## CVE-2025-9074 - Docker Desktop 权限提升 (Privilege Escalation), 隔离绕过 (Isolation Bypass), 未授权访问 (Unauthorized Access)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 权限提升 (Privilege Escalation), 隔离绕过 (Isolation Bypass), 未授权访问 (Unauthorized Access)

**影响应用:** Docker Desktop

**危害等级:** 高危 (High)

**CVSS评分:** 9.3

**影响版本:** Docker Desktop for Windows and macOS versions prior to 4.44.3

**利用条件:** 需要本地运行的恶意Linux容器；该恶意容器能够通过默认子网访问Docker Engine API (如 192.168.65.7:2375)。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2025-9074 是一个影响 Docker Desktop (Windows 和 macOS 版本) 的高危容器越权访问漏洞，CVSS 评分为 9.3。该漏洞允许在 Docker Desktop 环境中本地运行的恶意 Linux 容器绕过其固有的隔离机制。通过此漏洞，恶意容器可以直接访问宿主机器上的 Docker Engine API (通常在默认子网 192.168.65.7:2375 上开放)，从而实现对宿主机系统的完全控制。本质上，这个漏洞将容器内的权限提升到宿主机级别，可能导致数据泄露、系统篡改或进一步的网络渗透。此漏洞已在 Docker Desktop 4.44.3 版本中得到修复。

**POC 有效性分析:**
本次分析的 POC 是一个名为 `cve-2025-9074-poc.sh` 的 Bash 脚本，它是 `j3r1ch0123/CVE-2025-9074` (或其类似版本，如 `zenzue/CVE-2025-9074`) 的 Bash 实现，旨在不依赖 Python 环境的情况下，从容器内部运行。该 POC 的设计非常清晰和直接，能够完整地演示漏洞的利用过程。

POC 的核心在于利用未授权访问的 Docker Engine API。它通过向 API 发送 HTTP 请求来创建、启动、执行命令、获取日志，并最终清理容器。具体来说，该脚本能够创建一个新的 Alpine Linux 容器，并通过 `HostConfig` 参数指定一个 `bind mount`。这个 `bind mount` 将宿主机的 Windows C 盘 (`/mnt/host/c`) 映射到新创建容器内的 `/host_root` 目录。一旦挂载成功，攻击者就可以在新容器内执行任意命令，并通过 `/host_root` 访问宿主机的文件系统，从而窃取敏感文件、修改配置或部署恶意软件。

该 POC 脚本的有效性体现在以下几个方面：
1.  **完整的攻击链**: 脚本包含了从探测可用的 Docker API、创建容器、挂载宿主机目录、执行任意命令，到获取执行结果和清理环境的完整攻击流程。
2.  **实用性高**: 考虑到实际攻击场景中，许多容器可能没有安装 Python，Bash 脚本的实现大大增加了其在各种容器环境中的通用性和实用性。
3.  **清晰的逻辑**: 代码逻辑简洁明了，易于理解和审计，没有复杂的混淆或高级技术，专注于直接利用 Docker API。
4.  **直观的演示**: README 中提供的截图清晰地展示了通过挂载 `/host_root` 目录成功列出宿主机 C 盘内容的场景，直观地证明了漏洞的危害和 POC 的有效性。
因此，该 POC 达到了“完整利用”的级别，其质量评分为 9/10，功能完整且文档齐全。

**利用步骤:**
1.  **前提条件**: 攻击者需要在一个运行在 Docker Desktop (Windows 或 macOS) 环境中的容器内部，并且该 Docker Desktop 版本低于 4.44.3。
2.  **探测 Docker API**: 从容器内部，运行以下命令来探测宿主机上开放的 Docker Engine API 端口 (默认为 2375)：
    ```bash
    for ip in 172.18.0.1 172.17.0.1 192.168.65.7; do
        (echo > /dev/tcp/$ip/2375 2>/dev/null && echo "[+] $ip:2375 open") || :
    done
    ```
    这会输出可访问的 IP 地址和端口，例如 `192.168.65.7:2375`。
3.  **执行 POC 脚本**: 使用探测到的 IP 和端口，以及要执行的任意命令，运行 POC 脚本：
    ```bash
    ./cve-2025-9074-poc.sh <IP> <PORT> <CMD>
    ```
    例如，要列出宿主机的 C 盘内容，可以执行：
    ```bash
    ./cve-2025-9074-poc.sh 192.168.65.7 2375 "ls -la /host_root/"
    ```
    脚本将执行以下操作：
    *   通过 `curl` 向 `http://IP:PORT/containers/create` 发送 POST 请求，创建一个新的 `alpine` 容器。请求中包含 `HostConfig:{"Binds":["/mnt/host/c:/host_root"]}`，将宿主机的 C 盘挂载到新容器的 `/host_root`。同时，`Cmd` 参数指定了在容器启动时执行的命令 (`ls -la /host_root/`)。
    *   获取新容器的 ID。
    *   通过 `curl` 向 `http://IP:PORT/containers/$ID/start` 发送 POST 请求，启动新创建的容器。
    *   通过 `curl` 向 `http://IP:PORT/containers/$ID/logs?stdout=true&stderr=true` 获取容器的日志输出，即执行命令的结果。
    *   最后，脚本会通过 `http://IP:PORT/containers/$ID/stop` 和 `http://IP:PORT/containers/$ID` 停止并删除该临时容器，清理攻击痕迹。
4.  **结果验证**: 攻击者将从脚本输出中看到 `CMD` 命令在宿主机 C 盘上执行的结果。例如，如果 `CMD` 是 `ls -la /host_root/`，输出将是宿主机 C 盘的文件和目录列表。

**投毒风险分析:**
对提供的 POC 代码 (`cve-2025-9074-poc.sh`) 进行审计后，评估其投毒风险为 **0% (低风险)**。理由如下：
1.  **代码透明度高**: POC 代码是一个简洁的 Bash 脚本，所有操作都通过 `curl` 命令直接与 Docker Engine API 交互。代码没有进行任何混淆处理，每一行代码的意图都非常清晰，易于人工审查。
2.  **无外部依赖或可疑链接**: 脚本不从外部下载任何文件或执行其他外部脚本。它只依赖于系统中预装的 `curl` 和基本的 Bash 功能。没有发现任何指向可疑域名、IP 地址或恶意负载的链接。
3.  **操作行为可预测**: 脚本的核心功能是创建、启动、执行命令、获取日志和清理一个临时的 Docker 容器，并挂载宿主机目录。这些行为都是为了演示 CVE-2025-9074 漏洞利用的关键步骤。它不会在系统上留下永久性的后门，也不会尝试进行其他未经授权的操作。其 `CMD` 参数是用户提供的，脚本本身并未硬编码任何恶意命令。
4.  **符合安全研究目的**: 作为一份用于演示容器逃逸和宿主机文件系统访问的 POC，其功能和代码实现完全符合其安全研究目的，不包含任何超出漏洞证明范围的恶意代码。
5.  **无混淆或加密**: 代码中没有使用 `eval`、`base64` 编码、`hex` 编码或其他任何可能隐藏恶意逻辑的混淆或加密技术。
综上所述，该 POC 是一份安全、干净的漏洞验证代码，其目的仅仅是为了演示 CVE-2025-9074 的利用方式，不具备任何主动的投毒能力或恶意副作用。防御者可以放心地使用该 POC 进行漏洞复现和安全测试，无需担心其自身携带恶意负载。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
