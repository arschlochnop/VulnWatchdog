## CVE-2025-14847 - MongoDB Server 内存泄露 / 堆溢出

**漏洞编号:** CVE-2025-14847

**漏洞类型:** 内存泄露 / 堆溢出

**影响应用:** MongoDB Server

**危害等级:** 高危 (High)

**CVSS评分:** 8.1 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)

**影响版本:** 影响包含 zlib 压缩支持的多个版本 (具体版本需参考官方公告，已知涉及 v5.x, v6.x, v7.x 及 v8.x 的部分子版本)

**利用条件:** 远程网络访问，且 MongoDB 实例启用了 zlib 压缩协议（默认支持）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该漏洞源于 MongoDB 在处理 OP_COMPRESSED 消息时的逻辑缺陷。分析提供的 Go 代码（mongobleed.go）可见，攻击者构造了一个特殊的 zlib 压缩包，其 header 中声明的解压后长度与实际解压出的数据长度不一致。具体而言，buildScanProbe 函数构造了一个 OP_MSG 消息并进行 zlib 压缩，但在封装 OP_COMPRESSED 头时，手动设置了一个远大于实际解压后数据的长度字段（docLen+500）。当 MongoDB 服务端接收并处理此类请求时，由于缺乏对长度字段与实际解压输出长度的严格校验，导致服务端直接从堆内存中读取超出解压缓冲区范围的数据，并随响应返回给客户端。POC 代码展示了如何通过设置不同的 tag（如 'BLEED'）并在响应中检索该标志位来精准定位泄露的内存块。此 POC 逻辑清晰，完全符合 MongoDB 协议规范，具有极高的实战有效性，可导致服务器敏感配置、认证凭据或用户数据泄露。利用步骤如下：1. 初始化连接并确认目标端口开放；2. 构造含有伪造长度字段的 zlib 压缩负载；3. 发送 OP_COMPRESSED 类型的恶意数据包；4. 循环读取返回的响应包，并根据偏移量提取泄露的原始内存数据。【投毒风险分析】经过对提供的 POC 源代码进行深度安全审计，未发现明显的投毒行为。代码使用了 Go 标准库（bytes, compress/zlib, encoding/binary, net 等）进行协议构建，没有引用外部可疑的第三方依赖或未知的二进制执行文件。代码逻辑专注于网络套接字的读写和二进制数据的拼接，没有执行 shell 命令（os/exec）或访问本地敏感文件系统的操作。虽然漏洞利用本身具有高度危害，但该脚本仅作为研究工具使用，不具备自动横向移动或植入后门的特征。代码中唯一可能引起警觉的是对 mongo-driver 的间接引用，但在 go.sum 中其哈希值符合官方发布记录，不存在供应链篡改迹象。该 POC 的透明度较高，开发者可以通过简单的代码阅读验证其安全性。因此，投毒风险评级为极低（5%），主要风险在于攻击者可能将其直接集成为自动化扫描器的核心模块，但这属于漏洞利用范畴而非代码本身的投毒风险。

**项目地址:** [https://github.com/vulnwatchdog/mongobleed](https://www.google.com/search?q=https://github.com/vulnwatchdog/mongobleed) (基于路径推断)

**漏洞详情:** [https://www.cve.org/CVERecord?id=CVE-2025-14847](https://www.cve.org/CVERecord?id=CVE-2025-14847)
