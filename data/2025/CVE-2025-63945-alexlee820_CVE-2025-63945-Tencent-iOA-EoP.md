## CVE-2025-63945 - Tencent iOA 本地提权

**漏洞编号:** CVE-2025-63945

**漏洞类型:** 本地提权

**影响应用:** Tencent iOA

**危害等级:** 高危

**CVSS评分:** 未知

**影响版本:** 未知

**利用条件:** 需要本地访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该漏洞存在于Tencent iOA的PC Manager中，由于其对C:\Windows\Temp目录下的文件和目录处理不安全，攻击者可以利用符号链接（symlink）攻击，诱使SYSTEM权限的进程删除任意文件，从而导致本地权限提升。具体来说，当使用“ioa”组件时，会定期启动一个名为LegacyKB_ioa_win.exe的进程。在运行过程中，它会在Temp文件夹下创建一个TencentDownload目录，将文件下载到其中，并随后以SYSTEM权限执行删除操作。由于路径验证不足和不安全的删除逻辑，这种行为可能被滥用，以SYSTEM权限删除攻击者选择的文件，从而实现本地权限提升。

该漏洞利用过程如下：
1. 用户创建文件夹“C:\Windows\Temp\TencentDownload”。
2. 用户在文件夹“C:\Windows\Temp\TencentDownload\~*”上设置OpLock，一旦观察到创建任何~前缀的文件夹。
3. 进程“Legacy_*.exe”将尝试使用SYSTEM权限删除文件夹“C:\Windows\Temp\TencentDownload\~*”。
4. 由于OpLock，进程“Legacy_*.exe”将暂停。
5. 当OpLock被触发时，用户将文件“C:\Windows\Temp\TencentDownload\~*”移动到其他位置以清空该文件夹。
6. 用户创建从“C:\Windows\Temp\TencentDownload\”到“\RPC Control”的连接。
7. 用户创建从“GLOBAL\GLOBALROOT\RPC Control\~*”到目标文件夹/文件（例如，C:\Windows\System32\secrets）的符号链接。
8. 用户释放OpLock。
9. 用户删除符号链接。
10. 目标文件/文件夹（例如，C:\Windows\System32\secrets）将被删除。

POC有效性分析：该POC利用了Windows中的符号链接和目录连接的特性，结合Tencent iOA软件对临时目录的不安全处理，成功实现了任意文件删除。PoC作者提供了详细的利用步骤和演示视频，证明了该漏洞的可行性和危害性。该PoC质量较高，可以稳定复现漏洞。

投毒风险分析：该POC的投毒风险较低。虽然利用过程中涉及到创建符号链接和目录连接，但这些操作本身并不具有恶意性，只是被用于诱导SYSTEM权限进程删除指定文件。此外，该POC需要在本地执行，并且需要用户具有一定的权限才能创建符号链接和目录连接。攻击者可以通过将该POC打包成恶意软件进行传播，但由于其利用过程较为复杂，且需要一定的技术水平，因此投毒的难度较高。另外，由于其是LPE漏洞，配合其他漏洞使用，可能造成更大的危害，需要注意防范。
代码中未发现混淆，没有连接外部恶意脚本，没有发现后门代码。综上所述，该POC的投毒风险较低，为10%。

**项目地址:** https://github.com/user-attachments/assets/bcfb33df-bbe1-4276-bde8-d5453c87570d

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-63945
