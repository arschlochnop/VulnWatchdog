## CVE-2025-32463 - Sudo 本地权限提升 (Local Privilege Escalation, LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (Local Privilege Escalation, LPE)

**影响应用:** Sudo

**危害等级:** 高危 (Critical)

**CVSS评分:** 9.3

**影响版本:** Sudo 版本 1.9.14 到 1.9.17（含）

**利用条件:** 需要本地用户访问权限

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个存在于Sudo程序中的高危本地权限提升漏洞，CVSS评分高达9.3。该漏洞在Sudo v1.9.14版本中引入，并影响至v1.9.17版本。其根源在于Sudo在处理`--chroot`（或`-R`）选项时，未能正确处理`nsswitch.conf`文件以及动态链接库的加载机制。具体来说，当一个本地低权限用户通过`sudo -R`指定一个精心构造的chroot环境时，可以劫持Name Service Switch (NSS) 的解析过程。攻击者可以在chroot环境中放置一个恶意的`nsswitch.conf`文件，并使其指向一个攻击者控制的动态链接库。当sudo尝试在chroot环境中解析用户或组信息时，会加载这个恶意库，从而执行库中预设的代码，最终以root权限执行任意指令。

**POC有效性分析：**
所提供的POC代码（`CVE-2025-32463.sh`）是一个功能完整且高度有效的Shell脚本，能够成功利用CVE-2025-32463漏洞实现本地权限提升。该脚本的核心步骤和有效性体现在：
1.  **环境准备**：脚本首先使用`mktemp -d`创建一个唯一的临时目录（例如`/tmp/sudowoot.stage.XXXXXX`），确保攻击环境的隔离和避免与现有系统文件冲突。
2.  **恶意库生成**：它在临时目录中生成一个C语言源文件`woot1337.c`。这个C文件包含一个名为`woot`的构造函数（`__attribute__((constructor))`）。当这个共享库被加载时，`woot`函数会自动执行。`woot`函数的核心功能是调用`setreuid(0,0)`和`setregid(0,0)`来将当前进程的用户ID和组ID设置为0（即root权限），然后通过`execl("/bin/sh", "sh", "-c", "${CMD_C_ESCAPED}", NULL)`来执行用户指定的命令（默认为`/bin/bash`，提供一个root shell）。
3.  **编译恶意库**：脚本随后使用`gcc -shared -fPIC -Wl,-init,woot -o libnss_/woot1337.so.2 woot1337.c`命令将`woot1337.c`编译成一个动态链接库`libnss_/woot1337.so.2`。这里的命名`libnss_`和`.so.2`是关键，它模仿了NSS服务模块的命名规范，以便被系统加载。
4.  **劫持NSS配置**：脚本在chroot环境中创建了一个自定义的`nsswitch.conf`文件（`woot/etc/nsswitch.conf`）。这个文件被配置为在`passwd:`条目中包含`/woot1337`。这意味着当系统在chroot环境中查询用户密码信息时，会尝试加载并使用`libnss_/woot1337.so.2`。
5.  **触发漏洞**：最后，脚本执行`sudo -R woot woot`。`-R woot`指令告诉sudo在`woot`目录作为新的根目录中运行命令。当sudo在此chroot环境中尝试执行任何需要NSS解析的操作时，它将加载攻击者提供的恶意NSS模块`libnss_/woot1337.so.2`，从而触发其中的`woot`构造函数，最终实现权限提升。脚本执行完毕后会清理临时文件，确保环境的整洁。

**利用步骤：**
1.  将POC脚本（例如`CVE-2025-32463.sh`）下载到受影响的Linux系统上。
2.  确保脚本具有执行权限：`chmod +x CVE-2025-32463.sh`。
3.  以任意低权限用户身份执行脚本：`./CVE-2025-32463.sh`。
4.  脚本执行成功后，将立即获得一个root权限的shell会话。
5.  可以选择传递参数来执行特定的root命令：`./CVE-2025-32463.sh "id"` 将会以root身份执行`id`命令并显示输出。

**投毒风险分析：**
针对所提供的POC代码，投毒风险被评估为非常低（10%）。主要基于以下几点考量：

1.  **代码透明度与可读性**：POC脚本及其嵌入的C代码非常清晰、简洁，没有使用任何形式的代码混淆技术。攻击者可以很容易地审查每一行代码，理解其功能。C代码的核心逻辑（`setreuid(0,0); setregid(0,0); execl(...)`）是显而易见的权限提升操作，而非隐藏的恶意行为。

2.  **本地化操作**：所有文件（C源文件、编译后的共享库、`nsswitch.conf`）都是在本地通过`mktemp -d`创建的临时目录中生成的。脚本没有从外部网络下载任何文件或资源，从而杜绝了供应链攻击或中间人攻击引入恶意代码的可能性。

3.  **无外部通信**：POC代码中没有任何网络连接尝试、DNS查询或数据外发行为。这意味着脚本不会尝试将敏感信息发送到远程服务器，也不会从远程服务器接收进一步的指令。

4.  **标准工具的使用**：脚本仅依赖于标准的Linux工具和命令，如`mktemp`, `cd`, `cat`, `cp`, `gcc`, `echo`, `sudo`, `rm`。这些都是操作系统自带的合法工具，没有引入任何可疑的第三方二进制文件。

5.  **明确的利用目的**：该POC的唯一目的是演示CVE-2025-32463漏洞，并提供一个获取root权限的接口。脚本中所有操作都直接服务于这个目的，没有发现任何与漏洞利用无关的、具有持久性、隐蔽性或数据窃取性质的额外功能。例如，虽然它最终获取了root权限，但这是漏洞利用的结果，而不是POC本身偷偷植入的“后门”或“投毒”。

6.  **清理机制**：脚本最后包含了`rm -rf ${STAGE?}`命令，用于清除所有在临时目录中创建的文件和目录，展现了负责任的PoC行为，避免在系统上留下不必要的痕迹或垃圾文件。

综上所述，虽然该POC能够实现权限提升，其本身设计和实现是专注于漏洞验证的，不包含额外的、与演示目的不符的恶意投毒行为。

**项目地址:** https://github.com/kh4sh3i/CVE-2025-32463

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
