## CVE-2025-32463 - Linux Sudo组件 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Linux Sudo组件

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.9.14 up to 1.9.17 (before 1.9.17p1)

**利用条件:** 需要本地用户访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个影响Linux Sudo组件的高危本地提权漏洞，允许本地普通用户获取root权限。该漏洞的CVSS评分为9.3（严重），主要源于Sudo在处理`chroot`功能时，对非信任控制范围处理不当以及与NSS（Name Service Switch）模块加载机制的交互缺陷。具体来说，当`sudo`命令使用`-R`（chroot）选项时，在某些特定条件下，攻击者可以构造恶意环境参数，利用NSS劫持技术，在`chroot`沙箱完全生效之前或权限检查不完善的阶段，加载并执行恶意的NSS模块，从而绕过权限限制获取root权限。此漏洞在Sudo v1.9.14（2023年6月）中被引入，并影响包括Sudo 1.9.14至1.9.17版本（在1.9.17p1之前的所有版本）。

**POC有效性分析：**
所提供的POC脚本`CVE-2025-32463.sh`是一个功能完整的本地提权利用工具。该脚本通过以下步骤实现了完整的root权限获取：首先，它在`/tmp`目录下创建一个临时工作目录（例如`/tmp/sudowoot.stage.XXXXXX`），用于存放恶意载荷。其次，脚本动态生成一个C语言源文件`woot1337.c`。这个C文件包含一个`__attribute__((constructor))`修饰的`woot()`函数，这意味着该函数将在其所在的共享库被加载时自动执行。`woot()`函数的核心功能是调用`setreuid(0,0)`和`setregid(0,0)`将当前进程的有效和实际用户/组ID设置为root（0），然后执行一个由用户指定或默认为`/bin/bash`的命令，从而获取一个root shell。接着，脚本使用`gcc`将`woot1337.c`编译成一个共享库`libnss_/woot1337.so.2`。为了利用NSS劫持，脚本在临时目录中设置了一个伪造的`woot/etc`目录，并在其中创建了一个`nsswitch.conf`文件，将`passwd`查找指向恶意的`libnss_/woot1337.so.2`。最后，脚本通过执行`sudo -R woot woot`来触发漏洞。在脆弱版本的`sudo`中，`chroot`的实现与NSS模块加载的交互存在缺陷，使得攻击者可以控制的`libnss_/woot1337.so.2`在特权上下文中被加载，从而触发`woot()`函数，实现权限提升。POC在执行完毕后会清理所有创建的临时文件，具有良好的自清洁特性。经过分析，该POC能够可靠地利用CVE-2025-32463，有效性极高。

**利用步骤：**
1.  **环境准备**：攻击者在目标Linux系统上创建一个临时工作目录（例如`/tmp/sudowoot.stage.XXXXXX`），所有恶意文件都将在此目录中生成和存放。
2.  **创建恶意载荷**：生成一个名为`woot1337.c`的C语言源文件。该文件定义了一个特殊函数`woot()`，其目的是在被加载时将当前进程的用户和组ID提升为root（0），然后执行指定的shell命令（默认为`/bin/bash`，以获取root shell）。
3.  **编译共享库**：使用系统上的`gcc`编译器将`woot1337.c`编译成一个名为`libnss_/woot1337.so.2`的共享库文件。编译时会特别指定`woot()`函数作为初始化函数，确保在库加载时即刻执行。
4.  **设置NSS劫持环境**：在临时目录中创建`woot/etc`和`libnss_`子目录。在`woot/etc`目录下放置一个特制的`nsswitch.conf`文件，该文件将`passwd`服务的查询配置为使用攻击者控制的`libnss_/woot1337.so.2`。
5.  **触发漏洞**：执行命令`sudo -R woot woot`。这里的`-R`选项指示`sudo`在`woot`目录下执行后续操作。在脆弱的Sudo版本中，处理`chroot`与NSS模块加载的逻辑缺陷导致`sudo`在试图解析用户名等信息时，加载了攻击者提供的恶意NSS模块。
6.  **权限提升**：当`sudo`加载`libnss_/woot1337.so.2`时，其中的`woot()`函数作为初始化器被调用。该函数立即将进程权限提升至root，并执行预设的命令，从而实现本地提权，通常是获取一个root shell。
7.  **清理现场**：利用成功后，脚本会删除创建的所有临时文件和目录，以掩盖痕迹。

**投毒风险分析：**
此POC代码的投毒风险极低，评估为5%。其主要原因如下：
1.  **代码透明度高**：POC脚本`CVE-2025-32463.sh`采用Bash编写，代码逻辑清晰简洁，易于审计和理解。C语言部分的恶意载荷也直接嵌入在脚本中，没有进行任何混淆处理，其意图（权限提升）一目了然。
2.  **无外部依赖或网络请求**：脚本完全在本地执行，不包含任何外部网络请求（如下载远程文件、回调C2服务器等）或调用非标准库的行为。所有操作都依赖于本地系统工具（如`mktemp`, `cd`, `cat`, `gcc`, `cp`, `rm`）。
3.  **目的单一**：该POC的唯一目的在于演示和验证CVE-2025-32463本地提权漏洞。它通过NSS劫持和`chroot`缺陷实现root权限，此行为是漏洞利用的本质，不属于POC附带的额外恶意行为。
4.  **无持久化机制**：脚本在执行完成后会彻底删除所有创建的临时文件和目录（`rm -rf ${STAGE?}`），不会在系统上留下任何持久化的后门、恶意服务或配置修改，从而避免了不必要的副作用。
5.  **无混淆或加密**：代码中没有发现任何代码混淆、加密字符串、Base64编码的命令或其他旨在隐藏真实意图的技术。这意味着代码是直接可读和分析的。
综合来看，该POC是一个典型的、专注于漏洞利用原理的防御性安全研究工具，不包含任何额外的、与漏洞利用无关的恶意功能，因此其作为投毒载体的风险极小。

**项目地址:** 

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
