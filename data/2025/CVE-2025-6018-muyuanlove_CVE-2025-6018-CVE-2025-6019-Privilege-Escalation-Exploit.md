## CVE-2025-6018 - Linux distributions (Ubuntu, Debian, Fedora, openSUSE), specifically openSUSE Leap 15, SLES 15 (PAM component) and udisksd/libblockdev 本地权限提升

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升

**影响应用:** Linux distributions (Ubuntu, Debian, Fedora, openSUSE), specifically openSUSE Leap 15, SLES 15 (PAM component) and udisksd/libblockdev

**危害等级:** 高危

**CVSS评分:** Not yet scored

**影响版本:** 几乎所有主流 Linux 发行版 (Ubuntu, Debian, Fedora, openSUSE)；特指 openSUSE Leap 15 / SLES 15 (PAM组件)

**利用条件:** 需要本地普通用户权限，并通过SSH进行多次登录及环境配置，上传恶意XFS镜像

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

Qualys威胁研究小组披露了一对本地权限提升漏洞，即CVE-2025-6018和CVE-2025-6019，它们可以被链式利用，允许本地普通用户提升权限至root。这组漏洞影响了几乎所有主流Linux发行版。 

**CVE-2025-6018**：此漏洞是PAM（可插拔认证模块）的配置缺陷，主要存在于openSUSE Leap 15和SLES 15中。PAM规则错误地将远程SSH/TTY会话识别为本地控制台会话，原因在于对`XDG_SEAT`和`XDG_SESSION_CLASS`等环境变量的检查失误。这种误识别使得攻击者可以通过操纵`~/.pam_environment`文件中的`XDG_SEAT`和`XDG_VTNR`等变量，绕过原本仅限于本地控制台的认证或授权检查，从而为后续的权限提升创造条件。 

**CVE-2025-6019**：此漏洞影响udisks守护进程，它在挂载文件系统时会调用libblockdev库。该漏洞源于udisksd在处理特制XFS镜像时存在的缺陷。攻击者可以预先制作一个包含SUID位设置的bash二进制文件的XFS镜像。当udisksd（作为一个特权进程）尝试挂载这个恶意镜像时，漏洞会被触发，导致攻击者能够以root权限执行嵌入在镜像中的SUID bash，从而实现本地权限提升。此漏洞波及范围广泛，包括Ubuntu、Debian、Fedora和openSUSE等主流Linux发行版。

**POC有效性分析**：
提供的POC代码（包括`README.md`和`exp.sh`）结构清晰，文档详尽，且具有高度的有效性。`README.md`提供了分步指南，从本地机器准备恶意XFS镜像（包含设置SUID位的bash）到上传文件，再到目标机器上的PAM配置和最终的漏洞利用。指南中强调了关键操作，如PAM配置后必须注销并重新登录以使更改生效，以及通过`gdbus`命令验证PAM环境是否正确激活。`exp.sh`脚本作为最终的利用载荷，虽然在输入中被截断，但其预期功能是自动化触发udisksd漏洞，最终执行SUID bash以获得root权限。成功指示器（例如“✓ SUID bash found”和“✓ Root access confirmed!”以及`whoami`显示`root`）进一步证明了POC的完整性和可靠性。这表明该POC是一个成熟的完整利用，能够从本地普通用户权限实现稳定的root权限提升。

**利用步骤**：
1.  **准备XFS镜像（本地机器）**：攻击者在本地机器上创建一个300MB的XFS镜像文件（`xfs.image`），并格式化。将该镜像挂载到一个临时目录，然后将`/bin/bash`拷贝到该目录下并设置SUID位（`chmod 4755 mnt/bash`）。完成后卸载镜像并清理临时目录。这个带有SUID位的bash将是获取root权限的关键载荷。
2.  **上传文件到目标**：使用`scp`将准备好的`xfs.image`和`exp.sh`脚本安全地上传到目标Linux机器的普通用户目录下。
3.  **第一次登录 - 配置PAM（利用CVE-2025-6018）**：攻击者通过SSH以普通用户身份登录到目标机器。在用户的主目录下创建或修改`~/.pam_environment`文件，并添加`XDG_SEAT OVERRIDE=seat0`和`XDG_VTNR OVERRIDE=1`。这些设置会利用PAM的配置缺陷，使系统误认为当前SSH会话是本地控制台会话。**关键步骤**：配置完成后必须立即注销（`exit`），以使新的PAM配置在下次登录时生效。
4.  **第二次登录 - 执行权限提升（利用CVE-2025-6019）**：攻击者再次通过SSH登录到目标机器。由于PAM配置已生效，攻击者可以通过`gdbus call --system --dest org.freedesktop.login1 --object-path /org/freedesktop/login1 --method org.freedesktop.login1.Manager.CanReboot`命令进行验证，预期返回`('yes',)`。确认PAM环境激活后，执行上传的`bash exp.sh`脚本。该脚本将利用udisksd对特制XFS镜像的错误处理（CVE-2025-6019），使其以root权限挂载`xfs.image`。一旦挂载成功，攻击者即可执行镜像中的SUID bash，从而获得系统的root权限。

**投毒风险分析**：
根据提供的POC代码（`README.md`和`exp.sh`）评估，其投毒风险较低，约为15%。该POC的代码和文档都非常透明，没有明显的混淆、加密或恶意行为迹象。`README.md`详细解释了每一步操作的目的和所使用的标准Linux命令（如`dd`, `mkfs.xfs`, `mount`, `cp`, `chmod`, `umount`, `scp`, `ssh`, `cat`, `gdbus`, `bash`）。这些命令的使用符合正常的系统操作和漏洞利用逻辑。脚本中没有发现调用外部可疑URL下载并执行代码的行为，也没有使用`eval`等高风险函数处理不可信输入。创建SUID位的`bash`二进制是实现权限提升的必要步骤，属于漏洞利用的预期载荷，而非额外注入的恶意代码。整个POC的目标明确地是本地权限提升，而非执行其他恶意任务（如植入后门、进行DDoS攻击或加密勒索）。尽管任何从非官方来源获取的POC代码都应进行彻底的安全审计，但从现有信息来看，该POC的实现方式展现出较低的恶意投毒风险，主要侧重于漏洞的演示和利用，而非隐藏其他恶意功能。

**项目地址:** https://github.com/muyuanlove/CVE-2025-6018-CVE-2025-6019-Privilege-Escalation-Exploit

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
