## CVE-2025-6018/CVE-2025-6019 - Linux主流发行版 (如Ubuntu, Debian, Fedora, openSUSE, RHEL, TencentOS, SUSE Linux Enterprise Server) 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-6018/CVE-2025-6019

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Linux主流发行版 (如Ubuntu, Debian, Fedora, openSUSE, RHEL, TencentOS, SUSE Linux Enterprise Server)

**危害等级:** 高危 (High) - 本地攻击者可获取Root权限

**CVSS评分:** 

**影响版本:** 几乎所有主流Linux发行版，特别针对 openSUSE Leap 15 / SLES 15 的PAM模块，以及udisks2受影响版本

**利用条件:** 需要攻击者已具备目标系统的本地普通用户权限；需要通过SSH进行多次登录操作以激活PAM配置；目标系统需支持XFS文件系统；需上传恶意XFS镜像文件和攻击脚本

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-6018和CVE-2025-6019是近期由Qualys研究人员披露的两个关键本地权限提升漏洞，它们可以组合成一个强大的漏洞链，允许已获得低权限的攻击者在受影响的Linux系统上轻松获取root权限。CVE-2025-6018存在于openSUSE/SLES的PAM（可插拔认证模块）栈中。该漏洞允许远程登录的用户（例如通过SSH）伪装成“物理在场”的本地控制台用户，从而绕过某些权限检查。CVE-2025-6019则存在于udisks2守护进程中，具体是在调整XFS文件系统大小时挂载操作的一个缺陷。当udisks2在特定条件下处理一个由攻击者控制的XFS镜像时，它可以触发`setuid`程序（如 `/bin/bash`）的执行，从而导致权限提升。这两个漏洞独立来看各有影响，但组合利用时，CVE-2025-6018的PAM绕过为CVE-2025-6019的udisks2利用创造了必要的前提条件，使其能在特权上下文中执行，最终导致完全的本地root权限。

**POC有效性分析与利用步骤：** 提供的POC代码包括一个详尽的`README.md`文件和一个名为`exp.sh`的Bash脚本，清晰地展示了如何利用这一漏洞链。`README.md`提供了分步指南，包括准备恶意XFS镜像、上传文件到目标、配置PAM环境、以及最终执行提权脚本的详细说明。
1.  **准备XFS镜像（本地机器）**：攻击者首先在本地机器上创建一个300MB的XFS镜像文件（`xfs.image`）。在这个镜像内部，`/bin/bash`被复制并设置了SUID位（`chmod 4755 mnt/bash`），使其在执行时能以所有者权限运行（在此案例中，目标是root）。然后卸载并验证镜像大小。
2.  **上传文件到目标**：通过`scp`将精心制作的`xfs.image`和`exp.sh`脚本上传到目标机器的普通用户家目录。
3.  **首次登录 - 配置PAM**：攻击者通过SSH登录到目标系统，并在当前用户的`~/.pam_environment`文件中写入特定的环境变量（`XDG_SEAT OVERRIDE=seat0`和`XDG_VTNR OVERRIDE=1`）。这些变量旨在利用CVE-2025-6018绕过PAM的本地控制台判断逻辑。**关键步骤是用户必须注销并重新登录**，以使PAM配置生效。
4.  **第二次登录 - 执行权限提升**：攻击者重新SSH登录。此时，由于PAM配置已激活，系统会错误地将远程会话视为本地控制台会话。通过`gdbus`命令验证PAM配置是否生效（`CanReboot`应返回`('yes',)`）。一旦确认，便执行上传的`exp.sh`脚本。该脚本会利用CVE-2025-6019，通过`udisksctl`命令挂载恶意的XFS镜像，并寻找并执行镜像内部的SUID Bash Shell，从而获得root权限。
POC的成功指示器清晰，包括找到SUID Bash路径、root权限确认以及`whoami`命令输出`root`。整个POC流程完整、逻辑严谨，且提供了详细的故障排除指南，表明其具有高度的可用性和有效性。

**投毒风险分析：** 针对该POC的投毒风险评估为低（约10%）。主要原因如下：
1.  **代码可读性高**：`exp.sh`是一个纯Bash脚本，代码结构清晰，没有明显的混淆或加密。所有操作，如文件系统创建、SUID设置、PAM配置、以及`udisksctl`的调用，都以明文形式展示，易于安全研究人员进行审计和理解。
2.  **依赖标准工具**：脚本主要依赖Linux系统中常见的标准工具和命令，如`dd`, `mkfs.xfs`, `mount`, `chmod`, `scp`, `ssh`, `cat`, `gdbus`, `udisksctl`等。这些工具本身是合法的，POC仅是利用它们组合成的漏洞链。
3.  **无外部依赖或隐藏请求**：POC代码中没有发现任何对外部恶意域名的请求、下载可疑二进制文件、使用`curl`或`wget`获取未知内容的行为。它不包含任何`eval`命令用于执行动态的、可能被注入的字符串，从而避免了常见的远程代码执行投毒手法。
4.  **恶意负载由攻击者生成**：POC的核心“恶意”部分（SUID Bash）是由攻击者在本地机器上主动创建到XFS镜像中，然后上传到目标系统。这意味着POC脚本本身并非直接引入恶意软件，而是为攻击者提供的预制恶意负载（SUID Bash）提供了一个执行通道。这种模式使得潜在的恶意行为更容易被追溯到攻击者而非POC脚本本身。
5.  **透明的提权过程**：提权过程中涉及的关键步骤，如PAM环境变量的设置和`udisksctl`的调用，都是公开且可被监控的。脚本执行后，成功获取root权限的标志也明确列出，没有试图隐藏其行为。
综上所述，该POC的主要目的是验证漏洞，而非作为传播恶意软件的载体。其透明的执行流程和对标准工具的依赖，使得其被恶意篡改的风险较低，被用作投毒攻击的风险也相对可控。用户在下载和使用此类POC时，仍应从官方或可信来源获取，并进行必要的代码审计。

**项目地址:** https://github.com/muyuanlove/CVE-2025-6018-CVE-2025-6019-Privilege-Escalation-Exploit

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
