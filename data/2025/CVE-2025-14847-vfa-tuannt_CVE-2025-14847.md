## CVE-2025-14847 - MongoDB 内存泄露 (Memory Leak)

**漏洞编号:** CVE-2025-14847

**漏洞类型:** 内存泄露 (Memory Leak)

**影响应用:** MongoDB

**危害等级:** 高危 (High-Severity)

**CVSS评分:** 未提供具体评分，但评估为高危。

**影响版本:** MongoDB Community和Enterprise editions以及MongoDB Atlas的多个版本受影响。Percona Server for MongoDB (PSMDB) 也受影响。具体受影响版本包括但不限于 MongoDB Server 8.2.0 ≤ v ≤ 8.2.2，以及 MongoDB Server 8.0.0 ≤ v ≤ 8.0.x 系列中所有支持zlib压缩的早期版本。官方已发布修复版本：4.4.30+, 5.0.32+, 6.0.27+, 7.0.28+, 8.0.17+。

**利用条件:** 无需认证的远程网络访问。目标MongoDB实例需启用Zlib压缩功能。

**POC 可用性:** 9/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

MongoDB是一款广泛使用的NoSQL数据库系统。CVE-2025-14847，代号“MongoBleed”，是一个存在于MongoDB Zlib压缩协议中的高危堆内存信息泄露漏洞。该漏洞的根本原因在于`message_compressor_zlib.cpp`文件中，代码在处理Zlib解压缩数据时，错误地使用了`output.length()`来返回已分配的内存大小，而非实际解压缩数据的长度。这导致在接收到特制的、格式错误的Zlib压缩数据包时，服务器可能会读取并返回未初始化的堆内存内容。未经身份验证的远程攻击者可以通过发送此类恶意数据包，触发该漏洞，从而泄露服务器内存中的敏感数据，可能包含凭据、配置信息或其他运行时数据。此漏洞影响MongoDB Community和Enterprise版本，以及MongoDB Atlas和基于MongoDB上游代码的Percona Server for MongoDB的多个版本。

**POC有效性分析**：所提供的`HOW_TO_FIX.md`文档清晰且专业地指导了如何搭建、执行和验证此漏洞的概念验证（PoC）。该PoC设计得非常完善，旨在通过Docker Compose轻松部署一个易受攻击的MongoDB实例，并利用Node.js和Yarn环境执行一个名为`poc.ts`的脚本。文档明确指出，`poc.ts`脚本在连接到启用Zlib压缩的MongoDB服务时，“应该触发内存泄露”。这表明该PoC能够有效复现和验证CVE-2025-14847漏洞。文档中还包含了详细的修复方案和验证步骤，如检查Docker日志或通过`mongo --eval`命令查询配置，以及在修复后再次运行PoC以确认漏洞已无法利用。这些细节都强调了该PoC的可靠性和实证性，使其成为一个高质量、功能完整的漏洞验证工具。

**利用步骤**：
1.  **准备环境**: 攻击者需要一台安装了Node.js (v14或更高版本)、Yarn包管理器、Docker及Docker Compose的机器。
2.  **安装依赖**: 在获取的PoC项目目录中，执行`yarn install`命令以下载必要的Node.js依赖。
3.  **启动漏洞服务**: 使用`docker-compose up -d`命令启动一个预配置的、启用Zlib压缩的易受攻击MongoDB实例。PoC文档中的`docker-compose.yml`文件会确保启动一个特定易受攻击版本的MongoDB。
4.  **等待服务就绪**: 建议等待约10-15秒，以确保MongoDB服务完全启动并可接受连接。
5.  **执行PoC**: 运行命令`yarn ts-node poc.ts`。此脚本将作为客户端连接到目标MongoDB服务，发送特制的、格式错误的Zlib压缩数据包。
6.  **触发并观察**: 当PoC数据包被MongoDB服务器接收并处理时，会触发堆内存泄露。攻击者可通过PoC的输出、服务器日志或网络流量捕获来观察并收集泄露的内存数据。

**投毒风险分析**：本次评估是基于`HOW_TO_FIX.md`这份公开的漏洞修复指南，而非实际的`poc.ts`代码文件。该文档清晰、结构化地描述了漏洞背景、搭建环境、运行PoC及修复措施。根据文档，`poc.ts`的主要目标是发送特定格式的网络数据以触发内存泄露，旨在验证漏洞的存在。这种行为符合防御性安全研究中对PoC的预期，即演示漏洞而非执行恶意payload。PoC环境的搭建依赖于Docker、Node.js和Yarn等成熟、广泛使用的开源工具。文档中没有指示用户从非官方或可疑源下载任何软件或脚本，`yarn install`通常从官方registry获取包。尽管所分析的`HOW_TO_FIX.md`文档本身并无恶意内容，但任何PoC代码，如果未经仔细审查，理论上都可能被篡改。然而，考虑到其作为防御性安全研究的上下文，以及文档中所有描述都指向合法的漏洞测试和修复流程，其被用于投毒的直接风险极低。该PoC的透明度和详细的指导使其易于审查。综合以上分析，此PoC的投毒风险被评估为**低** (约10%)。这份文档为防御者提供了宝贵的工具和信息，帮助他们理解并应对MongoDB内存泄露漏洞。建议在运行任何PoC代码前，仍需对实际的`poc.ts`文件进行代码审查，以确保其行为符合预期。

**项目地址:** 

**漏洞详情:** 
