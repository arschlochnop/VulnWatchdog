## CVE-2025-8110 - Gogs 远程命令注入 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程命令注入 (RCE)

**影响应用:** Gogs

**危害等级:** 高危 (Critical)

**CVSS评分:** 9.8 (推测，基于高危及在野利用)

**影响版本:** 未明确指定版本，但已有在野利用，建议用户尽快关注官方公告并更新。

**利用条件:** 需要认证 (Authentication Required)，需要网络访问 (Network Access)，需要创建仓库权限。

**POC 可用性:** 9.5/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析: 提供的Python POC脚本针对CVE-2025-8110是高度有效且结构良好的。它全面实现了Gogs远程命令注入漏洞的利用链。脚本首先处理用户注册或登录，表明此漏洞需要认证后的用户才能触发。随后，它获取应用程序令牌，创建新的Git仓库，并将一个协作者添加到该仓库。这些步骤是为核心的漏洞触发机制做准备。该漏洞利用了Gogs在处理Git操作时存在的Time-of-Check to Time-of-Use (TOCTOU) 竞态条件，特别是与`git remote add`命令相关联的逻辑缺陷。通过精心构造，脚本能够利用这一竞态条件，在Gogs后端处理Git仓库时注入恶意的Git钩子（例如`pre-receive`钩子），从而实现任意命令执行。POC代码通过`BeautifulSoup`库实现了对CSRF令牌的正确提取和处理，确保了与Gogs Web界面的顺畅交互。它还包含了错误检查机制，并通过`rich`库提供了友好的控制台输出。值得称道的是，脚本还集成了清理功能，能够在漏洞利用完成后删除其创建的临时用户和仓库，这对于测试和研究环境而言是非常有益的。考虑到其自动化程度、对复杂利用流程的完整覆盖以及代码的清晰度，该POC被评定为高质量的完整利用脚本。

利用步骤: 针对CVE-2025-8110的攻击流程，如POC脚本所示，通常遵循以下自动化步骤：
1.  **用户认证**: 攻击者首先通过`register`或`login`函数在目标Gogs实例上进行注册或登录。这是攻击的前提，因为漏洞需要一个已认证的用户来执行后续操作。
2.  **获取应用程序令牌**: 成功登录后，脚本会访问用户的应用设置页面，生成并获取一个API令牌。此令牌可能用于在自动化过程中进行身份验证，以执行Git操作或绕过某些权限检查。
3.  **创建恶意仓库**: 攻击者在Gogs平台上创建一个新的Git仓库。这个仓库将作为载体，用于后续注入恶意Git钩子。
4.  **添加协作者**: 脚本将一个由攻击者控制的“恶意”用户添加为刚刚创建的仓库的协作者。这一步是利用TOCTOU竞态条件的关键环节。在Gogs处理协作者添加或相关仓库操作时，可能存在一个时间窗口，允许攻击者在Gogs后端完成对Git URL的验证之前，或在执行特定Git命令时，进行恶意代码的注入。
5.  **注入恶意Git Hook**: 在特定的Git操作（如通过 Git URL 执行`git remote add`）期间，利用Gogs对路径和文件操作的竞态条件，攻击者能够将一个恶意的Git钩子文件（例如`pre-receive`脚本）写入到Gogs服务器上的目标仓库目录中。这个钩子包含了攻击者预设的命令。
6.  **触发命令执行**: 当Gogs服务器或任何用户对被注入恶意钩子的仓库执行特定的Git操作（如推送代码或某些后台任务）时，被注入的Git钩子就会被自动执行，从而导致攻击者预设的任意命令在Gogs服务器上被执行。POC中展示了如何利用此机制获取反向Shell。
7.  **清理**: 攻击完成后，POC脚本会尝试删除在攻击过程中创建的临时用户和仓库，以清理攻击痕迹并恢复环境。

投毒风险分析: 针对所提供的CVE-2025-8110 POC代码进行的安全审查表明，其投毒风险极低，评估为5%。该Python脚本的唯一明确目的在于演示和验证Gogs中的远程命令注入漏洞，不包含任何额外、未声明的恶意功能。代码结构清晰，使用了Python标准库（如`requests`, `os`, `subprocess`）以及广为人知的第三方库（如`urllib3`, `BeautifulSoup`, `rich.console`），这些库本身不携带恶意负载。脚本未发现任何代码混淆、加密或尝试下载并执行来自未知或可疑源的外部代码的行为。所有的网络请求和系统调用都是为了实现漏洞利用逻辑，例如注册用户、创建仓库、触发Git操作以及最终执行反向Shell命令。值得注意的是，POC代码中包含了清理函数（`clean_up`），用于删除攻击过程中创建的用户和仓库，这进一步证明了其作为安全研究工具的性质，而非旨在持久驻留或造成额外损害。POC中的“恶意”部分仅限于作为漏洞利用负载的Git Hook脚本，其目的是在目标服务器上执行攻击者的命令，但这属于漏洞本身的功能，而非POC代码的额外恶意行为。因此，只要确保POC脚本是从可信来源获取且未被篡改，它在用于合法安全测试时不会带来额外的投毒风险。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
