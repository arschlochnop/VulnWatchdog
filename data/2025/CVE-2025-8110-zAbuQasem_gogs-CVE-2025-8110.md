## CVE-2025-8110 - Gogs 远程代码执行 (RCE), 符号链接绕过

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE), 符号链接绕过

**影响应用:** Gogs

**危害等级:** 高危，已在野外被积极利用，造成大量实例被攻陷。

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H (7.8)

**影响版本:** Gogs <= (所有受影响的未修复版本)

**利用条件:** 需要经过身份认证的攻击者；需要网络访问；中等攻击复杂度。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-8110是Gogs开源自托管Git服务中的一个严重远程代码执行（RCE）漏洞。该漏洞的根源在于Gogs在处理Git仓库文件操作（特别是文件上传和在线编辑功能）时对符号链接的过滤不当。攻击者可以通过构造包含恶意符号链接的Git仓库，欺骗Gogs服务器将文件内容写入到仓库目录之外的任意位置。此漏洞是对先前已修复的远程代码执行漏洞CVE-2024-55947（CVSS评分8.7）的安全修复的绕过。攻击者利用符号链接机制，可以创建指向例如`.git/hooks`目录或用户SSH密钥文件（如`~/.ssh/authorized_keys`）的符号链接。当Gogs处理包含这些恶意符号链接的文件时，会将攻击者上传的恶意内容写入到符号链接指向的系统关键文件，最终导致攻击者在目标服务器上执行任意代码或获取SSH访问权限。该漏洞已在野外被积极利用，据报道已造成超过700个公网暴露的Gogs实例遭到攻陷，凸显了其高危性和紧迫的修复需求。

**POC有效性分析**
提供的Python POC脚本是一个功能完整的自动化利用工具，能够有效地复现和利用CVE-2025-8110。该脚本采用模块化设计，清晰地实现了攻击的各个阶段。它首先通过`register`和`login`函数处理用户认证，这是利用漏洞的前提条件。随后，脚本能够获取必要的应用程序令牌，并创建恶意仓库。其核心利用逻辑在于`create_evil_repo_file`和`edit_repo_file`函数，通过精心构造的本地Git仓库，包含指向目标服务器敏感路径（如`../../../.ssh/authorized_keys`）的符号链接。然后，脚本上传或修改一个包含攻击者SSH公钥的文件，利用Gogs对符号链接处理的缺陷，将公钥写入到目标服务器的`authorized_keys`文件中。最后，脚本尝试通过SSH连接到目标服务器以验证RCE的成功。脚本使用了`requests`库处理HTTP通信，`BeautifulSoup`解析HTML获取CSRF令牌，`subprocess`执行本地Git命令和SSH连接，以及`shutil`进行文件操作。其流程设计严谨，代码逻辑清晰，错误处理机制也较为完善，能够稳定地实现从认证到RCE的完整攻击链。因此，该POC具有非常高的有效性和可靠性。

**利用步骤**
1.  **认证**: 攻击者通过Gogs的用户注册功能创建一个新账户，或者使用已有的合法用户凭证登录系统。
2.  **创建恶意仓库**: 攻击者在本地初始化一个Git仓库，并精心构造包含恶意符号链接的文件。例如，创建一个名为`sym.txt`的符号链接，使其指向目标服务器的敏感路径，如`../../../.ssh/authorized_keys`。
3.  **准备恶意载荷**: 攻击者生成一对SSH密钥，并将公钥内容保存到另一个文件（例如`key.txt`）中。
4.  **上传恶意仓库**: 攻击者将包含`sym.txt`符号链接和`key.txt`公钥文件的本地仓库推送到Gogs服务器。
5.  **触发漏洞**: 攻击者利用Gogs的在线文件编辑或文件上传功能，选择修改或上传`key.txt`的内容。由于`sym.txt`是一个符号链接，Gogs服务器在处理此操作时，会将`key.txt`的内容（即攻击者的SSH公钥）通过`sym.txt`指向的路径，写入到目标服务器的`~/.ssh/authorized_keys`文件中。
6.  **远程访问**: 一旦攻击者的SSH公钥被成功写入，攻击者便可以使用其对应的私钥，通过SSH协议远程连接并登录到受感染的Gogs服务器，从而实现远程代码执行。

**投毒风险分析**
该POC代码是用Python编写的，主要依赖于标准的Python库以及`requests`、`beautifulsoup4`、`rich`和`urllib3`等广泛使用的第三方库。代码结构清晰，逻辑透明，没有明显的混淆或加密代码块。在对代码进行审查后，未发现任何旨在恶意感染运行POC的本地系统（即分析者机器）的行为。`subprocess`模块的调用主要用于执行`git`命令（如`git init`, `git add`, `git commit`, `git push`）和`ssh`命令（用于验证漏洞利用成功后的连接），这些都是为了实现对目标Gogs服务器的攻击，而非对本地系统进行攻击。代码中没有发现下载并执行外部可疑脚本、使用`eval()`函数执行不受控输入、或进行任何非预期的文件系统操作。因此，从本地执行POC的角度来看，该POC的投毒风险极低（约为10%）。建议在隔离的测试环境中运行任何POC代码，以进一步降低潜在风险，并监控网络流量和系统行为。

**项目地址:** N/A - POC来自本地文件系统，未提供公开仓库地址

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
