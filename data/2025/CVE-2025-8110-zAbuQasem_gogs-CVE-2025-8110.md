## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 8.7 (CVSS 4.0)

**影响版本:** Gogs (所有包含CVE-2024-55947修复但未修复此符号链接绕过漏洞的版本)

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-8110是一个影响Gogs自托管Git服务的高危远程代码执行（RCE）漏洞。该漏洞的根源在于Gogs在处理Git仓库文件操作（特别是文件上传和在线编辑功能）时，对符号链接（Symbolic Link）的过滤不当。攻击者可以通过构造包含恶意符号链接的仓库，成功绕过此前针对CVE-2024-55947的路径限制防护机制，欺骗Gogs服务器将文件内容写入到仓库目录之外的任意位置，最终实现远程命令执行。该漏洞已在野外被积极利用，造成了超过700个公网暴露的Gogs实例遭到攻陷。

**POC有效性分析:**
提供的Python脚本`CVE-2025-8110.py`是一个功能完整的漏洞利用工具。该脚本结构清晰，使用了`requests`库进行HTTP通信，`bs4`解析HTML以提取CSRF令牌，以及`subprocess`模块调用本地Git命令来构建和推送恶意仓库。脚本首先实现了用户认证功能，支持注册新用户或使用现有凭据登录，确保了利用的前提条件——“需要认证”。随后，它能够获取必要的应用API Token，这是Gogs API交互的关键。利用的核心在于`create_malicious_tree`和`push_malicious_tree`函数，它们协同工作，在本地构建一个包含精心设计的符号链接的Git仓库。这些符号链接旨在指向Gogs服务器上的敏感文件路径，例如Git Hooks目录。通过将这个恶意构造的仓库推送到目标Gogs实例，脚本利用了Gogs对符号链接处理的缺陷，使得服务器错误地将恶意内容写入到符号链接指向的任意路径。最终，`exec_command`函数用于在目标服务器上触发并执行任意命令，例如通过激活被覆盖的Git Hook来实现远程代码执行。整个流程自动化程度高，代码逻辑严谨，易于理解和使用，充分证明了漏洞的有效性和可利用性。

**利用步骤:**
1.  **认证阶段**: 攻击者首先通过脚本的`register`或`login`函数，在目标Gogs实例上获取一个有效的用户会话和CSRF token。这通常需要攻击者拥有一个Gogs账户，或者目标实例开放了注册功能。
2.  **获取应用Token**: 登录成功后，脚本会模拟用户行为，访问Gogs的用户设置页面以生成并获取一个API应用Token。此Token在后续与Gogs API交互时用于认证。
3.  **创建恶意Git仓库**: 攻击者通过Gogs API在目标实例上创建一个新的Git仓库。
4.  **构建本地恶意载荷**: 在本地临时目录中，脚本初始化一个新的Git仓库。然后，它通过命令行方式（使用`subprocess`调用`git`命令）或文件系统操作，创建包含恶意符号链接的文件结构。这些符号链接被巧妙地构造，旨在绕过Gogs的文件路径限制，并指向Gogs服务器上的敏感文件，例如`.git/hooks`目录下的脚本文件。
5.  **推送到目标**: 攻击者将本地构造的恶意Git仓库（包含这些符号链接）推送到目标Gogs实例上新创建的仓库。由于Gogs在处理Git对象和文件写入时的逻辑缺陷，服务器会错误地解析这些符号链接，导致恶意文件内容（如Shell脚本）被写入到符号链接指向的任意服务器路径。
6.  **触发远程命令执行(RCE)**: 一旦恶意文件（例如，作为Git Hook脚本）被写入到目标服务器的可执行位置，攻击者可以通过触发相应的Git操作（如`git push`、`git pull`或在Gogs UI上进行某些操作）来激活该Hook。Gogs服务器执行这些Git操作时会自动调用Hook脚本，从而在服务器上执行攻击者预设的任意命令，实现远程代码执行。

**投毒风险分析:**
对`CVE-2025-8110.py`的投毒风险评估结果为低风险，具体百分比为10%。理由如下：
*   **代码透明度高**: 脚本代码清晰、可读性强，没有发现任何形式的代码混淆、加密或不透明的逻辑。所有函数和变量的命名都符合Python编程规范，易于安全研究人员审计其行为。
*   **无恶意外部连接**: 除了与目标Gogs实例进行交互外，该POC代码未向任何其他可疑的第三方服务器发起网络连接请求。`urllib3.disable_warnings`用于禁用SSL警告，这在渗透测试工具中是常见实践，并非恶意行为。
*   **标准库使用**: 脚本主要依赖Python标准库（如`os`, `subprocess`, `shutil`）和广受认可的第三方库（`requests`用于HTTP通信，`bs4`用于HTML解析，`rich`用于增强控制台输出）。未发现使用非标准、来源不明或具有高风险的第三方库。
*   **无后门或恶意载荷植入**: 该POC的目标是演示如何在远程Gogs服务器上实现RCE，而不是在运行POC的本地机器上植入后门或执行恶意操作。`subprocess`模块主要用于调用本地的`git`命令来构造攻击载荷，以及在成功利用后通过Gogs API在目标服务器上执行命令。本地临时文件的创建和清理都是为了实现漏洞利用，没有发现对本地系统造成持续性损害的意图。
*   **无危险函数滥用**: 代码中没有发现`eval()`、`exec()`等可能导致代码注入或反射型攻击的危险函数被滥用，所有命令执行都受控且目标明确地指向受攻击的Gogs服务器。

综上所述，该POC代码是纯粹的漏洞利用演示工具，其内部不包含任何恶意感染或传播机制，也不会对运行它的本地环境造成威胁。用户在进行安全测试时，可以放心地使用该POC，但必须确保仅在授权和受控的测试环境中使用，以避免对生产环境造成意外影响。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
