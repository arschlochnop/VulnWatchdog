## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 7.8

**影响版本:** Gogs <=

**利用条件:** 需要认证 (Authenticated)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-8110是Gogs自托管Git服务中的一个严重远程代码执行漏洞，其核心在于Gogs对Git仓库中的符号链接（Symbolic Link）处理存在逻辑缺陷。此漏洞是对先前发现的CVE-2024-55947（一个允许经过认证的攻击者向服务器任意路径写入文件的RCE漏洞）的安全修复的成功绕过。CVE-2024-55947的修复尝试限制文件写入操作，但并未充分考虑符号链接的滥用，导致攻击者可以通过精心构造的Git仓库再次实现任意文件写入和远程代码执行。

提供的POC脚本（CVE-2025-8110.py）是一个用Python编写的完整利用工具，它自动化了整个攻击流程。脚本首先通过`register()`和`login()`函数在目标Gogs实例上创建一个新用户并完成认证。这一步骤明确了该漏洞的利用需要攻击者具备有效的用户凭证。成功认证后，脚本会进一步调用`get_application_token()`来获取应用程序API令牌，这在某些Gogs版本或配置中可能用于执行Git相关操作或利用特定的管理功能。

攻击的核心环节在于`create_repo()`和`exploit_dotgit_rewrite()`函数。攻击者创建一个包含恶意符号链接结构的Git仓库，并将其推送到Gogs服务器。该脚本利用的独特之处在于，它创建了一个名为`.git`的目录，而不是传统意义上的 `.git` 目录，并在其中放置一个符号链接。例如，攻击者可以将`.git/hooks/post-receive`符号链接到服务器上的`~/.ssh/authorized_keys`文件。当Gogs服务器处理这个看似无害的Git仓库时，由于其未能正确地识别和过滤掉这些恶意符号链接，会错误地将用户在仓库中执行的文件写入或编辑操作映射到符号链接所指向的实际服务器路径。

POC脚本提供了两种主要的攻击载荷实现方式，均能最终导致远程代码执行：
1.  **SSH密钥写入**：脚本能够将攻击者预设的SSH公钥内容写入到目标Gogs用户宿主目录下的`~/.ssh/authorized_keys`文件。一旦写入成功，攻击者便能通过SSH协议，使用其私钥直接登录到运行Gogs服务的服务器，从而获得操作系统级别的shell访问权限。
2.  **Git Hook修改**：另一种攻击方式是利用Git的钩子机制。脚本可以通过符号链接，将恶意shell命令注入到例如`post-receive`等Git Hook文件中。当合法的Git用户（或攻击者自己）向该仓库进行`git push`等操作时，被修改的钩子文件就会在服务器端自动执行，从而触发预设的命令，例如启动一个反向shell，将服务器的控制权回传给攻击者。

`dotgit_rewrite`逻辑是本次漏洞利用的关键技术点，它成功规避了Gogs针对文件路径写入的限制，即使不能直接操作Git的内部目录结构，也能通过巧妙的符号链接构造实现跨目录的文件写入。脚本在成功利用后，还会执行`cleanup()`函数来删除创建的恶意仓库，以掩盖攻击痕迹。这个POC的每个步骤都经过精心设计，形成一个完整的攻击链，能够自动化地实现从认证到任意代码执行的全过程。这使得该漏洞的实际威胁等级非常高，对Gogs用户构成重大风险。

**利用步骤**:
1.  攻击者首先在目标Gogs实例上注册一个新用户并登录，获取有效的会话。
2.  利用认证会话，攻击者通过Gogs API获取一个应用程序令牌。
3.  攻击者创建一个新的Git仓库，该仓库被恶意构造，包含指向目标服务器上敏感文件的符号链接（例如，将`.git/hooks/post-receive`符号链接到服务器上的`~/.ssh/authorized_keys`）。
4.  攻击者通过Gogs的在线文件编辑功能或类似机制，向这个恶意符号链接指向的文件写入攻击载荷（如SSH公钥或反弹Shell命令）。
5.  利用Gogs对符号链接处理不当的缺陷，服务器会将攻击载荷写入到实际的目标敏感文件中。
6.  根据选择的攻击载荷，攻击者可以通过SSH登录（如果写入了SSH密钥）或等待特定的Git事件触发（如果修改了Git Hook）来执行任意代码，最终完全控制目标服务器。

**投毒风险分析**:
对提供的POC代码进行分析，其投毒风险评估为**低**（约10%）。该Python脚本旨在合法地验证和利用CVE-2025-8110漏洞，作为防御性安全研究的一部分。代码结构清晰，使用了`requests`、`os`、`subprocess`等标准且常用的Python库，没有发现使用高度混淆、加密或难以理解的代码段。`subprocess`模块的使用是为了执行标准的Git命令（如`git clone`, `git add`, `git commit`, `git push`），这些是利用Gogs漏洞所必需的操作，而不是为了执行恶意系统命令来感染运行POC的系统。没有检测到任何尝试连接到未知外部IP地址、下载或执行远程可执行文件、修改本地系统关键文件、安装持久化后门或执行其他非预期行为的代码逻辑。脚本的核心功能是与目标Gogs服务器进行HTTP通信、Git协议交互，以及本地Git仓库的创建与管理，这些都是漏洞利用流程的组成部分。作者信息（`__author__`, `__Linkedin__`）公开透明，进一步增加了代码的可信度。`proxies`变量的设置允许通过本地代理（如Burp Suite）进行流量分析，这是一种常见的安全测试实践，而非恶意行为。总体而言，该POC是一个专业的、自包含的漏洞利用工具，其设计目标是演示和利用CVE-2025-8110，而非对执行POC的主机进行投毒。用户在运行前应仔细阅读代码，但就其当前形式而言，投毒风险极低。

**项目地址:** 

**漏洞详情:** https://www.freebuf.com/articles/vuls/464926.html
