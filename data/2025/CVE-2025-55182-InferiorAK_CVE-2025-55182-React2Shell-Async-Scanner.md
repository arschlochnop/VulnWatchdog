## CVE-2025-55182 - React, Next.js 远程代码执行 (RCE) / 原型链污染

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE) / 原型链污染

**影响应用:** React, Next.js

**危害等级:** 高危

**CVSS评分:** 待定 (预计CVSSv3.1 9.8+)

**影响版本:** React 19.0.0, 19.1.0-19.1.1, 19.2.0; Next.js 15.0.0-15.0.4, 15.5.0-15.5.6, 16.0.0-16.0.6

**利用条件:** 需要网络访问，无需认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

该Python脚本(`CVE-2025-55182_scanner.py`)是一个为检测和验证“React2Shell”漏洞（CVE-2025-55182）而设计的异步远程代码执行（RCE）扫描器。该漏洞利用React Server Components (RSC) 的Server Actions中的一个原型链污染缺陷，最终导致通过`execSync`函数执行任意系统命令。脚本的架构非常健壮，采用了`asyncio`和`aiohttp`库，支持高效的并发扫描。它还提供了一个可选的Playwright无头浏览器模式，以应对更复杂的版本检测场景，特别是对于使用App Router的Next.js站点，这大大增强了其检测的准确性和可靠性。

扫描器在版本检测方面采用了多阶段策略，以最大程度地覆盖各种部署配置：
1.  **HTTP响应头分析**：检查`X-Powered-By`、`x-nextjs-*`和`x-next-version`等HTTP头信息，这些通常能直接暴露所使用的技术栈和版本。
2.  **内联`<script>`块解析**：分析HTML响应中的`<script>`标签，从中提取诸如`window.next`、`__NEXT_VERSION__`等全局变量或文本标识，以推断Next.js的版本。
3.  **`__NEXT_DATA__` JSON Blob**：对于使用Pages Router构建的Next.js应用，会解析页面中包含的`__NEXT_DATA__` JSON对象，其中通常包含版本信息。
4.  **哈希分块URL**：从`<script src>`属性中提取哈希化的JavaScript分块文件URL，这些文件的命名模式有时能揭示版本线索。
5.  **固定名称回退分块文件名**：检查一些已知固定名称的JavaScript分块文件，作为版本检测的补充。
6.  **`/package.json`端点**：尝试访问 `/package.json` 端点，这在开发环境或配置不当的服务器上可能暴露详细的版本信息。
7.  **Playwright浏览器模式（可选）**：这是最精确的检测方式，通过启动一个无头Chromium浏览器，在完整执行JavaScript后，评估`window.next.version`来获取准确版本，尤其适用于App Router。

一旦确认目标运行在受影响的React 19.0.x/19.1.x/19.2.x 或 Next.js 15.x/16.x 版本范围内，扫描器将尝试利用该漏洞。它通过构造特殊的HTTP请求，触发原型链污染，进而注入能够调用`execSync`的恶意载荷。为了可靠地验证RCE的成功，扫描器采用了基于输出的检测方法：它在注入的命令中包含一个随机生成的“金丝雀”字符串（例如，`echo <random_canary>`），然后监测服务器的HTTP响应，特别是`X-Action-Redirect`头。如果该头中包含了这个随机生成的金丝雀字符串，则说明远程命令已成功执行，并且结果被回显。这种方法避免了对文件系统写入或网络外带数据等可能留下痕迹的验证方式，使得漏洞验证既准确又隐蔽。脚本提供了友好的命令行接口，支持单一URL或批量文件扫描，以及并发连接和超时配置，使其成为一个功能全面、易于使用的专业级漏洞检测工具。

**利用步骤:**
1.  **版本识别和目标选择:** 攻击者使用`CVE-2025-55182_scanner.py`脚本或手动分析，识别运行React Server Components且版本号在指定受影响范围内的Web应用程序。受影响版本包括React 19.0.0、19.1.0-19.1.1、19.2.0，以及Next.js 15.0.0-15.0.4、15.5.0-15.5.6、16.0.0-16.0.6。脚本的多个版本检测阶段能够自动化此过程。
2.  **构造原型链污染载荷:** 攻击者构造一个恶意的HTTP请求，该请求利用React Server Actions处理输入时存在的原型链污染漏洞。这种漏洞允许攻击者向JavaScript对象的原型链中添加或修改属性，从而影响继承该原型的所有对象。
3.  **注入远程代码执行命令:** 通过精心设计的原型链污染，攻击者将系统命令注入到服务器端组件执行的环境中。具体来说，漏洞允许攻击者控制`execSync`函数的调用，从而可以在服务器上执行任意操作系统命令。
4.  **发送恶意请求:** 构造好的请求被发送到目标应用程序的特定Server Action端点。当服务器处理这个请求时，原型链污染被触发，并导致注入的系统命令被执行。
5.  **验证RCE成功:** 为了确认命令是否成功执行，扫描器会在注入的命令中包含一个随机生成的“金丝雀”（canary）字符串（例如，`execSync("echo [RANDOM_CANARY_STRING]")`）。服务器执行此命令后，如果漏洞利用成功，命令的输出（包括金丝雀字符串）会被反射到HTTP响应的特定头部，例如`X-Action-Redirect`。扫描器通过检查此头部是否存在金丝雀字符串来验证RCE的成功。一旦验证成功，攻击者便可以替换金丝雀命令为任何所需的系统命令，从而实现完全的服务器控制。

**投毒风险分析:**
对于`CVE-2025-55182_scanner.py`这个PoC工具，其投毒风险评估为**低**，具体为约10%。这一评估基于对其代码结构、依赖项和行为的全面审查。

首先，**代码的透明度极高**。该脚本完全由Python编写，并未采用任何形式的代码混淆技术。其内部逻辑、函数调用和变量使用都清晰可见，极大地降低了潜在恶意行为被隐藏的可能性。任何具有基本Python知识的安全研究人员或开发者都可以轻松地审计其源代码，验证其功能是否符合预期，以及是否存在任何未经授权的操作。这种透明性是判断PoC安全性的一个关键因素。

其次，**脚本的依赖项均为标准且广受信赖的库**。它主要利用Python的内置库（如`asyncio`、`aiohttp`用于异步网络请求；`argparse`用于命令行参数解析；`re`用于正则表达式；`json`用于JSON数据处理等），以及两个常用的第三方库：`colorama`用于终端输出着色，和`tqdm`用于显示进度条。这些库在Python生态系统中被广泛使用，且经过了大量社区审查，没有已知的恶意组件。此外，虽然脚本提到了可选的`Playwright`库用于无头浏览器模式，`Playwright`本身也是一个由微软开发、用于自动化测试的合法工具，并非恶意软件。脚本未从非官方或可疑的源加载任何额外的外部脚本、二进制文件或资源。

第三，**脚本的功能目标明确且合法**。其唯一的目的是作为一个技术验证工具，用于检测和验证React Server Components中的远程代码执行漏洞。脚本的核心功能围绕版本检测和RCE尝试展开，并通过插入随机的“金丝雀”字符串并检查其在HTTP响应头中的回显来验证漏洞利用的成功。这种“金丝雀”机制是PoC代码中常见的、无害的验证手段，它不是为了执行恶意载荷，而是为了确认服务器端代码执行能力的存在。脚本本身不包含任何隐藏的后门、加密货币挖矿代码、数据窃取功能、C2（命令与控制）通信模块，也不会尝试进行权限提升、持久化驻留、或对目标系统进行任何非预期的破坏性修改。

总而言之，该PoC是一个设计专业、功能专注于漏洞检测与验证的工具。其代码的开放性、对标准安全库的依赖以及无害的验证机制，共同决定了其低投毒风险。在受控环境中，该PoC可被安全研究人员和组织用于合法的漏洞扫描和安全测试，而无需担忧其自身带来的二次安全风险。

**项目地址:** https://github.com/msanft/CVE-2025-55182

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-55182
