## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全的反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全的反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 未经身份验证的远程攻击者可利用，无需身份凭证，通过网络远程触发

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS) 组件的高危远程代码执行（RCE）漏洞，其根本原因是服务端在处理特定SOAP请求时存在不安全的反序列化设计缺陷。攻击者无需任何身份验证即可通过网络远程触发此漏洞，从而在目标WSUS服务器上执行任意代码，获得完全控制权限。该漏洞被赋予CVSS 9.8分（满分10分）的严重评级，影响包括Windows Server 2025、Windows Server 2022和Windows Server 2019在内的多个Windows Server版本。

**POC有效性分析：**
提供的Python脚本 `CVE-2025-59287.py` 是一个功能完备的、针对CVE-2025-59287的远程代码执行（RCE）PoC。该脚本利用了WSUS中不安全的反序列化漏洞。代码结构清晰，使用Python标准库如 `requests`、`xml.etree.ElementTree`、`base64` 和 `uuid`，展示了较高的开发质量和可靠性。它通过 `argparse` 支持命令行参数，允许用户指定目标URL、要执行的命令以及调试模式，极大提高了其可用性。脚本的核心逻辑包括：探测WSUS服务可用端点、获取 `ServerId`、获取 `AuthorizationCookie`，以及最终构建并发送包含恶意反序列化payload的SOAP请求。恶意payload通常通过外部工具（如YSoSerial.net）生成，然后由PoC脚本编码并嵌入到SOAP请求中。脚本中禁用 `urllib3` 的SSL警告是PoC中常见的做法，以便在各种测试环境下顺利运行。总体而言，该PoC准确地模拟了漏洞利用过程，具备高度的有效性和可靠性。

**利用步骤：**
1.  **目标识别**：攻击者首先需要确定目标WSUS服务器的IP地址或域名。PoC脚本接收一个目标URL作为输入。
2.  **服务探测**：PoC脚本首先尝试访问WSUS服务的多个端点（如 `/ClientWebService/Client.asmx`、`/SimpleAuthWebService/SimpleAuth.asmx`、`/ReportingWebService/ReportingWebService.asmx`），以验证目标WSUS服务的可达性。
3.  **获取ServerId**：脚本向 `/ReportingWebService/ReportingWebService.asmx` 发送一个SOAP请求，调用 `GetRollupConfiguration` 方法，尝试从响应中提取WSUS服务器的唯一标识符 `ServerId`。如果获取失败，脚本会生成一个随机UUID作为备用。
4.  **获取AuthorizationCookie**：随后，脚本向 `/SimpleAuthWebService/SimpleAuth.asmx` 发送另一个SOAP请求，调用 `GetAuthorizationCookie` 方法。此请求包含之前获取的 `ServerId` 和一个客户端GUID，旨在获取用于后续操作的 `AuthorizationCookie`。
5.  **构建恶意Payload**：攻击者使用预先生成的反序列化gadget（例如，通过YSoSerial.net工具生成），其中嵌入了目标系统上要执行的任意操作系统命令。该payload会被Base64编码，并封装在一个特制的XML结构中。
6.  **发送恶意请求**：最后，PoC脚本将包含恶意Base64编码payload的SOAP请求发送到 `/ClientWebService/Client.asmx`。此请求会附带在步骤4中获取的 `AuthorizationCookie`。WSUS服务器在处理这个特制的事件时，由于存在不安全的反序列化漏洞，将解析并执行攻击者提供的命令，从而实现远程代码执行。

**投毒风险分析：**
对提供的Python PoC代码进行全面分析，未发现任何恶意行为或潜在的投毒迹象，投毒风险被评定为低（5%）。
*   **代码透明度与可读性**：该PoC代码结构清晰、逻辑简单直观，使用了标准的Python库和编程模式。代码中没有使用混淆技术、加密或任何难以理解的复杂逻辑，使其易于审查和理解其功能。
*   **依赖项分析**：脚本主要依赖于 `requests` (用于HTTP通信)、`xml.etree.ElementTree` (用于XML解析和构造)、`datetime`、`uuid` (用于生成唯一标识符)、`base64` (用于数据编码) 和 `urllib3` (作为requests的底层库)。这些都是Python生态系统中广泛使用且经过验证的库，其在代码中的使用方式也符合其预期功能。禁用 `urllib3` 的SSL警告虽然在生产环境中不建议，但在安全研究和PoC开发中是为了避免证书验证问题而常见的做法，并非恶意指示。
*   **网络行为**：该PoC的唯一网络通信目标是用户通过命令行参数指定的WSUS服务器。代码中没有尝试连接任何其他外部或可疑的IP地址、域名或C2服务器。所有请求都是为了与目标WSUS服务进行交互并利用漏洞。
*   **系统交互**：脚本的核心功能是构造并发送特制的HTTP/SOAP请求，以触发目标服务器上的命令执行。它本身不包含任何本地文件系统操作（如读写敏感文件、安装持久化后门）、修改系统配置或植入其他恶意软件的代码。PoC的目的是提供一个“命令执行的入口”，而非自带后门。
*   **动态代码执行**：代码中没有使用 `eval()`、`exec()` 或动态加载外部Python模块/脚本等高风险函数，这意味着PoC本身不会在执行过程中从不可信来源加载并运行额外代码。
*   **总结**：基于上述分析，该PoC代码是一个合法且纯粹用于漏洞验证和安全研究的工具。它不包含任何额外的恶意功能、后门或投毒机制。因此，其投毒风险极低，为5%。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
