## CVE-2025-59287 - Windows Server Update Service (WSUS) XML反序列化远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** XML反序列化远程代码执行 (RCE)

**影响应用:** Windows Server Update Service (WSUS)

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** 在2025年10月完整补丁发布之前的WSUS版本

**利用条件:** 网络可访问，无需用户认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-59287概述: 该漏洞是Windows Server Update Service (WSUS)中的一个XML反序列化远程代码执行漏洞，被赋予高达CVSS 9.8的评分，被安全行业普遍标记为“关键”（Critical）等级。这意味着攻击者可以无需任何认证，通过网络直接在运行WSUS服务的服务器上执行任意系统命令。威胁情报显示，该漏洞在微软发布初始补丁后不到10天内，就被各类攻击者迅速武器化，并在PoC代码公开后的48小时内，全球范围内便出现了首次野外攻击事件。这种极快的武器化速度和攻击落地时间，充分表明该漏洞的利用难度极低，对企业和组织构成直接且严重的威胁，需要紧急关注和修复。攻击目标已涵盖大学、科技公司、制造企业及医疗机构等多个行业。

POC代码分析: 提供的Python PoC脚本（文件名：CVE-2025-59287.py），由研究员FurkanKAYAPINAR开发，是一个设计精良且功能完整的利用工具。脚本的核心目标是利用WSUS服务中`/ClientWebService/Client.asmx`端点的`SyncUpdates`操作存在的XML反序列化缺陷，实现远程代码执行。脚本采用了Python的`argparse`模块，支持命令行参数输入，使得用户可以方便地指定目标URL、自定义执行命令和设置回调服务器等，极大提升了其易用性和灵活性。

利用原理: 漏洞的根本原因在于WSUS服务在处理SOAP请求时，特别是`SyncUpdates`操作中，对客户端发送的某些XML数据（如代理配置相关的`ProxyBypassList`和`ProxyServer`标签内容）进行了不安全的XML反序列化操作。具体来说，当服务接收到恶意构造的XML输入时，它会尝试将这些输入反序列化为.NET对象。攻击者可以利用这一过程，注入特定的.NET类（如`System.Configuration.Install.AssemblyInstaller`），并在其属性中嵌入Base64编码的恶意PowerShell命令。当WSUS服务尝试“安装”这个虚假的`AssemblyInstaller`对象时，其`Install`方法会被调用，从而触发内嵌的PowerShell命令，导致在WSUS服务进程的上下文下执行任意代码。

利用步骤（PoC执行流程）:
1. 端点探测 (probe_endpoints): 脚本首先执行一项预检查，尝试通过HTTP GET请求访问WSUS服务的几个关键Web服务端点（包括`/ClientWebService/Client.asmx`, `/SimpleAuthWebService/SimpleAuth.asmx`, `/ReportingWebService/ReportingWebService.asmx`）。这一步骤旨在确认WSUS服务是否存活且网络可达，并为后续的交互奠定基础。
2. 获取ServerId (get_server_id): 紧接着，脚本会向WSUS的`/ReportingWebService/ReportingWebService.asmx`端点发送一个`GetRollupConfiguration`的SOAP请求。通过解析响应的XML内容，脚本从中提取出WSUS服务器的唯一标识符`ServerId`。即使因某种原因无法获取到真实的`ServerId`，脚本也设计了回退机制，会生成一个随机的UUID作为替代，以确保后续流程可以继续。这一步骤无需任何用户凭证，仅依赖于服务自身的公开接口。
3. 获取授权Cookie (get_auth_cookie): 在获取到`ServerId`之后，脚本会向`/SimpleAuthWebService/SimpleAuth.asmx`端点发起一个`GetAuthorizationCookie`的SOAP请求。这个请求会利用之前获取的`ServerId`来换取一个授权Cookie。尽管名称包含“授权”，但此过程无需攻击者提供任何用户身份验证信息，而是WSUS服务自身内部认证机制的一部分，通常用于客户端与服务器的通信。获得的Cookie将在后续的RCE请求中作为有效的会话标识使用。
4. 构造RCE Payload (check_rce): 这是整个利用链中最关键的一步。脚本精心构造一个复杂的SOAP信封，目标锁定在`/ClientWebService/Client.asmx`的`SyncUpdates`操作。在请求体的`serviceSyncConfig`对象内部，脚本注入了一个恶意构造的XML序列化payload。这个payload利用.NET反序列化漏洞，通过将一个Base64编码的PowerShell命令嵌入到`ProxyServer`标签的`System.Configuration.Install.AssemblyInstaller`对象的`Path`属性中，从而实现代码注入。例如，PoC默认会尝试执行一个`ping`命令到攻击者指定的回调IP，用于验证RCE的成功。用户也可以通过命令行参数自定义执行任意PowerShell命令。
5. 发送恶意请求与结果验证: 最终，脚本将包含RCE payload的SOAP请求发送到目标WSUS服务器。一旦请求被服务器处理并反序列化，内嵌的PowerShell命令就会在WSUS服务运行的权限下被执行。如果攻击者提供了回调URL（例如，一个监听特定端口的Web服务器），脚本会尝试通过检查是否收到来自目标服务器的连接来验证命令的成功执行。这种带外（OOB）验证方式是RCE PoC中常用的有效性确认手段。

POC有效性评估: 综合来看，该PoC脚本的结构清晰、逻辑严谨，涵盖了从前期侦察到最终代码执行的完整利用流程。其利用方式与CVE-2025-59287描述的XML反序列化漏洞原理完全吻合，并且在实际场景中具备高度的可靠性。脚本使用了标准且稳定的Python库，极大地降低了运行环境的复杂性。此外，其内置的调试输出和回调验证机制，使得安全研究人员在复现和测试该漏洞时能够直观地观察和确认利用效果。因此，该PoC被评定为高可用且功能完整的利用工具，可在受控环境中用于验证漏洞存在性。

投毒风险分析: 该PoC脚本的投毒风险评估为**极低，仅约5%**。这一判断基于对其代码的全面审查，主要理由如下：
1. 高度的代码透明性与可读性: 脚本完全使用纯Python语言编写，代码结构清晰，注释丰富，且没有任何形式的混淆或加密。这使得任何具备基本Python知识的安全研究人员都能够轻松审查每一行代码，从而完全理解其内部逻辑和执行行为。这种高透明度是评估任何第三方工具安全性的关键因素。
2. 严格遵循标准库与常用库使用规范: 脚本所依赖的Python库包括`requests`、`xml.etree.ElementTree`、`datetime`、`uuid`、`xml.sax.saxutils`、`base64`以及`urllib3`。这些都是Python生态系统内广泛使用且经过充分审查的标准或常用第三方库。脚本对它们的使用方式符合其正常、预期的功能范畴，未发现任何滥用这些库来实现异常或恶意行为的迹象。`urllib3.disable_warnings`虽可能在某些场景下降低安全性警惕，但其本身并非恶意功能，在PoC或测试脚本中较为常见，旨在抑制冗余警告信息。
3. 完全缺乏外部依赖或下载行为: 脚本的整个执行过程完全基于本地代码，没有尝试从任何外部URL下载、加载或执行额外的二进制文件、脚本或恶意Payload。所有核心逻辑和数据都在脚本文件内部定义或由用户直接提供。这极大地降低了通过外部资源引入恶意代码的风险。
4. 恶意行为严格限定于目标系统: 脚本的“恶意”性质体现在其构造并发送给目标WSUS服务器的RCE payload上。这个payload旨在利用WSUS的XML反序列化漏洞，使得目标服务器执行由攻击者指定的任意PowerShell命令。然而，这些命令的执行环境是远程的WSUS服务器，而非运行PoC的本地研究机器。脚本本身不会尝试在本地系统上执行这些恶意指令，也不会对本地机器造成任何危害。它仅仅是作为一个通信和payload构建代理。
5. 无敏感信息收集或传输: 经过仔细检查，脚本不包含任何收集本地系统敏感信息（如凭证、文件、配置数据等）的逻辑，也不会尝试将任何数据传输到外部C2服务器或攻击者控制的地址。其所有的网络请求都指向目标WSUS服务器或用户指定的回调URL。
6. 无持久化或系统修改机制: 脚本的设计目标是验证漏洞，因此它不包含任何在本地系统上创建后门、修改系统配置、安装服务、注入进程或采取任何形式的持久化措施的代码。脚本执行完毕后，不会在本地系统上留下任何恶意残留。
综上所述，这份PoC代码被认为是一个合法的、用于安全研究和漏洞验证的工具。其设计和实现都非常规范，不含任何针对执行者自身的投毒或恶意功能。在遵循防御性安全研究最佳实践、在隔离环境中并获得授权的情况下使用该PoC，是安全的。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
