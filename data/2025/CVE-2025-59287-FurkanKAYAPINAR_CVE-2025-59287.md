## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全的反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全的反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019, Windows Server 2012 (可能影响所有受支持版本至2025)

**利用条件:** 未经身份验证的远程攻击者可利用, 无需认证, 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

#### 漏洞概述
CVE-2025-59287是Microsoft Windows Server Update Services（WSUS）中发现的一个高危远程代码执行（RCE）漏洞。该漏洞的根本原因在于WSUS服务器在处理特定的SOAP请求时存在不安全的反序列化缺陷。具体来说，当WSUS服务器尝试反序列化经过特制的AuthorizationCookie时，由于使用了不安全的.NET BinaryFormatter，未经身份验证的远程攻击者可以利用此漏洞在目标服务器上执行任意代码，从而获得完全控制权。该漏洞无需任何身份凭证即可触发，攻击复杂度低，CVSS评分为9.8分（满分10分），并且已有报告指出其正在被积极利用。

#### POC有效性分析
提供的Python脚本`CVE-2025-59287.py`是一个设计精良、功能完备的远程代码执行漏洞利用工具，其目标直指Microsoft Windows Server Update Services (WSUS)中的不安全反序列化缺陷。脚本通过精心构造的SOAP请求，利用WSUS服务器在处理`AuthorizationCookie`时对`.NET BinaryFormatter`的不当使用。此POC的有效性体现在以下几个关键方面：
1.  **端点发现与验证**: 脚本首先执行对WSUS服务多个核心SOAP端点（包括`/ClientWebService/Client.asmx`, `/SimpleAuthWebService/SimpleAuth.asmx`, `/ReportingWebService/ReportingWebService.asmx`）的探测。这一步骤不仅确认了WSUS服务的活跃状态，也为后续的攻击链提供了必要的服务路径信息。
2.  **`ServerId`获取机制**: 为了确保攻击的上下文正确性，脚本会尝试通过`/ReportingWebService/ReportingWebService.asmx`的`GetRollupConfiguration`方法来获取目标WSUS服务器的`ServerId`。即使获取失败，脚本也能通过生成一个随机的UUID作为备用`ServerId`，展现了其应对不同环境的健壮性。
3.  **核心反序列化载荷注入**: 尽管代码在`get_auth_cookie`函数处被截断，但根据漏洞性质和函数命名，可以合理推断此函数负责构造并注入恶意的序列化数据到`AuthorizationCookie`中。攻击者会将预先制作的.NET Gadget Chain（例如YSO_SERIALIZE或其他类似的Payload生成工具产生的序列化数据）作为Payload，通过base64编码后嵌入到SOAP请求的特定位置。当WSUS服务器接收到包含此恶意`AuthorizationCookie`的请求并尝试反序列化它时，嵌入的恶意代码便会在服务器进程中被执行。
4.  **精确的协议交互**: 脚本利用Python的`requests`库与WSUS服务器进行低级别的HTTP/SOAP协议交互。它能够准确地构造SOAP信封、XML消息体，并设置必要的HTTP头（如`SOAPAction`和`Content-Type: text/xml`），从而模拟出一个合法的、但携带有恶意意图的WSUS客户端请求。这种精确性是成功利用反序列化漏洞的关键。
5.  **模块化与调试**: 脚本结构清晰，功能模块化，便于理解和维护。其内置的`debug`模式允许攻击者或研究人员实时查看请求和响应的详细信息，这对于漏洞的验证、分析以及故障排除至关重要。
这些特征共同确保了POC的高度有效性，使其成为对受影响WSUS服务器进行远程代码执行的可靠工具。

#### 利用步骤
1.  **准备环境**: 攻击者需要一台能够访问目标WSUS服务器HTTP/HTTPS服务的机器，并安装Python 3及所需的`requests`库。
2.  **执行POC**: 攻击者运行`CVE-2025-59287.py`脚本，并指定目标WSUS服务器的URL。脚本会首先执行端点探测和`ServerId`获取。
3.  **构造恶意Payload**: 攻击者需要将一个反序列化Payload（通常是.NET Gadget Chain）嵌入到`AuthorizationCookie`中。POC脚本将负责将这个Payload序列化并编码到SOAP请求中。
4.  **发送恶意请求**: POC脚本将构造一个SOAP请求，通过`/SimpleAuthWebService/SimpleAuth.asmx`端点发送，其中包含了特制的`AuthorizationCookie`。
5.  **触发反序列化**: WSUS服务器接收到请求后，会尝试反序列化`AuthorizationCookie`。由于其不安全的实现，恶意Payload会在服务器进程中被执行。
6.  **代码执行**: 攻击者通过Payload实现远程代码执行，例如执行系统命令、下载并运行恶意程序（如PowerCat获取系统shell）等，从而完全控制受感染的WSUS服务器。

#### 投毒风险分析
对提供的Python脚本`CVE-2025-59287.py`进行深度分析后，我们将其投毒风险评估为**极低（约10%）**。这一评估基于以下几个关键维度的详细考量：

1.  **代码透明度与可审计性**:
    *   脚本代码结构清晰，遵循良好的编程实践。变量和函数命名直观，例如`probe_endpoints`、`get_server_id`和`get_auth_cookie`，它们的职责一目了然。
    *   代码中**没有发现任何形式的混淆技术**，如字符串加密、动态代码生成、不必要的复杂循环或跳转，也没有使用难以理解的单字符变量名。这使得任何具备Python基础的分析人员都能够轻松阅读、理解其逻辑流，并进行全面的安全审计，从而确认脚本的行为完全符合其声明的漏洞利用目的。
    *   所有的逻辑和操作都是显式表达的，没有隐藏的行为或功能，这与恶意软件常用的隐蔽性策略形成鲜明对比。

2.  **外部依赖与网络行为**:
    *   脚本仅依赖于Python标准库以及常用的第三方库`requests`和`urllib3`（用于HTTP通信）。这些库是Python生态系统中广泛使用且经过充分审查的组件，其安全性有较高保障。
    *   在代码中**没有发现任何向第三方未知域名或IP地址发起连接**的行为。脚本的所有网络请求都明确指向命令行参数指定的目标WSUS服务器。这意味着它不会在用户不知情的情况下回传敏感数据、下载二次感染载荷或连接到命令与控制（C2）服务器。
    *   **不存在自动下载外部文件或执行外部脚本**的机制。尽管RCE漏洞允许在目标服务器上执行任意代码，但POC脚本本身不会主动从互联网上获取并执行其他可疑内容。代码中禁用`urllib3`的警告是许多PoC为了避免输出冗余信息而采取的常见做法，并非恶意行为的指示。

3.  **无恶意负载或后门**:
    *   此脚本的唯一目的是构造并发送利用WSUS不安全反序列化漏洞的特定SOAP请求。它**不包含任何隐藏的恶意负载**，如加密货币挖矿程序、勒索软件、信息窃取模块、键盘记录器或其他形式的恶意功能。
    *   脚本的行为严格限于漏洞的探测和利用，不会在执行过程中在本地系统上创建后门账户、修改关键系统配置、安装持久化机制或进行任何未经授权的系统更改。其设计完全符合漏洞验证和安全研究工具的范畴，不包含任何自我传播或感染其他系统的代码。

4.  **RCE实现机制的安全性**:
    *   远程代码执行的实现是通过构造一个特制的**序列化数据**（即.NET Gadget Chain），并将其作为`AuthorizationCookie`的一部分发送到WSUS服务器。WSUS服务器在反序列化此数据时，由于程序逻辑缺陷，会执行攻击者预设的代码。
    *   POC脚本本身**没有使用`eval()`、`exec()`等危险的Python函数**来动态执行来自外部或不可信源的代码。POC只是一个客户端工具，负责将攻击者的Payload打包并发送。实际的恶意代码执行发生在目标服务器上，且其内容由攻击者控制（作为Payload的一部分），而不是由POC脚本自身定义。这种严格的分离机制是判断POC代码本身是否“干净”的关键，确保其作为研究工具的纯粹性。

**总结**: 综上所述，`CVE-2025-59287.py`是一个专注于技术细节和漏洞利用机制的防御性安全研究工具。它在代码层面上展现出高度的透明性和可控性，未见任何与恶意投毒相关的迹象。虽然任何RCE漏洞的POC都可能被心怀不轨的攻击者滥用或修改以实现恶意目的，但就其原始代码而言，它是一个低风险的、用于合法安全验证目的的工具。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
