## CVE-2025-8088 - WinRAR 路径遍历/任意代码执行 (Path Traversal/RCE)

**漏洞编号:** CVE-2025-8088

**漏洞类型:** 路径遍历/任意代码执行 (Path Traversal/RCE)

**影响应用:** WinRAR

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H (8.4)

**影响版本:** 所有受影响的Windows版RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll版本

**利用条件:** 用户需解压特制压缩包，无需认证，需要通过社工或其他方式将恶意压缩包传递给受害者。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

WinRAR (CVE-2025-8088) 是一个影响WinRAR软件的严重安全漏洞，攻击者可以通过巧妙利用Windows NTFS备用数据流 (ADS) 特性结合路径遍历技术，绕过WinRAR的文件解压安全机制。此漏洞允许攻击者构造恶意的RAR压缩包，在用户解压时，将恶意文件释放到系统任意位置，特别是像Windows启动文件夹这样的关键目录，最终实现任意代码执行。

**POC有效性分析**
所提供的Python POC代码是一个完整的漏洞利用生成器，旨在创建恶意WinRAR存档。该脚本详细配置了漏洞利用的关键参数，包括：
1.  **多层遍历深度 (NUM_DEPTHS)**: 支持生成不同深度的路径遍历模式，增强了其绕过文件路径验证的鲁棒性。
2.  **相对投放路径 (RELATIVE_DROP_PATH)**: 精确指定了恶意文件（payload.bat）的投放位置为Windows的“启动”文件夹（`AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\payload.bat`），这是一个典型的持久化攻击路径，确保恶意脚本在系统启动或用户登录时自动执行。
3.  **定制化Payload (PAYLOAD)**: 预定义了一个批处理脚本作为Payload。该脚本会在受害者系统上重复显示“System Hacked”消息，并启动Chrome浏览器和计算器，清晰地演示了任意代码执行的能力。
4.  **ADS流生成 (ADS_STREAMS)**: 通过生成长流名称，暗示了其利用NTFS备用数据流的策略，这通常用于隐藏恶意文件或绕过文件类型检测。
5.  **RAR5常量和头部信息 (RAR5_SIG, HFL_EXTRA, HFL_DATA)**: 虽然RAR文件生成的核心逻辑（如压缩和头部构造）在提供代码中被截断，但这些常量和导入的`zlib`, `struct`模块表明该脚本具备构建符合RAR5格式的恶意存档的能力。
6.  **额外的PDF生成功能 (create_professional_cv)**: 值得注意的是，POC中包含了一个生成专业简历PDF的功能。这可能是为了增加恶意压缩包的合法性或作为钓鱼攻击的诱饵，但这部分功能与核心漏洞利用机制无关。

综合来看，该POC脚本具备生成高度特制化恶意RAR文件的能力，其攻击路径设计合理，旨在通过用户解压操作实现持久化任意代码执行。尽管RAR文件生成的核心部分未完全展示，但其前置配置和Payload设计充分体现了利用此漏洞的完整性和有效性。

**利用步骤**
1.  **准备阶段**: 攻击者运行提供的Python POC脚本（或类似工具），生成一个名为`exploit.rar`的恶意WinRAR压缩包。该压缩包内部包含了精心构造的路径遍历序列和批处理Payload，例如`../../../AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\payload.bat`。
2.  **投递阶段**: 攻击者通过社会工程学手段，例如发送带有高度定制化地缘政治相关诱饵的钓鱼邮件，将`exploit.rar`投递给目标受害者。这些邮件通常会诱骗受害者认为这是一个合法文档或程序。
3.  **受害操作**: 受害者收到恶意邮件或下载恶意文件后，使用存在漏洞的WinRAR版本（包括Windows版RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll）尝试解压`exploit.rar`。攻击者通常会设计诱饵文件，让受害者误以为在解压一份无害的文档（如`Alicia_Sheree_CV_YYYY.pdf`）。
4.  **漏洞触发**: 在解压过程中，WinRAR的漏洞被触发。恶意文件`payload.bat`不会被解压到用户指定的目录，而是通过路径遍历被释放到系统关键位置，例如Windows的“启动”文件夹。
5.  **任意代码执行**: 当受害者下次重启系统或重新登录用户会话时，位于“启动”文件夹中的`payload.bat`脚本会自动执行。脚本将弹出“System Hacked”消息，并连续启动Chrome浏览器和计算器，从而实现任意代码执行，并可能进一步加载其他恶意软件或建立持久性。

**投毒风险分析**
对所提供的POC代码进行分析，旨在评估其作为安全研究工具本身是否存在恶意行为（即投毒风险），而非评估其生成的恶意文件的风险。

1.  **代码清晰度与标准库使用**: POC代码使用Python编写，导入了`os`, `sys`, `zlib`, `struct`, `platform`, `subprocess`, `pathlib`, `typing`, `datetime`以及`reportlab`等标准或常用的第三方库。这些库本身是合法的，且代码结构相对清晰，没有明显的混淆迹象。这表明代码的主要意图是功能性实现，而非隐藏恶意行为。
2.  **外部脚本或资源**: 在提供的代码片段中，没有发现任何从外部下载或执行未知脚本、二进制文件或进行可疑网络请求的行为。所有的Payload和逻辑都内嵌在Python脚本中，增强了其自包含性。
3.  **系统交互**: POC脚本主要通过`os`, `subprocess`, `pathlib`进行文件系统操作，例如创建`exploit.rar`文件。这些操作是漏洞利用生成工具的预期行为。其中定义的`PAYLOAD`变量包含的批处理命令 (`msg`, `start chrome.exe`, `start calc.exe`) 是 intended to be executed *on the victim's system* by the *generated malicious RAR file*, not by the POC script itself when run by a researcher. 对于研究人员而言，运行此POC仅会生成恶意RAR文件和（如果`create_professional_cv`功能被调用且未被截断）一个PDF文件，而不会直接感染研究人员的系统。
4.  **非核心功能的分析**: POC中包含的`create_professional_cv`函数用于生成PDF文件，这在传统的漏洞POC中并不常见。然而，该函数使用的是合法的`reportlab`库，其行为是生成一份PDF文档，本身不含恶意功能。这可能是一个障眼法，为了让生成的恶意压缩包看起来更像一个合法的求职文档，从而增加钓鱼成功的几率。从研究人员运行POC脚本的角度看，这部分代码不会造成投毒风险。
5.  **总结**: 基于对代码的分析，该POC脚本专注于生成恶意WinRAR压缩包以利用CVE-2025-8088，其自身的执行不包含后门、挖矿代码、信息窃取或其他直接危害研究人员系统的投毒行为。代码逻辑直接服务于漏洞利用生成，没有发现异常或可疑的网络通信、非预期文件修改或特权升级尝试。因此，该POC的投毒风险被评估为低。


**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8088
