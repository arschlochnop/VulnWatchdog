## CVE-2025-8088 - WinRAR (包括Windows版RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll) 路径遍历 (Path Traversal) / 目录穿越, 导致任意文件写入和任意代码执行

**漏洞编号:** CVE-2025-8088

**漏洞类型:** 路径遍历 (Path Traversal) / 目录穿越, 导致任意文件写入和任意代码执行

**影响应用:** WinRAR (包括Windows版RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll)

**危害等级:** 高危

**CVSS评分:** 未知 (但在实际利用中被评为高危)

**影响版本:** 未知 (受影响版本包括Windows版RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll，已由官方修复，建议用户尽快更新)

**利用条件:** 需要用户解压恶意构造的RAR压缩包。攻击者通常通过社会工程学手段（如钓鱼邮件，地缘政治相关诱饵）诱骗用户打开并解压。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5

## 详情

CVE-2025-8088 是一个影响 WinRAR 软件的严重路径遍历（或称目录穿越）漏洞。该漏洞的根本原因在于 WinRAR 在处理特制压缩包时，未能正确验证压缩包内嵌的文件路径。攻击者可以巧妙地结合路径遍历技术（如使用 `../`）和 Windows NTFS 备用数据流 (ADS) 特性，绕过 WinRAR 的文件验证机制，从而将恶意文件写入到用户指定解压目录之外的任意位置，包括 Windows 系统的启动文件夹等关键目录，最终实现任意代码执行。

**POC有效性分析：**

提供的Python POC脚本 (`CVE-2025-8088.py`) 是一个功能完整的利用工具，能够有效复现 CVE-2025-8088 漏洞。该脚本通过手动构造 RAR5 归档格式，精确地创建了一个恶意压缩包 (`exploit.rar`)。其核心机制在于：
1.  **路径遍历构造：** 脚本定义了多种 `PATH_TRAVERSALS` 模式 (如 `../`, `../../` 等)，用于在 RAR 文件的头信息中插入恶意路径。这些路径会尝试在解压时向上遍历目录树。
2.  **ADS 特性利用：** 脚本利用 NTFS 备用数据流的特性，通过生成长占位符流名称 (`ADS_STREAMS`)，进一步混淆和延长路径，辅助绕过 WinRAR 的路径清理或验证逻辑。这种结合使得恶意路径能够成功地超出预期解压目录。
3.  **目标文件写入：** 脚本将恶意文件 `payload.bat` 目标定位在 `AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\` 路径下。这是一个系统启动目录，放置在此处的批处理脚本会在用户登录或系统启动时自动执行。
4.  **恶意Payload：** `payload.bat` 包含一个简单的批处理脚本，其功能是在受害系统上反复弹出“System Hacked”消息框，并启动 `chrome.exe` 和 `calc.exe` 程序。这是一个明确的、视觉化的任意代码执行演示，证明了漏洞的严重性。

该POC脚本的结构清晰，通过 `create_rar_file` 函数封装了 RAR5 文件的创建逻辑，包括块头、文件头、数据块的构造。通过执行该脚本，可以成功生成一个恶意 `exploit.rar` 文件，一旦受害者解压，即可实现预期的任意代码执行效果。脚本中存在一段与漏洞利用不相关的 `create_professional_cv` 函数及其相关代码，这部分代码使用了 `reportlab` 库来生成一个PDF简历。这段代码似乎是作为填充或伪装，但它本身不参与漏洞利用过程，也不执行任何恶意操作。

**利用步骤：**

1.  **攻击者准备：** 攻击者首先运行提供的Python POC脚本，生成恶意RAR压缩包（例如 `exploit.rar`）。该压缩包内部包含构造好的路径和恶意 `payload.bat`。
2.  **社会工程学诱骗：** 攻击者通过社会工程学手段，如发送钓鱼邮件、利用伪装成合法文档（如与地缘政治相关的诱饵）的恶意附件，诱导受害者下载并打开这个 `exploit.rar` 文件。
3.  **受害者解压：** 受害者在不知情的情况下，使用受影响版本的 WinRAR 软件解压该恶意RAR文件。由于漏洞的存在，`payload.bat` 文件不会被解压到用户指定的目标文件夹，而是被 WinRAR 错误地写入到 Windows 的启动目录 (`AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\`)。
4.  **任意代码执行：** 当受害者下次启动计算机或重新登录时，Windows 会自动执行启动目录中的 `payload.bat` 脚本，从而触发弹出“System Hacked”消息框并启动浏览器和计算器等程序，成功实现攻击者预设的任意代码执行。

**投毒风险分析：**

对提供的Python POC脚本进行详细分析后，评估其投毒风险为**低** (5%)。

1.  **代码透明度：** 脚本的绝大部分代码是清晰可读的，核心逻辑围绕 RAR5 文件的构造和路径遍历的实现。没有发现明显的代码混淆技术来隐藏恶意行为。
2.  **标准库使用：** 脚本主要依赖 Python 的标准库（如 `os`, `sys`, `zlib`, `struct`, `platform`, `subprocess`, `pathlib`, `datetime`）以及一个明确的第三方库 `reportlab`。所有这些库的使用都符合其预期功能，没有被滥用来执行恶意操作。
3.  **非恶意填充代码：** 脚本中包含的 `create_professional_cv` 函数及其相关的 `reportlab` 代码，虽然与漏洞利用无关，但其功能是生成一个PDF简历，本身是无害的。这段代码更像是为了增加脚本的体积、混淆分析人员的视线，或使其看起来更像一个无害的应用程序，而非执行额外的恶意活动。它没有连接外部服务器、下载恶意组件或进行任何系统修改。
4.  **无外部通信：** 脚本中没有发现任何网络通信代码（如使用 `requests`, `urllib` 等），表明它不会尝试连接到攻击者的C2服务器或下载额外的恶意负载。
5.  **无动态代码执行：** 脚本中没有滥用 `eval()`、`exec()` 或其他动态代码执行机制来在运行时加载或执行未知的代码。
6.  **行为可预测性：** 脚本的唯一“恶意”行为是生成一个包含漏洞利用逻辑和恶意 payload 的 RAR 文件。这个行为是其作为 POC 工具的预期功能，而不是脚本自身在执行时对宿主系统造成危害。

综上所述，该 POC 脚本的目的是生成一个恶意压缩包，而不是在执行自身时感染运行它的系统。尽管其中包含一些无关代码，但这部分代码是良性的。因此，使用者在运行此 POC 脚本时，其自身受到恶意代码感染的风险极低，可以认为其投毒风险较低。

**项目地址:** 未知

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8088
