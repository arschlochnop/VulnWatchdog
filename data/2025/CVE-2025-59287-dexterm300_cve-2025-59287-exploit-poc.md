## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 无需认证, 远程可利用, 攻击复杂度低

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2025-59287 是一起高危的远程代码执行 (RCE) 漏洞，CVSS 评分高达 9.8，严重影响了微软的 Windows Server Update Services (WSUS) 组件。WSUS 是一款广泛部署的企业级集中式更新管理工具，用于分发 Windows 操作系统及其他微软产品的更新。此漏洞的根本原因在于其不安全的反序列化机制。具体来说，当 WSUS 服务器处理 AuthorizationCookie 时，使用了 .NET 的 BinaryFormatter 进行反序列化，而这一过程未能充分验证输入数据的完整性和安全性，导致攻击者能够注入并执行任意代码。

未经身份验证的远程攻击者可以利用此漏洞，通过向 WSUS 服务器发送特制的 HTTP 请求，并在其中包含恶意构造的 AuthorizationCookie。当服务器尝试反序列化此 Cookie 时，攻击者精心构造的 .NET 对象图便会被还原，并触发预设的恶意行为，最终导致在 WSUS 服务进程的上下文中执行任意操作系统命令。由于此漏洞无需任何身份验证即可触发，且攻击复杂度极低，使得其成为一个极具威胁性的漏洞。一旦成功利用，攻击者将获得目标服务器的完全控制权，因为 WSUS 服务通常以较高权限运行。

受影响的 Windows Server 版本包括 Windows Server 2025、Windows Server 2022 和 Windows Server 2019。这意味着大量部署了 WSUS 的企业环境都面临潜在的风险。威胁情报显示，此漏洞已经被攻击者积极利用。攻击者通常会利用 CVE-2025-59287 作为获取初始访问权限的入口点，随后可能结合 PowerCat 等工具进一步获取系统 shell（如 CMD 或 PowerShell），从而在受感染的服务器上执行进一步的恶意操作，例如数据窃取、部署勒索软件或建立持久化后门。因此，该漏洞对组织的IT基础设施构成严重威胁，需要立即采取缓解措施。

POC 有效性分析:
所提供的 POC 代码 BinaryFormatterPayloadGenerator.cs 是一个用 C# 编写的有效载荷生成器，专门用于利用 CVE-2025-59287 漏洞。该代码的核心功能是构建一个恶意的 BinaryFormatter 序列化流，该流在目标 WSUS 服务器上反序列化时能够触发任意命令执行。它利用了 .NET 环境中一个众所周知的反序列化 gadget 链，即 ObjectDataProvider。

具体而言，该 POC 代码首先创建一个 ObjectDataProvider 实例，将其 MethodName 设置为 "Start"，并将其 ObjectInstance 设置为一个新的 System.Diagnostics.Process 对象。然后，它根据用户提供的命令行参数解析出待执行的命令及其参数，并将其封装到 ProcessStartInfo 对象中。ProcessStartInfo 被配置为不使用 Shell 执行 (UseShellExecute = false) 且不创建窗口 (CreateNoWindow = true)，这使得命令能够静默地在后台执行。最后，BinaryFormatter 类被用来序列化这个精心构造的 ObjectDataProvider 对象，生成最终的恶意二进制有效载荷。

代码结构清晰，易于理解，并且包含了详细的编译和使用说明。通过 csc 命令编译后，用户可以轻松地运行该程序并指定任何想要执行的系统命令，例如 calc.exe 或 powershell -c whoami。生成的二进制数据流可以直接用于构造 HTTP 请求中的 AuthorizationCookie，从而利用 WSUS 的反序列化漏洞。该 POC 完整地演示了如何构造用于触发命令执行的恶意序列化对象，因此在概念验证和实际攻击载荷生成方面都具有很高的有效性。它为研究人员和防御者提供了一个清晰的蓝图，以理解漏洞的深层机制和攻击方式。

利用步骤:
1. 编译有效载荷生成器： 在 Windows 环境下，使用 .NET SDK 中的 C# 编译器 (csc) 编译 BinaryFormatterPayloadGenerator.cs 文件。需要确保引用了 WindowsBase.dll，通常位于 C:\Windows\Microsoft.NET\Framework\v4.0.30319\WindowsBase.dll。命令示例：`csc /reference:"C:\Windows\Microsoft.NET\Framework\v4.0.30319\WindowsBase.dll" BinaryFormatterPayloadGenerator.cs`
2. 生成恶意序列化载荷： 运行编译后的可执行文件 BinaryFormatterPayloadGenerator.exe，并指定要执行的命令。例如，要执行 calc.exe：`BinaryFormatterPayloadGenerator.exe calc.exe` 或者，要执行一个 PowerShell 命令：`BinaryFormatterPayloadGenerator.exe "powershell -c whoami"` 程序将把生成的二进制有效载荷输出到控制台（通常以十六进制或 Base64 编码形式，尽管当前 POC 仅输出原始字节流，在实际利用时需要进行适当编码）。
3. 构造并发送恶意 HTTP 请求： 将上一步生成的恶意序列化数据（可能需要进行 Base64 编码或其他适合 HTTP 传输的编码）嵌入到针对目标 WSUS 服务器的 HTTP 请求的 AuthorizationCookie 字段中。攻击者通常会使用 curl、Python 脚本或专门的 HTTP 客户端工具来发送此请求。请求的目标是 WSUS 服务的一个受影响的端点。
4. 远程命令执行： 当脆弱的 WSUS 服务器接收到包含恶意 AuthorizationCookie 的请求时，它会尝试反序列化该 Cookie 的内容。此时，攻击者构造的 ObjectDataProvider 将被实例化，并触发 Process.Start() 方法，从而在 WSUS 服务的权限下执行指定的任意命令。

投毒风险分析:
提供的 BinaryFormatterPayloadGenerator.cs POC 代码的投毒风险评估为低（15%）。该代码是一个合法的安全研究工具，旨在演示和生成利用 .NET 不安全反序列化漏洞的有效载荷。
首先，代码结构清晰、逻辑透明，并提供了详细的注释，这使得对代码进行审计和理解其功能变得非常容易。它完全使用标准的 .NET 库（System.IO、System.Runtime.Serialization.Formatters.Binary、System.Windows.Data、System.Diagnostics 等），没有引入任何第三方或可疑的外部依赖项。这显著降低了引入未知恶意代码的风险。
其次，该 POC 的核心功能是生成一个能够执行用户指定命令的序列化对象。它本身并不包含任何硬编码的恶意命令，而是将命令作为命令行参数接收。这意味着代码的行为完全由用户输入控制，POC 自身没有预设的恶意负载或后门。所提供的示例命令 calc.exe 或 whoami 都是用于概念验证的无害命令。
再者，代码中没有发现任何形式的代码混淆、动态加载外部脚本、向未知 IP 地址发起网络连接，或者其他任何可疑行为。它仅仅是一个本地运行的程序，用于在标准输出中生成一个字节流。
尽管该 POC 生成的输出是一个用于恶意目的的“有效载荷”，但生成器本身是纯净且无害的。因此，对于进行合法安全研究或内部测试的组织而言，使用此 POC 代码本体来理解漏洞机制或生成测试载荷的风险极低。然而，用户在使用此 POC 之前仍应遵循最佳实践，例如在隔离环境中运行，并仔细审查任何从互联网获取的代码，以确保其符合预期目的，并防止意外执行不必要的命令。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
