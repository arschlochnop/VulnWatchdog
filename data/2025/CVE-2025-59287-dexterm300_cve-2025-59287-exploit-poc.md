## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 未经身份验证的远程攻击者，无需获取任何身份凭证即可通过网络远程触发。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-59287是一个影响Microsoft Windows Server Update Services (WSUS)组件的高危远程代码执行（RCE）漏洞。该漏洞的根本原因在于服务端存在不安全的传统序列化机制中的对象反序列化缺陷。具体来说，当WSUS服务器处理特制的事件或AuthorizationCookie时，它使用.NET的BinaryFormatter进行反序列化，而BinaryFormatter在处理来自不受信任源的数据时，容易受到反序列化攻击。未经身份验证的远程攻击者可以发送包含恶意序列化对象的特制数据包。一旦WSUS服务器尝试反序列化此恶意对象，攻击者指定的任意代码将在服务器上以WSUS服务的权限执行，从而导致对目标服务器的完全控制。此漏洞被赋予CVSS 9.8分的严重评级，影响包括Windows Server 2025、Windows Server 2022和Windows Server 2019等多个Windows Server版本。

**POC有效性分析：**
提供的POC代码`BinaryFormatterPayloadGenerator.cs`是一个功能完整的C#程序，旨在生成针对CVE-2025-59287漏洞的恶意BinaryFormatter序列化 payload。该POC利用了.NET中一个经典的、已知可用于反序列化攻击的ObjectDataProvider gadget链。代码首先创建一个ObjectDataProvider实例，将其MethodName设置为“Start”，ObjectInstance设置为一个新的Process对象。然后，它根据命令行参数解析用户提供的命令，将其分解为FileName和Arguments，并配置ProcessStartInfo对象，例如设置UseShellExecute为false和CreateNoWindow为true，以实现隐蔽执行。最后，通过BinaryFormatter将这个精心构造的ObjectDataProvider链序列化成一个字节流，并将其以Base64编码的形式输出到控制台。代码提供了清晰的编译指南（`csc /reference:"C:\Windows\Microsoft.NET\Framework\v4.0.30319\WindowsBase.dll" BinaryFormatterPayloadGenerator.cs`）和使用示例（`BinaryFormatterPayloadGenerator.exe calc.exe`）。这表明该POC能够有效地生成用于触发WSUS不安全反序列化漏洞的有效负载，是验证此漏洞概念的强大工具。

**利用步骤：**
1.  **准备环境：** 确保攻击者机器上安装了.NET开发环境，以便编译C#代码。
2.  **编译POC：** 在命令行或PowerShell中，导航到`BinaryFormatterPayloadGenerator.cs`文件所在目录，并执行以下命令进行编译：
    `csc /reference:"C:\Windows\Microsoft.NET\Framework\v4.0.30319\WindowsBase.dll" BinaryFormatterPayloadGenerator.cs`
3.  **生成Payload：** 运行编译后的可执行文件，并提供要在目标WSUS服务器上执行的命令。例如，要执行`calc.exe`：
    `BinaryFormatterPayloadGenerator.exe calc.exe`
    或者执行PowerShell命令：
    `BinaryFormatterPayloadGenerator.exe "powershell -c whoami"`
4.  **获取Payload：** 程序将在控制台输出一个Base64编码的字符串，这即是生成的恶意序列化Payload。复制此字符串。
5.  **投递Payload：** 将上一步中获得的Base64编码的Payload嵌入到针对目标WSUS服务器的特定HTTP请求中。根据漏洞描述，这通常涉及将其作为特制事件的一部分或在AuthorizationCookie参数中进行投递，以便WSUS服务器进行反序列化。**请注意，此POC仅负责生成Payload，不包含实际的投递机制。** 攻击者需要额外工具或脚本来将此Payload注入到WSUS服务的通信流中。
6.  **远程代码执行：** 一旦Payload成功投递并被WSUS服务器反序列化，攻击者指定的命令将在服务器上以WSUS服务的权限执行，从而实现远程代码执行。

**投毒风险分析：**
提供的POC代码`BinaryFormatterPayloadGenerator.cs`的投毒风险评估为**低（5%）**。这份C#代码在设计上极其透明，其核心功能是根据用户指定的命令生成一个恶意BinaryFormatter序列化负载。通过详细审查代码，我们未发现任何试图执行以下行为的迹象：
1.  **代码混淆或加密：** 代码以清晰、可读的纯文本形式提供，没有使用任何混淆技术来隐藏其真实意图或关键操作。这使得安全研究人员可以轻松地审计每一行代码，确保其行为符合预期。
2.  **恶意行为或后门：** 代码中不包含任何内置的后门功能、数据窃取机制、键盘记录器、持久化组件或任何其他旨在危害运行POC的本地系统的恶意有效载荷。它的唯一目的就是构建一个用于远程系统利用的序列化对象。
3.  **外部脚本或资源加载：** POC代码完全自包含，不依赖于从外部URL下载或执行任何脚本、库或其他资源。所有引用的命名空间和类都属于标准的.NET Framework，例如`System.IO`、`System.Runtime.Serialization.Formatters.Binary`和`System.Diagnostics`。这意味着在运行POC时，不会有未经授权的网络连接去获取或加载潜在的恶意内容。
4.  **可疑的网络请求：** 该POC本身不发起任何出站网络连接。它是一个本地执行的工具，用于生成数据。它不会尝试连接到C2服务器、上传数据或进行任何类型的侦察活动。
5.  **不安全的编码实践：** 代码在使用字符串处理和文件操作（尽管这里主要是输出到控制台）时遵循了常见的安全实践。没有发现`eval()`或其他动态执行代码的潜在危险用法，除了其核心功能——构建一个旨在由目标系统反序列化的可执行命令负载。值得注意的是，该POC本身就是利用不安全的反序列化机制来构造Payload，但这个Payload的执行是在目标系统上，而非POC运行的本地系统。
6.  **文件系统篡改：** 除了编译过程中生成的可执行文件外，该POC没有尝试修改、创建或删除本地文件系统上的任何其他文件。其输出是到标准输出流，而非写入到可能具有危害性的位置。
因此，尽管此POC能够生成用于远程代码执行的强大攻击负载，从而具有极高的攻击潜在危害，但从“投毒”的角度来看（即POC代码本身是否会损害运行它的分析者系统），其风险被认为是极低的。用户可以放心地在受控环境中编译和运行此POC，以理解漏洞机制并生成测试Payload，而无需担心POC代码本身会引入本地安全风险。

**项目地址:** N/A

**漏洞详情:** N/A
