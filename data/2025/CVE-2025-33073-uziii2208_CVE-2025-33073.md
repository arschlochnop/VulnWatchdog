## CVE-2025-33073 - Windows Domain Controller (Active Directory) 域渗透/RCE/NTLM Relay

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 域渗透/RCE/NTLM Relay

**影响应用:** Windows Domain Controller (Active Directory)

**危害等级:** Critical

**CVSS评分:** N/A

**影响版本:** Windows Server 2016, Windows Server 2019, Windows Server 2022

**利用条件:** 需要DNSAdmins组成员凭证, WinRM服务开启(HTTP或HTTPS), 网络可达(SMB 445, DNS 53, WinRM 5985/5986)

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-33073的PoC代码展示了高度的有效性和实战性。该PoC名为“Reflection Relay PoC”，旨在利用Windows域控制器上的特定漏洞组合实现SYSTEM级别代码执行。它通过利用DNSAdmins组成员的权限进行DNS记录操作，结合NTLM Relay攻击和WinRM认证绕过，从而在目标域控制器上获得最高权限。PoC的README文件详细说明了其通用兼容性（适用于任何Windows域）、自动检测目标和网络配置、自动提取flag文件、交互式模式以及完整的日志记录功能。它明确宣称能提供“One-Shot SYSTEM Shell”，这意味着攻击者只需简单操作即可获得SYSTEM权限的shell。PoC支持Windows Server 2016/2019/2022版本的域控制器，并列出了清晰的利用条件，包括目标系统需开启WinRM服务，且攻击者需拥有DNSAdmins组成员的凭证。其依赖于Impacket、NetExec和krbrelayx等业界知名的渗透测试工具，这些工具的稳定性和可靠性进一步增强了PoC的有效性。

利用CVE-2025-33073的PoC代码，攻击者可遵循以下步骤：
1.  **环境准备**：首先，在攻击机上安装必要的系统工具（如`python3`、`netcat-openbsd`、`dnsutils`），并通过`pip3`安装Python库`impacket`和`netexec`。随后，克隆`krbrelayx`项目和本PoC的GitHub仓库。进入PoC目录后，使`exploit.sh`脚本可执行。
2.  **启动PoC**：执行`./exploit.sh`，脚本将进入交互模式，提示攻击者输入攻击机IP、目标域控制器IP、域名、以及一个属于DNSAdmins组的用户名和密码。
3.  **等待NTLM Relay就绪**：PoC脚本会自动配置DNS记录并启动NTLM Relay监听器。当脚本输出“[!] RELAY READY! OPEN NEW TERMINAL → PASTE COERCE COMMAND!”时，表示NTLM Relay已准备就绪。
4.  **执行强制认证命令**：在另一个终端窗口中，复制并执行PoC脚本输出的`nxc smb`命令。此命令会利用`coerce_plus`模块（类似于PetitPotam）强制目标域控制器向攻击者的NTLM Relay监听器进行认证。
5.  **获取SYSTEM Shell**：一旦域控制器的认证凭证被NTLM Relay捕获并转发至WinRM服务，PoC脚本将自动获得目标域控制器的SYSTEM级别shell。在此基础上，PoC还具备自动提取靶机flag文件的功能。

该PoC代码的投毒风险评估为低风险（约10%）。进行此评估的主要依据是其代码的开放性、透明性以及所使用的工具性质。
首先，该PoC的主要组成部分是一个名为`exploit.sh`的shell脚本，其内容通常是明文且易于审查的。这个脚本主要负责协调和调用一系列在渗透测试和安全研究领域被广泛认可和使用的开源工具及库。这些工具包括但不限于：Impacket（用于网络协议编程的Python库，广泛用于SMB、Kerberos、LDAP等协议的攻击和测试）、NetExec（原CrackMapExec，一个功能强大的多协议渗透测试工具，用于快速枚举大型网络、执行密码喷射、NTLM Relay等）、krbrelayx（一个专门用于Kerberos Relay攻击的工具）、netcat-openbsd（一个网络工具，常用于读取和写入网络连接，是渗透测试中的“瑞士刀”）、dnsutils（标准的DNS查询工具）。这些工具本身都是合法的，并且其代码库通常是公开的，允许安全研究人员进行审计。PoC脚本的核心功能是将这些工具以特定的顺序和参数组合起来，自动化执行一个多阶段的攻击链，从而实现对目标域控制器的系统级控制。
其次，PoC的README文件清晰地阐述了其功能、利用原理和预期结果，即在目标系统上获取SYSTEM权限。没有迹象表明PoC代码中存在旨在损害执行者本地机器的恶意行为，例如：代码混淆、未经授权的外部连接（除了与目标系统建立必要的攻击通信外），或者窃取执行者本地敏感信息的企图。PoC的功能仅限于其明确宣称的漏洞利用，不包含额外的、未公开的、针对本地执行环境的恶意功能（如在攻击机上安装持久化后门、挖矿程序等）。从防御性安全研究的角度来看，运行此类PoC是为了深入理解漏洞的利用机制，验证漏洞的存在，并为组织制定有效的检测和防御策略提供依据。因此，PoC中实现的“One-Shot SYSTEM Shell”或“Auto-Flag Extraction”等功能，应被理解为针对目标系统的攻击功能，而不是针对PoC运行者本身的恶意代码。将PoC对目标系统的攻击成功误解为对PoC运行者本身的“投毒”，会混淆安全研究的本质目标。综上所述，尽管PoC旨在发动高破坏性的攻击，但其自身的代码构成和行为模式符合透明、可审计的渗透测试工具范畴，不包含针对PoC使用者的隐蔽恶意载荷，因此被评定为低投毒风险。

**项目地址:** https://github.com/uziii2208/CVE-2025-33073

**漏洞详情:** 
