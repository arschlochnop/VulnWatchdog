## CVE-2025-33073 - Windows SMB Client, Windows Server (Domain Controller) 权限提升/NTLM反射/RCE

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM反射/RCE

**影响应用:** Windows SMB Client, Windows Server (Domain Controller)

**危害等级:** 高危

**CVSS评分:** 待定

**影响版本:** Windows Server 2016, Windows Server 2019, Windows Server 2022 (域控制器角色)

**利用条件:** 需要具有DNSAdmins组成员资格的用户凭据，目标域控制器需启用WinRM服务（HTTP或HTTPS），攻击者需具备到DC的网络访问权限（SMB 445, DNS 53, WinRM 5985/5986）。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-33073的公开利用代码（PoC）是一个高度专业化且功能完善的工具，它旨在简化对Windows域控制器进行SYSTEM级权限提升的复杂过程。该漏洞利用多个技术环节：首先通过DNSAdmins用户的特权进行DNS记录操纵，然后结合NTLM Relay攻击来获取更高权限，并最终利用WinRM服务实现SYSTEM级别的代码执行。该PoC的亮点在于其“通用兼容性”，这意味着它理论上可以在各种Windows域环境、使用任何合法的用户凭据（只要该用户是DNSAdmins组的成员）以及多种CTF（Capture The Flag）挑战环境中无缝运行。PoC提供了多项自动化功能，例如自动识别目标域控制器（DC）的网络配置，这大大减少了手动配置的错误和工作量。此外，它还能在成功利用后自动搜索并提取目标系统上的敏感标志文件（例如CTF中的flag），极大地提高了攻击效率。对于使用者而言，PoC还提供了“交互式模式”，通过清晰的步骤指引完成整个攻击流程，并具备“完整日志记录”功能，详细记录每一步操作，便于调试和事后分析。最关键的是，它承诺“一键获取SYSTEM Shell”，通过集成的WinRM Shell功能直接获得目标DC的最高权限。底层的DNS投毒和NTLM Relay服务器都内置于工具中，使得整个攻击链高度集成和自动化。从其README的详细描述、功能列表、以及对所依赖的成熟工具（如Impacket, NetExec, Krbrelayx）的整合来看，这个PoC是一个设计精良、技术先进且实战价值极高的漏洞利用工具，它显著降低了利用CVE-2025-33073所需的技术门槛。

**利用步骤**:
1.  **环境准备**: 攻击者需要安装Python 3、pip、netcat-openbsd、dnsutils，并通过pip安装`impacket`和`netexec`。此外，还需要克隆并安装`krbrelayx`项目。
2.  **克隆POC**: 将`https://github.com/uziii2208/CVE-2025-33073`项目克隆到本地，并使`exploit.sh`脚本可执行。
3.  **启动监听**: 在第一个终端中运行`./exploit.sh`，根据提示输入攻击者IP、目标DC IP、域名、具有DNSAdmins权限的用户名和密码。脚本将启动NTLM Relay服务器，并等待触发。
4.  **触发反射**: 当脚本提示“`[!] RELAY READY! OPEN NEW TERMINAL → PASTE COERCE COMMAND!`”时，在第二个终端中复制并执行脚本输出的`nxc smb`命令。这个命令会使用PetitPotam方法强制DC进行NTLM认证，将其反射回攻击者的NTLM Relay服务器。
5.  **获取SYSTEM Shell**: NTLM Relay成功后，POC将自动在第一个终端中打开一个SYSTEM级别的shell，并尝试自动提取所有标志文件。

**投毒风险分析**:
在对CVE-2025-33073的PoC代码进行投毒风险评估时，我们将其风险评定为较低，约为10%。这一评估基于以下几个关键因素：
首先，PoC的代码托管于GitHub平台，这是一个主流的开源代码仓库。通常，GitHub上的公共项目会受到开发者社区的广泛关注和审查，这在一定程度上降低了恶意代码潜入并长期存在的可能性。如果存在明显的恶意行为，很可能会被社区成员发现并报告。
其次，该PoC的核心功能是基于一系列在网络安全领域广为人知且广泛使用的合法工具库构建的，包括`impacket`、`netexec`和`krbrelayx`。这些工具本身是渗透测试人员和安全研究员进行漏洞评估、协议分析和权限提升的常用框架。它们的设计初衷是用于合法测试，并且拥有活跃的开发社区和良好的声誉。PoC脚本主要作用是协调和调用这些工具的不同模块，以实现自动化攻击流程，而非引入全新的、未经验证的或可疑的功能。
第三，PoC的安装过程明确且透明。它指导用户通过标准的Linux包管理器（`apt-get`）安装基本系统工具，通过Python的`pip3`工具安装Python依赖库，并通过`git clone`命令从GitHub获取PoC代码和`krbrelayx`工具。整个过程没有涉及任何模糊的或未经签名的二进制文件下载、没有要求执行未知来源的外部脚本，也没有任何混淆代码的迹象。这意味着用户可以清晰地看到所安装和执行的每一项内容。
第四，从行为层面分析，PoC所执行的“DNS投毒”和“NTLM Relay”是该漏洞利用技术本身的组成部分。这些操作是攻击者为了实现域控制器权限提升所必须采取的步骤，而不是PoC工具额外附加的、旨在危害使用者系统（即研究员的机器）的恶意行为。换言之，这些“恶意”操作是针对目标系统发起的，而非针对PoC运行环境本身的。
最后，由于该PoC主要由Shell脚本和Python代码组成，其可读性和可审计性较高。安全研究人员可以相对容易地审查其源代码，以识别任何潜在的恶意代码、后门、数据窃取机制或与预期功能不符的隐藏行为。
综上所述，虽然任何从互联网获取的代码都存在一定风险，但考虑到该PoC的透明性、所依赖工具的合法性、安装过程的标准性以及核心攻击逻辑的明确性，其对防御性安全研究人员自身系统构成“投毒”的风险是可控且较低的。研究人员仍应在隔离环境中进行测试，并对代码进行必要的审查，以确保安全。

**项目地址:** https://github.com/uziii2208/CVE-2025-33073

**漏洞详情:** https://www.sogou.com//link?url=hedJjaC291OT1KzyjerxM1uWkymzJPK99gAHtPfHXHl5vAV7UCaVa2MPVe_jz4X1arH42tNb8cQv_e41lemMPB0v3vXbgtoE9IF9KCY2vKs.
