## CVE-2025-33073 - Windows Server 2016/2019/2022, Windows SMB Client 权限提升 (Privilege Escalation) / NTLM反射

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 (Privilege Escalation) / NTLM反射

**影响应用:** Windows Server 2016/2019/2022, Windows SMB Client

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Windows Server 2016, 2019, 2022; Windows 10, 11 (特定版本)

**利用条件:** 拥有普通域用户凭据，目标环境未强制执行SMB签名，具备DNSAdmins权限或可利用ADIDNS进行投毒

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 45%

## 详情

【POC有效性分析】该漏洞名为CVE-2025-33073，是针对Windows SMB客户端NTLM认证机制的一次深层绕过。分析显示，漏洞存在于mrxsmb.sys驱动中，由于其对编组目标信息（Marshaled Target Information）的访问控制不当，允许攻击者伪造目标名称。本POC通过集成ADIDNS投毒和NTLM中继技术，实现了从普通域用户到SYSTEM权限的跨越。其核心逻辑在于：首先利用DNSAdmins权限或ADIDNS动态更新特性，在域内添加恶意的DNS记录；随后通过PetitPotam等强制认证手段，诱导域内主机（如域控或其他服务器）向攻击者控制的监听器发起SMB连接。由于mrxsmb.sys未能有效拦截携带特定目标信息的请求，攻击者可以绕过现有的NTLM反射缓解措施，将认证请求中继回目标机器自身或域内其他未开启SMB签名的机器，从而执行任意命令。POC代码结构清晰，使用了Impacket和NetExec等成熟框架，具备自动化探测目标DC、自动提取Flag和一键获取SYSTEM Shell的功能，经评估在实验环境下具有极高的利用成功率，对90%默认未启用SMB签名的企业环境构成直接威胁。

【利用步骤】1. 环境准备：在攻击机上安装Python3、Impacket、NetExec及krbrelayx工具包。2. 权限获取：获取一个具备DNSAdmins组权限或拥有ADIDNS写入权限的普通域用户账号。3. 启动监听：运行exploit.sh，配置攻击者IP、目标DC IP及域凭据，脚本将自动启动NTLM中继服务器并配置DNS记录。4. 强制认证：根据脚本提示，在另一终端使用nxc（NetExec）配合coerce_plus模块，通过PetitPotam等触发器强制目标机器向攻击者机器发起SMB认证。5. 权限提升：中继服务器捕获NTLM请求并完成反射攻击，通过WinRM协议在目标机器上反弹SYSTEM权限的Shell。

【投毒风险分析】该POC存在中等程度的投毒风险。首先，项目代码库源自第三方非官方仓库（uziii2208/CVE-2025-33073），此类针对高价值CVE的快速复现工具常被黑产利用作为分发马。其次，POC脚本中包含‘Auto-Flag Extraction’（自动Flag提取）功能，虽在CTF场景下属于辅助功能，但在真实防御分析中，这种自动化搜寻敏感文件的行为具有明显的蠕虫化特征，容易被修改为勒索软件的预热脚本。脚本要求sudo权限安装依赖（如netcat-openbsd），这为攻击者注入后门提供了高权限环境。虽然目前的README显示其主要依赖标准开源工具，但不排除在核心逻辑脚本exploit.sh中通过混淆手段下载并执行远程恶意Payload的可能。此外，自动化DNS记录修改操作如果不具备完善的回滚机制，会导致域内DNS环境污染，造成业务连续性风险。建议安全研究人员在完全隔离的沙箱环境中运行该POC，并重点审计其网络请求中是否存在非预期的外部域通信。

**项目地址:** [https://github.com/uziii2208/CVE-2025-33073](https://github.com/uziii2208/CVE-2025-33073)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
