## CVE-2025-33073 - Microsoft Windows SMB (Server Message Block) 权限提升/NTLM中继/反射攻击

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM中继/反射攻击

**影响应用:** Microsoft Windows SMB (Server Message Block)

**危害等级:** 高危 (Critical)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows Server 2016, 2019, 2022; Windows 10, 11 (主要影响域环境中的DC及未开启SMB签名的机器)

**利用条件:** 需要拥有一个普通的域用户凭据，且目标主机未强制开启SMB签名；利用DNSAdmins权限可实现更高级别的域控接管。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 25%

## 详情

【POC有效性分析】该漏洞被安全研究界称为“永恒之蓝”的变体或接班人，其核心在于Windows SMB客户端处理NTLM认证时存在设计缺陷，未能有效防御本地认证反射攻击。分析公开的PoC代码（exploit.sh及相关说明）可知，该利用工具集成了DNS投毒（基于DNSAdmins权限）、NTLM Relay（利用impacket和krbrelayx）以及WinRM远程执行。PoC通过自动化脚本引导用户输入目标信息，能够自动探测网络环境并识别易受攻击的域控制器。其技术链路非常完整：首先利用普通域账号或具有DNS管理权限的账号注入虚假的DNS记录，随后强制（Coerce）目标机器向攻击者控制的监听器发起身份验证请求。通过反射或中继该请求至WinRM服务，由于SMB驱动程序（mrxsmb.sys）在补丁前未对携带编组目标信息的目标名进行严格校验，攻击者可成功绕过认证保护，最终获取SYSTEM级别的Shell。PoC代码结构清晰，依赖项明确，具有极高的实战转化率。【利用步骤】1. 环境准备：在Linux攻击机上安装impacket、netexec和krbrelayx工具；2. 启动监听：运行exploit.sh进入交互模式，配置攻击者IP和目标DC信息，启动NTLM中继服务器；3. DNS注入：利用脚本自动在域DNS中添加攻击者控制的记录，或手动注入ADIDNS记录；4. 强制认证：使用nxc（NetExec）调用coerce_plus模块（如PetitPotam方法）触发目标DC向攻击者机器发起SMB连接；5. 权限提升：中继器捕获凭据并重定向至WinRM服务，执行自动化脚本中预设的命令，完成SYSTEM权限获取及Flag提取。【投毒风险分析】该PoC来源于GitHub第三方库（uziii2208/CVE-2025-33073），经过初步审查，其主体逻辑为Shell脚本调用成熟的安全工具链（如impacket），代码透明度较高。然而，由于该漏洞在2025年6月引发了大量的“保姆级”复现热潮，存在部分不法分子分发修改版利用工具的情况。风险主要集中在：1. 自动化Flag提取逻辑可能被篡改，将敏感数据（如NTDS.dit、机器Hash）异步上传至攻击者控制的C2服务器；2. 脚本中引用的远程仓库可能包含编译好的混淆二进制文件，存在植入后门风险；3. 某些版本的‘一键复现’脚本可能会在攻击者本地修改主机 hosts 文件或安装隐蔽的持久化程序。目前分析的该版本属于防御性研究范畴，代码库中未发现明显的恶意混淆（Obfuscation），投毒风险等级评定为低至中等。但在企业环境复现时，务必在隔离的实验室内使用，并严格审查exploit.sh中调用的外部URL请求。

**项目地址:** [https://github.com/uziii2208/CVE-2025-33073](https://github.com/uziii2208/CVE-2025-33073)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
