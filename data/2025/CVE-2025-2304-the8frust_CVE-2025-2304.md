## CVE-2025-2304 - Camaleon CMS 特权升级 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 特权升级 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危 (允许低权限用户通过质量赋值漏洞将自身权限提升至管理员)

**CVSS评分:** 未提供

**影响版本:** < 2.9.1

**利用条件:** 需要有效的低权限用户凭证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

该POC代码经过详细分析，被判定为高度有效且设计精良。它严格遵循了其`README.md`文件中概述的利用流程，包括但不限于以下关键步骤：首先，脚本能够成功访问目标CMS的管理员登录页面，并精确解析HTML以提取必要的CSRF（跨站请求伪造）令牌。其次，它利用提供的低权限用户凭证进行身份验证，并安全地管理会话Cookie。接着，脚本进一步导航至用户个人资料编辑页面，再次从中提取出用于密码更新的AJAX端点和新的CSRF令牌。最关键的是，该POC能够巧妙地构造一个恶意的HTTP PATCH请求，将其发送至密码更新端点。在这个请求中，除了正常的密码更新数据外，脚本还额外注入了`password[role]=admin`参数。这种做法直接利用了Camaleon CMS中存在的“质量赋值”（Mass Assignment）漏洞，使得后端在处理用户资料更新时，未能正确地过滤或验证所有传入的参数，从而允许攻击者非法修改用户的角色。脚本随后会验证用户角色是否已成功从低权限提升为管理员。在成功利用后，它还会清晰地输出新的管理员会话Cookie，这些Cookie可以被攻击者直接用于以管理员身份访问和控制整个CMS系统。脚本的实现采用了Python标准库`requests`进行HTTP通信，以及`BeautifulSoup`库进行HTML解析，这两种都是业界广泛认可且可靠的工具。此外，脚本还包含了基本的错误处理和清晰的彩色输出信息，增强了其可用性和可读性。鉴于其详细的执行步骤和对目标漏洞的精准打击，该POC在实际渗透测试环境中，对于复现和验证此特权升级漏洞具有极高的实用价值。

**利用步骤**
针对Camaleon CMS的此特权升级漏洞的利用过程相对直接，主要依赖于POC脚本的自动化执行。具体步骤如下：
1.  **环境准备**: 攻击者首先需要在本地机器上安装Python 3编程环境。随后，需要安装脚本所需的两个主要Python库：`requests`（用于发送HTTP请求）和`beautifulsoup4`（用于HTML解析）。安装命令通常为`pip install requests beautifulsoup4`。
2.  **获取初始凭证**: 攻击者必须预先获得目标Camaleon CMS系统中一个有效的低权限用户账号和对应的密码。这是利用此漏洞的前提条件，因为Mass Assignment发生在已认证用户的资料更新接口。
3.  **执行漏洞利用脚本**: 攻击者将`exploit.py`脚本下载到本地。在命令行中，使用Python 3执行该脚本，并提供以下必需的参数：目标Camaleon CMS的基准URL（`-t`或`--target`）、低权限用户的用户名（`-u`或`--username`）以及该用户的密码（`-p`或`--password`）。一个典型的命令示例是：`python3 exploit.py -t http://target.example.com -u lowuser -p lowpass123`。
4.  **脚本自动化攻击流程**: 脚本首先向目标CMS的管理员登录页面（`/admin/login`）发起GET请求，解析返回的HTML内容以提取有效的CSRF令牌。脚本随后使用提供的凭证和CSRF令牌尝试登录，并保存会话Cookie。接着，脚本访问已认证用户的个人资料编辑页面（`/admin/profile/edit`），再次从中解析以发现用于更新密码的特定AJAX端点，并获取新的CSRF令牌。关键步骤是构造一个恶意的HTTP PATCH请求，目标是之前发现的密码更新端点。请求体中包含了正常的密码更新参数，但额外添加了非预期的参数：`password[role]=admin`。当此恶意请求被发送到服务器时，由于Camaleon CMS的Mass Assignment漏洞，系统会在处理用户资料更新时，将传入的`role`参数误认为是合法且可修改的字段，并将其值设置为`admin`，从而实现权限提升。脚本会进行后续检查，以确认用户的角色是否已成功升级为管理员。如果利用成功，脚本会在控制台输出一条成功消息，并打印出包含新管理员权限的会话Cookie，攻击者可以使用这些Cookie继续进行后续操作。

**投毒风险分析**
针对此漏洞的POC代码（`exploit.py`）的投毒风险经过严格评估，被认定为极低，具体百分比评估为5%。这一评估基于以下详尽的分析：
首先，**代码的透明度和可读性极高**。`exploit.py`脚本的结构清晰，逻辑流程一目了然。所有HTTP请求均通过标准且信誉良好的`requests`库进行，HTML内容解析则依赖于`beautifulsoup4`库。脚本中使用了标准的Python语法、清晰的变量命名和适量的注释，使得任何具备基本Python知识的安全研究人员都能轻松阅读和理解其内部机制。没有发现任何代码混淆、加密或使用不常见编码技术的迹象，这进一步保证了其行为的透明性。
其次，**依赖的库均为业内标准且广受信任**。该POC仅依赖于Python的标准库以及两个非常流行的第三方库：`requests`和`beautifulsoup4`。这两个库在开源社区中拥有广泛的用户基础和严格的审查，未曾被发现包含恶意代码或后门。脚本没有尝试引入或执行任何来自未知源或可疑URL的外部代码或二进制文件。
第三，**脚本行为完全符合其宣称的目的**。POC的整个执行流程——从登录、获取CSRF令牌、访问特定页面、到构造包含恶意`role`参数的PATCH请求并验证权限提升——都与利用Camaleon CMS的特权升级漏洞（通过Mass Assignment）的描述完全一致。在代码中，没有发现任何与漏洞利用目的无关的、可疑的或潜在恶意的操作，例如：尝试进行文件系统操作、执行任意系统命令（通常是RCE漏洞的特征，而非此漏洞）、扫描网络、向攻击者控制的服务器发送敏感信息（除了正常请求的响应）、安装后门程序、修改系统配置或进行加密货币挖掘等。
唯一的，可以被误解为潜在风险的“行为”是脚本在成功利用后会将新的管理员会话Cookie打印到标准输出。然而，这并非投毒行为，而是漏洞利用成功后的预期输出，旨在帮助研究人员或攻击者继续利用已获得的管理员权限。这些Cookie仅在本地控制台显示，脚本中没有任何将其发送到外部地址的代码逻辑。
综上所述，该POC代码是专注于漏洞利用的“干净”代码，其设计和实现均未包含任何恶意载荷或投毒机制。用户可以放心地对其进行安全审查、测试和学习，而无需担心意外引入恶意软件或受到其他攻击。5%的风险评估仅仅是出于对任何第三方代码都可能存在的微小未知风险的保守考量。

**项目地址:** /tmp/vulnwatchdog_220093ac3951fe2a6e00bf89ef95261d

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-2304
