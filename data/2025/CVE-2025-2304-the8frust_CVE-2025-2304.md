## CVE-2025-2304 - Camaleon CMS Mass Assignment, Privilege Escalation

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Mass Assignment, Privilege Escalation

**影响应用:** Camaleon CMS

**危害等级:** 未提供

**CVSS评分:** 未提供

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (Valid low-privileged user credentials), 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

该漏洞（CVE-2025-2304）存在于Camaleon CMS，受影响的版本低于2.9.1。这是一个由于Mass Assignment（批量赋值）导致的特权升级漏洞。具体来说，当一个低权限用户尝试更新其密码时，系统未能正确地限制用户可修改的属性。攻击者可以利用这一缺陷，通过在密码更新请求中注入额外的参数（例如`password[role]=admin`），将自己的用户角色提升为管理员。

**POC有效性分析：**
该POC代码通过一个Python脚本`exploit.py`实现了对Camaleon CMS特权升级漏洞的完整利用。脚本设计精良，遵循了`README.md`中描述的详细利用流程。它首先利用`requests`库模拟浏览器行为，访问`/admin/login`页面以获取初始的CSRF令牌。接着，使用提供的低权限用户凭证进行身份验证，并维持一个会话。成功登录后，脚本会导航至`/admin/profile/edit`页面，再次解析HTML以提取用于密码更新的特定AJAX端点以及其所需的CSRF令牌。核心的漏洞利用步骤在于构建一个恶意的PATCH请求。该请求的JSON或表单数据中不仅包含新密码，还巧妙地注入了`password[role]=admin`参数。由于Camaleon CMS存在批量赋值缺陷，系统在处理此请求时会误将`role`属性也更新为`admin`，从而实现特权升级。脚本在发送请求后，会验证用户角色是否已成功提升，并通过输出更新后的会话cookie来确认利用成功。整个过程逻辑清晰，代码可读性高，使用了标准且成熟的`requests`和`beautifulsoup4`库进行网络通信和HTML解析。其自动化程度高，参数化良好，只需提供目标URL、用户名和密码即可运行。因此，该POC被评估为高度有效且可靠，能够稳定地演示并利用此特权升级漏洞。

**利用步骤：**
1.  **环境准备**：确保本地系统安装了Python 3。通过`pip install requests beautifulsoup4`命令安装所需的Python库。
2.  **获取凭证**：获取目标Camaleon CMS系统上的一个有效低权限用户（非管理员）的用户名和密码。
3.  **执行POC**：在命令行中，导航到POC代码所在的目录，并执行`exploit.py`脚本，提供目标CMS的基础URL、低权限用户名和密码作为参数。例如：`python3 exploit.py -t http://your-target-cms.com -u lowprivuser -p yourpassword`。
4.  **自动化流程**：
    *   脚本首先向`/admin/login`发送GET请求，获取登录页面的HTML内容，并从中解析出CSRF令牌。
    *   接着，使用提供的用户名、密码和获取到的CSRF令牌，向`/admin/login`发送POST请求，完成低权限用户的身份验证。
    *   认证成功后，脚本会带着会话cookie访问`/admin/profile/edit`页面。
    *   在个人资料编辑页面，脚本再次解析HTML，定位到用于更新密码的AJAX端点，并提取另一个CSRF令牌。
    *   然后，脚本构建一个恶意的PATCH请求，其数据包中除了包含新的用户密码外，还额外添加了`password[role]=admin`参数。
    *   这个精心构造的请求被发送到密码更新的AJAX端点，利用了批量赋值漏洞，将当前用户的角色从低权限用户提升为管理员。
5.  **验证与输出**：脚本会验证用户角色是否成功升级为管理员。如果成功，它将打印出新的会话cookie，攻击者可以使用这些cookie直接以管理员身份访问CMS。

**投毒风险分析：**
该POC代码的投毒风险评估为**0%**，属于极低风险范畴。这一结论基于对所提供`exploit.py`源代码的深入审查和分析，具体原因如下：

1.  **代码来源与结构**：POC代码位于一个临时目录`/tmp/vulnwatchdog_...`下，这通常表明它是一个本地副本，可能来源于某个公开的代码仓库。代码本身是清晰、非混淆的Python脚本，具有良好的结构和注释（虽然不多，但变量和函数命名语义化）。这种透明性是评估风险的基础，因为它允许进行全面的代码审计。

2.  **依赖项审查**：脚本仅依赖于Python标准库以及两个非常流行的第三方库：`requests`（用于HTTP请求）和`beautifulsoup4`（用于HTML解析）。这两个库在Python社区中被广泛使用和审查，通常被认为是安全且可靠的。POC中没有引入任何不寻常、不熟悉或从可疑来源获取的第三方依赖，也未见动态加载外部模块的行为。所有依赖都通过标准的`pip install`命令安装，进一步降低了引入恶意组件的风险。

3.  **网络行为分析**：对`exploit.py`中的所有网络请求（通过`requests`库）进行了审查。所有的HTTP/HTTPS请求都明确指向由用户在命令行参数`-t`（`--target`）中指定的目标URL。代码中没有发现任何向预设的第三方服务器、未知域名或IP地址发送数据的行为，包括用户凭证、系统信息、环境数据或其他敏感信息。攻击者的意图仅限于与目标Camaleon CMS进行交互，以实现特权升级。

4.  **文件系统和系统命令交互**：`exploit.py`代码中没有包含任何文件读写操作（例如，`open()`, `shutil`等），也没有尝试修改本地文件系统、配置文件或植入任何形式的后门。此外，脚本没有使用`os.system()`、`subprocess`模块等可能导致执行任意系统命令的函数。这意味着POC本身不会对运行它的系统造成损害或带来额外的安全风险。

5.  **代码混淆与动态执行**：脚本代码是完全明文的，没有使用任何混淆技术（如编码、加密、动态字符串拼接来隐藏恶意逻辑）。也没有利用`eval()`、`exec()`等函数来动态执行从外部获取的代码，从而排除了通过隐藏的恶意payload进行投毒的可能性。

6.  **目的专注性**：该POC的唯一明确目的是利用Camaleon CMS的批量赋值漏洞实现特权升级。代码的每一部分都直接服务于这一目标。它不包含任何超出此范围的辅助功能，例如扫描网络、下载额外的恶意payload、进行DDoS攻击或进行挖矿等行为。

综上所述，由于该POC代码来源透明、依赖项安全、网络行为可控、不进行文件系统修改或系统命令执行，且代码本身无混淆，因此可以确认其不包含任何投毒机制。在进行合法的防御性安全研究或测试时，这是一个可以信赖的POC。然而，任何安全研究人员在执行任何POC之前，仍应遵循最佳实践，即在隔离、受控的环境中进行，以防止意外情况发生。

**项目地址:** 未提供

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
