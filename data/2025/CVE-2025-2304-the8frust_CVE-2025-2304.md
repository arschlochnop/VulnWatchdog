## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** N/A

**影响版本:** < 2.9.1

**利用条件:** 需要有效低权限用户凭据；需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-2304是一个影响Camaleon CMS版本低于2.9.1的权限提升漏洞，其根源在于存在一个批量赋值（Mass Assignment）缺陷。当一个低权限用户尝试通过密码更新AJAX接口修改密码时，由于应用程序未能正确过滤或验证输入参数，攻击者可以在更新请求中注入额外的参数（例如`password[role]=admin`），从而将自己的角色从普通用户提升到管理员权限。这意味着任何拥有有效低权限账户的攻击者都可以利用此漏洞完全控制受影响的CMS实例。

**POC有效性分析:**
所提供的POC代码是一个用Python编写的脚本（`exploit.py`），并附有详细的`README.md`文档。该POC采用`requests`库进行HTTP通信，并使用`BeautifulSoup4`库进行HTML解析，以提取CSRF令牌和特定的API端点。脚本实现了一个完整的攻击流程：首先获取登录页面的CSRF令牌，然后使用提供的低权限用户凭据进行认证。成功认证后，脚本会访问个人资料编辑页面，从中提取密码更新的AJAX端点和相关的CSRF令牌。关键步骤在于，脚本随后会构造一个PATCH请求发送到该密码更新端点，并在请求体中恶意地包含了`password[role]=admin`参数。由于CMS存在批量赋值漏洞，系统在处理密码更新时会错误地将此角色参数应用到用户对象上，从而导致用户权限被提升至管理员。脚本最后会验证权限是否成功提升，并输出可重复利用的会话Cookie。从代码结构、逻辑和文档来看，该POC功能完整、逻辑清晰，能够有效地重现并利用该权限提升漏洞。它是一个高质量的、开箱即用的完整利用脚本。

**利用步骤:**
1.  **环境准备**: 确保系统已安装Python 3及所需的依赖库：`pip install requests beautifulsoup4`。
2.  **获取凭据**: 攻击者需要获得一个目标Camaleon CMS实例的有效低权限用户凭据（用户名和密码）。
3.  **执行POC**: 在命令行中运行POC脚本，并提供目标CMS的URL、获取到的用户名和密码：`python3 exploit.py -t http://target.com -u <username> -p <password>`。
4.  **初始认证**: 脚本首先访问 `/admin/login` 页面，提取anti-CSRF令牌，然后使用提供的用户名和密码向 `/admin/login` 发送POST请求以完成登录。
5.  **端点和令牌提取**: 登录成功后，脚本会访问 `/admin/profile/edit` 页面。通过解析该页面的HTML内容，脚本会识别出用于密码更新的AJAX端点（例如 `/admin/profile/password` 或类似路径）以及此操作所需的新的CSRF令牌。
6.  **构造恶意请求**: 脚本随后构造一个HTTP PATCH请求，目标是之前提取到的密码更新AJAX端点。请求的载荷（payload）中除了包含新的密码字段外，最关键的是注入了 `password[role]=admin` 参数。这个参数利用了批量赋值漏洞，告诉CMS在更新用户密码的同时，将用户角色也设置为管理员。
7.  **权限提升验证**: 请求发送后，如果漏洞利用成功，应用程序将处理该恶意参数并提升用户的权限。脚本会尝试访问只有管理员才能访问的页面或执行管理员特有的操作来验证权限提升是否成功。
8.  **结果输出**: 一旦确认权限提升成功，脚本将输出一条成功消息和当前会话的Cookies。攻击者可以使用这些Cookies在浏览器或其他工具中继续以管理员身份访问和操作Camaleon CMS。

**投毒风险分析:**
对提供的POC代码进行深入分析后，评估其投毒风险为低，具体风险百分比为10%。
*   **代码透明度**: POC代码（`exploit.py`）使用Python编写，语言清晰，结构良好，没有使用混淆技术或难以理解的复杂逻辑。所有关键操作（如HTTP请求、HTML解析和参数构造）都易于审查和理解。
*   **依赖库**: 脚本仅依赖于标准Python库（如`argparse`, `textwrap`, `sys`）和两个广泛使用的第三方库：`requests`（用于HTTP请求）和`beautifulsoup4`（用于HTML解析）。这些库都是安全社区中经过严格审查和广泛信任的，没有引入潜在恶意代码的风险。
*   **外部连接**: 脚本的主要功能是向指定的目标CMS服务器发送HTTP请求。它不尝试与任何其他未知的外部服务器建立连接、下载额外代码或执行远程命令。其行为范围严格限定在对目标CMS进行漏洞利用。
*   **系统交互**: 脚本对本地系统的影响非常有限，主要限于命令行参数解析和标准输出。它不进行文件写入、系统配置修改、注册表操作、创建计划任务或任何可能导致持久化或系统破坏的行为。
*   **恶意行为缺失**: 代码中没有检测到任何通常与投毒攻击相关的模式，例如：`eval()`或`exec()`与不可信输入的使用、代码注入、下载并执行任意代码、加密货币挖矿代码、后门安装、数据窃取或数据泄露等。
*   **免责声明**: `README.md`文件中明确指出：“仅用于教育和授权安全测试。未经授权使用是被禁止的。”这表明了该POC的合法用途和设计初衷。

综合来看，该POC代码是专注于漏洞利用本身，旨在帮助安全研究人员或渗透测试人员合法地验证和理解漏洞。它没有包含任何恶意负载或试图通过供应链攻击进行投毒的行为。用户在执行任何来自外部的代码时仍应保持警惕，但就当前这份POC而言，其安全风险处于非常低的水平。

**项目地址:** N/A

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
