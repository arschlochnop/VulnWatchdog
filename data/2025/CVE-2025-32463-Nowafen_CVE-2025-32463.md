## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危/Critical

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.9.14 to 1.9.17 (before 1.9.17p1)

**利用条件:** 需要本地用户访问权限；具体而言，攻击者需要在目标系统上具备能够调用带有 `--chroot (-R)` 选项的 `sudo` 命令的能力。尽管POC文档提到“非特权用户但具有 sudo 访问权限和 --chroot 权限”，这意味着用户需要具备执行特定 `sudo` 命令的权限，即使不属于 `sudoer` 组。此外，为了从源代码编译POC，需要Go 1.2+、gcc和libc-dev；不过，POC也提供了预编译的二进制文件，简化了部分环境要求。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个存在于Linux权限管理工具Sudo中的高危本地提权漏洞，CVSS评分为9.3。该漏洞主要影响Sudo版本1.9.14至1.9.17（以及1.8.8至1.9.17的部分版本，在1.9.17p1之前）。漏洞的根源在于Sudo在使用`--chroot (-R)`选项时，对用户控制的chroot环境中的`/etc/nsswitch.conf`文件处理不当。攻击者可以利用此缺陷，通过构造恶意的chroot环境，加载任意恶意动态链接库（如libnss_*.so.2），从而在目标系统上获取root权限。此漏洞的发现和分析表明，即使是非sudoer组的用户，在特定配置下也可能利用此功能实现权限提升。该漏洞被引入于Sudo v1.9.14版本，与chroot功能相关的命令匹配处理代码更新有关。

**POC有效性分析：**
该POC是一个用Go语言编写的完整利用工具，具有高度的可用性和自动化程度。它旨在自动化整个漏洞利用过程，从环境准备到最终获取root shell。POC的README文件提供了清晰的构建和使用指南，包括下载预编译二进制文件或从源代码构建的选项。根据描述，该工具会：
1. 在`/tmp`目录下创建一个临时目录（例如`/tmp/sudowoot.stage.*`），作为伪造的chroot环境。
2. 生成恶意的C语言代码文件（`woot1337.c`），这段代码的作用是在执行时将进程的UID和GID设置为0，然后启动一个root shell。
3. 在伪造的chroot环境中设置一个恶意的`nsswitch.conf`配置，使其能够加载攻击者控制的动态链接库。
4. 将生成的C代码编译成一个共享库（例如`libnss_/woot1337.so.2`）。
5. 通过执行`sudo -R woot woot`（或其他利用`--chroot`选项的命令）来触发漏洞，强制`sudo`在指定的chroot环境中加载恶意共享库。
6. 一旦恶意共享库被加载，其中的代码将被执行，从而实现权限提升并生成一个root shell。

POC文档中提供的验证步骤，如在root shell中运行`id`和`whoami`命令来确认用户ID为0和用户名为root，进一步证实了其有效性。考虑到漏洞原理的清晰性、POC实现的自动化程度以及公开披露的广泛性，该POC在符合条件的易受攻击系统上具有极高的成功率和有效性。

**利用步骤：**
1. **准备环境**：确保目标系统是Sudo受影响版本（1.9.14至1.9.17，且在1.9.17p1之前），并且攻击者拥有本地非特权用户账户。如果从源代码编译，目标系统需要Go 1.2+、gcc和libc-dev。攻击者账户需要能够执行带有`--chroot`选项的`sudo`命令。
2. **获取POC**：
   *   **下载预编译二进制文件**：执行命令 `curl -L https://github.com/Nowafen/CVE-2025-32463/releases/download/exploit/exploit -o exploit && chmod +x exploit`。
   *   **从源代码构建**：执行命令 `git clone https://github.com/Nowafen/CVE-2025-32463.git && cd CVE-2025-32463 && go build -o exploit`。
3. **执行漏洞利用**：运行编译好的POC二进制文件，命令为 `./exploit --execution`。POC将自动完成环境准备、恶意代码编译、chroot设置和漏洞触发等所有步骤。
4. **验证权限**：成功利用后，POC将启动一个root shell。在新的shell中，执行 `id` 命令应显示 `uid=0(root)`，执行 `whoami` 命令应显示 `root`，确认已获得root权限。
5. **清理**：POC工具通常会在利用完成后自动清理其创建的临时文件。

**投毒风险分析：**
对该POC代码的分析表明，其投毒风险处于低水平（10%）。主要基于以下几点考量：
1. **代码透明度与描述一致性**：POC的README文件详细描述了其工作原理，包括如何创建临时目录、生成并编译恶意C代码，以及如何利用`sudo`的`--chroot`选项加载该恶意共享库。这些描述与漏洞的利用机制完全吻合，且没有发现任何隐藏的或未声明的恶意行为。POC本身的功能就是为了在目标系统上实现权限提升，其“恶意”行为（如加载提权共享库）是其核心功能，而非额外附加的投毒行为。
2. **外部依赖性**：`go.mod`文件显示了标准的Go模块结构，未列出任何可疑或非官方的外部依赖。这意味着POC不太可能在后台偷偷拉取并执行来自不可信源的代码。
3. **本地操作**：POC的所有关键操作都在本地进行，例如创建临时文件、编译C代码等，这些都是exploit过程的正常组成部分。没有迹象表明POC会尝试建立C2（命令与控制）连接、进行数据窃取或执行其他与提权无关的网络通信。
4. **无混淆迹象**：尽管README中提到了“use garble for obfuscation”作为一种可选的构建方式，但这并非POC默认的行为，且其提供的源代码并未进行混淆。清晰的源代码有助于安全研究人员审查其内部逻辑，从而降低潜在的投毒风险。如果使用者选择使用混淆后的二进制，则需要承担更高的风险，但就原始POC本身而言，风险较低。

综上所述，该POC的主要风险在于其作为一种强大的本地提权工具，可能被恶意滥用。然而，从其自身是否包含额外恶意载荷的角度来看，其透明度和本地化操作特性使其投毒风险非常低。建议用户始终在隔离环境中运行此类工具，并仔细审查其源代码，以确保安全。

**项目地址:** https://github.com/Nowafen/CVE-2025-32463

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
