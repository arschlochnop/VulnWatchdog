## CVE-2025-32463 - sudo 本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** sudo

**危害等级:** Critical

**CVSS评分:** 9.3

**影响版本:** sudo 1.9.14-1.9.17 (before 1.9.17p1)

**利用条件:** 本地访问，需要一个非特权用户，但该用户需具备执行`sudo`命令并使用`--chroot`选项的权限。无需其他特定认证。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2025-32463是一个在`sudo`程序中发现的本地权限提升漏洞，影响版本为`sudo 1.9.14`至`1.9.17`（具体为`1.9.17p1`之前的版本）。该漏洞的CVSS评分为9.3，被定为Critical级别。问题出在`sudo`在处理`--chroot (-R)`选项时的一个缺陷，结合了NSS（Name Service Switch）劫持技术。当`sudo`命令被用于在一个由用户控制的目录中执行`--chroot`操作时，`sudo`可能会加载恶意的`/etc/nsswitch.conf`文件，进而加载恶意共享库，最终导致本地非特权用户获得`root`权限。攻击者通过操纵`chroot`环境，强制`sudo`加载一个恶意的共享库（例如，伪装成`libnss_*.so.2`），该库在加载时执行预设的payload，将进程的UID和GID设置为0，从而生成一个`root shell`。

**POC有效性分析与利用步骤:**
*   **POC有效性:** 所提供的Go语言实现的POC（`github.com/Nowafen/CVE-2025-32463`）是一个功能完整的漏洞利用工具，其`README.md`文档清晰详尽，包含了漏洞概述、影响版本、利用影响、先决条件、快速启动、使用方法和缓解措施。POC提供了预编译二进制文件和从源码构建的选项，极大地降低了利用门槛。其工作原理描述与漏洞原理一致：创建一个临时目录，生成用于提权（设置UID/GID为0并生成root shell）的恶意C代码，编译为共享库，然后设置一个假的`chroot`环境，利用`sudo -R woot woot`命令强制加载恶意NSS共享库，最终实现权限提升。成功执行后，会自动清理临时文件，表现出专业性和鲁棒性。根据其详细的步骤和原理描述，该POC具备高度的有效性。
*   **利用步骤:**
    1.  **准备环境:** 目标系统需安装Go 1.2+、gcc、libc-dev，并运行受影响的`sudo`版本（1.9.14-1.9.17）。攻击者需要具备一个非特权用户账号，且该用户能够通过`sudo`命令使用`--chroot`选项。
    2.  **获取POC:** 攻击者可以通过`curl`下载预编译的二进制文件，或者通过`git clone`下载源代码并编译。
        ```bash
        curl -L https://github.com/Nowafen/CVE-2025-32463/releases/download/exploit/exploit -o exploit
        chmod +x exploit
        # 或者
        git clone https://github.com/Nowafen/CVE-2025-32463.git
        cd CVE-2025-32463
        go build -o exploit
        ```
    3.  **执行漏洞:** 运行POC工具，带上`--execution`参数。
        ```bash
        ./exploit --execution
        ```
    4.  **验证:** 成功执行后，将获得一个`root shell`。在新的shell中执行`id`或`whoami`命令，应显示`uid=0(root)`或`root`。

**投毒风险分析:**
*   **POC代码分析:** 该POC项目采用Go语言编写，结构清晰，项目根目录下包含`go.mod`和`go.sum`文件，指示了标准的Go模块管理，增强了代码来源和依赖的透明度。从提供的`README.md`来看，POC的工作机制是本地生成C代码（`woot1337.c`）、本地编译（生成`libnss_/woot1337.so.2`）、并利用`sudo`的`--chroot`选项进行本地执行。整个过程没有提及任何需要外部网络请求（如下载额外Payload）、命令与控制（C2）服务器通信、加密通信或敏感数据回传等可疑行为。POC明确声明其目的为安全研究和教育，并警告不得用于恶意用途，这表明了其作者的意图是合法的安全研究。
*   **混淆和恶意行为检测:** 在提供的代码片段和文档描述中，没有发现明显的代码混淆技术（除了编译Go程序本身可能进行的优化）、利用零日漏洞、嵌入除了权限提升本身之外的额外恶意payload，或通过外部脚本或远程资源加载恶意组件的迹象。其核心机制是通过`chroot`和NSS劫持加载一个动态生成的、用于提权的共享库。这种通过在目标系统上动态编译和加载恶意代码来完成权限提升是许多LPE（Local Privilege Escalation）漏洞利用的常见手法，属于漏洞利用的“预期恶意行为”，而非POC本身携带有害代码。项目托管在GitHub上，其公开性也使得代码更容易被社区审查。
*   **潜在风险与防御策略:** 尽管该POC本身没有表现出直接的投毒风险，即它不包含额外恶意代码，但任何公开的漏洞利用代码都天然具有被恶意行为者滥用的风险。攻击者可能会在下载或编译此类合法POC之后，对其进行修改，例如在提权成功后添加隐蔽的后门程序、窃取系统敏感数据、建立持久化访问机制或将其武器化以进行更广泛的攻击。对于组织而言，防御措施应包括：
    1.  **及时更新补丁:** 这是最直接且有效的防御措施，将`sudo`更新到`1.9.17p1`或更高版本可完全修复此漏洞。
    2.  **严格的代码审查:** 在任何环境中部署或测试公开的POC代码前，必须进行彻底的代码审查，以确保其没有被篡改或包含未声明的恶意功能。
    3.  **沙箱环境测试:** 所有的漏洞利用和分析工作都应在隔离的沙箱或虚拟机环境中进行，以防止潜在的意外行为或未知的恶意代码对生产环境造成影响。
    4.  **限制`sudo`权限:** 遵循最小权限原则，严格控制哪些用户可以访问`sudo`以及可以使用哪些选项。考虑在`/etc/sudoers`中添加`Defaults !use_chroot`来禁用`chroot`功能，尽管这可能影响某些特定应用场景。
    5.  **监控与日志:** 实施强大的系统监控和日志记录机制，特别是针对`sudo`命令的使用、NSS配置文件的更改、以及异常进程活动和文件创建行为，以便及时发现和响应潜在的攻击尝试。
*   **结论:** 综合分析，本POC是一个专为CVE-2025-32463漏洞设计的、功能完整的本地权限提升工具。其代码清晰，操作透明，没有发现额外的投毒行为，因此其**直接投毒风险评估为低（0%）**。然而，所有利用工具都存在被滥用的风险，建议组织采取全面的安全措施来防范此类漏洞的利用。

**项目地址:** https://github.com/Nowafen/CVE-2025-32463

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
