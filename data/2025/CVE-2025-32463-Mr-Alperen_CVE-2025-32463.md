## CVE-2025-32463 - Sudo 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高 (High)

**CVSS评分:** CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

**影响版本:** Sudo versions 1.9.14 to 1.9.17 inclusive

**利用条件:** 本地访问，需要目标系统支持/etc/nsswitch.conf，无需额外认证

**POC 可用性:** 10/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低 (Low)

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个在Linux `sudo`组件中发现的高危本地权限提升漏洞。该漏洞影响`sudo`的1.9.14至1.9.17版本。问题根源在于`sudo`的`-R`或`--chroot`选项的实现缺陷。此选项旨在允许用户在指定的`chroot`环境下执行命令。然而，在受影响版本中，当`sudo`在评估`sudoers`文件时，路径解析（特别是涉及到Name Service Switch, NSS）会错误地在用户指定的`chroot`目录内部进行。攻击者可以利用此行为，创建一个精心构造的、用户可控的`chroot`环境。在该环境中，攻击者会放置一个恶意的`/etc/nsswitch.conf`文件，该文件将NSS查找（例如`passwd`服务）重定向到攻击者控制的动态链接库。当`sudo`尝试进行任何NSS相关的查找（如验证用户或组信息）时，它会在`chroot`环境中加载这个恶意的NSS库。由于该库是在`sudo`运行的上下文中加载的，它可以在执行实际命令之前，以root权限运行任意代码。一旦恶意库被加载并执行，攻击者便能获得系统的root权限。`sudo`的1.9.17p1版本已修复此漏洞，通过回滚了引入此问题的变更，并已将`-R`或`--chroot`功能标记为废弃，计划在未来版本中完全移除，因为其复杂性导致安全风险较高且使用不广泛。

**POC有效性分析：**
所提供的POC是一个高度有效且功能完整的bash脚本，它精确地复现并利用了CVE-2025-32463漏洞。该脚本是自包含的，无需外部依赖（除了标准系统工具如`gcc`和`mktemp`）。它首先在`/tmp`目录下创建一个临时工作目录，以隔离利用环境。核心利用逻辑包括：
1.  **恶意NSS库构建**：脚本嵌入了一个C语言源文件`woot1337.c`，该文件被编译成动态链接库`libnss_/woot1337.so.2`。这个C代码利用GCC的`__attribute__((constructor))`特性，确保在库加载时自动执行`woot()`函数。`woot()`函数的核心功能是调用`setreuid(0,0)`和`setregid(0,0)`将当前进程的有效用户ID和组ID设置为0（即root），然后执行`chdir("/")`跳出`chroot`环境，最后通过`execl("/bin/bash", "/bin/bash", NULL)`启动一个新的root权限的bash shell。
2.  **迷你chroot环境设置**：脚本在临时目录中创建了一个简化的`chroot`结构，包括`woot/etc`和`libnss_`。最关键的部分是`woot/etc/nsswitch.conf`文件的创建，其内容为`passwd: /woot1337`。这意味着任何对`passwd`服务的NSS查找都将被重定向到攻击者控制的`/woot1337.so.2`库。同时，为了确保`getgrnam()`等函数不失败，脚本还将系统的`/etc/group`文件复制到`woot/etc`。
3.  **漏洞触发**：最后，脚本执行`sudo -R woot woot`。`-R woot`参数指定了攻击者控制的`woot`目录作为`chroot`的根目录。当`sudo`尝试在`chroot`环境中解析命令`woot`或进行任何NSS查找时（例如，查找当前用户的组信息），它会读取`woot/etc/nsswitch.conf`并加载攻击者提供的`libnss_/woot1337.so.2`库。由于`woot()`函数被设计为在库加载时立即执行，攻击者的代码将以root权限运行，从而成功获取root shell。POC在Kali Rolling 2025-7-3上经过测试，证明其在主流Linux发行版上具有很高的成功率。

**利用步骤：**
1.  在目标系统上，验证`sudo`版本是否在受影响范围（1.9.14至1.9.17 inclusive）内，可通过运行`sudo --version`确认。
2.  将提供的bash脚本（例如`exploit.sh`）保存到本地文件系统。
3.  授予脚本执行权限：`chmod +x exploit.sh`。
4.  执行脚本：`./exploit.sh`。
5.  成功执行后，脚本将自动为当前用户提供一个具有root权限的shell（例如`/bin/bash`）。

**投毒风险分析：**
针对此CVE-2025-32463漏洞的POC代码经过仔细审查，投毒风险被评估为极低（5%）。该POC是一个完全透明的bash脚本，其所有组件（包括嵌入的C代码）都是明文可见的，没有任何混淆处理。
其核心功能是为了实现本地权限提升：
1.  **代码透明性**：C代码`woot1337.c`直接嵌入在bash脚本中，其逻辑清晰明了，即获取root权限并启动一个root shell。这正是漏洞利用的预期行为。
2.  **无外部依赖或网络活动**：脚本没有尝试从外部URL下载任何文件，也没有进行任何可疑的网络通信或数据外传操作。所有操作都在本地文件系统上完成，涉及的文件创建、编译和删除都在临时目录中进行。
3.  **标准库使用**：C代码使用了标准的C库函数（如`stdlib.h`, `unistd.h`）和POSIX调用（`setreuid`, `setregid`, `chdir`, `execl`），没有发现使用任何非标准、可疑或易受攻击的库。
4.  **无隐藏功能**：脚本的逻辑专注于实现CVE的LPE，没有迹象表明存在任何额外的、未声明的恶意功能，例如安装后门、持久化机制、挖矿程序或数据窃取模块。
综上所述，虽然任何从非官方来源获取的POC代码都应保持警惕，但该POC的结构和行为表明它是一个专注于演示和利用特定漏洞的合法安全研究工具，而非包含额外恶意载荷的投毒尝试。其“恶意”行为仅限于获取root权限，这是LPE漏洞本身的特点。

**项目地址:** https://github.com/K1tt3h/CVE-2025-32463-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
