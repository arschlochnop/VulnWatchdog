## CVE-2025-32463 - Sudo 本地提权 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (LPE)

**影响应用:** Sudo

**危害等级:** 严重

**CVSS评分:** 9.3 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** 1.9.14 至 1.9.17

**利用条件:** 具有本地普通用户权限，系统安装了受影响版本的Sudo，且支持/etc/nsswitch.conf配置。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞是Sudo在1.9.14版本中引入的一个设计缺陷。在处理'-R'或'--chroot'参数时，Sudo会在切换到用户指定的根目录（chroot）后，尝试解析/etc/nsswitch.conf以获取用户信息。由于此时Sudo进程仍具有root特权，它会加载并执行新chroot环境下由攻击者控制的动态链接库。POC通过创建一个伪造的chroot环境，其中包含恶意的/etc/nsswitch.conf和编译好的libnss共享对象。当执行'sudo -R'命令指向该目录时，Sudo会调用恶意库。在POC代码中，恶意库利用__attribute__((constructor))属性在加载时立即运行。它通过setreuid(0,0)和setregid(0,0)确保获得完全的root身份，随后调用chdir("/")配合chroot逃逸技巧（如execl）打破chroot限制，从而弹回一个具有物理主机root权限的bash shell。实验证明该POC逻辑严密，利用了Sudo核心路径解析机制的逻辑漏洞，无需依赖复杂的内核漏洞或内存破坏，在受影响版本上具有极高的成功率。利用步骤：首先，攻击者创建一个临时目录作为工作区；其次，编写一个带有构造函数属性的C代码文件，其核心逻辑是提升UID/GID并执行shell；然后，创建一个包含子目录etc的伪造chroot环境，并在其中写入指向恶意库名的nsswitch.conf；接着，使用gcc将C代码编译成共享库文件，并放置在Sudo会搜索的NSS路径下；最后，执行'sudo -R [伪造目录] [任意命令]'触发提权。投毒风险分析：从防御性安全研究的角度看，该POC代码逻辑清晰、透明。它使用了标准的C语言库函数和Shell脚本语法，没有使用任何混淆手段或二进制加密。其Payload部分明确指向了/bin/bash以获取权限，这是安全研究中PoC的典型行为。然而，投毒风险依然存在于几个方面：第一，在生产环境或共享服务器上运行此类脚本时，若脚本包含未声明的清理逻辑缺失，可能会留下提权后的持久化文件；第二，虽然此代码目前是干净的，但攻击者常通过修改编译参数（如-l参数链接远程恶意库）或在gcc编译环节插入隐藏指令来进行投毒。在自动化检测中，应重点监控gcc产生的so文件是否包含反弹shell的特征IP。此外，该脚本涉及到的mktemp目录如果权限设置不当，可能被其他本地恶意程序竞争利用。总体而言，该代码是标准的漏洞验证程序，投毒风险较低，主要风险在于其本身强大的提权能力，建议仅在受控的安全实验室环境中进行测试。

**项目地址:** [https://www.stratascale.com/vulnerability-alert-CVE-2025-32463-sudo-chroot](https://www.stratascale.com/vulnerability-alert-CVE-2025-32463-sudo-chroot)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
