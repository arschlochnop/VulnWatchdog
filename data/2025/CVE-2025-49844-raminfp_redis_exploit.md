## CVE-2025-49844 - Redis Use-After-Free (UAF), 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free (UAF), 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** 所有Redis版本低于8.2.2，8.0.4，7.4.6，7.2.11

**利用条件:** 远程访问，默认无需认证

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-49844，又称RediShell，是一个在Redis Lua解释器中发现的严重Use-After-Free（UAF）漏洞，其影响是远程代码执行（RCE）。该漏洞的CVSS评分高达10.0，属于危急级别，意味着攻击者可以在无需认证（默认配置下）的情况下通过远程访问Redis服务器来执行任意代码。受影响的Redis版本包括所有低于8.2.2、8.0.4、7.4.6和7.2.11的版本。

**POC有效性分析：**
该POC项目提供了一个完整的实验室环境，用于测试和理解CVE-2025-49844漏洞。项目包含一个`Dockerfile`和一个详细的`README.md`文件。`Dockerfile`精心构造了一个基于Redis 7.2.0（已知易受攻击版本）的Docker容器，并特意配置了`protected-mode no`和`bind 0.0.0.0`，使Redis实例在测试环境下可从外部访问且无需认证，这正是利用该漏洞所必需的条件。这种配置明确地为实验室测试禁用了默认的安全机制。
`README.md`文件提供了非常详细的指引，涵盖了环境搭建的先决条件、快速启动步骤、`exploit_poc.py`脚本的各种用法（包括检查漏洞、执行基础UAF测试、沙箱逃逸测试、高级内存破坏测试以及运行所有测试）以及Docker环境的管理命令。虽然`exploit_poc.py`脚本本身未被提供，但`README.md`中对其功能的描述（例如“沙箱逃逸”和“高级内存破坏”）强烈暗示了其具备完整的RCE能力，而不仅仅是导致服务崩溃或信息泄露。这种端到端的、文档齐全的设置和利用流程，表明该POC具有极高的有效性，能够清晰地演示和重现CVE-2025-49844的全部影响，包括远程代码执行。

**利用步骤：**
1.  **环境准备**：在宿主机上安装Docker、Docker Compose以及Python及其依赖库（`redis`、`colorama`）。
2.  **启动易受攻击的Redis实例**：进入POC项目目录，执行`docker-compose up -d`命令，根据`Dockerfile`和（隐式存在的）`docker-compose.yml`文件启动一个Redis 7.2.0容器。该Redis实例将配置为`protected-mode no`和`bind 0.0.0.0`，使其可远程访问且无需认证。
3.  **验证服务状态**：等待几秒钟，确保Redis服务完全启动后，通过`docker-compose ps`命令验证Redis容器是否正常运行。
4.  **执行漏洞利用**：运行提供的`exploit_poc.py`脚本，针对运行中的Redis实例发起攻击。例如，`python3 exploit_poc.py -H localhost -p 6380 -m all`将执行所有可用的测试模式，包括UAF、沙箱逃逸和高级内存破坏，最终实现远程代码执行。如果Redis服务器启用了认证，可以通过`-a "password"`选项提供密码。
5.  **观察结果**：脚本将输出测试结果，指示Redis实例是否易受攻击，并演示成功的漏洞利用，可能包括命令执行的输出或内存操作的痕迹。
6.  **清理环境**：测试完成后，使用`docker-compose down`或`docker-compose down -v`命令停止并移除实验室环境，包括相关卷。

**投毒风险分析：**
该POC项目被明确标记为“实验室环境”，仅用于“教育目的”。`README.md`中包含了清晰的警告：“仅在您拥有或获得明确许可的系统上使用”、“切勿暴露于互联网”以及“切勿在生产环境中使用”。这些免责声明强烈表明了其良性意图，旨在促进安全研究和理解，而非恶意部署。从提供的`Dockerfile`和`README.md`中，未发现任何代码混淆、加密字符串或可疑的网络请求。项目依赖于标准工具（Docker、Python、`redis-cli`）和本地连接（`localhost`）。

`Dockerfile`的内容直接且透明。它从官方的`redis:7.2.0`镜像构建，这是一个已知的易受攻击版本。`Dockerfile`中的修改——特别是`protected-mode no`和`bind 0.0.0.0`——是为了让Redis实例在测试期间故意不安全且可访问。这些配置的透明性与创建易受攻击且可访问的测试环境完全一致，没有发现任何可疑的、非标准的操作，例如从第三方源下载未知二进制文件、执行混淆的shell命令或引入后门组件。

尽管`exploit_poc.py`脚本本身未提供，但`README.md`中描述的各种测试模式（`check`、`basic` UAF测试、`sandbox`逃逸、`advanced`内存破坏、`all`）表明它是一个诊断和演示工具，而非隐秘的恶意载荷投放器。脚本对“UAF测试”、“沙箱逃逸”和“高级内存破坏”的关注直接对应于RediShell漏洞（Lua解释器中的UAF导致RCE）的技术细节，进一步证实了其作为特定CVE概念验证的角色。这些功能旨在展示漏洞的完整攻击链，而非执行额外的恶意操作。

然而，对于任何可执行的POC，都存在固有的风险，这是防御性安全研究必须警惕的。尽管此项目的意图看似良性，但如果`exploit_poc.py`被第三方替换或修改，则可能引入恶意载荷。例如，一个被篡改的`exploit_poc.py`可能会在演示漏洞的同时，安装后门、窃取数据、发起进一步的网络攻击、或者利用系统资源进行加密货币挖矿。此外，某些POC可能会在测试过程中创建持久性机制（如计划任务、服务或启动项），或者试图与外部C2服务器通信。

因此，在执行任何来自非官方源的POC时，都应采取严格的安全措施：1. **代码审计**：对所有脚本（包括`exploit_poc.py`等）进行彻底的代码审计，以识别潜在的恶意行为、可疑的网络连接、文件操作或系统命令。2. **沙箱环境**：始终在隔离的沙箱或虚拟机环境中运行POC，该环境与生产网络完全隔离，并且没有敏感数据。3. **网络监控**：在POC运行期间监控网络流量，检查是否有与已知恶意IP或域名的连接尝试，以及异常的数据外传。4. **系统监控**：监控系统资源使用、文件系统变化、进程活动和日志，以检测未经授权的操作。5. **哈希校验**：如果POC提供了哈希值，务必验证下载文件的完整性，确保其未被篡改。

鉴于提供的`Dockerfile`和`README.md`的明确警告、清晰文档以及专注漏洞演示的性质，此特定POC的直接“投毒风险”被评估为非常低（5%）。这个低风险评分是基于项目透明度和教育目的的判断。但用户始终应保持警惕，并严格审查任何随附的、尤其未直接包含在分析范围内的利用脚本（如`exploit_poc.py`），以防范潜在的第三方恶意篡改或误用。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
