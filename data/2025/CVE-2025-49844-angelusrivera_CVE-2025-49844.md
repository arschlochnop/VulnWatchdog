## CVE-2025-49844 - Redis Use-After-Free (UAF) / 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free (UAF) / 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** 所有支持Lua脚本的Redis版本，特别是8.2.1及更早版本，以及6.x和7.x分支中未打补丁的版本 (例如低于6.4.2, 7.2.4, 7.4.6, 7.8.6, 7.2.20等版本)

**利用条件:** 需要经过认证的攻击者 (拥有低权限及以上用户权限)

**POC 可用性:** 9/10

**POC 类型:** 概念验证 / 漏洞检测工具

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-49844，被命名为“RediShell”，是Redis数据库中一个极其严重的远程代码执行（RCE）漏洞。该漏洞的CVSS评分高达10.0分，属于最高威胁等级。其核心是一个存在于Redis Lua脚本执行模块中的Use-After-Free (UAF) 缺陷。该漏洞利用了Redis内存管理系统中一个长达约13年的固有问题，即在特定情况下，内存被释放后可能被错误地再次引用和使用。攻击者通过精心构造的Lua脚本，可以操控Redis的垃圾回收机制，强制触发这种“释放后重用”的错误，从而在Redis服务器的进程上下文中执行任意代码，最终导致服务器完全失陷。

受影响的范围非常广泛，包括所有支持Lua脚本的Redis版本，特别是8.2.1及更早版本。此外，6.x和7.x系列中未打补丁的版本也在此列，例如低于6.4.2, 7.2.4, 7.4.6, 7.8.6, 7.2.20等特定补丁版本之前的任何版本都面临风险。利用此漏洞的先决条件是攻击者需要具备对Redis服务器的认证凭据，即使是低权限用户也能进行利用。

**POC有效性分析：**
提供的POC是一个名为`rscan`的Go语言编写的漏洞检测扫描器。该工具旨在帮助用户检查其Redis服务器是否存在CVE-2025-49844漏洞。`README.md`文档非常详细，提供了清晰的构建步骤（使用Go Modules管理依赖并编译）和使用说明。用户可以通过指定目标主机、端口、认证密码，甚至批量扫描服务器列表文件来运行该扫描器。`rscan`的输出结果直观明了，会清晰地指示目标Redis服务器是否“DANGER!”（易受攻击）、“Good!”（已通过禁用Lua脚本保护）、“Great!”（已更新至安全版本），或“Oops!”（连接错误）。

尽管这个POC本身是一个检测工具，不包含直接的远程代码执行payload，但其`README.md`中深入解释了UAF漏洞的工作原理（“How This Memory Bug Works”部分），详细阐述了内存如何被错误地重用以及攻击者如何利用Redis的`EVAL`和`EVALSHA`等Lua脚本命令来篡改内存以实现任意代码执行。这种结合了工具化检测和详细漏洞原理阐释的方式，使得该POC在概念验证层面具有极高的有效性。它不仅能帮助用户迅速识别风险资产，还提供了理解漏洞机制和制定防护策略的宝贵信息。此外，POC还包含了即时缓解措施（禁用Lua脚本）和长期解决方案（更新Redis版本）的建议，使其成为一个全面且高度实用的安全工具。

**利用步骤：**
1.  **认证与访问：** 攻击者首先需要获取对目标Redis服务器的认证权限。这可能通过弱密码、默认凭据或此前获得的低权限账户实现。
2.  **构造恶意Lua脚本：** 攻击者需要深入了解Redis的内存管理机制和Lua引擎的内部实现，以精心构造一个恶意的Lua脚本。该脚本的目标是触发Redis内部的特定条件，导致某个内存区域在被释放后，又被错误地重用。
3.  **执行Lua脚本：** 利用Redis的`EVAL`或`EVALSHA`命令，攻击者将构造好的恶意Lua脚本提交给Redis服务器执行。
4.  **触发UAF与代码执行：** 当恶意脚本执行时，会触发Use-After-Free漏洞。攻击者通过控制被重用的内存区域，可以写入特定的数据，从而劫持程序控制流，最终在Redis服务器进程的权限下执行任意操作系统命令或Shell代码，导致服务器完全被控制。

**投毒风险分析：**
对提供的POC代码（`rscan` Go语言扫描器）进行分析，可以评估其投毒风险为极低 (5%)。该POC的`README.md`明确声明其目的仅限于“学习，而非攻击”，旨在帮助用户检查其Redis服务器的漏洞状态。代码本身是一个Go语言项目，依赖于标准的Go Modules进行构建和管理。在提供的README和代码片段中，没有发现任何可疑的行为模式，例如代码混淆、引入外部非标准或恶意库、执行未知外部脚本、建立隐蔽通信通道或试图植入后门。该工具的运行逻辑是基于网络连接和Redis协议进行版本识别和配置检查，以判断是否存在漏洞。其输出结果仅限于漏洞状态信息，不涉及任何数据篡改或恶意操作。因此，从代码和文档的表面分析来看，该POC是一个合法且专注于防御性研究的工具，不构成投毒风险。当然，任何情况下，用户在运行来自非官方源的代码时，都应保持警惕，建议在隔离环境中进行测试，并对代码进行安全审计以确保其安全无虞。

**项目地址:** 

**漏洞详情:** https://redis.io/blog/security-advisory-cve-2025-49844/
