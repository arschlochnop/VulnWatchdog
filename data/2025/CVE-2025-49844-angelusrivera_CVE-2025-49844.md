## CVE-2025-49844 - Redis 远程代码执行 (Use-After-Free)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (Use-After-Free)

**影响应用:** Redis

**危害等级:** 严重/Critical

**CVSS评分:** 10.0

**影响版本:** Redis < 6.2.20; 以及6.x, 7.x, 8.x分支中未打补丁的特定版本，包括Redis <= 8.2.1

**利用条件:** 需要认证（低权限或以上用户）; 需要能够执行Lua脚本

**POC 可用性:** 9

**POC 类型:** 概念验证 (Vulnerability Scanner)

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

Redis是一款高性能的开源键值存储数据库。CVE-2025-49844，被Wiz研究团队命名为RediShell，是Redis中一处影响严重的远程代码执行（RCE）漏洞，CVSS评分高达10.0分。该漏洞利用了Redis Lua脚本引擎中的一个存在时间长达约13年的释放后重用（Use-After-Free, UAF）缺陷。拥有认证权限的攻击者，即使是低权限用户，也可以通过精心构造的Lua脚本，操控Redis的垃圾回收机制，触发此UAF漏洞，进而导致在Redis服务器上执行任意代码，最终使服务器完全失陷。此漏洞影响Redis < 6.2.20版本，以及Redis 6.x、7.x和8.x分支中未打补丁的特定版本，例如POC中提及的所有8.2.1及更早版本。官方已发布安全补丁，建议用户及时升级至修复版本（例如：6.4.2-131+, 7.2.4-138+, 7.4.6-272+, 7.8.6-207+, 7.22.2-20+）。

POC有效性分析：
提供的POC是一个名为`rscan`的Go语言编写的扫描工具，旨在帮助用户检测其Redis服务器是否存在CVE-2025-49844漏洞。该POC具有很高的有效性，体现在以下几个方面：首先，其文档非常完善，提供了清晰的构建说明（`cd scanner; go mod tidy; go build -o rscan redis-scanner.go`）和多种使用示例，包括针对单个主机、多个主机或从文件导入主机列表进行扫描，并支持带密码认证的Redis实例。其次，扫描结果输出直观明了，通过🚨DANGER!（易受攻击）、🛡️Good!/✅Great!（受保护）、❌Oops!（连接问题）等标识符，清晰地指示了目标Redis服务器的漏洞状态，这对于快速识别和评估风险至关重要。更重要的是，POC的README文件还包含了对“释放后重用”（Use-After-Free）漏洞原理的详细解释，包括正常内存管理流程与漏洞触发机制的对比，以及攻击者如何通过Redis的Lua脚本系统（特别是`EVAL`和`EVALSHA`命令）来利用该漏洞实现任意代码执行。这种深入的原理剖析极大地增强了POC的教育和防御价值，使其不仅仅是一个检测工具，更是一个理解漏洞、指导修复的“完整指南”。虽然该POC本身不包含完整的RCE利用模块，但它有效检测了漏洞存在条件并详细阐述了利用机制，对于防御者来说是极为有用的威胁情报和自查工具。

利用步骤：
1.  **获取认证访问权限**：攻击者首先需要获取对目标Redis服务器的认证访问权限。根据描述，即使是低权限用户也足以满足条件。这意味着攻击者可能利用弱密码、凭证泄露或通过其他漏洞获得初步访问。
2.  **确认Lua脚本功能启用**：确认Redis服务器的Lua脚本执行功能（通过`EVAL`或`EVALSHA`命令）是启用的，这通常是Redis的默认配置。如果Lua脚本功能被禁用（例如通过`ACL SETUSER default -@scripting`），则无法利用此漏洞。
3.  **构造恶意Lua脚本**：攻击者需要精心构造一个恶意的Lua脚本。该脚本将利用Redis Lua引擎中存在的UAF漏洞，通过特定的内存操作和垃圾回收机制，导致Redis尝试使用已被释放的内存区域。
4.  **触发释放后重用**：通过`EVAL`或`EVALSHA`命令在Redis服务器上执行上述恶意Lua脚本。该脚本的执行将触发UAF缺陷，使得攻击者能够控制被释放并重新分配的内存区域的内容。
5.  **实现远程代码执行**：通过对内存的精准控制，攻击者可以覆盖Redis进程中的关键数据结构或函数指针，最终劫持程序执行流，在Redis服务器的上下文中执行任意操作系统命令或代码，实现RCE。

投毒风险分析：
该POC代码被评估为具有非常低的投毒风险（5%）。原因如下：首先，POC是一个Go语言编写的扫描工具，其核心功能是检测Redis服务器的漏洞状态，而非执行攻击载荷。代码本身在本地构建并运行（`go build -o rscan redis-scanner.go`），不涉及从外部下载或执行未经验证的脚本或二进制文件。其次，项目README文件明确声明其用途为“Just for Learning, Not Hacking ;)”，旨在帮助用户检查和保护自身资产。这种明确的声明降低了其被用于恶意目的的可能性。第三，作为Go语言项目，其依赖管理通过`go mod tidy`进行，透明且可追溯，通常不会引入隐藏的恶意代码，除非原始Go模块本身已被篡改。代码中没有明显的混淆、加密或尝试与可疑C2服务器通信的行为。其操作（连接Redis、发送命令、解析响应以判断版本和配置）符合一个安全扫描器的正常行为模式。因此，该POC被视为一个合法且安全的防御性工具，用于漏洞识别和教育，而非传播恶意软件或进行投毒攻击。

**项目地址:** N/A

**漏洞详情:** https://redis.io/blog/security-advisory-cve-2025-49844/
