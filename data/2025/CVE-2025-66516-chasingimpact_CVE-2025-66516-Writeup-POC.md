## CVE-2025-66516 - Apache Tika XXE (XML External Entity Injection)

**漏洞编号:** CVE-2025-66516

**漏洞类型:** XXE (XML External Entity Injection)

**影响应用:** Apache Tika

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** tika-core: 1.13 - 3.2.1; tika-parser-pdf-module: 2.0.0 - 3.2.1; tika-parsers: 1.13 - 1.28.5

**利用条件:** 无需认证，可通过网络上传或提交恶意构造的PDF文件进行攻击

**POC 可用性:** 4/10

**POC 类型:** 仅说明

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：根据提供的技术细节，该漏洞是一个极具威力的XXE注入。漏洞的根源在于Apache Tika的核心组件（tika-core）在调用Java StAX解析器处理PDF文档中的XFA（XML Forms Architecture）数据时，安全配置未能生效。尽管开发团队尝试通过`setXMLResolver`来拦截外部实体，但由于返回类型不匹配（返回了String而非InputStream），导致JDK默认解析器忽略了该设置并回退到默认的危险行为，即允许解析外部实体。攻击者只需构造一个包含恶意实体引用的PDF文件（如包含`SYSTEM "file:///etc/passwd"`），当Tika对其进行内容提取或解析时，就会触发文件读取或SSRF。由于该逻辑位于tika-core底层，任何集成了Tika的搜索索引系统、文档处理平台或邮件网关均处于高危状态。利用步骤：1. 准备一个合规的PDF文件结构；2. 在该PDF的XFA数据段中嵌入XML外部实体定义，指向目标系统的敏感文件（如/etc/passwd或C:/Windows/win.ini）或内部网络URL；3. 将该文件上传至使用受影响版本Apache Tika的应用程序；4. 观察应用程序返回的解析结果或通过SSRF带外（Out-of-band）接收泄露的数据。该POC目前主要表现为README文档和核心代码段分析，具有极高的理论可行性。投毒风险分析：针对该CVE的POC代码投毒风险目前评估为低到中等（15%）。虽然README中提供了详尽的技术分析和易损代码片段，但由于未提供一键式执行脚本（如Python、Bash等可直接运行的Exploit），因此直接执行恶意混淆代码的可能性较低。然而，研究员需警惕后续可能出现的所谓“一键验证脚本”或“批量检测工具”。在复杂的安全研究环境中，投毒者往往利用高危漏洞（如本例中的CVSS 10.0）作为诱饵，在PoC脚本中嵌入Base64加密的反弹Shell、静默下载恶意负载的指令或窃取本地凭证的Python后门。由于此漏洞涉及PDF解析，攻击者也可能发布预制的“测试PDF”，这些文件可能利用PDF自身的其他特性（如JavaScript执行或表单提交）在研究员的本地环境中触发非预期的网络行为。防御人员在复现时，应严格在隔离的沙箱环境中使用开源的、经过审计的解析逻辑进行测试，严禁直接运行来源不明的预编译二进制工具或带有复杂混淆的自动化利用程序。

**项目地址:** [https://github.com/user-attachments/assets/d7108e72-ffc5-464d-9666-8278d196d29d](https://github.com/user-attachments/assets/d7108e72-ffc5-464d-9666-8278d196d29d)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-66516](https://nvd.nist.gov/vuln/detail/CVE-2025-66516)
