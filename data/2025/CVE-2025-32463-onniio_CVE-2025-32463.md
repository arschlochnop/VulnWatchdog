## CVE-2025-32463 - Sudo 权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 至 1.9.17(不含 1.9.17p1)

**利用条件:** 本地用户权限，系统中启用了 sudo 且支持 -R (--chroot) 选项

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该漏洞是由于 Sudo 在处理 -R 或 --chroot 选项时存在逻辑缺陷。当使用该选项时，Sudo 会切换根目录到用户指定的路径，但在执行提权操作期间，由于动态链接器（ld.so）在处理 NSS（Name Service Switch）插件加载时，会根据 chroot 环境内的 /etc/nsswitch.conf 配置文件来寻找库文件。攻击者可以通过创建一个恶意的 chroot 目录，并在其中伪造 /etc/nsswitch.conf 和惡意的共享对象文件（如 libnss_xxx.so.2），从而在 Sudo 以 root 权限运行并尝试加载 NSS 插件时，诱导其加载并执行攻击者的恶意代码。本 POC 通过 Docker 模拟了受影响的 Sudo 1.9.16p2 环境，并提供了一个名为 sudo-cherrooe.sh 的脚本。该脚本自动化了整个利用流程：首先使用 gcc 编译一个带有 constructor 属性的恶意共享库，该库会在加载时立即执行 setreuid(0,0) 并启动 /bin/sh；接着配置一个包含指向该恶意库路径的 nsswitch.conf 文件的伪造 chroot 环境；最后通过执行 'sudo -R [路径] [命令]' 触发漏洞。经分析，该 POC 逻辑清晰，完全符合漏洞原理，能够实现在受影响版本上的本地提权。利用步骤：1. 在受影响系统中下载并准备 POC 脚本。2. 创建一个临时工作目录。3. 编写 C 代码并编译为 libnss_ 兼容的动态库，代码中应包含提权指令。4. 构造 chroot 结构，创建 etc 子目录并写入伪造的 nsswitch.conf，指定特定的 NSS 服务。5. 将编译好的 .so 文件放置在 chroot 环境对应的库搜索路径中。6. 调用 sudo -R 指向该目录执行任意命令。7. 成功获取 root 权限的 shell。投毒风险分析：该 POC 代码透明度高，主要由 Dockerfile、Bash 脚本和嵌入的 C 代码组成。代码逻辑直接针对漏洞验证，未使用任何混淆手段。脚本中的 setreuid(0,0) 等操作是提权漏洞验证的标准行为，而非恶意后门。在 Dockerfile 中使用了标准的官方 Ubuntu 镜像，安装的依赖包均为编译必须的 build-essential 和 sudo 依赖，未见从异常地址下载二进制文件或执行远程脚本的行为。唯一的外部链接是 sudo 官方网站提供的源码包。脚本中清理了临时工作目录，符合良性研究工具的特征。因此，该 POC 投毒风险极低，仅约为 10%，这部分风险主要来源于用户在生产环境运行未经审核的脚本可能导致系统配置受损。防御建议：组织应立即升级 Sudo 至 1.9.17p1 或更高版本。作为临时规避措施，可以通过配置限制普通用户使用 sudo 的 -R 选项，或通过安全策略（如 SELinux/AppArmor）限制 sudo 对异常目录下库文件的加载行为。

**项目地址:** [https://github.com/errooe/CVE-2025-32463-PoC](https://www.google.com/search?q=https://github.com/errooe/CVE-2025-32463-PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
