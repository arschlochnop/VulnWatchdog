## CVE-2025-2304 - Camaleon CMS 权限升级 / 大规模赋值 (Privilege Escalation / Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限升级 / 大规模赋值 (Privilege Escalation / Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危：已认证的普通用户可以利用此漏洞将自身权限提升至管理员，从而可能获得对系统的完全控制。

**CVSS评分:** N/A

**影响版本:** < 2.9.1

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

提供的Python POC脚本 `exploit.py` 能够有效利用 Camaleon CMS 中的 CVE-2025-2304 权限升级漏洞。该漏洞源于 `UsersController` 中 `updated_ajax` 方法的不安全大规模赋值（Mass Assignment），它错误地使用了 `permit!` 函数，导致在处理用户资料更新请求时未能有效过滤参数。攻击者可以通过向此接口注入额外参数来修改不应由用户控制的属性，从而实现权限升级。

`exploit.py` 脚本的利用流程如下：
1.  **参数解析与初始化**: 脚本启动时，接收命令行参数，包括目标 Camaleon CMS 的URL、一个已注册用户的用户名和密码。它首先确保URL以斜杠结尾，以便正确构建后续请求路径。
2.  **建立会话与登录**: 脚本创建一个 `requests` 会话对象，用于保持HTTP连接和cookies，模拟真实用户的浏览行为。它首先向 `/admin/login` 页面发起GET请求，解析返回的HTML内容，以提取表单中名为 `authenticity_token` 的CSRF令牌。这个令牌是进行POST登录请求所必需的。随后，脚本构建一个POST请求，包含用户提供的用户名、密码和获取到的 `authenticity_token`，发送到 `/admin/login` 接口进行认证。如果认证成功，会话中将保留相应的认证cookie。
3.  **获取CSRF令牌与更新接口URL**: 认证成功后，脚本接着向 `/admin/profile/edit` 页面发起GET请求。此步骤的目的是从用户个人资料编辑页面的HTML中提取两个关键信息：
    *   页面 `<meta>` 标签中名为 `csrf-token` 的令牌。这是进行后续敏感操作（如更新用户资料）所需的另一个安全令牌。
    *   名为 `profie-form-ajax-password` 的表单的 `action` 属性值。这个URL指示了用户密码及其他资料更新的 AJAX 接口。脚本会从相对路径中提取出绝对路径。
4.  **构造权限升级请求**: 这是利用漏洞的核心步骤。脚本根据之前获取的信息，构造一个HTTP PATCH请求。请求的目标URL是步骤3中获取到的更新接口URL。请求体（`data`）中包含以下关键参数：
    *   `_method: patch`: 这是一个用于Ruby on Rails框架的特殊参数，指示后端将此POST请求视为一个PATCH请求。
    *   `authenticity_token`: 步骤3中从个人资料编辑页面获取的 `csrf-token`。
    *   `password[password]`: 用户当前或新的密码。
    *   `password[password_confirmation]`: 密码确认。
    *   `password[role]`: **这是漏洞利用的关键点**。脚本将此参数值硬编码为 `admin`。由于Camaleon CMS的 `updated_ajax` 方法存在Mass Assignment漏洞，它会处理这个本不应由普通用户修改的 `role` 字段，并将其值更新到数据库中。
5.  **发送与验证**: 脚本将上述构造好的PATCH请求发送到 Camaleon CMS 服务器。如果服务器响应的HTTP状态码为 200 OK，脚本则认为漏洞利用成功，并提示用户重新登录以验证权限升级结果。这表明系统已接受并处理了带有 `admin` 角色的更新请求。

通过上述步骤，POC脚本成功地利用了Mass Assignment漏洞，将一个普通认证用户的权限提升至管理员级别。该POC的代码逻辑清晰，步骤完整，验证了CVE-2025-2304的真实性和可利用性。

**投毒风险分析**:
针对 `exploit.py` 脚本的投毒风险评估为低（约 5%）。此评估基于对脚本源代码的全面审查，重点关注其引入潜在恶意行为的可能性。

首先，该脚本完全由Python编写，并仅依赖两个广泛使用且经过充分审查的标准第三方库：`requests` 和 `BeautifulSoup`。`requests` 库是Python中进行HTTP通信的事实标准，而 `BeautifulSoup` 则是一个用于解析HTML和XML的流行库，两者均以其稳定性和安全性而闻名。脚本中没有使用任何非标准的、晦涩的或需要编译的外部二进制文件。所有导入的模块都是Python社区信任的组件。

其次，脚本的逻辑结构非常清晰和直接。其唯一且明确的目标是利用 CVE-2025-2304 漏洞实现权限升级。它通过一系列HTTP请求（GET、POST、PATCH）来模拟用户交互，解析HTML以提取CSRF令牌，并最终构造带有 `password[role]=admin` 参数的请求。整个过程的每一步都在代码中透明地展现，没有发现任何代码混淆、加密或动态生成代码的行为（例如，使用 `eval()`、`exec()` 或 `compile()` 函数来执行来自外部或不信任源的代码）。

此外，脚本没有包含任何可疑的网络通信行为。除了与目标 Camaleon CMS 服务器进行正常的HTTP交互以执行漏洞利用流程外，它不向任何其他外部域、IP地址或未知服务发起连接请求。这意味着脚本不会暗中向攻击者控制的服务器发送敏感信息、下载额外的恶意载荷或参与DDoS等活动。

脚本中也没有发现任何系统级操作的痕迹，例如尝试执行操作系统命令（如 `os.system()`、`subprocess.run()` 等）、读写任意文件、修改系统配置或安装持久性机制。它严格局限于HTTP协议层面的交互，并且其操作结果仅限于修改目标CMS内部的用户权限数据。

最后，POC的 `README.md` 文件明确指出“This exploit is provided for educational and research purposes only.”，这与代码的干净特性相符，进一步降低了其作为投毒载体的风险认知。

综上所述，`exploit.py` 脚本是一个干净、透明且专注于其声明目的的漏洞利用工具。对于安全研究人员和防御团队而言，在受控环境中对其进行分析和测试，其潜在的投毒风险极低。建议始终在隔离的虚拟机或容器环境中运行任何POC代码，即使其风险评估为低，以确保最大的安全性。

**项目地址:** N/A

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-2304
