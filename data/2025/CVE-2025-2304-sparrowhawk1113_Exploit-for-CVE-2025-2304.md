## CVE-2025-2304 - Camaleon CMS 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Camaleon CMS

**危害等级:** 高 (High)

**CVSS评分:** 

**影响版本:** Prior to 2.9.1

**利用条件:** 需要认证, 需要网络访问

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-2304 披露了 Camaleon CMS 中存在的权限提升漏洞，该漏洞源于不安全的批量赋值（Mass Assignment）。具体来说，Camaleon CMS 的 UsersController 中的 `updated_ajax` 方法使用了 `permit!` 函数，导致在处理用户参数时缺乏充分的过滤。这意味着一个已经过身份验证的恶意用户可以滥用此功能，通过修改受限制的用户属性（如 `role` 字段）来提升其权限，从而获得管理员权限。

**POC有效性分析：**
提供的 Python 脚本 `exploit.py` 是一个功能完整且结构良好的概念验证代码，能够有效复现和利用 CVE-2025-2304 漏洞。该脚本遵循了攻击者利用此漏洞的逻辑步骤：

1.  **参数解析与初始化：** 脚本首先使用 `argparse` 模块接收目标 Camaleon CMS 的 URL、有效用户名和密码作为输入，确保了必要的运行参数已提供。
2.  **会话管理与登录：** `exploit.py` 创建了一个 `requests.Session()` 对象来维护 HTTP 会话，这对于在多次请求中保持认证状态至关重要。它首先向 `/admin/login` 发送 GET 请求，从登录页面的 HTML 内容中解析出 `authenticity_token`（CSRF 令牌）。随后，它使用该令牌和用户提供的凭据向 `/admin/login` 发送 POST 请求以完成身份验证。
3.  **二次CSRF令牌获取：** 登录成功后，脚本接着向 `/admin/profile/edit` 发送 GET 请求，访问用户个人资料编辑页面。在此页面中，它从 `<meta name="csrf-token">` 标签中提取一个新的 CSRF 令牌，并解析出用于密码更新表单 (`profie-form-ajax-password`) 的 `action` URL。这个 URL 通常指向 `UsersController` 中处理用户资料更新的 `updated_ajax` 方法。
4.  **权限提升核心：** 这是漏洞利用的关键步骤。脚本构造了一个 `PATCH` 请求，将其发送到第三步中获取的 `updated_ajax` URL。在请求的 POST 数据中，除了更新用户密码的相关字段外，脚本故意包含了 `"password[role]": "admin"`。由于 Camaleon CMS 中 `updated_ajax` 方法的不安全实现（使用了 `permit!` 导致对参数的过滤不足），它会允许直接修改 `role` 属性，从而将当前已认证用户的角色提升为管理员。
5.  **结果验证：** 脚本最后检查服务器响应的状态码是否为 `200`。如果请求成功，它会输出成功的消息，并建议用户重新登录以验证权限提升效果。

综合来看，该 POC 脚本精确地模拟了漏洞的利用过程，并成功实现了已认证用户的权限提升。代码逻辑清晰，易于理解，且不依赖任何外部工具或非标准库（除了 `requests` 和 `BeautifulSoup4`）。

**利用步骤：**
1.  **环境准备：** 确保您的系统已安装 Python 3 和必要的库：`requests` 和 `BeautifulSoup4`。您可以使用 `pip install requests beautifulsoup4` 进行安装。
2.  **获取POC：** 保存 `exploit.py` 代码到本地文件系统。
3.  **确定目标：** 识别一个运行着易受攻击的 Camaleon CMS 版本（2.9.1 之前的版本）的目标网站。
4.  **获取凭据：** 拥有目标 Camaleon CMS 上任意一个已注册用户的有效登录凭据（即使是低权限用户）。
5.  **执行攻击：** 打开终端，导航到 `exploit.py` 所在的目录，然后运行以下命令，替换占位符为实际的目标 URL、用户名和密码：
    ```bash
    python exploit.py --url http://target-camaleon-cms.com --username [您的用户名] --password [您的密码]
    ```
6.  **验证结果：** 脚本执行成功后，会提示“Exploit successful. You can relogin to the user to see results”。此时，请登出 Camaleon CMS，然后使用您在步骤5中提供的相同用户名和密码重新登录。您会发现该账户已拥有管理员权限。

**投毒风险分析：**
针对提供的 `exploit.py` 脚本，其投毒风险评估为极低（约 5%）。分析如下：

1.  **代码透明度与可读性：** 脚本代码清晰、结构化良好，没有进行任何形式的代码混淆或加密处理。这使得安全研究人员和开发人员能够轻松地审查其内部逻辑，识别任何潜在的恶意行为。代码中所有的操作都直接可读且易于理解。
2.  **标准库的使用：** 脚本完全依赖于 Python 的标准库 (`argparse`) 以及广泛使用且经过充分审计的第三方库 (`requests` 和 `BeautifulSoup4`)。这些库都是 Python 生态系统中常用的工具，没有迹象表明它们被以非预期的方式滥用或包含恶意修改。脚本中未发现使用 `eval()`、`exec()` 等可能执行任意代码的危险函数。
3.  **无外部资源加载：** 脚本在执行过程中没有尝试从外部 URL 下载或加载任何额外的代码、二进制文件或配置文件。所有执行逻辑都完全封装在 `exploit.py` 文件内部，避免了动态引入恶意内容的风险。
4.  **行为范围受限：** 脚本的唯一目标是利用 Camaleon CMS 的特定漏洞来实现已认证用户的权限提升，即将 `role` 属性从普通用户修改为管理员。它不包含任何超出此范围的恶意功能，例如安装后门、创建秘密管理员账户（除了提升现有账户）、窃取本地敏感信息、发起对其他系统的网络扫描或攻击、连接到未知C2服务器等。
5.  **无持久化机制：** 脚本执行完成后，不会在目标系统上留下任何持久化的恶意组件或配置更改，除了被修改的账户角色属性。它也不会在运行脚本的本地机器上安装任何恶意软件或进行系统级别的修改。

**结论：** 鉴于上述分析，该 POC 脚本被认为是“清洁”的，不包含明显的恶意载荷或投毒行为。其代码目的明确，仅用于演示和验证 CVE-2025-2304 漏洞。尽管如此，作为最佳安全实践，任何来源的 POC 代码在生产环境中使用前都应进行独立的审查和沙箱测试。

**项目地址:** N/A

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-2304
