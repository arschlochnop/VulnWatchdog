## CVE-2025-2304 - Camaleon CMS 权限提升 (不安全的大规模赋值)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (不安全的大规模赋值)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** 未指定

**利用条件:** 需要认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

提供的Python脚本是一个功能完整的概念验证 (Proof-of-Concept, POC)，用于演示和利用CVE-2025-2304漏洞，该漏洞影响Camaleon CMS。此漏洞被描述为一个权限提升缺陷，源于`UsersController`中`updated_ajax`方法的不安全大规模赋值（unsafe mass assignment）。该方法使用了`permit!`函数，导致未经筛选的参数被处理。攻击者可以通过利用此弱点，修改受限属性，从而提升已认证用户的权限。

**POC有效性分析**
POC的执行流程清晰且有效，遵循了Web应用权限提升漏洞利用的典型步骤：
1.  **初始化与参数解析**: 脚本首先通过`argparse`库解析命令行参数，包括目标Camaleon CMS的URL、一个已注册用户的用户名和密码。它还包含了一个简单的URL格式校验，以确保`base_url`的正确性。
2.  **认证阶段**: POC首先向`/admin/login`端点发起一个HTTP GET请求，以获取HTML页面中的`authenticity_token`（即CSRF令牌），该令牌通过`BeautifulSoup`库进行解析提取。随后，脚本使用提取到的令牌和用户提供的凭证，向`/admin/login`发送一个HTTP POST请求以完成用户认证。`requests.Session()`被用于维持会话状态，确保后续请求能够携带有效的认证cookie。
3.  **权限提升准备**: 认证成功后，脚本接着向`/admin/profile/edit`端点发起GET请求。此步骤的目的是从页面中提取新的CSRF令牌（通常位于`<meta name="csrf-token">`标签中）以及用户个人资料更新表单（`id="profie-form-ajax-password"`）的`action` URL。这个`action` URL指向了包含漏洞的`updated_ajax`方法。
4.  **漏洞利用（大规模赋值）**: 漏洞利用的核心在于向获取到的`updated_ajax` URL发送一个特制的HTTP POST请求。请求的`data`负载中包含了`_method: "patch"`、新的`authenticity_token`、用户的当前密码和确认密码（可能为满足CMS验证要求），以及最关键的`password[role]: "admin"`。由于CMS在处理`updated_ajax`方法时存在不安全的大规模赋值漏洞，它未能正确过滤传入的参数，从而允许攻击者通过`password[role]: "admin"`直接将当前用户的角色设置为管理员，实现权限提升。
5.  **结果验证**: 脚本通过检查最终请求的HTTP响应状态码是否为200来判断利用是否成功。如果成功，则输出提示信息，建议用户重新登录以确认权限。

该POC代码编写规范，逻辑明确，充分利用了Python的`requests`和`BeautifulSoup`库，能够有效地复现和验证Camaleon CMS中的权限提升漏洞。

**利用步骤**
1.  **环境准备**: 确保您的Python环境中已安装`requests`和`BeautifulSoup4`库。如果没有，可以通过`pip install requests beautifulsoup4`命令进行安装。
2.  **获取POC**: 将提供的`exploit.py`代码保存到本地文件。
3.  **执行命令**: 在命令行中执行以下命令，替换`<TARGET_URL>`为您的Camaleon CMS目标地址，`<USERNAME>`和`<PASSWORD>`为已存在的低权限用户凭证：
    `python exploit.py --url <TARGET_URL> --username <USERNAME> --password <PASSWORD>`
    例如：`python exploit.py --url http://192.168.1.100/camaleon --username testuser --password testpass`
4.  **观察结果**: 脚本将尝试登录并执行权限提升操作。如果成功，将输出`Exploit sucessfull. You can relogin to the user to see results`。此时，使用原有的`<USERNAME>`和`<PASSWORD>`重新登录Camaleon CMS，该用户将拥有管理员权限。

**投毒风险分析**
对提供的POC代码`exploit.py`进行详细分析后，可以评估其投毒风险为**极低 (5%)**。以下是具体的评估依据：
1.  **代码清晰度与可读性**: 脚本代码结构清晰，逻辑简单直接，无任何形式的代码混淆、加密或动态生成代码的行为。每一行代码的功能意图都十分明确，易于安全研究人员进行代码审计和理解。这种透明性是评估低风险的关键指标。
2.  **依赖库的安全性**: POC仅依赖于两个标准且广泛使用的Python库：`requests` (用于HTTP请求) 和 `BeautifulSoup` (用于HTML解析)。这两个库在Python社区中享有高度的声誉，并经过了大量开发者的使用和安全审计。脚本中没有引入任何不常见的、来源不明的或已知的有安全问题的第三方库，从而避免了通过依赖链引入恶意代码的风险。
3.  **无外部回调或额外负载**: POC代码的主要功能是执行认证、令牌获取和权限提升操作，所有网络请求都明确指向用户指定的目标Camaleon CMS URL。代码中没有发现任何对第三方外部域名（C2服务器）、IP地址或未知资源的连接尝试。这意味着它不会在后台下载额外的恶意payload、上报敏感信息、执行远程控制指令或进行其他未授权的网络通信。
4.  **无持久化机制或系统修改**: 该POC设计为一次性执行，以达成权限提升的目的。它不包含任何在目标系统上建立持久化后门、修改系统配置、写入文件（除可能的session cookie外）、创建新用户（目标CMS除外）或执行其他可能导致系统状态永久性改变的操作。其影响仅限于修改目标CMS数据库中的用户角色。
5.  **无动态代码执行**: 脚本中没有使用`eval()`、`exec()`等可能导致任意代码执行的函数，也没有复杂的反射机制或插件加载逻辑。所有操作都是基于预定义的字符串和标准库函数进行，极大地降低了隐藏恶意代码的复杂性和可能性。
综上所述，该POC代码是纯粹的功能性利用脚本，旨在验证和复现Camaleon CMS中的权限提升漏洞。它完全符合其声明的“教育和研究目的”，没有发现任何恶意、可疑或难以理解的行为。因此，其对运行环境本身造成危害的投毒风险可以认定为极低。在进行漏洞复现或测试时，通常建议在隔离的测试环境中运行，但这更多是出于安全最佳实践的考虑，而非针对此特定POC代码的潜在恶意性。

**项目地址:** 未提供

**漏洞详情:** 未提供
