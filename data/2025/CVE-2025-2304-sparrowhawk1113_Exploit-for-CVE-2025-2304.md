## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (已认证用户), 需要网络访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

CVE-2025-2304 指出 Camaleon CMS 存在一个严重的权限提升漏洞，其根源在于不安全的Mass Assignment（批量赋值）机制。具体来说，当用户尝试修改其配置文件时，`UsersController` 中的 `updated_ajax` 方法错误地使用了 `permit!` 函数，导致未能对传入的参数进行充分过滤。这使得一个已认证的低权限用户能够通过提交包含 `password[role]: "admin"` 的恶意请求，将自己的账户角色直接提升为管理员。

**POC有效性分析**
提供的Python POC脚本 `exploit.py` 对此漏洞的利用进行了精准的复现。该脚本利用 `requests` 库处理HTTP通信，并结合 `BeautifulSoup` 进行HTML解析以提取必要的认证令牌。其利用流程设计巧妙且符合实际攻击场景：
1.  脚本首先创建一个持久化的 `requests` 会话，以维持登录状态和处理cookie。
2.  它向 `/admin/login` 发送GET请求，解析HTML以获取CSRF令牌（`authenticity_token`），这是后续POST请求所必需的。
3.  接着，脚本使用提供的用户名、密码和获取到的令牌，向 `/admin/login` 发送POST请求以完成用户认证。
4.  成功登录后，脚本访问 `/admin/profile/edit` 页面。在此页面中，它再次解析HTML，以获取用于个人资料更新的CSRF令牌（`csrf-token`）以及动态生成的 `updated_ajax` 接口的URL。
5.  攻击的核心在于向 `updated_ajax` 接口发送一个精心构造的PATCH请求。此请求的表单数据中，除了包含合法的新密码和确认密码外，还巧妙地注入了 `password[role]: "admin"` 参数。如果目标Camaleon CMS版本存在漏洞，即 `permit!` 函数未能正确筛选此 `role` 参数，那么CMS将处理此参数并将用户的角色更新为管理员。
6.  脚本通过检查HTTP响应状态码是否为 `200 OK` 来判断攻击是否成功。整个流程自动化程度高，逻辑清晰，完全模拟了攻击者手动利用此漏洞的步骤。鉴于Mass Assignment漏洞在Ruby on Rails应用中的常见性和该脚本的精确实现，此POC被认为是高度有效的，并且能够在受影响的Camaleon CMS版本上成功实现权限提升。

**利用步骤**
1.  **环境准备**：确保目标Camaleon CMS的版本低于2.9.1。获取一个有效但权限较低的Camaleon CMS用户账户的用户名和密码。
2.  **执行POC**：在终端中运行提供的Python脚本 `exploit.py`，并传入目标CMS的完整URL、已认证的用户名和密码。命令示例：`python exploit.py --url https://target-cms.com --username lowprivuser --password yourpassword`。
3.  **脚本操作**：脚本会自动执行登录、获取CSRF令牌、访问个人资料编辑页面以及发送恶意批量赋值请求等步骤。
4.  **验证结果**：如果脚本执行成功，将打印“Exploit sucessfull. You can relogin to the user to see results”。此时，可以使用原先的用户名和密码重新登录Camaleon CMS。重新登录后，该用户应已获得管理员权限，可以访问和执行管理员独有的功能。

**投毒风险分析**
对提供的POC代码进行全面分析后，可以得出结论：其投毒风险极低（0%）。该Python脚本展现出高度的透明度和清洁性，其行为完全专注于利用CVE-2025-2304描述的权限提升漏洞，不包含任何恶意或可疑的附加功能。具体分析如下：
*   **代码透明度**：脚本代码完全是明文的Python，没有经过任何混淆、加密或打包处理，方便安全研究人员进行审计和理解。代码逻辑直接、易懂，每一步操作都清晰可见。
*   **依赖库安全**：脚本仅依赖于三个标准的Python库：`requests` (用于HTTP请求)、`argparse` (用于命令行参数解析) 和 `BeautifulSoup` (用于HTML解析)。这些库都是Python生态系统中的成熟、广泛使用且经过严格审查的组件，本身不包含已知的恶意功能。
*   **无外部资源加载**：脚本内部没有发现任何尝试从外部URL下载、执行额外代码或二进制文件的行为，这有效避免了通过动态加载恶意载荷的风险。
*   **无文件系统操作**：除了正常的程序执行和可能的临时文件（由Python解释器或操作系统生成）外，脚本不进行任何非预期的文件创建、修改、删除或访问敏感文件系统路径的操作。
*   **无敏感信息泄露**：脚本的目的在于利用漏洞，而不是窃取本地系统信息。代码中没有发现收集用户环境数据、系统配置、凭据或其他敏感信息并尝试外发给第三方服务器的行为。
*   **网络通信纯粹**：脚本的所有网络通信都定向到用户通过 `--url` 参数指定的目标Camaleon CMS服务器。没有与任何其他未声明的、可疑的或已知的恶意IP地址/域名进行通信。
*   **本地执行路径**：该POC代码是从本地 `/tmp/vulnwatchdog_ea5951e461483666af1ffe613aa821c9/` 路径下获取的，这表明它可能是一个经过下载和解压的分析包的一部分，而非直接从不可信的公共源动态获取，进一步降低了在下载过程中被篡改的风险。
综上所述，该POC代码是安全且专门用于漏洞复现和验证的工具，不存在任何恶意投毒的风险。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
