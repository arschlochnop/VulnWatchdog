## CVE-2025-2304 - Camaleon CMS 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Camaleon CMS

**危害等级:** 高 (High)

**CVSS评分:** N/A

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (Authenticated Access), 需要网络访问 (Network Access)

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中 (Medium)

**投毒风险:** 5%

## 详情

CVE-2025-2304披露了Camaleon CMS中存在的一个严重的权限提升漏洞，具体表现为通过不安全的质量赋值（Mass Assignment）实现。该漏洞存在于`UsersController`的`updated_ajax`方法中，此方法不当使用了`permit!`函数。`permit!`函数在Ruby on Rails应用中被设计用于允许所有参数通过而无需过滤，这在特定上下文中是为了灵活性，但在处理用户可控输入时，如修改用户角色等敏感属性时，会导致严重的安全风险。攻击者一旦通过有效凭据登录系统，即使是低权限用户，也可以利用此漏洞修改自身的用户角色属性，将其提升至管理员（admin）权限，从而完全控制CMS系统。

**POC有效性分析及利用步骤：**
提供的Python POC脚本`exploit.py`是一个高效且功能完整的利用工具，它精确地复现了CVE-2025-2304描述的权限提升过程。该脚本基于`requests`库进行HTTP通信，并利用`BeautifulSoup`库解析HTML内容，以提取必要的CSRF令牌。其利用流程清晰且自动化：
1.  **参数解析与初始化：** 脚本首先通过`argparse`解析命令行参数，包括目标Camaleon CMS的URL、一个有效的用户名和密码。它还确保了URL的正确格式。
2.  **获取认证令牌：** 脚本向目标CMS的`/admin/login`页面发起GET请求，以获取`authenticity_token`。这是Rails应用中防止CSRF攻击的关键令牌，但在利用Mass Assignment时，攻击者需要获取此令牌才能成功提交请求。
3.  **用户认证：** 接下来，脚本使用获取到的`authenticity_token`以及用户提供的用户名和密码，向`/admin/login`页面发送POST请求以完成用户登录。成功登录后，脚本会保持会话（session）以便后续操作。
4.  **获取CSRF令牌与更新URL：** 脚本随后向`/admin/profile/edit`页面发起GET请求。此步骤的目的是获取用于个人资料更新表单的`csrf-token`（通常在meta标签中）以及`updated_ajax`方法的实际操作URL，该URL通常动态生成。
5.  **权限提升攻击：** 最关键的一步是向`updated_ajax`端点发送POST请求。该请求中除了包含必要的`_method`（patch）、`authenticity_token`、用户的当前密码和确认密码外，还恶意注入了`"password[role]": "admin"`参数。由于目标CMS的`updated_ajax`方法不当使用了`permit!`函数，它会无差别地处理所有提交的参数，包括`role`。因此，即使是非管理员用户，其角色也会被成功修改为“admin”。
6.  **结果验证：** 脚本通过检查HTTP响应状态码（200 OK）来判断攻击是否成功。若为200，则打印成功信息，指示用户重新登录以验证权限。

该POC脚本的逻辑严谨，成功模拟了浏览器行为，并精准地利用了Mass Assignment漏洞。它是一个开箱即用的工具，能够可靠地展示此漏洞的实际影响。

**投毒风险分析：**
针对CVE-2025-2304的POC脚本`exploit.py`在投毒风险评估方面，被认定为具有非常低的风险（5%）。这一判断基于对脚本源代码的全面审查，以及对其所使用的库和操作行为的深入理解。

首先，脚本的源代码是完全公开且可读的，没有进行任何形式的代码混淆。这种透明性使得任何具备基本Python知识的安全研究人员或开发人员都能够轻松审查其内部逻辑。代码清晰地展示了其与Camaleon CMS交互的每一个步骤，从登录、获取令牌到最终发送权限提升请求，所有操作都直接对应于漏洞的利用原理，没有隐藏或难以理解的模块。

其次，该脚本仅使用了Python标准生态系统中广泛信任且经过充分审查的第三方库：`requests`、`argparse`和`BeautifulSoup`。`requests`是Python中最流行的HTTP客户端库，以其健壮性和安全性著称；`argparse`是标准库的一部分，用于解析命令行参数；`BeautifulSoup`是一个用于解析HTML和XML文档的流行库，主要用于数据提取。这些库本身不包含任何已知恶意功能，且在网络安全领域被广泛用于合法的测试和分析工作。脚本通过这些库进行的网络通信也仅限于目标Camaleon CMS，没有发现任何向未知或可疑外部地址发起连接的尝试，也没有下载或执行外部脚本或二进制文件的指令。

此外，脚本的逻辑只专注于实现漏洞的利用，即通过特定的HTTP请求将用户的角色从低权限提升到管理员权限。它不包含任何额外的、与权限提升无关的功能，例如文件读写、系统命令执行、恶意软件安装、加密操作或数据外泄尝试。脚本的输入（URL、用户名、密码）也只用于其预期目的，即与目标CMS进行认证和交互，并未发现滥用这些输入进行其他恶意活动的代码。

最后，脚本的输出也仅限于指示攻击成功或失败的消息，没有生成任何可疑文件、修改系统配置或留下难以察觉的后门。其设计目标是作为概念验证或自动化利用工具，而非持续性威胁或隐蔽攻击手段。因此，只要该POC脚本是从可信来源获取，并在受控环境中进行安全研究，其自身携带的恶意或投毒风险极低。防御者可以放心地分析和研究此POC，以理解漏洞机制并加强防御措施，而无需过多担心POC本身带来额外的安全隐患。

**项目地址:** N/A

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
