## CVE-2025-54424 - 1Panel Agent 远程命令执行(RCE)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 远程命令执行(RCE)

**影响应用:** 1Panel Agent

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** 1Panel v2版本引入的Core-Agent架构，版本小于等于v2.0.5

**利用条件:** 无需认证，需要网络访问，通过伪造客户端TLS证书绕过服务端验证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-54424 是一个针对 1Panel 开源服务器运维面板的远程命令执行漏洞。该漏洞存在于 1Panel v2 版本引入的 Core-Agent 架构中，具体表现为 Core-Agent 节点与主节点之间的 TLS 证书校验逻辑存在缺陷。在进行 HTTPS 通信时，系统使用了 `tls.RequireAnyClientCert` 进行证书校验，但仅简单检查了客户端证书的 Common Name (CN) 是否为预设值（如 'panel_client'），而未进行完整的证书链验证或有效性检查。这使得攻击者能够动态生成一个 CN 匹配的自签名证书，从而绕过服务器的身份验证机制，建立起看似合法的 HTTPS 和 WebSocket 连接，进而向 Agent 下发恶意指令，最终在目标服务器上实现远程代码执行。

**POC有效性分析:**
提供的 Python POC 代码 (`CVE-2025-54424.py`) 是一个功能完善且高度可用的利用工具。该代码首先利用 `cryptography` 库动态生成一个符合要求的自签名 TLS 客户端证书和私钥，其中 Common Name (CN) 被设置为 `panel_client`。这一步骤是成功绕过 1Panel Agent 证书验证的关键。接着，POC 分为两步进行攻击：第一步是 HTTP 预检，它使用伪造的证书向目标 Agent 的 `/api/v2/dashboard/base/os` 接口发送 HTTPS GET 请求。如果该请求成功返回 200 状态码，则表明证书绕过成功且 Agent 处于可利用状态。第二步，POC 会使用同样的伪造证书建立 WebSocket 连接。一旦 WebSocket 连接成功建立，POC 就可以通过预设的接口（如 `execute_command` 函数所示）向 Agent 发送任意命令，并在目标服务器上执行，从而实现远程代码执行。代码结构清晰，支持多线程并发扫描、代理设置以及临时文件的自动清理，展现了较高的工程质量和可靠性。其功能完整性、易用性和稳定性使其在实际渗透测试和安全研究中具有很高的价值。

**利用步骤:**
1. **目标识别**: 攻击者需要识别运行 1Panel v2.0.5 或更早版本，并启用了 Core-Agent 架构的服务器。这些服务器通常会在某个端口（如默认的 23333）监听 Agent 服务。
2. **证书伪造**: 攻击者使用提供的 POC 工具，该工具会自动生成一个 Common Name (CN) 为 'panel_client' 的自签名 TLS 客户端证书和对应的私钥。这个证书是绕过 1Panel Agent 弱验证机制的关键。
3. **HTTP预检**: POC 使用生成的伪造证书向目标 Agent 的 HTTPS `/api/v2/dashboard/base/os` 接口发送 GET 请求。如果服务器接受该证书并返回 200 OK 状态码，则确认目标存在漏洞且证书绕过成功。
4. **WebSocket连接**: 一旦预检成功，POC 会利用相同的伪造证书建立一个安全的 WebSocket 连接到目标 Agent。这个 WebSocket 连接将被 Agent 视为一个合法的客户端会话。
5. **命令执行**: 通过建立的 WebSocket 连接，攻击者可以向 Agent 发送特定的 JSON 格式指令，包含任意的系统命令。Agent 在接收到这些指令后，会在其运行的主机上执行这些命令，从而实现远程代码执行，例如获取反弹 Shell、植入恶意程序、修改系统配置等。

**投毒风险分析:**
提供的 POC 代码 `CVE-2025-54424.py` 的投毒风险评估为低（约5%）。经过对代码的详细审查，未发现任何恶意或可疑的行为迹象。该代码完全由 Python 编写，并主要依赖于标准的 Python 库，如 `os`、`sys`、`json`、`tempfile`、`argparse`，以及常见的第三方库 `requests`、`websocket-client` 和 `cryptography`。这些库都是在安全研究和网络通信中广泛使用的，并且代码对它们的调用方式是透明且符合预期的。代码逻辑清晰，所有功能模块，包括动态生成证书 (`generate_self_signed_cert`)、执行 HTTP 请求 (`check_target`)、建立 WebSocket 连接和发送命令 (`execute_command`)，都直接明了地展示了其实现过程。代码中没有发现任何形式的代码混淆、动态加载外部未知脚本、使用 `eval()` 函数处理非信任数据或进行其他隐秘操作的行为。`execute_command` 函数的目的是为了演示漏洞的远程代码执行能力，而不是在 POC 本身中嵌入恶意载荷。此外，POC 在完成后会妥善清理其生成的临时证书文件，进一步证明其是为合法的安全测试目的而设计。因此，该 POC 被判定为安全、可靠，适用于安全研究人员和组织进行漏洞验证和防御测试，不带有额外恶意负载的风险。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
