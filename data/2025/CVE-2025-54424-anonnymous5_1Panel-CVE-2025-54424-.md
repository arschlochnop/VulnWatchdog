## CVE-2025-54424 - 1Panel 远程命令执行 (RCE), 证书验证绕过

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 远程命令执行 (RCE), 证书验证绕过

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H) - 基于漏洞性质推断

**影响版本:** 1Panel ≤ v2.0.5

**利用条件:** 无需认证 (可绕过证书验证), 需要网络访问, 目标需运行受影响的1Panel Agent服务。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析:
该POC是一个用Python编写的完整利用工具，旨在演示并利用CVE-2025-54424，即1Panel Agent的TLS证书验证绕过导致的远程命令执行（RCE）漏洞。根据搜索结果，该漏洞影响1Panel v2版本引入的Core-Agent架构，其节点间通信（HTTPS）在认证时使用了`tls.RequireAnyClientCert`策略。这意味着服务器仅要求客户端提供任何证书，而不验证其可信性或颁发者，从而允许攻击者使用自签名证书进行认证。

POC代码精准地利用了这一缺陷。首先，它动态生成了一个自签名的客户端证书和私钥，其中证书的`COMMON_NAME`被设置为`panel_client`，这可能是1Panel Agent在内部期望的身份标识。这一步骤使用了`cryptography`库，确保了生成的证书符合X.509标准且有效。

接下来，POC执行两步检测和利用流程。第一步是HTTP预检，通过向`https://<target_host>/api/v2/dashboard/base/os`发送带有伪造证书的GET请求。如果服务器返回200状态码，则初步判断目标可能存在漏洞。这一步验证了证书绕过是否成功建立了基础HTTPS连接，并且目标是可响应的1Panel实例。

第二步是实际的远程命令执行。POC通过WebSocket协议与目标建立连接，同样使用之前生成的自签名证书进行身份验证。一旦WebSocket连接建立，POC会构造一个JSON格式的命令请求，其中包含用户指定的命令（例如，反弹Shell或植入挖矿程序）。这个命令会通过WebSocket发送到1Panel Agent端执行。代码中清晰地展示了如何构建WebSocket请求头和消息体，以及如何处理WebSocket的回显，包括错误和成功信息。POC还支持多线程扫描多个目标，并能通过代理进行通信，这极大地增强了其在实际渗透测试中的可用性和效率。

综合来看，该POC代码结构清晰，逻辑严谨，直接针对漏洞的根本原因（弱证书验证），实现了从证书伪造、连接建立到命令执行的完整利用链。其功能完备性、错误处理和多功能性（如代理支持）都表明这是一个高质量、高有效性的利用工具。

利用步骤:
1.  **准备环境**: 确保Python环境已安装`requests`, `websocket-client`, `cryptography`等必要库。
2.  **目标识别**: 确定运行1Panel Agent且版本在v2.0.5及以下的目标服务器。
3.  **运行POC**: 
    *   使用`python CVE-2025-54424.py --target <目标IP或域名>`命令对单个目标进行漏洞检查。
    *   若要执行命令，可添加`--command "<待执行的命令>"`参数，例如：`python CVE-2025-54424.py --target 192.168.1.100 --command "id"`。
    *   POC会动态生成一个自签名的客户端证书和私钥。
    *   它首先尝试使用该伪造证书通过HTTPS对目标进行预检。
    *   如果预检成功，它将通过WebSocket连接发送命令。
    *   目标执行命令后，POC将显示命令的输出结果。
    *   对于批量扫描，可以使用`--file <目标列表文件>`参数，同时结合`--threads <线程数>`进行并发处理。
    *   攻击者还可以指定HTTP/HTTPS代理（`--proxy <代理地址>`）以隐藏踪迹或绕过网络限制。

投毒风险分析:
该POC代码的投毒风险评估为**低**，约为10%。主要基于以下几点分析：

1.  **代码透明度与可读性**: POC代码采用Python编写，结构清晰，逻辑简单明了，无任何混淆或加密。所有功能都直接在代码中实现，易于安全研究人员审计和理解其行为。
2.  **库依赖**: 代码主要依赖`requests`, `websocket-client`, `cryptography`, `tempfile`等标准或广泛使用的第三方库。这些库都是Python生态系统中被广泛信任和审计的组件。没有发现引入未知或可疑的外部依赖项。
3.  **核心功能**: POC的核心功能是生成自签名证书、建立HTTPS/WebSocket连接以及发送用户定义的命令。这些都是为了利用特定漏洞而设计的合法安全测试操作。
4.  **文件系统操作**: 代码确实会创建临时文件来存储生成的自签名证书和私钥（使用`tempfile.NamedTemporaryFile`）。这些临时文件在使用完毕后会被清理（`os.remove`），这是一种安全的文件处理方式，符合临时性凭证管理的最佳实践。虽然任何文件系统操作都可能引入潜在风险，但在此上下文中，其目的是明确且受控的，不构成恶意投毒行为。
5.  **网络行为**: 代码会向用户指定的目标主机发起网络请求，这是漏洞利用的固有行为。没有发现代码尝试连接除目标主机以外的任何其他未知或恶意域名。
6.  **无恶意荷载**: POC本身不包含任何恶意荷载（如挖矿程序、后门代码等），其执行的“恶意”行为完全取决于用户通过`--command`参数输入的指令。这意味着POC只是一个工具，其最终的攻击性质由使用者的意图决定。
7.  **无动态代码执行**: 除了发送用户提供的命令外，代码中没有发现`eval()`、`exec()`等可能被用于动态加载和执行外部恶意代码的危险函数，或从远程服务器下载并执行脚本的行为。

综上所述，该POC代码是为安全研究和漏洞验证目的而设计的，其行为透明且可控。虽然它是一个强大的RCE利用工具，但其自身并不包含恶意或投毒代码。风险主要存在于不法分子利用此工具对受害者系统进行攻击，而非工具本身携带的恶意负载。因此，在使用此类POC时，应始终保持警惕，并仅在授权的测试环境中使用。

**项目地址:** https://github.com/gmh5225/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
