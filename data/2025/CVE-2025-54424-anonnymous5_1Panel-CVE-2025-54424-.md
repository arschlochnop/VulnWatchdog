## CVE-2025-54424 - 1Panel 远程命令执行 (RCE)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** 1Panel ≤ v2.0.5

**利用条件:** 需要网络访问，无需认证（通过证书验证绕过），攻击者需伪造客户端证书（Common Name为'panel_client'）

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

此POC代码（CVE-2025-54424.py）是一个功能完备、高度有效的漏洞利用工具，用于检测并利用1Panel Agent的证书验证绕过远程命令执行漏洞（CVE-2025-54424）。该脚本使用Python编写，依赖于requests、websocket-client和cryptography等库，这些都是在网络安全领域广泛使用的标准库。

该POC的核心机制在于动态生成一个自签名的X.509客户端证书。根据漏洞描述，1Panel Agent在tls.RequireAnyClientCert模式下，仅要求客户端提供证书，但不验证其可信度或颁发机构，只要证书的Common Name (CN) 为“panel_client”即可通过验证。POC精确地实现了这一点，通过cryptography库生成了一个CN为“panel_client”的RSA私钥和配套证书，并将它们临时存储在文件中供后续使用。这种动态生成证书的方式确保了每次利用的灵活性和独立性。

利用流程分为两个主要阶段：
1.  **预检阶段（HTTP）**: POC首先通过HTTPS向目标`https://{target_host}/api/v2/dashboard/base/os`发送一个GET请求。这个请求携带了前面生成的自签名客户端证书。如果目标服务器返回200状态码，则初步判断其可能存在漏洞。这一步有助于过滤掉未运行1Panel Agent或端口不开放的无效目标，提高了后续WebSocket连接的效率。
2.  **漏洞利用阶段（WebSocket）**: 在预检成功后，POC尝试通过WebSocket协议连接到`wss://{target_host}/api/v2/agent/client/ws`。同样，在建立TLS连接时，它会提供之前生成的自签名客户端证书。一旦WebSocket连接成功建立，POC就能通过WebSocket协议向1Panel Agent发送任意命令，实现远程命令执行（RCE）。代码中明确包含了发送命令的逻辑，例如执行系统命令、获取反弹Shell等。通过将命令封装在特定的JSON结构中（如`{"cmd":"execute_command","payload":...}`），POC能够与Agent的API进行交互。

POC还具备多目标扫描能力，利用ThreadPoolExecutor并发处理多个目标，极大地提高了扫描效率。此外，它支持代理配置，这对于在特定网络环境下进行测试或规避防火墙有帮助。整体来看，该POC不仅验证了漏洞的存在，还提供了一个完整的、可用于实际攻击的远程命令执行框架，其功能完整性和可靠性达到了非常高的水准。

**利用步骤:**
1.  **识别目标**: 攻击者需要识别暴露在互联网上或可访问的内部网络中的1Panel Agent服务。通常这些服务会在HTTPS端口（如443或自定义端口）上监听。
2.  **环境准备**: 攻击者需要一个Python环境，并安装POC所需的库，主要是requests、websocket-client和cryptography。
3.  **运行POC**: 攻击者执行提供的Python POC脚本。脚本接受目标IP地址或主机名作为参数。例如：`python3 CVE-2025-54424.py -t <target_ip>`。
4.  **证书生成与绕过**: POC在运行时会自动生成一个自签名的客户端TLS证书，其Common Name (CN) 被设置为“panel_client”。攻击者无需手动创建证书。
5.  **建立HTTPS连接**: POC使用生成的证书尝试与目标1Panel Agent建立HTTPS连接。由于Agent的TLS配置缺陷（tls.RequireAnyClientCert），它会接受任何提供了证书的连接，而不会验证证书的合法性，从而实现了认证绕过。
6.  **建立WebSocket连接**: 在TLS连接成功后，POC会进一步尝试建立WebSocket连接到Agent的特定API端点。
7.  **远程命令执行**: 通过建立的WebSocket连接，攻击者可以通过POC向Agent发送封装的命令（例如Linux shell命令）。Agent会解析并执行这些命令，结果通常通过WebSocket返回给攻击者。这使得攻击者可以在目标服务器上执行任意代码，包括但不限于：获取服务器信息、上传或下载文件、创建新用户或修改现有用户权限、部署持久性后门、反弹Shell，获得目标服务器的交互式Shell会话、植入挖矿程序或其他恶意软件。

攻击者可以利用POC提供的`--cmd`参数直接执行命令，或者通过`--reverse`参数设置反弹Shell。整个过程高度自动化，降低了攻击的门槛。

**投毒风险分析:**
对提供的`CVE-2025-54424.py` POC代码进行深入分析后，可以评估其投毒风险为低，具体评分为10%。以下是详细的分析：

1.  **代码清晰度与可读性**: 该POC代码具有出色的清晰度和可读性。所有函数和变量命名都直观且有意义。代码结构良好，模块化程度高，例如将证书生成、目标检查、命令执行等功能封装在独立的函数中。脚本包含了关键的注释，解释了不同部分的功能，这极大地帮助了代码审计人员理解其意图。没有发现任何形式的代码混淆（如Base64编码的字符串、十六进制编码、动态加载模块等），这表明作者没有刻意隐藏恶意行为。

2.  **依赖库分析**: POC使用的Python库都是标准且广泛接受的库：`base64`, `ssl`, `sys`, `json`, `os`, `tempfile`, `argparse`, `requests`, `websocket`, `threading`, `concurrent.futures`, `datetime`, `cryptography`。`cryptography`库用于加密操作，包括生成自签名证书，这是核心漏洞利用逻辑的一部分。`requests`和`websocket`库用于网络通信，是执行HTTP请求和WebSocket连接的标准工具。这些库本身都是公开审查且经过大量使用的，没有已知的主流恶意行为。POC仅利用这些库提供的正常功能。

3.  **外部网络请求与资源**: POC的主要网络活动仅限于与目标1Panel Agent主机进行通信。它不向任何第三方或可疑的IP地址、域名发送请求。证书生成完全在本地完成，不依赖外部CA或在线服务。代码中禁用了`requests`库在禁用SSL验证时产生的警告（`InsecureRequestWarning`），这在进行漏洞测试或与自签名证书通信时是常见的做法，并非恶意行为的指示。

4.  **恶意负载与后门行为**: POC的功能是利用漏洞在目标服务器上执行用户指定的命令（通过`--cmd`参数）或建立反弹Shell（通过`--reverse`参数）。这意味着它会将用户输入的命令发送给目标执行。然而，POC本身的代码中并没有嵌入任何预设的恶意负载、后门程序、挖矿程序安装逻辑或DDoS攻击代码。临时证书和私钥文件在使用后会安全地创建和删除，没有在本地留下痕迹。没有发现尝试修改POC运行环境（即攻击者自己的机器）的任何配置、文件或系统行为。

5.  **资源消耗与行为模式**: POC的资源消耗（CPU、内存、网络带宽）符合其扫描和利用漏洞的正常操作模式。没有迹象表明它在后台执行计算密集型任务（如挖矿）或持续性地消耗系统资源。它旨在提供用户对目标系统的控制，而不是秘密地在后台进行其他活动。

**结论**: 综合以上分析，该POC代码是专注于利用CVE-2025-54424的合法安全研究工具。它严格按照漏洞原理设计，没有发现任何隐藏的、与漏洞利用目的无关的恶意行为。因此，将其投毒风险评定为低（10%）。用户在使用前仍应自行审查代码，并最好在隔离环境中运行，以确保安全。

**项目地址:** https://github.com/gmh5225/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
