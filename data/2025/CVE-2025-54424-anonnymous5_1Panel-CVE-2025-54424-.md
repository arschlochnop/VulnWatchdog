## CVE-2025-54424 - 1Panel 证书校验绕过 (Certificate Validation Bypass), 任意命令执行 (Arbitrary Command Execution)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 证书校验绕过 (Certificate Validation Bypass), 任意命令执行 (Arbitrary Command Execution)

**影响应用:** 1Panel

**危害等级:** 高

**CVSS评分:** AV:N/AC:H/Au:N/C:C/I:C/A:C

**影响版本:** <= 2.0.5

**利用条件:** 需要网络访问, 攻击复杂度中等 (使用POC时), 目标系统运行1Panel客户端通信服务

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-54424 是 1Panel 开源项目中的一个严重漏洞，被归类为证书校验绕过导致任意命令执行。该漏洞主要影响 1Panel <= 2.0.5 版本。攻击者可以通过伪造特定主题的客户端证书（Common Name 为 'panel_client'），绕过 1Panel 后端对客户端证书的合法性验证。一旦证书验证被绕过，攻击者便能建立起与 1Panel 从节点的WebSocket连接，进而通过 WebSocket 协议发送恶意指令，实现在目标服务器上任意命令执行。此漏洞的发现和披露对于保护 1Panel 用户的数据安全至关重要，因为它允许未经授权的远程攻击者完全控制受影响的系统。CNVD 对此漏洞的危害级别评定为“高”，CVSS 向量为 AV:N/AC:H/Au:N/C:C/I:C/A:C，表明它是一个远程可利用、对机密性、完整性和可用性影响均为完全的漏洞，但其利用的攻击复杂度在没有自动化工具辅助时相对较高。

**POC有效性分析:**
提供的 Python POC 代码 (`CVE-2025-54424.py`) 是一个功能完整的利用工具，能够有效地复现和利用 CVE-2025-54424 漏洞。该脚本的核心在于其动态生成自签名 X.509 证书的能力。它使用 `cryptography` 库生成一个包含特定 Common Name（`panel_client`）的私钥和证书。
POC 的利用流程分为两个主要阶段：
1. **HTTP 预检**: 首先，脚本会尝试通过 HTTPS 对目标 1Panel 实例的 `/api/v2/dashboard/base/os` 接口发起 GET 请求，并在请求中附带伪造的客户端证书。如果此请求成功返回 200 状态码，则表明证书校验绕过成功，攻击者已通过伪造证书获得了初步的 API 访问权限。
2. **WebSocket 命令执行**: 在 HTTP 预检成功后，POC 会进一步建立与 1Panel 从节点 `/api/v2/client/ws` 的 WebSocket 连接，同样使用伪造的客户端证书。通过 WebSocket 协议，POC 能够模拟正常的客户端行为，先订阅系统信息，然后创建虚拟终端，并最终通过 `terminal_command` 消息向该终端发送用户指定的任意命令。命令执行的结果会通过 WebSocket 回传，并在控制台打印出来。
POC 的设计考虑了多种使用场景，支持单个目标 URL 或目标列表文件输入，并提供了代理配置选项，增强了其在实际渗透测试中的灵活性和隐匿性。多线程扫描功能也使其能够高效地检测多个目标。所有关键操作，如证书生成、网络请求和 WebSocket 交互，都封装在独立的函数中，代码结构清晰，易于理解和维护。因此，该 POC 具有极高的实用性和可靠性，是一个高质量的漏洞利用工具。

**利用步骤:**
1. **准备环境**: 确保 Python 环境已安装 `requests`, `websocket-client`, `cryptography` 等必要的库。
2. **获取 POC**: 从 GitHub 仓库 `https://github.com/Mr-xn/CVE-2025-54424` 下载 `CVE-2025-54424.py` 脚本。
3. **指定目标与命令**: 
   *   使用 `-t` 或 `--target` 参数指定单个 1Panel 目标服务器的 URL（例如：`https://your-1panel-host.com`）。
   *   使用 `-f` 或 `--target_file` 参数指定包含多个目标 URL 的文件，每行一个。
   *   使用 `-c` 或 `--command` 参数指定要在目标服务器上执行的任意命令（例如：`id`, `cat /etc/passwd`）。
4. **执行 POC**: 
   *   示例：`python CVE-2025-54424.py -t https://your-1panel-host.com -c "id"`
   *   脚本将动态生成一个 CN 为 `panel_client` 的自签名证书，并尝试利用该证书绕过目标 1Panel 服务的校验。
   *   如果利用成功，脚本将通过 WebSocket 连接执行指定的命令，并将命令输出打印到控制台。
5. **可选配置**: 可通过 `-p` 或 `--proxy` 参数配置代理服务器，以在特定网络环境中或进行流量分析时使用。

**投毒风险分析:**
对提供的 `CVE-2025-54424.py` POC 代码进行深入分析后，评估其投毒风险为低 (5%)。主要原因如下：
*   **代码透明度高**: 脚本代码完全开源且结构清晰，没有发现任何形式的代码混淆或加密处理，所有功能逻辑一目了然。
*   **依赖标准库**: POC 主要依赖 Python 的标准库以及 `requests`, `websocket-client`, `cryptography` 等知名的第三方安全库。这些库广泛用于网络通信和密码学操作，自身安全性较高，且 POC 未对其进行异常修改。
*   **无恶意外部请求**: 除了目标 1Panel 服务器的请求以及用户可选配置的代理请求外，POC 没有向任何其他可疑的外部地址发送数据或下载额外资源。所有网络流量均指向预期的目标。
*   **无隐藏功能**: 脚本的核心功能是证书生成、HTTP 预检和 WebSocket 命令执行，这些都直接服务于漏洞利用的目的。没有发现任何与漏洞利用无关的、可疑的文件操作、系统配置修改或数据窃取行为。
*   **临时文件处理**: 脚本在动态生成证书和私钥时会创建临时文件，并在使用完成后通过 `os.remove()` 进行清理，这是一个标准且安全的做法，不会留下持久性痕迹或引入额外风险。
*   **可控性强**: 所有关键参数，包括目标、命令和代理，都由用户通过命令行参数明确指定。攻击行为的范围和内容完全由使用者控制，POC 本身不具备自主恶意行为。
综合来看，该 POC 是一个专注于漏洞利用的良性工具，其设计和实现均符合防御性安全研究或渗透测试的规范。在执行该 POC 时，主要风险在于其利用漏洞对目标系统造成的潜在破坏（如执行危险命令），而非 POC 自身携带恶意载荷对执行环境造成“投毒”。使用者应确保在授权范围内对目标系统进行测试，并清楚命令执行的后果。

**项目地址:** https://github.com/Mr-xn/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
