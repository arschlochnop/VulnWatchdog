## CVE-2025-32463 - Sudo 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 至 1.9.17

**利用条件:** 本地普通用户权限，系统安装有 gcc 环境或具备预编译动态库的能力，Sudo 支持 -R (chroot) 选项。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该漏洞利用了 Sudo 在处理 `--chroot` (或 `-R`) 选项时的逻辑缺陷。在受影响的版本中，当用户执行 `sudo -R /path/to/dir` 时，Sudo 切换到目标目录后，在执行 `chroot()` 系统调用之前或过程中，未能正确隔离 NSS (Name Service Switch) 配置文件及相关库的加载路径。具体来说，Sudo 会尝试加载 `/etc/nsswitch.conf`，由于此时进程的根目录上下文已受用户控制，Sudo 会加载由攻击者伪造的配置文件。POC 代码通过 `mktemp` 创建临时目录，构造了一个恶意的 `nsswitch.conf`，将 `passwd` 数据库指向一个自定义的服务模块 `woot1337`。随后，利用 `gcc` 编译一个 C 语言编写的共享库 `libnss_woot1337.so.2`。该共享库使用了 `__attribute__((constructor))` 属性，这使得它在被加载到 Sudo 进程空间时会立即执行。在库函数内部，通过 `setreuid(0,0)` 和 `setregid(0,0)` 将进程的实际和有效用户/组 ID 设为 root，并最终启动 `/bin/bash`。实验证明，该利用链逻辑严密，直接针对 Sudo 的动态库加载机制，绕过了传统的 chroot 限制，能够稳定地在目标受影响版本上获得 root shell。利用步骤：1. 创建攻击工作目录。2. 编写恶意 C 源码，包含提权执行 shell 的构造函数。3. 建立伪造的目录结构，包括 `etc` 和库文件存放目录。4. 编写恶意的 `nsswitch.conf`，指定非标准的 NSS 服务名称。5. 编译 C 源码为共享对象 (.so) 文件，并放置在 Sudo 寻找库的相对路径中。6. 执行 `sudo -R` 命令触发漏洞，获取 root 权限。投毒风险分析：该 POC 脚本代码结构透明，逻辑清晰，主要由 Bash 命令和标准的 C 语言提权 payload 组成。分析其 shell 脚本可见，其操作范围被严格限制在 `/tmp` 下的临时目录内，且在执行完毕后会尝试删除临时文件。代码中未发现混淆处理、Base64 编码的隐藏指令或非必要的网络连接请求。脚本的核心是通过本地编译和执行 Sudo 命令来完成提权验证，不涉及从远程服务器下载未知二进制文件的操作。唯一的外部依赖是 `git clone` 仓库，这属于标准的 POC 获取方式。风险评分较低（10%），主要风险点在于其能够直接实现提权，若在生产环境运行，其生成的 root shell 可能会被用户误操作导致系统配置更改。对于防御者而言，该脚本是纯粹的功能性验证工具，不具备恶意软件（如后门、矿工程序或窃密组件）的典型特征。在审计此类 POC 时，应重点关注 `libnss` 劫持部分是否包含额外的恶意系统调用，当前分析结果显示其行为仅限于获取 shell。

**项目地址:** [https://github.com/kh4sh3i/CVE-2025-32463.git](https://github.com/kh4sh3i/CVE-2025-32463.git)

**漏洞详情:** [https://avd.aliyun.com/detail?id=AVD-2025-32463](https://avd.aliyun.com/detail?id=AVD-2025-32463)
