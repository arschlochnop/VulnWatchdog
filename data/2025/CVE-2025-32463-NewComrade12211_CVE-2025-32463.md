## CVE-2025-32463 - sudo 本地提权 (Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Privilege Escalation)

**影响应用:** sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.9.14 <= sudo < 1.9.17p1

**利用条件:** 本地普通用户权限，系统安装有gcc用于编译共享库（或预编译），sudo支持-R (chroot) 选项

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞源于sudo在处理chroot（-R参数）时的逻辑缺陷。自1.9.14版本起，sudo引入了新的chroot机制，但在执行过程中，它会读取用户可控制目录下的/etc/nsswitch.conf文件。攻击者可以利用这一特性，通过自定义的nsswitch配置重定向系统库的加载路径，进而加载恶意的共享库（如libnss_*.so）。提供的POC代码非常完整且有效：首先，它创建了一个临时目录作为伪造的根环境（chroot jail）；其次，编写了一个带有__attribute__((constructor))属性的C语言代码段，该代码在库加载时会自动执行，调用setreuid(0,0)和setregid(0,0)来获取root权限并启动bash shell；然后，POC配置了虚假的/etc/nsswitch.conf，将passwd查询指向自定义的库名；最后，通过执行'sudo -R woot woot'命令触发漏洞。由于sudo以root权限运行并在进入chroot之前或期间未能正确过滤环境变量或隔离库加载路径，导致恶意库被以root身份加载。实验证明该POC逻辑严密，直接指向漏洞核心成因。利用步骤：1. 创建临时工作空间；2. 编写恶意C源码，定义提升权限后执行的shell操作；3. 建立伪造的目录结构，包括etc子目录；4. 构造恶意的nsswitch.conf文件，指定动态库加载策略；5. 编译生成的C代码为共享库，并放置在LD_LIBRARY_PATH或sudo搜索路径可及的伪造目录下；6. 执行带有-R参数的sudo命令，触发root级别的库加载，完成提权。投毒风险分析：该POC代码开源在GitHub上（kh4sh3i/CVE-2025-32463），脚本逻辑透明，主要由Bash命令、C语言源码和标准的gcc编译指令组成。分析脚本内容，其操作均在/tmp下的临时目录进行，清理工作（rm -rf）也比较到位，未发现明显的恶意混淆、远程后门植入或敏感数据外泄逻辑。风险评分较低（15%），主要风险点在于其依赖于git clone外部仓库，若上游仓库被接管或在exploit.sh中后续加入静默下载并执行二进制文件的指令，则可能演变为投毒攻击。防御研究员在使用此类POC时，应重点检查exploit.sh中是否存在curl、wget等外连操作，并审查C代码中除了execl之外是否包含隐藏的网络套接字操作。目前提供的代码片段是纯净的防御性研究样本。

**项目地址:** [https://github.com/kh4sh3i/CVE-2025-32463.git](https://github.com/kh4sh3i/CVE-2025-32463.git)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
