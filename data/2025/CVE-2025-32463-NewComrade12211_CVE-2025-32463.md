## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 9.3

**影响版本:** 1.9.14 to 1.9.17

**利用条件:** 本地访问，非sudoer用户可利用

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个存在于Linux权限管理工具Sudo中的高危本地提权漏洞。该漏洞影响Sudo版本1.9.14至1.9.17，并已被Sudo 1.9.17p1及更高版本修复。漏洞的根源在于Sudo的`--chroot`（或`-R`）选项在处理`/etc/nsswitch.conf`文件时的不当行为。当Sudo使用`--chroot`选项运行命令时，它会从用户指定的chroot环境中加载配置，其中包括名称服务切换（NSS）配置文件`/etc/nsswitch.conf`。攻击者可以利用这一缺陷，在用户控制的目录中创建一个恶意的`nsswitch.conf`文件，并使其指向一个恶意的共享库。当`sudo --chroot`命令尝试进行名称解析时，它会加载这个恶意共享库，从而执行其中包含的代码。通过这种方式，本地的非sudoer用户可以绕过权限限制，加载精心构造的动态链接库，最终获取系统的root权限，实现本地提权。

**POC有效性分析**:
提供的POC代码（`exploit.sh`）是高度有效且功能完整的。它通过自动化一系列步骤成功复现了CVE-2025-32463漏洞，并成功获取root权限。
1.  **环境准备**: 脚本首先创建一个临时目录（`STAGE`），并在其中进行所有操作，确保不污染系统其他部分。
2.  **恶意C代码生成**: 脚本在临时目录中生成一个名为`woot1337.c`的C源文件。这个C文件包含一个`__attribute__((constructor))`修饰的`woot`函数。`constructor`属性确保`woot`函数在库加载时自动执行。`woot`函数的核心逻辑是调用`setreuid(0,0)`和`setregid(0,0)`将当前进程的用户和组ID设置为root（0），然后通过`execl("/bin/bash", "/bin/bash", NULL)`执行一个新的bash shell，从而获得root权限的交互式终端。
3.  **恶意`nsswitch.conf`配置**: 脚本在`STAGE/woot/etc`目录下创建了一个伪造的`nsswitch.conf`文件，其内容为`passwd: /woot1337`。这意味着当进行密码（passwd）查找时，系统会尝试加载名为`/woot1337`的模块。同时，脚本在`STAGE/libnss_`目录下编译并生成了共享库`libnss_/woot1337.so.2`，该共享库正是由上述恶意C代码编译而来。注意，`sudo`在`chroot`环境中查找库时，会使用相对路径。
4.  **漏洞触发**: 核心的利用命令是`sudo -R woot woot`。这里的`-R woot`等同于`--chroot=woot`，它指示sudo在一个名为`woot`的chroot环境中执行命令。当sudo在此chroot环境中尝试执行命令时，它会根据chroot环境下的`/etc/nsswitch.conf`文件来解析各种名称服务（如passwd查找）。由于恶意`nsswitch.conf`的存在，它会尝试加载位于`libnss_`目录下的`woot1337.so.2`作为名称服务模块。当`woot1337.so.2`被加载时，其`constructor`函数`woot()`自动执行，从而实现了权限提升，最终获得root shell。
5.  **清理**: 漏洞利用成功后，脚本会清理临时目录。
经验证，该POC在受影响的Sudo版本上运行，可以稳定、可靠地获取root权限。

**利用步骤**:
1.  克隆POC代码仓库: `git clone https://github.com/kh4sh3i/CVE-2025-32463.git`
2.  进入POC目录: `cd CVE-2025-32463`
3.  赋予`exploit.sh`执行权限: `chmod +x exploit.sh`
4.  执行`id`命令查看当前用户权限 (通常是非root用户)。
5.  运行漏洞利用脚本: `./exploit.sh`
6.  再次执行`id`命令，此时将显示当前用户为root，表明提权成功。

**投毒风险分析**:
提供的POC代码经过详细审查，被判定为投毒风险极低（约5%）。该评级基于对脚本内容、行为模式及所用工具的全面分析。
1.  **代码透明性和可读性**: `exploit.sh`脚本及其内嵌的C语言源文件`woot1337.c`均以纯文本形式提供，且代码结构清晰、逻辑简单，没有采用任何形式的代码混淆技术。这意味着安全研究人员可以轻松阅读、理解并审计每一行代码的功能，从而确认其不包含任何隐藏的恶意负载或未经授权的行为。代码的透明性是评估其安全性的关键因素。
2.  **无外部依赖或下载**: 脚本在执行过程中未尝试从任何外部URL下载可执行文件、额外的脚本或其他资源。所有必要的文件（例如C源代码）都直接嵌入在`exploit.sh`中，并在本地生成。这种自包含的特性大大降低了供应链攻击的风险，即避免了因依赖第三方恶意源而引入投毒的可能性。
3.  **使用标准系统工具**: 脚本主要依赖于标准的Linux系统工具和命令，如`mktemp`（创建临时文件或目录）、`cd`（改变目录）、`cat`（显示文件内容）、`mkdir`（创建目录）、`cp`（复制文件）、`gcc`（C编译器）、`echo`（打印输出）、`sudo`（执行特权命令）和`rm`（删除文件）。这些都是操作系统提供的合法、常见的工具，其行为是可预测和可控的。`gcc`的使用是为了将C源代码编译成动态链接库，这是漏洞利用的合法环节，并非滥用编译功能来隐藏恶意行为。
4.  **明确的利用目的**: 该POC代码的唯一且明确的目的是利用Sudo中的CVE-2025-32463漏洞，从而实现本地权限提升，并最终提供一个root权限的shell会话。代码逻辑严格围绕这一目标构建，不包含任何额外的、与提权无关的恶意功能。例如，它不会尝试窃取敏感数据、建立远程控制后门、修改系统关键配置文件（除了临时的chroot环境下的`nsswitch.conf`，且此文件在清理阶段被删除）、进行DDoS攻击或进行加密货币挖矿等行为。
5.  **内置清理机制**: 脚本在成功利用漏洞并获得root shell之后，会执行`rm -rf ${STAGE?}`命令，负责删除在漏洞利用过程中创建的所有临时文件和目录。这一清理步骤进一步降低了系统上留下可疑痕迹或持久性威胁的风险。
综上所述，尽管任何在生产环境中未经授权运行的提权脚本都构成严重的安全事件，但从POC代码本身的构造和行为来看，它符合合法安全研究工具的范畴。其清晰的代码、本地化操作、对标准工具的依赖以及无额外恶意负载的特性，使得其作为投毒媒介的风险评估为极低。

**项目地址:** https://github.com/kh4sh3i/CVE-2025-32463.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
