## CVE-2025-9074 - Docker Desktop 容器逃逸

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸

**影响应用:** Docker Desktop

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** Docker Desktop ≤ 4.44.3 (Windows和macOS版本)

**利用条件:** 本地运行的恶意Linux容器；不依赖挂载；通过默认子网192.168.65.7:2375直接访问Docker Engine API；无需认证；运行容器的用户需具有与目标挂载文件夹匹配的权限。

**POC 可用性:** 10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-9074是一个在Docker Desktop应用中发现的高危容器逃逸漏洞，影响Windows和macOS版本的Docker Desktop。该漏洞的CVSS评分为9.3，表明其具有极高的危害性。它允许本地运行的恶意Linux容器绕过Docker的隔离机制，通过默认子网（192.168.65.7:2375）直接访问宿主机上的Docker Engine API，且无需进行身份认证或访问控制。一旦恶意容器获得对Docker Engine API的未授权访问权限，攻击者便可以利用该API创建新的容器，并指定挂载宿主机的文件系统卷。通过这种方式，攻击者可以获取对宿主机文件系统的完全读写权限，从而实现完整的容器逃逸，对宿主机系统造成严重影响。

**POC有效性分析**
本项目提供的PoC代码，由`zenzue`在GitHub上发布，是对安全研究员Felix Boulet发现的CVE-2025-9074漏洞的有效实现。该PoC的文档非常完整和清晰，包含了详细的步骤、必要的先决条件、清晰的命令示例以及预期结果的截图，极大地降低了复现门槛。PoC通过一系列简洁的`wget`命令，精确地模拟了攻击者如何利用该漏洞。首先，它向Docker Engine API的`/containers/create`端点发送一个`POST`请求，创建一个新的`alpine`容器。关键在于，这个请求在`HostConfig`中设置了`Binds`参数，将宿主机的C盘（在容器内映射为`/host_root`）挂载到新容器中。同时，利用`Cmd`参数在新容器内部执行命令，例如`echo pwned > /host_root/test/pwn.txt`，直接向宿主机文件系统写入文件。这直接证明了恶意容器拥有对宿主机文件系统的写入能力。接着，PoC通过`POST /containers/$cid/start`启动新创建的容器，使其执行上述写入操作。最后，为了演示读取能力，PoC通过`GET /containers/$cid/archive?path=/host_root/test`请求，从新容器中获取一个包含宿主机目录`C:\test`内容的压缩包，并解压验证其中的文件。整个PoC流程逻辑严谨，每一个步骤都紧密关联，环环相扣，最终成功地演示了从容器内部对宿主机文件系统进行读写的能力，从而验证了Docker Desktop容器逃逸漏洞的有效性。其清晰的截图进一步直观地证实了漏洞利用的成功。

**利用步骤**
1.  **环境准备**：确保Docker Desktop版本为4.44.3或更低，并在Windows或macOS宿主机上运行。同时，确保运行恶意容器的用户具有与目标挂载文件夹匹配的权限。
2.  **宿主机设置**：在Windows宿主机上创建一个测试目录，例如`C:\test`，并在其中创建一个示例文件`readme.txt`。
3.  **启动恶意容器**：在宿主机上启动一个简单的Linux容器，例如使用命令`docker run -it alpine '/bin/sh'`启动一个`alpine`容器。
4.  **创建并启动具有宿主机卷的新容器**：进入已启动的`alpine`容器内部，执行以下命令。该命令会向Docker Engine API发送`POST`请求，创建一个新的容器。这个新容器会将宿主机的`C:\`目录挂载到容器内的`/host_root`路径，并执行一个命令向`C:\test`目录写入`pwn.txt`文件，然后启动该新容器。
    ```sh
    # 创建容器并挂载宿主机卷
    wget --header='Content-Type: application/json' \
      --post-data='{"Image":"alpine","Cmd":["sh","-c","echo pwned > /host_root/test/pwn.txt"],"HostConfig":{"Binds":["/mnt/host/c:/host_root"]}}' \
      -O - http://192.168.65.7:2375/containers/create > create.json

    # 提取容器ID
    cid=$(cut -d'"' -f4 create.json)

    # 启动容器
    wget --post-data='' -O - http://192.168.65.7:2375/containers/$cid/start
    ```
5.  **验证宿主机文件写入**：在宿主机上检查`C:\test`目录，确认`pwn.txt`文件已成功创建。
6.  **验证宿主机文件读取**：在恶意容器内部，执行以下命令，从新创建的容器中请求获取宿主机挂载目录`/host_root/test`的存档文件，然后解压并查看`readme.txt`内容，确认可以成功读取宿主机文件。
    ```sh
    wget http://192.168.65.7:2375/containers/$cid/archive?path=/host_root/test -O test.tar
    tar -xvf test.tar
    cat test/readme.txt
    ```

**投毒风险分析**
针对此PoC代码的投毒风险评估为**低（5%）**。分析基于以下几点：
1.  **代码透明度高**：PoC代码完全开源，且以纯文本形式呈现，未经过任何形式的代码混淆。所使用的命令（如`wget`、`tar`、`cut`、`echo`）均为Linux环境下常见的标准工具，其功能易于理解和审计。这使得任何潜在的恶意行为都能够被安全研究人员和开发者轻易识别。
2.  **无外部恶意依赖**：PoC没有引入任何可疑的第三方脚本、二进制文件或外部链接（除了Docker Engine API本身）。所有的操作都集中在通过HTTP请求与Docker Engine API进行交互，以明确演示漏洞的利用方式，而非执行隐蔽的恶意加载或安装。
3.  **明确的免责声明**：`README.md`文件中明确指出：“This PoC is for educational and research purposes only. The author assumes no liability for misuse.”和“This PoC demonstrates the vulnerability safely and does not include weaponized exploit code.”这些声明清楚地表明了PoC的意图是用于研究和教育目的，而非用于实际攻击或作为恶意载荷的一部分。这进一步降低了其作为投毒工具的可能性。
4.  **功能目标明确**：PoC的设计目标是最小化地演示容器逃逸后对宿主机文件系统的读写能力，不包含额外的、与漏洞演示无关的“武器化”功能，例如持久化、权限提升至更高宿主机用户、横向移动等。

综上所述，虽然CVE-2025-9074漏洞本身具有高危性，一旦被攻击者恶意利用将造成严重后果，但当前分析的PoC代码自身是清洁和安全的，其目的是帮助防御者理解漏洞机制并进行防御措施的验证，而非作为攻击性恶意软件传播。组织在使用此PoC进行内部测试时，可以放心地进行，但务必确保测试环境的隔离性，并优先对生产环境中的Docker Desktop进行版本升级至4.44.3或更高版本，以彻底消除此漏洞带来的风险。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-9074
