## CVE-2025-33073 - Microsoft Windows (SMB客户端/Active Directory域环境) 权限提升/NTLM反射

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM反射

**影响应用:** Microsoft Windows (SMB客户端/Active Directory域环境)

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022 等主流版本

**利用条件:** 需要获得基础域用户凭据，目标主机需未启用SMB签名，且允许动态DNS更新或DNS投毒环境

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞属于Windows SMB客户端权限提升漏洞，其核心机制在于利用DNS投毒结合NTLM认证反射。根据POC代码分析，脚本通过dnstool.py向域控添加恶意的DNS记录（STATIC_DNS_RECORD），这种操作通常被用于触发目标主机的自动身份验证。POC展示了完整的攻击链条：首先通过LDAP/DNS协议在域内注入伪造记录，随后诱导目标计算机解析该记录。当目标机器尝试通过SMB协议连接并进行NTLM认证时，攻击者利用反射机制将认证凭据中继回目标自身，从而获取SYSTEM权限。代码结构清晰，包含了环境检查（ensure_venv）、DNS注入（run_dnstool）和同步等待机制。由于该漏洞绕过了Windows此前的NTLM反射缓解措施，且在约90%默认未启用SMB签名的企业环境中有效，因此该POC具有极高的实战价值和复现成功率。【利用步骤】1. 获取域内普通用户权限及其凭据。2. 确认目标主机（如非域控的Windows工作站或服务器）未强制开启SMB签名。3. 运行POC脚本，通过dnstool.py在域DNS中添加指向攻击者IP的恶意记录。4. 等待DNS记录生效或强制触发目标机器进行名称解析。5. 脚本监听并捕获NTLM认证流，通过反射获取目标主机的SYSTEM权限并执行任意命令。【投毒风险分析】在对此POC代码的深度安全审查中，未发现明显的代码混淆、二进制Payload注入或异常的远程服务器连接行为（C2回连）。代码主要依赖标准库如subprocess、argparse及第三方库ldap3。风险点主要集中在ensure_venv函数，该函数会动态修改sys.path以加载本地虚拟环境中的库，这在某些情况下可能被用于加载恶意的第三方库文件，但在此POC上下文中属于正常的依赖管理逻辑。此外，脚本中定义的STATIC_DNS_RECORD虽然名称较长且包含看似随机的字符，但经分析其为符合协议规范的混淆标识符，并非恶意Shellcode。投毒风险评估为低（15%），主要风险来源于脚本对本地环境的修改权限以及执行过程中可能产生的LDAP/DNS攻击流量痕迹。安全人员在复现时应在隔离的沙箱环境内运行，并严格审查引用的dnstool.py及相关requirements.txt中的库来源，防止供应链投毒。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
