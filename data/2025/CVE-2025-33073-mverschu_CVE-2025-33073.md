## CVE-2025-33073 - Microsoft Windows Server Message Block (SMB) 权限提升/NTLM中继/DNS投毒

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM中继/DNS投毒

**影响应用:** Microsoft Windows Server Message Block (SMB)

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022等受影响版本

**利用条件:** 需要一个普通的域用户凭据，且目标机器未强制执行SMB签名

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC展示了CVE-2025-33073漏洞的高度可利用性。代码通过结合ADIDNS投毒技术和NTLM中继攻击，实现了在Windows域环境下的横向移动。核心逻辑在于：首先，POC利用`dnstool.py`向域控（DC）注入一个恶意的DNS记录（STATIC_DNS_RECORD），由于Windows默认允许普通域用户在ADIDNS中创建新记录，这一步通常能成功。随后，脚本通过`dig`命令监测DNS记录是否生效。一旦生效，POC会利用Windows SMB客户端在处理目标名时的设计缺陷（mrxsmb.sys驱动漏洞），强制目标主机发起SMB连接并进行本地认证反射。通过中继这些身份验证请求，攻击者可以在未开启SMB签名的机器上执行任意命令或获取SYSTEM权限。代码结构清晰，包含了环境检查、虚拟环境处理以及对外部攻击工具（如dnstool.py）的调用，具有很高的实战价值，但也要求使用者具备一定的内网渗透基础知识。【利用步骤】1. 获取一个基础的域用户账号及密码。2. 部署攻击机环境，确保安装了ldap3、impacket等必要库，或通过setup.sh建立虚拟环境。3. 运行主脚本，指定目标DC、攻击者IP、用户名和密码。4. 脚本会自动在ADIDNS中注入恶意记录，并等待全球解析同步。5. 触发目标主机的SMB客户端漏洞，将其身份验证请求中继至攻击者控制的监听端。6. 利用中继成功的会话获取目标权限或执行特定指令。【投毒风险分析】从代码逻辑来看，该POC的投毒风险较低（约15%）。脚本主要依赖标准的Python库（如subprocess, argparse, pathlib）和常见的内网渗透库（ldap3）。代码逻辑透明，没有发现明显的Base64混淆、内存加密加载或外部恶意Payload下载等典型投毒行为。其`ensure_venv`函数虽然涉及路径操作，但其目的是为了确保依赖库的正确加载，符合渗透测试工具的编写规范。然而，由于该脚本需要调用外部的`dnstool.py`和`dig`工具，防御者仍需注意其调用的第三方组件是否被替换为恶意版本。风险主要源于此类工具在分发过程中可能被二次打包。代码中定义的`STATIC_DNS_RECORD`为固定硬编码，虽然不具有直接破坏性，但在实际防御场景中可作为关键指纹进行监测。整体而言，该代码是一个功能导向的漏洞复现工具，不包含针对执行者的恶意攻击逻辑。

**项目地址:** 本地路径: /tmp/vulnwatchdog_d0541d5a0847e6dcb76efdbe9d66a4d2/CVE-2025-33073.py

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
