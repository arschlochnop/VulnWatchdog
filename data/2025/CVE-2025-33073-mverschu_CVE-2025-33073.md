## CVE-2025-33073 - Microsoft Windows (SMB客户端/mrxsmb.sys) 权限提升/NTLM中继/反射攻击

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM中继/反射攻击

**影响应用:** Microsoft Windows (SMB客户端/mrxsmb.sys)

**危害等级:** 高危 (High)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022等主流版本

**利用条件:** 需要一个普通的域用户凭据，目标机器未强制开启SMB签名

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该CVE-2025-33073的POC代码表现出极高的实战价值与完整性。漏洞核心在于Windows SMB客户端在处理特定命名的目标连接时存在访问控制缺陷，允许攻击者通过受控的DNS记录诱导系统进行本地认证反射。代码中通过调用dnstool.py自动化注入恶意ADIDNS记录（如STATIC_DNS_RECORD变量所示），这一步是利用的关键，旨在利用Windows域环境默认允许域用户更新DNS记录的特性。脚本逻辑清晰，包含了环境自检、依赖库（ldap3等）加载以及针对域控（DC）和目标主机的攻击链路。其有效性在于它不仅是一个理论上的概念验证，而是整合了DNS投毒、NTLM凭据捕获与中继的完整自动化武器库。通过篡改mrxsmb.sys驱动程序处理编组目标信息的逻辑缺陷，该POC能实现在未经签名的SMB服务上执行命令，复现了类似于‘永恒之蓝’级别的内网横移能力，对于防御性研究而言，该代码准确映射了漏洞触发路径，是评估内网脆弱性的重要参考。利用步骤如下：首先，攻击者使用普通域账号通过ldap3向ADIDNS服务器添加一个精心构造的恶意A记录；其次，通过脚本强制目标机器发起SMB连接至该恶意记录指向的IP；最后，利用中继技术捕获NTLM身份验证请求并反射回目标系统或中继至其他未签名的服务器，从而获得高权限执行环境。【投毒风险分析】在对此POC进行静态代码与逻辑审计后，投毒风险评定为15%（低风险）。风险点主要集中在其复杂的执行环境准备上：脚本包含ensure_venv函数，该函数会动态修改sys.path以加载本地虚拟环境中的库，这种行为在某些恶意软件中被用于隐藏加载路径。然而，在本例中，其主要目的是为了解决ldap3等依赖库的部署问题，属于合理的工程实践。脚本中引用的STATIC_DNS_RECORD虽然包含看似乱码的字符，但经分析为构造特定SMB连接所需的特殊NetBIOS/DNS名称，并非恶意Shellcode或后门载荷。代码中存在subprocess.run调用外部dig命令和dnstool.py的行为，这属于功能性调用，未发现向硬编码的远程C2服务器发送敏感信息（如域凭据、本地Hash）的逻辑。值得注意的是，该类脚本通常在具有高价值数据的内网环境运行，虽然当前代码未见混淆或恶意混入后门，但使用者仍需警惕其依赖的第三方库是否被篡改。整体而言，该POC代码结构透明，注释清晰，未见明显的恶意投毒特征，属于高质量的公开安全研究工具。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
