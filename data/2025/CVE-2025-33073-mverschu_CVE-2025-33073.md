## CVE-2025-33073 - Microsoft Windows (SMB客户端/mrxsmb.sys) 权限提升/NTLM中继/反射攻击

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM中继/反射攻击

**影响应用:** Microsoft Windows (SMB客户端/mrxsmb.sys)

**危害等级:** 高危 (High)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022/2025

**利用条件:** 需要拥有普通域用户凭据，目标网络未强制执行SMB签名，且支持ADIDNS动态更新。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC代码展现了极高的实战价值与完整性。代码逻辑清晰地描绘了CVE-2025-33073的利用链：首先通过dnstool.py利用ADIDNS（活动目录集成DNS）漏洞注入一个特制的静态DNS记录（由变量STATIC_DNS_RECORD定义），随后利用Windows SMB客户端在处理目标名（Target Name）时的逻辑缺陷。分析发现，POC通过自动化脚本等待DNS记录同步，旨在诱导目标机器发起SMB连接，并将其NTLM认证请求通过中继手段反射回本地或域内其他主机。代码中使用了ldap3等标准库，并提供了详细的环境检查函数ensure_venv，显示出开发者对工具可用性的关注。这种利用方式规避了早期的反射攻击补丁，证明了Windows SMB协议在处理编组目标信息（Marshaled Target Information）时的深层设计缺陷依然存在。该POC在未打补丁的域环境下，能够有效实现从普通用户到系统管理员或域管理员的权限跨越，具有极高的利用成功率。【利用步骤】1. 获取一个普通域用户账号和密码；2. 运行脚本，通过dnstool向域控（DC）添加包含特定Payload的DNS记录；3. 脚本监听本地端口，等待目标主机的SMB客户端在尝试解析该虚假记录时触发认证；4. 利用中继技术将截获的NTLM凭据重放至未开启SMB签名的目标机器（如域控或其他高权限服务器），执行自定义命令或开启SOCKS代理。【投毒风险分析】从代码结构来看，该POC主要依赖开源安全工具和标准Python库。代码中虽然包含了ensure_venv和setup.sh等环境准备脚本，这在恶意软件分发中常被利用作为下载器，但在此场景下更多是为了配置复杂的内网渗透环境。主要的风险点在于：第一，其核心利用逻辑（STATIC_DNS_RECORD）硬编码了一段二进制数据，这增加了静态检测的难度，且容易被植入恶意Payload而不易察觉；第二，脚本涉及大量的子进程调用（subprocess），如果攻击者修改了dnstool.py或相关的依赖项，可能会在执行过程中静默下载并运行远端后门。然而，目前的分析显示代码逻辑尚属正常防御研究范畴，未发现混淆代码或可疑的外联加密流量，故判定为低至中等投毒风险。建议在隔离的沙箱环境中使用，并严格审计dnstool.py等配套脚本的真实行为。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
