## CVE-2025-8088 - WinRAR 路径遍历 (Path Traversal)

**漏洞编号:** CVE-2025-8088

**漏洞类型:** 路径遍历 (Path Traversal)

**影响应用:** WinRAR

**危害等级:** 高危 (High)

**CVSS评分:** CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

**影响版本:** WinRAR Windows版本, 包括RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll (在官方修复前受影响)

**利用条件:** 需要用户解压特制恶意压缩包

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-8088是一个影响WinRAR软件的严重零日安全漏洞，攻击者可以通过巧妙利用Windows NTFS备用数据流 (ADS)特性和路径遍历技术，绕过WinRAR的正常文件解压路径，将恶意文件释放至系统任意位置，最终实现任意代码执行。该漏洞主要影响WinRAR的Windows版本，包括RAR、UnRAR、便携式UnRAR源代码及UnRAR.dll在官方修复前均受影响。该漏洞的CVSS v3.1评分为8.4（高危），攻击复杂度低。攻击者可构造恶意压缩包，当用户解压这些特制压缩包时，存在漏洞的WinRAR版本会错误地采用压缩包内嵌的文件路径，而非用户指定的目标路径，从而导致恶意文件被投放到如启动文件夹等敏感位置，最终触发任意代码执行。根据威胁情报，该漏洞已遭到包括UNC4895 (RomCom)、APT44、Turla等在内的多个境外间谍组织和中国境内的非法攻击团伙的广泛利用，主要针对乌克兰军事及政府机构，并使用高度定制化的地缘政治相关诱饵进行钓鱼攻击。

**POC有效性分析:**
此PoC是一个用Python编写的脚本，名为`ADSRarBuilder`，其目的是生成一个利用CVE-2025-8088漏洞的恶意WinRAR存档文件。该PoC的有效性体现在以下几个关键方面：首先，PoC明确指出支持RAR5格式，这是WinRAR当前的主流压缩格式，确保了其对现代WinRAR版本的兼容性。其次，该PoC的核心机制是利用Windows NTFS的备用数据流 (Alternate Data Stream, ADS) 技术，将实际的恶意payload文件（如`Updaters.exe`）作为ADS附加到压缩包中的第一个诱饵文件上，这种方式使得payload在正常文件系统中不可见，增加了隐蔽性。再者，PoC通过修改RAR存档的头部信息，巧妙地插入了一个指向系统关键目录（如启动文件夹 `C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\`）的路径遍历字符串。当WinRAR解压此特制存档时，其路径解析逻辑出错，导致原本隐藏在ADS中的payload文件被写入到这个攻击者指定的目录。为了确保生成的恶意存档是有效的且不引起WinRAR的警告或错误，PoC实现了对RAR所有头部CRC校验值的重新计算，这使得生成的恶意RAR文件在解压时表现得像一个正常的存档，增加了攻击的成功率。此外，PoC支持添加多个诱饵文件，使得恶意压缩包看起来更具迷惑性，例如包含`README.md`和`doc.txt`等无害文件，以降低受害者的警惕性。该PoC提供了清晰的命令行接口和使用示例，使得安全研究人员可以轻松地生成恶意存档进行测试，其设计思路清晰，代码结构合理，逻辑严谨，验证了该漏洞的实际可利用性。

**利用步骤:**
利用CVE-2025-8088进行攻击通常遵循以下步骤：
1.  **准备Payload:** 攻击者首先准备一个恶意的可执行文件（例如，一个远控木马、信息窃取器等），作为最终在受害者机器上执行的payload。
2.  **生成恶意RAR文件:** 攻击者使用提供的PoC脚本（例如 `python main.py Updaters.exe Archive.rar --decoy README.md doc.txt`），将准备好的payload嵌入到生成的RAR存档中，并指定一个目标释放路径，例如Windows的启动文件夹。PoC脚本会自动处理ADS嵌入、路径遍历构造和CRC重计算。
3.  **社会工程学投递:** 攻击者通过社会工程学手段（如钓鱼邮件、恶意网站下载等）将这个特制的恶意RAR文件发送给目标受害者。邮件或网站通常会附带高度定制化的、与目标相关的诱饵信息，诱导受害者打开并解压文件。
4.  **受害者解压文件:** 受害者在不经意间下载并使用受影响版本的WinRAR解压该恶意RAR文件。由于WinRAR的路径遍历漏洞，WinRAR会将隐藏在ADS中的恶意payload文件释放到攻击者指定的敏感目录（例如`C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\`）。
5.  **任意代码执行:** 如果payload被放置在启动文件夹中，当受害者下次启动计算机或登录系统时，操作系统会自动执行该恶意payload，从而实现攻击者在受害者系统上的任意代码执行，进而控制受害者机器。

**投毒风险分析:**
对该PoC代码的投毒风险评估为**低（10%）**。分析基于以下几个关键因素：
1.  **代码透明度高:** PoC代码是开源的Python脚本，逻辑清晰，易于阅读和审计。代码没有进行混淆处理，也没有使用难以理解的编程技巧，使得潜在的恶意行为难以隐藏。
2.  **标准库使用:** 代码主要使用了Python标准库，如`os`、`subprocess`、`struct`、`zlib`、`pathlib`和`argparse`。这些库都是Python环境中常见的、用于文件操作、进程管理、数据结构处理和命令行解析的合法工具。
3.  **无外部可疑连接:** PoC代码中没有发现任何尝试连接外部未知服务器、下载额外组件或执行可疑网络通信的行为。其操作完全在本地文件系统和通过`rar.exe`进程进行。
4.  **明确的教育和研究目的:** PoC的`README.md`文件中明确声明其用途是“仅用于教育目的、研究和实验环境”，并带有明确的警告：“请勿在您不拥有或未获得明确测试许可的系统上使用此代码”，以及“不用于恶意用途”。这种声明增强了代码的可信度。
5.  **功能符合描述:** PoC的核心功能是构建一个恶意的RAR文件，而非自身携带恶意载荷。它通过调用本地安装的`rar.exe`来创建RAR存档，然后通过字节级操作修改RAR头以实现路径遍历和ADS注入。这个过程与PoC的描述完全一致，没有发现超出其声明范围的额外功能。
6.  **无混淆或动态代码:** 代码中没有使用`eval()`、`exec()`等可能动态执行未经验证代码的函数，也没有使用复杂的加密或编码来隐藏其真实意图。
**结论:** 尽管PoC的最终目的是生成一个可用于攻击的恶意文件，但PoC本身作为工具是干净的。它没有试图隐藏恶意载荷、窃取信息或进行其他未经授权的行为。对于防御性安全研究人员而言，该PoC是安全可信的，可以在受控的实验环境中用于理解和复现漏洞，以便建立相应的防御措施。然而，在使用任何PoC时，始终建议在隔离的虚拟机或沙盒环境中进行，以防范任何不可预见的风险。

**项目地址:** https://github.com/walidpyh/CVE-2025-8088.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8088
