## CVE-2025-6018 - Linux (主要影响openSUSE Leap 15.x, SLES 15.x，CVE-2025-6019波及Ubuntu、Debian、Fedora等主流发行版) 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Linux (主要影响openSUSE Leap 15.x, SLES 15.x，CVE-2025-6019波及Ubuntu、Debian、Fedora等主流发行版)

**危害等级:** 高危

**CVSS评分:** Not available

**影响版本:** CVE-2025-6018: openSUSE Leap 15.x, SLES 15.x；CVE-2025-6019: 几乎所有主流Linux发行版（Ubuntu、Debian、Fedora、openSUSE等）

**利用条件:** 需要本地普通用户权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析：
该POC代码提供了一个针对CVE-2025-6018（PAM环境注入）和CVE-2025-6019（UDisks2权限提升）的完整三阶段利用链。代码用Bash编写，结构清晰，通过注释详细说明了每个阶段的目的。它明确针对openSUSE Leap 15.x和SUSE系统，并结合了公开的POC。Stage 1在攻击者机器上创建了一个恶意XFS文件系统镜像，其中包含一个带有SUID权限的bash二进制文件。Stage 2利用了PAM配置缺陷，在目标系统上注入了恶意环境变量，该漏洞源于PAM规则错误地将SSH/TTY会话视为本地控制台会话。Stage 3则利用了udisks守护进程在挂载文件系统时调用libblockdev库时的漏洞，结合Stage 2的环境注入，成功挂载恶意XFS镜像并执行SUID bash，从而获取root权限。该POC的逻辑严密，利用了Linux系统中两个不同组件的漏洞，通过链式攻击实现从本地普通用户到root的权限提升，具有很高的有效性。脚本中使用的命令（如mkfs.xfs、mount、pkexec、udisksctl）都是标准的Linux工具，进一步证实了其可行性。由于其自动化特性和清晰的步骤，对目标系统而言构成严重威胁。

利用步骤：
1.  **第一阶段 (攻击者机器 - Kali/Root)**：攻击者在控制机器（例如Kali Linux，需root权限）上执行POC脚本的第一部分。此阶段的核心任务是创建一个名为`image.xfs`的XFS文件系统镜像。该镜像内含一个精心制作的`bash`二进制文件，并为其设置了SUID（Set User ID）权限。这个带有SUID权限的bash将在后续步骤中作为提权载荷使用。
2.  **文件传输 (攻击者至目标)**：创建完成后，攻击者需将`image.xfs`文件传输至目标Linux系统。该文件必须放置在目标系统上，且可被一个本地的非特权用户访问。
3.  **第二阶段 (目标机器 - 本地普通用户)**：在目标Linux系统上，作为一名本地的非特权用户，攻击者执行POC脚本的第二部分。此阶段利用CVE-2025-6018漏洞，即PAM（Pluggable Authentication Modules）配置缺陷。该漏洞具体表现为，在受影响的openSUSE或SLES系统中，PAM规则错误地将SSH/TTY会话判断为“本地控制台”会话，从而允许攻击者注入恶意的环境变量。这些注入的环境变量为第三阶段的提权操作奠定了基础。
4.  **第三阶段 (目标机器 - 本地普通用户 → Root)**：在完成PAM环境注入后，攻击者继续以本地非特权用户的身份执行POC脚本的第三部分。此阶段利用CVE-2025-6019漏洞，该漏洞存在于udisks守护进程处理文件系统挂载的机制中（具体涉及到libblockdev库的调用）。通过结合第二阶段注入的环境变量，攻击者能够触发udisks服务以特权方式挂载之前传输的恶意`image.xfs`文件。一旦该文件系统被挂载，其中包含的SUID bash二进制文件便可被执行，从而赋予攻击者一个root权限的shell，完成权限提升。

投毒风险分析：
该POC代码的投毒风险被评估为低（10%）。主要基于以下几点考量：
*   **代码透明度与可读性**：POC采用Bash脚本语言编写，代码结构清晰，注释丰富。所有操作都直接在脚本中体现，没有使用代码混淆技术，这使得安全研究人员可以轻松审计其内部逻辑和行为。
*   **无外部依赖与下载**：脚本未发现有从外部URL下载或执行未知二进制文件或脚本的行为。所有操作均依赖于目标系统上的标准Linux工具和库，如`mkfs.xfs`、`mount`、`pkexec`、`udisksctl`和`bash`。这种自包含的特性降低了引入外部恶意载荷的风险。
*   **恶意行为的局限性**：POC的“恶意”行为完全围绕着实现本地权限提升这一核心目标。例如，创建带有SUID权限的bash二进制文件，以及利用PAM和udisks漏洞，都是为了达到获取root权限的目的，而非在提权后进行额外的、隐蔽的恶意操作，如数据窃取、僵尸网络加入、后门植入等超出漏洞利用范畴的行为。它是一种经典的、直接的LPE利用方式，其效果就是获取root shell，没有明显的旁路恶意代码。
*   **标准库与高危函数**：脚本主要调用系统命令，没有发现滥用`eval`或其他可能导致执行任意不可控输入的高危函数。其对环境变量的修改是针对特定漏洞利用的，而非泛滥式的。
综上所述，该POC旨在合法地演示和利用已披露的漏洞，不包含额外的、隐蔽的恶意载荷或超出其提权目的的行为。在隔离环境中进行分析和测试是安全的，但由于其权限提升的性质，仍需谨慎操作以避免对测试环境造成意外影响。

**项目地址:** Not available (combined from public PoCs)

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
