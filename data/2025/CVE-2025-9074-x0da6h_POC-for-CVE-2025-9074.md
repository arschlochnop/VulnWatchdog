## CVE-2025-9074 - Docker Desktop 未授权访问/容器逃逸

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 未授权访问/容器逃逸

**影响应用:** Docker Desktop

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** < 4.44.3

**利用条件:** 需要恶意Linux容器在本地Docker Desktop环境中运行；无需认证即可通过默认子网192.168.65.7:2375访问Docker Engine API；不依赖挂载或特定的隔离设置

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个影响Docker Desktop应用程序的高危安全漏洞，其CVSS评分为9.3。该漏洞允许在Windows和macOS系统上运行的Docker Desktop中的恶意Linux容器绕过隔离机制，从而未授权访问宿主机上的Docker Engine API。这意味着攻击者可以利用此漏洞突破容器的沙箱环境，对宿主机执行任意操作，最终实现宿主机的完全控制。Docker官方已于2025年8月20日在Docker Desktop 4.44.3版本中修复了此漏洞，因此所有低于此版本的Docker Desktop实例均受影响。

该漏洞的核心在于Docker Desktop的容器隔离机制存在缺陷，导致本地运行的容器能够通过默认子网（通常是192.168.65.7:2375）直接连接到未受保护的Docker Engine API。值得注意的是，这种访问不依赖于用户是否启用了“Expose daemon on tcp://localhost:2375 without TLS”选项，也不受增强容器隔离（Enhanced Container Isolation, ECI）功能的影响，这意味着即使在默认或看似更安全的配置下，系统也可能面临风险。

提供的POC代码是一个名为`POC-for-CVE-2025-9074.sh`的Bash shell脚本，它完美地演示了如何利用这个未授权访问漏洞，在受感染的宿主机上实现任意文件的读写操作。脚本设计精巧，提供了`-read`和`-write`两个功能选项，分别用于从宿主机读取指定文件内容或向指定文件写入内容。

脚本首先定义了目标Docker Engine API的IP地址和端口（默认为192.168.65.7:2375），以及一个用于创建临时容器的基础镜像（默认为alpine）。在执行文件操作前，脚本会通过向`/_ping`和`/version`端点发送HTTP GET请求来验证Docker Engine API的可访问性，并获取Docker引擎的版本和操作系统信息。

其关键的漏洞利用机制体现在对`convert_path`函数的巧妙运用以及Docker容器创建请求的构造上。`convert_path`函数负责将用户提供的Windows路径（例如`C:/Windows/System32/drivers/etc/hosts`）转换为Linux格式的路径（例如`/mnt/host/c/Windows/System32/drivers/etc/hosts`），这是因为Docker Desktop在内部将宿主机的磁盘挂载为特定的Linux路径结构。

随后，脚本构建了一个JSON格式的Docker API请求负载，用于创建一个新的容器。这个请求的核心是`HostConfig.Binds`参数，它允许攻击者将宿主机上的任意目录（例如，包含目标文件的父目录）挂载到新创建的恶意容器内部的指定路径（例如`/host_root`）。通过这种方式，恶意容器便拥有了对宿主机文件系统的特定访问权限。

接着，脚本将容器的`Cmd`参数设置为一个shell命令，该命令根据攻击者的操作意图执行相应的任务：
- 如果是`-read`操作，`Cmd`会被设置为`sh -c "cat '$MOount_PATH/$FILE_BASENAME'"`，从而在新容器内读取挂载目录下指定文件的内容。
- 如果是`-write`操作，`Cmd`会被设置为`sh -c "printf '%s' '$CONTENT' > '$MOUNT_PATH/$FILE_BASENAME'"`，将指定内容写入到挂载目录下指定的文件中。

POC脚本使用`curl`工具向`/containers/create` API端点发送`POST`请求以创建上述配置的容器，然后向`/containers/$CID/start`端点发送`POST`请求启动该容器。如果是读取操作，脚本会在短暂等待后，通过向`/containers/$CID/logs?stdout=1&stderr=1`端点发送`GET`请求来获取并打印容器的执行日志，从而间接获取到宿主机文件的内容。最后，脚本会发送`DELETE /containers/$CID?force=1`请求来强制移除创建的临时容器，实现操作后的清理。

综上所述，该POC代码完整、有效且清晰地展示了CVE-2025-9074漏洞的利用方式，通过未授权访问Docker Engine API并结合卷挂载能力，成功实现了从容器内部对Docker Desktop宿主机文件系统的任意读写，从而证实了容器逃逸的可能性和高危危害。此POC是评估该漏洞威胁等级和构建防御措施的重要参考。


**利用步骤:**
1.  攻击者首先需要能够在一个Docker Desktop环境中运行一个恶意的Linux容器。这可以通过多种方式实现，例如通过诱骗用户运行恶意镜像，或利用其他漏洞在现有容器中植入恶意代码。
2.  一旦恶意容器运行，攻击者在容器内部执行POC脚本（例如`bash POC-for-CVE-2025-9074.sh -read "C:/Windows/System32/drivers/etc/hosts"`或`bash POC-for-CVE-2025-9074.sh -write "new content" "C:/path/to/file.txt"`）。
3.  POC脚本首先尝试通过默认子网 `192.168.65.7:2375` 直接访问宿主机的Docker Engine API。
4.  脚本通过发送 `/_ping` 和 `/version` 请求来验证API的可访问性。
5.  根据攻击者的意图（读取或写入文件），脚本构建一个特殊的Docker容器创建请求。该请求的关键在于使用 `HostConfig.Binds` 参数，将宿主机的任意目录（通过 `convert_path` 函数将Windows路径转换为Linux挂载路径）挂载到新创建的恶意容器内部的指定路径（例如`/host_root`）。
6.  新容器的 `Cmd` 参数被设置为执行文件读取（`cat` 命令）或文件写入（`printf` 命令）操作，目标文件位于挂载的宿主机目录中。
7.  脚本发送 `POST /containers/create` 请求创建该特殊容器，然后 `POST /containers/$CID/start` 启动它。
8.  如果执行的是读取操作，脚本会紧接着发送 `GET /containers/$CID/logs` 请求，获取文件内容并打印输出。
9.  无论读取还是写入，最后脚本都会发送 `DELETE /containers/$CID?force=1` 请求，强制移除创建的临时容器，清理痕迹。
10. 攻击者通过此过程即可在宿主机上实现任意文件读写，进一步可导致宿主机完全控制。


**投毒风险分析:**
对提供的POC代码`POC-for-CVE-2025-9074.sh`进行投毒风险分析后，可以判定其投毒风险为极低，定为10%。

首先，该POC是一个基于Bash shell的脚本，其代码结构清晰，逻辑透明，没有任何形式的代码混淆。所有的操作都直接以明文形式呈现在脚本中，易于人工审计和理解。

其次，脚本所依赖的工具均为Linux系统上标准且普遍存在的命令行工具，包括`curl`（用于HTTP请求）、`sed`（用于文本流编辑）、`cut`（用于文本切割）、`basename`（用于获取文件或目录的基本名称）、`dirname`（用于获取文件或目录的路径名）、`tr`（用于字符转换）、`printf`（用于格式化输出）和`cat`（用于文件连接和打印）。脚本没有引入任何外部的、非标准的或可疑的第三方库、依赖项或二进制文件。这意味着它不依赖于通过外部链接下载的代码，从而避免了供应链投毒的风险。

在网络行为方面，该POC脚本的核心操作是通过`curl`向预设的Docker Engine API地址（默认为192.168.65.7:2375）发送HTTP请求。这个地址是Docker Desktop在宿主机上暴露给容器的内部API接口，是漏洞利用的必要组成部分。脚本中没有发现任何试图连接到其他可疑IP地址、域名或下载未知内容的网络请求。所有网络通信都是针对目标漏洞本身，没有额外的“回调”或数据外泄尝试。

在代码功能方面，脚本的唯一目的是演示CVE-2025-9074漏洞如何实现对宿主机文件的读写。它精确地构造Docker API请求，并在容器内部执行`cat`或`printf`命令。这些命令的行为是明确的，并且与漏洞利用的既定目标完全一致。代码中没有发现任何额外的恶意负载，例如植入后门、启动僵尸网络客户端、进行加密货币挖矿或收集用户敏感信息并外传的代码。用于文件操作的`printf %s`命令也特意避免了末尾换行，体现了作者对精确控制的重视，这与恶意代码通常倾向于隐蔽性和破坏性的特性形成对比。

总结来说，该POC代码是针对特定漏洞的纯粹功能性验证工具。它完全符合“概念验证”或“完整利用”的定义，其设计目的是帮助安全研究人员和防御者理解和复现漏洞，以便加强防御。代码的透明性、对标准工具的依赖以及缺乏任何可疑的外部通信或隐藏行为，都表明其投毒风险极低。用户在执行任何POC时，仍应保持警惕并建议在隔离环境中进行，但就该POC本身而言，其安全性是值得信赖的。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
