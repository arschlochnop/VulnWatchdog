## CVE-2025-9074 - Docker Desktop 容器逃逸/越权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop <= 4.44.2 (修复于2025年8月20日的4.44.3版本)

**利用条件:** 需要本地运行恶意容器，该容器可访问Docker Engine API（通常在默认内部子网192.168.65.7:2375上），且无需额外认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

#### POC有效性分析

所提供的POC脚本`POC-for-CVE-2025-9074.sh`是一个针对Docker Desktop (Windows和macOS版本) CVE-2025-9074容器逃逸漏洞的有效且设计良好的演示工具。该漏洞的核心在于Docker Desktop默认将Docker Engine API暴露在其内部子网（通常是`192.168.65.7:2375`）上，且未强制执行认证机制。攻击者一旦能够在目标系统上运行一个恶意Linux容器，即可利用此配置实现对宿主机的越权访问。

该脚本的有效性体现在以下几个方面：
1.  **API交互能力**：POC使用`curl`命令直接与Docker Engine API进行HTTP通信，验证了其对API的访问能力。首先通过`/_ping`和`/version`端点进行连接性及版本探测，确保API可达且处于预期状态。
2.  **关键漏洞利用机制**：脚本的核心在于通过API创建新容器时，恶意利用`HostConfig.Binds`参数。它能够将宿主机上的任意指定目录（如`C:\`或`C:\Windows`下的任意路径）通过绑定挂载(bind mount)映射到新创建容器内部的一个指定路径（默认为`/host_root`）。这一步骤是实现容器逃逸、突破隔离的关键。
3.  **双向操作演示**：POC清晰地演示了该漏洞的两种主要攻击能力：
    *   **文件读取 (`-read`动作)**：通过在挂载了宿主机目录的容器内执行`cat`命令，成功读取宿主机上目标文件的内容，并将其输出从容器日志中捕获。
    *   **文件写入 (`-write`动作)**：通过在容器内执行`printf`命令，将任意内容写入宿主机上目标文件，直接修改宿主机文件系统。
4.  **跨平台路径处理**：脚本包含了一个精巧的`convert_path`函数，能够将Windows风格的路径（例如`C:/path/to/file.txt`）正确转换为Docker Desktop底层Linux VM所理解的路径格式（例如`/mnt/host/c/path/to/file.txt`）。这极大增强了POC在Windows主机环境下的可用性和鲁棒性，证明了开发者对Docker Desktop内部机制的深入理解。
5.  **自动化与清理**：POC脚本实现了容器的创建、启动、操作以及最终的强制移除（`DELETE /containers/$CID?force=1`），整个过程自动化且具有清理机制，减少了攻击痕迹，方便了漏洞验证。

综上所述，该POC脚本从技术实现到功能演示都高度有效，完整复现了CVE-2025-9074漏洞的利用链，能够可靠地证明攻击者在恶意容器内部实现宿主机文件系统读写的能力，从而达到容器逃逸的目的。它是一个功能完善、易于理解和验证的漏洞利用工具。

#### 利用步骤

1.  **前提条件**：攻击者需首先在目标Windows或macOS系统上获得执行恶意Linux容器的能力。这通常意味着攻击者已通过其他初始访问手段（如钓鱼、恶意软件投放等）使受害者运行了其控制的容器。
2.  **内部网络侦察**：在恶意容器内部，攻击者识别Docker Engine API的内部网络地址和端口，对于Docker Desktop，默认通常是`192.168.65.7:2375`。
3.  **API探测**：恶意容器通过`curl`等工具向`http://192.168.65.7:2375/_ping`或`/version`端点发送请求，确认Docker Engine API可达且无需认证即可访问。
4.  **构造恶意容器创建请求**：攻击者精心构造一个JSON格式的请求体，用于调用Docker Engine API的`/containers/create`端点。请求中包含：
    *   `Image`：指定一个用于执行命令的基础镜像（例如`alpine`）。
    *   `HostConfig.Binds`：这是利用漏洞的关键。攻击者在此参数中指定将宿主机上的任意目录路径（例如`C:\`或`C:\Windows\System32`）以绑定挂载的形式映射到新容器内部的某个路径（例如`/host_root`）。例如，`"C:/Windows:/host_root"`。
    *   `Cmd`：在新容器启动后要执行的命令。根据攻击目的，可以是读取文件 (`"sh", "-c", "cat /host_root/System32/drivers/etc/hosts"`) 或写入文件 (`"sh", "-c", "printf 'malicious content' > /host_root/some_file.txt"`)。
5.  **执行API请求**：通过`curl -X POST -H "Content-Type: application/json" -d "<构造的JSON>" http://192.168.65.7:2375/containers/create`发送请求，创建新容器。
6.  **启动容器**：获取新创建容器的ID后，通过`curl -X POST http://192.168.65.7:2375/containers/<容器ID>/start`启动容器，执行预设的命令。
7.  **获取结果与清理**：
    *   如果执行的是读取操作，攻击者可以从新容器的日志中获取到宿主机文件的内容，通过`curl http://192.168.65.7:2375/containers/<容器ID>/logs?stdout=1`。
    *   如果执行的是写入操作，宿主机上的目标文件将被修改。
    *   攻击完成后，为隐藏痕迹，攻击者通常会通过`curl -X DELETE http://192.168.65.7:2375/containers/<容器ID>?force=1`移除新创建的容器。

#### 投毒风险分析

对`POC-for-CVE-2025-9074.sh`脚本的投毒风险评估为极低，具体百分比为5%。这种低风险评级基于对脚本代码内容的全面审查和行为分析。脚本的每一行代码都是可读且易于理解的，它没有采用任何代码混淆、加密或复杂的间接执行机制，这使得安全研究人员可以清晰地追踪其执行流程和预期功能。

该POC脚本的核心操作集中于利用标准的`curl`命令与Docker Engine API进行交互，以及在容器内部执行基本的Shell命令（`cat`、`printf`）。这些操作都是公开的、可验证的，且与CVE-2025-9074漏洞的利用逻辑完全一致。脚本没有包含任何尝试下载和执行外部恶意负载、连接未知远程服务器、修改系统关键配置（如`/etc/hosts`、`/etc/passwd`，除非作为漏洞演示目标）、植入持久化后门或进行任何形式的数据窃取的指令。

脚本中明确的日志输出（如`[+] Targeting Docker HTTP API at $BASE_URL`、`[+] Windows path: $WIN_PATH`等）进一步增强了其透明度。这些信息有助于用户在运行前了解脚本将要执行的操作和目标。此外，脚本在完成利用演示后会主动清理所创建的容器，这表明其意图是用于测试和验证，而非长期驻留或隐蔽活动。

尽管任何可执行代码都存在理论上的风险，但对于此POC而言，其清晰、直接和高度聚焦于漏洞验证的特性，使其成为一个安全可靠的研究工具。用户在运行此POC时，可以基本确信其不会引入额外的恶意代码或执行超出预期范围的危险操作。风险主要集中在漏洞利用本身（即宿主机文件读写），这正是POC的目的所在，不应将其误判为投毒行为。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
