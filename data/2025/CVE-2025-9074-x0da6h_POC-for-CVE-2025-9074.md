## CVE-2025-9074 - Docker Desktop 容器逃逸/越权访问 (Container Escape/Privilege Escalation)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问 (Container Escape/Privilege Escalation)

**影响应用:** Docker Desktop

**危害等级:** 高危 (High)

**CVSS评分:** 9.3

**影响版本:** 影响Windows和macOS版本的Docker Desktop，版本低于4.44.3 (已于2025年8月20日修复)

**利用条件:** 需要本地运行恶意Linux容器，恶意容器可通过默认子网访问Docker Engine API，不依赖挂载Docker socket。攻击复杂度较低。

**POC 可用性:** 10/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是针对Docker Desktop for Windows和macOS的一个关键容器逃逸漏洞。该漏洞允许在本地运行的恶意Linux容器绕过隔离机制，通过默认子网（通常为192.168.65.7:2375）直接访问Docker Engine API。与许多容器逃逸漏洞不同，它不依赖于将Docker socket挂载到容器中。成功利用此漏洞，攻击者可以在宿主机系统上执行任意文件读写操作，从而导致完全的宿主机控制。该漏洞的严重评分为9.3（满分10分），影响Docker Desktop 4.44.3版本之前的所有版本，该修复版本已于2025年8月20日发布。此漏洞由安全研究员Felix Boulet偶然发现，他在注意到其他虚拟机软件存在类似问题后，对Docker Desktop的默认配置进行了检查，从而发现了这一缺陷。

提供的概念验证（POC）脚本 `POC-for-CVE-2025-9074.sh` 高度有效，并演示了对该漏洞的完整利用。这是一个结构良好的shell脚本，它利用 `curl` 直接与Docker Engine HTTP API进行交互。该脚本具有健壮的路径转换逻辑，能够将Windows风格的路径（例如，“C:/path/to/file.txt”）转换为适用于Linux容器中绑定挂载的格式（例如，“/mnt/host/c/path/to/file.txt”）。这确保了在Docker Desktop上进行跨平台利用的适用性。POC成功实现了在宿主机系统上的文件读取和写入功能。它首先通过 `_ping` 请求验证与Docker API端点的连接性。随后，它会创建一个用于创建新Docker容器的JSON负载。此负载包含一个关键的 `HostConfig.Binds` 条目，该条目将宿主机系统上的选定目录（源自目标Windows路径）映射到新容器内部的路径。该漏洞利用的核心在于在新创建的容器中执行命令（`cat` 用于读取，`printf` 用于写入），该容器直接绑定挂载了宿主机的目录。执行命令并检索日志（对于读取操作）后，脚本会细致地通过停止和删除临时容器来清理，确保痕迹最小化。其全面的功能和清晰的实现使其成为展示漏洞影响的绝佳演示。

CVE-2025-9074的利用通常涉及几个关键步骤。首先，攻击者必须能够在受漏洞影响的Docker Desktop安装上，在Docker容器内执行任意代码。这种初始访问可能源于多种来源，例如容器中运行的受损Web应用程序、从不受信任的注册表拉取的恶意Docker镜像，或内部威胁。一旦在容器内获得代码执行权限，攻击者便可以启动利用序列。提供的POC脚本简化了此过程：
1.  **初始访问**：攻击者必须在目标Docker Desktop实例上任何正在运行的Docker容器内实现远程代码执行（RCE）或本地代码执行。
2.  **API发现**：从受损容器内部，攻击者可以尝试访问Docker Engine HTTP API，该API在内部子网（默认在 `http://192.168.65.7:2375`）上默认暴露。POC脚本使用简单的 `_ping` 请求验证此连接性。
3.  **负载构造**：攻击者构造一个Docker API请求以创建新容器。此请求包含关键元素：一个基础镜像（例如 `alpine`）、一个要执行的命令（例如 `cat` 或 `printf`），以及至关重要的是 `HostConfig.Binds` 配置。此绑定挂载将Docker Desktop宿主机系统上的特定目录（例如 `C:\`）映射到攻击者新创建容器内的挂载点（例如 `/host_root`）。
4.  **容器创建和执行**：构造好的负载被发送到Docker Engine API的 `/containers/create` 端点。成功创建后，会发送一个后续的 `POST` 请求到 `/containers/$CID/start` 以启动这个特别构造的容器。
5.  **宿主机交互**：一旦容器启动，预定义的命令（例如 `cat /host_root/Windows/System32/drivers/etc/hosts`）就会执行，允许攻击者从宿主机系统读取任意文件或向宿主机文件写入新内容。输出（对于读取操作）从容器日志中捕获。
6.  **清理**：为了隐蔽性和资源管理，攻击者（或POC脚本）通常在操作完成后移除临时容器。整个过程允许攻击者实现对宿主机系统的完全控制，绕过容器隔离并可能提升权限。

与提供的 `POC-for-CVE-2025-9074.sh` 脚本相关的投毒风险非常低（估计为0-29%）。此评估基于对脚本代码、其依赖项及其操作行为的全面审查。该脚本完全开源，以人类可读的shell脚本格式编写，这有助于轻松审计和理解其功能。它严格使用标准的Unix实用程序和shell命令，例如 `set`、`echo`、`usage`、`shift`、`printf`、`sed`、`tr`、`basename`、`dirname`、`curl`、`cat` 和 `cut`。这些都是Linux环境中通常存在的基本工具，本身不与恶意意图相关联。
脚本的网络交互仅限于Docker Engine HTTP API端点，默认指定为 `http://192.168.65.7:2375`。没有对未知或可疑域的外部调用，没有尝试从互联网下载额外的负载，也没有使用混淆代码来隐藏恶意功能。它不以不受控制的方式使用 `eval` 或其他危险函数，这可能导致来自不受信任源的任意代码执行。其逻辑主要集中在构造和发送合法的Docker API请求，以演示漏洞中固有的容器逃逸、文件读取和文件写入功能。容器的创建和删除是标准的Docker操作，尽管在此上下文中被利用。该脚本不安装持久性后门、不修改超出明确读写目标的系统文件，也不表现出任何供应链攻击或嵌入式恶意软件的行为。其主要目的是用于合法的漏洞研究和测试，使其在受控的防御性安全环境中安全使用。用户可以逐行审查脚本以验证其良性性质，然后执行。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-9074
