## CVE-2025-2304 - Camaleon CMS Mass Assignment Privilege Escalation

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Mass Assignment Privilege Escalation

**影响应用:** Camaleon CMS

**危害等级:** Critical

**CVSS评分:** Not Available

**影响版本:** < 2.9.1

**利用条件:** Requires authentication, network access

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** Medium

**投毒风险:** 5%

## 详情

POC有效性分析
该POC脚本（CVE-2025-2304.py）旨在验证和利用Camaleon CMS中存在的批量赋值（Mass Assignment）权限提升漏洞，CVE编号为CVE-2025-2304。根据POC代码注释，此漏洞影响Camaleon CMS版本低于2.9.1。漏洞的核心在于updated_ajax端点不当地使用了permit!，导致所有传入的参数在未经严格过滤的情况下被处理。攻击者可以利用此机制，在修改用户密码时注入额外的参数，例如password[role]=admin，从而将当前已认证用户的角色提升至管理员级别。

该Python脚本的实现逻辑清晰且功能完整。它首先通过get_csrf_token函数从登录页面或编辑资料页面提取CSRF令牌，这对于成功提交表单至关重要。接着，login函数使用提供的用户名和密码进行身份验证，并通过检查响应URL是否包含"dashboard"或"profile"来确认登录状态。随后，get_user_info函数会访问用户个人资料编辑页面（/admin/profile/edit），并利用正则表达式和BeautifulSoup库解析HTML内容，以提取当前用户的ID和现有角色。这些信息对于后续的漏洞利用至关重要，特别是用户ID，它指定了要修改的用户。

核心的exploit函数构建了一个精心设计的POST请求，发送至/admin/profile/update_ajax端点。此请求不仅包含用户的新密码，还巧妙地注入了user[password][role]=admin参数。由于目标端点存在批量赋值漏洞，role参数被直接写入数据库，从而实现权限提升。脚本在发送利用请求后，会再次调用get_user_info来验证用户角色是否已成功更改为"admin"，这提供了清晰的利用成功指示。整个流程自动化、模块化，且使用了成熟的Python库（requests、BeautifulSoup），使其具有很高的可靠性和可用性。这种详细而分步的实现极大地增加了POC的有效性和可信度。

利用步骤
利用此CVE-2025-2304漏洞的步骤如下：
1.  **前提条件**：攻击者需要拥有一个目标Camaleon CMS系统上的有效认证用户凭据（用户名和密码）。目标CMS的版本必须低于2.9.1。此外，攻击者需要能够通过网络访问到CMS的管理界面。
2.  **环境配置**：攻击者需要准备Python 3环境，并安装必要的库（如`requests`和`BeautifulSoup4`）。POC脚本需要从命令行接收目标URL、用户名和密码作为参数。
3.  **获取CSRF令牌**：POC脚本首先会自动向目标CMS的`/admin/login`页面发送GET请求，解析页面内容以提取CSRF（跨站请求伪造）令牌。这个令牌是防止CSRF攻击的安全机制，但在许多Web应用中，它必须包含在随后的POST请求中才能通过验证。
4.  **用户登录**：脚本随后会使用前面获取的CSRF令牌、提供的用户名和密码，向`/admin/login`端点发送POST请求，尝试登录到CMS。如果登录成功，脚本将保持会话状态以供后续操作。
5.  **获取用户ID和当前角色**：登录成功后，脚本会向`/admin/profile/edit`页面发送GET请求。通过解析此页面的HTML内容，脚本能够提取当前登录用户的唯一ID以及其当前的权限角色。用户ID是执行批量赋值攻击的关键，因为它指定了要更新哪个用户的配置文件。
6.  **权限提升利用**：这是攻击的核心步骤。脚本会构造一个POST请求，目标是`/admin/profile/update_ajax`端点。这个请求的payload中除了包含用户ID和可能的新密码外，最关键的是注入了一个额外的参数：`user[password][role]=admin`。由于Camaleon CMS在处理此更新请求时存在批量赋值漏洞，它会直接处理并保存`role`参数，从而将当前用户的权限从普通用户提升至管理员。
7.  **验证攻击结果**：为了确认权限提升是否成功，脚本会再次尝试获取用户的角色信息。如果新的角色显示为“admin”，则表明漏洞利用成功，攻击者现在已拥有管理员权限。
通过以上自动化步骤，攻击者可以在获得任意有效用户凭据的前提下，快速实现对Camaleon CMS系统的管理员权限控制，从而对系统造成严重影响。

投毒风险分析
此Python POC脚本（CVE-2025-2304.py）旨在演示Camaleon CMS的批量赋值权限提升漏洞。在投毒风险方面，可以评估为**低风险**（例如：5%）。
评估依据如下：
*   **代码透明度和可读性**：脚本的代码结构清晰，逻辑简单直接，没有使用任何混淆技术。所有功能（如获取CSRF令牌、登录、获取用户信息、执行漏洞利用）都封装在独立的函数中，易于理解和审计。
*   **依赖库**：脚本仅依赖于标准的Python库，包括`requests`（用于HTTP请求）、`BeautifulSoup`（用于HTML解析）、`argparse`（用于命令行参数解析）和`re`（用于正则表达式匹配）。这些都是广泛使用的、经过社区验证的、低风险的第三方库。脚本没有引入任何不常见的或可疑的外部依赖。
*   **恶意行为缺失**：脚本的目的明确且单一，即利用Camaleon CMS的特定漏洞进行权限提升。在代码中，没有发现任何试图执行以下恶意行为的迹象：
    *   下载并执行来自未知或可疑来源的外部代码。
    *   尝试与除目标CMS之外的C2（命令与控制）服务器进行通信。
    *   在本地系统上安装后门、恶意软件或持久化机制。
    *   收集敏感的用户系统信息并外传。
    *   对用户系统进行破坏性操作（如删除文件、修改系统配置）。
    *   使用`eval()`或其他动态代码执行函数来处理不受信任的输入，从而引入潜在的注入风险。
*   **网络活动**：脚本的所有网络请求都明确指向命令行参数指定的目标CMS，且请求内容与其宣称的漏洞利用逻辑完全一致，未发现任何额外或可疑的网络连接。
*   **防范措施**：尽管该POC的投毒风险极低，但作为安全研究的最佳实践，建议任何用户在运行从互联网上获取的任何POC代码之前，都应仔细审查其源代码，并在隔离的、沙盒化的环境中进行测试。对于自动化测试环境，应确保POC的哈希值与已知可信来源的哈希值一致，以防供应链攻击或代码篡改。

总结来说，此POC脚本是一个相对安全、透明且专注于其声明目的的工具。其设计和实现方式大大降低了其自身被用于恶意投毒的风险。

**项目地址:** Not Available

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
