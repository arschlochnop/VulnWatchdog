## CVE-2025-2304 - Camaleon CMS 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H (8.8 High)

**影响版本:** 小于 2.9.1

**利用条件:** 需要认证 (Authenticated Access), 网络可达 (Network Accessible)

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

对提供的POC代码进行分析后，评估其投毒风险为低 (5%)。该POC代码表现出良好的安全实践，没有发现任何可疑或恶意的行为模式。它专注于漏洞的验证和利用，没有集成任何额外的投毒功能。因此，将其用于合法的安全测试或漏洞复现时，引发安全事件或造成意外损害的风险极低。建议在使用前仍进行沙箱环境测试以确保完全安全。

POC有效性分析：
提供的Python脚本 `CVE-2025-2304.py` 是一个完整且有效的概念验证 (POC) 工具，用于利用Camaleon CMS中的Mass Assignment权限提升漏洞 (CVE-2025-2304)。该漏洞源于 `updated_ajax` 端点对参数处理不当，特别是在其中使用 `permit!` 方法，导致所有参数未经充分过滤便被允许通过。这一设计缺陷使得一个已认证的低权限用户能够通过在密码更改操作中注入任意的 `role` 参数，从而将其权限提升至管理员级别。

该POC脚本结构良好，清晰地演示了漏洞利用的各个步骤。它首先定义了与目标Camaleon CMS实例交互所需的核心函数。`get_csrf_token` 函数对于绕过CSRF保护至关重要，它能智能地从页面元标签 (`csrf-token`) 或输入字段 (`authenticity_token`) 中提取CSRF令牌，确保了在不同页面结构下的健壮性。

在成功获取CSRF令牌后，`login` 函数负责用户认证。这是漏洞利用的关键前置条件，因为该漏洞要求一个已认证的会话。该函数向 `/admin/login` 端点发送POST请求，其中包含提供的用户名、密码和获取到的CSRF令牌。它通过检查重定向到“dashboard”或“profile”页面等迹象来判断登录是否成功，并向用户提供明确的反馈。

成功认证后，脚本会调用 `get_user_info` 函数来检索当前用户的ID和角色。用户ID对于构造个人资料更新URL至关重要，而角色信息主要用于漏洞利用前的检查或利用后的验证。这一步骤增加了脚本的完整性，有助于确认目标用户的初始状态。

漏洞利用的核心逻辑位于 `exploit` 函数中。在此函数中，脚本构造了一个恶意payload，利用了Mass Assignment漏洞。关键要素是在发送到 `/admin/profile/updated_ajax` 端点的数据中包含 `user[password][role]=admin` 参数。尽管此参数是 `password` 结构的一部分，但由于应用程序使用了 `params.require(:password).permit!` 方法，未能限制可进行Mass Assignment的字段，因此该参数仍然会被处理。通过同时包含 `user[password][password]` 和 `user[password][password_confirmation]` 字段，脚本在更改用户密码的同时注入了 `role=admin` 参数，从而成功获取了管理员权限。脚本还正确设置了 `X-CSRF-Token` 请求头，确保请求被服务器接受。最后，脚本通过重新获取用户信息并检查角色是否已更新为“admin”来验证权限提升的成功。

总而言之，该POC非常有效。它完全自动化了从初始认证到权限提升和验证的整个利用过程。使用标准的Python库 (`requests`、`BeautifulSoup`) 使其易于运行，并且其清晰的输出能够立即反馈漏洞利用的成功或失败。该脚本精确地针对漏洞描述的机制进行攻击，证实了其作为一个完整利用程序的有效性。

利用步骤：
1. 确保目标Camaleon CMS版本低于2.9.1。
2. 获取一个已认证的低权限用户账号和密码。
3. 在Python 3环境中运行POC脚本，例如：`python3 CVE-2025-2304.py http://[TARGET_URL] -u [USERNAME] -p [PASSWORD]`
4. 脚本将自动执行登录、获取CSRF token、发送恶意mass assignment请求，并将当前用户的角色提升为管理员。
5. 脚本执行完成后，将输出登录状态、用户ID、原始角色和新的角色（如果提升成功，则显示"admin"）。

投毒风险分析：
对提供的POC代码进行分析后，评估其投毒风险为**低 (5%)**。以下是详细的风险评估：

1. **代码来源与可靠性**：POC代码直接在本地文件系统路径 `/tmp/vulnwatchdog_.../CVE-2025-2304.py` 中给出，表明它可能是一个合法分析过程中的产物。它旨在演示漏洞，而非从不可信的第三方来源复制。这种直接性和本地性降低了在传输或下载过程中被篡改的风险。

2. **依赖项分析**：脚本仅使用了Python标准库和少数常见的第三方库：`sys`、`requests`、`argparse`、`re`、`bs4` (BeautifulSoup) 和 `urllib.parse`。这些都是广泛使用且经过社区审查的库，没有迹象表明它们存在已知恶意行为或被用于投毒。脚本没有动态下载或执行外部代码，所有依赖项都应预先安装在执行环境中。

3. **代码行为分析**：
   *   **无混淆**：代码是清晰、可读的Python脚本，未使用任何形式的代码混淆技术（如base64编码、加密字符串或不必要的字符替换）。这使得安全研究人员可以轻松地审查其完整功能。
   *   **无恶意payload**：脚本的核心逻辑是构造HTTP POST请求以利用Mass Assignment漏洞，将用户角色从低权限提升到管理员。它不包含任何额外的恶意payload，例如 shellcode、反向shell连接、数据窃取、挖矿代码、勒索软件指令或擦除系统文件等行为。其目的是明确的：漏洞利用而非恶意破坏。
   *   **无外部连接**：除了与目标Camaleon CMS服务器进行HTTP(S)通信外，脚本不尝试连接任何其他外部IP地址或域名。这意味着它不会向攻击者控制的C2服务器发送数据或接收进一步的指令。
   *   **无系统级操作**：脚本的操作范围严格限制在HTTP请求和响应处理上。它不尝试读取、写入或修改本地文件系统，不执行系统命令 (`os.system` 或 `subprocess` 调用)，也不修改系统配置。

综上所述，该POC代码表现出良好的安全实践，没有发现任何可疑或恶意的行为模式。它专注于漏洞的验证和利用，没有集成任何额外的投毒功能。因此，将其用于合法的安全测试或漏洞复现时，引发安全事件或造成意外损害的风险极低。

**项目地址:** 

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-2304
