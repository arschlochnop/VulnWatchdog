## CVE-2025-2304 - Camaleon CMS Privilege Escalation (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Privilege Escalation (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危 (High)

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (Authenticated Access Required), 网络访问 (Network Access)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

CVE-2025-2304 是 Camaleon CMS 中存在的一个质量赋值导致的权限提升漏洞。该漏洞影响 Camaleon CMS 版本低于 2.9.1。当一个已认证的用户试图更新其配置文件时，由于 `/admin/profile/updated_ajax` 端点在处理用户传入的参数时使用了 `permit!` 而没有进行充分的过滤，攻击者可以注入如 `password[role]=admin` 这样的恶意参数，从而将自己的角色从普通用户提升为管理员。

**POC 有效性分析:**
提供的 Python POC 脚本 `CVE-2025-2304.py` 是一个功能完整且高质量的利用工具。该脚本设计精良，具备以下主要功能模块：
1.  **参数解析:** 使用 `argparse` 模块，清晰地定义了目标 URL、用户名和密码等必需的命令行参数，便于用户指定目标和凭据。
2.  **CSRF Token 获取:** `get_csrf_token` 函数负责从目标页面（如登录页面或用户资料编辑页面）的 HTML 内容中提取 CSRF token。它会查找 `<meta name="csrf-token">` 标签或名为 `authenticity_token` 的隐藏输入字段。这是因为许多 Web 应用程序使用 CSRF token 来防御跨站请求伪造，获取它是成功进行后续认证和请求的关键步骤。
3.  **用户认证:** `login` 函数通过向 `/admin/login` 端点发送 POST 请求来模拟用户登录。在发送请求前，它会调用 `get_csrf_token` 获取登录页面的 CSRF token，并将用户名、密码和 CSRF token 一同提交。登录成功后，通过检查响应 URL 是否包含 "dashboard" 或 "profile" 来确认登录状态，提供清晰的反馈。
4.  **用户信息获取:** `get_user_info` 函数用于访问 `/admin/profile/edit` 页面，从页面内容中解析出当前会话用户的 ID 和现有角色。用户 ID 通常通过正则表达式从页面中提取，而角色则从 `<select name="user[role]">` 元素的 `selected` 选项中获取。此步骤对于验证漏洞利用前的状态以及利用后的权限变更至关重要。
5.  **核心利用逻辑:** `exploit` 函数是实现权限提升的关键。它向 `/admin/profile/updated_ajax` 端点发送一个特制的 POST 请求。该请求的数据包含用户的当前密码、希望设置的新密码（即使与旧密码相同也无妨）以及至关重要的恶意参数 `password[role]=admin`。由于 Camaleon CMS 在此端点处理 `password` 及其子参数时使用了过于宽泛的 `permit!` 规则，导致 `role` 参数被不当地接受并更新到用户对象中，从而实现了角色提升。在发送请求后，脚本会再次调用 `get_user_info` 来确认用户角色是否已成功更改为 "admin"，以此验证漏洞利用是否成功。

整个脚本流程清晰、逻辑严谨，包含了必要的错误处理，并且通过多次网络请求和状态验证，确保了漏洞利用的可靠性。其高质量的实现使得该 POC 具有很高的有效性。

**利用步骤:**
1.  **前置条件:** 确保目标服务器上运行的 Camaleon CMS 版本低于 2.9.1。
2.  **获取普通用户凭证:** 攻击者需要获得一个已注册的、非管理员用户的有效登录凭证（用户名和密码）。
3.  **下载并准备POC脚本:** 获取提供的 Python POC 脚本 `CVE-2025-2304.py`，并确保运行环境安装了必要的依赖库（`requests`, `beautifulsoup4`）。
4.  **执行POC脚本:** 打开命令行终端，运行以下命令：
    `python3 CVE-2025-2304.py http://<TARGET_URL> -u <USERNAME> -p <PASSWORD>`
    例如：`python3 CVE-2025-2304.py http://example.com -u normaluser -p mysecurepassword`
5.  **脚本操作:** 脚本将自动执行以下自动化步骤：
    a.  首先，访问 `<TARGET_URL>/admin/login` 页面，获取当前会话的 CSRF token。
    b.  使用提供的 `<USERNAME>` 和 `<PASSWORD>` 尝试登录 Camaleon CMS 管理后台。
    c.  登录成功后，访问 `<TARGET_URL>/admin/profile/edit` 页面，解析出当前已登录用户的 ID 和其当前的角色。
    d.  构造一个包含 `password[role]=admin` 参数的 POST 请求，并将其发送到 `<TARGET_URL>/admin/profile/updated_ajax` 端点，以触发质量赋值漏洞。
    e.  再次访问 `/admin/profile/edit` 页面，以确认用户角色是否已成功从普通用户提升为 "admin"。
6.  **结果验证:** 脚本执行完毕后，会输出当前用户的角色信息。如果显示为 "admin"，则表明权限提升成功。

**投毒风险分析:**
对 `CVE-2025-2304.py` 提供的 POC 代码进行了全面分析，评估其投毒风险为 0% (低风险)。

1.  **代码透明度与可读性:** 该 POC 脚本以纯文本 Python 形式提供，代码结构清晰，注释详尽，没有任何混淆或加密。这使得安全研究人员可以轻松审查代码的每一个细节，理解其功能，并验证其安全性。
2.  **依赖库安全性:** 脚本仅使用了 Python 的标准库（如 `sys`, `re`, `urllib.parse`）以及两个广泛使用的第三方库：`requests`（用于 HTTP 请求）和 `BeautifulSoup`（用于 HTML 解析）。这些库都是 Python 社区中高度信任和维护的工具，没有发现引入任何异常、未知或具有潜在风险的库。
3.  **网络行为限制:** 脚本的所有网络连接都明确指向通过命令行参数指定的目标 URL。代码中没有发现任何尝试连接其他外部、未经授权的服务器，或者向第三方发送敏感数据的行为。所有的 HTTP 请求路径（如 `/admin/login`, `/admin/profile/edit`, `/admin/profile/updated_ajax`）都与漏洞利用逻辑紧密相关。
4.  **无文件系统或系统命令操作:** 脚本在执行过程中不涉及任何文件读写、创建、删除等文件系统操作。它也没有调用 `os.system()`, `subprocess.run()` 等函数来执行任意的系统命令，从而排除了通过脚本对本地系统进行恶意修改的风险。
5.  **无混淆或恶意代码特征:** 代码中没有使用 `eval()`, `exec()` 等动态代码执行函数，也没有包含任何可疑的代码块、自修改逻辑或嵌入式恶意负载。其唯一目的就是演示和验证 CVE-2025-2304 漏洞的权限提升机制，不包含任何超出此范围的恶意功能。

综上所述，该 POC 脚本是合法且专注于漏洞复现的工具，其设计和实现均符合安全研究的最佳实践。因此，在使用该 POC 进行防御性安全研究时，可以认为其不带有任何投毒风险。

**项目地址:** 

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-2304
