## CVE-2025-33073 - Microsoft Windows (Active Directory 环境) 权限提升 / NTLM反射

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 / NTLM反射

**影响应用:** Microsoft Windows (Active Directory 环境)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8 (预估)

**影响版本:** Windows Server 及 Desktop 多个受支持版本 (90% 企业默认未启用 SMB 签名的环境)

**利用条件:** 需要具有普通域用户权限、目标主机未强制开启 SMB 签名、存在可控的 DNS 解析环境

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该提供的POC代码是一个基于Bash脚本的漏洞检测工具，名为“CVE-2025-33073-checker.sh”。分析其逻辑发现，脚本通过整合crackmapexec和PetitPotam工具来验证目标系统是否存在该漏洞。其核心逻辑分为三个阶段：首先，利用crackmapexec探测目标主机的SMB签名状态（signing:False）以及域名匹配情况，这是漏洞利用的前提条件。其次，脚本启动了一个本地nc监听器（端口445），旨在捕获强制触发的认证请求。最后，通过调用PetitPotam.py（一种已知的强制认证工具）向目标发起请求，诱导其向攻击者机器进行NTLM身份验证。如果nc捕获到了连接，则判定漏洞存在。从代码层面看，该POC具有较高的实用性，因为它并非盲目攻击，而是先验证前提条件，再进行无损的认证强制测试。对于防御性研究员来说，这提供了一个清晰的闭环验证逻辑，足以证明目标系统在未开启SMB签名的情况下，极易受到NTLM反射攻击的影响。虽然脚本中 PetitPotam 的参数调用部分（如 localhost1UWhRC... 等占位符）可能需要根据具体环境微调，但其作为检测工具的架构是完整的且具有高度的可参考性。

【利用步骤】1. 信息收集：获取一个有效的普通域用户凭据（用户名、密码、域名）。2. 扫描阶段：利用脚本配合crackmapexec对内网IP段进行扫描，筛选出未强制开启SMB签名（signing:False）的目标主机。3. 准备监听：在攻击机上开启445端口监听，或配置相应的NTLM中继工具（如impacket-ntlmrelayx）。4. 触发认证：执行PetitPotam攻击，利用漏洞绕过NTLM反射缓解措施，强制目标主机发起认证请求。5. 权限获取：通过NTLM反射机制或中继到域内其他敏感服务（如AD CS或Ldap），最终获取目标主机的SYSTEM权限或横向移动至其他资产。由于该漏洞绕过了现有的NTLM反射防护，攻击者可以在不需要复杂交互的情况下实现全域权限的扩张。

【投毒风险分析】该POC代码的投毒风险评级为15%，属于低风险范畴。通过对脚本内容的静态审计，未发现明显的恶意混淆（Obfuscation）或外部恶意域名连接。脚本中使用的 sudo nc 属于标准系统工具，用于网络调试。其主要依赖项 PetitPotam.py 和 crackmapexec 是安全社区广泛认可的合法渗透测试工具。然而，风险点在于：1. 脚本通过 mktemp 在 /tmp 目录下创建临时文件存放敏感数据，若清理不当可能导致凭据泄露。2. 脚本执行过程中使用了 sudo 权限运行 nc，这在不受信任的环境中可能被滥用。3. 脚本截断部分虽然未显示，但此类自动化脚本常被攻击者修改，通过在 PetitPotam 调用中植入恶意 Payload 或将捕获的 NTLM Hash 异步发送至外部服务器。因此，研究员在使用此类脚本时，应在隔离沙箱环境中运行，并重点检查其网络流向，确保所有捕获的数据仅在本地处理，防止内部凭证外泄。此外，需警惕任何从非官方仓库下载的、包含 base64 编码字符串或动态下载脚本行为的变体代码。

**项目地址:** [https://ti.dbappsecurity.com.cn/info/11105](https://ti.dbappsecurity.com.cn/info/11105)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
