## CVE-2025-33073 - Microsoft Windows (SMB客户端/mrxsmb.sys) 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Microsoft Windows (SMB客户端/mrxsmb.sys)

**危害等级:** 高危 (High)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2019/2022等主流版本

**利用条件:** 具有普通域用户凭据，目标主机未强制开启SMB签名 (SMB Signing: Disabled)

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞（CVE-2025-33073）是Windows SMB客户端中的权限提升漏洞，源于mrxsmb.sys驱动程序在处理编组目标信息时的访问控制不当。提供的POC脚本是一个自动化检测工具，其核心逻辑高度依赖于CrackMapExec、PetitPotam和Netcat。分析POC代码可见，其执行流程具备逻辑合理性：首先利用CrackMapExec扫描目标主机的SMB签名状态，这是利用该漏洞的前提条件（若强制签名则无法进行NTLM中继）。随后，脚本调用PetitPotam触发目标主机的SMB认证请求。关键的利用点在于，脚本尝试让目标主机连接回攻击者控制的本地445端口，以捕获NTLM认证信息。虽然此POC主要侧重于漏洞存在性的验证（通过捕获连接来判定），但在实际红队场景中，攻击者会配合ntlmrelayx等工具，将捕获的身份验证请求重定向至域控或其它高权限服务，从而实现横向移动或直接提升至SYSTEM权限。该POC脚本结构清晰，使用了标准的Shell语法和常见的安全工具链，对于验证内网环境下的SMB中继风险具有较高的实战参考价值。【利用步骤】1. 环境准备：确保攻击机安装了python3、crackmapexec、PetitPotam.py以及nc；2. 信息收集：准备包含目标IP地址的文本文件；3. 执行检测：运行脚本并提供有效的域用户凭据（-u, -p, -d）；4. 签名检查：脚本自动扫描目标是否关闭了SMB签名；5. 触发认证：利用PetitPotam强制目标主机向攻击者机器发起SMB连接；6. 验证响应：通过nc监听445端口，若在规定时间内收到连接请求，则确认漏洞存在。【投毒风险分析】该POC代码的投毒风险评级为低（15%）。通过对脚本内容的静态审计发现，该Shell脚本逻辑透明，主要功能是通过调用系统外部命令（如sudo nc, rm, kill）和已知的开源安全工具（PetitPotam.py）来完成任务。脚本中不存在任何二进制混淆、Base64编码的隐藏指令或未授权的外部域名请求。脚本中包含的‘sudo nc’操作虽然需要高权限，但这属于正常的SMB监听操作，目的是捕获反射的NTLM流量。唯一的潜在风险点在于其调用的外部‘PetitPotam.py’脚本，如果该Python脚本来源不明，可能存在恶意后门。此外，脚本在执行过程中会创建临时文件（/tmp/CVE-2025-33073-nc-output.XXXX），但逻辑中包含清理机制（trap cleanup_nc EXIT），表现出良好的脚本编写规范。整体而言，该工具未发现针对研究人员主机的恶意破坏行为或凭据窃取逻辑，其威胁性仅限于针对目标系统的漏洞检测。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073) (假设路径)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
