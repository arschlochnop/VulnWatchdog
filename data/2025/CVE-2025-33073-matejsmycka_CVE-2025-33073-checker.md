## CVE-2025-33073 - Microsoft Windows (SMB客户端组件 mrxsmb.sys) 权限提升 / NTLM 中继

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 / NTLM 中继

**影响应用:** Microsoft Windows (SMB客户端组件 mrxsmb.sys)

**危害等级:** 严重

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022 (主要针对未强制启用SMB签名的系统)

**利用条件:** 具有普通域用户凭据，目标机器未启用SMB签名，且攻击者可以修改ADIDNS记录或进行网络欺骗。

**POC 可用性:** 7/10

**POC 类型:** 概念验证 / 自动化扫描脚本

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该提供的POC脚本（CVE-2025-33073-checker.sh）是一个功能性的漏洞检测工具，而非完整的端到端利用载荷。它通过整合 crackmapexec、PetitPotam 和 netcat 来验证目标是否存在该漏洞。其核心逻辑分为三步：首先利用 crackmapexec 探测目标是否关闭了 SMB 签名（signing:False），这是利用的前提条件；其次利用 PetitPotam 触发目标主机的 SMB 认证回调（Coerced Authentication）；最后通过 netcat 监听 445 端口捕捉 NTLM 认证流量。如果能捕捉到连接，则证明目标极易受到 NTLM 中继攻击。该脚本有效性较高，因为它模拟了真实攻击的前期链路，能够准确识别存在配置缺陷的域环境。分析显示，CVE-2025-33073 实际上绕过了微软之前的 NTLM 反射缓解措施。在传统的反射攻击中，攻击者不能将 NTLM 身份验证反射回其发起的同一台计算机，但此漏洞通过修改 mrxsmb.sys 驱动中的目标名编组逻辑，使得这种反射再次成为可能。利用步骤通常包括：1. 获取域内普通权限；2. 通过 ADIDNS 注入恶意 DNS 记录，诱导目标连接攻击者机器；3. 触发目标发起 SMB 连接；4. 将获取的 NTLM 凭据中继回目标或另一台机器以获取 SYSTEM 权限。【投毒风险分析】该 POC 脚本的投毒风险较低，主要表现为代码透明度高且逻辑简单。脚本主要依赖于 Linux 系统标准工具（bash, nc, sudo）和知名的第三方安全工具（crackmapexec, PetitPotam.py）。代码中未发现混淆处理、恶意二进制文件的静默下载或非常规的 Base64 编码载荷。然而，风险点在于其对 PetitPotam.py 的外部调用，若该脚本来源不明，可能包含恶意逻辑。此外，脚本中使用了 `sudo nc -lvnp 445`，这在防御性研究环境中是正常的，但在不受信任的来源下，赋予脚本 sudo 权限可能导致本地权限被滥用。该工具的目的是合法的资产探测与合规性检查，不具备典型的投毒特征（如外传敏感凭据到第三方 C2 服务器）。整体而言，该脚本作为威胁情报团队的分析样本是相对安全的，建议在隔离的沙箱环境中使用，并手动审查 PetitPotam.py 的具体代码内容，以规避潜在的供应链投毒风险。

**项目地址:** [https://github.com/microsoft/MSRC-Exposures](https://www.google.com/search?q=https://github.com/microsoft/MSRC-Exposures) (官方参考)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
