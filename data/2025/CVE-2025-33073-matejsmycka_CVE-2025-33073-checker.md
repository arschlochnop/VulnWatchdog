## CVE-2025-33073 - Microsoft Windows (SMB客户端/mrxsmb.sys) 权限提升/NTLM反射攻击

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM反射攻击

**影响应用:** Microsoft Windows (SMB客户端/mrxsmb.sys)

**危害等级:** 高危 (Critical)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022 (具体取决于补丁安装情况)

**利用条件:** 需要拥有普通域用户凭据；目标主机未强制执行SMB签名；攻击者需能修改ADIDNS记录或进行网络流量诱导。

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC脚本（CVE-2025-33073-checker.sh）是一个典型的漏洞检测辅助工具，旨在验证内网环境中是否存在未启用SMB签名的易受攻击主机。脚本逻辑清晰，首先利用crackmapexec工具扫描目标IP的SMB签名状态（signing:False）及域归属。核心利用步骤集成了PetitPotam.py脚本，通过MS-EFSRPC协议强制目标机器向攻击者控制的监听端（nc监听的445端口）发起身份验证请求。通过判断监听端是否接收到NTLM连接，来确认目标是否受到CVE-2025-33073的影响。该漏洞的本质是mrxsmb.sys驱动对编组目标信息处理不当，绕过了现有的NTLM反射防护措施。此POC虽然不是完整的一键式SYSTEM提权工具（未包含后续的NTLM中继利用链，如Relay到AD CS或LDAP），但其检测逻辑在红队渗透和内网防御评估中具有极高的实战价值，能够准确识别出防御体系中的薄弱环节。利用步骤主要分为：1. 内网侦察识别未开启SMB签名的主机；2. 使用ADIDNS投毒或PetitPotam触发目标向攻击者主机发起认证；3. 攻击者在445端口接收反射或中继的流量。相比传统的NTLM Relay，该漏洞由于涉及SMB客户端驱动层面的逻辑绕过，使得即使在某些配置了防御措施的环境中依然可能被绕过。利用该POC可以快速复现漏洞存在的初期触发阶段，证明攻击路径的连通性。【投毒风险分析】该脚本本身主要由Bash编写，调用了标准的开源安全工具如crackmapexec、netcat以及PetitPotam.py。代码逻辑透明，未发现明显的恶意混淆、加密Payload下行或异常的外部链接请求。脚本中的关键操作（如使用sudo启动445端口监听）属于合法的渗透测试行为。然而，投毒风险点在于：1. 脚本依赖的外部Python组件（如PetitPotam.py）若来源不明，可能包含恶意后门；2. 脚本在/tmp目录下创建临时文件处理敏感输出，若权限控制不当可能导致凭据泄漏。由于本POC是作为漏洞验证工具分发的，存在被黑产改造并在非法渠道传播的可能性，例如在脚本末尾添加隐蔽的curl命令将扫描到的敏感内网IP和成功案例上传至攻击者服务器。目前来看，提供的脚本片段属于标准的研究用途，建议在受控的沙箱环境运行，并检查所有引用的第三方Python依赖项的哈希值，以确保供应链安全。总体投毒风险较低，主要风险来自于工具滥用而非代码本身的恶意逻辑。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073-checker](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073-checker)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
