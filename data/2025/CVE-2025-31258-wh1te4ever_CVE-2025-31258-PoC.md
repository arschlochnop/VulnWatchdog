## CVE-2025-31258 - macOS 沙箱逃逸 (Sandbox Escape)

**漏洞编号:** CVE-2025-31258

**漏洞类型:** 沙箱逃逸 (Sandbox Escape)

**影响应用:** macOS

**危害等级:** 高 (High)

**CVSS评分:** 

**影响版本:** 未提供 (Not provided)

**利用条件:** 本地执行恶意沙箱应用程序 (Local execution of malicious sandboxed application)

**POC 可用性:** 8/10

**POC 类型:** 概念验证 (Concept Proof)

**攻击复杂度:** 中 (Medium)

**投毒风险:** 10%

## 详情

POC有效性分析: 该PoC针对macOS系统中的CVE-2025-31258沙箱逃逸漏洞，该漏洞存在于`RemoteViewServices.framework`中。提供的代码是一个Objective-C项目，旨在模拟一个在沙箱环境中运行的恶意应用程序，并演示如何突破沙箱限制。核心逻辑位于`ViewController.m`文件中，它利用`dlopen`和`dlsym`函数动态加载系统私有框架`RemoteViewServices.framework`，并尝试调用其中的私有函数`PBOXDuplicateRequest`。通过精心构造`NSURL`参数，PoC试图诱导系统在应用程序的沙箱边界之外执行文件写入或复制操作。`CVE_2025_31258.entitlements`文件明确配置了`com.apple.security.app-sandbox`为`true`，这进一步证实了该PoC的设计目的是在沙箱内展示逃逸能力。尽管PoC代码被截断，但其结构完整，包含应用程序代理、视图控制器以及自定义的文件写入函数，清晰地展示了利用私有API进行沙箱绕过的意图，并明确标示为“部分沙箱逃逸实践”，表明其作为概念验证的有效性很高。
利用步骤:
1.  攻击者首先需要创建一个恶意的macOS应用程序，并确保其配置了沙箱权限（如PoC中`CVE_2025_31258.entitlements`文件所示）。
2.  在该恶意沙箱应用程序的代码中，利用Objective-C的动态链接功能，通过`dlopen`加载系统私有框架`/System/Library/PrivateFrameworks/RemoteViewServices.framework/RemoteViewServices`。
3.  接着，使用`dlsym`获取到该框架内部的私有函数`PBOXDuplicateRequest`的内存地址和函数指针。
4.  攻击者需精心构造`NSURL`对象作为`PBOXDuplicateRequest`的参数，以指定目标文件路径和源文件路径，这些路径将尝试指向沙箱外部的敏感区域。
5.  当用户运行此恶意沙箱应用程序时，应用程序会在沙箱环境中执行，并尝试调用被劫持的`PBOXDuplicateRequest`函数。
6.  如果漏洞利用成功，`PBOXDuplicateRequest`函数将执行其正常的文件操作逻辑，但其目标路径将超出应用程序的沙箱范围，从而实现对未授权系统资源的访问或对文件系统的写入操作。
投毒风险分析: 对CVE-2025-31258的PoC代码进行分析后，评估其投毒风险为低，具体百分比为10%。主要原因如下：
1.  **代码透明度高**：PoC代码是使用Objective-C和C语言编写的标准Xcode项目结构。其逻辑清晰，没有发现混淆代码、难以理解的函数名或数据结构。所有关键操作，如动态加载框架和调用私有API，都直接展示在代码中，易于审查。
2.  **无外部依赖或可疑请求**：代码中没有包含任何指向外部恶意服务器的URL、IP地址，或者下载、执行外部脚本的行为。所有操作都聚焦于利用本地系统上的`RemoteViewServices.framework`，旨在本地环境中演示沙箱逃逸。
3.  **未使用高危或非标准函数**：除了为了漏洞利用而动态加载系统私有框架（这是PoC的正常功能）外，代码中没有使用`eval()`、`system()`等通常与代码注入或远程执行相关的危险函数，也没有执行未经沙箱批准的 shell 命令。
4.  **无加密或编码**：代码中没有发现异常的base64编码字符串、加密数据块或试图隐藏其真实意图的机制。其文件写入操作也是通过标准的`open()`、`write()`函数实现，符合其演示突破沙箱权限写入文件的目的。
5.  **目的明确且受控**：PoC的`README.md`明确指出其目的是“Escape sandbox (partial) using RemoteViewServices”，代码逻辑完全围绕这一目标展开，即通过调用`PBOXDuplicateRequest`函数尝试绕过沙箱限制。代码的每一个部分都与漏洞的描述和预期行为相符，未发现任何额外、无关或恶意行为。此PoC是合法的安全研究工具，旨在展示漏洞的存在和利用方式，而非携带后门或进行恶意投毒。因此，其投毒风险非常低。

**项目地址:** https://securityonline.info/poc-released-cve-2025-31258-sandbox-escape-in-macos-via-remoteviewservices/

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-31258
