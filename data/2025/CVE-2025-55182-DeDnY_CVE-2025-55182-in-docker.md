## CVE-2025-55182 - React Server Components, Next.js 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components, Next.js

**危害等级:** 关键 (Critical)

**CVSS评分:** 10.0

**影响版本:** 受影响的React Server Components和Next.js版本 (具体版本未在输入中明确,但POC指出旧版本)

**利用条件:** 未认证的远程访问，通过精心构造的HTTP请求

**POC 可用性:** 9

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-55182，绰号“React2Shell”，是一个具有CVSS 10.0最高评分的远程代码执行（RCE）漏洞，严重影响使用React Server Components (RSC) 和Next.js框架的应用程序。此漏洞在2025年12月3日公开披露后迅速引起了广泛关注，并被形容为“核弹级”漏洞，随后遭到了大规模的实际利用。

该漏洞的核心根源在于React Flight协议的反序列化机制。React Server Components允许组件在服务端渲染并通过“Flight”协议以JSON-like流式格式发送到客户端，实现零客户端JS体积的交互体验。然而，该协议在处理反序列化对象时，未能充分校验对象属性访问路径，特别是针对`__proto__`和`constructor`等原型链属性的访问。攻击者可以利用这一缺陷，通过精心构造的HTTP请求，通常是一个恶意的`multipart`表单，来篡改服务器端对象的属性。

具体利用机制包括：攻击者能够利用`$B`引用，结合可控的`_response._prefix`和被劫持为`Function`类型的`_formData.get`属性，动态生成包含任意系统命令的函数。随后，这些恶意函数可以被赋值给对象的`.then`属性。当系统在处理这些被篡改的对象时，尤其是当`then`属性被意外调用时，攻击者注入的系统命令便会在服务器上执行，从而实现未授权的远程代码执行。锐捷网络的安全研究表明，这种攻击通常会尝试调用`child_process.execSync`等高危函数来执行系统命令，进一步证实了其潜在的危害性。

**POC有效性分析**
提供的POC代码包含一个完整的Docker环境设置和Python利用脚本，显示了高度的可用性和有效性。
1.  **环境搭建**: `Dockerfile`和`docker-compose.yml`文件协同工作，构建一个基于`node:18-alpine`的Next.js应用容器。`Dockerfile`负责安装依赖、复制应用代码，并配置了`npm run dev`命令启动服务。`docker-compose.yml`则定义了`next-vulnerable`服务，暴露了3000端口，并挂载了本地的`app`目录，确保容器运行的是一个可被攻击的Next.js实例。这些配置使得研究人员能够轻松地搭建起一个具备漏洞的测试环境，极大地降低了复现门槛。`README.md`也明确指出这是针对“old version”的Next.js服务器，验证了POC的目标。
2.  **漏洞利用脚本**: `exp.py`是一个用Python编写的利用脚本，其设计逻辑严谨，涵盖了漏洞利用的多个关键步骤。
    *   **信息收集**: 脚本首先对目标URL进行分析，通过正则表达式搜索HTML内容中可能包含`actionId`的模式，例如`data-next-action`, `"actionId"`, `__actionId`, `n-a`等，以发现潜在的服务器端Actions。此外，它还尝试发现`<form>`标签中的`action`属性，并探测`/_next/action`, `/api/actions`等标准或常见API端点，以识别可利用的攻击面。
    *   **请求构造**: 尽管提供的`exp.py`代码被截断，但从其分析和搜索结果的描述可以推断，脚本的后续部分将专注于构造一个恶意的HTTP `multipart`请求。这个请求将巧妙地利用React Flight协议的反序列化机制，注入恶意数据以触发原型链污染，最终导致任意代码执行。例如，它会利用`$B`引用、`_response._prefix`和`_formData.get`等关键点来生成包含系统命令的函数。
    *   **RCE触发**: 最终的恶意载荷将被放置在期望被反序列化和执行的位置，例如劫持对象的`.then`属性。当服务器处理这些受控对象时，其中注入的系统命令（如`child_process.execSync('ls -la /')`）将在Next.js服务器进程的权限下执行，实现RCE。
综合来看，该POC提供了一个功能完整的攻击链，从环境搭建到漏洞发现再到实际利用，都考虑得比较周全。它是一个高质量的、可用于复现和理解漏洞机制的完整利用工具。

**利用步骤**
1.  **准备环境**: 确保系统中已安装Docker和Docker Compose。
2.  **搭建漏洞环境**: 导航到POC代码的根目录（`/tmp/vulnwatchdog_aaee3bf80d318d652e8c9085f90c3528/`），执行`docker-compose up --build -d`命令，这将根据`Dockerfile`构建Next.js容器镜像，并启动一个监听在3000端口的易受攻击的Next.js服务。
3.  **运行利用脚本**: 确保Next.js服务已正常启动。在本地机器上运行Python利用脚本，例如：`python3 exp.py http://localhost:3000`。脚本将首先尝试发现Next.js应用程序中的可操作（action）ID和API端点。成功发现后，脚本将构造并发送恶意的`multipart`请求到目标URL，尝试利用React Flight的反序列化漏洞。如果利用成功，攻击者预设的系统命令（例如`ls -la /`）将在Next.js服务器上执行，并在脚本输出中显示执行结果。攻击者可以替换为任何其他想要执行的命令。

**投毒风险分析**
针对提供的CVE-2025-55182 POC代码，投毒风险评估为**低**（约10%）。评估依据如下：
1.  **代码透明度与可读性**: `Dockerfile`、`docker-compose.yml`和`exp.py`的代码都非常清晰、结构良好，没有明显的混淆或加密。`Dockerfile`使用官方的`node:18-alpine`基础镜像，安装的依赖（`npm`包、`curl`）都是标准且公开的。`exp.py`脚本使用`requests`、`re`、`json`、`sys`等Python标准库，没有引入任何非标准或可疑的第三方模块。脚本的逻辑，包括请求的构造和发送，都直观可见。
2.  **行为分析**: `Dockerfile`和`docker-compose.yml`的目的是搭建一个Next.js开发环境，其中包含了与漏洞相关的“旧版本”或特定配置，以便POC能够成功利用。它们没有包含任何额外的指令，如下载、执行外部脚本、修改系统配置以建立后门、或启动恶意服务等行为。`exp.py`的核心功能是探测目标、构造并发送HTTP请求，最终触发远程代码执行。虽然RCE本身是攻击行为，但这是POC的预期功能，而非POC代码本身引入的额外恶意行为。脚本中没有发现C2回调、数据窃取、加密挖矿或持久化机制等超出RCE验证范围的操作。脚本会打印详细的发现过程和请求状态，有助于用户理解其行为。
3.  **外部依赖**: 除了NPM包管理器在`Dockerfile`中安装的Next.js应用依赖外，没有发现POC主动从外部下载、执行未知二进制文件或脚本的行为。`exp.py`也没有尝试连接到任何可疑的外部IP地址或域名。
4.  **误报排除**: 在安全研究中，POC代码中用于执行命令（如`child_process.execSync('whoami')`）的代码是验证漏洞存在性的关键部分，不应被错误地识别为“投毒”行为。这些命令是漏洞利用本身的一部分，旨在证明攻击者可以执行任意代码。综上所述，该POC代码是专门为展示CVE-2025-55182漏洞而设计的，其所有组成部分的行为都符合这一目的，没有观察到任何超出此范围的、意图进行额外恶意活动（如投毒、建立后门、传播恶意软件）的迹象。因此，认为其投毒风险较低。

**项目地址:** None

**漏洞详情:** None
