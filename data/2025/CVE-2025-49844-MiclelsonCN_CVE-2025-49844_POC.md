## CVE-2025-49844 - Redis RCE (远程代码执行)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Redis

**危害等级:** Critical (严重)

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Redis 8.2.1 及以下版本

**利用条件:** 需要经过身份验证（低权限账号即可），具有执行 Lua 脚本的权限，且 Redis 实例未禁用 Lua 引擎。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞 CVE-2025-49844 是 Redis 在处理 Lua 脚本时存在的一个严重的内存释放后重用（Use-After-Free, UAF）漏洞。根据提供的 Python 脚本分析，该 POC 属于初步的概念验证阶段。脚本通过 Python 的 redis 库连接到目标服务器，并尝试执行一段精心构造的 Lua 脚本。该 Lua 脚本的核心逻辑是定义一个带有元表（metatable）的表对象，并在元表的 __gc 垃圾回收钩子中定义操作。通过调用 collectgarbage("collect") 强制进行多次垃圾回收，试图触发 Lua 解释器在管理对象生命周期时的逻辑错误。然而，当前 POC 代码主要起到了“模式演示”的作用，它成功证明了可以在受控环境下干扰垃圾回收流程，但并未包含完整的、能够实现稳定内存布局控制（Heap Spraying）或执行 shellcode 的高级溢出负载。在实际生产环境中，由于 Redis 内存分配器（如 jemalloc）的复杂性，简单地循环调用 GC 并不一定能立即导致进程崩溃或代码执行，因此该 POC 的实际攻击有效性有限，更多作为漏洞触发点的验证。利用步骤：1. 环境准备：攻击者需要获取目标 Redis 服务的 IP 地址、端口以及至少一个具备执行 EVAL 命令权限的低权限账户密码。2. 建立连接：使用 redis-py 等客户端库建立与目标的 TCP 连接。3. 触发检测：脚本首先通过 INFO 命令确认 Redis 版本是否在受影响范围内，并执行简单的 Lua 脚本测试 Lua 引擎是否可用。4. 漏洞触发：向 Redis 发送包含特定 Lua 逻辑的 EVAL 命令。该逻辑会通过元表操作注册一个对象，在对象被标记为垃圾后，再次尝试引用该对象相关的内存区域。5. 权限提升/逃逸：在 UAF 触发后，攻击者利用内存破坏绕过 Lua 的沙箱限制，直接操作底层进程内存，从而在服务器宿主机上执行任意系统命令。投毒风险分析：该 POC 脚本的投毒风险等级较低，约为 15%。代码结构清晰，主要依赖标准的 redis、sys、argparse 以及用于终端美化的 colorama 库，未发现导入可疑的第三方闭源库。分析其核心代码：1. 网络请求行为：脚本所有的网络活动均指向用户通过命令行参数指定的 `host` 和 `port`，没有发现隐蔽的外连 C2（控制端）地址。2. 恶意负载检测：脚本中不含混淆的 Base64 字符串或加密的二进制 Payload，所有 Lua 脚本内容均以明文形式硬编码在字符串中，易于审计。3. 本地环境安全性：脚本未执行任何针对执行者主机的敏感操作，如读取 ~/.ssh/ 目录或修改环境变量。唯一的风险点在于 UAF 类漏洞的测试具有极高的不稳定性，可能会导致目标 Redis 服务进程崩溃（DoS），在未经授权的生产环境测试中可能造成业务中断。此外，虽然当前代码安全，但防御者需警惕未来可能出现的通过 eval() 或 exec() 动态加载远程利用模块的变体版本，那些版本通常具有极高的投毒风险。

**项目地址:** n/a

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)
