## CVE-2025-32463 - Linux Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Linux Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.8.8 to 1.9.17 (fixed in 1.9.17p1)

**利用条件:** 需要本地低权限用户访问 (Requires local low-privileged user access)

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full exploit)

**攻击复杂度:** 低 (Low)

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个针对Linux Sudo组件的本地提权高危漏洞，CVSS评分为9.3（严重）。该漏洞影响Sudo 1.8.8至1.9.17版本，并在1.9.17p1版本中得到修复。漏洞的根源在于Sudo在使用`--chroot`选项时对`/etc/nsswitch.conf`文件处理不当。攻击者（本地低权限用户）可以通过控制一个特定的目录，在其中放置恶意的`nsswitch.conf`文件，并结合`--chroot`选项，欺骗Sudo加载并使用用户指定的根目录内的配置。这使得攻击者能够绕过权限限制，最终提升至root权限并执行任意代码。此漏洞是Sudo权限管理机制中的一个严重逻辑缺陷，允许没有特权的本地用户获取系统最高权限。此外，与此漏洞相关联的还有CVE-2025-32462，该漏洞与Sudo的`-h` (`--host`) 选项错误应用远程主机规则到本地有关，两者均可导致本地提权。

**POC有效性分析**:
所提供的`exploit.sh` POC脚本演示了一种经典的本地提权技术，即利用`LD_PRELOAD`环境变量。尽管CVE-2025-32463的描述主要围绕Sudo的`--chroot`功能缺陷，但`LD_PRELOAD`攻击是针对Sudo等特权程序时常见的辅助或替代利用方式，当Sudo未正确清理环境变量时即可被利用。该POC脚本首先检查`gcc`是否安装，然后创建一个临时目录`STAGE`。接着，它会在`STAGE`目录内创建`exploit.c`文件，其中包含一个`__attribute__((constructor))`函数。这个函数在共享库加载时自动执行，其核心功能是调用`setreuid(0, 0)`和`setregid(0, 0)`来将当前进程的用户和组ID设置为root (0)，然后通过`execl("/bin/bash", ...)`启动一个root权限的bash shell。脚本随后使用`gcc`将`exploit.c`编译为共享库`hax.so`。如果编译成功，它会将`hax.so`复制到`STAGE/lib`目录下，并将`/bin/true`复制为`TARGET_BIN`（此处为`preload_me`）。最后，脚本通过`export LD_PRELOAD="./lib/${LIB_NAME}"`设置`LD_PRELOAD`环境变量，使其指向恶意共享库`hax.so`。脚本的最后部分被截断，但其预期效果是，在`LD_PRELOAD`环境变量设置后，用户在同一shell会话中执行任何`sudo`命令（例如`sudo /bin/true`或`sudo ${TARGET_BIN}`），`sudo`进程在执行前会加载`hax.so`。由于`hax.so`的`constructor`函数被执行，进程的权限会被提升到root，从而获取一个root shell。该POC的代码逻辑清晰，利用机制成熟可靠，只要Sudo版本存在`LD_PRELOAD`相关的环境清理缺陷，或者`chroot`漏洞间接允许了`LD_PRELOAD`的利用，该POC便能有效工作。

**利用步骤**:
1.  **下载POC**: 使用`git clone https://github.com/wvverez/CVE-2025-32463.git`命令克隆POC代码仓库。
2.  **进入目录**: 切换到克隆下来的目录`cd CVE-2025-32463`。
3.  **赋予执行权限**: 执行`chmod +x exploit.sh`命令，使脚本可执行。
4.  **运行POC脚本**: 执行`./exploit.sh`。该脚本将编译恶意共享库并设置`LD_PRELOAD`环境变量。
5.  **触发提权**: 在*同一shell会话*中，执行任意需要`sudo`权限的命令，例如`sudo /bin/true`。此时，`LD_PRELOAD`会使得恶意库被加载，从而直接获得一个root权限的shell。

**投毒风险分析**:
对提供的`exploit.sh` POC代码进行分析，未发现任何恶意或可疑行为，因此投毒风险极低（评分为10%）。
1.  **代码透明性**: 脚本代码完全透明，可读性强。所有的操作，包括创建临时目录、编译C代码、设置环境变量等，都清晰可见。
2.  **编译过程**: 脚本在本地编译`exploit.c`文件。`exploit.c`的代码是直接的提权逻辑（`setreuid(0, 0); setregid(0, 0); execl("/bin/bash", ...);`），不包含任何后门、远程连接或数据窃取行为。
3.  **依赖项**: 除了系统自带的`gcc`编译器外，脚本没有引入任何外部的或不明的依赖。所有操作都在本地完成，没有进行任何网络请求以下载额外组件。
4.  **环境清理**: 脚本使用`mktemp -d`创建临时目录，这是一种安全且标准的方法，有助于在会话结束后清理临时文件，尽管脚本本身没有明确的清理步骤，但临时目录通常会在系统重启或达到生命周期后被清理。
5.  **无混淆/加密**: 代码中没有任何形式的混淆、加密或其他试图隐藏真实意图的技术。综上所述，该POC代码是典型的、专注于验证漏洞的工具，其目的纯粹是为了演示如何通过`LD_PRELOAD`机制实现Sudo的本地提权。作为防御性安全研究，使用此类工具进行测试是安全且符合预期的。

**项目地址:** https://github.com/wvverez/CVE-2025-32463.git

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
