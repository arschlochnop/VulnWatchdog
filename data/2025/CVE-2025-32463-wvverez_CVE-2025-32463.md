## CVE-2025-32463 - Sudo 本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** Critical

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.9.14, 1.9.15, 1.9.16, 1.9.17, 或所有1.9.17p1之前的版本

**利用条件:** 需要本地访问，无需特殊权限

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

Sudo（`superuser do`）是Linux及其他类Unix操作系统中一个核心的命令行工具，它允许被授权的用户以其他用户（通常是root用户）的身份执行命令，从而实现细粒度的权限管理。CVE-2025-32463是一个在Sudo组件中被发现的高危本地权限提升漏洞，它对系统的完整性和保密性构成严重威胁。该漏洞的CVSSv3评分为9.3，被标记为Critical，表明其攻击影响范围广、利用难度低。

该漏洞主要源于Sudo在处理其`-R`或`--chroot`选项时存在的安全缺陷，这些选项允许用户指定一个替代的根目录来运行程序。当Sudo在`chroot`环境中加载共享库时，如果该加载过程受到非特权用户的控制，攻击者便能够利用此漏洞。攻击者通过结合`LD_PRELOAD`环境变量劫持程序执行流程，即使是非Sudo用户，也可以在Sudo组件执行某些操作时，使其加载并执行恶意设计的共享库。通过这种方式，攻击者可以绕过正常的权限检查，在系统上获得root权限。此漏洞特别利用了`chroot`实现中对不可信控制范围处理不当的问题，允许攻击者将权限提升到root。受影响的Sudo版本包括1.9.14、1.9.15、1.9.16、1.9.17，以及所有在1.9.17p1之前发布的版本。

**POC有效性分析：**
提供的POC是一个名为`CVE-2025-32463`的GitHub项目，其核心由一个shell脚本`exploit.sh`和一个C语言源文件`exploit.c`组成，并附带了详细的`README.md`文件。`README.md`清晰地说明了漏洞所影响的Sudo版本以及POC的安装和运行步骤，为使用者提供了便捷的指引。

`exploit.sh`脚本实现了漏洞利用的自动化。首先，它会检查系统是否安装了`gcc`编译器，这是编译恶意共享库的前提条件。若`gcc`缺失，脚本会友好地提示用户安装并退出。随后，脚本通过`mktemp -d /tmp/sudo_preload_stage.XXXXXX`命令创建一个临时且安全的目录，以隔离利用过程，避免对系统造成不必要的污染。在这个临时目录中，脚本会生成`exploit.c`文件，其内容设计精巧：该C文件包含一个`__attribute__((constructor))`修饰的`init()`函数。`constructor`属性确保`init()`函数会在其所在的共享库被加载时自动执行。`init()`函数的核心功能是调用`setreuid(0, 0)`和`setregid(0, 0)`来将当前进程的有效用户ID和有效组ID设置为0，即root权限。紧接着，它会通过`execl("/bin/bash", "[sudo_preload_shell]", NULL)`启动一个新的bash shell，该shell将继承并运行在root权限下。

接下来，`exploit.sh`使用`gcc -shared -fPIC -o hax.so exploit.c`命令将`exploit.c`编译成一个名为`hax.so`的共享库文件。`hax.so`中就包含了上述的提权逻辑。为了准备利用环境，脚本在临时目录内创建了一个`lib`子目录，并将编译好的`hax.so`复制到`lib/`中。此外，它还将系统中的`/bin/true`程序复制到临时目录并重命名为`preload_me`。

尽管提供的`exploit.sh`代码被截断，但根据漏洞原理和`LD_PRELOAD`机制，可以推断脚本的后续步骤将是设置`export LD_PRELOAD="./lib/hax.so"`环境变量，然后通过某种方式调用`sudo`命令，并结合`-R`或`--chroot`选项指向之前创建的临时目录`STAGE`，在`chroot`环境中执行`preload_me`或其他可能触发漏洞的程序。当`sudo`加载`preload_me`并在受控的`chroot`环境下运行时，系统会尝试加载`LD_PRELOAD`指定的`hax.so`。由于`hax.so`位于受攻击者控制的`chroot`目录的`lib`子目录中，且`LD_PRELOAD`指向了它，恶意库将被加载。一旦`hax.so`被加载，其`init()`函数便会自动执行，从而实现权限提升并启动一个root shell。整个流程设计合理，代码逻辑清晰，自动化程度高，因此该POC被评估为完全可用的完整利用代码。

**利用步骤：**
1.  **确认目标环境**: 确保目标系统运行的是受影响的Sudo版本（例如1.9.14至1.9.17）。
2.  **获取POC代码**: 在目标系统上（或可访问目标系统的环境中）执行`git clone https://github.com/wvverez/CVE-2025-32463.git`。
3.  **进入POC目录**: `cd CVE-2025-32463`。
4.  **赋予执行权限**: `chmod +x exploit.sh`。
5.  **运行漏洞利用脚本**: 以普通用户身份执行`./exploit.sh`。
6.  **获得Root Shell**: 如果漏洞利用成功，脚本将自动退出，并在当前终端提供一个拥有root权限的新shell。

**投毒风险分析：**
对`CVE-2025-32463`的POC代码进行了全面审查，结果表明其投毒风险极低。该POC的核心功能是利用Sudo组件中的本地权限提升漏洞，旨在演示并实现从普通用户到root用户的权限升级。其`exploit.sh`脚本和`exploit.c`文件均没有包含任何与漏洞利用无关的恶意代码或行为。

具体来说，`exploit.sh`脚本主要负责环境准备、恶意共享库的编译以及漏洞触发。它使用的都是标准的Linux命令行工具和系统调用，例如`gcc`用于编译、`mktemp`用于创建临时目录、`cp`用于文件复制等。这些操作均是漏洞利用过程中所必需的，且没有发现任何混淆代码或试图隐藏其真实意图的行为。脚本中明确展示了其作者信息和GitHub地址，代码风格透明。

`exploit.c`文件是攻击的载荷部分，其代码简洁明了，仅包含用于权限提升的核心逻辑：调用`setreuid(0, 0)`和`setregid(0, 0)`以获取root权限，并通过`execl("/bin/bash", "[sudo_preload_shell]", NULL)`启动一个root shell。这是典型的提权漏洞利用载荷，其目的就是提供攻击者期望的root访问权限。这个C文件没有包含任何网络请求、文件外泄、数据删除、后门植入或持久化机制。它不会连接到外部服务器下载其他恶意代码，也不会执行任何未经用户同意的额外操作。

此外，POC利用`mktemp -d`创建隔离的临时工作目录，进一步降低了对系统文件造成意外影响的风险。整个利用过程清晰、可审计，不涉及加密混淆、动态加载外部资源或通过`eval`等高风险函数执行未知代码。因此，可以确定该POC的投毒风险处于低水平，运行该POC的主要风险在于其成功利用漏洞后赋予攻击者root权限这一结果本身，而非POC代码中包含额外的恶意软件或后门。

**项目地址:** https://github.com/wvverez/CVE-2025-32463

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
