## CVE-2024-34351 - Next.js (React Framework) SSRF/原型链污染

**漏洞编号:** CVE-2024-34351

**漏洞类型:** SSRF/原型链污染

**影响应用:** Next.js (React Framework)

**危害等级:** 高危 (High)

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N

**影响版本:** Next.js < 14.1.1

**利用条件:** 目标应用需启用 Next.js Server Actions 且版本在受影响范围内，攻击者需能构造特定的 RSC (React Server Components) 请求。

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】：本次分析的POC代码是一个基于Node.js编写的自动化探测脚本，旨在验证Next.js应用中Server Actions的安全性。脚本逻辑主要分为三个阶段：首先，它通过GET请求访问目标页面，利用正则表达式提取页面中隐藏的Action ID，这是利用CVE-2024-34351的前提条件；其次，脚本构造了一个复杂的POST请求，模拟React Server Components (RSC) 的交互协议。其核心特征在于设置了特定的HTTP请求头‘Next-Action’，并使用了‘text/x-component’的Accept头。POC通过URLSearchParams构造了一个包含原型链污染向量的Payload，例如通过‘1’号参数传递JSON化的Action ID信息。POC中还包含了一个‘paddingSize’参数，用于生成大量冗余数据（A字符填充），这旨在测试目标系统在处理超大Payload时是否会触发WAF绕过或导致后端逻辑异常。该POC能够有效验证服务器是否在未经验证的情况下接受并处理特定的Server Action。如果服务器返回了预期的RSC响应流（通常包含特定的JSON格式数据），则证明该漏洞点存在被利用的可能性。虽然该脚本目前仅展示了触发和探测逻辑，但其构造的参数结构完全符合CVE-2024-34351中描述的利用路径，即通过操作服务端函数的参数校验缺陷，配合JavaScript原型链特性来实现非预期的逻辑执行。利用步骤通常涉及：1. 扫描目标Next.js站点并提取有效的Server Action ID；2. 构造包含恶意跳转URL或受损逻辑的JSON Payload；3. 发送带有特定Header的POST请求；4. 观察服务器是否由于SSRF漏洞尝试请求攻击者控制的远程资源，或因原型链污染导致内部逻辑失效。\n\n【投毒风险分析】：该POC代码的投毒风险评级为15%，属于低风险范畴。从代码结构看，脚本使用了Node.js标准库（http/https），没有引入任何第三方可疑依赖，也没有发现常见的恶意混淆技术。其核心逻辑清晰透明，所有的网络请求均指向用户通过命令行参数指定的‘target’地址，不存在静默向攻击者控制的C2服务器外传数据的行为。代码中虽然包含了一个‘padding’填充逻辑，但这在安全测试中常用于规避基础的模式匹配规则，属于正常的POC验证行为，而非恶意Payload投送。需要注意的是，尽管代码本身是清白的，但在防御性研究中，研究人员应警惕脚本末尾被截断的部分（如parseResponse函数后续内容）。在实际的供应链威胁中，攻击者往往会在脚本的数据处理环节植入eval()函数或动态加载远程Shellcode。目前的POC版本仅表现为一种功能性探测工具，旨在帮助防御者识别其Next.js应用是否存在安全风险。建议在使用此类POC进行防御性测试时，始终在受控的沙箱环境下运行，并监控其本地文件系统调用和异常的网络出口连接，以防POC在后续更新或从不可信源获取时被植入后门。本脚本中的随机填充和RSC协议模拟是合法的安全检测行为，不应被判定为恶意投毒。

**项目地址:** [https://github.com/vercel/next.js](https://www.google.com/search?q=https://github.com/vercel/next.js)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-34351](https://nvd.nist.gov/vuln/detail/CVE-2024-34351)
