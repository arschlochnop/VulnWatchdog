## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 无需认证, 远程网络访问, 发送特制的AuthorizationCookie

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-59287 是一个针对 Microsoft Windows Server Update Services (WSUS) 组件的高危远程代码执行 (RCE) 漏洞，其根本原因是服务端存在不安全的 .NET 对象反序列化设计缺陷。该漏洞被赋予 CVSS 9.8 的严重评级，表明其具有极高的潜在威胁。未经身份验证的远程攻击者可以利用此漏洞，通过向 WSUS 服务器发送特制的请求，尤其是篡改 AuthorizationCookie 中的数据，从而触发不安全的对象反序列化过程。此过程在 WSUS 处理 AuthorizationCookie 时使用 .NET 的 BinaryFormatter 进行，导致攻击者能够在目标服务器上执行任意代码，最终完全控制受影响的 WSUS 服务器。

受影响的 WSUS 版本包括 Windows Server 2019、Windows Server 2022 和最新的 Windows Server 2025（包括 Server Core 安装版本）。鉴于 WSUS 在企业网络中负责分发操作系统及其他微软产品的更新，此漏洞的成功利用可能导致严重的供应链攻击，攻击者可以将恶意更新推送给整个网络中的客户端设备，从而造成广泛的损害和数据泄露。该漏洞的利用条件相对宽松，无需任何身份凭证，且可以通过网络远程触发，使其成为一个极其危险的攻击向量。

**POC 有效性分析**

本次分析的 POC 名为 "WSUS Security Research Toolkit"，是一个功能完善、文档齐全的 Python 工具包，旨在帮助安全研究人员和防御者验证 CVE-2025-59287 漏洞。该工具包提供了清晰的结构和易于遵循的指南，使其具有很高的可用性和有效性。

1.  **完整的功能实现：** POC 包含 `exp.py` 作为主执行脚本，负责与目标 WSUS 服务器进行通信并发送精心构造的请求。同时，`encrypt.py` 作为辅助工具，用于生成和准备攻击所需的 .NET 序列化 payload。这种模块化的设计使得攻击流程清晰可控。
2.  **详细的文档支持：** 提供的 `README.md` 文件是该 POC 质量的亮点之一。它详细列出了系统要求（如 Python 3.4+ 和 Git）、Windows 和 Linux 平台的安装步骤，以及明确的依赖项 (`requirements.txt`)。这大大降低了使用者环境配置的难度。
3.  **灵活的 payload 准备：** POC 提供了两种 payload 准备方法：直接编辑 `payload.txt` 文件（用于粘贴 Base64 编码的测试数据），或使用 `encrypt.py` 从二进制输入生成格式正确的 Base64 数据。这种灵活性使得攻击者可以根据具体需求定制恶意载荷，增强了 POC 的实战能力。
4.  **清晰的运行指南与示例：** `README.md` 中包含了详细的运行命令示例，例如 `python exp.py http://wsus-server.example.local:8533`，以及可选参数 `--no-wait`。这确保了即使是初次接触的用户也能快速上手。
5.  **有用的输出与故障排除：** 工具设计会显示连接状态、SOAP 请求/响应信息、生成的 Event ID，以及反序列化尝试的成功/失败状态。这些反馈对于判断漏洞是否成功利用至关重要。此外，`README.md` 还提供了全面的故障排除指南，涵盖了“连接拒绝”、“模块未找到”等常见问题及其解决方案，进一步提升了 POC 的实用性。
6.  **结论：** 综合来看，该 POC 达到了“完整可用，文档齐全”的最高标准。它不仅能够有效地验证 CVE-2025-59287 漏洞的存在，还提供了一套完整的利用框架，使得攻击者能够进行远程代码执行。其清晰的结构、详尽的说明和故障排除支持，使其在防御性安全研究和渗透测试中都具有极高的价值。

**利用步骤**

利用此 POC 对 CVE-2025-59287 进行攻击的详细步骤如下：

1.  **环境准备：**
    *   确保攻击机上安装了 Python 3.4 或更高版本以及 Git。
    *   操作系统可以是 Windows 10/11 或 Linux (Ubuntu 20.04+)。
    *   攻击机需要能够访问目标 WSUS 服务器的网络。
2.  **获取 POC 代码：**
    *   打开命令行或终端，执行 Git 命令克隆 POC 仓库：
        ```bash
git clone https://github.com/vatslaaeytoygag/CVE-2025-59287.git
        ```
3.  **进入项目目录：**
    *   切换到新创建的 POC 项目目录：
        ```bash
cd CVE-2025-59287
        ```
4.  **安装依赖：**
    *   安装 Python 脚本所需的库。在 Windows 上使用 `py` 命令，Linux/macOS 通常使用 `python3`：
        ```bash
py -m pip install -r requirements.txt
        # 或者在 Linux 上: python3 -m pip install -r requirements.txt
        ```
5.  **准备攻击 Payload：**
    *   攻击的核心是构造恶意的 .NET 序列化数据（即远程代码执行的命令）。有两种方式：
        *   **方法 A (通过 payload.txt):** 在 `CVE-2025-59287` 目录下创建一个名为 `payload.txt` 的文件，并将预先准备好的 Base64 编码的 .NET 序列化数据粘贴到该文件中。此数据应包含旨在目标服务器上执行的恶意命令。
        *   **方法 B (通过 encrypt.py):** 如果需要从原始二进制文件生成 payload，可以使用 `encrypt.py` 工具。例如：
            ```bash
python encrypt.py -i input_command.bin -o payload.txt --key YOUR_HEX_KEY
            ```
            `input_command.bin` 包含要执行的原始二进制命令，`YOUR_HEX_KEY` 是用于加密的十六进制密钥（如果需要加密）。生成的文件 `payload.txt` 将包含 Base64 编码的序列化数据。
6.  **执行漏洞利用：**
    *   使用 `exp.py` 脚本针对目标 WSUS 服务器发起攻击。将 `http://wsus-server.example.local:8533` 替换为实际的 WSUS 服务器地址和端口（默认端口通常是 8530 或 8533 for HTTP，8531 或 8532 for HTTPS）。
        ```bash
python exp.py http://192.168.1.100:8533
        ```
    *   可以添加 `--no-wait` 选项以跳过请求之间的延迟：
        ```bash
python exp.py http://192.168.1.100:8533 --no-wait
        ```
7.  **结果分析：**
    *   观察脚本的输出。它将显示与 WSUS 服务器的连接状态、发送的 SOAP 请求/响应信息、系统生成的事件 ID，以及最关键的反序列化尝试的成功或失败状态。如果显示成功，则表明攻击者在目标 WSUS 服务器上实现了远程代码执行。

**投毒风险分析 (10%)**

综合分析此 POC 的公开信息，其投毒风险评估为 **低风险（10%）**。以下是详细的考量因素：

1.  **高度透明的文档：** `README.md` 文件提供了极高的透明度，详细描述了工具的功能、安装、使用方法和故障排除。这种详尽的说明通常是合法安全研究工具的特征，而恶意代码往往会避免提供过多细节，以隐藏其真实目的或复杂性。清晰的文档使得使用者能够更好地理解工具的运作原理，从而更容易识别潜在的恶意行为。
2.  **明确的模块划分：** POC 明确区分了主利用脚本 (`exp.py`) 和 payload 准备工具 (`encrypt.py`)。这种设计理念将攻击逻辑与恶意 payload 的内容解耦，意味着攻击者需要主动提供或生成恶意 payload，而不是依赖 POC 自身携带。如果 POC 旨在投毒，通常会尝试在核心脚本中隐藏恶意 payload 或调用外部资源。
3.  **用户控制的 payload：** POC 允许用户通过 `payload.txt` 文件提供自定义的 Base64 编码数据，或者利用 `encrypt.py` 从其自己的二进制输入生成 payload。这意味着生成或使用的实际恶意代码完全由用户控制，降低了 POC 作者在其中嵌入后门的风险。用户可以审查 `input_file.bin` 或 `payload.txt` 中的内容，以确保其仅执行预期操作。
4.  **依赖标准库与常规操作：** 安装步骤主要涉及标准的 `git clone` 命令和 Python 的 `pip install -r requirements.txt`。这些都是常规的开发和安全工具部署流程。`README.md` 中没有提及下载或执行来自不明来源的二进制文件、复杂的脚本管道（如 `curl | bash`），或修改关键系统文件（如 `/etc/hosts`、系统启动项）的行为，这些都是投毒 POC 常见的特征。
5.  **缺少可疑网络行为迹象：** `README.md` 描述的工具输出关注于 WSUS 服务器的连接状态和 SOAP 交互，没有提及任何与外部未知服务器进行通信、数据回传或收集用户敏感信息的迹象。一个被投毒的 POC 通常会尝试在后台静默地与攻击者控制的命令与控制 (C2) 服务器进行通信。
6.  **安全使用免责声明：** 尽管被截断，但 `README.md` 末尾的 "Only use on..." 部分很可能包含标准的法律或道德免责声明，强调工具应在授权范围内使用。这种声明在合法安全研究项目中是常见的，而投毒者则通常不会提供此类提示，因为他们的目的就是非法利用。

**潜在风险与建议：**

尽管当前信息显示投毒风险较低，但仍建议采取以下预防措施：

*   **代码审计：** 在生产环境或敏感系统上运行前，务必对 `exp.py`、`encrypt.py` 和 `requirements.txt` 中的所有代码进行彻底的静态和动态分析。检查是否存在任何混淆代码、不寻常的网络请求（特别是DNS查询和HTTP/HTTPS连接）、文件读写操作、进程启动或对 `eval()` 等危险函数的调用。
*   **沙箱环境：** 首次运行 POC 时，应将其置于隔离的沙箱环境（如虚拟机或容器）中，并监控其所有的网络活动、文件系统操作和进程行为，以确保没有隐藏的恶意功能。
*   **依赖项检查：** 仔细审查 `requirements.txt` 中列出的所有 Python 库。确保它们是常用且信誉良好的库，并且版本没有被篡改。警惕任何不常见、名称拼写错误或来自未知源的依赖项。
*   **GitHub 用户审查：** 尽管 `vatslaaeytoygag` 这个用户名本身不能直接判断恶意性，但检查其 GitHub 贡献历史、其他项目以及是否存在其他用户报告的问题，可以作为额外的背景信息。

综上所述，根据提供的 POC 信息，该工具的设计和文档表现出合法安全研究工具的典型特征，因此直接包含恶意后门的风险较低。然而，任何来自第三方源的代码在执行前都应进行严格的安全审查，以应对未知风险。

**项目地址:** https://github.com/vatslaaeytoygag/CVE-2025-59287.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
