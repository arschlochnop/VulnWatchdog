## CVE-2025-47812 - Wing FTP Server 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-47812

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Wing FTP Server

**危害等级:** 高危/Critical

**CVSS评分:** 10.0 (Critical)

**影响版本:** Wing FTP Server <= 7.4.3

**利用条件:** 无需认证，可通过网络远程访问利用

**POC 可用性:** 10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：
提供的POC README详细阐述了CVE-2025-47812漏洞的两个阶段的预认证远程代码执行（RCE）攻击。该漏洞影响Wing FTP Server版本7.4.3及以下。第一阶段，攻击利用了Wing FTP服务器认证逻辑中对用户名参数中空字节（`\x00`）的错误处理。`c_CheckUser()`函数在内部使用`strlen()`，这会导致在第一个空字节处截断用户名字符串。这意味着像`anonymous%00<arbitrary_data>`这样的用户名在'anonymous'用户有效的情况下，可以绕过认证。认证成功后，`loginok.html`会调用`rawset(_SESSION, "username", username)`，此时使用的`username`是完整的、未经净化的POST参数，包括空字节之后的所有内容。随后，会话被序列化并保存为磁盘上的Lua脚本文件。由于序列化函数在不进行任何净化的前提下将字符串值包裹在`[[...]]`Lua长字符串字面量中，攻击者可以通过在用户名中注入`]]`来提前终止字符串字面量，从而在会话文件中附加任意Lua代码。例如，`anonymous\x00]] local h = io.popen("id") local r = h:read("*a") h:close() print(r) --`，其中`--`用于注释掉Wing FTP后续附加的`]]`。第二阶段，攻击者通过访问任何经过认证的端点（例如`/dir.html`）来触发Lua代码的执行。会话文件（以`UID` cookie值为名）是一个Lua脚本，每次访问认证端点时都会通过`loadfile()` + `f()`执行。发送带有有效`UID` cookie的`POST /dir.html`请求，将执行注入的Lua代码，并在响应体中返回命令输出。POC是一个基于Python 3.10+的利用工具，依赖`requests`和`urllib3`库，并提供了多种利用模式（命令执行、交互式shell、反向shell和信息转储），功能完善且文档清晰，表明其高度有效。

利用步骤：
1.  **准备环境**：确保系统安装了Python 3.10+，并使用`pip install -r requirements.txt`安装POC所需的`requests`和`urllib3`库。
2.  **确定目标**：识别运行Wing FTP Server且版本低于7.4.4的脆弱目标主机。
3.  **构造Payload**：攻击者（或POC脚本）将构造一个特殊的用户名，其中包含空字节（`\x00`）和恶意的Lua代码注入。例如：`anonymous\x00]]<lua_payload>--`。`<lua_payload>`可以是任意Lua代码，用于实现命令执行、反向Shell等功能。
4.  **阶段一：认证绕过与代码注入**：POC向Wing FTP服务器的登录接口发送一个POST请求，其中包含精心构造的用户名。服务器在处理用户名时，由于空字节截断导致认证绕过，并且未经净化的Lua代码被写入到服务器端的会话文件中，同时返回一个有效的`UID` cookie。
5.  **阶段二：触发执行**：POC随后会携带在阶段一获取到的`UID` cookie，向服务器的任意一个需要认证的端点（例如`/dir.html`）发送一个POST请求。服务器在处理此请求时会加载并执行先前注入到会话文件中的Lua脚本。
6.  **获取结果**：被执行的Lua代码（例如`id`命令的输出）的结果将被包含在HTTP响应体中返回给攻击者。
7.  **实现RCE**：通过这种方式，攻击者可以以`root`（Linux）或`NT AUTHORITY\SYSTEM`（Windows）权限在目标系统上执行任意命令，从而实现完全的远程代码执行。

投毒风险分析：
该POC的投毒风险评估为极低（约10%）。作为一种专业的防御性安全研究工具，此POC旨在演示和利用CVE-2025-47812漏洞，其设计和功能是作为漏洞利用工具来操作的，而非包含恶意附加物或自我感染。以下是具体的评估依据：
1.  **代码透明度与可读性**：POC的README文件详细描述了漏洞原理、利用机制和具体步骤，代码结构清晰，没有明显的混淆迹象。这使得安全研究人员可以轻松审计其功能，验证其合法性。
2.  **标准依赖项**：POC明确指明需要Python 3.10+以及`requests`和`urllib3`这两个广泛使用的、经过社区验证的标准Python库。这些库本身不含恶意代码，且POC通过标准的`pip install -r requirements.txt`方式安装依赖，没有引入外部可疑脚本或二进制文件。
3.  **预期行为与非恶意功能**：POC的核心功能是执行远程命令、获取shell和反弹shell。这些是漏洞利用工具的合法且预期行为。POC中用于演示Lua注入的`io.popen("id")`代码片段是典型的概念验证负载，旨在展示远程命令执行的能力，而非在运行POC的机器上植入后门或执行未授权操作。没有迹象表明POC会执行超出其声明范围的恶意活动，例如窃取运行者的本地数据、传播恶意软件或连接到未知C2服务器。
4.  **网络行为**：POC的网络请求仅针对其目标Wing FTP Server，以实现漏洞利用。没有证据表明它会与除目标之外的任何第三方恶意服务器进行通信或执行其他未经授权的网络活动。
综上所述，该POC被设计为一个专注于漏洞利用的工具，而不是一个包含恶意附加代码或旨在损害运行者的“投毒”工具。运行此POC的风险主要集中于未经授权地对其进行使用可能导致的法律和伦理问题，而非POC本身对研究环境的恶意影响。

**项目地址:** 

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-47812
