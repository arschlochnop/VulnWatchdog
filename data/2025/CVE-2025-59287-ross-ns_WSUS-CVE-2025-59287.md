## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全的反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全的反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Microsoft Windows Server Update Services (WSUS) 受影响版本

**利用条件:** 需要网络访问目标WSUS服务器，且可能需要有效的凭据或会话cookie。该漏洞涉及WSUS服务中的不安全反序列化缺陷，允许远程未授权或低权限用户执行任意代码。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

本POC代码分析基于`WSUS-CVE-2025-59287.ps1`脚本，该脚本旨在利用CVE-2025-59287漏洞。此漏洞是Microsoft Windows Server Update Services (WSUS) 中的一个远程代码执行（RCE）漏洞，具体表现为不安全的反序列化缺陷。攻击者可以通过向WSUS服务的某个特定终结点发送精心构造的SOAP请求，触发恶意payload的反序列化，从而在WSUS服务器上执行任意代码。

**POC有效性分析：**
该PowerShell脚本是一个高度功能化且结构清晰的漏洞利用工具。它首先通过`Get-ServerId`函数从WSUS的`ReportingWebService.asmx`服务中获取服务器ID，然后通过`Get-AuthCookie`函数（部分代码被截断，但表明了身份验证或会话管理的需求）获取必要的认证cookie。核心利用部分在于`New-Payload`函数，它首先构造了一个标准的PowerShell反向Shell命令，该命令通过Base64编码隐藏，确保在传输和执行过程中的隐蔽性。接着，脚本利用`ysoserial.exe`（一个业界知名的.NET反序列化payload生成工具）将Base64编码的反向Shell命令序列化为`.NET BinaryFormatter`格式的恶意payload，并指定使用`RolePrincipal`小工具链。最终，这个序列化后的payload连同获取到的服务器ID和认证cookie，被包含在SOAP请求中发送到WSUS服务器的易受攻击服务。一旦WSUS服务器反序列化这个恶意对象，内置的PowerShell反向Shell命令就会被执行，从而建立与攻击者Netcat侦听器的连接。整个流程自动化程度高，逻辑严谨，目标明确，显示了极高的有效性。

**利用步骤：**
1.  **环境准备**：攻击者需要一台运行PowerShell的Windows机器。下载并准备`ysoserial.exe`工具，并将其放置在脚本预期的路径（例如`./ysoserial/`目录下）。同时，攻击者需要在一台可访问的机器上启动一个Netcat侦听器，用于接收反向Shell。
2.  **修改POC脚本**：编辑`WSUS-CVE-2025-59287.ps1`脚本，根据实际情况修改以下参数：
    *   `$wsusServer`：目标WSUS服务器的IP地址或主机名。
    *   `$wsusPort`：目标WSUS服务器监听的端口（通常为8530或8531）。
    *   `$ncHost`：攻击者Netcat侦听器所在的IP地址。
    *   `$ncPort`：攻击者Netcat侦听器监听的端口，例如`4444`。
    *   `$computerObject`：在WSUS控制台中创建的任意计算机对象名称，用于构造请求。
3.  **启动Netcat监听**：在攻击者机器上启动Netcat侦听器，例如执行命令：`netcat -lvnp 4444`。
4.  **执行POC脚本**：在攻击者机器上执行修改后的PowerShell脚本，例如：`powershell.exe -File WSUS-CVE-2025-59287.ps1`。
5.  **接收反向Shell**：如果漏洞利用成功，Netcat侦听器将接收到一个来自目标WSUS服务器的反向Shell连接，攻击者即可在WSUS服务器上执行命令。

**投毒风险分析：**
本POC代码的投毒风险被评估为极低（5%）。代码的编写规范，逻辑清晰，具有详细的注释，易于安全研究人员审计和理解。脚本的核心功能完全围绕着利用CVE-2025-59287漏洞而设计，即生成、序列化并发送一个反向Shell payload。其中使用的`ysoserial.exe`是一个开源且广泛使用的合法渗透测试工具，用于生成各种语言和框架的反序列化payload。POC脚本本身并未包含或分发任何经过修改的、恶意的`ysoserial.exe`版本。此外，脚本中没有发现任何代码混淆、不寻常的文件写入操作、未经授权的外部网络请求（除了连接到目标WSUS服务器和攻击者自身的Netcat侦听器之外）或调用可疑的第三方代码。所有的网络通信和payload生成过程都是透明的。因此，此POC被视为一个专注于漏洞利用的良性安全研究工具，不包含任何隐藏的恶意代码或意图。其唯一“恶意”行为是作为漏洞利用的一部分，建立一个反向Shell，但这正是漏洞利用的预期结果，而非POC代码本身的投毒行为。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
