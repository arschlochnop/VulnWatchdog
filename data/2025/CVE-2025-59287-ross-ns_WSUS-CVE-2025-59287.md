## CVE-2025-59287 - Microsoft WSUS 反序列化远程代码执行

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 反序列化远程代码执行

**影响应用:** Microsoft WSUS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** 未知

**利用条件:** 需要网络访问；可能需要认证或特定WSUS配置；需要ysoserial.exe工具

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析：
提供的PowerShell脚本`WSUS-CVE-2025-59287.ps1`是一个功能完善的针对CVE-2025-59287的POC。该漏洞影响Microsoft WSUS，类型为远程代码执行（RCE），具体机制为反序列化漏洞。POC利用了`.NET BinaryFormatter`反序列化机制，并借助`ysoserial.exe`工具生成恶意的`RolePrincipal`反序列化Gadget。脚本清晰地构造了一个Base64编码的PowerShell反向Shell负载，旨在连接到攻击者指定的Netcat监听器。代码结构清晰，通过`New-Payload`函数负责负载生成，`Get-ServerId`函数用于获取目标WSUS服务器ID，以及一个被截断但显然用于获取认证Cookie的`Get-AuthCookie`函数。这表明该漏洞可能在特定认证上下文或未经认证但可访问的WSUS服务点被利用。脚本使用`Invoke-WebRequest`向WSUS的`/ReportingWebService/ReportingWebService.asmx`端点发送SOAP请求，这是利用Web服务反序列化漏洞的典型方法。虽然依赖外部的`ysoserial.exe`工具，但这在`.NET`反序列化利用中是常见做法，不影响其作为POC的有效性。总的来说，该POC设计精良，能够清晰演示WSUS RCE漏洞的利用过程，从而实现对目标服务器的远程控制。

利用步骤：
1.  **环境准备**：在攻击机上部署`ysoserial.exe`工具，并确保其与`WSUS-CVE-2025-59287.ps1`脚本处于同一目录下。同时，在攻击机上启动Netcat监听器，例如执行命令 `nc -lvnp 4444`，以便接收反向Shell连接。
2.  **配置POC脚本**：编辑`WSUS-CVE-2025-59287.ps1`脚本，根据目标环境和攻击机信息进行如下配置：
    *   `$wsusServer`: 设置为目标Microsoft WSUS服务器的IP地址或主机名。
    *   `$wsusPort`: 设置为WSUS服务监听的端口（通常是8530或8531）。
    *   `$ncHost`: 设置为攻击机（Netcat监听器所在机器）的IP地址。
    *   `$ncPort`: 设置为Netcat监听器使用的端口（例如4444）。
    *   `$computerObject`: 设置为一个用于在WSUS控制台中创建的计算机对象名称，例如“test.local”。
3.  **执行POC**：在攻击机上执行配置好的PowerShell脚本。脚本将执行以下操作：
    *   调用`New-Payload`函数，生成Base64编码的PowerShell反向Shell命令。
    *   通过`ysoserial.exe`将该Payload序列化为恶意的.NET对象，封装在SOAP请求中。
    *   向目标WSUS服务器的`/ReportingWebService/ReportingWebService.asmx`端点发送构造好的SOAP请求。这个请求将包含获取服务器ID和（如果需要）认证Cookie的步骤，并最终递送恶意反序列化数据。
4.  **接收反向Shell**：如果WSUS服务器存在漏洞并成功处理恶意反序列化数据，它将执行嵌入的PowerShell命令，与攻击机的Netcat监听器建立反向Shell连接。此时，攻击者将获得WSUS服务器的远程代码执行权限。

投毒风险分析：
对`WSUS-CVE-2025-59287.ps1`脚本的分析表明，其投毒风险处于低水平（10%）。脚本的主要功能是实现漏洞利用，代码逻辑清晰，主要涉及PowerShell内置命令和.NET框架类的调用。它通过`New-Payload`函数生成一个标准的反向Shell Payload，该Payload是可读且易于识别的。Payload的Base64编码和对`ysoserial.exe`的调用是为了构造反序列化攻击，这些都是公开且常用的渗透测试技术。脚本中没有发现代码混淆、下载和执行未知外部脚本、或者其他旨在对运行POC的用户或系统造成非预期损害的恶意行为。`ysoserial.exe`作为一个外部依赖项，其本身的安全性应由用户自行验证（从官方或可信来源获取），但就PowerShell脚本本身而言，它没有引入额外的恶意功能。脚本参数（如目标服务器、监听地址和端口）均明确暴露给用户配置，使得用户对脚本行为有充分的控制和理解。因此，该POC代码自身不包含隐藏的恶意组件或投毒行为。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
