## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) Insecure Deserialization leading to Remote Code Execution (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** Insecure Deserialization leading to Remote Code Execution (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** High

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** Unauthenticated, Remote, Network Access Required, Low Attack Complexity

**POC 可用性:** 8/10

**POC 类型:** Full Exploit

**攻击复杂度:** Low

**投毒风险:** 10%

## 详情

漏洞概述 (Vulnerability Overview):
CVE-2025-59287是一个影响Microsoft Windows Server Update Services (WSUS)组件的高危远程代码执行（RCE）漏洞。WSUS是微软为企业级环境设计的集中式更新管理工具，负责分发Windows操作系统及其他微软产品的更新。此漏洞的根本原因在于WSUS处理`AuthorizationCookie`时存在不安全的反序列化过程，具体是使用了.NET的`BinaryFormatter`，而其在处理特制的序列化数据时未进行充分的安全验证。未经身份验证的远程攻击者可以通过发送特制的SOAP请求，利用这一缺陷，触发不安全的对象反序列化，进而导致在目标WSUS服务器上执行任意代码。该漏洞被赋予CVSS 9.8的严重评级，攻击复杂度低，无需任何身份凭证即可远程触发，且有报告指出其正被积极利用，攻击者可利用此漏洞获取初始访问权限并进一步控制系统。

POC有效性分析 (POC Effectiveness Analysis):
提供的POC代码`WSUS-CVE-2025-59287.ps1`是一个功能完整的PowerShell脚本，旨在自动化利用CVE-2025-59287漏洞以获取目标WSUS服务器上的反向Shell。该脚本首先定义了目标WSUS服务器、端口、攻击者Netcat监听主机及端口等关键参数。其核心利用逻辑包括：
1.  **生成反序列化Payload**: `New-Payload`函数负责生成一个PowerShell反向Shell命令，并将其Base64编码。随后，它调用外部工具`ysoserial.exe`（该工具需要与POC脚本放置在同一目录下）来利用`RolePrincipal`小工具链，将Base64编码的反向Shell命令序列化为`.NET BinaryFormatter`格式的Payload，并再次进行Base64编码，以方便嵌入SOAP请求。
2.  **获取Server ID**: `Get-ServerId`函数通过向`/ReportingWebService/ReportingWebService.asmx`发送SOAP请求（调用`GetRollupConfiguration`方法）来获取WSUS服务器的唯一标识符（`ServerId`）。这一步是获取后续`AuthorizationCookie`的前提。
3.  **获取AuthorizationCookie**: (虽然`Get-AuthCookie`函数在提供的代码中被截断，但根据漏洞描述和上下文，其目的必然是获取一个可用于触发反序列化的`AuthorizationCookie`或直接包含恶意payload的`AuthorizationCookie`)。通常，漏洞利用会围绕构造一个恶意的`AuthorizationCookie`并在后续请求中发送。
4.  **触发漏洞**: 最终的攻击步骤（未完全展示在截断的代码中，但可推断）将涉及使用获取到的`ServerId`和恶意构造的`AuthorizationCookie`发送一个特制的SOAP请求到WSUS的某个服务接口。这个特制的`AuthorizationCookie`会包含`ysoserial`生成的恶意反序列化Payload，当WSUS服务器对其进行反序列化时，便会触发Payload中包含的PowerShell命令，从而建立与攻击者Netcat监听器的反向Shell连接。
该POC结构清晰，依赖于成熟的攻击工具`ysoserial.exe`和标准的PowerShell反向Shell技术，显示出较高的功能完整性和可靠性。

利用步骤 (Exploitation Steps):
1.  **环境准备**: 确保攻击机器上安装有PowerShell，并下载`ysoserial.exe`工具，将其放置在`WSUS-CVE-2025-59287.ps1`脚本的同一目录下。
2.  **配置参数**: 编辑`WSUS-CVE-2025-59287.ps1`脚本，修改以下变量：
    *   `$wsusServer`: 目标WSUS服务器的IP地址或主机名。
    *   `$wsusPort`: 目标WSUS服务器的服务端口（通常是8530或8531）。
    *   `$ncHost`: 攻击者监听Netcat的主机IP地址。
    *   `$ncPort`: 攻击者监听Netcat的端口。
3.  **启动监听**: 在攻击机器上，启动一个Netcat监听器，等待反向Shell连接：
    `nc -lvnp $ncPort`
4.  **执行POC**: 在PowerShell环境中执行脚本：
    `.\WSUS-CVE-2025-59287.ps1`
5.  **接收Shell**: 如果利用成功，攻击者的Netcat监听器将收到一个来自目标WSUS服务器的反向Shell连接。

投毒风险分析 (Poisoning Risk Analysis):
对提供的POC代码`WSUS-CVE-2025-59287.ps1`的分析显示，其投毒风险较低。
1.  **代码透明度**: 脚本代码结构清晰，使用了标准的PowerShell语法和系统库，没有明显的代码混淆或加密。所有关键操作，如Payload生成、SOAP请求构造、HTTP通信等，都以可读的方式呈现，易于安全研究人员审计。
2.  **外部依赖**: 脚本明确依赖`ysoserial.exe`这个外部工具来生成反序列化Payload。`ysoserial`是一个在反序列化漏洞研究领域广泛使用的开源工具，其功能和原理都非常透明。然而，用户仍需确保从官方或可信渠道获取`ysoserial.exe`，以防该工具本身被恶意篡改。脚本本身并未包含下载或执行未知外部可执行文件的代码（除了其预期调用的`ysoserial.exe`），降低了通过脚本引入未知恶意软件的风险。
3.  **恶意行为**: 脚本的预期恶意行为是利用WSUS漏洞在目标服务器上执行一个PowerShell反向Shell。这个行为是POC本身的目的，而非额外插入的“投毒”行为。生成的PowerShell反向Shell代码是标准的，旨在建立一个交互式会话，没有包含额外的、非预期的攻击负载。
4.  **网络通信**: 脚本的网络通信仅限于与目标WSUS服务器（通过HTTP/SOAP）以及与攻击者设置的Netcat监听器建立反向连接。没有发现向其他可疑IP地址或域名发起连接的尝试。
综上所述，该POC脚本专注于实现CVE-2025-59287的漏洞利用，未发现隐藏的、非预期的恶意功能。因此，评估其投毒风险为10%，主要风险点在于`ysoserial.exe`的来源需要用户自行验证其安全性。

**项目地址:** Not Available

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
