## CVE-2025-14847 - MongoDB Server, MongoDB Atlas, Percona Server for MongoDB (PSMDB) 内存泄露 (Memory Leak)

**漏洞编号:** CVE-2025-14847

**漏洞类型:** 内存泄露 (Memory Leak)

**影响应用:** MongoDB Server, MongoDB Atlas, Percona Server for MongoDB (PSMDB)

**危害等级:** 高危 (High)

**CVSS评分:** 未提供

**影响版本:** MongoDB Server 8.2.0 ≤ version ≤ 8.2.2; MongoDB Server 8.0.0 ≤ version (具体上限被截断); 多数MongoDB Community和Enterprise版本及MongoDB Atlas; Percona Server for MongoDB (PSMDB)

**利用条件:** 无需认证, 远程网络访问, 发送特制数据包

**POC 可用性:** 9

**POC 类型:** 完整利用 (漏洞检测器)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-14847，也被称为“MongoBleed”，是一个影响MongoDB服务器的高危未授权内存泄露漏洞。该漏洞源于MongoDB在处理Zlib压缩协议时存在缺陷，具体位于`message_compressor_zlib.cpp`文件中。原代码在解压缩数据时，错误地使用`output.length()`返回已分配的内存大小，而非实际解压缩数据的长度。这使得未经身份验证的远程攻击者能够通过发送格式错误的Zlib压缩数据包，触发服务器堆内存错误，读取到目标服务器堆内存中的未初始化区域，从而导致敏感数据（如认证信息、内部数据结构或其他机密数据）泄露。

**POC有效性分析:**
提供的POC是一个名为“MongoBleed CVE-2025-14847 – Vulnerability Checker”的Python脚本（`mongobleed_check.py`）。该POC被设计为一个专业的安全扫描器，其`README.md`明确指出它使用“PoC-accurate probing technique”，能够安全地复现漏洞利用逻辑以确定目标是否真正脆弱。它承诺“无数据修改”、“无需认证”、“无破坏性行为”和“受控的只读探测”，最终提供“真实的确认”。代码分析显示，该脚本通过`send_probe`函数精心构造了一个包含Zlib压缩BSON数据的MongoDB网络数据包。这个数据包包含了特定的协议头和载荷，旨在触发MongoDB服务器的内存泄露缺陷。接收到服务器响应后，`extract_leaks`函数会尝试通过正则表达式（例如查找十六进制字符串、JSON或BSON模式）从响应中解析并提取泄露的内存信息。此POC功能完整，支持单主机、IP范围和目标列表扫描，并提供JSON或彩色CLI输出，具备高实用性和准确性，是用于检测此漏洞的有效工具。

**利用步骤:**
1.  攻击者首先识别出可通过网络访问的、运行受影响版本的MongoDB服务器（通常监听在默认端口27017）。
2.  攻击者使用一个自定义工具或POC脚本（如提供的`mongobleed_check.py`），构造一个包含特制Zlib压缩协议消息的MongoDB数据包。这个数据包的设计目的是利用`message_compressor_zlib.cpp`中的逻辑缺陷。
3.  攻击者将此恶意数据包发送至目标MongoDB服务器。由于这是一个未授权漏洞，攻击者无需任何凭据即可发起攻击。
4.  MongoDB服务器在尝试解压和处理这个畸形数据包时，会因计算错误而将堆内存中的未初始化或敏感区域数据作为响应的一部分返回给攻击者。
5.  攻击者接收到服务器的响应。这个响应包含了超出预期长度的数据，其中就可能包含泄露的内存内容。
6.  攻击者解析收到的响应，通过模式匹配或数据分析来识别和提取其中包含的敏感信息，例如数据库凭据、会话令牌、API密钥或其他应用程序内部数据。

**投毒风险分析:**
提供的POC代码(`mongobleed_check.py`)是一个用Python编写的漏洞检测工具。经过详细审查，该代码的投毒风险极低，评估为5%。其主要原因如下：
*   **透明性与可读性:** 代码结构清晰，注释良好，逻辑易于理解。它不包含任何形式的代码混淆。
*   **标准库使用:** 脚本完全依赖Python标准库，如`socket`、`struct`、`zlib`、`re`、`argparse`、`json`、`sys`和`ipaddress`。不涉及任何第三方或外部依赖，从而避免了引入潜在恶意外部组件的风险。
*   **功能单一:** 脚本专注于其声明的功能——检测MongoDB内存泄露漏洞。它通过发送特定构造的数据包来探测目标，并解析响应以查找泄露信息。没有发现任何超出此范围的可疑行为，例如尝试进行文件系统操作、执行 shell 命令、向外部服务器发送数据（除了目标MongoDB服务器的响应）或下载并执行额外代码。
*   **非破坏性:** `README.md`明确指出该工具是“非破坏性”和“只读探测”的，并且代码逻辑也支持这一声明，它只进行网络通信和数据解析，不修改目标系统数据或配置。
*   **无后门:** 尽管存在漏洞验证代码，但它被用于检测漏洞，而非利用漏洞植入后门。在代码中没有发现任何试图建立持久化访问、窃取信息发送至未知C2服务器或进行其他恶意行为的迹象。

综上所述，该POC代码自身不存在明显的恶意投毒行为。然而，作为安全最佳实践，任何从公共GitHub仓库获取的代码都应在使用前进行审核，并建议在隔离环境中运行，以防范未来的潜在修改或供应链攻击。

**项目地址:** https://github.com/Systemhaus-Schulz/MongoBleed-CVE-2025-14847.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-14847
