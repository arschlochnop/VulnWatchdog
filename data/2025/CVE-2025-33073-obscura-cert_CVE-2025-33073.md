## CVE-2025-33073 - Microsoft Windows (SMB客户端组件) 权限提升/NTLM中继/反射攻击

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM中继/反射攻击

**影响应用:** Microsoft Windows (SMB客户端组件)

**危害等级:** 高危 (High)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2019, Windows Server 2022 等主流版本

**利用条件:** 具有普通域用户凭据，目标网络内未强制开启SMB签名

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：该POC名为‘Obscura$ DNS Relay Injector’，是一个典型的内网渗透链式攻击工具。其核心有效性在于整合了三个成熟的攻击向量：DNS投毒（通过samba-tool注入A记录）、NTLM Relay（集成impacket-ntlmrelayx）以及强制认证（利用MS-RPRN的rpcping触发）。从代码逻辑看，POC是高度有效的，因为它通过自动化手段解决了内网渗透中寻找中继目标和触发回连的痛点。该漏洞CVE-2025-33073的核心在于SMB客户端驱动mrxsmb.sys未能正确处理伪造的目标名，导致攻击者可以利用普通域用户权限反射认证。POC中的inject_record和send_coercion函数精确对应了这一利用链。利用步骤如下：1. 攻击者使用普通域账号，利用samba-tool向域控DNS服务器注入一个伪造的A记录（如WPAD或指向攻击者IP的虚假主机名）。2. 在本地启动Impacket的ntlmrelayx模块，监听并准备将捕获的凭据重定向到目标服务器（如另一台未签名的工作站）。3. 调用rpcping等RPC接口，通过Print Spooler服务强制目标主机向攻击者控制的伪造主机名发起SMB认证。4. 攻击者接收到认证请求后，将其relay至目标，从而获得目标主机的SYSTEM权限或执行代码。投毒风险分析：该代码段投毒风险较低，约15%。代码使用了标准的Python库（argparse, subprocess, socket）以及知名的安全工具集（samba-tool, impacket），未发现混淆处理、Base64编码的Payload或是非必要的外部网络请求。主程序逻辑清晰，主要通过调用系统命令和开源库完成任务。然而，风险点在于：第一，代码中硬编码了‘Administrator’用户名，并提示输入密码，这在自动化脚本中虽常见，但若被恶意修改为向远程C2服务器回传凭据，则具有间谍软件特征；第二，工具虽然标注为教育用途，但其封装的自动化注入和触发机制极易被直接集成到恶意软件中。代码本身不含恶意后门，但其提供的‘强制认证’逻辑是典型的黑客攻击手法，建议在隔离环境测试，并警惕任何要求提供高权限域控凭据的修改版POC。

**项目地址:** /tmp/vulnwatchdog_fad1ff1df60a16c9facfcc5ef27b7f42/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
