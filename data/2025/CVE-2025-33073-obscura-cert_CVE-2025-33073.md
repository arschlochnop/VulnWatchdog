## CVE-2025-33073 - Microsoft Windows (SMB客户端/Active Directory) 权限提升/NTLM重放

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升/NTLM重放

**影响应用:** Microsoft Windows (SMB客户端/Active Directory)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, Windows 11, Windows Server 2016/2019/2022/2025 等受影响版本（需未启用SMB签名）

**利用条件:** 域内普通用户权限，目标机器未开启SMB签名，网络可达

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC（Obscura$ DNS Relay Injector）展示了CVE-2025-33073的链式利用逻辑。漏洞核心在于SMB客户端在处理特定认证请求时未强制执行签名校验，允许攻击者绕过传统的NTLM反射缓解措施。POC通过三个关键步骤实现攻击：首先，利用samba-tool在域内DNS服务器上注入恶意的A记录，将合法的主机名指向攻击者IP；其次，通过RPC调用（如MS-RPRN的rpcping）强制目标主机（受害者）向攻击者控制的伪造主机发起认证请求；最后，使用impacket-ntlmrelayx捕获该NTLM认证并将其重放到目标服务器。该POC在代码逻辑上是完整的，涵盖了从环境准备（DNS注入）到触发认证（RPC Coercion）再到利用（Relay）的全过程。然而，该代码在实际环境中的有效性高度依赖于目标网络是否强制执行SMB签名。由于默认情况下，非域控的Windows工作站通常不强制开启SMB签名，该POC在大多数企业内网环境中具有极高的实战价值。其复现步骤清晰，逻辑闭环，能够有效证明该漏洞在域环境下的横向移动能力。【利用步骤】1. 获取域内普通用户凭据。2. 使用samba-tool向域控DNS添加恶意A记录，将自定义域名指向攻击者IP。3. 启动impacket-ntlmrelayx监听，设置攻击目标（如另一台未开启SMB签名的服务器）。4. 运行RPC强制触发脚本，利用rpcping或其他RPC接口强制受害机器向恶意域名发起NTLM认证。5. 监听器捕获认证并自动重放至目标，获取目标主机的SYSTEM权限或执行任意命令。【投毒风险分析】该POC代码展现出较低的投毒风险。代码主要依赖于标准的安全研究工具如impacket和samba-tool，其核心逻辑是通过subprocess调用这些成熟的第三方工具，而非在脚本内部实现复杂的二进制负载。代码结构透明，主要功能函数（inject_record, start_relay, send_coercion）均有明确的功能定义，且没有发现混淆代码、Base64加密的恶意Payload或异常的远程服务器连接行为。虽然脚本中包含了明文密码占位符（'YourPassword'），这属于典型的教学代码特征。尽管如此，使用者仍需注意脚本中的subprocess调用是否可能被注入恶意参数。总体评估，该POC是一个典型的安全研究辅助工具，其主要风险在于工具本身被滥用于非授权攻击，而非代码层面包含恶意后门。对于防御者而言，重点应放在检测异常的DNS注入记录和监控RPC强制认证行为上。

**项目地址:** [https://cloud.tencent.com/developer/article/2532999](https://cloud.tencent.com/developer/article/2532999)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
