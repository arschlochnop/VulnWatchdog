## CVE-2025-33073 - Microsoft Active Directory / Windows Server 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Active Directory / Windows Server

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows Server 2016, 2019, 2022 (主要影响启用了Print Spooler服务的域控制器)

**利用条件:** 需要拥有受信任域的特权账户(如DNS管理权限)或能控制内网DNS记录，且目标环境中未禁用MS-RPRN及未开启SMB签名/LDAP签名。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC（名为Obscura$）展示了一个高度结构化的攻击链，通过整合DNS记录注入、NTLM中继监听和RPC强制认证来实现对域环境的控制。代码逻辑清晰，首先利用samba-tool在AD DNS中注入恶意A记录，为后续的中继攻击做准备。接着，利用socket.gethostbyname_ex进行轮询验证，确保DNS记录已在全球范围内传播。随后，调用impacket-ntlmrelayx启动中继监听，最终通过rpcping触发MS-RPRN（打印机漏洞）强制目标机器进行身份验证。分析显示，该工具并非简单的DoS，而是完整的横向移动链路，能够有效地在缺乏SMB签名的环境中捕获并重放身份验证凭据，从而实现对目标系统的未授权访问。POC采用Python编写，依赖成熟的安全库Impacket，具有极高的实战化参考价值。【利用步骤】1. 配置攻击者IP并确保处于目标内网环境；2. 使用--dns-ip参数指向域控，并提供具有DNS修改权限的凭证注入恶意A记录；3. 确认DNS解析生效后，脚本会自动启动ntlmrelayx服务；4. 脚本通过rpcping向受害者IP发起RPC调用，强制受害者向攻击者注入的恶意域名发起身份验证请求；5. 攻击者接收到NTLM请求并将其重放至预设的目标服务器（如AD CS或另一个Server），从而获取更高权限或执行代码。【投毒风险分析】经过代码审查，该POC主要依赖Python标准库（argparse, subprocess, socket, time, sys）以及合法的第三方安全框架Impacket。代码中未发现混淆处理，也没有隐藏的恶意网络回连或文件加密行为。风险点在于脚本中的硬编码凭证逻辑（如--password=YourPassword），如果用户在不加检查的情况下运行包含默认密码的脚本，可能导致凭证泄露给第三方监控。此外，由于此类脚本常被打包为二进制文件分发，建议研究人员仅从可信源码构建，避免下载预编译版本。目前评估其投毒风险较低，属于典型的安全研究工具，但其强大的自动化攻击能力使其在恶意软件家族中极易被二次包装利用。分析过程中未发现明显的反调试或沙箱逃逸技术，代码透明度较高。

**项目地址:** [https://github.com/vulnwatchdog/Obscura-DNS-Relay-Injector](https://www.google.com/search?q=https://github.com/vulnwatchdog/Obscura-DNS-Relay-Injector)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
