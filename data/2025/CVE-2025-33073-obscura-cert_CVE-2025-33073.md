## CVE-2025-33073 - Microsoft Windows (SMB客户端/mrxsmb.sys) 权限提升 (LPE) / NTLM 中继

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 (LPE) / NTLM 中继

**影响应用:** Microsoft Windows (SMB客户端/mrxsmb.sys)

**危害等级:** 严重 (Critical)

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows 10, 11, Windows Server 2016/2019/2022/2025 (未打2025年6月补丁版本)

**利用条件:** 具有普通域用户权限，目标环境未强制执行SMB签名（SMB Signing），可访问域控制器及目标主机。

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

CVE-2025-33073 是一个存在于 Windows Server Message Block (SMB) 客户端中的严重权限提升漏洞。该漏洞的根源在于 mrxsmb.sys 驱动程序在处理编组目标信息时存在逻辑缺陷，导致攻击者能够绕过 NTLM 反射缓解措施。在典型的 Active Directory (AD) 域环境中，攻击者可以利用普通域用户权限，通过添加恶意的 DNS A 记录（ADIDNS 投毒）将特定主机名指向攻击者受控的 IP 地址。随后，攻击者利用 RPC 强制认证技术（如 MS-RPRN 或 MS-EFSR）诱导目标服务器（如文件服务器或工作站）向攻击者控制的伪造主机发起认证请求。由于漏洞允许伪造目标服务名（SPN）并绕过签名校验，攻击者可以将截获的 NTLM 认证凭据中继回目标机器或其他未启用 SMB 签名的机器，从而获取 SYSTEM 权限。POC 有效性分析：提供的 Python 代码片段展示了一个典型的自动化链条：首先利用 samba-tool 在域内注入 DNS 记录，解决定位问题；然后启动 impacket-ntlmrelayx 监听并准备中继；最后使用 rpcping 触发目标主机的认证行为。代码逻辑完整，直接调用了成熟的内网渗透工具库，在未修补的域环境中具有极高的实战价值，能够实现从普通用户到全域管理员的快速纵向渗透。利用步骤如下：1. 获取域内普通用户凭据；2. 使用脚本在 DC 上注入 A 记录指向攻击者 IP；3. 启动 NTLM 中继服务器，设置目标为欲攻陷的服务器；4. 触发 RPC 强制认证，使目标服务器向注入的 DNS 记录发起连接；5. 中继成功后，在目标机执行任意命令。投毒风险分析：该 POC 代码主要依赖于标准的系统工具（samba-tool）和知名的安全库（Impacket），代码逻辑透明且具有教学意义。通过对 main.py 的静态分析，其行为符合安全研究人员进行内网渗透测试的典型逻辑。然而，由于脚本涉及敏感凭据（如代码中的 --username=Administrator 和 --password 参数），在实际分发中存在极高的凭据泄露风险。虽然当前代码未发现明显的混淆、恶意回连或删除系统文件的后门逻辑，但此类‘域内大杀器’级别的工具极易被二次修改并植入恶意代码。15% 的风险评分主要源于其对外部工具的高度依赖，若 Impacket 等库被替换为恶意版本，或脚本被赋予 SUID/高权限运行，将对研究者的环境造成反向威胁。建议在使用此类自动化利用工具时，务必在隔离的实验环境中运行，并对所有调用的子进程指令进行严格审计。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2025-33073-Obscura-Relay](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2025-33073-Obscura-Relay)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)
