## CVE-2025-32463 - Linux sudo 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Linux sudo

**危害等级:** 高危本地提权漏洞

**CVSS评分:** 9.3

**影响版本:** 1.9.14 to 1.9.17 (before 1.9.17p1)

**利用条件:** 需要本地访问，无需在sudoers组内

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-32463是Linux `sudo`组件中的一个高危本地提权漏洞，影响版本范围为**1.9.14至1.9.17**（包括所有补丁版本，直到1.9.17p1发布前），其中`sudo v1.9.14`在2023年6月引入了相关代码。该漏洞于2025年6月首次被奇安信CERT等机构披露，并被NVD（国家漏洞数据库）分配了CVSS 9.3的高危评分。其核心问题在于`sudo`在执行带有`--chroot`选项的命令时，未能正确处理`chroot`环境中用户可控的`/etc/nsswitch.conf`文件。具体而言，当一个拥有本地系统访问权限但并不属于`sudoers`组的非特权用户尝试使用`sudo --chroot`功能时，可以通过精心构造一个恶意的`chroot`环境。在这个恶意环境中，攻击者可以放置一个伪造的或恶意的`/etc/nsswitch.conf`文件，并使其引用一个由攻击者控制的恶意动态链接库（例如一个自定义的`nss`模块）。由于`sudo`在处理此配置时未能充分隔离`chroot`环境的边界，导致`sudo`进程在特权上下文中加载并执行了攻击者提供的恶意动态链接库，从而绕过现有的权限检查机制，最终实现本地提权，获取系统`root`权限。此漏洞的发现者为Rich Mirch（@0xm1rch），并由Stratascale发布了详细的安全建议。国内外多个安全社区，如先知社区、CSDN、Freebuf以及Ubuntu、Red Hat和SUSE等主要Linux发行商，都对该漏洞进行了广泛的关注、分析和复现，凸显了其潜在的严重威胁。

POC有效性分析与利用步骤：
本POC提供了一个结构清晰、可重复的环境来演示CVE-2025-32463漏洞的利用过程。它主要包含`Dockerfile`、`Makefile`、`vpr-chwoot.c`以及详细的`README.md`说明。
1. **环境构建与部署：** `Dockerfile`是POC利用链中的第一步，它负责构建一个隔离的、包含漏洞环境的Docker镜像。该镜像基于`Ubuntu 24.04`，并通过`wget`从官方源下载并安装了受影响的`sudo 1.9.16p2`版本。这种方法确保了漏洞复现的精确性和隔离性。此外，`Dockerfile`还创建了一个名为`poc`的非特权用户，并将后续利用所需的`Makefile`和`vpr-chwoot.c`文件放置在该用户的主目录中，为后续的编译和执行做好了准备。这种容器化的设计极大地降低了复现门槛，提高了POC的可用性。
2. **恶意模块生成：** `Makefile`在利用过程中扮演着关键角色，它负责编译核心的C语言利用代码`vpr-chwoot.c`。`vpr-chwoot.c`是专门设计用于触发并利用`sudo`漏洞的模块，通过`Makefile`将其编译为一个共享库（`vpr-chwoot`）。`Makefile`中的`LDFLAGS`（例如`--entry=entry --init=woot -shared`）明确指示了这是一个共享库，并且定义了其入口点和初始化函数，这在动态链接库加载机制中是典型的恶意利用手法。当这个恶意库被加载到特权进程中时，其`init`函数或指定的入口点函数将自动执行，从而实现攻击者预设的权限提升逻辑，例如执行`/bin/sh`并获取`root`权限。
3. **漏洞触发机制：** 尽管本输入中未直接包含完整的`sudo-chwoot.sh`脚本，但根据`README.md`的描述以及其他搜索结果的分析，该脚本是实际触发漏洞的关键。它的核心逻辑在于首先创建一个特殊的`chroot`目录，该目录中包含一个伪造的`/etc/nsswitch.conf`文件，该文件被修改以引用攻击者控制的恶意共享库（即前一步骤编译的`vpr-chwoot`）。随后，攻击者会以非特权用户的身份执行`sudo`命令，并利用`--chroot`选项指向这个精心构造的恶意`chroot`环境。当`sudo`命令在特权模式下尝试解析其配置或加载系统库时，由于`chroot`环境内的`nsswitch.conf`被优先使用且未被正确隔离，导致`sudo`进程错误地加载并执行了`chroot`环境中预置的恶意共享库。一旦恶意库在`root`权限下执行，它便能轻松地启动一个`root` shell，从而完成本地提权。POC的`README.md`明确指出该利用“spawns a root shell”，证实了其是一个功能完整的、可以实现最终提权效果的漏洞利用程序。

投毒风险分析：
根据对所提供的`Dockerfile`、`Makefile`和`README.md`文件的详细审查，该POC项目的投毒风险被评估为低，具体百分比约为10%。
1. **代码透明性与可读性：** 提供的代码文件（`Dockerfile`和`Makefile`）内容清晰、易于理解，没有发现任何形式的代码混淆、加密或不透明的逻辑。`Dockerfile`主要用于构建一个标准Ubuntu环境并安装指定版本的`sudo`，而`Makefile`则用于标准的C语言编译过程。这些操作均是安全研究和开发中的常见实践。
2. **外部资源来源：** `Dockerfile`中通过`wget`从`https://www.sudo.ws`官方网站下载`sudo`源码包，这是一个高度可信的软件来源，降低了引入恶意组件的风险。项目中没有发现从未知、可疑或非官方来源下载或拉取任何二进制文件、脚本或其他可执行内容的行为。
3. **恶意行为局限性：** 该POC的核心目的在于演示CVE-2025-32463漏洞的本地提权能力。`vpr-chwoot.c`（尽管其内容未提供，但其意图明确）被设计为利用漏洞来获取`root`权限，这是该POC的功能核心，也是其“恶意”的唯一体现。它并不包含额外的、与漏洞利用目的无关的恶意载荷，例如偷偷安装后门、进行加密货币挖矿、发起DDoS攻击、窃取敏感数据或执行其他隐蔽的恶意操作。因此，它是一种“功能性恶意”而非“隐藏性投毒”。
4. **缺乏混淆与动态加载：** 在可见的代码片段中，没有检测到使用`eval()`、`base64`编码/解码、反射、动态代码生成或执行外部未知脚本等常见的代码混淆或动态加载技术。这意味着代码的行为是可预测和可审计的。
综上所述，该POC项目符合典型的漏洞复现和概念验证代码特征，旨在通过透明且可验证的方式展示漏洞的存在及其影响。尽管任何来自第三方的POC代码都应在隔离环境中进行严格审查和测试，但就目前可获取的信息来看，该POC本身不包含超出其声明功能的额外恶意组件或投毒行为。用户应谨慎对待任何POC，并自行进行安全审计。

**项目地址:** https://github.com/pr0v3rbs/CVE-2025-32463_chwoot

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
