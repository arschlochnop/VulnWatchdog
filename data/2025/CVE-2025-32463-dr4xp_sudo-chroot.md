## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Sudo 1.9.14 至 1.9.17 (包括), 且在 1.9.17p1 之前版本

**利用条件:** 本地访问，具有执行 sudo 命令的权限

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

### 漏洞概述与技术分析
CVE-2025-32463 是 Linux Sudo 组件中发现的一个高危本地权限提升（Local Privilege Escalation, LPE）漏洞。该漏洞源于 Sudo 在处理 `--chroot` (或 `-R`) 选项时对 Name Service Switch (NSS) 配置文件 `nsswitch.conf` 的不当处理。当一个非特权用户执行 `sudo` 命令并指定一个 `--chroot` 目录时，`sudo` 会在设定的 chroot 环境中运行。然而，在此过程中，如果 chroot 目录内存在一个用户可控的 `nsswitch.conf` 文件，且该文件被配置为加载恶意的共享库（例如 `libnss_*.so`），`sudo` 进程就会在尝试解析用户或组信息时加载并执行该恶意库。由于 `sudo` 此时以 root 权限运行，恶意库中的代码将能够以 root 权限执行，从而导致本地权限提升。

该漏洞最早于 Sudo v1.9.14 版本中引入，影响范围涵盖 Sudo 1.9.14 到 1.9.17 版本，直至 1.9.17p1 版本发布修复。攻击者无需特殊的网络访问或复杂的认证，只需具备本地用户权限并能够执行 `sudo` 命令即可利用。

### POC有效性分析与利用步骤
所提供的 POC 代码包含一个 Python 脚本 `exploit.py` 和一个 C 语言载荷 `woot1337.c`。这是一个功能完整且高度有效的本地提权利用程序。其利用流程如下：

1.  **创建临时环境**：`exploit.py` 首先会在 `/tmp` 目录下创建一个唯一的临时目录（例如 `sudowoot.stage.XXXXXX`），所有后续的恶意文件和目录都将在此临时环境中构建。
2.  **生成恶意载荷**：`exploit.py` 将 C 代码 `woot1337.c` 写入临时目录。该 C 代码定义了一个构造函数 `woot()`。当该共享库被加载时，`woot()` 函数将自动执行 `setreuid(0,0)` 和 `setregid(0,0)` 来获取 root 权限，然后执行 `/bin/bash` 以提供一个 root shell。
3.  **编译共享库**：`exploit.py` 使用 `gcc` 将 `woot1337.c` 编译为一个共享库 `libnss_/woot1337.so.2`。编译时使用了 `-shared`、`-fPIC` 等选项，并通过 `-Wl,-init,woot` 确保 `woot` 函数在库加载时被调用。该共享库存储在 `libnss_` 子目录中，模拟标准的 NSS 模块路径。
4.  **构造恶意 chroot 环境**：脚本在临时目录中创建 `woot/etc` 目录，并复制 `/etc/group` 到 `woot/etc`。接着，它创建 `woot/etc/nsswitch.conf` 文件，并将其内容设置为 `passwd: /woot1337`。这个配置旨在告诉 NSS 查找 `passwd` 服务时，加载路径为 `/woot1337` 的模块。在 chroot 环境中，`/woot1337` 将指向 `woot/libnss_/woot1337.so.2`。
5.  **触发漏洞**：最后，脚本执行命令 `sudo -R woot woot`。这里的 `-R woot` 参数指示 `sudo` 将根目录切换到临时目录下的 `woot` 目录。当 `sudo` 在 chroot 环境中启动并尝试解析用户或组信息时，它会读取 `woot/etc/nsswitch.conf`。根据此恶意配置，`sudo` 将尝试加载 `libnss_/woot1337.so.2`。由于 `sudo` 此时以 root 权限运行，并且 `woot()` 函数被指定为库的初始化函数，因此恶意代码会以 root 权限执行，从而获得一个 root shell。
6.  **清理**：漏洞利用成功或失败后，脚本会清理创建的临时目录及其内容。

该 POC 的设计思路清晰，自动化程度高，无需人工干预即可完成整个利用过程，因此被评为10/10的质量分数。它直接演示了如何通过精心构造的 chroot 环境和 NSS 配置来劫持 `sudo` 进程的执行流，达到本地权限提升的目的。

### 投毒风险分析
对提供的 POC 代码 (`exploit.py` 和 `woot1337.c`) 进行详细审查，评估其投毒风险：

1.  **代码透明度**：Python 脚本和 C 语言载荷的代码都非常清晰、直接，没有使用任何形式的混淆、加密或不透明的编程技巧。研究人员可以轻松阅读和理解代码的每一行，确认其意图是实现本地权限提升而非其他恶意行为。
2.  **库和依赖**：Python 脚本仅使用了标准的 Python 库，如 `os`、`subprocess`、`shutil` 和 `tempfile`。这些都是操作系统交互、进程管理和文件操作的常用且安全的模块。C 语言载荷是一个简单的权限提升代码，依赖标准 C 库函数和 `gcc` 编译器，没有引入任何非标准或可疑的外部依赖。
3.  **网络行为**：POC 代码中没有发现任何进行网络连接（如 HTTP/HTTPS 请求、TCP/UDP 连接）的代码。这意味着该 POC 不会尝试连接外部服务器进行数据 exfiltration、下载额外载荷、接收命令与控制（C2）指令或执行其他远程恶意操作。
4.  **恶意行为限定**：C 语言载荷 `woot1337.c` 的核心功能是调用 `setreuid(0,0)` 和 `setregid(0,0)` 来获取 root 权限，然后执行 `/bin/bash`。这是典型的本地提权载荷，其目的就是为了获得一个高权限的 shell。代码中没有发现除此以外的其他恶意指令，例如删除关键系统文件、安装后门、篡改系统配置或进行持久化等。
5.  **文件系统操作**：POC 脚本在文件系统上的操作仅限于在临时目录中创建和写入文件（C 源文件、编译后的共享库、恶意 `nsswitch.conf`）以及创建必要的目录结构。在利用成功或失败后，脚本会执行清理操作，删除所有创建的临时文件和目录，这体现了良好的 POC 实践，减少了系统上的残留痕迹。

综合以上分析，该 POC 代码的投毒风险极低，评估为 5%。它专注于演示 CVE-2025-32463 的利用机制，不包含额外的恶意载荷或隐藏功能。在受控环境中进行防御性安全研究和测试时，此 POC 是安全可靠的。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
