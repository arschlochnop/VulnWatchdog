## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 和 Windows Server 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS) 和 Windows Server

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019, Windows Server 2012

**利用条件:** 无需认证, 远程可利用, 低攻击复杂度, 通过特制事件触发不安全对象反序列化

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 40%

## 详情

该POC是一个针对CVE-2025-59287漏洞的PowerShell完整利用脚本，它基于 Hawktrace 提供的原始概念验证。该漏洞影响Microsoft Windows Server Update Services (WSUS)，允许未经身份验证的远程攻击者通过发送特制的SOAP请求，利用不安全的.NET对象反序列化机制实现远程代码执行。WSUS在处理 `AuthorizationCookie` 时使用传统的二进制序列化，当包含恶意payload的cookie被反序列化时，即可触发任意代码执行。

**POC有效性分析:**
该POC脚本名为 `wsus-rce.ps1`，其有效性已在未打补丁的Windows Server 2022 (WSUS version 10.0.20348.1) 上得到验证。POC自动化了整个攻击链，具体流程如下：
1.  **获取认证Cookie**: 脚本首先向目标WSUS服务器的 `/SimpleAuthWebService/SimpleAuth.asmx` 服务发送一个SOAP请求，调用 `GetAuthorizationCookie` 方法。由于漏洞无需认证，攻击者无需凭据即可获取一个有效的会话Cookie。脚本会生成一个唯一的 `clientId`，并使用 `hawktrace.local` 作为 `dnsName`。
2.  **生成反序列化Payload**: 脚本会自动从指定的GitHub地址（`https://github.com/DarkSecDevelopers/ysoserial.net/raw/master/ysoserial.net/binaries/Release/ysoserial.net.exe`）下载 `ysoserial.net` 工具。`ysoserial.net` 是一个专门用于生成.NET反序列化payload的开源工具。POC利用该工具生成一个反弹shell的payload，其中包含攻击者监听服务器的IP地址和端口。
3.  **发送恶意Payload**: 生成的恶意payload随后被嵌入到WSUS请求的 `AuthorizationCookie` 中。脚本通过SOAP请求将这个特制的Cookie发送到 `/ReportingWebService/ReportingWebService.asmx` 服务，调用 `PingAndProcessReportingData` 方法。
4.  **触发执行**: 根据 `README.md` 的说明，在发送payload后，需要(重新)打开目标WSUS服务器上的WSUS管理控制台。此操作将促使WSUS服务器尝试反序列化恶意 `AuthorizationCookie`，从而触发内嵌的反弹shell payload。攻击者预设的Netcat监听器将捕获到反弹shell，获得目标系统的远程命令执行权限。POC提供了截图证明了攻击成功后Kali上建立的反弹shell。

**利用步骤:**
1.  **环境准备**: 攻击者需要在其攻击机（如Kali Linux）上设置一个Netcat监听器，用于接收反弹shell。例如 `nc -lvnp <port>`。
2.  **配置POC脚本**: 编辑 `wsus-rce.ps1` 脚本，更新其中的 `Target` URL、`Port` 以及 `ListeningIP` 和 `ListeningPort` 等变量，使其指向目标WSUS服务器和攻击者的监听器。
3.  **运行POC**: 在攻击机上执行PowerShell脚本 `wsus-rce.ps1`。脚本将自动下载 `ysoserial.net`，生成payload，并将其发送到目标WSUS服务器。
4.  **触发漏洞**: 在目标Windows Server上，手动重新打开WSUS管理控制台。此操作将激活服务器端对恶意Cookie的反序列化处理。
5.  **获取Shell**: 攻击机上的Netcat监听器将收到来自WSUS服务器的反弹shell连接，攻击者即可在目标系统上执行任意命令。

**投毒风险分析:**
该POC的投毒风险评估为中等，约40%。主要风险点集中在其依赖外部下载可执行文件的机制上：
1.  **外部可执行文件下载**: 脚本硬编码了 `ysoserial.net.exe` 的下载地址，该文件直接从GitHub仓库的 `raw` 内容下载。虽然 `ysoserial.net` 是一个合法且常用的安全工具，但从第三方GitHub仓库下载可执行文件始终存在供应链风险。如果 `DarkSecDevelopers` 的GitHub仓库被攻陷，或者其内容被篡改，攻击者可能将恶意的 `ysoserial.net.exe` 植入到该地址，导致运行POC的机器在下载并执行 `ysoserial.net` 时被感染。这是一种潜在的“投毒”风险，尽管并非POC脚本本身包含恶意代码，但其依赖的外部资源存在风险。
2.  **代码清晰度**: `wsus-rce.ps1` 脚本本身的PowerShell代码逻辑清晰，结构良好，包含了详细的注释。除了调用 `ysoserial.net` 生成payload外，脚本主要负责构造和发送SOAP请求，没有发现明显的混淆、加密或直接植入恶意代码的行为。
3.  **无其他可疑通信**: 脚本没有额外的外部网络请求指向未知的C2服务器，或包含其他可疑的持久化机制。反弹shell的连接目标完全由用户配置，属于漏洞利用的预期结果，不应被视为POC本身的投毒。

建议防御性安全研究人员在使用此类POC进行测试时，应手动下载并校验 `ysoserial.net` 的哈希值，或从官方/可信渠道获取该工具，以最大程度降低供应链投毒风险。

**项目地址:** https://github.com/ZephrFish/CVE-2025-59287-WSUS

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
