## CVE-2025-9074 - Docker Engine, Docker Desktop 容器逃逸, 远程代码执行

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸, 远程代码执行

**影响应用:** Docker Engine, Docker Desktop

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** Docker Desktop < 4.44.3

**利用条件:** 需要目标Docker API端口(默认为2375)暴露且未授权访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

### POC有效性分析
提供的`cve-2025-9074.sh`脚本是一个高度有效的概念验证（PoC），用于利用CVE-2025-9074漏洞。该漏洞允许攻击者通过未授权的Docker Remote API访问实现容器逃逸和远程代码执行（RCE）。

该脚本的有效性体现在以下几个方面：首先，它能够动态检测目标Docker主机的操作系统类型（Linux或Windows），并根据操作系统配置相应的宿主机根目录挂载路径（例如，Linux为`/:/host_root`，Windows为`/mnt/host/c:/host_root`）。这一步是实现容器逃逸的关键，它将宿主机的完整文件系统暴露给攻击者控制的容器。其次，脚本通过查询`/images/json`端点智能地枚举目标主机上可用的Docker镜像，并在没有找到现有镜像时，自动回退到`alpine:latest`镜像，这提高了其适用性和鲁棒性。再次，它正确利用了Docker API的`/containers/create`端点创建新容器，并巧妙地将宿主机根目录挂载到容器内部。随后，通过`/containers/{id}/start`启动容器，并最终使用`/containers/{id}/exec`端点在已挂载宿主机根目录的容器内执行攻击者指定的任意命令。由于宿主机根目录已被挂载，在容器内执行的命令实际上能够直接访问和操作宿主机的文件系统，从而实现完整的远程代码执行和容器逃逸。

该PoC脚本以Bash编写，代码清晰，不依赖任何非标准库，仅使用`curl`、`grep`、`cut`、`sed`等常用shell工具。它提供了明确的用法说明和错误处理机制，使其成为一个功能完整且易于使用的漏洞利用工具。综上所述，该PoC是完全可用且高度有效的，能够成功演示并利用CVE-2025-9074漏洞。

### 利用步骤
利用CVE-2025-9074漏洞并执行此PoC脚本的步骤如下：

1.  **前提条件确认：**
    *   目标系统上运行的Docker Engine版本必须低于4.44.3。Docker官方已在4.44.3版本中修复此漏洞。
    *   目标Docker主机的远程API端口（默认为2375）必须在网络上暴露，并且未启用任何形式的身份验证，允许未经授权的访问。

2.  **准备PoC脚本：**
    *   将提供的`cve-2025-9074.sh`脚本文件保存到本地可执行环境中，例如`/tmp/cve-2025-9074.sh`。
    *   赋予脚本执行权限：`chmod +x /tmp/cve-2025-9074.sh`。

3.  **执行PoC：**
    *   在命令行中执行脚本，提供目标IP地址和您希望在宿主机上执行的命令。例如，要查看宿主机的用户ID：
        `./cve-2025-9074.sh 192.168.1.10 'id'`
    *   如果您知道Docker API运行在非标准端口上，可以额外指定端口号：
        `./cve-2025-9074.sh 192.168.1.10 'ls -la /host_root' 2376`

4.  **脚本内部操作流程：**
    *   脚本首先会尝试连接到目标Docker API的`/info`端点，以确认连接性并识别目标系统的操作系统类型（Linux或Windows）。
    *   根据检测到的操作系统，脚本会智能地构建一个用于挂载宿主机根目录的路径（如Linux的`/:/host_root`，Windows的`/mnt/host/c:/host_root`）。
    *   接着，脚本会查询目标Docker主机上的现有镜像列表。如果找到可用镜像，则优先使用；否则，它会尝试使用`alpine:latest`作为回退镜像（这可能要求目标主机能够访问外部网络以下载该镜像）。
    *   脚本通过向Docker API的`/containers/create`端点发送精心构造的JSON请求来创建一个新的容器。此请求的核心在于指定了宿主机根目录的挂载，并将容器配置为运行一个保持存活的命令（如`tail -f /dev/null`）。
    *   容器创建成功后，脚本会通过`/containers/{id}/start`端点启动该容器。
    *   最后，脚本利用`/containers/{id}/exec`端点，在已启动且挂载了宿主机根目录的容器内部执行攻击者指定的命令。由于宿主机根目录的挂载，命令可以通过`/host_root`路径直接作用于宿主机的文件系统。

5.  **获取结果：**
    脚本会将命令的执行结果打印到您的终端，从而实现对目标宿主机的远程命令执行。

### 投毒风险分析
该PoC脚本的投毒风险评估为**低**，具体百分比约为**5%**。

**详细分析如下：**

1.  **代码透明度高：** 该PoC是一个用Bash编写的shell脚本，代码逻辑清晰、易于阅读和理解。脚本中没有发现任何形式的代码混淆、加密或恶意编码技术。安全研究人员或分析师可以很容易地审计其每一行代码，以确认其行为。

2.  **无外部恶意依赖：** 脚本不从外部（如互联网上的未知URL）下载并执行任何二进制文件或额外的脚本。它仅依赖于目标系统上通常可用的标准系统工具，例如`curl`、`grep`、`cut`、`sed`和`date`。唯一可能涉及外部网络请求的是在目标主机上没有可用镜像时，PoC会尝试拉取`alpine:latest`镜像，但这属于Docker的正常行为，而非PoC本身的恶意投毒行为。

3.  **功能目标明确：** 脚本的核心功能是探测Docker API，创建一个将宿主机根目录挂载到容器内部的特权容器，并在此容器内执行用户指定的命令。其所有操作都直接服务于利用CVE-2025-9074漏洞，演示容器逃逸和RCE。脚本中没有发现试图执行非预期网络通信（除了与目标Docker API的通信）、收集敏感信息、创建持久化后门、修改系统关键配置或进行其他恶意负载投放的代码片段。

4.  **有限的副作用和痕迹：** 脚本在成功利用后会在目标Docker主机上留下一个以`audit_`前缀命名的已停止容器（如果未清理）。虽然这是一种攻击痕迹，但它不构成恶意投毒，也未对系统造成持续性的危害。攻击者若要实现持久化，通常需要额外步骤，而非此PoC脚本的直接功能。

5.  **安全研究目的：** 从脚本的标题、描述和代码结构来看，它显然是为安全研究和渗透测试目的而设计的工具。其行为符合一个标准的漏洞利用PoC，旨在证明漏洞的存在和可利用性，而非悄悄植入恶意软件。

综上所述，尽管在执行任何PoC代码时都应保持警惕并进行充分的代码审查，但此`cve-2025-9074.sh`脚本本身并未包含任何显式的恶意投毒功能或隐蔽行为。其投毒风险极低，主要风险在于误用或被恶意攻击者利用进行攻击，而非PoC代码自身的恶意性。

**项目地址:** https://github.com/Shaoshi17/CVE-2025-9074-Docker-Exploit

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
