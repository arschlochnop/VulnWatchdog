## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (有效用户凭证), 需要网络访问

**POC 可用性:** 8

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

对CVE-2025-2304的POC代码（exploit.py）分析表明，这是一个针对Camaleon CMS的权限提升漏洞，通过不当的Mass Assignment实现。该POC脚本设计精良，分为四个关键步骤，确保了漏洞利用的完整性和可靠性。

**POC有效性分析：**
该POC代码（exploit.py）旨在利用Camaleon CMS中存在的CVE-2025-2304漏洞，该漏洞被描述为一个通过Mass Assignment导致的权限提升缺陷。脚本的执行流程被精心划分为四个清晰且至关重要的阶段，以确保漏洞利用的稳健性和成功率。

1.  **初始登录CSRF Token获取**：漏洞利用序列始于脚本对目标CMS的`/admin/login`端点发起一次标准的GET请求。这一动作对于获取“authenticity_token”至关重要，该token是Web框架（如Camaleon CMS可能基于的Ruby on Rails）为减轻表单提交过程中的跨站请求伪造（CSRF）攻击而实施的安全措施。脚本利用一个精确的正则表达式（`RE_LOGIN_CSRF`）来解析HTML响应并提取此token。若无有效的`authenticity_token`，后续的登录尝试很可能失败，这凸显了脚本对目标安全机制的深入理解。

2.  **建立认证会话**：成功获取登录CSRF token后，脚本继续对CMS进行认证。它向`/admin/login` URL发送一个POST请求，其中包含之前获取的`authenticity_token`以及提供的`username`和`password`。登录后，脚本执行了一个关键的验证步骤：它检查HTTP响应内容中是否存在表示成功登录的关键词，例如“dashboard”或“logout”。此显式检查确认已成功建立一个认证会话，这是权限提升阶段的先决条件。这一步骤明确指出，此漏洞利用需要事先认证，即攻击者必须拥有至少一个低权限用户的有效凭据。

3.  **提取用户特定数据和配置文件CSRF Token**：在活跃的认证会话下，脚本导航至`/admin/profile/edit`页面。此阶段至关重要，原因有二。首先，它允许脚本识别与当前认证会话关联的`user_id`。此`user_id`通过另一个正则表达式（`RE_USER_ID`）从URL模式（如`/admin/users/{user_id}/updated_ajax`）中动态提取，该模式通常出现在个人资料页面的表单操作中。其次，个人资料编辑表单本身包含一个新的、用户特定的`authenticity_token`（通过`RE_PROFILE_CSRF`提取），这是提交个人资料更新所必需的。这种分层的CSRF保护意味着漏洞利用需要感知并绕过多个token要求，这体现了POC在模拟合法用户交互方面的彻底性。

4.  **通过Mass Assignment实现权限提升**：漏洞利用的高潮是向`/admin/users/{user_id}/updated_ajax`端点发送一个精心构造的PATCH请求，其中`{user_id}`是前一步骤中获取的标识符。此请求旨在利用Mass Assignment漏洞。当Web应用程序在没有充分过滤或验证的情况下自动将请求参数（例如，来自表单提交）绑定到对象的属性时，就会发生Mass Assignment。在权限提升的背景下，这通常意味着攻击者可以在更新请求中提供一个额外参数，例如`user[is_admin]=true`或`user[role]=admin`。尽管提供的输入中最终的Payload被截断，但搜索结果中对漏洞的描述（“通过Mass Assignment实现权限提升”）强烈证实了这种攻击向量。脚本设置了特定的HTTP头，`X-Requested-With: XMLHttpRequest`和`X-CSRF-Token`，以模拟源自合法个人资料编辑表单的AJAX请求，进一步增加了成功利用的可能性。一旦成功执行，此PATCH请求将修改数据库中目标用户的属性，赋予其Camaleon CMS的管理员权限。
该POC代码表现出高质量：它使用`requests`库进行可靠的HTTP处理，包含清晰的错误消息以便调试，并自动管理会话cookie。`requests.packages.urllib3.disable_warnings()`行的存在，虽然在测试中很常见，但并未削弱脚本的主要目的。总的来说，这个`exploit.py`脚本是CVE-2025-2304的一个高效且精心设计的概念验证，提供了一条从经过认证的低权限用户到完全管理员控制的完整且可操作的路径。

**利用步骤：**
1.  **获取漏洞利用脚本**：从公开源（如GitHub或其他漏洞库）获取`CVE-2025-2304`的POC脚本，例如本分析中的`exploit.py`。
2.  **准备目标信息**：确定目标Camaleon CMS的URL、一个有效用户的用户名和密码。此漏洞需要认证。
3.  **执行脚本**：运行`exploit.py`脚本，并提供目标URL、用户名和密码作为参数。例如：`python3 exploit.py <target_url> <username> <password>`。
4.  **自动登录并获取信息**：脚本将首先访问CMS的登录页面获取CSRF token，然后使用提供的凭据进行登录。登录成功后，脚本会访问当前用户的个人资料编辑页面，从中提取当前用户的ID和用于更新资料的另一个CSRF token。
5.  **发送特权提升Payload**：脚本将使用获取到的用户ID和CSRF token，向`/admin/users/{user_id}/updated_ajax`端点发送一个PATCH请求。此请求会包含一个恶意构造的Payload，利用Mass Assignment漏洞，将当前用户的权限提升到管理员级别。
6.  **验证权限**：攻击者可以尝试以之前使用的用户身份再次登录CMS，并检查是否获得了管理员仪表盘或特权功能，以验证漏洞利用是否成功。

**投毒风险分析：**
对提供的`exploit.py`代码进行详细审查后，评估其投毒风险为**低 (5%)**。以下是具体的风险分析：

**代码清晰度与可读性**：脚本代码结构清晰，使用了标准Python语法和`requests`库，逻辑易于理解。变量命名规范，函数职责明确，有助于安全研究人员快速审计代码，识别任何潜在的恶意行为。这降低了恶意代码被隐藏的可能性。

**外部依赖与库**：脚本主要依赖Python的`requests`库，这是一个广泛使用且受信任的HTTP客户端库。没有发现导入非标准或可疑的第三方库。`requests.packages.urllib3.disable_warnings()` 的使用是为了禁用SSL警告，这在渗透测试或本地环境中很常见，本身不构成恶意行为。

**网络活动**：脚本的所有网络活动都明确指向通过命令行参数指定的目标CMS URL。请求路径（`/admin/login`, `/admin/profile/edit`, `/admin/users/{user_id}/updated_ajax`）与漏洞利用的逻辑完全匹配，旨在与目标Web应用程序的已知接口进行交互。没有发现尝试连接到外部C2服务器、下载额外Payload、扫描其他网络资产或执行任何未经授权的外部通信，这表明其意图仅限于目标漏洞利用。

**文件系统操作**：脚本中没有进行任何文件读写、修改或删除操作，也未发现尝试在本地文件系统上创建或执行文件。这意味着它不会在执行它的系统上留下额外的恶意痕迹，保持了其作为安全工具的纯粹性。

**代码混淆与动态执行**：代码中没有使用任何形式的代码混淆技术，例如base64编码、加密字符串或复杂的逻辑跳转，也没有使用`eval()`、`exec()`等动态代码执行函数来加载或执行外部不可控的代码。这大大降低了隐藏恶意Payload或行为的风险。

**恶意Payload注入**：虽然脚本的最终Payload部分被截断，但从其上下文和漏洞类型来看，它预期会注入一个Mass Assignment相关的Payload，以修改用户的权限属性。这种Payload是漏洞利用的核心，但其意图是针对目标CMS本身，而不是针对执行POC的环境。假设完整的Payload是用于权限提升而非其他恶意目的，则其风险可控。

**总结**：鉴于上述分析，该POC代码表现出高度的透明度和标准化行为。其设计目标是专注于验证和利用Camaleon CMS的特定漏洞。没有发现任何指示其包含后门、数据窃取、C2通信或其他投毒行为的证据。因此，将其作为防御性安全研究工具的投毒风险极低。

**项目地址:** /tmp/vulnwatchdog_160be3e7642d6ffeaacaf39fdbc23876/

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
