## CVE-2025-2304 - Camaleon CMS Privilege Escalation (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Privilege Escalation (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** < 2.9.1

**利用条件:** 需要认证

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-2304 识别出 Camaleon CMS 中存在一个严重的特权升级漏洞，具体表现为“批量赋值（Mass Assignment）”缺陷。当应用程序在未进行适当验证或过滤的情况下，自动将传入的请求参数绑定到对象的属性时，就会出现批量赋值漏洞。在 Camaleon CMS 的上下文中，这个缺陷允许一个经过身份验证的、低权限的用户在更新操作期间操纵敏感属性（例如 `role_id`），从而将其权限提升到管理员或其他更高权限的角色。这可能使攻击者完全控制 CMS 实例，包括内容修改、用户管理，如果链式利用其他漏洞或滥用管理功能，甚至可能导致任意代码执行。此漏洞影响 2.9.1 版本之前的 Camaleon CMS。

**POC有效性分析:**
提供的概念验证（POC）代码 `exploit.py` 是一个结构良好的 Python 脚本，旨在利用 CVE-2025-2304。它演示了一个完整且功能齐全的漏洞利用链，用于针对批量赋值特权升级缺陷。该脚本利用 `requests` 库与目标 Camaleon CMS 应用程序进行交互，并使用 `re` 进行正则表达式解析。其方法涉及一个多步骤过程，模拟合法的用户交互以实现特权升级。该脚本编写清晰，使其逻辑易于理解和验证。它执行了 CSRF 令牌检索和会话管理等基本步骤，这些对于成功利用现代 Web 应用程序至关重要。POC 自动化从初始认证到特权升级的整个过程的能力，验证了 CVE-2025-2304 的存在和可利用性。其有效性很高，表明任何拥有受漏洞影响的 Camaleon CMS 实例的已认证用户都可能使用类似技术获取管理控制权。

**利用步骤:**
`exploit.py` 脚本执行以下操作序列以实现特权升级：
1.  **检索登录 CSRF 令牌：** 脚本首先向目标 Camaleon CMS 的 `/admin/login` 端点发送一个 GET 请求。然后，它使用正则表达式 (`RE_LOGIN_CSRF`) 解析 HTML 响应，以提取登录所需的 `authenticity_token`。
2.  **用户认证：** 使用检索到的 CSRF 令牌，脚本使用提供的有效 `username` 和 `password` 向 `/admin/login` 发送一个 POST 请求。这会验证用户并建立一个活动会话。脚本通过检查响应中是否包含“dashboard”或“logout”等关键词来验证登录是否成功。
3.  **提取用户 ID 和配置文件 CSRF 令牌：** 成功认证后，脚本对 `/admin/profile/edit` 页面执行 GET 请求。从该页面的 HTML 内容中，它提取两个关键信息：当前用户的 `user_id` (使用 `RE_USER_ID`) 和一个专用于配置文件更新的特定 CSRF 令牌 (使用 `RE_PROFILE_CSRF`)。这些值对于构建特权升级负载至关重要。
4.  **执行特权升级：** 最后，脚本向 `/admin/users/{user_id}/updated_ajax` 端点发送一个 PATCH 请求。此请求包含几个关键元素：`X-Requested-With: XMLHttpRequest` 头部、提取的 `X-CSRF-Token`，以及最重要的是，一个精心制作的负载，将 `user[role_id]` 参数设置为与管理员角色对应的值。通过批量赋值漏洞成功更新此属性，已认证用户的权限将被提升。

**投毒风险分析:**
对 CVE-2025-2304 提供的 `exploit.py` 脚本进行了彻底的“投毒”风险分析，即评估在看似合法的 POC 中可能嵌入的恶意代码或隐藏功能。根据对其源代码的检查，该脚本的**投毒风险较低**（估计为 5%）。
该脚本的依赖项仅限于标准的 Python 库：`requests`、`re` 和 `sys`。这些都是常用且经过良好审计的库，本身不构成固有风险。没有证据表明存在异常或可疑的导入，可能暗示外部恶意代码加载或执行。代码不包含任何混淆技术，使其功能透明且易于审计。每个函数和变量都服务于与利用批量赋值漏洞相关的明确目的。
具体而言，脚本没有使用不受信任的输入调用 `eval()` 或 `exec()`，也没有尝试从未经证实来源下载或执行外部二进制文件或脚本。它专门向指定的目标 URL 执行 HTTP 请求，与其作为 Web 应用程序漏洞利用工具的角色一致。没有尝试修改本地文件系统（除了可能存在的临时 Python 编译产物，这些是无害的）、建立反向 Shell 或从运行 POC 的机器中窃取敏感数据。`requests.packages.urllib3.disable_warnings()` 这一行是安全测试工具中抑制 SSL 证书警告的常见做法，并非恶意意图的指示。漏洞利用的核心涉及构造一个更改 `user[role_id]` 的负载，这本身就是特权升级漏洞的直接机制，而不是 POC 作者添加的恶意后门。因此，用户可以放心地执行此 POC，了解其唯一目的是演示和确认 CVE-2025-2304 的存在。

**项目地址:** 

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-2304
