## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (低权限用户), 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

对提供的POC代码（exploit.py）进行深入分析，评估其有效性、利用步骤和潜在投毒风险。

**POC有效性分析**
提供的`exploit.py`是一个结构良好且功能完备的Python脚本，旨在利用Camaleon CMS中的CVE-2025-2304权限提升漏洞。该漏洞通过“Mass Assignment”（批量赋值）机制实现。脚本展示了一个清晰的多阶段攻击流程，能够成功将低权限用户提升为高权限用户，例如管理员。

攻击链的第一步是`get_login_csrf`方法，它通过向`/admin/login`页面发起GET请求来获取登录所需的CSRF（跨站请求伪造）令牌。脚本使用正则表达式`RE_LOGIN_CSRF`精确地从HTML响应中提取此令牌，表明其能够正确处理Web应用程序的基本防御机制。

第二步是`login`方法，它使用此前获取的CSRF令牌、用户提供的用户名和密码向`/admin/login`端点发起POST请求进行认证。通过检查响应中是否包含“dashboard”或“logout”等关键词，脚本能够可靠地验证登录是否成功，确保后续操作在一个有效的会话中进行。这强调了此漏洞利用需要初始的、即使是低权限的用户凭据。

第三步，`get_profile_data`方法在成功认证后发挥作用。脚本访问`/admin/profile/edit`页面，并执行两项关键的数据提取操作：首先，它使用`RE_USER_ID`从页面源码中解析出当前已认证用户的ID，该ID对于定位要提升权限的用户至关重要。其次，它利用`RE_PROFILE_CSRF`提取用于更新用户配置的特定CSRF令牌。这种分步获取不同令牌的做法表明，Camaleon CMS可能为不同表单或上下文使用独立的CSRF令牌，而该利用脚本能够适应这种机制。

核心的漏洞利用发生在`execute_exploit`方法中。脚本向`/admin/users/{user_id}/updated_ajax`构造并发送一个PATCH请求。虽然提供的代码片段中payload部分被截断，但根据漏洞类型描述“Privilege Escalation through a Mass Assignment”，可推断payload会包含额外的参数，如`'user[admin]': 'true'`或`'user[role]': 'administrator'`，这些参数通过批量赋值机制被应用程序错误地处理，从而将当前用户的权限提升为管理员或其他高权限角色。脚本还正确设置了`X-CSRF-Token` HTTP头部，进一步证明了其在规避CSRF保护方面的有效性。

总而言之，该POC脚本具有很高的有效性，其对CSRF令牌的获取、会话管理以及针对特定HTTP请求和参数的操作，都展示了对Camaleon CMS漏洞机制的深刻理解。脚本设计为直接执行，仅需提供目标URL和凭据，使其成为一个易于部署和验证的权限提升工具。

**利用步骤**
1.  **准备环境**：确保目标Camaleon CMS实例版本低于2.9.1，并且攻击者拥有一个有效的（即使是低权限的）用户账户及其凭据。
2.  **获取POC**：下载或准备好提供的`exploit.py`脚本。
3.  **安装依赖**：如果尚未安装Python `requests`库，请通过`pip install requests`进行安装。
4.  **执行脚本**：在命令行终端中执行Python脚本，并提供目标URL、已认证的用户名和密码作为参数。例如：`python3 exploit.py https://target.com username password`。
5.  **自动认证**：脚本将首先自动访问目标CMS的登录页面，获取登录所需的CSRF令牌，然后利用提供的凭据和令牌完成用户登录，建立一个有效的会话。
6.  **信息收集**：登录成功后，脚本会继续访问用户配置文件编辑页面（`/admin/profile/edit`），从页面内容中解析出当前用户的ID以及用于更新用户配置的特定CSRF令牌。
7.  **权限提升**：脚本随后会构造一个PATCH请求，发送到`/admin/users/{user_id}/updated_ajax`端点。该请求的Payload中会包含通过“Mass Assignment”机制实现权限提升的关键参数（例如，将用户角色设置为管理员）。
8.  **验证**：攻击者可以尝试使用执行脚本时提供的用户凭据重新登录Camaleon CMS后台。如果权限提升成功，该用户现在应该能够访问通常只对管理员开放的功能和管理界面。

**投毒风险分析**
对提供的`exploit.py`脚本进行全面分析后，评估其投毒风险为**低风险（10%）**。以下是详细的风险评估依据：

1.  **代码透明度与可读性**：脚本代码结构清晰，使用了标准的Python语法，并且变量和函数命名具有高度描述性。没有发现任何形式的代码混淆、加密或打包，使得代码逻辑易于审查和理解。这表明作者旨在透明地展示漏洞利用过程，而非隐藏恶意行为。
2.  **外部依赖性**：脚本仅依赖Python标准库中的`re`（正则表达式）和`sys`（系统接口），以及广泛使用的第三方库`requests`。`requests`是一个用于HTTP通信的成熟且受信任的库，被广泛应用于各种Python项目，包括安全研究。脚本中没有发现从不安全或未知来源动态下载、导入或执行外部脚本或二进制文件的行为。
3.  **网络通信行为**：脚本所有的网络请求都明确针对用户在命令行中指定的`self.target`。请求的路径（`/admin/login`、`/admin/profile/edit`、`/admin/users/{user_id}/updated_ajax`）均与Camaleon CMS的已知管理和用户接口端点相符。没有迹象表明脚本尝试连接到任何第三方C2（命令与控制）服务器、泄露数据到外部地址，或执行除针对目标CMS之外的任何可疑网络活动。
4.  **文件系统与系统操作**：脚本代码中未包含任何文件读写、删除、修改或执行任意系统命令的操作。其功能严格限制在通过HTTP协议与目标Web应用程序进行交互，不涉及对本地文件系统或操作系统环境的任何更改。
5.  **动态代码执行**：脚本中没有使用如`eval()`、`exec()`或`subprocess.run()`等可能导致任意代码执行的函数。所有逻辑都是基于`requests`库的HTTP通信和`re`库的正则表达式匹配，这些都是可控且安全的操作。
6.  **数据隐私**：脚本的主要目的是利用权限提升漏洞，不涉及窃取目标系统上的敏感数据并将其外传的行为。用户输入的凭据仅用于登录目标系统，并未进行其他未经授权的传输。

综上所述，该POC代码是典型的、专注于漏洞验证的防御性安全研究工具。它不包含任何恶意功能、隐藏后门、数据窃取逻辑或与未授权远程实体的通信，因此被评估为低投毒风险。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
