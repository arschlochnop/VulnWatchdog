## CVE-2025-54424 - 1Panel 权限绕过/远程命令执行 (RCE)

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 权限绕过/远程命令执行 (RCE)

**影响应用:** 1Panel

**危害等级:** 高危

**CVSS评分:** CVSS:2.0/AV:N/AC:H/Au:N/C:C/I:C/A:C

**影响版本:** 1Panel <= 2.0.5

**利用条件:** 网络可达；无需认证（通过伪造客户端证书绕过）；攻击复杂度高（需要生成恶意TLS客户端证书并模拟节点通信）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 高

**投毒风险:** 5%

## 详情

CVE-2025-54424 详细描述:
该漏洞影响流行的开源Linux服务器运维管理面板1Panel，主要出现在其v2版本引入的节点管理功能中。漏洞的根本原因在于1Panel主控面板在验证从节点（Agent）上传的TLS客户端证书时存在缺陷，未能正确地执行证书链验证或允许具有特定Common Name (CN) 的自签名证书通过验证。具体来说，攻击者可以伪造一个Common Name为"panel_client"的自签名TLS客户端证书。当攻击者使用此伪造证书尝试与1Panel主控面板建立连接时，主控面板会错误地将其识别为合法的从节点连接，从而绕过正常的身份验证机制。一旦成功的建立连接，攻击者便能通过从节点与主控面板之间的通信协议（通常是WebSocket）发送恶意控制指令，这些指令最终会在主控面板服务器上被执行，导致任意命令执行（RCE）。这意味着未授权的远程攻击者在无需任何凭证的情况下，仅需网络可达性，即可完全控制受影响的1Panel主控服务器。

POC有效性分析:
提供的Python POC (CVE-2025-54424.py) 是一个功能完备且设计精良的漏洞利用工具，其有效性极高。该脚本利用了`cryptography`库动态生成具有特定CN（"panel_client"）的自签名TLS客户端证书和私钥，并将这些证书存储在临时文件中，这精准地模拟了绕过1Panel证书验证的关键步骤。脚本首先执行一个HTTP预检（例如对`/api/v2/dashboard/base/os`的GET请求），使用伪造的证书与目标1Panel面板建立HTTPS连接。如果HTTP请求返回200状态码，则初步验证了证书绕过的成功。随后，脚本尝试建立WebSocket连接（尽管 `exploit_target` 函数的代码在输入中被截断，但其结构和`websocket_shell`函数的存在明确指出其旨在通过WebSocket通道实现命令执行）。该POC不仅包含了漏洞检测逻辑，更提供了完整的利用框架，包括自动化生成利用所需的凭证，以及建立通信通道以执行命令。其并发扫描能力和交互式Shell功能进一步提升了其实用性和威胁性。总体而言，该POC代码能够成功复现并利用CVE-2025-54424漏洞，实现远程命令执行。

利用步骤:
1. 攻击者启动POC脚本，并指定目标1Panel主控面板的IP地址或域名。脚本会自动利用`cryptography`库在本地生成一个Common Name (CN) 为 `panel_client` 的自签名TLS客户端证书和对应的私钥文件。
2. 脚本使用这些动态生成的伪造证书和私钥，向目标1Panel主控面板发起HTTPS连接请求，例如访问 `/api/v2/dashboard/base/os` 等API接口。
3. 由于1Panel主控面板存在证书校验缺陷，它会错误地接受该伪造的客户端证书，将攻击者的连接视为来自合法从节点的通信，从而允许HTTPS连接成功建立。
4. 在HTTPS预检成功后，POC脚本会进一步尝试向目标面板建立一个WebSocket连接。这个WebSocket连接将继承之前通过伪造证书建立的信任。
5. 通过已建立的WebSocket连接，攻击者可以发送特定的指令和负载，模拟合法从节点的管理操作。这些恶意指令会被1Panel主控面板解析并执行，最终在运行1Panel的服务器上实现任意系统命令执行。
6. POC中包含的 `websocket_shell` 功能允许攻击者获得一个交互式的远程Shell，从而完全控制受影响的服务器。

投毒风险分析:
该POC代码的投毒风险评估为**低**，约为5%。我们对代码进行了详细审查，未发现任何明显的恶意投毒行为或潜在的安全风险。
代码清晰度: 脚本代码结构清晰，逻辑透明，变量命名规范，易于阅读和理解。没有观察到任何代码混淆、加密或难以分析的片段，这降低了隐藏恶意代码的可能性。
依赖项: 脚本主要依赖于Python的标准库以及几个广泛使用且经过验证的第三方库，包括`requests`、`websocket-client`和`cryptography`。这些库本身是业界公认的，且脚本对它们的使用方式符合正常的应用程序开发实践，没有发现滥用其功能以执行恶意操作的迹象。
外部资源: 脚本在执行过程中没有尝试从外部未经授权的URL下载任何文件、额外的脚本或恶意模块。所有证书生成和网络通信都指向指定的攻击目标，不涉及任何不明的第三方服务器。
恶意行为检测: 脚本的核心功能围绕漏洞的检测和利用展开，旨在证明漏洞的存在并提供利用能力。没有发现以下典型的投毒行为：收集并外传用户敏感信息、安装后门程序、创建持久化机制、进行加密货币挖矿、修改系统关键配置或添加非预期用户。代码中也没有使用`eval()`或`exec()`等高风险函数来执行来自外部或未经验证的任意代码。
总结: 鉴于代码的透明度、对标准库的合理使用以及缺乏任何可疑的外部通信或隐藏功能，该POC被认为是一个干净的漏洞验证和利用工具。其设计目标是证明漏洞的存在性并提供利用能力，而非作为恶意软件进行传播。然而，在任何环境下执行POC之前，仍强烈建议在隔离且受控的环境中进行测试。

**项目地址:** https://github.com/Mr-xn/CVE-2025-54424

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-54424
