## CVE-2025-49144 - Notepad++ 特权提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 特权提升

**影响应用:** Notepad++

**危害等级:** 高

**CVSS评分:** High

**影响版本:** 8.8.1及更早版本

**利用条件:** 需要本地访问权限，攻击者需诱导用户运行包含恶意 `regsvr32.exe` 的Notepad++ 8.8.1安装程序，并可能需要用户通过UAC提示。

**POC 可用性:** 8

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析: 所提供的POC是一个Markdown格式的`README.md`文件，对CVE-2025-49144（Notepad++ 8.8.1及更早版本安装程序中存在的本地权限提升漏洞）进行了高度有效的概念性分析。它详细阐述了漏洞的根本原因：“不受控的可执行文件搜索路径”或“二进制植入”。具体来说，安装程序在调用`regsvr32`时未指定其绝对路径（例如，使用`ExecWait 'regsvr32 /u /s "$INSTDIR\NppShell_01.dll"'`而非`$SYSDIR\regsvr32.exe`）。这导致Windows在文件搜索时，优先搜索当前目录（即安装程序运行的目录）。攻击者可以利用此机制，将一个恶意的`regsvr32.exe`文件放置在与Notepad++安装程序相同的目录中。当用户运行安装程序（通常会弹出UAC提示并以提升的权限执行）时，它会无意中执行攻击者伪造的`regsvr32.exe`，并继承这些提升的权限。`README`清晰地概述了Windows的文件搜索顺序，这对于理解漏洞利用机制至关重要。它还准确指出，该漏洞已在8.8.2版本中通过指定`regsvr32`的绝对路径得到修复。尽管此POC未提供可直接运行的恶意二进制文件，但它为如何构建和部署此类攻击提供了全面的蓝图，使其成为一份出色的概念验证。
利用步骤:
1.  **准备恶意载荷**: 攻击者首先需创建一个自定义的恶意 `regsvr32.exe` 文件。该文件可被设计用于多种目的，例如执行任意系统命令、建立反向Shell连接、收集敏感用户数据，或利用令牌复制等技术进一步获取 `NT AUTHORITY\SYSTEM` 的最高权限。
2.  **放置恶意文件**: 攻击者将制作好的恶意 `regsvr32.exe` 文件放置到与目标Notepad++ 8.8.1安装程序（例如 `npp.8.8.1.Installer.exe`）相同的目录中。用户的“下载”文件夹 (`Downloads`) 或任何其他用户可写入且可能运行安装程序的位置是常见的选择。
3.  **诱导用户执行**: 攻击者需通过社会工程学或其他手段诱导受害者从包含恶意 `regsvr32.exe` 的目录中运行Notepad++ 8.8.1安装程序。用户通常会双击运行安装文件，并在收到用户账户控制 (UAC) 提示时予以确认，从而使安装程序以提升的权限运行。
4.  **漏洞触发**: 在安装程序的执行过程中，它会尝试卸载旧版本的Shell扩展，通过调用命令 `'regsvr32 /u /s "$INSTDIR\NppShell_01.dll"'`。由于此命令未指定 `regsvr32` 的完整绝对路径，Windows操作系统会依据其预定的文件搜索顺序来查找 `regsvr32.exe`。
5.  **权限提升成功**: 根据Windows的文件搜索优先级，当前目录（即安装程序所在的目录）会被优先于标准系统目录 (`C:\Windows\System32`) 搜索。因此，攻击者预先放置的恶意 `regsvr32.exe` 将被优先识别并执行。由于Notepad++安装程序通常以管理员权限运行（或经UAC确认后获取），恶意 `regsvr32.exe` 也将继承并以相同的提升权限运行，从而实现本地权限提升。
6.  **执行恶意操作**: 一旦恶意载荷以高权限执行，攻击者便可利用这一权限执行各种预设的恶意活动，包括但不限于植入持久化后门、完全控制受害者的计算机系统，或进一步提升权限至 `NT AUTHORITY\SYSTEM`。
投毒风险分析: 本次分析的POC代码以Markdown格式的`README.md`文件呈现，其核心目的是详细阐述CVE-2025-49144漏洞的原理、利用机制和相应的修复方法。由于该POC文件纯粹是文本描述，不包含任何可执行脚本、编译后的二进制文件、恶意链接或外部代码依赖，因此其本身被投毒的风险极低，可评估为0-29%范围内的低风险，具体给定5%。这个极低的百分比主要考虑到一些极端且非直接相关的可能性，例如托管此`README`的平台或存储库本身遭到篡改，导致原始文件被替换为恶意内容。但这种风险并非源于`README`文件内容本身的潜在恶意性。对于合法的防御性安全研究人员而言，只要确保从可信来源获取该文件，并对其内容进行审查，阅读和理解这份POC是完全安全的。真正的安全风险在于，如果攻击者基于此POC的原理，制造并分发恶意的Notepad++ 8.8.1安装包（捆绑恶意的`regsvr32.exe`），或用户在学习漏洞利用时，自行创建并执行了恶意的`regsvr32.exe`。在这种情况下，风险源于恶意利用行为本身，而不是POC描述文档的投毒。总结来说，这份`README.md`作为一个教学性质的文档，其自身的投毒风险微乎其微。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
