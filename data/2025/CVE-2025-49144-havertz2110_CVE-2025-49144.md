## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高危，可能导致本地权限提升至SYSTEM，攻击者可完全控制受影响系统。

**CVSS评分:** N/A (Awaiting Analysis)

**影响版本:** Notepad++ 8.8.1 及更早版本

**利用条件:** 需要本地文件放置和用户交互，无远程认证或网络访问需求。

**POC 可用性:** 8

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

该POC（实际上是一个详细的`README.md`文件）对CVE-2025-49144 Notepad++安装程序权限提升漏洞进行了深入且准确的分析。漏洞核心是由于Notepad++ 8.8.1及更早版本的安装程序在卸载旧的Shell扩展时，调用`regsvr32`命令时未指定其绝对路径，例如使用了`ExecWait 'regsvr32 /u /s "$INSTDIR\NppShell_01.dll"'`而非`ExecWait '$SYSDIR\regsvr32.exe /u /s "$INSTDIR\NppShell_01.dll"'`。
这一疏忽导致了Windows的“ uncontrolled executable search path”（二进制种植，或DLL劫持的变种）行为。Windows在执行未带完整路径的命令时，会按照特定的搜索顺序查找可执行文件。该顺序首先检查当前进程的应用程序目录，然后是当前工作目录，接着才是System32等系统目录。
POC详细阐述了这一搜索顺序，并明确指出，如果攻击者在一个用户很可能运行安装程序的目录（例如“Downloads”文件夹）中放置一个精心制作的恶意`regsvr32.exe`文件，并诱使用户在该目录中运行Notepad++ 8.8.1安装程序，则系统会优先执行攻击者放置的恶意`regsvr32.exe`。
由于Notepad++安装程序通常需要管理员权限（通过UAC提示），因此恶意`regsvr32.exe`也将以提升的权限（通常是Administrator或SYSTEM，取决于后续Payload）执行，从而实现本地权限提升。
POC的分析逻辑清晰，对漏洞原理的解释准确，且指出了漏洞已在Notepad++ 8.8.2版本中通过指定`regsvr32`的绝对路径（`$SYSDIR\regsvr32.exe`）修复。其对攻击流程的描述完整，包括如何获取SYSTEM权限的额外说明，使得其具备极高的概念验证价值和可操作性。尽管没有直接提供可执行的恶意Payload代码，但其详细的分析足以指导安全研究人员或攻击者构建自己的Payload。

**利用步骤:**
1.  **准备恶意文件**: 攻击者首先需要创建一个恶意的可执行文件，并将其命名为`regsvr32.exe`。该文件应包含攻击者想要以提升权限执行的任意代码（例如，弹出一个反向shell、创建新的管理员用户、注入其他进程等）。POC特别提到，若要获取`NT AUTHORITY\SYSTEM`权限，需要设计特定的Payload来实现Token Duplication等操作。
2.  **文件放置**: 攻击者通过社会工程学手段（如钓鱼邮件、恶意网站诱导下载等）或点击劫持等方式，诱使用户将合法的Notepad++ 8.8.1安装程序（例如`npp.8.8.1.Installer.exe`）以及上一步准备的恶意`regsvr32.exe`文件下载并放置到用户机器上的同一个目录中。这个目录通常是用户默认下载目录，如`C:\Users\<username>\Downloads`。
3.  **用户执行**: 攻击者继续诱导用户在该目录中双击运行合法的Notepad++ 8.8.1安装程序。
4.  **权限提升**: 当安装程序启动并需要卸载旧的Shell扩展时，它会调用`regsvr32`。由于其未指定绝对路径，Windows会首先在当前安装程序所在的目录中查找`regsvr32.exe`。此时，系统会找到并执行攻击者预先放置的恶意`regsvr32.exe`。
5.  **Payload执行**: 因为Notepad++安装程序通常会请求UAC提升权限，恶意`regsvr32.exe`也会以提升后的权限（通常是管理员权限，如果Payload设计得当，甚至可以达到`SYSTEM`权限）运行，从而使攻击者完全控制受害机器。

**投毒风险分析:**
提供的POC文件是一个Markdown格式的`README.md`文档，其内容完全是关于漏洞的分析和复现步骤的说明。它不包含任何可直接执行的二进制文件、脚本或恶意代码。因此，从该POC本身来看，它不构成直接的投毒风险。该POC文档的代码清晰、逻辑严谨，主要目的是进行安全研究和教育，帮助理解漏洞原理。它没有包含任何混淆、恶意域名调用、外部脚本加载或其他可疑行为。这符合低风险POC的特征。尽管POC本身没有投毒风险，但其详细描述的攻击方法可能被恶意行为者利用。攻击者可以根据POC中提供的原理和步骤，自行创建恶意Payload（即恶意的`regsvr32.exe`），然后结合社会工程学等手段进行实际攻击。组织在进行防御时，应关注此漏洞的攻击面，教育用户不要随意下载并运行来路不明的可执行文件，并及时更新Notepad++到安全版本（8.8.2或更高）。对于安全研究人员，由于POC的清晰度，可以快速理解和复现，但仍需警惕在复现过程中不慎执行了自己或他人创建的恶意Payload。总的来说，该POC作为安全情报，其投毒风险评估为极低，可以放心用于分析和防御策略制定。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
