## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** <= 8.8.1

**利用条件:** 需要用户交互（运行安装程序），攻击者需诱导用户将恶意文件与合法安装程序放置于同一目录并运行。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 40

## 详情

CVE-2025-49144 是 Notepad++ 安装程序中存在的一个典型的本地权限提升（Local Privilege Escalation, LPE）漏洞，其核心机制是“不可控的可执行文件搜索路径”（Uncontrolled Executable Search Path），也被称为“二进制劫持”（Binary Planting）。根据提供的POC代码（README.md）和搜索结果，该漏洞的有效性已被广泛证实。
Notepad++ 8.8.1 及更早版本的安装程序在执行过程中会调用 `regsvr32` 命令来卸载旧的 shell 扩展 (`NppShell_01.dll`)。然而，安装程序在调用 `regsvr32` 时没有指定其绝对路径，例如 `ExecWait 'regsvr32 /u /s "$INSTDIR\NppShell_01.dll"'` 而非 `ExecWait '$SYSDIR\regsvr32.exe /u /s "$INSTDIR\NppShell_01.dll"'`。
根据 Windows 系统的可执行文件搜索顺序，当一个进程需要执行一个没有指定绝对路径的可执行文件时，系统会优先在以下位置进行查找：
1. 调用进程所在的目录（即安装程序所在的目录）。
2. 调用进程的当前工作目录。
3. `%SystemRoot%\System32` 目录。
4. 其他系统目录和 PATH 环境变量指定的目录。
因此，如果攻击者能够诱导用户将一个恶意的 `regsvr32.exe` 文件放置在与 Notepad++ 安装程序相同的目录中，那么当安装程序以提升的权限（通常是管理员权限，通过 UAC 提示获得）运行时，它将优先加载并执行攻击者提供的恶意 `regsvr32.exe`，而不是系统目录中合法的 `regsvr32.exe`。由于恶意文件继承了安装程序的权限，攻击者便能以相同的提升权限执行任意代码，从而实现权限提升。多个安全研究博客（如 FreeBuf、CSDN、Bilibili）都发布了详细的复现步骤和视频，进一步验证了该漏洞的真实性和可利用性。

**利用步骤**:
1.  **准备恶意文件**：攻击者首先制作一个恶意的 `regsvr32.exe` 可执行文件。这个恶意文件可以包含各种 payload，例如反弹 shell 代码、创建持久化后门、添加新的管理员用户，或者执行令牌窃取以获取 `NT AUTHORITY\SYSTEM` 权限。
2.  **诱导下载与放置**：攻击者通过社会工程学、钓鱼邮件、点击劫持等手段，诱导受害者下载 Notepad++ 8.8.1（或更早版本）的合法安装程序。同时，攻击者需要确保受害者将此合法安装程序和之前准备好的恶意 `regsvr32.exe` 文件下载并放置在 *同一个目录* 下，通常是用户的“下载”文件夹（`Downloads`）。
3.  **执行安装程序**：受害者在不知情的情况下，双击运行了 Notepad++ 的安装程序。由于 Notepad++ 安装通常需要管理员权限，系统会弹出用户账户控制（UAC）提示，受害者确认后，安装程序将以提升的权限（管理员权限或 SYSTEM 权限）开始运行。
4.  **二进制劫持触发**：在安装程序的执行流程中，当需要卸载旧的 shell 扩展时，安装程序会尝试调用 `regsvr32` 命令。此时，Windows 系统会按照其默认的可执行文件搜索顺序，优先在安装程序所在的目录（即攻击者放置恶意 `regsvr32.exe` 的目录）查找并加载 `regsvr32.exe`。
5.  **权限提升成功**：攻击者提供的恶意 `regsvr32.exe` 被加载并执行，并且其执行权限与安装程序的权限相同。这意味着攻击者成功绕过了普通用户权限限制，获得了管理员甚至 `NT AUTHORITY\SYSTEM` 级别的控制权，从而可以在受害者的系统上执行预定的恶意操作。

**投毒风险分析**:
本分析所依据的POC代码是针对 CVE-2025-49144 漏洞的一份 `README.md` 文档，它详细描述了漏洞原理、利用方式和修复措施。该 `README.md` 本身是纯文本分析，不包含任何可执行代码或恶意负载，因此就 *这份文档本身* 而言，其直接的投毒风险为极低（接近0%）。
然而，该漏洞涉及本地权限提升，且利用方法清晰，属于高价值漏洞类型。这意味着在野外，针对此漏洞的恶意 PoC 代码或利用工具的出现是高风险事件。攻击者很可能将恶意代码（如远控木马、勒索软件、挖矿程序等）打包进声称是 CVE-2025-49144 PoC 的可执行文件或脚本中，并通过各种渠道（如论坛、GitHub Fork、恶意网站）进行传播。
对于试图复现此漏洞的安全研究人员、渗透测试人员或普通用户，如果他们从非官方、不可信的来源下载所谓的“Notepad++ 提权 PoC”或“恶意 `regsvr32.exe`”文件，将面临极高的投毒风险。这些文件可能包含混淆的代码、后门或利用其他未知漏洞来进一步危害系统。 
组织在处理此类漏洞时，应教育员工警惕未知来源的文件，并严格遵循安全操作规范。进行漏洞复现和安全研究时，务必在隔离、沙箱化的环境中进行，并对所有下载的 PoC 代码和工具进行严格的安全审计和病毒扫描。此次漏洞的利用条件需要用户交互和恶意文件放置，也增加了通过社会工程学进行投毒的潜在风险。因此，尽管提供的分析文档无害，但该漏洞所处的生态环境和潜在利用方式决定了其相关的“投毒风险”（指在野外遇到的实际利用代码）是中等偏高的，故设置为 40%。

**项目地址:** https://github.com/TheTorjanCaptain/CVE-2025-49144_PoC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
