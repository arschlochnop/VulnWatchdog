## CVE-2025-55182 - React Server Components, Next.js, Shopify Hydrogen, Gatsby 5, Dify 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components, Next.js, Shopify Hydrogen, Gatsby 5, Dify

**危害等级:** 高危，已遭大规模实际利用

**CVSS评分:** N/A (高危)

**影响版本:** 使用受影响的React Server Components (RSC) 的应用，包括Next.js、Shopify Hydrogen、Gatsby 5以及Dify 1.10.0及可能更早版本。

**利用条件:** 未认证远程访问，通过构造恶意multipart表单即可利用

**POC 可用性:** 8

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-55182，又称React2Shell，是一个高危的远程代码执行漏洞，主要存在于React Server Components (RSC) 中，并影响基于RSC的框架，如Next.js、Shopify Hydrogen、Gatsby 5以及Dify等。该漏洞的核心在于React Flight反序列化机制未能正确校验对象属性访问路径（如`__proto__`、`constructor`），导致原型链污染。

**POC有效性分析:**
提供的`CVE-2025-55182批量测试脚本.py`是一个功能较为完善的批量扫描工具，旨在检测目标网站是否存在此RCE漏洞。脚本使用Python编写，依赖于`requests`库发送HTTP请求，并利用`threading`和`concurrent.futures`实现并发扫描，提高了检测效率。该POC通过构造特定的`multipart/form-data`请求体来触发漏洞。请求头中包含`Next-Action`、`X-Nextjs-Request-Id`等Next.js特定的标识，表明其针对Next.js环境进行了优化。Payload的核心在于利用原型链污染，通过将`then`属性指向一个构造的函数，该函数在运行时能够执行系统命令。脚本通过在响应头中查找`test123`作为命令执行成功的标志。例如，若成功注入`echo test123`命令，服务器响应头中若包含`test123`则判定为漏洞存在。尽管提供的POC代码片段有所截断，但从其结构和逻辑来看，它包含了一个典型的RCE利用流程：发送恶意请求 -> 触发代码执行 -> 检测特定输出。整体而言，该POC具备较强的实用性和有效性，适用于大规模目标检测。

**利用步骤:**
1.  **目标识别**: 攻击者需要识别使用React Server Components (RSC) 或其相关框架（如Next.js、Dify等）的Web应用程序。
2.  **恶意请求构造**: 攻击者构造一个恶意的HTTP POST请求，其`Content-Type`为`multipart/form-data`。请求体中包含一个精心制作的JSON-like结构，利用Next.js中React Flight反序列化机制对`__proto__`和`then`等属性的未充分校验。
3.  **原型链污染**: 通过特定的`$B`引用结合可控的`_response._prefix`，攻击者能够劫持或修改特定对象的`_formData.get`方法，将其类型更改为`Function`。
4.  **动态代码注入**: 在原型链被污染后，攻击者利用Payload将包含任意系统命令（例如执行`whoami`或反弹shell）的代码作为函数赋值给对象的`.then`属性。
5.  **触发执行**: 当受影响的服务器组件处理此恶意构造的请求并尝试解析相关属性时，`then`属性上的恶意代码将被执行，从而在服务器上实现远程代码执行 (RCE)。
6.  **结果验证**: 攻击者可以通过探测受影响服务器的响应（例如检查特定的HTTP响应头、延迟或网络连接）来确认命令是否成功执行。在提供的POC中，通过检查响应头中是否存在预设的字符串（如“test123”）来判断漏洞利用是否成功。

**投毒风险分析:**
对`CVE-2025-55182批量测试脚本.py`进行分析，评估其投毒风险为极低 (10%)。该脚本的主要目的是用于合法地检测React Server Components的RCE漏洞，并没有发现恶意投毒行为。
1.  **代码透明度**: 脚本代码结构清晰，逻辑易于理解，没有进行任何形式的代码混淆，便于安全专业人员审查和验证其安全性。
2.  **依赖标准库与常用库**: 脚本仅使用了Python标准库（如`os`, `sys`, `json`, `threading`）以及广为人知的第三方库（`requests`, `urllib3`, `tqdm`）。这些库都是在网络安全工具开发中常见且合法的，且在脚本中的用法均符合常规编程范式。
3.  **无恶意外部通信**: 脚本没有从任何外部未知或可疑来源下载、加载或执行额外的代码或二进制文件。所有的操作都在脚本自身代码的控制下完成。
4.  **限定的操作范围**: 脚本的主要操作集中在发送HTTP请求、解析响应以及将漏洞检测结果写入本地文件`vuln.txt`。没有发现脚本试图执行超出其漏洞检测目的的任何行为，例如删除系统文件、窃取敏感数据、安装后门、建立持久化连接、发起DDoS攻击等。
5.  **Payload的性质**: 脚本中的`payload`部分虽然包含了触发RCE的恶意构造数据，但这是漏洞利用的核心组成部分，旨在模拟攻击者的行为以验证漏洞是否存在，而不是POC脚本自身的恶意行为。其目的是在目标系统上执行一个测试命令（如`echo test123`）以确认可控性，并非用于对运行POC的环境进行恶意攻击。
基于以上分析，该POC脚本是一个合法、透明且专注于安全测试的工具，不包含恶意代码或旨在危害使用者系统的功能，因此其投毒风险非常低。

**项目地址:** N/A

**漏洞详情:** N/A
