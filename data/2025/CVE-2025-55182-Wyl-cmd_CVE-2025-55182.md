## CVE-2025-55182 - React Server Components, Next.js, Shopify Hydrogen, Gatsby 5 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components, Next.js, Shopify Hydrogen, Gatsby 5

**危害等级:** 关键/致命 (Critical)

**CVSS评分:** 

**影响版本:** Next.js版本 15.0.0-16.0.6

**利用条件:** 未认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-55182，又被称为“React2Shell”，是一个针对React Server Components (RSC) 及其广泛采用的框架（如Next.js、Shopify Hydrogen、Gatsby 5）的核弹级远程代码执行（RCE）漏洞。该漏洞的根本原因在于React Flight协议的反序列化机制对用户输入处理不当，未能充分校验对象属性访问路径，例如`__proto__`和`constructor`。这导致了一种原型链污染（Prototype Pollution）漏洞，允许攻击者通过精心构造的请求在未认证的情况下执行任意代码。

**利用步骤：**
1. 攻击者向目标服务器发送一个特制的`multipart/form-data` POST请求。这个请求并非简单的HTTP请求，其请求体中包含了一个高度精巧的JSON-like负载，该负载遵循React Flight协议规范。
2. 负载的核心在于利用RSC反序列化过程中对`__proto__`等属性访问路径的信任缺陷。攻击者通过构造 `$B` 引用，并结合可控的`_response._prefix`和被劫持为`Function`的`_formData.get`，动态生成一个包含任意系统命令的函数。
3. 该恶意函数随后被赋值给目标对象的一个关键属性，通常是`.then`属性。当服务器在反序列化过程中处理到这个被篡改的对象时，被注入的系统命令就会在服务器端被执行，从而实现远程代码执行。
4. 实际的POC通常会执行一个特定的命令（例如，在响应头中插入一个特定字符串，如`test123`），以便客户端POC能够通过检测这个字符串来确认漏洞的成功利用。

**POC有效性分析：**
提供的Python POC脚本（`CVE-2025-55182批量测试脚本.py`）是一个功能强大且高度有效的扫描工具，用于检测CVE-2025-55182漏洞。该脚本具有以下显著特点和功能：
*   **批量检测能力：** 脚本设计用于从文件中读取多个目标URL，并利用`concurrent.futures.ThreadPoolExecutor`进行多线程并发检测。这使得它能够高效地对大量目标进行扫描，显著提升了检测效率。
*   **精确的Payload构造：** 脚本精确地构造了符合漏洞利用要求的`multipart/form-data`请求体，包括所有必需的HTTP头部（如`Host`, `Next-Action`, `X-Nextjs-Request-Id`, `Content-Type`）和复杂的JSON-like负载。这个负载是触发原型链污染和RCE的关键。
*   **明确的漏洞判断逻辑：** 脚本通过检查服务器响应头中是否包含“test123”字符串来判断漏洞是否存在。这表明其内部的RCE Payload旨在执行一个将此标记注入响应头的命令，从而提供一个可靠的成功利用指示。
*   **良好的用户体验：** 脚本使用了`tqdm`库实现了进度条显示，为用户提供了直观的扫描进度反馈。同时，它还处理了`urllib3`的SSL警告，提升了运行的“干净”程度。
*   **鲁棒性：** 脚本内置了请求超时（1秒）和异常处理机制，能够有效应对网络问题或无响应的目标，确保扫描过程的稳定性和可靠性。它还支持将发现的漏洞URL写入`vuln.txt`文件，便于后续处理。
*   **局限性：** 尽管功能强大，但该POC的Payload是硬编码的，这意味着它只能尝试执行预设的命令以检测“test123”的存在。如果需要自定义执行任意命令，则需要修改脚本代码。不过，对于批量检测目的而言，这并非重大缺陷。
综合来看，该POC脚本在功能完整性、易用性和检测可靠性方面表现出色，是评估目标系统是否存在CVE-2025-55182漏洞的有效工具。

**投毒风险分析：**
对提供的Python POC脚本`CVE-2025-55182批量测试脚本.py`进行详细分析后，评估其投毒风险为低。以下是具体的风险评估依据：
*   **代码透明度和可读性：** 脚本采用Python编写，代码未经过任何形式的混淆、加密或打包。其结构清晰，函数命名规范，逻辑易于理解，允许任何具备Python基础的用户轻松审查代码。所有导入的库均为标准Python库（如`os`, `sys`, `json`, `threading`）或广泛使用的第三方安全/工具库（`requests`, `urllib3`, `tqdm`），这些库本身没有已知的恶意行为。
*   **依赖项安全性：** 脚本仅依赖上述标准和常用库，没有尝试从外部、不安全的源下载或执行任何额外的二进制文件、脚本或模块。这意味着其运行时环境仅限于用户已安装和信任的Python环境。
*   **行为分析：** 脚本的核心功能是向用户指定的URL发送HTTP POST请求，并根据响应内容判断漏洞是否存在。其观察到的行为包括：
    *   读取输入文件中的URL列表。
    *   构造并发送符合CVE-2025-55182利用特征的HTTP请求。
    *   检查响应头中是否存在特定字符串“test123”作为漏洞成功的标志。
    *   将发现的漏洞URL写入本地文件`vuln.txt`。
    *   利用多线程进行并发处理以提高效率。
*   **无恶意功能迹象：** 在代码中未发现任何迹象表明脚本会执行以下恶意行为：
    *   **数据窃取/外传：** 脚本不收集用户敏感信息、系统配置数据、网络凭据或任何其他私密数据，也未尝试将任何数据发送到攻击者控制的远程服务器。
    *   **本地系统修改：** 脚本不会修改本地文件系统（除了创建或追加`vuln.txt`文件）、注册表、系统配置或安装任何持久性后门程序。
    *   **资源滥用：** 脚本的线程使用旨在优化扫描性能，而非利用用户系统资源进行加密货币挖掘或其他恶意计算。
    *   **网络扫描（超出目标范围）：** 脚本只与用户提供的目标URL进行通信，不进行未经授权的内部网络扫描或对其他网络资源发起攻击。
*   **区分POC与Payload：** 重要的是要明确区分POC脚本本身和它所携带的漏洞利用Payload。POC脚本的目的是将一个恶意Payload（旨在危害目标服务器）发送到远程系统。这个Payload对远程服务器来说是恶意的，但POC脚本作为工具本身，对运行它的本地机器是无害的。脚本的逻辑是传递攻击，而不是自身包含恶意代码来攻击运行它的机器。
*   **结论：** 基于上述分析，该POC脚本的代码逻辑透明、行为可预测，且严格限定在漏洞检测的范围内。因此，该POC脚本对运行它的研究人员或组织构成的投毒风险极低。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-55182
