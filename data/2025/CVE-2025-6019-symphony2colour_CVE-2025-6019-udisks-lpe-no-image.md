## CVE-2025-6019 - UDisks2 权限提升

**漏洞编号:** CVE-2025-6019

**漏洞类型:** 权限提升

**影响应用:** UDisks2

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** UDisks2版本受逻辑缺陷影响

**利用条件:** 需要前置利用CVE-2025-6018获得D-Bus权限；需要本地访问权限；需要预先准备XFS文件系统镜像。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-6019是一个存在于UDisks2中的本地权限提升漏洞，它通过利用`Filesystem.Resize`方法中的逻辑缺陷，允许攻击者在特定条件下获取root权限。此漏洞并非独立存在，它是一个攻击链中的第二阶段，需要先成功利用CVE-2025-6018以获得必要的D-Bus权限和执行上下文。

**POC有效性分析:**
提供的POC脚本（`CVE-2025-6018-udisks-lpe-no-image.sh`，尽管文件名可能引起混淆，但根据配套的`README.md`和搜索结果，其功能是实现CVE-2025-6019的利用）是一个有效的Bash脚本，用于自动化执行CVE-2025-6019的第二阶段利用。脚本首先通过`gdbus call`尝试与`org.freedesktop.login1`服务交互，这验证了前置CVE-2025-6018利用所获取的D-Bus权限是否到位。接着，它会终止`gvfs-udisks2-volume-monitor`进程以避免干扰，并使用`udisksctl loop-setup`命令将一个预先准备好的XFS文件系统镜像（`xfs.image`）设置为循环设备。POC脚本的创新之处在于，它适用于目标系统不具备`mkfs.xfs`命令的情况，因此依赖于攻击者在外部创建并部署`xfs.image`。脚本随后会持续监控`/tmp/blockdev*/bash`路径，等待特权bash shell的出现。核心利用步骤在于通过`gdbus call`调用`org.freedesktop.UDisks2`服务的`Filesystem.Resize`方法，并传入特定参数（`0 '{}'`），触发UDisks2的逻辑缺陷。此操作会与前置利用和精心构造的XFS镜像结合，最终在`/tmp/blockdev*`目录下生成一个具有SUID权限的bash shell。脚本最后会执行该特权bash shell，从而完成权限提升。整个利用流程逻辑清晰，步骤严谨，符合已公开的漏洞原理，因此该POC被认为是功能完整的第二阶段利用脚本。

**利用步骤:**
1.  **前置利用**: 攻击者必须首先利用CVE-2025-6018漏洞，以获取与`org.freedesktop.login1`和`org.freedesktop.UDisks2`服务交互所需的D-Bus权限和执行上下文。本POC不包含CVE-2025-6018的利用脚本。
2.  **准备镜像**: 攻击者需根据Qualys的原始咨询报告，在攻击者控制的机器上创建一个特制的XFS文件系统镜像文件（`xfs.image`），其中包含恶意内容，例如带有SUID位的bash可执行文件。
3.  **上传文件**: 将`xfs.image`和本POC脚本（`exploit.sh`或类似名称）上传至目标受害机器的本地文件系统。
4.  **执行POC**: 在已获得D-Bus权限的会话中，执行上传的POC脚本，例如 `./exploit.sh`。
5.  **权限提升**: 脚本将自动执行一系列D-Bus调用和`udisksctl`操作，利用UDisks2的逻辑缺陷。一旦利用成功，脚本将找到并执行在`/tmp/blockdev*/`路径下生成的SUID特权bash shell，从而赋予攻击者root权限。

**投毒风险分析:**
该POC脚本是一个标准的Bash shell脚本，主要利用系统自带的`gdbus`、`udisksctl`、`killall`、`ls`和`bash`等工具。脚本内容清晰，没有使用代码混淆技术，也未包含任何外部可疑的URL链接或下载指令。脚本的核心功能是进行一系列D-Bus调用和文件系统操作，以实现权限提升，其产生的特权Shell是漏洞利用的预期结果，并非POC作者额外植入的恶意后门。从代码行为来看，它不包含任何非预期的恶意行为，例如数据窃取、C2通信、挖矿程序植入或勒索软件逻辑。因此，对于防御性安全研究人员而言，该POC代码本身的投毒风险非常低。在使用此类POC时，主要风险点在于`xfs.image`的内容，该镜像需要由攻击者自行构造。如果攻击者构造了恶意的`xfs.image`，并在真实的、未打补丁的生产环境中使用此POC，则可能导致系统被未经授权地完全控制。然而，此风险并非源于POC脚本自身的“投毒”，而是源于其作为攻击工具的固有性质和攻击者对恶意负载（`xfs.image`）的选择。在受控的沙箱环境或测试环境中进行复现和分析时，该脚本本身是安全的，不会引入额外的恶意软件。

**项目地址:** https://github.com/guinea-offensive-security/CVE-2025-6019

**漏洞详情:** https://cdn2.qualys.com/2025/06/17/suse15-pam-udisks-lpe.txt
