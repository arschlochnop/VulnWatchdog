## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危 (Critical)

**CVSS评分:** 9.3

**影响版本:** Sudo 1.9.14到1.9.17p1版本之间 (包含版本1.9.16p2)

**利用条件:** 本地访问，低权限用户，无需用户交互，攻击复杂度低

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：
CVE-2025-32463 是 Linux Sudo 组件中的一个高危本地权限提升漏洞，特别涉及到其 `chroot` 功能（`-R` 或 `--chroot` 选项）。该漏洞影响 Sudo 版本 1.9.14 至 1.9.17p1，其中 POC 中明确指出使用的 Sudo 1.9.16p2 版本是易受攻击的。此漏洞允许非特权本地用户在无需任何 `sudo` 规则配置的情况下，绕过权限限制，最终提升至 `root` 权限。提供的 POC 包结构完整且高度有效，专为通过 Docker 容器提供一个安全隔离的测试环境而设计。

`Dockerfile` 精心配置了测试环境：它首先基于 Ubuntu 24.04 基础镜像，然后安装了 `build-essential` 和 `wget` 等必要的构建工具。随后，它从官方 `www.sudo.ws` 网站下载 Sudo 1.9.16p2 的源代码，并进行编译和安装，确保目标环境精确地模拟了漏洞存在的具体版本和配置。在此之后，容器中创建了一个名为 `testuser` 的非特权用户，并将 `poc.sh` 脚本放置在其主目录中并赋予执行权限。`README.md` 文件清晰地阐述了漏洞的技术细节：它利用了 `sudo` 在使用 `chroot` 选项时处理命名服务切换 (NSS) 库的竞争条件。具体来说，当 `sudo` 执行 `chroot` 操作后，在降级权限之前，为了执行用户/组查找，它会通过 NSS 加载共享库（例如 `libnss_*.so`）。如果攻击者能够控制 `chroot` 环境（即指定一个恶意的 `chroot` 目录），他们就可以在其中放置一个恶意的 NSS 库及其 `nsswitch.conf` 配置。这个恶意库会被 `sudo` 在高权限（`root`）下加载，从而允许攻击者以 `root` 身份执行任意代码，例如生成一个 `root` shell。`poc.sh` 脚本正是遵循了这种攻击流程：它创建一个临时目录，编译一个恶意的 NSS 共享库。这个恶意库被精心设计，其构造函数在加载时会自动将进程的 UID/GID 设置为 0 (root)，然后生成一个 `root` shell。`README.md` 明确指出，在准备好的容器中执行 `poc.sh` 将会成功获取 `root` shell，这充分证明了该 POC 具备完整的漏洞利用能力，并且其详细的设置和解释确保了其在漏洞复现方面的可靠性和可重复性。

利用步骤：
1.  **构建环境**: 在包含 `Dockerfile`、`poc.sh` 和 `README.md` 的目录下，打开终端，执行命令 `docker build -t cve .`。此命令将根据 `Dockerfile` 的指示，构建一个名为 `cve` 的 Docker 镜像。该镜像将包含一个易受攻击的 Sudo 版本 (1.9.16p2) 和一个非特权用户 `testuser`。构建过程可能需要一些时间，取决于网络速度和系统性能。
2.  **运行容器**: 镜像构建成功后，使用命令 `docker run -it cve` 启动 Docker 容器。这会将用户带入容器内部的 `testuser` 用户的 shell 环境，其当前工作目录为 `/home/testuser`，在此用户下可进行漏洞利用尝试。
3.  **执行漏洞利用**: 在容器内部的 `testuser` shell 中，通过执行 `./poc.sh` 脚本来触发漏洞。该脚本将执行预定义的攻击流程，包括编译恶意 NSS 库并触发 `sudo` 加载它。
4.  **验证**: 如果漏洞利用成功，当前 `testuser` 的 shell 将自动升级为 `root` 权限的 shell，从而确认本地提权攻击已成功实现。用户可以通过运行 `id` 命令来验证当前的权限是否为 `root`。

投毒风险分析：
根据对提供的 `Dockerfile` 和 `README.md` 文件的深入分析，此 POC 的投毒风险被评估为极低，具体评分为 10%。
首先，`Dockerfile` 在构建过程中，从官方渠道 `https://www.sudo.ws/dist/sudo-1.9.16p2.tar.gz` 下载 Sudo 源代码。这种做法极大地降低了 Sudo 软件包本身被篡改或植入恶意代码的可能性，因为它避免了使用第三方或未知来源的镜像。此外，`Dockerfile` 中安装的所有依赖项，如 `build-essential` 和 `wget`，均为标准的、广泛使用的 Linux 开发和下载工具，它们本身不具备恶意功能，且通常通过官方的 apt 仓库获取。
其次，`poc.sh` 脚本虽然没有提供完整的代码，但 `README.md` 对其功能进行了清晰、透明的描述。根据描述，该脚本旨在编译一个恶意的 NSS 共享库，该库在加载时会将其进程的 UID/GID 设置为 0 (root) 并生成一个 `root` shell。这种行为是本地权限提升漏洞利用的典型手段，其目的是为了验证漏洞的存在和可利用性，而非执行任何超出此范围的恶意操作。在安全研究和漏洞复现的背景下，这种行为是完全符合预期的，并且未显示出任何隐藏的恶意企图。
再者，整个 POC 环境被设计为在 Docker 容器中运行。Docker 容器提供了一个高度隔离的环境，这意味着即使 `poc.sh` 脚本（理论上存在）包含任何未知或恶意代码，其影响也将被严格限制在容器的沙盒之内，不会对宿主机系统造成任何威胁或感染。这种隔离机制是进行安全研究和漏洞测试的关键，能够有效防止潜在的副作用外泄。
最后，此 POC 的创建者明确指出了其目的是为了提供一个可控、安全的测试环境，以复现 CVE-2025-32463 漏洞。其文档清晰、代码结构易于理解，并且没有使用任何代码混淆技术或包含任何指向外部可疑 URL 或加密内容的指示。所有这些因素都表明，该 POC 是一个合法的、用于防御性安全研究的工具，不包含恶意投毒行为，其目的在于帮助安全专业人员理解和防御此类漏洞。

**项目地址:** 无公开代码仓库

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
