## CVE-2025-33073 - Windows SMB / Active Directory 域服务 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Windows SMB / Active Directory 域服务

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows Server 2008 R2 SP1 及更高版本，具体受影响版本请参考微软官方安全公告。主要影响未强制启用SMB签名的Windows域环境。

**利用条件:** 需要经过身份验证的低权限域用户凭据；目标Windows主机需处于Active Directory域中，且未强制启用SMB签名；攻击者需能添加恶意DNS记录到域控制器；攻击者需具备网络访问权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

### POC有效性分析
该POC脚本 (CVE-2025-33073.py) 是一个功能完备的Python程序，旨在自动化利用Windows SMB权限提升漏洞CVE-2025-33073。此漏洞的核心在于绕过现有的NTLM反射缓解措施，允许经过身份验证的远程攻击者在未强制执行SMB签名的任何域内机器上以SYSTEM权限执行任意命令。

脚本通过巧妙地整合多个知名安全工具和技术，形成了一个高效的攻击链：它利用`dnstool.py`来添加恶意的DNS记录，使用`impacket-ntlmrelayx`作为NTLM认证中继监听器，并通过`CrackMapExec` (简写为`nxc`) 的`coerce_plus`模块（特别是PetitPotam方法）强制目标主机发起NTLM认证。整个流程通过Python的`subprocess`模块进行编排，使得复杂的攻击步骤得以自动化。脚本结构清晰，使用了`argparse`进行参数管理，并封装了`run_dnstool`、`wait_for_dns_record`、`start_ntlmrelayx`和`run_petitpotam`等核心功能，易于理解和维护。

其有效性已在多个场景下得到验证，可成功实现对目标主机的SYSTEM权限获取，进而导致横向渗透甚至域沦陷。此POC的实现质量较高，能够清晰地展示漏洞的利用机制和危害。然而，它的运行依赖于攻击者机器上正确配置和安装了所有必要的外部工具，并且目标环境必须满足特定的先决条件，例如SMB签名未被强制启用。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-33073
