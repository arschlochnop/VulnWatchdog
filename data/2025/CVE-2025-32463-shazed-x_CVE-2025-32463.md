## CVE-2025-32463 - Sudo 权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 至 1.9.17 (不含 1.9.17p1)

**利用条件:** 攻击者需拥有本地普通用户访问权限，目标系统安装了受影响版本的 Sudo 且支持 -R/--chroot 选项。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对的是 Sudo 1.9.14 引入的 -R (chroot) 功能缺陷。根据代码分析，漏洞根源在于 Sudo 在处理 chroot 路径时，未对用户控制目录下的配置文件进行严格的安全校验。POC通过创建一个伪造的 chroot 环境（包含恶意的 /etc/nsswitch.conf 和编译好的 libnss 动态库），诱导 Sudo 加载并执行恶意的 NSS 插件。由于 Sudo 在执行 chroot 操作时具有 root 权限，加载的 libnss_.king.so.2 会以超级用户身份运行，从而实现提权。此脚本实现了自动化架构检测（x86_64, aarch64等），并预置了 Base64 编码的 Payload，能够跨平台直接运行而无需现场编译环境，利用成功率极高且操作简便。利用步骤：1. 攻击者获取目标机器的普通 Shell 权限。2. 下载并解压 POC 项目，进入目录。3. 运行 get_root.sh 或 python 脚本。4. 脚本检测当前 CPU 架构并创建临时工作目录（如 /tmp/sudo_king.stage.xxx）。5. 在临时目录中构建伪造的 etc 结构，并写入恶意的 nsswitch.conf。6. 调用 sudo -R 指定该临时目录为 chroot 路径并执行。7. 触发恶意动态库加载，弹回 root shell 或执行提权命令。投毒风险分析：该 POC 存在中低程度的投毒风险。风险点主要在于其采用了预编译的二进制 Payload 注入（Base64 编码形式存储在 king.arch.b64 文件中）。在安全审计层面，这种做法隐蔽了攻击者的真实执行逻辑，黑盒化的二进制文件可能被修改以包含窃取 SSH 密钥、安装持久化后门或横向移动的恶意代码。虽然在防御研究场景下，这种封装是为了提高 POC 的便携性，但从供应链安全角度看，直接运行此类包含不明二进制文件的脚本具有极高风险。防御者应优先使用 mkall-dynamic.sh 脚本在受控环境中自行编译源码，而非直接执行预置的 Base64 Payload。脚本中虽未发现明显的反向 Shell 或外发数据的 Python 代码，但其二进制 Payload 的不透明性是主要的投毒怀疑点。

**项目地址:** [https://github.com/shazed-x/CVE-2025-32463](https://github.com/shazed-x/CVE-2025-32463)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
