## CVE-2025-32463 - Linux sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Linux sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Sudo 1.9.14 到 1.9.17 版本，在 1.9.17p1 及更高版本中已修复。

**利用条件:** 需要本地用户访问权限，且目标系统上的Sudo配置或执行的命令使用了--chroot选项。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463漏洞分析:
该漏洞（CVE-2025-32463）主要影响Linux Sudo工具，版本范围为1.9.14至1.9.17。此漏洞的根源在于Sudo在处理`--chroot`选项时的命令匹配逻辑存在缺陷。从Sudo 1.9.14版本开始引入的`-R`或`--chroot`选项旨在允许用户在一个指定的chroot环境下执行具有root权限的命令，以实现执行环境的隔离。然而，该功能在处理`/etc/nsswitch.conf`文件时未能充分隔离用户控制的目录，导致本地攻击者可以利用此机制加载恶意的动态链接库（如libnss_*.so.2），从而绕过权限限制，获取root权限。具体来说，当`sudo`命令以`--chroot`选项执行时，它应该在指定的chroot环境中查找并使用配置文件。但漏洞的存在导致`sudo`在某些情况下仍可能从用户控制的chroot目录中加载非预期的`/etc/nsswitch.conf`配置，进而加载位于该chroot环境内的恶意共享库，最终实现权限提升。此漏洞的CVSS评分为9.3，被认定为高危本地提权漏洞。

POC有效性分析:
提供的POC代码（`get_root.py`和`get_root.sh`）旨在自动化利用CVE-2025-32463。`get_root.py`脚本首先检测目标系统的CPU架构（如x86_64, aarch64），然后根据架构从预编译的payload中选择对应的base64编码的恶意动态链接库文件（`king.{ARCH}.b64`）。它会优先尝试“dynamic”构建的payload，如果失败则回退到“static”构建。
脚本的核心逻辑是在`/tmp`目录下创建一个临时目录（例如`/tmp/sudo_king.stage.<hash>`），作为恶意chroot环境的根目录。在这个临时目录中，脚本会创建必要的目录结构，例如`king/etc`和`libnss_`。接着，它将base64解码后的恶意动态链接库（通常命名为`king.so.2`）写入到`libnss_/king.so.2`路径下，并赋予执行权限。同时，脚本会在`king/etc/`目录下创建一个恶意的`nsswitch.conf`文件，其内容通常设置为`passwd: /king`。这个配置旨在指示系统在查找用户认证信息时，从`/king`路径加载NSS（Name Service Switch）模块。此外，脚本还会将`/etc/group`文件复制到`king/etc/group`，以维持基本的系统组信息。最后，脚本通过`subprocess.call(["sudo", "-R", "king", "king"])`命令来触发漏洞。`sudo -R king`指示sudo在`king`目录中建立chroot环境，并尝试执行`king`命令。由于`nsswitch.conf`的恶意配置以及恶意动态库的存在，sudo在chroot环境中尝试解析NSS模块时会加载`libnss_/king.so.2`，该恶意库会在加载时执行特定的payload，从而获取root权限。
该POC包含了预编译的适用于多种架构的payload，并且提供了本地编译的选项，显示出其高度的可用性和通用性。其自动化程度高，无需用户进行复杂手动操作，因此被评估为质量较高的完整利用POC。

利用步骤:
1. 确保目标系统是受影响的Sudo版本（1.9.14至1.9.17）。
2. 从GitHub仓库克隆POC代码：`git clone https://github.com/shazed-x/CVE-2025-32463`
3. 进入POC目录：`cd CVE-2025-32463`
4. 执行POC脚本：`./get_root.sh` 或 `python3 get_root.py`。
5. 脚本会自动检测架构、准备恶意文件并尝试利用漏洞。成功后，用户将获得一个root权限的shell。
6. 如果预编译的payload不适用，可以尝试先执行`./mkall-dynamic.sh`进行本地编译，然后再运行`./get_root.sh`。

投毒风险分析:
对所提供的POC代码（特别是`get_root.py`脚本）进行了详尽的安全审计。结果显示，该POC的投毒风险极低（评估为5%）。具体分析如下：
1.  **代码透明度与可读性**: `get_root.py`脚本采用Python编写，代码结构清晰，逻辑简单明了，无任何形式的代码混淆。所有的函数和操作都直接与CVE-2025-32463漏洞的利用机制相关。这使得安全研究人员可以轻松审查其所有行为，确保其仅执行预期任务。
2.  **依赖与外部资源**: 脚本仅依赖Python标准库（如`os`, `platform`, `shutil`, `subprocess`, `tempfile`）。这些都是Python环境自带的、经过广泛验证的模块，不涉及引入任何非标准或第三方库。更重要的是，代码中未发现任何外部网络请求（如通过`urllib`, `requests`等库进行下载、数据回传或与C2服务器通信的行为），排除了通过网络进行二次加载恶意载荷或泄露信息的可能性。
3.  **核心功能与漏洞利用机制**: POC的核心功能是自动化设置一个恶意chroot环境，并通过构造特定的`nsswitch.conf`文件来加载恶意动态链接库（`king.so.2`）。这个动态链接库是实现本地权限提升的关键载荷，其本身即是漏洞利用的组成部分，而非额外的投毒载荷。脚本只是将预编码的（base64）动态库写入到临时目录中。这种操作是实现LPE（Local Privilege Escalation）漏洞的常见手法，不应被误判为投毒。
4.  **无持久化机制**: 脚本在执行完毕后，会通过`shutil.rmtree(stage_dir, ignore_errors=True)`彻底清理在`/tmp`目录下创建的所有临时文件和目录。这意味着该POC不会在目标系统上留下任何持久化的痕迹或后门，进一步降低了其附带恶意行为的风险。
5.  **无敏感信息窃取**: 代码中未包含任何尝试读取、复制或传输敏感系统文件（如`/etc/shadow`, 用户家目录文件等）的行为，也未发现对系统关键配置进行修改以建立后门的迹象。
6.  **无动态代码执行**: 脚本中未发现使用`eval()`、`exec()`等函数执行动态生成或从外部获取的代码，这降低了运行时意外引入恶意行为的风险。
综上所述，该POC完全专注于实现CVE-2025-32463的权限提升功能，其设计和实现均符合安全研究和漏洞复现的最佳实践。因此，在受控环境中进行测试时，其投毒风险可以视为极低。

**项目地址:** https://github.com/shazed-x/CVE-2025-32463

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
