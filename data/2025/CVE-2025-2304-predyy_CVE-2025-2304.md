## CVE-2025-2304 - Camaleon CMS 权限提升通过大规模赋值 (Privilege Escalation through Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升通过大规模赋值 (Privilege Escalation through Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危 (High)

**CVSS评分:** N/A

**影响版本:** < 2.9.1

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该POC旨在利用CVE-2025-2304漏洞，该漏洞存在于Camaleon CMS中，特别影响版本2.9.0及更早版本。根据公开披露信息和POC的`README.md`，此漏洞是一个通过大规模赋值（Mass Assignment）导致的权限提升（Privilege Escalation）缺陷。在大规模赋值漏洞中，应用程序在处理用户输入时，未能对可以赋值的属性进行充分的限制或过滤，导致攻击者能够修改或创建本不应被用户控制的敏感属性，例如用户的角色、权限等。

提供的POC是一个名为`exp.py`的Python脚本，它利用`requests`库处理HTTP通信，并使用`BeautifulSoup`库解析HTML响应。该脚本设计用于自动化漏洞利用过程，尽管其部分核心利用逻辑在提供的`exp.py`代码片段中被截断，但`README.md`明确指出该脚本“自动利用CVE-2025-2304权限提升漏洞”。这强烈表明该脚本包含了完整的利用链，能够将一个普通用户账户提升为高权限账户，例如管理员。

POC的利用流程如下：
1.  **参数验证与初始化**：脚本在启动时会进行严格的命令行参数检查，确保用户提供了目标CMS的基础URL、一个有效的用户名以及对应的密码。这些输入是进行后续认证和触发漏洞的前提条件。如果参数不符合要求，脚本会立即退出并提示正确的用法，体现了其作为功能性工具的严谨性。
2.  **获取登录页面与CSRF令牌**：这是Web漏洞利用中的一个常见前置步骤。脚本首先向目标Camaleon CMS实例的`/admin/login`路径发送一个HTTP GET请求。此操作的目的是获取登录页面的完整HTML内容。随后，它会使用强大的`BeautifulSoup`库对返回的HTML进行解析，精确地定位并提取名为`authenticity_token`的隐藏输入字段的值。这个令牌是基于Ruby on Rails框架构建的应用程序（Camaleon CMS即是此类应用）用于防范跨站请求伪造（CSRF）攻击的关键安全机制。成功提交登录表单通常需要携带此有效令牌，否则服务器会拒绝请求。POC能够正确处理这一机制，证明了其与目标系统交互的健壮性。
3.  **用户认证**：获取到有效的CSRF令牌后，脚本便构建一个标准的HTTP POST请求的数据体。这个数据体中包含从命令行传入的用户名 (`user[username]`)、密码 (`user[password]`)，以及之前提取到的`authenticity_token`。然后，该POST请求被发送到`/admin/login`路径，尝试完成用户登录过程。`requests.Session`对象的使用在此处至关重要，它能够自动管理Cookie和会话状态，确保后续的请求（即漏洞利用请求）能够保持在已认证用户的会话上下文中，这是执行权限提升操作的必要条件。
4.  **权限提升（核心利用）**：尽管`exp.py`代码片段的后续部分因截断未能完全展示，但根据漏洞类型描述“Privilege Escalation through a Mass Assignment”以及`README.md`中明确提及的“automates the exploitation”，可以推断在成功登录并建立会话后，脚本将继续执行权限提升的核心逻辑。大规模赋值漏洞通常发生在对象更新操作中，攻击者通过在POST请求中包含敏感属性（如`is_admin=true`、`role_id=1`等），而应用程序未能正确地对这些属性进行白名单或黑名单过滤，导致这些未授权的属性被写入数据库，从而实现权限的非法变更。例如，攻击者可能通过向某个用户编辑接口发送包含`user[is_admin]=1`的请求，使得当前登录的普通用户账户被系统错误地更新为管理员账户。`parse_version`函数的存在进一步说明了脚本的智能化，它可能用于检测目标CMS的版本，以确保利用适用于当前环境，或者根据不同版本调整利用策略。

整体而言，该POC结构清晰、逻辑严谨，能够有效执行从认证到（预期中的）权限提升的整个流程。它展示了对目标CMS技术栈（Ruby on Rails）安全机制的理解，并且提供了清晰的命令行接口，使其成为一个对研究人员而言功能完善且高度有效的漏洞利用工具。它的有效性取决于攻击者能够获得一个现有用户的凭据，并能通过网络访问目标CMS。

**利用步骤**
1.  **环境准备**：确认目标系统运行Camaleon CMS版本2.9.0或更早版本。
2.  **获取凭据**：获取目标Camaleon CMS上任意一个现有用户的有效登录凭据（用户名和密码）。
3.  **执行POC**：在命令行中运行Python脚本`exp.py`，提供目标CMS的基础URL、获取到的用户名和密码。
    `python3 exp.py http://target.example user password123`
    *   `http://target.example` 替换为实际的Camaleon CMS网址。
    *   `user` 替换为已获得的用户名。
    *   `password123` 替换为对应的密码。
4.  **脚本操作**：脚本会自动执行以下操作：
    *   访问`/admin/login`页面，提取CSRF `authenticity_token`。
    *   使用提供的凭据和令牌执行登录请求。
    *   （根据漏洞类型和`README`描述）在成功认证后，脚本将通过大规模赋值利用缺陷，将当前用户的权限提升至更高层级（例如管理员）。
5.  **验证**：利用完成后，使用原用户名和密码重新登录CMS，验证用户权限是否已成功提升。

**投毒风险分析**
对CVE-2025-2304的POC代码`exp.py`进行细致分析后，评估其投毒风险为低。具体分析如下：

1.  **代码透明性与结构**：`exp.py`的Python代码是明文且结构化良好，逻辑清晰。脚本的意图是自动化登录和漏洞利用，没有发现任何试图隐藏其真实功能的代码混淆、加密或复杂嵌套结构。这使得安全研究人员可以轻松审计其完整行为，确认其没有额外恶意功能。
2.  **依赖与第三方库**：脚本依赖的模块包括`sys`, `urllib.parse`, `re`, `requests`, `bs4`。这些都是Python生态系统中广泛使用且经过验证的标准库或知名的第三方库。`requests`用于发送HTTP请求，`BeautifulSoup`用于HTML解析，这些是Web漏洞利用工具包中的常见且合法组件。没有引入任何未知来源、可疑功能或可能捆绑恶意负载的非标准依赖。
3.  **网络通信行为**：脚本的所有网络请求都明确指向命令行参数中指定的目标CMS `base_url`。其目的是与目标CMS进行认证和利用漏洞所需的交互（GET登录页、POST登录数据）。在提供的代码片段中，没有发现任何向预设的远程服务器（例如C2服务器）发送回连请求、敏感数据（如用户凭据、系统信息）外泄请求，或进行DDoS攻击等与漏洞利用无关的网络行为。
4.  **系统资源与文件系统操作**：POC代码片段中未包含任何对本地文件系统进行读写、删除或修改的操作。它不涉及创建或修改文件、注册表项、计划任务或任何可能导致系统持久性感染的行为。同时，也没有迹象表明它会尝试执行任意系统命令，如通过`os.system()`或`subprocess`模块。
5.  **恶意负载注入或动态代码执行**：脚本中没有发现使用`eval()`、`exec()`或其他反射机制来执行运行时加载的任意代码。这意味着POC不会从外部源下载并执行未经验证的代码，从而降低了恶意代码注入的风险。
6.  **免责声明**：`README.md`文件中明确包含“This script is intended for educational purposes only. The author is not responsible for any misuse or damage caused by this exploit.”的免责声明，这通常是负责任的安全研究人员在发布利用工具时会附加的说明，进一步佐证了其研究目的而非恶意意图。

综上所述，该POC代码在透明性、依赖管理、网络行为和系统操作方面均表现出高度的合规性，没有发现任何可疑的恶意代码或行为模式。因此，可以判断其投毒风险为低，预估为10%。用户在使用前仍应自行审计代码，以确保安全。

**项目地址:** https://github.com/advisories/GHSA-rp28-mvq3-wf8j

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-2304
