## CVE-2025-2304 - Camaleon CMS 特权升级 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 特权升级 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (普通用户凭据), 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析: 提供的Python脚本`exp.py`是一个针对CVE-2025-2304的鲁棒且高效的利用程序，该漏洞存在于Camaleon CMS 2.9.1版本之前，属于“Mass Assignment”类型的特权升级漏洞。Mass Assignment缺陷允许应用程序在未充分验证的情况下，将HTTP请求参数自动绑定到数据模型属性，从而使攻击者能够修改不应被访问的属性。此POC的核心功能是，在成功以标准用户身份登录后，通过一系列自动化步骤将普通用户的权限提升至管理员级别。脚本首先访问`/admin/login`页面以获取必要的`authenticity_token`（CSRF令牌），然后使用提供的普通用户凭据进行身份验证。登录成功后，它会解析当前用户的ID，并构造一个精心设计的POST请求，发送至用户资料更新接口（`/admin/users/<用户ID>`）。关键的漏洞利用载荷是`{"user[roles][]": "admin", "user[email]": "admin_user@exploit.com"}`。通过在请求中包含`user[roles][]`并赋值为"admin"，脚本尝试直接在用户更新过程中分配管理员角色，绕过了正常的权限检查。脚本包含了全面的错误处理机制，能够检测网络连接问题和登录失败。特权升级尝试完成后，脚本会通过再次检查更新后的用户资料页面中是否存在“admin”角色，并尝试访问管理员专属页面（如`/admin/themes`）来验证攻击是否成功。此验证机制确保了漏洞利用的准确性。代码结构清晰，使用了Python标准库及`requests`、`beautifulsoup4`等常用且可信赖的第三方库，展现了较高的可靠性和专业的安全研究意图。

利用步骤: 攻击者需要预先掌握一个受影响的Camaleon CMS实例的有效普通用户凭据（用户名和密码）。
1.  **环境准备**: 确保已安装Python 3和必要的库，如`requests`和`beautifulsoup4`。可以使用`pip install requests beautifulsoup4`进行安装。
2.  **脚本执行**: 运行POC脚本，提供目标Camaleon CMS的URL、普通用户名和密码作为命令行参数。例如：`python3 exp.py http://target.example regular_user_name regular_password`。
3.  **登录**: 脚本首先访问目标CMS的`/admin/login`页面，获取`authenticity_token`。然后，使用提供的普通用户凭据和获取到的`authenticity_token`向`/admin/login`发送POST请求进行认证。
4.  **获取用户ID**: 成功登录后，脚本会导航到`/admin/users/profile`页面，解析出当前已登录用户的ID。
5.  **特权升级**: 脚本构造一个POST请求，目标是`/admin/users/<用户ID>`的更新接口。请求数据中包含 `{"user[roles][]": "admin", "user[email]": "admin_user@exploit.com"}`。这个载荷利用了"Mass Assignment"漏洞，尝试将当前用户的角色直接修改为"admin"。
6.  **验证**: 特权升级尝试完成后，脚本会重新访问`/admin/users/profile`页面，检查用户的角色是否已更新为"admin"。它还会尝试访问一个只有管理员才能访问的页面（例如`/admin/themes`）来最终确认特权升级的成功。
7.  **结果输出**: 脚本将根据执行结果输出成功或失败信息，告知攻击者是否成功将普通用户提升为管理员权限。
通过上述步骤，一个拥有普通用户权限的攻击者即可利用此漏洞，将其账户提升至管理员权限，从而完全控制Camaleon CMS实例。

投毒风险分析: 评估此POC脚本的投毒风险，我们分析其代码结构、依赖项和行为模式。该POC是一个清晰、可读的Python脚本，主要依赖于`requests`和`beautifulsoup4`这两个广泛使用的HTTP请求和HTML解析库。这两个库是Python生态系统中标准且受信任的库，本身不构成投毒风险。脚本没有引入任何外部的、非标准的第三方代码或二进制文件，也没有在运行时动态下载或执行任何外部资源。代码中没有发现混淆、加密字符串、`eval()`等可疑函数的使用，所有逻辑都直接可见且易于理解。其核心功能是实现CVE-2025-2304描述的特权升级漏洞，即通过构造特定的HTTP POST请求，利用Camaleon CMS的Mass Assignment缺陷来修改用户角色。这种行为是POC的预期功能，不应被误判为恶意投毒。从代码层面看，整个脚本的意图完全是为了验证和利用特定的漏洞，没有发现任何超出此范围的、旨在损害运行环境或窃取数据的隐藏功能。因此，该POC的投毒风险极低，评分为5%。这5%的风险主要考虑到任何软件都可能存在的极小概率的非预期行为，但并非由作者恶意植入。对于安全研究人员和防御团队来说，这是一个相对安全的工具，可以在受控环境中用于测试和验证漏洞。

**项目地址:** N/A

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
