## CVE-2025-2304 - Camaleon CMS 特权升级 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 特权升级 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** Critical

**CVSS评分:** 

**影响版本:** <= 2.9.0

**利用条件:** 需要认证 (已注册用户)

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

该POC清晰地描述了其利用机制，即通过Mass Assignment漏洞将普通注册用户的权限提升至管理员级别。漏洞存在于 `UsersController` 的 `updated_ajax` 方法中，具体是使用了 `params.require(:user).permit!`，该方法未能对传入的用户参数进行有效过滤，导致攻击者可以注入并修改 `role` 参数。POC的实现步骤包括：首先，使用普通注册用户的凭证进行认证；其次，向 `/admin/users/[id]/updated_ajax` 端点发送一个特制的POST请求，请求体中包含 `password[role]=admin` 字段，同时更新用户的密码以确保会触发 `updated_ajax` 方法；最后，POC尝试访问管理员专属的端点来验证特权升级是否成功。根据`README.md`中的描述，该脚本提供了详细的安装（`pip install -r requirements.txt`）和使用说明，包括目标URL、用户名、密码以及可选的新密码参数，并给出了示例命令。这些信息表明该POC是一个功能完整的、可以直接运行的利用脚本，具有很高的有效性。它不仅指明了受影响的版本（Camaleon CMS 2.9.0），还给出了具体的漏洞代码片段和恶意payload，这对于验证漏洞和复现攻击非常有帮助。该POC的清晰度和完整性使其成为一个可靠的攻击工具，能够有效证明CVE-2025-2304的存在及可利用性。

**利用步骤**：
1.  **环境准备**：确保目标系统运行Camaleon CMS 2.9.0或更早的未打补丁版本。攻击者需要一个已注册的普通用户账户及其凭证。
2.  **获取POC脚本**：下载或编写用于利用此漏洞的Python脚本。
3.  **安装依赖**：根据POC提供的 `requirements.txt` 文件，安装所有必要的Python库。例如，`pip install -r requirements.txt`。
4.  **执行POC**：通过命令行运行Python脚本，提供目标Camaleon CMS实例的URL、已注册的用户名和密码。例如：`python camaleon_cms_privilege_escalation.py --url http://target-cms.com --username regularuser --password userpassword`。可选地，可以指定一个新的管理员密码：`--new-password newadminpass`。
5.  **认证与请求**：POC脚本将首先使用提供的凭证登录Camaleon CMS，获取会话cookie。然后，它将构造一个HTTP POST请求，发送到用户的profile更新端点，通常是 `/admin/users/[id]/updated_ajax`。请求的关键在于在POST数据中包含 `password[role]=admin`，同时还包含 `password[password]` 和 `password[password_confirmation]` 来更新用户的密码，以触发 Mass Assignment 漏洞。
6.  **权限提升**：由于 `updated_ajax` 方法中 `permit!` 的不安全使用，系统会不加过滤地处理所有传入参数，包括恶意的 `role=admin`。这将导致当前登录用户的角色从普通用户提升为管理员。
7.  **验证**：POC脚本会尝试访问只有管理员才能访问的页面或功能，以验证特权升级是否成功。如果验证通过，则表明攻击成功，该用户现在已具有管理员权限。
8.  **后果**：一旦普通用户获得管理员权限，他们就可以完全控制整个CMS系统，包括管理用户、发布或修改内容、访问敏感数据，甚至可能通过文件上传等功能进一步执行远程代码。

**投毒风险分析**：
鉴于提供的POC代码描述和上下文，该POC的投毒风险评估为**低（0%）**。以下是详细分析：
1.  **高度透明和明确的意图**：POC的 `README.md` 文件非常详尽，明确指出了漏洞的CVE编号 (CVE-2025-2304)、受影响产品 (Camaleon CMS 2.9.0)、漏洞类型 (Mass Assignment导致的特权升级)，并详细描述了攻击向量、利用机制和预期结果。这种高度的透明性排除了代码中隐藏恶意功能的可能性，因为其所有操作都被详细记录和解释。POC的目的明确，即作为合法安全研究的一部分，用于演示和验证Camaleon CMS中的一个已知安全缺陷，而非作为恶意载荷的一部分。
2.  **标准且可预测的攻击行为**：该POC的利用方法遵循了典型的Mass Assignment漏洞攻击模式。它通过修改HTTP POST请求中的参数，利用服务器端输入验证的缺陷来篡改用户角色的敏感属性。这种行为模式是安全社区广泛理解和识别的。POC所描述的HTTP请求和参数修改是针对目标系统特定漏洞点的精确攻击，没有涉及任何异常的协议、端口扫描、横向移动尝试或其他非预期的网络活动。
3.  **无外部非标准依赖或混淆**：`README.md` 仅提及安装 `requirements.txt` 中的依赖。在Python生态系统中，`requirements.txt` 是标准化的依赖管理机制，其内容是可审计的。通常，这类POC会依赖于像 `requests` 这样的HTTP客户端库。没有迹象表明POC会引入或执行来自不明来源的二进制文件、混淆代码、恶意外部脚本、或使用 `eval()` 等高风险函数来动态执行代码。其操作流程是线性的和直接的，专注于漏洞的利用逻辑。
4.  **防御性研究背景**：本次分析任务的明确目的是防御性安全研究，旨在识别和理解漏洞以加强组织防御。在这种受控且道德的研究环境中，提供的POC被视为测试工具，其设计原则是最小化副作用和风险，确保其行为仅限于验证漏洞本身。安全研究人员在构建此类POC时通常会避免加入任何与漏洞验证无关的恶意代码，以维护研究的合法性和可信度。
5.  **行为可审计性强**：由于POC的利用过程涉及特定的HTTP请求，这些请求在网络流量层面是可被监控和记录的。如果POC包含任何额外的恶意载荷或通信，这些异常行为将在网络监控和日志分析中暴露。`README.md`中详细的Payload示例也进一步增强了其行为的可审计性。
综上所述，根据提供的POC代码描述，该脚本被设计为一个纯粹的功能性漏洞利用工具，不包含任何恶意或可疑的投毒行为，因此其投毒风险评估为0%。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
