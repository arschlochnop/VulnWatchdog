## CVE-2025-2304 - Camaleon CMS 权限提升 (大规模赋值)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (大规模赋值)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

**影响版本:** 2.9.0

**利用条件:** 需要认证 (普通用户); 需要网络访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-2304 是 Camaleon CMS 2.9.0 版本中存在的一个关键的权限提升漏洞，具体表现为通过大规模赋值（Mass Assignment）实现。该漏洞存在于 `UsersController` 的 `updated_ajax` 方法中。当用户更新其资料时，该方法错误地使用了 `params.require(:user).permit!`，而不是对允许更新的参数进行明确的过滤。`permit!` 方法允许所有传入的参数绕过安全过滤，这使得攻击者能够注入和修改不应该由普通用户控制的属性，例如用户的 `role`（角色）。攻击者可以利用此漏洞将其账户的角色从普通用户提升为管理员。

**POC有效性分析**

该POC的`README.md`文件提供了非常详细和清晰的漏洞利用说明，表明其是一个功能完整且可靠的利用工具。该漏洞的核心在于Rails框架中`permit!`方法的误用，导致了大规模赋值漏洞。POC脚本通过以下步骤实现了漏洞利用：首先，它使用提供的普通用户凭据登录到目标Camaleon CMS系统。登录成功后，脚本会向`/admin/users/[id]/updated_ajax`端点发送一个POST请求，其中包含精心构造的恶意负载。该负载的关键部分是`password[role]=admin`，它利用了系统更新密码时也会处理其他参数的逻辑，从而将当前用户的角色修改为管理员。`README.md`中还明确指出了受影响的代码位置和恶意负载的HTTP请求示例，这进一步验证了POC的有效性。最终，脚本会尝试访问管理员专属的页面以验证权限提升是否成功，这种验证机制增加了POC的可靠性。尽管`README.md`提到脚本可能抛出一些错误，并建议忽略，但从其核心逻辑和详细描述来看，该POC能够成功地利用大规模赋值漏洞实现权限提升。

**利用步骤**

1.  **准备阶段**：攻击者需要获取或注册一个Camaleon CMS 2.9.0实例上的普通用户账户的凭据（用户名和密码）。
2.  **POC安装**：攻击者需在本地环境安装Python，并使用`pip install -r requirements.txt`命令安装POC所需的依赖库（通常是`requests`库）。
3.  **执行POC**：通过命令行执行POC脚本，提供目标CMS的URL、普通用户账户的用户名和密码。例如：`python camaleon_cms_privilege_escalation.py --url http://target-cms.com --username regularuser --password userpassword --new-password newadminpass`。
4.  **认证**：POC脚本首先会利用提供的凭据对目标CMS进行认证，获取会话令牌。
5.  **发送恶意请求**：脚本随后会构造一个POST请求，目标地址为`/admin/users/[id]/updated_ajax`（`[id]`为当前用户的ID）。请求体中包含恶意负载，例如`password[password]=newpass123&password[password_confirmation]=newpass123&password[role]=admin&_method=patch`。这里，`password[role]=admin`是触发权限提升的关键。
6.  **权限提升**：由于`UsersController#updated_ajax`方法中`permit!`的错误使用，CMS服务器会处理`role=admin`参数，并将当前用户的角色从普通用户修改为管理员。
7.  **验证**：POC脚本会尝试访问通常只有管理员才能访问的页面或功能，以验证权限提升是否成功。攻击者也可以在脚本执行完成后，使用被提升权限的用户账户重新登录CMS，确认其已获得管理员权限。

**投毒风险分析**

根据提供的POC`README.md`文件，该POC的投毒风险被评估为低（10%）。判断依据如下：首先，`README.md`清晰地说明了漏洞的原理、影响范围、利用方式和预期结果，这符合合法安全研究的透明性要求。它详细描述了攻击者如何利用大规模赋值漏洞将普通用户权限提升为管理员，并且提供了具体的Python脚本使用方法和示例。其次，POC的描述中没有提及任何代码混淆、使用外部可疑脚本、连接未知C2服务器或进行非预期行为（如安装后门、加密货币挖矿等）的迹象。其主要功能是进行认证和发送特定HTTP POST请求，这通常是用于漏洞验证的标准操作。`requirements.txt`的提及也暗示了使用标准的Python库，进一步降低了风险。尽管任何第三方POC都存在潜在的投毒风险，因为用户需要运行未知来源的代码，但从现有信息来看，该POC没有表现出任何恶意行为的特征。然而，在实际使用任何POC之前，始终强烈建议安全研究人员或工程师仔细审查其完整的源代码，以确保没有隐藏的恶意功能。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
