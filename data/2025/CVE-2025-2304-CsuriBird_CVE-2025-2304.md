## CVE-2025-2304 - Camaleon CMS Privilege Escalation (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Privilege Escalation (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** Critical

**CVSS评分:** 

**影响版本:** 2.9.0

**利用条件:** Authenticated user, Network access

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** Medium

**投毒风险:** 10%

## 详情

此POC旨在利用Camaleon CMS 2.9.0版本中的一个关键的大量赋值（Mass Assignment）漏洞，实现权限提升。该漏洞存在于`UsersController`的`updated_ajax`方法中。在Ruby on Rails应用中，当控制器方法使用`params.require(:user).permit!`语句时，它会无差别地允许所有传入参数通过，缺乏细粒度过滤。这意味着攻击者可经由HTTP请求参数，直接修改模型对象的任意属性，包括本不应由用户控制的`role`字段。此漏洞的本质在于`permit!`方法的误用；开发者通常应使用`permit`方法进行参数白名单过滤。在Camaleon CMS 2.9.0的`UsersController#updated_ajax`中，此错误允许恶意用户注入`role=admin`等参数，并被系统接受。\n\n**POC有效性分析:**\nPOC通过以下步骤利用漏洞：\n1.  **认证阶段**: 脚本使用提供的普通用户凭据登录，确保拥有有效会话。`updated_ajax`方法通常在用户登录后更新个人资料时被调用。\n2.  **利用阶段**: 成功认证后，脚本向`/admin/users/[id]/updated_ajax`端点发送POST请求。Payload精心构造，除密码更新参数外，恶意加入`password[role]=admin`。由于`permit!`方法的缺陷，服务器端将`role`参数值`admin`赋给当前用户角色属性。POC中提到ID默认为5，实际可能需动态获取或猜测。\n3.  **权限提升**: 服务器处理请求后，当前登录用户角色从普通角色提升为“administrator”，攻击者获得CMS完全控制权，包括管理内容、用户、插件、主题等敏感操作。\n4.  **验证阶段**: 脚本尝试访问管理员专属后台端点确认权限提升。访问成功即表明提升完成。README亦指出可手动登录验证新权限。POC提供了完整的利用流程、明确的漏洞点（`@user.update(params.require(:user).permit!)`）和payload示例，具有高度有效性与实用性，对组织构成严重威胁。\n\n**利用步骤:**\n攻击者可按以下步骤利用此漏洞：\n1.  **环境准备**: 确认目标Camaleon CMS版本为2.9.0或更早。准备Python环境及依赖。Python脚本自动化了多数操作，降低技术门槛。\n2.  **获取用户凭据**: 获取目标CMS普通用户账户的用户名和密码。此为利用的关键前置条件。\n3.  **执行POC**: 运行POC脚本，提供目标URL、用户名和密码（可选`--new-password`）。脚本自动处理登录、用户ID发现及恶意请求发送。\n4.  **验证权限**: 脚本执行后，攻击者使用新密码（或原密码）登录。原普通账户角色已升为管理员，可访问所有管理功能。确认获得完全系统控制权，可发布恶意内容、窃取数据或进一步渗透。\n\n**投毒风险分析:**\n根据提供的POC代码描述，该POC的投毒风险评估为**低（10%）**。分析如下：\n\n1.  **代码清晰度与目的透明**: POC的README文件清晰阐述了其目的、工作原理、漏洞详情及利用步骤。明确指出是Python脚本，用于利用Camaleon CMS大量赋值漏洞实现权限提升。所有关键操作（登录、发送POST请求、payload内容）均详细说明，无代码混淆、加密或难以理解的逻辑。标题和概述直接指明功能，不存在欺骗性。\n2.  **无外部依赖或可疑行为**: README仅提及`pip install -r requirements.txt`安装依赖，系标准Python依赖管理，未暗示加载外部恶意脚本或执行异常网络请求（如与未知C2服务器通信）。POC核心操作针对目标CMS的HTTP请求，符合漏洞利用目的。未提及使用`eval()`、`exec()`等危险函数，亦无远程加载代码迹象。其行为模式完全围绕漏洞利用本身。\n3.  **内联代码片段的安全性**: README展示的Ruby代码片段为Camaleon CMS自身漏洞代码及HTTP请求payload示例，而非POC Python代码。这些片段仅用于解释漏洞原理，本身不构成POC投毒风险，因其为静态说明文本，不具备执行能力。\n4.  **“忽略错误”的说明**: README提及“The script might throw some errors, please ignore them。”这可能表示脚本健壮性不足或在边缘情况产生非致命异常，通常是开发不严谨而非恶意代码迹象。恶意POC常试图隐藏真实意图，而非公开承认运行问题。这种坦诚反降低了疑虑。\n5.  **缺乏混淆或伪装**: 作为一个权限提升POC，其行为和目标明确。无迹象表明伪装成合法工具或包含隐藏后门、键盘记录器、挖矿程序等恶意负载。文件名`camaleon_cms_privilege_escalation.py`与功能完全对应，未见伪装。项目结构简单，仅README描述Python脚本，无多余文件或复杂目录结构，进一步降低投毒可能性。\n\n综上，该POC描述显示其专注于实现特定漏洞利用功能。尽管防御性安全研究需警惕非官方代码，但仅凭当前README内容，未发现高风险投毒指标。故评定投毒风险为低。实际运行该Python脚本仍需沙箱分析和代码审计，以确认与描述完全一致，不含未披露恶意功能。

**项目地址:** N/A

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
