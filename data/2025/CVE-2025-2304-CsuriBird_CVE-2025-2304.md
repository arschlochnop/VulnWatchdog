## CVE-2025-2304 - Camaleon CMS 特权升级 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 特权升级 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** Critical

**CVSS评分:** 未提供

**影响版本:** < 2.9.1 ( specifically 2.9.0)

**利用条件:** 需要认证 (普通用户); 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

此漏洞（CVE-2025-2304）影响Camaleon CMS 2.9.0及更早版本，是一个严重的特权升级漏洞，源于`UsersController`中的`updated_ajax`方法存在大规模赋值（Mass Assignment）缺陷。在用户更新个人资料时，该方法使用了不安全的`permit!`操作符，导致所有传递的参数（包括敏感的`role`参数）都可以被未经滤地直接赋值给用户对象。

**POC有效性分析:**
所提供的POC是一个用Python编写的完整利用脚本，它清晰地描述了漏洞的机制和利用过程。该POC首先会以一个普通注册用户的身份登录CMS，然后向`/admin/users/[id]/updated_ajax`接口发送一个特制的POST请求。这个请求的关键在于其恶意负载中包含`password[role]=admin`参数。由于`updated_ajax`方法中`@user.update(params.require(:user).permit!)`的缺陷，系统会将当前用户的`role`属性从普通用户强制更改为管理员。POC中详细说明了安装（`pip install -r requirements.txt`）、使用方法（`python camaleon_cms_privilege_escalation.py --url http://target-cms.com --username regularuser --password userpassword`）和示例，甚至提供了具体的恶意Payload和预期响应，以及漏洞代码在`UsersController`中的位置。这些细节都表明POC是经过精心设计、功能完善且高度有效的，能够成功演示并利用该特权升级漏洞。

**利用步骤:**
1.  **环境准备**: 攻击者首先需要在本地环境安装Python，并通过`pip install -r requirements.txt`命令安装POC脚本所需的所有Python依赖库。
2.  **获取认证凭证**: 攻击者需要预先获得一个Camaleon CMS的普通注册用户账号和密码。这通常可以通过常规用户注册、凭证泄露、社会工程学或其他较低权限的漏洞获取。
3.  **执行POC脚本**: 攻击者在命令行中执行Python POC脚本，并提供目标Camaleon CMS的URL、普通用户凭证以及可选的新管理员密码。例如：`python camaleon_cms_privilege_escalation.py --url http://192.168.1.100 --username testuser --password testpass123 --new-password newadminpass`。
4.  **登录认证**: POC脚本首先会使用提供的普通用户账号和密码向目标CMS进行身份认证，获取有效的会话。
5.  **构造并发送恶意请求**: 成功登录后，脚本会向CMS的`/admin/users/[id]/updated_ajax`接口发送一个POST请求。此请求的HTTP体中包含精心构造的参数，如`password[password]=newadminpass&password[password_confirmation]=newadminpass&password[role]=admin&_method=patch`。这里的核心是`password[role]=admin`，它利用了后端`permit!`方法对参数过滤不严的缺陷，意图将当前用户的角色强制设置为`admin`。
6.  **权限升级**: CMS的后端在处理`updated_ajax`请求时，由于使用了`permit!`而未能正确过滤`role`参数，导致攻击者指定的`admin`角色被直接赋值给当前用户，从而实现普通用户到管理员的权限升级。
7.  **验证升级**: POC脚本在完成上述步骤后，会尝试访问CMS中只有管理员权限才能访问的特定端点，以验证权限升级是否成功。一旦验证成功，攻击者现在即可使用原普通用户账号以管理员身份完全控制Camaleon CMS。

**投毒风险分析:**
根据提供的`README.md`文件内容，评估该POC代码的投毒风险为低（10%）。
首先，该POC的文档非常透明和详尽，明确指出了漏洞类型、受影响版本、利用方式、攻击流程以及技术细节，包括漏洞代码片段和恶意Payload示例。这种高度的透明性表明作者旨在进行合法安全研究和漏洞演示，而非隐藏恶意意图。POC的安装和使用方法遵循标准的Python项目实践，例如通过`pip install -r requirements.txt`安装依赖，以及通过命令行参数指定目标信息。这些都是安全研究工具的常见特征。
其次，该POC的核心功能是执行特权升级，其攻击载荷`password[role]=admin`直接针对漏洞本身，目的是修改受影响用户的角色。这种行为是漏洞利用的必要组成部分，并非旨在植入持久性后门或执行与漏洞无关的恶意操作。因此，将该利用载荷本身视为投毒代码是不准确的。POC的设计目标是演示如何将普通用户升级为管理员，而非利用漏洞进行二次攻击或对攻击者有利的秘密操作。
目前可获取的信息中，没有迹象表明POC代码本身包含恶意混淆、下载非预期外部代码、执行可疑命令或向未知服务器发送敏感数据等行为。所描述的利用过程仅限于与目标CMS的HTTP通信，以实现参数修改。
然而，任何公开的POC代码都存在被恶意行为者修改后重新发布，以包含实际恶意代码的潜在风险。例如，如果`requirements.txt`中指定的第三方库被篡改或被恶意版本替换，攻击者在安装依赖时可能会无意中引入恶意软件。因此，尽管该POC本身的风险较低，但对于任何从非官方渠道获取的POC，用户都应保持警惕，在执行前务必对其代码进行仔细审计，尤其是在生产环境中。建议在隔离环境中测试POC，并检查所有网络请求和文件系统活动，以确保其行为符合预期。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
