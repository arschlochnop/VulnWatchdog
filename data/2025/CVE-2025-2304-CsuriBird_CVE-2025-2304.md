## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** Critical

**CVSS评分:** N/A

**影响版本:** 2.9.0 及更早版本 (受影响版本 < 2.9.1)

**利用条件:** 需要已认证的普通用户账户，并可通过网络访问CMS管理接口。

**POC 可用性:** 9

**POC 类型:** 完整利用 (Exploit)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-2304 是 Camaleon CMS 中一个严重（Critical）的权限提升漏洞，具体存在于版本 2.9.0 及更早版本中。该漏洞的根源在于 `UsersController` 中 `updated_ajax` 方法的不安全实现。在该方法中，应用程序错误地使用了 `params.require(:user).permit!`，而不是对允许更新的参数进行明确的过滤。`permit!` 方法的本意是用于Rails控制器中白名单参数，但其在某些场景下（特别是当与深层哈希或非预期的上下文结合时）可能导致“万能牌”式的参数允许，从而绕过预期的安全控制。

**POC有效性分析:**
提供的POC是一个高质量的Python脚本，具有清晰的结构、详细的文档和使用示例，具备很高的可用性和有效性。该脚本直接针对漏洞核心，通过自动化以下步骤实现权限提升：首先，脚本以一个已注册的普通用户身份登录到Camaleon CMS。接着，它构造并向 `/admin/users/[id]/updated_ajax` 端点发送一个特制的HTTP POST请求。这个请求的恶意之处在于其数据负载：`password[role]=admin`。在正常的密码更新功能中，`user` 或 `password` 参数下的 `role` 字段不应被允许修改。然而，由于 `permit!` 方法的缺陷，这个 `role` 参数被意外地接受并处理，导致当前用户的角色从普通用户被修改为管理员。脚本随后会尝试访问只有管理员才能访问的接口以验证提权是否成功。这种利用方式直接利用了Ruby on Rails中Mass Assignment漏洞的经典模式，即攻击者通过操纵请求参数来修改不应被用户控制的数据库字段。POC的完整性和验证机制使其成为一个高度可靠的利用工具，能够有效复现和利用该漏洞。

**利用步骤:**
1. **环境准备:** 确保目标系统运行Camaleon CMS 2.9.0或更早版本，并拥有一个有效的普通用户账户（用户名和密码）。
2. **安装依赖:** 在本地环境中，使用 `pip install -r requirements.txt` 安装Python脚本所需的库。
3. **执行POC:** 运行Python脚本，提供目标CMS的URL、普通用户的用户名和密码。例如：
   `python camaleon_cms_privilege_escalation.py --url http://192.168.1.100 --username testuser --password testpass123 --new-password newadminpass`
   脚本会自动处理用户登录、构造恶意请求并发送至 `/admin/users/[id]/updated_ajax`。这里的 `[id]` 通常是普通用户的ID，POC中提到默认使用ID 5，但可能需要根据实际情况调整。恶意负载会将用户的 `role` 参数设置为 `admin`。
4. **验证:** 脚本会尝试访问管理员专属功能来验证权限提升是否成功。攻击者也可以手动使用升级后的账户登录CMS，确认是否已获得管理员权限。

**投毒风险分析:**
根据提供的README文件和POC代码片段，该POC的投毒风险评估为低（10%）。主要原因如下：
1. **代码清晰度高:** POC的描述非常详细，解释了漏洞原理、工作方式和利用步骤。代码逻辑围绕实现权限提升这一特定目标展开，没有明显的混淆或复杂结构，易于理解和审计。
2. **目的单一:** 脚本的唯一明确目的是利用Mass Assignment漏洞进行权限提升，并进行验证。没有迹象表明其包含额外的恶意功能，如建立后门、进行远程C2通信、下载并执行其他恶意载荷或进行数据窃取等非预期行为。
3. **标准库依赖:** 尽管`requirements.txt`文件本身未提供，但通常此类Python脚本依赖于常见的HTTP请求库（如`requests`）。只要`requirements.txt`中不包含恶意第三方包，且其内容未被篡改，则其风险较低。作为防御性安全研究，在执行任何第三方POC之前，始终建议审查`requirements.txt`的内容以及所有依赖库的源代码。
4. **无外部资源加载:** 提供的POC描述中没有提及脚本会从外部服务器加载或执行任何代码，这降低了运行时引入未知风险的可能性。

综上所述，该POC被设计为一种合法的安全研究工具，用于验证漏洞。然而，任何执行第三方代码的行为都应在隔离环境中进行，并对代码和其依赖项进行严格的安全审计，以防范任何潜在的意外或隐藏的恶意行为。

**项目地址:** N/A (本地路径或私有仓库)

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
