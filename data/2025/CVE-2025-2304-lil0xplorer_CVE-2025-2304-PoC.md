## CVE-2025-2304 - Camaleon CMS 权限提升 (Privilege Escalation), 大规模赋值 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Privilege Escalation), 大规模赋值 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** N/A

**影响版本:** < 2.9.1

**利用条件:** 需要认证, 网络可访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

该POC针对Camaleon CMS中的一个权限提升漏洞（CVE-2025-2304），该漏洞源于一个大规模赋值（Mass Assignment）缺陷。具体来说，当用户尝试更改密码时，`UsersController`中的`updated_ajax`方法不当地使用了`permit!`方法，导致所有传入参数未经充分过滤便被处理。攻击者可以利用此漏洞，在密码更新请求中注入`password[role]=admin`参数，从而将普通用户的权限提升至管理员。
POC代码（`exploit.py`）使用Python编写，依赖于`requests`、`BeautifulSoup`和`re`等标准库。其攻击流程清晰且有效：
1.  **认证**：脚本首先使用提供的有效用户凭据登录目标Camaleon CMS系统。
2.  **信息收集**：登录成功后，脚本访问用户的个人资料编辑页面（`/admin/profile/edit`），从页面内容中提取当前用户的`user_id`以及一个新的CSRF令牌。`user_id`用于构建后续的请求URL，而CSRF令牌用于绕过CSRF保护。
3.  **权限提升**：脚本随后构造一个`PATCH`请求，发送至`/admin/users/{user_id}/updated_ajax`端点。此请求的头部包含之前获取的CSRF令牌和`X-Requested-With: XMLHttpRequest`，模拟AJAX请求。请求体中除了包含正常的密码更新参数外，还恶意注入了`password[role]=admin`。
4.  **结果验证**：`README.md`中提供的示例输出`[+] Exploited! You're admin now`表明该POC能够成功执行权限提升操作。
该POC的逻辑与漏洞描述高度一致，利用了Web框架中常见的大规模赋值风险，通过未经验证的参数直接修改用户角色属性，因此具有很高的有效性。

**利用步骤**：
利用此POC的步骤如下：
1.  **环境准备**：确保本地系统已安装Python 3，并通过`pip install requests beautifulsoup4`安装所需的依赖库。
2.  **获取POC**：从POC源获取`exploit.py`文件和`README.md`文件。
3.  **执行命令**：打开终端或命令行界面，导航至`exploit.py`所在的目录。
4.  **运行POC**：执行以下命令，替换`http://target.com`为目标Camaleon CMS的URL，`username`和`password`为目标系统中的有效普通用户凭据：
    ```bash
    python exploit.py --url http://target.com -u username -p password
    ```
5.  **验证结果**：如果利用成功，脚本将输出`[+] Exploited! You're admin now`，表明指定用户的权限已成功提升至管理员。

**投毒风险分析**：
对提供的POC代码进行详细分析，旨在评估其潜在的投毒风险。在防御性安全研究中，对公开POC的安全性进行审查至关重要，以避免引入新的安全隐患。

1.  **代码来源与结构**：
    该POC代码以Python脚本（`exploit.py`）的形式提供，并附有详细的`README.md`文档。代码结构清晰，使用了标准的Python库，包括`requests`用于HTTP通信，`argparse`用于命令行参数解析，`BeautifulSoup`用于HTML解析，以及`re`用于正则表达式匹配。这些都是Python社区广泛使用且受信任的库，其本身不包含已知恶意功能。

2.  **依赖项分析**：
    POC明确列出了其依赖项：`pip install requests beautifulsoup4`。这些依赖项通过Python的官方包管理系统PyPI获取，通常被认为是安全的。代码中没有出现导入非标准或可疑第三方库的情况，这降低了通过恶意依赖链引入风险的可能性。

3.  **网络行为分析**：
    `exploit.py`中的所有网络请求都明确指向用户通过`--url`参数指定的目标URL。没有发现任何向预设的第三方服务器、C2服务器或其他可疑IP地址发送数据的行为。脚本只执行认证、页面内容抓取和发送特定利用请求，这些行为均与漏洞利用的逻辑直接相关。不存在尝试下载和执行外部脚本、上传敏感信息或进行加密货币挖矿等恶意网络活动。

4.  **文件系统与系统命令交互**：
    POC代码主要专注于HTTP通信和数据解析，没有尝试访问本地文件系统（除了导入标准库文件），也没有执行任何系统级别的命令（例如使用`os.system()`或`subprocess`模块执行外部程序）。这消除了通过POC代码进行文件篡改、数据窃取或在执行POC的机器上留下后门等风险。

5.  **代码混淆与动态执行**：
    代码未见任何混淆技术，逻辑易于阅读和理解。没有使用`eval()`、`exec()`等可能导致任意代码执行的动态功能，也没有动态加载或执行来自网络或其他不可信源的代码。这使得代码难以隐藏恶意行为，便于安全研究人员进行审计。

6.  **错误处理与日志记录**：
    POC在错误处理和日志记录方面较为基础，主要通过`print`语句输出执行状态。虽然这不是直接的投毒风险，但良好的错误处理和日志记录有助于快速诊断问题，减少在测试过程中因未知行为而产生的疑虑。

7.  **免责声明与作者信息**：
    `README.md`中包含明确的免责声明，指出该工具仅用于教育和授权的安全测试目的，并警告未经授权访问计算机系统是非法的。此外，还提供了作者的社交媒体链接（X和LinkedIn），这增加了透明度和责任感。虽然声明本身不能完全消除风险，但它表明作者至少在形式上遵循了负责任的披露和使用原则。

**总结**：
综合以上分析，此CVE-2025-2304的POC代码的投毒风险极低，评估为5%。其代码清晰、依赖标准库、网络行为透明且受控、无文件系统或系统命令交互，且无代码混淆或动态执行恶意代码的迹象。在使用此类POC时，始终建议在隔离环境中运行，并进行代码审查，以确保其安全性。但就目前提供的代码而言，其恶意性极小。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
