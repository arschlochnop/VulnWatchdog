## CVE-2025-2304 - Camaleon CMS 权限升级 (Privilege Escalation)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限升级 (Privilege Escalation)

**影响应用:** Camaleon CMS

**危害等级:** 高 (High)

**CVSS评分:** 

**影响版本:** < 2.9.1

**利用条件:** 需要认证 (Requires authentication)

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中 (Medium)

**投毒风险:** 5%

## 详情

POC有效性分析：
提供的POC代码 (`exploit.py`) 是一个完全可用的脚本，旨在成功利用Camaleon CMS中的CVE-2025-2304漏洞。该脚本精确地实现了`README.md`中描述的步骤，以实现权限升级。它首先使用提供的用户名和密码进行身份验证。成功登录后，脚本解析用户个人资料页面以提取当前用户的ID，并获取有效的CSRF令牌。最后，它向`/admin/users/{user_id}/updated_ajax`端点发送一个精心构造的`PATCH`请求。此漏洞的关键在于请求体中注入了`password[role]=admin`参数。这利用了“批量赋值 (Mass Assignment)”漏洞，即`UsersController`中的`permit!`方法未能过滤参数，允许经过身份验证的用户在密码更新操作期间将其`role`属性修改为`admin`。该脚本处理所有必要的动态元素，例如CSRF令牌和用户ID，使其健壮且可直接使用。`README.md`中显示的输出表明成功利用，证实了脚本将标准用户提升为管理员权限的有效性。使用标准Python库（`requests`、`BeautifulSoup`、`re`）进一步证实了其可靠性和易于设置。这个POC对于演示和验证此漏洞非常有效。

利用步骤：
1.  **先决条件**：攻击者需要任何用户帐户（即使是低权限帐户）的有效登录凭据，运行在易受攻击的Camaleon CMS实例上（版本低于2.9.1）。必须安装Python和所需的库（`requests`、`beautifulsoup4`）。
2.  **身份验证**：利用脚本首先使用提供的用户名和密码对`http://target.com/admin/login`进行标准登录。它从登录页面提取`authenticity_token`（CSRF令牌），以便进行POST请求。
3.  **信息收集**：登录后，脚本访问用户的个人资料编辑页面（`http://target.com/admin/profile/edit`）。然后，它解析HTML以提取两个关键信息：当前用户的数字`user_id`以及元标签中的新`csrf-token`，后续需要用于经过身份验证的请求。
4.  **权限升级**：脚本随后向`/admin/users/{user_id}/updated_ajax`端点发送一个精心构造的`POST`请求（使用`_method: patch`来模拟`PATCH`请求）。请求头中包含`X-CSRF-Token`和`X-Requested-With: XMLHttpRequest`。此请求的有效载荷至关重要：它包含`password[password]`、`password[password_confirmation]`（设置为原始密码）以及最关键的`password[role]=admin`。由于批量赋值漏洞，CMS会处理此`role`参数，将经过身份验证的用户角色更新为管理员。
5.  **验证**：成功执行后，用户的权限将被提升。脚本通常会通过一条消息确认这一点，如示例输出所示：`[+] Exploited! You're admin now`。攻击者随后可以使用其原始凭据登录，并发现他们现在拥有完整的管理员权限。

投毒风险分析：
提供的POC代码 (`exploit.py`) 及其相关的`README.md`已针对潜在的投毒风险进行了彻底审查，例如恶意意图、代码混淆或包含有害的外部组件。分析得出结论，与此特定POC相关的投毒风险非常低，估计约为5%。
导致这种低风险评估的主要原因是代码的直观和透明性质。`exploit.py`脚本用Python编写，仅使用广为人知且合法的开源库：`requests`用于HTTP通信，`argparse`用于命令行参数解析，`BeautifulSoup`用于HTML解析，`re`用于正则表达式。这些都是网络安全测试和开发中的标准工具，它们在脚本中的用法是常规且易于审计的。
代码中没有代码混淆、base64编码或可能隐藏恶意载荷的异常加密操作的迹象。脚本的逻辑与所描述的漏洞直接相关：它执行登录，提取必要的动态令牌（CSRF、用户ID），然后向具有已知易受攻击参数（`password[role]=admin`）的指定端点发送一个专门构造的HTTP POST请求。此行为与演示批量赋值权限升级完全一致。
此外，脚本不会尝试从第三方URL下载或执行任何外部代码或脚本。它完全在其自包含结构中使用已安装的Python库进行操作。除了漏洞利用本身所需的网络请求之外，没有可疑的网络请求，没有超出标准临时操作的文件系统修改，也没有尝试建立反向Shell或其他后门。`README.md`中的“免责声明”部分明确指出该工具“仅用于教育和授权的安全测试目的”，这强化了其预期的良性用途。
虽然不能保证任何代码100%不含隐藏的恶意意图（例如，可能会设想出高度复杂的、多阶段的攻击），但根据可观察到的代码及其依赖项，此POC被认为对出于防御目的执行它的用户造成危害的风险极低。用户应始终谨慎并审查代码，但对于此特定实例，风险被认为是低的。

**项目地址:** 

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-2304
