## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** 未知

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-2304 是一个影响 Camaleon CMS 的权限提升漏洞，允许经过身份验证的低权限用户将其角色提升为管理员。此漏洞的根本原因在于 `UsersController` 中 `updated_ajax` 方法的不安全实现。当用户尝试更改密码时，该方法被调用，但其内部使用的 `permit!` 方法未能对所有传入参数进行严格过滤，从而导致了典型的 Mass Assignment（批量赋值）漏洞。攻击者可以利用这一缺陷，在密码更新请求中注入额外的参数，例如指定 `password[role]=admin`，从而恶意修改用户的角色属性。

**POC有效性分析：**
提供的 Python POC 脚本 `exploit.py` 具有高度的有效性和完整性，完全能够自动化地演示和利用 CVE-2025-2304 漏洞。该脚本使用了一系列标准的、广泛信任的 Python 库，包括 `requests` 用于处理 HTTP 请求，`beautifulsoup4` 用于解析 HTML 内容以提取关键信息，`argparse` 用于处理命令行参数，以及 `re` 用于正则表达式匹配。这些库的运用使得脚本功能强大且可靠。POC的 `README.md` 文件提供了清晰、详细的文档，包括环境要求 (`pip install requests beautifulsoup4`)、使用方法、参数说明和执行示例。脚本的预期输出 `[+] Exploited! You're admin now` 明确表明其能够成功将普通用户权限提升至管理员级别。通过对脚本代码的审查，可以确认其逻辑严谨，步骤清晰，涵盖了从认证、信息提取到最终发送恶意请求的全过程。脚本通过模拟用户登录，获取会话相关的 CSRF token 和用户 ID，然后构造一个包含 `password[role]=admin` 字段的 PATCH 请求，成功绕过了CMS的权限校验机制，实现了权限的越界操作。因此，该 POC 脚本被评价为高质量、完整且功能强大的漏洞利用工具。

**利用步骤：**
1.  **环境准备**：攻击者需要在本地系统安装 Python 环境，并安装 POC 所需的第三方库：`pip install requests beautifulsoup4`。
2.  **获取有效凭证**：攻击前提是需要一个在目标 Camaleon CMS 上注册的有效用户账户（即拥有用户名和密码）。即使是最低权限的普通用户账户，也足以作为利用此漏洞的起点。
3.  **执行漏洞利用脚本**：攻击者通过命令行执行 `exploit.py` 脚本，并提供目标 Camaleon CMS 的基础 URL，以及有效的用户名和密码作为参数。例如：`python exploit.py --url http://target.com -u normal_user -p user_password`。
4.  **自动化认证过程**：脚本首先会向目标 CMS 的 `/admin/login` 路径发起一个 GET 请求，以获取登录页面中嵌入的 `authenticity_token`（即 CSRF token）。随后，它将使用此 token、提供的用户名和密码，向 `/admin/login` 路径发送一个 POST 请求，完成用户身份验证，并建立一个有效的会话。
5.  **提取用户ID和更新CSRF**：成功认证并建立会话后，脚本会访问当前用户的个人资料编辑页面 (`/admin/profile/edit`)。在此页面中，脚本将解析 HTML 响应，利用正则表达式精确提取当前用户的 `user_id`（通常存在于表单字段或 URL 中），并获取用于后续请求的新的 CSRF token。这些信息是构造精确、有效的攻击请求所必需的。
6.  **构造并发送恶意请求**：这是整个漏洞利用的核心步骤。脚本会构造一个 PATCH 请求，目标 URL 是 `/admin/users/{user_id}/updated_ajax`。请求头部将包含必要的 `X-CSRF-Token` 和 `Content-Type: application/x-www-form-urlencoded; charset=UTF-8` 等信息。请求体中除了包含正常的密码更新参数（例如 `password[password]` 和 `password[password_confirmation]`）外，关键在于恶意地插入 `password[role]: admin` 参数。
7.  **CMS处理与权限提升**：当 Camaleon CMS 的 `updated_ajax` 方法接收到这个精心构造的请求时，由于其内部使用的 `permit!` 方法未能对所有输入参数进行充分过滤，它会将 `password[role]` 参数视为有效输入，并将其值 `admin` 赋给当前用户的角色属性。这导致了该用户的权限被成功提升至管理员级别。
8.  **验证结果**：脚本最终会打印出 `[+] Exploited! You're admin now` 的成功信息，表明当前会话的用户权限已成功提升为管理员，攻击者现在可以以管理员身份执行任意操作，对 CMS 造成严重影响。

**投毒风险分析：**
对提供的 `exploit.py` POC 代码进行深入分析，评估其潜在的投毒风险，可以得出结论：该代码的投毒风险极低，可以安全地用于防御性安全研究。

首先，**代码透明度极高**。该 POC 脚本以纯文本形式存在，没有使用任何混淆技术、加密或打包手段。这意味着其所有功能和执行逻辑都完全公开且易于审查。任何具备基本 Python 技能的安全研究员都可以轻松阅读并理解其每一行代码，从而验证其行为是否符合预期，以及是否存在任何隐藏的恶意功能。

其次，**依赖项安全且标准**。脚本所依赖的库仅限于 Python 标准库（如 `argparse` 用于命令行参数解析，`re` 用于正则表达式操作）以及两个在 Python 生态系统和安全社区中广泛使用并高度信任的第三方库：`requests`（用于发出 HTTP 请求）和 `beautifulsoup4`（用于 HTML 解析）。这些库都是开源的，经过了大量社区的审查和测试，其自身引入恶意代码的风险微乎其微。脚本中没有发现导入任何不常见、来源不明或可能携带恶意载荷的外部模块或依赖。

再者，**网络通信行为受限且可预测**。该 POC 脚本所有的网络请求都明确且唯一地指向用户通过 `--url` 参数指定的单个目标 URL。脚本不会向任何其他预设的、硬编码的、可疑的或随机生成的 IP 地址或域名发起连接。它也未尝试与外部 C2（命令与控制）服务器进行通信，或进行任何形式的数据外泄。所有发出的 HTTP 请求内容都与漏洞利用的既定目的严格相符，即登录、获取会话信息和发送带有权限提升参数的 PATCH 请求，无任何额外的、可疑的数据传输。

此外，**系统交互极少且安全**。该脚本的设计专注于 Web 应用层面的交互，通过 HTTP 协议与目标 Web 服务器通信。在本地执行环境中，除了读取命令行参数和将执行结果打印到标准输出外，脚本没有执行任何文件系统操作（例如创建、读取、写入或删除文件），也没有尝试访问敏感的系统资源，更没有执行任意操作系统命令（如通过 `subprocess.call()` 或类似函数）。这意味着即使在受控环境中运行此脚本，也不会对本地操作系统或文件系统造成任何意外的副作用或损害。

最后，**缺乏动态代码执行机制**。对代码进行详细分析后，未发现使用 `eval()`、`exec()`、动态导入或加载外部非标准模块等可能导致运行时动态代码执行的函数。所有代码执行路径都是静态且可预测的，排除了在运行时加载或执行未经验证代码的风险。脚本的功能范围严格限定在其明确的漏洞利用目的之内，不包含任何额外的、与利用目的无关的复杂或隐藏功能。

综合以上分析，该 POC 代码展现出高度的专业性和安全性。其透明的代码结构、对标准且受信库的依赖、受控且可预测的网络行为，以及缺乏对系统资源的额外交互和动态代码执行能力，共同证明了其极低的投毒风险。该脚本是一个纯粹用于验证 CVE-2025-2304 漏洞的工具，不包含任何恶意或隐蔽的投毒代码。因此，其投毒风险评估为10%。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
