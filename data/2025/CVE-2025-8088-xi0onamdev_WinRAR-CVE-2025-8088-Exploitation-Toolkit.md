## CVE-2025-8088 - WinRAR 路径遍历/目录穿越 (Path Traversal/Directory Traversal)

**漏洞编号:** CVE-2025-8088

**漏洞类型:** 路径遍历/目录穿越 (Path Traversal/Directory Traversal)

**影响应用:** WinRAR

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** WinRAR 7.12及以下版本 (部分来源提及7.13以下版本)

**利用条件:** 用户需解压恶意构造的RAR压缩包，无需认证，可通过网络传播。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

### POC有效性分析
该POC是一个基于Python的图形用户界面（GUI）工具，专门用于利用WinRAR软件中的CVE-2025-8088路径遍历漏洞。该漏洞影响WinRAR 7.12及以下版本（部分信息指出7.13及以下版本），允许攻击者通过精心构造的RAR压缩包，在解压时将恶意文件释放到系统任意位置，最终实现任意代码执行。

该工具的有效性在于其巧妙地结合了Windows NTFS备用数据流（ADS）特性和RAR5文件头操纵技术。其工作流程分为五个关键阶段，这些阶段共同确保了恶意载荷的隐蔽性和持久性：

1.  **数据流注入 (Stream Injection)**：在攻击的第一阶段，工具利用NTFS备用数据流来隐藏攻击者的可执行载荷（例如`.exe`或`.bat`文件）。正常文件（如一个无害的文本文件）可以包含一个或多个备用数据流，这些数据流通常在文件管理器中不可见。通过将恶意载荷写入如`innocent.txt:malicious.exe`这样的数据流中，可以在不改变`innocent.txt`文件大小和内容的前提下，有效地“夹带”恶意代码。这种隐蔽性使得恶意载荷更难被传统的文件扫描或人工检查发现，为后续的投递和执行奠定了基础。

2.  **档案构建 (Archive Construction)**：接下来，工具利用系统中已安装的`rar.exe`命令行工具，将包含ADS注入文件的临时目录打包成一个标准的RAR档案。如果攻击者提供了诱饵文件，该文件也会被包含在内，以进一步迷惑受害者，使其认为正在解压一个正常的、预期的文件（例如一份文档或图片）。这一步使用的是WinRAR的合法压缩功能，但其内容已被预先处理为包含ADS隐蔽载荷的结构。

3.  **头部打补丁/路径遍历 (Header Patching/Path Traversal)**：这是漏洞利用的核心环节，也是该POC工具最关键的技术部分。`exploit_core.py`脚本不再仅仅依赖`rar.exe`，而是直接读取并修改生成的RAR5档案的二进制头部信息。它精确地修改了压缩包中文件项的路径描述，插入了大量的`..\`（父目录遍历）序列。通过这种方式，当受感染的WinRAR版本解压这个档案时，它会错误地解析路径，导致文件被写入到攻击者指定的目标路径，而不是用户预期的解压目录。该工具的目标路径被硬编码为`..\..\..\..\..\..\..\..\..\..\..\..\..\..\..\..\Users\%USERNAME%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\`，其目的是将恶意载荷直接放置到Windows的启动目录中。一旦文件被放置到启动目录，恶意程序将在用户下次登录或系统启动时自动执行，从而实现持久化控制和任意代码执行。

4.  **完整性校验 (Integrity Check)**：在修改了RAR档案的二进制头部之后，文件的CRC32校验和也会随之改变。为了确保生成的RAR档案仍然是有效的、可被WinRAR正常识别和解压（尽管是恶意解压），工具会重新计算并更新受影响部分的CRC32校验和。这一步是确保漏洞利用成功率的关键，避免因校验和不匹配导致档案损坏而无法利用。

5.  **部署 (Deployment)**：最后，工具输出一个完全武器化的RAR压缩包。这个压缩包已经准备好通过钓鱼邮件、恶意网站下载或其他社交工程手段分发给目标。由于其隐蔽性和自动化程度，攻击者可以高效地针对大量目标发起攻击。

结合搜索结果中提及的UNC4895 (RomCom)、APT44、Turla等间谍组织已将此漏洞武器化，并针对乌克兰军事及政府机构进行攻击，这进一步证明了该漏洞的严重性及其利用工具的有效性。该POC工具将复杂的ADS隐藏技术和二进制文件格式篡改自动化，极大地降低了攻击者的技术门槛，使其能够高效地构建和分发具有高度威胁的恶意载荷，对组织构成严重的威胁。

### 利用步骤
1.  **环境准备**: 确保系统已安装 Python 3.8+，并且 WinRAR 命令行工具 (`rar.exe`) 已添加到系统 PATH 环境变量中，或位于默认安装路径 (`C:\Program Files\WinRAR\` 或 `C:\Program Files (x86)\WinRAR\`)。
2.  **安装依赖**: 打开命令行或终端，执行 `pip install PyQt6` 安装图形界面库。
3.  **启动工具**: 在命令行中执行 `python gui.py` 启动漏洞利用控制台。
4.  **选择载荷 (Payload)**: 在工具界面上，点击 "PAYLOAD" 区域，选择一个可执行文件作为恶意载荷（例如，`.exe` 或 `.bat` 文件）。
5.  **选择诱饵 (Decoy)**: （可选）点击 "DECOY" 区域，选择一个无害文件作为诱饵，以分散目标用户的注意力，使其认为这是一个正常文件。
6.  **设置目标用户名 (Target)**: 设置一个备用的 Windows 用户名（默认为 "Administrator"）。这是用于构建目标路径 (`%USERNAME%` 部分) 的后备。
7.  **定义输出文件名 (Output)**: 在 "OUTPUT" 区域输入生成的恶意 RAR 压缩包的文件名。
8.  **执行**: 点击 "INITIATE EXPLOIT BUILD" 按钮，工具将开始生成武器化的 RAR 压缩包。
9.  **分发**: 将生成的恶意 RAR 压缩包发送给目标用户，并诱骗其解压。当目标用户使用受影响的 WinRAR 版本解压此压缩包时，恶意载荷将被释放到其启动目录，从而实现任意代码执行。

### 投毒风险分析
在对CVE-2025-8088的POC工具进行投毒风险评估时，我们着重分析该工具代码本身是否包含超出其宣称功能之外的恶意行为。经过对`exploit_core.py`和`README.md`的详细审查，我们得出结论，该POC工具的投毒风险为**低（10%）**。

首先，**代码的透明度和清晰度**是评估低风险的重要因素。`exploit_core.py`的实现逻辑直接且易于理解。它明确展示了如何查找WinRAR可执行文件、如何通过`subprocess.run`调用外部命令进行文件压缩、以及如何使用Python的`struct`、`zlib`等标准库进行RAR5文件头的二进制级别操作。代码中没有发现任何形式的混淆、加密或不透明的二进制模块，这使得安全研究人员能够完全审查其内部工作机制，确认其行为与描述一致。

其次，**外部依赖和网络行为**是关键的风险指标。该工具明确列出了其依赖项：Python 3.8+、`PyQt6`库以及系统中的`WinRAR CLI (rar.exe)`。`PyQt6`是一个广受信任的图形界面开发库，不包含恶意功能。`rar.exe`是WinRAR官方提供的命令行工具，工具对其的调用是其核心功能的一部分，并非隐蔽地利用系统漏洞或执行恶意命令。在代码中，我们没有发现任何可疑的网络通信模块，例如向外部服务器发送数据、下载额外载荷或执行C2（命令与控制）操作。所有的文件操作都限制在本地文件系统内，且主要集中在创建和修改目标RAR文件及其临时组件上。

再者，**系统权限和未经授权的行为**方面，该工具的操作均在用户运行脚本的上下文权限下进行。它会创建临时文件和目录，最终生成一个恶意RAR文件，这些都是其实现漏洞利用所必需的步骤。代码中没有迹象表明其尝试提升自身权限、修改系统关键配置（如注册表关键项）或安装驱动程序等超出正常应用程序范围的特权操作。其目的非常集中，就是构造一个恶意的压缩包，而非在执行时对研究人员的系统本身造成损害。

最后，`README.md`中的**免责声明和用途说明**强调了该工具仅用于“教育目的”和“授权安全测试”。虽然免责声明本身并不能完全保证工具的安全性，但结合代码的实际行为，可以验证开发者的意图与公开声明相符。该工具旨在成为一个用于安全研究和渗透测试的实用工具，而不是一个隐藏了后门或信息窃取功能的恶意软件。

综上所述，尽管此POC工具能够生成具有高度危害的恶意压缩包，但工具**自身**的代码是透明、可审计且专注于实现其宣称的漏洞利用功能，不包含额外的、隐藏的恶意功能或代码混淆。因此，对于在受控、沙箱环境中进行安全研究的专业人员而言，运行该POC工具的投毒风险较低。然而，任何执行第三方代码的行为都应保持谨慎，建议在隔离环境中进行测试。

**项目地址:** 

**漏洞详情:** 
