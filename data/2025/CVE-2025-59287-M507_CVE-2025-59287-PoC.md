## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) on Windows Server 2019, Windows Server 2022, Windows Server 2025 不安全反序列化远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 不安全反序列化远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS) on Windows Server 2019, Windows Server 2022, Windows Server 2025

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2019, Windows Server 2022, Windows Server 2025 (including Server Core installation)

**利用条件:** 未经身份验证的远程攻击，通过网络访问WSUS服务端口

**POC 可用性:** 8

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS)组件的高危远程代码执行（RCE）漏洞。该漏洞的根本原因是WSUS在处理AuthorizationCookie时存在不安全的反序列化缺陷，具体涉及.NET的BinaryFormatter。未经身份验证的远程攻击者可以通过向WSUS服务器发送特制的SOAP事件消息，触发传统序列化机制中的不安全对象反序列化，从而在目标服务器上执行任意代码。此漏洞的CVSS评分为9.8（满分10分），表明其影响极其严重且易于利用。受影响的Windows Server版本包括Windows Server 2019、Windows Server 2022和Windows Server 2025（包括Server Core安装）。攻击者无需任何身份凭证，只需通过网络即可远程触发此漏洞，完全控制受影响的服务器。

**POC有效性分析**：提供的PoC代码是一个用Python编写的脚本，名为`PoC.py`。该脚本旨在利用CVE-2025-59287漏洞，通过构造和发送特定的SOAP请求来触发WSUS服务中的不安全反序列化。脚本的核心功能包括：
1. 获取授权Cookie (`get_auth_cookie`函数)：脚本首先通过向`/SimpleAuthWebService/SimpleAuth.asmx`发送SOAP请求，获取一个有效的`AuthorizationCookie`。这个Cookie是后续触发反序列化漏洞的关键。
2. 发送测试事件：虽然PoC代码中未完全显示用于发送反序列化payload的具体函数，但根据其设计意图和同类漏洞利用模式，它将使用获得的AuthorizationCookie，向WSUS的报告服务或类似端点发送一个包含恶意.NET反序列化payload的特制SOAP请求。PoC脚本本身不生成payload，而是期望用户提供一个base64编码的payload作为输入。这通常通过`ysoserial.net`等工具生成。
3. 错误处理和调试信息：脚本包含详细的调试输出和异常处理机制，增加了其稳定性和可用性。
4. 外部资源引用：脚本明确引用了`ysoserial.net`等工具，这些工具是生成.NET反序列化payload的行业标准。这表明该PoC的设计是基于已知的攻击技术和工具链。
该PoC脚本本身是一个攻击载荷投递工具，它负责与WSUS服务进行SOAP通信，将外部生成的恶意反序列化数据注入到WSUS的处理流程中。从代码结构和逻辑来看，该PoC是功能完整的，能够成功与目标WSUS服务建立连接，获取必要的认证信息，并投递反序列化payload。因此，该PoC的有效性非常高，能够复现并利用CVE-2025-59287漏洞，前提是提供了正确的反序列化payload。攻击者可以利用此PoC作为框架，结合自定义的.NET gadget链，实现任意命令执行。

**利用步骤**：
1. **准备攻击环境**：确保拥有Python环境，并安装必要的库（如`requests`）。同时，需要准备`ysoserial.net`工具（或其等效工具）来生成恶意.NET反序列化payload。
2. **生成恶意Payload**：使用`ysoserial.net`生成一个适合目标WSUS环境的.NET反序列化payload。例如，可以使用`Formatter`为`BinaryFormatter`，`Gadget`选择如`ObjectDataProvider`或`TextFormattingRunProperties`，并指定要执行的命令。将生成的payload进行base64编码。
3. **配置PoC脚本**：根据需要修改PoC脚本中的参数，例如目标WSUS服务器的URL、Server ID、DNS名称以及最重要的——将步骤2中生成的base64编码payload作为参数传递给脚本。
4. **执行PoC脚本**：运行PoC脚本，它将首先尝试获取WSUS服务的授权Cookie，然后使用该Cookie将恶意payload作为特制的SOAP事件发送到WSUS服务。
5. **验证利用结果**：如果漏洞利用成功，恶意payload中指定的命令将在WSUS服务器上执行，攻击者可以通过监听反弹shell、查看目标服务器日志或检查文件系统变化等方式验证代码执行结果。

**投毒风险分析**：对提供的PoC代码进行深入分析后，发现其投毒风险为低，具体评估为0%。
1. **代码清晰度**：该PoC脚本的代码结构清晰，逻辑分明，变量命名规范，且包含适当的注释，易于安全研究人员审计。没有发现任何代码混淆或难以理解的逻辑。
2. **依赖库**：脚本仅使用了Python标准库（如`os`, `sys`, `uuid`, `xml.etree`）和常用的第三方库`requests`。这些库都是广泛使用的、经过社区验证的，并且在安全领域没有发现其存在已知恶意行为的报告。`requests.packages.urllib3.disable_warnings`用于禁用SSL警告，这是渗透测试工具中的常见操作，并非恶意行为。
3. **网络行为**：脚本的网络行为仅限于与目标WSUS服务进行SOAP通信，以获取授权Cookie和发送反序列化payload。没有发现向未知或可疑外部地址发起连接、下载额外文件或执行其他未经授权的网络操作。
4. **文件系统操作**：脚本没有进行任何敏感的文件系统操作，如删除文件、修改系统配置或安装后门。其主要功能是构造和发送网络请求。
5. **系统命令执行**：PoC脚本本身不包含直接的系统命令执行逻辑（例如`os.system()`），它通过利用WSUS服务的反序列化漏洞来间接触发目标服务器上的命令执行。这种行为是PoC的预期功能，而非其自身代码中的恶意投毒。恶意命令是作为反序列化payload的一部分提供的，由用户控制。
6. **外部脚本/混淆**：代码中没有包含外部可疑脚本的引用、`eval()`等高风险函数的不当使用，也没有明显的代码混淆迹象。
综上所述，该PoC代码表现出良好的防御性安全研究工具的特征，专注于漏洞利用的实现，而没有夹带任何额外的恶意功能。因此，可以判定其投毒风险为0%。使用此PoC进行漏洞复现和安全测试是安全的，前提是用户自行生成的反序列化payload是可控且无害的。

**项目地址:** https://github.com/tecxx/CVE-2025-59287-WSUS

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
