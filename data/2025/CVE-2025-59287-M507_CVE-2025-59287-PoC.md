## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 反序列化漏洞

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 反序列化漏洞

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Microsoft Windows Server Update Services (WSUS) on supported Windows Server versions

**利用条件:** 无需认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

The provided Python script serves as a Proof-of-Concept (POC) for CVE-2025-59287, a critical Remote Code Execution (RCE) vulnerability impacting Microsoft Windows Server Update Services (WSUS). This vulnerability stems from a deserialization flaw within the WSUS service, which, if exploited successfully, grants an attacker the ability to execute arbitrary code on the compromised server. WSUS is a pivotal component in enterprise IT infrastructures, responsible for managing and distributing essential updates to Windows clients. Consequently, an RCE vulnerability in such a central service poses a severe threat, potentially allowing an attacker to gain control over the WSUS server and use it as a pivot point for broader network infiltration.

The Python 3 POC script is well-structured, utilizing standard libraries such as `requests` for crafting and transmitting HTTP/SOAP requests, and `xml.etree.ElementTree` for parsing XML responses. A key function, `get_auth_cookie`, is designed to acquire an authorization cookie from the WSUS server's `/SimpleAuthWebService/SimpleAuth.asmx` endpoint. While its name suggests authentication, the script's internal comments and external references to "UNAUTH" (unauthenticated exploitation) indicate that this step likely does not require pre-existing credentials, enabling an unauthenticated attacker to initiate the exploitation process. The `clientId` and `dnsName` parameters within the SOAP request are standard elements for client identification in WSUS communications.

The POC's explanatory comments and external citations are vital for understanding its underlying methodology. It credits `hawktrace.com/blog/CVE-2025-59287-UNAUTH` as the original source for the exploit concept and lists additional resources including `github.com/tecxx/CVE-2025-59287-WSUS` and `github.com/pwntester/ysoserial.net`. The explicit mention of `ysoserial.net` is significant, as it is a widely recognized tool for generating malicious .NET deserialization payloads. This strongly implies that the RCE is achieved by embedding a specially crafted serialized object within a WSUS SOAP request. Upon the WSUS server's attempt to deserialize this object, the embedded malicious code is executed.

The script incorporates debug logging, utilizing a `_print` function with a `[DEBUG]` prefix, which enhances its utility for security researchers by providing detailed execution insights. The deliberate disabling of SSL warnings (`requests.packages.urllib3.disable_warnings`) is a common practice in penetration testing tools, particularly when dealing with self-signed certificates in test environments, and does not signify malicious intent within the POC itself.

CVE-2025-59287 carries a high severity rating, with search results indicating a CVSS score of up to 9.8 (Critical). Microsoft's issuance of an "emergency out-of-band update" further underscores the criticality and urgency of applying patches. Moreover, several search results (e.g., Result 3, 6) explicitly confirm that this vulnerability is "actively exploited" in the wild, with reports of the ShadowPad malware being distributed through this attack vector. This corroborates the practical effectiveness and real-world impact of the vulnerability, making a functional POC invaluable for defensive security operations.

**利用步骤:**
1.  **目标识别**: 确定网络中运行的Microsoft Windows Server Update Services (WSUS) 服务器。
2.  **获取会话Cookie**: 运行POC脚本的`get_auth_cookie`函数，向目标WSUS服务器的`/SimpleAuthWebService/SimpleAuth.asmx`接口发送SOAP请求，以获取一个授权Cookie。此步骤通常无需预先认证。
3.  **构造恶意Payload**: 利用`ysoserial.net`等工具生成一个恶意的.NET反序列化Payload，其中包含要在WSUS服务器上执行的命令（如反弹Shell或系统命令）。
4.  **注入并触发RCE**: 将恶意Payload嵌入到精心构造的SOAP请求中，并将其发送到WSUS服务器的相应服务接口。当服务器尝试反序列化此请求时，Payload中的恶意代码将被执行。
5.  **验证RCE**: 攻击者通过接收反向Shell或监测目标系统变化来验证代码执行是否成功，并进行后续渗透。

**投毒风险分析:**
基于对POC代码片段的细致审查，该Python脚本的投毒风险被评定为**低（10%）**。

1.  **代码透明度**: 脚本的编码风格清晰，结构化良好，易于理解和审计。未发现任何代码混淆技术（如Base64编码、Hex编码或复杂位运算），恶意代码难以在不被察觉的情况下隐藏其中。
2.  **依赖库**: POC仅依赖Python标准库和广泛使用的`requests`库。这些库均经过严格审查，无已知高危漏洞。未引入任何非标准或可疑的第三方依赖，降低了供应链投毒的风险。
3.  **网络行为**: 脚本的网络通信行为透明且目标明确，仅与WSUS服务器的特定SOAP接口进行交互。没有证据表明脚本尝试连接外部可疑IP、C2服务器、下载额外组件或窃取敏感数据。所有的SOAP请求内容在代码中均可见。
4.  **系统操作**: 提供的代码片段中不包含直接执行系统命令（如`os.system`, `subprocess`）或异常文件系统操作。尽管RCE的最终目标是执行命令，但POC本身专注于漏洞利用机制，而非携带和执行恶意载荷。恶意Payload的生成通常由攻击者独立完成，而非硬编码在POC中。
5.  **外部引用**: 代码注释中提及的外部GitHub仓库和安全博客链接，均为漏洞分析或POC相关研究，属于防御性安全研究的正常实践，不构成投毒风险。
6.  **SSL警告**: 禁用SSL警告（`disable_warnings`）是渗透测试工具的常见配置，用于处理自签名证书，并非恶意行为的指示。

**结论**: 综合来看，该POC代码表现出高度的透明度和专业性，其目的是验证漏洞的存在和可利用性，而非包含或传播恶意载荷。因此，将其用于合法的防御性安全测试或漏洞复现是安全的，不会引入额外的恶意软件或后门。

**项目地址:** https://github.com/tecxx/CVE-2025-59287-WSUS

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
