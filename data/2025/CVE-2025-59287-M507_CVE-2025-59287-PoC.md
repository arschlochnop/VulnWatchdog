## CVE-2025-59287 - Windows Server Update Services (WSUS), Microsoft Windows Server 远程代码执行(RCE), 不安全反序列化(Insecure Deserialization)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行(RCE), 不安全反序列化(Insecure Deserialization)

**影响应用:** Windows Server Update Services (WSUS), Microsoft Windows Server

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 无需认证, 远程网络访问, 攻击复杂度低

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-59287是一个针对微软Windows Server Update Services (WSUS)组件的高危远程代码执行(RCE)漏洞。该漏洞的根本原因是服务端存在不安全的反序列化设计缺陷，尤其是在处理特定SOAP请求中的AuthorizationCookie时，WSUS使用了.NET的BinaryFormatter进行反序列化，而BinaryFormatter已知存在反序列化不安全问题，允许攻击者通过精心构造的序列化数据执行任意代码。该漏洞被赋予CVSS 9.8分（满分10分）的严重评级，其利用条件极为宽松，攻击者无需获取任何身份凭证，即可通过网络远程触发漏洞，实现对目标服务器的完全控制。受影响的Windows Server版本包括Windows Server 2025、Windows Server 2022和Windows Server 2019，这使得该漏洞影响范围广泛且具有极高的潜在危害。

**POC有效性分析:**
提供的PoC代码`PoC.py`是一个功能完整的Python脚本，旨在利用CVE-2025-59287。该脚本通过模拟WSUS客户端与服务器的SOAP通信，分多个阶段实现漏洞利用。首先，脚本向目标WSUS服务器的`/SimpleAuthWebService/SimpleAuth.asmx`端点发送SOAP请求，调用`GetAuthorizationCookie`方法，以获取一个有效的认证Cookie。这一步骤是未经认证的，通过提供`clientId`和`dnsName`即可完成。其次，PoC代码本身不包含生成.NET反序列化payload的功能，而是依赖于外部工具`ysoserial.net`。用户需要预先安装`ysoserial.net`，并通过命令行参数指定其路径。`ysoserial.net`将根据指定的gadget和要执行的命令生成二进制序列化数据。最后，PoC将生成的`ysoserial.net` payload嵌入到一个特制的SOAP请求中，模拟一个`BinaryFormatException`。该请求发送至WSUS的`/ClientWebService/ClientWebService.asmx`端点。WSUS在处理这个包含恶意payload的请求时，会尝试反序列化其中的数据，从而触发payload中预设的命令执行。该PoC结构清晰，模块化程度高，包含了调试输出和错误处理，表明其经过精心设计和测试。它的有效性高度依赖于`ysoserial.net`生成正确且适用于目标环境的payload，但在网络通信层面，该PoC完整地实现了攻击链。因此，它是一个功能强大且高度可用的漏洞利用工具。

**利用步骤:**
攻击者可以使用此PoC执行以下步骤来利用CVE-2025-59287：
1.  **准备环境**: 确保安装Python 3和必要的依赖库（例如`requests`）。同时，下载并配置`ysoserial.net`工具，该工具用于生成.NET反序列化payload，并记录其可执行文件的路径。
2.  **生成Payload**: 使用`ysoserial.net`工具，选择一个合适的gadget（例如`ActivitySurrogateSelectorFromFile`或`ObjectDataProvider`）和要执行的命令（例如反弹shell或添加用户），生成序列化后的二进制payload。
3.  **运行PoC**: 执行`PoC.py`脚本，通过命令行参数指定目标WSUS服务器的URL、`ysoserial.net`工具的路径以及生成的payload所要执行的命令。例如：`python3 PoC.py --target https://[WSUS_SERVER_IP]:8531 --cmd "[PAYLOAD_COMMAND_HERE]" --ysoserial-path /path/to/ysoserial.net.exe`。如果payload是文件，则可以使用`--payload-file`参数。请确保WSUS服务在8531（HTTPS）或80（HTTP）端口运行。
4.  **接收结果**: 如果攻击成功，目标WSUS服务器将执行指定命令。攻击者可能获得反弹shell，在服务器上创建新的用户账户，或者执行其他任意操作，从而实现对服务器的完全控制。

**投毒风险分析:**
对`PoC.py`代码进行仔细审查后，评估其投毒风险为低，定为10%。这一评估基于对代码结构、依赖项、网络行为及文件系统操作的综合分析：
1.  **代码清晰度与可读性**: 脚本的整体逻辑结构清晰，函数和变量命名规范，具备良好的注释，使得代码易于阅读和理解。没有发现任何形式的代码混淆、加密或反调试技术，这大大降低了恶意代码被隐藏的可能性。所有关键步骤，如获取认证Cookie、发送测试事件以及最终的漏洞利用请求，都以直接明了的方式实现。
2.  **标准库与第三方库依赖**: 脚本主要依赖于Python的标准库（如`os`, `sys`, `uuid`, `xml.etree`, `datetime`）以及一个广泛使用的第三方库`requests`。这些库在Python生态系统中是合法且常用的，它们在PoC中的使用方式也符合其正常功能，例如`requests`用于发送HTTP/SOAP请求，`xml.etree`用于XML解析和构造。`urllib3`的警告禁用（`requests.packages.urllib3.disable_warnings`）是出于便利性考虑，允许测试HTTPS但证书无效的目标，而非恶意行为。这在漏洞利用脚本中属于常见实践。
3.  **外部工具交互**: `PoC.py`利用`subprocess.check_output`来调用外部工具`ysoserial.net`以生成反序列化payload。`ysoserial.net`本身是一个已知的、用于生成恶意.NET序列化数据的安全工具。`PoC.py`只是将其作为一种功能性依赖，负责执行它并获取其输出作为攻击的一部分。这种交互是受控且透明的：`ysoserial.net`的路径必须由用户通过命令行参数`--ysoserial-path`明确指定，并且生成的payload也直接用于漏洞利用，没有迹象表明PoC会在调用`ysoserial.net`的过程中进行额外的恶意操作，或者篡改`ysoserial.net`的输出。
4.  **网络与文件系统操作**: 脚本进行的网络请求都明确指向目标WSUS服务器的已知服务端口和路径，如`/SimpleAuthWebService/SimpleAuth.asmx`和`/ClientWebService/ClientWebService.asmx`。这些请求是漏洞利用过程的组成部分，没有观察到与外部C2服务器通信、数据泄露或恶意下载相关的可疑网络流量模式。在文件系统操作方面，`os`模块主要用于检查`ysoserial.net`的路径是否存在，没有发现对用户系统进行未经授权的文件读写、创建持久化机制或部署额外恶意文件的行为。
5.  **无隐藏恶意负载**: 脚本的核心目的是演示和执行CVE-2025-59287漏洞，其“恶意”部分是攻击者通过`--cmd`参数或`--payload-file`参数提供的，由`ysoserial.net`生成并最终在目标服务器上执行的命令。`PoC.py`自身不包含任何预设的、隐蔽的恶意payload，也没有尝试植入后门、进行加密勒索或任何其他超出漏洞利用范围的有害行为。综上所述，`PoC.py`是一个专注于漏洞利用的工具，其代码透明、可审计，不具备额外的投毒风险。在使用时，用户需要警惕的是其作为利用工具的强大功能，以及在使用`ysoserial.net`时所提供的具体命令内容，而非PoC脚本本身的恶意性。

**项目地址:** https://github.com/tecxx/CVE-2025-59287-WSUS

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
