## CVE-2025-47812 - Wing FTP Server 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-47812

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Wing FTP Server

**危害等级:** 高危

**CVSS评分:** None

**影响版本:** 7.4.4 之前的版本

**利用条件:** 无需认证的远程代码执行，需要网络访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析:
该POC是一个用Python编写的完整利用脚本，旨在针对Wing FTP Server版本7.4.4之前的关键远程代码执行漏洞（CVE-2025-47812）进行攻击。漏洞的核心在于服务器在处理用户登录时对`username`参数中的空字节（`%00`）处理不当。攻击者可以通过在`username`中注入空字节，随后拼接精心构造的Lua代码，从而在服务器的会话文件中写入并执行任意命令。此脚本通过以下步骤实现了这一攻击链：
1.  **参数解析**：脚本使用`argparse`模块，接受目标URL (`-u`) 和要执行的系统命令 (`-c`) 作为强制参数，以及可选的用户名 (`-U`) 和密码 (`-p`)，默认设置为匿名用户，符合未经认证的攻击条件。
2.  **Lua Payload构造**：脚本将用户提供的系统命令封装成Lua代码片段：`local h = io.popen("your_command") local r = h:read("*a") h:close() print(r)`。这段Lua代码的作用是在目标系统上执行指定命令，读取其标准输出，然后关闭进程句柄，并将输出打印出来。
3.  **空字节注入**：构造的Lua payload被巧妙地嵌入到`username`参数中，通过URL编码的空字节`%00`进行分隔，形成`username=anonymous%00]]%0d<Lua_code>%0d--&password=`的格式。`]]%0d`用于结束前面的Lua字符串，`%0d--`用于注释掉后续的合法参数，确保Lua代码能够被正确解析和执行。
4.  **初始认证请求**：脚本向目标的`/loginok.html`路径发送一个POST请求，请求体中包含注入了Lua代码的`username`参数。尽管请求发送到登录成功页面，但其目的是利用登录过程中的参数处理缺陷。
5.  **会话UID提取**：服务器响应后，脚本从`Set-Cookie`头中提取会话ID（`UID`），这是后续触发Lua代码执行的关键。
6.  **触发RCE**：脚本随后使用提取到的`UID`，向目标的`/dir.html`路径发送一个GET请求。根据漏洞原理，访问任何需要认证的终端节点（如`/dir.html`）会触发服务器加载并执行之前注入到会话文件中的Lua代码，从而在目标系统上以`SYSTEM`（Windows）或`root`（Linux/macOS）权限执行任意命令。
7.  **结果解析**：脚本会尝试从服务器的响应中解析并打印出命令的执行结果。
该POC脚本逻辑清晰，代码实现细节（如HTTP头伪造、URL编码、正则表达式提取UID等）完善，且完全符合漏洞描述，因此具有高度的有效性和可用性。它通过自动化完整的攻击链，成功展示了该漏洞的严重性和可利用性。

利用步骤:
1.  **环境准备**：
    *   确保攻击者机器上安装了Python 3。
    *   安装POC脚本所需的Python库：`pip install requests termcolor pwntools`。
2.  **获取POC脚本**：将提供的Python脚本保存到本地文件，例如`CVE-2025-47812.py`。
3.  **确定目标**：识别运行Wing FTP Server且版本低于7.4.4的目标系统IP地址和端口（例如`http://target_ip:port`）。
4.  **选择攻击命令**：确定要在目标系统上执行的任意操作系统命令。例如，在Linux上可以是`id`、`whoami`、`cat /etc/passwd`；在Windows上可以是`whoami`、`ipconfig`、`dir C:\`。
5.  **执行POC**：在命令行中运行POC脚本，提供目标URL和要执行的命令。
    *   **示例 (Linux命令)**：`python3 CVE-2025-47812.py -u http://192.168.1.100:21 -c "id"`
    *   **示例 (Windows命令)**：`python3 CVE-2025-47812.py -u http://192.168.1.101:21 -c "whoami"`
    *   脚本将显示请求过程和命令执行结果。
6.  **结果验证**：脚本执行成功后，会在控制台输出目标系统上命令的执行结果。如果命令执行失败或未返回预期结果，可能需要检查目标URL、端口或命令本身的正确性。

投毒风险分析:
对提供的POC脚本进行综合分析后，其投毒风险评估为低，具体百分比设定为10%。这个评估是基于以下几个关键因素：
1.  **代码透明度与可读性**：脚本完全用Python编写，代码结构清晰，逻辑分明，没有使用任何形式的代码混淆或加密技术。这使得安全研究人员可以轻松地审查代码的每一行，理解其功能和行为。
2.  **标准库和知名第三方库的使用**：脚本主要依赖于Python的标准库（如`sys`, `argparse`, `re`, `urllib.parse`, `signal`）以及在安全社区中广泛使用的、信誉良好的第三方库（`requests`用于HTTP通信，`termcolor`用于彩色输出，`pwntools`用于渗透测试辅助功能）。这些库本身是经过大量审查和测试的，不大可能包含恶意后门。
3.  **行为的专一性**：该POC脚本的行为是高度专一的，其唯一目的是利用Wing FTP Server的特定漏洞来实现远程代码执行。脚本的所有网络通信都定向到用户指定的受害者服务器，没有发现任何向第三方未知服务器发送数据、建立隐蔽通信通道、下载额外恶意负载、修改本地系统文件或创建后门账户的代码逻辑。
4.  **Payload的性质**：脚本中所谓的“恶意”部分是其生成的Lua命令执行payload。这个payload是针对目标服务器设计的，目的在于在目标系统上执行任意命令，而并非在运行POC的攻击者机器上执行。POC脚本本身充当一个“投递机制”，而不是一个感染源。
5.  **无持久化机制**：脚本不包含任何在攻击者机器上实现持久化的机制。它是一个一次性执行的工具，执行完毕后不会留下任何痕迹或改变本地系统状态。
综上所述，虽然任何从外部获取的代码都应保持警惕并进行审查，但该POC脚本在设计和实现上都体现了防御性安全研究工具的典型特征，不包含额外的恶意投毒代码或行为，因此其作为恶意投毒源的风险极低。10%的风险评分代表了对所有外部代码的普遍警惕性，而非基于发现的具体恶意行为。

**项目地址:** None

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-47812
