## CVE-2025-55182 - React Server Components (RSC), Next.js, Shopify Hydrogen, Gatsby 5, react-server-dom-we, Dify 1.10.0 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components (RSC), Next.js, Shopify Hydrogen, Gatsby 5, react-server-dom-we, Dify 1.10.0

**危害等级:** 高危 (核弹级漏洞)

**CVSS评分:** 

**影响版本:** React Server Components, Next.js (所有使用受影响Flight协议的版本), Dify 1.10.0及可能更早版本

**利用条件:** 无需认证, 需要网络访问, 攻击者构造恶意 multipart 表单

**POC 可用性:** 4

**POC 类型:** 概念验证 (环境检测)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-55182 是一个在 React Server Components (RSC) 中发现的高危远程代码执行 (RCE) 漏洞，也被称作 React2Shell。该漏洞的核心问题在于 React Flight 反序列化机制在处理用户输入的JSON-like流式数据时，未能正确校验对象属性访问路径，例如 `__proto__` 或 `constructor`。这导致攻击者可以利用原型链污染（Prototype Pollution）技术。攻击者通过精心构造恶意的 multipart 表单，利用 `$B` 引用结合可控的 `_response._prefix` 和被劫持为 `Function` 类型的 `_formData.get`，动态生成包含任意系统命令的函数。随后，这些恶意函数被赋值给对象的 `.then` 属性，当该对象在反序列化过程中被处理时，其 `.then` 属性会被触发执行，最终导致服务器端任意代码执行。此漏洞严重影响了广泛采用 RSC 架构的框架和应用，包括 Next.js、Shopify Hydrogen、Gatsby 5 等，以及特定版本的 Dify (如 Dify 1.10.0)。该漏洞已于2025年12月3日公开披露，并迅速遭到大规模的实际利用，对相关系统构成严重威胁。

**POC有效性分析：**
提供的 POC 代码名为 `RSC-Detect`，其主要目的是作为一个轻量级的检测工具，用于识别目标网站是否使用了 React Server Components (RSC) 和 Next.js 框架。它通过检查 HTTP 响应中的特定标记（如 `__flight__`, `react-server-streaming`, `__REACT_SERVER_APP__`）、内容类型（如 `text/x-component`, `text/vnd.rsc`, `application/x-react-server-component`）、Next.js 相关的 HTML 模式（如 `__NEXT_DATA__`, `/_next/static/`, `next-font`）以及 `x-powered-by: next.js` 头部信息来判断目标技术栈。因此，严格来说，此 POC 代码并非一个直接利用 CVE-2025-55182 进行 RCE 的完整利用工具，而是用于前期侦察和目标识别。它能有效地验证目标环境是否具备该漏洞的先决条件，即是否采用了受影响的 RSC/Next.js 技术栈。该代码结构清晰，依赖项极少（仅 `requests` 库），易于理解和审计，对于安全研究人员和漏洞赏金猎人来说，是一个高质量且实用的目标指纹识别工具，能够帮助缩小潜在受害者范围，为后续的漏洞利用工作提供基础。但它本身不能触发RCE，因此作为RCE的POC，其利用能力评分较低。

**利用步骤 (基于CVE信息与搜索结果的RCE利用步骤，而非提供POC的利用)：**
1.  **识别目标：** 利用工具（如提供的 `RSC-Detect` 或手动分析）识别使用 React Server Components (RSC) 和 Next.js 等受影响框架的网站。
2.  **构造恶意请求：** 攻击者需要分析目标应用的通信协议，特别是 React Flight 协议的数据结构，以构造一个精心制作的 `multipart/form-data` 请求。该请求应包含特制的 JSON-like 流式数据，利用 React Flight 反序列化机制的缺陷。
3.  **原型链污染：** 在构造的请求中，攻击者会利用 `__proto__` 或 `constructor` 等特殊属性路径，对目标对象的原型进行污染。这通常涉及劫持对象的某些属性，例如将一个用于数据获取的属性（如 `_formData.get`）劫持为 `Function` 类型。
4.  **注入代码：** 结合 `$B` 引用和可控的 `_response._prefix`，攻击者动态生成包含任意系统命令的 JavaScript 函数字符串，并将其作为有效载荷。
5.  **触发执行：** 将包含恶意函数的字符串赋值给目标对象的 `.then` 属性。当服务器端在反序列化过程中处理到这个被污染的对象时，由于其 `.then` 属性已被恶意函数占据，该函数便会被自动执行，从而实现远程代码执行。

**利用步骤 (提供的POC使用步骤)：**
1.  **环境准备：** 确保系统已安装 Git 和 Python 3.7+。
2.  **克隆仓库：** `git clone https://github.com/fBUZk2BH/RSC-Detect-CVE-2025-55182.git`
3.  **进入目录：** `cd RSC-Detect-CVE-2025-55182`
4.  **安装依赖：** `py -m pip install -r requirements.txt` (仅需安装 `requests` 库)。
5.  **配置目标：** 编辑 `main.py` 文件，在 `targetList` 变量中添加要分析的目标 URL 列表。
6.  **运行检测：** 执行 `py main.py`。脚本将对列表中的每个 URL 进行分析，并输出是否检测到 RSC 或 Next.js 框架的指标。

**投毒风险分析：**
提供的 `RSC-Detect` POC 代码的投毒风险极低。该代码是一个用 Python 编写的简单脚本，其功能仅限于对目标 URL 发送 HTTP GET 请求，并检查响应体、头部和特定 HTML 模式是否存在 React Server Components 或 Next.js 的指纹信息。代码内容完全透明，未发现任何形式的代码混淆。它不包含任何可疑的外部脚本引用、`eval()` 函数调用、恶意文件操作或与系统命令进行非预期交互的行为。依赖库仅为 `requests`，这是一个广泛使用且受信任的 HTTP 客户端库。尽管 GitHub 用户名 `fBUZk2BH` 看起来像是随机生成，但这本身并不能直接指示恶意行为，且代码本身并未表现出任何恶意意图，例如数据窃取、后门植入或对用户系统造成损害。因此，从防御性安全研究的角度评估，此 POC 代码对分析者或执行环境造成“投毒”的风险可以忽略不计。

**项目地址:** https://github.com/fBUZk2BH/RSC-Detect-CVE-2025-55182.git

**漏洞详情:** 
