## CVE-2025-55182 - React Server Components, Next.js, Shopify Hydrogen, Gatsby 5 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components, Next.js, Shopify Hydrogen, Gatsby 5

**危害等级:** 高危，被描述为“核弹级”漏洞

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** React Server Components以及依赖该技术的相关框架，具体受影响版本范围未详细披露，建议关注官方补丁公告。

**利用条件:** 无需认证的远程访问，攻击者可通过精心构造的恶意multipart表单请求进行利用

**POC 可用性:** 9/10

**POC 类型:** 仅说明 (检测工具)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-55182，代号为“React2Shell”，是一个针对React Server Components (RSC) 和Next.js框架的高危远程代码执行漏洞。该漏洞的核心在于React的“Flight”协议反序列化机制中，未能充分校验对象属性的访问路径，尤其是在处理`__proto__`和`constructor`等原型链属性时存在缺陷。攻击者无需认证，即可通过精心构造的恶意multipart表单请求来利用此漏洞。具体利用机制涉及通过`$B`引用，结合对`_response._prefix`的控制以及将`_formData.get`劫持为`Function`类型，从而动态生成包含任意系统命令的函数。随后，该恶意函数会被赋值给目标对象的`.then`属性，并在特定条件下被执行，最终导致服务器端任意代码执行。由于RSC技术已被Next.js、Shopify Hydrogen、Gatsby 5等主流框架广泛采用，且漏洞影响范围广、攻击门槛低，其危害程度被评估为“核弹级”。

**POC有效性分析 (for the provided `RSC-Detect` code):**
提供的POC代码是一个名为`RSC-Detect`的Python脚本，其主要功能是识别网站是否使用了React Server Components (RSC)或Next.js框架。该脚本通过检查HTTP响应中的多个指标来工作，包括：
1.  **RSC标记**: 在响应体中搜索`__flight__`、`react-server-streaming`、`__REACT_SERVER_APP__`等字符串。
2.  **Content-Type**: 检查响应头中的`Content-Type`是否包含`text/x-component`、`text/vnd.rsc`、`application/x-react-server-component`等RSC相关类型。
3.  **Next.js HTML**: 在响应体中搜索`__NEXT_DATA__`、`/_next/static/`、`next-font`、`next/script`等Next.js特有的HTML标记。
4.  **Headers**: 检查响应头中是否存在`x-powered-by: next.js`。
该脚本作为一个**检测工具**，在识别目标网站是否使用RSC或Next.js方面是**有效且准确的**。它通过一次HTTP GET请求即可快速完成目标指纹识别，具有轻量、快速、简单、准确的特点。然而，需要明确指出的是，该`RSC-Detect`脚本**并非CVE-2025-55182远程代码执行漏洞的实际利用POC**。它不包含任何用于构造恶意multipart表单、执行原型链污染或尝试RCE的逻辑。它的作用仅限于**前期的侦察和目标识别**，帮助安全研究人员或攻击者定位潜在的易受攻击系统。因此，对于直接验证CVE-2025-55182的RCE能力而言，此POC的**直接有效性为零**，但作为配套的侦察工具，其**间接辅助有效性很高**。

**利用步骤 (for the actual CVE, not the POC code):**
1.  **识别目标**: 使用类似于提供的`RSC-Detect`工具或其他指纹识别方法，确认目标网站使用了React Server Components (RSC) 或 Next.js 框架。
2.  **构造恶意请求**: 攻击者需要深入理解React Flight协议的反序列化机制和JavaScript原型链的工作原理。精心构造一个恶意的HTTP multipart表单请求，其中包含特定序列化的JSON-like数据。
3.  **原型链污染**: 在序列化数据中，利用RSC反序列化机制对`__proto__`、`constructor`等属性处理不当的漏洞，实现原型链污染，例如劫持关键对象的属性。
4.  **动态代码生成**: 通过控制`_response._prefix`和利用被劫持为`Function`类型的`_formData.get`，在服务器内存中动态生成包含任意系统命令的JavaScript函数。
5.  **触发执行**: 将上述动态生成的恶意函数赋值给目标对象的`.then`属性。在后续的某些操作或React组件生命周期中，当`.then`属性被调用时，服务器端将执行攻击者注入的系统命令，从而实现远程代码执行。

**投毒风险分析:**
对所提供的`RSC-Detect` POC代码进行分析，该脚本的投毒风险评估为**低**。主要基于以下观察：
1.  **代码清晰度**: 脚本使用标准的Python语言编写，代码结构清晰，易于阅读和理解。没有发现明显的混淆、加密或难以理解的复杂逻辑。
2.  **依赖项**: `requirements.txt`文件仅指定了`requests`库，这是一个广泛使用的标准HTTP请求库，本身不含有恶意功能。脚本中也没有引入其他可疑的外部依赖或加载未知模块。
3.  **网络行为**: 脚本的主要网络行为是对目标URL发起GET请求，并检查响应头和响应体。这些行为与其“检测RSC/Next.js”的声明功能完全一致，没有发现任何向第三方IP地址发送数据、下载额外payload或进行其他异常通信的行为。
4.  **文件操作**: 脚本不涉及任何文件创建、修改或删除操作，除了正常的命令行输出。
5.  **危险函数**: 代码中没有使用`eval()`、`exec()`等可能导致任意代码执行的危险函数，也没有执行系统命令的API调用。
综合来看，该`RSC-Detect`工具严格遵循其指纹识别的声明功能，代码透明且行为可预测。作为防御性安全研究，可以放心地使用和分析此代码，它不构成直接的投毒风险。即使有人恶意修改此类检测工具并注入后门，也易于通过代码审计发现。

**项目地址:** https://github.com/fBUZk2BH/RSC-Detect-CVE-2025-55182.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-55182
