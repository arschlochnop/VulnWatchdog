## CVE-2025-14847 - MongoDB 未授权远程堆内存信息泄露 (CWE-130)

**漏洞编号:** CVE-2025-14847

**漏洞类型:** 未授权远程堆内存信息泄露 (CWE-130)

**影响应用:** MongoDB

**危害等级:** 高危

**CVSS评分:** 8.7

**影响版本:** 8.2.0 ≤ MongoDB Server ≤ 8.2.2, 8.0.0 ≤ MongoDB Server ≤ 8.0.x

**利用条件:** 无需认证、远程可利用、默认配置下监听所有网卡

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

MongoDB 堆内存信息泄露漏洞 (CVE-2025-14847)，也被称为 MongoBleed，是一种未经身份验证的远程攻击者可以利用的严重漏洞。该漏洞被归类为 CWE-130（长度参数不一致）类型，其核心问题在于 MongoDB 服务端在处理 Zlib 压缩协议时，对解压缩数据长度的计算存在缺陷。具体来说，在 `message_compressor_zlib.cpp` 文件中，原代码错误地使用了已分配内存的大小（`output.length()`）而非实际解压缩数据的长度来返回，导致攻击者可以通过发送特制的 Zlib 压缩数据包，读取目标服务器堆内存中未初始化的部分，从而泄露敏感数据。该漏洞无需认证即可触发，且MongoDB默认配置下监听所有网卡（0.0.0.0），进一步降低了攻击门槛。受影响版本包括 8.2.0 ≤ MongoDB Server ≤ 8.2.2 和 8.0.0 ≤ MongoDB Server ≤ 8.0.x。

**POC有效性分析**
所提供的 `exploit.py` 是一个功能完整且高质量的利用脚本，旨在利用 CVE-2025-14847 漏洞。该脚本完全由 Python 编写，并利用标准库（如 `socket` 用于网络通信，`struct` 用于二进制数据打包，`zlib` 用于压缩）来构建和发送恶意数据包。其核心逻辑体现在 `prepare_payload` 函数中：首先，它构造一个畸形的 BSON 内容，并将其打包成 `op_msg` 格式。接着，对 `op_msg` 进行 Zlib 压缩。关键的漏洞触发点在于构建 `op_compressed` 消息时，脚本将 `uncompressedSize` 字段（直接对应漏洞根源）设置为一个由用户提供的 `buffer_size`，而非实际解压缩后的数据大小。`compressorId` 被设置为 2，表示使用 Zlib 压缩。最后，将整个恶意 `op_compressed` 消息封装在一个标准的 MongoDB 协议头中，并通过 TCP socket 发送给目标服务器。`exploit.py` 在成功建立连接并发送有效载荷后，会尝试接收并打印从服务器返回的数据，这些数据通常包含泄露的堆内存内容。该脚本通过 `argparse` 模块支持命令行参数，允许用户灵活指定目标主机、端口以及 `doc_length` 和 `buffer_size` 等关键参数。`README.md` 中还提供了使用 `podman-compose` 搭建漏洞环境的详细说明，使得漏洞的复现和测试过程更加可靠和便捷。综合来看，该 POC 的设计和实现都与漏洞原理高度吻合，具有极高的有效性和实用性。

**利用步骤**
1.  **环境准备**：根据 `README.md` 中的指引，使用 `podman-compose vuln-machine/ up -d` 命令启动一个易受攻击的 MongoDB 实例，搭建漏洞复现环境。
2.  **POC 初始化**：在本地利用机器上，为 `exploit.py` 创建并激活一个 Python 虚拟环境：`python3 -m venv venv && source venv/bin/activate`。
3.  **执行利用**：运行 `exploit.py` 脚本，指定目标 MongoDB 服务器的 IP 地址和端口。例如：`python3 exploit.py -H <target_ip> -p <target_port>`。脚本将自动构造并发送恶意压缩数据包到目标服务器。
4.  **数据捕获与分析**：脚本会接收 MongoDB 服务器的响应，并尝试解析和打印泄露的堆内存数据。攻击者需要进一步分析这些输出，以识别其中可能包含的敏感信息，如数据库凭证、API 密钥、会话令牌、连接字符串或其他用户数据。

**投毒风险分析**
对提供的 POC 代码 `exploit.py` 进行全面分析，确认其投毒风险极低。该脚本完全由 Python 编写，并仅依赖于标准库，包括 `sys`、`socket`、`struct`、`zlib`、`re`、`argparse` 和 `time`。代码逻辑清晰透明，专注于构建和发送特定协议的恶意数据包以触发内存泄露，未发现任何可疑行为，例如：
*   代码中没有进行任何外部文件写入操作或执行系统命令（除了 Python 解释器本身的基本操作）。
*   未发现尝试从未知来源下载或执行外部代码的行为。
*   代码中没有使用任何代码混淆、加密或反调试技术，保持了高度可读性。
*   所有的网络通信目标都明确指向用户通过命令行参数指定的主机和端口，脚本不会进行未经授权的端口扫描或连接到其他未知地址。
*   `README.md` 中包含明确的免责声明，指出该工具仅用于测试和学习目的，严禁用于非法活动，进一步表明了其设计初衷是用于合法的安全研究和漏洞验证。
鉴于代码的透明性、其明确的利用目的以及严格遵循标准库的使用，可以确定此 POC 不包含恶意投毒意图。将其用于授权的测试环境中是安全的，其对系统造成的唯一可预见影响是可能触发内存泄露并导致敏感信息可见，而不会植入后门、破坏系统完整性或进行其他未经授权的活动。

**项目地址:** 

**漏洞详情:** 
