## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危: 经验证的低权限用户可提升至管理员权限。

**CVSS评分:** 

**影响版本:** prior to 2.9.1

**利用条件:** 需要认证 (具备低权限用户账号), 需要网络访问。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该CVE-2025-2304漏洞是Camaleon CMS中的一个权限提升漏洞，它通过Mass Assignment机制实现。具体来说，当用户更新个人资料时，`/admin/users/:id/updated_ajax` 端点未能严格过滤 `password` 参数哈希中的敏感属性。攻击者可以利用此漏洞，通过注入 `password[role]=admin` 到 `password` 作用域中，覆盖其自身权限，从而将低权限用户提升为管理员。

**POC有效性分析**
所提供的PoC是一个功能完整的Python脚本，设计精良且高度有效。它利用 `requests.Session` 保持会话状态，确保认证后的操作得以执行。脚本通过解析 `/admin/profile/edit` 页面动态获取 `user[id]` 和 `authenticity_token`，这两个是利用Rails应用中RESTful端点和CSRF保护机制的关键。这种动态发现能力大大提高了PoC的可靠性和通用性。PoC还正确地实现了 `_method=patch` 的HTTP方法模拟，以满足Rails的路由要求，通过POST请求实现PATCH操作。核心攻击逻辑体现在构建一个 `application/x-www-form-urlencoded` 格式的payload，其中包含恶意的 `password[role]=admin` 字段，精准地利用了Mass Assignment漏洞。总体而言，该PoC对漏洞原理理解深刻，自动化程度高，是进行漏洞复现和验证的可靠工具。

**利用步骤**
1.  **环境准备**: 确保系统已安装Python 3.10+，并使用 `pip install -r requirements.txt` 命令安装 `requests` 和 `beautifulsoup4` 库。
2.  **目标系统**: 部署一个受影响的Camaleon CMS实例（版本低于2.9.1）。
3.  **获取凭证**: 准备一个有效的Camaleon CMS低权限用户账号及其密码。
4.  **执行PoC**: 在命令行中运行PoC脚本，提供目标CMS的URL、低权限用户名和密码，例如：`python3 main.py -u http://target.com --user lowuser --password lowpass`。
5.  **认证阶段**: PoC脚本首先会向 `/admin/login` 端点发起POST请求，使用提供的凭证进行身份认证，并建立一个会话。
6.  **信息侦察**: 脚本接着会访问 `/admin/profile/edit` 页面，通过解析其HTML内容，动态提取当前用户的唯一 `user[id]` 和用于后续请求的 `authenticity_token`（CSRF令牌）。
7.  **权限提升**: 脚本随后构造一个 `application/x-www-form-urlencoded` 类型的请求，通过POST方式发送到 `/admin/users/:id/updated_ajax` 端点（其中 `:id` 是上一步获取的用户ID）。此请求的payload中会包含 `_method=patch`（用于模拟PATCH请求）、动态获取的 `authenticity_token`、以及关键的 `password[role]=admin` 注入点。
8.  **验证**: 攻击者可以尝试重新登录，或直接访问管理员专属页面，验证其用户权限是否已成功提升为管理员。

**投毒风险分析**
该PoC的投毒风险评估为低风险 (10%)。根据 `README.md` 的详细说明和 `main.py` 的代码片段，该PoC的意图明确，完全专注于利用Camaleon CMS的Mass Assignment漏洞以实现权限提升。代码结构清晰，易于阅读和理解，没有发现代码混淆、恶意外部依赖、或异常的网络请求行为。它主要依赖于 `requests` (用于HTTP请求) 和 `beautifulsoup4` (用于HTML解析) 等常见且受信赖的Python库。PoC的核心逻辑是模拟用户更新操作，注入特定参数以修改用户角色，没有迹象表明其包含后门、数据窃取功能或任何其他超出漏洞利用范围的恶意载荷。因此，在受控环境中进行审查和测试后，该PoC被认为是相对安全的用于防御性研究和授权渗透测试的工具。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
