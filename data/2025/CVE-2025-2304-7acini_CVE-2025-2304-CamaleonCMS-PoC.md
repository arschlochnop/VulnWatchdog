## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** prior to 2.9.1

**利用条件:** 需要认证(低权限用户), 需要网络访问, 动态获取用户ID和CSRF token

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

### POC有效性分析

该POC针对Camaleon CMS中存在的Mass Assignment漏洞，具体影响版本为2.9.1之前（POC测试版本为2.8.1之前）。此漏洞位于用户管理模块的`/admin/users/:id/updated_ajax`端点，其核心机制是Ruby on Rails框架中Strong Parameters的配置不当。应用程序在处理用户资料更新的AJAX请求时，未能严格过滤`password`参数哈希中的敏感属性。攻击者（作为一名低权限用户）可以利用此缺陷，通过在更新请求的`password`作用域中注入一个`role`属性，将其值设置为`admin`，从而覆盖自己的权限，成功获取管理员身份。

该POC是基于Python编写的，并展现出高度的健壮性和功能完整性。它利用`requests.Session`来维护会话状态，确保在认证和漏洞利用阶段之间的数据一致性。为了满足Rails应用的CSRF保护机制，POC能够自动从DOM中抓取`authenticity_token`并将其同步到`X-CSRF-Token`头部。此外，POC还具备动态发现用户ID的能力，它通过解析`/admin/profile/edit`页面来获取RESTful端点所需的`user[id]`。在HTTP方法模拟方面，POC通过在POST请求中包含`_method=patch`参数，巧妙地满足了Rails对于资源更新通过PATCH方法路由的要求。其清晰的执行流程（认证 -> 信息侦察 -> 权限提升）和详细的Payload结构说明，都表明这是一个设计精良、功能完备且极具操作性的漏洞利用工具。鉴于其对关键利用环节的自动化处理和对Web应用安全机制的有效规避，此POC被判定为高度有效，能够可靠地复现并利用所述的权限提升漏洞。

### 利用步骤

1.  **环境准备**：
    *   确保目标Camaleon CMS的版本处于受影响的范围（例如，`prior to 2.9.1`，POC测试版本为`prior to 2.8.1`）。
    *   安装Python 3.10+及所需的Python库：`requests`和`beautifulsoup4`。可以通过运行`pip install -r requirements.txt`命令来安装。

2.  **执行POC**：
    *   在命令行中，以一个已认证的低权限用户身份运行POC脚本，指定目标URL、用户名和密码：
        `python3 main.py -u <目标CMS的URL> --user <低权限用户名> --password <低权限用户密码>`

3.  **身份认证 (Auth)**：
    *   POC首先会向`/admin/login`端点发送一个POST请求，使用提供的`<低权限用户名>`和`<低权限用户密码>`来建立一个认证会话。

4.  **信息侦察 (Recon)**：
    *   成功登录后，POC会向`/admin/profile/edit`页面发送一个GET请求。通过解析该页面的HTML响应，POC会动态地提取出当前用户的唯一标识符`user[id]`和一个新鲜的`authenticity_token`（用于CSRF保护）。这两个参数是后续权限提升攻击的关键。

5.  **权限提升 (Escalation)**：
    *   POC利用获取到的`user[id]`和`authenticity_token`，向`/admin/users/:id/updated_ajax`端点（其中`:id`是动态获取的用户ID）发送一个精心构造的POST请求。该请求的Payload采用`application/x-www-form-urlencoded`格式，并包含以下关键参数：
        *   `_method=patch`：这是一个Rails路由约定，用于模拟PATCH HTTP方法，指示服务器进行部分更新。
        *   `authenticity_token=[捕获到的CSRF token]`：绕过Rails的CSRF保护。
        *   `password[password]=[任意有效密码]`：尽管不是为了修改密码，但此参数可能用于满足Rails对`password`作用域的验证要求。
        *   `password[role]=admin`：这是恶意注入的核心，它利用Mass Assignment漏洞，将当前用户的`role`属性直接修改为`admin`，从而完成权限提升。

6.  **验证**：
    *   攻击成功后，脚本可能会尝试再次登录或访问管理员特有的功能，以验证用户权限是否已成功升级为管理员。一旦验证成功，攻击者便可利用低权限账户获得完整的CMS管理员控制权。

### 投毒风险分析

该POC代码的投毒风险评估为低，百分比为10%。这一评估基于以下几个关键因素：

1.  **代码透明度与可读性**：POC的`README.md`文件提供了极其详细的技术概述、功能描述、使用说明和攻击流程。代码本身（从提供的片段判断）采用标准Python编写，结构清晰，易于理解和审计。它没有使用任何代码混淆技术，使得其内部逻辑一目了然。

2.  **依赖库的安全性**：POC主要依赖于`requests`和`beautifulsoup4`这两个Python标准库。这些库在Python社区中被广泛使用和维护，拥有良好的安全记录，且均用于其预期目的（`requests`用于HTTP通信，`beautifulsoup4`用于HTML解析）。POC未引入任何非标准、来源不明或具有潜在恶意行为的第三方依赖。

3.  **行为可预测性**：POC的核心功能是自动化执行已知的权限提升攻击步骤，即登录、获取必要信息（用户ID和CSRF token）以及发送包含恶意`role=admin`参数的更新请求。其代码行为与`README.md`中的描述完全一致，没有发现任何超出预期范围的异常行为，例如：未授权的文件操作、反向Shell连接、敏感数据窃取、外部可执行文件下载或执行系统命令等。

4.  **无恶意负载植入**：POC的“恶意”部分在于其利用漏洞将低权限用户的角色更改为`admin`，而不是在目标系统上植入后门程序或恶意代码。`password[role]=admin`是漏洞利用的参数，而非独立运行的恶意程序或代码片段，因此不构成传统意义上的“投毒”。

5.  **明确的道德声明**：`README.md`中包含了清晰的“Ethical Disclosure”部分，明确指出该工具仅用于教育目的和授权的渗透测试，并警告未经授权访问生产系统是违法的。这表明作者的意图是出于安全研究和防御性目的，而非恶意攻击。

综上所述，该POC设计明确，代码透明，依赖安全，行为可控，且具有明确的道德声明。它是一个纯粹用于验证和演示漏洞的工具，不包含任何恶意“投毒”代码或隐藏的恶意功能。因此，在受控和授权的环境下使用该POC，被其自身代码感染或利用的风险极低。

**项目地址:** 

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
