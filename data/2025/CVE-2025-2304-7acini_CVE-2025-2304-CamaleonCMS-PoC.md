## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** 低于 2.9.1 版本

**利用条件:** 需要认证 (低权限用户), 需要网络访问

**POC 可用性:** 10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

这个PoC（Proof of Concept）针对的是Camaleon CMS中的一个权限提升漏洞，CVE-2025-2304。该漏洞的核心是Mass Assignment（批量赋值），发生在User Management模块的`updated_ajax`端点。当一个低权限用户尝试更新其个人资料时，应用程序未能严格过滤`password`参数哈希中包含的敏感属性。攻击者可以利用此缺陷，通过在`password`作用域内注入一个`role`属性，将其自身的用户角色从普通用户提升至管理员（admin）权限。

该PoC是一个功能完备的Python脚本，设计精良，具备高度的自动化能力，能够有效利用此漏洞。其技术实现考虑到了Web应用程序中常见的安全机制，使得利用过程流畅可靠。PoC的核心功能和技术特点包括：
1.  **会话持久性（Session Persistence）**：PoC使用`requests.Session`对象来管理HTTP请求，确保在整个认证和利用过程中，会话状态得以维护。这意味着PoC能够首先登录，然后利用同一个会话执行后续的侦察和攻击步骤，无需在每次请求时重新认证。
2.  **自动化CSRF同步（Automated CSRF Synchronization）**：Ruby on Rails应用程序通常使用CSRF（跨站请求伪造）令牌来防止此类攻击。该PoC能够智能地从Web页面的DOM中抓取`authenticity_token`，并将其同步到后续请求的`X-CSRF-Token`头部或请求体中，从而绕过Rails的CSRF保护机制。这一特性极大地简化了攻击过程。
3.  **动态ID发现（Dynamic ID Discovery）**：为了针对特定用户执行权限提升，PoC需要知道目标用户的ID。它通过解析`/admin/profile/edit`页面来动态地获取当前认证用户的`user[id]`。这种动态获取ID的方式增强了PoC的鲁棒性，使其不必依赖于硬编码的ID。
4.  **HTTP方法仿真（HTTP Method Emulation）**：Rails应用程序通常使用RESTful路由。对于资源更新操作（如PATCH），通常需要发送PATCH请求。然而，有时出于兼容性或其他原因，客户端可能只能发送POST请求。该PoC通过在POST请求体中添加`_method=patch`参数来模拟PATCH方法，满足了应用程序的路由要求，使得通过POST请求也能触发更新逻辑。

整个利用流程分为三个主要阶段：
1.  **认证阶段 (Auth)**：PoC首先向`/admin/login`端点发送一个POST请求，使用提供的用户名和密码进行认证，从而建立一个有效的用户会话。这是后续操作的基础，因为漏洞利用需要一个已认证的低权限用户身份。
2.  **侦察阶段 (Recon)**：认证成功后，PoC会向`/admin/profile/edit`端点发送一个GET请求。通过解析返回的HTML内容，PoC提取当前用户的唯一`user[id]`以及一个新鲜的`authenticity_token`。这些信息是构建权限提升payload的关键组成部分。
3.  **权限提升阶段 (Escalation)**：这是攻击的核心步骤。PoC向`/admin/users/:id/updated_ajax`端点（其中`:id`是动态获取的用户ID）发送一个经过精心构造的PATCH-over-POST请求。该请求的`application/x-www-form-urlencoded`格式的payload结构如下：
    *   `_method=patch`: 指示Rails将此POST请求视为PATCH请求。
    *   `authenticity_token=[Captured]`: 动态捕获的CSRF令牌，用于绕过安全检查。
    *   `password[password]=[NewPassword]`: 这是一个必要的字段，用于满足应用程序对`password`作用域的验证要求，即使不修改密码，也需要提供。
    *   `password[role]=admin`: **这是恶意注入的核心**。通过将`role`属性置于`password`作用域内，利用Mass Assignment漏洞，将当前用户的角色设置为`admin`。

综合来看，该PoC具有极高的有效性和可靠性。它不仅准确地复现了CVE-2025-2304的权限提升机制，而且通过自动化处理CSRF令牌、动态用户ID以及HTTP方法仿真等细节，大大降低了攻击的复杂性，使得即使是技术水平一般的攻击者也能轻松利用此漏洞。因此，该PoC被评为“完整利用”类型，并且在质量上得分很高。

针对此PoC代码的投毒风险评估结果为**低风险（10%）**。这一判断主要基于以下几个方面：

首先，从**代码清晰度和可读性**来看，PoC的`README.md`文件提供了极其详细的技术概述、功能特性、使用说明和利用流程。这些文档使得潜在用户能够充分理解代码的预期行为和实现细节。虽然`main.py`代码本身在输入中被截断，但从其描述和依赖项来看，它是一个标准的Python脚本，利用`requests`库进行HTTP通信，并可能使用`beautifulsoup4`进行HTML解析。这种透明性和对标准库的依赖性，显著降低了代码中隐藏恶意行为的可能性。

其次，**依赖性分析**显示PoC仅依赖于广泛使用的Python标准库和第三方库，如`requests`和`beautifulsoup4`。这些库在Python开发和安全社区中享有极高的声誉，经过了大量的审查和测试，其自身引入恶意代码的风险极低。PoC没有引入任何未知或可疑的外部依赖，也没有包含任何编译好的二进制文件或混淆代码，这些通常是恶意PoC的常见特征。

再次，对**代码行为的预期分析**表明，PoC的所有操作都严格围绕漏洞利用的目标——权限提升。它执行的操作包括：模拟用户登录、抓取页面上的特定信息（如CSRF令牌和用户ID）、以及发送一个精心构造的HTTP请求来修改用户角色。这些行为完全符合一个合法的漏洞PoC的功能范围。没有迹象表明PoC会尝试执行与漏洞利用无关的恶意操作，例如：
*   **网络外联行为**：PoC的HTTP请求目标明确指向用户提供的目标URL，没有发现或提及任何与外部未知IP地址或域名进行通信的行为，例如回连C2服务器。
*   **系统资源滥用**：PoC不涉及文件系统操作（读写除自身所需配置文件外）、系统命令执行（除非漏洞本身是RCE类型，但此漏洞是Mass Assignment），或任何其他可能导致数据泄露、系统破坏或持久化后门的活动。
*   **代码混淆或加密**：PoC的描述没有提及任何代码混淆、加密或动态加载外部脚本的行为，这些都是投毒代码的常见手法。

最后，**作者的道德声明**在PoC的`README.md`中非常明确：“This tool is for educational purposes and authorized penetration testing only. Unauthorized access to production systems is illegal.” 这一声明表明了作者开发此工具的合法意图，并提醒使用者遵守法律法规，进行授权范围内的安全测试。虽然道德声明不能完全排除恶意行为，但在缺乏其他恶意迹象的情况下，它为PoC的低风险评估提供了额外的支持。

综上所述，结合代码特性、依赖项、预期行为以及作者的声明，可以认为该PoC的投毒风险极低。对于进行防御性安全研究的组织而言，在严格遵循最佳实践（如在隔离环境中测试、审查代码、监控网络行为）的前提下，可以相对安全地使用此PoC来验证Camaleon CMS中的权限提升漏洞。

**项目地址:** N/A

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
