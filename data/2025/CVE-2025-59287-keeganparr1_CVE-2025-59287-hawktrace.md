## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 不安全反序列化 / 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 不安全反序列化 / 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8 (CVSSv3.1)

**影响版本:** Windows Server 2012, 2012 R2, 2016, 2019, 2022, 2025

**利用条件:** 无需认证，远程网络访问

**POC 可用性:** 7

**POC 类型:** 概念验证 (PoC)

**攻击复杂度:** 低

**投毒风险:** 10

## 详情

POC有效性分析:
提供的C#代码片段是一个针对CVE-2025-59287漏洞的概念验证（PoC），它清晰地展示了利用Microsoft Windows Server Update Services (WSUS) 中不安全反序列化缺陷的核心机制。该漏洞的根本原因在于WSUS在处理`AuthorizationCookie`时，使用.NET的`BinaryFormatter`进行不安全的序列化和反序列化操作，且缺乏对输入数据的充分验证。攻击者可以构造恶意的序列化数据，并在服务器端反序列化时执行任意代码。

该PoC代码的核心功能是生成一个恶意序列化负载。它首先定义了一个硬编码的16字节十六进制密钥（"877C14E433638145AD21BD0C17393071"），这个密钥很可能与WSUS服务在处理Cookie时使用的加密或签名机制相关。随后，代码包含了一个名为`ysooo`的base64编码字符串，这个字符串是一个典型的Ysoserial.NET工具生成的payload。经过解码，我们可以识别出其利用`System.Collections.Generic.ComparisonComparer` gadget链，并最终通过`System.Diagnostics.Process.Start`方法执行指定的命令。在本PoC中，预设的命令是`cmd /c calc`，即在目标系统上启动计算器程序，这是一个标准且无害的远程代码执行验证方式。

虽然该PoC代码片段并未包含完整的网络通信逻辑（即将生成的恶意`AuthorizationCookie`发送到WSUS服务器的HTTP请求部分），但它成功地演示了如何构造出能够触发远程代码执行的关键恶意数据。一旦这个恶意序列化负载被嵌入到一个合法的HTTP请求的`AuthorizationCookie`中并发送给受影响的WSUS服务器，它就能够绕过认证，在服务器端触发反序列化过程，从而执行攻击者指定的任意代码。因此，该PoC在展示漏洞利用的核心载荷生成方面是高度有效和功能完整的。它为理解和复现该漏洞提供了坚实的基础，是开发完整利用工具的重要组成部分。

利用步骤:
1.  **目标识别与探测**: 攻击者首先通过网络扫描或OSINT（开源情报）技术识别互联网上或内部网络中运行Microsoft Windows Server Update Services (WSUS)的服务器。这些服务器通常开放特定的HTTP/HTTPS端口（如80/443或8530/8531）。
2.  **恶意负载生成**: 攻击者使用类似本PoC中所示的工具（如Ysoserial.NET），并结合WSUS服务所用的特定加密密钥（本PoC中为`877C14E433638145AD21BD0C17393071`），构造一个恶意的.NET序列化对象。这个对象通过精心设计的Gadget链，指示WSUS服务在反序列化时执行预定义的命令。常用的测试命令是启动`calc.exe`，但实际攻击中会替换为用于建立持久性访问（如创建新用户、写入WebShell）或下载并执行恶意Payload（如Meterpreter、PowerCat）的命令。
3.  **构造HTTP请求**: 攻击者将生成的恶意序列化负载进行Base64编码，并将其作为HTTP请求头中`AuthorizationCookie`的值。该Cookie是WSUS用于身份验证和授权的机制，但由于其反序列化过程存在漏洞，无需有效的身份凭证即可触发。
4.  **发送恶意请求**: 攻击者将包含恶意`AuthorizationCookie`的特制HTTP请求发送到目标WSUS服务器的`ClientWebService`或`SimpleAuthWebService`等相关端点。
5.  **服务端反序列化触发**: WSUS服务器接收到请求后，其处理HTTP请求的组件会尝试反序列化`AuthorizationCookie`以验证用户会话。由于`BinaryFormatter`的不安全性，恶意构造的序列化对象在反序列化过程中会被解析，并执行其中包含的恶意代码。
6.  **远程代码执行**: 服务器会在其运行WSUS服务的上下文（通常是`NT AUTHORITY\NETWORK SERVICE`或`SYSTEM`权限）下执行攻击者预设的命令。这可能导致在服务器上弹出计算器、创建新的管理员用户、下载并执行任意二进制文件，或建立一个反向shell。
7.  **权限提升与横向移动**: 一旦获得远程代码执行，攻击者通常会进一步利用此权限进行信息收集、权限提升，并通过横向移动技术渗透到网络的其他部分，例如在搜索结果中提到的利用PowerCat获取系统shell。

投毒风险分析:
针对所提供的PoC代码，其“投毒风险”评估为低（10%）。这种风险评估主要基于以下几个方面的考量：

首先，**代码的透明度和清晰度**。该PoC代码使用C#语言编写，结构清晰，逻辑简单明了，没有发现任何形式的代码混淆。所有的关键操作，如密钥定义和Ysoserial payload的base64编码字符串，都直接呈现在代码中，易于安全研究人员进行审计和理解其功能。

其次，**外部依赖和网络行为**。该PoC代码的运行不依赖于除标准.NET库之外的任何外部资源，也没有在执行过程中发起任何出站网络连接。这意味着它不会尝试从恶意服务器下载额外的组件，也不会向外部发送敏感信息。其核心功能仅限于在本地生成一个特定的字节序列，即恶意的反序列化负载。

第三，**Payload的性质**。PoC代码中包含的Ysoserial payload旨在执行`cmd /c calc`命令。启动计算器是安全研究和渗透测试中验证远程代码执行漏洞最常用且无害的方式。该payload不包含任何持久化机制、后门、恶意软件下载器、凭据窃取功能或加密货币挖矿代码。它纯粹是一个用于证明漏洞存在和可利用性的“烟雾测试”。

**总结**: 尽管CVE-2025-59287是一个高危漏洞，且已被报告积极利用，但本PoC代码本身是“清洁”的。它旨在作为一个合法的安全工具，帮助组织理解和测试其WSUS服务器对该漏洞的防御能力。因此，在受控环境中，按照预期目的使用此PoC代码进行测试不会引入额外的恶意风险。然而，组织仍需警惕的是，真正的攻击者会用更具破坏性的payload替换`calc.exe`命令，以实现对目标系统的全面控制和攻击目标。防御工作的重点应放在及时打补丁和监控WSUS服务的异常行为上，而不是对PoC代码本身过度担忧其“投毒”性质。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
