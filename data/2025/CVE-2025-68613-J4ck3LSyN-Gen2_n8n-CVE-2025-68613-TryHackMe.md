## CVE-2025-68613 - n8n (开源工作流自动化工具) 沙箱逃逸/RCE

**漏洞编号:** CVE-2025-68613

**漏洞类型:** 沙箱逃逸/RCE

**影响应用:** n8n (开源工作流自动化工具)

**危害等级:** 关键 (Critical)

**CVSS评分:** 9.9

**影响版本:** 0.211.0 ≤ n8n < 1.120.4, n8n < 1.121.1, n8n < 1.122.0

**利用条件:** 需要用户认证，具备在工作流中编辑表达式的权限，默认配置即可触发

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞属于n8n表达式引擎中的沙箱逃逸问题。在受影响的版本中，n8n使用沙箱环境来执行用户定义的JavaScript表达式，以确保工作流的安全。然而，研究人员发现可以通过特定的JavaScript原型链污染或直接访问Node.js底层对象（如process.mainModule）的方法绕过沙箱限制。提供的POC代码显示，攻击者可以构造形如'{{ (function(){ return this.process.mainModule.require("child_process").execSync("command").toString() })() }}'的Payload。该Payload通过匿名函数自执行，利用'this'上下文获取对'process'对象的访问权，进而调用'child_process'模块执行任意系统命令。此POC经过验证在靶场环境下可直接读取敏感文件（如flag.txt），具有极高的实用性和成功率。漏洞利用的核心在于n8n未能彻底切断沙箱内代码与Node.js核心全局对象的联系，导致认证用户可以通过合法的功能点实现非法的底层控制。考虑到n8n通常部署在具有高度权限的内网环境，且连接了大量第三方API和数据库，该RCE的影响不仅限于宿主机，更可能导致整个自动化流水线中的凭据泄露。 【利用步骤】1. 登录n8n平台，创建一个新的工作流或在已有工作流中操作。2. 添加一个触发节点，例如'Manual Trigger'（手动触发）。3. 添加一个可以输入表达式的节点，如'Set Fields'（设置字段）或'Edit Image'等支持表达式的节点。4. 在字段的值（Value）部分，点击表达式编辑器，输入Payload：{{ (function(){ return this.process.mainModule.require('child_process').execSync('whoami').toString() })() }}。5. 点击'Execute Node'执行节点。6. 查看执行结果，Payload将返回系统命令执行后的标准输出，确认RCE成功。 【投毒风险分析】在该POC及相关公开信息的分析中，投毒风险处于低至中等水平（约15%）。目前披露的POC主要源自安全社区（如TryHackMe和CSDN）以及各大安全厂商的通告，代码逻辑透明，直接调用Node.js标准内置模块进行演示，未发现隐藏的恶意混淆代码或远程拉取恶意脚本的行为。然而，由于该漏洞的CVSS评分高达9.9，极易吸引攻击者将此类PoC封装进看似无害的'n8n自定义节点'（Custom Nodes）或'工作流模板'（JSON文件）中并在GitHub或n8n社区分享。如果防御者直接导入来源不明的工作流文件，其中嵌入的隐藏表达式可能会在工作流运行或预览时被动触发。分析发现，现有的POC代码虽然清晰，但攻击者可以利用JavaScript的编码特性（如String.fromCharCode或Base64反序列化）来混淆'child_process'等敏感字符，以规避简单的字符串过滤检查。因此，组织在测试POC时，必须在物理隔离的沙箱环境中执行，并警惕任何包含'eval'、'Function'或复杂原型链调用的工作流导入请求。整体来看，代码层面的投毒风险较低，但社会工程学层面的'工作流投毒'是防御重点。

**项目地址:** [https://tryhackme.com/p/J4ck3LSyN](https://tryhackme.com/p/J4ck3LSyN)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-68613](https://nvd.nist.gov/vuln/detail/CVE-2025-68613)
