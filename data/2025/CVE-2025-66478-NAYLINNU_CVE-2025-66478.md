## CVE-2025-66478 - Next.js (App Router) RCE

**漏洞编号:** CVE-2025-66478

**漏洞类型:** RCE

**影响应用:** Next.js (App Router)

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** Next.js < 15.1.1 (App Router 模式)

**利用条件:** 无需认证，远程网络访问，应用程序需启用 Next.js App Router 和 Server Actions/RSC 渲染功能。

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞（亦称为 React2Shell）是由于 Next.js 在处理 React Server Components (RSC) 反序列化时，未能对传入的 JSON 负载进行充分的安全校验。提供的 POC 代码采用了 Nuclei 模板格式，其核心逻辑在于通过构造一个恶意的 `multipart/form-data` 请求，利用 Next-Action 头部触发服务器端的处理逻辑。POC 中通过特定的 JSON 键值对 `{"then":"$1:__proto__:constructor:constructor"}` 尝试对 JavaScript 原型链进行访问。虽然该 POC 并没有包含完整的反弹 Shell 或任意命令执行的代码（即 Payload 本身是不完整的），但它通过观察服务器的特定响应来验证漏洞存在：如果服务器返回 500 错误且响应体中包含 React 运行时特有的错误指纹 `E{"digest"`，则证明反序列化器已成功处理并尝试解析该恶意对象。这种通过错误回显进行探测的方法在实际漏洞扫描中具有极高的准确性和较低的侵入性。由于该漏洞利用的是底层反序列化机制，攻击者可以通过进一步构造复杂的 thenable 对象或利用原型链污染（Prototype Pollution）来操纵 Node.js 运行时的环境，最终实现任意代码执行。【利用步骤】1. 确定目标系统是否运行 Next.js 且使用了 App Router 架构。2. 获取一个有效的 Next-Action ID（通常可以从页面源代码或网络流量中抓取）。3. 构造一个包含 `__proto__` 键值的 JSON Payload。4. 通过 POST 请求发送该负载，并在 HTTP 头部中包含 `Next-Router-State-Tree`。5. 监控服务器返回的 HTTP 500 响应及相关的 JSON 错误摘要，以确认漏洞的存在。6. 进一步构造可执行系统命令的 JavaScript 链式调用负载实现完全控制。【投毒风险分析】该 POC 代码由 Praetorian 与 AI 协作编写，代码结构清晰，采用了标准的 YAML 安全扫描模板格式。代码中不包含任何混淆、二进制 Payload 注入或未经授权的外部网络回连逻辑。其核心载荷 `constructor:constructor` 仅用于触发 JavaScript 引擎的解析行为，属于良性的探测性质。由于该 POC 明确依赖于标准的开源扫描工具 Nuclei 运行环境，且所有 HTTP 交互逻辑都是透明可读的，因此不存在隐藏的恶意后门或数据窃取脚本。对于防御性研究人员而言，该代码是非常安全的审计参考。但在使用此类公开 POC 时，安全研究员仍需注意，攻击者可能会在类似的公开代码中植入微妙的混淆代码（如编码后的 eval 调用）或将扫描结果异步发送到第三方服务器（OOB 数据带出）。本 POC 经过人工审核，确定其不具备这些特征，风险等级极低。尽管如此，在组织内部测试时，建议在受控的沙箱环境中执行，并审计任何由不可信源获取的 YAML 模板文件的 scripts 字段，以防扫描器本身的扩展插件被恶意利用。

**项目地址:** [https://nextjs.org/blog/CVE-2025-66478](https://nextjs.org/blog/CVE-2025-66478)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-55182](https://nvd.nist.gov/vuln/detail/CVE-2025-55182)
