## CVE-2025-32463 - Linux Sudo 本地提权 (Local Privilege Escalation, LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation, LPE)

**影响应用:** Linux Sudo

**危害等级:** 高危 (High Risk)

**CVSS评分:** 9.3

**影响版本:** Sudo 1.9.14 至 1.9.17 (在 1.9.17p1 版本中修复)

**利用条件:** 需要本地用户访问权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463 是 Linux Sudo 组件中一个高危的本地提权漏洞，它源于 `sudo` 命令在使用 `--chroot` (或 `-R`) 选项时，对 `nsswitch.conf` 文件的处理不当。攻击者可以通过控制 `chroot` 目录下的 `nsswitch.conf` 文件，使其指向一个恶意的动态链接库（通常是 `libnss_*.so`），从而在以 `root` 权限执行 `sudo` 命令时加载该恶意库，并最终获取 `root` 权限。

提供的 `exploit.py` POC 代码是一个功能完整的利用脚本，旨在自动化这一提权过程。其核心逻辑如下：
1.  **环境准备**：脚本首先在 `/tmp` 目录下创建一个唯一的临时目录（例如 `sudowoot.stage.XXXXXX`），并将工作目录切换到该临时目录。
2.  **恶意负载编译**：脚本在临时目录中生成一个名为 `woot1337.c` 的C语言源文件。该C代码包含一个 `__attribute__((constructor))` 属性的 `woot` 函数。这意味着当该库被加载时，`woot` 函数将自动执行。`woot` 函数的功能是将当前进程的用户ID和组ID设置为 `0` (即 `root`)，然后改变当前目录到根目录 `/`，并最终通过 `execl("/bin/bash", "/bin/bash", NULL)` 启动一个 `root` 权限的 bash shell。
3.  **构建Chroot环境**：脚本在临时目录中创建 `woot/etc` 和 `libnss_` 两个子目录。`woot/etc` 目录用于模拟 `chroot` 环境中的 `/etc` 目录。
4.  **NSSwitch配置劫持**：脚本在 `woot/etc` 目录下创建 `nsswitch.conf` 文件，并写入 `passwd: /woot1337`。这个配置是利用漏洞的关键，它指示系统在查询 `passwd` 数据库时，加载 `libnss_/woot1337.so.2` 库。
5.  **库文件复制**：脚本将 `/etc/group` 复制到 `woot/etc` 目录下，以确保 `chroot` 环境中存在基本的系统文件。
6.  **编译恶意库**：脚本使用 `gcc` 编译器将 `woot1337.c` 编译为一个共享库 `libnss_/woot1337.so.2`。编译参数 `-shared -fPIC -Wl,-init,woot` 确保 `woot` 函数在库加载时被调用。
7.  **触发漏洞**：最后，脚本执行 `sudo -R woot woot` 命令。`sudo -R woot` 将 `woot` 目录设置为 `chroot` 环境的根目录。当 `sudo` 在 `chroot` 环境中初始化其环境时，会尝试读取 `chroot` 环境下的 `/etc/nsswitch.conf`。由于 `nsswitch.conf` 已被劫持，系统会加载我们恶意的 `libnss_/woot1337.so.2` 库，进而触发 `woot` 函数，导致权限提升，最终获取到一个 `root` shell。
8.  **清理**：在漏洞利用尝试完成后，脚本会删除之前创建的临时目录，清除痕迹。

该POC完整且自动化，能够有效地利用CVE-2025-32463漏洞，在受影响的系统上从本地普通用户权限提升到 `root` 权限。

**投毒风险分析：**
本POC代码 (`exploit.py`) 经过详细审查，被判定为投毒风险极低。以下是具体分析：
1.  **代码透明度与可读性**：POC 使用 Python 编写，结构清晰，逻辑直接，没有进行任何混淆处理。C语言的恶意负载也直接嵌入在Python脚本中，易于理解其功能。这种透明度使得安全研究人员可以轻松审计代码，验证其行为是否与声称的漏洞利用目的相符。
2.  **核心功能专注**：脚本的所有操作都围绕着本地提权这一核心目标。它创建临时目录、生成C代码、编译共享库、配置 `nsswitch.conf`，并执行 `sudo` 命令来触发漏洞。这些步骤都是典型的本地提权漏洞利用流程。
3.  **无外部通信或持久化机制**：代码中没有任何网络请求，不连接任何远程服务器，也没有尝试下载或上传额外的数据。它也不包含任何持久化机制，如创建后门用户、修改系统启动项、安装恶意服务等。在利用完成后，脚本会清理其创建的临时文件和目录，进一步降低了作为恶意软件的风险。
4.  **标准库使用**：脚本仅使用了 Python 的标准库 (`os`, `subprocess`, `shutil`, `tempfile`)，这些库是执行文件系统操作、运行外部命令和管理临时文件的常用且安全的方式。
5.  **恶意负载的性质**：POC 中的 C 语言代码 (`woot1337.c`) 是典型的提权 shellcode，其唯一目的是将当前进程的权限提升至 `root` 并启动一个 `root` shell。虽然这本身是“恶意”行为（从防御角度看），但它完全符合一个本地提权漏洞POC的预期功能，且不包含任何额外的恶意载荷。根据指导原则，这种用于漏洞利用的后门代码不应被判定为“投毒”代码。
综上所述，该POC是一个干净、专注于漏洞利用的工具，不包含额外恶意功能，因此其被用作投毒工具的风险极低。

**项目地址:** Not explicitly provided in the input data.

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
