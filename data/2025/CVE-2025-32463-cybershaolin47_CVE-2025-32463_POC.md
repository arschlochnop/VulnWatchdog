## CVE-2025-32463 - sudo 本地提权 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (LPE)

**影响应用:** sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8

**影响版本:** 1.9.14 <= sudo < 1.9.17p1

**利用条件:** 具有普通用户权限的本地访问，目标系统安装了受影响版本的sudo且未禁用-R/--chroot选项，系统中存在gcc编译环境或预编译好的恶意动态库。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞源于sudo在处理-R（--chroot）命令行选项时的实现逻辑缺陷。自1.9.14版本起，sudo允许用户通过-R参数指定一个chroot目录。然而，sudo在切换到该目录后，由于不当的初始化顺序或对非置信配置文件的信任，会尝试从该用户控制的目录中加载配置（如/etc/nsswitch.conf）并随后加载关联的NSS（Name Service Switch）动态库。POC代码通过以下逻辑验证了有效性：1. 创建一个攻击者可写的模拟chroot环境目录；2. 在该目录下伪造/etc/nsswitch.conf文件，将其中的passwd查询指向一个自定义的模块名称（如shaolin）；3. 编写一个利用__attribute__((constructor))特性的C语言代码（exp.c），在动态库加载时自动执行setreuid(0,0)并弹出root shell；4. 将该C代码编译为符合NSS命名规范的动态库（libnss_shaolin.so.2）并放置在搜索路径中。最后，通过执行'sudo -R [chroot目录] [用户名]'触发。由于sudo以root权限运行，它在chroot环境中加载恶意库时会执行其中的构造函数，从而实现从普通用户到root的权限提升。该POC结构清晰，利用逻辑符合Linux共享库加载机制，在受影响系统上具有极高的成功率。 【利用步骤】1. 创建工作目录并初始化chroot环境结构：mkdir -p shaolin/etc libnss_；2. 构造恶意配置文件：将'passwd: /shaolin'写入shaolin/etc/nsswitch.conf，并复制系统的/etc/group到对应位置以满足基础环境要求；3. 编写漏洞利用载荷：创建exp.c，包含提权至root并执行/bin/bash的代码；4. 编译恶意动态库：使用gcc将其编译为共享对象libnss_/shaolin.so.2；5. 触发利用：运行'sudo -R shaolin shaolin'。此时sudo会读取伪造的nsswitch.conf，尝试加载libnss_shaolin库，进而执行攻击者的提权代码。 【投毒风险分析】该POC的投毒风险评级为低（10%）。风险来源分析如下：1. 代码透明度：提供的exp.c和privesc.sh脚本逻辑非常直观，所有操作均在本地文件系统内完成，且代码量极小，易于审计。2. 恶意行为识别：代码中主要的敏感操作是setreuid(0,0)和/bin/bash的调用，这是提权POC的标准行为，不属于隐藏的后门逻辑。3. 网络行为：脚本本身不包含curl、wget等从远程下载混淆脚本或二进制文件的指令，降低了供应链污染的风险。4. 潜在隐患：虽然该POC来自GitHub项目（cybershaolin47/CVE-2025-32463_POC），但目前的实现方式并未发现加密载荷或反调试机制。然而，防范此类漏洞时应注意，攻击者可能分发预编译好的.so文件，其中可能包含隐藏的远控木马。在本例中，由于提供了源代码且编译过程由本地gcc执行，风险受控。建议安全研究人员在隔离环境（如虚拟机）中运行此类POC，并始终优先审查shell脚本中是否存在未知的外部链接下载行为。

**项目地址:** [https://github.com/cybershaolin47/CVE-2025-32463_POC](https://github.com/cybershaolin47/CVE-2025-32463_POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
