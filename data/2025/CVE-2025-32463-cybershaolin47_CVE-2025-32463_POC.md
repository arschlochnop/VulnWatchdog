## CVE-2025-32463 - Sudo 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 至 1.9.17 (含)

**利用条件:** 具有本地普通用户访问权限，且 sudo 版本处于受影响范围内，环境中存在 gcc 编译器（用于编译共享库）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该漏洞源于 Sudo 在处理 `--chroot` (或 `-R`) 选项时的逻辑缺陷。在受影响的版本中，当执行 `sudo -R /path/to/chroot` 时，Sudo 会在进入 chroot 环境后错误地尝试从该受控目录中加载配置及相关的动态库。根据提供的 POC 代码（exp.c 和 privesc.sh），攻击者首先创建一个受控的 chroot 根目录结构，并在其中放置恶意的 `nsswitch.conf`。通过配置 `nsswitch.conf` 指向一个自定义的服务名（如 shaolin），并编译同名的恶意 NSS 共享库（libnss_shaolin.so.2），攻击者可以诱导以 root 权限运行的 sudo 进程加载该库。由于 `exp.c` 中使用了 `__attribute__((constructor))` 属性，这意味着一旦共享库被加载，其中的 `exploit` 函数就会立即执行。该函数通过 `setreuid(0,0)` 将进程的实际和有效用户 ID 设置为 root，随后启动 `/bin/bash`，从而为攻击者提供一个完全的 root shell。实验证明该流程逻辑严密，只要系统未更新到修复版本（1.9.17p1 及以上），利用成功率极高。利用步骤：1. 在本地创建一个攻击工作目录，并在其中模拟 chroot 环境（如创建 /etc 目录）。2. 编写恶意的 `nsswitch.conf`，将 NSS 查询重定向到自定义模块名。3. 编写攻击 C 代码，使用构造函数属性包含提权至 root 并执行 shell 的逻辑。4. 使用 gcc 将 C 代码编译成名为 `libnss_[name].so.2` 的共享对象。5. 执行命令 `sudo -R [chroot目录] [自定义名]` 触发漏洞，获取 root 权限。投毒风险分析：经过对提供的脚本和代码的详细审查，该 POC 属于低风险级别。其 `privesc.sh` 脚本和 `exp.c` 源码完全公开，逻辑透明，主要包含创建目录、写入配置文件、调用标准编译器（gcc）以及执行本地提权命令。代码中不存在混淆逻辑、任何形式的网络外连（反弹 shell 除外，但此处是直接本地 exec 提权）、系统敏感文件删除或加密等恶意投毒行为。唯一的可疑点在于 `exp.c` 会尝试修改 UID 并启动 shell，这在漏洞利用代码中属于标准行为，而非针对研究员的隐藏后门。然而，对于任何从 GitHub 克隆的自动化脚本，建议研究员在执行前务必检查 `privesc.sh` 中是否包含下载远程执行脚本的指令（如 curl/wget 到管道），在本例中未发现此类风险。该 POC 更多是作为一种概念验证工具，而非针对安全研究员的钓鱼工具。

**项目地址:** [https://github.com/cybershaolin47/CVE-2025-32463_POC](https://github.com/cybershaolin47/CVE-2025-32463_POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)
