## CVE-2025-49844 - Redis RCE (Use-After-Free)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** RCE (Use-After-Free)

**影响应用:** Redis

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** 影响所有支持Lua脚本的版本（6.x至8.x分支），修复版本为8.2.2及以上

**利用条件:** 需要具有执行Lua脚本权限的身份验证用户（低权限用户即可利用）

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 25%

## 详情

【POC有效性分析】该漏洞被称为RediShell，是Redis历史上首个CVSS满分漏洞。漏洞根本原因在于Redis的Lua脚本引擎在处理脚本解析时存在内存管理缺陷。具体而言，在luaY_parser函数解析脚本的过程中，如果触发了垃圾回收（GC），可能会释放正在使用的chunk名称字符串，导致释放后重用（Use-After-Free）。提供的POC代码通过newproxy(true)和自定义的__gc元方法人为干预Lua的垃圾回收时机。代码中build_payload生成了包含大量局部变量的脚本以维持内存压力，并通过循环调用loadstring和不断分配‘垃圾’字符串（junk变量）来提高GC在解析期间被触发的概率。当GC在解析器仍持有旧名称引用时运行，系统将访问已释放内存，从而导致崩溃或指令流劫持。该POC逻辑符合UAF漏洞的触发特征，但在实际环境中，受内存对齐、分配器行为等因素影响，可能需要多次运行（Race Condition）才能成功触发崩溃或RCE。【利用步骤】1. 获取Redis服务的访问权限（需通过AUTH认证）；2. 准备包含触发GC逻辑的恶意Lua脚本（如POC所示）；3. 使用redis-cli的--eval参数或EVAL命令将脚本发送至服务端执行；4. 通过循环执行增加竞争成功的几率，直到触发溢出或覆盖函数指针以获取OS shell。【投毒风险分析】提供的代码包投毒风险较低，但存在一定误导性。POC主体采用Lua编写，代码逻辑清晰，主要涉及Lua标准库和GC操作，未发现明显的恶意二阶段载荷或后门植入。然而，配套的README.MD文件包含波斯语描述，并诱导用户在Shodan上搜索公网目标（product:"Redis key-value store"），这具有典型的‘脚本小子’攻击诱导倾向。README中提供的Shell循环脚本虽然看似是自动化测试，但在防御研究视角下，这种建议直接针对生产环境或公网目标的行为具有攻击性色彩。尽管代码本身没有恶意混淆或外部下载行为，但其传播背景（如利用满分漏洞噱头）常被用于钓鱼或传播带有微小改动的‘假POC’。建议研究员在隔离沙箱环境中测试，并移除README中建议的自动化循环脚本，仅保留核心Lua逻辑进行调试分析。

**项目地址:** n/a

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)
