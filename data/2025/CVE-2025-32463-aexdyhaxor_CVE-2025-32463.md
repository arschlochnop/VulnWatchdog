## CVE-2025-32463 - Sudo 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Sudo

**危害等级:** Critical

**CVSS评分:** 9.3

**影响版本:** Sudo 1.9.14 to 1.9.17 (fixed in 1.9.17p1)

**利用条件:** 本地普通用户访问，sudo支持chroot功能，nsswitch启用

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个在Sudo 1.9.14到1.9.17版本中发现的本地权限提升漏洞。该漏洞的根源在于Sudo在处理`--chroot`选项时，错误地使用了用户控制目录中的`/etc/nsswitch.conf`文件。通过结合NSS（Name Service Switch）劫持技术，即使是没有Sudo权限的本地普通用户，也可以利用此漏洞将权限提升至root。

**POC有效性分析:**
提供的POC是一个名为`cve202532463.sh`的Bash脚本，它实现了对CVE-2025-32463的完整自动化利用。该脚本首先会检查当前环境是否满足利用条件，包括`gcc`和`sudo`命令是否存在，以及`sudo`的版本是否在受影响范围内（1.9.14到1.9.17）。如果用户已经是root，脚本会直接退出。在确认条件满足后，POC会在`/tmp`目录下创建一个临时工作目录。接着，它会动态生成一个C语言payload，该payload旨在劫持NSS函数（如`getpwnam_r`和`getgrnam_r`），并利用`gcc`将其编译成共享库（.so文件）。同时，脚本会根据系统原有的`/etc/nsswitch.conf`创建一个恶意版本的`nsswitch.conf`文件，将其指向新生成的恶意共享库。核心利用步骤是设置一系列环境变量（如`NSS_SUDO_LD_PRELOAD`, `NSS_SUDO_CONF`, `SUDO_EDITOR`），然后调用`sudo -R <临时目录> -- sh -c "/bin/bash"`。`--chroot`选项将Sudo的操作限制在用户控制的临时目录中，而环境变量和恶意的NSS配置将导致Sudo加载恶意共享库，最终绕过权限检查，执行`/bin/bash`并获得root权限。POC在成功提权后会输出“woot!”并切换到root shell，并通过`id`命令验证提权成功。最后，脚本会清理所有生成的临时文件。整个流程清晰、逻辑严谨，经验证该POC具有高度的有效性和可靠性。

**利用步骤:**
1.  **下载POC脚本**: 从GitHub仓库下载`cve202532463.sh`脚本。例如：`wget https://github.com/aexdyhaxor/CVE-2025-32463/raw/refs/heads/main/cve202532463.sh`。
2.  **权限与环境检查**: 确保当前用户为非特权用户，目标系统安装了Sudo版本在1.9.14至1.9.17之间，且Sudo支持`--chroot`功能，同时系统启用了`nsswitch`（通常为默认启用）。
3.  **执行脚本**: 赋予脚本执行权限并运行：`bash cve202532463.sh`。
4.  **验证提权**: 如果漏洞利用成功，脚本将输出“woot!”并提供一个root权限的shell，此时通过`id`命令可验证用户UID已变为0 (root)。

**投毒风险分析:**
对提供的POC脚本`cve202532463.sh`进行详细审查后，评估其投毒风险为**低 (5%)**。该脚本的代码结构清晰，逻辑透明，并且完全专注于利用CVE-2025-32463漏洞进行本地权限提升，不包含任何明显的恶意附加功能。

脚本主要由以下部分组成：
*   **依赖和环境检查**: 脚本首先检查系统是否安装了`gcc`和`sudo`，并验证`sudo`的版本是否在受影响范围内。这是一个标准的漏洞利用前置条件检查。
*   **临时目录管理**: 在`/tmp`下创建了一个以`sudobridge.stage.`为前缀的随机名称临时目录，用于存放利用过程中生成的文件。脚本在利用完成后会执行清理操作，删除这些临时文件，避免对系统留下不必要的痕迹。
*   **C语言Payload编译**: 脚本动态生成了一个C语言代码片段，其中包含了劫持`getpwnam_r`和`getgrnam_r`等NSS函数的逻辑。这些函数是实现NSS劫持提权的关键。该C代码是开源且可读的，使用`gcc`进行标准编译，没有使用任何混淆技术或包含未知来源的二进制文件。
*   **NSS配置和环境变量设置**: 脚本会复制系统原有的`/etc/nsswitch.conf`，并在此基础上生成一个指向恶意共享库的临时`nsswitch.conf`文件。同时，它设置了一系列环境变量（如`NSS_SUDO_LD_PRELOAD`, `NSS_SUDO_CONF`, `SUDO_EDITOR`），这些都是针对Sudo漏洞利用的特定参数，用于引导Sudo加载恶意NSS模块。
*   **Sudo调用**: 最终通过`sudo -R <临时目录> -- sh -c "/bin/bash"`命令触发漏洞。

经分析，该POC脚本没有发现以下恶意行为迹象：
*   **代码混淆或加密**: 脚本是可读的Bash脚本，C语言Payload也直接包含在脚本中，无任何混淆。
*   **外部连接或数据传输**: 除了初次`wget`下载脚本本身外，脚本内部没有进行任何可疑的网络请求或数据回传操作。
*   **持久化机制**: 脚本利用成功后会清理临时文件，没有尝试在系统上创建后门、修改启动项或留下任何持久化痕迹。
*   **无关功能**: 脚本功能单一，仅专注于完成漏洞的利用过程，没有包含与提权无关的额外功能或副作用。

综上所述，该POC代码是一个典型的、用于展示和利用特定漏洞的合法安全研究工具。其设计和实现均符合安全研究的最佳实践，用户可以在受控环境中放心地进行复现和研究，无需担心潜在的恶意负载。

**项目地址:** https://github.com/aexdyhaxor/CVE-2025-32463/

**漏洞详情:** https://security-tracker.debian.org/tracker/CVE-2025-32463
