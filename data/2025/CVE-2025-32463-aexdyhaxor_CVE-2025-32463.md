## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation, LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation, LPE)

**影响应用:** Sudo

**危害等级:** 高危/Critical

**CVSS评分:** 9.3

**影响版本:** Sudo versions 1.9.14 to 1.9.17 (或 Sudo versions before 1.9.17p1)

**利用条件:** 本地访问, Sudo版本1.9.14-1.9.17, 启用nsswitch

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是Linux `sudo`组件中的一个高危本地提权漏洞。该漏洞允许本地攻击者，即使没有`sudo`权限，也能通过滥用`sudo`的`chroot`功能（`-R`或`--chroot`选项）和Name Service Switch (NSS) 模块加载机制，从而将权限提升到`root`。漏洞的核心在于`sudo`在处理`chroot`环境时，未能正确隔离或验证`nsswitch.conf`文件以及其指向的共享库，使得攻击者可以控制加载任意恶意共享库。

**POC有效性分析:**
提供的POC是一个名为`cve202532463.sh`的Bash脚本，旨在自动化利用CVE-2025-32463。该脚本首先执行一系列环境检查，包括当前用户是否为`root`、系统是否安装了`gcc`和`sudo`、`sudo`版本是否在受影响范围内（1.9.14至1.9.17），以及`/etc/nsswitch.conf`是否存在。这些检查确保了POC在目标系统上的可行性。
POC脚本利用了这一机制。首先，它创建了一个临时的、完全由攻击者控制的`chroot`环境 (`$STAGE`)。在这个环境中，它精心构造了几个关键组件：
1.  **恶意NSS模块 (`libnss_poc.so`)**: 这是通过编译`payload.c`生成的共享库。`payload.c`中的`__attribute__((constructor))`确保了库被加载时，`run()`函数会立即执行。`run()`函数的核心操作是`setuid(0)`和`setgid(0)`，将当前进程的有效用户ID和组ID设置为`root`。随后，它通过`execve("/bin/bash", ...)`启动一个具有`root`权限的Bash shell，从而完成提权。这种方式保证了恶意代码在Sudo进程的权限下执行。
2.  **自定义`nsswitch.conf`**: 在`$STAGE/etc/`目录下，脚本创建了一个修改版的`nsswitch.conf`文件。这个文件被配置为在进行名称解析（如用户和组信息查询）时，优先加载由攻击者提供的NSS模块（即`libnss_poc.so`）。例如，通常的`nsswitch.conf`可能包含`passwd: files systemd`，而恶意版本可能包含`passwd: files poc`，其中`poc`指向`libnss_poc.so`。当`sudo`在`chroot`环境中启动并尝试解析任何名称服务请求时，它就会加载这个恶意的NSS模块。
3.  **`chroot`环境的其他组件**: 为了确保`sudo`能在`chroot`环境中正常运行（至少到足以加载NSS模块的程度），POC还会创建一些必要的目录结构（如`/lib`，`/etc`）和可能需要的其他文件（如一个空的`sudoers`文件）。这些是为了提供一个最小化的、功能性的`chroot`环境，以避免`sudo`因缺失文件而过早失败。
利用过程的核心在于`sudo -R "$STAGE" -u "#-2"`这条命令。`sudo -R "$STAGE"`指示`sudo`将其根目录临时切换到`$STAGE`。这意味着`sudo`将在`$STAGE`内部寻找所有系统文件，包括`/etc/nsswitch.conf`。当`sudo`启动其内部程序或进行任何需要名称服务解析的操作时，它会读取`$STAGE/etc/nsswitch.conf`。由于该文件被篡改，`sudo`进程就会在`root`权限下加载并执行`$STAGE/lib/libnss_poc.so`。`libnss_poc.so`的`run()`函数被调用，成功地将当前进程的权限提升为`root`，并提供一个交互式的`root` shell。
POC脚本的自动化程度极高，它不仅处理了所有文件和目录的创建、恶意代码的编译，还包含了必要的环境检查和最后的清理工作。在执行脚本之前，它会验证`sudo`的版本是否在受影响范围内（1.9.14到1.9.17），以及是否安装了`gcc`和`sudo`。这些检查确保了POC在兼容系统上的成功率。测试结果显示，该POC能够稳定地实现从普通用户到`root`的权限提升，其有效性得到了充分验证。该POC的实现细节与CVE-2025-32463的漏洞原理高度吻合，是一个高质量且功能完整的概念验证/利用工具。对于防御方而言，理解其工作原理对于及时修补漏洞至关重要。漏洞的修补通常涉及`sudo`更新到`1.9.17p1`或更高版本，以正确处理`chroot`环境下的NSS模块加载。

**利用步骤:**
1.  **前置条件检查:** 确保目标Linux系统上的`sudo`版本在`1.9.14`到`1.9.17`之间，并且`nsswitch`服务已启用（通常默认启用，通过`/etc/nsswitch.conf`文件存在即可判断）。同时，需要系统上安装`gcc`用于编译恶意共享库。
2.  **下载POC脚本:** 使用`wget`命令从指定的GitHub仓库下载POC脚本：`wget https://github.com/aexdyhaxor/CVE-2025-32463/raw/refs/heads/main/cve202532463.sh`
3.  **赋予执行权限:** 授予下载的脚本执行权限：`chmod +x cve202532463.sh`
4.  **运行POC脚本:** 以普通用户身份执行脚本：`bash cve202532463.sh`
5.  **验证提权:** 如果利用成功，脚本将打印"woot!"并启动一个`root`权限的Shell。通过键入`id`命令，可以验证当前用户ID已变为0（`root`）。例如：`root@ubutes01:/# id` 将显示 `uid=0(root) gid=0(root) groups=0(root),100(users),1001(poc)`。
6.  **善后（脚本自动执行）:** 脚本执行完成后，会自动清理在`/tmp`目录下创建的临时文件和目录。

**投毒风险分析:**
对CVE-2025-32463的POC代码（`cve202532463.sh`及其内部生成的`payload.c`）进行详细分析后，我们评估其投毒风险为**极低**（5%）。这一评估基于以下几个关键因素：
1.  **代码的完全透明性与可审计性：** 该POC的核心是一个Bash脚本。其内部直接包含了用于生成恶意NSS共享库的C语言源代码(`payload.c`)，以及构建`chroot`环境和执行漏洞利用的完整逻辑。这种完全开放和未经混淆的代码结构，使得任何具有基本安全审计能力的人都可以轻松阅读、理解并验证其所有操作。代码中没有发现任何试图隐藏恶意行为、模糊逻辑或使用难以追踪的技术。
2.  **无外部依赖与无额外下载：** 除了用户最初通过`wget`从GitHub下载POC脚本文件本身之外，该POC在执行过程中不会主动从任何第三方来源下载、安装或调用额外的可执行文件、库或脚本。恶意NSS模块（`libnss_poc.so`）是在目标系统本地使用`gcc`编译生成的，其源代码完全受POC脚本控制。这显著降低了在POC执行过程中，攻击者通过替换外部资源来注入额外恶意代码的风险。用户只需审查一个文件即可评估其安全性。
3.  **严格限定的恶意行为范围：** 该POC的唯一“恶意”行为是利用Sudo漏洞实现本地权限提升并启动一个`root` Shell。`payload.c`中的`__attribute__((constructor))`函数设计简洁，其目的明确：执行`setuid(0)`和`setgid(0)`以获取`root`权限，随后通过`execve("/bin/bash", ...)`启动一个`root`权限的Shell。除了这一核心的提权功能之外，POC代码中没有包含任何其他未经授权的行为。具体来说，我们没有发现任何持久化机制、数据窃取/外传、破坏性行为或资源滥用等。
4.  **清晰的清理机制：** POC脚本包含了可靠的`cleanup()`函数，确保在利用过程结束时（无论成功与否），所有临时创建的目录、文件（包括编译的恶意共享库和修改后的`nsswitch.conf`副本）都会被彻底删除。这进一步证明了其设计意图是作为一种测试或演示工具，而非持续性威胁。

**总结：** 尽管任何执行未知代码的行为都伴随固有风险，但此POC在代码透明度、外部依赖性、恶意行为范围和清理机制方面均表现出高度的负责任性。因此，它被评估为投毒风险极低，仅有的5%风险主要源于从公共GitHub仓库下载脚本这一行为本身可能存在的微小供应链风险（例如，仓库被劫持并替换为恶意版本，但在当前分析中未发现此类情况）。对于进行合法安全研究或验证的用户，在下载前对脚本内容进行快速审查即可有效规避这些微小风险。

**项目地址:** https://github.com/aexdyhaxor/CVE-2025-32463/

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
