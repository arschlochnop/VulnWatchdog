## CVE-2025-32463 - Sudo 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.8.8 至 1.9.17 ( specifically 1.9.14 至 1.9.17, 修复于 1.9.17p1 之前版本)

**利用条件:** 需要本地用户权限，sudo配置支持chroot功能，且系统启用了nsswitch功能

**POC 可用性:** 9

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 10

## 详情

CVE-2025-32463是Linux sudo组件中一个高危本地提权漏洞，其CVSS评分为9.3，影响sudo 1.9.14至1.9.17版本，以及早于1.9.17p1的所有版本。该漏洞的核心在于sudo命令在使用`--chroot`选项时对`/etc/nsswitch.conf`文件的处理不当。具体来说，当sudo在用户控制的chroot环境中运行时，它可能会从该环境中加载恶意的`/etc/nsswitch.conf`配置文件，进而导致加载攻击者控制的动态链接库。攻击者通过精心构造一个包含恶意`nsswitch.conf`文件的chroot环境，并利用sudo以特权执行特定命令时，可以诱使sudo加载并执行恶意的`libnss_sudo.so.2`库。这个恶意库可以在其构造函数中执行任意代码，最终以root权限运行，从而实现本地权限提升。此漏洞允许任何具有本地用户权限的攻击者，在满足特定`sudo`配置和版本要求的前提下，绕过现有的权限限制，获取系统最高权限。这一缺陷的发现揭示了在安全敏感的特权工具中，即使是看似隔离的`chroot`环境，也可能存在信任边界问题，特别是当其内部的文件路径解析和库加载机制未能充分考虑到来自非信任源的输入时。

**POC有效性分析：**
提供的POC代码是一个名为`cve202532463.sh`的bash脚本，其设计旨在自动化CVE-2025-32463漏洞的本地权限提升过程。通过对脚本内容的分析，可以确认其高度的有效性和完整性。脚本首先执行一系列环境检查，包括当前用户是否为root、系统是否安装了`gcc`和`sudo`，以及`sudo`的版本是否在受影响的范围内（1.9.14至1.9.17）。一旦满足这些先决条件，脚本会创建一个临时的chroot目录结构，并在其中精心构造必要的文件，包括一个恶意的`nsswitch.conf`文件和一个C语言源文件`bridge.c`。`bridge.c`被编译为一个动态链接库`libnss_sudo.so.2`，这个库在加载时会执行提权payload，通常是启动一个root权限的shell。最后，脚本使用`sudo --chroot=<临时目录> /bin/bash -c <命令>`这样的构造来触发漏洞。`sudo`在`--chroot`环境中尝试解析名称服务时，会加载我们提供的恶意`libnss_sudo.so.2`，从而执行其中的payload并获得root权限。POC的`README.md`中提供的执行截图显示，在运行脚本后，`id`命令的输出从普通用户`uid=1001(poc)`成功切换为`uid=0(root)`，这明确验证了POC能够成功利用漏洞并实现root权限提升。整个过程自动化且无需复杂的用户交互，证明了其作为完整利用工具的价值。

**利用步骤：**
要利用CVE-2025-32463漏洞，攻击者需要执行以下步骤：
1.  **准备环境**：目标系统必须运行受影响的`sudo`版本（1.9.14到1.9.17），支持`chroot`功能，且`nsswitch`功能启用。攻击者需要一个具有本地访问权限的低权限用户账户，并确保系统安装了`gcc`编译器。
2.  **获取POC脚本**：攻击者可以从GitHub仓库（例如`https://github.com/aexdyhaxor/CVE-2025-32463/raw/refs/heads/main/cve202532463.sh`）下载POC脚本。通常使用`wget`命令完成：`wget https://github.com/aexdyhaxor/CVE-2025-32463/raw/refs/heads/main/cve202532463.sh`。
3.  **执行POC**：赋予下载的脚本执行权限：`chmod +x cve202532463.sh`。以低权限用户身份运行脚本：`bash cve202532463.sh`。
4.  **验证提权**：如果漏洞利用成功，脚本将自动在新的root shell中执行`id`命令，显示当前用户已切换为root权限（`uid=0(root)`）。攻击者现在拥有目标系统的完全控制权限。
此过程相对简单，自动化程度高，使得该漏洞易于被具有基本Linux操作知识的攻击者利用。

**投毒风险分析：**
对`cve202532463.sh` POC脚本的投毒风险评估显示，其风险等级为低（10%）。这一判断基于对脚本内容的详细审查，并未发现任何恶意或可疑的行为，这些行为与实现提权漏洞利用的目的无关。
首先，脚本是纯粹的bash脚本，其内容清晰可读，没有经过代码混淆处理，如使用难以理解的变量名、复杂的嵌套调用或字符编码转换来隐藏真实意图。所有命令和逻辑都直接呈现在代码中，便于安全研究人员和分析人员进行快速和准确的审计。这种透明度是评估代码信任度的关键因素。脚本的核心功能围绕着创建临时的chroot环境、编译恶意的`nsswitch`模块以及执行带有`--chroot`选项的`sudo`命令以触发漏洞。这些操作均是本地执行，不依赖于外部网络请求来下载或执行额外的代码。虽然`README.md`中提供了通过`wget`下载脚本本身的指令，但这只是获取POC的方式，并非POC执行过程中的网络行为。脚本内部的`wget`或`curl`等网络请求调用缺失，表明其不会在执行过程中未经授权地获取其他资源或发送敏感信息。
其次，脚本中没有使用`eval`、base64编码、Hex编码或其他常见的用于隐藏恶意有效载荷的机制，例如通过动态拼接字符串来执行命令。编译的C代码（`bridge.c`）用于构建恶意的`libnss_sudo.so.2`库，其作用是加载时执行提权shell，这与漏洞的本地权限提升性质完全一致。该代码的目的是作为漏洞利用的一部分，而非植入后门、加密勒索文件、安装挖矿程序或进行其他未声明的恶意活动。C代码的逻辑也相对简单，专注于劫持`setuid`并执行`/bin/bash`，没有复杂的数据传输或外部通信机制。
此外，脚本使用的所有工具和库都是标准的Linux组件（如`gcc`、`sudo`、`mkdir`、`echo`、`cp`等），没有引入任何非标准或可疑的二进制文件。脚本在执行过程中创建的所有临时文件和目录（例如以`sudobridge.stage.`为前缀的目录）在脚本执行完成后也会被清理，减少了在系统上留下痕迹的可能性，这进一步降低了潜在的持久化威胁。虽然在生产环境中执行任何未经充分审查的POC都存在固有风险，但就该特定POC而言，其设计意图和实现方式高度吻合其宣称的漏洞利用目的，未发现任何额外恶意行为的迹象。因此，将其归类为低投毒风险是合理的，建议用户在隔离环境中进行测试，并始终审查源代码。

**项目地址:** https://github.com/aexdyhaxor/CVE-2025-32463/

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
