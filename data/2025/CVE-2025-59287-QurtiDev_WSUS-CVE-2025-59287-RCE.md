## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8

**影响版本:** 所有受支持的 Microsoft Windows Server Update Services (WSUS) 版本

**利用条件:** 无需认证，需要网络访问，通过特制SOAP请求

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：
此POC，名为`WSUS-CVE-2025-59287-RCE`，有效演示了在所有受支持的Microsoft Windows Server Update Services (WSUS) 中存在的关键（CVSS 9.8分）远程代码执行漏洞。该漏洞源于`GetCookie()`端点中不安全的反序列化机制，允许未经身份验证的攻击者以完全的SYSTEM权限执行任意代码。漏洞利用流程首先构建一个用于连接回攻击者监听机器的PowerShell反向Shell命令。此命令随后使用`ysoserial.net`框架中的`TypeConfuseDelegate` gadget进行序列化，这是一个专门用于利用.NET反序列化漏洞的众所周知的技术。序列化后的Payload不会直接发送，而是经过AES-128-CBC加密，使用预定义的固定密钥（`877C14E433638145AD21BD0C17393071`）和一个随机生成的初始化向量（IV）或盐值，从而增强其隐蔽性并规避潜在的基于签名的检测。加密后，生成的密文被Base64编码，以确保其在基于文本的协议中安全传输。最后，这个编码并加密的Payload被精心嵌入到SOAP信封的`AuthorizationCookie`字段中，SOAP是一种标准的基于XML的消息传输协议。这个特别构造的SOAP请求随后被发送到目标WSUS服务器的`GetCookie`端点。成功接收和处理后，易受攻击的WSUS服务器预计会首先使用硬编码的密钥解密Payload，然后反序列化.NET对象。由于反序列化过程不安全，这将触发嵌入的PowerShell反向Shell的执行。`exploit.cs`代码全面实现了这一复杂的流程，包括显示横幅、加密功能（AES加密/解密）、Payload生成以及发送SOAP请求所需的网络通信逻辑。`README.md`提供了极其清晰、分步的编译（使用Mono，它是.NET的跨平台实现）和使用说明，使得该漏洞利用具有高度的可操作性和可靠性，可用于演示漏洞。鉴于详细的技术解释、对反序列化gadget的明确提及以及完整、结构良好的C#代码，该POC在实现其既定目标——远程代码执行方面显得非常有效和稳健，使其成为安全评估和防御措施验证的宝贵工具。

利用步骤：
1.  **编译**: 使用Mono项目工具链编译`exploit.cs`。例如，在Linux或macOS上，可能需要安装Mono运行时和编译器，然后执行`csc exploit.cs`。
2.  **启动监听器**: 在攻击者机器上启动一个网络监听器，例如使用Netcat：`nc -lvnp 4444`，等待反向Shell连接。
3.  **运行POC**: 执行编译好的POC程序。
4.  **输入参数**: 根据程序提示，输入目标WSUS服务器的URL、攻击者的监听IP地址和监听端口号（例如：`http://target-wsus/ClientWebService/ClientWebService.asmx`, `192.168.1.100`, `4444`）。
5.  **获取Shell**: 如果漏洞利用成功，WSUS服务器将执行恶意Payload，并向攻击者的Netcat监听器建立一个SYSTEM权限的反向Shell连接。

投毒风险分析：
对提供的POC代码 (`exploit.cs`) 及其配套的`README.md`文件进行全面分析，可以确定该POC的投毒风险极低，接近于无。首先，`README.md`文件以极高的透明度详细解释了POC的功能：它是一个用于生成PowerShell反向Shell并利用Microsoft WSUS反序列化漏洞以在目标服务器上执行任意代码的工具。所有关键的利用步骤，包括Payload生成、`ysoserial.net`的使用、AES加密（带有明确指定的硬编码密钥）和SOAP请求的构造，都得到了详尽的描述。`exploit.cs`的源代码是清晰可读的C#代码，没有任何形式的代码混淆。它没有包含任何外部的、未经验证的第三方脚本引用，也没有进行任何可疑的、超出预期范围的网络请求（例如，不会在后台连接到攻击者服务器下载额外恶意组件）。代码中硬编码的AES密钥(`877C14E433638145AD21BD0C17393071`)虽然是固定值，但其目的是为了演示漏洞利用中的加密/解密机制，而非用于对运行POC的研究人员机器进行恶意攻击。`ysoserial.net`是安全社区中众所周知的.NET反序列化漏洞研究和利用框架。此外，POC项目在其`Disclaimer`部分明确指出，使用者必须获得书面授权才能进行测试，并强调了负责任和合法使用的原则，这进一步表明其作为合法防御性安全研究工具的定位。因此，运行此POC本身不会对安全研究人员的机器造成“供应链投毒”风险，即它不会在研究人员不知情的情况下暗中植入后门、窃取敏感数据、挖矿或执行其他旨在损害研究人员自身系统的恶意行为。该POC的唯一“恶意”之处在于其对目标系统的强大攻击能力——提供一个SYSTEM权限的反向Shell，但这正是其作为漏洞验证工具的预期核心功能。从防御性角度看，理解其机制并用于测试自身防御措施是其价值所在，而非作为攻击者利用研究人员的媒介。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
