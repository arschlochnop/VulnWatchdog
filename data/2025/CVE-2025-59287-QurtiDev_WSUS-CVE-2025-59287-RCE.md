## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全的反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全的反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Windows Server 2012, Windows Server 2019, Windows Server 2022, Windows Server 2025以及所有WSUS版本

**利用条件:** 无需认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS)的高危远程代码执行（RCE）漏洞，其CVSS评分为9.8（满分10分）。该漏洞源于WSUS在处理`AuthorizationCookie`时存在不安全的反序列化缺陷，具体表现为利用.NET的`BinaryFormatter`进行传统序列化机制中的对象反序列化。未经身份验证的远程攻击者可以通过发送特制的事件或SOAP请求，利用此漏洞在目标WSUS服务器上执行任意代码，并获得完全的SYSTEM权限。此漏洞无需任何身份凭证即可触发，攻击复杂度低，且已被监测到在野活跃利用，对运行WSUS的Windows Server 2012、2019、2022、2025等多个版本构成严重威胁。攻击者通常在获取初始访问权限后，会进一步利用PowerCat等工具获取系统shell，进行后续的恶意活动，如数据窃取、横向移动或部署勒索软件。

**POC有效性分析：**
提供的POC代码名为`WSUS-CVE-2025-59287-RCE`，由`exploit.cs`和`README.md`组成。该POC是一个功能完整的反弹Shell利用工具，旨在利用CVE-2025-59287漏洞。
1.  **载荷生成**：POC首先生成一个PowerShell反弹Shell命令。这个命令通常是一个下载并执行远程脚本的指令，但在POC中会替换为攻击者指定的IP和端口。
2.  **序列化**：生成的PowerShell命令通过`ysoserial.net`框架，使用`TypeConfuseDelegate` Gadget链进行.NET对象的序列化。这个过程将恶意载荷转换为一个二进制数据流，当目标WSUS服务器尝试反序列化时，将触发代码执行。
3.  **加密**：序列化后的载荷接着使用AES-128-CBC算法进行加密。POC代码中硬编码了一个AES密钥（`877C14E433638145AD21BD0C17393071`），并结合随机生成的盐值进行加密。这是为了绕过可能的WAF或检测机制，并确保载荷的机密性。
4.  **编码与封装**：加密后的二进制数据会被Base64编码，然后嵌入到一个SOAP请求的`AuthorizationCookie`字段中。WSUS服务在处理此Cookie时会尝试对其进行解密和反序列化。
5.  **传输**：构造好的SOAP请求通过HTTP发送到目标WSUS服务器的`GetCookie`端点。
该POC清晰地实现了漏洞的整个利用链，包括从恶意载荷的生成、序列化、加密、编码到最终的SOAP请求传输。代码结构清晰，逻辑完整，且`README.md`提供了详细的步骤说明，表明其具有高度的可用性和有效性。通过模拟实际的攻击手法，该POC能够成功触发WSUS服务器上的不安全反序列化，从而实现远程代码执行并获取SYSTEM权限的反弹Shell。

**利用步骤：**
1.  **编译POC**：使用.NET编译器或Mono环境编译`exploit.cs`文件，生成可执行程序。
2.  **启动监听器**：在攻击者机器上启动一个网络监听器，例如使用Netcat，监听指定的端口以接收反弹Shell。示例命令：`nc -lvnp 4444`。
3.  **运行POC**：执行编译后的POC程序。
4.  **输入参数**：根据POC的提示，输入目标WSUS服务器的URL、攻击者的IP地址以及监听端口。
5.  **获取Shell**：如果一切顺利，POC将发送恶意请求，WSUS服务器解密并反序列化载荷，最终在攻击者设置的监听器上接收到一个具有SYSTEM权限的反弹Shell。

**投毒风险分析：**
该POC代码的投毒风险被评估为低（10%）。
1.  **代码透明度**：`exploit.cs`代码结构清晰，易于阅读和理解。没有发现明显的代码混淆或加密，使得安全研究人员可以轻松审计其内部逻辑和行为。
2.  **依赖标准库**：代码主要依赖标准的.NET库进行网络通信、加密和文件操作，没有引入大量未知的第三方库，降低了引入恶意依赖的风险。
3.  **无隐藏恶意功能**：POC的核心功能是构造并发送反序列化载荷以获取反弹Shell，这与漏洞利用的目的完全一致。代码中没有发现任何与漏洞利用无关的、可疑的、非预期的恶意行为，例如：窃取用户数据、安装后门、进行DDoS攻击或进行挖矿等。
4.  **固定密钥和随机盐**：虽然代码中硬编码了AES密钥，但这属于反序列化攻击中常见的规避检测和加密载荷的手段，并非投毒行为的证据。随机盐的生成也是加密过程的标准实践。
5.  **PowerShell载荷**：POC生成的PowerShell反弹Shell载荷是该漏洞利用的最终目标，其本身具有“恶意”性质，但这是POC预期功能的一部分，并非POC代码自身被“投毒”。使用者需要明确，运行此POC的目的是在目标系统上执行此“恶意”载荷。
6.  **免责声明**：`README.md`中明确包含免责声明，强调需要获得书面授权才能进行测试，并呼吁负责任和合法地使用。这表明作者的意图是用于合法的安全研究和渗透测试。
综合来看，该POC代码的主要风险在于其利用漏洞的能力，而不是代码本身包含额外的、未声明的恶意功能。用户在运行任何来自外部的代码时，仍应保持警惕，并在隔离环境中进行测试。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
