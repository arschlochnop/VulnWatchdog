## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高 (High)

**CVSS评分:** 9.8

**影响版本:** 8.8.1 及更早版本 (8.8.1 and prior)

**利用条件:** 需要用户交互（社会工程学/点击劫持），攻击者需诱导用户下载恶意文件和合法安装程序到同一目录并在该目录运行安装程序。

**POC 可用性:** 6/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 中 (Medium)

**投毒风险:** 10%

## 详情

CVE-2025-49144 是一个影响 Notepad++ v8.8.1 及更早版本安装程序的严重权限提升漏洞。该漏洞允许非特权用户通过不安全的可执行文件搜索路径获得系统级权限。攻击者可以利用社会工程学或点击劫持等手段，诱使用户将合法的 Notepad++ 安装程序和恶意可执行文件下载到同一目录下。当用户在该目录下运行安装程序时，由于安装程序在 SYSTEM 权限下运行，并且其搜索路径存在漏洞，系统会自动加载攻击者预先放置的恶意文件（例如恶意DLL或EXE），从而使攻击者获得目标机器的完全控制权，严重威胁用户数据和系统的安全。

**POC有效性分析：**
本次提供的POC代码包含两个C#脚本 (`call-agent.cs` 和 `call-agent-no-prompt.cs`) 以及Notepad++ v8.8.1安装程序的SHA256校验和文件。C#脚本的主要功能是启动Notepad++安装程序，其中 `call-agent-no-prompt.cs` 额外包含了删除下载文件“Web标记” (`Zone.Identifier`) 的功能，以避免Windows的安全警告，从而降低用户警惕性，提高社会工程学攻击的成功率。这些脚本本身不包含恶意载荷，它们的作用是模拟用户执行Notepad++安装程序的行为，为漏洞的触发创造条件。因此，它们是漏洞利用链中的一个关键部分，但并非完整的、可直接执行的攻击代码，需要攻击者另外准备一个利用该不安全搜索路径的恶意可执行文件。尽管如此，这些POC代码能够有效地演示如何启动易受攻击的程序，并去除可能阻碍社工攻击成功的安全提示，从而验证了漏洞的触发机制和利用的可行性。其代码逻辑清晰，易于理解和验证，对于安全研究人员理解漏洞原理和复现过程具有较高的参考价值。例如，`call-agent-no-prompt.cs` 使用 `[DllImport("kernel32.dll", CharSet = CharSet.Unicode, SetLastError = true)]` 导入 `DeleteFile` 函数来删除 `Zone.Identifier` 标记，这是一个标准且常见的技术，用于处理从互联网下载文件时的安全区限制。这表明POC作者对Windows安全机制有一定了解，并旨在提供一个更“顺畅”的触发环境。`Process.Start(psi)` 方法则直接调用系统API启动进程，确保了与Notepad++安装程序的交互方式与用户手动双击执行无异。整体而言，POC代码虽不包含最终的恶意载荷，但在展示漏洞触发条件和简化利用准备方面，具有很强的实用性和指导意义。

**利用步骤：**
1.  **准备恶意载荷：** 攻击者首先需要开发一个恶意的DLL或可执行文件，该文件将利用Notepad++安装程序的不安全搜索路径漏洞。这个恶意文件通常会伪装成安装程序所需的一个合法组件，并包含攻击者希望以SYSTEM权限执行的恶意代码（例如，创建一个后门用户、执行远程命令等）。
2.  **社会工程学/点击劫持：** 攻击者通过钓鱼邮件、恶意网站或点击劫持等手段，诱骗目标用户下载两个文件：一个是合法的Notepad++ v8.8.1（或更早版本）安装程序，另一个是上述准备好的恶意可执行文件。关键在于，这两个文件必须被下载并放置在用户的**同一个**本地目录中。
3.  **执行安装程序：** 攻击者诱导用户从该目录下执行Notepad++安装程序。这可以通过多种方式实现，例如，直接让用户双击安装程序，或者像提供的C# POC那样，通过一个辅助脚本来启动安装程序，并移除安全警告。
4.  **权限提升：** 当Notepad++安装程序启动并运行时，由于其以SYSTEM权限执行，它会在查找其依赖组件时，首先在该安装目录中搜索。此时，它会加载攻击者预先放置的恶意文件，而不是系统路径中的合法文件。恶意文件随后以SYSTEM权限执行，赋予攻击者对目标系统的完全控制权。

**投毒风险分析：**
本次提供的POC代码，即`call-agent.cs`和`call-agent-no-prompt.cs`，从代码本身来看，投毒风险评估为低（10%）。代码逻辑非常简洁明了，主要功能集中在两个方面：一是通过`Process.Start`启动指定的安装程序；二是在`call-agent-no-prompt.cs`中，利用`DeleteFile` API删除安装程序的“Web标记” (`Zone.Identifier`)。这两个操作都是合法的系统调用，且代码中没有发现任何混淆、恶意功能（如网络通信、文件写入、注册表修改、动态加载远程代码等）或外部可疑依赖项。所有使用的都是标准的.NET框架库，没有引入第三方不可信组件，代码结构清晰，易于审计。因此，如果攻击者仅提供**这些POC代码**，其自身被植入恶意载荷的风险极低。任何具备基本C#编程知识的安全分析人员都可以轻松地审查并理解其全部功能，确认其不包含隐藏的恶意行为。这种透明度是评估POC代码安全性的一个重要指标。然而，需要明确的是，虽然POC代码本身是干净的，但**漏洞的性质**是允许攻击者注入其**自己的恶意代码**，以获得SYSTEM权限。这意味着，在实际攻击场景中，攻击者提供的“恶意可执行文件”才是真正的威胁来源，与POC代码的清洁性无关。防御者在利用这些POC进行测试时，应确保只运行受信任的Notepad++安装程序，并且在测试环境中模拟恶意文件时，应使用沙盒或其他隔离措施，以避免测试过程中因不当操作而引发的真实系统风险。组织在应对此类漏洞时，除了及时打补丁，还应加强终端用户安全意识培训，警惕不明来源的文件下载，并部署有效的终端检测与响应（EDR）解决方案，以识别和阻止未经授权的进程以高权限运行。考虑到此POC代码的纯粹性和教育目的，其被滥用进行投毒的直接风险很小，但其所演示的漏洞类型则具有极高的潜在危害。

**项目地址:** N/A (POC files provided directly, no repository URL specified)

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
