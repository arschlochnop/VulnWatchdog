## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高

**CVSS评分:** N/A (Awaiting Analysis)

**影响版本:** 8.8.1 及更早版本

**利用条件:** 攻击者需通过社会工程学或点击劫持诱使用户将合法Notepad++安装程序和恶意可执行文件下载到同一目录。用户随后需运行该安装程序，系统将自动以SYSTEM权限加载恶意文件。

**POC 可用性:** 6/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

此POC代码旨在辅助演示Notepad++安装程序（版本8.8.1及更早版本）中存在的严重权限提升漏洞（CVE-2025-49144）。它由一系列辅助文件组成，包括两个C#源代码文件（`call-agent.cs`和`call-agent-no-prompt.cs`）、一个记录Notepad++历史下载链接的文本文件（`archive-org.txt`），以及一个Notepad++ v8.8.1安装程序的SHA256校验和列表（`npp.8.8.1.checksums.sha256`），用于确保下载的安装程序完整性和版本准确性。

**POC有效性分析**
`call-agent.cs`和`call-agent-no-prompt.cs`的核心功能是作为Notepad++合法安装程序的启动器。具体而言，它们通过`System.Diagnostics.Process.Start` API来启动预定义的安装程序（例如`installer_Win8_Win11_x64_*.exe`）。其中，`call-agent-no-prompt.cs`版本额外集成了`DeleteFile`函数，用于删除Windows系统在下载文件后添加的`Zone.Identifier`文件流。这一操作旨在绕过Windows Defender SmartScreen或浏览器可能弹出的“文件来自互联网，可能不安全”警告，从而在实际攻击场景中降低用户的警觉性，提高社会工程学攻击的成功率。

然而，需要明确指出的是，尽管此POC代码提供了启动脆弱安装程序的关键机制，但它本身**并未包含**触发实际SYSTEM权限提升所需的恶意可执行文件。根据公开披露的漏洞描述，该漏洞的本质是Notepad++安装程序在以SYSTEM权限执行时，其内部的可执行文件搜索路径存在缺陷（Unsafe Executable Search Path），导致它会从其当前所在的目录优先加载某些预期的（或可被攻击者劫持的）可执行文件或动态链接库（DLL）。如果攻击者能够成功地将一个精心构造的恶意文件，以安装程序在SYSTEM权限下会加载的特定文件名，放置在与合法Notepad++安装程序相同的目录下，并随后诱导用户运行该安装程序，那么该恶意文件将被SYSTEM权限执行，从而导致权限提升。

因此，本POC代码的有效性体现在它成功地实现了攻击链的“启动器”部分。它能够准确地启动Notepad++安装程序，甚至能够处理掉可能阻碍用户执行的安全提示。但是，要实现完整的权限提升，安全研究人员或潜在攻击者还需要独立准备并部署一个符合安装程序加载条件（即正确的名称和类型）的恶意payload。这意味着，对于防御性研究人员而言，此POC是一个有价值的基础工具，但不足以直接复现完整的SYSTEM权限获取，需要研究人员进一步分析Notepad++安装程序，确定可劫持的文件名，并自行准备相应的恶意payload以完成验证。它的价值在于验证了漏洞触发的前置条件，而非完整的漏洞利用链。

**利用步骤**
1.  **确定目标Notepad++版本**: 攻击者需针对Notepad++版本8.8.1或更早版本进行攻击。
2.  **获取合法安装程序**: 攻击者需获取目标版本的Notepad++合法安装程序，例如POC中提到的`installer_Win8_Win11_x64_*.exe`。`archive-org.txt`提供了历史下载页面的线索。
3.  **准备恶意可执行文件**: 攻击者需要深入分析Notepad++安装程序的行为，以确定在SYSTEM权限下会从其当前目录加载哪些特定的文件名（例如，DLL劫持或不安全的可执行文件搜索路径导致的加载）。随后，攻击者创建一个恶意的可执行文件（例如，一个反向Shell程序、持久化脚本或键盘记录器），并将其重命名为安装程序会加载的特定文件名。
4.  **社交工程/诱导下载**: 攻击者利用钓鱼邮件、恶意网站、或点击劫持等社会工程学手段，诱导受害者下载并保存以下三个文件到**同一个本地目录**：合法的Notepad++安装程序、攻击者准备的恶意可执行文件、以及编译后的POC启动程序（例如，`call-agent-no-prompt.exe`）。
5.  **诱导执行POC**: 攻击者进一步诱导受害者运行编译后的POC启动程序。此程序会首先尝试删除Notepad++安装程序的`Zone.Identifier`流，以避免Windows的安全警告，然后启动Notepad++安装程序。
6.  **权限提升**: 当Notepad++安装程序启动时，它将以SYSTEM权限运行。在启动过程中，安装程序会检查当前目录，并按照其内部逻辑加载其所需的特定文件。由于攻击者已将恶意文件放置在同一目录并命名为安装程序会加载的名称，系统会错误地加载并执行该恶意文件，并且是以SYSTEM权限执行。
7.  **完全控制**: 恶意文件获得SYSTEM权限后，攻击者便能获得目标机器的完全控制权，执行任意系统命令、窃取数据、安装后门等。

**投毒风险分析**
对于防御性安全研究而言，此POC代码的投毒风险评定为**极低，约为5%**。主要基于以下分析：
1.  **代码透明度高**: 提供的C#源代码（`call-agent.cs`和`call-agent-no-prompt.cs`）清晰易读，没有进行任何代码混淆，方便安全研究人员进行审计。其逻辑简单直接，核心功能是利用`Process.Start`启动外部程序以及`DeleteFile`删除特定文件流。
2.  **功能无害**: POC代码本身并未包含恶意payload，也不是一个完整的利用工具。它仅是一个“启动器”，用于启动Notepad++的合法安装程序。即便其`call-agent-no-prompt.cs`包含了删除`Zone.Identifier`的功能，这只是为了绕过Windows的安全警告，并非执行恶意操作，且此操作是针对特定的安装程序文件，不影响系统其他部分。
3.  **无外部依赖或网络通信**: 代码中没有发现任何试图从外部URL下载恶意内容、连接C2服务器、执行`eval()`或加载未经验证的外部脚本的行为。所有操作均在本地进行，且针对已知文件。
4.  **无持久化机制**: POC代码不包含任何试图在目标系统上建立持久化机制（如修改注册表、创建计划任务、安装服务）的代码。它的生命周期仅限于启动Notepad++安装程序。
5.  **职责明确**: 此POC明确是为了演示如何启动Notepad++安装程序，为研究人员提供一个基础的触发机制，以配合自己准备的恶意payload来验证权限提升漏洞。它并非一个独立工作的恶意软件。
鉴于上述因素，研究人员在分析或运行此POC时，只要确保Notepad++安装程序和任何可能被放置在同一目录下的额外文件是已知和可信的，则不会面临代码本身带来的投毒风险。真正的风险在于攻击者如何将恶意payload与合法的安装程序和此POC（或其变体）结合，并将其作为攻击包的一部分进行传播。

**项目地址:** 无 (POC代码片段，未提供完整仓库地址)

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
