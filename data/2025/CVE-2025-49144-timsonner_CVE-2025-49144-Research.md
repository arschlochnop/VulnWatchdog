## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 严重 (Critical)

**CVSS评分:** Awaiting Analysis

**影响版本:** 8.8.1及之前版本 (versions 8.8.1 and prior)

**利用条件:** 需要用户交互（社会工程学或点击劫持诱使用户下载并运行安装程序和恶意可执行文件到同一目录）

**POC 可用性:** 7/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-49144是Notepad++安装程序中存在的一个权限提升漏洞，影响8.8.1及之前版本。该漏洞的根本原因是Notepad++安装程序（通常以SYSTEM权限运行）存在不安全的DLL/可执行文件搜索路径。攻击者可以利用社会工程学或点击劫持等手段，诱使用户将合法的Notepad++安装程序和恶意可执行文件（例如，精心制作的DLL或EXE，其文件名与安装程序在加载其依赖项时会搜索的某个文件相匹配）下载到同一目录。当用户运行该合法安装程序时，系统会自动以SYSTEM权限加载并执行位于同一目录下的恶意文件，从而使攻击者获得目标机器的完全控制权，严重威胁用户数据和系统安全。

**POC有效性分析：**
提供的POC代码包括两个C#文件：`call-agent.cs`和`call-agent-no-prompt.cs`。这两个文件是为启动Notepad++安装程序而设计的辅助工具，而非直接执行权限提升的恶意载荷。`call-agent.cs`的功能是简单地通过`Process.Start`方法启动指定路径下的安装程序。`call-agent-no-prompt.cs`则在此基础上增加了一个关键的步骤：它调用`DeleteFile`函数并指定`:Zone.Identifier`流，以移除安装程序的“网页标记（Mark of the Web）”。这个操作旨在绕过Windows在执行从互联网下载的文件时可能出现的安全警告，从而使攻击流程更为顺畅，降低用户警惕性。从POC的角度来看，这些代码有效地验证了攻击链中的关键第一步：自动化并隐蔽地触发易受攻击的Notepad++安装程序的执行。虽然它们本身不包含特权提升的逻辑，但它们为攻击者提供了一个可行的机制来启动漏洞利用的基础条件。因此，POC在验证触发机制和辅助攻击流程方面是有效且功能完整的，但在实现完整的SYSTEM权限获取方面还需要配合额外的恶意文件。

**利用步骤：**
1.  **制作恶意载荷**：攻击者首先需要开发一个恶意的可执行文件（例如，一个动态链接库DLL或可执行文件EXE）。这个恶意文件必须经过精心命名，使其与Notepad++安装程序在执行过程中会在当前目录中搜索的某个合法依赖项的名称相匹配。恶意载荷应包含攻击者希望以SYSTEM权限执行的操作，如创建后门用户、启动反向Shell或执行任意代码。
2.  **社会工程学投递**：攻击者利用社会工程学技术（如钓鱼邮件、虚假下载网站、恶意广告等）或点击劫持手段，诱导受害者下载两个文件：一个是被篡改的、存在漏洞的Notepad++安装程序（版本8.8.1或更早），以及攻击者制作的恶意可执行文件。这两个文件必须被下载并放置在受害者机器上的**同一个目录**中。
3.  **诱导执行**：攻击者随后诱导受害者运行Notepad++安装程序。这可以通过直接要求受害者双击安装程序完成，或者通过捆绑一个辅助程序（如提供的`call-agent.cs`或`call-agent-no-prompt.cs`，甚至经过伪装的快捷方式）来自动化启动过程，并可能移除“网页标记”以减少用户摩擦。
4.  **权限提升**：当受害者执行Notepad++安装程序时，该程序会以SYSTEM权限启动。由于存在不安全的搜索路径漏洞，安装程序在加载其依赖项时，会优先在当前目录中查找。此时，它将发现并加载攻击者放置的恶意可执行文件，而非系统路径下的合法文件。由于安装程序本身以SYSTEM权限运行，恶意文件也将以相同的SYSTEM权限执行。
5.  **完全控制**：恶意文件获得SYSTEM权限后，攻击者便能完全控制目标系统，可以执行任意操作，包括但不限于数据窃取、安装持久性后门、进一步横向移动、破坏系统或进行勒索。

**投毒风险分析：**
根据提供的C# POC代码（`call-agent.cs`和`call-agent-no-prompt.cs`），评估其自身的投毒风险为**低**（5%）。具体分析如下：
*   **代码清晰度**：POC代码结构简单，逻辑清晰，易于阅读和理解。它没有使用任何混淆技术、加密或复杂的数据结构来隐藏其真实意图。代码主要专注于调用标准的操作系统API来启动进程和执行文件操作。
*   **标准库使用**：代码完全依赖于.NET框架的标准库，如`System.Diagnostics`用于进程管理，`System.IO`用于文件路径操作，以及`System.Runtime.InteropServices`用于调用Windows API（`DeleteFile`）。没有发现任何调用非标准、可疑或不常用库的情况。
*   **无恶意载荷**：这两个POC文件本身不包含任何嵌入式恶意载荷、shellcode、病毒或蠕虫功能。它们没有尝试进行数据窃取、键盘记录、屏幕截图或任何其他形式的恶意监控。
*   **无网络活动**：代码中没有包含任何网络连接、远程通信、文件下载或数据外传的代码逻辑。它仅在本地文件系统上操作。
*   **“网页标记”移除**：`call-agent-no-prompt.cs`中移除“网页标记”的功能，虽然可能被恶意利用来降低用户警惕，但该功能本身是合法的Windows API调用，并非恶意行为。在安全研究和自动化脚本中，有时会使用此功能来简化对已知安全文件的操作流程，以减少不必要的安全提示。
*   **总结**：这些POC代码是纯粹的触发器或辅助工具，用于启动一个已知的易受攻击的应用程序，并不包含或引入任何恶意代码。它们是实现攻击链的一部分，但本身并非恶意软件。因此，从POC代码本身的完整性和行为来看，其直接投毒风险极低。组织在评估此漏洞时，应将重点放在修补Notepad++软件漏洞本身以及加强用户对社会工程学的防范意识上，而非担忧此POC代码的安全性。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
