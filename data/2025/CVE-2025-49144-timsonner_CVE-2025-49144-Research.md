## CVE-2025-49144 - Notepad++ 权限提升 (Privilege Escalation) / 二进制植入 (Binary Planting) / 不受控搜索路径 (Uncontrolled Search Path)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升 (Privilege Escalation) / 二进制植入 (Binary Planting) / 不受控搜索路径 (Uncontrolled Search Path)

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** v8.8.1 及之前版本

**利用条件:** 本地访问权限，非特权用户，需要用户执行Notepad++安装程序

**POC 可用性:** 6/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

Notepad++ v8.8.1及之前版本安装程序中存在一个高危本地权限提升漏洞（CVE-2025-49144）。该漏洞源于安装程序未能妥善处理可执行文件搜索路径，导致存在"二进制植入"（Binary Planting）漏洞。未授权的本地用户可以通过在安装程序所在目录放置恶意可执行文件，从而劫持合法系统工具的调用，最终将权限提升至SYSTEM。

**POC有效性分析：**
提供的POC代码片段包含两个C#文件（`call-agent.cs` 和 `call-agent-no-prompt.cs`），它们的主要功能是启动Notepad++ v8.8.1安装程序。其中，`call-agent-no-prompt.cs` 额外尝试移除下载文件中的“Web标记”（Mark of the Web），以避免安全警告。这些C#文件本身并非完整的漏洞利用代码，它们仅作为启动器的角色，用于触发Notepad++安装程序的执行。实际的漏洞利用需要攻击者预先在安装程序同目录下放置一个精心构造的恶意可执行文件，例如命名为`regsvr32.exe`。当合法的Notepad++安装程序启动时，它会按照其内部的搜索路径逻辑，优先在当前目录中查找并执行`regsvr32.exe`等系统工具。此时，由于攻击者控制了该路径，安装程序便会加载并执行恶意的`regsvr32.exe`，而非系统自带的合法程序，从而实现任意代码执行，并由于安装程序通常以更高权限运行，最终导致权限提升。尽管提供的POC代码仅包含触发部分，但结合搜索结果，多个安全研究团队已经成功复现并验证了此漏洞的有效性，证明了通过“二进制植入”方式劫持安装程序调用路径的可行性。GitHub上也已出现完整的POC项目，进一步证实了漏洞的可利用性。

**利用步骤：**
1.  **准备易受攻击的安装程序：** 获取Notepad++ v8.8.1或更早版本的安装程序文件（例如 `npp.8.8.1.Installer.x64.exe`）。
2.  **创建恶意载荷：** 编写一个恶意可执行文件，其功能包括但不限于执行后门、创建新用户、禁用安全防护等，并确保该文件能够以SYSTEM权限运行。将此恶意文件命名为Notepad++安装程序在执行过程中会调用的合法系统工具名称，例如`regsvr32.exe`。
3.  **放置恶意文件：** 将步骤2中创建的恶意`regsvr32.exe`文件放置在与Notepad++安装程序相同的目录下。
4.  **执行安装程序：** 运行Notepad++安装程序。当安装程序尝试调用`regsvr32.exe`时，由于当前目录优先于系统路径，它将加载并执行攻击者放置的恶意`regsvr32.exe`。
5.  **权限提升：** 恶意代码在安装程序的SYSTEM权限下执行，从而实现本地权限提升。

**投毒风险分析：**
就提供的POC代码文件 (`call-agent.cs` 和 `call-agent-no-prompt.cs`) 而言，其投毒风险评估为**低（0%）**。这些C#代码是清晰且易于理解的，它们的功能仅限于启动指定的Notepad++安装程序文件，不包含任何恶意载荷、代码混淆、可疑的外部网络请求或对系统进行不当修改的行为。`call-agent-no-prompt.cs` 中删除`Zone.Identifier`的操作也只是为了绕过Windows的安全提示，并非恶意行为本身。

然而，需要强调的是，尽管POC代码本身是无害的，但**CVE-2025-49144这一漏洞本身的性质使其成为进行投毒和恶意攻击的高风险载体**。攻击者可以利用此漏洞，通过“钓鱼攻击”或在用户下载并运行安装程序前，将伪装成合法系统工具的恶意可执行文件植入到安装目录中。一旦用户执行了被劫持的Notepad++安装程序，恶意代码将以SYSTEM权限运行，从而在目标系统上部署木马、勒索软件或其他恶意软件。这种利用供应链攻击（利用用户对合法软件的信任）的方式，使得该漏洞在实际攻击场景中具有极高的威胁和投毒潜力。因此，虽然分析的POC代码本身是干净的，但应对此漏洞保持高度警惕，并通过升级软件版本、强化终端安全策略等方式进行有效防御。

**项目地址:** https://github.com/TheTorjanCaptain/CVE-2025-49144_PoC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
