## CVE-2025-49144 - Notepad++ 特权提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 特权提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高 (High)

**CVSS评分:** 

**影响版本:** v8.8.1 及更早版本

**利用条件:** 需要本地访问和用户交互来执行易受攻击的安装程序

**POC 可用性:** 7/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-49144是一个高危的本地特权提升漏洞，影响Notepad++ v8.8.1及更早版本。该漏洞源于安装程序中存在的“未受控制的安装程序路径缺陷（uncontrolled installer path flaw）”或称为“二进制植入（binary planting）”问题。当Notepad++的安装程序在执行时，由于其设计缺陷，可能会在特定的、可预测的路径中（例如，安装程序自身的当前工作目录）寻找并加载特定的动态链接库（DLL）或其他可执行文件。如果攻击者能够在此路径中放置一个精心构造的恶意DLL或EXE，并在管理员权限下运行的Notepad++安装程序被启动时，该恶意文件就会被加载并以安装程序的权限（通常是SYSTEM权限）执行。这意味着攻击者可以利用此漏洞绕过权限限制，获取系统最高权限。
提供的POC代码包括两个C#文件：`call-agent.cs` 和 `call-agent-no-prompt.cs`。这两个文件都旨在启动Notepad++的安装程序。
`call-agent.cs` 是一个基础的C#应用程序，它通过 `Process.Start` 方法启动位于其自身目录下的一个名为 `installer_Win8_Win11_x64_*.exe` 的安装程序。此POC的核心功能是作为触发器，模拟用户执行安装程序的操作。
`call-agent-no-prompt.cs` 在 `call-agent.cs` 的基础上增加了一个关键功能：它尝试通过调用 `kernel32.dll` 中的 `DeleteFile` 函数来删除目标安装程序的“Web标记（Mark of the Web）”区域标识符（`Zone.Identifier`）。Web标记是Windows操作系统的一个安全特性，用于识别从互联网下载的文件，并在用户尝试执行这些文件时显示安全警告。删除Web标记可以使安装程序在运行时不弹出安全警告，从而降低用户对可疑行为的警觉，提高攻击的成功率。
这两个POC代码本身并不包含用于特权提升的恶意DLL或EXE payload。它们的作用是展示如何启动Notepad++的易受攻击的安装程序，从而为实际的二进制植入攻击提供了一个启动机制。因此，这些POC是有效的概念验证工具，它们演示了如何利用用户交互来触发漏洞的执行路径。其有效性在于成功启动了易受攻击的安装程序，而安装程序自身的漏洞处理将导致特权提升。攻击者需要额外提供一个恶意二进制文件来完成最终的特权提升。

**利用步骤**:
1.  **准备恶意Payload**: 攻击者首先需要开发或获取一个恶意的DLL或EXE文件。该文件旨在在获得SYSTEM权限后执行攻击者的指令，例如创建后门、窃取数据或部署其他恶意软件。
2.  **定位漏洞触发点**: 攻击者研究Notepad++ v8.8.1或更早版本的安装程序，识别其在哪个目录、以什么名称查找并加载外部二进制文件（例如，特定的DLL文件，通常在当前执行目录下或PATH环境变量中）。
3.  **部署恶意文件**: 攻击者将恶意Payload放置在步骤2中确定的易受攻击的安装程序会搜索的目录中。例如，如果安装程序在自身所在的目录中寻找 `version.dll`，攻击者就会将恶意DLL命名为 `version.dll` 并放置在那里。
4.  **分发POC和安装程序**: 攻击者将易受攻击的Notepad++安装程序（例如 `npp.8.8.1.Installer.x64.exe`）、C# POC应用程序（编译后的 `call-agent.exe` 或 `call-agent-no-prompt.exe`）以及恶意Payload打包在一起，并诱骗受害者下载并解压到同一个文件夹中。
5.  **诱骗用户执行**: 攻击者诱骗目标用户运行C# POC应用程序。例如，通过钓鱼邮件、恶意网站下载等方式。
6.  **触发漏洞**: 当用户运行C# POC应用程序时，该POC会启动Notepad++的安装程序。
7.  **特权提升**: Notepad++安装程序在执行过程中，会以高权限（通常为SYSTEM）在预期的路径中查找并加载二进制文件。此时，它会加载攻击者放置的恶意Payload，并以SYSTEM权限执行，从而实现特权提升，授予攻击者对系统的完全控制权。

**投毒风险分析**:
对提供的POC代码 (`call-agent.cs` 和 `call-agent-no-prompt.cs`) 进行分析，可以判断其直接投毒风险较低。这两段C#代码的功能非常明确且有限：它们仅仅是用于启动一个指定的Notepad++安装程序。代码中没有发现任何恶意载荷、混淆技术、对外部可疑资源的连接请求、动态代码执行（如 `eval`）、或者其他典型的恶意行为模式。
`call-agent.cs` 只是简单地通过 `Process.Start` 调用了位于同一目录下的安装程序。
`call-agent-no-prompt.cs` 增加了一个 `DeleteFile` 的API调用，用于删除从互联网下载文件时操作系统附加的“Web标记（Zone.Identifier）”。虽然这种行为在某些恶意软件中也会出现，但其目的通常是为了绕过安全警告，使恶意软件运行得更“顺畅”。在本次漏洞的POC场景中，它仅仅是尝试避免用户在运行安装程序时看到安全提示，属于一种利用增强而非直接的恶意行为。它的调用目标是操作系统自身的API `kernel32.dll!DeleteFile`，而非某个外部恶意库。
因此，就POC代码本身而言，它不具备自我传播、窃取信息、破坏系统等直接的恶意能力。它是一个干净的、专注于演示漏洞触发机制的工具。
然而，需要注意的是，低风险的POC代码并不意味着整个攻击链的风险就低。真正的“投毒”风险存在于攻击者如何将这个POC与恶意Payload（即通过二进制植入技术加载的DLL或EXE）结合。攻击者可能会：
1.  **捆绑恶意Payload**: 将此POC、Notepad++易受攻击的安装程序和攻击者的恶意DLL/EXE一起打包分发。用户下载并运行POC时，就会间接触发恶意Payload。
2.  **修改安装程序**: 攻击者可以对Notepad++的安装程序进行修改，在其中嵌入后门或使其直接加载恶意组件，然后将修改后的安装程序作为“投毒”载体。
3.  **社会工程学**: 攻击者可能利用POC作为诱饵，通过社会工程学手段诱骗用户下载并执行，从而在用户不知情的情况下，为后续的恶意活动铺平道路。
综上所述，虽然POC代码本身是无害的，但它为攻击者提供了一个方便的触发工具。组织在防御时，除了要修补Notepad++漏洞外，还应关注对可执行文件的来源审计、用户安全意识培训以及终端检测与响应（EDR）解决方案，以防范与此类POC结合的恶意攻击。

**项目地址:** 

**漏洞详情:** https://www.sogou.com//link?url=hedJjaC291NO0MtHpTcLO3dQmtdCSFRLCKJHXJs1wXcDZwF9M2OsSYJ6nkCx6RuU
