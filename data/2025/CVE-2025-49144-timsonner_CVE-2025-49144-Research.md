## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高危，允许攻击者通过不安全的可执行文件搜索路径获得系统级权限，从而获得目标机器的完全控制权。

**CVSS评分:** N/A - Awaiting Analysis

**影响版本:** 8.8.1 及更早版本

**利用条件:** 需要用户交互（社会工程学或点击劫持），诱导用户将合法Notepad++安装程序和攻击者提供的恶意可执行文件下载到同一目录，并运行安装程序。

**POC 可用性:** 6

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

CVE-2025-49144是Notepad++安装程序中存在的一个严重的权限提升漏洞。该漏洞影响Notepad++ 8.8.1及更早版本。其核心机制在于安装程序在执行过程中存在不安全的可执行文件搜索路径。这意味着，当用户运行Notepad++的合法安装程序时，系统会自动以SYSTEM权限搜索并加载特定名称的辅助可执行文件或DLL。如果攻击者能够诱使用户将一个精心构造的恶意可执行文件（例如，具有特定名称的DLL或EXE）放置在与合法Notepad++安装程序相同的目录下，那么当用户启动合法安装程序时，该恶意文件将被Windows系统以SYSTEM权限加载并执行。这使得攻击者能够获得目标机器的完全控制权，从而对用户数据和系统安全构成严重威胁。

**利用步骤**:
攻击者利用此漏洞的典型步骤如下：
1.  **准备恶意载荷**: 攻击者首先需要创建一个恶意可执行文件（例如，一个反弹Shell程序、键盘记录器或持久化后门），并将其命名为Notepad++安装程序在执行时会以SYSTEM权限搜索并加载的文件名（例如，`Update.exe`或某个特定的DLL）。这个恶意载荷将是攻击者最终获得SYSTEM权限的工具。
2.  **获取合法安装程序**: 攻击者需要获得受影响版本的Notepad++（如v8.8.1）的合法安装程序。POC中提供的`archive-org.txt`链接指向了Notepad++ 8.8.1的下载页面，表明攻击者可以轻易获取到。
3.  **诱导用户下载**: 攻击者通过社会工程学手段（如钓鱼邮件、虚假网站、恶意广告等）或点击劫持技术，诱骗受害者将合法Notepad++安装程序以及攻击者准备的恶意可执行文件下载到目标机器的同一个目录中。这是攻击成功的关键步骤，需要用户的配合。
4.  **执行安装程序**: 受害者被诱导运行Notepad++的合法安装程序。POC中提供的`call-agent.cs`和`call-agent-no-prompt.cs`脚本就是为了方便这一步骤。这些脚本会尝试启动位于当前目录下的Notepad++安装程序。其中，`call-agent-no-prompt.cs`甚至会尝试移除Windows下载文件自带的"Mark of the Web"安全警告，使安装过程看起来更“无害”。
5.  **权限提升与控制**: 当合法Notepad++安装程序启动时，由于其不安全的可执行文件搜索路径特性，它会优先在当前目录中搜索并加载攻击者放置的恶意可执行文件。由于Notepad++安装程序通常需要SYSTEM权限才能完成安装，因此，这个恶意文件也将以SYSTEM权限运行，从而赋予攻击者对目标机器的完全控制权。

**POC有效性分析**:
所提供的POC代码由三个主要部分组成：`archive-org.txt`、`call-agent.cs`和`call-agent-no-prompt.cs`，以及一个Notepad++安装程序的SHA256校验文件`npp.8.8.1.checksums.sha256`。
1.  `archive-org.txt`：这个文件提供了一个指向Notepad++ 8.8.1版本下载页面的Archive.org链接。这验证了攻击者可以获取到受漏洞影响的Notepad++安装程序，是漏洞复现的基础。
2.  `npp.8.8.1.checksums.sha256`：提供了Notepad++ 8.8.1安装程序和便携版文件的SHA256校验和。这有助于研究人员或攻击者验证下载的Notepad++安装程序是否合法且未被篡改，确保漏洞存在于原始软件中。
3.  `call-agent.cs` 和 `call-agent-no-prompt.cs`：这两个C#脚本是用于启动Notepad++安装程序的辅助工具。它们的功能是自动化运行指定目录下的Notepad++安装程序。`call-agent-no-prompt.cs` 更进一步，尝试通过调用`DeleteFile` API删除安装程序的"Zone.Identifier"流，以绕过Windows关于下载文件的安全警告。
这些POC脚本本身并没有直接包含权限提升的恶意载荷。它们的作用是启动作为漏洞触发点的合法Notepad++安装程序。漏洞的实际利用需要攻击者额外提供一个能够被Notepad++安装程序以SYSTEM权限加载的恶意可执行文件（例如，一个命名为`Update.exe`的恶意程序或恶意DLL）。
因此，从严格意义上讲，这些POC代码是**概念验证性质**的。它们展示了攻击者如何自动化地启动漏洞触发程序，并解决了可能的用户交互障碍（如安全警告），但没有提供完整的攻击链，即缺少了真正的SYSTEM权限恶意载荷。然而，它们对于理解漏洞的触发机制和部署自动化攻击仍然具有重要的参考价值。它们有效地模拟了用户在社会工程学攻击下运行安装程序这一关键步骤。若要实现完整的权限提升，研究人员或攻击者需根据Notepad++安装程序的具体行为，识别出被SYSTEM权限加载的文件名，并创建相应的恶意文件。

**投毒风险分析**:
对所提供的POC代码进行详细审查后，评估其投毒风险为**低（0%）**。
1.  **代码行为透明**: `call-agent.cs` 和 `call-agent-no-prompt.cs` 两个C#脚本的代码逻辑非常清晰和简单。它们的主要功能是构建Notepad++安装程序的路径，并使用`Process.Start`方法启动该安装程序。`call-agent-no-prompt.cs`额外包含了一个P/Invoke调用`DeleteFile`来移除文件的"Mark of the Web"（Zone.Identifier），这是一个常见的安全研究和攻击准备步骤，旨在减少用户警惕性，但并非恶意行为本身。
2.  **标准库使用**: POC代码中使用的命名空间（`System`, `System.Diagnostics`, `System.IO`, `System.Runtime.InteropServices`）都是.NET框架的标准库。没有发现任何可疑的第三方库引用或非标准API调用。
3.  **无外部连接或数据传输**: 代码中没有发现任何尝试建立网络连接、下载外部资源、与C2服务器通信或向外部地址发送数据的行为。所有操作都限制在本地文件系统层面。
4.  **无代码混淆或加密**: POC代码以明文形式提供，没有进行任何混淆、加密或打包处理，便于安全研究人员阅读和分析其真实意图。
5.  **核心漏洞的界定**: 重要的是要区分POC代码本身与漏洞利用的最终恶意载荷。此CVE涉及Notepad++安装程序在SYSTEM权限下不安全地加载*攻击者提供的恶意文件*。所提供的C# POC代码是用于启动*合法*Notepad++安装程序，它本身不是那个被SYSTEM权限加载的恶意文件。因此，POC代码本身不包含后门或恶意逻辑。它的作用是作为攻击过程中的一个辅助工具，促使漏洞的触发。
综上所述，这些POC代码是合法且无害的辅助脚本，旨在协助复现或触发Notepad++安装程序的权限提升漏洞。它们本身不构成投毒风险，不包含任何恶意代码、后门或可疑行为。研究人员可以安全地分析和运行这些POC代码，以理解漏洞的运作方式。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
