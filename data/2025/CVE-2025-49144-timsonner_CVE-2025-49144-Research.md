## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** 8.8.1及之前版本

**利用条件:** 需要用户交互，攻击者需诱导用户将恶意文件与合法安装程序放置于同一目录并执行安装程序，实现本地权限提升

**POC 可用性:** 7

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

Notepad++ v8.8.1及之前版本的安装程序中存在一个严重的权限提升漏洞 (CVE-2025-49144)。该漏洞源于安装程序在加载其所需组件时，存在不安全的可执行文件搜索路径。当用户运行Notepad++安装程序时，系统会以SYSTEM权限执行该程序。如果攻击者能够诱导用户将一个恶意的可执行文件（例如，恶意的DLL或EXE）放置在与合法Notepad++安装程序相同的目录下，安装程序在启动时可能会优先加载并执行这个恶意文件，从而导致攻击者以SYSTEM权限在目标机器上执行任意代码，获得完全控制权。

**POC有效性分析**:
提供的POC代码包含两个C#文件 (`call-agent.cs` 和 `call-agent-no-prompt.cs`) 以及一些辅助文件（`archive-org.txt` 和 `npp.8.8.1.checksums.sha256`）。
`archive-org.txt` 提供了Notepad++ v8.8.1下载链接的存档快照，用于指明受影响的特定版本。`npp.8.8.1.checksums.sha256` 提供了该版本安装程序及相关文件的哈希值，用于验证文件的完整性，确保下载到的是正确的、未被篡改的漏洞版本。
`call-agent.cs` 和 `call-agent-no-prompt.cs` 是用于启动Notepad++安装程序的简单C#程序。它们通过 `Process.Start` 函数来执行指定路径下的安装程序。`call-agent-no-prompt.cs` 相较于 `call-agent.cs` 多了一个功能，即使用 `DeleteFile` API 调用来删除安装程序的 "Mark of the Web" (Zone.Identifier)。"Mark of the Web" 是Windows系统为从互联网下载的文件添加的一个安全标识，旨在提示用户文件来源，并在打开时触发安全警告。移除此标识可以使安装程序在运行时不弹出安全警告，从而降低用户警惕性，提高社会工程学攻击的成功率。
这些POC代码本身不包含直接的恶意负载，它们的作用是作为触发器，启动Notepad++安装程序，以便该安装程序能够加载并执行攻击者预先放置在同一目录下的恶意文件。因此，这些POC代码验证了漏洞利用的前置步骤和触发机制的有效性，即能够正确地启动受漏洞影响的Notepad++安装程序，并辅助攻击者绕过一些安全提示。要完成完整的权限提升，还需要一个专门制作的恶意DLL或EXE文件，该文件需要在安装程序启动时被加载。从这个角度看，POC是有效的，它演示了如何启动攻击链的关键环节。

**利用步骤**:
1.  **确定目标版本**: 确认目标系统上安装的Notepad++版本为8.8.1或更早版本，或者攻击者可以诱导用户下载安装此版本。
2.  **获取漏洞安装程序**: 从官方渠道或受信任来源下载Notepad++ v8.8.1的安装程序（例如 `npp.8.8.1.Installer.x64.exe`）。
3.  **创建恶意负载**: 制作一个恶意的DLL文件（例如，伪装成Notepad++安装程序会尝试加载的某个系统DLL，如 `version.dll` 或 `dwmapi.dll`，具体取决于Notepad++安装程序实际的DLL搜索顺序），或一个恶意的可执行文件。该恶意文件应包含攻击者想要以SYSTEM权限执行的代码。
4.  **社会工程学/点击劫持**: 攻击者需要诱骗用户下载合法Notepad++安装程序和恶意文件到同一个目录中（例如，用户的"下载"文件夹）。攻击者可以创建一个恶意网页，利用点击劫持技术，诱使用户在不知情的情况下将这两个文件下载到指定目录。
5.  **触发漏洞**: 诱导用户运行Notepad++安装程序。攻击者可以使用提供的 `call-agent-no-prompt.cs` 编译成的可执行文件来启动安装程序，或者直接让用户双击安装程序。
6.  **权限提升**: 当Notepad++安装程序启动时，它会以SYSTEM权限运行，并根据其不安全的DLL搜索路径机制，加载并执行同一目录下的恶意文件。恶意文件中的代码将以SYSTEM权限执行，从而实现权限提升，攻击者获得对目标系统的完全控制。

**投毒风险分析**:
提供的POC代码（`call-agent.cs` 和 `call-agent-no-prompt.cs`）本身具有**低风险**的投毒潜力（投毒风险：0%）。经过详细分析，这两个C#文件不包含任何恶意代码、代码混淆、可疑的外部网络请求或对系统敏感资源的非正常访问。
1.  **代码清晰度与可审计性**: POC代码逻辑直观明了，使用了标准C#语法和库，易于任何具备基本C#编程知识的安全研究人员进行审计。其核心功能是获取当前程序所在目录，构建Notepad++安装程序的完整路径，然后通过 `System.Diagnostics.Process.Start` 方法启动该安装程序。这种行为是典型的程序启动操作，不涉及任何复杂或隐蔽的恶意逻辑。
2.  **标准库与API使用**: 代码中主要依赖于 `System.Diagnostics` 和 `System.IO` 命名空间下的标准类和方法，这些都是.NET框架的组成部分，用于进程管理和文件路径操作，其使用方式符合常规编程范式。`call-agent-no-prompt.cs` 文件中引入的 `kernel32.dll` 并调用 `DeleteFile` 函数，旨在删除Windows系统为从互联网下载的文件添加的"Mark of the Web" (Zone.Identifier) 标识。这一API调用虽涉及操作系统底层功能，但在安全测试和利用场景中，其目的是为了规避用户界面的安全警告，使得漏洞利用流程更为顺畅和隐蔽。这种做法是安全研究工具中的常见特性，并非直接的恶意载荷。它修改的是文件的元数据流，而不是文件内容本身，且不具有持续性的危害。
3.  **无恶意负载或后门**: POC代码的设计目标是启动一个特定的程序（Notepad++安装程序），而不是植入恶意软件、建立后门、窃取数据或进行加密货币挖掘。它不包含任何直接执行攻击者指令或在目标系统上留下持久化机制的代码。真正的权限提升恶意负载（如特制的DLL文件）是漏洞利用的 *另一个* 组成部分，需要攻击者另外制作并部署。POC代码本身并未集成或生成此类恶意负载。
4.  **无外部通信或数据泄露**: 代码中没有检测到任何试图建立网络连接、向外部服务器发送数据、下载远程脚本或执行其他形式的外部通信行为。这意味着POC在执行过程中不会将任何信息泄露给攻击者，也不会从外部获取并执行不受信任的代码。
5.  **无代码混淆或规避技术**: 提供的POC代码未进行任何形式的混淆处理，其意图完全透明。它没有使用反调试、反虚拟机或任何其他旨在规避安全检测的复杂技术。
**总结**: 鉴于以上多方面的分析，该POC代码本身在功能上是纯净的，不具有投毒能力，其设计目的仅限于合法地演示或触发漏洞利用的初始阶段。其行为可预测，且不包含任何隐藏的恶意组件。因此，组织在进行防御性安全研究和验证此POC时，可以放心地编译和运行这些C#代码，但必须严格区分POC代码本身与在实际漏洞利用过程中需要准备的、可能包含真正恶意功能的 *额外负载文件*。对额外负载文件的安全性进行严格审查是至关重要的。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
