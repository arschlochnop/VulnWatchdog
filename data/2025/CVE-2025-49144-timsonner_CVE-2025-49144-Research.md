## CVE-2025-49144 - Notepad++ 本地权限提升 (Binary Planting)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 本地权限提升 (Binary Planting)

**影响应用:** Notepad++

**危害等级:** 高

**CVSS评分:** 

**影响版本:** Notepad++ v8.8.1 及更早版本

**利用条件:** 需要本地访问权限，用户需执行恶意诱导的Notepad++ v8.8.1安装程序。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49144是Notepad++ v8.8.1版本安装程序中存在的一个严重的本地权限提升漏洞。该漏洞的根本原因是“未受控的可执行文件搜索路径”（Uncontrolled Executable Search Path），也称为“二进制植入”（Binary Planting）漏洞。当用户运行Notepad++ v8.8.1的安装程序时，该程序在执行过程中会调用一些系统组件或程序（例如`regsvr32.exe`）。然而，在查找这些可执行文件时，安装程序会优先在其当前所在目录进行搜索，而不是直接从系统路径中加载。攻击者可以利用这一特性，在包含合法Notepad++安装程序的同一目录下放置一个同名（例如，名为`regsvr32.exe`）的恶意可执行文件。当用户启动Notepad++安装程序时，该恶意文件会被安装程序错误地加载并执行。由于安装程序通常需要管理员权限才能运行（或触发UAC提示，用户为安装合法软件通常会接受），因此攻击者植入的恶意程序也将以与安装程序相同的、通常是SYSTEM级别的高权限运行，从而导致本地系统权限的完全获取。这使得攻击者能够完全控制受影响的系统，执行任意代码，窃取敏感数据，甚至部署持久化后门。

**POC有效性分析:**
提供的POC代码包括两个C#脚本文件（`call-agent.cs`和`call-agent-no-prompt.cs`）、一个Notepad++ v8.8.1安装程序的校验和文件（`npp.8.8.1.checksums.sha256`）以及一个指向Notepad++ v8.8.1下载页面的存档链接（`archive-org.txt`）。这些C#脚本旨在启动Notepad++的安装程序。其中，`call-agent-no-prompt.cs`脚本额外包含了一项功能，即尝试删除目标安装程序的“网页标记”（Mark of the Web，Zone.Identifier），这是一个常见的安全特性，用于提示用户文件来源于互联网。删除此标记可以帮助攻击者规避用户在执行下载文件时可能遇到的安全警告，从而提高社会工程学攻击的成功率。虽然这些POC脚本本身并未直接包含用于“二进制植入”的恶意负载（例如一个恶意的`regsvr32.exe`），但它们成功地演示了攻击链中的关键第一步：启动易受攻击的Notepad++安装程序。结合搜索结果中FreeBuf和CSDN等平台发布的详细复现文章，可以确认该漏洞的利用方式和POC的有效性。这些复现文章详细描述了如何创建和放置恶意`regsvr32.exe`以实现提权，这表明完整的攻击路径是明确且可复现的。因此，提供的POC代码是整个利用链中的一个有效组成部分，用于触发漏洞执行。

**利用步骤:**
1.  **准备恶意负载**：攻击者首先需要创建一个恶意可执行文件，例如一个反向Shell、键盘记录器或恶意软件加载器。这个恶意文件将被命名为Notepad++安装程序会调用的一个系统程序名，例如`regsvr32.exe`。
2.  **构建攻击包**：攻击者将合法的Notepad++ v8.8.1安装程序（例如`npp.8.8.1.Installer.x64.exe`）与步骤1中准备的恶意`regsvr32.exe`放置在同一个目录下。
3.  **社会工程学诱导**：攻击者通过钓鱼邮件、恶意网站、社交媒体或受感染的共享网络等方式，诱导受害者下载并执行这个包含了合法安装程序和恶意负载的攻击包。攻击者可能会利用本POC中的`call-agent-no-prompt.cs`脚本来启动安装程序，以规避“网页标记”的安全警告，增加受害者执行的信任度。
4.  **漏洞触发**：当受害者双击运行Notepad++安装程序时，操作系统会提示用户进行UAC（用户账户控制）确认，请求管理员权限。用户通常会认为这是一个合法软件的安装过程而同意授权。
5.  **恶意执行与提权**：一旦安装程序获得高权限开始执行，当其需要调用`regsvr32.exe`时，它会优先在其当前目录查找，从而加载并执行攻击者预先放置的恶意`regsvr32.exe`。此时，恶意程序将继承Notepad++安装程序的SYSTEM权限，实现本地权限提升，并执行攻击者预设的恶意操作，例如安装后门、窃取数据或完全控制系统。
6.  **善后（可选）**：攻击者可能还会删除恶意负载以清除痕迹，或者确保后续持久化访问。

**投毒风险分析:**
针对本漏洞提供的POC代码（包括`call-agent.cs`、`call-agent-no-prompt.cs`、`npp.8.8.1.checksums.sha256`和`archive-org.txt`），其自身对研究人员构成的投毒风险被评估为**低（10%）**。分析原因如下：
首先，`call-agent.cs`是一个非常简单的C#程序，其主要功能是使用`Process.Start`方法启动一个指定的外部可执行文件（在本例中是Notepad++安装程序）。此代码逻辑清晰，不包含任何混淆、恶意指令或调用外部恶意资源的企图。它仅仅是程序启动器，本身不具备恶意功能。
其次，`call-agent-no-prompt.cs`在`call-agent.cs`的基础上增加了一个功能：通过调用Windows API `DeleteFile`来删除下载文件的“Zone.Identifier”流。这个操作的目的是移除文件下载时留下的“网页标记”，从而避免Windows系统弹出安全警告。虽然这种行为在攻击场景中被用于降低受害者警惕，但从POC代码本身来看，它使用的是合法的Windows API函数，并且没有对系统进行任何持久化、隐蔽的恶意修改。它的目的在于模拟攻击者在社会工程学阶段可能采取的规避措施，而非直接实施恶意攻击。
再次，`npp.8.8.1.checksums.sha256`文件仅包含了一系列Notepad++ v8.8.1安装包和便携包的SHA256哈希值。这是一个纯文本文件，用于验证下载文件的完整性和真实性，不具备任何可执行性或恶意行为。`archive-org.txt`文件则仅仅是一个URL，同样不构成安全威胁。
最重要的一点是，根据防御性安全研究的指导原则，“务必不要把POC验证的后门代码判定为投毒代码”。本POC提供的代码是用于启动合法但存在漏洞的Notepad++安装程序，而非漏洞被利用后由攻击者部署的“后门代码”或“恶意负载”。真正的恶意负载（例如在利用过程中被植入的恶意`regsvr32.exe`）并未包含在此POC包中。攻击者需要额外创建并部署这些恶意文件。因此，研究人员在受控环境中运行这些POC文件时，只会启动Notepad++的合法安装程序，而不会直接面临恶意软件感染的风险，除非研究人员自己主动在POC所在的目录下放置了恶意可执行文件，并将其用于模拟攻击场景。鉴于代码的透明性和功能的局限性，可以认为其自身的投毒风险非常低。然而，在进行任何安全研究和复现时，始终建议在隔离的、非生产环境中进行，以防范潜在的意外情况。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
