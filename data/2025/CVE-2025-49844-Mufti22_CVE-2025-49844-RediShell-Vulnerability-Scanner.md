## CVE-2025-49844 - Redis 远程代码执行 (RCE), 释放后重用 (Use-After-Free)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (RCE), 释放后重用 (Use-After-Free)

**影响应用:** Redis

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** Redis 6.0.0 <= version < 6.2.20; Redis 7.0.0 <= version < 7.2.11; Redis 7.4.0 <= version < 7.4.6; Redis 8.0.0 <= version < 8.0.4; Redis 8.2.0 <= version < 8.2.2

**利用条件:** 需要认证, 可通过Lua脚本触发, 低权限用户

**POC 可用性:** 3/10

**POC 类型:** 概念验证 (仅版本检测)

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

POC有效性分析:\n提供的POC代码 (`redis_checker.py`) 实际上是一个针对 CVE-2025-49844 的版本检测工具，而非完整的远程代码执行漏洞利用工具。根据其 `README.md` 文件说明，该工具旨在“执行安全检查，而不实际利用漏洞”。脚本通过连接到目标 Redis 服务器，获取其 `redis_version` 信息，然后将其与预定义的已知易受攻击的版本范围进行比对。这些版本范围包括 Redis 6.0.0 至 6.2.20 (不含)、7.0.0 至 7.2.11 (不含)、7.4.0 至 7.4.6 (不含)、8.0.0 至 8.0.4 (不含) 以及 8.2.0 至 8.2.2 (不含)。脚本逻辑清晰，使用了 `redis` 和 `packaging` 等标准Python库，能够可靠地执行版本检测功能。它仅执行 `PING` 和 `INFO` 命令，不会对目标系统造成任何修改或破坏。因此，作为一个漏洞检测器，该POC是有效的且功能完整的，但作为实际的RCE利用代码，它仅停留在概念验证（版本判断）层面。\n\n利用步骤:\nCVE-2025-49844 是 Redis Lua 脚本引擎中的一个严重释放后重用（Use-After-Free, UAF）漏洞，被命名为 RediShell。该漏洞允许经过身份认证的攻击者，通过构造恶意的 Lua 脚本，来操纵 Redis 的垃圾回收机制，从而触发 UAF 缺陷，最终导致在 Redis 服务器上执行任意代码（RCE）。\n具体的利用步骤通常包括：\n1.  **认证绕过/获取凭证**: 攻击者需要首先获得对目标 Redis 实例的认证权限。这可能通过弱密码、默认凭证、配置不当或社会工程等方式实现。漏洞描述中明确指出“经过认证的攻击者”或“拥有低权限及以上用户权限的攻击者”是利用前提。\n2.  **构造恶意 Lua 脚本**: 攻击者需要精心设计一个 Lua 脚本，该脚本将利用 Redis Lua 引擎内部的特定内存管理行为。这通常涉及分配和释放某个数据结构，然后通过某种手段再次访问已释放的内存区域，从而导致 UAF。\n3.  **触发垃圾回收**: 攻击者需要控制 Redis 的 Lua 环境，使其执行上述恶意脚本，并强制触发垃圾回收机制。通过特定的Lua操作和数据量，可以精细控制内存的分配与释放时机。\n4.  **写入任意数据/控制程序流**: 一旦 UAF 被成功触发，攻击者可以利用对已释放内存区域的再次访问，写入恶意数据或覆盖关键的函数指针、栈变量等，从而劫持程序执行流，最终在 Redis 进程的上下文中执行任意操作系统命令。\n5.  **远程代码执行**: 成功劫持程序流后，攻击者可以在受害服务器上执行任意系统命令，完全控制服务器。这可能包括但不限于下载并执行恶意文件、建立反向Shell、窃取数据等。\n鉴于该漏洞的复杂性，实际的RCE利用需要深入理解Redis的内部机制、Lua脚本引擎以及内存管理细节。\n\n投毒风险分析:\n对所提供的POC代码 (`redis_checker.py` 和 `README.md`) 进行分析，未发现任何恶意或可疑行为。\n1.  **代码行为**: 脚本的主要功能是连接到 Redis 实例并获取版本信息，然后与已知的易受攻击版本范围进行比对。它没有执行任何写操作、文件修改、系统命令执行、或任何形式的数据外传。\n2.  **依赖库**: 脚本仅依赖 `redis` 和 `packaging` 这两个标准的Python库。这些库在Python生态系统中被广泛使用，且没有已知的高风险漏洞或恶意行为。\n3.  **网络活动**: 除了与目标Redis服务器建立正常的连接和通信（执行 `PING` 和 `INFO` 命令）外，代码没有尝试连接到任何第三方服务器或进行其他异常网络请求。\n4.  **代码混淆/加密**: 代码是清晰、可读的Python代码，没有使用任何混淆、加密或打包技术来隐藏其真实意图。\n5.  **作者信息**: 作者 Malik Fomin 在 `redis_checker.py` 中明确声明，并指出该工具“仅用于授权的渗透测试”。这表明了作者的合法安全研究意图。\n综合来看，该POC代码的投毒风险极低，可以评估为 0%。它是一个无害的、用于识别目标Redis实例是否存在 CVE-2025-49844 漏洞的版本检测工具。在使用时，用户仍需确保目标Redis实例是授权测试的，并注意连接凭证的安全。

**项目地址:** 

**漏洞详情:** https://redis.io/blog/security-advisory-cve-2025-49844/
