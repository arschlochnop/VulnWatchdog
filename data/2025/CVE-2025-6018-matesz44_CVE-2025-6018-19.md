## CVE-2025-6018 - Linux系统，主要包括SUSE Leap 15/SLES 15 (CVE-2025-6018) 及几乎所有主流发行版 (Ubuntu, Debian, Fedora, openSUSE) (CVE-2025-6019中涉及的udisks组件) 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Linux系统，主要包括SUSE Leap 15/SLES 15 (CVE-2025-6018) 及几乎所有主流发行版 (Ubuntu, Debian, Fedora, openSUSE) (CVE-2025-6019中涉及的udisks组件)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** SUSE Leap 15, SLES 15 (针对CVE-2025-6018); 几乎所有主流Linux发行版 (涉及libblockdev库和udisks守护进程的CVE-2025-6019)

**利用条件:** 需要本地普通用户权限，利用需要多步骤操作，包括用户重新登录触发PAM配置修改以及后续通过udisks服务触发提权。通常攻击者需已获得目标系统的低权限访问。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-6018和CVE-2025-6019是由Qualys威胁研究小组披露的一对Linux本地权限提升漏洞，可组合形成一个完整的攻击链，使本地普通用户获得root权限。CVE-2025-6018利用SUSE 15发行版中PAM配置的缺陷，将远程会话错误识别为本地控制台会话，从而授予非特权用户“allow_active”权限。CVE-2025-6019则利用libblockdev库中udisks守护进程挂载文件系统时的漏洞，允许具有“allow_active”权限的用户通过恶意构造的XFS镜像文件，结合udisks的resize功能，最终执行以root权限运行的SUID二进制文件，实现root权限提升。该漏洞链对广泛的Linux发行版构成威胁，特别是CVE-2025-6019涉及的udisks和libblockdev组件。

POC有效性分析: 提供的POC代码`CVE-2025-6018-19.sh`是一个功能完整的Shell脚本，它实现了Qualys描述的整个权限提升攻击链。该脚本分为三个主要功能模块：`xfs`、`pam`和`root`。
1.  `xfs`模块：负责在本地（攻击者控制的机器或Docker环境）创建一个特殊的XFS镜像文件`xfs.image`。这个镜像文件内部包含一个被设置为SUID root权限的`bash`可执行文件。这是提权攻击的最终载荷。脚本会检查`mkfs.xfs`工具的存在，并处理挂载失败的情况。
2.  `pam`模块：针对CVE-2025-6018。此模块通过向用户的`~/.pam_environment`文件写入特定的`XDG_SEAT OVERRIDE=seat0`和`XDG_VTNR OVERRIDE=1`环境变量，欺骗PAM系统将用户的会话识别为本地控制台会话。这导致用户在下次登录时获得“allow_active”权限，这是触发CVE-2025-6019的先决条件。
3.  `root`模块：针对CVE-2025-6019。此模块首先通过`gdbus`检查当前用户是否已具备“allow_active”权限。如果未具备，它会提示用户先运行`pam()`并重新登录。一旦具备“allow_active”权限，它会终止`gvfs-udisks2-volume-monitor`进程，然后利用`udisksctl loop-setup`命令将之前创建的恶意`xfs.image`作为循环设备挂载，并禁用用户交互。随后，通过`gdbus call --system --dest org.freedesktop.UDisks2 --object-path ... --method org.freedesktop.UDisks2.Filesystem.Resize 0 '{}'`触发udisks的resize功能。由于libblockdev库在处理文件系统resize时存在缺陷，结合带有SUID `bash`的XFS镜像，这最终导致攻击者能够以root权限执行`bash`，从而完全控制系统。脚本中使用了`while true; do ... && break; done 2>/dev/null &`来等待恶意bash进程被创建，确保提权成功。

利用步骤:
1.  **准备阶段（攻击者本地）**: 执行`sh CVE-2025-6018-19.sh xfs`，生成含SUID root `bash`的`xfs.image`。
2.  **传输阶段**: 将`xfs.image`传输至目标Linux机器（例如`/tmp`）。
3.  **第一阶段提权（目标机器，普通用户）**: 以普通用户身份运行`sh CVE-2025-6018-19.sh pam`，修改`~/.pam_environment`。然后，退出并重新登录SSH/TTY会话，以获得“allow_active”权限。
4.  **第二阶段提权（目标机器，allow_active用户）**: 重新登录后，执行`sh CVE-2025-6018-19.sh root`。脚本会验证权限，并利用udisks漏洞执行`xfs.image`中的SUID `bash`，最终提供一个root shell。

投毒风险分析: 提供的POC代码的投毒风险评估为**低（5%）**。该评估基于以下几个关键因素：
1.  **来源可信度高**: 该POC脚本明确标注其内容来源于Qualys官方的安全通告（`https://cdn2.qualys.com/2025/06/17/suse15-pam-udisks-lpe.txt`）。Qualys作为一家在全球范围内享有盛誉的专业网络安全公司，其发布的安全研究成果和漏洞利用工具通常经过严格的内部审查，并致力于负责任的披露。这大大增强了代码的初始可信度，表明其主要目的是为了安全研究和防御目的，而非恶意传播。
2.  **代码透明度和可读性强**: 脚本代码编写清晰、逻辑分明，没有使用任何形式的代码混淆、加密或难以理解的技巧。所有Shell命令和系统调用都直接可见，使得安全研究人员可以轻松地逐行审查代码，理解其确切功能。这种高度的透明性是评估其无恶意意图的关键指标之一，因为任何潜在的恶意行为都将无所遁形。
3.  **行为分析局限于漏洞利用本身**: 脚本的核心功能围绕着实现已披露的本地权限提升漏洞。它执行的操作包括：在攻击者本地或受害者系统上创建并处理XFS文件系统镜像，并在其中嵌入一个SUID root权限的`bash`可执行文件，这是实现最终提权载荷的必要步骤；修改当前用户的`~/.pam_environment`文件，插入特定的环境变量以利用CVE-2025-6018，从而欺骗PAM系统授予用户“allow_active”权限；利用`udisksctl`和`gdbus`等标准系统工具与`udisks2`守护进程进行交互，触发CVE-2025-6019的逻辑缺陷，最终导致执行SUID `bash`以获取root权限。未发现该脚本有任何超出这些提权目的的附加恶意行为。例如，代码中没有包含任何网络回调（C2通信）、数据窃取（例如读取`/etc/shadow`并外传）、部署非预期后门、安装恶意软件或修改系统关键配置（超出PAM环境修改范围，且该修改是为了提权，而非持久化恶意存在）的迹象。其所有操作均是实现本地root权限获取这一既定目标的必要组成部分。
4.  **无外部恶意依赖**: 脚本仅依赖于标准Linux发行版中普遍存在的工具和库，如`dd`、`mkfs.xfs`、`mount`、`cp`、`chown`、`chmod`、`umount`、`killall`、`udisksctl`、`gdbus`、`grep`等。它不引入或下载任何来自不可信来源的第三方二进制文件或脚本，这进一步降低了引入外部恶意载荷的风险。
综上所述，尽管该POC执行了对目标系统而言具有破坏性的权限提升操作，但其设计和实现完全符合其声明的漏洞利用目的。代码本身并未展现出任何额外或隐蔽的恶意功能。因此，对于旨在进行防御性安全研究和漏洞复现的组织而言，使用此POC的投毒风险被评估为极低。

**项目地址:** https://cdn2.qualys.com/2025/06/17/suse15-pam-udisks-lpe.txt

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
