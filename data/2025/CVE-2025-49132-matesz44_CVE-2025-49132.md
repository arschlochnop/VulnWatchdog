## CVE-2025-49132 - Pterodactyl Panel 路径遍历/本地文件包含到远程代码执行 (Path Traversal/LFI to RCE)

**漏洞编号:** CVE-2025-49132

**漏洞类型:** 路径遍历/本地文件包含到远程代码执行 (Path Traversal/LFI to RCE)

**影响应用:** Pterodactyl Panel

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** <= v1.11.10

**利用条件:** 无需认证，需要网络访问，目标Pterodactyl实例需配置PHP PEAR组件

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-49132是Pterodactyl Panel中存在的一个高危漏洞，被评定为CVSS 10.0（Critical）。该漏洞的本质是未经授权的路径遍历（Path Traversal）和本地文件包含（LFI），最终可导致远程代码执行（RCE）。攻击者可利用`locale.json`接口，通过操纵`locale`和`namespace`参数构造恶意请求，触发模板注入或代码注入，进而控制目标服务器。受影响的版本包括v1.11.10及更早版本，建议用户尽快升级到v1.11.11或更高版本。

**POC有效性分析：**
所提供的POC是一个Bash shell脚本，其利用逻辑清晰且严谨，旨在实现从LFI到RCE的完整攻击链。脚本首先定义了攻击目标（TARGET）和要执行的命令（COMMAND）。其核心利用步骤如下：
1.  **权限绕过与路径遍历**：脚本利用`Pterodactyl Panel`的`locale.json`接口，通过`locale=../../../../..${PEARPATH}`参数实现路径遍历，旨在访问服务器文件系统中的任意位置，特别是PHP PEAR的配置路径。
2.  **利用pearcmd写入Webshell**：通过`namespace=pearcmd`参数，脚本激活了PHP PEAR的命令行工具（`pearcmd`）的处理逻辑。结合`+config-create+/&payload+/tmp/${WEBSHELL}.php`，攻击者能够利用`pearcmd`的配置写入功能，在目标服务器的`/tmp`目录下创建一个临时的PHP webshell文件。该webshell的内容是一个经典的`<?=eval($_GET[<随机参数>])?>`，允许通过GET参数执行任意PHP代码。
3.  **RCE触发**：webshell创建成功后，脚本发起第二次`curl`请求。这次请求同样利用路径遍历(`locale=../../../../../tmp`)来访问刚刚写入的webshell(`/tmp/${WEBSHELL}.php`)。通过将预设的系统命令作为GET参数(`WEBSHELLPARAM=system('${COMMAND}');die();`)传递给webshell，脚本实现了在目标服务器上的远程代码执行。
该POC考虑了不同的PHP PEAR路径，增加了其成功率。它依赖于`curl`、`uuidgen`等标准系统工具，并提供了可选的`encode`工具用于URL编码。整体来看，该POC设计精巧，利用了已知且经过验证的LFI到RCE技术，具有极高的有效性。

**利用步骤：**
1.  **前置条件**：确保目标Pterodactyl Panel的版本为v1.11.10或更早，且攻击者拥有对目标Pterodactyl Panel的网络访问权限。此外，目标的PHP环境需要可利用的PEAR组件配置。
2.  **准备环境**：下载并保存POC脚本（例如`CVE-2025-49132.sh`）。（可选）为了更好地处理特殊字符，可以安装`matesz44/encode`工具，或手动对命令进行URL编码。
3.  **执行POC**：在命令行中运行POC脚本，提供目标Pterodactyl Panel的URL和希望在目标服务器上执行的系统命令。例如：`sh CVE-2025-49132.sh http://target-panel.com 'uname -a'`。
4.  **Webshell写入**：脚本将首先尝试通过路径遍历和`pearcmd`的`config-create`功能，在目标服务器的`/tmp`目录下写入一个临时的PHP webshell文件（文件名由`uuidgen`生成）。
5.  **命令执行**：一旦webshell写入成功，POC将再次利用路径遍历访问该webshell，并通过GET参数将指定的系统命令传递给webshell执行。
6.  **结果获取**：目标服务器执行命令后，其输出将被捕获并利用`awk`从HTTP响应中提取，然后打印到攻击者的终端。

**投毒风险分析：**
此POC脚本的投毒风险评估为低，具体百分比为5%。这种低风险的判断基于对脚本代码的详细审查，并严格区分了漏洞利用代码与恶意投毒代码的本质差异。首先，脚本采用Bash shell编写，语言透明度高，所有操作均通过`curl`命令显式发出HTTP请求，以及通过`uuidgen`生成随机文件名和参数，这些都是标准的系统工具和操作。没有发现任何形式的代码混淆、加密或难以理解的逻辑，使得任何具备基本脚本阅读能力的分析人员都能轻易理解其功能和意图。

其次，脚本的核心功能是利用已知的`Pterodactyl Panel`漏洞（CVE-2025-49132）实现未经授权的远程代码执行。其利用方法是构造特定的HTTP请求，通过路径遍历漏洞和`pearcmd`组件的特性，在目标服务器上写入一个临时的PHP webshell。这个webshell的内容是`<?php eval($_GET[<随机参数>]); ?>`，这是一个非常典型的、用于远程代码执行的合法webshell载荷。它的目的是接收并执行攻击者指定的命令，而不是执行任何预设的恶意动作。在安全研究和渗透测试场景中，这种载荷被广泛用于验证RCE漏洞的存在和功能，本身不应被视为“投毒”。

脚本中对外部依赖的声明也体现了其透明性。它提到了`https://github.com/matesz44/encode`作为一个可选的URL编码工具。尽管任何外部依赖都理论上存在风险，但该脚本明确指出了其来源，并且提供了手动编码命令的替代方案，这意味着即使不使用该外部工具，POC也能运行。此外，脚本本身并未尝试自动下载、安装或执行该外部工具，而是依赖于用户环境是否已安装。在整个脚本流程中，没有发现向外部未知地址发送敏感数据、下载未知二进制文件、修改本地系统配置、植入后门或进行任何持久化操作的迹象。其唯一的目标是执行用户在命令行中指定的命令，并将结果返回。因此，它是一个功能单一且目标明确的漏洞验证和利用工具，而非旨在对使用它的人进行攻击。

值得注意的是，在防御性安全研究中，务必将“漏洞利用的有效载荷”（例如这里用于RCE的webshell）与“恶意投毒行为”（例如POC中包含后门、窃取数据）区分开来。这个POC中的webshell是实现漏洞利用的关键组成部分，其行为完全受控于脚本使用者的输入，不具备独立或隐蔽的恶意性。因此，基于上述分析，该POC的投毒风险被判定为低。

**项目地址:** https://github.com/Zen-kun04/CVE-2025-49132

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49132
