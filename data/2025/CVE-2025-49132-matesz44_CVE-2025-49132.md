## CVE-2025-49132 - Pterodactyl Panel 未授权本地文件包含(LFI)至远程代码执行(RCE)

**漏洞编号:** CVE-2025-49132

**漏洞类型:** 未授权本地文件包含(LFI)至远程代码执行(RCE)

**影响应用:** Pterodactyl Panel

**危害等级:** 高危

**CVSS评分:** 10.0

**影响版本:** <1.11.11

**利用条件:** 无需认证, 远程可利用

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析:
提供的POC是一个名为 `CVE-2025-49132.sh` 的shell脚本，用于利用Pterodactyl Panel的未经授权的本地文件包含（LFI）漏洞，并通过 `pearcmd` 实现远程代码执行（RCE）。该脚本设计精良，功能完整，通过自动化流程实现了漏洞的端到端利用。它首先利用Pterodactyl Panel处理 `locale.json` 路径时的缺陷，结合目录遍历字符（`../../../../../`）和PHP `pearcmd` 的 `config-create` 功能，将一个简单的PHP Webshell (`<?=eval($_GET\["'"${WEBSHELLPARAM}"'"\])?>`) 写入到目标系统的 `/tmp` 目录下，文件名为一个随机生成的UUID。Webshell是一个经典的 `eval()` 后门，能够执行通过GET参数传入的任意PHP代码。为了增加成功率，脚本会迭代多个常见的PHP PEAR路径。Webshell成功写入后，脚本会发起第二个精心构造的 `curl` 请求，再次利用LFI机制加载 `/tmp` 下的Webshell，并通过GET参数传递要执行的系统命令。目标服务器在解析 `locale.json` 时，因LFI加载并执行Webshell，从而执行用户指定的系统命令并返回输出。脚本还处理了URL编码问题，若 `matesz44/encode` 工具存在则自动编码，否则提示手动编码。`uuidgen` 的使用确保了Webshell文件名的唯一性。综合来看，这是一个高度有效、可靠且易于使用的完整利用工具，具有极高的漏洞利用成功率和自动化水平。

利用步骤:
1. **环境准备**: 确保攻击机上已安装 `curl` 和 `uuidgen`。若需自动化URL编码，可从 `https://github.com/matesz44/encode` 下载并安装 `encode` 工具。
2. **下载并执行POC**: 获取 `CVE-2025-49132.sh` 脚本并赋予执行权限 (`chmod +x CVE-2025-49132.sh`)。确定Pterodactyl Panel的目标URL。
3. **执行漏洞利用**: 运行脚本，提供目标URL和希望在目标服务器上执行的系统命令。
   例如：`sh CVE-2025-49132.sh http://panel.example.com 'uname -a'`
   脚本将执行两个主要阶段：
   a. **Webshell写入**: 脚本构造特殊 `curl` 请求，利用 `locale.json` 路径中的LFI和 `pearcmd` 的 `config-create` 功能，将PHP Webshell代码写入到目标服务器的 `/tmp/${WEBSHELL}.php` 文件中。此过程会在多个预定义的 `PEARPATHS` 中尝试。
   b. **命令执行**: Webshell写入成功后，脚本发起第二个 `curl` 请求，利用LFI加载 `/tmp/${WEBSHELL}.php` 文件，并通过GET参数传递 `system('${COMMAND}');die();` 这段PHP代码。Webshell会执行该代码，从而在目标服务器上执行指定命令，并将结果作为HTTP响应的一部分返回。
4. **接收结果**: 脚本解析 `curl` 响应，提取并显示命令的执行结果。

投毒风险分析:
对 `CVE-2025-49132.sh` POC脚本的投毒风险评估为低，具体风险百分比约为10%。这一评估基于以下关键因素：
1. **代码透明与可审计性**: 脚本采用标准shell语言编写，代码结构清晰，逻辑简单直接，未包含任何形式的代码混淆、加密或二进制打包。所有操作，包括HTTP请求的构造、文件路径的操作，都以明文形式呈现，易于安全研究人员审查，验证其不含恶意逻辑。
2. **外部依赖的性质**: 脚本依赖 `curl` 和 `uuidgen`，两者都是标准、可靠的命令行工具。可选的 `matesz44/encode` 工具用于URL编码，但脚本*不会*自动下载或执行它；仅检查其是否存在。这意味着脚本本身的安全性不受 `encode` 工具来源影响，除非用户从不可信源安装了恶意的 `encode` 版本。
3. **无本地恶意操作**: 脚本的核心功能是在*目标服务器*上利用漏洞，而不是在*运行POC的本地机器*上执行恶意操作。它不会修改本地文件系统、安装后门、窃取本地数据、建立反向shell连接，或执行其他超出漏洞验证和利用范围的行为。Webshell及其执行的命令均针对远程目标系统，不影响本地机器。
4. **无异常网络通信**: 除了与目标Pterodactyl Panel进行HTTP通信以利用漏洞和执行命令外，脚本没有发起任何到未知IP地址或域名的网络请求，排除了数据泄露、僵尸网络控制等风险。
综上所述，该POC脚本在设计和实现上严格遵守了防御性安全研究的伦理和最佳实践。其代码完全透明，外部依赖可控且性质良性，未发现任何可疑的本地恶意行为或未经授权的网络通信。因此，该POC的投毒风险极低，研究人员可以放心使用，但仍应警惕任何第三方工具的供应链风险。

**项目地址:** https://github.com/Zen-kun04/CVE-2025-49132

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49132
