## CVE-2025-49132 - Pterodactyl Panel Local File Inclusion (LFI) leading to Remote Code Execution (RCE)

**漏洞编号:** CVE-2025-49132

**漏洞类型:** Local File Inclusion (LFI) leading to Remote Code Execution (RCE)

**影响应用:** Pterodactyl Panel

**危害等级:** Critical

**CVSS评分:** 9.8 (Estimated)

**影响版本:** Unknown, likely recent versions based on HackTheBox mention.

**利用条件:** Unauthenticated, network access required, target system must have PHP PEAR installed (common in PHP environments).

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析:
此POC脚本（`CVE-2025-49132.sh`）旨在利用Pterodactyl Panel中存在的未授权本地文件包含（LFI）漏洞，并通过`pearcmd`工具链实现远程代码执行（RCE）。脚本结构清晰，使用Bash编写，并依赖于标准的命令行工具如`curl`、`uuidgen`和`awk`。其核心逻辑分为两个主要阶段。第一阶段，脚本通过构造一个特殊的HTTP GET请求，利用Pterodactyl的`locales/locale.json`接口，结合LFI漏洞 (`locale=../../../../..${PEARPATH}`)，指向系统上的`pearcmd`路径（例如`/usr/share/php/PEAR`或`/usr/local/lib/php`）。通过操纵`namespace`参数为`pearcmd`，脚本能够滥用`pearcmd`的`config-create`功能，将一个PHP Webshell (`<?php eval($_GET["\""${WEBSHELLPARAM}"\""]); ?>`) 写入到目标系统的`/tmp/`目录下的一个随机生成的文件名（由`uuidgen`生成）中。这个webshell非常简洁，允许通过GET请求参数执行任意PHP代码。第二阶段，脚本再次使用`curl`发送HTTP GET请求，但这次将`locale`参数设置为`/../../../../../tmp`，并将`namespace`参数设置为前一步创建的webshell文件的名称（不带`.php`后缀），同时在GET请求中包含由`uuidgen`生成的`WEBSHELLPARAM`参数，其值为`system('${COMMAND}');die();`。这将导致webshell被执行，从而在目标系统上以Web服务器的权限执行任意传入的系统命令。脚本还包含一个可选的URL编码功能，如果系统中存在`encode`工具（来自`https://github.com/matesz44/encode`），它将自动对用户输入的命令进行URL编码，以确保特殊字符能正确传递；否则，脚本会提示用户手动编码。总体而言，该POC的逻辑严谨，利用链完整，从LFI到RCE的路径明确，且其利用方式是当前已知绕过PHP配置限制实现RCE的常见技术之一（如利用`pearcmd`）。考虑到Pterodactyl作为流行的游戏服务器管理面板，此漏洞的发现具有较高威胁性，其POC的有效性在技术上是可信的。

利用步骤:
1.  确保本地系统安装了`curl`、`uuidgen`和`awk`工具。
2.  （可选）从`https://github.com/matesz44/encode`安装`encode`工具，以便自动处理命令中的特殊字符URL编码。
3.  执行POC脚本，提供目标Pterodactyl Panel的URL和要执行的系统命令。
    示例：`sh CVE-2025-49132.sh http://panel.example.com 'ls -la /'`
4.  脚本将首先尝试利用LFI和`pearcmd`在目标`/tmp`目录下写入一个PHP webshell。
5.  写入成功后，脚本会通过LFI再次调用该webshell，并传递指定的系统命令进行执行。
6.  命令的输出结果将被`awk`解析并打印到标准输出。

投毒风险分析:
该POC脚本的投毒风险被评估为**低 (10%)**。主要基于以下几个原因：
首先，脚本代码清晰、简洁，没有明显的混淆或加密部分。它是一个标准的Bash脚本，易于阅读和理解其执行的每一步操作。
其次，脚本所使用的工具都是标准的Linux/Unix命令行工具（`curl`、`uuidgen`、`tr`、`printf`、`command -v`、`awk`）。这些工具本身是无害的，且脚本对其的使用方式也符合预期，即用于网络请求、生成唯一标识符、字符串处理和输出解析。没有发现脚本尝试下载或执行任何未知或可疑的外部二进制文件。
第三，脚本明确声明了一个外部依赖`https://github.com/matesz44/encode`。虽然依赖外部工具本身可能引入风险，但该脚本对此依赖的处理方式是可选的：如果`encode`工具不存在，脚本会发出通知并要求用户手动进行URL编码，而不是强制下载或尝试自动安装。这种处理方式降低了潜在的供应链攻击风险。用户可以选择不使用`encode`工具，或者在仔细审查其代码后再行安装。
第四，脚本的核心功能是向目标服务器植入一个PHP webshell (`<?php eval($_GET["\""${WEBSHELLPARAM}"\""]); ?>`)。这个webshell是漏洞利用的*有效载荷*，而不是POC脚本自身的恶意组件。这意味着脚本的目的就是将这段代码写入目标，以实现RCE。这与POC中隐藏恶意代码（如挖矿程序、反弹shell到攻击者控制的C2服务器、数据窃取等）的情况有本质区别。
最后，没有发现脚本尝试与任何未知的IP地址或域名进行通信（除了目标Pterodactyl Panel），也没有尝试修改本地系统配置、删除文件或执行其他超出漏洞利用范围的恶意行为。

综上所述，该POC脚本在设计和实现上都遵循了漏洞验证的常规实践，其代码透明度高，且对外部依赖的处理谨慎，因此其作为攻击工具本身的投毒风险较低。组织在使用时应重点关注被攻击系统被植入webshell后的二次危害，而不是POC脚本本身带来的直接危害。

**项目地址:** https://github.com/matesz44/encode

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49132
