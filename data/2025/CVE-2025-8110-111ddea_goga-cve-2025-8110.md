## CVE-2025-8110 - Gogs 符号链接绕过远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 符号链接绕过远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 7.8

**影响版本:** Gogs <= 0.13.2

**利用条件:** 需要认证 (管理员权限, API Token)

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-8110是一个影响Gogs开源自托管Git服务的严重远程代码执行漏洞。该漏洞源于对之前符号链接相关安全修复（CVE-2024-55947）的绕过。攻击者可以通过创建指向`.git`目录之外的符号链接，并利用Gogs的API向这些符号链接写入内容，最终实现任意文件覆盖和远程代码执行。

**POC有效性分析:**
该POC以详细的Markdown报告形式提供，清晰地展示了从环境搭建到漏洞利用的完整链条。它通过自动化脚本在Docker环境中部署Gogs 0.13.2，并模拟一个拥有管理员权限和API Token的攻击者。

利用过程分为以下关键步骤：
1.  **创建恶意符号链接**: 攻击者首先在本地Git仓库中创建两个精心构造的符号链接。第一个是`malicious_link_abs`，指向服务器文件系统上的任意路径（例如`/tmp/pwned_marker`），用于验证任意文件写入能力。第二个是`link_to_config`，指向目标仓库的`.git/config`文件（例如`/data/git/gogs-repositories/attacker/test-repo.git/config`）。随后，这些包含符号链接的仓库被推送到Gogs服务器。
2.  **触发文件覆盖**: 攻击者利用Gogs的`PutContents` API，向这些符号链接写入数据。首先，向`malicious_link_abs`写入Base64编码的“PWNED”字符串，成功验证了其可以写入仓库外部的任意文件。接着，关键一步是向`link_to_config`写入包含恶意`sshCommand`的Git配置文件内容，例如`sshCommand = "whoami > /tmp/hacked"`。此处的`sshCommand`是Git的一个配置选项，允许在执行SSH命令（如`git fetch`或`git ls-remote`）之前执行任意系统命令。
3.  **结果验证与RCE触发**: POC通过`docker exec`命令验证了文件覆盖的成功。它显示`/tmp/pwned_marker`文件被创建并包含“PWNED”，并且仓库的`.git/config`文件被成功篡改。最后，通过在Docker容器内执行一个Git网络操作（如`git ls-remote git@github`），成功触发了注入的`sshCommand`，在`/tmp`目录下创建了`hacked`文件，并写入了运行Gogs服务的用户身份，从而验证了远程代码执行的成功。该POC报告的详细程度、命令的明确性以及验证步骤的完整性，使其成为一个高度有效且易于复现的漏洞利用指南。

**利用步骤:**
1.  **环境准备**: 使用`setup-gogs-vulnerable.sh`脚本在Docker中搭建Gogs 0.13.2漏洞环境。获取管理员用户的API Token。
2.  **创建和推送恶意符号链接**: 在本地创建一个新的Git仓库。在该仓库中，创建两个符号链接：`ln -s /tmp/pwned_marker malicious_link_abs` 和 `ln -s /data/git/gogs-repositories/attacker/test-repo.git/config link_to_config`。将这些符号链接添加到Git并推送至Gogs服务器。
3.  **API触发文件覆盖**: 
    *   使用`curl`命令向`/api/v1/repos/attacker/test-repo/contents/malicious_link_abs`发送`PUT`请求，写入Base64编码的“PWNED”字符串，验证任意文件写入。
    *   再次使用`curl`命令向`/api/v1/repos/attacker/test-repo/contents/link_to_config`发送`PUT`请求，写入恶意Git配置，其中包含`[core] sshCommand = "whoami > /tmp/hacked"`等内容，注入RCE payload。
4.  **验证RCE**: 
    *   通过`docker exec gogs-vulnerable cat /tmp/pwned_marker`验证任意文件写入是否成功。
    *   通过`docker exec gogs-vulnerable cat /data/git/gogs-repositories/attacker/test-repo.git/config`验证Git配置文件是否被篡改。
    *   在Gogs容器内执行一个Git网络操作（如`git ls-remote git@github`），触发`sshCommand`执行，并检查`/tmp/hacked`文件是否被创建且包含`whoami`的输出。

**投毒风险分析:**
本POC是一个**漏洞验证报告**，以纯文本Markdown格式呈现，其核心目的是清晰、透明地展示漏洞的利用过程，而非作为可执行的恶意软件。因此，其直接的投毒风险极低。

1.  **代码透明性**: 报告中包含的所有命令（`git`、`ln -s`、`curl`、`docker exec`）都是显式且易于理解的。Git配置文件片段也清晰地展示了注入的恶意`sshCommand`。这种完全透明的代码和指令格式，使得安全研究人员或防御者能够轻松审查其内容，确保不存在任何隐藏的恶意行为、混淆代码或外部恶意资源引用。
2.  **执行方式**: POC的执行依赖于用户手动复制和粘贴`bash`命令，或通过脚本自动化这些显式命令。这意味着，除非用户主动修改或在自动化脚本中引入额外恶意逻辑，否则原始报告本身不会执行任何超出漏洞演示范围的操作。
3.  **无恶意负载**: 报告中演示的“恶意代码”——即`sshCommand = "whoami > /tmp/hacked"`，其目的是为了验证RCE，它只会在受控的测试环境中创建一个指示文件，并不会对系统造成持续性损害或建立后门。这与攻击者可能在野外使用的真正恶意负载（如反向shell、持久化机制）有本质区别。
4.  **二次开发风险**: 真正的投毒风险源于攻击者可能会基于此详细的漏洞利用知识，开发并分发一个包含实际恶意负载的自动化攻击工具。这种工具可能在执行类似POC中的步骤时，偷偷植入真实的后门、窃取数据或进行其他破坏性行为。然而，这种风险是**针对恶意利用脚本本身**，而非针对这份作为研究成果的POC报告。防御方应将此POC作为加固Gogs实例的重要参考，而非怀疑POC本身带有恶意。

综上所述，这份POC报告是合法防御性安全研究的典范，为组织提供了详细的攻击面信息和复现方法，以便加强防御。其本身无投毒风险，但组织必须警惕其所揭示的漏洞在野外被恶意利用的可能性。

**项目地址:** N/A

**漏洞详情:** https://www.freebuf.com/articles/vuls/464926.html
