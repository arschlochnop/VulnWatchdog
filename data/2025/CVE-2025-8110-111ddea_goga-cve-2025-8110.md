## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 8.7

**影响版本:** Gogs 0.13.2 及可能更早版本

**利用条件:** 需要认证的用户权限（若启用开放注册则门槛降低），通过网络访问利用Gogs的PutContents API，创建并利用恶意符号链接。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-8110 是 Gogs 自托管 Git 服务中的一个高危远程代码执行（RCE）漏洞，其CVSS评分为8.7。该漏洞的根源在于Gogs的`PutContents` API对用户提交的符号链接处理不当，未能充分验证目标路径。攻击者可以利用这一缺陷，通过在Git仓库中创建指向服务器任意文件路径的符号链接，并在随后的API调用中向这些符号链接写入数据，从而实现任意文件覆盖。最终，攻击者能够通过修改仓库的Git配置文件（例如`.git/config`），注入恶意`sshCommand`，在Gogs服务器执行任意系统命令。

**POC有效性分析:**
提供的Proof-of-Concept (POC) 报告是极其有效且细致的。它以一个结构化的Markdown文档形式呈现，明确地展示了如何在一个Dockerized的Gogs 0.13.2环境中复现该漏洞。POC的步骤清晰，包含所有必要的shell命令、Git操作和`curl`请求，使其高度可重现。报告首先演示了任意文件写入的能力，通过创建指向`/tmp/pwned_marker`的符号链接，并成功向其写入“PWNED”字符串，证明了Gogs确实会跟随符号链接写入仓库外部路径。更关键的是，POC进一步展示了如何利用此漏洞实现RCE。攻击者通过符号链接将恶意内容写入目标仓库的`.git/config`文件，注入了一个包含`sshCommand = "whoami > /tmp/hacked"`的Git配置。当Gogs服务器或管理员对受感染的仓库执行任何涉及SSH远程操作的Git命令（如`git fetch`或`git ls-remote`）时，该注入的`sshCommand`便会被Git客户端执行，从而导致服务器上的任意命令执行。验证步骤通过`docker exec`命令检查文件内容和命令执行结果，确凿地证明了漏洞的成功利用和RCE的实现。POC的质量极高，是进行防御性安全研究和验证的理想工具。

**利用步骤:**
CVE-2025-8110的利用涉及多个阶段，核心是利用Gogs的`PutContents` API和Git的符号链接处理机制：
1.  **环境准备**：攻击者首先需拥有目标Gogs实例上的认证用户权限（POC中为admin权限及API Token），并在该用户下创建一个新的Git仓库（例如`attacker/test-repo`）。
2.  **创建恶意符号链接**：攻击者在其本地`test-repo`克隆中创建两个关键的符号链接。第一个名为`malicious_link_abs`，指向服务器文件系统上的任意绝对路径（如`/tmp/pwned_marker`），用于验证任意文件写入。第二个名为`link_to_config`，指向目标仓库在服务器上的`.git/config`文件（如`/data/git/gogs-repositories/attacker/test-repo.git/config`）。这两个符号链接随后被提交并推送到Gogs服务器。
3.  **任意文件覆盖**：攻击者使用Gogs的`PutContents` API，通过认证请求向`http://localhost:3000/api/v1/repos/attacker/test-repo/contents/malicious_link_abs`写入Base64编码的内容。由于漏洞的存在，Gogs错误地跟随`malicious_link_abs`符号链接，将数据写入到服务器上的`/tmp/pwned_marker`，而非仓库内部路径，从而实现任意文件写入。
4.  **RCE通过Git配置注入**：为实现RCE，攻击者再次使用`PutContents` API，目标是`link_to_config`。此次请求的payload是一个精心构造的Git配置文件片段，其中包含`[core]`部分下的`sshCommand`条目（例如`sshCommand = "whoami > /tmp/hacked"`），并定义一个伪造的远程仓库（如`git@github.com:fake/fake.git`）。
5.  **触发RCE Payload**：注入的`sshCommand`不会立即执行。它会潜伏在`.git/config`中，直到Gogs服务器或具有相应权限的用户对受损仓库执行涉及SSH连接的Git操作（例如`git fetch`或`git ls-remote`）。此时，Git客户端会解析配置，识别`sshCommand`，并在尝试建立SSH连接之前执行攻击者定义的命令，最终在Gogs服务器上实现任意命令执行，权限为Gogs服务运行的权限。

**投毒风险分析:**
针对此CVE-2025-8110的POC材料，经过严格评估，其“投毒”风险被判定为极低，具体估算为5%。此低风险评级基于以下几个关键因素：

首先，该POC以详细的Markdown格式漏洞验证报告呈现。它是一个静态、人类可读的文档，而非可执行脚本、编译后的二进制文件或外部代码文件集合。其内容主要由解释性文本、明确的bash命令和`curl`请求组成。这种固有的透明性是其低投毒风险的首要原因。每个命令、每个参数和每一次交互都清晰地展示出来，任何审阅者或安全分析师都可以逐行审查代码。不存在隐藏层、混淆字符串或旨在逃避检测的编码负载。这种透明度从根本上杜绝了恶意代码的隐秘植入。

其次，POC安全性的一个关键方面是其操作目标。报告中详细说明的所有命令都明确设计用于与严格受控和隔离的环境进行交互。目标始终是`http://localhost:3000`，即一个本地Docker容器（`gogs-vulnerable`）。这种本地化目标策略对于减轻任何意外或广泛危害的风险至关重要。漏洞利用命令并非指向外部生产系统、未知IP地址或公共域（除了作为RCE负载一部分的示例性假`git@github.com:fake/fake.git`，它并非POC本身的外部依赖）。这种隔离确保了即使某个命令行为异常，其影响也将被限制在沙盒化的Docker环境中，从而保护了主机系统和外部网络。

第三，POC中存在的“恶意”元素纯粹是说明性的，其唯一目的是演示漏洞的影响。例如，诸如`touch /tmp/pwned_rce_verified`或`whoami > /tmp/hacked`之类的命令是简单、非破坏性的负载。它们的功能是提供具体证据（例如，创建文件或将输出重定向到文件），证明在*隔离的Docker容器内*确实发生了任意命令执行。这些命令并非设计用于数据窃取、建立持久后门或造成拒绝服务条件。它们是渗透测试和漏洞研究中常见的标准、良性验证步骤。

此外，该POC没有显示出与投毒仓库相关的任何高级规避技术或恶意代码注入载体。它不涉及代码混淆、从不受信任的来源包含可疑的外部脚本或库，或尝试从远程、未经验证的服务器下载并执行任意内容。该方法严格遵循公认的安全研究实践，优先采用清晰、可重现的步骤来验证已披露的漏洞。

综上所述，Markdown报告的透明性、对本地隔离测试环境的明确目标以及“恶意”负载的良性和说明性特征，共同促成了极低的投毒风险。出于防御性安全目的（例如漏洞测试、补丁验证或教育研究）使用此POC的个人可以高度确信，他们不会无意中引入恶意代码或危害自己的系统。该材料是CVE的干净、学术性演示，在不造成不当安全威胁的情况下实现了其预期目的。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110
