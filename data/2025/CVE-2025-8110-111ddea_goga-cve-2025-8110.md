## CVE-2025-8110 - Gogs 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-8110

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gogs

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS v3.1)

**影响版本:** Gogs <= 0.13.2

**利用条件:** 需要身份认证 (管理员权限/API Token), 需网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

CVE-2025-8110是影响Gogs自托管Git服务的严重远程代码执行漏洞。该漏洞源于Gogs的`PutContents` API在处理用户上传内容时，对符号链接的过滤不当，导致攻击者可以通过创建指向`.git`目录或其他任意文件路径的符号链接，进而重写关键文件，最终实现远程代码执行。此漏洞被认为是之前修复（如CVE-2024-55947）的绕过，表明Gogs在文件路径处理上存在更深层次的缺陷。

**POC有效性分析**
所提供的POC是一份全面且详细的漏洞验证报告，其目的明确且执行过程透明。报告基于Gogs 0.13.2的Docker环境进行验证，这确保了复现的隔离性和准确性。攻击者需要具备管理员权限和有效的API Token才能利用此漏洞，这表明它是一个经过身份验证的RCE漏洞。POC的关键步骤和验证结果如下：

1.  **符号链接创建与文件覆盖测试**：POC首先演示了任意文件写入的能力。攻击者在本地Git仓库中创建一个名为`malicious_link_abs`的符号链接，使其指向服务器上的任意文件路径，例如`/tmp/pwned_marker`。随后，攻击者将此符号链接推送到Gogs服务器，并通过Gogs的`PutContents` API向`malicious_link_abs`写入Base64编码的内容（例如“UFdORUQ=”代表“PWNED”）。通过`docker exec`命令在Gogs容器内部检查`/tmp/pwned_marker`文件，确认其被成功创建并写入内容，证明Gogs的`PutContents` API在处理符号链接时未能正确限制写入范围，允许其跟随链接写入仓库外部的路径。

2.  **RCE前置：篡改Git配置**：在此基础上，POC进一步展示了如何利用此漏洞实现远程代码执行。攻击者创建另一个符号链接`link_to_config`，指向目标仓库的Git配置目录下的`config`文件，即`/data/git/gogs-repositories/attacker/test-repo.git/config`。同样地，通过`PutContents` API向`link_to_config`写入包含恶意`sshCommand`的Git配置内容。例如，注入`[core] sshCommand = touch /tmp/pwned_rce_verified; /usr/bin/ssh`或`sshCommand = "whoami > /tmp/hacked"`。`sshCommand`是Git的一个配置项，用于指定SSH客户端命令，它会在Git需要通过SSH与远程仓库交互时被执行。

3.  **触发RCE**：RCE的触发机制是当Gogs服务器或其管理员对受影响仓库执行任何涉及远程Git操作（如`git ls-remote git@github.com`）时。此时，Git会读取被篡改的`.git/config`文件中的`sshCommand`指令，并执行其中包含的恶意命令（如`touch /tmp/pwned_rce_verified`或`whoami > /tmp/hacked`），从而在服务器上实现任意命令执行。

4.  **结果验证**：POC通过在Docker容器内部检查`/tmp/pwned_rce_verified`或`/tmp/hacked`文件是否存在，以及`.git/config`文件是否已被成功篡改，从而验证RCE的成功。整个验证流程清晰、可重复，且提供了详细的命令和预期结果，使得该POC具有极高的可用性和可信度。

**利用步骤**
1.  **环境准备**：部署一个Gogs版本为0.13.2或更低的环境（推荐使用Docker）。获取一个具有管理员权限的用户账户及其对应的API Token。
2.  **创建恶意Git仓库**：在本地创建一个新的Git仓库，并初始化。在此仓库中，创建两个符号链接：
    *   `malicious_link_abs`，指向服务器上的一个任意可写路径，例如`/tmp/pwned_marker`。
    *   `link_to_config`，指向目标Gogs实例中受控仓库的`.git/config`文件，例如`/data/git/gogs-repositories/attacker/test-repo.git/config`。
3.  **推送恶意符号链接**：将上述符号链接添加到本地仓库，提交并推送到Gogs服务器上攻击者控制的`attacker/test-repo`仓库。
4.  **执行任意文件写入（验证步骤）**：使用`curl`命令和获取到的API Token，通过`PUT`请求调用Gogs的`http://localhost:3000/api/v1/repos/attacker/test-repo/contents/malicious_link_abs`接口，将Base64编码的“PWNED”内容写入该路径。随后，通过`docker exec gogs-vulnerable cat /tmp/pwned_marker`验证文件是否被创建。
5.  **注入恶意Git配置（RCE核心）**：再次使用`curl`命令，通过`PUT`请求调用`http://localhost:3000/api/v1/repos/attacker/test-repo/contents/link_to_config`接口，将包含恶意`sshCommand`的Git配置内容（如`[core] sshCommand = touch /tmp/pwned_rce_verified; /usr/bin/ssh`）写入目标仓库的`.git/config`文件。
6.  **触发远程代码执行**：在Gogs服务器上（例如通过`docker exec gogs-vulnerable`进入容器），导航到受影响的仓库目录，并执行一个需要与远程交互的Git命令，例如`git ls-remote git@github.com:fake/fake.git`。这将触发Git读取被篡改的`.git/config`并执行恶意`sshCommand`。
7.  **结果验证**：通过`docker exec gogs-vulnerable ls /tmp/pwned_rce_verified`或`cat /tmp/hacked`命令，确认恶意命令是否成功执行并创建了相应文件。

**投毒风险分析**
此POC的投毒风险评估为极低，具体百分比为5%。这一评估是基于对POC内容、行为和目的的全面分析。

1.  **目的透明且良性**：该POC是一份明确标注为“漏洞验证报告”的文档，其核心目标是演示和验证CVE-2025-8110的存在及其利用机制，而非进行实际攻击。所有提供的步骤和代码片段都围绕着漏洞的复现和结果的确认。
2.  **代码行为透明无混淆**：POC中所有的命令、API请求和注入的配置内容均以纯文本形式清晰呈现，没有任何形式的代码混淆、加密或打包。这使得安全研究人员可以轻松审查每一行代码，理解其确切功能，确保没有隐藏的恶意行为。
3.  **无恶意载荷或外部连接**：用于演示RCE的“恶意”载荷（如`touch /tmp/pwned_marker`、`touch /tmp/pwned_rce_verified`或`whoami > /tmp/hacked`）是典型的良性测试命令，其作用仅仅是在目标系统上留下可验证的痕迹，以证明命令执行的能力。这些命令不会对系统造成破坏，也不会建立持久化后门、窃取数据或尝试与外部C2服务器进行通信。POC中未包含任何指向恶意外部资源、下载可疑文件或执行未经授权网络活动的指令。
4.  **环境隔离性**：POC明确建议在Docker环境中进行验证，这一实践极大地降低了潜在风险。即使在复现过程中出现意外情况，其影响也将被限制在隔离的容器中，不会蔓延到宿主系统或其他生产环境。
5.  **符合防御性安全研究原则**：作为专业的防御性安全研究员，区分漏洞验证代码与实际恶意攻击代码至关重要。这份POC严格遵守了伦理规范，专注于揭示漏洞机制，以帮助组织理解威胁并加强防御，而不是作为攻击工具。将其中的测试载荷误判为投毒代码，将违背其在安全社区中的积极作用。

综上所述，这份CVE-2025-8110的POC报告是安全、透明且专业的，完全符合合法防御性安全研究的范畴，不含任何实际的恶意投毒行为。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-8110/
