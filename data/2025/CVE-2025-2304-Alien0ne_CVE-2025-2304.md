## CVE-2025-2304 - Camaleon CMS 权限提升 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限提升 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 

**影响版本:** <= 2.9.0

**利用条件:** 需要认证

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

该漏洞利用POC（Proof of Concept）脚本是一个用Python编写的工具，旨在复现并利用Camaleon CMS 2.9.0版本中的一个认证后的权限提升漏洞。该漏洞的根本原因在于Camaleon CMS在处理用户配置文件更新时，特别是`updated_ajax`控制器动作中，错误地使用了Ruby on Rails的`permit!`方法。在Ruby on Rails中，`params.require(:password).permit!`允许任何通过`password`参数提交的字段被批量赋值（Mass Assignment），其中包括通常不应由用户直接控制的敏感字段，如`role`（角色）。攻击者可以通过发送如`password[role]=admin`这样的参数，将自己低权限用户的角色直接提升为管理员。

该POC脚本的有效性非常高，它完整地模拟了攻击流程。首先，它通过向`/admin/login`发送HTTP POST请求并提供有效的用户名和密码来模拟用户登录。成功登录后，脚本会从`/admin/profile/edit`页面抓取CSRF（跨站请求伪造）令牌，这表明该POC能够正确处理Web应用程序常见的安全防御措施，使其在实际环境中具有更高的成功率。接着，POC向`/admin/profile/updated_ajax`端点发起一个精心构造的POST请求。该请求的表单数据中不仅包含了更新密码所需的字段（`password[password]`和`password[password_confirmation]`），还恶意地添加了`password[role]=admin`参数。由于目标CMS的`permit!`机制，服务器会无条件接受这个角色变更请求，从而导致当前登录用户的权限被提升至管理员级别。

除了核心的权限提升功能，该POC还提供了两个实用且有价值的扩展选项：
1.  **S3配置提取（-e参数）**：在权限提升成功后，脚本可以进一步访问通常只有管理员才能访问的`/admin/settings/site`页面，尝试从中解析并提取敏感的S3存储桶配置信息（如Access Key ID、Secret Access Key等）。这展示了权限提升可能带来的实际信息泄露风险。
2.  **角色回滚（-r参数）**：为了方便测试和避免对目标系统造成长期影响，POC支持在利用完成后将用户的角色恢复到原始状态。这体现了其作为安全研究工具的专业性和责任感。
整个POC代码逻辑清晰、注释详尽，易于理解和调试。它使用了标准的Python `requests`库进行HTTP通信，没有复杂的第三方依赖，确保了其稳定性和可移植性。这些特点共同证明了该POC是一个功能完整、可靠且高效的漏洞利用工具，能够准确复现并验证Camaleon CMS中的认证后权限提升漏洞。

**利用步骤:**
1.  **环境准备**：确认目标Camaleon CMS实例运行在受影响的版本（例如2.9.0或更早版本）。
2.  **获取凭据**：需要一个在目标CMS上注册的有效普通用户凭据（用户名和密码）。
3.  **安装依赖**：在运行POC的机器上，确保安装了Python 3.8+，并通过`pip install requests`安装必要的Python库。
4.  **执行POC**：
    *   **基本权限提升**：运行`python exploit.py -u http://target.com -U your_username -P your_password`。
    *   **提升并提取S3配置**：运行`python exploit.py -u http://target.com -U your_username -P your_password -e`。
    *   **提升并回滚角色**：运行`python exploit.py -u http://target.com -U your_username -P your_password -r`。
    *   **所有功能**：运行`python exploit.py -u http://target.com -U your_username -P your_password -e -r`。
5.  **验证**：POC执行成功后，使用原凭据登录，应能发现用户角色已变为管理员，可以访问管理员专属功能或页面。

**投毒风险分析:**
该POC代码的投毒风险评估为10%，属于极低风险范畴。这一评估基于对其代码结构、依赖项、行为模式及外部交互的全面分析：

1.  **代码透明度和可读性**：该POC使用Python语言编写，代码结构清晰、逻辑直接，没有使用任何形式的代码混淆或加密技术。每个功能模块，包括登录、CSRF令牌获取、权限提升请求构造、S3配置提取和角色回滚，都易于通过代码阅读来理解其具体实现。这种高度的透明性使得安全分析师能够轻松地审查其内部工作机制，识别任何潜在的恶意代码或隐藏功能。

2.  **标准库和第三方依赖**：该脚本仅依赖Python的官方`requests`库，这是一个业界广泛认可、经过严格审查且用于HTTP通信的标准库。它不引入任何可疑的、不知名的或通过非官方渠道获取的第三方二进制文件或模块。使用标准且信誉良好的库显著降低了因引入恶意依赖而导致投毒的风险。

3.  **行为模式的局限性**：POC的行为严格限制在复现Camaleon CMS的权限提升漏洞及其附带的信息泄露功能。它没有尝试执行超出此范围的任何操作，例如：
    *   **未授权的外部通信**：除了与目标Camaleon CMS服务器进行HTTP通信外，脚本未尝试连接任何其他IP地址、域名或C2（命令与控制）服务器。
    *   **文件系统操作**：脚本不会在本地系统上创建、修改、删除任何文件，或上传数据到外部存储，除了正常的日志输出或错误报告（如果存在）。
    *   **系统命令执行**：没有发现调用`os.system()`、`subprocess.run()`或其他可能执行任意系统命令的代码，从而避免了通过命令注入进行系统级破坏的风险。
    *   **持久化机制**：脚本不包含任何尝试在受感染系统上建立后门、安装服务或修改启动项以实现持久化访问的代码。

4.  **无恶意荷载或加密**：脚本不包含任何嵌入式恶意荷载、加密代码或自修改行为。它的设计意图明确且单一，即作为一个概念验证工具。

5.  **验证方法**：对于用户而言，验证该POC安全性的最佳方法是：
    *   **代码审计**：对整个Python脚本进行彻底的代码审查，确保所有函数调用和网络请求都符合预期。
    *   **沙箱环境执行**：在一个隔离的沙箱或虚拟机环境中运行POC，并监控其网络流量、文件系统活动和进程行为，以确认没有异常操作。

综上所述，该POC代码表现出高度的防御性安全研究工具特征，其设计和实现都旨在透明地展示漏洞利用过程，而非隐蔽地执行恶意活动。因此，其投毒风险可以被认定为极低。

**项目地址:** 

**漏洞详情:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-2304
