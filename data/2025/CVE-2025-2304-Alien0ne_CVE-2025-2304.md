## CVE-2025-2304 - Camaleon CMS Privilege Escalation (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** Privilege Escalation (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** High

**CVSS评分:** Not available

**影响版本:** Affects versions < 2.9.1, specifically v2.9.0 and earlier.

**利用条件:** 需要认证 (Valid credentials required), 需要网络访问 (Network access required)

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

POC有效性分析:
The provided Proof-of-Concept (POC) details a critical authenticated privilege escalation vulnerability in Camaleon CMS version 2.9.0. The core issue lies within the `updated_ajax` controller action, which insecurely uses `params.require(:password).permit!`. This `permit!` method, when used carelessly, allows an attacker to update any attribute within the `password` hash, including sensitive ones not intended for user modification through this endpoint. In this specific case, an authenticated user can submit `password[role]=admin` along with legitimate password fields, effectively changing their own role to administrator.

The POC is presented as a Python script, complete with a comprehensive `README.md` that thoroughly explains the vulnerability, its root cause, and detailed usage instructions. The script's functionality includes:
1.  **Authentication**: Logs into the Camaleon CMS using provided valid credentials.
2.  **CSRF Token Acquisition**: Fetches a Cross-Site Request Forgery (CSRF) token from the `/admin/profile/edit` page, which is essential for successfully making POST requests to the application.
3.  **Exploitation**: Crafts and sends a POST request to the `updated_ajax` endpoint. This request includes the obtained CSRF token and the malicious `password[role]=admin` parameter, alongside standard `password` and `password_confirmation` fields, to trigger the mass assignment and elevate the user's privileges.
4.  **Optional Post-Exploitation**: The script offers an option (`-e`) to extract Amazon S3 configuration values (if available) from the `/admin/settings/site` page after successful role escalation. This demonstrates the potential for further sensitive information leakage.
5.  **Optional Reversion**: An additional option (`-r`) allows the user's role to be reverted to its original value after the exploit run, which is particularly useful for defensive testing and minimizing residual impact.

The detailed root cause explanation, including the vulnerable Ruby code snippet, strongly corroborates the exploit mechanism. The script's minimal dependency (`requests`) and clear workflow suggest it is a robust, well-engineered, and fully functional exploit.

利用步骤:
1.  **前提条件**: 攻击者需要获得一个Camaleon CMS实例上的有效用户凭据。这可以是任何已认证的用户账户，不一定是管理员账户。
2.  **环境准备**: 确保系统已安装Python 3.8+及`requests`库。若未安装，可使用`pip install requests`进行安装。
3.  **执行攻击**: 使用提供的Python exploit脚本。根据需求选择不同的参数：
    *   **基础权限升级**: `python exploit.py -u http://[目标CMS URL] -U [用户名] -P [密码]`
    *   **权限升级并提取S3配置**: `python exploit.py -u http://[目标CMS URL] -U [用户名] -P [密码] -e`
    *   **权限升级并在完成后还原角色**: `python exploit.py -u http://[目标CMS URL] -U [用户名] -P [密码] -r`
    *   **权限升级、提取S3配置并还原角色**: `python exploit.py -u http://[目标CMS URL] -U [用户名] -P [密码] -e -r`
4.  **验证影响**: 脚本执行成功后，目标用户的角色将被修改为“admin”。如果使用了`-e`参数，脚本将尝试访问`/admin/settings/site`页面并解析其中可能包含的S3配置信息（如访问密钥、存储桶名称等）。
5.  **后续操作**: 获得管理员权限后，攻击者将对CMS拥有完全控制权，可以执行内容修改、用户管理、插件安装等操作，甚至可能根据CMS的其他功能实现远程代码执行(RCE)。S3配置的泄露可能导致对云存储资源的进一步攻击。

投毒风险分析:
该POC代码的投毒风险评估为0%，即极低风险。以下是支持此评估的几个关键因素：

首先，该POC的文档极其清晰和透明。`README.md`文件详细阐述了漏洞的性质、根本原因（甚至直接提供了脆弱的Ruby代码片段），以及POC脚本的精确运行步骤和其执行的操作。这种高度的透明度使得分析人员可以很容易地理解脚本的预期行为，从而难以隐藏任何恶意功能。模糊不清或缺乏文档的POC往往是恶意代码的常见特征。

其次，脚本的依赖关系非常简单，仅限于标准的Python `requests`库。它没有引入任何不寻常或需要额外下载的第三方库，也没有尝试从外部源（如互联网）下载并执行代码。这种对标准、已知良好库的依赖极大地降低了代码中嵌入恶意负载或引入意外行为的可能性。恶意POC通常会尝试引入非标准库或动态加载代码来隐藏其真实目的。

第三，POC脚本的描述行为与它声称要执行的任务完全一致：通过大规模赋值漏洞进行权限升级，并选择性地提取配置信息。登录、获取CSRF令牌、构建特定的POST请求以更改用户角色，以及从管理员页面抓取S3配置，所有这些步骤都直接服务于漏洞的演示目的。脚本中没有发现任何与命令和控制（C2）通信、持久化后门安装、加密货币挖掘或任何其他典型恶意行为相关的代码迹象。甚至包含一个`--revert`选项，允许测试后恢复用户角色，这进一步表明其主要用于安全研究或测试目的，而非恶意攻击。

最后，根据“务必不要把POC验证的后门代码判定为投毒代码”的指示，虽然此POC通过将用户角色升级为管理员来“创建”了一个临时的管理入口，但这正是漏洞利用的预期结果，而非额外的、未经披露的恶意负载。脚本的目的就是展示如何获得管理员权限。因此，基于代码的清晰度、标准的依赖关系以及与文档完全一致的行为，该POC的投毒风险被判定为可忽略不计。

**项目地址:** Not provided

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2025-2304
