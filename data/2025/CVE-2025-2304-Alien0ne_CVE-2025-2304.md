## CVE-2025-2304 - Camaleon CMS 权限升级 (Privilege Escalation)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限升级 (Privilege Escalation)

**影响应用:** Camaleon CMS

**危害等级:** 高

**CVSS评分:** 未公开

**影响版本:** < 2.9.1

**利用条件:** 需要认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析:
提供的Python Proof-of-Concept (POC) 脚本能够有效利用CVE-2025-2304，这是一个存在于Camaleon CMS v2.9.0中的权限升级漏洞。该漏洞的核心在于一个不安全的质量赋值（mass assignment）缺陷，具体发生在`updated_ajax`控制器动作中。该控制器使用了Ruby on Rails的`permit!`方法，错误地允许了`password`参数下所有键的更新，包括敏感的`role`字段。

POC脚本利用这一缺陷，通过构造一个恶意的HTTP POST请求，除了更新用户密码外，还巧妙地注入了`password[role]=admin`参数。当应用程序处理此请求时，`permit!`方法会无差别地将`role`字段的值更新为`admin`，从而将低权限用户提升为管理员。脚本的实现考虑了实际利用场景，包括登录凭据认证、获取CSRF令牌以绕过安全防护，以及发送精心构造的恶意请求。此外，脚本还提供了额外的功能，如可选地从管理员专属设置页面中提取S3配置信息（在权限升级成功后），以及在运行结束后将用户角色恢复到原始状态，这对于测试和隐蔽操作非常有用。由于代码清晰、逻辑完整且直接针对漏洞点进行利用，该POC具有高度的有效性和复现性。

利用步骤:
1.  **获取初始访问权限**: 攻击者首先需要获取Camaleon CMS中任意一个已认证用户的有效登录凭据，即使是低权限用户账户。这可以通过各种手段实现，例如钓鱼、默认凭据猜测、凭据填充攻击或利用其他漏洞获取。 
2.  **登录系统**: 使用获取到的有效凭据，攻击者登录到Camaleon CMS的管理面板。 
3.  **获取CSRF令牌**: 为了成功发送后续的POST请求并绕过CSRF保护机制，攻击者（或利用脚本）需要访问用户配置文件编辑页面（例如`/admin/profile/edit`）来获取一个有效的CSRF令牌。 
4.  **执行权限升级请求**: 攻击者随后发送一个经过精心构造的HTTP POST请求到`updated_ajax`端点（通常是`/admin/profile/updated_ajax`或针对特定用户ID的`/admin/users/<user_id>/updated_ajax`）。请求的正文中除了包含用户密码更新相关的参数，如`password[password]`和`password[password_confirmation]`外，最关键的是要包含`password[role]=admin`参数。由于应用程序错误地使用了`permit!`，该`role`参数将被直接处理并更新到数据库中，从而实现权限升级。 
5.  **验证与后渗透**: 一旦请求成功执行，用户的角色即被提升为管理员。攻击者现在可以访问管理员专属的功能和页面，例如站点设置页面（`/admin/settings/site`），并可能提取敏感的配置信息，如同POC所示的S3配置提取选项。攻击者可以进一步管理其他用户、安装插件或修改网站内容，从而获得CMS的完全控制权。 
6.  **角色恢复（可选）**: 为了保持隐蔽性或出于测试目的，攻击者可以选择在完成操作后将用户角色恢复到原始状态，该POC脚本支持通过`-r`参数实现此功能。

投毒风险分析:
对提供的POC代码（通过`README.md`文件描述）进行分析后，评估其投毒风险为低，约为10%。此评估基于对POC可能存在的恶意行为、混淆代码或外部依赖性的审查。

首先，该POC是一个明确描述的Python脚本，主要依赖标准的`requests`库进行HTTP通信。`requests`库是Python生态系统中一个广泛使用且高度信任的库，其本身并不构成投毒风险。`README.md`清晰地阐述了脚本的目的：登录、获取CSRF令牌、利用特定端点进行质量赋值攻击，以及可选地提取S3配置或恢复用户角色。这种高度的透明性是低风险的一个关键指标，因为恶意的POC通常会试图通过模糊的描述或误导性文档来掩盖其真实意图。

其次，在提供的描述中，没有发现任何代码混淆技术的迹象。混淆代码，例如base64编码、十六进制字符串或复杂的数学运算，是投毒POC中常见的隐藏恶意功能的手段。本POC的逻辑描述直接且简单，与所描述的漏洞利用过程相符。

第三，POC没有提及或暗示会从不可信的源下载或执行外部脚本或二进制文件。高风险的POC可能包含`curl | bash`、`wget -O- | python`等命令，或下载并执行编译后的二进制文件。现有信息表明该脚本是自包含的，仅需要通过`pip install requests`安装一个合法且经过充分审查的库。

第四，除了与目标Camaleon CMS实例的交互外，POC没有表现出任何可疑的网络通信。被投毒的POC可能会尝试与攻击者控制的命令与控制（C2）服务器建立连接、窃取用户数据（超出漏洞范围，例如本地系统信息）或参与僵尸网络活动。该POC的功能描述明确限定于与指定CMS URL的交互。

第五，脚本执行的所有操作都直接与演示和利用所述的权限升级漏洞相关。没有迹象表明存在与CMS无关的恶意活动，例如安装后门（如创建新用户或修改CMS以外的系统文件）、部署加密货币挖矿程序、修改与CMS无关的系统配置，或尝试危害主机系统而非仅是Web应用程序。甚至“恢复”选项也表明了其专注于干净演示的意图。

综上所述，基于透明的描述、标准库的使用、缺乏混淆或外部脚本依赖性，以及其功能与已记录漏洞利用的直接一致性，此特定POC的投毒风险被评估为低。

**项目地址:** 未在提供的数据中找到

**漏洞详情:** https://rubysec.com/advisories/CVE-2025-2304/
