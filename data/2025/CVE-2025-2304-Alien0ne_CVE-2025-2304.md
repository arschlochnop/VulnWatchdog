## CVE-2025-2304 - Camaleon CMS 权限升级 (Mass Assignment)

**漏洞编号:** CVE-2025-2304

**漏洞类型:** 权限升级 (Mass Assignment)

**影响应用:** Camaleon CMS

**危害等级:** 高危

**CVSS评分:** Not Available

**影响版本:** 版本低于2.9.1 (包括2.9.0及更早版本)

**利用条件:** 需要认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析:
提供的Proof-of-Concept (POC) 脚本针对Camaleon CMS 2.9.0及更早版本，演示了通过不安全的批量赋值（Mass Assignment）实现的严重权限升级漏洞。该漏洞位于`updated_ajax`控制器动作中，具体来说，是由于使用了`@user.update(params.require(:password).permit!)`。在Ruby on Rails中，当`permit!`方法未明确指定允许的参数时，它会允许更新在指定键（此处为`password`）下的所有提交参数。这一疏忽使得一个经过身份验证的低权限用户能够通过注入任意字段来修改用户更新请求。

POC脚本通过发送精心构造的请求，在合法的密码更新字段中包含`password[role]=admin`，从而有效地利用了这一缺陷。当此请求被易受攻击的`updated_ajax`动作处理时，应用程序会意外地将用户的角色更新为“admin”，授予其完整的管理员权限。该脚本首先使用提供的凭据进行身份验证，然后从`/admin/profile/edit`页面获取必要的CSRF令牌，最后发出恶意的`updated_ajax`调用。这种多步骤过程准确反映了真实的漏洞利用场景。POC附带的`README.md`清晰地解释了根本原因和攻击机制，使得脚本的功能透明且可验证。可选功能，例如在权限提升后从管理员设置页面提取敏感的S3配置以及能够恢复角色，进一步增强了POC的全面性，展示了该漏洞的全部影响。这种健壮的设计证实了POC在重现漏洞方面的高效性。

利用步骤:
1.  **环境准备**: 确保目标Camaleon CMS实例运行的是易受攻击的版本，特别是2.9.0或2.9.1之前的任何版本。获取CMS上任何现有用户的有效登录凭据；即使是标准用户帐户也足以发起攻击。
2.  **POC获取与安装**: 下载`exploit.py`脚本及其关联的`README.md`。如果尚未安装，请安装Python 3.8+和`requests`库（`pip install requests`）。
3.  **基本权限升级**: 从命令行执行POC脚本，提供目标CMS的基本URL、有效用户名及其对应的密码。例如：`python exploit.py -u http://example.com -U lowprivuser -P yourpassword`。成功执行后，指定用户的角色将被提升为“admin”。
4.  **可选操作 - S3配置提取**: 为了演示权限升级后的影响，脚本可以选择性地尝试从CMS的设置页面（通常只有管理员才能访问）提取S3配置详细信息。使用`-e`标志：`python exploit.py -u http://example.com -U lowprivuser -P yourpassword -e`。
5.  **可选操作 - 角色回滚**: 出于测试或清理目的，脚本可以使用`-r`标志在漏洞利用后将用户的角色恢复到其原始值：`python exploit.py -u http://example.com -U lowprivuser -P yourpassword -r`。这可以与其他标志结合使用，例如`python exploit.py -u http://example.com -U lowprivuser -P yourpassword -e -r`。
遵循这些步骤，攻击者可以可靠地获得管理员权限，并可能访问Camaleon CMS内的敏感信息。

投毒风险分析:
所提供的POC (`exploit.py`及其`README.md`) 显示出极低的投毒风险（估计为5%）。此评估基于以下几个因素：
1.  **代码透明性**: `README.md`提供了对漏洞、根本原因以及脚本如何利用它的清晰详细解释。代码逻辑被明确描述，使得安全研究人员可以轻松理解其预期行为，而无需反混淆或猜测。
2.  **标准库使用**: 脚本明确列出`requests`作为其唯一的外部依赖项，这是一个广泛使用且受信任的Python HTTP库。没有迹象表明存在可能隐藏恶意功能的复杂、自定义或可疑的导入。
3.  **缺乏可疑行为**: 审查文档化的行为，脚本仅专注于与利用已识别漏洞相关的合法操作：登录、获取CSRF令牌、发送用于权限升级的精心构造的HTTP POST请求，以及可选地发出另一个经过身份验证的GET请求以提取S3配置。没有迹象表明试图建立反向Shell、从未知来源下载额外的有效载荷、修改与CMS无关的系统文件、除了明确提及的S3配置之外泄露敏感数据，或从事任何其他意外的网络活动。
4.  **无混淆**: `README.md`本身是一个纯文本文件，并且根据其描述，引用的Python脚本并未混淆，使其意图清晰。
尽管风险很低，但最佳安全实践要求，任何第三方POC代码，无论其表面上多么良性，都应在执行前由合格的安全专业人员在受控环境（例如，沙箱或隔离的虚拟机）中进行审查，尤其是在针对生产或关键系统时。这可以最大程度地降低任何剩余的、不可预见的或巧妙隐藏的恶意组件的风险。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-2304
