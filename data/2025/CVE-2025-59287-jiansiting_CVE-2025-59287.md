## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 未经身份验证的远程攻击者，需要网络访问，需获取WSUS加密密钥

**POC 可用性:** 4

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS) 组件的高危远程代码执行（RCE）漏洞。该漏洞的根本原因在于WSUS在处理AuthorizationCookie时存在不安全的反序列化缺陷。未经身份验证的远程攻击者可以通过发送特制的事件，触发传统序列化机制中不安全的对象反序列化，从而在目标服务器上以SYSTEM权限执行任意代码。该漏洞被赋予了CVSS 9.8分（满分10分）的严重评级，攻击者无需获取任何身份凭证，即可通过网络远程触发漏洞，实现对目标服务器的完全控制。受影响的Windows Server版本包括Windows Server 2019、Windows Server 2022和Windows Server 2025。

**POC有效性分析:**
提供的POC代码`cve-2025-59287-encrypt.py`是一个Python脚本，其主要功能是实现AES-CBC加密。根据`README.md`的说明，“此EXP需要首先获取Wsus的密钥，此密钥需要通过其他攻击方法获取，这一点需要明确。” 这表明该POC并非一个完整的、开箱即用的漏洞利用工具，而是攻击链中的一个关键组件。脚本中的`encrypt_payload`函数实现了AES-CBC加密逻辑，使用了固定的16字节全零IV，并生成16字节的非零salt，这与WSUS处理AuthorizationCookie时描述的加密机制相符。`main`函数中硬编码了一个十六进制密钥`877C14E433638145AD21BD0C17393071`（用于演示目的），并提供了一个Base64编码的字符串`zfc`，该字符串代表一个被序列化的.NET对象（很可能是一个反序列化gadget链）。

因此，该POC代码在演示如何将一个恶意的.NET反序列化payload进行加密以符合WSUS的AuthorizationCookie格式方面是有效且准确的。它成功地展示了攻击的加密部分，是理解和重现该漏洞的关键一步。然而，它并未包含获取WSUS服务器密钥的机制，也没有实现将加密后的cookie发送到WSUS服务器的实际网络请求部分。这意味着攻击者需要先通过其他途径获得WSUS服务器的AES加密密钥，才能利用此POC生成有效的恶意AuthorizationCookie。如果没有这个密钥，该POC无法独立完成远程代码执行，故将其定为“概念验证”类型，并在质量评分上给予4分，表示它提供了部分核心功能，但需要补充关键前置条件和利用逻辑才能构成完整利用。

**利用步骤:**
1.  **密钥获取：** 攻击者首先需要通过其他攻击方法（例如，通过物理访问、本地权限提升或利用其他漏洞）获取目标WSUS服务器的AES加密密钥。这是利用此漏洞进行远程代码执行的关键前提。
2.  **Payload构造：** 攻击者需要构造一个恶意的.NET反序列化payload。这个payload通常是一个精心设计的gadget链，当WSUS服务器对其进行反序列化时，能够触发任意命令执行（例如，启动计算器、下载并执行恶意文件等）。POC代码中的`zfc`变量提供了一个Base64编码的示例payload片段。
3.  **Payload加密：** 使用获取到的WSUS AES密钥，并通过POC代码中实现的`encrypt_payload`函数（或使用相同逻辑的加密工具），将构造好的恶意.NET反序列化payload进行AES-CBC加密。加密过程包括生成一个16字节的非零随机salt，然后将salt和payload分块加密，通常使用一个固定的16字节全零初始化向量（IV）。
4.  **发送恶意请求：** 将加密后的payload作为`AuthorizationCookie`的值，封装在一个HTTP请求中。攻击者会将这个特制的HTTP请求发送到WSUS服务器的`GetCookie()`或其他相关端点。
5.  **服务端解密与反序列化：** WSUS服务器接收到包含恶意`AuthorizationCookie`的请求后，会使用其内部的AES密钥对cookie进行解密。解密后的数据被传递给.NET的`BinaryFormatter`进行反序列化处理。
6.  **代码执行：** 由于`BinaryFormatter`存在不安全反序列化漏洞，恶意构造的payload在反序列化过程中被执行，从而导致远程代码执行。攻击通常以`SYSTEM`权限运行，赋予攻击者对目标服务器的完全控制权。

**投毒风险分析:**
对`cve-2025-59287-encrypt.py` POC代码进行审查后，可以得出以下投毒风险评估：

1.  **代码清晰度：** 该POC代码的逻辑非常清晰，函数定义明确，变量命名规范，易于阅读和理解。没有发现任何代码混淆或复杂的加密解密逻辑（除了实现AES-CBC本身）。
2.  **依赖库：** 代码主要使用了Python标准库`os`（用于生成随机字节）以及`pycryptodome`库（通过`from Crypto.Cipher import AES`引入）。`pycryptodome`是一个广泛使用且信誉良好的密码学库，通常被认为是安全的。这些库的使用符合其预期功能，没有异常之处。
3.  **外部请求与行为：** 该POC脚本是一个纯粹的本地执行工具，其唯一目的是对提供的字节数据进行AES加密。它不执行任何网络通信（例如，连接到外部C2服务器、下载文件）、不修改系统配置、不写入可执行文件到非标准位置，也不进行任何非预期的文件系统操作。它没有任何迹象表明会进行数据窃取、挖矿或其他恶意活动。
4.  **可疑功能：** 代码中没有发现任何隐藏的后门、调用`eval()`或`exec()`等危险函数、利用操作系统命令注入点，或包含任何看起来可疑的功能。主要的“恶意”部分是`zfc`变量中Base64编码的.NET反序列化payload，但这属于漏洞利用的核心，而非POC代码本身的恶意行为。用户在实际使用时，通常会替换成自定义的payload。

**综合评估：** 鉴于POC代码的透明性、对标准库的合理使用以及缺乏任何可疑的外部通信或系统修改行为，该POC的投毒风险极低。攻击者或安全研究人员可以轻松地审计代码，确认其功能仅限于payload加密。因此，其投毒风险百分比评估为10%。用户在实际使用时，应重点审查`zfc`变量中代表的payload内容，确保其符合预期，避免使用来源不明的payload。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
