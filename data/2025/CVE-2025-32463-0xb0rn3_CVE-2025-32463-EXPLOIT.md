## CVE-2025-32463 - Sudo 本地提权 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危/严重 (Critical)

**CVSS评分:** 9.3

**影响版本:** Sudo before 1.9.17p1

**利用条件:** 需要本地用户权限，并且目标用户的`sudoers`配置中必须显式允许使用`ChrootDir`选项（例如`ChrootDir=*`或指定路径）。即使没有`NOPASSWD`，只要允许`sudo -R`即可利用。这表明攻击需要对目标系统有一定程度的控制或了解。

**POC 可用性:** 9

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

CVE-2025-32463是一个在Sudo软件中发现的高危本地提权漏洞，其CVSS评分为9.3（严重）。根据公开披露的信息，此漏洞影响Sudo 1.9.17p1之前的版本。该漏洞的核心问题在于Sudo在执行`--chroot`选项时，错误地从用户控制的目录加载`/etc/nsswitch.conf`文件。正常情况下，Sudo在进行chroot操作后，应仅使用chroot环境内的配置。然而，在此漏洞中，即使Sudo在chroot环境中，它仍可能从用户可控的外部路径加载Name Service Switch (NSS) 配置文件。攻击者若能控制chroot目录，便可在此目录中植入恶意的`nsswitch.conf`文件，并指定一个恶意共享库。当Sudo以提升的权限运行并尝试解析名称服务时，它将加载这个恶意库，从而允许本地攻击者在Sudo降低权限之前执行任意代码，最终获得root权限。此漏洞要求攻击者具备本地系统访问权限，并且Sudo配置（sudoers文件）允许目标用户使用`-R`（chroot）选项。这种配置通常不是默认设置，但在某些特定隔离环境或容器化场景中可能存在。例如，在Ubuntu和Debian等Linux发行版中，此漏洞被标记为高优先级。

需要特别指出的是，所提供的POC代码（路径为`/tmp/vulnwatchdog_.../README.md`）明确指出其目标是**CVE-2023-42456**，而非本分析的主体CVE-2025-32463。尽管两个CVE都涉及Sudo的`-R` (chroot) 功能与NSS库劫持导致本地提权，但它们针对的Sudo版本范围和具体的修复点可能存在差异。CVE-2023-42456的POC标题为"Xpl0it — Sudo NSS Library Hijack"，由0xb0rn3开发。该POC的设计目的在于利用Sudo在处理动态NSS库加载时的信任模型缺陷，当`sudo -R`与`chroot`目录结合使用时，攻击者可以通过控制`chroot`目录内的`nsswitch.conf`来强制Sudo加载恶意的共享库。POC声称成功利用后可获得root shell或以`uid=0 gid=0`执行指定命令。

该POC针对CVE-2023-42456，根据其README文件描述，是高度有效和功能完整的。它不仅详细解释了漏洞原理，还提供了清晰的使用指南。POC通过版本检测机制来避免对非漏洞版本进行误报，这体现了其开发的严谨性。受影响版本包括Sudo 1.9.14.x（所有版本）、1.9.15至1.9.15p1、以及1.9.16至1.9.16p1，而1.9.17及更高版本不受影响。这与CVE-2025-32463的受影响版本（Sudo before 1.9.17p1）范围有所重叠，但具体的漏洞触发点和修复可能不同。
**利用步骤（基于CVE-2023-42456 POC）：**
1.  **前提条件确认**：攻击者需要具备本地用户权限，且目标用户的sudoers条目中必须显式允许使用`ChrootDir`选项，例如`targetuser ALL=(root) ChrootDir=* NOPASSWD: ALL`。
2.  **构建恶意环境**：POC会在一个用户可控的目录中构建一个恶意chroot环境。这个环境中包含一个定制的`nsswitch.conf`文件，它会引导Sudo去加载一个由攻击者控制的恶意共享库（`.so`文件）。
3.  **恶意库的注入**：恶意共享库通常包含一个构造函数（如`_init`），当库被加载时会自动执行。该构造函数会利用Sudo此时仍处于root权限的特点，执行提权操作。
4.  **触发漏洞**：攻击者随后执行`sudo -R /path/to/malicious_chroot_dir`命令，Sudo在解析用户或组信息时，会根据恶意`nsswitch.conf`加载攻击者提供的恶意NSS模块，从而触发恶意代码执行并获取root权限。
5.  **获取Root Shell**：一旦恶意代码执行，POC通常会直接将用户置于root shell中，或者执行预设的root命令。

对于所提供的POC代码（尽管其目标是CVE-2023-42456），其投毒风险评估为**0% (低风险)**。主要基于以下几点：
1.  **明确的免责声明**：POC的README文件开头包含清晰的免责声明，强调其仅用于授权的渗透测试和教育安全研究，并警告未经授权的使用是非法的。
2.  **详细的原理说明**：POC详细阐述了其利用的技术原理，即Sudo NSS库劫持，并解释了漏洞存在的条件和受影响的版本范围。这种开放性使得用户可以理解其工作方式。
3.  **无混淆或外部依赖**：从提供的README内容看，POC没有显示出代码混淆的迹象，也没有提及下载或执行外部恶意脚本。它描述了本地构建恶意chroot环境和恶意库的过程，这些过程是透明且可审计的。
4.  **聚焦于特定CVE**：该POC明确指出其针对的是CVE-2023-42456，并列出了其他不相关的CVE，以避免混淆和误导。这种精确性有助于用户了解其用途和局限性。
5.  **防御性研究目的**：考虑到该工具是作为概念验证（PoC）安全研究工具发布的，其主要目的是帮助安全研究人员和防御者理解漏洞并验证其存在，从而加强防御措施，而非设计为广泛传播或用于恶意攻击。基于这些点，该POC本身似乎是一个合法的安全研究工具，在其设计或声明的意图中没有内在的"投毒"风险。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
