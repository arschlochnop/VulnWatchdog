## CVE-2025-32463 - Sudo 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危/Critical

**CVSS评分:** 9.3

**影响版本:** Sudo 版本 1.9.14 到 1.9.17（含），在 1.9.17p1 中修复。

**利用条件:** 需要本地访问权限；Sudoers配置中需允许目标用户使用"ChrootDir="指令，且通常与"NOPASSWD"结合使用；攻击者需控制chroot目录。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-32463 Linux Sudo 本地提权漏洞的POC有效性分析、利用步骤与投毒风险评估：

**POC有效性分析:**
所提供的POC代码虽然在其 `README.md` 中明确指出是针对 `CVE-2023-42456`，但其描述的攻击技术——“sudo `-R` chroot NSS library injection → privilege escalation to root”——与搜索结果中对 `CVE-2025-32463` 的描述高度一致，即“Sudo 在处理 chroot 选项时的一个缺陷联合nss劫持，导致本地用户提权”。这表明尽管CVE编号不同，但两者很可能共享相同的核心漏洞机制或属于同一类漏洞利用技术。此POC旨在利用 `sudo` 在使用 `-R` (chroot) 标志时，在权限降级前，对动态加载NSS (Name Service Switch) 库的处理方式存在的信任模型缺陷。在受影响的 `sudo` 版本上，如果攻击者能够控制 `chroot` 目录，就可以在该目录内部精心构造 `nsswitch.conf` 文件，强制 `sudo` 在其仍持有提升权限时加载一个恶意的共享库。一旦恶意库被加载并执行，它就能以 `root` 权限运行任意代码。POC强调了一个关键的先决条件：目标用户的 `sudoers` 配置条目必须明确包含 `ChrootDir=` 指令，允许其使用 `-R` 选项，并且通常会与 `NOPASSWD` 选项结合使用。如果缺少 `ChrootDir` 权限，`sudo` 会直接拒绝 `-R` 标志的使用。POC还声称具备针对 `CVE-2023-42456` 的详细版本检测功能，以避免误报，这暗示了其作为概念验证工具的严谨性。其最终目标是提供一个 `root` shell 或以 `uid=0 gid=0` 执行指定的命令，表明这是一个完整的提权利用。因此，尽管并非直接为 `CVE-2025-32463` 命名，此POC代码为理解和验证 `CVE-2025-32463` 所利用的NSS劫持提权机制提供了极具价值的参考和实现范例。

**利用步骤:**
1.  **环境准备与先决条件检查**: 确认目标系统的 `sudo` 版本是否在 `CVE-2025-32463` 的受影响范围内（即Sudo 1.9.14到1.9.17p1）。最关键的是，目标用户的 `sudoers` 配置必须明确允许使用 `ChrootDir=` 指令，例如 `targetuser ALL=(root) ChrootDir=/var/jail/* NOPASSWD: /bin/bash` 或 `ChrootDir=*`。
2.  **获取与部署POC**: 将POC代码（通常是一个包含利用脚本、恶意共享库源代码和相关配置文件的包）下载并放置在受攻击的本地机器上。
3.  **编译恶意共享库**: POC通常包含一个用C语言编写的恶意共享库（例如 `libnss_exploit.so`）的源代码。攻击者需要将其编译成动态链接库文件，该库在被 `sudo` 加载时，会执行提权payload，例如调用 `setuid(0); setgid(0); execve("/bin/sh", ...);` 来启动一个 `root` shell。
4.  **构建Chroot环境**: 在 `sudoers` 允许的 `ChrootDir` 路径下，创建一个受攻击者完全控制的目录结构，作为 `chroot` 环境的根目录。
5.  **劫持NSS配置**: 在这个 `chroot` 环境内部，创建或修改 `etc/nsswitch.conf` 文件，将其配置为在解析名称服务时，优先加载攻击者提供的恶意共享库。例如，将 `passwd: files systemd` 修改为 `passwd: files exploit systemd`，其中 `exploit` 指向恶意库。
6.  **执行漏洞利用**: 运行POC提供的利用脚本（例如 `./sudo-chwoot.sh`）。该脚本会以当前低权限用户身份调用 `sudo -R /path/to/chroot /bin/bash` (或任意命令)。`sudo` 在处理 `-R` 选项时，会在特权模式下进入 `chroot` 环境，并尝试加载 `chroot` 环境内的 `nsswitch.conf`。此时，`sudo` 将加载攻击者提供的恶意共享库，从而在 `sudo` 仍持有 `root` 权限时执行恶意代码。
7.  **权限提升**: 恶意代码执行后，攻击者即可获得 `root` 权限的 shell 会话，或执行任何预设的 `root` 命令。

**投毒风险分析:**
此POC的 `README.md` 清晰地指明其为“概念验证 (PoC) 安全研究工具”，并明确声明其唯一用途是“授权渗透测试和教育安全研究”。它包含强烈的免责声明，明确指出未经授权的使用是非法的，且作者不对任何滥用行为负责。这种透明且负责任的声明极大地降低了其作为恶意软件的直接风险。从功能层面看，该POC的核心机制是构建一个恶意的NSS共享库，并通过劫持 `nsswitch.conf` 来欺骗 `sudo` 加载它，从而实现提权。这个恶意共享库是漏洞利用的组成部分，它执行的 payload (如获取 `root` shell) 是为了验证漏洞，并非POC代码本身携带的“后门”或“投毒”行为。因此，我们应严格区分漏洞利用代码与恶意软件。通过对 `README.md` 的审阅，未发现任何代码混淆、可疑的外部网络请求、加载外部脚本或执行非标准操作的迹象。项目的作者信息是公开的，进一步增强了可信度。基于以上分析，该POC的投毒风险被评估为低（10%）。然而，作为防御性安全研究员，我们始终建议在独立的、隔离的环境中对所有来自外部来源的POC代码进行详细审查和测试，以确保其行为完全符合预期，并且不包含任何未声明的恶意功能。在实际部署和使用前，务必对源代码进行人工审计。

**项目地址:** https://github.com/kh4sh3i/CVE-2025-32463

**漏洞详情:** https://ubuntu.com/security/CVE-2025-32463
