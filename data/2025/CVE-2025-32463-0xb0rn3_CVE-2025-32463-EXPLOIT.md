## CVE-2023-42456 - sudo 权限提升 (Privilege Escalation)

**漏洞编号:** CVE-2023-42456

**漏洞类型:** 权限提升 (Privilege Escalation)

**影响应用:** sudo

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** sudo 1.9.14 – 1.9.14p2 (所有版本), 1.9.15 – 1.9.15p1 (修复于 1.9.15p2), 1.9.16 – 1.9.16p1 (修复于 1.9.16p2)

**利用条件:** 需要目标用户的sudoers配置中包含ChrootDir指令，且攻击者需控制chroot目录。

**POC 可用性:** 9/10

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析:
提供的`README.md`文件详细介绍了`Xpl0it`，这是一个针对CVE-2023-42456的概念验证工具。该漏洞源于`sudo`在处理动态NSS (Name Service Switch) 库加载时存在的信任模型缺陷，特别是在使用`-R` (chroot) 标志时。`Xpl0it`工具的核心功能是演示如何将权限提升至`root`。它通过利用攻击者控制`sudo -R`指定的`chroot`目录的场景来实现。在受控的`chroot`环境中，攻击者可以篡改`nsswitch.conf`文件，强制`sudo`加载一个恶意的共享库。关键在于，这个恶意库是在`sudo`仍然持有`root`权限时加载的，即在其降低权限之前。`Xpl0it`声称成功运行时可以将用户置于`root` shell下，或者以`uid=0 gid=0`执行任何指定的命令，这证实了其完全权限提升的能力。

该README文件还明确列出了受影响的`sudo`版本：`1.9.14`到`1.9.14p2`（此分支中的所有版本），`1.9.15`到`1.9.15p1`（在`1.9.15p2`中修复），以及`1.9.16`到`1.9.16p1`（在`1.9.16p2`中修复）。它还特别指出`sudo 1.9.17`及更高版本不受此漏洞影响，纠正了早期可能存在的错误信息。这种精确的版本检测机制表明该工具可能具有健壮的实现。此外，工具还明确排除了其他`sudo` CVEs，如CVE-2021-3156 (Baron Samedit)，这表明其利用技术具有高度的专注性和精确性。

利用此漏洞的一个关键前提是目标用户的`sudoers`配置中必须存在明确的`ChrootDir=`指令。如果缺少此指令，`sudo`将完全拒绝`-R`标志。README中提供了允许利用的`sudoers`配置示例，从不受限制的`ChrootDir=*`到路径受限的条目，工具声称可以适应这些配置并在其中创建暂存目录。这些详细的文档和清晰的技术解释表明，只要目标环境满足特定的先决条件，POC代码很可能功能完备且有效。

利用步骤:
1. **识别目标**: 攻击者需要识别运行受影响`sudo`版本（`1.9.14 – 1.9.14p2`, `1.9.15 – 1.9.15p1`, `1.9.16 – 1.9.16p1`）的系统。
2. **前置条件检查**: 确认目标系统上目标用户的`sudoers`配置中包含`ChrootDir=`指令，并且攻击者对该`chroot`目录具有控制权。
3. **准备攻击环境**: 攻击者将在受控的`chroot`目录内设置恶意环境。这包括创建一个恶意的`nsswitch.conf`文件，该文件将强制`sudo`加载攻击者提供的恶意共享库。
4. **注入恶意库**: 当用户执行`sudo -R`命令时，由于`nsswitch.conf`被篡改，`sudo`会在降权之前加载并执行攻击者指定的恶意共享库。
5. **权限提升**: 恶意共享库被加载后，会在`sudo`仍拥有`root`权限时执行其代码。`Xpl0it`工具旨在利用此机会直接获得`root` shell 或以`root`权限执行任意命令。这些步骤利用了`sudo`在处理`chroot`环境中的`NSS`库加载机制时的信任模型缺陷，从而实现权限提升。

投毒风险分析:
该POC (Xpl0it) 的投毒风险被评估为**低**，具体为10%。主要基于以下几个方面：
1. **明确的免责声明**: README文件开头包含一个显著的警告和免责声明，明确指出该工具仅用于“授权的渗透测试和教育性安全研究”，并强调“作者对任何误用不承担责任。未经授权的使用是非法的。” 这种声明强烈表明其意图是防御性的和道德的，旨在帮助研究人员和安全团队理解和测试漏洞，而非用于恶意攻击。
2. **POC的性质**: 作为一个“概念验证安全研究工具”，它的目的是展示漏洞的存在和可利用性，而不是提供一个隐蔽的、持久的攻击载荷。通常，这类工具的代码结构会比较清晰，便于安全研究人员审查。
3. **缺乏可疑行为指示**: 从提供的README内容来看，没有迹象表明该工具会进行代码混淆、下载外部恶意脚本、执行未授权的网络请求或包含任何其他已知用于投毒的恶意行为。其描述专注于漏洞的技术细节和利用机制。
4. **本地化利用**: 漏洞利用过程主要涉及在受控的`chroot`环境中进行本地文件（`nsswitch.conf` 和恶意共享库）的创建和加载，这通常不会涉及到复杂的远程投毒机制。
5. **目的明确**: 工具的最终目标是获得`root` shell 或执行指定命令，这是安全研究工具在成功利用漏洞后常见的行为，不应与投毒混淆。

综上所述，尽管任何可执行代码都存在被恶意修改的理论风险，但就该POC目前披露的文档信息而言，其设计宗旨、明确的用途和缺乏可疑行为模式，使其作为公开披露的POC代码本身的投毒风险非常低。使用者应始终从可信源获取此类工具，并在安全隔离的环境中进行分析和验证。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2023-42456
