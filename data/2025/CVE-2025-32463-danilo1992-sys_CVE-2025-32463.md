## CVE-2025-32463 - Sudo 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 to 1.9.17

**利用条件:** 本地访问

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个高危的本地提权漏洞，影响Linux系统上的Sudo工具，具体涉及版本1.9.14至1.9.17。该漏洞源于Sudo在处理`--chroot`（或`-R`）选项时存在不当，它会在权限降低之前从用户控制的目录加载配置文件，例如`/etc/nsswitch.conf`。这使得本地攻击者可以通过诱导Sudo加载恶意共享库来获取root权限。该漏洞最初于2023年6月在Sudo v1.9.14中引入，并已在版本1.9.17p1中得到修复。根据CVSS评分，其严重性为9.3，属于关键级别。

**POC有效性分析：**
提供的概念验证（POC）代码`CVE-2025-32463.sh`是一个完整且功能性的漏洞利用脚本。该脚本通过以下步骤系统地构建并执行攻击：
1.  **创建临时环境**：脚本首先使用`mktemp`在`/tmp`下创建一个临时目录，所有后续操作都在此目录中进行。
2.  **生成恶意C代码**：脚本在临时目录中创建一个名为`woot.c`的C源文件。此C代码包含一个`__attribute__((constructor))`修饰的`woot`函数，这意味着该函数将在库加载时自动执行。`woot`函数的核心功能是调用`setreuid(0,0)`和`setregid(0,0)`来将进程的有效和实际用户/组ID设置为0（即root），然后切换到根目录并执行`/bin/bash`，从而获得一个root shell。
3.  **构建恶意文件结构**：脚本创建`woot/etc`和`libnss_`子目录。最关键的一步是创建`woot/etc/nsswitch.conf`文件，并写入内容`passwd: /woot`。这个自定义的`nsswitch.conf`旨在误导系统名称服务切换（NSS）机制，使其在查找用户密码信息时尝试加载一个特定的NSS模块。
4.  **编译恶意库**：使用`gcc`将`woot.c`编译成一个共享库`libnss_/woot.so.2`。`-Wl,-init,woot`编译选项确保在库加载时执行`woot`函数（即我们的提权payload）。
5.  **触发漏洞**：最后，脚本执行命令`sudo -R woot woot`。`-R`（或`--chroot`）选项指示Sudo在`woot`目录（即我们精心构造的环境）中运行。当Sudo在此chroot环境中尝试解析用户或组信息时，它会使用攻击者控制的`nsswitch.conf`。由于`nsswitch.conf`中的`/woot`条目，Sudo将尝试加载`libnss_/woot.so.2`。一旦该恶意库被加载，其`woot`构造函数就会执行，从而在Sudo正确降权之前获取root权限。基于上述分析，该POC具有高度的有效性，并清晰地展示了漏洞的利用路径。

**利用步骤：**
1.  确认目标系统运行的是Sudo的受影响版本（1.9.14至1.9.17）。
2.  将`CVE-2025-32463.sh`脚本下载到本地系统。
3.  授予脚本执行权限：`chmod +x CVE-2025-32463.sh`。
4.  执行脚本：`./CVE-2025-32463.sh`。
5.  如果利用成功，用户将获得一个root shell。

**投毒风险分析：**
所提供的POC脚本`CVE-2025-32463.sh`及其内嵌的C代码`woot.c`的投毒风险极低。该脚本的操作完全透明，并且仅限于本地系统，主要在为利用目的创建的临时目录中进行。脚本中没有发现任何代码混淆、Base64编码的payload或可疑的外部网络请求。C代码是一个标准且易于理解的提权payload（将UID/GID设置为0并生成一个root shell），这与演示本地提权漏洞的预期功能完全一致。除了为了演示漏洞而获取受影响系统上的root权限这一预期功能外，没有迹象表明存在其他恶意活动。脚本使用`gcc`进行编译也是此类漏洞利用中的常见做法。因此，作为合法的防御性安全研究人员，该POC本身包含隐藏后门或其他恶意功能的风险极小，大约为5%。在受控环境中进行分析和测试时，只要用于合法的安全研究和测试目的，组织可以安全地使用此POC，而无需担心因POC本身而导致的意外系统泄露。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
