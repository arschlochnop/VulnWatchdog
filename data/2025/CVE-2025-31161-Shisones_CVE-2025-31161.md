## CVE-2025-31161 - CrushFTP 身份认证绕过/逻辑缺陷

**漏洞编号:** CVE-2025-31161

**漏洞类型:** 身份认证绕过/逻辑缺陷

**影响应用:** CrushFTP

**危害等级:** 关键

**CVSS评分:** 9.8

**影响版本:** < 10.8.4 和 < 11.3.1

**利用条件:** 无需认证、需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

该POC代码提供了一个针对CrushFTP（版本低于10.8.4和11.3.1）的身份认证绕过漏洞CVE-2025-31161的完整验证和利用机制。从提供的Readme文件和使用说明来看，该POC设计精良，功能完备。它明确指出了漏洞的根本原因在于CrushFTP在处理特定格式的AWS4-HMAC认证头时存在一个逻辑缺陷。具体来说，当一个被“破坏”（mangled）的Credential=user/头部被发送到服务器时，它会导致一个未处理的Java IndexOutOfBounds异常。这个异常的关键影响在于，它阻止了服务器执行正常的会话清理流程，从而使得请求的用户在没有提供正确密码的情况下，仍然被视为已通过认证。这种绕过机制的描述与业界对身份认证绕过漏洞的理解高度一致，通常涉及绕过身份验证逻辑或利用其错误处理路径。
POC提供了两种操作模式，这极大地增强了其在安全测试中的实用性：
1. Check Mode（检查模式）: 允许安全研究人员在不修改目标系统的前提下，验证目标CrushFTP实例是否存在该漏洞。通过尝试泄露默认管理员账户的会话cookie，POC能够提供明确的漏洞存在证据。这种模式对于风险评估和合规性扫描尤其有用，因为它提供了非侵入式的检测能力。
2. Exploit Mode（利用模式）: 在确认漏洞存在后，攻击者或授权测试人员可以利用此模式进一步接管系统。该模式通过劫持一个指定管理员用户的会话，然后利用该会话在CrushFTP实例中注入一个新的管理账户。这意味着攻击者可以获得对CrushFTP服务器的完全管理控制权，包括文件传输、用户管理等所有功能。
POC的Python脚本（例如exploit.py）依赖于标准的requests库，这是一个广泛用于HTTP通信的Python库，增加了代码的稳定性和可移植性。清晰的使用说明、命令行参数和示例命令，使得该POC易于部署和执行，即使对于经验相对较少的测试人员也能快速上手。整体而言，该POC不仅证明了CVE-2025-31161漏洞的存在，还提供了直接、有效的利用途径，其高质量和完整性表明该漏洞对受影响的CrushFTP系统构成了严重威胁。

利用步骤:
1. 准备环境: 攻击者或安全研究人员需要一台操作系统（如Linux、macOS或Windows）并安装有Python 3.x解释器。同时，需确保Python环境中安装了requests库，可通过运行pip install requests命令进行安装。目标CrushFTP服务器必须运行受影响的版本，即低于10.8.4或低于11.3.1。
2. 获取POC代码: 从公开的GitHub仓库（如https://github.com/r0otk3r/CVE-2025-31161）克隆或下载POC代码到本地测试环境。例如：git clone https://github.com/r0otk3r/CVE-2025-31161.git，然后进入克隆下来的目录。
3. 漏洞检测 (可选但推荐): 在尝试利用之前，建议先使用“Check Mode”验证目标是否存在漏洞。执行命令：python3 exploit.py check -u <target_ip> -p <port>。其中，<target_ip>是CrushFTP服务器的IP地址或域名，<port>是CrushFTP服务的监听端口（通常为8080）。如果目标易受攻击，POC会提示成功并可能显示泄露的会话信息。
4. 执行漏洞利用: 如果检测结果表明目标存在漏洞，可以切换到“Exploit Mode”进行实际的接管操作。执行命令：python3 exploit.py exploit -u <target_ip> -p <port> -a <admin_user> -nu <new_username> -np <new_password>。
   * <target_ip>和<port>同上。
   * <admin_user>: 需要指定一个在CrushFTP上已存在的管理员用户名，例如默认的crushadmin。POC将尝试劫持此用户的会话。
   * <new_username>: 攻击者希望在CrushFTP系统中创建的新管理员账户的用户名。
   * <new_password>: 为新创建的管理员账户设置的密码。
5. 确认控制: 脚本成功执行后，攻击者可以使用新创建的<new_username>和<new_password>登录到CrushFTP管理界面，从而获得对整个系统的完全控制权，包括上传、下载文件，管理用户，配置服务器设置等。

投毒风险分析:
对所提供的POC代码进行投毒风险评估后，我们认为其投毒风险为低（0%）。这一判断基于以下多方面考量：
首先，该POC项目在GitHub上公开发布，并明确遵循MIT许可证。MIT许可证是一种高度宽松的开源许可证，允许代码的自由使用、修改和分发，但也要求保留版权和许可声明。许可证的透明性以及代码的开源特性，使得其可以被全球的安全社区广泛审查和审计。通常情况下，恶意代码的作者会避免使用如此开放且易于追踪的许可证。
其次，POC的Readme.md文件包含了明确的免责声明和使用警告。它明确指出该工具仅用于授权的安全测试和教育目的，并强调未经授权的使用是违法行为。这种负责任的披露和警示态度，与试图隐藏恶意意图的投毒代码作者的行为模式截然不同。恶意投毒者通常会通过虚假宣传来诱导用户运行其代码，而非发出合法使用警告。
第三，从技术实现上看，POC代码的依赖性非常明确且普遍。Readme.md中仅列出了requests这个Python标准HTTP库作为其唯一先决条件。requests是一个经过广泛测试和信任的库，其本身不包含恶意功能。POC并未引入任何不常见、可疑或需要额外特权的第三方库或外部脚本。这种对标准、透明技术的依赖性，降低了隐藏恶意功能的可能性。
第四，POC的代码行为是透明且可预测的。其核心逻辑是模拟特定的HTTP请求（包含精心构造的AWS4-HMAC头）以触发CrushFTP的认证绕过漏洞，最终目标是在目标系统上创建新的管理员账户。这一过程与POC文档中描述的功能完全一致，没有发现任何代码混淆、加密，或任何可能指向未声明功能的迹象（如未经授权的数据外传、与C2服务器通信、植入后门、加密勒索等）。“注入新管理员账户”是漏洞利用本身的关键步骤，而非额外的恶意载荷，是实现完全管理控制的直接方式。
最后，作为一个GitHub上的公开项目，它受到了社区的监督和审查。如果代码中存在任何恶意行为，很可能会被其他安全研究人员迅速发现、报告并标记。目前没有证据表明该POC存在此类报告。
综上所述，该POC在透明度、授权、依赖性和行为上都表现出高度的合法性和安全性，因此将其投毒风险评估为0%。然而，需要强调的是，尽管POC本身无毒，但如果被恶意方获取并用于攻击，其对CrushFTP系统的危害是极高的。

**项目地址:** https://github.com/r0otk3r/CVE-2025-31161

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-31161
