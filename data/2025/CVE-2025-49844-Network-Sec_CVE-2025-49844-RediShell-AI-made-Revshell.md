## CVE-2025-49844 - Redis 远程代码执行 (RCE), Use-After-Free (UAF)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (RCE), Use-After-Free (UAF)

**影响应用:** Redis

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** 所有支持Lua脚本的Redis版本（包括6.x-8.x分支）均受影响。具体而言，受影响版本在以下已打补丁版本之前：6.4.2-131, 7.2.4-138, 7.4.6-272, 7.8.6-207, 和 7.22.2-20。

**利用条件:** 需要经过认证的攻击者（低权限或更高）及网络访问。

**POC 可用性:** 6/10

**POC 类型:** 概念验证 (仅导致崩溃)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49844被命名为RediShell，是Redis数据库中一个极其严重的远程代码执行（RCE）漏洞，CVSS评分高达10.0分。该漏洞由Wiz研究团队发现，并影响所有支持Lua脚本的Redis版本，包括6.x至8.x的全部分支。其核心是Redis Lua脚本执行模块中存在的Use-After-Free（UAF）漏洞。经过认证的攻击者（包括具有低权限的用户）可以通过构造特殊的Lua脚本，精确操控Redis的垃圾回收机制，触发该UAF漏洞，从而实现内存损坏，最终导致在Redis服务器上执行任意代码，实现服务器的完全失陷。

**POC代码分析及有效性：**
本次提供的POC代码文件名为`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`。需要特别指出的是，该文件所指向的CVE编号（CVE-2025-62507）与搜索结果中反复提及的`CVE-2025-49844`存在明显差异。尽管同目录下的`README.md`文件尝试将该Python脚本与`CVE-2025-49844`关联，并称其为“AI-made Revshell PoC”，但`README.md`自身也明确指出该POC仅能导致Redis服务器崩溃，而无法实现远程代码执行。实际上，该Python脚本利用的是Redis中`XACKDEL`命令的一个缓冲区溢出（Buffer Overflow）漏洞，而非`CVE-2025-49844`所描述的Lua脚本Use-After-Free漏洞。

该POC代码使用`pwn`库与Redis服务器建立连接，并通过以下步骤触发漏洞：首先，它发送`XGROUP CREATE mystream mygroup 0-0 MKSTREAM`命令，为后续的`XACKDEL`操作创建必要的流和消费者组。随后，它构造一个包含20个伪造流ID的payload。这些流ID通过将循环模式的字节转换为巨大的64位整数来生成，旨在超越Redis内部处理`XACKDEL`命令时用于存储ID的静态缓冲区（`STREAMID_STATIC_VECTOR_LEN`为8）。当Redis尝试处理这些超出预期的ID时，缓冲区溢出被触发，导致服务器崩溃。因此，该POC代码在触发Redis服务器崩溃方面是有效的，但它并非针对`CVE-2025-49844`的远程代码执行利用，也未涉及Lua脚本的UAF。

**CVE-2025-49844利用步骤（基于搜索结果）：**
1.  **权限获取**：攻击者首先需要获取对目标Redis服务器的认证权限。该漏洞要求攻击者拥有低权限或更高用户权限才能执行Lua脚本。这可以通过弱密码、凭据泄露或利用其他漏洞绕过认证来实现。
2.  **构造恶意Lua脚本**：攻击者精心设计一个恶意的Lua脚本。此脚本将利用Redis Lua引擎中处理内存分配和释放的逻辑缺陷，通过特定的操作序列触发Use-After-Free（释放后重用）条件。
3.  **操控垃圾回收机制**：恶意Lua脚本会尝试通过一系列操作来影响Redis的垃圾回收机制，使其在特定内存区域被释放后，攻击者能够再次访问并覆写这片区域。
4.  **内存损坏与执行流劫持**：一旦成功触发UAF并控制了释放后的内存，攻击者便可利用内存损坏来劫持程序执行流，例如覆写函数指针或返回地址。这允许攻击者加载恶意Redis模块（如果有条件）或直接执行任意操作系统命令。
5.  **远程代码执行**：最终，攻击者通过上述步骤在Redis服务器上执行任意代码，完全控制受害系统。

**投毒风险分析：**
针对提供的Python POC代码`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`进行分析。该脚本的编写风格清晰，代码逻辑直接明了，主要目的是通过发送特制数据包触发Redis服务器崩溃，以验证缓冲区溢出漏洞的存在。它使用`pwn`库进行网络通信，这是一个在CTF和漏洞研究中常用的安全工具库，其本身不包含恶意功能。代码中没有发现任何混淆、加密指令、外部恶意链接请求、异常的文件读写操作或尝试执行非预期系统命令的行为。该脚本专注于构造特定的payload以实现崩溃效果，不涉及后门植入、数据窃取或其他恶意负载。因此，就此Python脚本本身而言，其投毒风险非常低。虽然`README.md`中提到“AI-made Revshell PoC”可能暗示恶意意图，但实际代码并未实现反向shell或任何恶意功能，且明确承认仅导致崩溃。`README.md`中引用的其他GitHub PoC链接（如`https://github.com/raminfp/redis_exploit/blob/main/exploit_poc.py`和`https://github.com/dwisiswant0/CVE-2025-49844/blob/master/CVE-2025-49844.lua`）属于外部资源，其安全性需要单独评估，不计入本次对当前提供的Python脚本的投毒风险评估。综合来看，提供的POC代码投毒风险评级为低（10%）。

**项目地址:** https://github.com/raminfp/redis_exploit/blob/main/exploit_poc.py (Original PoC for CVE-2025-49844 mentioned in README)

**漏洞详情:** https://redis.io/blog/security-advisory-cve-2025-49844/
