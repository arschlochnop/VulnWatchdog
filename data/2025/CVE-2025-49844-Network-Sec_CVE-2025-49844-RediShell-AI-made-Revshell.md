## CVE-2025-49844 - Redis 远程代码执行 (RCE), 释放后重用 (Use-After-Free), Lua脚本漏洞

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (RCE), 释放后重用 (Use-After-Free), Lua脚本漏洞

**影响应用:** Redis

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** Redis < 6.2.20, 以及 7.x 和 8.x 系列的未修复版本

**利用条件:** 需要认证 (Authenticated Access), 需要网络访问 (Network Access)

**POC 可用性:** 4/10

**POC 类型:** 概念验证 (Proof of Concept) / 仅导致崩溃

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

### 漏洞描述 (CVE-2025-49844)
Redis 远程代码执行漏洞 CVE-2025-49844，被命名为 RediShell，CVSS 评分为 10.0（最高严重级别）。该漏洞由 Wiz 研究团队发现，并得到 Redis 官方的确认。此漏洞主要存在于 Redis 的 Lua 脚本执行模块中，其根本原因是内存管理不当，导致了释放后重用（Use-After-Free, UAF）缺陷。攻击者必须是经过认证的用户（具有低权限及以上），通过构造恶意的 Lua 脚本，可以操纵 Redis 的垃圾回收机制，从而触发 UAF 漏洞。成功利用此漏洞能够导致远程代码执行，允许攻击者在受影响的 Redis 服务器上执行任意命令，进而实现完全控制。受影响的 Redis 版本包括所有低于 6.2.20 的版本，以及 7.x 和 8.x 系列中的部分未修复版本。例如，官方安全通告列出了 7.22.2-20、7.8.6-207 等版本及以上包含了修复，这意味着这些版本之前的相关分支均受影响。

### POC有效性分析与利用步骤
本次分析的输入数据中包含了两个关于“POC代码”的文件，但存在关键差异和说明：

1.  **关于 CVE-2025-49844 的 PoC (基于 `README.md` 的描述)**：
    `README.md` 文件明确指出，针对 `CVE-2025-49844` 的 AI 生成的反向 Shell PoC 尚未成功实现远程代码执行 (RCE)。该 PoC 尝试仅导致了 Redis 服务器的崩溃 (Denial of Service, DoS)，而未能执行任意命令。这表明，要实现完整的 RCE 利用，可能需要更深入的内存布局理解和更精密的漏洞利用技术，以精确控制 UAF 后被重用的内存。尽管未实现 RCE，但崩溃本身也足以证明漏洞的存在及其对服务可用性的影响。`README.md` 中还引用了两个外部 PoC 链接，包括一个 Python 实现（`https://github.com/raminfp/redis_exploit`）和一个 Lua 实现（`https://github.com/dwisiswant0/CVE-2025-49844`），后者更符合漏洞类型（Lua脚本触发）。这些外部 PoC 理论上可能实现 RCE，但由于其代码未直接提供，无法进行直接的有效性评估。

2.  **关于 `CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py` 文件**：
    此 Python 脚本的命名及其内部注释清晰地指向 `CVE-2025-62507`，而非 `CVE-2025-49844`。它利用的是 Redis 中 `XACKDEL` 命令的一个缓冲区溢出漏洞。脚本通过发送超出内部缓冲区（通常为 8 个 ID）限制的大量（此处设置为 20 个）格式合法但数值巨大的 Stream ID，来触发溢出，导致 Redis 服务器崩溃。该 PoC 成功在 Redis 8.2.1 或 8.2.2 版本上实现了服务崩溃效果，表明了该特定漏洞的有效性。
    **利用步骤 (针对 `CVE-2025-62507` Python PoC):**
    a.  使用 `pwntools` 库连接到目标 Redis 服务器。
    b.  发送 `XGROUP CREATE mystream mygroup 0-0 MKSTREAM` 命令，以设置 `XACKDEL` 命令所需的 Stream 和 Consumer Group。
    c.  构造包含 20 个 Stream ID 的 `XACKDEL` 命令，其中每个 ID 都通过将循环模式生成的 8 字节数据转换为 64 位整数，再拼接上 `-{i}` 后缀构成。这些巨大的 ID 导致缓冲区溢出。
    d.  将构造好的 `XACKDEL` 命令发送至 Redis 服务器，触发崩溃。

### 投毒风险分析

1.  **提供的 Python PoC (`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`)**: 经过详细审查，该 Python 脚本的投毒风险评估为极低 (10%)。代码结构清晰，易于理解，且未进行任何混淆处理。它主要依赖于标准的 `pwntools` 库进行网络交互和 payload 构造，核心逻辑完全围绕着触发缓冲区溢出以导致服务崩溃这一目的。脚本中未发现任何迹象表明其包含恶意后门、试图下载外部可执行文件、执行系统敏感命令或进行其他与漏洞演示无关的恶意行为。它是一个典型的、功能单一且透明的崩溃型概念验证代码，符合防御性安全研究的目的。

2.  **针对 `CVE-2025-49844` 的通用 PoC 风险**: 尽管我们直接提供的 PoC 针对 `CVE-2025-49844` 仅显示为崩溃且未实现 RCE，但 `CVE-2025-49844` 本身被评为 CVSS 10.0 的远程代码执行漏洞。这意味着一旦出现功能完善的 RCE PoC，其投毒风险将迅速飙升。此类 PoC 可能会被恶意攻击者用于植入各种恶意负载，例如反向 Shell、数据窃取模块、持久化后门或蠕虫传播机制。因此，对于任何声称能够实现 `CVE-2025-49844` 完整 RCE 的 PoC，无论是通过外部链接获取还是未来新出现的，都必须对其进行最高级别的安全审查。建议采取严格的沙箱环境隔离、详细的代码审计、网络流量监控以及逆向工程分析等措施，以彻底排除任何潜在的恶意组件或行为。

**项目地址:** https://github.com/raminfp/redis_exploit

**漏洞详情:** https://redis.io/blog/security-advisory-cve-2025-49844/
