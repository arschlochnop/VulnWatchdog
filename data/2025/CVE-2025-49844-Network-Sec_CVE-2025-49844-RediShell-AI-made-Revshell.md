## CVE-2025-49844 - Redis 远程代码执行 (RCE), 释放后重用 (Use-After-Free)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 远程代码执行 (RCE), 释放后重用 (Use-After-Free)

**影响应用:** Redis

**危害等级:** 严重

**CVSS评分:** 10.0

**影响版本:** Redis < 6.2.20, 7.2.0 ≤ R

**利用条件:** 需要认证，远程访问

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49844，又被称为“RediShell”，是Redis数据库中一个严重的远程代码执行（RCE）漏洞。该漏洞存在于Redis的Lua脚本执行模块中，其核心机制是释放后重用（Use-After-Free）缺陷。攻击者可以通过构造并执行特制的Lua脚本，巧妙地操控Redis的垃圾回收机制，从而触发这一内存管理漏洞。一旦成功利用，未经授权的代码可能在Redis服务器上执行，导致服务器完全失陷。该漏洞的威胁等级被评估为“严重”，CVSS评分高达10.0分（部分来源显示9.9分），属于最高严重级别。
利用此漏洞需要经过身份验证的攻击者，或拥有低权限及以上用户权限的攻击者。这意味着攻击者需要先获取对Redis服务器的合法访问凭证。受影响的Redis版本主要包括特定分支的旧版本，例如搜索结果指出“Redis < 6.2.20”，以及存在模糊描述的“7.2.0 ≤ R”，后者可能指的是7.2.0及之后某个特定补丁版本之前的系列。由于利用涉及到复杂的Lua脚本构造和内存操作，攻击复杂度被认为是中等。

本次分析中提供了一个名为`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`的Python脚本。值得注意的是，该脚本的命名（CVE-2025-62507）与本次任务主要分析的CVE-2025-49844存在编号差异，暗示它可能针对的是一个不同的漏洞类型，即缓冲区溢出。然而，在同一目录下，README文件明确提到了CVE-2025-49844，并讨论了其“AI-made Revshell PoC”以及其他相关PoC链接，同时指出“No matter what we tried, it was impossible to get code execution. Crashing? Yes. Commands? No.”。这表明，即使是针对CVE-2025-49844的PoC，目前也仅能导致服务器崩溃，而未能实现远程代码执行。
对Python脚本`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`的详细分析显示，它使用`pwntools`库与Redis服务器进行交互。脚本的目标IP和端口被硬编码为`127.0.0.1:6379`，便于本地测试。其核心逻辑是利用Redis的`XACKDEL`命令。首先，脚本会创建一个Redis流（`mystream`）和一个消费者组（`mygroup`），这是`XACKDEL`命令执行的前提条件。随后，脚本会构造一个包含大量（硬编码为20个）特殊格式ID的payload。这些ID通过`pwntools`的`cyclic`函数生成循环模式，并被转换为巨大的64位整数，然后与索引拼接成`"{first_part}-{i}"`的形式。虽然这些ID在格式上是合法的流ID片段，但其数量和大小被设计为超出Redis内部处理`STREAMID_STATIC_VECTOR_LEN`（通常为8）时的预期缓冲区范围，从而触发缓冲区溢出。脚本明确指出，发送20个ID是为了确保覆盖缓冲区并影响重要的栈数据，最终导致Redis服务器崩溃。
**POC有效性分析**: 尽管Python脚本的CVE编号与其文件名不符，且主要目标是导致服务器崩溃而非远程代码执行，但作为一个**概念验证（PoC）**，它在实现其特定目标（即利用缓冲区溢出导致Redis服务崩溃）方面是有效的。脚本结构清晰，使用了成熟的渗透测试工具库`pwntools`，并明确了攻击逻辑。它成功展示了特定Redis命令在特定条件下可能导致的拒绝服务（DoS）漏洞。然而，对于CVE-2025-49844所描述的“远程代码执行”能力，该PoC（以及README中提及的针对CVE-2025-49844的其他PoC）尚未完全实现，目前仅能触发崩溃。因此，其作为RCE PoC的质量为“仅概念验证”。

**针对CVE-2025-49844（Lua脚本RCE）的理论利用步骤：**
1.  **认证访问**: 攻击者需要首先获得Redis服务器的认证凭证，或者利用其他漏洞提升权限以执行命令。
2.  **构造恶意Lua脚本**: 攻击者需精心设计一个恶意的Lua脚本，该脚本旨在通过操纵Redis的垃圾回收机制或内存管理函数，触发“释放后重用”漏洞。
3.  **执行脚本**: 通过Redis的`EVAL`或`EVALSHA`命令执行构造好的恶意Lua脚本。
4.  **实现代码执行**: 如果利用成功，服务器将执行攻击者注入的任意代码，从而实现远程代码执行，攻击者可能获得服务器的控制权。
**针对提供的Python PoC（缓冲区溢出导致崩溃）的利用步骤：**
1.  **环境准备**: 确保目标Redis服务器正在运行，且可能受缓冲区溢出影响（例如，此PoC测试的版本为Redis 8.2.1/8.2.2）。
2.  **运行PoC**: 在攻击者机器上执行Python脚本`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`。可以通过修改脚本中的`HOST`和`PORT`变量来指定目标Redis服务器。
3.  **观察结果**: 脚本将连接到目标Redis服务器，执行必要的初始化命令，然后发送包含大量ID的`XACKDEL`命令。
4.  **服务器崩溃**: 受到攻击的Redis服务器将因缓冲区溢出而立即崩溃，导致服务中断（拒绝服务）。

对提供的`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`代码进行全面审查后，评估其投毒风险为**低**（约10%）。主要基于以下几点：
1.  **代码透明性**: 脚本代码结构清晰，使用了Python标准库和`pwntools`等合法且常用的渗透测试工具库。没有发现代码混淆、加密或任何试图隐藏其真实意图的行为。
2.  **功能专一性**: 脚本的唯一目的是构造并发送一个特定的Redis命令payload，以触发缓冲区溢出并导致服务器崩溃，其逻辑明确且直接，与README文件中对该PoC仅能导致“Crashing”的描述相符。
3.  **无恶意副作用**: 代码中没有包含任何外部网络请求、文件写入、系统命令执行（除了通过Redis协议发送命令）、或者植入后门等行为。所有操作均围绕Redis协议和内存溢出攻击的原理展开。
4.  **无“后门”代码**: 尽管PoC的目的是利用漏洞，但它本身不包含任何意图在目标系统上建立持久访问或进行其他恶意活动的“后门”代码。它只是一个纯粹的漏洞触发工具。
值得注意的是，`README.md`中提到一个“AI-made Revshell PoC”用于CVE-2025-49844，逆向shell本身是一种攻击载荷，但该代码未在此次分析中提供。仅根据当前提供的Python脚本，投毒风险评估为低。如果未来分析中包含反向Shell代码，则需要重新评估其潜在的恶意行为和投毒风险。

**项目地址:** https://github.com/raminfp/redis_exploit/blob/main/exploit_poc.py

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
