## CVE-2025-49844 - Redis Use-After-Free (UAF), 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free (UAF), 远程代码执行 (RCE)

**影响应用:** Redis

**危害等级:** 严重

**CVSS评分:** 10.0

**影响版本:** Redis < 6.2.20, 7.2.0 ≤ Redis < [未明确次版本]. 注意：所提供的PoC代码基于Redis 8.2.1/8.2.2版本测试

**利用条件:** 需要认证 (Authenticated Access), 低权限用户或更高

**POC 可用性:** 6

**POC 类型:** 概念验证 (Denial of Service)

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49844 概述:
根据公开披露信息，CVE-2025-49844 是一个存在于 Redis 内存数据结构存储系统中的严重远程代码执行（RCE）漏洞，由 Wiz 研究团队发现并命名为 "RediShell"。该漏洞的 CVSS 评分高达 10.0 (或 9.9)，属于最高威胁级别。漏洞存在于 Redis 的 Lua 脚本执行模块中，攻击者可利用特殊的 Lua 脚本，通过操控垃圾回收机制，触发释放后重用（Use-After-Free, UAF）漏洞，从而可能导致在 Redis 服务器上执行任意代码。利用此漏洞需要攻击者拥有对 Redis 实例的认证权限，即低权限及以上用户权限。受影响的版本包括 Redis < 6.2.20 以及 7.2.0 ≤ Redis < 某个未明确的次版本。该漏洞据称已存在于 Redis 源代码中约 13 年。

POC 有效性分析:
本次分析提供了一份名为 `CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py` 的 Python 脚本，并附带一个 `README.md` 文件。值得注意的是，Python 脚本内部及文件名明确指向 `CVE-2025-62507`，并描述其利用的是缓冲区溢出（Buffer Overflow）漏洞，目标是 Redis 8.2.1 或 8.2.2 版本，并明确表示会导致服务器崩溃（Denial of Service, DoS）。
然而，同捆的 `README.md` 文件标题却明确标注为 `# CVE-2025-49844 RediShell`，并在其“Progress”部分坦承：“No matter what we tried, it was impossible to get code execution. Crashing? Yes. Commands? No.” 这表明，尽管该 PoC 包旨在针对 `CVE-2025-49844` 进行概念验证，但其提供的 Python 脚本实际实现了 Redis 的崩溃，而非预期的远程代码执行。这与 `CVE-2025-49844` 官方描述的“远程代码执行”有所出入，但与 README 对“CVE-2025-49844”利用尝试结果的自述“只能导致崩溃”相符。
因此，我们可以判断：这份 PoC 代码（`CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`）是一份有效的 Redis 崩溃（DoS）PoC，它通过缓冲区溢出触发。尽管它并非直接验证 `CVE-2025-49844` 所描述的 Lua 脚本 UAF RCE，但它展示了在 Redis 中触发崩溃的可能性，并且其作者将其与 `CVE-2025-49844` 相关联，说明其可能是在探索 `CVE-2025-49844` 或类似 Redis 漏洞时产生的副产品或早期阶段的 PoC。其质量评分为 6，因为它能够稳定地触发服务器崩溃，但未能实现完整远程代码执行。

利用步骤:
1.  **环境准备:**
    *   启动一个受影响的 Redis 实例。根据 PoC 代码，Redis 8.2.1 或 8.2.2 是测试目标，但 `CVE-2025-49844` 的官方通告指出受影响版本为 Redis < 6.2.20 和 7.2.0 ≤ Redis < [未明确次版本]。在实际测试时，应选择与 PoC 匹配或在通告范围内的版本。
    *   确保 Python 3 环境可用，并安装 `pwntools` 库 (`pip install pwntools`)。
2.  **PoC 执行:**
    *   将提供的 Python 脚本保存为 `exploit.py` (或原名 `CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py`)。
    *   修改脚本中的 `HOST` 和 `PORT` 变量，指向目标 Redis 服务器。默认设置为 `127.0.0.1:6379`。
    *   执行脚本：`python3 exploit.py`。
3.  **攻击流程:**
    *   脚本首先通过 `XGROUP CREATE mystream mygroup 0-0 MKSTREAM` 命令在目标 Redis 服务器上创建流和消费者组，这是 `XACKDEL` 命令的先决条件。
    *   随后，脚本构造一个带有 20 个大整数格式 ID 的 `XACKDEL` 命令。这些 ID 是通过 `pwntools` 的 `cyclic` 函数生成字节模式，然后转换为 64 位整数，再拼接成 `first_part-index` 的流 ID 格式。
    *   `NUM_IDS_TO_SEND` 被设置为 20，超过了 Redis 内部 `STREAMID_STATIC_VECTOR_LEN` 的 8 个限制，旨在触发缓冲区溢出。
    *   当 Redis 服务器处理这个特制的 `XACKDEL` 命令时，由于缓冲区溢出，将导致服务器进程异常终止或崩溃，从而实现拒绝服务攻击。
    *   脚本在发送完 payload 后会关闭连接，因为预计服务器将崩溃，不会返回正常响应。

投毒风险分析:
对所提供的 PoC 代码 `CVE-2025-62507_Crash_Working_PoC_BufferOverflow.py` 进行分析，其投毒风险评估为低（10%）。
1.  **代码透明度与可读性:** Python 脚本代码结构清晰，使用了标准的 `pwntools` 库进行网络连接和 payload 构造。核心逻辑易于理解，没有发现代码混淆、加密或不寻常的编程技巧。
2.  **依赖项:** 仅依赖 `pwntools`，这是一个在安全研究领域广泛使用的合法库。代码中没有引入外部的、来源不明的库或二进制文件。
3.  **行为分析:** 脚本的主要行为是连接到指定的 Redis 服务器，发送特定的 Redis 命令（`XGROUP CREATE` 和 `XACKDEL`）以触发漏洞并导致服务崩溃。这些行为与证明漏洞存在的目的相符。没有迹象表明脚本会尝试在目标系统上执行除崩溃之外的恶意操作（如安装后门、窃取数据、进行挖矿等）。
4.  **网络请求:** 除了与目标 Redis 服务器的直接通信外，脚本没有发起其他可疑的网络请求，例如连接到恶意 C2 服务器或下载二次 payload。
5.  **文件系统操作:** 脚本不涉及文件系统读写操作，不会创建或修改本地文件，更不会感染其他系统文件。
6.  **README 警示:** 尽管 `README.md` 文件开头提到了“AI-made Revshell PoC”，但紧接着又表示“Untested completition of the Redishell PoC made by AI.” 并在后续明确指出“impossible to get code execution. Crashing? Yes. Commands? No.” 这表明作者对代码的预期功能持谨慎态度，并且实际提供的代码并未包含反向 Shell 逻辑。这种声明反而增加了代码的透明度，提示分析人员该 PoC 的局限性。
综合来看，该 PoC 代码是一个纯粹的拒绝服务概念验证，其设计和实现均符合防御性安全研究的目的，不包含恶意投毒成分。

**项目地址:** https://github.com/raminfp/redis_exploit/blob/main/exploit_poc.py

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49844
