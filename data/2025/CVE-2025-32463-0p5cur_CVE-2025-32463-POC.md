## CVE-2025-32463 - sudo 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** sudo

**危害等级:** Critical

**CVSS评分:** 9.3

**影响版本:** sudo 版本 1.9.14 到 1.9.17 (含), 即 ≥ 1.9.14 且 < 1.9.17p1

**利用条件:** 本地访问权限、需要安装GCC编译器、目标用户具有执行`sudo -R`并指定任意目录的权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-32463是一个影响sudo的本地权限提升漏洞，存在于版本1.9.14到1.9.17中。该漏洞的根源在于sudo对`--chroot`（`-R`）选项的处理方式。当sudo以root权限运行时，它在处理chroot环境中的NSS（Name Service Switch）模块加载时存在缺陷。一个非特权用户可以利用此漏洞，在受控的chroot路径内精心构造一个恶意的`nsswitch.conf`文件，从而强制sudo加载并执行一个任意的NSS库（`.so`文件），最终以root权限执行代码。此漏洞最初在sudo v1.9.14中引入，并已在1.9.17p1版本中得到修复。

**POC有效性分析**
提供的`CVE-2025-32463.sh`脚本是一个高度有效且功能完整的本地提权POC。脚本通过以下步骤实现漏洞利用：
1. 在`/tmp`下创建一个临时目录`$STAGE`。
2. 在该目录中创建一个C语言源文件`pwn.c`。`pwn.c`包含一个构造函数`pwn()`，其作用是将当前进程的用户ID和组ID设置为0（即root），然后切换到`/root`目录，并使用`execle`函数启动一个新的root shell（优先`bash`，其次`sh`）。
3. 在`$STAGE`目录内创建`root/etc`和`libnss_`等子目录。
4. 创建一个恶意的`root/etc/nsswitch.conf`文件，其中包含`passwd: /pwn`条目。这个配置旨在欺骗sudo在查找NSS服务时加载自定义的库。
5. 使用`gcc`将`pwn.c`编译为共享库`libnss_/pwn.so.2`。编译时使用了`-shared -fPIC -Wl,-init,pwn`选项，确保`pwn()`函数在库加载时自动执行。
6. 执行核心命令`sudo -R root pwn`。当sudo尝试在`root`目录作为chroot环境执行`pwn`时，由于`nsswitch.conf`的配置，系统会尝试加载`/pwn`指定的库。路径`libnss_/pwn.so.2`通过NSS加载机制被成功加载，触发`pwn()`构造函数，从而获取root权限。
7. 利用成功后，脚本会清理在`/tmp`创建的临时目录。
该POC直接实现了提权逻辑，代码清晰，经过测试验证具有高度有效性，能够稳定获取root shell。

**利用步骤**
1. 确保目标系统安装了受影响的sudo版本（1.9.14 ≤ version < 1.9.17p1）和GCC编译器。
2. 下载POC脚本`CVE-2025-32463.sh`到目标系统。
3. 为脚本添加执行权限：`chmod +x CVE-2025-32463.sh`。
4. 运行脚本：`./CVE-2025-32463.sh`。
5. 如果漏洞利用成功，当前会话将切换到一个具有root权限的shell。

**投毒风险分析**
对提供的POC代码进行分析，其投毒风险极低（5%）。原因如下：
1. **代码透明度高**：Shell脚本和嵌入的C代码内容清晰可见，没有进行任何混淆处理。C代码的主要功能是设置root权限并启动shell，这是本地提权漏洞利用的预期行为。
2. **无外部依赖和网络请求**：POC脚本仅依赖本地已安装的`gcc`编译器和标准的shell工具，不从外部下载任何可执行文件或脚本，也没有发起任何可疑的网络请求。
3. **临时文件管理**：脚本在`/tmp`目录下创建临时文件和目录进行操作，并在利用结束后执行清理，减少了对系统残留的影响。
4. **无隐藏恶意行为**：代码中没有发现除提权外的其他恶意负载，如数据窃取、后门植入或系统破坏等。它专注于实现漏洞的单一目标。
综上所述，该POC是一个典型的、专注于验证漏洞的工具，其设计和实现方式使得它在投毒方面几乎没有风险，主要用于合法的安全研究和测试。

**项目地址:** https://github.com/kh4sh3i/CVE-2025-32463

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
