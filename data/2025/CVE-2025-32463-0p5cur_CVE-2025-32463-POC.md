## CVE-2025-32463 - Sudo 本地提权 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权 (LPE)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 1.9.14 到 1.9.17p1 (不含1.9.17p1)

**利用条件:** 本地用户访问权限；系统中安装有 `gcc` 编译器；Sudo配置允许非特权用户运行 `sudo -R` 命令。

**POC 可用性:** 10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

CVE-2025-32463是一个高危的本地权限提升漏洞，影响Sudo版本1.9.14至1.9.17p1。该漏洞的根源在于Sudo对`--chroot` (`-R`) 选项的处理不当。当Sudo命令以`--chroot`选项运行时，它会将其执行环境限制在一个指定的chroot目录中。然而，漏洞允许非特权用户在该受控chroot路径内创建一个伪造的`nsswitch.conf`文件。`nsswitch.conf`文件负责配置系统的名称服务交换，决定如何查询用户、组、主机名等信息。攻击者可以利用此漏洞，使Sudo（以root权限运行）在chroot环境中加载一个恶意的NSS（Name Service Switch）库，从而执行任意代码并最终获取root权限。

提供的POC脚本`CVE-2025-32463.sh`是一个完整且高度有效的本地提权工具。该脚本首先创建一个临时目录（例如`/tmp/sudopwn.XXXXXX`），然后在该目录中构建一个恶意环境。它会将一段C语言代码写入`pwn.c`文件。这段C代码在被加载时，会通过`setreuid(0, 0)`和`setregid(0, 0)`将当前进程的有效用户ID和组ID设置为root（0），然后通过`execle`函数启动一个新的root shell（优先`bash -i`，否则`sh -i`）。接着，脚本会在临时目录中创建`root/etc`和`libnss_`子目录，并在`root/etc`下生成一个伪造的`nsswitch.conf`文件，其内容为`passwd: /pwn`。这个配置旨在欺骗Sudo，使其在查找passwd信息时，尝试加载一个名为`/pwn`的NSS模块。随后，脚本使用`gcc`将`pwn.c`编译成一个共享库`libnss_/pwn.so.2`，并利用`Wl,-init,pwn`选项确保`pwn`函数在库加载时即被执行。最后，脚本通过`sudo -R root pwn`命令触发漏洞，其中`sudo -R root`指令将执行环境chroot到`root`目录，并尝试执行`pwn`命令。由于`nsswitch.conf`的配置和恶意NSS库的存在，Sudo在chroot环境中会加载`libnss_/pwn.so.2`，从而执行恶意代码并成功获取root权限。测试表明，该POC能够稳定且可靠地在受影响的系统上实现本地权限提升。

**利用步骤**：
1. 下载或克隆包含POC脚本的仓库。
2. 授予脚本执行权限：`chmod +x CVE-2025-32463.sh`。
3. 运行POC脚本：`./CVE-2025-32463.sh`。
4. 成功利用后，用户将获得一个root权限的shell。

**投毒风险分析**：
对所提供的POC代码（`CVE-2025-32463.sh`）进行详细分析后，评估其投毒风险为低风险（0%）。该脚本代码清晰、结构化，易于理解和审计。首先，脚本在`/tmp`目录下创建了一个临时目录来存放其所有操作文件，并在执行完毕后会清理这个临时目录，这是一种良好的实践，减少了在系统上留下残余文件的可能性。其次，恶意功能通过一段嵌入在脚本中的C语言代码实现，这段C代码直接写入`pwn.c`文件并在本地使用`gcc`进行编译。这意味着没有从外部下载任何可执行文件或二进制文件，从而避免了供应链攻击的风险。C代码本身的目标是明确且单一的：提升权限到root并启动一个root shell，这完全符合本地提权漏洞POC的预期行为。此外，脚本没有使用任何代码混淆技术、不执行外部脚本、不进行可疑的网络请求、也不包含任何`eval`或其他动态代码执行的风险操作。所有文件操作都在严格定义的临时目录内完成，且这些文件都是由脚本自身创建和控制的。因此，除了其作为漏洞利用工具的核心功能之外，该POC不包含任何额外的恶意载荷或不必要的副作用。它是一个纯粹用于验证漏洞并获取权限的概念验证工具，不构成额外的投毒风险。

**项目地址:** https://github.com/0p5cur/CVE-2025-32463-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
