## CVE-2025-32463 - sudo 本地权限提升(LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升(LPE)

**影响应用:** sudo

**危害等级:** 严重

**CVSS评分:** 9.3

**影响版本:** Sudo版本1.9.14到1.9.17（含），即≥ 1.9.14且< 1.9.17p1

**利用条件:** 需要本地访问权限；用户需要能够运行sudo -R并指定任意目录；需要安装gcc编译器。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个影响Sudo权限管理工具的本地提权漏洞。该漏洞的根源在于Sudo在处理`--chroot` (`-R`) 选项时存在缺陷，此选项是在Sudo 1.9.14版本中引入的。具体来说，当一个非特权用户能够以`sudo -R`命令指定一个任意目录时，他们可以利用这一缺陷。攻击者可以通过在受控的chroot路径内精心构造一个伪造的`nsswitch.conf`文件，强制以root权限运行的Sudo加载一个任意的NSS（Name Service Switch）库，从而在root上下文中执行恶意代码，实现本地权限提升。此漏洞尤其危险，因为`sudo`是Linux系统中广泛使用的核心权限管理工具。

**POC有效性分析:** 提供的POC脚本`CVE-2025-32463.sh`是一个功能完整的本地提权工具，其有效性经过分析被确认。该脚本首先在`/tmp`目录下创建一个临时工作目录（例如`/tmp/sudopwn.XXXXXX`），以确保操作的隔离性。随后，它在此临时目录中生成一个C语言源文件`pwn.c`。`pwn.c`文件包含一个构造函数`pwn`，该函数在加载时会自动执行。此构造函数的核心功能是将当前进程的有效用户ID和组ID设置为0（即root），然后尝试执行`/bin/bash`或`/bin/sh`，从而提供一个具有root权限的交互式shell。接下来，脚本在临时目录中创建必要的目录结构（`root/etc`和`libnss_`），并将一个特制的`nsswitch.conf`文件写入`root/etc/nsswitch.conf`。这个`nsswitch.conf`文件被修改为在查询`passwd`服务时指向`libnss_/pwn.so.2`。然后，脚本使用`gcc`将`pwn.c`编译为一个共享库`libnss_/pwn.so.2`，利用`-Wl,-init,pwn`选项确保`pwn`函数作为初始化函数在库加载时自动执行。最后，脚本执行`sudo -R root pwn`命令。当`sudo`在`--chroot root`环境下运行时，它会加载伪造的`nsswitch.conf`，进而加载恶意编译的`libnss_/pwn.so.2`。由于`pwn.so.2`被加载，其构造函数`pwn`被执行，最终导致权限提升至root。整个过程自动化且高效，验证了该漏洞的可利用性。

**利用步骤:**
1. 确保目标系统安装了受影响的Sudo版本（1.9.14至1.9.17，不含1.9.17p1）。
2. 确保系统上安装了`gcc`编译器。
3. 确保当前非特权用户可以运行`sudo -R`命令并指定任意目录。
4. 下载或克隆POC脚本文件`CVE-2025-32463.sh`。
5. 授予脚本执行权限：`chmod +x CVE-2025-32463.sh`。
6. 运行脚本：`./CVE-2025-32463.sh`。
7. 成功执行后，将获得一个root权限的shell。
8. 脚本会自动清理创建的临时文件和目录。

**投毒风险分析:** 对提供的POC代码进行详细审查后，评估其投毒风险为低（约10%）。代码是完全透明的，没有进行任何形式的混淆处理，所有操作步骤和意图都清晰可见。脚本的主要功能是创建一个临时的本地环境，编译一个C语言payload，并利用Sudo的漏洞加载此payload以实现本地权限提升。
*   **无外部依赖或网络请求:** POC代码没有包含任何对外部资源（如URL下载、远程命令执行）的调用，所有文件操作都限制在本地创建的临时目录中。
*   **代码行为可预测:** `pwn.c`中的C语言代码清晰地定义了其行为：设置root权限并启动shell。这是标准的本地提权载荷，而非隐藏的恶意软件或后门。
*   **标准工具使用:** 脚本主要依赖于`mktemp`、`cat`、`mkdir`、`cp`、`gcc`、`sudo`、`rm`等标准的Linux命令行工具，这些工具的调用方式符合其正常使用逻辑。
*   **清理机制:** 脚本在执行完毕后会主动清理其创建的临时文件和目录（`rm -rf "$STAGE"`），减少了系统残留和潜在的副作用。
*   **无混淆:** 整个脚本（包括内联的C代码）都是明文，易于审计和理解，使得恶意代码的注入变得困难且容易被发现。基于以上分析，该POC代码的主要风险在于其利用漏洞实现提权的能力，而不是代码本身包含额外的恶意载荷或进行投毒。

**项目地址:** https://github.com/0p5cur/CVE-2025-32463-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
