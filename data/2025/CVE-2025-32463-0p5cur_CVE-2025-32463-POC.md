## CVE-2025-32463 - Sudo 本地权限提升 (Local Privilege Escalation - LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (Local Privilege Escalation - LPE)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** `sudo` versions ≥ 1.9.14 and < 1.9.17p1

**利用条件:** 需要本地访问权限，目标系统需安装`gcc`编译器，且当前非特权用户有权限执行带有任意目录参数的`sudo -R`命令。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析:
CVE-2025-32463是一个影响`sudo`版本1.9.14至1.9.17的本地权限提升漏洞。该漏洞的根源在于`sudo`在处理其`--chroot` (`-R`) 选项时存在缺陷，此选项是在1.9.14版本中引入的。攻击者（一个非特权用户）可以利用此漏洞，在一个受控的chroot路径内精心构造一个伪造的`nsswitch.conf`配置文件，从而强制以root权限运行的`sudo`加载任意的“名称服务切换”（NSS）库，并执行其中的恶意代码，最终获得root权限。

提供的POC代码`CVE-2025-32463.sh`是一个shell脚本，它完整地实现了这一攻击向量。其工作原理如下：
1.  **环境准备**：脚本首先创建一个临时目录（例如`/tmp/sudopwn.XXXXXX`），并将其作为攻击的工作空间。
2.  **恶意C代码嵌入与编译**：脚本在临时目录中嵌入一个C语言源文件`pwn.c`。这段C代码包含一个构造函数`pwn()`，该函数被设计用于在加载时执行。`pwn()`函数的核心功能是调用`setreuid(0, 0)`和`setregid(0, 0)`来将当前进程的有效用户ID和组ID设置为root（0），然后通过`execle()`函数启动一个新的root权限的交互式shell（优先`bash`，其次`sh`）。随后，脚本使用`gcc`将`pwn.c`编译为一个共享库`libnss_/pwn.so.2`，并指定`pwn`作为其初始化函数（通过`-Wl,-init,pwn`链接器选项）。这意味着一旦这个共享库被加载，`pwn()`函数就会立即执行。
3.  **伪造chroot环境**：脚本在临时目录中创建`root/etc`和`libnss_`子目录。`libnss_`目录用于存放编译后的恶意NSS库。更关键的是，它在`root/etc`中创建一个伪造的`nsswitch.conf`文件，其中包含一行`passwd: /pwn`。这个配置指示NSS在查询`passwd`服务时，应该尝试加载名为`/pwn`的NSS模块。在chroot环境中，`/pwn`实际上会解析到`libnss_/pwn.so.2`。
4.  **触发漏洞**：最后，脚本执行核心攻击命令`sudo -R root pwn`。
    *   `sudo -R root`：指示`sudo`在进入以`root`（临时目录下的`root`子目录）为根的新chroot环境后，以`root`用户身份执行后续命令。
    *   `pwn`：这是一个任意的、在chroot环境中可能不存在的命令。当`sudo`尝试在chroot环境中执行`pwn`命令时，它会进行一系列的系统调用，包括通过NSS来解析用户和组信息。
5.  **权限提升**：由于伪造的`nsswitch.conf`的存在，`sudo`在尝试解析`passwd`服务时会加载位于chroot环境内的恶意共享库`libnss_/pwn.so.2`。一旦该库被加载，其构造函数`pwn()`便会自动执行。此时，`pwn()`函数将进程的有效权限提升至root，并随即启动一个具有root权限的shell。
6.  **清理**：攻击完成后，脚本会清理创建的临时目录及其内容。

通过上述步骤，该POC脚本能够可靠地在满足条件的系统上实现本地权限提升。其代码逻辑清晰，利用机制直接，是一个功能完整的、有效的概念验证（PoC）和攻击工具。

利用步骤:
1.  **环境检查**: 确认目标系统上`sudo`的版本在1.9.14到1.9.17p1之间（含1.9.14，不含1.9.17p1）。同时，确认系统已安装`gcc`编译器。
2.  **权限确认**: 确保当前非特权用户具备执行带有任意目录参数的`sudo -R`命令的权限。
3.  **获取POC**: 将`CVE-2025-32463.sh`脚本文件传输到目标系统。
4.  **添加执行权限**: 在目标系统上为脚本添加执行权限：`chmod +x CVE-2025-32463.sh`。
5.  **执行攻击**: 运行脚本：`./CVE-2025-32463.sh`。
6.  **获取Root Shell**: 如果攻击成功，当前终端会话将自动升级为一个root权限的交互式shell。

投毒风险分析:
对`CVE-2025-32463.sh` POC代码进行分析后，评估其投毒风险为**低（5%）**。以下是具体分析：
1.  **代码透明度高**: POC脚本本身和其中嵌入的C语言代码都非常清晰、简洁且易于理解。没有发现任何形式的代码混淆或加密，这使得安全研究人员和使用者可以轻松审查其功能。
2.  **无外部依赖**: 脚本不从任何外部源（如互联网上的URL）下载或执行代码。所有必要的组件（C代码、配置文件）都直接内联在脚本中或通过标准系统工具（如`gcc`）在本地生成。
3.  **使用标准库和工具**: 脚本主要依赖于标准的shell命令（`mktemp`, `cd`, `cat`, `mkdir`, `cp`, `rm`）以及`gcc`和`sudo`这两个核心工具。这些都是Linux系统上常见的、被信任的组件。
4.  **恶意行为仅限于权限提升**: C语言有效载荷（`pwn.c`）的唯一目的是将进程权限提升到root并启动一个root shell。没有发现额外的恶意功能，例如建立到外部C2服务器的通信、数据窃取或外发、安装持久化后门（除了通过获取root权限后手动安装）、进行加密货币挖掘、删除或破坏系统文件。
5.  **良好清理机制**: 脚本在攻击完成后会使用`rm -rf "$STAGE"`命令彻底删除所有创建的临时文件和目录，避免在系统上留下不必要的痕迹或攻击遗留物。
6.  **POC性质**: 这是一个明确标记为“概念验证”（Proof of Concept）的工具，其目的在于演示漏洞的可利用性，而非作为隐蔽攻击武器。

尽管该POC本身风险低，但在实际部署任何第三方代码时，始终建议进行彻底的安全审查。恶意行为者可以轻易地修改此类权限提升POC，以在获得root权限后植入后门、窃取敏感信息或执行其他有害操作。因此，在任何未经授权的环境中使用此类工具都将承担法律风险。但就此提供的原始POC代码而言，其意图明确且无额外恶意载荷。

**项目地址:** https://github.com/0p5cur/CVE-2025-32463-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
