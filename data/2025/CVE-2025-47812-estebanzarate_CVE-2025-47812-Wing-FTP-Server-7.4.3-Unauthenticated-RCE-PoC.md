## CVE-2025-47812 - Wing FTP Server 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-47812

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Wing FTP Server

**危害等级:** 严重

**CVSS评分:** 未提供

**影响版本:** <= 7.4.3

**利用条件:** 无需认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

POC有效性分析: 所提供的POC脚本（CVE-2025-47812.py）是一个功能完整的Python利用工具，旨在攻击Wing FTP Server版本7.4.3及更早版本中存在的未经认证的远程代码执行（RCE）漏洞。该漏洞的根源在于在用户登录时对username参数进行NULL字节注入。攻击者可以通过向`/loginok.html`发送一个包含NULL字节和Lua代码的特制username参数，将恶意Lua代码注入到服务器的会话文件中。一旦Lua代码被成功注入，攻击者只需使用服务器返回的UID会话Cookie访问`/dir.html`路径，即可触发注入代码的执行，并将命令的输出返回给攻击者。该POC脚本自动化了这一过程：首先，它构造并发送一个HTTP POST请求到目标服务器的`/loginok.html`路径，请求体中包含编码后的username（其中嵌入了Lua代码负载，利用`io.popen()`执行系统命令）。如果注入成功，服务器会在响应头中设置`Set-Cookie`，包含一个UID。随后，脚本使用此UID发送一个HTTP GET请求到`/dir.html`，这会激活存储在会话文件中的Lua代码并执行系统命令。脚本会解析响应，提取并显示命令执行的输出。此外，该POC还实现了一个交互式shell功能，允许攻击者在目标服务器上持续执行命令，极大地增强了利用的便利性和有效性。脚本使用了标准且知名的Python库（如`requests`用于HTTP通信，`prompt_toolkit`用于提供交互式shell），代码结构清晰，注释详尽，易于理解和验证其功能，证明了其高度的可用性和稳定性。
利用步骤:
1.  确认目标系统运行的是Wing FTP Server版本7.4.3或更早版本。
2.  准备Python 3环境，并确保安装了`requests`和`prompt_toolkit`库（`pip install requests prompt_toolkit`）。
3.  下载或复制POC脚本（CVE-2025-47812.py）。
4.  在命令行中执行脚本，指定目标URL。例如：`python3 CVE-2025-47812.py -u http://target.example.com`。
5.  脚本将尝试利用漏洞并在成功后进入一个交互式命令shell。
6.  在shell中输入任意系统命令（例如：`whoami`、`ls -la /`、`cat /etc/passwd`），命令将在目标服务器上执行，并将结果返回显示在当前终端。
7.  输入`exit`或`quit`退出交互式shell。
投毒风险分析: 对提供的POC代码进行了深入分析，结果显示该脚本的投毒风险极低，可视为0%。
1.  代码清晰度与可读性：脚本的Python代码结构清晰，逻辑分明，变量命名规范，并且包含了详细的注释，极大地提高了代码的可读性。这使得安全研究人员可以轻松审查每一行代码，确保其行为符合预期。
2.  依赖库：该POC仅使用了标准Python库（如`re`, `sys`, `argparse`, `urllib.parse`）以及两个常用的第三方库：`requests`（用于HTTP请求）和`prompt_toolkit`（用于构建交互式命令行界面）。这些都是业界广泛使用且经过严格审查的库，其本身不包含恶意功能。脚本对这些库的使用也局限于其正常功能范围。
3.  网络通信行为：脚本的所有网络通信都明确指向攻击者通过`-u`参数指定的目标URL。除了与目标服务器进行漏洞利用所需的HTTP/HTTPS请求外，代码中未发现任何向第三方IP地址、可疑域名或未知服务发送数据、下载额外payload或建立非授权连接的行为。
4.  文件系统操作：代码没有包含任何对本地文件系统进行非预期读写、删除或修改的操作。其所有文件操作都限于脚本自身的执行环境，没有尝试影响宿主机的安全或完整性。
5.  代码混淆与恶意payload：脚本代码未经过任何形式的混淆处理，所有逻辑和数据流都一目了然。注入的Lua代码payload是动态构建的，用于执行用户提供的命令，不包含硬编码的恶意后门、加密货币挖矿代码或其他恶意功能。
6.  总结：基于以上全面分析，该POC代码完全符合防御性安全研究和漏洞验证工具的标准。它旨在演示和利用特定漏洞，不包含任何恶意或投毒行为。因此，其投毒风险评估为0%。

**项目地址:** https://github.com/4m3rr0r/CVE-2025-47812-poc/blob/main/CVE-2025-47812.py

**漏洞详情:** https://www.vicarius.io/vsociety/posts/cve-2025-47812-mitigation-script-remote-code-execution-vulnerability-in-wing-ftp-server
