## CVE-2025-9074 - Docker Desktop 容器逃逸 / 未授权访问 / 主机接管

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸 / 未授权访问 / 主机接管

**影响应用:** Docker Desktop

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** Docker Desktop < 4.44.3 (Windows and macOS)

**利用条件:** 需要本地运行的恶意Linux容器，通过默认子网192.168.65.7:2375直接访问Docker Engine API，不依赖挂载。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-9074是一个影响Docker Desktop应用程序（包括Windows和macOS版本）的严重容器越权访问漏洞。该漏洞允许本地运行的恶意Linux容器绕过隔离机制，通过默认的内部子网地址192.168.65.7:2375直接访问并操作Docker Engine API。成功的利用可以导致容器逃逸，进而实现对宿主机的完全控制。

**POC有效性分析:**
提供的Python POC脚本 `CVE-2025-9074-docker-exploit.py` 是一个功能全面且高度有效的利用工具，充分展示了该漏洞的危害性。该脚本设计精良，能够执行从基本容器管理到高级宿主机文件系统操作和命令执行的多种功能，证实了CVE-2025-9074确实能导致宿主机接管。其核心功能包括：

1.  **Docker API交互**: 脚本能够通过HTTP请求与Docker Engine API进行通信，获取容器列表（`get_containers`）、在容器内部执行命令（`execute_command`）并提供交互式shell（`interactive_shell`）。这表明了从恶意容器内部能够成功访问并控制Docker守护进程。
2.  **宿主机路径规范化**: `normalize_host_path` 函数是其关键特性之一。它智能地将Windows路径（例如 `D:\temp`）转换为Docker Desktop在Linux子系统内部映射的相应路径（例如 `/mnt/host/d/temp`）。这一功能确保了POC在不同操作系统上操作宿主机文件系统的兼容性和准确性，是实现跨平台宿主机访问的基础。
3.  **宿主机文件系统操作**: 脚本提供了强大的能力来直接操作宿主机的文件系统，包括读取（`read_host_file`）、写入（`write_host_file`）、上传（`upload_file_to_host`）、下载（`download_file_from_host`）、列目录（`list_host_dir`）、创建目录（`create_host_dir`）和删除路径（`delete_host_path`）。这些操作通常通过创建临时容器并巧妙地挂载宿主机特定路径，然后利用 `docker cp` 或类似机制来完成，从而绕过了容器的隔离。
4.  **宿主机命令执行**: 最具破坏性的能力是 `run_host_command_via_container`。此功能允许攻击者在宿主机上执行任意命令。它通过创建一个新的临时容器，将宿主机上的关键系统目录（如 `/usr/bin` 或 `/bin`）挂载到容器内，然后在该容器环境中执行用户指定的命令。由于这些目录包含了宿主机的核心二进制文件，因此任何在这些路径下执行的命令都相当于直接在宿主机上执行，从而实现了完全的远程代码执行（RCE）。
5.  **鲁棒性与易用性**: 脚本使用了 `argparse` 进行命令行参数解析，支持多种操作模式。同时，它包含依赖检查和错误处理，提升了其可用性和可靠性。其模块化的设计使得攻击者可以根据需要选择不同的攻击向量。综合来看，此POC脚本有效、完整且易于使用，是复现和理解CVE-2025-9074漏洞危害的理想工具。

**利用步骤:**
1.  **初始立足点**: 攻击者需要已经成功在受影响版本的Docker Desktop（Windows或macOS，版本低于4.44.3）上运行了一个恶意的Linux容器。这是利用此漏洞的前提条件。
2.  **获取POC**: 从 `https://github.com/zenzue/CVE-2025-9074` 下载Python POC脚本 `CVE-2025-9074-docker-exploit.py` 到攻击者的控制机器。
3.  **安装依赖**: 确保攻击机器上安装了Python `requests` 和 `docker` 库。脚本在启动时会检查，如果缺失会提示通过 `pip install docker websocket-client` 进行安装。
4.  **确认连接**: 运行POC脚本时，它将默认尝试连接到 `http://192.168.65.7:2375`，这是Docker Desktop的内部Docker Engine API地址。若要验证连接，可执行 `python CVE-2025-9074-docker-exploit.py --list-containers` 来列出当前宿主机上运行的所有Docker容器。
5.  **宿主机文件系统访问**: 利用POC脚本可以对宿主机文件系统进行操作：
    *   读取文件: `python CVE-2025-9074-docker-exploit.py --read-host-file "C:\Windows\System32\drivers\etc\hosts"` (Windows) 或 `"/etc/passwd"` (macOS)。
    *   写入文件: `python CVE-2025-9074-docker-exploit.py --write-host-file "C:\temp\malicious_data.txt" --data "This is a malicious payload."`。
    *   上传文件: `python CVE-2025-9074-docker-exploit.py --upload-file-to-host "./local_exploit.exe" "C:\ProgramData\payload.exe"`。
6.  **宿主机命令执行**: 这是实现完全主机接管的关键步骤。攻击者可以执行任意的宿主机命令：
    *   Windows示例: `python CVE-2025-9074-docker-exploit.py --run-host-cmd "cmd.exe /c whoami"` 或 `powershell.exe -Command "Get-Process"`。
    *   macOS示例: `python CVE-2025-9074-docker-exploit.py --run-host-cmd "/bin/bash -c 'id; hostname'"`。
通过这些步骤，攻击者可以成功突破Docker容器的隔离，在宿主机上获得任意代码执行能力，从而完全控制目标系统。

**投毒风险分析:**
对 `CVE-2025-9074-docker-exploit.py` 脚本的源代码进行了深入分析，以评估其潜在的投毒风险。投毒风险指的是POC代码本身是否被作者恶意篡改，例如植入后门、加密货币挖矿程序、数据窃取功能或任何其他非漏洞利用目的的恶意行为。

1.  **代码透明度与可读性**: 脚本代码结构清晰，使用了标准Python编程范式，并且有大量描述性的函数名和注释。没有发现任何形式的代码混淆、难以理解的加密字符串或复杂的间接调用，这使得代码的每一行意图都相对容易审查。这种高透明度显著降低了隐藏恶意功能的可能性。
2.  **依赖项的合法性**: 脚本仅依赖于Python的标准库（如 `sys`, `os`, `json`, `argparse`, `requests`, `threading`, `platform`, `time`, `socket`, `signal`）以及广泛用于与Docker交互的官方Python `docker` 库及其相关的 `websocket-client`。这些都是安全、常用的合法库，没有发现导入或使用任何可疑的、非标准的、或从未知来源加载的第三方库或模块。
3.  **网络行为分析**: 脚本的核心网络通信是针对硬编码的本地Docker Engine API地址 `http://192.168.65.7:2375`。这是漏洞利用的预期行为，用于与受影响的Docker Desktop实例进行交互。除了这种本地通信，代码中没有发现任何向外部、未知或可疑的IP地址/域名发送数据、下载额外恶意载荷或建立C2（命令与控制）通道的行为。所有的网络请求都直接服务于漏洞利用的目的，如获取容器信息、执行命令或传输文件到/从宿主机。因此，没有证据表明存在未经授权的数据外泄或远程控制功能。
4.  **文件系统与系统资源操作**: 脚本对文件系统进行的读、写、上传、下载和执行操作，都是通过Docker Engine API完成的，并且目标路径和具体命令完全由用户通过命令行参数指定和控制。脚本本身不会未经用户授权地修改本地（运行POC的机器）文件系统，也不会在宿主机上创建、修改或运行任何预设的恶意可执行文件。其资源消耗也主要集中在Docker API调用和文件传输上，没有检测到如加密货币挖矿程序常见的高CPU/GPU利用率或连接矿池的行为。
5.  **无敏感信息泄露**: 脚本中没有代码尝试收集任何用户敏感信息（如个人数据、认证凭据、系统配置）并将其传输到外部服务器。

**结论**: 综合上述分析，该POC代码的投毒风险被评定为**低**，具体为10%。代码高度透明、依赖合法、网络行为受控且与漏洞利用目的完全一致，未发现任何混淆、恶意载荷或异常行为。所有的操作都是为了证明CVE-2025-9074容器逃逸漏洞的危害性，即通过非授权访问Docker Engine API实现宿主机接管。因此，该POC代码可以安全地用于合法的防御性安全研究、漏洞复现和安全测试。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
