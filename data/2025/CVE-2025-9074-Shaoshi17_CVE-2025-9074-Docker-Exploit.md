## CVE-2025-9074 - Docker Desktop for Windows and macOS 容器逃逸 (Container Escape)

**漏洞编号:** CVE-2025-9074

**漏洞类型:** 容器逃逸 (Container Escape)

**影响应用:** Docker Desktop for Windows and macOS

**危害等级:** 高危

**CVSS评分:** 9.3

**影响版本:** 受影响版本在 Docker Desktop 4.44.3 之前

**利用条件:** 本地运行的恶意Linux容器可以访问Docker Engine API (192.168.65.7:2375)；不依赖挂载Docker socket。

**POC 可用性:** 9

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：
提供的Python PoC脚本（`CVE-2025-9074-docker-exploit.py`）是针对Docker Desktop（Windows和macOS版本）中存在的容器越权访问漏洞CVE-2025-9074的完整利用工具。该漏洞的本质是Docker Engine HTTP API在默认子网`192.168.65.7:2375`上可从容器内部直接访问，绕过了Docker的隔离机制。攻击者利用此特性，无需特殊的配置或权限，即可从一个受控容器内部直接与宿主机的Docker Engine进行通信。PoC通过利用这一未授权访问，能够创建一个新的、具有宿主机文件系统绑定挂载（bind mount）的特权容器。脚本的核心功能`create_priv_container_with_mount`通过向`/containers/create`端点发送精心构造的HTTP POST请求，其中关键参数包括`Privileged=True`和`Binds`。`Privileged=True`赋予新容器高级权限，而`Binds`参数则允许攻击者指定宿主机上的任意路径（例如，整个根文件系统`/`或敏感目录如`/etc`）挂载到新创建的容器中。一旦成功创建并启动此容器，攻击者即可在新容器内部获得对宿主机文件系统的读写权限，从而实现完整的宿主机控制和数据窃取、修改等高危操作。脚本还包含路径规范化功能`normalize_host_path`，能够正确处理Windows环境下的路径格式转换（例如，将`D:\temp`转换为`/mnt/host/d/temp`），这显著提升了PoC在Windows系统上的可用性和稳定性。综上所述，该PoC具有高度的有效性和完整性，能够直接展示漏洞的利用效果。

利用步骤：
1.  **前提条件**: 攻击者需要在一个受影响的Docker Desktop版本（低于4.44.3）上运行一个恶意的Linux容器，并且该容器能够访问到宿主机上的Docker Engine API（默认为`http://192.168.65.7:2375`）。此PoC脚本可以在该恶意容器内部执行，或者从一个可以访问到此API的外部机器上执行。攻击者通常会通过其他途径先获得一个容器内的代码执行权限。
2.  **安装依赖**: 在执行PoC的机器或容器中，确保已安装Python以及必要的`docker`库。可以通过运行`pip install docker websocket-client`来安装所需依赖。
3.  **执行PoC**: 运行Python脚本。根据实际情况，可以指定目标Docker API的URL（如果不同于默认的`http://192.168.65.7:2375`），并指定希望从宿主机挂载的路径和容器内的挂载点。例如，要将宿主机的整个根文件系统挂载到容器的`/host`路径下，可以执行命令：`python CVE-2025-9074-docker-exploit.py --docker-api-url http://192.168.65.7:2375 --mount-path / --container-mount-point /host`。
4.  **创建特权容器**: PoC脚本会利用未授权的Docker API访问，向`/containers/create`端点发送请求，创建一个新的特权容器。这个新容器将宿主机指定路径（如整个根文件系统`/`）绑定挂载到容器内的指定路径（如`/host`）。
5.  **宿主机控制**: 一旦新的特权容器被成功创建并启动，攻击者即可通过进入该容器（例如，使用`docker exec -it <new_container_id> /bin/bash`），然后在`/host`路径下访问和修改宿主机的整个文件系统，从而完全控制宿主机。

投毒风险分析：
对提供的PoC代码进行深入分析后，评估其投毒风险为极低，设定为5%。该PoC代码表现出高度的透明性和专业性，旨在纯粹地演示和验证CVE-2025-9074漏洞的利用方式，而非夹带任何恶意载荷。具体分析如下：
1.  **代码清晰度高**: 代码结构清晰，逻辑分明，使用了标准的Python编程实践。没有发现任何形式的代码混淆、加密或难以理解的构造，使得安全研究人员可以轻松地审计每一行代码的功能和意图。
2.  **依赖标准库**: 脚本主要依赖Python标准库（如`sys`, `json`, `os`, `platform`等）以及广为接受和审查的第三方库`requests`和`docker`。这些库本身是安全的，且脚本对它们的使用方式符合其正常功能，没有滥用其特性。
3.  **无外部资源加载**: 代码中未包含从外部URL下载或执行任何脚本、二进制文件或配置文件的指令。所有的功能都封装在本地脚本中，排除了通过远程注入恶意代码的风险。
4.  **无异常网络行为**: 除了向预期的Docker Engine API（`http://192.168.65.7:2375`）发送HTTP请求外，代码中未检测到任何向其他可疑IP地址或域名建立连接、发送数据或进行回调的迹象。其网络活动完全符合漏洞利用的需要。
5.  **无后门植入**: 脚本的核心目的是通过Docker API创建具有宿主机文件系统绑定挂载的特权容器，以证明容器逃逸能力。这种行为本身是漏洞利用的一部分，而非额外的后门植入。脚本没有尝试在宿主机或目标容器内持久化恶意文件或建立独立的C2通信。
尽管此PoC本身是“干净”的，但任何公开的PoC都存在被恶意攻击者修改并植入恶意功能（例如，在创建特权容器后植入持久性后门、数据窃取模块或勒索软件）的潜在风险。因此，作为防御性安全研究的常规实践，强烈建议在任何环境中运行公开PoC之前，都对其代码进行全面且细致的审查和沙箱测试，以防范潜在的投毒风险和二次利用。

**项目地址:** https://github.com/zenzue/CVE-2025-9074

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-9074
