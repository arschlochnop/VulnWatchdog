## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 关键

**CVSS评分:** 9.8

**影响版本:** 所有受支持的Windows Server版本上运行的WSUS服务

**利用条件:** 无需认证，需要网络访问，通过HTTP/HTTPS对WSUS服务的网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

该POC代码是一个用Python编写的远程代码执行（RCE）漏洞利用脚本，专门针对Microsoft Windows服务器更新服务（WSUS）中的CVE-2025-59287漏洞。该漏洞被归类为远程代码执行漏洞，并被微软评为关键级别，CVSS评分高达9.8分。搜索结果显示此漏洞已被积极利用，表明其利用难度较低且影响范围广。
脚本的核心利用机制是.NET反序列化。它通过调用外部的ysoserial.net工具来生成恶意序列化数据。ysoserial.net是一个著名的工具，用于生成各种流行的.NET反序列化利用链的Payload。此POC中，它使用DataSet gadget和SoapFormatter格式生成Payload，旨在执行攻击者指定的任意命令。
POC的利用流程包括以下关键步骤：
1.  **获取认证Cookie**: 脚本首先向WSUS服务器的/SimpleAuthWebService/SimpleAuth.asmx端点发送SOAP请求，以获取一个授权Cookie。它会生成一个随机的clientId（UUID），并在请求中包含该ID。这一步骤似乎无需任何预认证凭据，表明该漏洞可能存在于认证机制的早期阶段或认证绕过。成功获取的CookieData将用于后续的恶意请求。
2.  **构造恶意Payload**: 利用generate_ysoserial_payload函数，通过调用ysoserial.net（需要预先下载并指定路径）生成一个包含攻击者指定命令的.NET反序列化Payload。例如，--command "calc.exe"将生成执行计算器程序的Payload。
3.  **发送恶意SOAP请求**: 脚本随后构造一个SOAP请求，目标是WSUS服务器的/ReportingWebService/ReportingWebService.asmx端点。这个请求的关键在于它将步骤2中生成的恶意.NET反序列化Payload嵌入到SOAP消息体的BatchReportingRequest结构中的updateID字段内。这种嵌入方式利用了WSUS在处理特定报表数据时，对updateID字段进行不安全的反序列化操作。
4.  **触发反序列化**: 当WSUS服务器接收并处理包含恶意Payload的SOAP请求时，它会对待updateID字段进行反序列化。由于Payload是恶意的，且利用了DataSet gadget，这会导致服务器在反序列化过程中执行Payload中嵌入的任意系统命令，从而实现远程代码执行。
该POC代码结构清晰，利用逻辑完整，并且使用了成熟的.NET反序列化技术，结合ysoserial.net工具，大大提高了利用的可靠性和成功率。脚本参数化良好，易于使用和配置，能够实现对WSUS服务器的远程命令执行。搜索结果中也提及此漏洞正在被积极利用，进一步印证了其有效性和潜在的巨大威胁。

**利用步骤:**
1.  **安装Python依赖**: 确保Python环境已安装requests库 (pip install requests).
2.  **获取ysoserial.net**: 从GitHub或其他可靠来源下载ysoserial.net的编译版本(ysoserial.exe)，并记住其路径。
3.  **运行POC脚本**:
    *   打开命令行或终端。
    *   使用以下命令执行脚本，替换[目标WSUS服务器URL]、[ysoserial.net路径]和[要执行的命令]：
        python CVE-2025-59287.py --target [目标WSUS服务器URL] --ysoserial [ysoserial.net路径] --command "[要执行的命令]"
    *   例如，要在目标服务器上执行calc.exe：
        python CVE-2025-59287.py --target https://wsus.example.com --ysoserial C:\path\to\ysoserial.exe --command "calc.exe"
    *   脚本会尝试获取授权Cookie，生成Payload，然后发送恶意请求。如果成功，指定命令将在WSUS服务器上执行。

**投毒风险分析:**
对提供的POC代码进行详细分析后，评估其投毒风险为**低**（10%）。理由如下：

1.  **代码可读性与透明度**: POC代码采用Python编写，结构清晰，逻辑明确，没有发现任何代码混淆或加密的行为。所有函数、变量和操作都易于理解，研究人员可以轻松审计其功能。
2.  **依赖库分析**: 脚本主要使用了标准Python库，如requests（用于HTTP请求）、urllib3（用于禁用SSL警告）、xml.etree.ElementTree（用于XML解析）、subprocess（用于执行外部命令）、os（用于文件路径操作）和argparse（用于命令行参数解析）。这些都是常见且信誉良好的库，未发现引入恶意或可疑的第三方依赖。
3.  **外部工具调用**: 脚本依赖ysoserial.net外部工具来生成反序列化Payload。ysoserial.net是一个广为人知的安全研究工具，用于.NET反序列化漏洞的Payload生成。POC通过subprocess.run命令明确地调用ysoserial.exe，并传递了DataSet、SoapFormatter等参数以及用户指定的命令。这种调用方式是透明的，其目的是在目标服务器上执行命令，而不是在运行POC的本地机器上执行恶意操作。该过程的输出会被捕获，并用于构造发送给目标服务器的SOAP请求。
4.  **无恶意本地行为**: POC代码没有包含任何在本地机器上执行恶意操作的指令，例如：不尝试下载或执行来自外部URL的任意代码；不修改本地文件系统，不创建、删除或篡改敏感文件；不尝试建立反向Shell连接到攻击者的C2服务器；不收集并外发本地机器的敏感信息；不使用eval()或其他动态代码执行函数来执行来自不可信源的代码。
5.  **明确的攻击目标**: 脚本的唯一目标是利用WSUS服务器上的远程代码执行漏洞。它构造的恶意Payload旨在影响目标服务器，而不是执行者。POC的目的是帮助安全研究人员或组织验证漏洞，而不是传播恶意软件或对执行者造成损害。

综上所述，该POC代码表现出高度的专业性和防御性安全研究的意图。其功能是明确的漏洞利用，不包含任何隐藏的恶意功能或“投毒”行为。因此，其投毒风险非常低。研究人员在运行前应确保ysoserial.net的来源可靠，以防该外部工具本身被篡改，但这已超出POC代码本身的范围。

**项目地址:** N/A

**漏洞详情:** https://www.sogou.com//link?url=hedJjaC291OT1KzyjerxM1uWkymzJPK99gAHtPfHXHl5vAV7UCaVa8f-geW9JwLzIDNAVdEdFEMyeFZ86WHW40lVnezfefvp
