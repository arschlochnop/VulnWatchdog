## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 或其他使用相同SOAP服务接口的.NET应用 不安全的反序列化 (Remote Code Execution)

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 不安全的反序列化 (Remote Code Execution)

**影响应用:** Microsoft Windows Server Update Services (WSUS) 或其他使用相同SOAP服务接口的.NET应用

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** 未知

**利用条件:** 需要网络访问，利用前需获取有效的认证Cookie，但POC代码可以自动获取该Cookie。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：
该POC (CVE-2025-59287.py) 是一个用Python 3编写的完整利用脚本，旨在利用基于.NET SOAP服务的反序列化漏洞，实现远程代码执行（RCE）。脚本的核心在于集成 `ysoserial.net` 工具，该工具用于动态生成用于.NET应用的不安全反序列化Payload。具体而言，它利用 `DataSet` gadget和 `SoapFormatter` 格式来构造恶意数据。

脚本的利用流程清晰且自动化程度高：
1. **Payload生成:** `generate_ysoserial_payload` 函数负责调用外部 `ysoserial.net` 工具，根据用户提供的系统命令生成恶意的反序列化Payload。脚本会检查 `ysoserial.net` 的路径并处理生成过程中可能出现的错误，如工具未找到或超时。
2. **认证Cookie获取:** `get_auth_cookie` 函数是一个关键步骤。它通过向目标 `/SimpleAuthWebService/SimpleAuth.asmx` 端点发送 `GetAuthorizationCookie` SOAP请求，尝试自动获取有效的认证Cookie。这意味着即使攻击者没有预先获取认证信息，该POC也能在一定程度上绕过认证门槛，简化了利用过程。
3. **漏洞利用:** `exploit` 函数执行实际攻击。它向目标 `/ReportingWebService/ReportingWebService.asmx` 端点发送一个带有特定 `SOAPAction`（`GetReportViewerUrl`）的POST请求。脚本将生成的 `ysoserial.net` Payload巧妙地嵌入到SOAP请求的 `reportViewerUrl` XML元素中。当目标服务器处理此SOAP请求并尝试反序列化 `reportViewerUrl` 的内容时，如果存在漏洞，则会执行Payload中封装的任意系统命令，从而导致远程代码执行。

整体而言，该POC脚本结构良好，逻辑严谨，自动化程度高，能够有效地对存在此.NET反序列化漏洞的目标发起RCE攻击。其成功与否取决于目标环境是否易受此特定SOAP服务反序列化缺陷的影响。

利用步骤：
1. **获取ysoserial.net:** 首先，确保你的攻击机器上安装了 `.NET Runtime`，并下载 `ysoserial.net` 工具（通常是 `ysoserial.exe`）。将其放置在一个可访问的路径，例如 `/opt/ysoserial/ysoserial.exe`。
2. **安装Python环境:** 确保你的系统安装了Python 3，并安装了必要的Python库：`requests` 和 `urllib3`。你可以通过运行 `pip install requests urllib3` 来安装它们。
3. **执行POC脚本:** 使用命令行执行 `CVE-2025-59287.py` 脚本，并提供目标URL、你希望在目标服务器上执行的命令，以及 `ysoserial.net` 工具的完整路径。
    *   **示例命令:** 要在目标服务器上执行 `hostname` 命令并获取其输出（此为盲RCE，通常需要OOB技术或反弹shell来接收结果）：
        ```bash
        python3 CVE-2025-59287.py --target "https://<目标IP或主机名>" --command "hostname" --ysoserial "/path/to/ysoserial.exe"
        ```
    *   脚本首先会自动尝试获取认证Cookie和Server ID。
    *   接着，`ysoserial.net` 会根据 `hostname` 命令生成反序列化Payload。
    *   最后，该Payload会被发送到 `/ReportingWebService/ReportingWebService.asmx` 端点，触发漏洞并执行命令。
4. **验证命令执行:** 由于这是盲RCE，你无法直接从POC输出中看到命令结果。建议将 `--command` 参数设置为一个反弹shell命令或Webshell写入命令，以便进一步控制目标系统并验证漏洞利用成功。例如，使用 `powershell` 反弹shell负载。

投毒风险分析：
该POC脚本的投毒风险被评估为**低，约为5%**。此评估基于对代码的详尽审查，结果显示脚本高度透明，专注于其既定的漏洞利用功能，并未发现隐藏的恶意行为。

**评估依据如下：**
*   **代码清晰度与可读性:** 脚本采用Python编写，代码结构清晰，注释合理，逻辑易于理解，没有使用任何形式的代码混淆或加密技术来掩盖其真实意图。安全研究人员可以轻松审计其功能。
*   **标准库与可信赖依赖:** 脚本主要依赖于Python的标准库以及 `requests` 和 `urllib3` 等广泛使用且经过验证的第三方库。这些库本身是业界信任的组件，用于执行HTTP请求和XML解析等常规操作。
*   **外部工具的明确性:** 脚本唯一引用的外部二进制是 `ysoserial.net`，这是一个公开且在渗透测试和安全研究领域被广泛认可的反序列化Payload生成工具。POC明确要求用户通过命令行参数 `--ysoserial` 指定该工具的路径，并会验证其存在性。这意味着脚本不会自行下载或引入未知来源的外部可执行文件，而是将对外部工具的信任责任留给用户，显著降低了通过隐藏恶意依赖进行投毒的风险。
*   **无额外恶意载荷:** 对代码的分析未发现任何与漏洞利用无关的、可疑的恶意功能。例如，脚本不会在目标系统上安装后门、窃取用户数据并回传、连接到未知的命令与控制（C2）服务器，或进行其他超出RCE目的的操作。其唯一“恶意”行为是执行用户指定的命令，这本身是RCE漏洞利用的核心。
*   **用户对命令的控制:** 攻击者通过 `--command` 参数完全控制将在目标系统上执行的命令。POC脚本本身不包含预设的、可能对攻击者自身造成危害的恶意命令。

**潜在风险（非POC代码投毒）：**
*   **ysoserial.net工具的来源:** 尽管POC脚本本身是干净的，但如果用户从不可靠的来源获取了被篡改或恶意的 `ysoserial.net` 版本，那么实际的漏洞利用行为可能会附带恶意载荷。
*   **目标环境的安全配置:** 如果POC用于测试的环境不安全，或者目标系统本身存在其他未知的漏洞，可能会引发额外的安全问题。
*   **网络嗅探/重定向风险:** 在执行过程中，若网络路径被攻击者控制，例如DNS污染或ARP欺骗，可能导致脚本连接到非预期的恶意服务器，但这并非脚本自身的恶意。

**总结:** 综合来看，该POC是一个合法且功能完备的漏洞利用工具，其设计和实现都符合专业的安全研究标准。它没有表现出任何旨在“投毒”攻击者或其系统的行为，因此投毒风险极低。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
