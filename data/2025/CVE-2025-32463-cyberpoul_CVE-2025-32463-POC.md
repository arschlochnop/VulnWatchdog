## CVE-2025-32463 - sudo 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** sudo

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** sudo 版本 1.9.14 到 1.9.17 (不包含 1.9.17p1 及更高版本，以及 1.9.14 之前的版本)

**利用条件:** 本地访问权限，系统安装有 GCC 编译器，并且非特权用户可以运行 `sudo -R` 命令（某些配置下可能受限）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-32463 是一个严重的本地权限提升（Local Privilege Escalation, LPE）漏洞，影响 `sudo` 版本 1.9.14 至 1.9.17。该漏洞存在于 `sudo` 处理 `--chroot` (`-R`) 选项的方式中。当 `sudo` 被配置为允许非特权用户使用 `-R` 选项时，攻击者可以利用其在受控 chroot 环境中伪造 `nsswitch.conf` 文件的能力。通过精心构造的 `nsswitch.conf`，攻击者可以强制 `sudo`（以 root 身份运行）加载一个任意的 Name Service Switch (NSS) 共享库。一旦恶意库被加载，攻击者就可以在 root 权限下执行任意代码，从而完全控制受影响的系统。

**POC有效性分析：**
所提供的 POC (`CVE-2025-32463.sh`) 是一个高度有效且功能完整的 shell 脚本，旨在演示此漏洞并获取 root shell。该脚本首先创建一个临时目录 (`STAGE`)，用于构建恶意 chroot 环境。接着，它生成一个名为 `pwn.c` 的 C 语言源文件。此 C 文件包含一个带有 `__attribute__((constructor))` 属性的 `pwn` 函数，确保在库加载时自动执行。`pwn` 函数的核心功能是调用 `setreuid(0, 0)` 和 `setregid(0, 0)` 将当前进程的用户和组 ID 提升至 root (0, 0)，随后尝试通过 `execle` 执行 `/bin/bash -i` 或 `/bin/sh -i` 以获取一个交互式 root shell。脚本在 `STAGE` 目录内创建 `root/etc` 和 `libnss_` 目录，并精心构造 `root/etc/nsswitch.conf` 文件，将其 `passwd` 服务的查找路径指向 `/pwn`。同时，它将 `/etc/group` 复制到 `root/etc` 以确保 chroot 环境中的基本功能。最关键的一步是，脚本使用 `gcc` 将 `pwn.c` 编译为共享库 `libnss_/pwn.so.2`，并利用 `-Wl,-init,pwn` 链接器选项指定 `pwn` 为初始化函数。最后，脚本执行 `sudo -R root pwn`。当 `sudo` 尝试在 `STAGE` 的 chroot 环境中解析用户（即使 `pwn` 并非一个真实命令），NSS 机制会根据伪造的 `nsswitch.conf` 加载 `libnss_/pwn.so.2`。此举触发了 `pwn` 函数的执行，成功提升权限并提供了 root shell。该 POC 代码逻辑清晰，直接利用了漏洞点，并且在符合利用条件的环境中表现出极高的成功率，因此被评估为完整利用。

**利用步骤：**
1. 确保目标系统安装了受影响的 `sudo` 版本 (1.9.14 到 1.9.17)。
2. 确保目标系统已安装 `gcc` 编译器。
3. 确认非特权用户具有执行 `sudo -R` 命令的权限（某些严格配置可能禁用此功能）。
4. 将 `CVE-2025-32463.sh` 脚本下载到目标系统。
5. 赋予脚本执行权限：`chmod +x CVE-2025-32463.sh`。
6. 执行脚本：`./CVE-2025-32463.sh`。
7. 如果漏洞利用成功，将获得一个交互式的 root shell (`#`)。

**投毒风险分析：**
此 POC 代码的投毒风险评估为低（10%）。对 `CVE-2025-32463.sh` 脚本及其嵌入的 C 语言代码进行分析表明，其功能仅限于本地权限提升。C 代码的核心逻辑是设置用户和组 ID 为 root 并执行一个 shell，没有发现任何超出此范围的恶意行为。脚本在本地创建和清理临时文件和目录，使用标准编译工具 `gcc`，并且不涉及任何异常的系统调用、外部网络连接或数据外泄尝试。代码中没有发现混淆技术、可疑的 `eval` 语句、嵌入的恶意 URL 或 IP 地址，也未尝试安装持久性后门或加密货币挖矿程序。此外，`README.md` 文件明确指出该仓库旨在用于“教育目的”和“授权环境”，进一步增强了其作为合法安全研究工具的可信度。尽管任何第三方代码，特别是利用代码，都应始终经过仔细审计以防被篡改，但就当前提供的代码而言，其意图和实现均无恶意迹象，风险较低。组织在任何环境中执行此类 POC 前，都应进行全面的安全审查和沙箱测试，以确保代码的完整性和预期行为。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-32463
