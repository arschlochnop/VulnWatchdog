## CVE-2025-55182 - React Server Components, Next.js 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-55182

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** React Server Components, Next.js

**危害等级:** 严重

**CVSS评分:** 10.0

**影响版本:** Next.js 14.x.x (受影响版本 < 14.3.2), Next.js 15.x.x (受影响版本 < 15.2.4), 以及使用存在缺陷的React Flight反序列化机制的React Server Components应用。

**利用条件:** 无需认证，可通过网络访问利用

**POC 可用性:** 9/10

**POC 类型:** 概念验证 (检测工具)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：
该POC代码是一个名为`React2Shell Passive Scanner`的Python脚本，主要用于**被动扫描和检测** CVE-2025-55182（React2Shell）漏洞的存在，而非主动利用该漏洞执行代码。脚本明确指出其设计目标是“隐秘检测（stealth detection）”和“行为测试，不执行任何代码（Behavioral testing only — no code execution）”。
其有效性体现在以下几个方面：
1.  **多维度指纹识别**：脚本采用了多种技术来识别漏洞，包括：
    *   **错误模式指纹识别**：通过发送特定的、会导致服务器返回可识别错误响应的请求，从而判断漏洞是否存在。这种方式避免了实际的代码执行，降低了风险和被检测的概率。
    *   **框架版本检测**：通过检查HTTP响应头或特定路径来推断目标系统使用的Next.js版本，并与已知打补丁的版本列表（如`PATCHED_VERSIONS`字典中定义的Next.js 14.3.2+和15.2.4+为已修复版本）进行比对，从而判断目标是否可能存在漏洞。
    *   **RSC端点发现**：脚本会尝试通过`robots.txt`、`sitemap`以及常见路径来发现React Server Components (RSC) 的API端点，增加了检测的覆盖面。
    *   **HTTP头指纹识别和RSC Accept头探测**：通过发送带有特定`Accept`头（如`text/x-component`）的请求，以及分析响应头，进一步确认目标是否为RSC应用并可能受影响。
2.  **WAF友好探测**：脚本设计了多种“反序列化探测（deserialization probes）”，并按“触发WAF规则可能性从低到高”的顺序排列，旨在规避Web应用防火墙的检测。这些探测通过构造畸形的RSC数据包，观察服务器的反应。
3.  **高级扫描功能**：支持单URL或URL列表扫描、多线程、代理、请求延迟和抖动（jitter）以规避速率限制、详细的JSON/CSV/TXT格式化输出，这些都使得该扫描器功能强大且易于集成到现有安全流程中。
4.  **明确的非攻击性**：POC作者多次强调“无代码执行”，这对于防御者而言是一个非常安全的漏洞检测工具，可以在不损害系统的情况下评估风险。
综上，该POC作为一款被动式漏洞检测工具，功能完备，设计精巧，能够高效且安全地帮助用户识别目标系统是否存在CVE-2025-55182漏洞，具有很高的实用价值和有效性。

利用步骤（针对CVE-2025-55182漏洞本身的实际利用）：
CVE-2025-55182，又名React2Shell，是一个高危的远程代码执行（RCE）漏洞，存在于React Server Components（RSC）和Next.js框架中。其核心问题源于Next.js中React Flight反序列化机制对用户输入的对象属性访问路径（如`__proto__`、`constructor`）缺乏严格校验。攻击者可以利用这一缺陷，在未经认证的情况下，通过精心构造恶意请求来执行服务器上的任意代码。
具体的利用步骤大致如下：
1.  **识别目标**：攻击者首先需要找到使用React Server Components或Next.js，且版本存在缺陷的Web应用。
2.  **构造恶意Payload**：攻击者需要构造一个特殊的`multipart`表单请求，其中包含恶意的React Flight序列化数据。
3.  **利用原型链污染**：在序列化数据中，攻击者利用 `$B` 引用机制结合可控的 `_response._prefix` 和被劫持为 `Function` 类型的 `_formData.get` 等属性，来动态地生成一个包含任意系统命令的函数。
4.  **劫持 `then` 属性**：攻击者将上述动态生成的包含系统命令的函数，赋值给目标对象的一个 `.then` 属性。在JavaScript中，`then` 方法通常与Promise对象相关联，当一个对象具有 `then` 方法时，在某些上下文（如 `await` 或 Promise 链）中它可能会被隐式调用。
5.  **触发反序列化及命令执行**：当服务器端处理并反序列化这个恶意的 `multipart` 表单时，React Flight 反序列化机制会解析构造好的数据。由于缺乏足够的校验，恶意的 `then` 属性会被处理，并在特定条件下被调用。一旦 `then` 方法被调用，攻击者预置在其中的系统命令（例如通过 `child_process.execSync` 调用）就会在服务器上以应用进程的权限执行，从而实现远程代码执行。例如，攻击者可以执行 `ls /` 来列出服务器根目录文件，或者执行 `cat /etc/passwd` 读取敏感文件，甚至下载并执行恶意脚本，完全控制受影响的服务器。

投毒风险分析：
对提供的`passive.py` POC代码进行全面分析后，评估其投毒风险为**低（5%）**。分析基于以下几点：
1.  **代码透明度与可读性**：该POC是纯Python脚本，代码结构清晰，逻辑分明，没有发现任何形式的代码混淆。所有的功能实现都直接体现在代码中，易于安全研究人员审计和理解其行为。
2.  **依赖与库**：脚本仅导入了Python标准库（如`sys`, `json`, `csv`, `time`, `random`, `concurrent.futures`, `urllib.parse`等）以及常用的第三方库`requests`和`urllib3`。这些库都是广泛使用的、经过社区验证的成熟组件，其本身引入恶意代码的风险较低。脚本并未引入任何可疑或来源不明的外部模块。
3.  **行为模式**：脚本的明确设计目的是进行“被动扫描”和“隐秘检测”，并且多次强调“不执行任何代码”。代码逻辑完全围绕发送HTTP请求、解析响应、版本比对和错误模式匹配展开。没有发现任何尝试执行系统命令、修改文件、持久化驻留、回连未知C2服务器、下载额外可执行文件或利用`eval()`等高风险函数动态执行代码的行为。
4.  **网络活动**：脚本的网络活动仅限于向目标URL发送探测性HTTP请求，并接收其响应。没有证据表明它会与除目标系统之外的任何第三方服务器进行通信，也没有收集敏感数据并外传的行为。
5.  **意图与上下文**：从POC的注释、`BANNER`信息以及功能描述来看，其核心目的是帮助安全研究人员和防御者安全地识别漏洞，而不是利用漏洞发起攻击。它是一个防御性安全工具，而非攻击性工具。
综上所述，`passive.py`是一个专注于漏洞检测的合法安全工具，其代码质量高，行为可预测，不包含恶意功能，因此投毒风险极低。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-55182
