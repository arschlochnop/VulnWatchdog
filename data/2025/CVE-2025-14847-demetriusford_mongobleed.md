## CVE-2025-14847 - MongoDB Server 堆溢出读取/内存泄露

**漏洞编号:** CVE-2025-14847

**漏洞类型:** 堆溢出读取/内存泄露

**影响应用:** MongoDB Server

**危害等级:** 高危 (High)

**CVSS评分:** 8.7

**影响版本:** 多个支持的版本和旧版 MongoDB Server（zlib 压缩开启时）

**利用条件:** 远程、无需认证、MongoDB 实例需启用 zlib 压缩

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC（命名为mongobleed.rb）是一个高度完整的Ruby实现，专门针对MongoDB的OP_COMPRESSED消息处理漏洞。分析代码结构发现，它精确模拟了利用流程：首先，它构造了一个标准的BSON文档并将其封装在OP_MSG中；其次，使用zlib对载荷进行压缩；关键点在于，它在构造OP_COMPRESSED头部时，故意提供了一个远大于实际解压后长度的uncompressed_size值。通过这种方式，当MongoDB服务器在解压缓冲区后，BSON解析器会根据该虚假长度继续向后读取，从而越界进入堆内存空间。由于解析器在遇到不符合BSON规范的堆数据时会抛出错误，这些错误信息中往往包含了被解析器错误提取的堆内存片段。POC通过捕获并解析这些错误回显，实现了对服务器敏感数据的泄露。代码中包含了详细的偏移量控制（--min-offset/--max-offset）和输出保存功能，证明其具备极高的实战可用性。该漏洞已被CISA列入已知利用漏洞（KEV）清单，表明在野攻击非常活跃，此POC的逻辑与披露的攻击手法完全吻合。【利用步骤】1. 环境准备：安装Ruby环境及必要的gem包（colorize, sorbet-runtime）；2. 目标确认：确认目标MongoDB服务器开启了zlib压缩支持（通常端口为27017）；3. 执行脚本：运行 `bundle exec ruby mongobleed.rb --host <target_ip>`；4. 参数微调：根据回显情况调整offset参数，以获取不同深度的堆内存内容；5. 数据提取：脚本会自动将泄露的内存片段尝试解析并输出，攻击者可从中筛选凭据、配置或会话信息。【投毒风险分析】经过对代码的静态审计，该POC目前表现为较低的投毒风险。代码仓库结构规范，包含Makefile、Gemfile和符合Sorbet类型检查的Ruby脚本，没有发现明显的代码混淆、远程Shell反弹指令或恶意下载器行为。脚本使用的依赖项（如colorize）均为Ruby社区常见的合法库。主要风险点在于其对底层网络套接字的直接操作，但这属于安全研究工具的正常行为。代码逻辑清晰，易于阅读和审查，没有隐藏的eval调用或非标准的外部依赖请求。尽管如此，防御方在下载使用此类POC时，仍应在隔离沙箱环境中运行，并使用bundle命令进行依赖审计，防止下游供应链劫持。目前的分析结论是，该POC是一个纯粹的、高质量的安全研究工具，其主要威胁来自于其强大的漏洞利用能力，而非其代码本身包含的恶意后门。

**项目地址:** [https://github.com/advisories/GHSA-4742-mr57-2r9j](https://github.com/advisories/GHSA-4742-mr57-2r9j)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-14847](https://nvd.nist.gov/vuln/detail/CVE-2025-14847)
