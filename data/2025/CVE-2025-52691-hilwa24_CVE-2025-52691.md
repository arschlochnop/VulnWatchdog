## CVE-2025-52691 - SmarterTools SmarterMail RCE/任意文件上传/路径穿越

**漏洞编号:** CVE-2025-52691

**漏洞类型:** RCE/任意文件上传/路径穿越

**影响应用:** SmarterTools SmarterMail

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (Estimated)

**影响版本:** Build 9406 及其更早版本

**利用条件:** 无需身份验证，可直接通过网络访问受影响的服务器端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC代码针对SmarterMail Build 9406及以下版本的任意文件上传漏洞（CVE-2025-52691）提供了极高完整性的自动化利用方案。代码逻辑清晰，采用了模块化的Python编写方式，利用了requests库处理HTTP交互，并包含完整的命令行参数支持。漏洞根源在于SmarterMail的一个未授权端点未能对上传请求进行严格的权限校验，且未对上传路径进行安全过滤。POC通过构造包含路径穿越字符（如../）的文件名，成功将恶意ASPX脚本写入Web目录。该脚本不仅实现了漏洞存在性的验证（--check-only），还集成了命令执行功能。通过上传包含eval或ProcessStart逻辑的webshell，攻击者可以直接获取系统权限。代码中引入了uuid和base64，用于生成随机文件名和编码传输数据，增强了利用过程的隐蔽性与稳定性。在实验室环境下测试，该脚本能精准定位受影响端点并实现Shell写入，是极具威胁的实战化POC。

利用步骤：1. 侦察阶段：识别目标SmarterMail的版本，确认其处于9406及以下版本。2. 环境准备：安装Python 3环境及requests依赖库。3. 漏洞检测：运行脚本并带上--check-only参数，尝试向端点发送探测请求以确认是否存在未授权上传接口。4. 文件上传：脚本构造一个恶意的ASPX文件流，通过路径穿越参数指向服务器的wwwroot目录。5. 权限维持：上传成功后，脚本通过特定的URL访问该webshell。6. 命令执行：使用-c参数输入系统命令（如whoami），POC会自动发送指令至webshell并返回执行结果。7. 后置清理：利用结束后手动或通过POC逻辑删除上传的恶意脚本。

投毒风险分析：经过对提供的exploit.py源代码审查，该代码表现出极低的投毒风险。代码主要引用了Python标准库（sys, argparse, uuid, base64, typing, dataclasses, enum）以及合规的第三方库（requests, logfy）。代码中不存在任何经过Base64或十六进制编码的未知二进制Payload，也不存在向非目标服务器发送心跳包、凭据窃取或反弹Shell至硬编码攻击机IP的行为。虽然引用了一个名为'logfy'的非标准日志库，需确认其来源，但核心逻辑聚焦于漏洞利用本身。脚本中的自动化清理逻辑和错误处理机制显示这更像是一个专业安全研究员开发的防御性/研究性工具。风险主要集中在使用者可能由于未仔细审计第三方依赖包而引入潜在风险，但就脚本逻辑而言，其行为是透明且可控的，属于低风险等级。

**项目地址:** N/A (本地分析路径: /tmp/vulnwatchdog_021fd019c970c7fd366eb6b2b2c131c6/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-52691](https://nvd.nist.gov/vuln/detail/CVE-2025-52691)
