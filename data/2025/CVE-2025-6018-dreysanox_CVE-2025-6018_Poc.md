## CVE-2025-6018 - Linux (主要影响 openSUSE Leap 15/SLES 15 的PAM模块, 以及其他主流发行版如Ubuntu, Debian, Fedora中配置不当的PAM组件和udisks守护进程) 本地权限提升 (LPE)

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Linux (主要影响 openSUSE Leap 15/SLES 15 的PAM模块, 以及其他主流发行版如Ubuntu, Debian, Fedora中配置不当的PAM组件和udisks守护进程)

**危害等级:** 高危

**CVSS评分:** 

**影响版本:** PAM版本 pam-1.3.0, openSUSE Leap 15 / SLES 15，以及其他存在类似PAM配置缺陷和udisks漏洞的Linux发行版

**利用条件:** 需要已认证的本地或远程SSH/TTY访问权限

**POC 可用性:** 7

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析：
提供的POC代码`poc2025-6018.py`是一个Python脚本，旨在利用CVE-2025-6018，该漏洞是本地权限提升漏洞链中的关键一环。脚本通过`paramiko`库建立到目标Linux系统的SSH连接，模拟一个已认证的用户会话。脚本首先执行一系列预检查，以确定目标系统是否满足漏洞触发条件，包括查询PAM（可插拔认证模块）的版本（特定寻找`pam-1.3.0`）以及验证`pam_env.so`模块是否在PAM配置文件中存在（例如，`/etc/pam.d/common-*`或`/etc/pam.d/sshd`）。
如果这些条件被满足，脚本将进入“环境投毒”阶段（Stage 1）。此阶段通过创建或修改目标用户家目录下的`~/.pam_environment`文件，设置`XDG_SEAT OVERRIDE=seat0`和`XDG_VTNR OVERRIDE=1`环境变量。这是CVE-2025-6018的核心机制，它欺骗PAM模块将远程SSH/TTY会话误识别为本地控制台会话。脚本使用了清晰的彩色输出，以便用户能够直观地了解连接状态、漏洞检查结果和执行进度。尽管POC代码的后半部分（特别是“Stage 2: Triggering privilege escalation”）在提供的数据中被截断，但就CVE-2025-6018的利用而言，其环境投毒的实现是完整且有效的。结合Qualys威胁研究小组披露的信息，CVE-2025-6018通常与CVE-2025-6019（涉及udisks守护进程和libblockdev库）结合，以完成从普通用户到root权限的完整提权。因此，该POC为整个漏洞链的第一个关键步骤提供了强有力的概念验证，展现了其高度的有效性。

利用步骤：
1.  **前提条件**：攻击者需具备目标Linux系统的普通用户SSH凭证或TTY访问权限。目标系统必须是受影响的Linux发行版（例如openSUSE Leap 15/SLES 15，或具有类似PAM配置缺陷的Ubuntu、Debian、Fedora等），并且PAM配置中存在将远程会话误判为本地控制台的缺陷（CVE-2025-6018）。同时，通常需要系统存在另一个漏洞（如CVE-2025-6019，涉及udisks或libblockdev）来利用被修改的环境变量进行最终提权。
2.  **执行POC**：攻击者使用Python运行`poc2025-6018.py`脚本，并提供目标主机的IP地址、用户名以及对应的认证凭据（密码或SSH密钥）。
3.  **连接与检查**：脚本会通过`paramiko`库尝试建立SSH连接。连接成功后，它将执行系统命令来检查PAM版本和配置文件，以确认目标系统是否满足CVE-2025-6018的脆弱条件。
4.  **环境投毒**：如果系统被识别为脆弱，脚本会在当前登录用户的家目录下（`~/.pam_environment`）写入特定的环境变量`XDG_SEAT OVERRIDE=seat0`和`XDG_VTNR OVERRIDE=1`。这一步是利用CVE-2025-6018的关键，它欺骗PAM模块，使其将远程会话误认为是本地控制台会话。
5.  **触发提权（后续步骤）**：尽管提供的POC代码在此处截断，但根据漏洞链的描述，在环境被成功“投毒”后，攻击者通常会利用另一个漏洞（例如CVE-2025-6019）来触发最终的权限提升。由于PAM现在已将会话视为本地会话，某些服务（如udisks）在处理特定操作时可能会授予普通用户本不应有的高权限，从而使攻击者能够获取root权限。
6.  **验证**：攻击者可以通过执行`id`或`whoami`等命令来验证是否已成功提升至root权限。

投毒风险分析：
对提供的POC代码`poc2025-6018.py`进行审查后，评估其投毒风险为10%，属于低风险范畴。该代码的结构清晰，逻辑明确，其核心功能完全围绕着CVE-2025-6018漏洞的利用展开，没有发现任何可疑的恶意行为。
首先，脚本使用了标准的Python库，例如`paramiko`用于安全的SSH连接和命令执行，以及`colorama`用于改善终端输出。这些库在安全社区和开发领域均被广泛认可和使用，不包含内在的恶意功能。代码中未检测到尝试导入或执行来自外部、未知或混淆来源的代码，也没有使用如`eval()`这类高风险函数，这显著降低了潜在的投毒风险。
其次，POC执行的主要操作是建立SSH连接、检查系统配置以及在目标系统上创建或修改`~/.pam_environment`文件。修改此文件以设置`XDG_SEAT`和`XDG_VTNR`变量是CVE-2025-6018漏洞利用的合法组成部分，其目的是为了模拟特定的环境条件，从而触发PAM的预期外行为。虽然这种操作是漏洞利用的关键，但其本身并非传统意义上的恶意活动，也不会在目标系统上留下难以检测的恶意后门或加载额外的恶意载荷。所有执行的命令均可追溯，且意图明确地服务于漏洞检查和环境配置。
此外，代码中没有发现任何网络回调、数据窃取、加密货币挖矿、建立持久化机制或任何其他常见的恶意软件特征。所有操作都是透明的，且直接服务于漏洞的验证和利用目的。
综上所述，该POC代码是一个典型的漏洞概念验证或利用工具，旨在演示特定漏洞的存在和可利用性。作为防御性安全研究员，我们必须区分漏洞利用代码与旨在植入后门、窃取数据或执行其他未声明恶意行为的投毒代码。鉴于该POC仅限于实现CVE-2025-6018的利用，且未包含任何额外的恶意载荷或行为，其投毒风险被评估为非常低。尽管如此，在任何环境下使用此类POC进行测试时，仍建议在隔离环境中进行，并对任何来自未知来源的、后续可能被引入的利用代码保持高度警惕。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-6018
