## CVE-2025-49144 - Notepad++ 权限提升与远程代码执行 (Privilege Escalation and Remote Code Execution via Search Path Hijacking)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升与远程代码执行 (Privilege Escalation and Remote Code Execution via Search Path Hijacking)

**影响应用:** Notepad++

**危害等级:** 高危 (High)

**CVSS评分:** N/A

**影响版本:** v8.8.1安装程序

**利用条件:** 需要本地访问权限或用户执行恶意捆绑的安装程序，攻击者需在安装程序同目录下放置恶意文件。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析: 该漏洞利用了Notepad++安装程序在查找 `regsvr32.exe` 时存在的未引用路径（unquoted PATH）问题。动态分析揭示，安装程序在尝试定位 `regsvr32.exe` 时，会优先在其当前工作目录中进行搜索，而非直接通过系统PATH查找。这种行为允许攻击者将一个恶意的 `regsvr32.exe` 文件放置在与合法Notepad++安装程序相同的目录下。当用户执行安装程序时，它会错误地加载并执行攻击者提供的恶意 `regsvr32.exe`，从而导致任意代码执行，并且由于安装程序通常以SYSTEM权限运行，因此可以实现权限提升。POC清晰地展示了这一过程：首先，编写一个简单的C#程序，其功能是向 `C:\Windows\Temp\` 目录写入一个名为 `NOTEPAD_VULNERABIL.txt` 的文件，以证明代码执行。接着，使用Donut工具将这段C#代码转换为Shellcode，并将其嵌入到一个C语言编写的Shellcode加载器中。这个C程序被编译为 `regsvr32.exe`。当这个恶意的 `regsvr32.exe` 与Notepad++安装程序一起被放置并在安装过程中执行时，C程序会分配内存、加载并执行Shellcode，成功在SYSTEM权限下创建文本文件，验证了漏洞的有效性以及远程代码执行和权限提升的能力。整个POC链条完整，机制明确，验证了攻击的可行性。

利用步骤:
1. 攻击者获取存在漏洞的Notepad++安装程序（例如 `v8.8.1` 版本）。
2. 攻击者编写一个恶意载荷，例如一个能够写入文件的C#程序，用于在目标系统上执行任意操作。
3. 使用如Donut之类的工具将C#程序转换为Shellcode，并将其嵌入到一个C语言编写的Shellcode加载器中。
4. 将该C语言程序编译为名为 `regsvr32.exe` 的可执行文件，作为恶意二进制文件。
5. 攻击者将这个恶意 `regsvr32.exe` 文件与原始的Notepad++安装程序放置在同一个目录下。
6. 攻击者通过社会工程学或其他手段，诱导受害者运行该目录下的Notepad++安装程序。
7. 当安装程序运行时，它将首先在当前目录中查找并执行攻击者提供的恶意 `regsvr32.exe`，而非系统自带的合法程序。
8. 恶意 `regsvr32.exe` 将执行其中嵌入的Shellcode，从而在SYSTEM权限下执行任意代码（在本POC中是写入一个证明文件）。

投毒风险分析: 提供的POC代码本身（C#用于写入文件和C语言Shellcode加载器）的投毒风险极低。C#代码的功能仅限于创建一个文本文件，其内容明确、无害，旨在作为概念验证。C语言的Shellcode加载器代码结构清晰，使用了标准的Windows API进行内存分配和Shellcode执行，不包含任何混淆、恶意网络通信或持久化机制。`payload.h` 中包含的Shellcode直接来源于上述无害的C#代码，因此其内容也是可审计和无恶意的。该POC的目的是为了演示漏洞机制和可利用性，而非进行实际攻击。然而，此漏洞类型和利用方法具有非常高的投毒潜力。攻击者可以非常容易地替换POC中的演示性Shellcode为真实的恶意载荷，例如：植入后门程序以实现持久控制、部署勒索软件加密受害者数据、安装信息窃取木马窃取敏感信息、或作为横向移动的跳板在内部网络中进一步扩散。鉴于此漏洞允许在SYSTEM权限下执行代码，攻击者一旦成功利用，便能完全控制受感染系统。因此，尽管POC代码本身安全，但其利用的漏洞类型和技术栈使得其极易被恶意攻击者复用和改造，从而对目标系统造成严重危害。组织在应对此类漏洞时，除了分析POC代码，更应关注其潜在的攻击向量和被恶意利用的风险。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
