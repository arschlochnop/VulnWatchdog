## CVE-2025-49144 - Notepad++ 权限提升, 远程代码执行 (RCE)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升, 远程代码执行 (RCE)

**影响应用:** Notepad++

**危害等级:** 严重

**CVSS评分:** N/A

**影响版本:** v8.8.1

**利用条件:** 需要本地用户交互 (运行受感染的安装程序), 攻击者需要将恶意文件置于安装程序同目录

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

该漏洞 (CVE-2025-49144) 存在于Notepad++ v8.8.1版本的安装程序中。具体来说，安装程序在执行过程中尝试定位并运行`regsvr32.exe`时，没有对其路径进行带引号处理。这种未引用路径（Unquoted Path）或可执行文件劫持（Executable Hijacking）的漏洞，允许攻击者在Notepad++安装程序所在的同一目录下放置一个恶意构造的`regsvr32.exe`文件。当合法安装程序运行时，由于其本身通常以SYSTEM等高权限运行，它将错误地加载并执行攻击者控制的`regsvr32.exe`，而非系统路径中合法的`regsvr32.exe`。这导致了本地权限提升（LPE）至SYSTEM级别，并进一步实现任意代码执行（RCE）。一旦攻击者获得SYSTEM权限，他们将对受影响系统拥有完全控制权，构成严重的威胁。

提供的概念验证（POC）代码充分且有效地演示了此漏洞的严重性和利用方式。POC详细地展示了一个多步骤的利用过程：首先，攻击者创建一个C#程序（例如名为`PoC.cs`），该程序的目标是向`C:\Windows\Temp\`目录写入一个简单的文本文件（`NOTEPAD_VULNERABIL.txt`），并明确指出此操作证明了“使用SYSTEM权限执行代码”。随后，这个C#代码被使用`donut`工具转换成Shellcode。接着，开发一个简短的C语言程序，其功能是将生成的Shellcode加载到内存中并执行。这个C程序被编译成一个可执行文件，并重命名为`regsvr32.exe`。当这个特制的`regsvr32.exe`文件被放置在Notepad++ v8.8.1安装程序所在的相同目录中，并且用户执行了该安装程序时，恶意`regsvr32.exe`将被安装程序以SYSTEM权限自动执行。最终，在`C:\Windows\Temp\`目录中成功创建`NOTEPAD_VULNERABIL.txt`文件，验证了漏洞利用的成功，并证实攻击者能够以SYSTEM级别执行任意代码。该POC通过提供清晰的代码片段和详细的漏洞机制解释，具有高度的有效性和可复现性。

利用此漏洞的步骤如下：
1.  **准备恶意载荷**：攻击者首先需要准备一个恶意载荷，例如POC中所示的用于写入文件的C#代码，或在实际攻击场景中更具破坏性的载荷。
2.  **生成Shellcode**：使用`donut`等工具将准备好的恶意载荷（C#程序）转换为Shellcode。
3.  **创建加载器**：编写一个C语言程序，该程序的主要功能是将上述生成的Shellcode加载到内存中并执行。
4.  **编译与重命名**：将C语言加载器程序编译为可执行文件，并将其文件名修改为`regsvr32.exe`。
5.  **文件放置**：将这个恶意构造的`regsvr32.exe`文件放置在Notepad++ v8.8.1安装程序的同一目录下。
6.  **诱导执行**：通过社会工程学或其他手段，诱导受害者运行被篡改目录下的Notepad++ v8.8.1安装程序。
7.  **权限提升与代码执行**：当安装程序启动时，它将错误地执行攻击者提供的`regsvr32.exe`，从而以SYSTEM权限运行嵌入其中的恶意Shellcode，最终实现系统级别的远程代码执行。

对提供的POC代码进行投毒风险分析，其风险评估为非常低（5%）。POC中包含的C#载荷和C语言加载器代码片段都非常清晰，其目的明确且无害：通过写入一个临时文件来演示漏洞的权限提升能力。代码中没有发现任何混淆处理、可疑的外部调用、试图下载额外载荷或与命令与控制（C2）服务器通信的行为。`donut`工具虽然用于Shellcode生成，但其本身是标准的.NET程序集转Shellcode工具，不具备固有恶意性。POC的说明文档清晰地阐述了如何编译和部署这些组件。对于防御性安全研究人员而言，可以轻松理解其功能，并验证代码本身不包含隐藏的后门或超出其既定目的（证明SYSTEM级别执行）的恶意代码。尽管任何POC都可能被恶意行为者修改以包含真正的恶意载荷，但就当前提供的这份POC及其描述而言，它是一个干净、具有教育意义的漏洞演示，而非被木马化或内含恶意功能的工具。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
