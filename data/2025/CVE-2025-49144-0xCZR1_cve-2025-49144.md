## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** Awaiting Analysis

**影响版本:** 8.8.1及更早版本

**利用条件:** 需要用户交互（社会工程学或点击劫持）将恶意文件与合法安装程序放置在同一目录，之后在运行安装程序时自动以SYSTEM权限执行。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49144 是一个影响 Notepad++ 安装程序（版本 8.8.1 及更早版本）的严重权限提升漏洞。该漏洞的根本原因在于安装程序在查找 `regsvr32.exe` 这一系统工具时存在不安全的搜索路径行为。具体来说，安装程序在尝试定位 `regsvr32.exe` 时，会优先在其当前工作目录中进行搜索，而非直接使用绝对路径或遵循系统标准的 PATH 环境变量。这种设计缺陷允许攻击者通过在安装程序同目录中放置一个恶意命名为 `regsvr32.exe` 的可执行文件，从而在高权限下执行任意代码。

**利用步骤：**
1. 攻击者首先精心制作一个恶意可执行文件，并将其命名为 `regsvr32.exe`。该文件可以包含任何恶意载荷，例如建立反向 shell、安装持久化后门或执行数据窃取等操作。
2. 攻击者利用社会工程学、点击劫持或类似手段，诱导受害者下载合法的 Notepad++ 安装程序（例如 `npp.8.8.1.Installer.x64.exe`）以及前述的恶意 `regsvr32.exe` 文件，并将两者放置在同一目录下。
3. 当受害者双击运行合法的 Notepad++ 安装程序时，安装程序在初始化过程中会尝试查找并执行 `regsvr32.exe`。由于不安全的搜索路径，它会首先发现并加载同目录下的恶意 `regsvr32.exe`。
4. 恶意 `regsvr32.exe` 将被以 SYSTEM 权限执行，从而使攻击者获得目标机器的完全控制权，严重威胁用户数据和系统安全。

**POC有效性分析：**
所提供的概念验证（POC）材料对 CVE-2025-49144 漏洞的权限提升机制进行了高度有效且清晰的演示。该 `readme.md` 文件准确地指出了漏洞的根源：Notepad++ 安装程序在搜索 `regsvr32.exe` 时存在不安全的路径解析缺陷，它会优先在其当前工作目录中寻找，而非依赖绝对路径或系统环境变量。这种行为为攻击者注入恶意可执行文件创造了关键的机会窗。

POC 的实现方法经过精心设计，并且逻辑严谨。首先，它定义了一个简单但有效的 C# 载荷。当此载荷被执行时，它仅执行一个无害的操作：在 `C:\Windows\Temp` 目录下创建一个名为 `NOTEPAD_VULNERABIL.txt` 的文本文件。该文件的内容明确指出：“Acest fisier demonstreaza executia de cod cu privilegii de SYSTEM”，清晰地表明代码已成功以 SYSTEM 权限执行。选择这种无害载荷对于 POC 来说是典范，因为它既能明确证明漏洞的存在，又不会对目标系统造成任何损害。

接下来，POC 描述了将此 C# 载荷转换为 shellcode 的过程，并提及使用了 `donut` 等工具。尽管 `donut` 工具本身并未直接提供，但其将托管代码转换为与位置无关的 shellcode 的应用是安全研究中常见且合法的技术。生成的 shellcode 封装了 C# 程序的全部功能。

POC 的另一个关键组成部分是一个小型 C 程序，用于在内存中加载并执行生成的 shellcode。该 C 程序使用标准的 Windows API 函数（如 `VirtualAlloc`、`RtlMoveMemory`、`VirtualProtect`、`CreateThread`、`WaitForSingleObject`）来动态分配可执行内存、将 shellcode 复制到其中、调整内存保护并创建线程执行 shellcode。这个标准的 shellcode 运行器随后被编译为一个名为 `regsvr32.exe` 的可执行文件。文件名的选择至关重要，因为它直接模拟了 Notepad++ 安装程序不安全搜索的合法系统工具。

最后，为了成功利用漏洞，攻击者需要将这个由攻击者控制的 `regsvr32.exe` 文件与一个合法的、存在漏洞的 Notepad++ 安装程序包（例如 `npp.8.8.1.Installer.x64.exe`）放置在同一目录下。当不知情的用户启动安装程序时，安装程序的缺陷逻辑会导致它从当前目录而非 `C:\Windows\System32` 等系统路径中发现并启动恶意的 `regsvr32.exe`。至关重要的是，此次执行以 SYSTEM 权限进行，从而使攻击者获得了对目标机器的完全控制。`NOTEPAD_VULNERABIL.txt` 文件以 SYSTEM 权限成功创建，成为了权限提升的无可辩驳的证据。该 POC 结构良好，易于理解，并提供了足够的细节以便独立验证，从而证实了 CVE-2025-49144 的高严重性和可利用性。

**投毒风险分析：**
针对所提供的概念验证（POC）代码的投毒风险评估显示，其风险极低。这里的“投毒”指的是 POC 本身可能包含隐藏的恶意功能、后门或旨在损害试图验证漏洞的用户系统的元素。

POC 中提供的 C# 载荷被明确设计为执行一个单一的、无害的操作：在 `C:\Windows\Temp` 目录中创建一个名为 `NOTEPAD_VULNERABIL.txt` 的文本文件。这个操作是完全良性的，仅作为权限提升成功的指示器。它不试图修改系统文件、安装服务、建立网络连接、窃取数据，或执行任何通常与恶意软件相关的有害操作。其目的纯粹是诊断和演示性质。

同样，负责加载和执行 shellcode 的 C 代码是安全研究和漏洞利用开发中常用且透明的技术。它利用标准的 Windows API 函数来分配内存、复制数据、设置执行权限并运行载荷。此 C 包装器中没有发现任何混淆、反分析技术或任何隐藏的恶意代码。代码清晰直观，其功能仅限于其声明的目的：执行所提供的 shellcode。

尽管 POC 提到了使用 `donut` 将 C# 程序集转换为 shellcode，而 `donut` 是一个强大且多功能的工具，但在此处其用途仅限于一个良性载荷。如果源（C# 程序）本身是良性的，那么使用 `donut` 行为并不会在生成的 shellcode 中引入恶意组件。shellcode 的行为将与 C# 程序一致，而 C# 程序本身已被确定为无害。

总而言之，所提供的 POC 代码片段是干净、透明的，并且完全专注于演示 CVE-2025-49144 漏洞。没有发现任何可疑的网络请求、混淆的代码段，或调用外部不受信任资源的迹象，表明存在投毒企图。安全研究人员和实践者可以以高度信任的态度分析、编译和执行此特定 POC，相信它不会引入恶意软件或损害其系统。低投毒风险证明了在呈现此概念验证时所遵循的道德规范。然而，必须重申，此低风险**仅适用于所提供的 POC**。底层漏洞本身是严重的，现实世界的攻击者无疑会用更具破坏性的载荷（例如反向 shell、勒索软件或持久性后门）来替换无害的文本文件写入载荷，以实现其恶意目标。因此，修补此漏洞仍然是至关重要的防御策略。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
