## CVE-2025-49144 - Notepad++ 权限提升/远程代码执行 (Privilege Escalation/Remote Code Execution)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升/远程代码执行 (Privilege Escalation/Remote Code Execution)

**影响应用:** Notepad++

**危害等级:** 高危/Critical

**CVSS评分:** 9.8

**影响版本:** v8.8.1

**利用条件:** 需要用户交互/本地文件系统写入权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49144 是 Notepad++ v8.8.1 安装程序中存在的一个权限提升（Privilege Escalation）和远程代码执行（Remote Code Execution, RCE）漏洞。该漏洞的根本原因在于安装程序在执行 `regsvr32` 命令时，没有使用带引号的绝对路径，而是优先在其当前工作目录中查找该可执行文件。这种行为是典型的 DLL 劫持或非引用服务路径（Unquoted Service Path）漏洞的一个变种，允许攻击者通过放置一个恶意的 `regsvr32.exe` 文件在安装程序所在的目录中，来劫持正常的程序执行流程，并以 SYSTEM 权限执行任意代码。

**POC有效性分析:**
提供的POC代码非常清晰且有效，它通过模拟攻击者利用该漏洞的完整流程来证明其可行性。POC包含以下几个关键部分：
1.  一个简单的C#程序，其功能是向 `C:\Windows\Temp\` 目录写入一个名为 `NOTEPAD_VULNERABIL.txt` 的文本文件，内容为“Acest fisier demonstreaza executia de cod cu privilegii de SYSTEM.”（此文件演示了以SYSTEM权限执行代码）。这个程序的目标是明确展示代码是以SYSTEM权限执行的。
2.  使用 `donut` 工具将上述C#程序编译为Shellcode。这种技术在实际攻击中常用于内存执行，以规避基于文件签名的检测。
3.  一个C语言编写的Shellcode加载器。这个加载器负责从头文件中读取Shellcode，并使用 `VirtualAlloc`、`RtlMoveMemory` 和 `VirtualProtect` 等Windows API将其加载到内存中，并通过 `CreateThread` 在内存中执行。这是Shellcode执行的常见模式。
4.  最后，将编译后的C语言加载器重命名为 `regsvr32.exe` 并放置在Notepad++安装程序所在的目录中。当用户运行Notepad++ v8.8.1安装程序时，安装程序会错误地加载并执行攻击者提供的恶意 `regsvr32.exe`，而非系统路径下的合法 `regsvr32.exe`。由于安装程序通常以 SYSTEM 权限运行，因此攻击者的Payload也将以 SYSTEM 权限执行。

这个POC的有效性极高，它不仅演示了权限提升到 SYSTEM 级别，也通过创建文件证明了任意代码执行的能力。整个利用链条完整，技术细节明确，易于复现和验证。

**利用步骤:**
1.  **准备恶意Payload:** 攻击者首先编写一个恶意程序（例如一个后门程序、勒索软件或其他恶意功能），或者像POC中所示，编写一个用于验证权限的简单程序（如创建特定文件）。
2.  **生成Shellcode:** 使用 `donut` 等工具将恶意程序转换为Shellcode。
3.  **编写并编译Shellcode加载器:** 编写一个C语言程序，该程序能够加载并执行上述Shellcode。这个C程序将被编译为一个可执行文件。
4.  **重命名可执行文件:** 将编译后的C程序重命名为 `regsvr32.exe`。
5.  **放置恶意文件:** 攻击者将这个伪造的 `regsvr32.exe` 文件放置到受害者计划运行Notepad++ v8.8.1安装程序（例如 `npp.8.8.1.Installer.x64.exe`）的同一目录下。
6.  **诱导执行:** 攻击者诱导受害者从包含恶意 `regsvr32.exe` 的目录中运行合法的Notepad++安装程序。这可以通过钓鱼、恶意下载链接或直接在已感染系统上放置文件来实现。
7.  **权限提升与RCE:** 当受害者运行安装程序时，Notepad++安装程序会优先从当前目录加载攻击者提供的 `regsvr32.exe` 并执行其内部的Shellcode。由于安装程序通常以 SYSTEM 权限运行，攻击者的Payload将获得 SYSTEM 级别的权限，从而实现权限提升和远程代码执行。

**投毒风险分析:**
根据提供的POC代码和描述，该POC本身的投毒风险评估为低（10%）。主要原因如下：
1.  **代码清晰无混淆:** POC中提供的C#和C语言代码片段都是清晰、可读且没有进行任何混淆处理的。其逻辑简单直接，意图明确为演示漏洞的利用而非隐藏恶意行为。
2.  **Payload功能 benign:** POC中C#程序的Payload仅仅是创建一个文本文件来证明代码执行和权限级别。它不包含任何实际的恶意功能，如数据窃取、系统破坏、网络回连或部署后门。
3.  **无外部可疑依赖:** POC中没有发现引入外部可疑脚本、库或组件。虽然提到了 `donut` 工具，但这是用于Shellcode生成的合法工具，而非恶意依赖。
4.  **标准利用技术:** POC利用了 DLL 劫持/非引用路径的标准技术，并通过Shellcode加载器执行Payload，这些都是安全研究和渗透测试中常见的无害验证方法。

尽管POC本身没有投毒风险，但该漏洞本身的潜在危害是极高的。攻击者可以轻易地将POC中的良性Payload替换为任何恶意Payload，例如：安装持久化后门、窃取敏感数据、部署勒索软件、横向移动或植入其他恶意软件。因此，虽然POC代码本身安全，但它所演示的漏洞具有严重的实际攻击风险。组织应尽快修补受影响的Notepad++版本，并对软件安装流程进行安全审查，确保路径引用的正确性和完整性。

**项目地址:** https://osintteam.blog/cve-2025-49144-privilege-escalation-in-notepad-v8-8-1-installer-and-rce-with-system-privileges-c018d79a5f1d

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
