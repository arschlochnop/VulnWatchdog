## CVE-2025-49144 - Notepad++ 特权提升 (Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 特权提升 (Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高危 (High Risk) - 导致系统完整入侵和SYSTEM权限代码执行

**CVSS评分:** N/A

**影响版本:** 未明确指定，但影响Notepad++的安装程序，可能涉及未正确处理路径引用的版本。

**利用条件:** 需要用户执行受影响的Notepad++安装程序，且攻击者需将恶意regsvr32.exe文件放置在安装程序所在目录。无需认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

本漏洞，标识为CVE-2025-49144，是一个影响Notepad++安装程序的特权提升漏洞。核心问题在于安装程序在执行`regsvr32`命令时，未对路径进行正确引用，导致存在未引用路径漏洞（Unquoted Path Vulnerability）。当安装程序尝试查找并执行`regsvr32.exe`时，它会首先在其当前工作目录中进行搜索，而非直接使用`C:\Windows\System32`中的合法路径。攻击者可以利用此弱点，在Notepad++安装程序所在的目录中放置一个恶意构造的`regsvr32.exe`文件，从而在用户执行安装程序时，以与安装程序相同的权限（通常是SYSTEM权限）执行任意代码。

**POC有效性分析**
所提供的POC代码非常有效且具有清晰的说明，能够成功验证此特权提升漏洞。该POC包含两个主要部分：首先，一个用C#编写的简单Payload，其功能是在`C:\Windows\Temp`目录下创建一个名为`NOTEPAD_VULNERABIL.txt`的文本文件，并写入“Acest fisier demonstreaza executia de cod cu privilegii de SYSTEM.”（此文件演示以SYSTEM权限执行代码）的文本，以此作为代码成功执行的直观证据。其次，该POC描述了如何使用`donut`工具将此C# Payload转换为Shellcode，然后将其嵌入到一个用C语言编写的加载器中。这个C语言加载器被编译为`regsvr32.exe`。当恶意`regsvr32.exe`与Notepad++安装程序置于同一目录并被执行时，它将以高权限（通常为SYSTEM）启动，并执行嵌入的Shellcode，最终成功创建证明文件。这种利用方式充分利用了未引用路径漏洞的原理，演示了如何将低权限下的恶意代码提升至SYSTEM权限执行，从而实现系统完整性入侵。尽管POC中展示的图片链接无法访问，但其文字描述和代码逻辑足以证明其有效性和可靠性。

**利用步骤**
1.  **漏洞识别与确认**: 攻击者首先需要确认目标Notepad++安装程序存在CVE-2025-49144描述的未引用路径漏洞。
2.  **Payload准备**: 攻击者根据攻击目的，编写一个自定义的恶意Payload。本POC中Payload是一个C#程序，用于创建特定文本文件以证明权限提升。实际攻击中，Payload可能包括创建后门、窃取敏感数据、部署持久化机制或执行其他恶意操作。
3.  **Shellcode生成**: 使用`donut`等工具将C# Payload转换为Shellcode。
4.  **恶意`regsvr32.exe`制作**: 编写一个C语言程序，该程序的核心功能是加载并执行上一步骤生成的Shellcode。将此C程序编译成一个名为`regsvr32.exe`的可执行文件。
5.  **文件植入**: 攻击者需设法将制作好的恶意`regsvr32.exe`文件放置在受害者将要执行的Notepad++安装程序所在的同一目录下。这可能通过社会工程学、供应链攻击或利用其他初始访问漏洞实现。
6.  **诱导执行**: 攻击者诱导或等待受害者执行Notepad++的安装程序。
7.  **特权提升**: 当Notepad++安装程序启动并尝试调用`regsvr32`时，操作系统会因未引用路径漏洞，优先在安装程序当前工作目录中找到并执行攻击者植入的恶意`regsvr32.exe`。由于安装程序通常以管理员或SYSTEM权限运行，恶意`regsvr32.exe`也将继承这些高权限，执行其内部的Payload，从而实现特权提升。

**投毒风险分析**
本POC代码的投毒风险评估为低，百分比为10%。这主要基于对所提供的C#和C代码片段的详细审查。首先，**代码清晰度与可读性**是评估低风险的关键因素。POC中的C#代码非常简洁，其功能仅限于在指定路径（`C:\Windows\Temp`）下创建一个带有特定文本内容的文本文件。这种直接而无歧义的逻辑极大地降低了隐藏恶意功能的可能性。同样，C语言代码作为Shellcode加载器，其结构和函数调用都符合标准的Shellcode执行模式，没有发现任何复杂或混淆的编码技术，使得安全研究人员能够轻易理解其内部工作原理。其次，在**标准库和第三方工具的使用**方面，POC提及使用`donut`工具将C#代码转换为Shellcode，这是一个开源且被广泛认可的Shellcode生成工具，其本身并非恶意软件，而是用于将各种编程语言（如.NET、VBScript、JScript）编写的程序转换为独立的Shellcode以实现内存执行。在合法的渗透测试和安全研究中，`donut`常被用于规避传统基于文件签名或磁盘行为的检测。POC对其的使用是透明的，且其功能仅限于格式转换，不涉及额外的恶意功能注入。C#和C代码也仅依赖于操作系统提供的标准API和库，如`System.IO`（用于文件操作）以及`VirtualAlloc`、`RtlMoveMemory`、`VirtualProtect`、`CreateThread`、`WaitForSingleObject`（用于内存管理和线程创建），这些都是进行代码执行和内存操作的合法系统调用。第三，**实际恶意行为分析**是判断投毒风险的核心。此POC所演示的“恶意”行为仅限于在目标系统上以SYSTEM权限创建一个文本文件，文件中包含一句声明特权执行的英文提示。这一行为的唯一目的是提供一个可视化证据，证明漏洞已被成功利用并实现了预期的特权提升效果。代码中不包含任何可能导致实际损害的进一步操作，例如：尝试建立C2（命令与控制）通信、下载和执行第二阶段恶意负载、遍历文件系统以窃取敏感数据、修改系统关键配置、创建新的持久化后门账户、或者对文件进行加密以勒索。其目标纯粹是概念验证（Proof of Concept）。最后，**外部依赖与网络行为**方面，POC代码中没有任何迹象表明它会尝试连接外部网络资源，例如下载额外组件、发送数据到远程服务器或与任何C2基础设施进行通信。它是一个完全独立的执行单元，其功能严格限定在本地文件操作和内存执行Shellcode。这进一步降低了其作为投毒载体的风险。综上所述，虽然POC代码展示了强大的特权提升能力，为攻击者提供了执行任意代码的平台，但就POC本身而言，它是一个教学和验证性质的代码，其内部逻辑透明、行为受限、不包含实际的恶意payload，因此将其投毒风险评估为低（10%）是合理的。防御性安全研究人员在使用此类POC进行测试时，仍应在受控的隔离环境中操作，并且如果从非官方或不可信渠道获取，务必对任何POC代码进行彻底的安全审计，以防其在被分发过程中被恶意篡改。这个低风险评估仅针对当前提供的POC代码，不代表漏洞本身的危害程度或其被恶意利用的潜在后果。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
