## CVE-2025-49144 - Notepad++ 权限提升

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 权限提升

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** N/A (NVD Awaiting Analysis), 但由于可获得SYSTEM权限，危害等级较高

**影响版本:** 8.8.1及之前版本

**利用条件:** 需要用户交互（社会工程学或点击劫持），攻击者需诱导用户将恶意文件放置在特定目录并运行合法安装程序。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2025-49144是一个影响Notepad++安装程序（版本8.8.1及更早版本）的严重权限提升漏洞。该漏洞的根本原因在于安装程序在查找`regsvr32`可执行文件时，会首先在其当前工作目录中进行搜索，而没有使用带引号的绝对路径，这使得攻击者可以劫持这一查找过程。这意味着，如果一个恶意可执行文件被命名为`regsvr32.exe`并放置在Notepad++安装程序的同一目录下，当合法安装程序运行时，系统将自动以安装程序的权限（通常为SYSTEM权限）加载并执行恶意文件，从而使攻击者获得目标机器的完全控制权，威胁用户数据和系统的安全。

**POC有效性分析**：
该POC是高度有效且清晰的，它详细展示了漏洞的利用过程。其核心思想是利用Notepad++安装程序在加载`regsvr32`时的不安全搜索路径。POC分两部分实现：
1.  **恶意Payload构建**：首先，POC提供了一个简单的C#程序，其唯一功能是在`C:\Windows\Temp\`目录下创建一个名为`NOTEPAD_VULNERABIL.txt`的文本文件，内容为“Acest fisier demonstreaza executia de cod with privilegii de SYSTEM.”。这个文件作为执行成功的明确标志，证明了代码以SYSTEM权限运行。
2.  **Shellcode封装与执行**：随后，这个C#程序被`donut`工具转换成shellcode，并嵌入到一个C语言程序中。C语言程序负责在内存中分配空间（`VirtualAlloc`），将shellcode复制进去（`RtlMoveMemory`），更改内存保护属性为可执行（`VirtualProtect`），最后在一个新线程中执行该shellcode（`CreateThread`）。这个C程序被编译成名为`regsvr32.exe`的恶意可执行文件。

**利用步骤**：
1.  攻击者获取Notepad++ 8.8.1或更早版本的合法安装程序。
2.  攻击者编译POC提供的C代码，生成恶意`regsvr32.exe`文件。
3.  攻击者通过社会工程学、点击劫持或类似手段，诱导受害者将合法的Notepad++安装程序和恶意的`regsvr32.exe`下载到同一个目录下。
4.  当受害者运行合法的Notepad++安装程序时，该安装程序会在当前目录中找到并执行攻击者提供的恶意`regsvr32.exe`。
5.  恶意`regsvr32.exe`会以SYSTEM权限执行其内部的shellcode，从而在`C:\Windows\Temp\`目录下成功创建`NOTEPAD_VULNERABIL.txt`文件，证明权限提升成功。

**投毒风险分析**：
针对此POC代码本身的投毒风险评估为低（10%）。
该POC代码清晰、无混淆，并且其核心功能（C#部分）仅是创建一个文本文件作为执行成功的证明，不包含任何恶意行为如网络回连、数据窃取、持久化后门或系统破坏等。用于加载shellcode的C语言代码也使用了标准的Windows API函数，逻辑简单透明。代码中没有发现使用外部可疑脚本、二进制数据或任何可能绕过传统安全检测的复杂技术。因此，在进行防御性安全研究和漏洞复现时，此POC代码本身是安全的，不会对分析环境造成额外风险。但是，攻击者可以轻易地将其中演示性Payload替换为真正的恶意Payload（例如，植入远控、窃取凭据或部署勒索软件），从而使利用过程的投毒风险急剧升高。因此，尽管POC本身无害，其利用方法具有极高的攻击潜力。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
