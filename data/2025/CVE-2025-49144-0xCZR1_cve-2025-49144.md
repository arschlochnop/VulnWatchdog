## CVE-2025-49144 - Notepad++ 特权提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2025-49144

**漏洞类型:** 特权提升 (Local Privilege Escalation)

**影响应用:** Notepad++

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** 8.8.1及之前版本

**利用条件:** 需要本地用户交互，在安装或卸载Notepad++ 8.8.1及之前版本时触发

**POC 可用性:** 9

**POC 类型:** 概念验证 (Proof of Concept)

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

本分析文档聚焦于CVE-2025-49144，一个被Tenable®和多个安全研究报告确认为高危的本地特权提升（LPE）漏洞，影响Notepad++ 8.8.1及之前版本。该漏洞被称为“Installer Path Flaw”，其核心在于Notepad++的安装程序（包括卸载程序）在执行过程中寻找`regsvr32`这一系统工具时，未能使用完整的绝对路径或带引号的路径。相反，它会首先在其当前工作目录中查找`regsvr32.exe`。这一行为导致了一个经典的不安全路径查找漏洞。攻击者可以利用此缺陷，在一个包含Notepad++安装程序的目录中放置一个精心制作的恶意`regsvr32.exe`文件。当用户（即使是标准权限用户）执行该安装程序时，恶意`regsvr32.exe`将会在安装程序所拥有的高权限上下文（通常是SYSTEM权限）下被执行。这意味着攻击者可以利用这一机制，在受害者的系统上以最高权限执行任意代码，从而实现对系统的完全控制。Notepad++官方已迅速发布8.8.2版本以修复此漏洞。

**POC有效性分析**:
所提供的POC代码对CVE-2025-49144漏洞的有效性进行了直观且明确的验证。POC的说明详细阐述了漏洞的根源——Notepad++安装程序在查找关键系统工具`regsvr32`时存在不安全的路径解析行为，即优先在当前工作目录中搜索。
POC的实现过程包含三个主要阶段：首先，编写了一个简单的C#程序作为Payload，其功能是向`C:\Windows\Temp`路径写入一个带有特定文本的`NOTEPAD_VULNERABIL.txt`文件，旨在明确证明代码是以SYSTEM权限执行的。随后，这个C# Payload被转换成shellcode。最后，一个C语言编写的shellcode加载器被用于将该shellcode加载到内存并执行。这个C语言程序被编译并命名为`regsvr32.exe`。
当这个恶意`regsvr32.exe`与存在漏洞的Notepad++安装程序（版本8.8.1及更早）放置在同一目录下，并且用户执行安装程序时，安装程序会错误地调用攻击者伪造的`regsvr32.exe`。由于Notepad++安装程序通常以SYSTEM权限运行，攻击者伪造的`regsvr32.exe`及其内部的Payload也将以SYSTEM权限执行。POC中成功创建`NOTEPAD_VULNERABIL.txt`文件并写入内容的现象，完美地证明了攻击者能够利用此漏洞将权限从普通用户提升至SYSTEM，实现任意代码的 SYSTEM 权限执行。整个POC的逻辑严谨，代码结构清晰，是验证此LPE漏洞的强有力证明。

**利用步骤**:
1.  **构造恶意Payload**: 攻击者需要开发一个执行所需恶意操作的程序（例如POC中的文件创建器）。
2.  **生成Shellcode**: 使用工具（如`Donut`）将Payload程序转换为原始shellcode。
3.  **编写Shellcode加载器**: 编写一个C程序，包含加载和执行shellcode的逻辑（如使用`VirtualAlloc`、`RtlMoveMemory`、`VirtualProtect`和`CreateThread`等Windows API）。
4.  **编译为`regsvr32.exe`**: 将上述C程序编译成可执行文件，并将其命名为`regsvr32.exe`。
5.  **目标准备**: 获取受影响版本的Notepad++安装程序（例如8.8.1）。
6.  **文件部署**: 将编译好的恶意`regsvr32.exe`文件放置在与Notepad++安装程序相同的目录下。
7.  **诱导执行**: 诱导或等待本地用户（即使是低权限用户）执行该目录下的Notepad++安装程序。
8.  **触发漏洞**: Notepad++安装程序在启动时查找`regsvr32`，会优先在当前目录找到并执行攻击者部署的恶意`regsvr32.exe`。
9.  **权限提升与Payload执行**: 恶意`regsvr32.exe`将继承安装程序的SYSTEM权限，并执行其内置的shellcode，从而实现SYSTEM权限下的任意代码执行。攻击者可通过检查Payload结果（如创建的文件）来验证攻击成功。

**投毒风险分析**:
针对本次分析的POC代码，其被评估为**低投毒风险（15%）**。此评估主要基于以下几个核心要素：

首先，**代码的透明度和可读性是关键**。POC提供了清晰的`readme.md`文档，详细解释了漏洞原理，并公开了用于验证漏洞的C#和C语言代码片段。C# Payload仅用于在指定路径创建文本文件，其功能简单明了，无任何混淆或隐藏逻辑。C语言的shellcode加载器也采用标准的Windows API调用（如`VirtualAlloc`, `RtlMoveMemory`, `VirtualProtect`, `CreateThread`），这些都是合法的系统编程实践。代码中没有发现任何试图隐藏其意图或执行复杂、可疑操作的迹象，使得安全研究人员能够轻松审计其行为。

其次，**该POC不包含任何外部依赖或网络通信**。其设计是完全自包含的，代码不尝试连接到远程服务器、下载额外的Payload、执行外部脚本或收集并传输敏感信息。所有操作均在本地环境中完成，大大降低了通过POC引入外部恶意组件或数据泄露的风险。

再者，**Payload的性质是纯粹的验证性行为**。POC中包含的shellcode仅用于在`C:\Windows\Temp`创建一个文本文件以证明SYSTEM权限的获取。这个行为本身是非破坏性的，且不具备典型恶意软件的特征（如建立后门、加密数据、持久化、横向移动等）。这种设计旨在提供一个清晰、无害的机制来验证漏洞的存在和影响，而非执行实际的恶意攻击。

综上所述，虽然此POC代码在技术上展示了一个高度危险的权限提升漏洞，但其自身的代码实现、透明度以及Payload的非恶意性质，使其作为安全研究工具时，投毒风险极低。然而，必须强调的是，利用此POC所演示的漏洞，攻击者可以轻易替换其中的Payload，实现任意恶意功能，如部署持久性后门、数据窃取、系统破坏或勒索软件。因此，在处理和执行任何漏洞利用代码时，安全研究人员务必在隔离且受控的环境中进行，并对所有代码（尤其是Payload部分）进行严格的审查，以防范潜在的意外或恶意后果。

**项目地址:** 

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-49144
