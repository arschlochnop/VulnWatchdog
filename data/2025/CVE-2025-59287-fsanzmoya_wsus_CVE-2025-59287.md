## CVE-2025-59287 - Microsoft Windows Server Update Services (WSUS) 远程代码执行 (RCE) / 不安全反序列化

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 远程代码执行 (RCE) / 不安全反序列化

**影响应用:** Microsoft Windows Server Update Services (WSUS)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Windows Server 2025, Windows Server 2022, Windows Server 2019

**利用条件:** 无需认证，远程网络访问

**POC 可用性:** 3/10

**POC 类型:** 仅概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2025-59287是一个针对Microsoft Windows Server Update Services (WSUS) 组件的严重远程代码执行（RCE）漏洞。该漏洞的根本原因在于WSUS服务器端存在不安全的反序列化设计缺陷，尤其是在处理`AuthorizationCookie`时，使用了.NET的`BinaryFormatter`机制。`BinaryFormatter`因其在反序列化过程中缺乏对输入内容的严格验证，极易遭受反序列化攻击，允许攻击者注入恶意对象并触发任意代码执行。

该漏洞的威胁等级被评定为高危，CVSS评分高达9.8（满分10分），这表明其具有极高的潜在危害。未经身份验证的远程攻击者可以利用此漏洞，通过向WSUS服务器发送特制（crafted）的SOAP事件，触发不安全的对象反序列化过程。一旦攻击成功，攻击者将能够在目标WSUS服务器上以WSUS服务账户的权限执行任意代码，从而完全控制受影响的服务器。受影响的Windows Server版本包括Windows Server 2025、Windows Server 2022和Windows Server 2019。

**POC有效性分析：**
提供的Python脚本`check_vuln_wsus`旨在作为CVE-2025-59287漏洞的“WSUS Vulnerability Checker”。该脚本主要执行了以下操作：
1.  **服务可达性检查**：脚本首先尝试通过HTTP GET请求连接到目标WSUS服务器的`ClientWebService/Client.asmx`端点。如果收到200状态码，则确认WSUS服务在该端口上可达，这是后续漏洞利用的前提。
2.  **SOAP请求结构展示**：脚本随后构建了一个SOAP信封，其中包含一个针对`GetCookie`方法的请求。这个请求的关键部分在于`<AuthorizationCookie><Cookie>TEST_PAYLOAD</Cookie></AuthorizationCookie>`。`TEST_PAYLOAD`明确指示此处应插入一个恶意序列化负载。

然而，该脚本的当前实现**并未**包含实际的恶意反序列化负载，也**未**发送构建好的POST请求。它仅停留在构建SOAP请求模板的阶段。这意味着，该脚本本身并不能直接触发RCE或验证目标服务器是否真正存在反序列化漏洞（beyond service accessibility）。它更多地是一个**概念验证**工具，用于：
*   确认WSUS服务的存在和可访问性。
*   展示用于利用该漏洞的SOAP请求的基本结构。

因此，从RCE利用的角度来看，该POC的质量较低（3/10）。它为攻击者提供了利用的框架和目标信息，但需要攻击者手动生成并插入恶意的.NET反序列化payload，并实现发送POST请求的逻辑，才能实现完整的RCE利用。对于防御者而言，它可以用于识别暴露的WSUS服务实例，但无法模拟完整的攻击。

**利用步骤：**
1.  **目标识别**：攻击者首先需要通过网络扫描等方式识别出运行WSUS服务的Windows Server实例，通常监听在HTTP 8530端口或HTTPS 8531端口。
2.  **服务验证**：确认WSUS的`ClientWebService`端点（例如`http://[target]:8530/ClientWebService/Client.asmx`）是否可访问且正常响应。
3.  **生成恶意Payload**：利用如YsoSerial.net之类的工具，根据目标环境和期望的攻击效果，生成一个恶意的.NET序列化对象（gadget chain），该对象在反序列化时能执行攻击者指定的命令或代码。
4.  **构造恶意SOAP请求**：将生成的恶意序列化Payload嵌入到针对`GetCookie`方法的SOAP请求中的`<AuthorizationCookie><Cookie>`标签内。
5.  **发送攻击请求**：通过HTTP POST请求将构造好的恶意SOAP信封发送到目标WSUS服务器的`ClientWebService/Client.asmx`端点。
6.  **代码执行**：WSUS服务器在处理并尝试反序列化恶意`AuthorizationCookie`时，将执行攻击者嵌入的Payload，从而在目标服务器上实现远程代码执行。

**投毒风险分析：**
该POC代码（`/tmp/vulnwatchdog_1ff305eda7cb43a69483ddcbe4ce98c0/check_vuln_wsus`）的投毒风险极低，评估为10%。分析如下：
*   **代码透明度与可读性**：脚本是用Python编写的，代码结构清晰，易于阅读和理解。没有使用任何形式的代码混淆或加密技术，使得潜在的恶意行为难以隐藏。
*   **依赖库**：脚本仅使用了Python标准库中的`requests`和`sys`模块。`requests`库是HTTP通信的标准库，`sys`用于系统交互。禁用`InsecureRequestWarning`是进行自签名证书测试或开发时常见的操作，本身不代表恶意。
*   **行为分析**：脚本的主要功能是：打印信息、尝试进行HTTP GET请求以检查WSUS服务可达性，并构建一个包含`TEST_PAYLOAD`占位符的SOAP请求字符串。最关键的是，**该脚本在提供的代码片段中并未实际发送任何POST请求，也未包含任何真实的恶意Payload**。它仅展示了请求的结构，并明确指示`TEST_PAYLOAD`是待替换的部分。
*   **无外部资源加载**：脚本没有尝试从外部URL下载、执行任何代码或文件，也没有进行任何可疑的网络通信（除了对目标WSUS服务的请求）。
*   **无系统修改**：脚本不包含任何修改本地文件系统、注册表、创建后门账户或执行其他恶意系统操作的代码。
*   **结论**：该脚本是一个纯粹的检测工具和概念性演示，旨在帮助安全研究人员或管理员验证WSUS服务的可访问性和理解漏洞的触发机制。它不包含任何恶意功能，不会对执行它的系统造成危害，因此投毒风险极低。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-59287
