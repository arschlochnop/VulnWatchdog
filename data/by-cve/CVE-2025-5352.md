## CVE-2025-5352 - lunary-ai/lunary XSS

**漏洞编号:** CVE-2025-5352

**漏洞类型:** XSS

**影响应用:** lunary-ai/lunary

**危害等级:** 高危，允许攻击者在所有用户的浏览器中执行任意JavaScript代码。

**CVSS评分:** 待定，根据XSS的通常评分，预计较高

**影响版本:** 受影响版本未知，但漏洞存在于Analytics组件中，涉及NEXT_PUBLIC_CUSTOM_SCRIPT变量。

**利用条件:** 需要攻击者能够控制部署期间的NEXT_PUBLIC_CUSTOM_SCRIPT变量，或通过服务器入侵来修改此变量。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 60%

## 详情

此漏洞位于lunary-ai/lunary的Analytics组件中。当NEXT_PUBLIC_CUSTOM_SCRIPT变量在没有进行适当清理的情况下，使用`dangerouslySetInnerHTML`注入到DOM中时，会产生存储型XSS漏洞。攻击者可以通过控制此变量（在部署期间或通过服务器入侵）在所有用户的浏览器中执行任意JavaScript代码。

POC有效性分析：
POC代码显示了存储型XSS漏洞的存在，该漏洞允许攻击者将恶意JavaScript代码注入到网页中。`dangerouslySetInnerHTML`的使用表明存在注入漏洞的潜在风险。攻击者可以利用此漏洞来执行各种恶意操作，例如窃取用户凭据，重定向用户到恶意网站或更改网站的内容。lunary-ai/lunary的Analytics组件没有对输入进行充分的过滤和转义，导致NEXT_PUBLIC_CUSTOM_SCRIPT直接插入DOM中，从而触发XSS漏洞。经验证，通过控制NEXT_PUBLIC_CUSTOM_SCRIPT变量，可以在受害者浏览器上执行任意JavaScript代码。此漏洞可能导致会话劫持、数据泄露、恶意软件传播等严重后果。

利用步骤：
1. 确定lunary-ai/lunary安装中使用的NEXT_PUBLIC_CUSTOM_SCRIPT变量。
2. 如果攻击者可以在部署期间控制此变量，则可以直接将恶意JavaScript代码注入其中。
3. 另一种方法是通过服务器入侵，攻击者可以修改服务器上的NEXT_PUBLIC_CUSTOM_SCRIPT变量。
4. 当用户访问包含Analytics组件的网页时，恶意JavaScript代码将在用户的浏览器中执行。
5. 攻击者可以利用此漏洞来执行各种恶意操作，例如窃取用户凭据，重定向用户到恶意网站或更改网站的内容。

投毒风险分析：
由于XSS漏洞允许执行任意JavaScript代码，因此存在相当高的投毒风险。 攻击者可能会尝试注入混淆的代码，以逃避检测。注入的代码可能包含对外部资源的引用，这些资源可能会被修改为恶意代码。考虑到`dangerouslySetInnerHTML`的性质以及潜在的控制点，投毒风险评估为中等。

具体来说，以下是一些潜在的投毒场景：
1. 攻击者可能会注入经过模糊处理的JavaScript代码，这些代码在执行时会下载并执行其他恶意脚本。
2. 攻击者可能会注入看似无害的代码，这些代码会在特定条件下触发恶意行为。
3. 攻击者可能会利用此漏洞来传播恶意软件，例如勒索软件或键盘记录器。
4. 攻击者可能会尝试利用此漏洞来执行跨站点请求伪造（CSRF）攻击。

由于此漏洞允许攻击者在用户的浏览器中执行任意JavaScript代码，因此组织应立即采取措施来修复此漏洞。这可能包括实施更严格的输入验证和转义策略，以及定期审查和更新其安全措施。

综合考虑，此漏洞的投毒风险较高，需要进行缓解。

**项目地址:** https://huntr.com/bounties/f1d3dbce-3c3e-480e-b81e-0e8afa05c491

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2025-5352
