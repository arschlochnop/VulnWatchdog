## CVE-2024-41997 - Warp Terminal (macOS) 命令注入/远程代码执行(RCE)

**漏洞编号:** CVE-2024-41997

**漏洞类型:** 命令注入/远程代码执行(RCE)

**影响应用:** Warp Terminal (macOS)

**危害等级:** 高危

**CVSS评分:** 尚未在NVD发布最终得分，但根据RCE特性评估约为 8.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)

**影响版本:** < v0.2024.07.16.08.02

**利用条件:** 无需认证；需要用户交互（点击恶意链接）；Warp 终端正在运行

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】：此POC代码非常完整且具有极高的实战验证价值。该漏洞源于Warp终端在处理自定义URI Scheme（warp://）时的不安全实现。具体而言，Warp的Docker集成功能注册了一个协议处理器，其中的 `/docker/open_subshell` 端点未能对 `shell` 参数进行充分的转义或过滤。POC通过构建一个包含Shell元字符（如反引号 `` ` ``）的恶意URL，成功将注入指令嵌入到系统执行流中。分析 `pwn.html` 可知，该Payload使用了 `echo ' `id>/tmp/hax&&killall stable` '`。这种构造方式巧妙地绕过了简单的字符串拼接限制，通过反引号强制执行系统命令 `id` 并将输出重定向至临时文件，随后调用 `killall` 结束进程以掩盖攻击痕迹。经过静态代码审计，该POC逻辑清晰，直接利用了macOS系统对URL Scheme的自动分发机制，攻击路径极短且稳定，是一份极高质量的防御研究样本。利用步骤如下：1. 启动版本低于v0.2024.07.16.08.02的Warp终端。2. 攻击者构造包含恶意注入脚本的HTML文件并诱导受害者访问。3. 受害者点击 `warp://` 链接，浏览器触发系统级协议调用。4. Warp接收请求并尝试打开Docker子Shell，无意中执行了注入的恶意命令。5. 攻击者在 `/tmp/hax` 获取权限执行结果，受害者终端闪退，攻击完成。 【投毒风险分析】：该POC代码本身的投毒风险较低，主要体现为防御性研究目的。分析提供的 `pwn.html` 代码，其执行的行为（写入/tmp/hax以及关闭终端进程）是典型的“无害化证明”，旨在向安全研究员展示漏洞的存在及其造成的后果，而非窃取隐私数据或建立持久化后门。代码采用明文编写，没有任何混淆、Base64编码或动态下发Payload的逻辑，符合白帽子安全社区的分享惯例。虽然Payload中包含了 `killall stable` 这种具有一定破坏性（会导致用户未保存的工作丢失）的指令，但这是为了演示攻击者如何通过技术手段实施反溯源，而非恶意损毁系统。项目结构简单，不包含第三方二进制库、外部可执行文件引用或隐藏脚本。对于威胁情报团队而言，此类代码可以安全地在隔离沙箱环境中进行复现测试。然而，需要注意其作为‘投毒载体’的潜在可能：如果该POC被分发在非官方渠道，攻击者可能会修改 `shell` 参数中的Payload，将其替换为下载并执行远程木马的指令。由于该漏洞利用门槛极低且具备1-click触发特性，组织在分发此类研究资料时应确保代码完整性，防止内部人员误触恶意修改后的链接。

**项目地址:** [https://gist.github.com/bhyh/d1ee7a825fce283bf8acbdb42c8a7832](https://gist.github.com/bhyh/d1ee7a825fce283bf8acbdb42c8a7832)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-41997](https://nvd.nist.gov/vuln/detail/CVE-2024-41997)
