# CVE-2021-21980

> ğŸ“¦ è¯¥CVEæœ‰ **5** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21980-Osyanina_westone-CVE-2021-21980-scanner.md](../2021/CVE-2021-21980-Osyanina_westone-CVE-2021-21980-scanner.md)

## CVE-2021-21980-VMware vCenter Server Arbitrary File Read

**æ¼æ´ç¼–å·:** CVE-2021-21980

**æ¼æ´ç±»å‹:** Arbitrary File Read

**å½±å“åº”ç”¨:** VMware vCenter Server and VMware Cloud Foundation

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²

**å½±å“ç‰ˆæœ¬:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´æ˜¯vSphere Web Client (FLEX/Flash)ä¸­çš„æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£ï¼Œå³å¯è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚æä¾›çš„POCä»£ç ä»“åº“`westone-CVE-2021-21980-scanner`åŒ…å«ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶`CVE-2021-21980.exe`ï¼Œå¯èƒ½ç”¨äºæ‰«æç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚ç”±äºç¼ºå°‘å®é™…æ¼æ´åˆ©ç”¨çš„payloadç»†èŠ‚ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚å› ä¸ºä»…ä»…æä¾›äº†ä¸€ä¸ªexeæ–‡ä»¶ï¼Œç¼ºå°‘æºä»£ç çš„å®¡æ ¸ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½å­˜åœ¨å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œè¯¥ä»“åº“ä¸­æœªä½“ç°XSSå’ŒSSRFæ¼æ´ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [Osyanina/westone-CVE-2021-21980-scanner](https://github.com/Osyanina/westone-CVE-2021-21980-scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)

---

## POC #2

**æ¥æº**: [CVE-2021-21980-gui2000guix-ui_cve-2021-21980-mock-server.md](../2021/CVE-2021-21980-gui2000guix-ui_cve-2021-21980-mock-server.md)

## CVE-2021-21980-VMware vCenter Server-ä»»æ„æ–‡ä»¶è¯»å–

**æ¼æ´ç¼–å·:** CVE-2021-21980

**æ¼æ´ç±»å‹:** ä»»æ„æ–‡ä»¶è¯»å–

**å½±å“åº”ç”¨:** VMware vCenter Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²

**å½±å“ç‰ˆæœ¬:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-21980å­˜åœ¨äºvSphere Web Client (FLEX/Flash)ä¸­ï¼Œæ˜¯ä¸€ä¸ªæœªç»æˆæƒçš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£ï¼Œåˆ©ç”¨æ­¤æ¼æ´è¯»å–æ•æ„Ÿä¿¡æ¯ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚Dockerfileæ„å»ºäº†ä¸€ä¸ªæ¨¡æ‹ŸvCenter Serverç¯å¢ƒçš„Flaskåº”ç”¨ï¼Œè¯¥åº”ç”¨å­˜åœ¨/eam/vibç«¯ç‚¹ï¼Œé€šè¿‡æ„é€ åŒ…å«`../`å’Œ`/etc/passwd`æˆ–`passwd`çš„`id`å‚æ•°ï¼Œå¯ä»¥å®ç°ç›®å½•ç©¿è¶Šï¼Œè¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ`curl -k "https://localhost:8443/eam/vib?id=../../../../../../../../../../etc/passwd"`å¯ä»¥è¯»å–æ¨¡æ‹Ÿçš„`/app/sensitive/passwd-mock`æ–‡ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥ä»“åº“ä»£ç çš„æŠ•æ¯’é£é™©ä¸º0%ã€‚åŸå› æ˜¯è¯¥ä»“åº“æä¾›çš„æ˜¯ä¸€ä¸ªæ¼æ´éªŒè¯å’Œæµ‹è¯•ç¯å¢ƒï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å®‰å…¨åœ°è¿›è¡Œæ¼æ´æ£€æµ‹å’Œç ”ç©¶ï¼Œè€Œä¸æ˜¯ç”¨äºæ¶æ„æ”»å‡»ã€‚è™½ç„¶è¯¥ç¯å¢ƒä¸­æ¨¡æ‹Ÿäº†æ¼æ´ï¼Œä½†æ²¡æœ‰å‘ç°ä»»ä½•éšè—çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚æ‰€æœ‰ä»£ç éƒ½ä¸æ¼æ´çš„æ¼”ç¤ºå’Œæ£€æµ‹ç›¸å…³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡vCenter Serverçš„443ç«¯å£ã€‚
2.  æ”»å‡»è€…æ„é€ æ¶æ„çš„URLï¼Œä¾‹å¦‚ `/eam/vib?id=../../../../../../../../../../etc/passwd`ï¼Œå…¶ä¸­`id`å‚æ•°åŒ…å«ç›®å½•ç©¿è¶Šçš„payloadã€‚
3.  vCenter Serverçš„Web Clientåœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œæ²¡æœ‰å……åˆ†éªŒè¯`id`å‚æ•°ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è¯»å–æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ã€å¯†ç æ–‡ä»¶ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [gui2000guix-ui/cve-2021-21980-mock-server](https://github.com/gui2000guix-ui/cve-2021-21980-mock-server)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)

---

## POC #3

**æ¥æº**: [CVE-2021-21980-gui2000guix-ui_cve-2021-21980-nuclei-poc.md](../2021/CVE-2021-21980-gui2000guix-ui_cve-2021-21980-nuclei-poc.md)

## CVE-2021-21980-VMware vCenter Server æ–‡ä»¶è¯»å–

**æ¼æ´ç¼–å·:** CVE-2021-21980

**æ¼æ´ç±»å‹:** ä»»æ„æ–‡ä»¶è¯»å–

**å½±å“åº”ç”¨:** VMware vCenter Server and VMware Cloud Foundation

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²

**å½±å“ç‰ˆæœ¬:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£

**POC å¯ç”¨æ€§:** å¦

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-21980 æ˜¯ä¸€ä¸ª VMware vCenter Server ä¸­çš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—® vCenter Server çš„ 443 ç«¯å£ï¼Œåˆ©ç”¨è¯¥æ¼æ´è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ã€å¯†ç ç­‰ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«MITåè®®çš„LICENSEæ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­POCæ˜¯å¦æœ‰æ•ˆã€‚LICENSEæ–‡ä»¶æœ¬èº«ä¸å…·å¤‡æ‰§è¡Œèƒ½åŠ›ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º0%ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¯·æ±‚è¯»å–ç›®æ ‡æ–‡ä»¶ã€‚ç”±äºç¼ºå°‘EXPä»¥åŠç›¸å…³æ¼æ´ä¿¡æ¯ï¼Œæ— æ³•å®Œå…¨åˆ†æåˆ©ç”¨æ–¹å¼ï¼Œä½†å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [gui2000guix-ui/cve-2021-21980-nuclei-poc](https://github.com/gui2000guix-ui/cve-2021-21980-nuclei-poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)

---

## POC #4

**æ¥æº**: [CVE-2021-21980-pkxk5pr6m2-web_cve-2021-21980-nuclei-poc.md](../2021/CVE-2021-21980-pkxk5pr6m2-web_cve-2021-21980-nuclei-poc.md)

## CVE-2021-21980-VMware vCenter Server ä»»æ„æ–‡ä»¶è¯»å–

**æ¼æ´ç¼–å·:** CVE-2021-21980

**æ¼æ´ç±»å‹:** ä»»æ„æ–‡ä»¶è¯»å–

**å½±å“åº”ç”¨:** VMware vCenter Server and VMware Cloud Foundation

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²

**å½±å“ç‰ˆæœ¬:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®vCenter Server 443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-21980æ˜¯ä¸€ä¸ªå­˜åœ¨äºVMware vCenter Serverå’ŒVMware Cloud Foundationä¸­çš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£ï¼Œå¯ä»¥åˆ©ç”¨vSphere Web Client (FLEX/Flash) ä¸­çš„æ¼æ´è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´å­˜åœ¨äºç‰¹å®šç‰ˆæœ¬çš„VMware vCenter Serverå’ŒVMware Cloud Foundationï¼Œå¹¶ä¸”æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯è¢«åˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªæ˜¯ä¸€ä¸ªMITåè®®çš„LICENSEæ–‡ä»¶ï¼Œå†…å®¹ä»…å£°æ˜ç‰ˆæƒå’Œä½¿ç”¨è®¸å¯ï¼Œä¸åŒ…å«ä»»ä½•æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©æä½ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£ã€‚åˆ©ç”¨vSphere Web Clientï¼ˆFLEX/Flashï¼‰ç»„ä»¶ä¸­å­˜åœ¨çš„æ¼æ´ï¼Œæ„é€ ç‰¹å®šçš„è¯·æ±‚æ¥è¯»å–ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [pkxk5pr6m2-web/cve-2021-21980-nuclei-poc](https://github.com/pkxk5pr6m2-web/cve-2021-21980-nuclei-poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)

---

## POC #5

**æ¥æº**: [CVE-2021-21980-pratikjojode_vcenter-cve-2021-21980-lab.md](../2021/CVE-2021-21980-pratikjojode_vcenter-cve-2021-21980-lab.md)

## CVE-2021-21980 - VMware vCenter Server Web Client ä»»æ„æ–‡ä»¶è¯»å–

**æ¼æ´ç¼–å·:** CVE-2021-21980

**æ¼æ´ç±»å‹:** ä»»æ„æ–‡ä»¶è¯»å–

**å½±å“åº”ç”¨:** VMware vCenter Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²

**å½±å“ç‰ˆæœ¬:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®vCenter Serverçš„443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äº VMware vCenter Server çš„ vSphere Web Client (FLEX/Flash) ç»„ä»¶ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡å‘ `/ui/vic-rest/services/containerView` ç«¯ç‚¹å‘é€åŒ…å«è·¯å¾„éå†åºåˆ—çš„è¯·æ±‚ï¼Œè¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ Nuclei æ¨¡æ¿ `CVE-2021-21980.yaml` ç»éªŒè¯æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€åŒ…å«è·¯å¾„éå†çš„ GET è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ `/ui/vic-rest/services/containerView` ç«¯ç‚¹æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ éªŒè¯é€šè¿‡æ£€æŸ¥å“åº”ä½“ä¸­æ˜¯å¦å­˜åœ¨ "root:x:0:0:" ä»¥åŠçŠ¶æ€ç æ˜¯å¦ä¸º200ï¼Œheaderä¸­æ˜¯å¦å­˜åœ¨VMwareã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„æ–‡ä»¶ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚
*   `Dockerfile` ç”¨äºæ„å»ºä¸€ä¸ªåŒ…å«è„†å¼± Flask åº”ç”¨çš„ Docker é•œåƒï¼Œè¯¥ Flask åº”ç”¨æ¨¡æ‹Ÿäº† VMware vCenter Server å­˜åœ¨æ¼æ´çš„ç«¯ç‚¹ã€‚
*   `server.py` æ˜¯ä¸€ä¸ª Flask åº”ç”¨ï¼Œå®ƒæ¥æ”¶æ¥è‡ª `/ui/vic-rest/services/containerView` ç«¯ç‚¹çš„è¯·æ±‚ï¼Œå¹¶å°è¯•è¯»å–ç”± `id` å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ã€‚å­˜åœ¨è·¯å¾„éå†æ¼æ´ã€‚
*   `CVE-2021-21980.yaml` æ˜¯ Nuclei æ¨¡æ¿ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ£€æµ‹å’Œåˆ©ç”¨æ­¤æ¼æ´ã€‚
*   `README.md` åŒ…å«æœ‰å…³å¦‚ä½•æ„å»ºã€è¿è¡Œå’Œæµ‹è¯•æ­¤è„†å¼±ç¯å¢ƒçš„è¯´æ˜ã€‚
*   `docker-compose.yml` æ–‡ä»¶ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºï¼Œç®€åŒ–äº†ç¯å¢ƒçš„éƒ¨ç½²ã€‚
*   `nuclei-validation-output.txt` æ–‡ä»¶è®°å½•äº†ä½¿ç”¨ Nuclei éªŒè¯è¯¥æ¼æ´çš„è¾“å‡ºï¼Œè¯æ˜äº†æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«è·¯å¾„éå†åºåˆ—çš„ URLï¼Œä¾‹å¦‚ï¼š`https://<vcenter_server>/ui/vic-rest/services/containerView?id=../../../etc/passwd`ã€‚
2.  æ”»å‡»è€…å‘ vCenter Server çš„ 443 ç«¯å£å‘é€è¯¥ URL çš„ GET è¯·æ±‚ã€‚
3.  vCenter Server ä¸Šçš„ vSphere Web Client æ¥æ”¶åˆ°è¯·æ±‚ï¼Œç”±äºå¯¹ `id` å‚æ•°çš„éªŒè¯ä¸è¶³ï¼Œå…è®¸æ”»å‡»è€…è¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–ä»»æ„æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…ä»å“åº”ä¸­è·å–æ–‡ä»¶å†…å®¹ã€‚

**é¡¹ç›®åœ°å€:** [pratikjojode/vcenter-cve-2021-21980-lab](https://github.com/pratikjojode/vcenter-cve-2021-21980-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)

---

