## CVE-2026-0770 - Langflow 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-0770

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Langflow

**危害等级:** 关键 (Critical)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Langflow 最新版本 (截止2026年2月7日)

**利用条件:** 无需认证 (在默认配置AUTO_LOGIN=true时可绕过认证), 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

Langflow应用在其`src/lfx/src/lfx/custom/validate.py`文件中的`validate_code()`函数中存在一个严重的远程代码执行（RCE）漏洞。此漏洞的核心在于，该函数未经任何沙箱处理，直接使用Python的`exec()`语句执行用户提交的Python代码，从而允许攻击者在承载Langflow的服务器上执行任意系统命令。该漏洞影响截至2026年2月7日的Langflow所有最新版本。除了`validate_code()`函数，该文件中的`eval_function()`、`execute_function()`、`create_function()`以及`create_class()`等多个函数也因类似地不安全使用`exec()`而存在相同的代码执行风险。这些函数通常用于处理自定义组件或流定义中的动态代码，为攻击者提供了广泛的利用途径。此外，当`AUTO_LOGIN=true`（Langflow的默认配置）时，即使部分端点要求认证，攻击者也能绕过认证进行利用，极大降低了攻击门槛。

**POC有效性分析：**
提供的POC以详细的`README.md`文档形式呈现，其内容对漏洞的原理、受影响版本、多个利用端点以及具体的利用技术进行了详尽的阐述。文档明确指出了`exec()`函数在缺乏适当安全沙箱的情况下执行用户控制代码的固有危险性。POC不仅提供了关键的易受攻击代码片段，还创新性地解释了“生成器抛出技巧”（Generator Throw Trick）这一高级利用技术，以实现在命令执行后巧妙地回显输出。这种技巧通过利用Python在函数定义时评估默认参数表达式的特性，并在需要回显时通过引发包含输出的异常来规避了只能执行函数定义的限制。这份POC文档的质量非常高，它包含了足够的关键技术细节、背景知识和攻击逻辑，使得有经验的安全研究人员能够根据其描述，无需过多修改即可轻松构建一个功能完备且有效的漏洞利用脚本。其完整性和清晰度使得该漏洞在实际测试环境中具有高度的可复现性，是评估Langflow安全性的重要参考。

**利用步骤：**
1.  **目标识别与访问：** 识别并定位运行Langflow应用程序的服务器实例。确认目标实例是否启用了`AUTO_LOGIN=true`配置（默认情况），这将允许攻击者无需认证即可访问相关API端点。若未启用，则需获取有效的用户凭据。
2.  **选择攻击端点：** 在无需认证的场景下，攻击者可优先选择利用`/api/v1/webhook/{flow_id}`或`/api/v1/build_public_tmp/{flow_id}/flow`等公共流执行端点。若需认证或偏好直接验证代码，`/api/v1/validate/code`也是一个直接且有效的利用点。
3.  **构造恶意Payload：** 基于“生成器抛出技巧”，精心构造一个Python代码片段作为恶意Payload。例如，定义一个包含默认参数的函数，在该参数表达式中执行`os.system('id')`或`subprocess.check_output('whoami', shell=True)`等系统命令，并将命令执行的结果捕获。随后，通过`raise Exception(output)`语句将捕获到的输出封装在一个异常中，以便通过HTTP响应回显。
4.  **发送HTTP请求：** 将构造好的恶意Payload以JSON格式嵌入到HTTP POST请求体中，并发送至预选的Langflow API端点。确保请求头（如`Content-Type`）设置正确。
5.  **解析响应获取结果：** 拦截并分析API的HTTP响应。攻击者需要从响应中解析出异常信息，从中提取之前封装的命令执行结果。这将直接提供目标服务器上的敏感信息，如用户ID、当前工作目录等。
6.  **后续攻击扩展：** 一旦实现初始的远程代码执行并获取回显，攻击者可进一步利用该能力，上传Webshell、建立反向Shell、执行持久化后门、读取敏感文件、修改配置或进行内网渗透等高级攻击活动。

**投毒风险分析：**
本次分析的输入是一份以`README.md`形式呈现的POC文档，其核心内容是对Langflow应用程序中远程代码执行漏洞的详细技术描述和利用方法的阐述。此文档的性质是纯文本报告，旨在帮助安全研究人员理解漏洞原理、复现攻击步骤并评估其影响。它并非一个可直接执行的恶意脚本、二进制文件或包含任何混淆代码。文档中没有任何迹象表明其包含恶意外部链接、自执行的恶意载荷或其他旨在感染或损害阅读者本地系统的潜在恶意行为。因此，从防御性安全研究的视角来看，分析这份POC文档本身不携带任何“投毒”风险。其风险评级为0%，这明确表示在对文档进行分析的过程中，研究人员的本地环境不会因POC内容而引入任何恶意软件或安全隐患。需要明确的是，虽然文档描述了如何构造和执行恶意代码以攻击目标系统，但这些恶意代码是针对目标Langflow应用而非分析此POC的本地环境。研究人员在根据此文档自行编写并运行任何利用脚本时，仍需谨慎并进行充分的安全审查，但这属于利用阶段的风险管理，与POC文档本身的“投毒风险”是两个不同的概念。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-0770
