## CVE-2025-3464 - ASUS Armoury Crate / AsIO3.sys Race Condition / TOCTOU

**漏洞编号:** CVE-2025-3464

**漏洞类型:** Race Condition / TOCTOU

**影响应用:** ASUS Armoury Crate / AsIO3.sys

**危害等级:** High

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** ASUS Armoury Crate (含 AsIO3.sys 驱动组件) 特定版本

**利用条件:** 本地普通用户访问权限，受影响系统安装有 ASUS Armoury Crate 及其驱动组件

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 高

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对CVE-2025-3464漏洞表现出极高的技术针对性。漏洞核心在于Armoury Crate软件中AsIO3.sys驱动程序的Race Condition（竞态条件）漏洞，具体为Time-of-check Time-of-use (TOCTOU)类型。代码通过建立指向受信任路径（C:\Program Files (x86)\ASUS\AsusCertService\AsusCertService.exe）的硬链接来绕过驱动的安全检查。在POC中，研究者利用了AsIO3.sys提供的减量原语（Decrement Primitive），这是一种典型的内核利用技巧。通过精准泄露内核对象地址（利用NtQuerySystemInformation和SystemHandleInformationEx），POC能够定位当前线程的KTHREAD结构，并通过减量操作将PreviousMode字段从1（UserMode）修改为0（KernelMode）。一旦PreviousMode被修改，当前进程即可通过NtReadVirtualMemory和NtWriteVirtualMemory直接读写内核空间。POC进一步实现了令牌窃取（Token Stealing），通过遍历EPROCESS链表定位System进程的Token并替换当前进程Token，最终获取NT AUTHORITY\SYSTEM权限。代码结构严谨，包含了必要的偏移量定义、内核函数动态加载以及详细的同步逻辑（如使用命名事件AsIO3_TOCTOU_Sync），证明该漏洞在本地环境下具有极高的可利用性和危害性。利用步骤：1. 环境准备：编译AsIO3_FullExploit.c，确保系统安装有目标驱动。2. 路径模拟：创建特定的硬链接目录结构以匹配驱动程序的路径白名单检查。3. 内核泄露：调用系统API获取当前进程和System进程的内核对象地址及句柄信息。4. 竞态触发：启动多线程同步机制，在驱动程序检查文件路径与实际执行IOCTL操作的微小时间窗口内切换硬链接指向。5. 模式篡改：利用驱动的减量缺陷修改KTHREAD.PreviousMode。6. 权限提权：在内核模式权限下，定位System进程Token并覆盖当前进程Token。7. 结果验证：启动具有System权限的新Cmd窗口。投毒风险分析：该POC代码的投毒风险评估为15%，属于低风险范畴。首先，代码采用标准C语言编写，未进行任何形式的混淆或加密处理，所有系统调用和逻辑流程均对研究人员透明。其次，代码中引用的头文件和库（如windows.h, ntdll, shlwapi）均为Windows开发标准库，未发现引入第三方可疑DLL或远程下载恶意Payload的行为。代码的攻击逻辑完全聚焦于权限提升，没有发现典型的恶意后门特征，如反弹Shell到非特定IP、窃取用户凭据或加密本地文件。唯一需要关注的点是其使用了低级的内核操作，这类代码在未经修改的情况下，如果不慎在生产环境下运行可能导致系统蓝屏（BSOD），但这是利用内核漏洞的固有风险，而非主观的恶意投毒行为。此外，POC项目地址指向的是合法的安全研究路径，代码注释清晰地说明了其用途和编译方式，符合安全社区披露漏洞的规范。建议防御人员在隔离的虚拟机环境中进行测试，并重点关注系统中AsIO3.sys驱动的加载情况及异常的硬链接创建行为。

**项目地址:** /tmp/vulnwatchdog_45da341562dd6d56ea05dbb8321a6ea2/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2025-3464](https://nvd.nist.gov/vuln/detail/CVE-2025-3464)
