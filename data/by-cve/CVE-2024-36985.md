## CVE-2024-36985 - Splunk Enterprise 远程代码执行 (RCE)

**漏洞编号:** CVE-2024-36985

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Splunk Enterprise

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Splunk Enterprise 9.2.x 之前的版本，9.1.x 之前的版本，9.0.x 之前的版本

**利用条件:** 需要具有运行自定义搜索命令权限的经过身份验证的用户帐户。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于 Splunk Enterprise 的 'copybuckets' 自定义搜索命令中，主要由于对该命令参数的输入验证不足。攻击者可以通过构造特殊的 JSON 格式 payload，利用 Splunk 架构中 Java 二进制文件的执行逻辑实现命令注入。提供的 POC 代码逻辑清晰，采用了标准化的漏洞利用流程：首先通过身份验证获取 sessionKey，然后构造包含恶意 shell 命令的 JSON 对象。Payload 使用了 base64 编码来绕过简单的字符过滤，并通过 busybox nc 尝试建立反弹 shell。利用步骤如下：1. 攻击者获取具有基本权限的 Splunk 凭据。2. 使用 POC 中的脚本连接到目标管理端口（默认 8089）。3. 脚本发送认证请求并截取返回的 sessionKey。4. 构造包含 providers 和 vixes 结构的恶意 JSON，其中 command.arg.2 包含反向 Shell 逻辑。5. 通过调用带有该 payload 的自定义搜索命令触发后端 Java 执行，从而在 Splunk 服务器上以运行服务的用户权限执行任意系统命令。此漏洞危害极大，因为 Splunk 通常运行在拥有高级权限的服务器上，且能够访问大量企业敏感日志。投毒风险分析：该 POC 代码编写规范，主要依赖 Python 的 requests, base64, json 等标准库或常用库，未发现明显的代码混淆或恶意二进制混淆。通过静态分析，脚本的主要功能是自动化执行漏洞利用流，没有发现扫描本地文件、窃取当前机器环境变量或向第三方 C2 地址发送敏感信息的后门行为。Payload 中虽然包含了反弹 Shell 代码（busybox nc），但这属于典型的安全研究验证行为，而非针对研究者本人的投毒攻击。然而，脚本中存在 urllib3.disable_warnings() 调用，这虽然是处理自签名证书的常规手段，但可能被某些安全工具标记为风险。总体而言，该代码作为防御性研究工具是安全的，投毒风险较低，但在执行前应始终在隔离沙箱环境中确认 payload 的目的 IP 和端口（LHOST/LPORT），以防被第三方恶意修改后分发。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-36985-Exploit](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-36985-Exploit)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-36985](https://nvd.nist.gov/vuln/detail/CVE-2024-36985)
