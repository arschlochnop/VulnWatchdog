## CVE-2024-36985 - Splunk Enterprise RCE (远程代码执行)

**漏洞编号:** CVE-2024-36985

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Splunk Enterprise

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Splunk Enterprise < 9.2.2, < 9.1.5, < 9.0.10

**利用条件:** 需要低权限用户认证，可访问管理端口(默认8089)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对Splunk Enterprise中的CVE-2024-36985漏洞进行了高度自动化的实现。其核心原理是利用Splunk内置应用‘splunk_archiver’中的‘copybuckets.py’脚本对外部查找（external lookup）处理不当的缺陷。漏洞源于系统在执行该脚本时，未能正确过滤或限制通过JSON参数传递的系统指令。POC通过模拟合法用户登录获取Session Key，随后构造了一个复杂的JSON载荷，该载荷利用‘vixes’和‘providers’配置项，将恶意指令注入到Java虚拟索引（VIX）的配置中。具体而言，它通过调用‘sudobash’或其他可执行文件作为提供者命令，配合Base64编码的Payload绕过简单的字符过滤，最终在底层操作系统上执行反弹Shell指令。代码结构清晰，包含了身份验证、载荷构造、HTTP触发请求等完整模块，经分析具有极高的实战有效性。利用步骤：1. 获取目标主机的管理端口（通常为8089）及有效的低权限凭据；2. 运行脚本，程序首先调用/services/auth/login接口获取sessionKey；3. 脚本自动构造包含恶意命令的JSON配置文件，该文件定义了一个虚假的vix provider；4. 通过发送包含该JSON的特定查找请求触发‘copybuckets.py’执行；5. 目标服务器解析JSON并执行注入的Shell命令，攻击者在本地监听端口即可获得权限。投毒风险分析：该POC代码逻辑透明，使用了标准的Python库（requests, base64, json），未发现明显的恶意混淆或加密行为。代码中的Payload构造部分清晰可见，开发者明确标注了‘reverse_shell_cmd’位置，便于研究人员审查。虽然脚本涉及到敏感的操作（如执行系统命令），但这些属于漏洞验证的必要组成部分，而非针对分析者机器的后门。主要的风险点在于脚本使用了urllib3.disable_warnings()，这在POC中很常见，用以处理自签名证书。代码中没有发现任何试图窃取分析者本地环境变量、SSH密钥或向第三方服务器发送敏感数据的隐藏逻辑。此外，代码未引用外部不明来源的二进制文件。综合评估，该POC属于高质量、低风险的防御性研究样本，但用户在运行此类脚本时仍应在隔离的沙箱环境中进行，以防止针对特定目标的误伤或Payload在非预期环境下触发。其风险主要来自于Payload本身的破坏性，而非脚本本身的安全性陷阱。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-36985-Splunk-RCE](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-36985-Splunk-RCE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-36985](https://nvd.nist.gov/vuln/detail/CVE-2024-36985)
