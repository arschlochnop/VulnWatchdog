## CVE-2026-21876 - OWASP ModSecurity Core Rule Set (CRS) WAF绕过/跨站脚本(XSS)

**漏洞编号:** CVE-2026-21876

**漏洞类型:** WAF绕过/跨站脚本(XSS)

**影响应用:** OWASP ModSecurity Core Rule Set (CRS)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** CRS < 4.22.0, CRS < 3.3.8

**利用条件:** 后端应用支持特定的字符集编码（如UTF-7）且WAF未对多部分表单请求中的charset属性进行白名单限制或深度检查。

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC提供了一个完整的漏洞复现环境，包含Docker容器配置和攻击载荷。其核心逻辑在于利用了OWASP CRS在处理`multipart/form-data`请求时的安全缺陷。攻击者在多部分表单的Part头中声明了`Content-Type: text/plain; charset=utf-7`。由于旧版本的CRS未能有效识别或过滤非标准的字符集编码，导致包含恶意代码的UTF-7编码字符串（如`+ADw-img+ACA-src+AD0-x+AD4-`，解码后为`<img src=x>`）得以绕过WAF检测规则。随后，后端应用（如Flask配合特定解析库）在处理这些数据时，若将其解码为原始HTML，则会导致XSS攻击。POC中包含了对比测试，明确展示了攻击载荷在存在漏洞的CRS版本中被放行，而在修复版本或严格模式下被阻断的情景，验证了漏洞的真实存在性与危害。利用步骤：1. 使用docker-compose部署提供的靶场环境，其中包含一个配置了受影响版本CRS的ModSecurity Nginx代理。2. 构造一个特定的HTTP POST请求，设置Content-Type为`multipart/form-data`并指定boundary。3. 在表单字段（如username）的头部添加`Content-Type: text/plain; charset=utf-7`。4. 将恶意XSS Payload（例如`<script>alert(1)</script>`）进行UTF-7编码。5. 发送请求至靶机地址。6. 观察到WAF并未触发拦截，恶意脚本在后端或浏览器端成功解析执行。投毒风险分析：经过对提供的代码进行防御性审计，该POC仓库表现出极高的透明度。它包含标准的Dockerfile、docker-compose.yml以及简单的Flask应用脚本（app.py），所有逻辑均使用标准库实现，不涉及任何外部二进制下载或混淆的Shell脚本。其中引用的外部链接均指向官方安全通告（GitHub Advisory）和OWASP CRS官方博客。风险评估为极低（5%），其风险仅在于该脚本具有实际的攻击能力，若在非授权环境下使用会造成实际破坏。代码中未发现任何隐藏的反向Shell、凭据窃取逻辑或恶意第三方依赖注入。整个项目结构清晰，符合安全研究和合规漏洞演示的标准。分析过程中特别注意了对多部分解析逻辑的审计，确认其仅用于演示绕过机制，不含恶意后门。

**项目地址:** [https://github.com/coreruleset/coreruleset/security/advisories/GHSA-36fv-25j3-r2c5](https://github.com/coreruleset/coreruleset/security/advisories/GHSA-36fv-25j3-r2c5)

**漏洞详情:** [https://coreruleset.org/20260106/cve-2026-21876-critical-multipart-charset-bypass-fixed-in-crs-4.22.0-and-3.3.8/](https://coreruleset.org/20260106/cve-2026-21876-critical-multipart-charset-bypass-fixed-in-crs-4.22.0-and-3.3.8/)
