## CVE-2024-43400 - Jinja2 (Python 库) Jinja2 模板注入 (SSTI)

**漏洞编号:** CVE-2024-43400

**漏洞类型:** Jinja2 模板注入 (SSTI)

**影响应用:** Jinja2 (Python 库)

**危害等级:** 高危 (High)

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** < 3.1.4

**利用条件:** 应用程序直接处理用户提供的不可信 Jinja2 模板内容，且未进行沙箱加固或使用了不安全的解析方式。

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：本漏洞主要存在于 Jinja2 模板引擎中。CVE-2024-43400 涉及在处理特定格式的模板时，攻击者可以通过构造恶意的 Jinja2 语法绕过限制，执行任意 Python 代码。在提供的 POC 代码片段中，可以看到该环境被封装在 Docker 中，并使用 yasa-engine（一款静态分析工具）来检测代码中的 Taint Flow（污染流）。虽然提供的 Python 代码片段（run.py）主要是为了调用 yasa 引擎对 XWiki 项目中的 StringClass.java 进行扫描，但其核心逻辑在于验证 'taint_flow_java_input' 规则，这暗示该 CVE 在实际利用中通常表现为不受信任的数据流向了敏感的执行函数。POC 代码展示了如何构建一个自动化的漏洞检测环境，通过静态扫描受影响组件（如 XWiki 中使用的 Jinja2 相关逻辑）来定位漏洞点。经分析，该 POC 并非直接的漏洞利用脚本，而是一个完整的防御性检测框架，能够有效识别代码库中是否存在类似 CVE-2024-43400 的风险点。其利用步骤通常涉及：1. 寻找 Web 应用中接收用户输入并将其传递给 Jinja2 渲染引擎的入口；2. 构造 payload（如使用 **globals** 等魔法方法）绕过沙箱；3. 实现远程代码执行。投毒风险分析：该 POC 主要是基于 Docker 的自动化扫描环境，代码结构清晰，使用了 Python 标准库（json, os, re, subprocess, pathlib）进行逻辑处理。Dockerfile 基础镜像为 debian:12-slim，安装了必要的运行环境（python3, ca-certificates）。在 run.py 中，代码逻辑聚焦于 SARIF 格式的检测结果处理、结果路径规范化以及最终的 JSON 报告生成。未发现任何混淆代码、恶意下载脚本（curl/wget 到未知 IP）、反弹 Shell 命令或非法窃取环境变量的行为。YASA 引擎相关的二进制文件虽然不可见源码，但在威胁情报语境下属于已知的分析工具。代码中定义的输出路径处理函数具有良好的容错性，不会对主机系统造成破坏。整体来看，该 POC 项目是为了安全研究设计的自动化工具，投毒风险极低，主要风险在于用户如果随意替换 YASA 二进制文件可能引入供应链风险，但在当前代码框架下是安全的。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-43400](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-43400)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-43400](https://www.google.com/search?q=https://nvd.nist.gov/vuln/detail/CVE-2024-43400)
