## CVE-2024-43202 - Apache DolphinScheduler RCE (远程代码执行)

**漏洞编号:** CVE-2024-43202

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache DolphinScheduler

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 版本需参考官方通告，通常涉及 3.2.1 之前的版本

**利用条件:** 通常需要访问 DolphinScheduler 的 Web 控制台或 API 接口，可能涉及对特定任务定义（如 HttpTask）的参数注入。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞属于 Apache DolphinScheduler 中的代码注入漏洞（CWE-94），攻击者可以通过构造恶意的输入流，在系统构造代码段时注入受外部影响的输入，从而修改语法或行为，最终导致远程代码执行。提供的 POC 代码实际上并不是一个直接的攻击脚本，而是一个基于 Docker 的扫描引擎环境（Yasa Engine）。它通过加载特定的规则文件 'rule_config_java_cve43202.json'，并定位到 'HttpTaskDefinitionParser.java' 文件进行静态代码分析。该 POC 的逻辑旨在自动化检测代码库中是否存在符合该 CVE 模式的漏洞点，而非实现自动化攻击。脚本中包含了对 DolphinScheduler 任务插件 API 的路径定位，说明漏洞核心在于 HTTP 任务定义的解析逻辑中。虽然这证明了漏洞的可检测性，但对于渗透测试人员来说，它缺乏直接触发漏洞的 payload 示例，需要结合对源码解析逻辑的深度理解来构造实际的 HTTP 请求 payload。因此，该 POC 在防御性扫描和漏洞验证方面具有参考价值，但在攻击自动化方面完整性较低。

【利用步骤】1. 识别目标系统中运行的 Apache DolphinScheduler 版本，确认是否在受影响范围内。2. 寻找允许定义或修改 HttpTask 的功能模块。3. 构造包含恶意脚本或指令注入的 JSON 定义，特别是针对 HttpTaskDefinitionParser 处理的字段。4. 提交任务定义并触发解析流程。5. 观察后端服务器是否执行了注入的系统命令或 Java 代码。由于漏洞涉及 CWE-94，利用通常集中在对特定解析类（如 HttpTaskDefinitionParser.java）注入非预期字符以改变控制流。

【投毒风险分析】从提供的代码段分析，投毒风险处于低水平（约15%）。该 POC 包含 Dockerfile 和 Bash 脚本，其行为主要是环境搭建和静态扫描工具的调用。代码中使用了标准的 Python 脚本处理 JSON 路径，并没有发现明显的恶意行为（如反弹 Shell、敏感文件窃取或隐藏的二级下载器）。其执行过程主要是在本地或容器内对指定的目录（/repo）进行静态扫描。唯一值得警惕的是脚本会下载并执行名为 'yasa-engine-linux-x64' 等二进制文件，这些二进制文件的安全性依赖于获取渠道的可靠性。如果这些二进制文件来自非官方仓库，则可能存在植入恶意逻辑的风险。然而，脚本本身的逻辑流程是透明且符合防御性研究意图的。在部署此类扫描容器时，应限制其网络访问权限，并对 COPY 进容器的 yasa-bundle 内容进行完整性校验，以防止在供应链环节被替换为恶意版本。

**项目地址:** 未直接提供，基于 POC 路径推测为私有或特定研究仓库

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-43202](https://nvd.nist.gov/vuln/detail/CVE-2024-43202)
