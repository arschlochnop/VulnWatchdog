## CVE-2019-18634 - Sudo 栈缓冲区溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本 (且开启了 pwfeedback 选项)

**利用条件:** 系统 /etc/sudoers 配置文件中启用了 pwfeedback 选项；攻击者需拥有本地低权限用户访问权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞存在于 Sudo 的 tgetpass.c 源码中。当 /etc/sudoers 启用了 pwfeedback 选项（在输入密码时显示星号）时，Sudo 会在用户输入时进行处理。如果用户通过管道或伪终端发送大量字符（特别是包含 Null 或反斜杠字符时），会导致输入缓冲区溢出到栈空间。提供的 POC 代码非常专业且具备高度有效性。它通过调用 posix_openpt() 创建伪终端（PTY）来模拟交互式输入，绕过了 sudo_term_eof 的限制。代码中硬编码了针对 Ubuntu (18.04/20.04) 和 Arch Linux 的内存偏移量（TGP_OFFSET），并使用环境变量 SUDO_ASKPASS 配合 execlp("sh", ...) 来实现在溢出后重定向执行流以获取 Root Shell。这种利用方式通过操作 termios 结构和 tcgetattr/tcsetattr 细粒度控制终端行为，证明了漏洞的可利用性。利用步骤如下：1. 检查 /etc/sudoers 是否包含 pwfeedback 配置。2. 编译 exploit.c，利用 Makefile 链接静态库。3. 运行程序，程序会创建一个伪终端并启动 sudo。4. 通过伪终端向 sudo 进程发送精心构造的溢出载荷，覆盖返回地址或函数指针。5. 触发成功后，sudo 会再次调用自身（通过 SUDO_ASKPASS），由于环境已设置，最终执行 sh 弹出 root shell。投毒风险分析：该 POC 代码展示了极高的透明度和安全性。首先，Makefile 仅包含标准的编译指令，没有隐藏的预编译脚本或后处理命令。其次，exploit.c 的源码完全使用标准 C 库（stdio, stdlib, termios, unistd 等），逻辑直观，所有内存操作和系统调用（如 dup2, execlp）均有明确的目的说明。代码中没有任何网络请求（如 curl/wget 到外部服务器）、无加密/混淆的二进制负载、也无自删除或驻留持久化逻辑。环境变量的操作（unsetenv/setenv）仅限于 Exploit 自身逻辑所需，不影响系统全局安全。唯一敏感的操作是 execlp("sh")，这是提权 POC 的标准行为，用于验证权限获取。整体而言，该代码属于典型的防御性研究 PoC，未发现任何投毒特征或恶意后门，对于安全研究人员学习缓冲区溢出原理具有很高的价值。

**项目地址:** [https://www.sudo.ws/alerts/pwfeedback.html](https://www.sudo.ws/alerts/pwfeedback.html)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)
