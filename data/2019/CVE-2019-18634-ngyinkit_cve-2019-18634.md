## CVE-2019-18634 - Sudo 栈缓冲区溢出(Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出(Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本

**利用条件:** 必须在 /etc/sudoers 配置文件中启用 'pwfeedback' 选项（该选项默认不开启）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞源于 Sudo 1.8.26 之前的版本在处理 getpass() 函数输入时的逻辑缺陷。当用户在启用 'pwfeedback'（输入密码时显示星号）的情况下通过管道或伪终端提供输入时，处理字符退格和擦除的逻辑未能正确检查缓冲区边界。提供的 Python POC 代码利用 pwn 库构造了一个高度精确的攻击负载。POC 首先创建了一个反弹 Shell 脚本 '/tmp/shell.sh' 并将其权限设置为可执行。随后，它利用 SUDO_ASKPASS 环境变量将该脚本与 sudo 命令关联。核心利用逻辑在于通过伪终端 (os.openpty) 向 sudo 进程注入精心构造的 payload。该 payload 包含重复的 '\x00\x15' 字节序列，旨在触发 tgetpass.c 中的溢出点。POC 还通过填充 0 字节来伪造进程状态信息（如 pid, uid, guid 等），试图稳定利用环境。该 POC 具备从普通用户权限提升至 root 权限的能力，且在特定的实验环境下成功率较高，展示了完整的溢出链条。【利用步骤】1. 验证目标系统 /etc/sudoers 中是否配置了 Defaults pwfeedback。2. 准备 Python 环境并安装 pwntools 库。3. 在攻击机或本地环境中执行 exploit.py。4. 脚本会创建一个包含反弹 Shell 指令的临时文件。5. 利用伪终端向执行 sudo -S id 的进程发送精心构造的缓冲区溢出字符串。6. 成功触发溢出后，sudo 会因为提权逻辑被劫持而执行 SUDO_ASKPASS 指向的脚本，从而在 4444 端口获得一个 root 权限的交互式 Shell。【投毒风险分析】该 POC 代码主要基于 Python 的 pwntools 库编写，代码逻辑清晰透明。经过静态分析，未发现代码混淆、非法加密、远程下载恶意二进制文件或向外部非控制服务器发送敏感数据的行为。代码中硬编码的 127.0.0.1 目标地址表明其设计初衷是用于本地验证或教育目的（如搜索结果 6 提到的教育用途）。其敏感操作包括创建反弹 Shell 脚本和设置 SUDO_ASKPASS 变量，这些均属于典型的漏洞利用技术范畴，而非隐藏的恶意后门。虽然该 POC 涉及写文件操作（/tmp/shell.sh），但由于路径固定且逻辑简单，对系统造成的意外副作用可控。综合评估，该代码作为安全研究使用时投毒风险极低，其公开性和可读性较高，未见针对研究员个人的欺骗性或破坏性指令，属于合法的漏洞演示代码。

**项目地址:** [https://www.youtube.com/watch?v=LhqbExt5oq0](https://www.youtube.com/watch?v=LhqbExt5oq0)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
