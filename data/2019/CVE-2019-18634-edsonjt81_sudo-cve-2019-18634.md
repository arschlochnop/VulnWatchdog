## CVE-2019-18634 - Sudo 栈溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo < 1.8.26

**利用条件:** 在 /etc/sudoers 中启用了 pwfeedback 选项（Linux Mint 和 elementary OS 默认开启）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：本漏洞存在于Sudo处理密码回显（pwfeedback）的过程中。当该功能开启时，Sudo会在用户输入密码时显示星号。该功能存在一个逻辑错误：即使用户没有按下回车键，Sudo也会处理信号字符（如KILL或ERASE），并将其写入固定大小的缓冲区。如果通过管道或伪终端发送大量此类控制字符，将触发栈溢出。提供的C语言POC代码非常专业且具有极高的有效性。它通过posix_openpt创建伪终端，绕过了Sudo对非终端输入的限制。代码中硬编码了针对Ubuntu 18.04/20.04和Arch Linux的内存偏移量（TGP_OFFSET），这表明该POC经过了针对性调试，能够直接将权限提升至root。它利用tgetpass函数中的缓冲区溢出覆盖返回地址或控制结构，最终调用execlp("sh", "sh", NULL)获取高权限Shell。该POC不依赖复杂的网络环境，仅需本地低权限账户即可触发。利用步骤：首先，验证当前环境是否开启了pwfeedback，可通过sudo -l或查看/etc/sudoers配置文件确认。其次，使用Makefile编译exploit.c生成可执行文件。执行该程序时，POC会通过fork和execvp启动sudo进程，并通过伪终端模拟恶意输入。当溢出发生并成功覆盖指令指针后，程序将通过SUDO_ASKPASS环境变量或直接劫持执行流的方式回弹一个root shell。投毒风险分析：该POC代码逻辑清晰，主要使用了标准的POSIX C库（如termios.h, fcntl.h, unistd.h），没有引入任何第三方库或外部二进制payload。代码中不存在网络通信行为（如建立反弹连接到未知IP），也没有对系统关键文件（如/etc/shadow或~/.ssh/authorized_keys）进行非授权修改的隐藏逻辑。代码段中的unsetenv("SUDO_ASKPASS")和dup2操作是提权POC中常见的环境清理和标准流重定向手段，旨在确保获取的Shell能够正常交互。虽然包含Makefile，但脚本仅执行标准的编译指令。综上所述，该代码属于典型的漏洞研究POC，未发现恶意混淆、加密shellcode或后门注入行为。对于安全研究人员而言，其投毒风险极低，但在执行前仍建议在隔离的虚拟机环境中根据目标系统的具体Sudo版本微调内存偏移量。

**项目地址:** [https://www.sudo.ws/alerts/pwfeedback.html](https://www.sudo.ws/alerts/pwfeedback.html)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)
