## CVE-2019-11043 - PHP-FPM RCE

**漏洞编号:** CVE-2019-11043

**漏洞类型:** RCE

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** PHP versions 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11

**利用条件:** Certain configurations of FPM setup

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2019-11043是PHP-FPM中的一个远程代码执行漏洞。该漏洞源于FPM模块在某些配置下，可能将数据写入超出分配的缓冲区，覆盖FCGI协议数据的区域。攻击者通过构造特殊的请求，可以覆盖内存中的其他数据，从而执行任意代码。

POC有效性分析：
提供的PoC代码（/tmp/vulnwatchdog_7f224bbee7b8acc17a8b70fd547a8b0c/README.md, /tmp/vulnwatchdog_7f224bbee7b8acc17a8b0c/detect.py）是一个完整的利用脚本，它首先通过detect.py模块检测目标是否存在漏洞，然后利用main.py模块进行攻击。检测脚本通过发送特定的HTTP请求，根据返回的状态码判断是否存在漏洞。如果存在漏洞，脚本会尝试设置"session.auto_start=0"来关闭session的自动启动，然后执行攻击。

利用步骤：
1. 使用提供的docker-compose.yml搭建易受攻击的PHP-FPM环境（参考https://github.com/vulhub/vulhub/tree/master/php/CVE-2019-11043）。
2. 运行detect.py脚本检测目标是否存在漏洞：python3 detect.py -u http://target_ip/index.php。
3. 如果检测到漏洞，使用main.py脚本进行攻击：python3 main.py -u http://target_ip/index.php。
4. 成功利用后，可以通过URL参数执行任意命令：http://target_ip/index.php?a=/usr/bin/yourcommand。

投毒风险分析：
该PoC代码的投毒风险较低，主要原因如下：
1. 代码结构清晰：PoC代码由Python编写，代码逻辑易于理解，没有明显的混淆或隐藏恶意行为。
2. 标准库的使用：PoC代码主要使用了requests等标准Python库，没有引入第三方的高风险库。
3. 明确的目的性：PoC代码的目的是检测和利用CVE-2019-11043漏洞，没有发现其他潜在的恶意行为。
4. 交互行为：PoC需要在成功利用后，通过GET参数传入需要执行的系统指令，因此仅作为漏洞验证利用，不太可能直接被用于大规模投毒传播。
尽管如此，仍然存在一定的投毒风险：
1. 命令注入：攻击者可以通过URL参数执行任意命令，如果攻击者利用该漏洞执行恶意代码，可能会对目标系统造成损害。例如，攻击者可能利用该漏洞下载并执行恶意脚本。
2. 篡改代码：攻击者可能会篡改PoC代码，在其中添加恶意代码，然后将其传播给其他人。因此，在使用PoC代码时，务必确保代码的来源可靠。
3. 不可信环境执行：如果在不可信的环境中执行PoC代码，可能会导致敏感信息泄露或其他安全问题。

综合考虑，该PoC代码的投毒风险较低，但仍需谨慎使用。

**项目地址:** https://github.com/kriskhub/CVE-2019-11043

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
