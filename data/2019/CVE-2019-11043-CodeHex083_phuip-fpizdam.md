## CVE-2019-11043 - PHP-FPM 远程代码执行(RCE)

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP-FPM

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** PHP 7+ (受影响版本范围未知，漏洞存在于修复前的版本)

**利用条件:** 需要特定配置的Nginx + PHP-FPM环境，攻击者可以通过发送特制的HTTP请求触发漏洞。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2019-11043是一个存在于PHP-FPM中的远程代码执行漏洞。该漏洞存在于使用特定配置的Nginx + PHP-FPM的服务器中，允许攻击者远程执行代码。攻击者通过构造特殊的HTTP请求，可以绕过`fastcgi_split_path_info`指令的限制，从而将恶意代码传递给PHP-FPM执行。漏洞利用的关键在于`PATH_INFO`变量的处理，以及Nginx配置文件中缺少对文件是否存在性的检查。利用该漏洞，攻击者可以在服务器上执行任意代码，从而控制服务器，窃取敏感信息或进行其他恶意活动。

POC代码分析表明，该漏洞利用程序通过发送包含特定格式的URL的HTTP请求来触发漏洞。该URL旨在破坏`fastcgi_split_path_info`指令的正则表达式，从而允许攻击者将恶意代码作为`PATH_INFO`传递给PHP-FPM。为了成功利用此漏洞，目标服务器必须具有特定的Nginx + PHP-FPM配置，包括使用`fastcgi_split_path_info`指令，并且缺少诸如`try_files`之类的脚本存在性检查。POC代码提供了一个完整的漏洞利用程序，可以自动执行利用过程。该POC的质量很高，因为它包含完整的漏洞利用代码，并且提供了有关如何设置易受攻击环境的说明。

利用步骤：
1.  设置一个具有易受攻击配置的Nginx + PHP-FPM服务器。这包括使用`fastcgi_split_path_info`指令，并将`PATH_INFO`变量设置为`$fastcgi_path_info`，同时确保没有诸如`try_files`之类的脚本存在性检查。
2.  使用POC代码针对易受攻击的服务器发送特制的HTTP请求。
3.  如果漏洞利用成功，则将在服务器上执行恶意代码。

投毒风险分析：
该POC的投毒风险较低。虽然POC代码确实允许在服务器上执行任意代码，但该代码本身并不包含任何恶意功能。但是，始终存在攻击者修改POC代码以包含恶意代码的风险。例如，攻击者可能会修改POC代码，使其在服务器上安装后门或窃取敏感信息。此外，如果攻击者能够利用此漏洞控制服务器，他们可能会使用该服务器来托管恶意软件或发起其他攻击。由于POC主要利用已知的漏洞配置，并且依赖于对`PATH_INFO`变量的精确控制，因此直接在POC中添加恶意后门或病毒的难度较高。代码主要集中在构造特定格式的HTTP请求以绕过安全限制，而不是执行复杂的恶意操作。然而，攻击者可能会修改POC，在成功利用后下载并执行额外的恶意脚本，从而增加投毒风险。总的来说，该漏洞的投毒风险较低，约为15%。

**项目地址:** https://github.com/theMiddleBlue/CVE-2019-11043

**漏洞详情:** None
