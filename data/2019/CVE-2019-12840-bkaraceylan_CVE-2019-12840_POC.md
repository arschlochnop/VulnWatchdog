# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md](../2019/CVE-2019-12840-bkaraceylan_CVE-2019-12840_POC.md)

# CVE-2019-12840

> ğŸ“¦ è¯¥CVEæœ‰ **5** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md](../2019/CVE-2019-12840-KrE80r_webmin_cve-2019-12840_poc.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Webminå®ä¾‹è¿è¡Œä¸”æ”»å‡»è€…å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ï¼Œéœ€è¦ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´å­˜åœ¨äºWebminçš„Package Updatesæ¨¡å—ã€‚ä»»ä½•è¢«æˆæƒè®¿é—®æ­¤æ¨¡å—çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡`update.cgi`çš„`data`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæƒé™ä¸ºrootã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„PoCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†å¯åˆ©ç”¨çš„PoCä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1.  **ç™»å½•æ¨¡å—ï¼š** æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•Webminã€‚
2.  **æ¼æ´åˆ©ç”¨æ¨¡å—ï¼š** æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„payloadå‘é€åˆ°`update.cgi`ã€‚
3.  **åå¼¹shellæ¨¡å—:** æ„é€ åå¼¹shellçš„å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ã€‚

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„ã€ä¸æ¼æ´åˆ©ç”¨æ— å…³çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯`b64revshell`å‡½æ•°æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ç”Ÿæˆåå¼¹shellï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨æ¥ä¼ æ’­æ¶æ„payloadã€‚æŠ•æ¯’é£é™©é¢„ä¼°åœ¨5%ï¼Œä¸»è¦æ¥è‡ªäºä½¿ç”¨è€…å¯¹åå¼¹shellçš„æ»¥ç”¨å’Œè„šæœ¬æœ¬èº«å­˜åœ¨çš„å¾®å°å¯èƒ½æ€§ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼æˆ–æ³¨é‡Šä¸­éšè—çš„ç»†å¾®æ¶æ„æŒ‡ä»¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **èº«ä»½éªŒè¯ï¼š** é¦–å…ˆï¼Œæ”»å‡»è€…éœ€è¦æœ‰æ•ˆçš„Webminç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ¨¡å—æƒé™ï¼š** æ”»å‡»è€…éœ€è¦å…·æœ‰â€œPackage Updatesâ€æ¨¡å—çš„è®¿é—®æƒé™ã€‚
3.  **æ„é€ Payloadï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTP POSTè¯·æ±‚ï¼Œå°†å…¶å‘é€åˆ°`update.cgi`ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ‰§è¡Œpayloadä¸­çš„å‘½ä»¤ï¼Œå¹¶ä»¥rootæƒé™æ‰§è¡Œã€‚
5.  **è·å–ç»“æœï¼š** æ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…ä½¿ç”¨åå¼¹shellè·å–äº¤äº’å¼shellã€‚

æä¾›çš„PoCè„šæœ¬é¦–å…ˆå°è¯•ç™»å½•Webminï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«å‘½ä»¤çš„payloadï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/package-updates/update.cgi`ï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #2

**æ¥æº**: [CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md](../2019/CVE-2019-12840-Pol-Ruiz_PoC-CVE-2019-12840.md)

## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminè®¿é—®æƒé™ï¼Œä¸”ç”¨æˆ·æ‹¥æœ‰"Package Updates"æ¨¡å—çš„æˆæƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2019-12840å…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡"Package Updates"æ¨¡å—çš„update.cgié¡µé¢ä¸­çš„dataå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾—rootæƒé™ã€‚æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ†æå¦‚ä¸‹ï¼š

1.  **æœ‰æ•ˆæ€§ï¼š**
    *   æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºï¼ŒWebmin 1.910åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨æ­¤æ¼æ´ï¼Œä»»ä½•æœ‰"Package Updates"æ¨¡å—æƒé™çš„ç”¨æˆ·å‡å¯åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2019-12840.pyï¼‰ä¹Ÿæä¾›äº†å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯å’Œå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤POCä»£ç æœ‰æ•ˆã€‚

2.  **æŠ•æ¯’é£é™©ï¼š**
    *   è¯¥è„šæœ¬æ€»ä½“æ¥è¯´æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç™»å½•Webminå¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚ä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Œæ¯”å¦‚ reverse shell éƒ¨åˆ†ä½¿ç”¨base64ç¼–ç ï¼Œå¯èƒ½å­˜åœ¨é€šè¿‡æ›¿æ¢ç¼–ç åçš„shellcodeæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä½†æ¦‚ç‡è¾ƒä½ï¼Œåˆæ­¥åˆ¤å®šæŠ•æ¯’é£é™©ä¸º10%ï¼Œè„šæœ¬ä¸­æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åé—¨æˆ–æ¶æ„ä»£ç ã€‚

3.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   **ç™»å½•è®¤è¯ï¼š** é¦–å…ˆï¼Œè„šæœ¬ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Webminç³»ç»Ÿã€‚
    *   **è·å–Session IDï¼š** æˆåŠŸç™»å½•åï¼Œè„šæœ¬è·å–Webminçš„Session ID (sid)ã€‚
    *   **æ„é€ æ¶æ„è¯·æ±‚ï¼š** è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/package-updates/update.cgi`é¡µé¢ã€‚å…¶ä¸­ï¼Œ`data`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å…·ä½“è€Œè¨€ï¼Œè„šæœ¬ä¿®æ”¹äº† `u` å‚æ•°çš„å€¼, æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤. 
    *   **å‘½ä»¤æ‰§è¡Œï¼š** WebminæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±äºæœªå¯¹`data`å‚æ•°è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒé™ã€‚
    *   **åå¼¹Shell (å¯é€‰)ï¼š** å¯ä»¥é€šè¿‡`-lhost`å‚æ•°æŒ‡å®šåå¼¹shellçš„åœ°å€ï¼Œè„šæœ¬ä¼šå°†payloadç¼–ç ä¸ºbase64ï¼ŒWebmin æ‰§è¡Œè§£ç åçš„ä»£ç ï¼Œå®ç°åå¼¹shellã€‚

4.  **æ€»ç»“ï¼š**
    è¯¥æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äºWebminå¯¹"Package Updates"æ¨¡å—çš„è¾“å…¥éªŒè¯ä¸è¶³ï¼Œå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #3

**æ¥æº**: [CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md](../2019/CVE-2019-12840-WizzzStark_CVE-2019-12840.py.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æ‹¥æœ‰Package Updatesæ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2019-12840 å…è®¸æ‹¥æœ‰ 'Package Updates' æ¨¡å—æƒé™çš„ Webmin ç”¨æˆ·é€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä»¥ root æƒé™æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è¯¥æ¼æ´çš„ POC ä»£ç ã€‚

**æŠ•æ¯’é£é™©:**

å¯¹æä¾›çš„ POC ä»£ç è¿›è¡Œåˆ†æï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ (urllib3.disable_warnings(), session.verify = False)
2.  ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• Webmin (session.post(webmin_url))
3.  æ„é€ åŒ…å«å‘½ä»¤çš„ POST è¯·æ±‚å‘é€åˆ° `package-updates/update.cgi` (session.post(package_url))
4.  æå–å¹¶æ‰“å°å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆhtml.unescape(re.findall(...))ï¼‰

è„šæœ¬æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œæ²¡æœ‰å‘ç°é¢å¤–éšè—çš„æ¶æ„ä»£ç æˆ–è¡Œä¸ºã€‚README.md æ–‡ä»¶åªæ˜¯æè¿°äº† POC çš„ç”¨é€”å’Œ CVE ç¼–å·ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·å¿…é¡»è¢«æˆæƒä½¿ç”¨ 'Package Updates' æ¨¡å—ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ POC è„šæœ¬ï¼ˆæˆ–å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼‰ç™»å½• Webminã€‚
3.  POC è„šæœ¬æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ POST è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° `/package-updates/update.cgi`ã€‚
4.  Webmin æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…ã€‚

æ¼æ´åˆ©ç”¨çš„å…³é”®åœ¨äº `update.cgi` æ²¡æœ‰æ­£ç¡®åœ°å¯¹ `data` å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ç”±äº Webmin ä»¥ root æƒé™è¿è¡Œï¼Œå› æ­¤æ”»å‡»è€…æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå…·æœ‰ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [WizzzStark/CVE-2019-12840.py](https://github.com/WizzzStark/CVE-2019-12840.py)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #4

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #5

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---



---

## POC #5

**æ¥æº**: [CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md](../2019/CVE-2019-12840-fenix0499_CVE-2019-12840-NodeJs-Exploit.md)

## CVE-2019-12840 - Webmin Package Updates è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è·å– root æƒé™

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ Webmin è®¿é—®æƒé™ï¼Œä»¥åŠæ‹¥æœ‰ Package Updates æ¨¡å—çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å…è®¸ä»»ä½•è¢«æˆæƒè®¿é—® Webmin "Package Updates" æ¨¡å—çš„ç”¨æˆ·ï¼Œé€šè¿‡ `update.cgi` çš„ `data` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æœ‰æ•ˆã€‚æ¼æ´åº“å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜ï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å…è®¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æä¾›çš„ POC ä»£ç é€šè¿‡ Node.js è„šæœ¬åˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š
1.  è®¾ç½®ä¸éªŒè¯ TLS è¯ä¹¦ã€‚
2.  å®šä¹‰ç›®æ ‡ Webmin ä¸»æœºã€æœ¬åœ°ç›‘å¬ä¸»æœºå’Œç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  å®šä¹‰äº†ç”¨äºç™»å½•å’Œè§¦å‘æ¼æ´çš„ URLã€‚
4.  å®šä¹‰äº†ç”¨äºå‘é€ HTTP è¯·æ±‚çš„ `request` å‡½æ•°ï¼Œå¤„ç† Cookie å’Œ HTTPS ä»£ç†ã€‚
5.  `startListener` å‡½æ•°å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç”¨äºæ¥æ”¶åå‘ Shell è¿æ¥ã€‚
6.  `execExploit` å‡½æ•°è´Ÿè´£ç™»å½• Webmin å¹¶åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚é¦–å…ˆæ„é€ ç™»å½•å‚æ•°å¹¶å‘é€ POST è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadï¼Œå¹¶å°†å…¶ä½œä¸º `update.cgi` çš„ `data` å‚æ•°å‘é€ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚

è„šæœ¬å°è¯•å»ºç«‹åå‘ shellã€‚ è™½ç„¶åå‘ shell æœ¬èº«å¯ä»¥è¢«åˆ©ç”¨äºæ¶æ„ç›®çš„ï¼Œä½†æä¾›çš„ä»£ç çš„æ˜ç¡®ç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œè€Œä¸æ˜¯å¼•å…¥éšè—çš„åé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚

**é£é™©è¯„ä¼°ç»“è®ºï¼š**

ä»£ç ä¸­å­˜åœ¨çš„å¾®å°é£é™©ç‚¹ï¼š
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` ç¦ç”¨ TLS è¯ä¹¦éªŒè¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½è¢«ä¸­é—´äººæ”»å‡»åˆ©ç”¨ã€‚ä½†åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼æ´åˆ©ç”¨ï¼Œå› ä¸ºç›®æ ‡ Webmin å®ä¾‹å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¯ä»¥è§†ä½œæ­£å¸¸åˆ©ç”¨ã€‚

* `remoteHost`ï¼Œ`localHost`ï¼Œ`localPort`ï¼Œ`username`ï¼Œ`password` è¿™äº›å˜é‡å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè™½ç„¶å¢åŠ äº†ä½¿ç”¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨è¢«æ»¥ç”¨çš„å¯èƒ½ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼Œæ­¤ POC ä»£ç çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ‹¥æœ‰ Webmin çš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”è¯¥è´¦å·æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„æƒé™ã€‚
2.  æ”»å‡»è€…è¿è¡Œæä¾›çš„ Node.js è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç™»å½• Webminï¼Œå¹¶æ„é€ åŒ…å«åå‘ Shell å‘½ä»¤çš„ Payloadã€‚
3.  è„šæœ¬é€šè¿‡å‘ `update.cgi` å‘é€ POST è¯·æ±‚ï¼Œå°† Payload ä½œä¸º `data` å‚æ•°ä¼ é€’ï¼Œä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚
4.  ç›®æ ‡ Webmin æœåŠ¡å™¨æ‰§è¡Œ Payload ä¸­çš„åå‘ Shell å‘½ä»¤ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œä»è€Œå»ºç«‹åå‘ Shell è¿æ¥ã€‚
5.  æ”»å‡»è€…é€šè¿‡åå‘ Shell è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„ root æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

## POC #6

**æ¥æº**: [CVE-2019-12840-zAbuQasem_CVE-2019-12840.md](../2019/CVE-2019-12840-zAbuQasem_CVE-2019-12840.md)

## CVE-2019-12840 Webmin 1.910 'Package Updates' è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2019-12840

**æ¼æ´ç±»å‹:** è¿œç¨‹å‘½ä»¤æ‰§è¡Œ

**å½±å“åº”ç”¨:** Webmin

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** <= 1.910

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Webminç”¨æˆ·æƒé™ï¼Œä¸”è¯¥ç”¨æˆ·æ‹¥æœ‰ 'Package Updates' æ¨¡å—çš„è®¿é—®æƒé™ï¼Œèƒ½è®¿é—®WebminæœåŠ¡ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2019-12840 æ¼æ´å­˜åœ¨äº Webmin 1.910 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ä»»ä½•å…·æœ‰ "Package Updates" æ¨¡å—è®¿é—®æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡å‘ update.cgi è„šæœ¬çš„ data å‚æ•°å‘é€æ¶æ„è¯·æ±‚ï¼Œä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­ exploit-db å’Œå…¶ä»–å®‰å…¨ç«™ç‚¹å‡å·²æ”¶å½•è¯¥æ¼æ´ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç æœ¬èº«ä¸»è¦æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡Œåå¼¹ shellã€‚ä»£ç ä¸­å­˜åœ¨å¯ç–‘çš„ä»£ç†é…ç½®ï¼Œ `proxies={'https':'http://127.0.0.1:8080'}`ï¼Œå¦‚æœæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°åˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ä¿®æ”¹åå¼¹ shell çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€…æ·»åŠ é¢å¤–çš„å‘½ä»¤æ‰§è¡Œï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ï¼Œä½†æ˜¯ä»ä»£ç æœ¬èº«æ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨ä½¿ç”¨è€…å¦‚æœä½¿ç”¨äº†ä¸€äº›ä¸å®‰å…¨çš„ä»£ç†æˆ–è€…ä¸‹è½½æºä¸æ˜çš„è„šæœ¬ï¼Œå¯¼è‡´payloadè¢«ç¯¡æ”¹ï¼Œæ‰ä¼šäº§ç”ŸæŠ•æ¯’è¡Œä¸ºã€‚å› æ­¤åˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦å…·æœ‰ Webmin çš„æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·éœ€è¦æ‹¥æœ‰ "Package Updates" æ¨¡å—çš„è®¿é—®æƒé™ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ exploit.py è„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ Webmin çš„ URLã€æœ‰æ•ˆçš„ sid cookieã€ç”¨æˆ·åã€å¯†ç ã€æ”»å‡»è€…ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP åœ°å€å’Œç«¯å£ã€‚
3.  è„šæœ¬é¦–å…ˆå°è¯•ç™»å½• Webminã€‚
4.  å¦‚æœç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¼šæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ payloadï¼Œè¯¥ payload ä¼šä½¿ç”¨ base64 ç¼–ç ï¼Œç„¶åé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° /package-updates/update.cgi è„šæœ¬ã€‚
5.  Webmin æœåŠ¡å™¨æ‰§è¡Œ payload ä¸­çš„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…è·å¾—æœåŠ¡å™¨çš„ root æƒé™ shellã€‚

**é¡¹ç›®åœ°å€:** [zAbuQasem/CVE-2019-12840](https://github.com/zAbuQasem/CVE-2019-12840)

**æ¼æ´è¯¦æƒ…:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)

---

