## CVE-2019-11043 - PHP-FPM with specific Nginx configurations Remote Code Execution (RCE)

**漏洞编号:** CVE-2019-11043

**漏洞类型:** Remote Code Execution (RCE)

**影响应用:** PHP-FPM with specific Nginx configurations

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** Specifically affects configurations of Nginx and PHP-FPM where the `cgi.fix_pathinfo` is enabled and improperly configured.

**利用条件:** Requires a specific configuration of Nginx and PHP-FPM. The `cgi.fix_pathinfo` must be enabled and misconfigured. No authentication is required.

**POC 可用性:** 9/10

**POC 类型:** Complete Exploitation

**攻击复杂度:** Low

**投毒风险:** 10%

## 详情

CVE-2019-11043 is a critical remote code execution vulnerability that affects PHP-FPM when used in conjunction with Nginx under specific configurations. The vulnerability stems from an incorrect implementation of the `cgi.fix_pathinfo` directive. When enabled, this directive is intended to handle requests for files that do not exist by passing the request to the PHP interpreter. However, a flaw in how Nginx passes requests to PHP-FPM allows attackers to inject arbitrary code. 

POC代码有效性分析：
The provided Dockerfile and associated files create an intentionally vulnerable environment that replicates the conditions required to trigger CVE-2019-11043. The Dockerfile sets up an Ubuntu 19.10 environment with Nginx and PHP 7.3, configuring PHP-FPM to listen on localhost:9000. Crucially, it retains the vulnerable `cgi.fix_pathinfo = 1` setting. The `nginx.conf` file contains a minimal, intentionally vulnerable fastcgi block that exposes the flaw. The provided README outlines the steps to build and run the vulnerable application, as well as a quickstart guide to exploit the vulnerability using `phuip-fpizdam`. The included application is a task management app, which is just to provide a functional application context.

利用步骤：
1. Build the Docker image using `docker build -t cve-2019-11043-lab:app .`.
2. Run the Docker container using `docker run --rm -p 8080:80 cve-2019-11043-lab:app`.
3. Open the application in a browser at `http://localhost:8080/`.
4. Use `phuip-fpizdam` or a similar tool to exploit the vulnerability by sending a crafted request to a PHP file (e.g., `status.php`). The tool will identify the correct parameters and construct the exploit.

投毒风险分析：
The primary risk associated with this specific POC is relatively low. The Dockerfile builds a self-contained environment. The primary risk resides in the use of external tools like `phuip-fpizdam`. While `phuip-fpizdam` itself is a known exploitation tool and does not inherently contain malicious code, obtaining the tool from untrusted sources could introduce a risk of using a tampered version. The risk is mitigated by the fact that the tool's functionality is focused on exploiting the RCE, and not on establishing persistence or gathering information. The docker image installs php extensions using apt-get from ubuntu mirrors, which has a minimal risk of poisoning, because of established software supply chain security controls. Therefore, the poisoning risk is estimated to be around 10%. The risk could be higher if the attacker uses the RCE to install more backdoors.

**项目地址:** https://github.com/theMiddleBlue/CVE-2019-11043

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
