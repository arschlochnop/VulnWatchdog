## CVE-2019-18634 - Sudo 栈缓冲区溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本

**利用条件:** 需要在 /etc/sudoers 中启用 pwfeedback 选项（Linux Mint 和 elementary OS 默认启用）

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于 Sudo 的 tgetpass.c 文件中。当 /etc/sudoers 启用了 pwfeedback 功能时，Sudo 会在用户输入密码时显示星号。如果输入被重定向到 Sudo 且包含大量无效字符（如空字符），tgetpass() 函数中的缓冲区管理逻辑会出现错误，导致栈溢出。提供的 POC 包含三个核心组件：exploit.py 用于生成触发溢出的有效载荷，通过特定的 null 填充、标志位修改和用户数据覆盖来控制程序流；exec.c 是一个辅助的 C 程序，其逻辑是利用 Sudo 的 SUID 权限，通过 fchown 和 fchmod 修改自身权限或直接通过 setuid(0) 获取 root shell；run.py 则是集成脚本，使用 socat 建立伪终端环境，绕过 Sudo 对交互式终端的检测。该 POC 逻辑严密，利用了 SUDO_ASKPASS 环境变量和重定向机制，在满足 pwfeedback 开启的条件下具有极高的成功率。利用步骤：首先，使用 cc 编译 exec.c 生成目标文件 /tmp/pipe；其次，设置 SUDO_ASKPASS 环境变量指向该二进制文件；然后，通过 run.py 调用 socat 启动 exploit.py 产生的 payload 输入流；最后，执行 sudo -S 命令，触发溢出后 Sudo 会执行 SUDO_ASKPASS 指向的文件，由于溢出已经破坏了内部状态或权限校验，exec.c 最终能以 root 权限运行并启动 /bin/bash。投毒风险分析：该 POC 代码结构清晰，主要使用了 Python 标准库（os）和 C 标准库（stdio, unistd, sys/stat 等），未发现明显的代码混淆或加密行为。虽然 run.py 包含执行系统命令的操作（os.system），但这些操作均服务于漏洞利用过程，如编译源码、启动 socat 和执行 sudo。核心利用逻辑位于 exploit.py 的字节码构建中，且 exec.c 的提权逻辑（修改自身所有者为 root 并设置 SUID 位）是提权漏洞 POC 的常见模式，并非隐蔽的恶意后门。潜在的投毒风险主要在于 POC 依赖外部工具 socat，如果用户在不受信的环境中下载未经审计的配套工具，可能引入风险。此外，POC 中硬编码的路径如 /tmp/pipe 和 /tmp/pty 属于常规操作。综合评估，该代码属于学术和研究性质的漏洞验证，无恶意投毒特征，投毒风险处于低位（15%），主要风险源于 POC 本身具备的破坏性提权功能而非隐藏的第三方攻击载荷。

**项目地址:** [https://github.com/Plazmaz/CVE-2019-18634](https://github.com/Plazmaz/CVE-2019-18634)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
