## CVE-2019-18634 - Sudo 栈缓冲区溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本

**利用条件:** 受影响系统中 /etc/sudoers 配置文件必须启用了 pwfeedback 选项。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC代码是一个基于Python 3和pwntools库编写的本地权限提升利用脚本，旨在针对Ubuntu 20.04上的Sudo 1.8.25版本进行攻击。漏洞根源在于Sudo处理pwfeedback选项（在用户输入密码时显示星号的功能）时的逻辑缺陷。在处理来自伪终端（PTY）的输入时，Sudo未能正确验证输入长度，导致在读取终止符（如NL或EOF）之前可以注入超过缓冲区容量的数据。POC通过os.openpty()创建一个伪终端，模拟交互式环境，并利用Sudo的-S参数从stdin读取。代码中payload的构造非常典型：使用大量的'\x00\x15'（其中\x15是SIGKILL对应的字符，在Sudo的特定处理逻辑中触发溢出路径）填充缓冲区，随后通过p64(6)和p32(0)尝试覆盖关键的内存结构或返回地址。该POC调用了外部的'shell.sh'并通过SUDO_ASKPASS环境变量引导执行。分析认为该POC逻辑严密，利用思路符合CVE-2019-18634的公开技术细节，在满足pwfeedback配置的前提下具有很高的执行成功率。利用步骤如下：1. 确认目标系统Sudo版本低于1.8.26。2. 确认/etc/sudoers中包含'Defaults pwfeedback'配置。3. 准备名为'shell.sh'的恶意脚本（如反弹shell或chmod u+s /bin/bash）。4. 运行exploit.py脚本，脚本将通过PTY注入精心构造的Payload，触发栈溢出并执行SUDO_ASKPASS指定的提权程序。【投毒风险分析】从代码层面分析，该POC的投毒风险较低，约为10%。主要代码由Python标准库（sys, os, time）和安全研究领域通用的pwntools库组成。代码逻辑透明，直接展示了如何打开PTY、构造Payload以及通过os.write发送数据的过程。并未发现混淆、动态下载远程恶意负载、执行系统关键路径破坏或收集用户敏感信息的行为。唯一的外部依赖是'shell.sh'，这属于用户可控的配置项，且README中已明确提示用户需自行替换内容，这是典型的研究型POC特征。然而，作为防御方，仍需注意pwntools这类库在特定环境下可能被攻击者包装。在导入pwntools时，它会生成一些本地配置，但不具备恶意传播属性。整体来看，该代码包是一个纯粹的漏洞验证工具，不包含针对研究员主机的后门或恶意逻辑。建议在隔离的虚拟机环境下测试，并手动检查shell.sh的内容以确保安全。

**项目地址:** [https://y3a.github.io/2021/04/17/sudo-cve-analysis/](https://y3a.github.io/2021/04/17/sudo-cve-analysis/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
