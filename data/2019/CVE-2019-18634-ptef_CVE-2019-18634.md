## CVE-2019-18634 - Sudo 栈溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本

**利用条件:** 在 /etc/sudoers 配置文件中启用了 pwfeedback 选项

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：本漏洞源于Sudo在处理输入时，如果开启了pwfeedback选项（即在输入密码时显示星号），程序在读取输入到缓冲区时未进行足够的边界检查，从而导致栈溢出。所提供的C语言代码展示了如何利用伪终端（PTY）来模拟用户输入并触发该溢出。代码通过posix_openpt、grantpt和unlockpt建立主从设备，随后通过execve调用sudo，并将恶意载荷通过PTY写入。分析该代码发现，它针对Linux Mint 19.1环境进行了硬编码偏移量调整，虽然在其他发行版上可能需要调整偏移量才能成功提权，但其核心逻辑（触发tgetpass.c中的溢出路径）是完全有效的。利用步骤：1. 确认目标系统Sudo版本低于1.8.26且/etc/sudoers中配置了'Defaults pwfeedback'。2. 编译exploit.c文件，生成可执行文件。3. 执行编译后的程序，程序会创建一个伪终端并设置环境变量。4. 程序调用'sudo -S'，绕过askpass限制并向stdin发送超长字符串触发溢出。5. 如果偏移量匹配，覆盖返回地址执行shellcode或跳转至提权逻辑，最终获得root权限。投毒风险分析：该POC代码结构清晰，主要使用标准C库函数（如termios.h, unistd.h, sys/wait.h等）进行系统调用，未发现任何经过混淆的二进制补丁、外部服务器连接（C2回调）或恶意文件下载行为。代码中虽然定义了一个名为PLEASE_EXEC_MY_SHELL的环境变量，但这属于典型的本地提权Payload逻辑，旨在溢出后重定向执行流以获取/bin/sh。其README明确指出该版本针对特定OS编写并建议参考官方安全公告，展现了典型的防御性研究人员的特征。由于代码完全开源且逻辑易于审计，不存在隐蔽的恶意后门，投毒风险极低。该代码的主要用途是教育和漏洞验证，不具备自动化感染或窃取信息的木马特征。

**项目地址:** [https://github.com/cardinal3/CVE-2019-18634](https://www.google.com/search?q=https://github.com/cardinal3/CVE-2019-18634) (根据POC作者推断)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
