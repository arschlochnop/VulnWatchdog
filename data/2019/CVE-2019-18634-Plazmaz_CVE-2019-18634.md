## CVE-2019-18634 - Sudo 堆/栈缓冲区溢出

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 堆/栈缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8

**影响版本:** Sudo 版本小于 1.8.26 (部分影响至 1.8.30)

**利用条件:** 系统 /etc/sudoers 配置文件中启用了 pwfeedback 选项（Linux Mint 和 elementary OS 默认启用）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞源于 Sudo 程序在处理用户输入密码时的缓冲区溢出。当 pwfeedback 开启时，Sudo 会在用户输入密码时显示星号，其在处理退格符（\b）时存在逻辑缺陷，导致输入字符偏移量未被正确检查，从而引发缓冲区溢出。所提供的 POC 包含一个 shell 脚本 `self-contained.sh`，它通过 Perl 构造特定的溢出 payload，并利用 `socat` 创建伪终端来模拟交互式输入。利用步骤如下：1. 检查目标系统 Sudo 版本并确认 `/etc/sudoers` 中是否存在 `pwfeedback`；2. 下载或编译 POC 源码，其中 `exec.c` 编译后作为 `SUDO_ASKPASS` 变量的目标，该代码利用 `fchown` 和 `fchmod` 设置 SUID 权限；3. 脚本执行 `sudo -k -S id`，并将 Payload 通过管道输入。当溢出发生时，程序计数器被覆盖，最终执行 `exec.c` 中定义的提权逻辑，获取 root shell。该 POC 针对 1.8.25 版本测试通过，由于不同版本字符处理差异，其他版本可能需要微调 Payload。 投毒风险分析：该 POC 的投毒风险处于低至中水平。主要关注点在于 `self-contained.sh` 脚本在执行初期会尝试通过 `wget` 从外部 GitHub 仓库（`andrew-d/static-binaries`）下载 `socat` 二进制文件。虽然该仓库在安全社区内知名度较高，但从防御者角度看，执行未经审计的第三方二进制文件存在供应链风险。除此之外，脚本中的 Perl 代码和 C 源码逻辑透明，主要功能是构造溢出字符串和利用 SUID 权限执行 `/bin/bash`，未发现明显的恶意混淆、键盘记录或数据外传代码。建议研究人员在隔离的实验环境下运行，并手动编译本地的 `socat` 以消除外部下载风险。POC 核心提权逻辑清晰，没有隐藏的恶意后门，属于典型的防御性研究代码。

**项目地址:** [https://github.com/Plazmaz/CVE-2019-18634](https://github.com/Plazmaz/CVE-2019-18634)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
