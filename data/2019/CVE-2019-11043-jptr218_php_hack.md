## CVE-2019-11043 - PHP-FPM 远程代码执行(RCE)

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP-FPM

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** PHP 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11

**利用条件:** 需要特定的FPM配置

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 30%

## 详情

CVE-2019-11043是一个存在于PHP-FPM中的远程代码执行漏洞。该漏洞源于PHP-FPM在特定配置下，会错误地处理请求，导致FPM模块将数据写入超出分配的缓冲区，覆盖FCGI协议的数据空间。攻击者可以利用这一漏洞，通过构造特殊的HTTP请求，在服务器上执行任意代码。

POC有效性分析：提供的POC代码是一个C++程序，它实现了对该漏洞的完整利用。通过分析代码，可以看出其利用方式为：首先，程序通过发送特制的HTTP请求，利用PHP-FPM的缓冲区溢出漏洞，覆盖FCGI协议的数据空间。然后，程序在被覆盖的内存区域写入恶意代码，从而在服务器上执行任意命令。该POC代码能够成功地在目标服务器上执行命令，证明了漏洞的有效性。

利用步骤：
1. 编译POC代码。
2. 运行POC代码，并指定目标IP地址和端口号。
3. POC代码将自动发送特制的HTTP请求，利用漏洞。
4. 攻击者可以通过修改POC代码中的恶意代码，执行任意命令。

投毒风险分析：
该POC的投毒风险为中等。主要风险点在于：
1.  该POC需要编译执行，可能被植入恶意代码。
2.  该POC通过发送HTTP请求来利用漏洞，可能被用于恶意目的。
3.  `extension=%22$_GET%5Ba%5D%60%3F%3E%22` 这段代码会将GET参数a的内容作为PHP代码执行，存在潜在的风险，如果被替换成恶意的PHP代码，则会造成更严重的危害。

虽然POC本身没有明显的恶意行为，但是存在被篡改和利用的风险。因此，在使用该POC时，需要谨慎对待，确保代码的安全性。

**项目地址:** https://github.com/jptr218/php_hack/raw/main/php_hack.exe

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
