## CVE-2019-11043 - PHP-FPM RCE

**漏洞编号:** CVE-2019-11043

**漏洞类型:** RCE

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11

**利用条件:** Certain configurations of FPM setup with Nginx

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2019-11043 是一个存在于 PHP-FPM 结合 Nginx 服务器特定配置下的远程代码执行漏洞。该漏洞源于 FastCGI 的 path_info 处理中的一个缺陷，攻击者可以通过构造特定的请求，使得 FPM 模块将数据写入到为 FCGI 协议数据保留的缓冲区之外，从而覆盖内存中的其他数据，最终实现远程代码执行。

POC 验证分析：

提供的 POC 代码是一个 Python 脚本，它能够利用此漏洞。该 POC 脚本首先会通过发送一系列请求来寻找合适的 QSL（Query String Length）候选值。然后，它会测试这些候选值，以确定目标是否存在漏洞。如果目标存在漏洞，该脚本会利用该漏洞执行任意代码。POC 代码清晰，易于理解和使用，提供了详细的安装和使用说明，包括使用 Docker 镜像来搭建漏洞环境，极大地简化了漏洞验证的过程。该POC的有效性很高，经过测试可以成功触发漏洞，实现远程代码执行。

利用步骤：
1. 搭建包含漏洞的 Nginx 和 PHP-FPM 环境（例如，使用提供的 Docker 镜像）。
2. 运行 exploit.py 脚本，指定目标 URL（例如，http://localhost:11043/index.php）。
3. 脚本会自动寻找合适的 QSL 值并测试漏洞。
4. 如果目标存在漏洞，脚本会显示成功信息，并指示如何通过 curl 命令执行任意代码。

投毒风险分析：
该 POC 的投毒风险较低。代码主要使用 Python 标准库，没有发现恶意行为或外部脚本调用。虽然脚本可以执行任意代码，但这是漏洞利用的固有特性，并非恶意投毒行为。脚本的代码清晰易懂，没有混淆或隐藏恶意代码的迹象。此外，该POC主要依赖于服务器配置错误实现RCE，所以投毒风险较低。但是仍然存在一定风险，攻击者可能会修改exploit脚本，加入恶意代码，例如植入后门、窃取信息等。使用该POC时，建议仔细检查代码，确保其安全性。

总结：该漏洞危害性高，利用简单，建议尽快修复。


**项目地址:** https://github.com/vulnwatchdog_57ea9793fe79118b505538927e5a051c/CVE-2019-11043

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
