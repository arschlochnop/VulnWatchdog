## CVE-2019-9978 - Social Warfare 插件 (WordPress) RCE/存储型XSS

**漏洞编号:** CVE-2019-9978

**漏洞类型:** RCE/存储型XSS

**影响应用:** Social Warfare 插件 (WordPress)

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** < 3.5.3

**利用条件:** 无需认证，远程网络访问，插件处于激活状态且未打补丁

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2019-9978是一个严重的安全漏洞，存在于WordPress的Social Warfare插件中。该漏洞源于插件在处理调试参数（swp_debug）时未能对外部提供的URL进行充分过滤。具体而言，当攻击者通过wp-admin/admin-post.php发送带有swp_debug=load_options和swp_url=外部恶意配置文件的请求时，插件会尝试加载并解析该URL指向的PHP配置。由于插件直接将获取的内容放入执行上下文中，这导致了双重风险：一是存储型跨站脚本（XSS），二是远程代码执行（RCE）。\n\nPOC有效性分析：提供的Python POC代码逻辑严密且高度可用。它通过以下步骤实现攻击：首先，在攻击者本地启动一个临时的HTTP服务器（quietServer），该服务器用于托管恶意的payload.txt。payload.txt的内容构造非常精巧，使用了<pre>system('command')</pre>标签。当目标WordPress服务器接收到针对swp_url参数的请求并指向该本地文件时，Social Warfare插件会拉取该文件内容并触发PHP的执行机制。POC中利用threading模块实现了攻击与Payload托管的异步进行，极大地提高了自动化程度。代码通过BeautifulSoup解析返回的HTML，从中提取系统命令的执行结果，验证了漏洞的可利用性。该POC针对性强，直接指向了漏洞的核心触发点wp-admin/admin-post.php，是评估受影响系统风险的有效工具。\n\n利用步骤：1. 攻击者准备攻击载荷，如包含PHP system函数的文本文件。2. 在公网或攻击者可控的主机上启动HTTP服务。3. 构造特定的HTTP GET请求，目标指向WordPress站点的/wp-admin/admin-post.php，参数设置为swp_debug=load_options和swp_url=[Payload_URL]。4. 目标服务器访问Payload_URL并执行其中的PHP代码。5. 攻击者在响应包中获取命令执行后的回显数据。\n\n投毒风险分析：该POC代码的投毒风险被评定为低（15%）。代码结构透明，主要使用了Python的标准库如argparse、threading、http.server以及常见的第三方库requests和BeautifulSoup。代码逻辑清晰，其核心功能是启动一个本地HTTP服务并向目标发送请求，不存在混淆代码、恶意下载器或隐蔽的外部连接。唯一的外部依赖是BeautifulSoup和requests，这在安全研究脚本中属于常规操作。投毒风险主要源于此类POC在传播过程中可能被恶意篡改，例如在payload.txt生成逻辑中插入攻击者自己的反弹Shell地址，或者在POC脚本开头添加自动删除本地文件的指令。但就当前代码本身而言，其行为是合规且可控的防御性研究工具，未发现针对执行者的恶意行为。在使用时，建议研究员在受控的沙箱环境中运行，并使用pip安装依赖以防止供应链攻击。

**项目地址:** [https://github.com/nelson-m/CVE-2019-9978](https://www.google.com/search?q=https://github.com/nelson-m/CVE-2019-9978)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2019-9978](https://nvd.nist.gov/vuln/detail/CVE-2019-9978)
