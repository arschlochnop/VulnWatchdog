## CVE-2019-11043 - PHP-FPM Remote Code Execution (RCE)

**漏洞编号:** CVE-2019-11043

**漏洞类型:** Remote Code Execution (RCE)

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** PHP versions 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11

**利用条件:** Requires specific FPM configuration vulnerable to the buffer overflow. Publicly accessible PHP-FPM service.

**POC 可用性:** 8/10

**POC 类型:** Complete exploit

**攻击复杂度:** Low

**投毒风险:** 15%

## 详情

CVE-2019-11043 is a critical remote code execution vulnerability affecting PHP-FPM. This vulnerability arises from a buffer overflow in the FPM module when handling requests with specific configurations. The vulnerability occurs because FPM can write past allocated buffers into the space reserved for FCGI protocol data. This allows an attacker to potentially inject arbitrary code into the server's memory space and execute it.

The provided POC code includes a `docker-compose.yml` file to set up a vulnerable environment with Nginx and PHP-FPM. The `default.conf` file configures Nginx to forward PHP requests to the PHP-FPM service. The `index.php` file simply displays "Hello World", serving as a basic application. The `exploit/CVE-2019-11043-Checker.py` script is used to verify the vulnerability. This script sends a crafted HTTP request with specific headers (D-Pisos, Ebut) to trigger the buffer overflow. The script checks for the presence of 'PHP' and 'nginx' in the response headers, indicating a vulnerable configuration. If a vulnerable configuration is detected, it attempts to exploit the vulnerability.

The exploit leverages the ability to manipulate the `PATH_INFO` variable in the FastCGI protocol. By crafting a specific `PATH_INFO` value, an attacker can cause FPM to miscalculate the buffer size and overwrite memory. This can lead to arbitrary code execution within the context of the PHP-FPM process.

**Exploitation Steps:**

1.  Set up the vulnerable environment using `docker-compose up`.
2.  Run the exploit script `exploit/CVE-2019-11043-Checker.py` against the target URL.
3.  The script will send a series of crafted requests to trigger the vulnerability.
4.  If successful, the script will execute arbitrary code on the server.

**投毒风险分析:**

The provided POC code presents a relatively low poisoning risk. The primary risk stems from the `exploit/CVE-2019-11043-Checker.py` script, which is responsible for exploiting the vulnerability. While the script itself appears to be clean, it's crucial to verify its integrity before execution. A compromised script could potentially inject malicious code into the server during the exploitation process. Specifically, the script makes a request to the target URL. While unlikely in this specific POC, the headers in this request could be modified to trigger other vulnerabilities on the target server, or to exfiltrate sensitive data if the target server logs the full request. The risk is mitigated by the relatively simple nature of the script and the use of standard Python libraries. The usage of `requests` library is standard practice, reducing the likelihood of hidden malicious functionality. However, one must always be vigilant about the source of the code and carefully review it before execution. The risk assessment is further lowered as there is no usage of `eval()` or shell commands within the exploit code. The file doesn't retrieve external dependencies or execute downloaded code, reducing the risk of supply chain attacks. Overall, the 투毒risk is estimated to be 15% due to the reliance on external libraries and potential for modification.

**项目地址:** https://github.com/jas9reet/CVE-2019-11043

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
