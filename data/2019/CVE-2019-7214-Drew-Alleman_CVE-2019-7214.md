# CVE-2019-7214

> 📦 该CVE有 **4** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2019-7214-Drew-Alleman_CVE-2019-7214.md](../2019/CVE-2019-7214-Drew-Alleman_CVE-2019-7214.md)

## CVE-2019-7214 SmarterMail 反序列化远程代码执行

**漏洞编号:** CVE-2019-7214

**漏洞类型:** 反序列化漏洞

**影响应用:** SmarterMail

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < build 6985

**利用条件:** 目标SmarterMail版本低于Build 6985，且17001端口对外开放。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-7214是SmarterMail 16.x版本Build 6985之前存在的一个反序列化漏洞。未经验证的攻击者可以通过TCP 17001端口向存在漏洞的SmarterMail服务器发送特制的序列化数据，从而执行任意命令。\n\n**有效性分析：**\n根据漏洞信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞是有效的。漏洞库信息和搜索结果都明确指出SmarterMail在build 6985之前存在此漏洞，并且有公开的PoC代码可用。漏洞利用代码（CVE-2019-7214.py）实现了利用该漏洞进行远程代码执行的功能。\n\n**投毒风险分析：**\n提供的PoC代码主要功能是利用.NET反序列化漏洞，在目标服务器上执行PowerShell命令，并建立反向shell。PowerShell命令经过Base64编码，便于传输和执行。分析代码后发现，其主要功能是建立反向shell，虽然存在恶意利用的可能，但本身功能设计是漏洞利用的一部分，所以不存在明显的投毒代码。但该POC修改自其他作者，需要综合评估代码贡献者信誉和代码审查结果。推测的投毒风险较低，约为5%。风险主要来自于反向shell建立后的进一步恶意操作，不属于PoC代码投毒本身。\n\n**利用方式：**\n1.  **确定目标版本：** 确认目标SmarterMail服务器的版本低于Build 6985。\n2.  **开放端口检测：** 确认目标服务器的17001端口对外开放，或者攻击者可以访问该端口。\n3.  **配置攻击机：** 在攻击机上配置监听端口，用于接收反向shell。\n4.  **构造PoC：** 使用提供的PoC代码（CVE-2019-7214.py），设置攻击机的IP地址和监听端口。PoC 代码中使用了经过 base64 编码的 PowerShell 命令建立反向TCP连接。\n5.  **发送Payload：** 运行PoC代码，向目标服务器的17001端口发送构造的Payload。\n6.  **获取Shell：** 如果漏洞利用成功，攻击机将收到来自目标服务器的反向shell，从而可以在目标服务器上执行任意命令。

**项目地址:** [Drew-Alleman/CVE-2019-7214](https://github.com/Drew-Alleman/CVE-2019-7214)

**漏洞详情:** [CVE-2019-7214](https://nvd.nist.gov/vuln/detail/CVE-2019-7214)

---

## POC #2

**来源**: [CVE-2019-7214-ElusiveHacker_CVE-2019-7214.md](../2019/CVE-2019-7214-ElusiveHacker_CVE-2019-7214.md)

## CVE-2019-7214-SmarterMail-反序列化RCE

**漏洞编号:** CVE-2019-7214

**漏洞类型:** 反序列化RCE

**影响应用:** SmarterMail

**危害等级:** 高危，可远程代码执行

**影响版本:** < Build 6985

**利用条件:** 目标端口17001可访问（默认配置下不可远程访问，Build 6985后修复）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-7214是SmarterMail 16.x版本Build 6985之前的一个反序列化漏洞。攻击者可以通过向目标服务器的17001端口（如果可访问）发送特制的序列化数据，来执行任意命令。该漏洞利用依赖于.NET反序列化漏洞，攻击者可以构造恶意的PowerShell命令作为payload，并通过序列化方式传递给SmarterMail服务器。提供的PoC代码（CVE-2019-7214.py）构造了这样的payload，其中包含了base64编码的PowerShell反向shell命令。  

**有效性:**  根据搜索结果和漏洞利用代码，可以判断该POC代码有效。多个来源表明存在可利用的PoC，并且提供的代码本身也实现了利用过程。

**投毒风险:** 投毒风险较低，估计在5%左右。主要考虑以下几个方面：
1.  **代码来源：** 代码来自多个作者，经过了ElusiveHacker修改，但主要逻辑是Soroush Dalili的。原始作者的信誉需要评估，但NCC Group也发布了相关的技术报告，佐证了漏洞的存在。
2.  **代码内容：** 代码主要功能是生成和发送Payload，Payload本身包含反向shell的PowerShell命令。虽然反向shell本身有风险，但这是漏洞利用的必要组成部分，不属于投毒。
3.  **配置参数：**  代码中需要配置`LHOST`和`LPORT`，这是反向连接的地址，如果攻击者不小心使用了错误的配置，可能导致连接到恶意的服务器，存在被反制的风险。但这不属于代码本身的投毒。
4. **README.md文件：** README文件说明了如何配置和使用该PoC，其中提到了hostname解析、端口配置以及使用Netcat监听等步骤。它对环境搭建和运行提供了指引，并无恶意操作。

主要的投毒风险在于，如果攻击者下载了该POC，并在生产环境中使用，可能被其他人截获反向shell连接，从而导致信息泄露或权限被窃取。因此,不能完全排除攻击者在托管的服务器上，捕获反向shell链接。

**利用方式:**  
1.  **确定目标版本：**  确认SmarterMail版本低于Build 6985。
2.  **确认端口可访问：** 确认目标服务器的17001端口可以通过网络访问。
3.  **配置PoC：** 修改PoC代码中的`HOSTNAME`、`LHOST`和`LPORT`参数，分别设置为目标主机名、攻击者IP地址和监听端口。
4.  **运行PoC：** 运行PoC代码，发送序列化的Payload。
5.  **监听连接：** 在攻击者机器上使用Netcat或其他工具监听指定的端口。
6.  **获取Shell：** 如果漏洞利用成功，将在攻击者机器上获得一个来自目标服务器的PowerShell Shell。

**项目地址:** [ElusiveHacker/CVE-2019-7214](https://github.com/ElusiveHacker/CVE-2019-7214)

**漏洞详情:** [CVE-2019-7214](https://nvd.nist.gov/vuln/detail/CVE-2019-7214)

---

## POC #3

**来源**: [CVE-2019-7214-andyfeili_-CVE-2019-7214.md](../2019/CVE-2019-7214-andyfeili_-CVE-2019-7214.md)

## CVE-2019-7214 - SmarterMail 反序列化远程代码执行

**漏洞编号:** CVE-2019-7214

**漏洞类型:** .NET 反序列化

**影响应用:** SmarterTools SmarterMail

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 16.x before build 6985

**利用条件:** 目标服务器运行受影响的SmarterMail版本，且17001端口可访问（默认情况下在Build 6985补丁后不可远程访问）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-7214 存在于 SmarterTools SmarterMail 16.x build 6985 之前的版本中。该漏洞允许未经身份验证的攻击者通过反序列化不可信数据，在服务器上执行任意命令。根据漏洞库信息和搜索结果，攻击者可以利用 .NET remoting 端点（17001端口）发送恶意序列化对象，从而触发远程代码执行。

**有效性:** 提供的 POC 代码是一个 Python 脚本，它利用了 .NET 反序列化漏洞。脚本首先定义了目标主机、端口，攻击者的监听主机、端口，然后构造一个包含 PowerShell 反向 Shell 命令的 Payload。该 Payload 使用 `System.Collections.Generic.SortedSet` 对象，攻击者使用powershell执行恶意代码，并将其base64编码后插入Payload，利用方式较为直接，大概率有效。Exploit-DB上也有相关利用代码（[webpage 4]）。

**投毒风险:** 经分析，POC代码的主要功能是利用漏洞进行远程代码执行，实现反向shell。虽然代码中包含反向shell，但这是漏洞利用的必要组成部分，并非恶意投毒。Payload 使用 PowerShell 下载并执行指定 URL 上的脚本，这部分如果 URL 被篡改，则存在投毒风险，目前代码中URL参数由攻击者指定。脚本的整体结构和逻辑与已知的 CVE-2019-7214 利用方式一致。投毒风险主要存在于用户如果直接使用该脚本，而没有审查其中的反向Shell地址，可能会被其他人利用。综合考虑，投毒风险较低，约为5%。

**利用方式:**
1.  **确定目标:** 找到运行 SmarterMail 16.x build 6985 之前版本的服务器，并确认17001端口对外开放。
2.  **配置攻击机:** 准备一台攻击机，配置监听端口（LPORT）。
3.  **修改POC代码:** 修改POC代码中的 HOST (目标服务器IP地址), LHOST(攻击机IP), PORT(Smartermail的17001端口) 和 LPORT(攻击机监听端口) 的参数。
4.  **运行POC代码:** 执行Python脚本，将恶意序列化数据发送到目标服务器的17001端口。
5.  **获取Shell:** 如果漏洞利用成功，攻击机将收到一个反向Shell，攻击者即可在目标服务器上执行任意命令。

**项目地址:** [andyfeili/-CVE-2019-7214](https://github.com/andyfeili/-CVE-2019-7214)

**漏洞详情:** [CVE-2019-7214](https://nvd.nist.gov/vuln/detail/CVE-2019-7214)

---

## POC #4

**来源**: [CVE-2019-7214-devzspy_CVE-2019-7214.md](../2019/CVE-2019-7214-devzspy_CVE-2019-7214.md)

## CVE-2019-7214 - SmarterMail Deserialization RCE

**漏洞编号:** CVE-2019-7214

**漏洞类型:** .NET Deserialization Remote Code Execution

**影响应用:** SmarterMail

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < Build 6985

**利用条件:** 目标服务器运行SmarterMail 16.x，且17001端口对外开放（默认build 6985后已关闭）。攻击者需要能够向17001端口发送请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-7214 漏洞存在于 SmarterTools SmarterMail 16.x build 6985 之前的版本中。这是一个 .NET 反序列化漏洞，未经身份验证的攻击者可以通过 17001 端口向服务器发送恶意构造的序列化数据，从而在服务器上执行任意代码。 

**有效性：**
根据漏洞描述和提供的漏洞利用代码，该漏洞利用的有效性较高。多个来源确认了该漏洞的存在，并且 exploit-db 上也存在相关的利用代码。

**投毒风险：**
提供的 Python 代码 `cve-2019-7214.py` 的主要功能是：

1.  构造一个包含嵌入式 PowerShell 命令的 .NET 反序列化 payload。
2.  PowerShell 命令的作用是创建一个 TCP 反向 shell 连接到攻击者指定的 LHOST 和 LPORT。
3.  将 payload 发送到目标 SmarterMail 服务器的 17001 端口。

代码中包含的 PowerShell 脚本会连接到攻击者指定的 IP 地址和端口，执行接收到的命令，并将结果返回。理论上攻击者可以在反向shell执行任何操作，危害极大。

尽管如此，该漏洞本身就是执行任意代码，因此，如果使用者明确知道正在利用反序列化漏洞执行命令，将反向shell连接到自己的服务器，那么它就不是后门或投毒代码。
README.md 提示用户某些 POC 可能需要修改，也属于正常情况。

但依旧存在一定的投毒风险，例如：

*   **隐藏的远程包含：** 代码中可能存在远程包含恶意代码的语句，但从提供的代码片段中未发现。
*   **微妙的参数篡改：** 攻击者可能在不知情的情况下修改了 LHOST/LPORT，导致 shell 连接到攻击者的服务器。

因此，综合来看，投毒风险较低，约为 5%。

**利用方式：**

1.  **确定目标版本：** 确认目标服务器运行的 SmarterMail 版本低于 build 6985。
2.  **检查端口可达性：** 确保可以访问目标服务器的 17001 端口。
3.  **配置攻击机：** 设置攻击机的监听端口（LPORT）和 IP 地址（LHOST）。
4.  **修改并运行Exploit** 修改exp中的HOST,LHOST,PORT,LPORT,生成Payload并且进行发送.
5.  **执行 PowerShell 命令：** 成功利用漏洞后，可以在目标服务器上执行任意 PowerShell 命令。

**项目地址:** [devzspy/CVE-2019-7214](https://github.com/devzspy/CVE-2019-7214)

**漏洞详情:** [CVE-2019-7214](https://nvd.nist.gov/vuln/detail/CVE-2019-7214)

---

