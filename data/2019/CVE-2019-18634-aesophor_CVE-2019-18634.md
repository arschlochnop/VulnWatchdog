## CVE-2019-18634 - Sudo 堆栈缓冲区溢出

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 堆栈缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo < 1.8.26

**利用条件:** 系统必须在 /etc/sudoers 中启用了 pwfeedback 选项（Linux Mint 和 elementary OS 默认启用，其他发行版通常默认禁用）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

CVE-2019-18634 是 Sudo 实用程序中存在的一个基于堆栈的缓冲区溢出漏洞。该漏洞源于当 /etc/sudoers 配置文件中启用了 'pwfeedback' 选项时，tgetpass.c 中的 getpass() 函数在处理用户输入时未进行充分的边界检查。pwfeedback 选项的作用是在用户输入密码时显示星号（*）。攻击者可以通过在终端输入超长字符并配合特定的控制字符（如终止符或回退符），导致缓冲区溢出并覆盖特权 sudo 进程中的内存。即便当前用户不在 sudoers 列表中，只要 pwfeedback 被启用，该漏洞即可被利用，从而允许本地用户将权限提升至 root。在提供的 POC 分析中，exploit.py 脚本表现出较高的有效性。它利用了 python 的 pwn 库（pwntools），通过伪终端（pty）模拟用户交互，向 sudo 进程发送精心构造的 payload。代码通过覆盖 tgetpass_flags 标志位并设置 TGP_ASKPASS 标志，强制 sudo 调用指定的 SUDO_ASKPASS 可执行文件。POC 巧妙地绕过了常规限制，通过控制 user_details 结构体中的 uid/gid 字段为 0（即 root），最终实现权限提升。利用步骤如下：1. 确认目标系统 sudo 版本低于 1.8.26 且启用了 pwfeedback。2. 编译安装特定版本的 sudo 用于环境模拟（如 POC 中所示）。3. 准备一个反弹 shell 脚本。4. 运行 exploit.py，脚本会启动监听器并通过管道向 sudo 注入溢出载荷，最终通过 SUDO_ASKPASS 机制执行恶意脚本，返回一个 root shell。投毒风险分析：该 POC 代码整体逻辑清晰，主要使用了 Python 标准库（os, sys）和安全研究领域常用的 pwntools 框架。经过审计，代码中虽然涉及反弹 shell 的创建（/tmp/reverse.sh），但这是为了展示漏洞利用效果的典型行为，目标地址被设置为本地 127.0.0.1，不具备远程投毒特征。代码中没有发现任何混淆、base64 编码的恶意负载、静默下载外部脚本或尝试修改系统关键凭证（如 /etc/passwd 或远程上传 SSH 密钥）的行为。项目提供了完整的 README 文档和构建脚本，透明度较高。虽然利用过程中涉及本地提权，但代码本身并未包含窃取主机敏感信息的逻辑。风险点在于，如果攻击者修改了脚本中的 IP 地址并进行二次分发，可能将其转化为恶意工具。目前公开的这个版本属于标准的、透明的安全研究脚本，投毒风险评级为低。防御者应当关注的是此类代码被集成到自动化扫描工具中的可能性，而非脚本本身携带木马。

**项目地址:** [https://github.com/aesophor/CVE-2019-18634](https://github.com/aesophor/CVE-2019-18634)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
