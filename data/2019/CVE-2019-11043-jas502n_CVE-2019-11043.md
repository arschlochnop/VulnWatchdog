## CVE-2019-11043 - PHP-FPM RCE

**漏洞编号:** CVE-2019-11043

**漏洞类型:** RCE

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** PHP 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11

**利用条件:** Requires specific FPM configuration, network access to the vulnerable server.

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2019-11043 是 PHP-FPM 中的一个远程代码执行 (RCE) 漏洞。此漏洞允许攻击者在特定配置下通过发送特制的 HTTP 请求来执行任意代码。具体来说，该漏洞存在于 FPM 如何处理 FastCGI 协议数据的方式中，攻击者可以利用此漏洞覆盖分配的缓冲区，从而执行恶意代码。POC的有效性分析如下：该POC通过`phuip-fpizdam`工具进行漏洞利用，该工具专门用于检测和利用此漏洞。利用步骤包括：首先，使用`go get github.com/neex/phuip-fpizdam`安装该工具。然后，通过`docker-compose up -d`启动存在漏洞的docker环境。接下来，通过执行`./phuip-fpizdam http://10.10.20.166:8080/index.php`来触发漏洞。最后，通过访问`http://10.10.20.166:8080/index.php?a=id`验证RCE是否成功。根据提供的docker-compose.yml和默认的nginx配置信息，可以快速搭建漏洞环境，从而验证漏洞。漏洞利用工具`phuip-fpizdam`可有效进行漏洞检测和利用，通过发送特制的请求包，实现了RCE。利用过程较为简单，攻击复杂度较低。但是该漏洞的利用具有一定的局限性，需要特定的FPM配置，这在一定程度上限制了漏洞的利用范围。

投毒风险分析：该POC代码主要由Go语言编写的漏洞利用工具`phuip-fpizdam`和一些辅助的Python脚本构成。`phuip-fpizdam`工具本身相对独立，没有发现包含恶意代码或后门的迹象。该工具的功能主要是发送特制的HTTP请求来触发漏洞，实现远程代码执行。辅助的Python脚本可能用于验证漏洞或执行其他辅助任务，同样没有发现明显的恶意行为。此外，提供的docker-compose.yml文件用于快速搭建漏洞环境，方便漏洞的验证和分析。虽然没有发现明显的恶意行为，但是考虑到RCE漏洞本身的危害性，攻击者可能利用此漏洞上传恶意脚本或程序，从而对系统造成更大的危害。因此，在实际应用中，需要对漏洞利用过程进行严格的监控和限制，以防止潜在的投毒攻击。此外，该项目使用Go语言编写，下载安装需要注意来源是否可靠，避免下载被篡改的版本。综合来看，该POC的投毒风险较低，约为10%。

**项目地址:** https://github.com/neex/phuip-fpizdam

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
