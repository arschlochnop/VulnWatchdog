## CVE-2019-11043 - PHP-FPM RCE

**漏洞编号:** CVE-2019-11043

**漏洞类型:** RCE

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11

**利用条件:** 需要网络访问, 特定Nginx + php-fpm配置

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2019-11043是一个影响PHP-FPM的远程代码执行漏洞。该漏洞源于Nginx在处理包含%0a的请求时，由于换行符\n导致PATH_INFO为空。当PHP-FPM处理空的PATH_INFO时，存在逻辑缺陷，允许攻击者通过构造恶意请求执行任意代码。

POC有效性分析：提供的POC代码（phuip-fpizdam）能够成功利用该漏洞。通过发送特定的HTTP请求，攻击者可以控制PHP-FPM的执行流程，从而执行系统命令。POC代码包含两个exp，一个是Go语言编写的，另一个是编译好的可执行文件，简化了利用过程。漏洞利用的关键在于Nginx的`fastcgi_split_path_info`配置。如果配置不当，攻击者可以绕过安全检查，将恶意代码传递给PHP-FPM。

利用步骤：
1. 确认目标服务器使用Nginx和PHP-FPM，并存在漏洞配置（即包含`fastcgi_split_path_info`）。
2. 使用提供的POC工具（例如`./phuip-fpizdam`）指定目标URL（例如`http://192.168.93.131:8080/index.php`）。
3. POC工具会自动构造恶意请求，发送到目标服务器。
4. 如果漏洞利用成功，攻击者可以在目标服务器上执行任意命令。

该漏洞的成功利用通常依赖于特定的Nginx配置。常见的易受攻击的配置包括：
```
location ~ [^/]\.php(/|$) {
    fastcgi_split_path_info ^(.+?\.php)(/.*)$;
    fastcgi_param PATH_INFO       $fastcgi_path_info;
    fastcgi_pass   php:9000;
}
```

缓解措施包括删除或修改Nginx配置文件中不安全的`fastcgi_split_path_info`配置。

投毒风险分析：该POC的投毒风险较低。主要风险点在于编译好的可执行文件，但该文件是漏洞利用的一部分，用于构造特定的HTTP请求。由于漏洞原理的特殊性，需要特定的请求结构才能触发，因此直接植入恶意后门的难度较高。攻击者更倾向于利用此漏洞直接执行命令或部署Webshell，而不是进行持久化投毒。如果攻击者替换POC中的可执行文件，则可能存在投毒风险，例如植入反向Shell或下载恶意代码。然而，由于漏洞利用本身需要特定的环境和配置，因此大规模投毒的概率相对较低。总体而言，该漏洞的投毒风险较低，但仍需注意下载和使用POC时的安全性，确保从可信来源获取代码。

总体而言，虽然POC本身不太可能直接包含恶意代码，但攻击者可能会修改POC以适应其特定目标，从而引入恶意行为。因此，在利用POC之前，务必进行代码审查和安全分析。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
