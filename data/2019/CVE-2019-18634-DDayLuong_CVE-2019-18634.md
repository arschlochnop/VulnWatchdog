## CVE-2019-18634 - Sudo 栈缓冲区溢出 (Stack-based Buffer Overflow)

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出 (Stack-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.26 之前的版本

**利用条件:** 系统开启了 pwfeedback 选项（在 /etc/sudoers 中配置）；攻击者需拥有本地普通用户访问权限。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对Sudo在处理pwfeedback选项时的栈溢出漏洞。当pwfeedback启用时，Sudo会在用户输入密码时显示星号，其tgetpass.c中的缓冲区处理逻辑存在缺陷。该POC由三部分组成：xpl.pl利用脚本、exec.c提权载荷以及run.sh执行脚本。xpl.pl通过构造特定的Payload，利用溢出覆盖tgetpass_flags，从而绕过长度检查并操纵程序流。exec.c则被编译为SUDO_ASKPASS指向的二进制文件，通过两次运行实现提权：第一次修改自身权限为SUID root，第二次执行并派生root权限的bash。经分析，该POC逻辑严密，利用了Sudo处理stdin和pty的特性，在满足pwfeedback开启的条件下具有极高的成功率。利用步骤：1. 确认目标系统/etc/sudoers中包含'Defaults pwfeedback'。2. 将代码上传至目标服务器。3. 编译exec.c为/tmp/pipe。4. 运行socat建立伪终端，并执行perl脚本输入Payload。5. 设置SUDO_ASKPASS环境变量指向/tmp/pipe。6. 执行sudo -k -S id触发漏洞。7. /tmp/pipe被以root权限执行后派生root shell。投毒风险分析：该POC代码结构清晰，主要逻辑集中在缓冲区偏移计算和SUID提权技术上。脚本中存在一处远程下载行为，即使用wget从githubusercontent下载socat二进制文件，这虽然是为了方便利用（socat是利用pty重定向所必需的），但在生产环境中从不可信源下载二进制执行文件属于潜在风险点，可能被用于供应链攻击。然而，核心提权代码（C代码和Perl Payload）均透明可见，未发现恶意混淆、键盘记录或隐蔽反弹Shell等典型的投毒特征。主要的风险在于该脚本会修改/tmp/pipe的权限并保持SUID root状态，若未及时清理，可能留下本地后门。总体而言，该POC属于标准的防御性安全研究代码，投毒风险较低，但审计人员应注意wget下载的外部文件指纹。

**项目地址:** [https://github.com/nemo-wq/SUDO_Killer](https://www.google.com/search?q=https://github.com/nemo-wq/SUDO_Killer)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2019-18634](https://nvd.nist.gov/vuln/detail/cve-2019-18634)
