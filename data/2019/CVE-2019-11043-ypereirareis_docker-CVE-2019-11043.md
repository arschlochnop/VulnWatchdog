## CVE-2019-11043 - PHP-FPM Remote Code Execution (RCE)

**漏洞编号:** CVE-2019-11043

**漏洞类型:** Remote Code Execution (RCE)

**影响应用:** PHP-FPM

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** PHP versions 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11

**利用条件:** Specific FPM configurations are required. Requires network access to the vulnerable server.

**POC 可用性:** 9/10

**POC 类型:** Complete exploit

**攻击复杂度:** Low

**投毒风险:** 10%

## 详情

CVE-2019-11043 is a remote code execution vulnerability affecting PHP-FPM. Specifically, it allows attackers to execute arbitrary code on a vulnerable server. This vulnerability stems from a buffer overflow in certain configurations of FPM setup. The FPM module writes past allocated buffers into the space reserved for the FCGI protocol data. The provided Proof-of-Concept (POC) leverages this vulnerability to achieve remote code execution. The POC, available at github.com/neex/phuip-fpizdam, allows to check if a web server is vulnerable and, if it is, to execute arbitrary commands. The provided Dockerfile and README.md further simplifies testing by creating a containerized environment to execute the exploit.

The exploit works by manipulating the query string length (QSL) in a specific way that causes the buffer overflow in PHP-FPM. If the server is vulnerable, the attacker can then execute arbitrary commands. The provided example shows how to detect the vulnerability and then execute a command (which in the example is `which which`) by appending `?a=/bin/sh+-c+'which+which'&` to the URL. The POC demonstrates a high degree of effectiveness, allowing for remote code execution with relative ease, provided that the target environment is configured in a specific vulnerable manner.

**Exploitation Steps:**
1.  **Identify a Target:** Find a PHP-FPM server that might be running a vulnerable version of PHP.
2.  **Vulnerability Detection:** Use the `phuip-fpizdam` tool (or the provided Docker image) to check if the server is vulnerable.
3.  **Exploitation:** If the server is vulnerable, use the tool to execute arbitrary commands by appending a crafted query string to the URL.
4.  **Post-Exploitation:** After successful execution, perform necessary cleanup tasks, such as removing any created files.

**Poisoning Risk Analysis:**
The primary risk associated with this POC lies in its potential for widespread exploitation. While the core exploit itself doesn't inherently contain malicious code, its ease of use and high success rate make it an attractive tool for attackers. The tool is quite explicit and doesn't involve code obfuscation, and leverages standard libraries. The provided Dockerfile uses a standard golang image. The risk of a supply chain attack or backdoors is low. However, threat actors could modify the readily available exploit code to include malicious functionalities such as deploying malware, creating backdoors, or exfiltrating sensitive data. Modified versions can be distributed under the guise of security tools, leading unsuspecting users to inadvertently deploy them on their systems. The vulnerability itself is also used in the wild for ransomware deployment, as evidenced by the NextCry ransomware incident. Therefore the poisoning risk is estimated at 10%.

**项目地址:** https://github.com/neex/phuip-fpizdam

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2019-11043
