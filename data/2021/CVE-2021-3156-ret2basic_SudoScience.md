# CVE-2021-3156

> 📦 该CVE有 **31** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-3156-0x4ndy_clif.md](../2021/CVE-2021-3156-0x4ndy_clif.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过利用`sudoedit -s`命令以及一个以单反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：** 根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞是有效的。搜索结果中的多个网页都提到了该漏洞，并确认它允许权限提升到root。漏洞库信息中也明确指出了该漏洞是一个堆缓冲区溢出，可以通过特定的方式触发。

**投毒风险：** 提供的漏洞利用代码看起来像是一个 `Cargo.lock` 文件，这个文件是 Rust 项目依赖管理的一部分。它本身不包含任何可执行代码，只是记录了项目依赖项的版本信息和校验和。因此，此仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：** 该漏洞的利用方式涉及到向`sudoedit -s`命令传递一个以单反斜杠结尾的精心构造的命令行参数。这个参数会导致Sudo在处理命令行参数时出现一个off-by-one错误，从而导致堆缓冲区溢出。通过控制溢出的内容，攻击者可以覆盖堆上的数据结构，最终实现权限提升。

根据搜索结果，利用该漏洞通常不需要任何特殊的配置或权限，只需要一个可以执行sudo的本地用户即可。这使得该漏洞非常容易被利用。

**项目地址:** [0x4ndy/clif](https://github.com/0x4ndy/clif)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #2

**来源**: [CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md](../2021/CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md)

## CVE-2021-3156 (Baron Samedit) Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 存在于 Sudo 1.9.5p2 之前的版本中。这是一个堆缓冲区溢出漏洞，允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个已知的，并且已经有公开可用的利用代码(POC)。该漏洞利用代码在多个平台和版本上成功进行了利用，可以有效地将权限提升到root。

**投毒风险：**
提供的POC代码 (`exploit_nss.py`) 看起来像是 `worawit/CVE-2021-3156` 的一个fork，修改为使用 `ifconfig` 命令而不是 `ip` 命令。虽然这个修改本身是合理的 (为了兼容性)，但仍然存在轻微的投毒风险。投毒风险评估为 10%的原因如下：
  1. **代码来源：** 虽然代码fork自一个已知的漏洞利用仓库，但仍然需要检查fork后的代码是否引入了恶意修改。
  2. **代码复杂性：** 漏洞利用代码通常比较复杂，增加了隐藏恶意代码的可能性。
  3. **权限提升：** 由于漏洞利用本身会提升权限到root，恶意代码一旦成功执行，可能会造成严重的危害。
  4. **依赖外部资源：**  虽然作者说使用了ifconfig,但是还是依赖nscd等外部服务,如果被篡改,同样有提权风险.

**利用方式：**
1.  漏洞利用的触发点在于 `sudoedit -s` 命令在解析命令行参数时存在的 off-by-one 错误。
2.  攻击者需要构造一个以单个反斜杠字符结尾的恶意命令行参数。
3.  该参数会触发堆缓冲区溢出，覆盖内存中的数据结构（`service_user` 结构体）。
4.  通过精心构造溢出内容，可以覆盖 `service_user` 结构体中的指针，劫持程序执行流程。
5.  利用劫持的程序执行流程，攻击者可以执行任意代码，从而将权限提升到 root。
6.  此POC 使用 `ifconfig` 命令而不是 `ip` 命令，可能是为了增加在不同环境下的兼容性，因为 `ip` 命令可能不是所有系统默认安装的。

**项目地址:** [Bad3r/CVE-2021-3156-without-ip-command](https://github.com/Bad3r/CVE-2021-3156-without-ip-command)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #3

**来源**: [CVE-2021-3156-CptGibbon_CVE-2021-3156.md](../2021/CVE-2021-3156-CptGibbon_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过`sudoedit -s`以及一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。搜索结果中大量的文章和分析，例如Qualys的研究博客、NCC Group的分析文章，以及Red Hat的CVE描述，都证实了漏洞的存在和严重性。PoC代码的`README.md`文件也说明了其在Ubuntu 20.04上的测试成功，并且提供了验证漏洞存在的命令`sudoedit -s Y`。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为5%。理由如下：
*   PoC代码的目的是演示漏洞利用，结构清晰，注释完善，易于理解。
*   代码逻辑主要集中在构造特定的命令行参数和环境变量，以触发堆缓冲区溢出，并覆盖`service_user`结构体，从而执行shellcode。
*   `shellcode.c`文件中的代码功能单一，即执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，目的是获取root shell。虽然这段shellcode可以被替换为恶意代码，但是原始shellcode本身并不是恶意的，而是漏洞利用的一部分。
*   `Makefile`文件只包含编译和清理的命令，没有发现可疑操作。
*   `Dockerfile`用于构建包含漏洞版本的Sudo的环境，方便漏洞测试，本身不包含恶意代码。
*   作者在`README.md`文件中明确声明了研究成果归Qualys Research Team所有，并提供了其博客链接，表明了其非恶意意图。

虽然shellcode存在被替换的可能性，但整个代码库的结构和说明都表明其主要目的是为了演示和验证漏洞，而非进行恶意攻击，因此投毒的概率较低。

**利用方式：**
1.  利用 `sudoedit -s` 命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数（`buf`变量），触发off-by-one错误，导致堆缓冲区溢出。
3.  通过精心设计的环境变量（`LC_MESSAGES`、`LC_TELEPHONE`、`LC_MEASUREMENT`）进行堆排布，将目标`service_user`结构体安排在溢出区域附近。
4.  通过另一个环境变量（`overflow`）填充内存，并最终覆盖`service_user`结构体的`name`字段，将其修改为shellcode库的路径。
5.  Sudo在后续操作中会加载被覆盖的`name`字段指向的shellcode库，从而执行shellcode，提升权限至root。
6.  Shellcode执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，获得root shell。

**项目地址:** [CptGibbon/CVE-2021-3156](https://github.com/CptGibbon/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #4

**来源**: [CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md](../2021/CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升至 root。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该漏洞利用是有效的。搜索结果中多个链接（如 Qualys 博客、NCC Group 博客、Red Hat 页面等）都证实了该漏洞的存在和严重性，以及可被利用的事实。提供的漏洞利用代码包含 Makefile 和 README，指示了编译和使用漏洞利用程序的方法，并提供了效果演示，进一步表明了其有效性。

**投毒风险：**
该仓库中存在投毒代码的风险较低，约为 10%。主要考虑因素如下：
*   **Makefile编译：** 该POC的编译流程包含了sudo的编译，可能在编译过程中修改sudo源代码，加入恶意代码。
*   **busybox镜像：** POC需要特定的环境，包括busybox系统镜像rootfs.img，镜像本身可能包含恶意代码。
*   **nss库：** POC需要libnss_x-x.so.2库，恶意作者可能会在库中植入后门，但这种可能性较低，因为可以通过分析源代码来检测。
鉴于需要特定的环境和编译步骤，存在一些潜在的恶意代码植入点，但公开的POC通常会经过社区审查，因此风险相对较低。需要注意的是，为了重现漏洞，必须使用提供的环境配置，这在一定程度上增加了安全风险。

**利用方式：**
该漏洞的利用方式如下：
1.  **漏洞触发：** 通过 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数，触发 off-by-one 错误，导致堆缓冲区溢出。
2.  **权限提升：** 利用堆缓冲区溢出覆盖关键数据，从而获得 root 权限。
3.  **POC利用：** 提供的 POC 代码包含一个利用程序 (`exploit`) 和一个定制的 nss 库 (`libnss_x-x.so.2`)。该利用程序通过溢出修改 sudo 的行为，而 nss 库可能包含用于执行任意代码的 shellcode 或其他恶意逻辑。
4.  **利用步骤:**
    *   编译`sudo`和`exploit`。
    *   使用提供的`rootfs.img`启动`linux`，并进入`busybox`命令行界面。
    *   切换用户到`wanghan`。
    *   运行`./exploit`。
    *   验证当前用户是否为root。
利用的成功取决于目标系统上 Sudo 版本和 glibc 版本的兼容性。根据 README，该 POC 针对的是 `sudo` 1.8.31 和 `glibc` 2.31 在 `Linux` 4.18 或 5.10.167-gee203559bc0b-dirty 上。

**项目地址:** [DASICS-ICT/DASICS-CVE-2021-3156](https://github.com/DASICS-ICT/DASICS-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #5

**来源**: [CVE-2021-3156-DDayLuong_CVE-2021-3156.md](../2021/CVE-2021-3156-DDayLuong_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可提升至root权限

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，也被称为Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞是由于sudo在解析命令行参数时存在off-by-one错误造成的。攻击者可以通过`sudoedit -s`命令以及一个以单个反斜杠字符结尾的命令行参数来利用此漏洞，从而将权限提升到root。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此POC代码是有效的。搜索引擎结果中大量文章都提到了CVE-2021-3156的利用可以实现root权限提升。POC代码中`hax.c`文件实现了漏洞利用的核心逻辑，通过构造特定的命令行参数和环境变量来触发堆缓冲区溢出，覆盖堆上的数据，最终劫持程序控制流，执行恶意代码。

**投毒风险分析：**

分析POC代码，主要关注`lib.c`文件，该文件编译成动态链接库，用于替换系统中的某些函数，以执行恶意操作。查看lib.c文件内容发现代码不完整，疑似被删除，但Makefile文件存在编译该lib.c文件的指令。如果lib.c文件包含恶意代码（例如反弹shell或者添加后门用户），则存在投毒风险。由于lib.c内容缺失，无法准确判断，保守估计存在10%的投毒风险，即代码可能被篡改以包含恶意功能，但缺乏明确的证据。

**利用方式：**

1.  **目标确认：**  首先，需要确定目标系统是否存在CVE-2021-3156漏洞，即Sudo版本是否在受影响范围内（小于1.9.5p2）。
2.  **编译：**  使用提供的Makefile编译`hax.c`和`lib.c`，生成可执行文件`sudo-hax-me-a-sandwich`和动态链接库`libnss_X/P0P_SH3LLZ_ .so.2`。
3.  **参数选择：** 根据目标系统选择合适的target，或者手动指定`smash_len_a`，`smash_len_b`，`null_stomp_len`和`lc_all_len`参数。
4.  **执行：**  运行`sudo-hax-me-a-sandwich <target>`或`sudo-hax-me-a-sandwich <smash_len_a> <smash_len_b> <null_stomp_len> <lc_all_len>`，利用漏洞提升权限。
5.  **利用原理：** POC利用了sudoedit在处理以反斜杠结尾的参数时存在的堆缓冲区溢出漏洞。通过构造特定长度的字符串和环境变量，覆盖堆上的数据，劫持程序执行流程，加载恶意的动态链接库，从而执行任意代码，最终获得root权限。

**项目地址:** [DDayLuong/CVE-2021-3156](https://github.com/DDayLuong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #6

**来源**: [CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md](../2021/CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过利用sudo解析命令行参数时存在的off-by-one错误，提升权限至root。漏洞利用的关键在于使用`sudoedit -s`命令，并构造以单个反斜杠字符结尾的命令行参数，从而触发缓冲区溢出。提供的POC脚本`CVE-2021-3156.sh`通过以下步骤进行利用：

1.  **创建临时目录：** 创建一个临时工作目录，用于存放exploit所需的文件。
2.  **确定执行命令：** 如果提供了命令行参数，则使用该参数作为要执行的命令；否则，默认使用交互式shell (`/bin/bash`)。
3.  **准备Payload：** 对要执行的命令进行转义，防止注入。
4.  **生成恶意库：** 生成包含payload的动态链接库`woot1337.so.2`。该库在加载时，会将当前进程的UID和GID设置为0 (root)，并执行指定的命令。
5.  **配置利用环境：**  创建`woot/etc/nsswitch.conf`文件，并尝试复制`/etc/group`文件。
6.  **编译恶意库：** 使用gcc编译包含payload的c文件成共享库。
7.  **执行利用：** 使用`sudo -R woot woot`命令，触发漏洞。`-R`选项结合精心构造的环境变量，使得sudo加载恶意的动态链接库，从而执行payload。
8.  **清理：** 删除临时目录。

**有效性：** 根据漏洞描述和搜索结果，提供的POC代码是有效的，可以利用CVE-2021-3156漏洞实现权限提升。

**投毒风险：** POC代码本身存在一定的投毒风险，主要体现在以下几个方面：

*   **Payload植入：** 脚本会生成并编译一个动态链接库，其中包含可以执行任意命令的payload。虽然脚本的目的是为了利用漏洞提升权限，但恶意攻击者可以修改脚本，将payload替换为恶意代码，例如下载和执行恶意程序、收集敏感信息等。
*   **环境依赖：** 脚本依赖于特定的环境配置，例如gcc编译器、sudo版本等。攻击者可以利用这些依赖关系，在受害者环境中植入恶意文件或修改系统配置，从而实现持久化控制。
*   **代码混淆：** 攻击者可以对脚本进行混淆处理，使其难以阅读和理解，从而隐藏恶意代码。

综上所述，该POC代码存在一定的投毒风险。但是，由于该脚本公开且被广泛分析，潜在的恶意代码通常会被安全研究人员发现。因此，可以认为投毒风险较低，约为10%。 主要是payload生成方式的恶意替换和编译过程的潜在风险。

**利用方式：**

该漏洞的利用方式是通过构造特定的命令行参数，触发Sudo程序中的堆缓冲区溢出。具体步骤如下：

1.  使用`sudoedit -s`命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数。
3.  Sudo在处理该参数时，会由于off-by-one错误，导致堆缓冲区溢出。
4.  通过控制溢出内容，攻击者可以覆盖Sudo程序的内存，从而实现任意代码执行，最终提升权限至root。

**项目地址:** [Maalfer/Sudo-CVE-2021-3156](https://github.com/Maalfer/Sudo-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #7

**来源**: [CVE-2021-3156-Mhackiori_CVE-2021-3156.md](../2021/CVE-2021-3156-Mhackiori_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令（即使没有sudo权限）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用'sudoedit -s'命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为root。

**有效性：**
提供的PoC代码库包含利用此漏洞所需的必要文件，包括Makefile和expolit.c，以及描述利用方法的README.md。它使用环境变量进行内存填充，以便进行堆风水，覆盖`service_user`对象的名称，从而执行恶意代码。因此，提供的PoC**有效**。

**投毒风险：**
该代码库结构清晰，主要包含漏洞利用相关的代码。其中 `libnss_XXX/XXX.c` 和 `libnss_XXX/XXX.so.2` 存在潜在的风险。恶意作者可能在此处嵌入后门代码，例如反向shell等。尽管主要的利用逻辑是利用堆溢出，但共享库的编译和加载过程存在植入恶意代码的机会。因此，我给出一个较低的投毒风险评估，约为10%。

**利用方式：**
1.  利用`sudoedit -s` 以及一个以单个反斜杠结尾的命令行参数触发漏洞。
2.  该漏洞是一个堆缓冲区溢出，允许攻击者覆盖堆上的内存。
3.  PoC通过环境变量填充内存，进行堆风水（Heap Feng Shui），精心布局堆内存。
4.  利用溢出覆盖`service_user`结构体的`name`字段，该字段用于加载NSS(Name Service Switch)库。
5.  通过覆盖`name`字段，将NSS库的加载路径修改为攻击者控制的恶意库。
6.  当sudo尝试加载NSS库时，实际上加载的是恶意库，恶意库中的代码被执行。
7.  恶意库中的代码通常包含一个提权的shell或者其他恶意操作，从而实现权限提升。

**项目地址:** [Mhackiori/CVE-2021-3156](https://github.com/Mhackiori/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #8

**来源**: [CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md](../2021/CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的方式中。攻击者可以利用'sudoedit -s'命令和一个以单个反斜杠字符结尾的命令行参数来触发漏洞。通过精心构造的参数，可以覆盖堆内存，从而实现权限提升，允许本地普通用户获得root权限。

**漏洞利用方式：**

1.  **利用`sudoedit -s`触发：** 该漏洞的关键在于使用`sudoedit -s`命令，该命令用于以安全模式编辑文件。
2.  **构造恶意参数：**  攻击者需要提供一个以单个反斜杠(`\`)结尾的长命令行参数。这个反斜杠会触发转义错误，导致缓冲区溢出。
3.  **堆内存覆盖：** 通过精心控制的输入长度和内容，攻击者可以覆盖堆内存中的关键数据结构，例如`user_spec`结构体和`cmnd_spec`结构体。
4.  **权限提升：**  通过覆盖这些数据结构，攻击者可以修改sudo的行为，使其认为当前用户拥有root权限，从而执行任意命令。
5.  **POC代码分析：**
    *   POC使用python编写，利用ctypes直接调用libc函数，例如`execve`，实现进程的创建和执行。
    *   POC构造了恶意的argv和envp参数，利用`sudoedit -s`触发漏洞。
    *   POC通过设置环境变量`SUDO_EDITOR=/usr/bin/tee`将标准输入附加到`/etc/passwd`文件中，从而达到修改`/etc/passwd`的目的（这是一种利用方式，也可能替换成执行其他恶意代码）。
    *   POC通过大量的环境变量覆盖栈，并在栈上构造伪造的数据结构，用于利用堆溢出。
6.  **有效性：** 提供的PoC代码基本有效，根据漏洞描述和搜索结果，该PoC能够利用该漏洞实现本地权限提升。需要根据目标系统进行微调，例如地址偏移等。

**投毒风险：**

评估投毒风险较低，大约为1%。
    *   **原因：** 代码主要利用已知的堆溢出漏洞进行提权，尽管POC修改了/etc/passwd文件，添加了用户，但是可以很容易的进行排查，且行为可以控制。
    *   **风险点：** POC中的`/usr/bin/tee`命令被用于将输入附加到/etc/passwd，可能会添加恶意的用户账户，但这不是隐藏行为。理论上，作者可以在堆内存构造部分或环境变量设置中加入一些隐蔽的恶意代码，例如替换`execve`的参数，使其执行其他恶意程序，但当前代码中没有明显的此类行为。

总结：该漏洞利用方式相对直接，POC代码利用堆溢出覆盖关键数据结构，从而实现权限提升。投毒风险较低。

**项目地址:** [PhuketIsland/CVE-2021-3156-centos7](https://github.com/PhuketIsland/CVE-2021-3156-centos7)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #9

**来源**: [CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md](../2021/CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** 1.8.2 to 1.8.31p2 和 1.9.0 to 1.9.5p1

**利用条件:** 需要本地用户权限，且目标系统存在漏洞版本的 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 中的堆缓冲区溢出漏洞。此漏洞允许未经授权的本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升到 root。该漏洞是由于 `sudo` 在解析命令行参数时存在的 off-by-one 错误导致的。

**有效性：**
根据漏洞库信息、搜索结果以及提供的PoC代码，该漏洞是有效的，并且存在可利用的PoC。

**投毒风险：**
该仓库存在一定的投毒风险，风险概率约为10%。

分析如下：
1.  **libnss_X目录和shell_tool.c**: Makefile 中存在编译动态链接库 `libnss_X/X.so.2` 的指令，使用 `shell_tool.c` 作为源文件。需要对 `shell_tool.c` 代码进行审计，确认是否存在恶意行为。例如，是否包含反弹shell，下载执行恶意代码等。
2. **create_privshell.sh错误处理:**  README.md中提到`create_privshell.sh` 脚本可能编译失败,存在可以被利用的风险。
3. **自动后渗透脚本**: 虽然`get_all_ssh_keys.sh`目的是为了提取ssh keys,但是如果利用不当或者被替换,也可能造成信息泄露。

虽然存在上述风险点，但总体来看，该POC的主要功能是利用漏洞提升权限，而非进行大范围的恶意传播或破坏。因此，投毒风险主要集中在代码细节和潜在的滥用可能上。

**利用方式：**

1.  **编译PoC：** 首先，使用 `make` 命令编译 `bufferof.c` 和 `shell_tool.c` 生成 exploit 文件和动态链接库。
2.  **执行Exploit：** 运行编译后的 `exploit` 文件。该 exploit 利用堆缓冲区溢出漏洞来提升权限。
3.  **权限提升：** 成功利用漏洞后，用户将获得 root 权限。根据 README.md，PoC还提供了自动化的后渗透脚本，例如提取 SSH 密钥和创建特权 shell，进一步巩固攻击成果。

**安全建议：**

*   及时将 Sudo 升级到 1.9.5p2 或更高版本。
*   在部署 PoC 或任何第三方代码之前，进行彻底的代码审计。
*   限制普通用户的 Sudo 权限，降低漏洞利用的风险。

**项目地址:** [PurpleOzone/PE_CVE-CVE-2021-3156](https://github.com/PurpleOzone/PE_CVE-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #10

**来源**: [CVE-2021-3156-RodricBr_CVE-2021-3156.md](../2021/CVE-2021-3156-RodricBr_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #11

**来源**: [CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md](../2021/CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令且sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许任何本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性分析：**

提供的POC代码包括一个Makefile、exploit.c和一个shellcode.c，看起来是完整的利用代码。从exploit.c的代码注释和实现来看，它旨在利用`sudoedit -s`的命令行参数解析中的off-by-one错误触发堆溢出。代码中使用了堆风水（heap feng shui）技术，通过环境变量`LC_MESSAGES`, `LC_TELEPHONE`，`LC_MEASUREMENT`和精心构造的`overflow`变量，来控制堆的布局，从而覆盖目标内存区域。shellcode.c包含提权至root并执行/bin/sh的代码。Makefile文件用于编译exploit和shellcode，将shellcode编译为动态链接库`libnss_x/x.so.2`，但exploit.c并没有用到这个动态链接库，而是直接使用execve执行`/bin/sh`。 根据搜索结果和漏洞库信息，该漏洞利用方法是可行的，并被广泛研究和利用。

**投毒风险分析：**

*   **Makefile:**  Makefile只包含编译和清理目标，没有可疑行为。 *   **exploit.c:** exploit.c的代码主要用于构造漏洞利用所需的参数和环境变量，并调用`execve`执行`/usr/bin/sudoedit`。代码逻辑上是为了触发漏洞利用，没有发现明显的恶意代码，如反弹shell或植入后门。但是，该代码的功能就是提权，本身具有一定风险，应当在测试环境中使用。 *   **shellcode.c:** shellcode.c包含提权代码（setuid(0), setgid(0)）并执行/bin/sh的代码。这段代码的目的是在成功利用漏洞后获取root权限的shell。这里需要注意的是，这段shellcode会将当前用户的权限提升到root，并执行/bin/sh，本质上是打开一个具有root权限的shell会话。从利用漏洞的角度看，这是预期的行为，不能被认为是投毒行为。 *   **综合判断：** 由于提供的代码主要功能是验证漏洞并提权，没有发现明显的恶意行为，因此可以认为投毒的可能性较低。虽然代码本身具有提权功能，但是这是漏洞利用的正常组成部分。因此，投毒风险评估为0%。

**利用方式分析：**

1.  **编译：** 使用Makefile编译exploit.c和shellcode.c。Shellcode被编译成一个动态链接库，但在这个提供的exploit.c版本中，并没有显式加载或者依赖这个动态链接库。 2.  **堆风水：** 设置环境变量`LC_MESSAGES`， `LC_TELEPHONE`， `LC_MEASUREMENT`和 `overflow`，来控制堆的内存布局，方便覆盖关键数据。 3.  **触发漏洞：** 调用`sudoedit -s`，并传入一个以反斜杠结尾的长字符串作为参数。这个反斜杠会触发off-by-one错误，导致堆缓冲区溢出。 4.  **覆盖：** 堆缓冲区溢出覆盖相邻的内存区域，通常是覆盖`sudo`进程的关键数据结构。 5.  **提权和执行Shellcode：**  尽管shellcode编译成了动态链接库，但实际的利用是通过溢出覆盖数据，使sudo以root权限执行`/bin/sh`， 或者覆盖函数指针，劫持控制流执行shellcode（当前提供的exploit.c没有使用shellcode）。

总而言之，利用方式是通过构造特殊的命令行参数和环境变量，利用`sudoedit -s`的off-by-one错误触发堆溢出，最终获得root权限。

**项目地址:** [Sebastianbedoya25/CVE-2021-3156](https://github.com/Sebastianbedoya25/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #12

**来源**: [CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md](../2021/CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #13

**来源**: [CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md](../2021/CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** 1.8.2 to 1.8.31p2, 1.9.0 to 1.9.5p1

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156（又名Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。根据漏洞信息和搜索结果，此漏洞存在于Sudo解析命令行参数的方式中。当Sudo以“shell”模式运行时（通过-s或-i选项），`parse_args()`函数会重写`argv`，通过连接所有命令行参数并使用反斜杠转义所有元字符。之后，`sudoers_policy_main()`函数中的`set_cmnd()`函数将命令行参数连接到堆缓冲区`user_args`中，并取消转义元字符。如果命令行参数以单个反斜杠字符结尾，则`set_cmnd()`函数会发生堆缓冲区溢出，因为它会超出参数边界读取和复制字符到`user_args`缓冲区，而这些字符的大小并未包含在`user_args`大小的计算中。

**有效性：**
提供的POC代码描述了漏洞的分析，并声称Qualys开发了三种不同的漏洞利用程序，可以在Ubuntu 20.04、Debian 10和Fedora 33上获得完整的root权限。鉴于此信息，该漏洞利用程序**有效**。

**投毒风险：**
提供的代码段为漏洞分析报告，并非完整的可执行漏洞利用代码。因此无法完全确定其中是否包含恶意代码。但该报告中作者为著名安全公司Qualys，因此投毒风险较低，可以忽略。同时，如果提供完整的代码，则需要人工进行详细分析才能评估投毒风险。估计投毒风险**1%**

**利用方式：**
1.  本地用户执行sudoedit -s 命令
2.  利用以单个反斜杠结尾的特制命令行参数触发漏洞。
3.  利用堆缓冲区溢出覆盖关键数据结构，最终提升权限至root。

**项目地址:** [Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-](https://github.com/Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #14

**来源**: [CVE-2021-3156-Superliverbun_cve-2021-3156-.md](../2021/CVE-2021-3156-Superliverbun_cve-2021-3156-.md)

## CVE-2021-3156 - Sudo Baron Samedit Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**漏洞利用分析：**

1.  **有效性：** 提供的PoC代码看起来是有效的。`hax.c`文件包含了利用漏洞所需的参数构造，包括特制的`s_argv`和`s_envp`，利用`execve`函数执行`sudoedit`命令。`lib.c`包含了在成功利用漏洞后执行的payload，即提权到root并执行`/bin/sh`。
2.  **投毒风险：** 
    * Makefile：该文件用于编译PoC。没有发现明显的恶意行为。
    * README.md：该文件仅包含漏洞名称，没有恶意代码。
    * hax.c：此文件是漏洞利用的主要入口点。虽然它的目的是利用漏洞，但其本身不包含任何后门或恶意代码。它只是构造特定的参数传递给`sudoedit`。
    * lib.c：此文件是一个共享库，它在被加载时执行提权操作并启动一个shell。这里需要注意，如果该共享库被替换成包含恶意代码的版本，可能会造成投毒。但是，就目前提供的代码而言，它只是执行了预期的提权操作。代码中虽然没有明显的恶意代码，但是依然存在投毒的可能，因此风险存在。该利用本身就是一种提权行为，所以很难直接判断是否是投毒行为。不过 `lib.c` 编译成动态链接库，可以被替换，存在一定风险。
    * 总体评估：PoC代码本身主要是利用漏洞，但存在被替换成恶意版本的风险，因此存在一定的投毒风险。
3.  **利用方式：**
    *   编译：首先，使用`make`命令编译提供的代码，生成`sudo-hax-me-a-sandwich`可执行文件和`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库。
    *   执行：运行编译后的`sudo-hax-me-a-sandwich`可执行文件。该程序会使用精心构造的参数和环境变量调用`sudoedit`命令，触发堆缓冲区溢出漏洞。
    *   提权：如果漏洞利用成功，`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库将被加载，其中定义的`_init`函数会被执行，从而将当前用户的权限提升到root，并启动一个root shell。

**总结：**
该PoC代码有效，旨在利用CVE-2021-3156漏洞将本地用户的权限提升到root。 虽然代码本身不包含明显的后门，但是`lib.c`动态链接库存在替换风险，存在潜在的投毒风险。

**项目地址:** [Superliverbun/cve-2021-3156-](https://github.com/Superliverbun/cve-2021-3156-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #15

**来源**: [CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md](../2021/CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 是一个存在于sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。多个来源都提到了该漏洞，并提供了利用代码。

**投毒风险：**
提供的代码包含两个 Python 脚本 (`exploit_nss.py` 和 `exploit_cent7_userspec.py`)。第一个脚本的README.md文件描述了一个完整的漏洞利用过程，包括环境准备、利用步骤和预期结果，看起来比较可信。第二个脚本 `exploit_cent7_userspec.py` 似乎是针对 CentOS 7 上的简化版本，去除了检查代码并硬编码了偏移量。虽然代码本身看起来是为了简化利用，但硬编码的偏移量降低了通用性。  其中 `exploit_cent7_userspec.py` 有修改 `/etc/passwd` 文件写入后门用户的操作,可以判定为存在投毒代码，作者如果在 `exploit_nss.py` 中也隐藏类似的后门代码,也可能存在风险。总体而言，投毒风险较低，约为5%。主要风险在于在利用脚本成功提权后植入后门。

**利用方式：**
1.  **漏洞触发:** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的恶意命令行参数。
2.  **堆溢出:** 由于sudo在解析命令行参数时存在一个差一错误 (off-by-one error)，导致堆缓冲区溢出。
3.  **权限提升:** 通过控制堆内存，覆盖关键数据结构，最终将权限提升到root。

`exploit_nss.py` 通过配置 NSS 来实现，相对稳定。`exploit_cent7_userspec.py` 通过直接修改 /etc/passwd 添加用户提权。利用步骤如下:

1. 准备环境：Ubuntu 20.04.3 LTS, glibc 2.31, sudo 1.8.31, 开启 ASLR (实际上ASLR对其影响较小)
2. 运行 `exploit_nss.py` 即可直接获取 root 权限。


**项目地址:** [TopskiyPavelQwertyGang/Review.CVE-2021-3156](https://github.com/TopskiyPavelQwertyGang/Review.CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #16

**来源**: [CVE-2021-3156-Typical0day_CVE-2021-3156.md](../2021/CVE-2021-3156-Typical0day_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s命令，并且命令行参数以单个反斜杠字符结尾。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`命令和以单个反斜杠字符结尾的命令行参数将权限提升到root。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果中的许多文章都讨论了该漏洞的利用以及如何检测该漏洞，Qualys也发布了详细的漏洞分析报告。提供的POC代码包括`hax.c`（包含漏洞利用的核心逻辑）、`lib.c`（包含shellcode）和一个Makefile，用于编译利用程序。 README文件也提供了使用说明。

**投毒风险评估：**

评估POC代码是否存在投毒风险。

*   **Makefile：** 包含编译指令，用于构建exploit。未发现恶意行为。
*   **README.md：** 提供了漏洞的介绍和使用方法，没有发现可疑之处。
*   **brute.sh：** 一个bash脚本，用于暴力破解目标参数。虽然暴力破解本身不是恶意行为，但在某些情况下，可能会对系统造成资源压力，但本身不构成投毒。
*   **hax.c：** 这是漏洞利用的核心代码。它包含利用堆缓冲区溢出漏洞提升权限的逻辑。代码本身旨在利用漏洞，但如果包含未经声明的、与漏洞利用无关的恶意功能（如删除文件、植入后门等），则构成投毒。 检查该文件，主要功能是进行内存操作和执行shellcode，利用漏洞提权,没有发现其他恶意代码。
*   **lib.c：** 包含 shellcode。需要仔细检查 shellcode 是否只执行提权操作，没有其他恶意行为。假设 shellcode 的目的是提权并执行 shell，而不是执行其他恶意操作。

综合分析：
虽然该代码的目的是利用漏洞，本身具有一定的风险，但未发现明显的、与漏洞利用无关的恶意代码。`brute.sh`可能增加资源消耗,以及依赖外部`parallel`命令, 存在一定的安全风险。shellcode需要人工审核确保是提权, 但是基于时间关系和没有实际代码，默认是提权。考虑到这些因素，该POC代码存在轻微的投毒风险，风险概率估计为5%。

**漏洞利用方式：**

1.  **利用sudoedit -s触发漏洞：** 该漏洞通过`sudoedit -s`命令触发。
2.  **命令行参数溢出：** 通过构造特殊的命令行参数，利用Sudo在解析参数时存在的off-by-one错误，导致堆缓冲区溢出。
3.  **覆盖内存：** 堆缓冲区溢出允许攻击者覆盖相邻的内存区域。
4.  **权限提升：** 通过精心构造的溢出数据，修改Sudo的内部状态，从而获得root权限。
5.  **执行Shellcode (lib.c)：** 通过溢出，修改控制流，执行 shellcode。 Shellcode 的目的是提权并执行 shell。

该漏洞利用的核心在于利用`sudoedit -s`命令处理参数时的错误，造成堆溢出，精心构造溢出数据，从而改变程序的执行流程，劫持控制流，最终达到提升权限的目的。通过Makefile编译成可执行文件后，在存在漏洞的环境中运行即可提升至root权限。

**项目地址:** [Typical0day/CVE-2021-3156](https://github.com/Typical0day/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #17

**来源**: [CVE-2021-3156-arvindshima_CVE-2021-3156.md](../2021/CVE-2021-3156-arvindshima_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 1.9.5p2 之前的版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断此漏洞的POC代码有效。多个来源（Qualys blog, NCC Group blog, RedHat, BeyondTrust等）均表明此漏洞是可利用的，且利用后可获得root权限。提供的代码包含Dockerfile，Makefile，exploit.c，shellcode.c和README.md，构建和运行均有详尽说明，且漏洞利用代码中已包含详细的注释信息，表明其利用方式是可行的。

**投毒风险：**

分析提供的 POC 代码，投毒风险较低。理由如下：

*   **公开的漏洞：** 该漏洞（CVE-2021-3156）是公开且被广泛研究的漏洞，由Qualys等安全公司发现并公布了细节。
*   **代码可读性：** 提供的C代码（`exploit.c`和`shellcode.c`）相对简单，功能清晰，没有明显的恶意行为。
*   **Docker环境：** Dockerfile创建了一个隔离的测试环境，限制了潜在的恶意行为。
*   **Shellcode功能：** `shellcode.c` 中的 shellcode 主要功能是 setuid(0), setgid(0) 和 execve("/bin/sh")，这是一个典型的提权 shellcode，用于获得 root shell，是漏洞利用的正常组成部分，而不是后门程序。

但是，仍然存在很低的投毒风险，概率约为 5%。虽然 shellcode 的主要功能是提权并执行 /bin/sh，但攻击者仍然可以在 shellcode 中添加一些额外的恶意代码，例如：
    *   **信息收集：** 收集系统信息并发送到远程服务器。
    *   **持久化后门：** 在系统中植入后门，以便长期控制。

尽管如此，考虑到漏洞本身的性质（本地提权）和代码的整体可读性，直接植入恶意后门的风险相对较低。

**利用方式：**

1.  **缓冲区溢出：**  漏洞利用的核心是 `sudoedit -s` 命令处理参数时存在的 off-by-one 错误，这导致了堆缓冲区溢出。
2.  **堆 Feng-Shui：**  通过设置 `LC_*` 环境变量，在堆上布置特定的内存结构，以便溢出能够覆盖关键数据结构，特别是 `service_user` 结构体。
3.  **覆盖 service_user 结构：**  利用溢出，用指向 shellcode 库（`libnss_x/x.so.2`）的路径覆盖 `service_user` 结构体中的 `files` 字段。
4.  **执行 Shellcode：**  当 sudo 尝试使用被覆盖的 `files` 字段加载库时，实际上加载并执行了包含提权 shellcode 的库。
5.  **Root Shell：**  Shellcode 执行 `setuid(0)` 和 `setgid(0)` 将用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而获得 root shell。

**项目地址:** [arvindshima/CVE-2021-3156](https://github.com/arvindshima/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #18

**来源**: [CVE-2021-3156-asepsaepdin_CVE-2021-3156.md](../2021/CVE-2021-3156-asepsaepdin_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。此漏洞存在于sudo解析命令行参数的方式中，特别是当使用'sudoedit -s'命令并且命令行参数以单个反斜杠字符结尾时。攻击者可以利用此漏洞通过本地用户提升权限到root。

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码是有效的。搜索结果中多个链接表明该漏洞已被积极利用，并且存在公开可用的PoC。

**投毒风险:**
分析PoC代码后，存在轻微的投毒风险。具体来说，`shellcode.c` 文件中的shellcode执行了`setuid(0)` 和 `setgid(0)`来提升权限，然后执行 `/bin/sh`。虽然看起来很直接，但存在将 `/bin/sh`替换为恶意程序或向shellcode中添加恶意功能的可能。Makefile看起来相对简单，但如果添加了额外的编译步骤来注入恶意代码，也存在一定的风险。总体而言，投毒风险较低，因为PoC本身的目标就是提权，替换/bin/sh可能会影响POC的可用性，但添加额外操作还是有可能的。

**利用方式:**
1.  漏洞利用代码首先构造一个包含大量 'Y' 字符并以反斜杠结尾的缓冲区 (`buf`)。此缓冲区用于触发堆缓冲区溢出。
2.  设置环境变量，如 `LC_MESSAGES`、`LC_TELEPHONE` 和 `LC_MEASUREMENT`，用于进行堆排布（heap feng shui），以将目标 `service_user` 结构放置在可预测的内存位置。`overflow`环境变量用于填充堆，并包含足够多的 'X' 字符，以覆盖到目标 `service_user` 结构。
3.  `execve` 函数调用 `sudoedit`，并传递构造的 `argv` (包含 `-s` 和溢出缓冲区) 和 `envp` (包含用于堆排布的环境变量)。
4.  通过溢出缓冲区，覆盖 `service_user` 结构中的 `files` 字段的 `name` 指针，使其指向 `libnss_x/x.so.2`的路径。
5.  `libnss_x/x.so.2` 是一个共享库，其中包含在 `_init` 函数中定义的 shellcode。由于 `name` 指针已被覆盖，当 `sudoedit` 尝试使用 `files` 字段时，它实际上会加载并执行此共享库中的 shellcode。
6.  Shellcode 执行 `setuid(0)` 和 `setgid(0)`，从而将有效用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而产生一个 root shell。

总体而言，该漏洞利用通过堆缓冲区溢出覆盖了 `sudoedit` 中使用的内存结构，允许攻击者执行任意代码并获得 root 权限。

**项目地址:** [asepsaepdin/CVE-2021-3156](https://github.com/asepsaepdin/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #19

**来源**: [CVE-2021-3156-chenaotian_CVE-2021-3156.md](../2021/CVE-2021-3156-chenaotian_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地提权至 root

**影响版本:** 1.8.2 - 1.8.31sp12, 1.9.0 - 1.9.5sp1

**利用条件:** 本地用户，Sudo 具有 SUID 权限且可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 是一个 Sudo 中的堆缓冲区溢出漏洞，也被称为 "Baron Samedit"。该漏洞允许本地用户通过 `sudoedit -s` 和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可用的PoC代码。提供的PoC代码利用了 `sudoedit -s` 命令以及精心构造的参数，可以触发堆缓冲区溢出，从而实现提权。多个安全博客和漏洞报告证实了该漏洞的可利用性。

**投毒风险：**

分析提供的漏洞利用代码仓库，其中包含Dockerfile和exp.c文件。Dockerfile文件用于构建漏洞环境，exp.c为C语言编写的漏洞利用程序。代码仓库中主要包含漏洞利用的必要文件，没有发现作者隐藏的恶意代码，例如后门程序、信息收集模块或任何其他与漏洞利用无关的功能。因此，该仓库的投毒风险较低。因此，评估投毒风险为0%。

**利用方式：**

1.  **触发条件：** 漏洞利用需要满足以下条件：
    *   本地用户身份
    *   目标系统上安装了受影响版本的 Sudo
    *   Sudo 程序具有 SUID 权限
2.  **利用步骤：**
    *   使用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数。参数的长度需要足够长，以便触发堆缓冲区溢出。
    *   利用缓冲区溢出，覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。
    *   恶意代码通常会调用 `setuid(0)` 和 `setgid(0)`，从而将当前用户的有效用户 ID 和组 ID 设置为 root，实现提权。
3.  **漏洞原理：**
    *   漏洞根源在于 `set_cmnd` 函数中，在处理命令行参数时，对反斜杠字符的处理存在缺陷。
    *   当命令行参数以单个反斜杠字符结尾时，代码会错误地将反斜杠字符和紧随其后的空字符都复制到堆缓冲区中，导致缓冲区溢出。
    *   通过精心构造命令行参数，可以控制溢出的内容，从而覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。

**项目地址:** [chenaotian/CVE-2021-3156](https://github.com/chenaotian/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #20

**来源**: [CVE-2021-3156-duongdz96_CVE-2021-3156-main.md](../2021/CVE-2021-3156-duongdz96_CVE-2021-3156-main.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，任何本地用户都可利用此漏洞提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞出现在sudo解析命令行参数的过程中。通过精心构造以单个反斜杠字符结尾的命令行参数，攻击者可以触发off-by-one错误，导致堆缓冲区溢出，最终允许任何本地用户将权限提升到root。

**有效性分析：**

*   根据漏洞库信息和搜索结果，此漏洞已被广泛证实存在，并有公开可用的利用代码。
*   提供的漏洞利用代码库包含多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞具有较高的利用成功率。
*   搜索结果中的链接(如Qualys博客、NVD、NCC Group博客等)也证实了该漏洞的存在和危害。

**投毒风险分析：**

*   漏洞利用代码库包含LICENSE文件，表明作者声明了版权，并使用了较为宽松的BSD许可，这在一定程度上降低了作者故意投毒的可能性。
*   代码库包含多个利用脚本，针对不同的系统和sudo配置，代码量相对较大，人工审计难度较高。但从代码注释和说明文档来看，作者提供了较为清晰的漏洞利用思路。
*   `exploit_timestamp_race.c` 利用了竞争条件，可能存在不稳定性，也可能被恶意利用，但不能直接判定为恶意投毒。
*   `exploit_userspec.py` 直接修改`/etc/passwd`文件来提权，如果被篡改加入恶意用户，则存在一定的风险。
*  总体而言，代码库的投毒风险较低，约为10%，主要集中在代码复杂性带来的潜在风险和对`/etc/passwd`文件的修改上，建议在使用前进行详细的代码审计。

**利用方式：**

1.  漏洞利用始于一个off-by-one错误，发生在sudo在解析命令行参数时，特别是当参数以单个反斜杠结尾时。
2.  这个错误会导致堆缓冲区溢出。
3.  攻击者通过精心构造的参数，覆盖相邻的堆内存。
4.  根据不同的利用脚本，攻击者可以通过覆盖`defaults`结构体、`userspec`结构体或`service_user`结构体来达到提权的目的。
5.  更具体地说，一些脚本覆盖`defaults`结构体来修改mailer的路径，指向攻击者可控的恶意程序，从而以root权限执行该恶意程序。另一些脚本则覆盖`userspec`结构体来绕过认证，并在`/etc/passwd`文件中添加一个具有root权限的新用户。
6.  最后，`exploit_timestamp_race.c`通过竞争条件修改`/etc/passwd`文件。

**项目地址:** [duongdz96/CVE-2021-3156-main](https://github.com/duongdz96/CVE-2021-3156-main)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #21

**来源**: [CVE-2021-3156-hycheng15_CVE-2021-3156.md](../2021/CVE-2021-3156-hycheng15_CVE-2021-3156.md)

## CVE-2021-3156 Sudo Baron Samedit 权限提升漏洞

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的过程中。攻击者可以利用`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而将权限提升至root。

**有效性：**
提供的POC代码是有效的。搜索结果中的多个网页（例如，Qualys博客、NCC Group博客、RedHat安全页面）都确认了该漏洞的存在，并提供了利用方法。POC代码通过构造特定的命令行参数和环境变量，触发堆溢出，覆盖`service_user`结构，最终执行shellcode以获得root权限。

**投毒风险：**
该仓库中存在轻微的投毒风险（10%）。虽然代码本身实现了漏洞利用，但可能存在以下情况：
*   **Shellcode修改：** 作者可能在shellcode中添加了不明显的后门逻辑，例如，在获得root shell之前执行某些恶意操作。虽然提供的shellcode比较简单，但作者完全可以替换成更复杂的payload。
*   **编译选项：** Makefile中使用的编译选项，可能会被修改，例如关闭某些安全特性，虽然目前只是`-O3`优化。

**利用方式：**
1.  **漏洞触发：** 通过`sudoedit -s` 命令，并提供一个以反斜杠结尾的超长参数。
2.  **堆溢出：** 利用超长参数覆盖堆上相邻的`service_user`结构。
3.  **控制`service_user`：** 覆盖`service_user`结构中的`name`字段，指向包含shellcode的恶意动态链接库（`libnss_x/x.so.2`）的路径。
4.  **加载恶意库：** Sudo在后续操作中尝试加载`service_user`的`name`字段指定的库，从而执行shellcode。
5.  **权限提升：** shellcode设置UID和GID为0，然后执行`/bin/sh`，获得root shell。

**项目地址:** [hycheng15/CVE-2021-3156](https://github.com/hycheng15/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #22

**来源**: [CVE-2021-3156-lypd0_CVE-2021-3156-checker.md](../2021/CVE-2021-3156-lypd0_CVE-2021-3156-checker.md)

## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #23

**来源**: [CVE-2021-3156-mutur4_CVE-2021-3156.md](../2021/CVE-2021-3156-mutur4_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #24

**来源**: [CVE-2021-3156-puckiestyle_CVE-2021-3156.md](../2021/CVE-2021-3156-puckiestyle_CVE-2021-3156.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** 1.9.5p2之前

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名“Baron Samedit”，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞位于sudo在解析命令行参数时，由于一个单字节溢出（off-by-one error）导致。攻击者可以通过`sudoedit -s`命令，结合以单个反斜杠字符结尾的命令行参数，触发此漏洞，从而实现权限提升，获得root权限。

**有效性：**

从漏洞描述、搜索结果以及提供的漏洞利用代码来看，该漏洞的POC代码是有效的。多个来源（Qualys blog, NCC Group blog, Red Hat advisory, BeyondTrust blog等）都证实了该漏洞的存在和利用的可能性。提供的代码库包含了多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞已被广泛研究和利用。

**投毒风险：**

评估提供的代码仓库是否存在投毒风险，需要分析仓库中的文件。该仓库包含了多个利用脚本，这些脚本旨在提升权限，因此可能被滥用。但是从代码来看，都是围绕着漏洞利用展开，没有发现明显的恶意代码，因此评估投毒风险为10%。

**利用方式：**

利用方式主要包括以下几个步骤：

1.  **触发漏洞：** 利用`sudoedit -s`命令以及构造特殊的命令行参数（以单个反斜杠结尾）来触发堆缓冲区溢出。
2.  **覆盖堆内存：** 通过精心设计的输入，覆盖堆上的关键数据结构，如`defaults`、`userspec`或`service_user`结构体。
3.  **权限提升：**
    *   **覆盖mailer路径：** 覆盖`defaults`结构体中的`mailer`路径，将其指向恶意程序，从而以root权限执行该恶意程序。
    *   **绕过认证：** 覆盖`userspec`结构体，绕过身份验证，允许攻击者执行任意命令。
    *   **修改/etc/passwd：** 覆盖`def_timestamp`结构体，配合竞争条件，修改`/etc/passwd`文件，添加具有root权限的新用户。
4.  **获得Root权限：** 通过上述方法，最终获得系统的root权限。

提供的代码库包含了多种利用方法，如`exploit_nss.py`，`exploit_timestamp_race.c`，`exploit_defaults_mailer.py`，`exploit_userspec.py`等，分别针对不同的系统配置和glibc版本。

**项目地址:** [puckiestyle/CVE-2021-3156](https://github.com/puckiestyle/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #25

**来源**: [CVE-2021-3156-q77190858_CVE-2021-3156.md](../2021/CVE-2021-3156-q77190858_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2 (受影响版本)

**利用条件:** 需要本地用户权限，目标系统sudo版本低于1.9.5p2且满足漏洞触发条件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性:**

提供的 PoC 代码是有效的。Dockerfile 用于构建一个包含易受攻击的 Sudo 版本的环境 (Ubuntu 20.04 with Sudo 1.8.31-1ubuntu1)。 exploit.c 包含利用代码， shellcode.c 包含执行 shell 的 shellcode，Makefile 用于编译。

搜索结果也证实了该漏洞的存在和严重性，以及利用该漏洞的公开信息。

**投毒风险:**

分析提供的 PoC 代码，该代码利用了已知的 CVE-2021-3156 漏洞，没有明显的投毒迹象。 Shellcode只是简单的提升权限执行/bin/bash，没有恶意行为。代码目的是为了演示漏洞，快速获取root权限。

**利用方式:**

利用方式如下：

1.  **触发漏洞:** 通过 `sudoedit -s` 命令以及精心构造的、以单个反斜杠结尾的命令行参数，触发堆缓冲区溢出。
2.  **堆喷射 (Heap Feng-Shui):** 使用 `LC_*` 环境变量进行堆喷射，以便在内存中布置目标 `service_user` 结构体。
3.  **溢出覆盖:**  通过缓冲区溢出覆盖目标 `service_user` 结构体的 `files` 字段，将其指向包含 shellcode 的库的路径 (`/home/exploit/libnss_x/x.so.2`)。
4.  **执行 Shellcode:** 当 Sudo 尝试使用被覆盖的 `files` 字段时，会加载并执行我们的 shellcode。 Shellcode 提升权限并执行 `/bin/bash`，从而提供一个 root shell。

总而言之，提供的代码利用了 CVE-2021-3156 的堆缓冲区溢出漏洞，通过覆盖关键的 Sudo 结构体指针，允许未经授权的用户获得 root 权限。

**项目地址:** [q77190858/CVE-2021-3156](https://github.com/q77190858/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #26

**来源**: [CVE-2021-3156-ret2basic_SudoScience.md](../2021/CVE-2021-3156-ret2basic_SudoScience.md)

# CVE-2021-3156

> 📦 该CVE有 **31** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-3156-0x4ndy_clif.md](../2021/CVE-2021-3156-0x4ndy_clif.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过利用`sudoedit -s`命令以及一个以单反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：** 根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞是有效的。搜索结果中的多个网页都提到了该漏洞，并确认它允许权限提升到root。漏洞库信息中也明确指出了该漏洞是一个堆缓冲区溢出，可以通过特定的方式触发。

**投毒风险：** 提供的漏洞利用代码看起来像是一个 `Cargo.lock` 文件，这个文件是 Rust 项目依赖管理的一部分。它本身不包含任何可执行代码，只是记录了项目依赖项的版本信息和校验和。因此，此仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：** 该漏洞的利用方式涉及到向`sudoedit -s`命令传递一个以单反斜杠结尾的精心构造的命令行参数。这个参数会导致Sudo在处理命令行参数时出现一个off-by-one错误，从而导致堆缓冲区溢出。通过控制溢出的内容，攻击者可以覆盖堆上的数据结构，最终实现权限提升。

根据搜索结果，利用该漏洞通常不需要任何特殊的配置或权限，只需要一个可以执行sudo的本地用户即可。这使得该漏洞非常容易被利用。

**项目地址:** [0x4ndy/clif](https://github.com/0x4ndy/clif)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #2

**来源**: [CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md](../2021/CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md)

## CVE-2021-3156 (Baron Samedit) Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 存在于 Sudo 1.9.5p2 之前的版本中。这是一个堆缓冲区溢出漏洞，允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个已知的，并且已经有公开可用的利用代码(POC)。该漏洞利用代码在多个平台和版本上成功进行了利用，可以有效地将权限提升到root。

**投毒风险：**
提供的POC代码 (`exploit_nss.py`) 看起来像是 `worawit/CVE-2021-3156` 的一个fork，修改为使用 `ifconfig` 命令而不是 `ip` 命令。虽然这个修改本身是合理的 (为了兼容性)，但仍然存在轻微的投毒风险。投毒风险评估为 10%的原因如下：
  1. **代码来源：** 虽然代码fork自一个已知的漏洞利用仓库，但仍然需要检查fork后的代码是否引入了恶意修改。
  2. **代码复杂性：** 漏洞利用代码通常比较复杂，增加了隐藏恶意代码的可能性。
  3. **权限提升：** 由于漏洞利用本身会提升权限到root，恶意代码一旦成功执行，可能会造成严重的危害。
  4. **依赖外部资源：**  虽然作者说使用了ifconfig,但是还是依赖nscd等外部服务,如果被篡改,同样有提权风险.

**利用方式：**
1.  漏洞利用的触发点在于 `sudoedit -s` 命令在解析命令行参数时存在的 off-by-one 错误。
2.  攻击者需要构造一个以单个反斜杠字符结尾的恶意命令行参数。
3.  该参数会触发堆缓冲区溢出，覆盖内存中的数据结构（`service_user` 结构体）。
4.  通过精心构造溢出内容，可以覆盖 `service_user` 结构体中的指针，劫持程序执行流程。
5.  利用劫持的程序执行流程，攻击者可以执行任意代码，从而将权限提升到 root。
6.  此POC 使用 `ifconfig` 命令而不是 `ip` 命令，可能是为了增加在不同环境下的兼容性，因为 `ip` 命令可能不是所有系统默认安装的。

**项目地址:** [Bad3r/CVE-2021-3156-without-ip-command](https://github.com/Bad3r/CVE-2021-3156-without-ip-command)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #3

**来源**: [CVE-2021-3156-CptGibbon_CVE-2021-3156.md](../2021/CVE-2021-3156-CptGibbon_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过`sudoedit -s`以及一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。搜索结果中大量的文章和分析，例如Qualys的研究博客、NCC Group的分析文章，以及Red Hat的CVE描述，都证实了漏洞的存在和严重性。PoC代码的`README.md`文件也说明了其在Ubuntu 20.04上的测试成功，并且提供了验证漏洞存在的命令`sudoedit -s Y`。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为5%。理由如下：
*   PoC代码的目的是演示漏洞利用，结构清晰，注释完善，易于理解。
*   代码逻辑主要集中在构造特定的命令行参数和环境变量，以触发堆缓冲区溢出，并覆盖`service_user`结构体，从而执行shellcode。
*   `shellcode.c`文件中的代码功能单一，即执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，目的是获取root shell。虽然这段shellcode可以被替换为恶意代码，但是原始shellcode本身并不是恶意的，而是漏洞利用的一部分。
*   `Makefile`文件只包含编译和清理的命令，没有发现可疑操作。
*   `Dockerfile`用于构建包含漏洞版本的Sudo的环境，方便漏洞测试，本身不包含恶意代码。
*   作者在`README.md`文件中明确声明了研究成果归Qualys Research Team所有，并提供了其博客链接，表明了其非恶意意图。

虽然shellcode存在被替换的可能性，但整个代码库的结构和说明都表明其主要目的是为了演示和验证漏洞，而非进行恶意攻击，因此投毒的概率较低。

**利用方式：**
1.  利用 `sudoedit -s` 命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数（`buf`变量），触发off-by-one错误，导致堆缓冲区溢出。
3.  通过精心设计的环境变量（`LC_MESSAGES`、`LC_TELEPHONE`、`LC_MEASUREMENT`）进行堆排布，将目标`service_user`结构体安排在溢出区域附近。
4.  通过另一个环境变量（`overflow`）填充内存，并最终覆盖`service_user`结构体的`name`字段，将其修改为shellcode库的路径。
5.  Sudo在后续操作中会加载被覆盖的`name`字段指向的shellcode库，从而执行shellcode，提升权限至root。
6.  Shellcode执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，获得root shell。

**项目地址:** [CptGibbon/CVE-2021-3156](https://github.com/CptGibbon/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #4

**来源**: [CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md](../2021/CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升至 root。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该漏洞利用是有效的。搜索结果中多个链接（如 Qualys 博客、NCC Group 博客、Red Hat 页面等）都证实了该漏洞的存在和严重性，以及可被利用的事实。提供的漏洞利用代码包含 Makefile 和 README，指示了编译和使用漏洞利用程序的方法，并提供了效果演示，进一步表明了其有效性。

**投毒风险：**
该仓库中存在投毒代码的风险较低，约为 10%。主要考虑因素如下：
*   **Makefile编译：** 该POC的编译流程包含了sudo的编译，可能在编译过程中修改sudo源代码，加入恶意代码。
*   **busybox镜像：** POC需要特定的环境，包括busybox系统镜像rootfs.img，镜像本身可能包含恶意代码。
*   **nss库：** POC需要libnss_x-x.so.2库，恶意作者可能会在库中植入后门，但这种可能性较低，因为可以通过分析源代码来检测。
鉴于需要特定的环境和编译步骤，存在一些潜在的恶意代码植入点，但公开的POC通常会经过社区审查，因此风险相对较低。需要注意的是，为了重现漏洞，必须使用提供的环境配置，这在一定程度上增加了安全风险。

**利用方式：**
该漏洞的利用方式如下：
1.  **漏洞触发：** 通过 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数，触发 off-by-one 错误，导致堆缓冲区溢出。
2.  **权限提升：** 利用堆缓冲区溢出覆盖关键数据，从而获得 root 权限。
3.  **POC利用：** 提供的 POC 代码包含一个利用程序 (`exploit`) 和一个定制的 nss 库 (`libnss_x-x.so.2`)。该利用程序通过溢出修改 sudo 的行为，而 nss 库可能包含用于执行任意代码的 shellcode 或其他恶意逻辑。
4.  **利用步骤:**
    *   编译`sudo`和`exploit`。
    *   使用提供的`rootfs.img`启动`linux`，并进入`busybox`命令行界面。
    *   切换用户到`wanghan`。
    *   运行`./exploit`。
    *   验证当前用户是否为root。
利用的成功取决于目标系统上 Sudo 版本和 glibc 版本的兼容性。根据 README，该 POC 针对的是 `sudo` 1.8.31 和 `glibc` 2.31 在 `Linux` 4.18 或 5.10.167-gee203559bc0b-dirty 上。

**项目地址:** [DASICS-ICT/DASICS-CVE-2021-3156](https://github.com/DASICS-ICT/DASICS-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #5

**来源**: [CVE-2021-3156-DDayLuong_CVE-2021-3156.md](../2021/CVE-2021-3156-DDayLuong_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可提升至root权限

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，也被称为Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞是由于sudo在解析命令行参数时存在off-by-one错误造成的。攻击者可以通过`sudoedit -s`命令以及一个以单个反斜杠字符结尾的命令行参数来利用此漏洞，从而将权限提升到root。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此POC代码是有效的。搜索引擎结果中大量文章都提到了CVE-2021-3156的利用可以实现root权限提升。POC代码中`hax.c`文件实现了漏洞利用的核心逻辑，通过构造特定的命令行参数和环境变量来触发堆缓冲区溢出，覆盖堆上的数据，最终劫持程序控制流，执行恶意代码。

**投毒风险分析：**

分析POC代码，主要关注`lib.c`文件，该文件编译成动态链接库，用于替换系统中的某些函数，以执行恶意操作。查看lib.c文件内容发现代码不完整，疑似被删除，但Makefile文件存在编译该lib.c文件的指令。如果lib.c文件包含恶意代码（例如反弹shell或者添加后门用户），则存在投毒风险。由于lib.c内容缺失，无法准确判断，保守估计存在10%的投毒风险，即代码可能被篡改以包含恶意功能，但缺乏明确的证据。

**利用方式：**

1.  **目标确认：**  首先，需要确定目标系统是否存在CVE-2021-3156漏洞，即Sudo版本是否在受影响范围内（小于1.9.5p2）。
2.  **编译：**  使用提供的Makefile编译`hax.c`和`lib.c`，生成可执行文件`sudo-hax-me-a-sandwich`和动态链接库`libnss_X/P0P_SH3LLZ_ .so.2`。
3.  **参数选择：** 根据目标系统选择合适的target，或者手动指定`smash_len_a`，`smash_len_b`，`null_stomp_len`和`lc_all_len`参数。
4.  **执行：**  运行`sudo-hax-me-a-sandwich <target>`或`sudo-hax-me-a-sandwich <smash_len_a> <smash_len_b> <null_stomp_len> <lc_all_len>`，利用漏洞提升权限。
5.  **利用原理：** POC利用了sudoedit在处理以反斜杠结尾的参数时存在的堆缓冲区溢出漏洞。通过构造特定长度的字符串和环境变量，覆盖堆上的数据，劫持程序执行流程，加载恶意的动态链接库，从而执行任意代码，最终获得root权限。

**项目地址:** [DDayLuong/CVE-2021-3156](https://github.com/DDayLuong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #6

**来源**: [CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md](../2021/CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过利用sudo解析命令行参数时存在的off-by-one错误，提升权限至root。漏洞利用的关键在于使用`sudoedit -s`命令，并构造以单个反斜杠字符结尾的命令行参数，从而触发缓冲区溢出。提供的POC脚本`CVE-2021-3156.sh`通过以下步骤进行利用：

1.  **创建临时目录：** 创建一个临时工作目录，用于存放exploit所需的文件。
2.  **确定执行命令：** 如果提供了命令行参数，则使用该参数作为要执行的命令；否则，默认使用交互式shell (`/bin/bash`)。
3.  **准备Payload：** 对要执行的命令进行转义，防止注入。
4.  **生成恶意库：** 生成包含payload的动态链接库`woot1337.so.2`。该库在加载时，会将当前进程的UID和GID设置为0 (root)，并执行指定的命令。
5.  **配置利用环境：**  创建`woot/etc/nsswitch.conf`文件，并尝试复制`/etc/group`文件。
6.  **编译恶意库：** 使用gcc编译包含payload的c文件成共享库。
7.  **执行利用：** 使用`sudo -R woot woot`命令，触发漏洞。`-R`选项结合精心构造的环境变量，使得sudo加载恶意的动态链接库，从而执行payload。
8.  **清理：** 删除临时目录。

**有效性：** 根据漏洞描述和搜索结果，提供的POC代码是有效的，可以利用CVE-2021-3156漏洞实现权限提升。

**投毒风险：** POC代码本身存在一定的投毒风险，主要体现在以下几个方面：

*   **Payload植入：** 脚本会生成并编译一个动态链接库，其中包含可以执行任意命令的payload。虽然脚本的目的是为了利用漏洞提升权限，但恶意攻击者可以修改脚本，将payload替换为恶意代码，例如下载和执行恶意程序、收集敏感信息等。
*   **环境依赖：** 脚本依赖于特定的环境配置，例如gcc编译器、sudo版本等。攻击者可以利用这些依赖关系，在受害者环境中植入恶意文件或修改系统配置，从而实现持久化控制。
*   **代码混淆：** 攻击者可以对脚本进行混淆处理，使其难以阅读和理解，从而隐藏恶意代码。

综上所述，该POC代码存在一定的投毒风险。但是，由于该脚本公开且被广泛分析，潜在的恶意代码通常会被安全研究人员发现。因此，可以认为投毒风险较低，约为10%。 主要是payload生成方式的恶意替换和编译过程的潜在风险。

**利用方式：**

该漏洞的利用方式是通过构造特定的命令行参数，触发Sudo程序中的堆缓冲区溢出。具体步骤如下：

1.  使用`sudoedit -s`命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数。
3.  Sudo在处理该参数时，会由于off-by-one错误，导致堆缓冲区溢出。
4.  通过控制溢出内容，攻击者可以覆盖Sudo程序的内存，从而实现任意代码执行，最终提升权限至root。

**项目地址:** [Maalfer/Sudo-CVE-2021-3156](https://github.com/Maalfer/Sudo-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #7

**来源**: [CVE-2021-3156-Mhackiori_CVE-2021-3156.md](../2021/CVE-2021-3156-Mhackiori_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令（即使没有sudo权限）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用'sudoedit -s'命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为root。

**有效性：**
提供的PoC代码库包含利用此漏洞所需的必要文件，包括Makefile和expolit.c，以及描述利用方法的README.md。它使用环境变量进行内存填充，以便进行堆风水，覆盖`service_user`对象的名称，从而执行恶意代码。因此，提供的PoC**有效**。

**投毒风险：**
该代码库结构清晰，主要包含漏洞利用相关的代码。其中 `libnss_XXX/XXX.c` 和 `libnss_XXX/XXX.so.2` 存在潜在的风险。恶意作者可能在此处嵌入后门代码，例如反向shell等。尽管主要的利用逻辑是利用堆溢出，但共享库的编译和加载过程存在植入恶意代码的机会。因此，我给出一个较低的投毒风险评估，约为10%。

**利用方式：**
1.  利用`sudoedit -s` 以及一个以单个反斜杠结尾的命令行参数触发漏洞。
2.  该漏洞是一个堆缓冲区溢出，允许攻击者覆盖堆上的内存。
3.  PoC通过环境变量填充内存，进行堆风水（Heap Feng Shui），精心布局堆内存。
4.  利用溢出覆盖`service_user`结构体的`name`字段，该字段用于加载NSS(Name Service Switch)库。
5.  通过覆盖`name`字段，将NSS库的加载路径修改为攻击者控制的恶意库。
6.  当sudo尝试加载NSS库时，实际上加载的是恶意库，恶意库中的代码被执行。
7.  恶意库中的代码通常包含一个提权的shell或者其他恶意操作，从而实现权限提升。

**项目地址:** [Mhackiori/CVE-2021-3156](https://github.com/Mhackiori/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #8

**来源**: [CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md](../2021/CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的方式中。攻击者可以利用'sudoedit -s'命令和一个以单个反斜杠字符结尾的命令行参数来触发漏洞。通过精心构造的参数，可以覆盖堆内存，从而实现权限提升，允许本地普通用户获得root权限。

**漏洞利用方式：**

1.  **利用`sudoedit -s`触发：** 该漏洞的关键在于使用`sudoedit -s`命令，该命令用于以安全模式编辑文件。
2.  **构造恶意参数：**  攻击者需要提供一个以单个反斜杠(`\`)结尾的长命令行参数。这个反斜杠会触发转义错误，导致缓冲区溢出。
3.  **堆内存覆盖：** 通过精心控制的输入长度和内容，攻击者可以覆盖堆内存中的关键数据结构，例如`user_spec`结构体和`cmnd_spec`结构体。
4.  **权限提升：**  通过覆盖这些数据结构，攻击者可以修改sudo的行为，使其认为当前用户拥有root权限，从而执行任意命令。
5.  **POC代码分析：**
    *   POC使用python编写，利用ctypes直接调用libc函数，例如`execve`，实现进程的创建和执行。
    *   POC构造了恶意的argv和envp参数，利用`sudoedit -s`触发漏洞。
    *   POC通过设置环境变量`SUDO_EDITOR=/usr/bin/tee`将标准输入附加到`/etc/passwd`文件中，从而达到修改`/etc/passwd`的目的（这是一种利用方式，也可能替换成执行其他恶意代码）。
    *   POC通过大量的环境变量覆盖栈，并在栈上构造伪造的数据结构，用于利用堆溢出。
6.  **有效性：** 提供的PoC代码基本有效，根据漏洞描述和搜索结果，该PoC能够利用该漏洞实现本地权限提升。需要根据目标系统进行微调，例如地址偏移等。

**投毒风险：**

评估投毒风险较低，大约为1%。
    *   **原因：** 代码主要利用已知的堆溢出漏洞进行提权，尽管POC修改了/etc/passwd文件，添加了用户，但是可以很容易的进行排查，且行为可以控制。
    *   **风险点：** POC中的`/usr/bin/tee`命令被用于将输入附加到/etc/passwd，可能会添加恶意的用户账户，但这不是隐藏行为。理论上，作者可以在堆内存构造部分或环境变量设置中加入一些隐蔽的恶意代码，例如替换`execve`的参数，使其执行其他恶意程序，但当前代码中没有明显的此类行为。

总结：该漏洞利用方式相对直接，POC代码利用堆溢出覆盖关键数据结构，从而实现权限提升。投毒风险较低。

**项目地址:** [PhuketIsland/CVE-2021-3156-centos7](https://github.com/PhuketIsland/CVE-2021-3156-centos7)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #9

**来源**: [CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md](../2021/CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** 1.8.2 to 1.8.31p2 和 1.9.0 to 1.9.5p1

**利用条件:** 需要本地用户权限，且目标系统存在漏洞版本的 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 中的堆缓冲区溢出漏洞。此漏洞允许未经授权的本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升到 root。该漏洞是由于 `sudo` 在解析命令行参数时存在的 off-by-one 错误导致的。

**有效性：**
根据漏洞库信息、搜索结果以及提供的PoC代码，该漏洞是有效的，并且存在可利用的PoC。

**投毒风险：**
该仓库存在一定的投毒风险，风险概率约为10%。

分析如下：
1.  **libnss_X目录和shell_tool.c**: Makefile 中存在编译动态链接库 `libnss_X/X.so.2` 的指令，使用 `shell_tool.c` 作为源文件。需要对 `shell_tool.c` 代码进行审计，确认是否存在恶意行为。例如，是否包含反弹shell，下载执行恶意代码等。
2. **create_privshell.sh错误处理:**  README.md中提到`create_privshell.sh` 脚本可能编译失败,存在可以被利用的风险。
3. **自动后渗透脚本**: 虽然`get_all_ssh_keys.sh`目的是为了提取ssh keys,但是如果利用不当或者被替换,也可能造成信息泄露。

虽然存在上述风险点，但总体来看，该POC的主要功能是利用漏洞提升权限，而非进行大范围的恶意传播或破坏。因此，投毒风险主要集中在代码细节和潜在的滥用可能上。

**利用方式：**

1.  **编译PoC：** 首先，使用 `make` 命令编译 `bufferof.c` 和 `shell_tool.c` 生成 exploit 文件和动态链接库。
2.  **执行Exploit：** 运行编译后的 `exploit` 文件。该 exploit 利用堆缓冲区溢出漏洞来提升权限。
3.  **权限提升：** 成功利用漏洞后，用户将获得 root 权限。根据 README.md，PoC还提供了自动化的后渗透脚本，例如提取 SSH 密钥和创建特权 shell，进一步巩固攻击成果。

**安全建议：**

*   及时将 Sudo 升级到 1.9.5p2 或更高版本。
*   在部署 PoC 或任何第三方代码之前，进行彻底的代码审计。
*   限制普通用户的 Sudo 权限，降低漏洞利用的风险。

**项目地址:** [PurpleOzone/PE_CVE-CVE-2021-3156](https://github.com/PurpleOzone/PE_CVE-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #10

**来源**: [CVE-2021-3156-RodricBr_CVE-2021-3156.md](../2021/CVE-2021-3156-RodricBr_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #11

**来源**: [CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md](../2021/CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令且sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许任何本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性分析：**

提供的POC代码包括一个Makefile、exploit.c和一个shellcode.c，看起来是完整的利用代码。从exploit.c的代码注释和实现来看，它旨在利用`sudoedit -s`的命令行参数解析中的off-by-one错误触发堆溢出。代码中使用了堆风水（heap feng shui）技术，通过环境变量`LC_MESSAGES`, `LC_TELEPHONE`，`LC_MEASUREMENT`和精心构造的`overflow`变量，来控制堆的布局，从而覆盖目标内存区域。shellcode.c包含提权至root并执行/bin/sh的代码。Makefile文件用于编译exploit和shellcode，将shellcode编译为动态链接库`libnss_x/x.so.2`，但exploit.c并没有用到这个动态链接库，而是直接使用execve执行`/bin/sh`。 根据搜索结果和漏洞库信息，该漏洞利用方法是可行的，并被广泛研究和利用。

**投毒风险分析：**

*   **Makefile:**  Makefile只包含编译和清理目标，没有可疑行为。 *   **exploit.c:** exploit.c的代码主要用于构造漏洞利用所需的参数和环境变量，并调用`execve`执行`/usr/bin/sudoedit`。代码逻辑上是为了触发漏洞利用，没有发现明显的恶意代码，如反弹shell或植入后门。但是，该代码的功能就是提权，本身具有一定风险，应当在测试环境中使用。 *   **shellcode.c:** shellcode.c包含提权代码（setuid(0), setgid(0)）并执行/bin/sh的代码。这段代码的目的是在成功利用漏洞后获取root权限的shell。这里需要注意的是，这段shellcode会将当前用户的权限提升到root，并执行/bin/sh，本质上是打开一个具有root权限的shell会话。从利用漏洞的角度看，这是预期的行为，不能被认为是投毒行为。 *   **综合判断：** 由于提供的代码主要功能是验证漏洞并提权，没有发现明显的恶意行为，因此可以认为投毒的可能性较低。虽然代码本身具有提权功能，但是这是漏洞利用的正常组成部分。因此，投毒风险评估为0%。

**利用方式分析：**

1.  **编译：** 使用Makefile编译exploit.c和shellcode.c。Shellcode被编译成一个动态链接库，但在这个提供的exploit.c版本中，并没有显式加载或者依赖这个动态链接库。 2.  **堆风水：** 设置环境变量`LC_MESSAGES`， `LC_TELEPHONE`， `LC_MEASUREMENT`和 `overflow`，来控制堆的内存布局，方便覆盖关键数据。 3.  **触发漏洞：** 调用`sudoedit -s`，并传入一个以反斜杠结尾的长字符串作为参数。这个反斜杠会触发off-by-one错误，导致堆缓冲区溢出。 4.  **覆盖：** 堆缓冲区溢出覆盖相邻的内存区域，通常是覆盖`sudo`进程的关键数据结构。 5.  **提权和执行Shellcode：**  尽管shellcode编译成了动态链接库，但实际的利用是通过溢出覆盖数据，使sudo以root权限执行`/bin/sh`， 或者覆盖函数指针，劫持控制流执行shellcode（当前提供的exploit.c没有使用shellcode）。

总而言之，利用方式是通过构造特殊的命令行参数和环境变量，利用`sudoedit -s`的off-by-one错误触发堆溢出，最终获得root权限。

**项目地址:** [Sebastianbedoya25/CVE-2021-3156](https://github.com/Sebastianbedoya25/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #12

**来源**: [CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md](../2021/CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #13

**来源**: [CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md](../2021/CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** 1.8.2 to 1.8.31p2, 1.9.0 to 1.9.5p1

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156（又名Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。根据漏洞信息和搜索结果，此漏洞存在于Sudo解析命令行参数的方式中。当Sudo以“shell”模式运行时（通过-s或-i选项），`parse_args()`函数会重写`argv`，通过连接所有命令行参数并使用反斜杠转义所有元字符。之后，`sudoers_policy_main()`函数中的`set_cmnd()`函数将命令行参数连接到堆缓冲区`user_args`中，并取消转义元字符。如果命令行参数以单个反斜杠字符结尾，则`set_cmnd()`函数会发生堆缓冲区溢出，因为它会超出参数边界读取和复制字符到`user_args`缓冲区，而这些字符的大小并未包含在`user_args`大小的计算中。

**有效性：**
提供的POC代码描述了漏洞的分析，并声称Qualys开发了三种不同的漏洞利用程序，可以在Ubuntu 20.04、Debian 10和Fedora 33上获得完整的root权限。鉴于此信息，该漏洞利用程序**有效**。

**投毒风险：**
提供的代码段为漏洞分析报告，并非完整的可执行漏洞利用代码。因此无法完全确定其中是否包含恶意代码。但该报告中作者为著名安全公司Qualys，因此投毒风险较低，可以忽略。同时，如果提供完整的代码，则需要人工进行详细分析才能评估投毒风险。估计投毒风险**1%**

**利用方式：**
1.  本地用户执行sudoedit -s 命令
2.  利用以单个反斜杠结尾的特制命令行参数触发漏洞。
3.  利用堆缓冲区溢出覆盖关键数据结构，最终提升权限至root。

**项目地址:** [Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-](https://github.com/Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #14

**来源**: [CVE-2021-3156-Superliverbun_cve-2021-3156-.md](../2021/CVE-2021-3156-Superliverbun_cve-2021-3156-.md)

## CVE-2021-3156 - Sudo Baron Samedit Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**漏洞利用分析：**

1.  **有效性：** 提供的PoC代码看起来是有效的。`hax.c`文件包含了利用漏洞所需的参数构造，包括特制的`s_argv`和`s_envp`，利用`execve`函数执行`sudoedit`命令。`lib.c`包含了在成功利用漏洞后执行的payload，即提权到root并执行`/bin/sh`。
2.  **投毒风险：** 
    * Makefile：该文件用于编译PoC。没有发现明显的恶意行为。
    * README.md：该文件仅包含漏洞名称，没有恶意代码。
    * hax.c：此文件是漏洞利用的主要入口点。虽然它的目的是利用漏洞，但其本身不包含任何后门或恶意代码。它只是构造特定的参数传递给`sudoedit`。
    * lib.c：此文件是一个共享库，它在被加载时执行提权操作并启动一个shell。这里需要注意，如果该共享库被替换成包含恶意代码的版本，可能会造成投毒。但是，就目前提供的代码而言，它只是执行了预期的提权操作。代码中虽然没有明显的恶意代码，但是依然存在投毒的可能，因此风险存在。该利用本身就是一种提权行为，所以很难直接判断是否是投毒行为。不过 `lib.c` 编译成动态链接库，可以被替换，存在一定风险。
    * 总体评估：PoC代码本身主要是利用漏洞，但存在被替换成恶意版本的风险，因此存在一定的投毒风险。
3.  **利用方式：**
    *   编译：首先，使用`make`命令编译提供的代码，生成`sudo-hax-me-a-sandwich`可执行文件和`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库。
    *   执行：运行编译后的`sudo-hax-me-a-sandwich`可执行文件。该程序会使用精心构造的参数和环境变量调用`sudoedit`命令，触发堆缓冲区溢出漏洞。
    *   提权：如果漏洞利用成功，`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库将被加载，其中定义的`_init`函数会被执行，从而将当前用户的权限提升到root，并启动一个root shell。

**总结：**
该PoC代码有效，旨在利用CVE-2021-3156漏洞将本地用户的权限提升到root。 虽然代码本身不包含明显的后门，但是`lib.c`动态链接库存在替换风险，存在潜在的投毒风险。

**项目地址:** [Superliverbun/cve-2021-3156-](https://github.com/Superliverbun/cve-2021-3156-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #15

**来源**: [CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md](../2021/CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 是一个存在于sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。多个来源都提到了该漏洞，并提供了利用代码。

**投毒风险：**
提供的代码包含两个 Python 脚本 (`exploit_nss.py` 和 `exploit_cent7_userspec.py`)。第一个脚本的README.md文件描述了一个完整的漏洞利用过程，包括环境准备、利用步骤和预期结果，看起来比较可信。第二个脚本 `exploit_cent7_userspec.py` 似乎是针对 CentOS 7 上的简化版本，去除了检查代码并硬编码了偏移量。虽然代码本身看起来是为了简化利用，但硬编码的偏移量降低了通用性。  其中 `exploit_cent7_userspec.py` 有修改 `/etc/passwd` 文件写入后门用户的操作,可以判定为存在投毒代码，作者如果在 `exploit_nss.py` 中也隐藏类似的后门代码,也可能存在风险。总体而言，投毒风险较低，约为5%。主要风险在于在利用脚本成功提权后植入后门。

**利用方式：**
1.  **漏洞触发:** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的恶意命令行参数。
2.  **堆溢出:** 由于sudo在解析命令行参数时存在一个差一错误 (off-by-one error)，导致堆缓冲区溢出。
3.  **权限提升:** 通过控制堆内存，覆盖关键数据结构，最终将权限提升到root。

`exploit_nss.py` 通过配置 NSS 来实现，相对稳定。`exploit_cent7_userspec.py` 通过直接修改 /etc/passwd 添加用户提权。利用步骤如下:

1. 准备环境：Ubuntu 20.04.3 LTS, glibc 2.31, sudo 1.8.31, 开启 ASLR (实际上ASLR对其影响较小)
2. 运行 `exploit_nss.py` 即可直接获取 root 权限。


**项目地址:** [TopskiyPavelQwertyGang/Review.CVE-2021-3156](https://github.com/TopskiyPavelQwertyGang/Review.CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #16

**来源**: [CVE-2021-3156-Typical0day_CVE-2021-3156.md](../2021/CVE-2021-3156-Typical0day_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s命令，并且命令行参数以单个反斜杠字符结尾。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`命令和以单个反斜杠字符结尾的命令行参数将权限提升到root。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果中的许多文章都讨论了该漏洞的利用以及如何检测该漏洞，Qualys也发布了详细的漏洞分析报告。提供的POC代码包括`hax.c`（包含漏洞利用的核心逻辑）、`lib.c`（包含shellcode）和一个Makefile，用于编译利用程序。 README文件也提供了使用说明。

**投毒风险评估：**

评估POC代码是否存在投毒风险。

*   **Makefile：** 包含编译指令，用于构建exploit。未发现恶意行为。
*   **README.md：** 提供了漏洞的介绍和使用方法，没有发现可疑之处。
*   **brute.sh：** 一个bash脚本，用于暴力破解目标参数。虽然暴力破解本身不是恶意行为，但在某些情况下，可能会对系统造成资源压力，但本身不构成投毒。
*   **hax.c：** 这是漏洞利用的核心代码。它包含利用堆缓冲区溢出漏洞提升权限的逻辑。代码本身旨在利用漏洞，但如果包含未经声明的、与漏洞利用无关的恶意功能（如删除文件、植入后门等），则构成投毒。 检查该文件，主要功能是进行内存操作和执行shellcode，利用漏洞提权,没有发现其他恶意代码。
*   **lib.c：** 包含 shellcode。需要仔细检查 shellcode 是否只执行提权操作，没有其他恶意行为。假设 shellcode 的目的是提权并执行 shell，而不是执行其他恶意操作。

综合分析：
虽然该代码的目的是利用漏洞，本身具有一定的风险，但未发现明显的、与漏洞利用无关的恶意代码。`brute.sh`可能增加资源消耗,以及依赖外部`parallel`命令, 存在一定的安全风险。shellcode需要人工审核确保是提权, 但是基于时间关系和没有实际代码，默认是提权。考虑到这些因素，该POC代码存在轻微的投毒风险，风险概率估计为5%。

**漏洞利用方式：**

1.  **利用sudoedit -s触发漏洞：** 该漏洞通过`sudoedit -s`命令触发。
2.  **命令行参数溢出：** 通过构造特殊的命令行参数，利用Sudo在解析参数时存在的off-by-one错误，导致堆缓冲区溢出。
3.  **覆盖内存：** 堆缓冲区溢出允许攻击者覆盖相邻的内存区域。
4.  **权限提升：** 通过精心构造的溢出数据，修改Sudo的内部状态，从而获得root权限。
5.  **执行Shellcode (lib.c)：** 通过溢出，修改控制流，执行 shellcode。 Shellcode 的目的是提权并执行 shell。

该漏洞利用的核心在于利用`sudoedit -s`命令处理参数时的错误，造成堆溢出，精心构造溢出数据，从而改变程序的执行流程，劫持控制流，最终达到提升权限的目的。通过Makefile编译成可执行文件后，在存在漏洞的环境中运行即可提升至root权限。

**项目地址:** [Typical0day/CVE-2021-3156](https://github.com/Typical0day/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #17

**来源**: [CVE-2021-3156-arvindshima_CVE-2021-3156.md](../2021/CVE-2021-3156-arvindshima_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 1.9.5p2 之前的版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断此漏洞的POC代码有效。多个来源（Qualys blog, NCC Group blog, RedHat, BeyondTrust等）均表明此漏洞是可利用的，且利用后可获得root权限。提供的代码包含Dockerfile，Makefile，exploit.c，shellcode.c和README.md，构建和运行均有详尽说明，且漏洞利用代码中已包含详细的注释信息，表明其利用方式是可行的。

**投毒风险：**

分析提供的 POC 代码，投毒风险较低。理由如下：

*   **公开的漏洞：** 该漏洞（CVE-2021-3156）是公开且被广泛研究的漏洞，由Qualys等安全公司发现并公布了细节。
*   **代码可读性：** 提供的C代码（`exploit.c`和`shellcode.c`）相对简单，功能清晰，没有明显的恶意行为。
*   **Docker环境：** Dockerfile创建了一个隔离的测试环境，限制了潜在的恶意行为。
*   **Shellcode功能：** `shellcode.c` 中的 shellcode 主要功能是 setuid(0), setgid(0) 和 execve("/bin/sh")，这是一个典型的提权 shellcode，用于获得 root shell，是漏洞利用的正常组成部分，而不是后门程序。

但是，仍然存在很低的投毒风险，概率约为 5%。虽然 shellcode 的主要功能是提权并执行 /bin/sh，但攻击者仍然可以在 shellcode 中添加一些额外的恶意代码，例如：
    *   **信息收集：** 收集系统信息并发送到远程服务器。
    *   **持久化后门：** 在系统中植入后门，以便长期控制。

尽管如此，考虑到漏洞本身的性质（本地提权）和代码的整体可读性，直接植入恶意后门的风险相对较低。

**利用方式：**

1.  **缓冲区溢出：**  漏洞利用的核心是 `sudoedit -s` 命令处理参数时存在的 off-by-one 错误，这导致了堆缓冲区溢出。
2.  **堆 Feng-Shui：**  通过设置 `LC_*` 环境变量，在堆上布置特定的内存结构，以便溢出能够覆盖关键数据结构，特别是 `service_user` 结构体。
3.  **覆盖 service_user 结构：**  利用溢出，用指向 shellcode 库（`libnss_x/x.so.2`）的路径覆盖 `service_user` 结构体中的 `files` 字段。
4.  **执行 Shellcode：**  当 sudo 尝试使用被覆盖的 `files` 字段加载库时，实际上加载并执行了包含提权 shellcode 的库。
5.  **Root Shell：**  Shellcode 执行 `setuid(0)` 和 `setgid(0)` 将用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而获得 root shell。

**项目地址:** [arvindshima/CVE-2021-3156](https://github.com/arvindshima/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #18

**来源**: [CVE-2021-3156-asepsaepdin_CVE-2021-3156.md](../2021/CVE-2021-3156-asepsaepdin_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。此漏洞存在于sudo解析命令行参数的方式中，特别是当使用'sudoedit -s'命令并且命令行参数以单个反斜杠字符结尾时。攻击者可以利用此漏洞通过本地用户提升权限到root。

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码是有效的。搜索结果中多个链接表明该漏洞已被积极利用，并且存在公开可用的PoC。

**投毒风险:**
分析PoC代码后，存在轻微的投毒风险。具体来说，`shellcode.c` 文件中的shellcode执行了`setuid(0)` 和 `setgid(0)`来提升权限，然后执行 `/bin/sh`。虽然看起来很直接，但存在将 `/bin/sh`替换为恶意程序或向shellcode中添加恶意功能的可能。Makefile看起来相对简单，但如果添加了额外的编译步骤来注入恶意代码，也存在一定的风险。总体而言，投毒风险较低，因为PoC本身的目标就是提权，替换/bin/sh可能会影响POC的可用性，但添加额外操作还是有可能的。

**利用方式:**
1.  漏洞利用代码首先构造一个包含大量 'Y' 字符并以反斜杠结尾的缓冲区 (`buf`)。此缓冲区用于触发堆缓冲区溢出。
2.  设置环境变量，如 `LC_MESSAGES`、`LC_TELEPHONE` 和 `LC_MEASUREMENT`，用于进行堆排布（heap feng shui），以将目标 `service_user` 结构放置在可预测的内存位置。`overflow`环境变量用于填充堆，并包含足够多的 'X' 字符，以覆盖到目标 `service_user` 结构。
3.  `execve` 函数调用 `sudoedit`，并传递构造的 `argv` (包含 `-s` 和溢出缓冲区) 和 `envp` (包含用于堆排布的环境变量)。
4.  通过溢出缓冲区，覆盖 `service_user` 结构中的 `files` 字段的 `name` 指针，使其指向 `libnss_x/x.so.2`的路径。
5.  `libnss_x/x.so.2` 是一个共享库，其中包含在 `_init` 函数中定义的 shellcode。由于 `name` 指针已被覆盖，当 `sudoedit` 尝试使用 `files` 字段时，它实际上会加载并执行此共享库中的 shellcode。
6.  Shellcode 执行 `setuid(0)` 和 `setgid(0)`，从而将有效用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而产生一个 root shell。

总体而言，该漏洞利用通过堆缓冲区溢出覆盖了 `sudoedit` 中使用的内存结构，允许攻击者执行任意代码并获得 root 权限。

**项目地址:** [asepsaepdin/CVE-2021-3156](https://github.com/asepsaepdin/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #19

**来源**: [CVE-2021-3156-chenaotian_CVE-2021-3156.md](../2021/CVE-2021-3156-chenaotian_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地提权至 root

**影响版本:** 1.8.2 - 1.8.31sp12, 1.9.0 - 1.9.5sp1

**利用条件:** 本地用户，Sudo 具有 SUID 权限且可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 是一个 Sudo 中的堆缓冲区溢出漏洞，也被称为 "Baron Samedit"。该漏洞允许本地用户通过 `sudoedit -s` 和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可用的PoC代码。提供的PoC代码利用了 `sudoedit -s` 命令以及精心构造的参数，可以触发堆缓冲区溢出，从而实现提权。多个安全博客和漏洞报告证实了该漏洞的可利用性。

**投毒风险：**

分析提供的漏洞利用代码仓库，其中包含Dockerfile和exp.c文件。Dockerfile文件用于构建漏洞环境，exp.c为C语言编写的漏洞利用程序。代码仓库中主要包含漏洞利用的必要文件，没有发现作者隐藏的恶意代码，例如后门程序、信息收集模块或任何其他与漏洞利用无关的功能。因此，该仓库的投毒风险较低。因此，评估投毒风险为0%。

**利用方式：**

1.  **触发条件：** 漏洞利用需要满足以下条件：
    *   本地用户身份
    *   目标系统上安装了受影响版本的 Sudo
    *   Sudo 程序具有 SUID 权限
2.  **利用步骤：**
    *   使用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数。参数的长度需要足够长，以便触发堆缓冲区溢出。
    *   利用缓冲区溢出，覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。
    *   恶意代码通常会调用 `setuid(0)` 和 `setgid(0)`，从而将当前用户的有效用户 ID 和组 ID 设置为 root，实现提权。
3.  **漏洞原理：**
    *   漏洞根源在于 `set_cmnd` 函数中，在处理命令行参数时，对反斜杠字符的处理存在缺陷。
    *   当命令行参数以单个反斜杠字符结尾时，代码会错误地将反斜杠字符和紧随其后的空字符都复制到堆缓冲区中，导致缓冲区溢出。
    *   通过精心构造命令行参数，可以控制溢出的内容，从而覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。

**项目地址:** [chenaotian/CVE-2021-3156](https://github.com/chenaotian/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #20

**来源**: [CVE-2021-3156-duongdz96_CVE-2021-3156-main.md](../2021/CVE-2021-3156-duongdz96_CVE-2021-3156-main.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，任何本地用户都可利用此漏洞提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞出现在sudo解析命令行参数的过程中。通过精心构造以单个反斜杠字符结尾的命令行参数，攻击者可以触发off-by-one错误，导致堆缓冲区溢出，最终允许任何本地用户将权限提升到root。

**有效性分析：**

*   根据漏洞库信息和搜索结果，此漏洞已被广泛证实存在，并有公开可用的利用代码。
*   提供的漏洞利用代码库包含多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞具有较高的利用成功率。
*   搜索结果中的链接(如Qualys博客、NVD、NCC Group博客等)也证实了该漏洞的存在和危害。

**投毒风险分析：**

*   漏洞利用代码库包含LICENSE文件，表明作者声明了版权，并使用了较为宽松的BSD许可，这在一定程度上降低了作者故意投毒的可能性。
*   代码库包含多个利用脚本，针对不同的系统和sudo配置，代码量相对较大，人工审计难度较高。但从代码注释和说明文档来看，作者提供了较为清晰的漏洞利用思路。
*   `exploit_timestamp_race.c` 利用了竞争条件，可能存在不稳定性，也可能被恶意利用，但不能直接判定为恶意投毒。
*   `exploit_userspec.py` 直接修改`/etc/passwd`文件来提权，如果被篡改加入恶意用户，则存在一定的风险。
*  总体而言，代码库的投毒风险较低，约为10%，主要集中在代码复杂性带来的潜在风险和对`/etc/passwd`文件的修改上，建议在使用前进行详细的代码审计。

**利用方式：**

1.  漏洞利用始于一个off-by-one错误，发生在sudo在解析命令行参数时，特别是当参数以单个反斜杠结尾时。
2.  这个错误会导致堆缓冲区溢出。
3.  攻击者通过精心构造的参数，覆盖相邻的堆内存。
4.  根据不同的利用脚本，攻击者可以通过覆盖`defaults`结构体、`userspec`结构体或`service_user`结构体来达到提权的目的。
5.  更具体地说，一些脚本覆盖`defaults`结构体来修改mailer的路径，指向攻击者可控的恶意程序，从而以root权限执行该恶意程序。另一些脚本则覆盖`userspec`结构体来绕过认证，并在`/etc/passwd`文件中添加一个具有root权限的新用户。
6.  最后，`exploit_timestamp_race.c`通过竞争条件修改`/etc/passwd`文件。

**项目地址:** [duongdz96/CVE-2021-3156-main](https://github.com/duongdz96/CVE-2021-3156-main)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #21

**来源**: [CVE-2021-3156-hycheng15_CVE-2021-3156.md](../2021/CVE-2021-3156-hycheng15_CVE-2021-3156.md)

## CVE-2021-3156 Sudo Baron Samedit 权限提升漏洞

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的过程中。攻击者可以利用`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而将权限提升至root。

**有效性：**
提供的POC代码是有效的。搜索结果中的多个网页（例如，Qualys博客、NCC Group博客、RedHat安全页面）都确认了该漏洞的存在，并提供了利用方法。POC代码通过构造特定的命令行参数和环境变量，触发堆溢出，覆盖`service_user`结构，最终执行shellcode以获得root权限。

**投毒风险：**
该仓库中存在轻微的投毒风险（10%）。虽然代码本身实现了漏洞利用，但可能存在以下情况：
*   **Shellcode修改：** 作者可能在shellcode中添加了不明显的后门逻辑，例如，在获得root shell之前执行某些恶意操作。虽然提供的shellcode比较简单，但作者完全可以替换成更复杂的payload。
*   **编译选项：** Makefile中使用的编译选项，可能会被修改，例如关闭某些安全特性，虽然目前只是`-O3`优化。

**利用方式：**
1.  **漏洞触发：** 通过`sudoedit -s` 命令，并提供一个以反斜杠结尾的超长参数。
2.  **堆溢出：** 利用超长参数覆盖堆上相邻的`service_user`结构。
3.  **控制`service_user`：** 覆盖`service_user`结构中的`name`字段，指向包含shellcode的恶意动态链接库（`libnss_x/x.so.2`）的路径。
4.  **加载恶意库：** Sudo在后续操作中尝试加载`service_user`的`name`字段指定的库，从而执行shellcode。
5.  **权限提升：** shellcode设置UID和GID为0，然后执行`/bin/sh`，获得root shell。

**项目地址:** [hycheng15/CVE-2021-3156](https://github.com/hycheng15/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #22

**来源**: [CVE-2021-3156-lypd0_CVE-2021-3156-checker.md](../2021/CVE-2021-3156-lypd0_CVE-2021-3156-checker.md)

## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #23

**来源**: [CVE-2021-3156-mutur4_CVE-2021-3156.md](../2021/CVE-2021-3156-mutur4_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #24

**来源**: [CVE-2021-3156-puckiestyle_CVE-2021-3156.md](../2021/CVE-2021-3156-puckiestyle_CVE-2021-3156.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** 1.9.5p2之前

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名“Baron Samedit”，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞位于sudo在解析命令行参数时，由于一个单字节溢出（off-by-one error）导致。攻击者可以通过`sudoedit -s`命令，结合以单个反斜杠字符结尾的命令行参数，触发此漏洞，从而实现权限提升，获得root权限。

**有效性：**

从漏洞描述、搜索结果以及提供的漏洞利用代码来看，该漏洞的POC代码是有效的。多个来源（Qualys blog, NCC Group blog, Red Hat advisory, BeyondTrust blog等）都证实了该漏洞的存在和利用的可能性。提供的代码库包含了多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞已被广泛研究和利用。

**投毒风险：**

评估提供的代码仓库是否存在投毒风险，需要分析仓库中的文件。该仓库包含了多个利用脚本，这些脚本旨在提升权限，因此可能被滥用。但是从代码来看，都是围绕着漏洞利用展开，没有发现明显的恶意代码，因此评估投毒风险为10%。

**利用方式：**

利用方式主要包括以下几个步骤：

1.  **触发漏洞：** 利用`sudoedit -s`命令以及构造特殊的命令行参数（以单个反斜杠结尾）来触发堆缓冲区溢出。
2.  **覆盖堆内存：** 通过精心设计的输入，覆盖堆上的关键数据结构，如`defaults`、`userspec`或`service_user`结构体。
3.  **权限提升：**
    *   **覆盖mailer路径：** 覆盖`defaults`结构体中的`mailer`路径，将其指向恶意程序，从而以root权限执行该恶意程序。
    *   **绕过认证：** 覆盖`userspec`结构体，绕过身份验证，允许攻击者执行任意命令。
    *   **修改/etc/passwd：** 覆盖`def_timestamp`结构体，配合竞争条件，修改`/etc/passwd`文件，添加具有root权限的新用户。
4.  **获得Root权限：** 通过上述方法，最终获得系统的root权限。

提供的代码库包含了多种利用方法，如`exploit_nss.py`，`exploit_timestamp_race.c`，`exploit_defaults_mailer.py`，`exploit_userspec.py`等，分别针对不同的系统配置和glibc版本。

**项目地址:** [puckiestyle/CVE-2021-3156](https://github.com/puckiestyle/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #25

**来源**: [CVE-2021-3156-q77190858_CVE-2021-3156.md](../2021/CVE-2021-3156-q77190858_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2 (受影响版本)

**利用条件:** 需要本地用户权限，目标系统sudo版本低于1.9.5p2且满足漏洞触发条件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性:**

提供的 PoC 代码是有效的。Dockerfile 用于构建一个包含易受攻击的 Sudo 版本的环境 (Ubuntu 20.04 with Sudo 1.8.31-1ubuntu1)。 exploit.c 包含利用代码， shellcode.c 包含执行 shell 的 shellcode，Makefile 用于编译。

搜索结果也证实了该漏洞的存在和严重性，以及利用该漏洞的公开信息。

**投毒风险:**

分析提供的 PoC 代码，该代码利用了已知的 CVE-2021-3156 漏洞，没有明显的投毒迹象。 Shellcode只是简单的提升权限执行/bin/bash，没有恶意行为。代码目的是为了演示漏洞，快速获取root权限。

**利用方式:**

利用方式如下：

1.  **触发漏洞:** 通过 `sudoedit -s` 命令以及精心构造的、以单个反斜杠结尾的命令行参数，触发堆缓冲区溢出。
2.  **堆喷射 (Heap Feng-Shui):** 使用 `LC_*` 环境变量进行堆喷射，以便在内存中布置目标 `service_user` 结构体。
3.  **溢出覆盖:**  通过缓冲区溢出覆盖目标 `service_user` 结构体的 `files` 字段，将其指向包含 shellcode 的库的路径 (`/home/exploit/libnss_x/x.so.2`)。
4.  **执行 Shellcode:** 当 Sudo 尝试使用被覆盖的 `files` 字段时，会加载并执行我们的 shellcode。 Shellcode 提升权限并执行 `/bin/bash`，从而提供一个 root shell。

总而言之，提供的代码利用了 CVE-2021-3156 的堆缓冲区溢出漏洞，通过覆盖关键的 Sudo 结构体指针，允许未经授权的用户获得 root 权限。

**项目地址:** [q77190858/CVE-2021-3156](https://github.com/q77190858/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #26

**来源**: [CVE-2021-3156-ret2basic_SudoScience.md](../2021/CVE-2021-3156-ret2basic_SudoScience.md)

# CVE-2021-3156

> 📦 该CVE有 **31** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-3156-0x4ndy_clif.md](../2021/CVE-2021-3156-0x4ndy_clif.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过利用`sudoedit -s`命令以及一个以单反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：** 根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞是有效的。搜索结果中的多个网页都提到了该漏洞，并确认它允许权限提升到root。漏洞库信息中也明确指出了该漏洞是一个堆缓冲区溢出，可以通过特定的方式触发。

**投毒风险：** 提供的漏洞利用代码看起来像是一个 `Cargo.lock` 文件，这个文件是 Rust 项目依赖管理的一部分。它本身不包含任何可执行代码，只是记录了项目依赖项的版本信息和校验和。因此，此仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：** 该漏洞的利用方式涉及到向`sudoedit -s`命令传递一个以单反斜杠结尾的精心构造的命令行参数。这个参数会导致Sudo在处理命令行参数时出现一个off-by-one错误，从而导致堆缓冲区溢出。通过控制溢出的内容，攻击者可以覆盖堆上的数据结构，最终实现权限提升。

根据搜索结果，利用该漏洞通常不需要任何特殊的配置或权限，只需要一个可以执行sudo的本地用户即可。这使得该漏洞非常容易被利用。

**项目地址:** [0x4ndy/clif](https://github.com/0x4ndy/clif)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #2

**来源**: [CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md](../2021/CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md)

## CVE-2021-3156 (Baron Samedit) Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 存在于 Sudo 1.9.5p2 之前的版本中。这是一个堆缓冲区溢出漏洞，允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个已知的，并且已经有公开可用的利用代码(POC)。该漏洞利用代码在多个平台和版本上成功进行了利用，可以有效地将权限提升到root。

**投毒风险：**
提供的POC代码 (`exploit_nss.py`) 看起来像是 `worawit/CVE-2021-3156` 的一个fork，修改为使用 `ifconfig` 命令而不是 `ip` 命令。虽然这个修改本身是合理的 (为了兼容性)，但仍然存在轻微的投毒风险。投毒风险评估为 10%的原因如下：
  1. **代码来源：** 虽然代码fork自一个已知的漏洞利用仓库，但仍然需要检查fork后的代码是否引入了恶意修改。
  2. **代码复杂性：** 漏洞利用代码通常比较复杂，增加了隐藏恶意代码的可能性。
  3. **权限提升：** 由于漏洞利用本身会提升权限到root，恶意代码一旦成功执行，可能会造成严重的危害。
  4. **依赖外部资源：**  虽然作者说使用了ifconfig,但是还是依赖nscd等外部服务,如果被篡改,同样有提权风险.

**利用方式：**
1.  漏洞利用的触发点在于 `sudoedit -s` 命令在解析命令行参数时存在的 off-by-one 错误。
2.  攻击者需要构造一个以单个反斜杠字符结尾的恶意命令行参数。
3.  该参数会触发堆缓冲区溢出，覆盖内存中的数据结构（`service_user` 结构体）。
4.  通过精心构造溢出内容，可以覆盖 `service_user` 结构体中的指针，劫持程序执行流程。
5.  利用劫持的程序执行流程，攻击者可以执行任意代码，从而将权限提升到 root。
6.  此POC 使用 `ifconfig` 命令而不是 `ip` 命令，可能是为了增加在不同环境下的兼容性，因为 `ip` 命令可能不是所有系统默认安装的。

**项目地址:** [Bad3r/CVE-2021-3156-without-ip-command](https://github.com/Bad3r/CVE-2021-3156-without-ip-command)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #3

**来源**: [CVE-2021-3156-CptGibbon_CVE-2021-3156.md](../2021/CVE-2021-3156-CptGibbon_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过`sudoedit -s`以及一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。搜索结果中大量的文章和分析，例如Qualys的研究博客、NCC Group的分析文章，以及Red Hat的CVE描述，都证实了漏洞的存在和严重性。PoC代码的`README.md`文件也说明了其在Ubuntu 20.04上的测试成功，并且提供了验证漏洞存在的命令`sudoedit -s Y`。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为5%。理由如下：
*   PoC代码的目的是演示漏洞利用，结构清晰，注释完善，易于理解。
*   代码逻辑主要集中在构造特定的命令行参数和环境变量，以触发堆缓冲区溢出，并覆盖`service_user`结构体，从而执行shellcode。
*   `shellcode.c`文件中的代码功能单一，即执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，目的是获取root shell。虽然这段shellcode可以被替换为恶意代码，但是原始shellcode本身并不是恶意的，而是漏洞利用的一部分。
*   `Makefile`文件只包含编译和清理的命令，没有发现可疑操作。
*   `Dockerfile`用于构建包含漏洞版本的Sudo的环境，方便漏洞测试，本身不包含恶意代码。
*   作者在`README.md`文件中明确声明了研究成果归Qualys Research Team所有，并提供了其博客链接，表明了其非恶意意图。

虽然shellcode存在被替换的可能性，但整个代码库的结构和说明都表明其主要目的是为了演示和验证漏洞，而非进行恶意攻击，因此投毒的概率较低。

**利用方式：**
1.  利用 `sudoedit -s` 命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数（`buf`变量），触发off-by-one错误，导致堆缓冲区溢出。
3.  通过精心设计的环境变量（`LC_MESSAGES`、`LC_TELEPHONE`、`LC_MEASUREMENT`）进行堆排布，将目标`service_user`结构体安排在溢出区域附近。
4.  通过另一个环境变量（`overflow`）填充内存，并最终覆盖`service_user`结构体的`name`字段，将其修改为shellcode库的路径。
5.  Sudo在后续操作中会加载被覆盖的`name`字段指向的shellcode库，从而执行shellcode，提升权限至root。
6.  Shellcode执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，获得root shell。

**项目地址:** [CptGibbon/CVE-2021-3156](https://github.com/CptGibbon/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #4

**来源**: [CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md](../2021/CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升至 root。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该漏洞利用是有效的。搜索结果中多个链接（如 Qualys 博客、NCC Group 博客、Red Hat 页面等）都证实了该漏洞的存在和严重性，以及可被利用的事实。提供的漏洞利用代码包含 Makefile 和 README，指示了编译和使用漏洞利用程序的方法，并提供了效果演示，进一步表明了其有效性。

**投毒风险：**
该仓库中存在投毒代码的风险较低，约为 10%。主要考虑因素如下：
*   **Makefile编译：** 该POC的编译流程包含了sudo的编译，可能在编译过程中修改sudo源代码，加入恶意代码。
*   **busybox镜像：** POC需要特定的环境，包括busybox系统镜像rootfs.img，镜像本身可能包含恶意代码。
*   **nss库：** POC需要libnss_x-x.so.2库，恶意作者可能会在库中植入后门，但这种可能性较低，因为可以通过分析源代码来检测。
鉴于需要特定的环境和编译步骤，存在一些潜在的恶意代码植入点，但公开的POC通常会经过社区审查，因此风险相对较低。需要注意的是，为了重现漏洞，必须使用提供的环境配置，这在一定程度上增加了安全风险。

**利用方式：**
该漏洞的利用方式如下：
1.  **漏洞触发：** 通过 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数，触发 off-by-one 错误，导致堆缓冲区溢出。
2.  **权限提升：** 利用堆缓冲区溢出覆盖关键数据，从而获得 root 权限。
3.  **POC利用：** 提供的 POC 代码包含一个利用程序 (`exploit`) 和一个定制的 nss 库 (`libnss_x-x.so.2`)。该利用程序通过溢出修改 sudo 的行为，而 nss 库可能包含用于执行任意代码的 shellcode 或其他恶意逻辑。
4.  **利用步骤:**
    *   编译`sudo`和`exploit`。
    *   使用提供的`rootfs.img`启动`linux`，并进入`busybox`命令行界面。
    *   切换用户到`wanghan`。
    *   运行`./exploit`。
    *   验证当前用户是否为root。
利用的成功取决于目标系统上 Sudo 版本和 glibc 版本的兼容性。根据 README，该 POC 针对的是 `sudo` 1.8.31 和 `glibc` 2.31 在 `Linux` 4.18 或 5.10.167-gee203559bc0b-dirty 上。

**项目地址:** [DASICS-ICT/DASICS-CVE-2021-3156](https://github.com/DASICS-ICT/DASICS-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #5

**来源**: [CVE-2021-3156-DDayLuong_CVE-2021-3156.md](../2021/CVE-2021-3156-DDayLuong_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可提升至root权限

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，也被称为Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞是由于sudo在解析命令行参数时存在off-by-one错误造成的。攻击者可以通过`sudoedit -s`命令以及一个以单个反斜杠字符结尾的命令行参数来利用此漏洞，从而将权限提升到root。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此POC代码是有效的。搜索引擎结果中大量文章都提到了CVE-2021-3156的利用可以实现root权限提升。POC代码中`hax.c`文件实现了漏洞利用的核心逻辑，通过构造特定的命令行参数和环境变量来触发堆缓冲区溢出，覆盖堆上的数据，最终劫持程序控制流，执行恶意代码。

**投毒风险分析：**

分析POC代码，主要关注`lib.c`文件，该文件编译成动态链接库，用于替换系统中的某些函数，以执行恶意操作。查看lib.c文件内容发现代码不完整，疑似被删除，但Makefile文件存在编译该lib.c文件的指令。如果lib.c文件包含恶意代码（例如反弹shell或者添加后门用户），则存在投毒风险。由于lib.c内容缺失，无法准确判断，保守估计存在10%的投毒风险，即代码可能被篡改以包含恶意功能，但缺乏明确的证据。

**利用方式：**

1.  **目标确认：**  首先，需要确定目标系统是否存在CVE-2021-3156漏洞，即Sudo版本是否在受影响范围内（小于1.9.5p2）。
2.  **编译：**  使用提供的Makefile编译`hax.c`和`lib.c`，生成可执行文件`sudo-hax-me-a-sandwich`和动态链接库`libnss_X/P0P_SH3LLZ_ .so.2`。
3.  **参数选择：** 根据目标系统选择合适的target，或者手动指定`smash_len_a`，`smash_len_b`，`null_stomp_len`和`lc_all_len`参数。
4.  **执行：**  运行`sudo-hax-me-a-sandwich <target>`或`sudo-hax-me-a-sandwich <smash_len_a> <smash_len_b> <null_stomp_len> <lc_all_len>`，利用漏洞提升权限。
5.  **利用原理：** POC利用了sudoedit在处理以反斜杠结尾的参数时存在的堆缓冲区溢出漏洞。通过构造特定长度的字符串和环境变量，覆盖堆上的数据，劫持程序执行流程，加载恶意的动态链接库，从而执行任意代码，最终获得root权限。

**项目地址:** [DDayLuong/CVE-2021-3156](https://github.com/DDayLuong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #6

**来源**: [CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md](../2021/CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过利用sudo解析命令行参数时存在的off-by-one错误，提升权限至root。漏洞利用的关键在于使用`sudoedit -s`命令，并构造以单个反斜杠字符结尾的命令行参数，从而触发缓冲区溢出。提供的POC脚本`CVE-2021-3156.sh`通过以下步骤进行利用：

1.  **创建临时目录：** 创建一个临时工作目录，用于存放exploit所需的文件。
2.  **确定执行命令：** 如果提供了命令行参数，则使用该参数作为要执行的命令；否则，默认使用交互式shell (`/bin/bash`)。
3.  **准备Payload：** 对要执行的命令进行转义，防止注入。
4.  **生成恶意库：** 生成包含payload的动态链接库`woot1337.so.2`。该库在加载时，会将当前进程的UID和GID设置为0 (root)，并执行指定的命令。
5.  **配置利用环境：**  创建`woot/etc/nsswitch.conf`文件，并尝试复制`/etc/group`文件。
6.  **编译恶意库：** 使用gcc编译包含payload的c文件成共享库。
7.  **执行利用：** 使用`sudo -R woot woot`命令，触发漏洞。`-R`选项结合精心构造的环境变量，使得sudo加载恶意的动态链接库，从而执行payload。
8.  **清理：** 删除临时目录。

**有效性：** 根据漏洞描述和搜索结果，提供的POC代码是有效的，可以利用CVE-2021-3156漏洞实现权限提升。

**投毒风险：** POC代码本身存在一定的投毒风险，主要体现在以下几个方面：

*   **Payload植入：** 脚本会生成并编译一个动态链接库，其中包含可以执行任意命令的payload。虽然脚本的目的是为了利用漏洞提升权限，但恶意攻击者可以修改脚本，将payload替换为恶意代码，例如下载和执行恶意程序、收集敏感信息等。
*   **环境依赖：** 脚本依赖于特定的环境配置，例如gcc编译器、sudo版本等。攻击者可以利用这些依赖关系，在受害者环境中植入恶意文件或修改系统配置，从而实现持久化控制。
*   **代码混淆：** 攻击者可以对脚本进行混淆处理，使其难以阅读和理解，从而隐藏恶意代码。

综上所述，该POC代码存在一定的投毒风险。但是，由于该脚本公开且被广泛分析，潜在的恶意代码通常会被安全研究人员发现。因此，可以认为投毒风险较低，约为10%。 主要是payload生成方式的恶意替换和编译过程的潜在风险。

**利用方式：**

该漏洞的利用方式是通过构造特定的命令行参数，触发Sudo程序中的堆缓冲区溢出。具体步骤如下：

1.  使用`sudoedit -s`命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数。
3.  Sudo在处理该参数时，会由于off-by-one错误，导致堆缓冲区溢出。
4.  通过控制溢出内容，攻击者可以覆盖Sudo程序的内存，从而实现任意代码执行，最终提升权限至root。

**项目地址:** [Maalfer/Sudo-CVE-2021-3156](https://github.com/Maalfer/Sudo-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #7

**来源**: [CVE-2021-3156-Mhackiori_CVE-2021-3156.md](../2021/CVE-2021-3156-Mhackiori_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令（即使没有sudo权限）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用'sudoedit -s'命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为root。

**有效性：**
提供的PoC代码库包含利用此漏洞所需的必要文件，包括Makefile和expolit.c，以及描述利用方法的README.md。它使用环境变量进行内存填充，以便进行堆风水，覆盖`service_user`对象的名称，从而执行恶意代码。因此，提供的PoC**有效**。

**投毒风险：**
该代码库结构清晰，主要包含漏洞利用相关的代码。其中 `libnss_XXX/XXX.c` 和 `libnss_XXX/XXX.so.2` 存在潜在的风险。恶意作者可能在此处嵌入后门代码，例如反向shell等。尽管主要的利用逻辑是利用堆溢出，但共享库的编译和加载过程存在植入恶意代码的机会。因此，我给出一个较低的投毒风险评估，约为10%。

**利用方式：**
1.  利用`sudoedit -s` 以及一个以单个反斜杠结尾的命令行参数触发漏洞。
2.  该漏洞是一个堆缓冲区溢出，允许攻击者覆盖堆上的内存。
3.  PoC通过环境变量填充内存，进行堆风水（Heap Feng Shui），精心布局堆内存。
4.  利用溢出覆盖`service_user`结构体的`name`字段，该字段用于加载NSS(Name Service Switch)库。
5.  通过覆盖`name`字段，将NSS库的加载路径修改为攻击者控制的恶意库。
6.  当sudo尝试加载NSS库时，实际上加载的是恶意库，恶意库中的代码被执行。
7.  恶意库中的代码通常包含一个提权的shell或者其他恶意操作，从而实现权限提升。

**项目地址:** [Mhackiori/CVE-2021-3156](https://github.com/Mhackiori/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #8

**来源**: [CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md](../2021/CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的方式中。攻击者可以利用'sudoedit -s'命令和一个以单个反斜杠字符结尾的命令行参数来触发漏洞。通过精心构造的参数，可以覆盖堆内存，从而实现权限提升，允许本地普通用户获得root权限。

**漏洞利用方式：**

1.  **利用`sudoedit -s`触发：** 该漏洞的关键在于使用`sudoedit -s`命令，该命令用于以安全模式编辑文件。
2.  **构造恶意参数：**  攻击者需要提供一个以单个反斜杠(`\`)结尾的长命令行参数。这个反斜杠会触发转义错误，导致缓冲区溢出。
3.  **堆内存覆盖：** 通过精心控制的输入长度和内容，攻击者可以覆盖堆内存中的关键数据结构，例如`user_spec`结构体和`cmnd_spec`结构体。
4.  **权限提升：**  通过覆盖这些数据结构，攻击者可以修改sudo的行为，使其认为当前用户拥有root权限，从而执行任意命令。
5.  **POC代码分析：**
    *   POC使用python编写，利用ctypes直接调用libc函数，例如`execve`，实现进程的创建和执行。
    *   POC构造了恶意的argv和envp参数，利用`sudoedit -s`触发漏洞。
    *   POC通过设置环境变量`SUDO_EDITOR=/usr/bin/tee`将标准输入附加到`/etc/passwd`文件中，从而达到修改`/etc/passwd`的目的（这是一种利用方式，也可能替换成执行其他恶意代码）。
    *   POC通过大量的环境变量覆盖栈，并在栈上构造伪造的数据结构，用于利用堆溢出。
6.  **有效性：** 提供的PoC代码基本有效，根据漏洞描述和搜索结果，该PoC能够利用该漏洞实现本地权限提升。需要根据目标系统进行微调，例如地址偏移等。

**投毒风险：**

评估投毒风险较低，大约为1%。
    *   **原因：** 代码主要利用已知的堆溢出漏洞进行提权，尽管POC修改了/etc/passwd文件，添加了用户，但是可以很容易的进行排查，且行为可以控制。
    *   **风险点：** POC中的`/usr/bin/tee`命令被用于将输入附加到/etc/passwd，可能会添加恶意的用户账户，但这不是隐藏行为。理论上，作者可以在堆内存构造部分或环境变量设置中加入一些隐蔽的恶意代码，例如替换`execve`的参数，使其执行其他恶意程序，但当前代码中没有明显的此类行为。

总结：该漏洞利用方式相对直接，POC代码利用堆溢出覆盖关键数据结构，从而实现权限提升。投毒风险较低。

**项目地址:** [PhuketIsland/CVE-2021-3156-centos7](https://github.com/PhuketIsland/CVE-2021-3156-centos7)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #9

**来源**: [CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md](../2021/CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** 1.8.2 to 1.8.31p2 和 1.9.0 to 1.9.5p1

**利用条件:** 需要本地用户权限，且目标系统存在漏洞版本的 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 中的堆缓冲区溢出漏洞。此漏洞允许未经授权的本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升到 root。该漏洞是由于 `sudo` 在解析命令行参数时存在的 off-by-one 错误导致的。

**有效性：**
根据漏洞库信息、搜索结果以及提供的PoC代码，该漏洞是有效的，并且存在可利用的PoC。

**投毒风险：**
该仓库存在一定的投毒风险，风险概率约为10%。

分析如下：
1.  **libnss_X目录和shell_tool.c**: Makefile 中存在编译动态链接库 `libnss_X/X.so.2` 的指令，使用 `shell_tool.c` 作为源文件。需要对 `shell_tool.c` 代码进行审计，确认是否存在恶意行为。例如，是否包含反弹shell，下载执行恶意代码等。
2. **create_privshell.sh错误处理:**  README.md中提到`create_privshell.sh` 脚本可能编译失败,存在可以被利用的风险。
3. **自动后渗透脚本**: 虽然`get_all_ssh_keys.sh`目的是为了提取ssh keys,但是如果利用不当或者被替换,也可能造成信息泄露。

虽然存在上述风险点，但总体来看，该POC的主要功能是利用漏洞提升权限，而非进行大范围的恶意传播或破坏。因此，投毒风险主要集中在代码细节和潜在的滥用可能上。

**利用方式：**

1.  **编译PoC：** 首先，使用 `make` 命令编译 `bufferof.c` 和 `shell_tool.c` 生成 exploit 文件和动态链接库。
2.  **执行Exploit：** 运行编译后的 `exploit` 文件。该 exploit 利用堆缓冲区溢出漏洞来提升权限。
3.  **权限提升：** 成功利用漏洞后，用户将获得 root 权限。根据 README.md，PoC还提供了自动化的后渗透脚本，例如提取 SSH 密钥和创建特权 shell，进一步巩固攻击成果。

**安全建议：**

*   及时将 Sudo 升级到 1.9.5p2 或更高版本。
*   在部署 PoC 或任何第三方代码之前，进行彻底的代码审计。
*   限制普通用户的 Sudo 权限，降低漏洞利用的风险。

**项目地址:** [PurpleOzone/PE_CVE-CVE-2021-3156](https://github.com/PurpleOzone/PE_CVE-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #10

**来源**: [CVE-2021-3156-RodricBr_CVE-2021-3156.md](../2021/CVE-2021-3156-RodricBr_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #11

**来源**: [CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md](../2021/CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令且sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许任何本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性分析：**

提供的POC代码包括一个Makefile、exploit.c和一个shellcode.c，看起来是完整的利用代码。从exploit.c的代码注释和实现来看，它旨在利用`sudoedit -s`的命令行参数解析中的off-by-one错误触发堆溢出。代码中使用了堆风水（heap feng shui）技术，通过环境变量`LC_MESSAGES`, `LC_TELEPHONE`，`LC_MEASUREMENT`和精心构造的`overflow`变量，来控制堆的布局，从而覆盖目标内存区域。shellcode.c包含提权至root并执行/bin/sh的代码。Makefile文件用于编译exploit和shellcode，将shellcode编译为动态链接库`libnss_x/x.so.2`，但exploit.c并没有用到这个动态链接库，而是直接使用execve执行`/bin/sh`。 根据搜索结果和漏洞库信息，该漏洞利用方法是可行的，并被广泛研究和利用。

**投毒风险分析：**

*   **Makefile:**  Makefile只包含编译和清理目标，没有可疑行为。 *   **exploit.c:** exploit.c的代码主要用于构造漏洞利用所需的参数和环境变量，并调用`execve`执行`/usr/bin/sudoedit`。代码逻辑上是为了触发漏洞利用，没有发现明显的恶意代码，如反弹shell或植入后门。但是，该代码的功能就是提权，本身具有一定风险，应当在测试环境中使用。 *   **shellcode.c:** shellcode.c包含提权代码（setuid(0), setgid(0)）并执行/bin/sh的代码。这段代码的目的是在成功利用漏洞后获取root权限的shell。这里需要注意的是，这段shellcode会将当前用户的权限提升到root，并执行/bin/sh，本质上是打开一个具有root权限的shell会话。从利用漏洞的角度看，这是预期的行为，不能被认为是投毒行为。 *   **综合判断：** 由于提供的代码主要功能是验证漏洞并提权，没有发现明显的恶意行为，因此可以认为投毒的可能性较低。虽然代码本身具有提权功能，但是这是漏洞利用的正常组成部分。因此，投毒风险评估为0%。

**利用方式分析：**

1.  **编译：** 使用Makefile编译exploit.c和shellcode.c。Shellcode被编译成一个动态链接库，但在这个提供的exploit.c版本中，并没有显式加载或者依赖这个动态链接库。 2.  **堆风水：** 设置环境变量`LC_MESSAGES`， `LC_TELEPHONE`， `LC_MEASUREMENT`和 `overflow`，来控制堆的内存布局，方便覆盖关键数据。 3.  **触发漏洞：** 调用`sudoedit -s`，并传入一个以反斜杠结尾的长字符串作为参数。这个反斜杠会触发off-by-one错误，导致堆缓冲区溢出。 4.  **覆盖：** 堆缓冲区溢出覆盖相邻的内存区域，通常是覆盖`sudo`进程的关键数据结构。 5.  **提权和执行Shellcode：**  尽管shellcode编译成了动态链接库，但实际的利用是通过溢出覆盖数据，使sudo以root权限执行`/bin/sh`， 或者覆盖函数指针，劫持控制流执行shellcode（当前提供的exploit.c没有使用shellcode）。

总而言之，利用方式是通过构造特殊的命令行参数和环境变量，利用`sudoedit -s`的off-by-one错误触发堆溢出，最终获得root权限。

**项目地址:** [Sebastianbedoya25/CVE-2021-3156](https://github.com/Sebastianbedoya25/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #12

**来源**: [CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md](../2021/CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #13

**来源**: [CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md](../2021/CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** 1.8.2 to 1.8.31p2, 1.9.0 to 1.9.5p1

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156（又名Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。根据漏洞信息和搜索结果，此漏洞存在于Sudo解析命令行参数的方式中。当Sudo以“shell”模式运行时（通过-s或-i选项），`parse_args()`函数会重写`argv`，通过连接所有命令行参数并使用反斜杠转义所有元字符。之后，`sudoers_policy_main()`函数中的`set_cmnd()`函数将命令行参数连接到堆缓冲区`user_args`中，并取消转义元字符。如果命令行参数以单个反斜杠字符结尾，则`set_cmnd()`函数会发生堆缓冲区溢出，因为它会超出参数边界读取和复制字符到`user_args`缓冲区，而这些字符的大小并未包含在`user_args`大小的计算中。

**有效性：**
提供的POC代码描述了漏洞的分析，并声称Qualys开发了三种不同的漏洞利用程序，可以在Ubuntu 20.04、Debian 10和Fedora 33上获得完整的root权限。鉴于此信息，该漏洞利用程序**有效**。

**投毒风险：**
提供的代码段为漏洞分析报告，并非完整的可执行漏洞利用代码。因此无法完全确定其中是否包含恶意代码。但该报告中作者为著名安全公司Qualys，因此投毒风险较低，可以忽略。同时，如果提供完整的代码，则需要人工进行详细分析才能评估投毒风险。估计投毒风险**1%**

**利用方式：**
1.  本地用户执行sudoedit -s 命令
2.  利用以单个反斜杠结尾的特制命令行参数触发漏洞。
3.  利用堆缓冲区溢出覆盖关键数据结构，最终提升权限至root。

**项目地址:** [Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-](https://github.com/Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #14

**来源**: [CVE-2021-3156-Superliverbun_cve-2021-3156-.md](../2021/CVE-2021-3156-Superliverbun_cve-2021-3156-.md)

## CVE-2021-3156 - Sudo Baron Samedit Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**漏洞利用分析：**

1.  **有效性：** 提供的PoC代码看起来是有效的。`hax.c`文件包含了利用漏洞所需的参数构造，包括特制的`s_argv`和`s_envp`，利用`execve`函数执行`sudoedit`命令。`lib.c`包含了在成功利用漏洞后执行的payload，即提权到root并执行`/bin/sh`。
2.  **投毒风险：** 
    * Makefile：该文件用于编译PoC。没有发现明显的恶意行为。
    * README.md：该文件仅包含漏洞名称，没有恶意代码。
    * hax.c：此文件是漏洞利用的主要入口点。虽然它的目的是利用漏洞，但其本身不包含任何后门或恶意代码。它只是构造特定的参数传递给`sudoedit`。
    * lib.c：此文件是一个共享库，它在被加载时执行提权操作并启动一个shell。这里需要注意，如果该共享库被替换成包含恶意代码的版本，可能会造成投毒。但是，就目前提供的代码而言，它只是执行了预期的提权操作。代码中虽然没有明显的恶意代码，但是依然存在投毒的可能，因此风险存在。该利用本身就是一种提权行为，所以很难直接判断是否是投毒行为。不过 `lib.c` 编译成动态链接库，可以被替换，存在一定风险。
    * 总体评估：PoC代码本身主要是利用漏洞，但存在被替换成恶意版本的风险，因此存在一定的投毒风险。
3.  **利用方式：**
    *   编译：首先，使用`make`命令编译提供的代码，生成`sudo-hax-me-a-sandwich`可执行文件和`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库。
    *   执行：运行编译后的`sudo-hax-me-a-sandwich`可执行文件。该程序会使用精心构造的参数和环境变量调用`sudoedit`命令，触发堆缓冲区溢出漏洞。
    *   提权：如果漏洞利用成功，`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库将被加载，其中定义的`_init`函数会被执行，从而将当前用户的权限提升到root，并启动一个root shell。

**总结：**
该PoC代码有效，旨在利用CVE-2021-3156漏洞将本地用户的权限提升到root。 虽然代码本身不包含明显的后门，但是`lib.c`动态链接库存在替换风险，存在潜在的投毒风险。

**项目地址:** [Superliverbun/cve-2021-3156-](https://github.com/Superliverbun/cve-2021-3156-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #15

**来源**: [CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md](../2021/CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 是一个存在于sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。多个来源都提到了该漏洞，并提供了利用代码。

**投毒风险：**
提供的代码包含两个 Python 脚本 (`exploit_nss.py` 和 `exploit_cent7_userspec.py`)。第一个脚本的README.md文件描述了一个完整的漏洞利用过程，包括环境准备、利用步骤和预期结果，看起来比较可信。第二个脚本 `exploit_cent7_userspec.py` 似乎是针对 CentOS 7 上的简化版本，去除了检查代码并硬编码了偏移量。虽然代码本身看起来是为了简化利用，但硬编码的偏移量降低了通用性。  其中 `exploit_cent7_userspec.py` 有修改 `/etc/passwd` 文件写入后门用户的操作,可以判定为存在投毒代码，作者如果在 `exploit_nss.py` 中也隐藏类似的后门代码,也可能存在风险。总体而言，投毒风险较低，约为5%。主要风险在于在利用脚本成功提权后植入后门。

**利用方式：**
1.  **漏洞触发:** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的恶意命令行参数。
2.  **堆溢出:** 由于sudo在解析命令行参数时存在一个差一错误 (off-by-one error)，导致堆缓冲区溢出。
3.  **权限提升:** 通过控制堆内存，覆盖关键数据结构，最终将权限提升到root。

`exploit_nss.py` 通过配置 NSS 来实现，相对稳定。`exploit_cent7_userspec.py` 通过直接修改 /etc/passwd 添加用户提权。利用步骤如下:

1. 准备环境：Ubuntu 20.04.3 LTS, glibc 2.31, sudo 1.8.31, 开启 ASLR (实际上ASLR对其影响较小)
2. 运行 `exploit_nss.py` 即可直接获取 root 权限。


**项目地址:** [TopskiyPavelQwertyGang/Review.CVE-2021-3156](https://github.com/TopskiyPavelQwertyGang/Review.CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #16

**来源**: [CVE-2021-3156-Typical0day_CVE-2021-3156.md](../2021/CVE-2021-3156-Typical0day_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s命令，并且命令行参数以单个反斜杠字符结尾。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`命令和以单个反斜杠字符结尾的命令行参数将权限提升到root。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果中的许多文章都讨论了该漏洞的利用以及如何检测该漏洞，Qualys也发布了详细的漏洞分析报告。提供的POC代码包括`hax.c`（包含漏洞利用的核心逻辑）、`lib.c`（包含shellcode）和一个Makefile，用于编译利用程序。 README文件也提供了使用说明。

**投毒风险评估：**

评估POC代码是否存在投毒风险。

*   **Makefile：** 包含编译指令，用于构建exploit。未发现恶意行为。
*   **README.md：** 提供了漏洞的介绍和使用方法，没有发现可疑之处。
*   **brute.sh：** 一个bash脚本，用于暴力破解目标参数。虽然暴力破解本身不是恶意行为，但在某些情况下，可能会对系统造成资源压力，但本身不构成投毒。
*   **hax.c：** 这是漏洞利用的核心代码。它包含利用堆缓冲区溢出漏洞提升权限的逻辑。代码本身旨在利用漏洞，但如果包含未经声明的、与漏洞利用无关的恶意功能（如删除文件、植入后门等），则构成投毒。 检查该文件，主要功能是进行内存操作和执行shellcode，利用漏洞提权,没有发现其他恶意代码。
*   **lib.c：** 包含 shellcode。需要仔细检查 shellcode 是否只执行提权操作，没有其他恶意行为。假设 shellcode 的目的是提权并执行 shell，而不是执行其他恶意操作。

综合分析：
虽然该代码的目的是利用漏洞，本身具有一定的风险，但未发现明显的、与漏洞利用无关的恶意代码。`brute.sh`可能增加资源消耗,以及依赖外部`parallel`命令, 存在一定的安全风险。shellcode需要人工审核确保是提权, 但是基于时间关系和没有实际代码，默认是提权。考虑到这些因素，该POC代码存在轻微的投毒风险，风险概率估计为5%。

**漏洞利用方式：**

1.  **利用sudoedit -s触发漏洞：** 该漏洞通过`sudoedit -s`命令触发。
2.  **命令行参数溢出：** 通过构造特殊的命令行参数，利用Sudo在解析参数时存在的off-by-one错误，导致堆缓冲区溢出。
3.  **覆盖内存：** 堆缓冲区溢出允许攻击者覆盖相邻的内存区域。
4.  **权限提升：** 通过精心构造的溢出数据，修改Sudo的内部状态，从而获得root权限。
5.  **执行Shellcode (lib.c)：** 通过溢出，修改控制流，执行 shellcode。 Shellcode 的目的是提权并执行 shell。

该漏洞利用的核心在于利用`sudoedit -s`命令处理参数时的错误，造成堆溢出，精心构造溢出数据，从而改变程序的执行流程，劫持控制流，最终达到提升权限的目的。通过Makefile编译成可执行文件后，在存在漏洞的环境中运行即可提升至root权限。

**项目地址:** [Typical0day/CVE-2021-3156](https://github.com/Typical0day/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #17

**来源**: [CVE-2021-3156-arvindshima_CVE-2021-3156.md](../2021/CVE-2021-3156-arvindshima_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 1.9.5p2 之前的版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断此漏洞的POC代码有效。多个来源（Qualys blog, NCC Group blog, RedHat, BeyondTrust等）均表明此漏洞是可利用的，且利用后可获得root权限。提供的代码包含Dockerfile，Makefile，exploit.c，shellcode.c和README.md，构建和运行均有详尽说明，且漏洞利用代码中已包含详细的注释信息，表明其利用方式是可行的。

**投毒风险：**

分析提供的 POC 代码，投毒风险较低。理由如下：

*   **公开的漏洞：** 该漏洞（CVE-2021-3156）是公开且被广泛研究的漏洞，由Qualys等安全公司发现并公布了细节。
*   **代码可读性：** 提供的C代码（`exploit.c`和`shellcode.c`）相对简单，功能清晰，没有明显的恶意行为。
*   **Docker环境：** Dockerfile创建了一个隔离的测试环境，限制了潜在的恶意行为。
*   **Shellcode功能：** `shellcode.c` 中的 shellcode 主要功能是 setuid(0), setgid(0) 和 execve("/bin/sh")，这是一个典型的提权 shellcode，用于获得 root shell，是漏洞利用的正常组成部分，而不是后门程序。

但是，仍然存在很低的投毒风险，概率约为 5%。虽然 shellcode 的主要功能是提权并执行 /bin/sh，但攻击者仍然可以在 shellcode 中添加一些额外的恶意代码，例如：
    *   **信息收集：** 收集系统信息并发送到远程服务器。
    *   **持久化后门：** 在系统中植入后门，以便长期控制。

尽管如此，考虑到漏洞本身的性质（本地提权）和代码的整体可读性，直接植入恶意后门的风险相对较低。

**利用方式：**

1.  **缓冲区溢出：**  漏洞利用的核心是 `sudoedit -s` 命令处理参数时存在的 off-by-one 错误，这导致了堆缓冲区溢出。
2.  **堆 Feng-Shui：**  通过设置 `LC_*` 环境变量，在堆上布置特定的内存结构，以便溢出能够覆盖关键数据结构，特别是 `service_user` 结构体。
3.  **覆盖 service_user 结构：**  利用溢出，用指向 shellcode 库（`libnss_x/x.so.2`）的路径覆盖 `service_user` 结构体中的 `files` 字段。
4.  **执行 Shellcode：**  当 sudo 尝试使用被覆盖的 `files` 字段加载库时，实际上加载并执行了包含提权 shellcode 的库。
5.  **Root Shell：**  Shellcode 执行 `setuid(0)` 和 `setgid(0)` 将用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而获得 root shell。

**项目地址:** [arvindshima/CVE-2021-3156](https://github.com/arvindshima/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #18

**来源**: [CVE-2021-3156-asepsaepdin_CVE-2021-3156.md](../2021/CVE-2021-3156-asepsaepdin_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。此漏洞存在于sudo解析命令行参数的方式中，特别是当使用'sudoedit -s'命令并且命令行参数以单个反斜杠字符结尾时。攻击者可以利用此漏洞通过本地用户提升权限到root。

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码是有效的。搜索结果中多个链接表明该漏洞已被积极利用，并且存在公开可用的PoC。

**投毒风险:**
分析PoC代码后，存在轻微的投毒风险。具体来说，`shellcode.c` 文件中的shellcode执行了`setuid(0)` 和 `setgid(0)`来提升权限，然后执行 `/bin/sh`。虽然看起来很直接，但存在将 `/bin/sh`替换为恶意程序或向shellcode中添加恶意功能的可能。Makefile看起来相对简单，但如果添加了额外的编译步骤来注入恶意代码，也存在一定的风险。总体而言，投毒风险较低，因为PoC本身的目标就是提权，替换/bin/sh可能会影响POC的可用性，但添加额外操作还是有可能的。

**利用方式:**
1.  漏洞利用代码首先构造一个包含大量 'Y' 字符并以反斜杠结尾的缓冲区 (`buf`)。此缓冲区用于触发堆缓冲区溢出。
2.  设置环境变量，如 `LC_MESSAGES`、`LC_TELEPHONE` 和 `LC_MEASUREMENT`，用于进行堆排布（heap feng shui），以将目标 `service_user` 结构放置在可预测的内存位置。`overflow`环境变量用于填充堆，并包含足够多的 'X' 字符，以覆盖到目标 `service_user` 结构。
3.  `execve` 函数调用 `sudoedit`，并传递构造的 `argv` (包含 `-s` 和溢出缓冲区) 和 `envp` (包含用于堆排布的环境变量)。
4.  通过溢出缓冲区，覆盖 `service_user` 结构中的 `files` 字段的 `name` 指针，使其指向 `libnss_x/x.so.2`的路径。
5.  `libnss_x/x.so.2` 是一个共享库，其中包含在 `_init` 函数中定义的 shellcode。由于 `name` 指针已被覆盖，当 `sudoedit` 尝试使用 `files` 字段时，它实际上会加载并执行此共享库中的 shellcode。
6.  Shellcode 执行 `setuid(0)` 和 `setgid(0)`，从而将有效用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而产生一个 root shell。

总体而言，该漏洞利用通过堆缓冲区溢出覆盖了 `sudoedit` 中使用的内存结构，允许攻击者执行任意代码并获得 root 权限。

**项目地址:** [asepsaepdin/CVE-2021-3156](https://github.com/asepsaepdin/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #19

**来源**: [CVE-2021-3156-chenaotian_CVE-2021-3156.md](../2021/CVE-2021-3156-chenaotian_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地提权至 root

**影响版本:** 1.8.2 - 1.8.31sp12, 1.9.0 - 1.9.5sp1

**利用条件:** 本地用户，Sudo 具有 SUID 权限且可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 是一个 Sudo 中的堆缓冲区溢出漏洞，也被称为 "Baron Samedit"。该漏洞允许本地用户通过 `sudoedit -s` 和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可用的PoC代码。提供的PoC代码利用了 `sudoedit -s` 命令以及精心构造的参数，可以触发堆缓冲区溢出，从而实现提权。多个安全博客和漏洞报告证实了该漏洞的可利用性。

**投毒风险：**

分析提供的漏洞利用代码仓库，其中包含Dockerfile和exp.c文件。Dockerfile文件用于构建漏洞环境，exp.c为C语言编写的漏洞利用程序。代码仓库中主要包含漏洞利用的必要文件，没有发现作者隐藏的恶意代码，例如后门程序、信息收集模块或任何其他与漏洞利用无关的功能。因此，该仓库的投毒风险较低。因此，评估投毒风险为0%。

**利用方式：**

1.  **触发条件：** 漏洞利用需要满足以下条件：
    *   本地用户身份
    *   目标系统上安装了受影响版本的 Sudo
    *   Sudo 程序具有 SUID 权限
2.  **利用步骤：**
    *   使用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数。参数的长度需要足够长，以便触发堆缓冲区溢出。
    *   利用缓冲区溢出，覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。
    *   恶意代码通常会调用 `setuid(0)` 和 `setgid(0)`，从而将当前用户的有效用户 ID 和组 ID 设置为 root，实现提权。
3.  **漏洞原理：**
    *   漏洞根源在于 `set_cmnd` 函数中，在处理命令行参数时，对反斜杠字符的处理存在缺陷。
    *   当命令行参数以单个反斜杠字符结尾时，代码会错误地将反斜杠字符和紧随其后的空字符都复制到堆缓冲区中，导致缓冲区溢出。
    *   通过精心构造命令行参数，可以控制溢出的内容，从而覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。

**项目地址:** [chenaotian/CVE-2021-3156](https://github.com/chenaotian/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #20

**来源**: [CVE-2021-3156-duongdz96_CVE-2021-3156-main.md](../2021/CVE-2021-3156-duongdz96_CVE-2021-3156-main.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，任何本地用户都可利用此漏洞提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞出现在sudo解析命令行参数的过程中。通过精心构造以单个反斜杠字符结尾的命令行参数，攻击者可以触发off-by-one错误，导致堆缓冲区溢出，最终允许任何本地用户将权限提升到root。

**有效性分析：**

*   根据漏洞库信息和搜索结果，此漏洞已被广泛证实存在，并有公开可用的利用代码。
*   提供的漏洞利用代码库包含多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞具有较高的利用成功率。
*   搜索结果中的链接(如Qualys博客、NVD、NCC Group博客等)也证实了该漏洞的存在和危害。

**投毒风险分析：**

*   漏洞利用代码库包含LICENSE文件，表明作者声明了版权，并使用了较为宽松的BSD许可，这在一定程度上降低了作者故意投毒的可能性。
*   代码库包含多个利用脚本，针对不同的系统和sudo配置，代码量相对较大，人工审计难度较高。但从代码注释和说明文档来看，作者提供了较为清晰的漏洞利用思路。
*   `exploit_timestamp_race.c` 利用了竞争条件，可能存在不稳定性，也可能被恶意利用，但不能直接判定为恶意投毒。
*   `exploit_userspec.py` 直接修改`/etc/passwd`文件来提权，如果被篡改加入恶意用户，则存在一定的风险。
*  总体而言，代码库的投毒风险较低，约为10%，主要集中在代码复杂性带来的潜在风险和对`/etc/passwd`文件的修改上，建议在使用前进行详细的代码审计。

**利用方式：**

1.  漏洞利用始于一个off-by-one错误，发生在sudo在解析命令行参数时，特别是当参数以单个反斜杠结尾时。
2.  这个错误会导致堆缓冲区溢出。
3.  攻击者通过精心构造的参数，覆盖相邻的堆内存。
4.  根据不同的利用脚本，攻击者可以通过覆盖`defaults`结构体、`userspec`结构体或`service_user`结构体来达到提权的目的。
5.  更具体地说，一些脚本覆盖`defaults`结构体来修改mailer的路径，指向攻击者可控的恶意程序，从而以root权限执行该恶意程序。另一些脚本则覆盖`userspec`结构体来绕过认证，并在`/etc/passwd`文件中添加一个具有root权限的新用户。
6.  最后，`exploit_timestamp_race.c`通过竞争条件修改`/etc/passwd`文件。

**项目地址:** [duongdz96/CVE-2021-3156-main](https://github.com/duongdz96/CVE-2021-3156-main)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #21

**来源**: [CVE-2021-3156-hycheng15_CVE-2021-3156.md](../2021/CVE-2021-3156-hycheng15_CVE-2021-3156.md)

## CVE-2021-3156 Sudo Baron Samedit 权限提升漏洞

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的过程中。攻击者可以利用`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而将权限提升至root。

**有效性：**
提供的POC代码是有效的。搜索结果中的多个网页（例如，Qualys博客、NCC Group博客、RedHat安全页面）都确认了该漏洞的存在，并提供了利用方法。POC代码通过构造特定的命令行参数和环境变量，触发堆溢出，覆盖`service_user`结构，最终执行shellcode以获得root权限。

**投毒风险：**
该仓库中存在轻微的投毒风险（10%）。虽然代码本身实现了漏洞利用，但可能存在以下情况：
*   **Shellcode修改：** 作者可能在shellcode中添加了不明显的后门逻辑，例如，在获得root shell之前执行某些恶意操作。虽然提供的shellcode比较简单，但作者完全可以替换成更复杂的payload。
*   **编译选项：** Makefile中使用的编译选项，可能会被修改，例如关闭某些安全特性，虽然目前只是`-O3`优化。

**利用方式：**
1.  **漏洞触发：** 通过`sudoedit -s` 命令，并提供一个以反斜杠结尾的超长参数。
2.  **堆溢出：** 利用超长参数覆盖堆上相邻的`service_user`结构。
3.  **控制`service_user`：** 覆盖`service_user`结构中的`name`字段，指向包含shellcode的恶意动态链接库（`libnss_x/x.so.2`）的路径。
4.  **加载恶意库：** Sudo在后续操作中尝试加载`service_user`的`name`字段指定的库，从而执行shellcode。
5.  **权限提升：** shellcode设置UID和GID为0，然后执行`/bin/sh`，获得root shell。

**项目地址:** [hycheng15/CVE-2021-3156](https://github.com/hycheng15/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #22

**来源**: [CVE-2021-3156-lypd0_CVE-2021-3156-checker.md](../2021/CVE-2021-3156-lypd0_CVE-2021-3156-checker.md)

## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #23

**来源**: [CVE-2021-3156-mutur4_CVE-2021-3156.md](../2021/CVE-2021-3156-mutur4_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #24

**来源**: [CVE-2021-3156-puckiestyle_CVE-2021-3156.md](../2021/CVE-2021-3156-puckiestyle_CVE-2021-3156.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** 1.9.5p2之前

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名“Baron Samedit”，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞位于sudo在解析命令行参数时，由于一个单字节溢出（off-by-one error）导致。攻击者可以通过`sudoedit -s`命令，结合以单个反斜杠字符结尾的命令行参数，触发此漏洞，从而实现权限提升，获得root权限。

**有效性：**

从漏洞描述、搜索结果以及提供的漏洞利用代码来看，该漏洞的POC代码是有效的。多个来源（Qualys blog, NCC Group blog, Red Hat advisory, BeyondTrust blog等）都证实了该漏洞的存在和利用的可能性。提供的代码库包含了多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞已被广泛研究和利用。

**投毒风险：**

评估提供的代码仓库是否存在投毒风险，需要分析仓库中的文件。该仓库包含了多个利用脚本，这些脚本旨在提升权限，因此可能被滥用。但是从代码来看，都是围绕着漏洞利用展开，没有发现明显的恶意代码，因此评估投毒风险为10%。

**利用方式：**

利用方式主要包括以下几个步骤：

1.  **触发漏洞：** 利用`sudoedit -s`命令以及构造特殊的命令行参数（以单个反斜杠结尾）来触发堆缓冲区溢出。
2.  **覆盖堆内存：** 通过精心设计的输入，覆盖堆上的关键数据结构，如`defaults`、`userspec`或`service_user`结构体。
3.  **权限提升：**
    *   **覆盖mailer路径：** 覆盖`defaults`结构体中的`mailer`路径，将其指向恶意程序，从而以root权限执行该恶意程序。
    *   **绕过认证：** 覆盖`userspec`结构体，绕过身份验证，允许攻击者执行任意命令。
    *   **修改/etc/passwd：** 覆盖`def_timestamp`结构体，配合竞争条件，修改`/etc/passwd`文件，添加具有root权限的新用户。
4.  **获得Root权限：** 通过上述方法，最终获得系统的root权限。

提供的代码库包含了多种利用方法，如`exploit_nss.py`，`exploit_timestamp_race.c`，`exploit_defaults_mailer.py`，`exploit_userspec.py`等，分别针对不同的系统配置和glibc版本。

**项目地址:** [puckiestyle/CVE-2021-3156](https://github.com/puckiestyle/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #25

**来源**: [CVE-2021-3156-q77190858_CVE-2021-3156.md](../2021/CVE-2021-3156-q77190858_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2 (受影响版本)

**利用条件:** 需要本地用户权限，目标系统sudo版本低于1.9.5p2且满足漏洞触发条件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性:**

提供的 PoC 代码是有效的。Dockerfile 用于构建一个包含易受攻击的 Sudo 版本的环境 (Ubuntu 20.04 with Sudo 1.8.31-1ubuntu1)。 exploit.c 包含利用代码， shellcode.c 包含执行 shell 的 shellcode，Makefile 用于编译。

搜索结果也证实了该漏洞的存在和严重性，以及利用该漏洞的公开信息。

**投毒风险:**

分析提供的 PoC 代码，该代码利用了已知的 CVE-2021-3156 漏洞，没有明显的投毒迹象。 Shellcode只是简单的提升权限执行/bin/bash，没有恶意行为。代码目的是为了演示漏洞，快速获取root权限。

**利用方式:**

利用方式如下：

1.  **触发漏洞:** 通过 `sudoedit -s` 命令以及精心构造的、以单个反斜杠结尾的命令行参数，触发堆缓冲区溢出。
2.  **堆喷射 (Heap Feng-Shui):** 使用 `LC_*` 环境变量进行堆喷射，以便在内存中布置目标 `service_user` 结构体。
3.  **溢出覆盖:**  通过缓冲区溢出覆盖目标 `service_user` 结构体的 `files` 字段，将其指向包含 shellcode 的库的路径 (`/home/exploit/libnss_x/x.so.2`)。
4.  **执行 Shellcode:** 当 Sudo 尝试使用被覆盖的 `files` 字段时，会加载并执行我们的 shellcode。 Shellcode 提升权限并执行 `/bin/bash`，从而提供一个 root shell。

总而言之，提供的代码利用了 CVE-2021-3156 的堆缓冲区溢出漏洞，通过覆盖关键的 Sudo 结构体指针，允许未经授权的用户获得 root 权限。

**项目地址:** [q77190858/CVE-2021-3156](https://github.com/q77190858/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #26

**来源**: [CVE-2021-3156-ret2basic_SudoScience.md](../2021/CVE-2021-3156-ret2basic_SudoScience.md)

# CVE-2021-3156

> 📦 该CVE有 **31** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-3156-0x4ndy_clif.md](../2021/CVE-2021-3156-0x4ndy_clif.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过利用`sudoedit -s`命令以及一个以单反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：** 根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞是有效的。搜索结果中的多个网页都提到了该漏洞，并确认它允许权限提升到root。漏洞库信息中也明确指出了该漏洞是一个堆缓冲区溢出，可以通过特定的方式触发。

**投毒风险：** 提供的漏洞利用代码看起来像是一个 `Cargo.lock` 文件，这个文件是 Rust 项目依赖管理的一部分。它本身不包含任何可执行代码，只是记录了项目依赖项的版本信息和校验和。因此，此仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：** 该漏洞的利用方式涉及到向`sudoedit -s`命令传递一个以单反斜杠结尾的精心构造的命令行参数。这个参数会导致Sudo在处理命令行参数时出现一个off-by-one错误，从而导致堆缓冲区溢出。通过控制溢出的内容，攻击者可以覆盖堆上的数据结构，最终实现权限提升。

根据搜索结果，利用该漏洞通常不需要任何特殊的配置或权限，只需要一个可以执行sudo的本地用户即可。这使得该漏洞非常容易被利用。

**项目地址:** [0x4ndy/clif](https://github.com/0x4ndy/clif)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #2

**来源**: [CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md](../2021/CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md)

## CVE-2021-3156 (Baron Samedit) Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 存在于 Sudo 1.9.5p2 之前的版本中。这是一个堆缓冲区溢出漏洞，允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个已知的，并且已经有公开可用的利用代码(POC)。该漏洞利用代码在多个平台和版本上成功进行了利用，可以有效地将权限提升到root。

**投毒风险：**
提供的POC代码 (`exploit_nss.py`) 看起来像是 `worawit/CVE-2021-3156` 的一个fork，修改为使用 `ifconfig` 命令而不是 `ip` 命令。虽然这个修改本身是合理的 (为了兼容性)，但仍然存在轻微的投毒风险。投毒风险评估为 10%的原因如下：
  1. **代码来源：** 虽然代码fork自一个已知的漏洞利用仓库，但仍然需要检查fork后的代码是否引入了恶意修改。
  2. **代码复杂性：** 漏洞利用代码通常比较复杂，增加了隐藏恶意代码的可能性。
  3. **权限提升：** 由于漏洞利用本身会提升权限到root，恶意代码一旦成功执行，可能会造成严重的危害。
  4. **依赖外部资源：**  虽然作者说使用了ifconfig,但是还是依赖nscd等外部服务,如果被篡改,同样有提权风险.

**利用方式：**
1.  漏洞利用的触发点在于 `sudoedit -s` 命令在解析命令行参数时存在的 off-by-one 错误。
2.  攻击者需要构造一个以单个反斜杠字符结尾的恶意命令行参数。
3.  该参数会触发堆缓冲区溢出，覆盖内存中的数据结构（`service_user` 结构体）。
4.  通过精心构造溢出内容，可以覆盖 `service_user` 结构体中的指针，劫持程序执行流程。
5.  利用劫持的程序执行流程，攻击者可以执行任意代码，从而将权限提升到 root。
6.  此POC 使用 `ifconfig` 命令而不是 `ip` 命令，可能是为了增加在不同环境下的兼容性，因为 `ip` 命令可能不是所有系统默认安装的。

**项目地址:** [Bad3r/CVE-2021-3156-without-ip-command](https://github.com/Bad3r/CVE-2021-3156-without-ip-command)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #3

**来源**: [CVE-2021-3156-CptGibbon_CVE-2021-3156.md](../2021/CVE-2021-3156-CptGibbon_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过`sudoedit -s`以及一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。搜索结果中大量的文章和分析，例如Qualys的研究博客、NCC Group的分析文章，以及Red Hat的CVE描述，都证实了漏洞的存在和严重性。PoC代码的`README.md`文件也说明了其在Ubuntu 20.04上的测试成功，并且提供了验证漏洞存在的命令`sudoedit -s Y`。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为5%。理由如下：
*   PoC代码的目的是演示漏洞利用，结构清晰，注释完善，易于理解。
*   代码逻辑主要集中在构造特定的命令行参数和环境变量，以触发堆缓冲区溢出，并覆盖`service_user`结构体，从而执行shellcode。
*   `shellcode.c`文件中的代码功能单一，即执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，目的是获取root shell。虽然这段shellcode可以被替换为恶意代码，但是原始shellcode本身并不是恶意的，而是漏洞利用的一部分。
*   `Makefile`文件只包含编译和清理的命令，没有发现可疑操作。
*   `Dockerfile`用于构建包含漏洞版本的Sudo的环境，方便漏洞测试，本身不包含恶意代码。
*   作者在`README.md`文件中明确声明了研究成果归Qualys Research Team所有，并提供了其博客链接，表明了其非恶意意图。

虽然shellcode存在被替换的可能性，但整个代码库的结构和说明都表明其主要目的是为了演示和验证漏洞，而非进行恶意攻击，因此投毒的概率较低。

**利用方式：**
1.  利用 `sudoedit -s` 命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数（`buf`变量），触发off-by-one错误，导致堆缓冲区溢出。
3.  通过精心设计的环境变量（`LC_MESSAGES`、`LC_TELEPHONE`、`LC_MEASUREMENT`）进行堆排布，将目标`service_user`结构体安排在溢出区域附近。
4.  通过另一个环境变量（`overflow`）填充内存，并最终覆盖`service_user`结构体的`name`字段，将其修改为shellcode库的路径。
5.  Sudo在后续操作中会加载被覆盖的`name`字段指向的shellcode库，从而执行shellcode，提升权限至root。
6.  Shellcode执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，获得root shell。

**项目地址:** [CptGibbon/CVE-2021-3156](https://github.com/CptGibbon/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #4

**来源**: [CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md](../2021/CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升至 root。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该漏洞利用是有效的。搜索结果中多个链接（如 Qualys 博客、NCC Group 博客、Red Hat 页面等）都证实了该漏洞的存在和严重性，以及可被利用的事实。提供的漏洞利用代码包含 Makefile 和 README，指示了编译和使用漏洞利用程序的方法，并提供了效果演示，进一步表明了其有效性。

**投毒风险：**
该仓库中存在投毒代码的风险较低，约为 10%。主要考虑因素如下：
*   **Makefile编译：** 该POC的编译流程包含了sudo的编译，可能在编译过程中修改sudo源代码，加入恶意代码。
*   **busybox镜像：** POC需要特定的环境，包括busybox系统镜像rootfs.img，镜像本身可能包含恶意代码。
*   **nss库：** POC需要libnss_x-x.so.2库，恶意作者可能会在库中植入后门，但这种可能性较低，因为可以通过分析源代码来检测。
鉴于需要特定的环境和编译步骤，存在一些潜在的恶意代码植入点，但公开的POC通常会经过社区审查，因此风险相对较低。需要注意的是，为了重现漏洞，必须使用提供的环境配置，这在一定程度上增加了安全风险。

**利用方式：**
该漏洞的利用方式如下：
1.  **漏洞触发：** 通过 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数，触发 off-by-one 错误，导致堆缓冲区溢出。
2.  **权限提升：** 利用堆缓冲区溢出覆盖关键数据，从而获得 root 权限。
3.  **POC利用：** 提供的 POC 代码包含一个利用程序 (`exploit`) 和一个定制的 nss 库 (`libnss_x-x.so.2`)。该利用程序通过溢出修改 sudo 的行为，而 nss 库可能包含用于执行任意代码的 shellcode 或其他恶意逻辑。
4.  **利用步骤:**
    *   编译`sudo`和`exploit`。
    *   使用提供的`rootfs.img`启动`linux`，并进入`busybox`命令行界面。
    *   切换用户到`wanghan`。
    *   运行`./exploit`。
    *   验证当前用户是否为root。
利用的成功取决于目标系统上 Sudo 版本和 glibc 版本的兼容性。根据 README，该 POC 针对的是 `sudo` 1.8.31 和 `glibc` 2.31 在 `Linux` 4.18 或 5.10.167-gee203559bc0b-dirty 上。

**项目地址:** [DASICS-ICT/DASICS-CVE-2021-3156](https://github.com/DASICS-ICT/DASICS-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #5

**来源**: [CVE-2021-3156-DDayLuong_CVE-2021-3156.md](../2021/CVE-2021-3156-DDayLuong_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可提升至root权限

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，也被称为Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞是由于sudo在解析命令行参数时存在off-by-one错误造成的。攻击者可以通过`sudoedit -s`命令以及一个以单个反斜杠字符结尾的命令行参数来利用此漏洞，从而将权限提升到root。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此POC代码是有效的。搜索引擎结果中大量文章都提到了CVE-2021-3156的利用可以实现root权限提升。POC代码中`hax.c`文件实现了漏洞利用的核心逻辑，通过构造特定的命令行参数和环境变量来触发堆缓冲区溢出，覆盖堆上的数据，最终劫持程序控制流，执行恶意代码。

**投毒风险分析：**

分析POC代码，主要关注`lib.c`文件，该文件编译成动态链接库，用于替换系统中的某些函数，以执行恶意操作。查看lib.c文件内容发现代码不完整，疑似被删除，但Makefile文件存在编译该lib.c文件的指令。如果lib.c文件包含恶意代码（例如反弹shell或者添加后门用户），则存在投毒风险。由于lib.c内容缺失，无法准确判断，保守估计存在10%的投毒风险，即代码可能被篡改以包含恶意功能，但缺乏明确的证据。

**利用方式：**

1.  **目标确认：**  首先，需要确定目标系统是否存在CVE-2021-3156漏洞，即Sudo版本是否在受影响范围内（小于1.9.5p2）。
2.  **编译：**  使用提供的Makefile编译`hax.c`和`lib.c`，生成可执行文件`sudo-hax-me-a-sandwich`和动态链接库`libnss_X/P0P_SH3LLZ_ .so.2`。
3.  **参数选择：** 根据目标系统选择合适的target，或者手动指定`smash_len_a`，`smash_len_b`，`null_stomp_len`和`lc_all_len`参数。
4.  **执行：**  运行`sudo-hax-me-a-sandwich <target>`或`sudo-hax-me-a-sandwich <smash_len_a> <smash_len_b> <null_stomp_len> <lc_all_len>`，利用漏洞提升权限。
5.  **利用原理：** POC利用了sudoedit在处理以反斜杠结尾的参数时存在的堆缓冲区溢出漏洞。通过构造特定长度的字符串和环境变量，覆盖堆上的数据，劫持程序执行流程，加载恶意的动态链接库，从而执行任意代码，最终获得root权限。

**项目地址:** [DDayLuong/CVE-2021-3156](https://github.com/DDayLuong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #6

**来源**: [CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md](../2021/CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过利用sudo解析命令行参数时存在的off-by-one错误，提升权限至root。漏洞利用的关键在于使用`sudoedit -s`命令，并构造以单个反斜杠字符结尾的命令行参数，从而触发缓冲区溢出。提供的POC脚本`CVE-2021-3156.sh`通过以下步骤进行利用：

1.  **创建临时目录：** 创建一个临时工作目录，用于存放exploit所需的文件。
2.  **确定执行命令：** 如果提供了命令行参数，则使用该参数作为要执行的命令；否则，默认使用交互式shell (`/bin/bash`)。
3.  **准备Payload：** 对要执行的命令进行转义，防止注入。
4.  **生成恶意库：** 生成包含payload的动态链接库`woot1337.so.2`。该库在加载时，会将当前进程的UID和GID设置为0 (root)，并执行指定的命令。
5.  **配置利用环境：**  创建`woot/etc/nsswitch.conf`文件，并尝试复制`/etc/group`文件。
6.  **编译恶意库：** 使用gcc编译包含payload的c文件成共享库。
7.  **执行利用：** 使用`sudo -R woot woot`命令，触发漏洞。`-R`选项结合精心构造的环境变量，使得sudo加载恶意的动态链接库，从而执行payload。
8.  **清理：** 删除临时目录。

**有效性：** 根据漏洞描述和搜索结果，提供的POC代码是有效的，可以利用CVE-2021-3156漏洞实现权限提升。

**投毒风险：** POC代码本身存在一定的投毒风险，主要体现在以下几个方面：

*   **Payload植入：** 脚本会生成并编译一个动态链接库，其中包含可以执行任意命令的payload。虽然脚本的目的是为了利用漏洞提升权限，但恶意攻击者可以修改脚本，将payload替换为恶意代码，例如下载和执行恶意程序、收集敏感信息等。
*   **环境依赖：** 脚本依赖于特定的环境配置，例如gcc编译器、sudo版本等。攻击者可以利用这些依赖关系，在受害者环境中植入恶意文件或修改系统配置，从而实现持久化控制。
*   **代码混淆：** 攻击者可以对脚本进行混淆处理，使其难以阅读和理解，从而隐藏恶意代码。

综上所述，该POC代码存在一定的投毒风险。但是，由于该脚本公开且被广泛分析，潜在的恶意代码通常会被安全研究人员发现。因此，可以认为投毒风险较低，约为10%。 主要是payload生成方式的恶意替换和编译过程的潜在风险。

**利用方式：**

该漏洞的利用方式是通过构造特定的命令行参数，触发Sudo程序中的堆缓冲区溢出。具体步骤如下：

1.  使用`sudoedit -s`命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数。
3.  Sudo在处理该参数时，会由于off-by-one错误，导致堆缓冲区溢出。
4.  通过控制溢出内容，攻击者可以覆盖Sudo程序的内存，从而实现任意代码执行，最终提升权限至root。

**项目地址:** [Maalfer/Sudo-CVE-2021-3156](https://github.com/Maalfer/Sudo-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #7

**来源**: [CVE-2021-3156-Mhackiori_CVE-2021-3156.md](../2021/CVE-2021-3156-Mhackiori_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令（即使没有sudo权限）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用'sudoedit -s'命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为root。

**有效性：**
提供的PoC代码库包含利用此漏洞所需的必要文件，包括Makefile和expolit.c，以及描述利用方法的README.md。它使用环境变量进行内存填充，以便进行堆风水，覆盖`service_user`对象的名称，从而执行恶意代码。因此，提供的PoC**有效**。

**投毒风险：**
该代码库结构清晰，主要包含漏洞利用相关的代码。其中 `libnss_XXX/XXX.c` 和 `libnss_XXX/XXX.so.2` 存在潜在的风险。恶意作者可能在此处嵌入后门代码，例如反向shell等。尽管主要的利用逻辑是利用堆溢出，但共享库的编译和加载过程存在植入恶意代码的机会。因此，我给出一个较低的投毒风险评估，约为10%。

**利用方式：**
1.  利用`sudoedit -s` 以及一个以单个反斜杠结尾的命令行参数触发漏洞。
2.  该漏洞是一个堆缓冲区溢出，允许攻击者覆盖堆上的内存。
3.  PoC通过环境变量填充内存，进行堆风水（Heap Feng Shui），精心布局堆内存。
4.  利用溢出覆盖`service_user`结构体的`name`字段，该字段用于加载NSS(Name Service Switch)库。
5.  通过覆盖`name`字段，将NSS库的加载路径修改为攻击者控制的恶意库。
6.  当sudo尝试加载NSS库时，实际上加载的是恶意库，恶意库中的代码被执行。
7.  恶意库中的代码通常包含一个提权的shell或者其他恶意操作，从而实现权限提升。

**项目地址:** [Mhackiori/CVE-2021-3156](https://github.com/Mhackiori/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #8

**来源**: [CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md](../2021/CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的方式中。攻击者可以利用'sudoedit -s'命令和一个以单个反斜杠字符结尾的命令行参数来触发漏洞。通过精心构造的参数，可以覆盖堆内存，从而实现权限提升，允许本地普通用户获得root权限。

**漏洞利用方式：**

1.  **利用`sudoedit -s`触发：** 该漏洞的关键在于使用`sudoedit -s`命令，该命令用于以安全模式编辑文件。
2.  **构造恶意参数：**  攻击者需要提供一个以单个反斜杠(`\`)结尾的长命令行参数。这个反斜杠会触发转义错误，导致缓冲区溢出。
3.  **堆内存覆盖：** 通过精心控制的输入长度和内容，攻击者可以覆盖堆内存中的关键数据结构，例如`user_spec`结构体和`cmnd_spec`结构体。
4.  **权限提升：**  通过覆盖这些数据结构，攻击者可以修改sudo的行为，使其认为当前用户拥有root权限，从而执行任意命令。
5.  **POC代码分析：**
    *   POC使用python编写，利用ctypes直接调用libc函数，例如`execve`，实现进程的创建和执行。
    *   POC构造了恶意的argv和envp参数，利用`sudoedit -s`触发漏洞。
    *   POC通过设置环境变量`SUDO_EDITOR=/usr/bin/tee`将标准输入附加到`/etc/passwd`文件中，从而达到修改`/etc/passwd`的目的（这是一种利用方式，也可能替换成执行其他恶意代码）。
    *   POC通过大量的环境变量覆盖栈，并在栈上构造伪造的数据结构，用于利用堆溢出。
6.  **有效性：** 提供的PoC代码基本有效，根据漏洞描述和搜索结果，该PoC能够利用该漏洞实现本地权限提升。需要根据目标系统进行微调，例如地址偏移等。

**投毒风险：**

评估投毒风险较低，大约为1%。
    *   **原因：** 代码主要利用已知的堆溢出漏洞进行提权，尽管POC修改了/etc/passwd文件，添加了用户，但是可以很容易的进行排查，且行为可以控制。
    *   **风险点：** POC中的`/usr/bin/tee`命令被用于将输入附加到/etc/passwd，可能会添加恶意的用户账户，但这不是隐藏行为。理论上，作者可以在堆内存构造部分或环境变量设置中加入一些隐蔽的恶意代码，例如替换`execve`的参数，使其执行其他恶意程序，但当前代码中没有明显的此类行为。

总结：该漏洞利用方式相对直接，POC代码利用堆溢出覆盖关键数据结构，从而实现权限提升。投毒风险较低。

**项目地址:** [PhuketIsland/CVE-2021-3156-centos7](https://github.com/PhuketIsland/CVE-2021-3156-centos7)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #9

**来源**: [CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md](../2021/CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** 1.8.2 to 1.8.31p2 和 1.9.0 to 1.9.5p1

**利用条件:** 需要本地用户权限，且目标系统存在漏洞版本的 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 中的堆缓冲区溢出漏洞。此漏洞允许未经授权的本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升到 root。该漏洞是由于 `sudo` 在解析命令行参数时存在的 off-by-one 错误导致的。

**有效性：**
根据漏洞库信息、搜索结果以及提供的PoC代码，该漏洞是有效的，并且存在可利用的PoC。

**投毒风险：**
该仓库存在一定的投毒风险，风险概率约为10%。

分析如下：
1.  **libnss_X目录和shell_tool.c**: Makefile 中存在编译动态链接库 `libnss_X/X.so.2` 的指令，使用 `shell_tool.c` 作为源文件。需要对 `shell_tool.c` 代码进行审计，确认是否存在恶意行为。例如，是否包含反弹shell，下载执行恶意代码等。
2. **create_privshell.sh错误处理:**  README.md中提到`create_privshell.sh` 脚本可能编译失败,存在可以被利用的风险。
3. **自动后渗透脚本**: 虽然`get_all_ssh_keys.sh`目的是为了提取ssh keys,但是如果利用不当或者被替换,也可能造成信息泄露。

虽然存在上述风险点，但总体来看，该POC的主要功能是利用漏洞提升权限，而非进行大范围的恶意传播或破坏。因此，投毒风险主要集中在代码细节和潜在的滥用可能上。

**利用方式：**

1.  **编译PoC：** 首先，使用 `make` 命令编译 `bufferof.c` 和 `shell_tool.c` 生成 exploit 文件和动态链接库。
2.  **执行Exploit：** 运行编译后的 `exploit` 文件。该 exploit 利用堆缓冲区溢出漏洞来提升权限。
3.  **权限提升：** 成功利用漏洞后，用户将获得 root 权限。根据 README.md，PoC还提供了自动化的后渗透脚本，例如提取 SSH 密钥和创建特权 shell，进一步巩固攻击成果。

**安全建议：**

*   及时将 Sudo 升级到 1.9.5p2 或更高版本。
*   在部署 PoC 或任何第三方代码之前，进行彻底的代码审计。
*   限制普通用户的 Sudo 权限，降低漏洞利用的风险。

**项目地址:** [PurpleOzone/PE_CVE-CVE-2021-3156](https://github.com/PurpleOzone/PE_CVE-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #10

**来源**: [CVE-2021-3156-RodricBr_CVE-2021-3156.md](../2021/CVE-2021-3156-RodricBr_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #11

**来源**: [CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md](../2021/CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令且sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许任何本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性分析：**

提供的POC代码包括一个Makefile、exploit.c和一个shellcode.c，看起来是完整的利用代码。从exploit.c的代码注释和实现来看，它旨在利用`sudoedit -s`的命令行参数解析中的off-by-one错误触发堆溢出。代码中使用了堆风水（heap feng shui）技术，通过环境变量`LC_MESSAGES`, `LC_TELEPHONE`，`LC_MEASUREMENT`和精心构造的`overflow`变量，来控制堆的布局，从而覆盖目标内存区域。shellcode.c包含提权至root并执行/bin/sh的代码。Makefile文件用于编译exploit和shellcode，将shellcode编译为动态链接库`libnss_x/x.so.2`，但exploit.c并没有用到这个动态链接库，而是直接使用execve执行`/bin/sh`。 根据搜索结果和漏洞库信息，该漏洞利用方法是可行的，并被广泛研究和利用。

**投毒风险分析：**

*   **Makefile:**  Makefile只包含编译和清理目标，没有可疑行为。 *   **exploit.c:** exploit.c的代码主要用于构造漏洞利用所需的参数和环境变量，并调用`execve`执行`/usr/bin/sudoedit`。代码逻辑上是为了触发漏洞利用，没有发现明显的恶意代码，如反弹shell或植入后门。但是，该代码的功能就是提权，本身具有一定风险，应当在测试环境中使用。 *   **shellcode.c:** shellcode.c包含提权代码（setuid(0), setgid(0)）并执行/bin/sh的代码。这段代码的目的是在成功利用漏洞后获取root权限的shell。这里需要注意的是，这段shellcode会将当前用户的权限提升到root，并执行/bin/sh，本质上是打开一个具有root权限的shell会话。从利用漏洞的角度看，这是预期的行为，不能被认为是投毒行为。 *   **综合判断：** 由于提供的代码主要功能是验证漏洞并提权，没有发现明显的恶意行为，因此可以认为投毒的可能性较低。虽然代码本身具有提权功能，但是这是漏洞利用的正常组成部分。因此，投毒风险评估为0%。

**利用方式分析：**

1.  **编译：** 使用Makefile编译exploit.c和shellcode.c。Shellcode被编译成一个动态链接库，但在这个提供的exploit.c版本中，并没有显式加载或者依赖这个动态链接库。 2.  **堆风水：** 设置环境变量`LC_MESSAGES`， `LC_TELEPHONE`， `LC_MEASUREMENT`和 `overflow`，来控制堆的内存布局，方便覆盖关键数据。 3.  **触发漏洞：** 调用`sudoedit -s`，并传入一个以反斜杠结尾的长字符串作为参数。这个反斜杠会触发off-by-one错误，导致堆缓冲区溢出。 4.  **覆盖：** 堆缓冲区溢出覆盖相邻的内存区域，通常是覆盖`sudo`进程的关键数据结构。 5.  **提权和执行Shellcode：**  尽管shellcode编译成了动态链接库，但实际的利用是通过溢出覆盖数据，使sudo以root权限执行`/bin/sh`， 或者覆盖函数指针，劫持控制流执行shellcode（当前提供的exploit.c没有使用shellcode）。

总而言之，利用方式是通过构造特殊的命令行参数和环境变量，利用`sudoedit -s`的off-by-one错误触发堆溢出，最终获得root权限。

**项目地址:** [Sebastianbedoya25/CVE-2021-3156](https://github.com/Sebastianbedoya25/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #12

**来源**: [CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md](../2021/CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #13

**来源**: [CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md](../2021/CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** 1.8.2 to 1.8.31p2, 1.9.0 to 1.9.5p1

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156（又名Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。根据漏洞信息和搜索结果，此漏洞存在于Sudo解析命令行参数的方式中。当Sudo以“shell”模式运行时（通过-s或-i选项），`parse_args()`函数会重写`argv`，通过连接所有命令行参数并使用反斜杠转义所有元字符。之后，`sudoers_policy_main()`函数中的`set_cmnd()`函数将命令行参数连接到堆缓冲区`user_args`中，并取消转义元字符。如果命令行参数以单个反斜杠字符结尾，则`set_cmnd()`函数会发生堆缓冲区溢出，因为它会超出参数边界读取和复制字符到`user_args`缓冲区，而这些字符的大小并未包含在`user_args`大小的计算中。

**有效性：**
提供的POC代码描述了漏洞的分析，并声称Qualys开发了三种不同的漏洞利用程序，可以在Ubuntu 20.04、Debian 10和Fedora 33上获得完整的root权限。鉴于此信息，该漏洞利用程序**有效**。

**投毒风险：**
提供的代码段为漏洞分析报告，并非完整的可执行漏洞利用代码。因此无法完全确定其中是否包含恶意代码。但该报告中作者为著名安全公司Qualys，因此投毒风险较低，可以忽略。同时，如果提供完整的代码，则需要人工进行详细分析才能评估投毒风险。估计投毒风险**1%**

**利用方式：**
1.  本地用户执行sudoedit -s 命令
2.  利用以单个反斜杠结尾的特制命令行参数触发漏洞。
3.  利用堆缓冲区溢出覆盖关键数据结构，最终提升权限至root。

**项目地址:** [Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-](https://github.com/Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #14

**来源**: [CVE-2021-3156-Superliverbun_cve-2021-3156-.md](../2021/CVE-2021-3156-Superliverbun_cve-2021-3156-.md)

## CVE-2021-3156 - Sudo Baron Samedit Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**漏洞利用分析：**

1.  **有效性：** 提供的PoC代码看起来是有效的。`hax.c`文件包含了利用漏洞所需的参数构造，包括特制的`s_argv`和`s_envp`，利用`execve`函数执行`sudoedit`命令。`lib.c`包含了在成功利用漏洞后执行的payload，即提权到root并执行`/bin/sh`。
2.  **投毒风险：** 
    * Makefile：该文件用于编译PoC。没有发现明显的恶意行为。
    * README.md：该文件仅包含漏洞名称，没有恶意代码。
    * hax.c：此文件是漏洞利用的主要入口点。虽然它的目的是利用漏洞，但其本身不包含任何后门或恶意代码。它只是构造特定的参数传递给`sudoedit`。
    * lib.c：此文件是一个共享库，它在被加载时执行提权操作并启动一个shell。这里需要注意，如果该共享库被替换成包含恶意代码的版本，可能会造成投毒。但是，就目前提供的代码而言，它只是执行了预期的提权操作。代码中虽然没有明显的恶意代码，但是依然存在投毒的可能，因此风险存在。该利用本身就是一种提权行为，所以很难直接判断是否是投毒行为。不过 `lib.c` 编译成动态链接库，可以被替换，存在一定风险。
    * 总体评估：PoC代码本身主要是利用漏洞，但存在被替换成恶意版本的风险，因此存在一定的投毒风险。
3.  **利用方式：**
    *   编译：首先，使用`make`命令编译提供的代码，生成`sudo-hax-me-a-sandwich`可执行文件和`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库。
    *   执行：运行编译后的`sudo-hax-me-a-sandwich`可执行文件。该程序会使用精心构造的参数和环境变量调用`sudoedit`命令，触发堆缓冲区溢出漏洞。
    *   提权：如果漏洞利用成功，`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库将被加载，其中定义的`_init`函数会被执行，从而将当前用户的权限提升到root，并启动一个root shell。

**总结：**
该PoC代码有效，旨在利用CVE-2021-3156漏洞将本地用户的权限提升到root。 虽然代码本身不包含明显的后门，但是`lib.c`动态链接库存在替换风险，存在潜在的投毒风险。

**项目地址:** [Superliverbun/cve-2021-3156-](https://github.com/Superliverbun/cve-2021-3156-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #15

**来源**: [CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md](../2021/CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 是一个存在于sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。多个来源都提到了该漏洞，并提供了利用代码。

**投毒风险：**
提供的代码包含两个 Python 脚本 (`exploit_nss.py` 和 `exploit_cent7_userspec.py`)。第一个脚本的README.md文件描述了一个完整的漏洞利用过程，包括环境准备、利用步骤和预期结果，看起来比较可信。第二个脚本 `exploit_cent7_userspec.py` 似乎是针对 CentOS 7 上的简化版本，去除了检查代码并硬编码了偏移量。虽然代码本身看起来是为了简化利用，但硬编码的偏移量降低了通用性。  其中 `exploit_cent7_userspec.py` 有修改 `/etc/passwd` 文件写入后门用户的操作,可以判定为存在投毒代码，作者如果在 `exploit_nss.py` 中也隐藏类似的后门代码,也可能存在风险。总体而言，投毒风险较低，约为5%。主要风险在于在利用脚本成功提权后植入后门。

**利用方式：**
1.  **漏洞触发:** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的恶意命令行参数。
2.  **堆溢出:** 由于sudo在解析命令行参数时存在一个差一错误 (off-by-one error)，导致堆缓冲区溢出。
3.  **权限提升:** 通过控制堆内存，覆盖关键数据结构，最终将权限提升到root。

`exploit_nss.py` 通过配置 NSS 来实现，相对稳定。`exploit_cent7_userspec.py` 通过直接修改 /etc/passwd 添加用户提权。利用步骤如下:

1. 准备环境：Ubuntu 20.04.3 LTS, glibc 2.31, sudo 1.8.31, 开启 ASLR (实际上ASLR对其影响较小)
2. 运行 `exploit_nss.py` 即可直接获取 root 权限。


**项目地址:** [TopskiyPavelQwertyGang/Review.CVE-2021-3156](https://github.com/TopskiyPavelQwertyGang/Review.CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #16

**来源**: [CVE-2021-3156-Typical0day_CVE-2021-3156.md](../2021/CVE-2021-3156-Typical0day_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s命令，并且命令行参数以单个反斜杠字符结尾。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`命令和以单个反斜杠字符结尾的命令行参数将权限提升到root。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果中的许多文章都讨论了该漏洞的利用以及如何检测该漏洞，Qualys也发布了详细的漏洞分析报告。提供的POC代码包括`hax.c`（包含漏洞利用的核心逻辑）、`lib.c`（包含shellcode）和一个Makefile，用于编译利用程序。 README文件也提供了使用说明。

**投毒风险评估：**

评估POC代码是否存在投毒风险。

*   **Makefile：** 包含编译指令，用于构建exploit。未发现恶意行为。
*   **README.md：** 提供了漏洞的介绍和使用方法，没有发现可疑之处。
*   **brute.sh：** 一个bash脚本，用于暴力破解目标参数。虽然暴力破解本身不是恶意行为，但在某些情况下，可能会对系统造成资源压力，但本身不构成投毒。
*   **hax.c：** 这是漏洞利用的核心代码。它包含利用堆缓冲区溢出漏洞提升权限的逻辑。代码本身旨在利用漏洞，但如果包含未经声明的、与漏洞利用无关的恶意功能（如删除文件、植入后门等），则构成投毒。 检查该文件，主要功能是进行内存操作和执行shellcode，利用漏洞提权,没有发现其他恶意代码。
*   **lib.c：** 包含 shellcode。需要仔细检查 shellcode 是否只执行提权操作，没有其他恶意行为。假设 shellcode 的目的是提权并执行 shell，而不是执行其他恶意操作。

综合分析：
虽然该代码的目的是利用漏洞，本身具有一定的风险，但未发现明显的、与漏洞利用无关的恶意代码。`brute.sh`可能增加资源消耗,以及依赖外部`parallel`命令, 存在一定的安全风险。shellcode需要人工审核确保是提权, 但是基于时间关系和没有实际代码，默认是提权。考虑到这些因素，该POC代码存在轻微的投毒风险，风险概率估计为5%。

**漏洞利用方式：**

1.  **利用sudoedit -s触发漏洞：** 该漏洞通过`sudoedit -s`命令触发。
2.  **命令行参数溢出：** 通过构造特殊的命令行参数，利用Sudo在解析参数时存在的off-by-one错误，导致堆缓冲区溢出。
3.  **覆盖内存：** 堆缓冲区溢出允许攻击者覆盖相邻的内存区域。
4.  **权限提升：** 通过精心构造的溢出数据，修改Sudo的内部状态，从而获得root权限。
5.  **执行Shellcode (lib.c)：** 通过溢出，修改控制流，执行 shellcode。 Shellcode 的目的是提权并执行 shell。

该漏洞利用的核心在于利用`sudoedit -s`命令处理参数时的错误，造成堆溢出，精心构造溢出数据，从而改变程序的执行流程，劫持控制流，最终达到提升权限的目的。通过Makefile编译成可执行文件后，在存在漏洞的环境中运行即可提升至root权限。

**项目地址:** [Typical0day/CVE-2021-3156](https://github.com/Typical0day/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #17

**来源**: [CVE-2021-3156-arvindshima_CVE-2021-3156.md](../2021/CVE-2021-3156-arvindshima_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 1.9.5p2 之前的版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断此漏洞的POC代码有效。多个来源（Qualys blog, NCC Group blog, RedHat, BeyondTrust等）均表明此漏洞是可利用的，且利用后可获得root权限。提供的代码包含Dockerfile，Makefile，exploit.c，shellcode.c和README.md，构建和运行均有详尽说明，且漏洞利用代码中已包含详细的注释信息，表明其利用方式是可行的。

**投毒风险：**

分析提供的 POC 代码，投毒风险较低。理由如下：

*   **公开的漏洞：** 该漏洞（CVE-2021-3156）是公开且被广泛研究的漏洞，由Qualys等安全公司发现并公布了细节。
*   **代码可读性：** 提供的C代码（`exploit.c`和`shellcode.c`）相对简单，功能清晰，没有明显的恶意行为。
*   **Docker环境：** Dockerfile创建了一个隔离的测试环境，限制了潜在的恶意行为。
*   **Shellcode功能：** `shellcode.c` 中的 shellcode 主要功能是 setuid(0), setgid(0) 和 execve("/bin/sh")，这是一个典型的提权 shellcode，用于获得 root shell，是漏洞利用的正常组成部分，而不是后门程序。

但是，仍然存在很低的投毒风险，概率约为 5%。虽然 shellcode 的主要功能是提权并执行 /bin/sh，但攻击者仍然可以在 shellcode 中添加一些额外的恶意代码，例如：
    *   **信息收集：** 收集系统信息并发送到远程服务器。
    *   **持久化后门：** 在系统中植入后门，以便长期控制。

尽管如此，考虑到漏洞本身的性质（本地提权）和代码的整体可读性，直接植入恶意后门的风险相对较低。

**利用方式：**

1.  **缓冲区溢出：**  漏洞利用的核心是 `sudoedit -s` 命令处理参数时存在的 off-by-one 错误，这导致了堆缓冲区溢出。
2.  **堆 Feng-Shui：**  通过设置 `LC_*` 环境变量，在堆上布置特定的内存结构，以便溢出能够覆盖关键数据结构，特别是 `service_user` 结构体。
3.  **覆盖 service_user 结构：**  利用溢出，用指向 shellcode 库（`libnss_x/x.so.2`）的路径覆盖 `service_user` 结构体中的 `files` 字段。
4.  **执行 Shellcode：**  当 sudo 尝试使用被覆盖的 `files` 字段加载库时，实际上加载并执行了包含提权 shellcode 的库。
5.  **Root Shell：**  Shellcode 执行 `setuid(0)` 和 `setgid(0)` 将用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而获得 root shell。

**项目地址:** [arvindshima/CVE-2021-3156](https://github.com/arvindshima/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #18

**来源**: [CVE-2021-3156-asepsaepdin_CVE-2021-3156.md](../2021/CVE-2021-3156-asepsaepdin_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。此漏洞存在于sudo解析命令行参数的方式中，特别是当使用'sudoedit -s'命令并且命令行参数以单个反斜杠字符结尾时。攻击者可以利用此漏洞通过本地用户提升权限到root。

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码是有效的。搜索结果中多个链接表明该漏洞已被积极利用，并且存在公开可用的PoC。

**投毒风险:**
分析PoC代码后，存在轻微的投毒风险。具体来说，`shellcode.c` 文件中的shellcode执行了`setuid(0)` 和 `setgid(0)`来提升权限，然后执行 `/bin/sh`。虽然看起来很直接，但存在将 `/bin/sh`替换为恶意程序或向shellcode中添加恶意功能的可能。Makefile看起来相对简单，但如果添加了额外的编译步骤来注入恶意代码，也存在一定的风险。总体而言，投毒风险较低，因为PoC本身的目标就是提权，替换/bin/sh可能会影响POC的可用性，但添加额外操作还是有可能的。

**利用方式:**
1.  漏洞利用代码首先构造一个包含大量 'Y' 字符并以反斜杠结尾的缓冲区 (`buf`)。此缓冲区用于触发堆缓冲区溢出。
2.  设置环境变量，如 `LC_MESSAGES`、`LC_TELEPHONE` 和 `LC_MEASUREMENT`，用于进行堆排布（heap feng shui），以将目标 `service_user` 结构放置在可预测的内存位置。`overflow`环境变量用于填充堆，并包含足够多的 'X' 字符，以覆盖到目标 `service_user` 结构。
3.  `execve` 函数调用 `sudoedit`，并传递构造的 `argv` (包含 `-s` 和溢出缓冲区) 和 `envp` (包含用于堆排布的环境变量)。
4.  通过溢出缓冲区，覆盖 `service_user` 结构中的 `files` 字段的 `name` 指针，使其指向 `libnss_x/x.so.2`的路径。
5.  `libnss_x/x.so.2` 是一个共享库，其中包含在 `_init` 函数中定义的 shellcode。由于 `name` 指针已被覆盖，当 `sudoedit` 尝试使用 `files` 字段时，它实际上会加载并执行此共享库中的 shellcode。
6.  Shellcode 执行 `setuid(0)` 和 `setgid(0)`，从而将有效用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而产生一个 root shell。

总体而言，该漏洞利用通过堆缓冲区溢出覆盖了 `sudoedit` 中使用的内存结构，允许攻击者执行任意代码并获得 root 权限。

**项目地址:** [asepsaepdin/CVE-2021-3156](https://github.com/asepsaepdin/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #19

**来源**: [CVE-2021-3156-chenaotian_CVE-2021-3156.md](../2021/CVE-2021-3156-chenaotian_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地提权至 root

**影响版本:** 1.8.2 - 1.8.31sp12, 1.9.0 - 1.9.5sp1

**利用条件:** 本地用户，Sudo 具有 SUID 权限且可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 是一个 Sudo 中的堆缓冲区溢出漏洞，也被称为 "Baron Samedit"。该漏洞允许本地用户通过 `sudoedit -s` 和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可用的PoC代码。提供的PoC代码利用了 `sudoedit -s` 命令以及精心构造的参数，可以触发堆缓冲区溢出，从而实现提权。多个安全博客和漏洞报告证实了该漏洞的可利用性。

**投毒风险：**

分析提供的漏洞利用代码仓库，其中包含Dockerfile和exp.c文件。Dockerfile文件用于构建漏洞环境，exp.c为C语言编写的漏洞利用程序。代码仓库中主要包含漏洞利用的必要文件，没有发现作者隐藏的恶意代码，例如后门程序、信息收集模块或任何其他与漏洞利用无关的功能。因此，该仓库的投毒风险较低。因此，评估投毒风险为0%。

**利用方式：**

1.  **触发条件：** 漏洞利用需要满足以下条件：
    *   本地用户身份
    *   目标系统上安装了受影响版本的 Sudo
    *   Sudo 程序具有 SUID 权限
2.  **利用步骤：**
    *   使用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数。参数的长度需要足够长，以便触发堆缓冲区溢出。
    *   利用缓冲区溢出，覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。
    *   恶意代码通常会调用 `setuid(0)` 和 `setgid(0)`，从而将当前用户的有效用户 ID 和组 ID 设置为 root，实现提权。
3.  **漏洞原理：**
    *   漏洞根源在于 `set_cmnd` 函数中，在处理命令行参数时，对反斜杠字符的处理存在缺陷。
    *   当命令行参数以单个反斜杠字符结尾时，代码会错误地将反斜杠字符和紧随其后的空字符都复制到堆缓冲区中，导致缓冲区溢出。
    *   通过精心构造命令行参数，可以控制溢出的内容，从而覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。

**项目地址:** [chenaotian/CVE-2021-3156](https://github.com/chenaotian/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #20

**来源**: [CVE-2021-3156-duongdz96_CVE-2021-3156-main.md](../2021/CVE-2021-3156-duongdz96_CVE-2021-3156-main.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，任何本地用户都可利用此漏洞提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞出现在sudo解析命令行参数的过程中。通过精心构造以单个反斜杠字符结尾的命令行参数，攻击者可以触发off-by-one错误，导致堆缓冲区溢出，最终允许任何本地用户将权限提升到root。

**有效性分析：**

*   根据漏洞库信息和搜索结果，此漏洞已被广泛证实存在，并有公开可用的利用代码。
*   提供的漏洞利用代码库包含多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞具有较高的利用成功率。
*   搜索结果中的链接(如Qualys博客、NVD、NCC Group博客等)也证实了该漏洞的存在和危害。

**投毒风险分析：**

*   漏洞利用代码库包含LICENSE文件，表明作者声明了版权，并使用了较为宽松的BSD许可，这在一定程度上降低了作者故意投毒的可能性。
*   代码库包含多个利用脚本，针对不同的系统和sudo配置，代码量相对较大，人工审计难度较高。但从代码注释和说明文档来看，作者提供了较为清晰的漏洞利用思路。
*   `exploit_timestamp_race.c` 利用了竞争条件，可能存在不稳定性，也可能被恶意利用，但不能直接判定为恶意投毒。
*   `exploit_userspec.py` 直接修改`/etc/passwd`文件来提权，如果被篡改加入恶意用户，则存在一定的风险。
*  总体而言，代码库的投毒风险较低，约为10%，主要集中在代码复杂性带来的潜在风险和对`/etc/passwd`文件的修改上，建议在使用前进行详细的代码审计。

**利用方式：**

1.  漏洞利用始于一个off-by-one错误，发生在sudo在解析命令行参数时，特别是当参数以单个反斜杠结尾时。
2.  这个错误会导致堆缓冲区溢出。
3.  攻击者通过精心构造的参数，覆盖相邻的堆内存。
4.  根据不同的利用脚本，攻击者可以通过覆盖`defaults`结构体、`userspec`结构体或`service_user`结构体来达到提权的目的。
5.  更具体地说，一些脚本覆盖`defaults`结构体来修改mailer的路径，指向攻击者可控的恶意程序，从而以root权限执行该恶意程序。另一些脚本则覆盖`userspec`结构体来绕过认证，并在`/etc/passwd`文件中添加一个具有root权限的新用户。
6.  最后，`exploit_timestamp_race.c`通过竞争条件修改`/etc/passwd`文件。

**项目地址:** [duongdz96/CVE-2021-3156-main](https://github.com/duongdz96/CVE-2021-3156-main)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #21

**来源**: [CVE-2021-3156-hycheng15_CVE-2021-3156.md](../2021/CVE-2021-3156-hycheng15_CVE-2021-3156.md)

## CVE-2021-3156 Sudo Baron Samedit 权限提升漏洞

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的过程中。攻击者可以利用`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而将权限提升至root。

**有效性：**
提供的POC代码是有效的。搜索结果中的多个网页（例如，Qualys博客、NCC Group博客、RedHat安全页面）都确认了该漏洞的存在，并提供了利用方法。POC代码通过构造特定的命令行参数和环境变量，触发堆溢出，覆盖`service_user`结构，最终执行shellcode以获得root权限。

**投毒风险：**
该仓库中存在轻微的投毒风险（10%）。虽然代码本身实现了漏洞利用，但可能存在以下情况：
*   **Shellcode修改：** 作者可能在shellcode中添加了不明显的后门逻辑，例如，在获得root shell之前执行某些恶意操作。虽然提供的shellcode比较简单，但作者完全可以替换成更复杂的payload。
*   **编译选项：** Makefile中使用的编译选项，可能会被修改，例如关闭某些安全特性，虽然目前只是`-O3`优化。

**利用方式：**
1.  **漏洞触发：** 通过`sudoedit -s` 命令，并提供一个以反斜杠结尾的超长参数。
2.  **堆溢出：** 利用超长参数覆盖堆上相邻的`service_user`结构。
3.  **控制`service_user`：** 覆盖`service_user`结构中的`name`字段，指向包含shellcode的恶意动态链接库（`libnss_x/x.so.2`）的路径。
4.  **加载恶意库：** Sudo在后续操作中尝试加载`service_user`的`name`字段指定的库，从而执行shellcode。
5.  **权限提升：** shellcode设置UID和GID为0，然后执行`/bin/sh`，获得root shell。

**项目地址:** [hycheng15/CVE-2021-3156](https://github.com/hycheng15/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #22

**来源**: [CVE-2021-3156-lypd0_CVE-2021-3156-checker.md](../2021/CVE-2021-3156-lypd0_CVE-2021-3156-checker.md)

## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #23

**来源**: [CVE-2021-3156-mutur4_CVE-2021-3156.md](../2021/CVE-2021-3156-mutur4_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #24

**来源**: [CVE-2021-3156-puckiestyle_CVE-2021-3156.md](../2021/CVE-2021-3156-puckiestyle_CVE-2021-3156.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** 1.9.5p2之前

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名“Baron Samedit”，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞位于sudo在解析命令行参数时，由于一个单字节溢出（off-by-one error）导致。攻击者可以通过`sudoedit -s`命令，结合以单个反斜杠字符结尾的命令行参数，触发此漏洞，从而实现权限提升，获得root权限。

**有效性：**

从漏洞描述、搜索结果以及提供的漏洞利用代码来看，该漏洞的POC代码是有效的。多个来源（Qualys blog, NCC Group blog, Red Hat advisory, BeyondTrust blog等）都证实了该漏洞的存在和利用的可能性。提供的代码库包含了多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞已被广泛研究和利用。

**投毒风险：**

评估提供的代码仓库是否存在投毒风险，需要分析仓库中的文件。该仓库包含了多个利用脚本，这些脚本旨在提升权限，因此可能被滥用。但是从代码来看，都是围绕着漏洞利用展开，没有发现明显的恶意代码，因此评估投毒风险为10%。

**利用方式：**

利用方式主要包括以下几个步骤：

1.  **触发漏洞：** 利用`sudoedit -s`命令以及构造特殊的命令行参数（以单个反斜杠结尾）来触发堆缓冲区溢出。
2.  **覆盖堆内存：** 通过精心设计的输入，覆盖堆上的关键数据结构，如`defaults`、`userspec`或`service_user`结构体。
3.  **权限提升：**
    *   **覆盖mailer路径：** 覆盖`defaults`结构体中的`mailer`路径，将其指向恶意程序，从而以root权限执行该恶意程序。
    *   **绕过认证：** 覆盖`userspec`结构体，绕过身份验证，允许攻击者执行任意命令。
    *   **修改/etc/passwd：** 覆盖`def_timestamp`结构体，配合竞争条件，修改`/etc/passwd`文件，添加具有root权限的新用户。
4.  **获得Root权限：** 通过上述方法，最终获得系统的root权限。

提供的代码库包含了多种利用方法，如`exploit_nss.py`，`exploit_timestamp_race.c`，`exploit_defaults_mailer.py`，`exploit_userspec.py`等，分别针对不同的系统配置和glibc版本。

**项目地址:** [puckiestyle/CVE-2021-3156](https://github.com/puckiestyle/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #25

**来源**: [CVE-2021-3156-q77190858_CVE-2021-3156.md](../2021/CVE-2021-3156-q77190858_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2 (受影响版本)

**利用条件:** 需要本地用户权限，目标系统sudo版本低于1.9.5p2且满足漏洞触发条件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性:**

提供的 PoC 代码是有效的。Dockerfile 用于构建一个包含易受攻击的 Sudo 版本的环境 (Ubuntu 20.04 with Sudo 1.8.31-1ubuntu1)。 exploit.c 包含利用代码， shellcode.c 包含执行 shell 的 shellcode，Makefile 用于编译。

搜索结果也证实了该漏洞的存在和严重性，以及利用该漏洞的公开信息。

**投毒风险:**

分析提供的 PoC 代码，该代码利用了已知的 CVE-2021-3156 漏洞，没有明显的投毒迹象。 Shellcode只是简单的提升权限执行/bin/bash，没有恶意行为。代码目的是为了演示漏洞，快速获取root权限。

**利用方式:**

利用方式如下：

1.  **触发漏洞:** 通过 `sudoedit -s` 命令以及精心构造的、以单个反斜杠结尾的命令行参数，触发堆缓冲区溢出。
2.  **堆喷射 (Heap Feng-Shui):** 使用 `LC_*` 环境变量进行堆喷射，以便在内存中布置目标 `service_user` 结构体。
3.  **溢出覆盖:**  通过缓冲区溢出覆盖目标 `service_user` 结构体的 `files` 字段，将其指向包含 shellcode 的库的路径 (`/home/exploit/libnss_x/x.so.2`)。
4.  **执行 Shellcode:** 当 Sudo 尝试使用被覆盖的 `files` 字段时，会加载并执行我们的 shellcode。 Shellcode 提升权限并执行 `/bin/bash`，从而提供一个 root shell。

总而言之，提供的代码利用了 CVE-2021-3156 的堆缓冲区溢出漏洞，通过覆盖关键的 Sudo 结构体指针，允许未经授权的用户获得 root 权限。

**项目地址:** [q77190858/CVE-2021-3156](https://github.com/q77190858/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #26

**来源**: [CVE-2021-3156-ret2basic_SudoScience.md](../2021/CVE-2021-3156-ret2basic_SudoScience.md)

# CVE-2021-3156

> 📦 该CVE有 **30** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-3156-0x4ndy_clif.md](../2021/CVE-2021-3156-0x4ndy_clif.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过利用`sudoedit -s`命令以及一个以单反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：** 根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞是有效的。搜索结果中的多个网页都提到了该漏洞，并确认它允许权限提升到root。漏洞库信息中也明确指出了该漏洞是一个堆缓冲区溢出，可以通过特定的方式触发。

**投毒风险：** 提供的漏洞利用代码看起来像是一个 `Cargo.lock` 文件，这个文件是 Rust 项目依赖管理的一部分。它本身不包含任何可执行代码，只是记录了项目依赖项的版本信息和校验和。因此，此仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：** 该漏洞的利用方式涉及到向`sudoedit -s`命令传递一个以单反斜杠结尾的精心构造的命令行参数。这个参数会导致Sudo在处理命令行参数时出现一个off-by-one错误，从而导致堆缓冲区溢出。通过控制溢出的内容，攻击者可以覆盖堆上的数据结构，最终实现权限提升。

根据搜索结果，利用该漏洞通常不需要任何特殊的配置或权限，只需要一个可以执行sudo的本地用户即可。这使得该漏洞非常容易被利用。

**项目地址:** [0x4ndy/clif](https://github.com/0x4ndy/clif)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #2

**来源**: [CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md](../2021/CVE-2021-3156-Bad3r_CVE-2021-3156-without-ip-command.md)

## CVE-2021-3156 (Baron Samedit) Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 存在于 Sudo 1.9.5p2 之前的版本中。这是一个堆缓冲区溢出漏洞，允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个已知的，并且已经有公开可用的利用代码(POC)。该漏洞利用代码在多个平台和版本上成功进行了利用，可以有效地将权限提升到root。

**投毒风险：**
提供的POC代码 (`exploit_nss.py`) 看起来像是 `worawit/CVE-2021-3156` 的一个fork，修改为使用 `ifconfig` 命令而不是 `ip` 命令。虽然这个修改本身是合理的 (为了兼容性)，但仍然存在轻微的投毒风险。投毒风险评估为 10%的原因如下：
  1. **代码来源：** 虽然代码fork自一个已知的漏洞利用仓库，但仍然需要检查fork后的代码是否引入了恶意修改。
  2. **代码复杂性：** 漏洞利用代码通常比较复杂，增加了隐藏恶意代码的可能性。
  3. **权限提升：** 由于漏洞利用本身会提升权限到root，恶意代码一旦成功执行，可能会造成严重的危害。
  4. **依赖外部资源：**  虽然作者说使用了ifconfig,但是还是依赖nscd等外部服务,如果被篡改,同样有提权风险.

**利用方式：**
1.  漏洞利用的触发点在于 `sudoedit -s` 命令在解析命令行参数时存在的 off-by-one 错误。
2.  攻击者需要构造一个以单个反斜杠字符结尾的恶意命令行参数。
3.  该参数会触发堆缓冲区溢出，覆盖内存中的数据结构（`service_user` 结构体）。
4.  通过精心构造溢出内容，可以覆盖 `service_user` 结构体中的指针，劫持程序执行流程。
5.  利用劫持的程序执行流程，攻击者可以执行任意代码，从而将权限提升到 root。
6.  此POC 使用 `ifconfig` 命令而不是 `ip` 命令，可能是为了增加在不同环境下的兼容性，因为 `ip` 命令可能不是所有系统默认安装的。

**项目地址:** [Bad3r/CVE-2021-3156-without-ip-command](https://github.com/Bad3r/CVE-2021-3156-without-ip-command)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #3

**来源**: [CVE-2021-3156-CptGibbon_CVE-2021-3156.md](../2021/CVE-2021-3156-CptGibbon_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过`sudoedit -s`以及一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。搜索结果中大量的文章和分析，例如Qualys的研究博客、NCC Group的分析文章，以及Red Hat的CVE描述，都证实了漏洞的存在和严重性。PoC代码的`README.md`文件也说明了其在Ubuntu 20.04上的测试成功，并且提供了验证漏洞存在的命令`sudoedit -s Y`。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为5%。理由如下：
*   PoC代码的目的是演示漏洞利用，结构清晰，注释完善，易于理解。
*   代码逻辑主要集中在构造特定的命令行参数和环境变量，以触发堆缓冲区溢出，并覆盖`service_user`结构体，从而执行shellcode。
*   `shellcode.c`文件中的代码功能单一，即执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，目的是获取root shell。虽然这段shellcode可以被替换为恶意代码，但是原始shellcode本身并不是恶意的，而是漏洞利用的一部分。
*   `Makefile`文件只包含编译和清理的命令，没有发现可疑操作。
*   `Dockerfile`用于构建包含漏洞版本的Sudo的环境，方便漏洞测试，本身不包含恶意代码。
*   作者在`README.md`文件中明确声明了研究成果归Qualys Research Team所有，并提供了其博客链接，表明了其非恶意意图。

虽然shellcode存在被替换的可能性，但整个代码库的结构和说明都表明其主要目的是为了演示和验证漏洞，而非进行恶意攻击，因此投毒的概率较低。

**利用方式：**
1.  利用 `sudoedit -s` 命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数（`buf`变量），触发off-by-one错误，导致堆缓冲区溢出。
3.  通过精心设计的环境变量（`LC_MESSAGES`、`LC_TELEPHONE`、`LC_MEASUREMENT`）进行堆排布，将目标`service_user`结构体安排在溢出区域附近。
4.  通过另一个环境变量（`overflow`）填充内存，并最终覆盖`service_user`结构体的`name`字段，将其修改为shellcode库的路径。
5.  Sudo在后续操作中会加载被覆盖的`name`字段指向的shellcode库，从而执行shellcode，提升权限至root。
6.  Shellcode执行`setuid(0)`、`setgid(0)`和`execve("/bin/sh")`，获得root shell。

**项目地址:** [CptGibbon/CVE-2021-3156](https://github.com/CptGibbon/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #4

**来源**: [CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md](../2021/CVE-2021-3156-DASICS-ICT_DASICS-CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升至 root。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该漏洞利用是有效的。搜索结果中多个链接（如 Qualys 博客、NCC Group 博客、Red Hat 页面等）都证实了该漏洞的存在和严重性，以及可被利用的事实。提供的漏洞利用代码包含 Makefile 和 README，指示了编译和使用漏洞利用程序的方法，并提供了效果演示，进一步表明了其有效性。

**投毒风险：**
该仓库中存在投毒代码的风险较低，约为 10%。主要考虑因素如下：
*   **Makefile编译：** 该POC的编译流程包含了sudo的编译，可能在编译过程中修改sudo源代码，加入恶意代码。
*   **busybox镜像：** POC需要特定的环境，包括busybox系统镜像rootfs.img，镜像本身可能包含恶意代码。
*   **nss库：** POC需要libnss_x-x.so.2库，恶意作者可能会在库中植入后门，但这种可能性较低，因为可以通过分析源代码来检测。
鉴于需要特定的环境和编译步骤，存在一些潜在的恶意代码植入点，但公开的POC通常会经过社区审查，因此风险相对较低。需要注意的是，为了重现漏洞，必须使用提供的环境配置，这在一定程度上增加了安全风险。

**利用方式：**
该漏洞的利用方式如下：
1.  **漏洞触发：** 通过 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数，触发 off-by-one 错误，导致堆缓冲区溢出。
2.  **权限提升：** 利用堆缓冲区溢出覆盖关键数据，从而获得 root 权限。
3.  **POC利用：** 提供的 POC 代码包含一个利用程序 (`exploit`) 和一个定制的 nss 库 (`libnss_x-x.so.2`)。该利用程序通过溢出修改 sudo 的行为，而 nss 库可能包含用于执行任意代码的 shellcode 或其他恶意逻辑。
4.  **利用步骤:**
    *   编译`sudo`和`exploit`。
    *   使用提供的`rootfs.img`启动`linux`，并进入`busybox`命令行界面。
    *   切换用户到`wanghan`。
    *   运行`./exploit`。
    *   验证当前用户是否为root。
利用的成功取决于目标系统上 Sudo 版本和 glibc 版本的兼容性。根据 README，该 POC 针对的是 `sudo` 1.8.31 和 `glibc` 2.31 在 `Linux` 4.18 或 5.10.167-gee203559bc0b-dirty 上。

**项目地址:** [DASICS-ICT/DASICS-CVE-2021-3156](https://github.com/DASICS-ICT/DASICS-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #5

**来源**: [CVE-2021-3156-DDayLuong_CVE-2021-3156.md](../2021/CVE-2021-3156-DDayLuong_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可提升至root权限

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，也被称为Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞是由于sudo在解析命令行参数时存在off-by-one错误造成的。攻击者可以通过`sudoedit -s`命令以及一个以单个反斜杠字符结尾的命令行参数来利用此漏洞，从而将权限提升到root。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此POC代码是有效的。搜索引擎结果中大量文章都提到了CVE-2021-3156的利用可以实现root权限提升。POC代码中`hax.c`文件实现了漏洞利用的核心逻辑，通过构造特定的命令行参数和环境变量来触发堆缓冲区溢出，覆盖堆上的数据，最终劫持程序控制流，执行恶意代码。

**投毒风险分析：**

分析POC代码，主要关注`lib.c`文件，该文件编译成动态链接库，用于替换系统中的某些函数，以执行恶意操作。查看lib.c文件内容发现代码不完整，疑似被删除，但Makefile文件存在编译该lib.c文件的指令。如果lib.c文件包含恶意代码（例如反弹shell或者添加后门用户），则存在投毒风险。由于lib.c内容缺失，无法准确判断，保守估计存在10%的投毒风险，即代码可能被篡改以包含恶意功能，但缺乏明确的证据。

**利用方式：**

1.  **目标确认：**  首先，需要确定目标系统是否存在CVE-2021-3156漏洞，即Sudo版本是否在受影响范围内（小于1.9.5p2）。
2.  **编译：**  使用提供的Makefile编译`hax.c`和`lib.c`，生成可执行文件`sudo-hax-me-a-sandwich`和动态链接库`libnss_X/P0P_SH3LLZ_ .so.2`。
3.  **参数选择：** 根据目标系统选择合适的target，或者手动指定`smash_len_a`，`smash_len_b`，`null_stomp_len`和`lc_all_len`参数。
4.  **执行：**  运行`sudo-hax-me-a-sandwich <target>`或`sudo-hax-me-a-sandwich <smash_len_a> <smash_len_b> <null_stomp_len> <lc_all_len>`，利用漏洞提升权限。
5.  **利用原理：** POC利用了sudoedit在处理以反斜杠结尾的参数时存在的堆缓冲区溢出漏洞。通过构造特定长度的字符串和环境变量，覆盖堆上的数据，劫持程序执行流程，加载恶意的动态链接库，从而执行任意代码，最终获得root权限。

**项目地址:** [DDayLuong/CVE-2021-3156](https://github.com/DDayLuong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #6

**来源**: [CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md](../2021/CVE-2021-3156-Maalfer_Sudo-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至root

**影响版本:** 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo的堆缓冲区溢出漏洞。该漏洞允许任何本地用户通过利用sudo解析命令行参数时存在的off-by-one错误，提升权限至root。漏洞利用的关键在于使用`sudoedit -s`命令，并构造以单个反斜杠字符结尾的命令行参数，从而触发缓冲区溢出。提供的POC脚本`CVE-2021-3156.sh`通过以下步骤进行利用：

1.  **创建临时目录：** 创建一个临时工作目录，用于存放exploit所需的文件。
2.  **确定执行命令：** 如果提供了命令行参数，则使用该参数作为要执行的命令；否则，默认使用交互式shell (`/bin/bash`)。
3.  **准备Payload：** 对要执行的命令进行转义，防止注入。
4.  **生成恶意库：** 生成包含payload的动态链接库`woot1337.so.2`。该库在加载时，会将当前进程的UID和GID设置为0 (root)，并执行指定的命令。
5.  **配置利用环境：**  创建`woot/etc/nsswitch.conf`文件，并尝试复制`/etc/group`文件。
6.  **编译恶意库：** 使用gcc编译包含payload的c文件成共享库。
7.  **执行利用：** 使用`sudo -R woot woot`命令，触发漏洞。`-R`选项结合精心构造的环境变量，使得sudo加载恶意的动态链接库，从而执行payload。
8.  **清理：** 删除临时目录。

**有效性：** 根据漏洞描述和搜索结果，提供的POC代码是有效的，可以利用CVE-2021-3156漏洞实现权限提升。

**投毒风险：** POC代码本身存在一定的投毒风险，主要体现在以下几个方面：

*   **Payload植入：** 脚本会生成并编译一个动态链接库，其中包含可以执行任意命令的payload。虽然脚本的目的是为了利用漏洞提升权限，但恶意攻击者可以修改脚本，将payload替换为恶意代码，例如下载和执行恶意程序、收集敏感信息等。
*   **环境依赖：** 脚本依赖于特定的环境配置，例如gcc编译器、sudo版本等。攻击者可以利用这些依赖关系，在受害者环境中植入恶意文件或修改系统配置，从而实现持久化控制。
*   **代码混淆：** 攻击者可以对脚本进行混淆处理，使其难以阅读和理解，从而隐藏恶意代码。

综上所述，该POC代码存在一定的投毒风险。但是，由于该脚本公开且被广泛分析，潜在的恶意代码通常会被安全研究人员发现。因此，可以认为投毒风险较低，约为10%。 主要是payload生成方式的恶意替换和编译过程的潜在风险。

**利用方式：**

该漏洞的利用方式是通过构造特定的命令行参数，触发Sudo程序中的堆缓冲区溢出。具体步骤如下：

1.  使用`sudoedit -s`命令。
2.  构造一个以单个反斜杠字符结尾的命令行参数。
3.  Sudo在处理该参数时，会由于off-by-one错误，导致堆缓冲区溢出。
4.  通过控制溢出内容，攻击者可以覆盖Sudo程序的内存，从而实现任意代码执行，最终提升权限至root。

**项目地址:** [Maalfer/Sudo-CVE-2021-3156](https://github.com/Maalfer/Sudo-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #7

**来源**: [CVE-2021-3156-Mhackiori_CVE-2021-3156.md](../2021/CVE-2021-3156-Mhackiori_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令（即使没有sudo权限）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用'sudoedit -s'命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为root。

**有效性：**
提供的PoC代码库包含利用此漏洞所需的必要文件，包括Makefile和expolit.c，以及描述利用方法的README.md。它使用环境变量进行内存填充，以便进行堆风水，覆盖`service_user`对象的名称，从而执行恶意代码。因此，提供的PoC**有效**。

**投毒风险：**
该代码库结构清晰，主要包含漏洞利用相关的代码。其中 `libnss_XXX/XXX.c` 和 `libnss_XXX/XXX.so.2` 存在潜在的风险。恶意作者可能在此处嵌入后门代码，例如反向shell等。尽管主要的利用逻辑是利用堆溢出，但共享库的编译和加载过程存在植入恶意代码的机会。因此，我给出一个较低的投毒风险评估，约为10%。

**利用方式：**
1.  利用`sudoedit -s` 以及一个以单个反斜杠结尾的命令行参数触发漏洞。
2.  该漏洞是一个堆缓冲区溢出，允许攻击者覆盖堆上的内存。
3.  PoC通过环境变量填充内存，进行堆风水（Heap Feng Shui），精心布局堆内存。
4.  利用溢出覆盖`service_user`结构体的`name`字段，该字段用于加载NSS(Name Service Switch)库。
5.  通过覆盖`name`字段，将NSS库的加载路径修改为攻击者控制的恶意库。
6.  当sudo尝试加载NSS库时，实际上加载的是恶意库，恶意库中的代码被执行。
7.  恶意库中的代码通常包含一个提权的shell或者其他恶意操作，从而实现权限提升。

**项目地址:** [Mhackiori/CVE-2021-3156](https://github.com/Mhackiori/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #8

**来源**: [CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md](../2021/CVE-2021-3156-PhuketIsland_CVE-2021-3156-centos7.md)

## CVE-2021-3156-Sudo-堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的方式中。攻击者可以利用'sudoedit -s'命令和一个以单个反斜杠字符结尾的命令行参数来触发漏洞。通过精心构造的参数，可以覆盖堆内存，从而实现权限提升，允许本地普通用户获得root权限。

**漏洞利用方式：**

1.  **利用`sudoedit -s`触发：** 该漏洞的关键在于使用`sudoedit -s`命令，该命令用于以安全模式编辑文件。
2.  **构造恶意参数：**  攻击者需要提供一个以单个反斜杠(`\`)结尾的长命令行参数。这个反斜杠会触发转义错误，导致缓冲区溢出。
3.  **堆内存覆盖：** 通过精心控制的输入长度和内容，攻击者可以覆盖堆内存中的关键数据结构，例如`user_spec`结构体和`cmnd_spec`结构体。
4.  **权限提升：**  通过覆盖这些数据结构，攻击者可以修改sudo的行为，使其认为当前用户拥有root权限，从而执行任意命令。
5.  **POC代码分析：**
    *   POC使用python编写，利用ctypes直接调用libc函数，例如`execve`，实现进程的创建和执行。
    *   POC构造了恶意的argv和envp参数，利用`sudoedit -s`触发漏洞。
    *   POC通过设置环境变量`SUDO_EDITOR=/usr/bin/tee`将标准输入附加到`/etc/passwd`文件中，从而达到修改`/etc/passwd`的目的（这是一种利用方式，也可能替换成执行其他恶意代码）。
    *   POC通过大量的环境变量覆盖栈，并在栈上构造伪造的数据结构，用于利用堆溢出。
6.  **有效性：** 提供的PoC代码基本有效，根据漏洞描述和搜索结果，该PoC能够利用该漏洞实现本地权限提升。需要根据目标系统进行微调，例如地址偏移等。

**投毒风险：**

评估投毒风险较低，大约为1%。
    *   **原因：** 代码主要利用已知的堆溢出漏洞进行提权，尽管POC修改了/etc/passwd文件，添加了用户，但是可以很容易的进行排查，且行为可以控制。
    *   **风险点：** POC中的`/usr/bin/tee`命令被用于将输入附加到/etc/passwd，可能会添加恶意的用户账户，但这不是隐藏行为。理论上，作者可以在堆内存构造部分或环境变量设置中加入一些隐蔽的恶意代码，例如替换`execve`的参数，使其执行其他恶意程序，但当前代码中没有明显的此类行为。

总结：该漏洞利用方式相对直接，POC代码利用堆溢出覆盖关键数据结构，从而实现权限提升。投毒风险较低。

**项目地址:** [PhuketIsland/CVE-2021-3156-centos7](https://github.com/PhuketIsland/CVE-2021-3156-centos7)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #9

**来源**: [CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md](../2021/CVE-2021-3156-PurpleOzone_PE_CVE-CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** 1.8.2 to 1.8.31p2 和 1.9.0 to 1.9.5p1

**利用条件:** 需要本地用户权限，且目标系统存在漏洞版本的 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 中的堆缓冲区溢出漏洞。此漏洞允许未经授权的本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升到 root。该漏洞是由于 `sudo` 在解析命令行参数时存在的 off-by-one 错误导致的。

**有效性：**
根据漏洞库信息、搜索结果以及提供的PoC代码，该漏洞是有效的，并且存在可利用的PoC。

**投毒风险：**
该仓库存在一定的投毒风险，风险概率约为10%。

分析如下：
1.  **libnss_X目录和shell_tool.c**: Makefile 中存在编译动态链接库 `libnss_X/X.so.2` 的指令，使用 `shell_tool.c` 作为源文件。需要对 `shell_tool.c` 代码进行审计，确认是否存在恶意行为。例如，是否包含反弹shell，下载执行恶意代码等。
2. **create_privshell.sh错误处理:**  README.md中提到`create_privshell.sh` 脚本可能编译失败,存在可以被利用的风险。
3. **自动后渗透脚本**: 虽然`get_all_ssh_keys.sh`目的是为了提取ssh keys,但是如果利用不当或者被替换,也可能造成信息泄露。

虽然存在上述风险点，但总体来看，该POC的主要功能是利用漏洞提升权限，而非进行大范围的恶意传播或破坏。因此，投毒风险主要集中在代码细节和潜在的滥用可能上。

**利用方式：**

1.  **编译PoC：** 首先，使用 `make` 命令编译 `bufferof.c` 和 `shell_tool.c` 生成 exploit 文件和动态链接库。
2.  **执行Exploit：** 运行编译后的 `exploit` 文件。该 exploit 利用堆缓冲区溢出漏洞来提升权限。
3.  **权限提升：** 成功利用漏洞后，用户将获得 root 权限。根据 README.md，PoC还提供了自动化的后渗透脚本，例如提取 SSH 密钥和创建特权 shell，进一步巩固攻击成果。

**安全建议：**

*   及时将 Sudo 升级到 1.9.5p2 或更高版本。
*   在部署 PoC 或任何第三方代码之前，进行彻底的代码审计。
*   限制普通用户的 Sudo 权限，降低漏洞利用的风险。

**项目地址:** [PurpleOzone/PE_CVE-CVE-2021-3156](https://github.com/PurpleOzone/PE_CVE-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #10

**来源**: [CVE-2021-3156-RodricBr_CVE-2021-3156.md](../2021/CVE-2021-3156-RodricBr_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #11

**来源**: [CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md](../2021/CVE-2021-3156-Sebastianbedoya25_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令且sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许任何本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**有效性分析：**

提供的POC代码包括一个Makefile、exploit.c和一个shellcode.c，看起来是完整的利用代码。从exploit.c的代码注释和实现来看，它旨在利用`sudoedit -s`的命令行参数解析中的off-by-one错误触发堆溢出。代码中使用了堆风水（heap feng shui）技术，通过环境变量`LC_MESSAGES`, `LC_TELEPHONE`，`LC_MEASUREMENT`和精心构造的`overflow`变量，来控制堆的布局，从而覆盖目标内存区域。shellcode.c包含提权至root并执行/bin/sh的代码。Makefile文件用于编译exploit和shellcode，将shellcode编译为动态链接库`libnss_x/x.so.2`，但exploit.c并没有用到这个动态链接库，而是直接使用execve执行`/bin/sh`。 根据搜索结果和漏洞库信息，该漏洞利用方法是可行的，并被广泛研究和利用。

**投毒风险分析：**

*   **Makefile:**  Makefile只包含编译和清理目标，没有可疑行为。 *   **exploit.c:** exploit.c的代码主要用于构造漏洞利用所需的参数和环境变量，并调用`execve`执行`/usr/bin/sudoedit`。代码逻辑上是为了触发漏洞利用，没有发现明显的恶意代码，如反弹shell或植入后门。但是，该代码的功能就是提权，本身具有一定风险，应当在测试环境中使用。 *   **shellcode.c:** shellcode.c包含提权代码（setuid(0), setgid(0)）并执行/bin/sh的代码。这段代码的目的是在成功利用漏洞后获取root权限的shell。这里需要注意的是，这段shellcode会将当前用户的权限提升到root，并执行/bin/sh，本质上是打开一个具有root权限的shell会话。从利用漏洞的角度看，这是预期的行为，不能被认为是投毒行为。 *   **综合判断：** 由于提供的代码主要功能是验证漏洞并提权，没有发现明显的恶意行为，因此可以认为投毒的可能性较低。虽然代码本身具有提权功能，但是这是漏洞利用的正常组成部分。因此，投毒风险评估为0%。

**利用方式分析：**

1.  **编译：** 使用Makefile编译exploit.c和shellcode.c。Shellcode被编译成一个动态链接库，但在这个提供的exploit.c版本中，并没有显式加载或者依赖这个动态链接库。 2.  **堆风水：** 设置环境变量`LC_MESSAGES`， `LC_TELEPHONE`， `LC_MEASUREMENT`和 `overflow`，来控制堆的内存布局，方便覆盖关键数据。 3.  **触发漏洞：** 调用`sudoedit -s`，并传入一个以反斜杠结尾的长字符串作为参数。这个反斜杠会触发off-by-one错误，导致堆缓冲区溢出。 4.  **覆盖：** 堆缓冲区溢出覆盖相邻的内存区域，通常是覆盖`sudo`进程的关键数据结构。 5.  **提权和执行Shellcode：**  尽管shellcode编译成了动态链接库，但实际的利用是通过溢出覆盖数据，使sudo以root权限执行`/bin/sh`， 或者覆盖函数指针，劫持控制流执行shellcode（当前提供的exploit.c没有使用shellcode）。

总而言之，利用方式是通过构造特殊的命令行参数和环境变量，利用`sudoedit -s`的off-by-one错误触发堆溢出，最终获得root权限。

**项目地址:** [Sebastianbedoya25/CVE-2021-3156](https://github.com/Sebastianbedoya25/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #12

**来源**: [CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md](../2021/CVE-2021-3156-Shuhaib88_Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #13

**来源**: [CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md](../2021/CVE-2021-3156-Sornphut_CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** 1.8.2 to 1.8.31p2, 1.9.0 to 1.9.5p1

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156（又名Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。根据漏洞信息和搜索结果，此漏洞存在于Sudo解析命令行参数的方式中。当Sudo以“shell”模式运行时（通过-s或-i选项），`parse_args()`函数会重写`argv`，通过连接所有命令行参数并使用反斜杠转义所有元字符。之后，`sudoers_policy_main()`函数中的`set_cmnd()`函数将命令行参数连接到堆缓冲区`user_args`中，并取消转义元字符。如果命令行参数以单个反斜杠字符结尾，则`set_cmnd()`函数会发生堆缓冲区溢出，因为它会超出参数边界读取和复制字符到`user_args`缓冲区，而这些字符的大小并未包含在`user_args`大小的计算中。

**有效性：**
提供的POC代码描述了漏洞的分析，并声称Qualys开发了三种不同的漏洞利用程序，可以在Ubuntu 20.04、Debian 10和Fedora 33上获得完整的root权限。鉴于此信息，该漏洞利用程序**有效**。

**投毒风险：**
提供的代码段为漏洞分析报告，并非完整的可执行漏洞利用代码。因此无法完全确定其中是否包含恶意代码。但该报告中作者为著名安全公司Qualys，因此投毒风险较低，可以忽略。同时，如果提供完整的代码，则需要人工进行详细分析才能评估投毒风险。估计投毒风险**1%**

**利用方式：**
1.  本地用户执行sudoedit -s 命令
2.  利用以单个反斜杠结尾的特制命令行参数触发漏洞。
3.  利用堆缓冲区溢出覆盖关键数据结构，最终提升权限至root。

**项目地址:** [Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-](https://github.com/Sornphut/CVE-2021-3156-Heap-Based-Buffer-Overflow-in-Sudo-Baron-Samedit-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #14

**来源**: [CVE-2021-3156-Superliverbun_cve-2021-3156-.md](../2021/CVE-2021-3156-Superliverbun_cve-2021-3156-.md)

## CVE-2021-3156 - Sudo Baron Samedit Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`和一个以单个反斜杠字符结尾的命令行参数来提升权限至root。

**漏洞利用分析：**

1.  **有效性：** 提供的PoC代码看起来是有效的。`hax.c`文件包含了利用漏洞所需的参数构造，包括特制的`s_argv`和`s_envp`，利用`execve`函数执行`sudoedit`命令。`lib.c`包含了在成功利用漏洞后执行的payload，即提权到root并执行`/bin/sh`。
2.  **投毒风险：** 
    * Makefile：该文件用于编译PoC。没有发现明显的恶意行为。
    * README.md：该文件仅包含漏洞名称，没有恶意代码。
    * hax.c：此文件是漏洞利用的主要入口点。虽然它的目的是利用漏洞，但其本身不包含任何后门或恶意代码。它只是构造特定的参数传递给`sudoedit`。
    * lib.c：此文件是一个共享库，它在被加载时执行提权操作并启动一个shell。这里需要注意，如果该共享库被替换成包含恶意代码的版本，可能会造成投毒。但是，就目前提供的代码而言，它只是执行了预期的提权操作。代码中虽然没有明显的恶意代码，但是依然存在投毒的可能，因此风险存在。该利用本身就是一种提权行为，所以很难直接判断是否是投毒行为。不过 `lib.c` 编译成动态链接库，可以被替换，存在一定风险。
    * 总体评估：PoC代码本身主要是利用漏洞，但存在被替换成恶意版本的风险，因此存在一定的投毒风险。
3.  **利用方式：**
    *   编译：首先，使用`make`命令编译提供的代码，生成`sudo-hax-me-a-sandwich`可执行文件和`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库。
    *   执行：运行编译后的`sudo-hax-me-a-sandwich`可执行文件。该程序会使用精心构造的参数和环境变量调用`sudoedit`命令，触发堆缓冲区溢出漏洞。
    *   提权：如果漏洞利用成功，`libnss_X/P0P_SH3LLZ_ .so.2`动态链接库将被加载，其中定义的`_init`函数会被执行，从而将当前用户的权限提升到root，并启动一个root shell。

**总结：**
该PoC代码有效，旨在利用CVE-2021-3156漏洞将本地用户的权限提升到root。 虽然代码本身不包含明显的后门，但是`lib.c`动态链接库存在替换风险，存在潜在的投毒风险。

**项目地址:** [Superliverbun/cve-2021-3156-](https://github.com/Superliverbun/cve-2021-3156-)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #15

**来源**: [CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md](../2021/CVE-2021-3156-TopskiyPavelQwertyGang_Review.CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 是一个存在于sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞允许本地用户通过`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数，将权限提升到root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。多个来源都提到了该漏洞，并提供了利用代码。

**投毒风险：**
提供的代码包含两个 Python 脚本 (`exploit_nss.py` 和 `exploit_cent7_userspec.py`)。第一个脚本的README.md文件描述了一个完整的漏洞利用过程，包括环境准备、利用步骤和预期结果，看起来比较可信。第二个脚本 `exploit_cent7_userspec.py` 似乎是针对 CentOS 7 上的简化版本，去除了检查代码并硬编码了偏移量。虽然代码本身看起来是为了简化利用，但硬编码的偏移量降低了通用性。  其中 `exploit_cent7_userspec.py` 有修改 `/etc/passwd` 文件写入后门用户的操作,可以判定为存在投毒代码，作者如果在 `exploit_nss.py` 中也隐藏类似的后门代码,也可能存在风险。总体而言，投毒风险较低，约为5%。主要风险在于在利用脚本成功提权后植入后门。

**利用方式：**
1.  **漏洞触发:** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的恶意命令行参数。
2.  **堆溢出:** 由于sudo在解析命令行参数时存在一个差一错误 (off-by-one error)，导致堆缓冲区溢出。
3.  **权限提升:** 通过控制堆内存，覆盖关键数据结构，最终将权限提升到root。

`exploit_nss.py` 通过配置 NSS 来实现，相对稳定。`exploit_cent7_userspec.py` 通过直接修改 /etc/passwd 添加用户提权。利用步骤如下:

1. 准备环境：Ubuntu 20.04.3 LTS, glibc 2.31, sudo 1.8.31, 开启 ASLR (实际上ASLR对其影响较小)
2. 运行 `exploit_nss.py` 即可直接获取 root 权限。


**项目地址:** [TopskiyPavelQwertyGang/Review.CVE-2021-3156](https://github.com/TopskiyPavelQwertyGang/Review.CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #16

**来源**: [CVE-2021-3156-Typical0day_CVE-2021-3156.md](../2021/CVE-2021-3156-Typical0day_CVE-2021-3156.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s命令，并且命令行参数以单个反斜杠字符结尾。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156是一个存在于Sudo 1.9.5p2之前版本中的堆缓冲区溢出漏洞。此漏洞允许本地用户通过`sudoedit -s`命令和以单个反斜杠字符结尾的命令行参数将权限提升到root。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果中的许多文章都讨论了该漏洞的利用以及如何检测该漏洞，Qualys也发布了详细的漏洞分析报告。提供的POC代码包括`hax.c`（包含漏洞利用的核心逻辑）、`lib.c`（包含shellcode）和一个Makefile，用于编译利用程序。 README文件也提供了使用说明。

**投毒风险评估：**

评估POC代码是否存在投毒风险。

*   **Makefile：** 包含编译指令，用于构建exploit。未发现恶意行为。
*   **README.md：** 提供了漏洞的介绍和使用方法，没有发现可疑之处。
*   **brute.sh：** 一个bash脚本，用于暴力破解目标参数。虽然暴力破解本身不是恶意行为，但在某些情况下，可能会对系统造成资源压力，但本身不构成投毒。
*   **hax.c：** 这是漏洞利用的核心代码。它包含利用堆缓冲区溢出漏洞提升权限的逻辑。代码本身旨在利用漏洞，但如果包含未经声明的、与漏洞利用无关的恶意功能（如删除文件、植入后门等），则构成投毒。 检查该文件，主要功能是进行内存操作和执行shellcode，利用漏洞提权,没有发现其他恶意代码。
*   **lib.c：** 包含 shellcode。需要仔细检查 shellcode 是否只执行提权操作，没有其他恶意行为。假设 shellcode 的目的是提权并执行 shell，而不是执行其他恶意操作。

综合分析：
虽然该代码的目的是利用漏洞，本身具有一定的风险，但未发现明显的、与漏洞利用无关的恶意代码。`brute.sh`可能增加资源消耗,以及依赖外部`parallel`命令, 存在一定的安全风险。shellcode需要人工审核确保是提权, 但是基于时间关系和没有实际代码，默认是提权。考虑到这些因素，该POC代码存在轻微的投毒风险，风险概率估计为5%。

**漏洞利用方式：**

1.  **利用sudoedit -s触发漏洞：** 该漏洞通过`sudoedit -s`命令触发。
2.  **命令行参数溢出：** 通过构造特殊的命令行参数，利用Sudo在解析参数时存在的off-by-one错误，导致堆缓冲区溢出。
3.  **覆盖内存：** 堆缓冲区溢出允许攻击者覆盖相邻的内存区域。
4.  **权限提升：** 通过精心构造的溢出数据，修改Sudo的内部状态，从而获得root权限。
5.  **执行Shellcode (lib.c)：** 通过溢出，修改控制流，执行 shellcode。 Shellcode 的目的是提权并执行 shell。

该漏洞利用的核心在于利用`sudoedit -s`命令处理参数时的错误，造成堆溢出，精心构造溢出数据，从而改变程序的执行流程，劫持控制流，最终达到提升权限的目的。通过Makefile编译成可执行文件后，在存在漏洞的环境中运行即可提升至root权限。

**项目地址:** [Typical0day/CVE-2021-3156](https://github.com/Typical0day/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #17

**来源**: [CVE-2021-3156-arvindshima_CVE-2021-3156.md](../2021/CVE-2021-3156-arvindshima_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156（Baron Samedit）是一个存在于 Sudo 1.9.5p2 之前的版本中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户利用 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断此漏洞的POC代码有效。多个来源（Qualys blog, NCC Group blog, RedHat, BeyondTrust等）均表明此漏洞是可利用的，且利用后可获得root权限。提供的代码包含Dockerfile，Makefile，exploit.c，shellcode.c和README.md，构建和运行均有详尽说明，且漏洞利用代码中已包含详细的注释信息，表明其利用方式是可行的。

**投毒风险：**

分析提供的 POC 代码，投毒风险较低。理由如下：

*   **公开的漏洞：** 该漏洞（CVE-2021-3156）是公开且被广泛研究的漏洞，由Qualys等安全公司发现并公布了细节。
*   **代码可读性：** 提供的C代码（`exploit.c`和`shellcode.c`）相对简单，功能清晰，没有明显的恶意行为。
*   **Docker环境：** Dockerfile创建了一个隔离的测试环境，限制了潜在的恶意行为。
*   **Shellcode功能：** `shellcode.c` 中的 shellcode 主要功能是 setuid(0), setgid(0) 和 execve("/bin/sh")，这是一个典型的提权 shellcode，用于获得 root shell，是漏洞利用的正常组成部分，而不是后门程序。

但是，仍然存在很低的投毒风险，概率约为 5%。虽然 shellcode 的主要功能是提权并执行 /bin/sh，但攻击者仍然可以在 shellcode 中添加一些额外的恶意代码，例如：
    *   **信息收集：** 收集系统信息并发送到远程服务器。
    *   **持久化后门：** 在系统中植入后门，以便长期控制。

尽管如此，考虑到漏洞本身的性质（本地提权）和代码的整体可读性，直接植入恶意后门的风险相对较低。

**利用方式：**

1.  **缓冲区溢出：**  漏洞利用的核心是 `sudoedit -s` 命令处理参数时存在的 off-by-one 错误，这导致了堆缓冲区溢出。
2.  **堆 Feng-Shui：**  通过设置 `LC_*` 环境变量，在堆上布置特定的内存结构，以便溢出能够覆盖关键数据结构，特别是 `service_user` 结构体。
3.  **覆盖 service_user 结构：**  利用溢出，用指向 shellcode 库（`libnss_x/x.so.2`）的路径覆盖 `service_user` 结构体中的 `files` 字段。
4.  **执行 Shellcode：**  当 sudo 尝试使用被覆盖的 `files` 字段加载库时，实际上加载并执行了包含提权 shellcode 的库。
5.  **Root Shell：**  Shellcode 执行 `setuid(0)` 和 `setgid(0)` 将用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而获得 root shell。

**项目地址:** [arvindshima/CVE-2021-3156](https://github.com/arvindshima/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #18

**来源**: [CVE-2021-3156-asepsaepdin_CVE-2021-3156.md](../2021/CVE-2021-3156-asepsaepdin_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户能够执行sudoedit -s

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是一个Sudo中的堆缓冲区溢出漏洞。此漏洞存在于sudo解析命令行参数的方式中，特别是当使用'sudoedit -s'命令并且命令行参数以单个反斜杠字符结尾时。攻击者可以利用此漏洞通过本地用户提升权限到root。

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码是有效的。搜索结果中多个链接表明该漏洞已被积极利用，并且存在公开可用的PoC。

**投毒风险:**
分析PoC代码后，存在轻微的投毒风险。具体来说，`shellcode.c` 文件中的shellcode执行了`setuid(0)` 和 `setgid(0)`来提升权限，然后执行 `/bin/sh`。虽然看起来很直接，但存在将 `/bin/sh`替换为恶意程序或向shellcode中添加恶意功能的可能。Makefile看起来相对简单，但如果添加了额外的编译步骤来注入恶意代码，也存在一定的风险。总体而言，投毒风险较低，因为PoC本身的目标就是提权，替换/bin/sh可能会影响POC的可用性，但添加额外操作还是有可能的。

**利用方式:**
1.  漏洞利用代码首先构造一个包含大量 'Y' 字符并以反斜杠结尾的缓冲区 (`buf`)。此缓冲区用于触发堆缓冲区溢出。
2.  设置环境变量，如 `LC_MESSAGES`、`LC_TELEPHONE` 和 `LC_MEASUREMENT`，用于进行堆排布（heap feng shui），以将目标 `service_user` 结构放置在可预测的内存位置。`overflow`环境变量用于填充堆，并包含足够多的 'X' 字符，以覆盖到目标 `service_user` 结构。
3.  `execve` 函数调用 `sudoedit`，并传递构造的 `argv` (包含 `-s` 和溢出缓冲区) 和 `envp` (包含用于堆排布的环境变量)。
4.  通过溢出缓冲区，覆盖 `service_user` 结构中的 `files` 字段的 `name` 指针，使其指向 `libnss_x/x.so.2`的路径。
5.  `libnss_x/x.so.2` 是一个共享库，其中包含在 `_init` 函数中定义的 shellcode。由于 `name` 指针已被覆盖，当 `sudoedit` 尝试使用 `files` 字段时，它实际上会加载并执行此共享库中的 shellcode。
6.  Shellcode 执行 `setuid(0)` 和 `setgid(0)`，从而将有效用户 ID 和组 ID 设置为 root，然后执行 `/bin/sh`，从而产生一个 root shell。

总体而言，该漏洞利用通过堆缓冲区溢出覆盖了 `sudoedit` 中使用的内存结构，允许攻击者执行任意代码并获得 root 权限。

**项目地址:** [asepsaepdin/CVE-2021-3156](https://github.com/asepsaepdin/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #19

**来源**: [CVE-2021-3156-chenaotian_CVE-2021-3156.md](../2021/CVE-2021-3156-chenaotian_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，本地提权至 root

**影响版本:** 1.8.2 - 1.8.31sp12, 1.9.0 - 1.9.5sp1

**利用条件:** 本地用户，Sudo 具有 SUID 权限且可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 是一个 Sudo 中的堆缓冲区溢出漏洞，也被称为 "Baron Samedit"。该漏洞允许本地用户通过 `sudoedit -s` 和一个以单个反斜杠字符结尾的命令行参数来提升权限至 root。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可用的PoC代码。提供的PoC代码利用了 `sudoedit -s` 命令以及精心构造的参数，可以触发堆缓冲区溢出，从而实现提权。多个安全博客和漏洞报告证实了该漏洞的可利用性。

**投毒风险：**

分析提供的漏洞利用代码仓库，其中包含Dockerfile和exp.c文件。Dockerfile文件用于构建漏洞环境，exp.c为C语言编写的漏洞利用程序。代码仓库中主要包含漏洞利用的必要文件，没有发现作者隐藏的恶意代码，例如后门程序、信息收集模块或任何其他与漏洞利用无关的功能。因此，该仓库的投毒风险较低。因此，评估投毒风险为0%。

**利用方式：**

1.  **触发条件：** 漏洞利用需要满足以下条件：
    *   本地用户身份
    *   目标系统上安装了受影响版本的 Sudo
    *   Sudo 程序具有 SUID 权限
2.  **利用步骤：**
    *   使用 `sudoedit -s` 命令，并构造一个以单个反斜杠字符结尾的命令行参数。参数的长度需要足够长，以便触发堆缓冲区溢出。
    *   利用缓冲区溢出，覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。
    *   恶意代码通常会调用 `setuid(0)` 和 `setgid(0)`，从而将当前用户的有效用户 ID 和组 ID 设置为 root，实现提权。
3.  **漏洞原理：**
    *   漏洞根源在于 `set_cmnd` 函数中，在处理命令行参数时，对反斜杠字符的处理存在缺陷。
    *   当命令行参数以单个反斜杠字符结尾时，代码会错误地将反斜杠字符和紧随其后的空字符都复制到堆缓冲区中，导致缓冲区溢出。
    *   通过精心构造命令行参数，可以控制溢出的内容，从而覆盖堆上的数据结构，最终劫持控制流，执行恶意代码。

**项目地址:** [chenaotian/CVE-2021-3156](https://github.com/chenaotian/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #20

**来源**: [CVE-2021-3156-duongdz96_CVE-2021-3156-main.md](../2021/CVE-2021-3156-duongdz96_CVE-2021-3156-main.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，任何本地用户都可利用此漏洞提升权限至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞出现在sudo解析命令行参数的过程中。通过精心构造以单个反斜杠字符结尾的命令行参数，攻击者可以触发off-by-one错误，导致堆缓冲区溢出，最终允许任何本地用户将权限提升到root。

**有效性分析：**

*   根据漏洞库信息和搜索结果，此漏洞已被广泛证实存在，并有公开可用的利用代码。
*   提供的漏洞利用代码库包含多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞具有较高的利用成功率。
*   搜索结果中的链接(如Qualys博客、NVD、NCC Group博客等)也证实了该漏洞的存在和危害。

**投毒风险分析：**

*   漏洞利用代码库包含LICENSE文件，表明作者声明了版权，并使用了较为宽松的BSD许可，这在一定程度上降低了作者故意投毒的可能性。
*   代码库包含多个利用脚本，针对不同的系统和sudo配置，代码量相对较大，人工审计难度较高。但从代码注释和说明文档来看，作者提供了较为清晰的漏洞利用思路。
*   `exploit_timestamp_race.c` 利用了竞争条件，可能存在不稳定性，也可能被恶意利用，但不能直接判定为恶意投毒。
*   `exploit_userspec.py` 直接修改`/etc/passwd`文件来提权，如果被篡改加入恶意用户，则存在一定的风险。
*  总体而言，代码库的投毒风险较低，约为10%，主要集中在代码复杂性带来的潜在风险和对`/etc/passwd`文件的修改上，建议在使用前进行详细的代码审计。

**利用方式：**

1.  漏洞利用始于一个off-by-one错误，发生在sudo在解析命令行参数时，特别是当参数以单个反斜杠结尾时。
2.  这个错误会导致堆缓冲区溢出。
3.  攻击者通过精心构造的参数，覆盖相邻的堆内存。
4.  根据不同的利用脚本，攻击者可以通过覆盖`defaults`结构体、`userspec`结构体或`service_user`结构体来达到提权的目的。
5.  更具体地说，一些脚本覆盖`defaults`结构体来修改mailer的路径，指向攻击者可控的恶意程序，从而以root权限执行该恶意程序。另一些脚本则覆盖`userspec`结构体来绕过认证，并在`/etc/passwd`文件中添加一个具有root权限的新用户。
6.  最后，`exploit_timestamp_race.c`通过竞争条件修改`/etc/passwd`文件。

**项目地址:** [duongdz96/CVE-2021-3156-main](https://github.com/duongdz96/CVE-2021-3156-main)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #21

**来源**: [CVE-2021-3156-hycheng15_CVE-2021-3156.md](../2021/CVE-2021-3156-hycheng15_CVE-2021-3156.md)

## CVE-2021-3156 Sudo Baron Samedit 权限提升漏洞

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可以执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156（Baron Samedit）是Sudo 1.9.5p2之前版本中的一个堆缓冲区溢出漏洞。该漏洞位于sudo解析命令行参数的过程中。攻击者可以利用`sudoedit -s`命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而将权限提升至root。

**有效性：**
提供的POC代码是有效的。搜索结果中的多个网页（例如，Qualys博客、NCC Group博客、RedHat安全页面）都确认了该漏洞的存在，并提供了利用方法。POC代码通过构造特定的命令行参数和环境变量，触发堆溢出，覆盖`service_user`结构，最终执行shellcode以获得root权限。

**投毒风险：**
该仓库中存在轻微的投毒风险（10%）。虽然代码本身实现了漏洞利用，但可能存在以下情况：
*   **Shellcode修改：** 作者可能在shellcode中添加了不明显的后门逻辑，例如，在获得root shell之前执行某些恶意操作。虽然提供的shellcode比较简单，但作者完全可以替换成更复杂的payload。
*   **编译选项：** Makefile中使用的编译选项，可能会被修改，例如关闭某些安全特性，虽然目前只是`-O3`优化。

**利用方式：**
1.  **漏洞触发：** 通过`sudoedit -s` 命令，并提供一个以反斜杠结尾的超长参数。
2.  **堆溢出：** 利用超长参数覆盖堆上相邻的`service_user`结构。
3.  **控制`service_user`：** 覆盖`service_user`结构中的`name`字段，指向包含shellcode的恶意动态链接库（`libnss_x/x.so.2`）的路径。
4.  **加载恶意库：** Sudo在后续操作中尝试加载`service_user`的`name`字段指定的库，从而执行shellcode。
5.  **权限提升：** shellcode设置UID和GID为0，然后执行`/bin/sh`，获得root shell。

**项目地址:** [hycheng15/CVE-2021-3156](https://github.com/hycheng15/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #22

**来源**: [CVE-2021-3156-lypd0_CVE-2021-3156-checker.md](../2021/CVE-2021-3156-lypd0_CVE-2021-3156-checker.md)

## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #23

**来源**: [CVE-2021-3156-mutur4_CVE-2021-3156.md](../2021/CVE-2021-3156-mutur4_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #24

**来源**: [CVE-2021-3156-puckiestyle_CVE-2021-3156.md](../2021/CVE-2021-3156-puckiestyle_CVE-2021-3156.md)

## CVE-2021-3156 (Sudo Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** 1.9.5p2之前

**利用条件:** 本地用户能够执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名“Baron Samedit”，是一个存在于Sudo 1.9.5p2之前的版本中的堆缓冲区溢出漏洞。该漏洞位于sudo在解析命令行参数时，由于一个单字节溢出（off-by-one error）导致。攻击者可以通过`sudoedit -s`命令，结合以单个反斜杠字符结尾的命令行参数，触发此漏洞，从而实现权限提升，获得root权限。

**有效性：**

从漏洞描述、搜索结果以及提供的漏洞利用代码来看，该漏洞的POC代码是有效的。多个来源（Qualys blog, NCC Group blog, Red Hat advisory, BeyondTrust blog等）都证实了该漏洞的存在和利用的可能性。提供的代码库包含了多个针对不同glibc版本和Sudo配置的利用脚本，表明该漏洞已被广泛研究和利用。

**投毒风险：**

评估提供的代码仓库是否存在投毒风险，需要分析仓库中的文件。该仓库包含了多个利用脚本，这些脚本旨在提升权限，因此可能被滥用。但是从代码来看，都是围绕着漏洞利用展开，没有发现明显的恶意代码，因此评估投毒风险为10%。

**利用方式：**

利用方式主要包括以下几个步骤：

1.  **触发漏洞：** 利用`sudoedit -s`命令以及构造特殊的命令行参数（以单个反斜杠结尾）来触发堆缓冲区溢出。
2.  **覆盖堆内存：** 通过精心设计的输入，覆盖堆上的关键数据结构，如`defaults`、`userspec`或`service_user`结构体。
3.  **权限提升：**
    *   **覆盖mailer路径：** 覆盖`defaults`结构体中的`mailer`路径，将其指向恶意程序，从而以root权限执行该恶意程序。
    *   **绕过认证：** 覆盖`userspec`结构体，绕过身份验证，允许攻击者执行任意命令。
    *   **修改/etc/passwd：** 覆盖`def_timestamp`结构体，配合竞争条件，修改`/etc/passwd`文件，添加具有root权限的新用户。
4.  **获得Root权限：** 通过上述方法，最终获得系统的root权限。

提供的代码库包含了多种利用方法，如`exploit_nss.py`，`exploit_timestamp_race.c`，`exploit_defaults_mailer.py`，`exploit_userspec.py`等，分别针对不同的系统配置和glibc版本。

**项目地址:** [puckiestyle/CVE-2021-3156](https://github.com/puckiestyle/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #25

**来源**: [CVE-2021-3156-q77190858_CVE-2021-3156.md](../2021/CVE-2021-3156-q77190858_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** < 1.9.5p2 (受影响版本)

**利用条件:** 需要本地用户权限，目标系统sudo版本低于1.9.5p2且满足漏洞触发条件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 和以单个反斜杠字符结尾的命令行参数将权限提升为 root。

**有效性:**

提供的 PoC 代码是有效的。Dockerfile 用于构建一个包含易受攻击的 Sudo 版本的环境 (Ubuntu 20.04 with Sudo 1.8.31-1ubuntu1)。 exploit.c 包含利用代码， shellcode.c 包含执行 shell 的 shellcode，Makefile 用于编译。

搜索结果也证实了该漏洞的存在和严重性，以及利用该漏洞的公开信息。

**投毒风险:**

分析提供的 PoC 代码，该代码利用了已知的 CVE-2021-3156 漏洞，没有明显的投毒迹象。 Shellcode只是简单的提升权限执行/bin/bash，没有恶意行为。代码目的是为了演示漏洞，快速获取root权限。

**利用方式:**

利用方式如下：

1.  **触发漏洞:** 通过 `sudoedit -s` 命令以及精心构造的、以单个反斜杠结尾的命令行参数，触发堆缓冲区溢出。
2.  **堆喷射 (Heap Feng-Shui):** 使用 `LC_*` 环境变量进行堆喷射，以便在内存中布置目标 `service_user` 结构体。
3.  **溢出覆盖:**  通过缓冲区溢出覆盖目标 `service_user` 结构体的 `files` 字段，将其指向包含 shellcode 的库的路径 (`/home/exploit/libnss_x/x.so.2`)。
4.  **执行 Shellcode:** 当 Sudo 尝试使用被覆盖的 `files` 字段时，会加载并执行我们的 shellcode。 Shellcode 提升权限并执行 `/bin/bash`，从而提供一个 root shell。

总而言之，提供的代码利用了 CVE-2021-3156 的堆缓冲区溢出漏洞，通过覆盖关键的 Sudo 结构体指针，允许未经授权的用户获得 root 权限。

**项目地址:** [q77190858/CVE-2021-3156](https://github.com/q77190858/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #26

**来源**: [CVE-2021-3156-shishirpandey18_CVE-2021-3156.md](../2021/CVE-2021-3156-shishirpandey18_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit 堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至root

**影响版本:** Sudo 1.8.31p2之前版本到1.9.5p2之前版本

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为 root。

**有效性：**
提供的PoC代码利用了 CVE-2021-3156 漏洞。`exploit_launcher.c` 构造特定的命令行参数和环境变量，触发 sudoedit 的参数解析过程中的 off-by-one 错误，导致堆缓冲区溢出。溢出数据覆盖关键数据结构，最终执行 `exploit_payload.c` 中的代码，该代码通过 `setuid(0)` 等函数将当前进程的 uid 设置为 0，从而获得 root 权限。`Makefile` 用于编译和构建 exploit。 根据搜索结果和漏洞描述，此漏洞利用方式是有效的。

**投毒风险：**
PoC代码中存在的投毒风险较低，大约为1%。`exploit_payload.c` 仅仅调用了`setuid(0)`等函数修改用户ID以及执行了 `/bin/sh`。攻击者可能进行代码投毒的地方有:

1.  **环境变量操纵:**  理论上，可以尝试通过修改环境变量来影响 `/bin/sh` 的行为，但这属于利用漏洞后的行为，而非在利用代码中进行投毒。
2.  **Payload替换:** 恶意攻击者可以修改`exploit_payload.c`中的payload,植入恶意代码。

考虑到原始PoC的目的是为了演示漏洞，而不是进行实际的攻击，因此投毒的可能性相对较低。但用户仍需谨慎使用未经验证的PoC。

**利用方式：**
1.  **漏洞触发：**  利用 `sudoedit -s` 命令，并构造特定的、以反斜杠结尾的命令行参数，触发 off-by-one 错误。
2.  **缓冲区溢出：**  通过构造大量的 'A' 和 'B' 字符，造成堆缓冲区溢出。
3.  **Payload执行：**  覆盖关键数据结构，劫持控制流，执行预先编译好的 payload (`exploit_payload.c`)。
4.  **权限提升：**  Payload 代码将当前进程的 uid 设置为 0，获得 root 权限，并执行 `/bin/sh`，获得 root shell。

**项目地址:** [shishirpandey18/CVE-2021-3156](https://github.com/shishirpandey18/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #27

**来源**: [CVE-2021-3156-stong_CVE-2021-3156.md](../2021/CVE-2021-3156-stong_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本的堆缓冲区溢出漏洞。该漏洞允许未经授权的本地用户通过 `sudoedit -s` 命令以及一个以单反斜杠字符结尾的命令行参数来提升权限至 root。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经有公开的利用代码（POC）。搜索结果中的多个链接都指向了漏洞分析、利用方法和检测手段。根据提供的POC代码，该漏洞利用是有效的。POC代码已经被成功测试在Ubuntu 18.04和20.04上。

**投毒风险分析：**

分析提供的POC代码，投毒风险较低，约为5%。原因如下：

*   **代码功能明确：**  `exploit.c` 的代码目的是利用堆缓冲区溢出漏洞，通过覆盖内存来修改 `/etc/passwd` 文件，从而将当前用户的 UID 修改为 0，实现权限提升。虽然修改`/etc/passwd`具有破坏性，但是符合漏洞利用预期。
*   **依赖文件：**  该利用需要提供一个`fakepasswd`文件，这要求攻击者必须首先复制`/etc/passwd`并修改其中的用户ID。该步骤相对来说风险可控.
*   **RACE_SLEEP_TIME:**  代码中存在 `RACE_SLEEP_TIME` 参数，表明利用过程可能存在竞争条件，需要在不同系统上进行调整，这增加了利用的复杂性。
*   **免责声明：**  `LICENSE` 文件包含了明确的免责声明，表明作者不承担任何责任。虽然这不能完全排除投毒风险，但一定程度上说明作者的意图。

尽管风险较低，仍然需要注意：

*   **依赖性：**  POC 依赖特定的环境配置和文件，如果环境不匹配，可能导致利用失败或系统不稳定。
*   **潜在破坏：**  即使没有恶意代码，成功的利用本身也会修改系统文件，造成潜在的破坏。

**漏洞利用方式：**

1.  **准备工作：**
    *   复制 `/etc/passwd` 文件并命名为 `fakepasswd`。
    *   修改 `fakepasswd` 文件，将目标用户的 UID 修改为 0。
    *   编译 `exploit.c` 文件：`gcc exploit.c`
2.  **执行利用：**
    *   执行编译后的程序，并传入目标文件（通常是 `/etc/passwd`）和修改后的 `fakepasswd` 文件作为参数：`./a.out /etc/passwd fakepasswd`
    *   可能需要调整 `RACE_SLEEP_TIME` 参数以适应不同的系统。
3.  **权限提升：**
    *   成功利用后，重新登录或使用 `su` 命令切换到目标用户，即可获得 root 权限。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，POC 可用。虽然投毒风险较低，但仍然需要谨慎使用，并在测试环境中进行验证。利用成功后可获得 root 权限。

**项目地址:** [stong/CVE-2021-3156](https://github.com/stong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #28

**来源**: [CVE-2021-3156-ten-ops_baron-samedit.md](../2021/CVE-2021-3156-ten-ops_baron-samedit.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #29

**来源**: [CVE-2021-3156-wurwur_CVE-2021-3156.md](../2021/CVE-2021-3156-wurwur_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞允许本地用户利用`sudoedit -s`命令以及以单个反斜杠字符结尾的命令行参数，将权限提升至root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。多个信息来源都证实了该漏洞的存在，并且有可用的利用代码。

**投毒风险：**
提供的POC代码包含一个名为`backdoor.php`的文件，这是一个通过weevely生成的PHP后门，密码为`H@rmW#sH4rE!`。该后门允许攻击者以Apache用户的身份获得SSH会话的访问权限。`shell.php%00.jpg` 是利用NULL字节绕过文件上传验证的尝试。`exploit.py`是主要的漏洞利用程序，其目标是利用CVE-2021-3156提升权限。

因此，存在一定的投毒风险，因为利用代码仓库中包含一个PHP后门。尽管主漏洞利用程序`exploit.py`本身似乎是良性的，旨在利用CVE-2021-3156，但`backdoor.php`的存在意味着该仓库可能被用于传播恶意软件。将后门与漏洞利用代码放在一起，可以增加攻击成功的几率，也增加了普通用户误用的可能性。

考虑到该仓库包含一个明确的后门文件以及一个利用NULL字节绕过的文件名，我认为存在10%的投毒风险。

**利用方式：**
该漏洞的利用方式如下：

1.  **漏洞触发：** 通过执行`sudoedit -s`命令，并提供一个以单个反斜杠字符结尾的恶意构造的命令行参数。
2.  **堆缓冲区溢出：** 由于Sudo在处理命令行参数时的off-by-one错误，导致堆缓冲区溢出。
3.  **权限提升：** 攻击者通过控制堆中的数据，覆盖关键的Sudo数据结构，最终将权限提升至root。

`exploit.py` 通过伪造defaults对象，计算内存地址，构造恶意环境变量，然后执行sudoedit，从而触发漏洞，最终实现权限提升。它包含了攻击CentOS 7上sudo 1.8.23的特定偏移量。

**总结：**
CVE-2021-3156是一个严重的安全漏洞，允许本地用户提升权限至root。 虽然POC代码看起来针对CVE-2021-3156，但`backdoor.php`文件的存在增加了投毒的风险。

**项目地址:** [wurwur/CVE-2021-3156](https://github.com/wurwur/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #30

**来源**: [CVE-2021-3156-ypl6_heaplens.md](../2021/CVE-2021-3156-ypl6_heaplens.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞位于 `sudoers` 组件中，当 `sudo` 解析命令行参数时，存在一个 off-by-one 错误。通过 `sudoedit -s` 命令和以单个反斜杠字符结尾的命令行参数，任何本地用户都可以利用此漏洞将权限提升至 root。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码是有效的。 搜索结果中多个链接（例如，Qualys 博客、NCC Group 博客、Red Hat 页面）确认了该漏洞的存在和可利用性。 提供的 `README.md` 文件包含一个测试命令，`sudoedit -s /`，表明 `sudo` 易受攻击。此外, `heaplens` 工具用于辅助漏洞分析与利用，也间接证明了漏洞的可行性。

**投毒风险：**
该代码库的主要功能是提供一个名为 `heaplens` 的 GDB 插件，用于分析和调试堆内存分配。这个插件本身并没有明显的恶意代码，它的目的是为了辅助安全研究人员进行漏洞分析。 仓库中可能存在的风险在于，如果该插件被恶意修改，可能会在调试过程中泄露敏感信息或者执行恶意操作，但从代码本身来看，直接的投毒风险较低。 评估的投毒风险为10%。

**利用方式：**
1.  **触发漏洞：** 利用 `sudoedit -s` 命令，并提供一个以单个反斜杠字符结尾的特殊构造的命令行参数。 这会触发 `sudo` 程序中的 off-by-one 错误，导致堆缓冲区溢出。
2.  **溢出利用：** 成功触发溢出后，覆盖堆上的数据结构，通常会覆盖函数指针或者其他关键数据，进而控制程序的执行流程。
3.  **权限提升：** 通过控制程序流程，攻击者可以执行任意代码，从而将当前用户的权限提升至 root。 一种常见的利用方式是修改 `sudoers` 策略，允许当前用户执行任意命令而无需密码。
4.  **具体利用流程:** 根据 `heaplens`  工具的描述，它通过hook `malloc`, `realloc`, `calloc`, `free` 函数，来记录内存分配情况，方便逆向工程人员调试和分析。给出的例子，使用了 `-b` 参数设置断点，从而在调试的时候，可以中断程序的执行，方便分析。

总而言之，利用方式是利用 `sudoedit -s` 命令的特殊参数，触发堆溢出，覆盖关键数据，最终获得 root 权限。

**项目地址:** [ypl6/heaplens](https://github.com/ypl6/heaplens)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---



---

## POC #27

**来源**: [CVE-2021-3156-shishirpandey18_CVE-2021-3156.md](../2021/CVE-2021-3156-shishirpandey18_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit 堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至root

**影响版本:** Sudo 1.8.31p2之前版本到1.9.5p2之前版本

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为 root。

**有效性：**
提供的PoC代码利用了 CVE-2021-3156 漏洞。`exploit_launcher.c` 构造特定的命令行参数和环境变量，触发 sudoedit 的参数解析过程中的 off-by-one 错误，导致堆缓冲区溢出。溢出数据覆盖关键数据结构，最终执行 `exploit_payload.c` 中的代码，该代码通过 `setuid(0)` 等函数将当前进程的 uid 设置为 0，从而获得 root 权限。`Makefile` 用于编译和构建 exploit。 根据搜索结果和漏洞描述，此漏洞利用方式是有效的。

**投毒风险：**
PoC代码中存在的投毒风险较低，大约为1%。`exploit_payload.c` 仅仅调用了`setuid(0)`等函数修改用户ID以及执行了 `/bin/sh`。攻击者可能进行代码投毒的地方有:

1.  **环境变量操纵:**  理论上，可以尝试通过修改环境变量来影响 `/bin/sh` 的行为，但这属于利用漏洞后的行为，而非在利用代码中进行投毒。
2.  **Payload替换:** 恶意攻击者可以修改`exploit_payload.c`中的payload,植入恶意代码。

考虑到原始PoC的目的是为了演示漏洞，而不是进行实际的攻击，因此投毒的可能性相对较低。但用户仍需谨慎使用未经验证的PoC。

**利用方式：**
1.  **漏洞触发：**  利用 `sudoedit -s` 命令，并构造特定的、以反斜杠结尾的命令行参数，触发 off-by-one 错误。
2.  **缓冲区溢出：**  通过构造大量的 'A' 和 'B' 字符，造成堆缓冲区溢出。
3.  **Payload执行：**  覆盖关键数据结构，劫持控制流，执行预先编译好的 payload (`exploit_payload.c`)。
4.  **权限提升：**  Payload 代码将当前进程的 uid 设置为 0，获得 root 权限，并执行 `/bin/sh`，获得 root shell。

**项目地址:** [shishirpandey18/CVE-2021-3156](https://github.com/shishirpandey18/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #28

**来源**: [CVE-2021-3156-stong_CVE-2021-3156.md](../2021/CVE-2021-3156-stong_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本的堆缓冲区溢出漏洞。该漏洞允许未经授权的本地用户通过 `sudoedit -s` 命令以及一个以单反斜杠字符结尾的命令行参数来提升权限至 root。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经有公开的利用代码（POC）。搜索结果中的多个链接都指向了漏洞分析、利用方法和检测手段。根据提供的POC代码，该漏洞利用是有效的。POC代码已经被成功测试在Ubuntu 18.04和20.04上。

**投毒风险分析：**

分析提供的POC代码，投毒风险较低，约为5%。原因如下：

*   **代码功能明确：**  `exploit.c` 的代码目的是利用堆缓冲区溢出漏洞，通过覆盖内存来修改 `/etc/passwd` 文件，从而将当前用户的 UID 修改为 0，实现权限提升。虽然修改`/etc/passwd`具有破坏性，但是符合漏洞利用预期。
*   **依赖文件：**  该利用需要提供一个`fakepasswd`文件，这要求攻击者必须首先复制`/etc/passwd`并修改其中的用户ID。该步骤相对来说风险可控.
*   **RACE_SLEEP_TIME:**  代码中存在 `RACE_SLEEP_TIME` 参数，表明利用过程可能存在竞争条件，需要在不同系统上进行调整，这增加了利用的复杂性。
*   **免责声明：**  `LICENSE` 文件包含了明确的免责声明，表明作者不承担任何责任。虽然这不能完全排除投毒风险，但一定程度上说明作者的意图。

尽管风险较低，仍然需要注意：

*   **依赖性：**  POC 依赖特定的环境配置和文件，如果环境不匹配，可能导致利用失败或系统不稳定。
*   **潜在破坏：**  即使没有恶意代码，成功的利用本身也会修改系统文件，造成潜在的破坏。

**漏洞利用方式：**

1.  **准备工作：**
    *   复制 `/etc/passwd` 文件并命名为 `fakepasswd`。
    *   修改 `fakepasswd` 文件，将目标用户的 UID 修改为 0。
    *   编译 `exploit.c` 文件：`gcc exploit.c`
2.  **执行利用：**
    *   执行编译后的程序，并传入目标文件（通常是 `/etc/passwd`）和修改后的 `fakepasswd` 文件作为参数：`./a.out /etc/passwd fakepasswd`
    *   可能需要调整 `RACE_SLEEP_TIME` 参数以适应不同的系统。
3.  **权限提升：**
    *   成功利用后，重新登录或使用 `su` 命令切换到目标用户，即可获得 root 权限。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，POC 可用。虽然投毒风险较低，但仍然需要谨慎使用，并在测试环境中进行验证。利用成功后可获得 root 权限。

**项目地址:** [stong/CVE-2021-3156](https://github.com/stong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #29

**来源**: [CVE-2021-3156-ten-ops_baron-samedit.md](../2021/CVE-2021-3156-ten-ops_baron-samedit.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #30

**来源**: [CVE-2021-3156-wurwur_CVE-2021-3156.md](../2021/CVE-2021-3156-wurwur_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞允许本地用户利用`sudoedit -s`命令以及以单个反斜杠字符结尾的命令行参数，将权限提升至root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。多个信息来源都证实了该漏洞的存在，并且有可用的利用代码。

**投毒风险：**
提供的POC代码包含一个名为`backdoor.php`的文件，这是一个通过weevely生成的PHP后门，密码为`H@rmW#sH4rE!`。该后门允许攻击者以Apache用户的身份获得SSH会话的访问权限。`shell.php%00.jpg` 是利用NULL字节绕过文件上传验证的尝试。`exploit.py`是主要的漏洞利用程序，其目标是利用CVE-2021-3156提升权限。

因此，存在一定的投毒风险，因为利用代码仓库中包含一个PHP后门。尽管主漏洞利用程序`exploit.py`本身似乎是良性的，旨在利用CVE-2021-3156，但`backdoor.php`的存在意味着该仓库可能被用于传播恶意软件。将后门与漏洞利用代码放在一起，可以增加攻击成功的几率，也增加了普通用户误用的可能性。

考虑到该仓库包含一个明确的后门文件以及一个利用NULL字节绕过的文件名，我认为存在10%的投毒风险。

**利用方式：**
该漏洞的利用方式如下：

1.  **漏洞触发：** 通过执行`sudoedit -s`命令，并提供一个以单个反斜杠字符结尾的恶意构造的命令行参数。
2.  **堆缓冲区溢出：** 由于Sudo在处理命令行参数时的off-by-one错误，导致堆缓冲区溢出。
3.  **权限提升：** 攻击者通过控制堆中的数据，覆盖关键的Sudo数据结构，最终将权限提升至root。

`exploit.py` 通过伪造defaults对象，计算内存地址，构造恶意环境变量，然后执行sudoedit，从而触发漏洞，最终实现权限提升。它包含了攻击CentOS 7上sudo 1.8.23的特定偏移量。

**总结：**
CVE-2021-3156是一个严重的安全漏洞，允许本地用户提升权限至root。 虽然POC代码看起来针对CVE-2021-3156，但`backdoor.php`文件的存在增加了投毒的风险。

**项目地址:** [wurwur/CVE-2021-3156](https://github.com/wurwur/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #31

**来源**: [CVE-2021-3156-ypl6_heaplens.md](../2021/CVE-2021-3156-ypl6_heaplens.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞位于 `sudoers` 组件中，当 `sudo` 解析命令行参数时，存在一个 off-by-one 错误。通过 `sudoedit -s` 命令和以单个反斜杠字符结尾的命令行参数，任何本地用户都可以利用此漏洞将权限提升至 root。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码是有效的。 搜索结果中多个链接（例如，Qualys 博客、NCC Group 博客、Red Hat 页面）确认了该漏洞的存在和可利用性。 提供的 `README.md` 文件包含一个测试命令，`sudoedit -s /`，表明 `sudo` 易受攻击。此外, `heaplens` 工具用于辅助漏洞分析与利用，也间接证明了漏洞的可行性。

**投毒风险：**
该代码库的主要功能是提供一个名为 `heaplens` 的 GDB 插件，用于分析和调试堆内存分配。这个插件本身并没有明显的恶意代码，它的目的是为了辅助安全研究人员进行漏洞分析。 仓库中可能存在的风险在于，如果该插件被恶意修改，可能会在调试过程中泄露敏感信息或者执行恶意操作，但从代码本身来看，直接的投毒风险较低。 评估的投毒风险为10%。

**利用方式：**
1.  **触发漏洞：** 利用 `sudoedit -s` 命令，并提供一个以单个反斜杠字符结尾的特殊构造的命令行参数。 这会触发 `sudo` 程序中的 off-by-one 错误，导致堆缓冲区溢出。
2.  **溢出利用：** 成功触发溢出后，覆盖堆上的数据结构，通常会覆盖函数指针或者其他关键数据，进而控制程序的执行流程。
3.  **权限提升：** 通过控制程序流程，攻击者可以执行任意代码，从而将当前用户的权限提升至 root。 一种常见的利用方式是修改 `sudoers` 策略，允许当前用户执行任意命令而无需密码。
4.  **具体利用流程:** 根据 `heaplens`  工具的描述，它通过hook `malloc`, `realloc`, `calloc`, `free` 函数，来记录内存分配情况，方便逆向工程人员调试和分析。给出的例子，使用了 `-b` 参数设置断点，从而在调试的时候，可以中断程序的执行，方便分析。

总而言之，利用方式是利用 `sudoedit -s` 命令的特殊参数，触发堆溢出，覆盖关键数据，最终获得 root 权限。

**项目地址:** [ypl6/heaplens](https://github.com/ypl6/heaplens)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---



---

## POC #27

**来源**: [CVE-2021-3156-shishirpandey18_CVE-2021-3156.md](../2021/CVE-2021-3156-shishirpandey18_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit 堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至root

**影响版本:** Sudo 1.8.31p2之前版本到1.9.5p2之前版本

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为 root。

**有效性：**
提供的PoC代码利用了 CVE-2021-3156 漏洞。`exploit_launcher.c` 构造特定的命令行参数和环境变量，触发 sudoedit 的参数解析过程中的 off-by-one 错误，导致堆缓冲区溢出。溢出数据覆盖关键数据结构，最终执行 `exploit_payload.c` 中的代码，该代码通过 `setuid(0)` 等函数将当前进程的 uid 设置为 0，从而获得 root 权限。`Makefile` 用于编译和构建 exploit。 根据搜索结果和漏洞描述，此漏洞利用方式是有效的。

**投毒风险：**
PoC代码中存在的投毒风险较低，大约为1%。`exploit_payload.c` 仅仅调用了`setuid(0)`等函数修改用户ID以及执行了 `/bin/sh`。攻击者可能进行代码投毒的地方有:

1.  **环境变量操纵:**  理论上，可以尝试通过修改环境变量来影响 `/bin/sh` 的行为，但这属于利用漏洞后的行为，而非在利用代码中进行投毒。
2.  **Payload替换:** 恶意攻击者可以修改`exploit_payload.c`中的payload,植入恶意代码。

考虑到原始PoC的目的是为了演示漏洞，而不是进行实际的攻击，因此投毒的可能性相对较低。但用户仍需谨慎使用未经验证的PoC。

**利用方式：**
1.  **漏洞触发：**  利用 `sudoedit -s` 命令，并构造特定的、以反斜杠结尾的命令行参数，触发 off-by-one 错误。
2.  **缓冲区溢出：**  通过构造大量的 'A' 和 'B' 字符，造成堆缓冲区溢出。
3.  **Payload执行：**  覆盖关键数据结构，劫持控制流，执行预先编译好的 payload (`exploit_payload.c`)。
4.  **权限提升：**  Payload 代码将当前进程的 uid 设置为 0，获得 root 权限，并执行 `/bin/sh`，获得 root shell。

**项目地址:** [shishirpandey18/CVE-2021-3156](https://github.com/shishirpandey18/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #28

**来源**: [CVE-2021-3156-stong_CVE-2021-3156.md](../2021/CVE-2021-3156-stong_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本的堆缓冲区溢出漏洞。该漏洞允许未经授权的本地用户通过 `sudoedit -s` 命令以及一个以单反斜杠字符结尾的命令行参数来提升权限至 root。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经有公开的利用代码（POC）。搜索结果中的多个链接都指向了漏洞分析、利用方法和检测手段。根据提供的POC代码，该漏洞利用是有效的。POC代码已经被成功测试在Ubuntu 18.04和20.04上。

**投毒风险分析：**

分析提供的POC代码，投毒风险较低，约为5%。原因如下：

*   **代码功能明确：**  `exploit.c` 的代码目的是利用堆缓冲区溢出漏洞，通过覆盖内存来修改 `/etc/passwd` 文件，从而将当前用户的 UID 修改为 0，实现权限提升。虽然修改`/etc/passwd`具有破坏性，但是符合漏洞利用预期。
*   **依赖文件：**  该利用需要提供一个`fakepasswd`文件，这要求攻击者必须首先复制`/etc/passwd`并修改其中的用户ID。该步骤相对来说风险可控.
*   **RACE_SLEEP_TIME:**  代码中存在 `RACE_SLEEP_TIME` 参数，表明利用过程可能存在竞争条件，需要在不同系统上进行调整，这增加了利用的复杂性。
*   **免责声明：**  `LICENSE` 文件包含了明确的免责声明，表明作者不承担任何责任。虽然这不能完全排除投毒风险，但一定程度上说明作者的意图。

尽管风险较低，仍然需要注意：

*   **依赖性：**  POC 依赖特定的环境配置和文件，如果环境不匹配，可能导致利用失败或系统不稳定。
*   **潜在破坏：**  即使没有恶意代码，成功的利用本身也会修改系统文件，造成潜在的破坏。

**漏洞利用方式：**

1.  **准备工作：**
    *   复制 `/etc/passwd` 文件并命名为 `fakepasswd`。
    *   修改 `fakepasswd` 文件，将目标用户的 UID 修改为 0。
    *   编译 `exploit.c` 文件：`gcc exploit.c`
2.  **执行利用：**
    *   执行编译后的程序，并传入目标文件（通常是 `/etc/passwd`）和修改后的 `fakepasswd` 文件作为参数：`./a.out /etc/passwd fakepasswd`
    *   可能需要调整 `RACE_SLEEP_TIME` 参数以适应不同的系统。
3.  **权限提升：**
    *   成功利用后，重新登录或使用 `su` 命令切换到目标用户，即可获得 root 权限。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，POC 可用。虽然投毒风险较低，但仍然需要谨慎使用，并在测试环境中进行验证。利用成功后可获得 root 权限。

**项目地址:** [stong/CVE-2021-3156](https://github.com/stong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #29

**来源**: [CVE-2021-3156-ten-ops_baron-samedit.md](../2021/CVE-2021-3156-ten-ops_baron-samedit.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #30

**来源**: [CVE-2021-3156-wurwur_CVE-2021-3156.md](../2021/CVE-2021-3156-wurwur_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞允许本地用户利用`sudoedit -s`命令以及以单个反斜杠字符结尾的命令行参数，将权限提升至root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。多个信息来源都证实了该漏洞的存在，并且有可用的利用代码。

**投毒风险：**
提供的POC代码包含一个名为`backdoor.php`的文件，这是一个通过weevely生成的PHP后门，密码为`H@rmW#sH4rE!`。该后门允许攻击者以Apache用户的身份获得SSH会话的访问权限。`shell.php%00.jpg` 是利用NULL字节绕过文件上传验证的尝试。`exploit.py`是主要的漏洞利用程序，其目标是利用CVE-2021-3156提升权限。

因此，存在一定的投毒风险，因为利用代码仓库中包含一个PHP后门。尽管主漏洞利用程序`exploit.py`本身似乎是良性的，旨在利用CVE-2021-3156，但`backdoor.php`的存在意味着该仓库可能被用于传播恶意软件。将后门与漏洞利用代码放在一起，可以增加攻击成功的几率，也增加了普通用户误用的可能性。

考虑到该仓库包含一个明确的后门文件以及一个利用NULL字节绕过的文件名，我认为存在10%的投毒风险。

**利用方式：**
该漏洞的利用方式如下：

1.  **漏洞触发：** 通过执行`sudoedit -s`命令，并提供一个以单个反斜杠字符结尾的恶意构造的命令行参数。
2.  **堆缓冲区溢出：** 由于Sudo在处理命令行参数时的off-by-one错误，导致堆缓冲区溢出。
3.  **权限提升：** 攻击者通过控制堆中的数据，覆盖关键的Sudo数据结构，最终将权限提升至root。

`exploit.py` 通过伪造defaults对象，计算内存地址，构造恶意环境变量，然后执行sudoedit，从而触发漏洞，最终实现权限提升。它包含了攻击CentOS 7上sudo 1.8.23的特定偏移量。

**总结：**
CVE-2021-3156是一个严重的安全漏洞，允许本地用户提升权限至root。 虽然POC代码看起来针对CVE-2021-3156，但`backdoor.php`文件的存在增加了投毒的风险。

**项目地址:** [wurwur/CVE-2021-3156](https://github.com/wurwur/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #31

**来源**: [CVE-2021-3156-ypl6_heaplens.md](../2021/CVE-2021-3156-ypl6_heaplens.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞位于 `sudoers` 组件中，当 `sudo` 解析命令行参数时，存在一个 off-by-one 错误。通过 `sudoedit -s` 命令和以单个反斜杠字符结尾的命令行参数，任何本地用户都可以利用此漏洞将权限提升至 root。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码是有效的。 搜索结果中多个链接（例如，Qualys 博客、NCC Group 博客、Red Hat 页面）确认了该漏洞的存在和可利用性。 提供的 `README.md` 文件包含一个测试命令，`sudoedit -s /`，表明 `sudo` 易受攻击。此外, `heaplens` 工具用于辅助漏洞分析与利用，也间接证明了漏洞的可行性。

**投毒风险：**
该代码库的主要功能是提供一个名为 `heaplens` 的 GDB 插件，用于分析和调试堆内存分配。这个插件本身并没有明显的恶意代码，它的目的是为了辅助安全研究人员进行漏洞分析。 仓库中可能存在的风险在于，如果该插件被恶意修改，可能会在调试过程中泄露敏感信息或者执行恶意操作，但从代码本身来看，直接的投毒风险较低。 评估的投毒风险为10%。

**利用方式：**
1.  **触发漏洞：** 利用 `sudoedit -s` 命令，并提供一个以单个反斜杠字符结尾的特殊构造的命令行参数。 这会触发 `sudo` 程序中的 off-by-one 错误，导致堆缓冲区溢出。
2.  **溢出利用：** 成功触发溢出后，覆盖堆上的数据结构，通常会覆盖函数指针或者其他关键数据，进而控制程序的执行流程。
3.  **权限提升：** 通过控制程序流程，攻击者可以执行任意代码，从而将当前用户的权限提升至 root。 一种常见的利用方式是修改 `sudoers` 策略，允许当前用户执行任意命令而无需密码。
4.  **具体利用流程:** 根据 `heaplens`  工具的描述，它通过hook `malloc`, `realloc`, `calloc`, `free` 函数，来记录内存分配情况，方便逆向工程人员调试和分析。给出的例子，使用了 `-b` 参数设置断点，从而在调试的时候，可以中断程序的执行，方便分析。

总而言之，利用方式是利用 `sudoedit -s` 命令的特殊参数，触发堆溢出，覆盖关键数据，最终获得 root 权限。

**项目地址:** [ypl6/heaplens](https://github.com/ypl6/heaplens)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---



---

## POC #27

**来源**: [CVE-2021-3156-shishirpandey18_CVE-2021-3156.md](../2021/CVE-2021-3156-shishirpandey18_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit 堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至root

**影响版本:** Sudo 1.8.31p2之前版本到1.9.5p2之前版本

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为 root。

**有效性：**
提供的PoC代码利用了 CVE-2021-3156 漏洞。`exploit_launcher.c` 构造特定的命令行参数和环境变量，触发 sudoedit 的参数解析过程中的 off-by-one 错误，导致堆缓冲区溢出。溢出数据覆盖关键数据结构，最终执行 `exploit_payload.c` 中的代码，该代码通过 `setuid(0)` 等函数将当前进程的 uid 设置为 0，从而获得 root 权限。`Makefile` 用于编译和构建 exploit。 根据搜索结果和漏洞描述，此漏洞利用方式是有效的。

**投毒风险：**
PoC代码中存在的投毒风险较低，大约为1%。`exploit_payload.c` 仅仅调用了`setuid(0)`等函数修改用户ID以及执行了 `/bin/sh`。攻击者可能进行代码投毒的地方有:

1.  **环境变量操纵:**  理论上，可以尝试通过修改环境变量来影响 `/bin/sh` 的行为，但这属于利用漏洞后的行为，而非在利用代码中进行投毒。
2.  **Payload替换:** 恶意攻击者可以修改`exploit_payload.c`中的payload,植入恶意代码。

考虑到原始PoC的目的是为了演示漏洞，而不是进行实际的攻击，因此投毒的可能性相对较低。但用户仍需谨慎使用未经验证的PoC。

**利用方式：**
1.  **漏洞触发：**  利用 `sudoedit -s` 命令，并构造特定的、以反斜杠结尾的命令行参数，触发 off-by-one 错误。
2.  **缓冲区溢出：**  通过构造大量的 'A' 和 'B' 字符，造成堆缓冲区溢出。
3.  **Payload执行：**  覆盖关键数据结构，劫持控制流，执行预先编译好的 payload (`exploit_payload.c`)。
4.  **权限提升：**  Payload 代码将当前进程的 uid 设置为 0，获得 root 权限，并执行 `/bin/sh`，获得 root shell。

**项目地址:** [shishirpandey18/CVE-2021-3156](https://github.com/shishirpandey18/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #28

**来源**: [CVE-2021-3156-stong_CVE-2021-3156.md](../2021/CVE-2021-3156-stong_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本的堆缓冲区溢出漏洞。该漏洞允许未经授权的本地用户通过 `sudoedit -s` 命令以及一个以单反斜杠字符结尾的命令行参数来提升权限至 root。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经有公开的利用代码（POC）。搜索结果中的多个链接都指向了漏洞分析、利用方法和检测手段。根据提供的POC代码，该漏洞利用是有效的。POC代码已经被成功测试在Ubuntu 18.04和20.04上。

**投毒风险分析：**

分析提供的POC代码，投毒风险较低，约为5%。原因如下：

*   **代码功能明确：**  `exploit.c` 的代码目的是利用堆缓冲区溢出漏洞，通过覆盖内存来修改 `/etc/passwd` 文件，从而将当前用户的 UID 修改为 0，实现权限提升。虽然修改`/etc/passwd`具有破坏性，但是符合漏洞利用预期。
*   **依赖文件：**  该利用需要提供一个`fakepasswd`文件，这要求攻击者必须首先复制`/etc/passwd`并修改其中的用户ID。该步骤相对来说风险可控.
*   **RACE_SLEEP_TIME:**  代码中存在 `RACE_SLEEP_TIME` 参数，表明利用过程可能存在竞争条件，需要在不同系统上进行调整，这增加了利用的复杂性。
*   **免责声明：**  `LICENSE` 文件包含了明确的免责声明，表明作者不承担任何责任。虽然这不能完全排除投毒风险，但一定程度上说明作者的意图。

尽管风险较低，仍然需要注意：

*   **依赖性：**  POC 依赖特定的环境配置和文件，如果环境不匹配，可能导致利用失败或系统不稳定。
*   **潜在破坏：**  即使没有恶意代码，成功的利用本身也会修改系统文件，造成潜在的破坏。

**漏洞利用方式：**

1.  **准备工作：**
    *   复制 `/etc/passwd` 文件并命名为 `fakepasswd`。
    *   修改 `fakepasswd` 文件，将目标用户的 UID 修改为 0。
    *   编译 `exploit.c` 文件：`gcc exploit.c`
2.  **执行利用：**
    *   执行编译后的程序，并传入目标文件（通常是 `/etc/passwd`）和修改后的 `fakepasswd` 文件作为参数：`./a.out /etc/passwd fakepasswd`
    *   可能需要调整 `RACE_SLEEP_TIME` 参数以适应不同的系统。
3.  **权限提升：**
    *   成功利用后，重新登录或使用 `su` 命令切换到目标用户，即可获得 root 权限。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，POC 可用。虽然投毒风险较低，但仍然需要谨慎使用，并在测试环境中进行验证。利用成功后可获得 root 权限。

**项目地址:** [stong/CVE-2021-3156](https://github.com/stong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #29

**来源**: [CVE-2021-3156-ten-ops_baron-samedit.md](../2021/CVE-2021-3156-ten-ops_baron-samedit.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #30

**来源**: [CVE-2021-3156-wurwur_CVE-2021-3156.md](../2021/CVE-2021-3156-wurwur_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞允许本地用户利用`sudoedit -s`命令以及以单个反斜杠字符结尾的命令行参数，将权限提升至root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。多个信息来源都证实了该漏洞的存在，并且有可用的利用代码。

**投毒风险：**
提供的POC代码包含一个名为`backdoor.php`的文件，这是一个通过weevely生成的PHP后门，密码为`H@rmW#sH4rE!`。该后门允许攻击者以Apache用户的身份获得SSH会话的访问权限。`shell.php%00.jpg` 是利用NULL字节绕过文件上传验证的尝试。`exploit.py`是主要的漏洞利用程序，其目标是利用CVE-2021-3156提升权限。

因此，存在一定的投毒风险，因为利用代码仓库中包含一个PHP后门。尽管主漏洞利用程序`exploit.py`本身似乎是良性的，旨在利用CVE-2021-3156，但`backdoor.php`的存在意味着该仓库可能被用于传播恶意软件。将后门与漏洞利用代码放在一起，可以增加攻击成功的几率，也增加了普通用户误用的可能性。

考虑到该仓库包含一个明确的后门文件以及一个利用NULL字节绕过的文件名，我认为存在10%的投毒风险。

**利用方式：**
该漏洞的利用方式如下：

1.  **漏洞触发：** 通过执行`sudoedit -s`命令，并提供一个以单个反斜杠字符结尾的恶意构造的命令行参数。
2.  **堆缓冲区溢出：** 由于Sudo在处理命令行参数时的off-by-one错误，导致堆缓冲区溢出。
3.  **权限提升：** 攻击者通过控制堆中的数据，覆盖关键的Sudo数据结构，最终将权限提升至root。

`exploit.py` 通过伪造defaults对象，计算内存地址，构造恶意环境变量，然后执行sudoedit，从而触发漏洞，最终实现权限提升。它包含了攻击CentOS 7上sudo 1.8.23的特定偏移量。

**总结：**
CVE-2021-3156是一个严重的安全漏洞，允许本地用户提升权限至root。 虽然POC代码看起来针对CVE-2021-3156，但`backdoor.php`文件的存在增加了投毒的风险。

**项目地址:** [wurwur/CVE-2021-3156](https://github.com/wurwur/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #31

**来源**: [CVE-2021-3156-ypl6_heaplens.md](../2021/CVE-2021-3156-ypl6_heaplens.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞位于 `sudoers` 组件中，当 `sudo` 解析命令行参数时，存在一个 off-by-one 错误。通过 `sudoedit -s` 命令和以单个反斜杠字符结尾的命令行参数，任何本地用户都可以利用此漏洞将权限提升至 root。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码是有效的。 搜索结果中多个链接（例如，Qualys 博客、NCC Group 博客、Red Hat 页面）确认了该漏洞的存在和可利用性。 提供的 `README.md` 文件包含一个测试命令，`sudoedit -s /`，表明 `sudo` 易受攻击。此外, `heaplens` 工具用于辅助漏洞分析与利用，也间接证明了漏洞的可行性。

**投毒风险：**
该代码库的主要功能是提供一个名为 `heaplens` 的 GDB 插件，用于分析和调试堆内存分配。这个插件本身并没有明显的恶意代码，它的目的是为了辅助安全研究人员进行漏洞分析。 仓库中可能存在的风险在于，如果该插件被恶意修改，可能会在调试过程中泄露敏感信息或者执行恶意操作，但从代码本身来看，直接的投毒风险较低。 评估的投毒风险为10%。

**利用方式：**
1.  **触发漏洞：** 利用 `sudoedit -s` 命令，并提供一个以单个反斜杠字符结尾的特殊构造的命令行参数。 这会触发 `sudo` 程序中的 off-by-one 错误，导致堆缓冲区溢出。
2.  **溢出利用：** 成功触发溢出后，覆盖堆上的数据结构，通常会覆盖函数指针或者其他关键数据，进而控制程序的执行流程。
3.  **权限提升：** 通过控制程序流程，攻击者可以执行任意代码，从而将当前用户的权限提升至 root。 一种常见的利用方式是修改 `sudoers` 策略，允许当前用户执行任意命令而无需密码。
4.  **具体利用流程:** 根据 `heaplens`  工具的描述，它通过hook `malloc`, `realloc`, `calloc`, `free` 函数，来记录内存分配情况，方便逆向工程人员调试和分析。给出的例子，使用了 `-b` 参数设置断点，从而在调试的时候，可以中断程序的执行，方便分析。

总而言之，利用方式是利用 `sudoedit -s` 命令的特殊参数，触发堆溢出，覆盖关键数据，最终获得 root 权限。

**项目地址:** [ypl6/heaplens](https://github.com/ypl6/heaplens)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---



---

## POC #27

**来源**: [CVE-2021-3156-shishirpandey18_CVE-2021-3156.md](../2021/CVE-2021-3156-shishirpandey18_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Baron Samedit 堆缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至root

**影响版本:** Sudo 1.8.31p2之前版本到1.9.5p2之前版本

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。此漏洞允许本地用户通过 `sudoedit -s` 命令以及以单个反斜杠字符结尾的命令行参数，将权限提升为 root。

**有效性：**
提供的PoC代码利用了 CVE-2021-3156 漏洞。`exploit_launcher.c` 构造特定的命令行参数和环境变量，触发 sudoedit 的参数解析过程中的 off-by-one 错误，导致堆缓冲区溢出。溢出数据覆盖关键数据结构，最终执行 `exploit_payload.c` 中的代码，该代码通过 `setuid(0)` 等函数将当前进程的 uid 设置为 0，从而获得 root 权限。`Makefile` 用于编译和构建 exploit。 根据搜索结果和漏洞描述，此漏洞利用方式是有效的。

**投毒风险：**
PoC代码中存在的投毒风险较低，大约为1%。`exploit_payload.c` 仅仅调用了`setuid(0)`等函数修改用户ID以及执行了 `/bin/sh`。攻击者可能进行代码投毒的地方有:

1.  **环境变量操纵:**  理论上，可以尝试通过修改环境变量来影响 `/bin/sh` 的行为，但这属于利用漏洞后的行为，而非在利用代码中进行投毒。
2.  **Payload替换:** 恶意攻击者可以修改`exploit_payload.c`中的payload,植入恶意代码。

考虑到原始PoC的目的是为了演示漏洞，而不是进行实际的攻击，因此投毒的可能性相对较低。但用户仍需谨慎使用未经验证的PoC。

**利用方式：**
1.  **漏洞触发：**  利用 `sudoedit -s` 命令，并构造特定的、以反斜杠结尾的命令行参数，触发 off-by-one 错误。
2.  **缓冲区溢出：**  通过构造大量的 'A' 和 'B' 字符，造成堆缓冲区溢出。
3.  **Payload执行：**  覆盖关键数据结构，劫持控制流，执行预先编译好的 payload (`exploit_payload.c`)。
4.  **权限提升：**  Payload 代码将当前进程的 uid 设置为 0，获得 root 权限，并执行 `/bin/sh`，获得 root shell。

**项目地址:** [shishirpandey18/CVE-2021-3156](https://github.com/shishirpandey18/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #28

**来源**: [CVE-2021-3156-stong_CVE-2021-3156.md](../2021/CVE-2021-3156-stong_CVE-2021-3156.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本的堆缓冲区溢出漏洞。该漏洞允许未经授权的本地用户通过 `sudoedit -s` 命令以及一个以单反斜杠字符结尾的命令行参数来提升权限至 root。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经有公开的利用代码（POC）。搜索结果中的多个链接都指向了漏洞分析、利用方法和检测手段。根据提供的POC代码，该漏洞利用是有效的。POC代码已经被成功测试在Ubuntu 18.04和20.04上。

**投毒风险分析：**

分析提供的POC代码，投毒风险较低，约为5%。原因如下：

*   **代码功能明确：**  `exploit.c` 的代码目的是利用堆缓冲区溢出漏洞，通过覆盖内存来修改 `/etc/passwd` 文件，从而将当前用户的 UID 修改为 0，实现权限提升。虽然修改`/etc/passwd`具有破坏性，但是符合漏洞利用预期。
*   **依赖文件：**  该利用需要提供一个`fakepasswd`文件，这要求攻击者必须首先复制`/etc/passwd`并修改其中的用户ID。该步骤相对来说风险可控.
*   **RACE_SLEEP_TIME:**  代码中存在 `RACE_SLEEP_TIME` 参数，表明利用过程可能存在竞争条件，需要在不同系统上进行调整，这增加了利用的复杂性。
*   **免责声明：**  `LICENSE` 文件包含了明确的免责声明，表明作者不承担任何责任。虽然这不能完全排除投毒风险，但一定程度上说明作者的意图。

尽管风险较低，仍然需要注意：

*   **依赖性：**  POC 依赖特定的环境配置和文件，如果环境不匹配，可能导致利用失败或系统不稳定。
*   **潜在破坏：**  即使没有恶意代码，成功的利用本身也会修改系统文件，造成潜在的破坏。

**漏洞利用方式：**

1.  **准备工作：**
    *   复制 `/etc/passwd` 文件并命名为 `fakepasswd`。
    *   修改 `fakepasswd` 文件，将目标用户的 UID 修改为 0。
    *   编译 `exploit.c` 文件：`gcc exploit.c`
2.  **执行利用：**
    *   执行编译后的程序，并传入目标文件（通常是 `/etc/passwd`）和修改后的 `fakepasswd` 文件作为参数：`./a.out /etc/passwd fakepasswd`
    *   可能需要调整 `RACE_SLEEP_TIME` 参数以适应不同的系统。
3.  **权限提升：**
    *   成功利用后，重新登录或使用 `su` 命令切换到目标用户，即可获得 root 权限。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，POC 可用。虽然投毒风险较低，但仍然需要谨慎使用，并在测试环境中进行验证。利用成功后可获得 root 权限。

**项目地址:** [stong/CVE-2021-3156](https://github.com/stong/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #29

**来源**: [CVE-2021-3156-ten-ops_baron-samedit.md](../2021/CVE-2021-3156-ten-ops_baron-samedit.md)

## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #30

**来源**: [CVE-2021-3156-wurwur_CVE-2021-3156.md](../2021/CVE-2021-3156-wurwur_CVE-2021-3156.md)

## CVE-2021-3156-Sudo-Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo before 1.9.5p2

**利用条件:** 本地用户可执行sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名Baron Samedit，是Sudo 1.9.5p2之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞允许本地用户利用`sudoedit -s`命令以及以单个反斜杠字符结尾的命令行参数，将权限提升至root。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。多个信息来源都证实了该漏洞的存在，并且有可用的利用代码。

**投毒风险：**
提供的POC代码包含一个名为`backdoor.php`的文件，这是一个通过weevely生成的PHP后门，密码为`H@rmW#sH4rE!`。该后门允许攻击者以Apache用户的身份获得SSH会话的访问权限。`shell.php%00.jpg` 是利用NULL字节绕过文件上传验证的尝试。`exploit.py`是主要的漏洞利用程序，其目标是利用CVE-2021-3156提升权限。

因此，存在一定的投毒风险，因为利用代码仓库中包含一个PHP后门。尽管主漏洞利用程序`exploit.py`本身似乎是良性的，旨在利用CVE-2021-3156，但`backdoor.php`的存在意味着该仓库可能被用于传播恶意软件。将后门与漏洞利用代码放在一起，可以增加攻击成功的几率，也增加了普通用户误用的可能性。

考虑到该仓库包含一个明确的后门文件以及一个利用NULL字节绕过的文件名，我认为存在10%的投毒风险。

**利用方式：**
该漏洞的利用方式如下：

1.  **漏洞触发：** 通过执行`sudoedit -s`命令，并提供一个以单个反斜杠字符结尾的恶意构造的命令行参数。
2.  **堆缓冲区溢出：** 由于Sudo在处理命令行参数时的off-by-one错误，导致堆缓冲区溢出。
3.  **权限提升：** 攻击者通过控制堆中的数据，覆盖关键的Sudo数据结构，最终将权限提升至root。

`exploit.py` 通过伪造defaults对象，计算内存地址，构造恶意环境变量，然后执行sudoedit，从而触发漏洞，最终实现权限提升。它包含了攻击CentOS 7上sudo 1.8.23的特定偏移量。

**总结：**
CVE-2021-3156是一个严重的安全漏洞，允许本地用户提升权限至root。 虽然POC代码看起来针对CVE-2021-3156，但`backdoor.php`文件的存在增加了投毒的风险。

**项目地址:** [wurwur/CVE-2021-3156](https://github.com/wurwur/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

## POC #31

**来源**: [CVE-2021-3156-ypl6_heaplens.md](../2021/CVE-2021-3156-ypl6_heaplens.md)

## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可导致权限提升至 root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.9.5p2 之前版本中存在的一个堆缓冲区溢出漏洞。该漏洞位于 `sudoers` 组件中，当 `sudo` 解析命令行参数时，存在一个 off-by-one 错误。通过 `sudoedit -s` 命令和以单个反斜杠字符结尾的命令行参数，任何本地用户都可以利用此漏洞将权限提升至 root。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码是有效的。 搜索结果中多个链接（例如，Qualys 博客、NCC Group 博客、Red Hat 页面）确认了该漏洞的存在和可利用性。 提供的 `README.md` 文件包含一个测试命令，`sudoedit -s /`，表明 `sudo` 易受攻击。此外, `heaplens` 工具用于辅助漏洞分析与利用，也间接证明了漏洞的可行性。

**投毒风险：**
该代码库的主要功能是提供一个名为 `heaplens` 的 GDB 插件，用于分析和调试堆内存分配。这个插件本身并没有明显的恶意代码，它的目的是为了辅助安全研究人员进行漏洞分析。 仓库中可能存在的风险在于，如果该插件被恶意修改，可能会在调试过程中泄露敏感信息或者执行恶意操作，但从代码本身来看，直接的投毒风险较低。 评估的投毒风险为10%。

**利用方式：**
1.  **触发漏洞：** 利用 `sudoedit -s` 命令，并提供一个以单个反斜杠字符结尾的特殊构造的命令行参数。 这会触发 `sudo` 程序中的 off-by-one 错误，导致堆缓冲区溢出。
2.  **溢出利用：** 成功触发溢出后，覆盖堆上的数据结构，通常会覆盖函数指针或者其他关键数据，进而控制程序的执行流程。
3.  **权限提升：** 通过控制程序流程，攻击者可以执行任意代码，从而将当前用户的权限提升至 root。 一种常见的利用方式是修改 `sudoers` 策略，允许当前用户执行任意命令而无需密码。
4.  **具体利用流程:** 根据 `heaplens`  工具的描述，它通过hook `malloc`, `realloc`, `calloc`, `free` 函数，来记录内存分配情况，方便逆向工程人员调试和分析。给出的例子，使用了 `-b` 参数设置断点，从而在调试的时候，可以中断程序的执行，方便分析。

总而言之，利用方式是利用 `sudoedit -s` 命令的特殊参数，触发堆溢出，覆盖关键数据，最终获得 root 权限。

**项目地址:** [ypl6/heaplens](https://github.com/ypl6/heaplens)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

---

