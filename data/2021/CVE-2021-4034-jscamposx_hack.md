## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** CRITICAL

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中包含 polkit 的版本 (自 2009 年起)

**利用条件:** 本地普通用户权限，目标系统安装有带有 SUID 权限的 pkexec 程序

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC提供了针对CVE-2021-4034（PwnKit）的完整漏洞利用方案。PwnKit是一个存在于Polkit的pkexec程序中的内存损坏漏洞。该POC利用了pkexec在处理命令行参数（argv）时的越界读取漏洞。当argv为空时，pkexec会尝试读取argv[1]，从而读取到环境变量（envp[0]）。通过精心构造的环境变量，攻击者可以诱导pkexec通过gconv机制加载恶意的共享库（.so文件），从而在SUID权限下执行任意代码。本POC包含一个预编译的ELF二进制文件‘PwnKit’，这极大地提高了其易用性，用户无需在目标机器上配置编译环境即可运行。此外，POC还集成了一个PHP反弹Shell脚本，旨在为攻击者在提权后提供持久化的远程控制能力。经分析，该漏洞利用原理清晰，在缺少补丁的Linux系统中成功率极高，具有极强的实战破坏力。 利用步骤：1. 攻击者首先通过SSH、Webshell或其他方式获取目标Linux系统的普通用户权限。2. 将二进制文件‘PwnKit’上传至目标系统的临时目录（如/tmp）。3. 使用‘chmod +x PwnKit’赋予文件执行权限。4. 直接运行‘./PwnKit’。5. 漏洞触发后，系统将直接弹出具有Root权限的Shell环境。若需建立远程持久化，攻击者可在攻击机开启nc监听，并配合运行提供的reverseShell.php脚本。 投毒风险分析：该POC仓库的投毒风险评估为低至中等。风险点主要在于：1. 提供了预编译的ELF二进制文件。在安全研究领域，使用未经源码审计的预编译二进制文件存在极高风险，因为攻击者可能在编译过程中植入后门、木马或窃密脚本，导致研究员在测试时反被控。虽然本项目标榜为教育目的，但二进制文件的黑盒属性是主要的潜在威胁。2. 集成了Reverse Shell脚本。尽管该脚本声明用于后渗透阶段，但其预配置的IP（192.168.1.8）和硬编码行为符合典型黑客工具包特征。3. 仓库描述使用了较多煽动性词汇（如‘Arsenal’、‘Skull emoji’），这类项目往往容易被恶意软件开发者克隆并二次打包投毒。然而，目前的代码结构尚属清晰，未发现明显的代码混淆或自动执行的恶意安装脚本。建议安全研究人员在测试此类POC时，务必在完全隔离的虚拟机环境中运行，并优先使用可信来源的源代码进行自行编译，而非直接使用二进制文件，以规避潜在的供应链投毒攻击。

**项目地址:** /tmp/vulnwatchdog_9f0d2421efe03bc8b5f2bccd08a3675d/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
