## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式，安装了Ignition组件（2.5.2之前版本）

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于Laravel框架的错误处理组件Ignition中。当应用处于Debug模式时，Ignition允许用户通过POST请求向`/_ignition/execute-solution`接口发送特定的解决方案指令。POC利用了`MakeViewVariableOptionalSolution`类中对`viewFile`参数的不安全处理。核心利用逻辑是通过`file_get_contents`和`file_put_contents`配合PHP的过滤器（Filter）链，将恶意的Base64数据写入到Laravel的日志文件中，随后通过`phar://`协议触发反序列化。POC代码中定义了`monolog_rce`等多种Gadget Chains，并使用了外部工具`phpggc`来生成序列化载荷。分析显示，该POC具备完整的漏洞触发逻辑：首先通过检测确认环境，然后尝试通过清空日志、写入Payload、最后执行反序列化的流程来实现RCE。代码结构清晰，使用了标准的requests库进行交互，具有较高的实战利用价值。利用步骤：1. 确认目标Laravel开启Debug模式；2. 构造恶意Payload并利用PHP过滤器清空日志文件；3. 将Base64编码的Phar文件分段写入日志；4. 使用phar://协议包含日志文件触发反序列化；5. 执行系统命令。投毒风险分析：经过对提供的`exploit.py`代码审查，未发现明显的恶意后门植入或针对攻击者本机的破坏性代码。代码主要逻辑集中在与远程服务器的交互上。主要的风险点在于：1. 脚本依赖于本地安装的`phpggc`工具，如果该工具来源不可靠，可能存在本地执行风险；2. 脚本中的Payload构造部分使用了复杂的Python单行命令（如调用sys.stdin.read并转换十六进制），这种混淆方式虽然是为了格式化Payload，但也可能被用于隐藏恶意逻辑。3. 脚本并未包含任何反弹Shell至第三方服务器的可疑行为，其导入的库均为标准库（requests, os, uuid）。整体评估为低投毒风险，但用户在使用时应注意`phpggc`路径的配置，并确保在一个隔离的虚拟化环境中运行，以防止Payload构造过程中产生的临时文件对系统造成非预期影响。此外，Docker环境的配置文件显示其主要用于本地复现，配置相对安全。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
