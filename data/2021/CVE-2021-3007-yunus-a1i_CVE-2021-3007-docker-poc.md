## CVE-2021-3007 - Laminas/Zend HTTP Deserialization RCE

**漏洞编号:** CVE-2021-3007

**漏洞类型:** Deserialization RCE

**影响应用:** Laminas/Zend HTTP

**危害等级:** Critical

**CVSS评分:** N/A

**影响版本:** < 2.14.2 (laminas-http), <= 2.14.1 (zendframework/zend-http)

**利用条件:** Requires network access to a vulnerable endpoint, ability to send crafted serialized objects.

**POC 可用性:** 9/10

**POC 类型:** Complete exploit

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2021-3007 is a critical PHP deserialization vulnerability affecting Laminas/Zend HTTP versions prior to 2.14.2. The vulnerability resides in the `Zend\Http\Response\Stream` class and allows for arbitrary file write through attacker-controlled serialized objects. The provided Proof-of-Concept (PoC) includes a Docker environment, a Nuclei exploit template, and a standalone exploit script, facilitating easy verification and exploitation. The PoC's effectiveness is demonstrated through its ability to write arbitrary files on the target system via a crafted serialized object injected into the vulnerable `unserialize()` function within the application.

**POC有效性分析:**
The provided PoC is highly effective due to its comprehensive nature. It includes a Docker Compose configuration that sets up a vulnerable environment with the affected laminas-http dependency. The Nuclei template automates the exploitation process, and the standalone exploit script provides a manual method for triggering the vulnerability. The documentation is clear, detailing the steps required to run the PoC and verify the exploit. The inclusion of debug logs further enhances the PoC's usability by providing detailed insights into the exploitation process. The PoC leverages a real exploit payload, not merely version detection, making it a reliable tool for security researchers and penetration testers. The multi-step exploitation flow ensures the vulnerability is accurately triggered and validated.

**利用步骤:**
1.  Set up the vulnerable environment using Docker Compose (`docker-compose up -d`).
2.  Verify the application is running by accessing it via `curl http://127.0.0.1:8080`.
3.  Optionally, run the manual exploit test using `docker exec -it cve-2021-3007-vulnerable php /var/www/html/exploit.php http://localhost/index.php test.txt proof` to write a file named `test.txt` with the content "proof".
4.  Run the Nuclei template using `nuclei -u http://127.0.0.1:8080 -t CVE-2021-3007.yaml -debug -vv -o nuclei-debug-CVE-2021-3007.log` to automatically exploit the vulnerability. This will generate a debug log containing HTTP requests, payload data, and exploit verification responses.
5.  Clean up the environment using `docker-compose down -v`.

**投毒风险分析:**
The投毒风险 for this particular PoC is considered low. The provided code is relatively clean and straightforward, primarily focused on demonstrating the deserialization vulnerability. The `exploit.php` script generates a serialized object designed to write a file to the file system, which, while malicious in a vulnerable context, does not inherently contain overtly harmful code. The Dockerfile sets up a standard PHP environment with common dependencies and does not include any suspicious commands. The Nuclei template is designed to automate the exploitation process but does not introduce any additional risks beyond those inherent in the vulnerability itself. There is no evidence of code obfuscation, external script execution, or backdoors. The main concern is the file write capability, but this is part of the intended exploitation and not a separate malicious activity. Therefore, the poisoning risk is estimated at 10%. The risk could potentially increase if the file write were directed to critical system files, but the default PoC focuses on writing benign content to a user-controlled location. The lack of any network-based malware distribution or data exfiltration components further mitigates the poisoning risk.

**项目地址:** https://github.com/hakivvi/CVE-2021-3007

**漏洞详情:** N/A
