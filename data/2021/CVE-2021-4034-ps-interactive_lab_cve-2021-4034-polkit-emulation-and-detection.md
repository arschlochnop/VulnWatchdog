## CVE-2021-4034 - polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** polkit (pkexec)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中包含 polkit 的版本，自 2009 年 5 月起的所有版本 (0.105 及以下均受影响)

**利用条件:** 攻击者必须拥有目标系统的本地用户访问权限（即使是低权限用户）。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞被业界称为 PwnKit。提供的 Python POC 代码高度有效且专业。它利用了 pkexec 实用程序在处理命令行参数（argc 为 0）时的越界读取漏洞。代码通过 ctypes 调用 C 标准库中的 execve 函数，巧妙地构造了一个畸形的环境变量数组。其中，PATH=GCONV_PATH=. 与 XAUTHORITY 参数被用于触发 iconv 模块的错误加载。该 POC 会在 /tmp 目录下创建必要的目录结构和伪造的 gconv-modules 配置文件，并将 base64 编码的恶意共享库（payload）解码为 .so 文件。当 pkexec 运行时，由于它具有 setuid 权限，它会以 root 权限加载并执行攻击者指定的共享库，从而直接导致权限提升。整个利用过程无需任何复杂的依赖，且代码逻辑清晰，通过 Python 直接操作内存和系统调用，避开了常规 shell 命令的限制，具有极高的实战稳定性。利用步骤：1. 在目标系统的可写目录（如 /tmp）下部署此 Python 脚本。2. 脚本会自动创建名为 GCONV_PATH=. 的目录以及与 exploit 变量同名的子目录。3. 脚本会将内置的 base64 负载解码为共享库文件。4. 脚本创建一个恶意的 gconv-modules 文件，指向该共享库。5. 脚本通过 execve 启动 /usr/bin/pkexec，并注入精心构造的环境变量。6. pkexec 触发越界漏洞，加载恶意库，攻击者获得 root shell。投毒风险分析：该脚本目前的投毒风险处于较低水平（约 15%）。主要原因在于其逻辑透明度高，使用的是标准的 Python 类库（ctypes, os, base64），且核心逻辑完全围绕 CVE-2021-4034 的公开利用原理展开。代码中未发现明显的外部网络请求、未混淆的恶意二阶段下载器或对系统关键配置文件（如 /etc/shadow）的静默修改行为。主要的敏感行为包括在 /tmp 目录下创建文件和修改权限 (0o0755)，这些是漏洞利用的必要步骤。由于 payload 以 base64 编码形式硬编码在脚本中，防御者需注意该 payload 是否包含反弹 shell 以外的后门逻辑。虽然此 POC 表现为纯粹的研究工具，但安全研究员在使用时仍应在隔离的沙箱环境中审计 payload 字段，防止该 base64 字符串在提升权限后执行额外的破坏性操作。整体而言，该代码符合高质量漏洞研究 POC 的特征，投毒嫌疑较低。

**项目地址:** [https://access.redhat.com/security/cve/cve-2021-4034](https://access.redhat.com/security/cve/cve-2021-4034)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
