## CVE-2021-40438 - Apache HTTP Server SSRF

**漏洞编号:** CVE-2021-40438

**漏洞类型:** SSRF

**影响应用:** Apache HTTP Server

**危害等级:** 高危

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** 2.4.48 及之前版本

**利用条件:** 无需认证，网络可达

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 20%

## 详情

CVE-2021-40438 是 Apache HTTP Server 中的一个服务器端请求伪造（SSRF）漏洞。通过构造特制的请求 URI 路径，攻击者可以使 mod_proxy 模块将请求转发到由远程用户选择的源服务器。该漏洞影响 Apache HTTP Server 2.4.48 及之前的版本。经过对提供的POC代码进行分析，发现该POC利用了Apache HTTP Server中mod_proxy模块的配置缺陷，通过构造包含'unix:'前缀的URI，可以使服务器将请求转发到Unix域套接字。POC代码通过发送包含精心构造的URI的HTTP请求，触发了该漏洞。具体来说，该URI包含一个指向目标Unix域套接字的路径，例如：/\?unix:/path/to/socket|http://example.com/。服务器在处理该请求时，会将请求转发到指定的Unix域套接字，从而允许攻击者与该套接字进行交互。如果目标Unix域套接字绑定到具有特权访问权限的服务，攻击者可能能够利用此漏洞执行任意代码或访问敏感数据。

利用步骤：
1.  确定目标Apache HTTP Server的版本是否为2.4.48或更早版本。
2.  确认mod_proxy模块已启用。
3.  构造包含'unix:'前缀的恶意URI，指向目标Unix域套接字。
4.  向目标服务器发送包含该URI的HTTP请求。
5.  验证请求是否已成功转发到目标Unix域套接字。

投毒风险分析：
该POC代码主要通过构造特殊的URI来触发SSRF漏洞，本身不包含明显的恶意代码。然而，该漏洞可能被用于执行以下恶意活动：
1.  扫描内部网络：攻击者可以利用该漏洞扫描内部网络，发现其他易受攻击的系统。
2.  访问敏感数据：如果目标Unix域套接字绑定到具有特权访问权限的服务，攻击者可能能够访问敏感数据。
3.  执行任意代码：在某些情况下，攻击者可能能够利用该漏洞在目标服务器上执行任意代码。

由于POC代码主要依赖于HTTP请求的构造，因此其投毒风险较低。主要的风险在于，攻击者可能会修改POC代码，使其在利用漏洞的同时执行其他恶意操作。例如，攻击者可能会添加代码，在目标服务器上安装后门程序，或者窃取敏感数据。

考虑到以上因素，该POC的投毒风险评定为中低，约为20%。为了降低投毒风险，建议用户在使用POC代码时，仔细检查代码的安全性，并确保在安全的环境中运行。

**项目地址:** https://github.com/xxx/CVE-2021-40438

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2021-40438
