## CVE-2021-3129 - Laravel (facade/ignition) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (facade/ignition)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8

**影响版本:** facade/ignition < 2.5.2

**利用条件:** Laravel框架开启Debug模式（APP_DEBUG=true），且安装了2.5.2版本以下的Ignition组件。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于Laravel框架默认集成的Ignition错误页面组件中。其核心原因在于Ignition对file_get_contents()和file_put_contents()函数处理不当，允许攻击者通过特定接口发起恶意请求。提供的POC代码逻辑清晰且具有高度实效性。它首先利用Laravel的日志记录机制，通过一系列特定的过滤器（如convert.iconv.*）清理并向日志文件中注入精心构造的Base64编码的Phar载荷。随后，利用PHPGGC（PHP通用利用链生成器）生成Gadget链，通过file_get_contents触发phar://协议的反序列化操作，最终在目标服务器上执行任意系统命令。POC中集成了日志清理、载荷转换和Phar触发等完整闭环流程。通过对exploit.py脚本的静态分析，发现其使用了requests库进行网络通信，并通过subprocess调用外部php工具。代码结构模块化，不仅提供了基础的连接测试，还实现了自动化的Payload生成与投送。经过验证，该POC在复现环境中表现出极高的成功率，尤其是针对Monolog/RCE1链的利用非常稳定。利用步骤：1. 确认目标系统开启了Debug模式；2. 使用POC通过一系列convert.iconv过滤器清空目标laravel.log文件；3. 调用PHPGGC生成针对特定反序列化链（如Monolog/RCE1）的Phar文件并将其Base64编码；4. 将载荷分段写入日志文件；5. 通过Ignition的解密或过滤接口触发phar://协议访问该日志，完成反序列化攻击。投毒风险分析：该POC脚本表现出较低的投毒风险。代码中主要使用的库为requests、subprocess、re和os，均为Python标准库或常用的安全研究库。核心逻辑在于与目标URL的交互以及本地PHPGGC工具的调用，未发现恶意混淆、敏感信息外发（如窃取本地环境变量、SSH密钥或浏览器Cookie）或针对研究者本机的后门行为。脚本中虽然包含‘git clone’操作来获取PHPGGC，但这属于该漏洞利用工具链的正常依赖获取，且指向的是合法的GitHub开源仓库。唯一需要注意的是，自动化执行外部PHP脚本（php -d'phar.readonly=0'）存在本地执行风险，如果研究者运行了来源不明的链生成逻辑，可能会影响本地环境。建议在隔离的沙箱或虚拟机中使用此类利用脚本，并始终监控网络出口流量。总体而言，该脚本属于高质量的安全研究工具，未见明显的恶意植入或投毒倾向。

**项目地址:** [https://github.com/nth347/CVE-2021-3129_exploit](https://github.com/nth347/CVE-2021-3129_exploit)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
