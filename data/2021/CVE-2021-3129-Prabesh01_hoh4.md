## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** Laravel框架开启Debug模式（APP_DEBUG=true）且安装了Ignition组件

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对CVE-2021-3129漏洞提供了完整的自动化利用链。漏洞核心在于Laravel内置的错误页处理组件Ignition（facade/ignition）在Debug模式下暴露了`/_ignition/execute-solution`接口，允许执行预定义的‘解决方案’。攻击者通过利用`MakeViewVariableOptionalSolution`类，配合PHP的`php://filter`协议实现对日志文件的精准控制。POC首先通过正则匹配获取Laravel日志文件的绝对路径，随后利用PHP伪协议清空日志。关键步骤在于将精心构造的Base64编码的Phar反序列化Payload写入日志文件，并利用一系列iconv和quoted-printable编码转换滤镜清除冗余字符，确保日志中仅包含合法的Phar数据。最后，通过`phar://`协议触发反序列化，实现在服务器上的任意代码执行。该POC逻辑清晰，使用了Python标准库如urllib和re，通过dataclass结构化管理攻击向量，具有极高的实战有效性和复现成功率。利用步骤：1. 确认目标开启Debug模式；2. 脚本自动探测日志文件路径；3. 发送Payload至日志；4. 使用php://filter解码Payload；5. 通过phar://包含日志触发反序列化；6. 获取系统控制权。投毒风险分析：经过对提供的Python源代码进行深入审查，未发现明显的恶意混淆或后门植入行为。脚本主要逻辑集中在HTTP POST请求的构造和PHP伪协议的链路组合上。代码中使用了urllib.request进行网络通信，并未调用外部的可执行二进制文件或下载远程脚本。尽管脚本包含清理日志（clear_logs）和写入Payload（put_payload）的敏感操作，但这些均属于漏洞利用的必要环节。然而，在威胁情报防御视角下，仍需注意此类脚本可能被二传手修改，植入诸如反弹Shell至第三方攻击机或收集目标系统敏感元数据的代码。当前代码版本表现为纯粹的渗透测试工具，但在执行环境中应严格限制外联IP，并检查是否包含隐藏的base64嵌套执行块。总体而言，该POC代码透明度高，投毒风险处于低位，但在实际防御研究中应在沙箱环境下运行，防止POC在执行过程中向未授权的第三方服务器上报成功利用的元数据。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
