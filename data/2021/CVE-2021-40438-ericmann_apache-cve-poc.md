## CVE-2021-40438 - Apache HTTP Server SSRF

**漏洞编号:** CVE-2021-40438

**漏洞类型:** SSRF

**影响应用:** Apache HTTP Server

**危害等级:** High

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N

**影响版本:** 2.4.48 and earlier

**利用条件:** No authentication required, network access

**POC 可用性:** 9/10

**POC 类型:** Complete exploit

**攻击复杂度:** Low

**投毒风险:** 15%

## 详情

CVE-2021-40438是Apache HTTP Server中的一个服务器端请求伪造（SSRF）漏洞，影响2.4.48及更早版本。通过精心构造的请求URI路径，攻击者可以使mod_proxy模块将请求转发到由远程用户选择的源服务器，从而可能暴露内部服务或执行未经授权的操作。

POC有效性分析：提供的POC代码包含一个docker-compose.yml文件，用于搭建包含易受攻击的Apache HTTP Server 2.4.48和PHP服务器的环境。Dockerfile用于构建apache服务器，其中的httpd.conf和vhost.conf文件配置了存在漏洞的代理设置。PHP服务器提供了一个简单的phpinfo()页面，作为验证SSRF漏洞是否成功的依据。通过向易受攻击的Apache服务器发送特定的请求，可以触发mod_proxy模块将请求转发到PHP服务器，从而在Apache服务器的响应中显示PHP信息。

利用步骤：
1. 使用docker-compose构建并启动环境。
2. 构造包含恶意URI路径的HTTP请求，该路径指示mod_proxy将请求转发到攻击者控制的服务器。
3. 将构造的请求发送到易受攻击的Apache服务器。
4. 验证Apache服务器是否已将请求转发到攻击者控制的服务器，例如，检查攻击者服务器的访问日志或查看Apache服务器的响应。
5. 如果成功转发，攻击者可以利用此SSRF漏洞访问内部服务、读取敏感数据或执行其他恶意操作。

投毒风险分析：该POC的投毒风险较低。它主要包含用于搭建和利用漏洞的配置文件和脚本，没有发现明显的恶意代码或行为。php/server.php 只是一个简单的phpinfo() 页面，并不会带来安全风险。 docker-compose.yml， Dockerfile，apache/httpd.conf等也都是标准配置。但如果攻击者修改docker镜像或配置文件，例如，在PHP服务器中植入后门，则可能会增加投毒风险。因此，在使用此POC时，务必仔细检查代码和配置，确保其安全性。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2021-40438
