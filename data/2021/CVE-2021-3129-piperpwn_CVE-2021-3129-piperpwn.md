## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式且安装了Ignition组件

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞的核心在于Laravel默认的错误处理组件Ignition（版本小于2.5.2）中存在不安全的文件操作。由于Ignition在开启Debug模式时，允许通过HTTP接口接收攻击者可控的参数并传递给file_get_contents()和file_put_contents()。攻击者可以利用php://filter伪协议对日志文件进行清理和格式化，通过多次写入将恶意Phar文件的Base64编码内容注入到Laravel的日志文件（storage/logs/laravel.log）中。随后，利用phar://伪协议触发反序列化漏洞，结合PHP通用链（如Laravel/RCE系列或Monolog/RCE系列）执行系统命令。该POC代码逻辑清晰，预置了多种phpggc生成的Gadget Chains（Laravel/RCE1-7及Monolog/RCE1-4），涵盖了绝大多数受影响环境。其利用逻辑包含：1. 探测目标环境；2. 清理当前日志文件；3. 通过十六进制编码将Payload分次写入日志；4. 解码并触发Phar反序列化。该POC具有极高的实战价值和成功率，是评估防御能力的重要参考。利用步骤：首先确保目标处于Debug模式；其次调用/index.php/_ignition/execute-solution接口，利用MakeViewVariableOptionalSolution类触发文件写操作；通过多次调用将精心构造的Phar数据写入日志；最后利用phar://协议读取日志文件触发反序列化执行代码。投毒风险分析：该POC代码整体结构相对规范，主要依赖Python标准库requests进行HTTP交互，代码逻辑透明度较高。在代码片段中，虽然使用了复杂的字符串转换（如hex(ord(i))构成的十六进制注入流），但这属于此漏洞利用的必要技术手段，用于规避日志文件中的非打印字符干扰，而非恶意的代码混淆。代码中出现的'system(id)'等指令属于典型的合法的安全验证载荷，旨在证明RCE能力而非实施真实的破坏。尽管如此，此类POC在传播过程中仍存在一定的被修改风险，例如被他人嵌入恶意的外部Shell请求。当前分析的脚本并未发现隐藏的远程下载、敏感信息外传或对本地主机的越权操作。然而，脚本中定义的proxy选项指向127.0.0.1:8080，提示用户该脚本在使用时可能默认经过代理，用户需自查代理环境的安全性。总体而言，该代码属于高质量的安全研究工具，投毒风险较低，但在执行前仍建议在隔离的沙箱环境中使用。

**项目地址:** [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits) (参考来源)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
