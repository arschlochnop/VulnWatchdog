## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** Laravel < 8.4.2, Ignition < 2.5.2

**利用条件:** Laravel框架开启Debug模式（APP_DEBUG=true），且使用了特定版本的Ignition报错页面组件。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于Laravel框架默认使用的Ignition报错组件中。当开启Debug模式时，Ignition暴露了接口允许用户提交特定的‘solution’以修复错误。漏洞的核心在于Ignition对file_get_contents()和file_put_contents()的处理不当。提供的POC代码显示了针对此漏洞的高度工程化实现，它集成了大量的phpggc利用链（如laravel/rce1到rce22以及monolog/rce系列）。POC通过构造复杂的反序列化Payload，利用Phar协议触发反序列化。其有效性极高，因为它自动处理了Log文件的清理和Payload的注入，能够绕过多种环境限制。该脚本还引用了cloudscraper库，这表明它考虑到了绕过Cloudflare等WAF的可能性。利用步骤：1. 确认目标环境开启Debug模式。2. 向_ignition/execute-solution接口发送POST请求。3. 利用php://filter清空Laravel日志文件。4. 将经过Base64编码的Phar Payload写入日志。5. 使用Phar协议读取日志文件触发反序列化执行系统命令。投毒风险分析：该POC代码逻辑清晰，主要使用了标准的Python库如requests、argparse等，虽然包含了复杂的利用逻辑和大量的利用链字符串，但其行为主要集中在漏洞探测和利用上。代码中未发现明显的恶意二阶段载荷（如自动反弹Shell到攻击者控制的私有服务器）或系统敏感文件窃取行为。然而，投毒风险评估为15%的原因在于其引用了cloudscraper等第三方库，且由于脚本中包含了大量的二进制Payload字符串，防御者在分析时需小心脚本是否在利用成功后静默下载并运行其他恶意软件。此外，POC中存在对环境的大量探测行为，虽然属于漏洞利用范畴，但依然具有一定的侵略性。整体来看，该POC是一个高质量的研究工具，其风险主要来源于其强大的攻击性而非代码投毒。

**项目地址:** [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
