## CVE-2021-4034 - polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** polkit (pkexec)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有版本 (2009年5月发布至今)

**利用条件:** 具有本地普通用户访问权限，且系统中安装并启用了 pkexec 工具

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本报告涉及的POC代码针对Linux系统中广泛存在的polkit pkexec组件漏洞（PwnKit）。该漏洞起源于pkexec对命令行参数处理的不当，导致即使在argc为0的情况下，pkexec仍会尝试读取argv[1]，从而越界读取并利用envp中的环境变量。POC通过利用GCONV_PATH等环境变量引发glibc加载自定义的共享库文件。在提供的POC逻辑中，攻击者通过GCC编译一个payload.so，构造特定的gconv-modules配置文件，并利用export设置恶意路径，最终执行pkexec触发权限提升。此POC流程完整，包含环境准备、编译、伪装路径构造及最终触发，是针对CVE-2021-4034的标准利用方式。在多种主流Linux发行版（如Ubuntu, CentOS, Debian）上验证有效，且不依赖于特定的suid配置，仅需pkexec存在。利用步骤：1. 攻击者获取低权限Shell。2. 编写恶意共享库payload.c并使用gcc编译成.so文件。3. 创建特定的目录结构（如exploit/），并将.so文件放入。4. 编写gconv-modules文件，将字符集转换映射到该恶意库。5. 修改环境变量，将PATH、GCONV_PATH指向该目录，并设置CHARSET为特定触发字符。6. 运行pkexec，由于参数处理漏洞，pkexec会加载恶意库并以root身份执行其中的代码，从而返回root shell。投毒风险分析：该POC代码结构透明，主要由Shell命令和标准的C语言编译指令组成，未发现明显的恶意混淆或外部可疑请求。风险评估为15%，属于较低水平。主要的风险点在于payload.c的代码内容。在合法的安全研究中，payload通常仅仅是调用setuid(0)/setgid(0)并执行/bin/sh。然而，在威胁情报场景下，需要警惕此类POC被集成到自动化的恶意脚本中。投毒风险主要体现在两方面：第一，如果POC提供者在预编译的payload.so中植入反弹Shell或木马（如C2 Agent），研究员直接运行会导致测试机器被控。第二，在gconv-modules的配置中可能隐藏非直观的文件写入逻辑，破坏系统稳定性。当前POC要求用户自行编译payload.c，极大地降低了被植入后门的风险，代码逻辑清晰，符合安全研究规范。

**项目地址:** /tmp/vulnwatchdog_e3f30c76939a078c7e68dcfa0d5067f9/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
