## CVE-2021-4034 - polkit (PolicyKit) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** polkit (PolicyKit)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有版本的 polkit (从 2009 年至 2022 年 1 月)

**利用条件:** 攻击者必须具有目标 Linux 系统的本地低权限用户访问权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC项目名为 'PwnKit Exploit'，针对 Linux 核心组件 polkit 的 pkexec 工具中存在的参数解析逻辑错误进行利用。该漏洞（被称为 PwnKit）源于 pkexec 在处理命令行参数时未对 argc 进行充分验证，当 argc 为 0 时，程序会越界读取环境变量并将受控路径写入内存，最终通过注入恶意的共享库（Shared Object）并利用环境变量重新定向加载路径来实现 root 权限执行。提供的 POC 结构完整，包含 Python 主程序 `zaara_pwnkit.py` 和辅助 C 代码 `phazto_helper.c`。代码逻辑符合公开的 PwnKit 利用向量：即通过 `execve()` 传递空参数列表并在环境变量中注入精心构造的 GCONV_PATH。该 POC 增加了‘隐身模式’和‘漏洞检测’功能，增强了其实战化能力。根据代码结构分析，该脚本具备在 Ubuntu、CentOS、Debian 等主流发行版上直接运行并获取 root shell 的能力，其有效性极高，属于成熟的利用代码。利用步骤通常涉及：1. 将 POC 上传至目标服务器；2. 编译辅助 C 组件或直接运行 Python 脚本；3. 脚本触发 pkexec 越界读取并执行恶意库；4. 成功获取 root 交互式 shell。由于 pkexec 通常默认安装在大多数主流 Linux 桌面和服务器版本中，该漏洞的危害面极大且极其稳定。\n\n【投毒风险分析】该 POC 的投毒风险被评估为较低（15%），但仍需警惕。通过静态代码审查，该项目由自称为 'ZAARA' 的个人或其团队 'Team-Phazto' 发布，代码中虽然使用了较为煽动性的黑客用语（如 'THINK SMART. HACK SAFE.'），但核心利用逻辑清晰且符合已知的安全研究规范。主要的风险点在于：首先，POC 依赖于外部 C 辅助文件 `phazto_helper.c`，在实际运行中会涉及本地编译行为，这种中间环节容易被插入额外的恶意指令（如反弹 shell 或凭据窃取代码）。其次，脚本中提到的‘Stealth Mode’（隐身模式）虽然宣称是减少足迹，但在闭源或高度混淆的环境下，这种功能常被攻击者用来隐藏其恶意持久化行为。然而，目前观察到的代码片段显示其主要使用了 Python 标准库，并未发现明显的 base64 混淆、外部非法域名连接或针对开发环境的恶意文件篡改行为。其 README 文档中详尽的缓解措施建议（如移除 SUID 位）也符合防御性研究的初衷。尽管如此，从非官方受信源下载此类高危 Exploit 脚本时，安全从业人员应始终在隔离沙箱内进行审计和运行，防止其在利用漏洞的同时向后台发送本地敏感信息或建立未授权的后门连接。

**项目地址:** [https://github.com/zaaraZiof0/pwnkit-exploit-CVE](https://www.google.com/search?q=https://github.com/zaaraZiof0/pwnkit-exploit-CVE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
