## CVE-2021-3156 - Sudo 堆缓冲区溢出 (Heap-based Buffer Overflow)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出 (Heap-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.8.2 至 1.8.31p2; 1.9.0 至 1.9.5p1

**利用条件:** 本地用户访问权限，无需在sudoers文件中

**POC 可用性:** 4/10

**POC 类型:** 概念验证/仅说明

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：本分析针对提供的Python项目代码进行。该项目并非直接利用（Exploit）代码，而是一个侧重于防御性检测和教育的实验室工具集。其中，detector/sudo_version_check.py 模块通过解析系统sudo命令的输出版本号，对比内置的受影响版本列表（1.8.2至1.9.5）来判断是否存在风险。analyzer/privilege_risk_analyzer.py 仅用于验证当前进程的UID/EUID状态，以说明提权的前置环境。由于该项目不包含触发堆溢出的payload（如利用反斜杠转义字符在shell模式下注入），因此无法直接用于获取Root权限，其POC性质属于静态版本检测和环境评估。利用步骤：1. 本地用户执行检测脚本以确定Sudo版本是否处于1.8.2-1.9.5p1范围内。2. 在真实攻击场景中，攻击者会利用sudoedit或sudo -s/-i配合精心构造的argv参数（以反斜杠结尾导致溢出）。3. 覆盖堆内存中的关键结构以劫持程序流。4. 成功执行后可绕过密码验证直接获取root Shell。投毒风险分析：该代码库的投毒风险极低（约5%）。通过对提供的Python源码审查，项目使用了标准的os、subprocess和re库，没有发现外部网络连接（C2回连）、代码混淆、base64加密载荷或eval执行敏感字符串的行为。README明确标注为教育用途，主要功能是版本检测和提供加固指南（mitigation_guide.py）。其主要风险点在于如果该项目在不受信任的第三方渠道传播，攻击者可能会通过在检测脚本中注入隐蔽的后门代码（如在subprocess.check_output中添加恶意命令）来诱导防御者运行。但就目前代码片段而言，代码逻辑透明，完全属于辅助工具性质，未发现恶意投毒迹象。

**项目地址:** [https://github.com/VilmarTuminskii/cve-2021-3156-sudo-lab](https://github.com/VilmarTuminskii/cve-2021-3156-sudo-lab)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
