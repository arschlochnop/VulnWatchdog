# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

# CVE-2021-21300

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æ˜¯å¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¼€å¯äº†ç¬¦å·é“¾æŽ¥æ”¯æŒï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filter (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300æ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“ç‰ˆæœ¬åŒ…æ‹¬2.14.2åˆ°2.30.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æ¼æ´žæºäºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterå’Œç¬¦å·é“¾æŽ¥æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œæ¶æ„ä»“åº“å¯ä»¥åˆ©ç”¨ç¬¦å·é“¾æŽ¥å’Œç²¾å¿ƒæž„é€ çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥POCåŒ…å«ä¸€ä¸ª`.git/hooks/post-checkout`è„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåœ¨`git checkout`æ“ä½œä¹‹åŽè¢«æ‰§è¡Œã€‚å½“å—å®³è€…å…‹éš†åŒ…å«è¯¥è„šæœ¬çš„æ¶æ„ä»“åº“ï¼Œå¹¶æ‰§è¡Œ`git checkout`æ“ä½œæ—¶ï¼Œè¯¥è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ `echo PWNED >&2` è¿™æ®µä»£ç ä¼šå°†â€œPWNEDâ€è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„POCä»£ç æœ¬èº«å¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚å®ƒä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žè€Œå­˜åœ¨ï¼Œå…¶ç›®çš„æ˜¯åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ¤å…¥åŽé—¨ï¼Œå½±å“å…¶ä»–å¼€å‘è€…æˆ–è€…æž„å»ºç³»ç»Ÿã€‚å› æ­¤ï¼Œä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„`.git/hooks/post-checkout`è„šæœ¬ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨äº†clean/smudge filterçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«è®¾è®¡ä¸ºåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿç‰¹æ€§ã€‚
3.  æ”»å‡»è€…è¯±å¯¼å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“å—å®³è€…æ‰§è¡Œ`git checkout`æˆ–å…¶ä»–è§¦å‘`post-checkout` hookçš„æ“ä½œæ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**æ¥æº**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+ æˆ– APFS)ï¼Œå¹¶ä¸”é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚ Git LFS)ã€‚ å—å®³è€…éœ€è¦å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git ä¸­ï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹å‡ ä¸ªå…³é”®å› ç´ ï¼š

1.  **å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ NTFS, HFS+ æˆ– APFS ç­‰æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚
2.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽé…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚è¿™äº›è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºå’Œæäº¤æ–‡ä»¶æ—¶è‡ªåŠ¨è½¬æ¢æ–‡ä»¶å†…å®¹ã€‚
3.  **æ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
2.  æ”»å‡»è€…åœ¨ `.gitattributes` æ–‡ä»¶ä¸­é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
4.  å½“ Git å°è¯•æ£€å‡ºä»“åº“ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
5.  ç”±äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½ä¼šæŒ‡å‘æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´è¯¥è„šæœ¬è¢«æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `A/a` å’Œ `A/b`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¯èƒ½æ˜¯å ä½ç¬¦ï¼Œæˆ–è€…ç”¨äºŽè§¦å‘ clean/smudge è¿‡æ»¤å™¨ã€‚
*   `A/post-checkout`ï¼šè¿™æ˜¯ä¸€ä¸ª Git hook è„šæœ¬ï¼Œä¼šåœ¨ `git checkout` å‘½ä»¤ä¹‹åŽæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žæ¼æ´žå·²è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CVE-2021-21300 æ¼æ´žåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šè¿‡é…ç½® `post-checkout` é’©å­ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å®³è€…å…‹éš†ä»“åº“åŽç«‹å³æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åœ¨è¿™ä¸ªç‰¹å®šçš„ POC ä»£ç ä¸­ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º "PWNED"ï¼Œç”¨äºŽéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 0%ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯æ®è¡¨æ˜Žä½œè€…è¯•å›¾é€šè¿‡éšè—æ¶æ„ä»£ç æ¥è¿›ä¸€æ­¥å±å®³å—å®³è€…ã€‚

**é¡¹ç›®åœ°å€:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**æ¥æº**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿè¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+ or APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æœŸé—´æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ åŒ…å«ç¬¦å·é“¾æŽ¥å’Œä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚Git LFSï¼‰çš„æ¶æ„ä»“åº“æ¥å®žçŽ°ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼Œä¼šå¯¼è‡´åœ¨æ£€å‡ºåŽæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª `post-checkout` é’©å­è„šæœ¬ï¼Œå½“ä»“åº“è¢«æ£€å‡ºåŽä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¯¥è„šæœ¬ç®€å•åœ°è¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¡¨æ˜Žä»£ç æ‰§è¡Œå·²æˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š** POCä»£ç æœ¬èº«å¹¶ä¸åŒ…å«éšè—çš„æŠ•æ¯’ä»£ç ã€‚ `post-checkout` è„šæœ¬çš„ç›®çš„éžå¸¸æ˜Žæ˜¾ï¼Œå³éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚ ç”±äºŽæ ·æœ¬å¾ˆå°ä¸”ç›´æŽ¥ï¼Œå› æ­¤å…¶ä¸­åµŒå…¥éšè—çš„ã€æ¶æ„åŠŸèƒ½çš„å¯èƒ½æ€§å¾ˆä½Žã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­è„šæœ¬çš„Gitä»“åº“ã€‚
2.  ä»“åº“ä¸­åŒ…å«ç¬¦å·é“¾æŽ¥ä»¥åŠé…ç½®äº† clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨Git LFSè·Ÿè¸ªçš„å¤§æ–‡ä»¶ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
4.  å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šè‡ªåŠ¨æ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**æ¥æº**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽ Git ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ Git å®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶ï¼ˆå¦‚ Git LFSï¼‰çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚`exploit.sh` è„šæœ¬åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ `delayed-checkout`ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°† `post-checkout` è¿‡æ»¤å™¨åº”ç”¨äºŽç›®å½• `A`ã€‚è„šæœ¬éšåŽåœ¨ `A/post-checkout` ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼Œå½“æ£€å‡º `A` ç›®å½•æ—¶ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ `a`ï¼ŒæŒ‡å‘ `.git/hooks`ï¼Œå¹¶å°† `a` æ·»åŠ åˆ°ç‰ˆæœ¬æŽ§åˆ¶ä¸­ã€‚å½“åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†æ­¤ä»“åº“æ—¶ï¼ŒGit å¯èƒ½ä¼šé”™è¯¯åœ°æ‰§è¡Œä½äºŽ `.git/hooks` ç›®å½•ä¸­çš„æ¶æ„ `post-checkout` è„šæœ¬ã€‚

æ ¹æ®æ¼æ´žæè¿°ä»¥åŠPOCçš„è¡Œä¸ºï¼Œå¯ä»¥åˆ¤å®šPOCçš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

POC ä»£ç æœ¬èº«ä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œæ—¨åœ¨æ¼”ç¤ºæ¼æ´žè§¦å‘å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬ä»…ä»…æ‰§è¡Œ `echo PWNED >&2`ã€‚å› æ­¤ï¼Œæ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•gitä»“åº“éƒ½æœ‰æŠ•æ¯’çš„å¯èƒ½ï¼Œå¦‚ä½œè€…å¯ä»¥ä¿®æ”¹gité…ç½®é¡¹ï¼Œè®©ç”¨æˆ·æ¯æ¬¡æäº¤éƒ½è§¦å‘æ¶æ„ä»£ç æ‰§è¡Œç­‰ã€‚

åŸºäºŽä»£ç åˆ†æžï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†æ— æ³•å®Œå…¨æŽ’é™¤ï¼Œå‡è®¾å­˜åœ¨ä¸€äº›éšè”½æ€§æžé«˜çš„æŠ•æ¯’æ‰‹æ³•ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½Žçš„æ¦‚çŽ‡ä¼°è®¡ï¼Œæ¯”å¦‚10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª `.gitattributes` æ–‡ä»¶ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰å’Œä¸€ä¸ª `post-checkout` é’©å­ã€‚
    *   ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚
    *   ä¸€ä¸ª `post-checkout` è„šæœ¬ï¼ŒåŒ…å«æ”»å‡»è€…æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…å°†æ­¤æ¶æ„ä»“åº“æ‰˜ç®¡åœ¨å…¬å…±æˆ–ç§æœ‰ Git æœåŠ¡å™¨ä¸Šã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…å…‹éš†æ­¤æ¶æ„ä»“åº“åˆ°å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windows æˆ– macOSï¼‰ã€‚
4.  å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` é’©å­ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**

*   å‡çº§ Git åˆ°å·²ä¿®å¤ç‰ˆæœ¬ï¼ˆ>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6ï¼‰ã€‚
*   ç¦ç”¨ Git ä¸­çš„ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**æ¥æº**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚Windows, macOSï¼‰ï¼Œå¯ç”¨äº†core.symlinksï¼Œä¸”é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†Gitçš„clean/smudgeè¿‡æ»¤å™¨å’Œç¬¦å·é“¾æŽ¥åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤„ç†æ–¹å¼ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œç‰¹å®šæ–‡ä»¶çš„Gitä»“åº“ã€‚
2.  ä»“åº“é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡Git LFSï¼‰ã€‚
3.  å½“ç”¨æˆ·å…‹éš†æ­¤ä»“åº“æ—¶ï¼Œç¬¦å·é“¾æŽ¥ä¼šè¢«åˆ›å»ºã€‚
4.  åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç²¾å¿ƒæž„é€ çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶åçš„ç»„åˆä¼šå¯¼è‡´Gitæ‰§è¡Œæ¶æ„ä»£ç ã€‚

**POCä»£ç åˆ†æžï¼š**

æä¾›çš„POCä»£ç åŒ…å«ä¸‰ä¸ªæ–‡ä»¶:

*   `A/a`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/b`: æ–‡ä»¶å†…å®¹ä¸ºç©º
*   `A/post-checkout`:  è¿™æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒä¼šåœ¨`git checkout`æ“ä½œ**ä¹‹åŽ**æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå‘`http://dc5325e3774c.ngrok.io`å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™å…è®¸æ”»å‡»è€…è¿½è¸ªå—å®³è€…æ˜¯å¦å…‹éš†äº†ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬æœ¬èº«å³æ˜¯åŽé—¨ï¼Œä¹Ÿèƒ½å¤Ÿä¸‹è½½å…¶ä»–æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…é€šè¿‡`post-checkout` hook æ‰§è¡Œ `curl` å‘½ä»¤æ¥ä¸Žå¤–éƒ¨æœåŠ¡å™¨é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ­¤POCè‡ªèº«ä¸åŒ…å«ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯åˆ©ç”¨äº† Git çš„ç‰¹æ€§æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚`post-checkout` è„šæœ¬ä¸­çš„ `curl` å‘½ä»¤æ˜¯æ”»å‡»è€…æ”¾ç½®çš„åŽé—¨ï¼Œç”¨äºŽæ‰§è¡Œè¿œç¨‹æ“ä½œã€‚å› æ­¤ï¼Œè¿™é‡Œå°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ï¼Œå› ä¸ºè„šæœ¬æœ¬èº«å³ä¸ºæ¶æ„åˆ©ç”¨çš„è½½ä½“,å¹¶éžæ˜¯éšè—çš„æ¶æ„ä»£ç .æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶ `post-checkout` è„šæœ¬çš„å†…å®¹æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

**æ€»ç»“ï¼š**

CVE-2021-21300æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…å…‹éš†æ¶æ„ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ç”¨æˆ·åº”é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ï¼Œå¹¶åŠæ—¶æ›´æ–°Gitåˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œç¦ç”¨`core.symlinks`æˆ–è€…ä¸å…¨å±€é…ç½®clean/smudge filterså¯ä»¥ä½œä¸ºä¸´æ—¶ç¼“è§£æŽªæ–½ã€‚

**é¡¹ç›®åœ°å€:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**æ¥æº**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ (å¦‚ NTFS, HFS+, APFS)ï¼Œå¼€å¯äº†core.symlinksé…ç½®ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filtersï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰clean/smudge filterï¼ˆæ¯”å¦‚Git LFSï¼‰çš„æ–‡ä»¶ï¼Œåœ¨å…‹éš†ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žä¸»è¦å­˜åœ¨äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚ Windows å’Œ macOS é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”»å‡»è€…éœ€è¦æ‰˜ç®¡ä¸€ä¸ªæ¶æ„çš„ Git ä»“åº“ï¼Œå¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚æä¾›çš„POCä»£ç é€šè¿‡åœ¨ `.git/hooks/post-checkout` ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªåä¸º `post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬æ¥å®žçŽ°ã€‚å½“ç”¨æˆ· `clone` æˆ–è€… `checkout` åŒ…å«è¯¥è„šæœ¬çš„ä»“åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚ `post-checkout`è„šæœ¬çš„å†…å®¹æ˜¯æ‰“å° "PWNED" åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¡¨æ˜Žæ”»å‡»æˆåŠŸã€‚ç”±äºŽPOCä»£ç çš„åŠŸèƒ½ç®€å•ï¼Œä»…ç”¨äºŽéªŒè¯æ¼æ´žï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽè¯¥ä»“åº“å¯èƒ½åŒ…å«å…¶ä»–æ¶æ„æ–‡ä»¶æˆ–é…ç½®ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥ä»¥åŠä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶çš„ Git ä»“åº“ã€‚
2.  æ”»å‡»è€…åœ¨ `.git/hooks` ç›®å½•ä¸‹æ”¾ç½®æ¶æ„è„šæœ¬ï¼Œä¾‹å¦‚ `post-checkout`ã€‚
3.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚
4.  å½“ç”¨æˆ·å…‹éš†ä»“åº“åŽï¼ŒGit ä¼šæ‰§è¡Œ `post-checkout` è„šæœ¬ï¼Œä»Žè€Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥è§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
POC ä»£ç æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ‰“å° "PWNED" çš„è„šæœ¬ã€‚ä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½åœ¨ä»“åº“ä¸­éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œæˆ–è€…åˆ©ç”¨ Git LFS æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚å› æ­¤ï¼Œè™½ç„¶ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žå¯¹å¾…æ¥è‡ªæœªçŸ¥æ¥æºçš„ Git ä»“åº“ã€‚ä»“åº“ä½œè€…æœ‰å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ¤å…¥åŽé—¨æˆ–è€…æ¶æ„ä»£ç ï¼Œå› æ­¤ç»¼åˆåˆ¤å®šæŠ•æ¯’å¯èƒ½æ€§ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**æ¥æº**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»ŸæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”æ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ï¼Œå¯ç”¨äº†ç¬¦å·é“¾æŽ¥ï¼Œå¹¶é…ç½®äº†clean/smudge filterï¼ˆå¦‚Git LFSï¼‰ã€‚ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ¼æ´žæ˜¯Gitä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽå½“Gitå®¢æˆ·ç«¯åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨(ä¾‹å¦‚Git LFS)çš„æ¶æ„ä»“åº“æ—¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«ç‰¹åˆ¶çš„ç¬¦å·é“¾æŽ¥å’Œæ–‡ä»¶çš„ä»“åº“ï¼Œå½“ç”¨æˆ·å…‹éš†è¯¥ä»“åº“æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„POCæ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç¼“è§£æŽªæ–½å’Œè¡¥ä¸ç‰ˆæœ¬ã€‚PacketStorm Securityç­‰ç½‘ç«™ä¸Šä¹Ÿæœ‰åˆ©ç”¨ä»£ç çš„ç¤ºä¾‹ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦å±•ç¤ºäº†Gité’©å­çš„ç¤ºä¾‹ï¼Œä¾‹å¦‚`applypatch-msg.sample`ã€`commit-msg.sample`å’Œ`fsmonitor-watchman.sample`ã€‚è¿™äº›æ˜¯æ­£å¸¸çš„GitåŠŸèƒ½ï¼Œç”¨äºŽåœ¨ç‰¹å®šGitæ“ä½œæœŸé—´æ‰§è¡Œè„šæœ¬ã€‚è™½ç„¶è¿™äº›é’©å­æœ¬èº«ä¸æ˜¯æ¶æ„ä»£ç ï¼Œä½†æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›é’©å­æ¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä»“åº“ä¸­åŒ…å«ä¸€ä¸ª`.gitattributes`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é…ç½®äº†ä¸€ä¸ªæ¶æ„çš„clean/smudgeè¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨ä¼šåœ¨æ£€å‡ºæ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚`fsmonitor-watchman.sample`è¿™ä¸ªæ–‡ä»¶ç›‘è§†æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œæ¶æ„ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´ç›‘æŽ§ç³»ç»Ÿè¢«ç ´åï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œ**ä»“åº“æœ¬èº«å­˜åœ¨è¢«æŠ•æ¯’çš„å¯èƒ½ï¼Œæ¦‚çŽ‡çº¦ä¸º10%**ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªGitä»“åº“ï¼Œå…¶ä¸­åŒ…å«ï¼š
    *   ä¸€ä¸ª`.gitattributes`æ–‡ä»¶ï¼Œé…ç½®ä¸€ä¸ªæ¶æ„çš„clean/smudgeè¿‡æ»¤å™¨ã€‚ä¾‹å¦‚ï¼Œå°†æ‰€æœ‰`.txt`æ–‡ä»¶æŒ‡å‘ä¸€ä¸ªæ‰§è¡Œä»»æ„ä»£ç çš„è„šæœ¬ã€‚
    *   ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘è§¦å‘æ¶æ„è¿‡æ»¤å™¨çš„æ–‡ä»¶ã€‚
    *   å¯èƒ½åŒ…å«Git LFSè·Ÿè¸ªçš„æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨å…‹éš†æ—¶è§¦å‘è¿‡æ»¤å™¨ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…é€šè¿‡å„ç§æ‰‹æ®µï¼ˆä¾‹å¦‚ï¼Œç¤¾äº¤å·¥ç¨‹ã€é±¼å‰å¼ç½‘ç»œé’“é±¼ç­‰ï¼‰è¯±éª—å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **æ‰§è¡Œæ¶æ„ä»£ç ï¼š** å½“å—å®³è€…å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šæ ¹æ®`.gitattributes`ä¸­çš„é…ç½®æ‰§è¡Œclean/smudgeè¿‡æ»¤å™¨ã€‚å¦‚æžœè¿‡æ»¤å™¨æŒ‡å‘æ¶æ„è„šæœ¬ï¼Œåˆ™è¯¥è„šæœ¬ä¼šåœ¨å—å®³è€…çš„è®¡ç®—æœºä¸Šæ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

è¦æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
*   ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ã€‚
*   æ–‡ä»¶ç³»ç»Ÿä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚NTFS, HFS+, APFSï¼‰ã€‚
*   å¯ç”¨äº†ç¬¦å·é“¾æŽ¥ï¼ˆé»˜è®¤å¯ç”¨ï¼Œä½†å¯ä»¥é€šè¿‡`git config core.symlinks false`ç¦ç”¨ï¼‰ã€‚
*   é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ã€‚


**é¡¹ç›®åœ°å€:** [Roboterh/CVE-2021-21300](https://github.com/Roboterh/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---



---

## POC #8

**æ¥æº**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.30.1 (å—å½±å“ç‰ˆæœ¬è¯¦è§æ¼æ´žåº“ä¿¡æ¯)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œä¸”ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+ã€APFSï¼‰ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´žä¸»è¦å½±å“ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå¦‚ Windows å’Œ macOSï¼Œå¹¶ä¸”éœ€è¦é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `A/a`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/b`ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ã€‚
* `A/post-checkout`ï¼šä¸€ä¸ª shell è„šæœ¬ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»º `/tmp/pwn` æ–‡ä»¶å¹¶å†™å…¥ "PWN" å­—ç¬¦ä¸²ã€‚

`post-checkout` è„šæœ¬è¢«æ”¾ç½®åœ¨ `.git/hooks` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ `git checkout` å‘½ä»¤æ‰§è¡ŒåŽæ‰§è¡Œã€‚åˆ©ç”¨çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æŽ¥ï¼Œä½¿å¾—åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé’©å­è„šæœ¬èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œç»“åˆ clean/smudge è¿‡æ»¤å™¨é…ç½®ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ POC ä»£ç éžå¸¸ç®€å•ï¼Œé™¤äº†åˆ›å»º `/tmp/pwn` æ–‡ä»¶ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ“ä½œã€‚è¿™æ„å‘³ç€è¯¥ä»£ç æœ¬èº«ä¸å¤ªå¯èƒ½åŒ…å«ä»»ä½•ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ `post-checkout` é’©å­çš„ Git ä»“åº“ã€‚
2.  è¯¥ä»“åº“è¿˜åŒ…å«ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ `A/a` å’Œ `A/b`ï¼Œä»¥åŠå¿…è¦çš„ Git LFS é…ç½®æˆ–å…¶ä»–è§¦å‘ clean/smudge è¿‡æ»¤å™¨çš„é…ç½®ã€‚
3.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“åˆ°ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ–‡ä»¶ç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¸”è¯¥æœºå™¨å·²ç»é…ç½®äº† Git LFS æˆ–å…¶ä»– clean/smudge è¿‡æ»¤å™¨ã€‚
4.  åœ¨å…‹éš†è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§ï¼Œä»¥åŠ clean/smudge è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œ`post-checkout` é’©å­è¢«è§¦å‘æ‰§è¡Œï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  åœ¨è¿™ä¸ª POC ä¾‹å­ä¸­ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœæ˜¯åœ¨ `/tmp/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `pwn` çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º `PWN`ã€‚

**é¡¹ç›®åœ°å€:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**æ¥æº**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git æ¶æ„ä»“åº“è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windows/macOSï¼‰ï¼Œå¯ç”¨ Git LFSï¼Œå¹¶ä¸”å—å®³è€…å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ åŒ…å«æ¶æ„ Git hooks çš„ä»“åº“ï¼Œåœ¨å—å®³è€…å…‹éš†è¯¥ä»“åº“æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»ä¾èµ–äºŽå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠ Git LFS çš„ clean/smudge è¿‡æ»¤å™¨ã€‚æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå¦‚ 'A'ï¼‰ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º 'post-checkout' çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ¶æ„å‘½ä»¤ã€‚ç„¶åŽï¼Œæ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚å½“ Git æ‰§è¡Œ 'A/post-checkout' æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº† '.git/hooks/post-checkout' ä¸­çš„æ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ Git ä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ 'A'ï¼‰ï¼Œä»¥åŠ 'A/post-checkout' æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚
3.  ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½® Git LFS æ¥å¤„ç† 'A/post-checkout' æ–‡ä»¶ã€‚
4.  æ”»å‡»è€…å°†ç›®å½• 'A' æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ '.git/hooks/' çš„ç¬¦å·é“¾æŽ¥ã€‚
5.  æ”»å‡»è€…æäº¤å¹¶å°†æ¶æ„ä»“åº“æŽ¨é€åˆ°ä¸€ä¸ªå…¬å…±æˆ–ç§æœ‰ Git ä»“åº“ã€‚
6.  å—å®³è€…å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
7.  å½“ Git æ‰§è¡Œ post-checkout é’©å­æ—¶ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥å’Œå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°:**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶:

*   `README.md`: æè¿°æ¼æ´žä¿¡æ¯å’Œåˆ©ç”¨æ–¹æ³•ã€‚
*   `A/a`ï¼Œ`A/b`: ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨äºŽè¿·æƒ‘ç”¨æˆ·ï¼Œå¢žåŠ ä»“åº“çš„ä¼ªè£…æ€§ã€‚
*   `A/post-checkout`: åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ `echo PWNED >&2`ï¼Œç”¨äºŽåœ¨å—å®³è€…ç»ˆç«¯è¾“å‡º "PWNED"ã€‚

åœ¨åˆ†æžäº†æä¾›çš„ä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„æ¶æ„ä»£ç ï¼Œè¯¥POCç›®çš„æ˜¯éªŒè¯æ¼æ´žï¼Œè€Œå¹¶éžæŠ•æ¯’ã€‚

**ç»“è®º:**

æä¾›çš„ PoC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨äºŽéªŒè¯ CVE-2021-21300 æ¼æ´žã€‚ ä»£ç æœ¬èº«ä¸åŒ…å«æŠ•æ¯’å†…å®¹ï¼Œä»…ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ã€‚ä½†å¦‚æžœæœ‰äººå‘å¸ƒåŒ…å«æ¶æ„payloadçš„ç±»ä¼¼ä»£ç ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**æ¥æº**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.30.1 (ç‰¹å®šç‰ˆæœ¬)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿ (ä¾‹å¦‚ NTFS, HFS+, APFS)ï¼Œå—å½±å“çš„ Git ç‰ˆæœ¬ï¼Œé…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (å¦‚ Git LFS)ï¼Œç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ª Git æ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

1.  **Case-Insensitive æ–‡ä»¶ç³»ç»Ÿï¼š** ç›®æ ‡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Windows ä¸Šçš„ NTFS æˆ– macOS ä¸Šçš„ HFS+ æˆ– APFSã€‚
2.  **å—å½±å“çš„ Git ç‰ˆæœ¬ï¼š** Git ç‰ˆæœ¬å¿…é¡»åœ¨ 2.14.2 å’Œ 2.30.1 ä¹‹é—´ï¼Œä½†å·²è¢«ä¿®å¤çš„ç‰ˆæœ¬é™¤å¤–ã€‚å…·ä½“å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´è¯·å‚è€ƒæ¼æ´žåº“ä¿¡æ¯ã€‚
3.  **Clean/Smudge è¿‡æ»¤å™¨ï¼š** å¿…é¡»é…ç½® clean/smudge è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ Git LFSã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
4.  **ç”¨æˆ·äº¤äº’ï¼š** ç”¨æˆ·å¿…é¡»å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„æ¶æ„ä»“åº“ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ¶æ„ä»“åº“ï¼š

*   ç¬¦å·é“¾æŽ¥
*   ä½¿ç”¨ clean/smudge è¿‡æ»¤å™¨çš„æ–‡ä»¶

å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGit ä¼šå°è¯•ç­¾å‡ºæ–‡ä»¶ã€‚ç”±äºŽ case-insensitive æ–‡ä»¶ç³»ç»Ÿå’Œ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œç¬¦å·é“¾æŽ¥å¯èƒ½æŒ‡å‘ä»“åº“ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæˆ–è€… clean/smudge è¿‡æ»¤å™¨å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç  `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¼æ´žåˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ¼æ´žæè¿°ä¸­æåˆ°çš„ï¼Œæ”»å‡»çš„å…³é”®åœ¨äºŽç²¾å¿ƒæž„é€ çš„ä»“åº“å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·é“¾æŽ¥å’Œå¸¦æœ‰æ¶æ„é…ç½®çš„ `.gitattributes` æ–‡ä»¶ç­‰ï¼Œå› æ­¤ï¼Œä»…å‡­è¿™ä¸ª README æ–‡ä»¶æ— æ³•åˆ¤æ–­æ¼æ´žæ˜¯å¦èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ã€‚éœ€è¦åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ç»™å®šçš„ `README.md` æ–‡ä»¶å†…å®¹éžå¸¸ç®€å•ï¼ŒåªåŒ…å« CVE ç¼–å·ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä»…å‡­å•ä¸ªæ–‡ä»¶å°±å®Œå…¨æŽ’é™¤æŠ•æ¯’é£Žé™©ã€‚æ•´ä¸ªä»“åº“éƒ½å¯èƒ½åŒ…å«éšè—çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨ `.gitattributes` ä¸­é…ç½®çš„ clean/smudge è¿‡æ»¤å™¨ä¸­ã€‚æ›´å¤æ‚çš„æŠ•æ¯’æ‰‹æ®µå¯èƒ½ä¼šæ¶‰åŠæ›´éšè”½çš„ä»£ç æ³¨å…¥ï¼Œä¾‹å¦‚åœ¨çœ‹ä¼¼æ— å®³çš„æ–‡ä»¶ä¸­åµŒå…¥ Payload æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´žæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå½»åº•åˆ†æžæ•´ä¸ªä»“åº“çš„å†…å®¹æ‰èƒ½æ›´å‡†ç¡®åœ°è¯„ä¼°æŠ•æ¯’é£Žé™©ã€‚

**æœç´¢å¼•æ“Žç»“æžœåˆ†æžï¼š**

æœç´¢ç»“æžœè¡¨æ˜Ž CVE-2021-21300 å½±å“ Git å®¢æˆ·ç«¯åœ¨ case-insensitive æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ“ä½œï¼Œå¹¶å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚Git for Windows é»˜è®¤é…ç½® Git LFSï¼Œå› æ­¤æ›´å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿæ‰˜ç®¡æ¶æ„ä»“åº“å¹¶è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥ä»“åº“ã€‚ç›¸å…³é“¾æŽ¥æä¾›æ›´å¤šæ¼æ´žä¿¡æ¯ã€ä¿®å¤æ–¹æ¡ˆå’Œè®¨è®ºã€‚

**é¡¹ç›®åœ°å€:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**æ¥æº**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ˆå¦‚NTFS, HFS+æˆ–APFSï¼‰ï¼ŒåŒæ—¶é…ç½®äº†clean/smudge filters (ä¾‹å¦‚ Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ˜¯ä¸€ä¸ªGitçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå‡ºçŽ°åœ¨å½“å…‹éš†åŒ…å«ç¬¦å·é“¾æŽ¥çš„æ¶æ„ä»“åº“æ—¶ï¼Œå¹¶ä¸”è¯¥ä»“åº“ä½¿ç”¨äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆæ¯”å¦‚ Git LFSï¼‰ã€‚åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆå¦‚Windowså’ŒmacOSçš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æ£€å‡ºæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç¬¦å·é“¾æŽ¥ï¼ˆ`ln -s .git/hooks a`ï¼‰å’Œ `post-checkout` hook çš„æ¶æ„ä»“åº“ã€‚å½“è¿™ä¸ªä»“åº“è¢«å…‹éš†åˆ°å¯ç”¨äº†ç¬¦å·é“¾æŽ¥å’Œ clean/smudge è¿‡æ»¤å™¨çš„ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æ—¶å€™ï¼Œ`post-checkout` è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥POCä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡º"PWNED"æ¥è¡¨ç¤ºæ¼æ´žåˆ©ç”¨æˆåŠŸã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©ä¼°è®¡ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Gitä»“åº“ã€‚
2.  ä»“åº“åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ª hook è„šæœ¬(å¦‚ post-checkout)ã€‚
3.  ä»“åº“é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ (ä¾‹å¦‚é€šè¿‡ `.gitattributes` æ–‡ä»¶å¯ç”¨Git LFS)ã€‚
4.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
5.  å½“ç”¨æˆ·å…‹éš†ä»“åº“æ—¶ï¼ŒGitä¼šåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºç¬¦å·é“¾æŽ¥ã€‚
6.  ç”±äºŽ clean/smudge è¿‡æ»¤å™¨çš„å­˜åœ¨ï¼Œä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œhook è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ­¤æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å†™ä¸æ•æ„Ÿæ€§å’Œclean/smudge è¿‡æ»¤å™¨çš„å¯ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**æ¥æº**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€ä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsçš„NTFSï¼‰ä¸”å®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„Gitï¼Œå¹¶é…ç½®äº†clean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼ŒGit for Windowsé»˜è®¤é…ç½®Git LFSï¼‰ï¼Œç”¨æˆ·éœ€è¦cloneæ¶æ„ä»“åº“

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå­˜åœ¨äºŽ Git å¤šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”±äºŽå¯¹ç¬¦å·é“¾æŽ¥å¤„ç†ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤§å°å†™æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥çš„ Git ä»“åº“ã€‚å½“ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šå…‹éš†è¯¥ä»“åº“æ—¶ï¼Œè¯¥ç¬¦å·é“¾æŽ¥å¯èƒ½è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹çš„æ¶æ„è„šæœ¬ï¼Œå¯¼è‡´åœ¨ clone è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽ clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ä»“åº“ï¼Œå½“åœ¨ Windows ç³»ç»Ÿä¸Š clone è¯¥ä»“åº“æ—¶ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žï¼Œä½†å…¶ä¸­å­˜åœ¨å°‘é‡æŠ•æ¯’é£Žé™©ã€‚`hack.sh`è„šæœ¬è™½ç„¶å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ”»å‡»åœºæ™¯ï¼Œä½†æ”»å‡»è€…å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å…·ç ´åæ€§çš„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚å› æ­¤ï¼Œå…‹éš†æ­¤ä»“åº“å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œå¤§çº¦ä¸º10%ã€‚è¿™ä¸ªä¼°è®¡æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªäº‹å®žï¼Œå³POCçš„é‡ç‚¹æ˜¯æ¼æ´žæ¼”ç¤ºï¼Œè€Œéžå®Œå…¨éšè”½çš„æ¶æ„ä»£ç ã€‚æ›´å¤æ‚çš„åˆ©ç”¨å¯èƒ½ä¼šæœ‰æ›´é«˜çš„æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„ç¬¦å·é“¾æŽ¥å’Œ post-checkout è„šæœ¬çš„ Git ä»“åº“ã€‚
2.  ä»“åº“çš„ .gitattributes æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼ˆå¦‚ Git LFSï¼‰ã€‚
3.  ç”¨æˆ·åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå…‹éš†è¯¥ä»“åº“ã€‚
4.  åœ¨ clone è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¬¦å·é“¾æŽ¥è¢«è§£æžåˆ° .git/hooks ç›®å½•ä¸‹ï¼Œpost-checkout è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚
5. å¯ä»¥é€šè¿‡ä¿®æ”¹post-checkoutæ–‡ä»¶å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶å—å®³è€…æœºå™¨ã€‚

**é¡¹ç›®åœ°å€:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**æ¥æº**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 2.14.2 <= Gitç‰ˆæœ¬ < 2.17.6, 2.18.0 <= Gitç‰ˆæœ¬ < 2.18.5, 2.19.0 <= Gitç‰ˆæœ¬ < 2.19.6, 2.20.0 <= Gitç‰ˆæœ¬ < 2.20.5, 2.21.0 <= Gitç‰ˆæœ¬ < 2.21.4, 2.22.0 <= Gitç‰ˆæœ¬ < 2.22.5, 2.23.0 <= Gitç‰ˆæœ¬ < 2.23.4, 2.24.0 <= Gitç‰ˆæœ¬ < 2.24.4, 2.25.0 <= Gitç‰ˆæœ¬ < 2.25.5, 2.26.0 <= Gitç‰ˆæœ¬ < 2.26.3, 2.27.0 <= Gitç‰ˆæœ¬ < 2.27.1, 2.28.0 <= Gitç‰ˆæœ¬ < 2.28.1, 2.29.0 <= Gitç‰ˆæœ¬ < 2.29.3, 2.30.0 <= Gitç‰ˆæœ¬ < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™(å¦‚NTFS, HFS+)ï¼Œå¹¶ä¸”é…ç½®äº†clean/smudge filterï¼ˆä¾‹å¦‚Git LFSï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-21300 æ¼æ´žå…è®¸æ¶æ„ Git ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„ Git ä»“åº“ã€‚
2.  **åˆ©ç”¨ç¬¦å·é“¾æŽ¥ï¼š** ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼ˆsymbolic linkï¼‰ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ä¸‹çš„ä¸€ä¸ªé’©å­è„šæœ¬ï¼ˆä¾‹å¦‚ `post-checkout`ï¼‰ã€‚
3.  **clean/smudge filterï¼š** ä»“åº“çš„ `.gitattributes` æ–‡ä»¶é…ç½®äº† clean/smudge è¿‡æ»¤å™¨ï¼Œå¦‚ Git LFSã€‚
4.  **è§¦å‘æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†æ¶æ„ä»“åº“ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ˆå¦‚Windowsçš„NTFSï¼‰ï¼ŒGit ä¼šå°è¯•æ›´æ–°å·¥ä½œç›®å½•ã€‚ç”±äºŽç¬¦å·é“¾æŽ¥çš„å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼ŒGit ä¼šé”™è¯¯åœ°å°†ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„é’©å­è„šæœ¬ï¼ˆå¦‚ `A/post-checkout`ï¼‰å¤åˆ¶åˆ° `.git/hooks/post-checkout`ï¼Œä»Žè€Œå¯¼è‡´è¯¥è„šæœ¬åœ¨åŽç»­çš„ `git checkout` æ“ä½œæ—¶è¢«æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç  `build_bad_repo.sh` å°è¯•åˆ©ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºæ¶æ„ä»“åº“ã€‚å®ƒé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œç„¶åŽåˆ›å»º `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® `filter=lfs`ã€‚æŽ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `A/post-checkout` çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«æ¶æ„ä»£ç ã€‚ç„¶åŽï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `a` çš„ç¬¦å·é“¾æŽ¥ï¼ŒæŒ‡å‘ `.git/hooks` ç›®å½•ã€‚æœ€åŽï¼Œå°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° Git ä»“åº“å¹¶æäº¤ã€‚å½“ç”¨æˆ·å…‹éš†æ­¤æ¶æ„ä»“åº“å¹¶åœ¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿä¸Šæ£€å‡ºæ—¶ï¼Œ`A/post-checkout` ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€ŒéªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  æä¾›çš„ POC ä»£ç æœ¬èº«å³ä¸ºæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘ RCE çš„æ¶æ„ä»“åº“ã€‚å…¶ä¸­ `A/post-checkout` è„šæœ¬çš„å†…å®¹ `echo HACKed(unauthorized_command) >&2` ä»…ç”¨äºŽæ¼”ç¤ºç›®çš„ï¼Œè¡¨æ˜Žä»£ç å·²è¢«æ‰§è¡Œã€‚è„šæœ¬æœ¬èº«çš„è¡Œä¸ºåªæ˜¯è¾“å‡ºä¸€æ®µæ–‡å­—ï¼Œæ²¡æœ‰éšè—å…¶ä»–æ¶æ„ä»£ç ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºä¸å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚Poison ä¸º0%.

**ç¼“è§£æŽªæ–½ï¼š**

*   å‡çº§ Git ç‰ˆæœ¬åˆ°ä¿®å¤ç‰ˆæœ¬ã€‚
*   ç¦ç”¨ç¬¦å·é“¾æŽ¥æ”¯æŒ (`git config --global core.symlinks false`)ã€‚
*   é¿å…å…‹éš†æ¥è‡ªä¸å—ä¿¡ä»»æ¥æºçš„ä»“åº“ã€‚

**é¡¹ç›®åœ°å€:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**æ¥æº**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-21300

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Git

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæƒé™èŽ·å–

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š>= 2.14.2, < 2.17.6ï¼Œ>= 2.18.0, < 2.18.5ï¼Œ>= 2.19.0, < 2.19.6ï¼Œ>= 2.20.0, < 2.20.5ï¼Œ>= 2.21.0, < 2.21.4ï¼Œ>= 2.22.0, < 2.22.5ï¼Œ>= 2.23.0, < 2.23.4ï¼Œ>= 2.24.0, < 2.24.4ï¼Œ>= 2.25.0, < 2.25.5ï¼Œ>= 2.26.0, < 2.26.3ï¼Œ>= 2.27.0, < 2.27.1ï¼Œ>= 2.28.0, < 2.28.1ï¼Œ>= 2.29.0, < 2.29.3ï¼Œ>= 2.30.0, < 2.30.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿéœ€è¦ä½¿ç”¨å—å½±å“çš„Gitç‰ˆæœ¬ï¼Œå¹¶ä¸”å…‹éš†åŒ…å«æ¶æ„é…ç½®çš„ä»“åº“ã€‚éœ€è¦å¼€å¯core.symlinks (é»˜è®¤å¼€å¯), éœ€è¦é…ç½®clean/smudge filter (å¦‚Git LFS)

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-21300æ˜¯ä¸€ä¸ªGitæ¼æ´žï¼Œå…è®¸æ¶æ„ä»“åº“åœ¨å…‹éš†æ—¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽGitåœ¨å¤„ç†åŒ…å«ç¬¦å·é“¾æŽ¥å’Œclean/smudgeè¿‡æ»¤å™¨ï¼ˆå¦‚Git LFSï¼‰çš„ä»“åº“æ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NTFSã€HFS+æˆ–APFSï¼‰ä¸Šå¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆã€‚`post-checkout` è„šæœ¬åŒ…å« `echo PWNED >&2`ï¼Œè¡¨æ˜Žå½“æ‰§è¡Œ `git clone` å¹¶æ£€å‡ºä»“åº“åŽï¼Œä¼šè¾“å‡º "PWNED" åˆ°æ ‡å‡†é”™è¯¯æµï¼Œè¯æ˜Žä»£ç æ‰§è¡ŒæˆåŠŸã€‚

**æŠ•æ¯’é£Žé™©ï¼š**  

è™½ç„¶POCä»£ç æœ¬èº«åªåŒ…å«ç®€å•çš„ä»£ç æ‰§è¡ŒéªŒè¯ï¼Œå¹¶æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½†æ¶æ„ä»“åº“çš„åˆ›å»ºè€…å®Œå…¨å¯ä»¥åœ¨ `post-checkout` è„šæœ¬æˆ–è€…clean/smudge filterä¸­åµŒå…¥æ›´å¤æ‚çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·å‡­æ®ã€å®‰è£…åŽé—¨ç­‰ã€‚å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œé£Žé™©ç¨‹åº¦ä¸º10%.

**åˆ©ç”¨æ–¹å¼ï¼š** 

1.  **åˆ›å»ºæ¶æ„ä»“åº“ï¼š** æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„é…ç½®çš„Gitä»“åº“ï¼Œä»“åº“ä¸­åŒ…å«ï¼š
    *   ç¬¦å·é“¾æŽ¥
    *   `.gitattributes` æ–‡ä»¶ï¼Œé…ç½® clean/smudge è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ Git LFSï¼ŒGit for Windows é»˜è®¤é…ç½®ï¼‰
    *   `post-checkout` é’©å­æˆ–å…¶ä»–èƒ½åœ¨å…‹éš†/æ£€å‡ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚
2.  **è¯±éª—ç”¨æˆ·å…‹éš†ä»“åº“ï¼š** æ”»å‡»è€…è¯±éª—ç›®æ ‡ç”¨æˆ·å…‹éš†è¯¥æ¶æ„ä»“åº“ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** å½“ç”¨æˆ·å…‹éš†ä»“åº“å¹¶æ£€å‡ºä»£ç æ—¶ï¼Œæ¶æ„ `post-checkout` è„šæœ¬è¢«æ‰§è¡Œï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

