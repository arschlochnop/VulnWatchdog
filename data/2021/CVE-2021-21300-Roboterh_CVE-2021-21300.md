# CVE-2021-21300

> 📦 该CVE有 **14** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21300-1uanWu_CVE-2021-21300.md](../2021/CVE-2021-21300-1uanWu_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**利用条件:** 需要受害者克隆恶意仓库，文件系统需要是大小写不敏感（如NTFS, HFS+, APFS），开启了符号链接支持，并且配置了clean/smudge filter (例如 Git LFS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300是Git中的一个远程代码执行漏洞，影响版本包括2.14.2到2.30.1之间的多个版本。漏洞源于当Git客户端在大小写不敏感的文件系统上，并且配置了clean/smudge filter和符号链接支持的情况下，恶意仓库可以利用符号链接和精心构造的文件，在克隆过程中执行任意代码。

**有效性：**

根据提供的POC代码，可以判断漏洞利用是有效的。该POC包含一个`.git/hooks/post-checkout`脚本，该脚本会在`git checkout`操作之后被执行。当受害者克隆包含该脚本的恶意仓库，并执行`git checkout`操作时，该脚本就会被执行，从而实现远程代码执行。 `echo PWNED >&2` 这段代码会将“PWNED”输出到标准错误流，表明漏洞利用成功。

**投毒风险：**

提供的POC代码本身并没有明显的投毒代码。它仅仅是为了演示漏洞而存在，其目的是在受害者机器上执行任意代码，而不是在代码仓库中植入后门，影响其他开发者或者构建系统。因此，仓库中存在作者隐藏的投毒代码的可能性较低。投毒风险评估为0%。

**利用方式：**

1.  攻击者创建一个包含恶意`.git/hooks/post-checkout`脚本以及其他相关文件的Git仓库。
2.  仓库中包含符号链接和使用了clean/smudge filter的文件，这些文件被设计为利用文件系统的大小写不敏感特性。
3.  攻击者诱导受害者克隆该恶意仓库。
4.  当受害者执行`git checkout`或其他触发`post-checkout` hook的操作时，恶意脚本会被执行，从而导致远程代码执行。

**项目地址:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #2

**来源**: [CVE-2021-21300-AlkenePan_CVE-2021-21300.md](../2021/CVE-2021-21300-AlkenePan_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许恶意仓库在克隆时执行任意代码

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用大小写不敏感的文件系统 (例如 NTFS, HFS+ 或 APFS)，并且配置了 clean/smudge 过滤器 (例如 Git LFS)。 受害者需要克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞存在于 Git 中，允许恶意仓库在克隆到大小写不敏感的文件系统上时执行任意代码。漏洞利用依赖于以下几个关键因素：

1.  **大小写不敏感的文件系统：** 漏洞利用依赖于 NTFS, HFS+ 或 APFS 等文件系统，这些系统对文件名的大小写不敏感。
2.  **Clean/Smudge 过滤器：** 漏洞利用依赖于配置的 clean/smudge 过滤器，例如 Git LFS。这些过滤器会在检出和提交文件时自动转换文件内容。
3.  **恶意仓库：** 攻击者需要创建一个包含恶意配置的 Git 仓库。

**利用方式：**

1.  攻击者创建一个恶意 Git 仓库，仓库中包含一个或多个符号链接以及使用了 clean/smudge 过滤器的文件。
2.  攻击者在 `.gitattributes` 文件中配置 clean/smudge 过滤器，使其指向一个恶意脚本。
3.  受害者克隆该恶意仓库到大小写不敏感的文件系统上。
4.  当 Git 尝试检出仓库中的文件时，会触发 clean/smudge 过滤器。
5.  由于大小写不敏感的文件系统的特性，符号链接可能会指向恶意脚本，导致该脚本被执行。

**POC 代码分析：**

提供的 POC 代码包含以下文件：

*   `A/a` 和 `A/b`：这两个文件可能是占位符，或者用于触发 clean/smudge 过滤器。
*   `A/post-checkout`：这是一个 Git hook 脚本，会在 `git checkout` 命令之后执行。在这个例子中，它会输出 "PWNED" 到标准错误流，表明漏洞已被成功利用。

**有效性：**

提供的 POC 代码有效，它演示了如何利用 CVE-2021-21300 漏洞在克隆仓库时执行任意代码。通过配置 `post-checkout` 钩子，攻击者可以在受害者克隆仓库后立即执行恶意代码。

**投毒风险：**

在这个特定的 POC 代码中，没有明显的投毒代码。 `post-checkout` 脚本只是简单地输出 "PWNED"，用于验证漏洞的存在。 投毒风险评估为 0%。这意味着在这个特定的例子中，没有证据表明作者试图通过隐藏恶意代码来进一步危害受害者。

**项目地址:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #3

**来源**: [CVE-2021-21300-ETOCheney_cve-2021-21300.md](../2021/CVE-2021-21300-ETOCheney_cve-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统被控制

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用受影响的Git版本，文件系统为大小写不敏感（如NTFS, HFS+ or APFS），并且配置了clean/smudge过滤器（例如Git LFS）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许恶意仓库在克隆期间执行任意代码。攻击者可以通过构造包含符号链接和使用 clean/smudge 过滤器的文件（如Git LFS）的恶意仓库来实现。当在大小写不敏感的文件系统上克隆此仓库时，会导致在检出后执行恶意脚本。

**有效性：** 提供的POC代码是有效的，它包含一个 `post-checkout` 钩子脚本，当仓库被检出后会自动执行。该脚本简单地输出 "PWNED" 到标准错误流，表明代码执行已成功。

**投毒风险：** POC代码本身并不包含隐藏的投毒代码。 `post-checkout` 脚本的目的非常明显，即验证漏洞的存在。 由于样本很小且直接，因此其中嵌入隐藏的、恶意功能的可能性很低。所以投毒风险为0%。

**利用方式：**
1.  攻击者创建一个包含恶意 `post-checkout` 钩子脚本的Git仓库。
2.  仓库中包含符号链接以及配置了 clean/smudge 过滤器的文件（例如，使用Git LFS跟踪的大文件）。
3.  攻击者诱使用户克隆该恶意仓库。
4.  当用户在大小写不敏感的文件系统上克隆仓库时，Git会自动执行 `post-checkout` 脚本，从而执行攻击者的恶意代码。

**项目地址:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #4

**来源**: [CVE-2021-21300-Faisal78123_CVE-2021-21300.md](../2021/CVE-2021-21300-Faisal78123_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**利用条件:** 目标系统文件系统大小写不敏感（如NTFS, HFS+, APFS），且配置了clean/smudge filter（如Git LFS）。用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 是一个存在于 Git 中的远程代码执行漏洞。该漏洞源于 Git 客户端在大小写不敏感的文件系统上，处理包含符号链接和带有 clean/smudge 过滤器的文件（如 Git LFS）的恶意仓库时，可能执行恶意代码。

**有效性分析：**

提供的 POC 代码尝试利用此漏洞。`exploit.sh` 脚本创建一个包含恶意配置的 Git 仓库。它首先初始化一个 Git 仓库 `delayed-checkout`，然后创建一个 `.gitattributes` 文件，该文件将 `post-checkout` 过滤器应用于目录 `A`。脚本随后在 `A/post-checkout` 中创建一个可执行脚本，当检出 `A` 目录时会执行该脚本。脚本创建一个符号链接 `a`，指向 `.git/hooks`，并将 `a` 添加到版本控制中。当在大小写不敏感的文件系统上克隆此仓库时，Git 可能会错误地执行位于 `.git/hooks` 目录中的恶意 `post-checkout` 脚本。

根据漏洞描述以及POC的行为，可以判定POC的有效性高。

**投毒风险分析：**

POC 代码本身主要关注漏洞利用，旨在演示漏洞触发和利用的方式。其中 `A/post-checkout` 脚本仅仅执行 `echo PWNED >&2`。因此，漏洞利用代码本身不包含明显的投毒代码。但任何git仓库都有投毒的可能，如作者可以修改git配置项，让用户每次提交都触发恶意代码执行等。

基于代码分析，投毒风险较低，但无法完全排除，假设存在一些隐蔽性极高的投毒手法，给出一个较低的概率估计，比如10%。

**利用方式：**

1.  攻击者创建一个恶意的 Git 仓库，其中包含：
    *   一个 `.gitattributes` 文件，配置了 clean/smudge 过滤器（例如 Git LFS）和一个 `post-checkout` 钩子。
    *   一个符号链接，指向 `.git/hooks` 目录。
    *   一个 `post-checkout` 脚本，包含攻击者想要执行的恶意代码。
2.  攻击者将此恶意仓库托管在公共或私有 Git 服务器上。
3.  攻击者诱骗受害者克隆此恶意仓库到大小写不敏感的文件系统（例如 Windows 或 macOS）。
4.  当受害者克隆仓库时，Git 会执行 `post-checkout` 钩子中的恶意代码，导致远程代码执行。

**修复方案：**

*   升级 Git 到已修复版本（>= 2.30.1, 2.29.3, 2.28.1, 2.27.1, 2.26.3, 2.25.5, 2.24.4, 2.23.4, 2.22.5, 2.21.4, 2.20.5, 2.19.6, 2.18.5, 2.17.6）。
*   禁用 Git 中的符号链接支持 (`git config --global core.symlinks false`)。
*   避免克隆来自不受信任来源的仓库。

**项目地址:** [Faisal78123/CVE-2021-21300](https://github.com/Faisal78123/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #5

**来源**: [CVE-2021-21300-Kirill89_CVE-2021-21300.md](../2021/CVE-2021-21300-Kirill89_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，且文件系统大小写不敏感（如Windows, macOS），启用了core.symlinks，且配置了clean/smudge filter（如Git LFS）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许恶意仓库在克隆时执行远程代码。该漏洞利用了Git的clean/smudge过滤器和符号链接在大小写不敏感的文件系统上的处理方式。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意符号链接和特定文件的Git仓库。
2.  仓库配置了clean/smudge过滤器（例如，通过Git LFS）。
3.  当用户克隆此仓库时，符号链接会被创建。
4.  在大小写不敏感的文件系统上，精心构造的符号链接和文件名的组合会导致Git执行恶意代码。

**POC代码分析：**

提供的POC代码包含三个文件:

*   `A/a`: 文件内容为空
*   `A/b`: 文件内容为空
*   `A/post-checkout`:  这是一个shell脚本，它会在`git checkout`操作**之后**执行。这个脚本会向`http://dc5325e3774c.ngrok.io`发起一个HTTP请求，这允许攻击者追踪受害者是否克隆了仓库。这个脚本本身即是后门，也能够下载其他恶意代码。

**有效性评估：**

此POC代码是有效的，因为它展示了如何在克隆仓库时执行任意代码。攻击者通过`post-checkout` hook 执行 `curl` 命令来与外部服务器通信，这可以用来执行任何命令。

**投毒风险：**

此POC自身不包含传统意义上的投毒代码，而是利用了 Git 的特性来执行恶意操作。`post-checkout` 脚本中的 `curl` 命令是攻击者放置的后门，用于执行远程操作。因此，这里将投毒风险评估为0%，因为脚本本身即为恶意利用的载体,并非是隐藏的恶意代码.攻击者通过控制 `post-checkout` 脚本的内容来达到攻击目的。

**总结：**

CVE-2021-21300是一个严重的安全漏洞，因为它允许攻击者在受害者克隆恶意仓库时执行任意代码。用户应避免克隆来自不受信任来源的仓库，并及时更新Git到已修复的版本。同时，禁用`core.symlinks`或者不全局配置clean/smudge filters可以作为临时缓解措施。

**项目地址:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #6

**来源**: [CVE-2021-21300-Maskhe_CVE-2021-21300.md](../2021/CVE-2021-21300-Maskhe_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，并且文件系统是大小写不敏感的 (如 NTFS, HFS+, APFS)，开启了core.symlinks配置，同时配置了clean/smudge filters（如Git LFS）。用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 漏洞允许攻击者通过构造包含恶意符号链接和带有clean/smudge filter（比如Git LFS）的文件，在克隆仓库时执行任意代码。漏洞主要存在于大小写不敏感的文件系统上，例如 Windows 和 macOS 默认的文件系统。攻击者需要托管一个恶意的 Git 仓库，并诱使用户克隆该仓库。提供的POC代码通过在 `.git/hooks/post-checkout` 目录下放置一个名为 `post-checkout` 的可执行脚本来实现。当用户 `clone` 或者 `checkout` 包含该脚本的仓库时，Git 会自动执行该脚本，从而实现任意代码执行。 `post-checkout`脚本的内容是打印 "PWNED" 到标准错误输出，表明攻击成功。由于POC代码的功能简单，仅用于验证漏洞，投毒风险较低，主要风险在于该仓库可能包含其他恶意文件或配置，在不知情的情况下执行。

**漏洞利用方式:**

1.  攻击者创建一个包含恶意符号链接以及使用 clean/smudge 过滤器的文件的 Git 仓库。
2.  攻击者在 `.git/hooks` 目录下放置恶意脚本，例如 `post-checkout`。
3.  攻击者诱使用户克隆该仓库。
4.  当用户克隆仓库后，Git 会执行 `post-checkout` 脚本，从而执行攻击者预设的恶意代码。

**有效性：**
提供的POC代码有效，可以触发远程代码执行。

**投毒风险分析：**
POC 代码本身比较简单，主要功能是执行一个打印 "PWNED" 的脚本。但仍存在一定的投毒风险，因为攻击者可能在仓库中隐藏其他恶意代码，或者利用 Git LFS 执行更复杂的攻击。因此，虽然直接的投毒风险较低，但用户仍然需要谨慎对待来自未知来源的 Git 仓库。仓库作者有可能在其他地方植入后门或者恶意代码，因此综合判定投毒可能性为10%。

**项目地址:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #7

**来源**: [CVE-2021-21300-Roboterh_CVE-2021-21300.md](../2021/CVE-2021-21300-Roboterh_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，且文件系统为大小写不敏感（如NTFS, HFS+, APFS），启用了符号链接，并配置了clean/smudge filter（如Git LFS）。用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300漏洞是Git中的一个远程代码执行漏洞，存在于当Git客户端在大小写不敏感的文件系统上处理包含符号链接和clean/smudge过滤器(例如Git LFS)的恶意仓库时。攻击者可以创建一个包含特制的符号链接和文件的仓库，当用户克隆该仓库时，恶意代码会被执行。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC是有效的。多个来源都确认了该漏洞的存在，并提供了缓解措施和补丁版本。PacketStorm Security等网站上也有利用代码的示例。

**投毒风险：**
提供的代码片段主要展示了Git钩子的示例，例如`applypatch-msg.sample`、`commit-msg.sample`和`fsmonitor-watchman.sample`。这些是正常的Git功能，用于在特定Git操作期间执行脚本。虽然这些钩子本身不是恶意代码，但攻击者可以利用这些钩子来执行恶意操作。例如，攻击者可以在仓库中包含一个`.gitattributes`文件，该文件配置了一个恶意的clean/smudge过滤器，该过滤器会在检出时执行任意代码。`fsmonitor-watchman.sample`这个文件监视文件系统的变化，恶意修改这个文件可能会导致监控系统被破坏，或者执行恶意的代码。因此，**仓库本身存在被投毒的可能，概率约为10%**。

**利用方式：**
1.  **创建恶意仓库：** 攻击者创建一个Git仓库，其中包含：
    *   一个`.gitattributes`文件，配置一个恶意的clean/smudge过滤器。例如，将所有`.txt`文件指向一个执行任意代码的脚本。
    *   一个或多个符号链接，指向触发恶意过滤器的文件。
    *   可能包含Git LFS跟踪的文件，以便在克隆时触发过滤器。
2.  **诱骗用户克隆仓库：** 攻击者通过各种手段（例如，社交工程、鱼叉式网络钓鱼等）诱骗受害者克隆该恶意仓库。
3.  **执行恶意代码：** 当受害者克隆仓库时，Git会根据`.gitattributes`中的配置执行clean/smudge过滤器。如果过滤器指向恶意脚本，则该脚本会在受害者的计算机上执行，从而导致远程代码执行。

要成功利用此漏洞，需要满足以下条件：
*   目标系统使用受影响的Git版本。
*   文件系统为大小写不敏感（如NTFS, HFS+, APFS）。
*   启用了符号链接（默认启用，但可以通过`git config core.symlinks false`禁用）。
*   配置了clean/smudge filter（例如Git LFS）。


**项目地址:** [Roboterh/CVE-2021-21300](https://github.com/Roboterh/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #8

**来源**: [CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md](../2021/CVE-2021-21300-Saboor-Hakimi-23_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.14.2 <= version < 2.30.1 (受影响版本详见漏洞库信息)

**利用条件:** 需要目标系统使用受影响的Git版本，且使用大小写不敏感的文件系统（如NTFS、HFS+、APFS），并且配置了clean/smudge filter（例如Git LFS），用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 是一个 Git 漏洞，允许恶意仓库在克隆时执行任意代码。此漏洞主要影响使用大小写不敏感文件系统的系统，如 Windows 和 macOS，并且需要配置 clean/smudge 过滤器（例如 Git LFS）。

**有效性分析：**
提供的 POC 代码包含以下文件：
* `A/a`：一个空文件。
* `A/b`：一个空文件。
* `A/post-checkout`：一个 shell 脚本，其作用是创建 `/tmp/pwn` 文件并写入 "PWN" 字符串。

`post-checkout` 脚本被放置在 `.git/hooks` 目录下，并在 `git checkout` 命令执行后执行。利用的关键在于精心构造的文件名和符号链接，使得在大小写不敏感的文件系统上，钩子脚本能够被正确识别并执行。根据漏洞描述，结合 clean/smudge 过滤器配置，可以触发执行。

**投毒风险分析：**
提供的 POC 代码非常简单，除了创建 `/tmp/pwn` 文件之外没有其他操作。这意味着该代码本身不太可能包含任何作者隐藏的恶意代码。投毒风险较低。

**利用方式：**
1.  攻击者创建一个包含恶意 `post-checkout` 钩子的 Git 仓库。
2.  该仓库还包含一些文件，例如 `A/a` 和 `A/b`，以及必要的 Git LFS 配置或其他触发 clean/smudge 过滤器的配置。
3.  受害者克隆该恶意仓库到使用大小写不敏感文件系统的机器上，且该机器已经配置了 Git LFS 或其他 clean/smudge 过滤器。
4.  在克隆过程中，由于文件系统的大小写不敏感性，以及 clean/smudge 过滤器的处理，`post-checkout` 钩子被触发执行，导致任意代码执行。
5.  在这个 POC 例子中，代码执行的结果是在 `/tmp/` 目录下创建一个名为 `pwn` 的文件，文件内容为 `PWN`。

**项目地址:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #9

**来源**: [CVE-2021-21300-Sizvy_CVE-2021-21300.md](../2021/CVE-2021-21300-Sizvy_CVE-2021-21300.md)

## CVE-2021-21300: Git 恶意仓库远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许攻击者在受害者机器上执行任意代码

**影响版本:** 2.14.2 <= Git版本 < 2.30.1

**利用条件:** 需要目标系统使用大小写不敏感的文件系统（如Windows/macOS），启用 Git LFS，并且受害者克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许攻击者通过构造包含恶意 Git hooks 的仓库，在受害者克隆该仓库时执行任意代码。攻击依赖于大小写不敏感的文件系统，以及 Git LFS 的 clean/smudge 过滤器。攻击者创建一个目录（如 'A'），并在其中包含一个名为 'post-checkout' 的文件，该文件包含恶意命令。然后，攻击者将目录 'A' 替换为指向 '.git/hooks/' 的符号链接。当 Git 执行 'A/post-checkout' 时，实际上执行了 '.git/hooks/post-checkout' 中的恶意代码。

**漏洞利用方式:**

1.  攻击者创建一个恶意 Git 仓库。
2.  仓库包含一个目录（例如 'A'），以及 'A/post-checkout' 文件，其中包含恶意代码。
3.  仓库的 `.gitattributes` 文件配置 Git LFS 来处理 'A/post-checkout' 文件。
4.  攻击者将目录 'A' 替换为一个指向 '.git/hooks/' 的符号链接。
5.  攻击者提交并将恶意仓库推送到一个公共或私有 Git 仓库。
6.  受害者克隆该恶意仓库。
7.  当 Git 执行 post-checkout 钩子时，由于符号链接和大小写不敏感的文件系统，恶意代码会被执行。

**投毒风险评估:**

提供的漏洞利用代码主要包含以下文件:

*   `README.md`: 描述漏洞信息和利用方法。
*   `A/a`，`A/b`: 两个空文件，用于迷惑用户，增加仓库的伪装性。
*   `A/post-checkout`: 包含恶意代码，例如 `echo PWNED >&2`，用于在受害者终端输出 "PWNED"。

在分析了提供的代码后，没有发现作者隐藏的恶意代码，该POC目的是验证漏洞，而并非投毒。

**结论:**

提供的 PoC 代码有效，可以用于验证 CVE-2021-21300 漏洞。 代码本身不包含投毒内容，仅用于演示漏洞利用。但如果有人发布包含恶意payload的类似代码，则存在投毒风险。

**项目地址:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #10

**来源**: [CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md](../2021/CVE-2021-21300-danshuizhangyu_CVE-2021-21300.md)

## CVE-2021-21300

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.30.1 (特定版本)

**利用条件:** 需要目标系统使用 case-insensitive 文件系统 (例如 NTFS, HFS+, APFS)，受影响的 Git 版本，配置了 clean/smudge 过滤器 (如 Git LFS)，用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 是一个 Git 漏洞，允许恶意仓库在克隆时执行远程代码。漏洞利用依赖于以下条件：

1.  **Case-Insensitive 文件系统：** 目标系统必须使用 case-insensitive 文件系统，例如 Windows 上的 NTFS 或 macOS 上的 HFS+ 或 APFS。
2.  **受影响的 Git 版本：** Git 版本必须在 2.14.2 和 2.30.1 之间，但已被修复的版本除外。具体受影响的版本范围请参考漏洞库信息。
3.  **Clean/Smudge 过滤器：** 必须配置 clean/smudge 过滤器，例如 Git LFS。Git for Windows 默认配置 Git LFS，因此容易受到攻击。
4.  **用户交互：** 用户必须克隆来自不受信任来源的恶意仓库。

**利用方式：**

攻击者创建一个包含以下内容的恶意仓库：

*   符号链接
*   使用 clean/smudge 过滤器的文件

当用户克隆仓库时，Git 会尝试签出文件。由于 case-insensitive 文件系统和 clean/smudge 过滤器的存在，符号链接可能指向仓库之外的文件，或者 clean/smudge 过滤器可能执行恶意代码。

**有效性：**
提供的 POC 代码 `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` 仅仅是一个 README 文件，本身并不包含任何漏洞利用代码。但是，正如漏洞描述中提到的，攻击的关键在于精心构造的仓库内容，包括符号链接和带有恶意配置的 `.gitattributes` 文件等，因此，仅凭这个 README 文件无法判断漏洞是否能够成功利用。需要分析整个仓库的内容才能确定其有效性。

**投毒风险：**

给定的 `README.md` 文件内容非常简单，只包含 CVE 编号。投毒风险较低，估计为 10%。但是，不能仅凭单个文件就完全排除投毒风险。整个仓库都可能包含隐藏的恶意代码，例如在 `.gitattributes` 中配置的 clean/smudge 过滤器中。更复杂的投毒手段可能会涉及更隐蔽的代码注入，例如在看似无害的文件中嵌入 Payload 或利用其他漏洞来执行恶意代码。因此，彻底分析整个仓库的内容才能更准确地评估投毒风险。

**搜索引擎结果分析：**

搜索结果表明 CVE-2021-21300 影响 Git 客户端在 case-insensitive 文件系统上的操作，并可能导致远程代码执行。Git for Windows 默认配置 Git LFS，因此更容易受到攻击。此外，要成功利用该漏洞，攻击者必须能够托管恶意仓库并诱使用户克隆该仓库。相关链接提供更多漏洞信息、修复方案和讨论。

**项目地址:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #11

**来源**: [CVE-2021-21300-erranfenech_CVE-2021-21300.md](../2021/CVE-2021-21300-erranfenech_CVE-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用受影响的Git版本，并且文件系统是大小写不敏感的（如NTFS, HFS+或APFS），同时配置了clean/smudge filters (例如 Git LFS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 是一个Git的远程代码执行漏洞。该漏洞出现在当克隆包含符号链接的恶意仓库时，并且该仓库使用了 clean/smudge 过滤器（比如 Git LFS）。在大小写不敏感的文件系统上（如Windows和macOS的默认文件系统），这可能导致在检出时执行恶意代码。

**有效性：**
提供的POC代码看起来是有效的。它创建了一个包含符号链接（`ln -s .git/hooks a`）和 `post-checkout` hook 的恶意仓库。当这个仓库被克隆到启用了符号链接和 clean/smudge 过滤器的系统上，并且文件系统是大小写不敏感的时候，`post-checkout` 脚本就会被执行，从而实现远程代码执行。

**投毒风险：**
该POC代码的主要目的是演示漏洞，没有发现明显的投毒代码。脚本只是简单地输出"PWNED"来表示漏洞利用成功。因此，投毒风险估计为0%。

**利用方式：**
1.  攻击者创建一个恶意的Git仓库。
2.  仓库包含一个符号链接，指向 `.git/hooks` 目录下的一个 hook 脚本(如 post-checkout)。
3.  仓库配置了 clean/smudge 过滤器 (例如通过 `.gitattributes` 文件启用Git LFS)。
4.  攻击者诱使用户克隆该恶意仓库。
5.  当用户克隆仓库时，Git会在大小写不敏感的文件系统上创建符号链接。
6.  由于 clean/smudge 过滤器的存在，以及大小写不敏感的文件系统，hook 脚本会被执行，从而导致远程代码执行。

总而言之，此漏洞的利用依赖于特定的环境配置，比如文件系统的大小写不敏感性和clean/smudge 过滤器的启用。

**项目地址:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #12

**来源**: [CVE-2021-21300-fengzhouc_CVE-2021-21300.md](../2021/CVE-2021-21300-fengzhouc_CVE-2021-21300.md)

## CVE-2021-21300

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**利用条件:** 目标系统需使用大小写不敏感的文件系统（如Windows的NTFS）且安装了受影响版本的Git，并配置了clean/smudge过滤器（如Git LFS，Git for Windows默认配置Git LFS），用户需要clone恶意仓库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 漏洞存在于 Git 多个版本中，由于对符号链接处理不严格，攻击者可以在大小写敏感的文件系统上创建一个包含恶意符号链接的 Git 仓库。当用户在大小写不敏感的文件系统（如 Windows）上克隆该仓库时，该符号链接可能被解析到 .git/hooks 目录下的恶意脚本，导致在 clone 过程中执行任意命令。漏洞利用依赖于 clean/smudge 过滤器（如 Git LFS）。

**有效性：** 提供的 POC 代码是有效的，它演示了如何创建一个包含恶意符号链接和 post-checkout 脚本的仓库，当在 Windows 系统上 clone 该仓库时，post-checkout 脚本会被执行，从而实现远程命令执行。

**投毒风险：** 代码的主要功能是利用漏洞，但其中存在少量投毒风险。`hack.sh`脚本虽然展示了一个简单的攻击场景，但攻击者可以在此基础上添加更具破坏性的代码，例如删除文件、窃取敏感信息等。因此，克隆此仓库存在一定的风险，大约为10%。这个估计是基于这样一个事实，即POC的重点是漏洞演示，而非完全隐蔽的恶意代码。更复杂的利用可能会有更高的投毒风险。

**利用方式：**
1.  攻击者创建一个包含恶意符号链接和 post-checkout 脚本的 Git 仓库。
2.  仓库的 .gitattributes 文件配置了 clean/smudge 过滤器（如 Git LFS）。
3.  用户在大小写不敏感的文件系统上克隆该仓库。
4.  在 clone 过程中，由于符号链接被解析到 .git/hooks 目录下，post-checkout 脚本会被执行，从而实现远程命令执行。
5. 可以通过修改post-checkout文件内容为恶意代码，从而控制受害者机器。

**项目地址:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #13

**来源**: [CVE-2021-21300-henry861010_Network_Security_NYCU.md](../2021/CVE-2021-21300-henry861010_Network_Security_NYCU.md)

## CVE-2021-21300-Git-RCE

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.14.2 <= Git版本 < 2.17.6, 2.18.0 <= Git版本 < 2.18.5, 2.19.0 <= Git版本 < 2.19.6, 2.20.0 <= Git版本 < 2.20.5, 2.21.0 <= Git版本 < 2.21.4, 2.22.0 <= Git版本 < 2.22.5, 2.23.0 <= Git版本 < 2.23.4, 2.24.0 <= Git版本 < 2.24.4, 2.25.0 <= Git版本 < 2.25.5, 2.26.0 <= Git版本 < 2.26.3, 2.27.0 <= Git版本 < 2.27.1, 2.28.0 <= Git版本 < 2.28.1, 2.29.0 <= Git版本 < 2.29.3, 2.30.0 <= Git版本 < 2.30.1

**利用条件:** 目标系统文件系统不区分大小写(如NTFS, HFS+)，并且配置了clean/smudge filter（例如Git LFS）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许恶意 Git 仓库在克隆时执行任意代码。利用方式为：

1.  **创建恶意仓库：** 攻击者创建一个包含恶意配置的 Git 仓库。
2.  **利用符号链接：** 仓库中包含一个符号链接（symbolic link），指向 `.git/hooks` 目录下的一个钩子脚本（例如 `post-checkout`）。
3.  **clean/smudge filter：** 仓库的 `.gitattributes` 文件配置了 clean/smudge 过滤器，如 Git LFS。
4.  **触发执行：** 当用户克隆恶意仓库，并且文件系统不区分大小写（如Windows的NTFS），Git 会尝试更新工作目录。由于符号链接的存在，并且文件系统不区分大小写，Git 会错误地将符号链接指向的钩子脚本（如 `A/post-checkout`）复制到 `.git/hooks/post-checkout`，从而导致该脚本在后续的 `git checkout` 操作时被执行。
5.  **远程代码执行：** 恶意脚本被执行，实现远程代码执行。

**POC有效性：** 提供的 POC 代码 `build_bad_repo.sh` 尝试利用上述方法创建恶意仓库。它首先初始化一个 Git 仓库，然后创建 `.gitattributes` 文件，配置 `filter=lfs`。接着，创建一个名为 `A/post-checkout` 的可执行脚本，该脚本包含恶意代码。然后，创建一个名为 `a` 的符号链接，指向 `.git/hooks` 目录。最后，将这些文件添加到 Git 仓库并提交。当用户克隆此恶意仓库并在易受攻击的系统上检出时，`A/post-checkout` 中的代码将被执行，从而验证漏洞的存在。

**投毒风险：**  提供的 POC 代码本身即为漏洞利用代码，目的是创建一个能触发 RCE 的恶意仓库。其中 `A/post-checkout` 脚本的内容 `echo HACKed(unauthorized_command) >&2` 仅用于演示目的，表明代码已被执行。脚本本身的行为只是输出一段文字，没有隐藏其他恶意代码，因此可以认为不存在投毒风险。Poison 为0%.

**缓解措施：**

*   升级 Git 版本到修复版本。
*   禁用符号链接支持 (`git config --global core.symlinks false`)。
*   避免克隆来自不受信任来源的仓库。

**项目地址:** [henry861010/Network_Security_NYCU](https://github.com/henry861010/Network_Security_NYCU)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

## POC #14

**来源**: [CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md](../2021/CVE-2021-21300-the-chivalrousZ_cve-2021-21300.md)

## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统权限获取

**影响版本:** 受影响版本：>= 2.14.2, < 2.17.6，>= 2.18.0, < 2.18.5，>= 2.19.0, < 2.19.6，>= 2.20.0, < 2.20.5，>= 2.21.0, < 2.21.4，>= 2.22.0, < 2.22.5，>= 2.23.0, < 2.23.4，>= 2.24.0, < 2.24.4，>= 2.25.0, < 2.25.5，>= 2.26.0, < 2.26.3，>= 2.27.0, < 2.27.1，>= 2.28.0, < 2.28.1，>= 2.29.0, < 2.29.3，>= 2.30.0, < 2.30.1

**利用条件:** 目标系统需要使用受影响的Git版本，并且克隆包含恶意配置的仓库。需要开启core.symlinks (默认开启), 需要配置clean/smudge filter (如Git LFS)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300是一个Git漏洞，允许恶意仓库在克隆时执行远程代码。该漏洞是由于Git在处理包含符号链接和clean/smudge过滤器（如Git LFS）的仓库时，在不区分大小写的文件系统（如NTFS、HFS+或APFS）上可能导致执行恶意脚本。 

**有效性：** 提供的POC代码有效。`post-checkout` 脚本包含 `echo PWNED >&2`，表明当执行 `git clone` 并检出仓库后，会输出 "PWNED" 到标准错误流，证明代码执行成功。

**投毒风险：**  

虽然POC代码本身只包含简单的代码执行验证，并没有明显的投毒行为。但恶意仓库的创建者完全可以在 `post-checkout` 脚本或者clean/smudge filter中嵌入更复杂的恶意代码，例如窃取用户凭据、安装后门等。因此，存在一定的投毒风险，风险程度为10%.

**利用方式：** 

1.  **创建恶意仓库：** 攻击者创建一个包含恶意配置的Git仓库，仓库中包含：
    *   符号链接
    *   `.gitattributes` 文件，配置 clean/smudge 过滤器（例如 Git LFS，Git for Windows 默认配置）
    *   `post-checkout` 钩子或其他能在克隆/检出过程中执行的脚本。
2.  **诱骗用户克隆仓库：** 攻击者诱骗目标用户克隆该恶意仓库。
3.  **代码执行：** 当用户克隆仓库并检出代码时，恶意 `post-checkout` 脚本被执行，导致远程代码执行。

**项目地址:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)

---

