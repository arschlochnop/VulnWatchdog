## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中的 polkit 版本 (2009年至今)

**利用条件:** 具有本地普通用户访问权限，目标系统安装并启用了 polkit (pkexec)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞被称为 'PwnKit'，是 Linux 系统中 polkit 的 pkexec 工具存在的一个内存破坏漏洞。由于 pkexec 在处理命令行参数时缺乏正确的边界检查，攻击者可以通过操纵环境变量（尤其是 PATH 和 GCONV_PATH）在非特权上下文中诱导 pkexec 加载并执行恶意的共享库。提供的 POC 代码非常简洁且高效。cve-2021-4034.c 利用 execve 调用 pkexec，并通过构造特殊的环境变量数组（environ）触发漏洞，其中 'PATH=GCONV_PATH=.' 是关键，它欺骗 pkexec 在当前目录下寻找共享库。pwnkit.c 定义了 gconv_init 函数，该函数在被加载时会调用 setuid(0) 和 setgid(0) 获取 root 权限，并执行 /bin/sh 启动一个特权 Shell。Makefile 自动化了整个编译过程，包括创建伪造的 gconv 模块配置文件和目录结构。经分析，该 POC 逻辑清晰，完全符合 PwnKit 的公开技术原理，能够在未打补丁的典型 Linux 环境下实现 100% 的成功率。利用步骤：1. 在本地目录创建 Makefile、cve-2021-4034.c 和 pwnkit.c；2. 执行 make 命令，编译生成 cve-2021-4034 可执行文件、pwnkit.so 共享库，并生成 gconv-modules 配置文件及相关目录；3. 运行编译生成的二进制文件 ./cve-2021-4034；4. 漏洞触发后，pkexec 会以 root 权限执行 pwnkit.so 中的代码，从而直接弹回一个 root shell。投毒风险分析：该 POC 代码展示了极高的透明度和安全性，主要体现在以下几个方面：首先，代码逻辑完全公开，使用的是标准的 C 语言库函数（如 unistd.h, stdlib.h），没有引入任何第三方库或外部二进制依赖。其次，Makefile 的操作仅限于本地目录（如创建临时文件夹 GCONV_PATH=.），不涉及对系统敏感文件（如 /etc/passwd 或 /etc/shadow）的越权修改，符合防御性研究的规范。代码中没有任何网络通信行为，不存在向远程服务器外发凭据或接受控制指令的情况。虽然 exploit 最终目的是获取 root 权限，但其 payload（/bin/sh）是安全研究中标准的提权验证方式，而非恶意后门。综上所述，该 POC 的投毒风险极低，可认为是纯粹的教学与研究代码，安全从业人员在受控环境下编译使用时基本无需担心恶意投毒问题。但由于其威力巨大，防御者应重点关注生产环境的补丁更新。

**项目地址:** 本地分析版本

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
