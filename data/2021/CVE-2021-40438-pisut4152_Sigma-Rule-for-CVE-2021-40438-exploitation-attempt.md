## CVE-2021-40438 - Apache HTTP Server Server-Side Request Forgery (SSRF)

**漏洞编号:** CVE-2021-40438

**漏洞类型:** Server-Side Request Forgery (SSRF)

**影响应用:** Apache HTTP Server

**危害等级:** High

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N

**影响版本:** 2.4.48 and earlier

**利用条件:** The mod_proxy module must be enabled. A crafted request URI path is required to trigger the vulnerability.

**POC 可用性:** 7/10

**POC 类型:** Complete exploit

**攻击复杂度:** Low

**投毒风险:** 10%

## 详情

CVE-2021-40438 is a server-side request forgery (SSRF) vulnerability affecting the mod_proxy module in Apache HTTP Server version 2.4.48 and earlier. A specially crafted request URI path can cause mod_proxy to forward the request to an origin server chosen by the remote user. This can lead to various security risks, including information disclosure, denial of service, and potentially remote code execution if the attacker can target internal services with known vulnerabilities. The provided POC code in `web_cve_2021_40438_apache_server_side_request_forgery.yml` indicates an attempt to exploit this vulnerability by crafting a request containing the `?unix:` prefix in the URI. The signature is designed to detect requests where the URI contains the `?unix:` string and the server responds with a 200 OK status code. 

**POC有效性分析:**
The provided YAML file is a Sigma rule designed to detect exploitation attempts of CVE-2021-40438. The rule checks for web server logs (`logsource: category: webserver`) where the URI (`c-uri`) contains the string `?unix:`. Additionally, it verifies that the HTTP status code (`sc-status`) is 200, indicating a successful request. This combination suggests a potential SSRF attack attempting to leverage the `mod_proxy` vulnerability. The rule's `level: high` designation indicates that a match should be treated as a serious security incident.

**利用步骤:**
1. Ensure the Apache HTTP Server has mod_proxy enabled.
2. Identify a vulnerable endpoint that uses mod_proxy.
3. Craft a request with a URI containing `?unix:` followed by the target internal service's address or file path.
4. Send the crafted request to the vulnerable endpoint.
5. If successful, the server will forward the request to the specified internal service, potentially exposing sensitive information or allowing unauthorized actions.

**投毒风险分析:**
由于POC仅包含检测规则，不包含直接的payload或者利用代码，因此直接投毒的风险较低。 但是，如果攻击者利用此规则作为蓝图来创建恶意有效负载并将其传播到易受攻击的系统，则存在间接风险。 此外，如果规则本身被修改为包含恶意逻辑或故意产生误报，则也可能发生投毒事件。 由于此漏洞允许SSRF，因此攻击者可以滥用它来访问内部服务或在服务器上执行操作。 攻击者可以使用该漏洞读取本地文件，连接到内部服务或访问云元数据。虽然此漏洞的直接利用不涉及代码执行，但它可能导致进一步的攻击，例如远程代码执行（如果内部服务存在漏洞）。如果恶意行为者创建了利用此漏洞的工具，他们可以尝试通过隐藏的有效负载或后门来感染这些工具。用户下载并使用受感染的工具可能会无意中危及他们的系统。由于此POC本质上是防御性的，因此直接投毒风险较低。但是，应仔细审核和验证任何基于此POC创建的利用代码或工具，以确保它们不包含恶意组件。

**项目地址:** https://github.com/SigmaHQ/sigma/blob/master/rules/web/web_cve_2021_40438_apache_server_side_request_forgery.yml

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2021-40438
