# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

# CVE-2021-31166

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31166-0vercl0k_CVE-2021-31166.md](../2021/CVE-2021-31166-0vercl0k_CVE-2021-31166.md)

## CVE-2021-31166: HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982和10.0.19042.982)

**利用条件:** 需要网络访问，目标系统运行存在漏洞的HTTP.sys服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 `http.sys` 中。该漏洞是由于 `http!UlpParseContentCoding` 函数中 use-after-free 错误导致的。攻击者可以发送特制的 HTTP 请求到存在漏洞的服务器，触发该漏洞，导致服务器崩溃（Bugcheck）或执行恶意代码。

**有效性：**
提供的POC代码利用了 `http!UlpParseContentCoding` 函数中的 use-after-free 漏洞，通过特定的 HTTP 请求触发该漏洞，导致系统崩溃。根据漏洞描述和POC代码的说明，该POC代码是有效的。

**投毒风险：**
提供的代码包括一个MIT许可证和漏洞说明文档(README.md)。漏洞利用代码主要集中在HTTP请求的构造上，以便触发`http.sys`中的漏洞。虽然无法完全排除投毒的可能性，但从代码内容来看，作者隐藏恶意代码的可能性较低。可以认为存在10%的投毒风险,主要体现在编译过程和HTTP请求构造的细节中，可能存在隐藏的恶意行为，比如信息泄露或权限提升。

**利用方式：**
1.  攻击者构造恶意的 HTTP 请求，该请求包含特定的 `Accept-Encoding` 头部。
2.  当 `http.sys` 解析该 HTTP 请求时，`UlpParseContentCoding` 函数中的漏洞会被触发。
3.  漏洞触发会导致一个 LIST_ENTRY 结构体被错误地释放，然后在后续操作中被再次访问。
4.  最终导致系统崩溃（Bugcheck）或允许攻击者执行任意代码。简单的POC可能仅仅触发拒绝服务(DoS),复杂的利用可以构造内存布局执行任意代码.
5.  漏洞利用通常涉及到精心构造的HTTP请求，这些请求需要发送到目标服务器的HTTP服务端口（通常是80或443端口）。

**项目地址:** [0vercl0k/CVE-2021-31166](https://github.com/0vercl0k/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #2

**来源**: [CVE-2021-31166-0xmaximus_Home-Demolisher.md](../2021/CVE-2021-31166-0xmaximus_Home-Demolisher.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于指定Build版本)

**利用条件:** 目标系统需要运行受影响版本的Windows，并开启HTTP服务(通常是IIS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 HTTP.sys 组件中。攻击者可以通过发送特制的 HTTP 请求到服务器来触发此漏洞，从而实现远程代码执行。根据漏洞库信息，该漏洞的CVSS评分为9.8，属于严重级别。CISA也将其列入已知被利用漏洞目录。提供的python脚本（CVE-2021-31166.py）尝试利用此漏洞。脚本通过发送包含特定 'Accept-Encoding' 头的 HTTP 请求来触发漏洞。脚本的实现方式是通过发送特制的HTTP请求，如果服务器在发送请求后停止运行，则认为服务器存在漏洞。

**有效性：**  POC代码（CVE-2021-31166.py）的有效性取决于目标系统是否满足漏洞存在的条件，即运行的是受影响版本的Windows，并且没有安装相应的安全更新。提供的代码通过修改HTTP头部中的`Accept-Encoding`来尝试触发漏洞。如果服务器在发送特制请求后无法正常工作，则可能存在漏洞。如果目标IIS服务崩溃，则说明POC可能有效。实际环境中利用的成功率还受到网络环境等多种因素的影响。

**投毒风险：**  分析提供的Python脚本（CVE-2021-31166.py和CVE-2022-21907.py）后，未发现明显的恶意代码或后门。脚本的主要功能是发送特制的HTTP请求，并根据服务器的响应来判断是否存在漏洞。 脚本会检查服务器是否仍在运行。代码看起来是合法的漏洞利用尝试，风险为0%。

**利用方式：**  漏洞的利用方式是发送特制的 HTTP 请求。关键在于`Accept-Encoding` 头部。 脚本（CVE-2021-31166.py）中使用的`Accept-Encoding`头是`'Accept-Encoding': 'doar-e, ftw, imo, ,'`，而CVE-2022-21907.py 使用的是 `'Accept-Encoding': 'AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,'`。通过构造畸形的HTTP头部，可以触发服务器端的内存错误，导致拒绝服务甚至远程代码执行。利用此漏洞，攻击者可以在未经授权的情况下，在服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [0xmaximus/Home-Demolisher](https://github.com/0xmaximus/Home-Demolisher)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #3

**来源**: [CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md](../2021/CVE-2021-31166-ZZ-SOCMAP_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #4

**来源**: [CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md](../2021/CVE-2021-31166-bgsilvait_WIn-CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2，版本低于 10.0.19041.982 和 10.0.19042.982

**利用条件:** 需要目标服务器开启HTTP服务，且攻击者可以发送HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞，存在于 Windows 的 http.sys 组件中。攻击者可以通过发送特制的 HTTP 请求，触发 use-after-free 漏洞，从而在目标系统上执行任意代码。

**漏洞利用有效性：**

根据漏洞库信息和漏洞利用代码，该漏洞的利用是可行的。CISA已将此漏洞添加到已知被利用的漏洞目录中，表明该漏洞已经被攻击者利用。提供的漏洞利用代码是一个 Terraform 脚本，用于搭建一个包含易受攻击的 Windows 服务器的测试环境。攻击者可以利用该环境进行漏洞验证和利用。漏洞利用代码中使用了特定的 `Accept-Encoding` 头来触发漏洞。

**投毒风险：**

该仓库的投毒风险较低，约为10%。虽然 Terraform 脚本用于部署基础架构，但攻击向量主要集中在特定的HTTP请求头。以下几点降低了投毒风险：
* 代码主要用于自动化部署环境，方便复现漏洞。
* 攻击Payload 通过特殊的HTTP头部注入，较为明显,容易识别。
* 仓库目的是为了演示漏洞利用，并提供了 WAF 规则进行防御。

仍然存在一些小的风险：
* Terraform配置可能包含未知的配置错误，导致部署的环境存在额外的安全隐患。
* 在实际利用过程中，攻击者可能修改 Payload 来绕过检测。

**漏洞利用方式：**

1.  **环境搭建：** 使用 Terraform 脚本搭建包含易受攻击的 Windows Server 的测试环境。
2.  **发送恶意请求：** 向目标服务器发送包含特定 `Accept-Encoding` 头的 HTTP 请求，例如 `Accept-Encoding: doar-e, ftw, imo, ,`。
3.  **触发漏洞：** 恶意请求会触发 http.sys 中的 use-after-free 漏洞。
4.  **执行代码：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码，获得系统控制权。

**缓解措施：**

*   安装 Microsoft 提供的安全更新。
*   部署 WAF 规则来阻止包含恶意 `Accept-Encoding` 头的请求。
*   监控 HTTP 请求，检测异常的 `Accept-Encoding` 头。

**项目地址:** [bgsilvait/WIn-CVE-2021-31166](https://github.com/bgsilvait/WIn-CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #5

**来源**: [CVE-2021-31166-corelight_CVE-2021-31166.md](../2021/CVE-2021-31166-corelight_CVE-2021-31166.md)

## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #6

**来源**: [CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md](../2021/CVE-2021-31166-imikoYa_CVE-2021-31166-exploit.md)

## CVE-2021-31166 (HTTP Protocol Stack Remote Code Execution Vulnerability)

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows 10 Version 2004 (小于10.0.19041.982), Windows Server version 2004 (小于10.0.19041.982), Windows 10 Version 20H2 (小于10.0.19042.982), Windows Server version 20H2 (小于10.0.19042.982)

**利用条件:** 目标系统运行存在漏洞版本的HTTP.sys服务，攻击者需要能够发送HTTP请求到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于Microsoft Windows HTTP.sys中。攻击者可以通过发送特制的HTTP请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的Windows 10和Windows Server。根据CISA KEV目录，该漏洞已被积极利用。

**有效性：**
提供的README.md文件本身并不是漏洞利用代码，而是描述了受影响的版本。根据漏洞库信息，以及搜索引擎可能返回的有效利用信息（虽然这里为空），初步判断此漏洞存在可利用的PoC。

**投毒风险：**
提供的POC代码（README.md）仅描述了受影响的版本，本身并不包含恶意代码。但考虑到通常漏洞利用会包含多个文件,比如exp.py,利用脚本等, 风险评估如下:
 - 直接投毒代码：0% (因为只提供了README.md)
 - 潜在投毒风险：10% (由于缺乏实际的漏洞利用代码，无法判断是否存在隐藏的恶意代码，例如通过下载恶意payload执行)

**利用方式：**
根据漏洞描述，攻击者需要构造恶意的HTTP请求并将其发送到目标服务器。该请求会触发HTTP.sys中的漏洞，导致远程代码执行。具体利用方式可能涉及精心构造的HTTP头或请求体，利用 Use-After-Free 漏洞等。


**项目地址:** [imikoYa/CVE-2021-31166-exploit](https://github.com/imikoYa/CVE-2021-31166-exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #7

**来源**: [CVE-2021-31166-mauricelambert_CVE-2021-31166.md](../2021/CVE-2021-31166-mauricelambert_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)/拒绝服务 (DoS)

**影响应用:** Microsoft Windows HTTP Protocol Stack

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要运行受影响版本的 Windows 并且启用了 HTTP 服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个 HTTP 协议栈的远程代码执行漏洞。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。CISA 已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。

提供的 PowerShell 和 Ruby 脚本均旨在利用此漏洞进行拒绝服务 (DoS) 攻击，导致蓝屏死机 (BSOD)。它们通过发送特制的 HTTP 请求，其中包含包含大量随机字符串的 `Accept-Encoding` 标头来触发漏洞。该标头会造成 HTTP 协议栈处理异常，最终导致崩溃。

**有效性:**
根据提供的漏洞利用代码，该漏洞的利用方法是通过发送畸形的 HTTP 请求，特别是 `Accept-Encoding` 字段，来触发 Windows HTTP 协议栈的异常，导致拒绝服务攻击，使系统蓝屏。鉴于CISA已经将其加入到已知被利用漏洞库，可以认为该漏洞是有效的，并且在野外已经被利用。

**投毒风险:**
分析提供的 PowerShell 和 Ruby 脚本，未发现明显的恶意代码或后门。这些脚本主要用于生成包含大量随机字符串的 `Accept-Encoding` 标头，以触发漏洞。脚本的目的是导致目标系统崩溃，而不是植入后门或执行其他恶意操作。因此，投毒风险较低。但需要注意的是，由于脚本运行后会导致系统崩溃，所以存在一定的误报风险，在使用过程中务必谨慎。

**利用方式:**

1.  **选择目标:** 确定运行受影响版本的 Windows 系统的目标服务器。
2.  **准备攻击环境:**  准备一台能够发送 HTTP 请求的机器，并安装 PowerShell 或 Ruby 环境。
3.  **配置脚本:** 修改提供的 PowerShell 或 Ruby 脚本，设置目标服务器的 IP 地址或域名。
4.  **发送恶意请求:**  运行脚本，向目标服务器发送包含特制 `Accept-Encoding` 标头的 HTTP 请求。
5.  **触发漏洞:**  目标服务器的 HTTP 协议栈在处理恶意请求时发生异常，导致系统崩溃并蓝屏。

该漏洞主要影响的是Windows HTTP 协议栈的稳定性，攻击者可以利用该漏洞发起拒绝服务攻击，使得服务器无法正常提供服务。虽然提供的 PoC 主要展示了 DoS 攻击，但是根据漏洞描述，也存在远程代码执行的风险，需要及时修复。

**项目地址:** [mauricelambert/CVE-2021-31166](https://github.com/mauricelambert/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #8

**来源**: [CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md](../2021/CVE-2021-31166-mvlnetdev_CVE-2021-31166-detection-rules.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2（受影响版本低于特定Build版本）

**利用条件:** 需要攻击者能够发送特制的HTTP请求到受影响的服务器，目标服务器开启了IIS、WinRM或WSDAPI服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于 Windows HTTP.sys 中。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，成功利用此漏洞的攻击者可以在目标系统上执行任意代码。根据漏洞信息，受影响的组件包括IIS，WinRM，WSDAPI。从提供的漏洞利用代码来看，其目的是通过 Zeek (Bro) 网络安全监控工具检测 CVE-2021-31166 的利用行为。该代码本身是一段 Zeek 脚本，用于分析网络流量，并检测包含特定恶意模式（`/[^[:space:]]+,[[:space:]]{0,},$/`，在`ACCEPT-ENCODING`头中）的 HTTP 请求。当检测到匹配的请求时，脚本会记录一个通知。此外，该脚本还会监控受攻击主机是否出现TCP重传过多的情况，这可能表明目标主机崩溃或拒绝服务。因此该Zeek脚本本身不能用于直接攻击目标，而是用于检测攻击行为。

**有效性：**  提供的代码本身是检测规则，并不是直接利用漏洞的 PoC 代码。但是，它依赖于初始 PoC（参考了 `https://github.com/0vercl0k/CVE-2021-31166`），所以间接证明了漏洞的可利用性。

**投毒风险：**  由于该代码主要是检测规则，因此直接的投毒风险较低。潜在的风险可能在于，如果攻击者能够控制 Zeek 脚本的部署环境，他们可以修改脚本以忽略某些恶意流量，或者触发误报，从而干扰安全监控。但是，从代码本身来看，并没有明显的恶意代码或后门。因此，投毒风险较低，估算为10%。脚本中存在可配置项，例如 `learn_iis_webservers` 和 `iis_websubnets`，如果配置不当可能会导致检测范围错误，但这些属于配置问题，而非投毒。

**利用方式：**
1.  攻击者需要向目标服务器发送包含特制 `Accept-Encoding` 头的 HTTP 请求，该请求的 `Accept-Encoding` 头的格式需要匹配正则表达式 `/[^[:space:]]+,[[:space:]]{0,},$/`。
2.  成功利用该漏洞可能导致远程代码执行，攻击者可以在目标系统上执行任意代码。
3.  受影响的服务包括 IIS，WinRM，WSDAPI。
4. 提供的Zeek脚本用于检测利用漏洞的流量模式，但不能直接利用该漏洞。

**项目地址:** [mvlnetdev/CVE-2021-31166-detection-rules](https://github.com/mvlnetdev/CVE-2021-31166-detection-rules)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---



---

## POC #9

**来源**: [CVE-2021-31166-qazbnme_CVE-2021.md](../2021/CVE-2021-31166-qazbnme_CVE-2021.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 需要目标系统开启HTTP服务且存在漏洞版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息，CVE-2021-31166 是一个 HTTP 协议栈远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞在目标系统上执行任意代码。漏洞影响多个版本的 Windows 10 和 Windows Server。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的漏洞利用代码只有一个行为准则文件，因此无法判断漏洞的利用方式。考虑到漏洞被 CISA 收录，以及CVSS评分为9.8，该漏洞利用的有效性应为高。文件内容本身没有明显的投毒迹象，但考虑到缺乏实际的利用代码，这里假定存在少量投毒风险(10%), 因为可能存在引导使用者下载恶意文件的行为。

**项目地址:** [qazbnme/CVE-2021](https://github.com/qazbnme/CVE-2021)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #10

**来源**: [CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md](../2021/CVE-2021-31166-y0g3sh-99_CVE-2021-31166-Exploit.md)

## CVE-2021-31166-HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈的远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，利用协议栈中的漏洞来执行任意代码。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。CISA已将其添加到已知被利用漏洞目录中，表明该漏洞在野外已被积极利用。提供的Python POC脚本通过发送包含特定'Accept-Encoding'头的HTTP请求来尝试触发漏洞。该脚本的有效性较低，因为它仅通过发送带有特定header的请求来检测服务端是否会崩溃，崩溃被认为是利用成功，但无法直接验证代码执行。存在一定的投毒风险，因为脚本相对简单，容易被修改和重新分发，攻击者可能在其中加入恶意代码，例如反弹shell等，但目前代码未发现异常行为。

**项目地址:** [y0g3sh-99/CVE-2021-31166-Exploit](https://github.com/y0g3sh-99/CVE-2021-31166-Exploit)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #11

**来源**: [CVE-2021-31166-zecopro_CVE-2021-31166.md](../2021/CVE-2021-31166-zecopro_CVE-2021-31166.md)

## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

## POC #12

**来源**: [CVE-2021-31166-zha0gongz1_CVE-2021-31166.md](../2021/CVE-2021-31166-zha0gongz1_CVE-2021-31166.md)

## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)

---

