## CVE-2021-3156 - Sudo 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.8.2 到 1.8.31p2; 1.9.0 到 1.9.5p1

**利用条件:** 具有本地普通用户访问权限，目标系统安装了受影响版本的 Sudo

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：提供的代码是针对 CVE-2021-3156（Baron Samedit）漏洞的一个功能完整的漏洞利用程序。该漏洞源于 Sudo 在处理命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。exploit_launcher.c 文件通过构造特定的命令行参数（以反斜杠结尾）和环境变量（如 LC_ALL）来触发该溢出。具体而言，它利用了 sudoedit -s 模式，其中代码在剥离转义字符时会跳过缓冲区边界。exploit_payload.c 则编写了一个共享对象（Shared Object），利用 GCC 构造函数属性（__attribute__((constructor))）在库加载时自动执行代码。该负载通过 setuid(0) 和 execv("/bin/sh") 尝试获取 root shell。从代码逻辑看，该 POC 针对 Ubuntu 20.04.1 进行了硬编码偏移量调整（如 overflow_a=56, null_bytes=63），这在堆溢出利用中是常见的手段，极大提高了在该特定平台上的成功率。整体 POC 结构清晰，包含 Makefile 自动化编译流程，是一个极具威力的本地提权工具。利用步骤：1. 在受影响的 Linux 系统上下载并解压 POC 源文件；2. 执行 make 命令，编译生成 exploit_it 执行文件和 libnss_X 目录下的恶意共享库；3. 运行 ./exploit_it，该程序会调用 sudoedit 并注入精心构造的参数和环境变量；4. 漏洞触发后，Sudo 会错误地加载 POC 生成的恶意动态库；5. 动态库初始化函数被执行，系统弹出具有 root 权限的 shell。投毒风险分析：该 POC 的投毒风险极低。通过对源代码的静态审计，可以确认 Makefile 仅涉及标准的编译命令（gcc），没有远程下载脚本（curl/wget）或混淆操作。exploit_launcher.c 的代码完全基于标准 C 库，功能仅限于设置 exploit 所需的环境变量和调用 execve。exploit_payload.c 虽然包含 setuid(0) 等具有破坏性的操作，但这属于提权 POC 的标准行为，并非针对研究人员主机的恶意后门。代码中没有发现任何网络通信、敏感文件窃取（如 ~/.ssh/id_rsa）或持久化后门安装逻辑。文件路径使用 /tmp 目录且逻辑透明，不具备恶意软件的典型隐匿特征。对于安全研究人员而言，这是一个安全的、可用于防御性测试的参考实现。

**项目地址:** 本地提取

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
