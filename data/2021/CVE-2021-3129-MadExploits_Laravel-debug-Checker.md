## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式 (APP_DEBUG=true)，且Ignition版本处于受影响范围。

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：本POC（Laravel-debug-Checker）是一个基于Python开发的扫描工具，旨在检测目标站点是否存在CVE-2021-3129漏洞。该漏洞的根源在于Laravel默认的错误页渲染组件Ignition中，针对`file_get_contents()`和`file_put_contents()`等函数的使用未经过充分过滤，允许攻击者通过特定接口（如`_ignition/health-check`）触发Phar反序列化。本POC代码逻辑清晰，通过requests库向目标路径发起GET请求，检查返回包中是否包含`{"can_execute_commands":true}`，这是确认Ignition组件健康检查接口暴露且允许执行某些操作的典型标志。虽然该POC仅实现了漏洞存在性的检测（Scanner），并未包含完整的Getshell载荷构造（如Log投毒或Phar文件伪造），但其检测逻辑与漏洞触发的前提条件完全吻合。利用步骤：1. 确认目标Laravel应用已开启Debug模式。2. 访问`/_ignition/health-check`接口，若返回特定JSON结果则证明基础环境触发可能。3. 在完整攻击中，攻击者会利用`view_config`漏洞，通过`php://filter`流将恶意Phar内容写入日志文件，最后利用`phar://`协议触发反序列化执行任意代码。本工具极大简化了第一步的筛选过程。投毒风险分析：经过对提供的`laravel_debug.py`源代码进行审计，未发现明显的恶意行为或投毒迹象。代码使用了标准的Python库如requests、multiprocessing和colorama，没有进行代码混淆，且外部依赖项在`requirements.txt`中均指向官方PyPI库（requests、colorama、pycryptodome）。其核心逻辑是简单的HTTP请求发送与字符串匹配，结果仅保存在本地的`laravel-log.txt`中，不涉及敏感信息的远程外泄或反弹Shell操作。值得注意的是，`requirements.txt`中虽然引入了`pycryptodome`，但在脚本中并未使用，这可能是为了后续扩展开发预留或从其他项目中复制而来。对于此类安全工具，建议在隔离环境运行，以防其潜在的自动化扫描行为触发安全警报或违反当地合规性要求。整体而言，该项目属于透明的防御性扫描工具，投毒风险较低。

**项目地址:** [https://github.com/MadExploits/Laravel-debug-Checker](https://github.com/MadExploits/Laravel-debug-Checker)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
