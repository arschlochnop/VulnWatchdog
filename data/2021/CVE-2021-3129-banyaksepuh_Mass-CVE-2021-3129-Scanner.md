## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** Laravel < 8.4.2, Ignition < 2.5.2

**利用条件:** Laravel开启Debug模式，且使用了受影响版本的Ignition组件。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该提供的POC代码是一个基于Bash脚本的批量漏洞扫描器。其核心逻辑非常简单，主要通过curl向目标主机的`/_ignition/execute-solution`路径发送GET请求，并检查响应体中是否包含‘The GET method is not supported for this route. Supported methods: POST.’这一特定字符串。根据Laravel及其Ignition组件的路由定义，如果该路径存在并返回此特定报错，则意味着Ignition组件已安装且处于可访问状态。然而，此POC仅能作为‘存在性检查’，即确定目标是否开启了Debug模式并暴露了Ignition接口，并不能实际执行反序列化利用。真正的利用需要通过POST请求发送精心构造的Payload，利用Laravel文件操作函数（file_get_contents/file_put_contents）配合php://filter伪协议及Phar反序列化技术来触发。该POC在自动化侦察阶段具有一定参考价值，但在实际防御测试中缺乏深度。利用步骤如下：1. 确认目标网站开启Debug模式；2. 攻击者通过Ignition提供的`run-solution`接口尝试清空现有日志；3. 通过一系列特定的Log写入操作，将编码后的Payload注入到Laravel日志文件中；4. 利用`php://filter`流包装器读取日志文件并通过`phar://`协议触发反序列化，最终实现RCE。整个过程对环境依赖较低，一旦开启Debug模式，利用链条非常稳固。 【投毒风险分析】经过对提供的Bash脚本代码分析，投毒风险评级为低（10%）。脚本逻辑透明，使用了标准的Linux命令如curl、tput、cat和if-else结构。代码中并未发现混淆、动态下载外部恶意负载、非对称加密通信或反弹Shell等典型的后门特征。其ASCII艺术字和颜色设置属于常见的脚本修饰。唯一的潜在风险点在于用户可能盲目运行来源不明的自动化脚本，脚本内部虽然目前仅指向目标站点的特定路径，但在复杂的供应链攻击中，这类批量扫描工具可能被植入静默向开发者服务器发送本地敏感信息（如环境变量、SSH密钥）的指令。此脚本中，变量SITE直接由外部list.txt读入，并未进行严格过滤，若攻击者在list.txt中构造畸形数据，可能触发本地环境的执行异常。总体而言，该脚本作为扫描工具是相对安全的，但其‘批量扫描’属性更偏向于红队侦察工具，不建议在未授权的情况下在生产环境中使用。组织应重点防御此漏洞，通过关闭Debug模式或升级Ignition组件来阻断此类探测。

**项目地址:** 无 (代码来源于vulnwatchdog临时提取)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
