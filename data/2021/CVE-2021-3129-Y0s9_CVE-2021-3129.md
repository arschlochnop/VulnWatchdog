## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式 (APP_DEBUG=true)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞源于Laravel默认错误页渲染组件Ignition对log文件处理不当。POC代码逻辑完整，通过利用Ignition提供的MakeViewVariableOptionalSolution接口，结合PHP过滤器流（php://filter）对laravel.log进行多次编码转换，从而清理日志并注入Phar反序列化Payload。脚本中包含monolog/rce1等多个Gadget链，通过调用外部phpggc工具生成Payload，并使用convert.quoted-printable-encode等过滤器规避字符限制，最终触发Phar反序列化实现命令执行。此POC结构清晰，具备自动化检测、Payload生成、日志清理及命令执行功能，配合vulhub镜像验证具有极高成功率。利用步骤：1. 确认目标Laravel环境开启Debug模式且Ignition版本受影响。2. 在本地准备phpggc工具环境。3. 运行exploit.py，指定目标URL和待执行命令。4. 脚本首先清空laravel.log，随后将生成的Phar Payload写入日志，最后通过file_get_contents触发phar协议解析执行命令。投毒风险分析：该POC代码逻辑透明，主要依赖Python标准库（requests, os, uuid, sys）和外部合法的PHP反序列化利用工具phpggc。代码中未发现明显的混淆、恶意后门、隐藏的网络外带请求或针对研究员机器的破坏性操作。脚本通过uuid生成随机定界符来定位命令执行结果，显示了较好的工程化水平。虽然代码涉及文件写入和日志清理，但属于针对目标靶机的漏洞利用必要环节，非投毒行为。潜在风险在于exploit.py会通过os.system调用本地PHP命令，若用户本地PHP环境被劫持可能存在本地执行风险，且代码提示用户需自行git clone phpggc，需防范第三方克隆源的安全性。总体而言，该代码作为安全研究使用时投毒风险较低，属于可信的漏洞复现工具，但建议在隔离的沙箱环境中运行以规避供应链攻击风险。

**项目地址:** [https://github.com/ambionics/phpggc](https://github.com/ambionics/phpggc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
