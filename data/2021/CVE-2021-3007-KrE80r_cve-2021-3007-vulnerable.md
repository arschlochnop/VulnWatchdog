## CVE-2021-3007 - Zend Framework 反序列化RCE

**漏洞编号:** CVE-2021-3007

**漏洞类型:** 反序列化RCE

**影响应用:** Zend Framework

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** Zend Framework 3.0.0 及更高版本; Laminas HTTP < 2.14.2

**利用条件:** 需要网络访问，攻击者可以发送恶意请求触发反序列化。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2021-3007 是 Zend Framework 中的一个反序列化漏洞，该漏洞源于不安全的对象反序列化。在Zend Framework 3.0.0及更高版本中，攻击者可以利用 Zend Framework 从对象中加载类的特性，通过发送特制的请求到服务器，从而执行任意代码。该漏洞存在于`Zend_Http_Response_Stream`类中，当应用程序尝试反序列化不受信任的数据时，攻击者可以控制反序列化的对象，进而执行恶意代码。

POC有效性分析：
提供的 Dockerfile 文件可以快速搭建一个存在 CVE-2021-3007 漏洞的测试环境。通过 composer 安装了存在漏洞的 laminas/laminas-http 2.14.1 版本。Dockerfile 还包含健康检查，确保应用正常运行。README.md 文件提供了详细的漏洞信息，包括 CVSS 评分、受影响的版本以及利用步骤。

利用步骤：
1. 克隆包含 Dockerfile 的项目： `git clone https://github.com/KrE80r/CVE-2021-3007-vulnerable`
2. 使用 Docker Compose 启动环境：`docker-compose up -d`
3. 发送特制的 HTTP 请求，其中包含恶意序列化数据。该数据会触发 Zend Framework 中的反序列化漏洞，从而执行任意代码。具体payload构造细节参考相关安全研究文章。
4. 验证代码执行情况，例如通过反弹 shell 或执行系统命令。

投毒风险分析：
该 POC 的主要目的是为了安全测试和漏洞验证，本身不包含恶意代码。Dockerfile 清晰地定义了环境依赖和配置，没有发现混淆代码或恶意行为。虽然利用反序列化漏洞本身具有一定的风险，但提供的 POC 侧重于漏洞的重现和验证，而非恶意攻击。风险主要在于如果攻击者使用此POC创建了恶意payload，并将其传播给其他用户。由于POC的目的是演示RCE，所以payload中可能会包含执行任意命令的代码，如果这些代码被恶意修改，可能会造成破坏。虽然composer配置中禁用了audit，允许superuser，但这只是为了快速搭建测试环境，不属于恶意行为。总的来说，该POC的投毒风险较低，主要是由于其清晰的代码结构和明确的测试目的。但用户仍需注意payload的构造和使用，避免被恶意利用。

**项目地址:** https://github.com/KrE80r/CVE-2021-3007-vulnerable

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2021-3007
