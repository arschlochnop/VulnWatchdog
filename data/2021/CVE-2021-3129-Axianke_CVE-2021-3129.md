## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Ignition < 2.5.2 (Laravel < 8.4.2)

**利用条件:** Laravel框架开启Debug模式 (APP_DEBUG=true)，且安装并使用了特定版本的Ignition组件。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC代码是一个针对CVE-2021-3129漏洞的自动化利用工具，其核心原理是利用Laravel Debug页面（Ignition）对文件读写函数的不安全处理，结合Phar反序列化实现RCE。代码结构清晰，通过调用外部工具phpggc生成针对不同利用链（如laravel/rce1-16, monolog/rce1-9）的Phar payload。POC实现了自动化探测漏洞是否存在（poc函数）、清空日志（cleanlog函数）以及多步构造Payload并最终触发执行的过程。分析显示，该POC通过连续发送构造好的恶意请求，将Base64编码的Phar内容注入到laravel.log中，再通过php://filter/read=convert.quoted-printable-decode/resource=../storage/logs/laravel.log等过滤器处理日志内容，最后利用phar://伪协议触发反序列化。此POC具备高度的实战性，能够根据不同的目标环境自动尝试多种利用链，是一个功能相对完整的漏洞利用脚本。代码中包含了详细的利用逻辑，从环境检测到最终的命令执行，步骤完整且符合技术原理。【利用步骤】1. 环境准备：确保本地拥有phpggc工具并位于POC同级目录；2. 漏洞探测：通过访问_ignition/execute-solution接口，根据返回状态码判断是否开启了Debug模式；3. 清空日志：发送特定请求，利用convert.iconv过滤器清空目标主机的laravel.log，为Payload注入做准备；4. 写入Payload：将生成的Phar Payload通过Base64编码并结合过滤器分批写入日志文件；5. 触发执行：使用phar://协议指向生成的日志文件，触发反序列化以执行系统命令。【投毒风险分析】经过对提供的Python源代码进行深入审查，该脚本属于开源安全研究工具的典型表现形式，其代码逻辑公开透明。投毒风险极低，主要基于以下几点：首先，脚本使用的库均为Python标准库（如argparse, base64, re）和常见的第三方库（requests, urllib3, colorama, pyfiglet），未发现引入不明来源的恶意二进制文件或远程恶意URL。其次，核心逻辑在于本地调用phpggc生成Payload，并在本地进行Base64编码处理，所有敏感操作均在研究员可控的本地环境中进行。脚本中虽然存在os.system(command)调用，但其目的是调用本地的phpggc工具，而非执行下载器或后门。最后，代码中没有发现任何试图窃取研究员本地敏感信息（如SSH密钥、浏览器Cookie、环境变量）或建立反向Shell回传至攻击者控制端（C2）的行为。尽管如此，使用者仍需注意其调用的phpggc是否来自官方渠道，因为投毒风险往往潜伏于此类配套的第三方Payload生成器中。综合评估，该POC脚本本身安全，属于合法的安全研究范畴，无明显恶意后门特征。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
