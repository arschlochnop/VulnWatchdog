# CVE-2021-34527

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-34527-0xirison_PrintNightmare-Patcher.md](../2021/CVE-2021-34527-0xirison_PrintNightmare-Patcher.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本及更新低于安全公告中指定的版本

**利用条件:** Print Spooler服务运行，且未安装相应的安全更新

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是 Windows Print Spooler 服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以 SYSTEM 权限运行任意代码。根据漏洞库信息和搜索结果，该漏洞影响多个 Windows 版本。利用方式通常涉及滥用 `RpcAddPrinterDriverEx()` 函数来加载恶意驱动程序。提供的漏洞利用代码 `printnightmare-patcher.py` 并非漏洞利用程序，而是一个补丁程序，用于检测系统是否存在漏洞，并尝试安装补丁或修改注册表设置以缓解风险。此工具会检查是否存在 KB5004954 补丁，如果未安装，则尝试使用 PowerShell 安装。 它还检查 PointAndPrint 注册表项。 由于此脚本目的是缓解漏洞而不是利用漏洞，因此它本身不包含任何显式的“投毒”代码。 但是，任何修改系统设置的脚本都有潜在风险。 在这种情况下，如果此脚本安装了错误的更新（可能性很小，除非用户篡改脚本），或者意外禁用了打印后台处理程序，则可能会导致系统不稳定或打印功能中断。因此，存在一定的投毒风险，估计为10%。

漏洞利用方式如下：

1.  **远程代码执行:** 攻击者利用Print Spooler服务中的漏洞，通过网络发送恶意请求，实现在目标系统上执行任意代码。
2.  **SYSTEM权限:** 成功利用漏洞后，攻击者获得的权限是SYSTEM，这是Windows系统中最高的权限。
3.  **DLL注入:** 漏洞通常涉及将恶意的DLL文件注入到Print Spooler服务进程中。
4.  **绕过安全措施:** 某些已知的利用方法可以绕过Point and Print的限制，即使这些限制已经配置。

**项目地址:** [0xirison/PrintNightmare-Patcher](https://github.com/0xirison/PrintNightmare-Patcher)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #2

**来源**: [CVE-2021-34527-AUSK1LL9_CVE-2021-34527.md](../2021/CVE-2021-34527-AUSK1LL9_CVE-2021-34527.md)

# CVE-2021-34527

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-34527-0xirison_PrintNightmare-Patcher.md](../2021/CVE-2021-34527-0xirison_PrintNightmare-Patcher.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本及更新低于安全公告中指定的版本

**利用条件:** Print Spooler服务运行，且未安装相应的安全更新

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是 Windows Print Spooler 服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以 SYSTEM 权限运行任意代码。根据漏洞库信息和搜索结果，该漏洞影响多个 Windows 版本。利用方式通常涉及滥用 `RpcAddPrinterDriverEx()` 函数来加载恶意驱动程序。提供的漏洞利用代码 `printnightmare-patcher.py` 并非漏洞利用程序，而是一个补丁程序，用于检测系统是否存在漏洞，并尝试安装补丁或修改注册表设置以缓解风险。此工具会检查是否存在 KB5004954 补丁，如果未安装，则尝试使用 PowerShell 安装。 它还检查 PointAndPrint 注册表项。 由于此脚本目的是缓解漏洞而不是利用漏洞，因此它本身不包含任何显式的“投毒”代码。 但是，任何修改系统设置的脚本都有潜在风险。 在这种情况下，如果此脚本安装了错误的更新（可能性很小，除非用户篡改脚本），或者意外禁用了打印后台处理程序，则可能会导致系统不稳定或打印功能中断。因此，存在一定的投毒风险，估计为10%。

漏洞利用方式如下：

1.  **远程代码执行:** 攻击者利用Print Spooler服务中的漏洞，通过网络发送恶意请求，实现在目标系统上执行任意代码。
2.  **SYSTEM权限:** 成功利用漏洞后，攻击者获得的权限是SYSTEM，这是Windows系统中最高的权限。
3.  **DLL注入:** 漏洞通常涉及将恶意的DLL文件注入到Print Spooler服务进程中。
4.  **绕过安全措施:** 某些已知的利用方法可以绕过Point and Print的限制，即使这些限制已经配置。

**项目地址:** [0xirison/PrintNightmare-Patcher](https://github.com/0xirison/PrintNightmare-Patcher)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #2

**来源**: [CVE-2021-34527-AUSK1LL9_CVE-2021-34527.md](../2021/CVE-2021-34527-AUSK1LL9_CVE-2021-34527.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE) / 本地权限提升 (LPE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致远程代码执行，系统完全控制

**影响版本:** 受影响的Windows版本众多，具体请参考漏洞库信息。

**利用条件:** 需要目标系统开启Print Spooler服务，在某些利用场景下，可能需要经过身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是一个Windows Print Spooler服务中的严重漏洞。攻击者可以利用此漏洞在目标系统上执行任意代码，获得SYSTEM权限。搜索引擎结果显示，此漏洞影响广泛，并且存在公开的PoC。提供的漏洞利用代码是一个PowerShell脚本，它通过利用Print Spooler服务的漏洞来实现本地权限提升。该脚本通过嵌入Base64编码的GZIP压缩DLL payload，并根据用户提供的参数进行修改，然后将其加载到Print Spooler服务中。该DLL payload的默认行为是向本地管理员组添加新用户。利用方式主要有两种：一种是远程代码执行，需要网络访问；另一种是本地权限提升，攻击者需要在目标系统上已经具有一定的权限。分析PoC代码，发现其主要功能是权限提升，并没有明显的恶意代码。但是，用户在使用自定义DLL payload时，存在被投毒的风险。因此，虽然PoC本身看起来没有明显的投毒行为，但用户需要谨慎使用自定义DLL，避免加载恶意代码。

**项目地址:** [AUSK1LL9/CVE-2021-34527](https://github.com/AUSK1LL9/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #3

**来源**: [CVE-2021-34527-Amaranese_CVE-2021-34527.md](../2021/CVE-2021-34527-Amaranese_CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致SYSTEM权限的远程代码执行

**影响版本:** 受影响的Windows版本及补丁版本之前

**利用条件:** 攻击者需要能够与目标系统的打印服务通信（通常是445端口，但可能配置为其他端口），并需要用户权限（尽管存在本地提权变种）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以利用此漏洞以 SYSTEM 权限执行任意代码。根据漏洞库信息，多个 Windows 版本都受到影响，直到相应的安全更新发布。搜索结果也表明该漏洞是一个严重的安全问题，并被称为"PrintNightmare"。

**有效性分析：**

提供的 PowerShell 脚本 (CVE-2021-34527.PS1) 旨在利用 PrintNightmare 漏洞。该脚本允许攻击者添加一个新的本地管理员用户，或执行自定义 DLL 代码作为 NT AUTHORITY\SYSTEM。脚本通过 `AddPrinterDriverEx` 函数加载恶意的打印机驱动程序来实现代码执行。

**投毒风险分析：**

虽然脚本的主要功能是利用 PrintNightmare 漏洞，但存在少量投毒风险。

1.  **默认凭据：** 脚本默认创建一个用户名为 `adm1n`，密码为 `P@ssw0rd` 的管理员帐户。如果攻击者直接使用默认配置，可能使得目标系统容易被其他攻击者利用。
2.  **DLL来源：** 脚本允许指定自定义的 DLL。如果攻击者从不可信的来源下载 DLL，则可能执行恶意代码，反过来感染攻击者的系统。
3.  **编码方式：** 使用 `UnicodeEncoding` 可能会引入一些问题，因为有些系统可能使用不同的编码方式。尽管这不是直接的投毒，但可能导致利用失败。
4.  **依赖性：** 脚本依赖于特定的 Windows API 和 DLL 文件。如果这些 API 或 DLL 不可用或行为发生变化，脚本可能无法正常工作。

**利用方式分析：**

利用方式主要步骤如下：

1.  **准备恶意DLL：** 攻击者需要准备一个包含恶意代码的 DLL 文件。提供的脚本可以生成一个默认的 DLL，该 DLL 将创建一个新的本地管理员用户。或者，攻击者可以提供自己的 DLL。
2.  **执行PowerShell脚本：** 攻击者需要在目标系统上执行提供的 PowerShell 脚本。需要具有一定的用户权限才能执行该脚本。
3.  **加载恶意驱动：** 脚本使用 `AddPrinterDriverEx` 函数将恶意 DLL 加载为打印机驱动程序。由于 Print Spooler 服务以 SYSTEM 权限运行，因此 DLL 中的代码也将以 SYSTEM 权限执行。
4.  **代码执行：** 恶意 DLL 中的代码被执行，从而允许攻击者控制目标系统。

**结论：**
提供的 POC 代码有效，但存在少量投毒风险（大约 10%）。攻击者需要注意使用安全的 DLL 来源，并避免使用默认凭据。

**项目地址:** [Amaranese/CVE-2021-34527](https://github.com/Amaranese/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #4

**来源**: [CVE-2021-34527-Eutectico_Printnightmare.md](../2021/CVE-2021-34527-Eutectico_Printnightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响版本见漏洞库信息

**利用条件:** 需要网络访问，且目标系统存在漏洞版本的Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。根据漏洞库信息和搜索引擎结果，该漏洞影响多个Windows版本。提供的POC代码旨在缓解该漏洞，主要通过禁用Print Spooler服务以及拒绝驱动程序安装来实现。漏洞利用方式通常涉及向Print Spooler服务发送特制的打印请求，导致服务加载并执行恶意的DLL文件。 

**有效性：** 提供的POC代码并非漏洞利用代码，而是缓解措施，用于禁用Print Spooler服务并阻止恶意驱动程序的安装。因此，它不能用于验证漏洞的存在，而是用于降低漏洞带来的风险。

**投毒风险：** 提供的代码主要包含PowerShell脚本和CMD脚本，用于禁用Print Spooler服务和配置驱动程序安装权限。初步分析表明，代码本身没有明显的恶意行为，但存在以下潜在风险：

1.  **误用/滥用：** 如果攻击者能够控制这些脚本的执行，他们可能选择性地禁用或启用某些安全措施，从而为进一步的攻击打开方便之门。
2.  **依赖外部文件 (serverlist.txt)：** `disable-spooler.cmd`脚本依赖于`serverlist.txt`文件，如果该文件被篡改，可能导致意外的服务器被禁用Print Spooler服务，从而影响业务连续性。
3.  **权限提升：** 虽然脚本本身没有直接提权操作，但如果运行脚本的用户权限不足，可能会导致脚本执行失败，留下安全隐患。

因此，综合考虑，投毒风险较低，估计在10%左右。 主要的风险在于脚本被恶意修改或被利用进行拒绝服务攻击（禁用打印服务）。

**利用方式：**  PrintNightmare漏洞的利用方式通常涉及以下步骤：

1.  **利用未经授权的打印机驱动程序安装：** 攻击者可以使用`AddPrinterDriverEx`函数，上传并安装恶意的打印机驱动程序。
2.  **DLL注入：** 恶意的驱动程序实际上是一个DLL文件，当Print Spooler服务加载该驱动程序时，DLL中的代码会被执行，从而实现远程代码执行。
3.  **SYSTEM权限获取：** 由于Print Spooler服务以SYSTEM权限运行，因此注入的DLL代码也会以SYSTEM权限执行。

需要注意的是，微软已经发布了针对此漏洞的补丁。建议用户及时安装补丁，并采取其他缓解措施，例如禁用Print Spooler服务（如果不需要打印功能）或限制驱动程序安装权限。

**项目地址:** [Eutectico/Printnightmare](https://github.com/Eutectico/Printnightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #5

**来源**: [CVE-2021-34527-Tomparte_PrintNightmare.md](../2021/CVE-2021-34527-Tomparte_PrintNightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE) / 本地提权 (LPE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致远程代码执行和系统权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 打印服务未打补丁或配置不当，可能需要一定权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的关键漏洞，允许经过身份验证的用户（在某些配置下，甚至可能未经身份验证）以SYSTEM权限执行远程代码。虽然微软发布了补丁，但最初的补丁并不完全有效，特别是对于本地提权（LPE）。

**有效性:**
从搜索结果和漏洞库信息来看，该漏洞是真实存在的，并且已被积极利用。提供的POC代码实际上**并非漏洞利用代码**，而是**缓解措施**。它通过修改注册表键来限制打印客户端连接和禁用安装打印机驱动时的警告和提权提示，以降低漏洞被利用的风险。

**投毒风险:**
该仓库的目的是提供缓解措施，而不是漏洞利用。尽管如此，任何代码库都存在潜在的投毒风险。此处的风险较低，约为10%，原因如下：
*   代码相对简单，易于审查。
*   代码主要操作注册表，影响系统策略，而非直接执行恶意代码。
*   作者提供了多个参考链接，方便用户验证代码的正确性。
但是，仍然存在一些风险：
*   恶意作者可能在脚本中添加额外的注册表修改，导致系统不稳定或出现其他问题。
*   批处理脚本可能被修改以执行其他命令，但这种修改相对容易被发现。

**利用方式:**
根据漏洞信息和搜索结果，攻击者可以利用此漏洞通过以下步骤执行任意代码：
1.  利用不安全的打印机驱动程序安装机制。
2.  上传并安装特制的恶意驱动程序。
3.  该恶意驱动程序以SYSTEM权限运行，允许攻击者完全控制系统。

需要注意的是，提供的POC代码是用来缓解漏洞的，通过修改注册表禁用或限制某些功能以降低攻击面，而不是利用漏洞本身。 它试图通过设置 `RegisterSpoolerRemoteRpcEndPoint`, `NoWarningNoElevationOnInstall`, 和 `UpdatePromptSettings` 注册表项来缓解漏洞，而不是利用漏洞。 然而，也存在潜在的投毒风险，即作者可能在脚本中包含了额外的、未说明的恶意操作。 用户在使用任何第三方脚本之前，都应该进行仔细审查。

**项目地址:** [Tomparte/PrintNightmare](https://github.com/Tomparte/PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #6

**来源**: [CVE-2021-34527-WidespreadPandemic_CVE-2021-34527_ACL_mitigation.md](../2021/CVE-2021-34527-WidespreadPandemic_CVE-2021-34527_ACL_mitigation.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，详见漏洞库信息

**利用条件:** 需要网络可达，目标系统运行Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞允许经过身份验证的攻击者通过不正确的文件操作，以SYSTEM权限在目标系统上执行任意代码。攻击者可以利用该漏洞安装程序、查看、更改或删除数据，或创建具有完全用户权限的新帐户。

**有效性：**
提供的POC代码实际上是缓解脚本，而非漏洞利用代码。这些PowerShell脚本通过修改`%windir%\System32\spool\drivers`目录的ACL，来阻止SYSTEM账户对该目录进行写入操作，从而缓解PrintNightmare漏洞。脚本`CVE-2021-34527_ACL_Mitigation.ps1`添加ACL规则，拒绝SYSTEM用户对该目录进行写入操作，而`CVE-2021-34527_ACL_Mitigation_Rollback.ps1`则移除这些ACL规则。

**投毒风险：**
虽然提供的脚本本身用于缓解漏洞，但仍存在一定的投毒风险。攻击者可能修改这些脚本，例如：
*   **添加恶意代码：** 在缓解脚本中插入额外的命令，在修改ACL的同时执行恶意操作，例如下载和执行恶意软件。
*   **创建后门：** 通过精心设计的ACL规则，允许特定账户（例如攻击者控制的账户）对`drivers`目录进行写入操作，从而创建一个后门。
鉴于以上风险，判断投毒风险为10%，主要风险在于脚本被篡改。

**利用方式：**
真正的漏洞利用方式（未提供具体exp，根据分析）涉及到滥用`AddPrinterDriverEx`函数，允许低权限用户加载任意驱动程序。攻击者可以上传包含恶意代码的驱动程序，并利用Print Spooler服务以SYSTEM权限加载该驱动，从而实现远程代码执行。ACL缓解脚本通过限制SYSTEM账户对`drivers`目录的写入权限，阻止了恶意驱动程序的上传和加载。


**项目地址:** [WidespreadPandemic/CVE-2021-34527_ACL_mitigation](https://github.com/WidespreadPandemic/CVE-2021-34527_ACL_mitigation)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #7

**来源**: [CVE-2021-34527-byt3bl33d3r_ItWasAllADream.md](../2021/CVE-2021-34527-byt3bl33d3r_ItWasAllADream.md)

## CVE-2021-34527 PrintNightmare RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本，包括但不限于Windows 10, Windows Server 2019, Windows 11

**利用条件:** 需要Active Directory域凭据进行身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。从搜索引擎结果和漏洞库信息来看，该漏洞影响多个Windows版本，并允许经过身份验证的攻击者以SYSTEM权限执行任意代码。提供的漏洞利用代码是一个Python扫描器，用于检测目标子网是否存在PrintNightmare RCE漏洞，它通过模拟攻击者使用的RPC调用来判断主机是否脆弱。

**有效性：**
提供的POC代码本身是一个扫描器，而不是直接的漏洞利用程序。它模拟了攻击中使用的RPC调用，以此来判断目标主机是否存在漏洞。因此，可以认为它在漏洞检测方面是有效的。

**投毒风险：**
虽然POC的主要功能是扫描，但考虑到它包含从github下载的exp,存在一定的风险，需要仔细审查exp代码。此外，Dockerfile包含curl和git命令，存在下载恶意脚本的可能性，但代码本身主要是进行漏洞扫描，没有发现明显的恶意代码或后门。考虑到网络下载依赖，投毒风险评估为10%。

**利用方式：**
1.  **身份验证：**  攻击者需要具有Active Directory域的有效凭据才能利用此漏洞。
2.  **RPC调用：**  攻击者使用MS-PAR和MS-RPRN协议中存在的漏洞函数，向Print Spooler服务发送特制的RPC请求。
3.  **DLL注入：**  攻击者通过`AddPrinterDriverEx`函数安装恶意的打印机驱动程序，该驱动程序实际上是一个DLL文件，会被Print Spooler服务加载。
4.  **代码执行：**  当Print Spooler服务加载恶意的DLL驱动程序时，其中的代码将以SYSTEM权限执行，从而允许攻击者完全控制受影响的系统。

该漏洞利用的核心在于滥用`AddPrinterDriverEx`函数，在没有适当权限验证的情况下安装恶意的打印机驱动程序。


**项目地址:** [byt3bl33d3r/ItWasAllADream](https://github.com/byt3bl33d3r/ItWasAllADream)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #8

**来源**: [CVE-2021-34527-cyb3rpeace_CVE-2021-34527.md](../2021/CVE-2021-34527-cyb3rpeace_CVE-2021-34527.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本和补丁版本请参考漏洞库信息

**利用条件:** 需要目标系统存在Print Spooler服务，且攻击者需要拥有一定的权限(例如，已认证的用户)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞在公开后被广泛利用，并且存在公开可用的PoC代码，说明该漏洞的有效性很高。

**投毒风险：**
提供的PowerShell脚本 `CVE-2021-34527.ps1`  分析如下：

1.  **主要功能：** 脚本的主要目的是利用 PrintNightmare 漏洞，通过添加恶意的打印机驱动程序来执行任意代码。默认情况下，它会创建一个新的本地管理员用户，并设置指定的用户名和密码。
2.  **DLL 注入：** 脚本允许用户指定自己的 DLL 文件，或者使用内置的 DLL 文件。
3.  **内置 DLL：** 如果不提供 DLL，脚本会使用一个内置的 payload，该 payload 的目的是创建用户并添加到管理员组。这部分代码存在一定的风险，如果 payload 被篡改，可能会执行恶意操作。
4. **风险分析：**
    *  脚本本身功能就是利用漏洞，目的是执行代码。
    *  脚本允许使用用户提供的 DLL，这本身就存在风险，用户可能提供恶意的 DLL 文件。
    *  脚本中存在内置的 DLL，如果攻击者修改了脚本中的 get_nightmare_dll 函数，使其返回恶意的 DLL，那么在使用默认选项的情况下，会执行攻击者预设的恶意操作。
   *   `get_nightmare_dll` 函数未提供,无法进一步判断。

鉴于以上分析，认为存在一定的投毒风险，但风险主要集中在对脚本和 DLL 的篡改上。脚本本身的目的就是利用漏洞执行代码，因此不能将漏洞利用代码本身视为投毒代码。如果 `get_nightmare_dll` 函数返回的DLL被替换成其他恶意代码，则存在较高投毒风险，这里我们给出 **10%** 的投毒风险概率。

**利用方式：**

1.  **攻击者**需要具备一定的权限，例如已经通过身份验证的用户。
2.  **攻击者**运行 PoC 脚本，脚本将执行以下操作：
    *   如果指定了 DLL 文件，则使用指定的 DLL 文件。
    *   如果没有指定 DLL 文件，则使用内置的 DLL 文件，并根据指定的用户名和密码，修改 DLL 中的相应字段。
    *   将 DLL 文件写入到临时目录。
    *   使用 `AddPrinterDriverEx` 函数添加恶意的打印机驱动程序，该驱动程序将加载 DLL 文件，并执行其中的代码。
3.  **DLL** 中的代码将以 SYSTEM 权限执行，从而允许攻击者执行任意操作，例如添加新的管理员用户、安装恶意软件等。
4.  **修复方案:** 及时安装Microsoft发布的针对CVE-2021-34527的补丁，并确保相关注册表设置正确配置。

**项目地址:** [cyb3rpeace/CVE-2021-34527](https://github.com/cyb3rpeace/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #9

**来源**: [CVE-2021-34527-d0rb_CVE-2021-34527.md](../2021/CVE-2021-34527-d0rb_CVE-2021-34527.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要能够与目标系统的445端口(SMB)通信。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个存在于 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过不当的权限文件操作，利用此漏洞在目标系统上以 SYSTEM 权限执行任意代码。根据漏洞库信息，多个Windows版本都受到影响，且需要设置特定的注册表键值才能缓解此漏洞。提供的PoC代码通过SMB协议发送一个协商协议的请求。虽然这个PoC *本身* 似乎并没有包含直接执行代码的部分，但它代表了攻击的第一阶段，即与目标建立连接。真正的漏洞利用需要进一步的步骤，例如上传恶意驱动程序。根据提供的代码和信息，无法直接判断其是否有效，因为提供的代码仅是一个SMB协商协议的请求，这只是利用该漏洞的其中一步。该仓库中的PoC.py文件没有发现明显的恶意代码或后门,没有执行任何本地文件操作或连接到任何外部恶意服务器的行为，主要实现了发送SMB协议协商请求，所以投毒风险较低，风险概率为0%。

**利用方式：**

1.  **连接目标：** 通过SMB协议（445端口）与目标系统的Print Spooler服务建立连接。
2.  **触发漏洞：**  利用 `RpcAddPrinterDriverEx` 函数安装恶意的打印机驱动程序。这个函数允许在没有适当权限验证的情况下安装驱动程序。
3.  **代码执行：**  恶意的驱动程序被加载，从而允许攻击者以SYSTEM权限执行任意代码。

**需要注意的是，微软已经发布了补丁来修复此漏洞。因此，只有在未打补丁的系统上才能成功利用此漏洞。**

**项目地址:** [d0rb/CVE-2021-34527](https://github.com/d0rb/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #10

**来源**: [CVE-2021-34527-dywhoami_CVE-2021-34527-Scanner-Based-On-cube0x0-POC.md](../2021/CVE-2021-34527-dywhoami_CVE-2021-34527-Scanner-Based-On-cube0x0-POC.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 攻击者需要能够访问目标系统的Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是一个存在于Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作来利用此漏洞，从而以SYSTEM权限在目标系统上运行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是一个已知的、被广泛利用的漏洞。漏洞利用代码 (POC) 通过 `impacket` 库与目标系统的Print Spooler服务建立连接，并尝试添加恶意的打印机驱动程序。如果成功，攻击者可以利用该驱动程序执行任意代码。

搜索结果显示，此漏洞已被积极利用，并且存在缓解措施和检测方法。

**投毒风险分析：**

POC代码主要目的是验证漏洞的存在，并非恶意软件，但依旧存在潜在的投毒风险，包括：

1.  **恶意Payload替换：** 攻击者可能修改POC代码，将原有的测试Payload替换为恶意代码，例如安装后门或窃取敏感数据。
2.  **依赖库篡改：** 攻击者可能通过篡改`impacket`等依赖库，在其中植入恶意代码。
3.  **诱导执行：** 攻击者可能诱导用户以高权限运行修改后的POC代码，从而提升恶意代码的执行权限。

基于以上分析，此POC代码存在10%的投毒风险。

**利用方式分析：**

该漏洞的利用方式主要涉及以下步骤：

1.  **连接Print Spooler服务：** 攻击者使用 `impacket` 库中的函数与目标系统的Print Spooler服务建立连接。
2.  **构建恶意驱动程序容器：** 攻击者构造包含恶意驱动程序路径的`DRIVER_CONTAINER` 结构。POC 中使用了 `C:\Windows\System32\winhttp.dll` 和 `C:\Windows\System32\kernelbase.dll` 作为初始配置，后续尝试 `C:\Windows\System32\spool\drivers\x64\3\old\{0}\{1}` 路径，用于绕过安全检查。
3.  **添加打印机驱动程序：** 攻击者调用 `rprn.hRpcAddPrinterDriverEx` 函数，尝试将恶意的驱动程序添加到目标系统。  通过多次尝试不同的文件路径，利用不当的文件复制操作触发漏洞。
4.  **执行任意代码：** 如果驱动程序添加成功，攻击者可以通过打印操作或其他方式加载该驱动程序，从而以SYSTEM权限执行任意代码。

**项目地址:** [dywhoami/CVE-2021-34527-Scanner-Based-On-cube0x0-POC](https://github.com/dywhoami/CVE-2021-34527-Scanner-Based-On-cube0x0-POC)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #11

**来源**: [CVE-2021-34527-geekbrett_CVE-2021-34527-PrintNightmare-Workaround.md](../2021/CVE-2021-34527-geekbrett_CVE-2021-34527-PrintNightmare-Workaround.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，请参考漏洞库信息

**利用条件:** 攻击者需要能够访问目标系统的打印服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。根据漏洞库信息和搜索结果，攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。利用方式通常涉及向Print Spooler服务发送特制的请求，诱使其加载恶意的DLL文件，从而实现远程代码执行。虽然提供的漏洞利用代码只有GNU GPL协议，不能判断是否有恶意代码，但是参考其他信息，此漏洞利用过程需要上传并加载DLL，所以有一定概率投毒者会篡改DLL，植入后门，因此判定存在10%的投毒风险。

**项目地址:** [geekbrett/CVE-2021-34527-PrintNightmare-Workaround](https://github.com/geekbrett/CVE-2021-34527-PrintNightmare-Workaround)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #12

**来源**: [CVE-2021-34527-glorisonlai_printnightmare.md](../2021/CVE-2021-34527-glorisonlai_printnightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致SYSTEM权限的远程代码执行

**影响版本:** 受影响的Windows版本及其相应版本号详见漏洞库信息

**利用条件:** 需要经过身份验证的用户或者可以通过其他方式触发Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞是真实存在的，并且存在可用的POC代码。 搜索引擎结果中也明确指出存在可利用该漏洞的EXP.

**投毒风险：**
提供的POC代码（README.md）本身不包含可执行代码，因此直接包含恶意代码的可能性较低。但是，`printnightmare` 目录可能包含其他文件，这些文件可能包含恶意代码。 并且考虑到这是一个广泛公开的漏洞，攻击者可能修改公开的exp进行传播。因此，存在一定风险。

初步判断投毒风险为10%，主要基于以下几点：
1.  仅有README.md文件，无法直接判断代码功能
2.  漏洞广泛公开，攻击者可能修改EXP。

**利用方式：**
利用方式通常涉及以下步骤：
1.  攻击者利用经过身份验证的账户或者未经身份验证的情况下，通过网络或其他方式与目标系统的Print Spooler服务通信。
2.  攻击者向Print Spooler服务发送特制的请求，触发漏洞。
3.  漏洞触发后，攻击者可以上传并执行恶意的DLL文件，从而在目标系统上以SYSTEM权限执行任意代码。
4.  通过执行恶意代码，攻击者可以安装程序、查看、更改或删除数据，或者创建具有完全用户权限的新账户。

**修复方案:**
1. 及时安装微软官方发布的补丁。
2. 禁用Print Spooler服务（如果不需要打印功能）。
3. 检查并设置注册表项：HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint下的NoWarningNoElevationOnInstall和UpdatePromptSettings为0。

**项目地址:** [glorisonlai/printnightmare](https://github.com/glorisonlai/printnightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #13

**来源**: [CVE-2021-34527-hackerhouse-opensource_cve-2021-34527.md](../2021/CVE-2021-34527-hackerhouse-opensource_cve-2021-34527.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致系统权限提升和远程代码执行

**影响版本:** Windows Desktop 7, 8, 8.1, 10, 11 & Server 2008, 2012, 2016, 2019，版本受漏洞库信息中具体版本号影响

**利用条件:** 需要目标系统开启Print Spooler服务，可能需要绕过Point and Print策略或满足特定用户权限要求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是一个存在于Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作，利用AddPrinterDriverEx()函数加载恶意DLL，从而以SYSTEM权限执行任意代码。漏洞利用代码显示，攻击者需要提供一个线程安全的DLL路径作为参数。虽然代码本身实现了漏洞利用逻辑，但潜在的投毒风险在于，如果攻击者提供的DLL本身包含恶意代码，则可能在目标系统上执行恶意操作。代码中的随机字符串生成函数和对打印机驱动程序的枚举，看似是为了绕过某些安全机制，但也可能被用于混淆攻击行为。尽管代码本身没有明显的后门，但如果攻击者替换或修改了提供的DLL，就可能植入恶意代码，从而实现投毒攻击。根据漏洞利用代码和描述，该漏洞利用方式是通过调用`AddPrinterDriverEx()`函数，并加载攻击者指定的DLL，从而实现SYSTEM权限的代码执行。

**有效性：** 提供的POC代码有效，因为它实现了PrintNightmare漏洞的利用，能够执行任意代码。

**投毒风险：** 存在一定的投毒风险（10%）。主要风险在于攻击者提供的DLL可能包含恶意代码。虽然提供的代码片段本身没有明显的后门，但整个利用过程依赖于外部提供的DLL，这为投毒创造了机会。需要注意的是，这里所说的“投毒”是指攻击者在利用漏洞时，所使用的恶意DLL可能被其他人替换或修改，从而导致意外的或不期望的后果，例如执行了攻击者无法控制的代码。

**利用方式：**
1.  攻击者准备一个恶意的、线程安全的DLL文件。
2.  攻击者执行POC代码，并提供恶意DLL的路径作为参数。
3.  POC代码调用AddPrinterDriverEx()函数，加载并执行攻击者提供的DLL。
4.  由于Print Spooler服务以SYSTEM权限运行，攻击者提供的DLL也将在SYSTEM权限下执行，从而实现权限提升和远程代码执行。

**项目地址:** [hackerhouse-opensource/cve-2021-34527](https://github.com/hackerhouse-opensource/cve-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #14

**来源**: [CVE-2021-34527-m8sec_CVE-2021-34527.md](../2021/CVE-2021-34527-m8sec_CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，攻击者可以以 SYSTEM 权限执行任意代码。

**影响版本:** 受影响的Windows版本众多，具体参见漏洞库信息中的cpes。

**利用条件:** 攻击者需要能够访问目标系统的网络，并且Print Spooler服务处于运行状态。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息和搜索结果，CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作来利用此漏洞，从而以SYSTEM权限执行任意代码。

**有效性：**

根据CISA的ADP记录，此漏洞已被积极利用，因此提供的POC代码很可能有效。搜索结果也表明存在可用的利用代码。

**投毒风险：**

提供的Python POC代码是一个相对完整的漏洞利用框架，包含SMB服务器搭建、目标解析、以及利用Print Spooler服务进行攻击的逻辑。虽然代码中没有明显的恶意功能，但存在以下潜在的投毒风险：

*   **DLL劫持：** 漏洞利用的核心在于上传恶意的DLL文件并在目标系统上加载执行。攻击者可能在上传的DLL文件中包含恶意代码，从而实现持久化控制或其他恶意目的。POC代码中虽然不包含恶意DLL，但是用户在使用时需要自行构建，可能存在风险。
*   **SMB服务器安全：** SMB服务器本身可能存在安全问题，如果配置不当，可能被用于攻击其他系统。POC代码中实现的SMB服务器是一个简易版本，安全性较低。建议在隔离环境中运行。
*   **参数篡改：** 用户在使用POC时，可能因为参数配置错误而导致利用失败，或者产生意料之外的结果。例如，错误的共享路径、IP地址等。

综合以上因素，我评估此仓库中存在10%的作者隐藏的投毒代码的可能性，主要集中在使用用户自行构建的恶意DLL文件和SMB服务器安全风险上。

**利用方式：**

1.  **搭建SMB服务器：** 攻击者首先需要搭建一个SMB服务器，用于托管恶意的DLL文件。
2.  **利用Print Spooler服务：** 攻击者利用Print Spooler服务的AddPrinterDriverEx函数，将恶意的DLL文件上传到目标系统。
3.  **DLL劫持：** Print Spooler服务在加载驱动时，会加载上传的DLL文件，从而执行其中的恶意代码，实现远程代码执行。攻击者可以利用此漏洞获取SYSTEM权限。
4.  **清理：** 清理攻击痕迹，例如删除上传的DLL文件。

**项目地址:** [m8sec/CVE-2021-34527](https://github.com/m8sec/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #15

**来源**: [CVE-2021-34527-nemo-wq_PrintNightmare-CVE-2021-34527.md](../2021/CVE-2021-34527-nemo-wq_PrintNightmare-CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以 SYSTEM 权限执行任意代码

**影响版本:** 受影响的 Windows 版本包括但不限于 Windows 10, Windows Server 2019, Windows 11 等 (参考漏洞库信息)

**利用条件:** 需要目标系统开启 Print Spooler 服务，并且攻击者需要具备一定的身份验证权限 (参考搜索引擎结果)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过 `RpcAddPrinterDriverEx` 函数不正确地执行特权文件操作来利用此漏洞，从而以 SYSTEM 权限运行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞的POC代码是有效的。多个来源确认了该漏洞的存在和可利用性。

**投毒风险：**

POC代码存在潜在的投毒风险，但概率较低（10%）。

*   **风险点：** 代码中存在多个硬编码的文件路径（如 `C:\Windows\System32\winhttp.dll` 和 `C:\Windows\System32\kernelbase.dll`），以及对共享目录的依赖。攻击者可能通过修改这些路径，引导受害者加载恶意的 DLL 文件，从而实现远程代码执行。
*   **缓解：** 代码需要根据目标环境进行调整，硬编码路径在实际使用中会存在适配问题。经验丰富的渗透测试人员会检查并修改这些路径，降低了直接运行恶意代码的风险。
*   **其他：** 虽然代码本身的功能是利用漏洞执行代码，但精心构造的恶意 DLL 仍然是攻击的核心，不能因为存在后门 DLL 就判定为投毒。

**利用方式：**

1.  **连接目标：** 使用 `impacket` 库建立与目标 Print Spooler 服务的 RPC 连接。
2.  **构建 Payload：** 构造 `DRIVER_CONTAINER` 结构，包含指向恶意 DLL 的路径（通过共享目录提供）。
3.  **触发漏洞：** 调用 `hRpcAddPrinterDriverEx` 函数，将恶意的驱动程序信息添加到 Print Spooler 服务。
4.  **权限提升：** Print Spooler 服务尝试加载指定的 DLL 文件，由于权限提升漏洞，加载过程以 SYSTEM 权限执行，从而实现任意代码执行。
5.  **尝试路径** 通过循环尝试 `C:\Windows\System32\spool\drivers\x64\3\old\{0}\{1}`目录下的DLL。

**项目地址:** [nemo-wq/PrintNightmare-CVE-2021-34527](https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #16

**来源**: [CVE-2021-34527-rdboboia_disable-RegisterSpoolerRemoteRpcEndPoint.md](../2021/CVE-2021-34527-rdboboia_disable-RegisterSpoolerRemoteRpcEndPoint.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户通过Print Spooler服务远程执行代码，可能导致完全系统控制

**影响版本:** 受影响版本包括多个Windows版本，详见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，且允许网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，也被称为PrintNightmare，是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。根据漏洞库信息和搜索结果，该漏洞影响多个Windows版本。提供的漏洞利用代码实际上是一个缓解脚本，用于禁用Print Spooler接受客户端连接，通过修改注册表键值`HKLM\Software\Policies\Microsoft\Windows NT\Printers\RegisterSpoolerRemoteRpcEndPoint`为2来禁用远程连接。利用方式通常涉及滥用`RpcAddPrinterDriverEx`函数加载恶意驱动程序，从而实现代码执行。缓解方法是安装Microsoft发布的补丁或使用提供的脚本禁用Print Spooler的远程连接。

**有效性:**
根据搜索结果，存在多个POC利用代码。该缓解脚本代码有效，但目的与攻击利用相反。 它只是通过修改注册表来禁用远程连接，从而降低风险，

**投毒风险:**
该脚本本身的功能是禁用远程连接，没有发现直接的投毒代码。但是，存在一定的投毒风险：
*   **依赖外部源:** 该脚本依赖于Windows自身的`reg`命令和`shutdown`命令。攻击者理论上可以通过替换系统命令，诱导用户运行恶意程序(可能性极低)。
*   **误导用户:** 攻击者可能修改脚本描述，诱导用户在不需要的情况下禁用打印服务，从而影响正常使用。
*   **未来修改:** 仓库作者或其他人可能在未来版本中添加恶意代码。
该脚本本身用于缓解漏洞，直接包含恶意代码可能性较低，但考虑到软件供应链的安全风险，仍然存在一定的投毒可能。

**利用方式：**
PrintNightmare漏洞的利用方式通常包含以下步骤：
1.  攻击者利用具有漏洞的`RpcAddPrinterDriverEx`函数。
2.  上传包含恶意代码的驱动程序文件。
3.  Print Spooler服务尝试加载该驱动程序。
4.  由于Print Spooler以SYSTEM权限运行，恶意代码也以SYSTEM权限执行。

**项目地址:** [rdboboia/disable-RegisterSpoolerRemoteRpcEndPoint](https://github.com/rdboboia/disable-RegisterSpoolerRemoteRpcEndPoint)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #17

**来源**: [CVE-2021-34527-syntaxbearror_PowerShell-PrintNightmare.md](../2021/CVE-2021-34527-syntaxbearror_PowerShell-PrintNightmare.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler Remote Code Execution

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Print Spooler Service

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 需要目标系统启用Print Spooler服务，且攻击者能够通过网络或本地访问Print Spooler服务

**POC 可用性:** 是，但提供的代码并非直接的漏洞利用，而是缓解脚本

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。漏洞利用方式通常涉及向Print Spooler服务发送特制的请求，导致服务加载并执行恶意的DLL文件。提供的POC代码实际上是PowerShell脚本，用于设置注册表项以缓解此漏洞，而不是利用它。servers.ps1配置服务器的PointAndPrint设置，而workstations.ps1旨在阻止工作站上的远程打印连接。这些脚本通过修改注册表项来限制驱动程序安装和禁用远程RPC端点注册。由于脚本目标是缓解漏洞而非利用，因此投毒风险较低，但仍存在一定风险，例如配置错误可能导致打印功能失效，或者被篡改的脚本可能包含恶意代码。 搜索引擎结果表明此漏洞影响广泛，并且已经被积极利用。漏洞库信息也详细列出了受影响的Windows版本。需要注意的是，微软已经发布了安全更新来修复此漏洞，建议尽快安装。综合判断投毒风险约为10%，主要基于对脚本修改的可能性以及配置错误的风险。

**项目地址:** [syntaxbearror/PowerShell-PrintNightmare](https://github.com/syntaxbearror/PowerShell-PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #18

**来源**: [CVE-2021-34527-thomas-lauer_PrintNightmare.md](../2021/CVE-2021-34527-thomas-lauer_PrintNightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要Print Spooler服务运行，且用户具有一定权限（至少是域内用户或本地用户）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，也被称为PrintNightmare，是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的文件操作获得SYSTEM权限，从而安装程序，查看、更改或删除数据，或创建具有完全用户权限的新帐户。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且存在公开的PoC。

**利用方式：**
利用方式主要围绕着对`C:\Windows\System32\spool\drivers`目录的ACL权限进行修改，上传恶意DLL，然后触发打印服务加载该DLL，从而以SYSTEM权限执行任意代码。

**PoC代码分析：**
提供的PoC代码主要分为以下几类：

1.  **备份/恢复ACL：**
    *   `BackupAclPrintSpooler.cmd`和`DattoRMMAclComponenteAngepasst.ps1`用于备份`C:\Windows\System32\spool\drivers`目录的ACL，以便在利用后恢复。
2.  **修改ACL：**
    *   `SetAclPrintSpooler.cmd`和`SetACL.ps1`用于设置ACL，通常是拒绝SYSTEM用户对`C:\Windows\System32\spool\drivers`目录的写入权限（Deny）。
    *  `RemoveAclPrintSpooler.cmd`和`RemoveACL.ps1`用于移除SYSTEM用户对`C:\Windows\System32\spool\drivers`目录的拒绝权限。
    *  `DattoRMMAclComponenteAngepasst.ps1` 脚本允许选择授予或拒绝SYSTEM账户对 spool\drivers 文件夹的访问权限，在不同的利用场景下进行权限控制。
3.  **监控策略：**
    *   `Monitoring Policy SYSMON_PrinterSpooler.pcy`是一个Sysmon策略，用于监控与打印服务相关的事件。
4.  **其他：**
    *   `RestrictDriverInstallationToAdministrators.cmd`通过修改注册表来限制只有管理员才能安装打印驱动程序，是一个缓解措施。
    * `StopUnusedPrinterserver.ps1`尝试停止域内不使用的打印服务，也是缓解措施。

**投毒风险：**
PoC代码本身的功能主要是修改ACL和备份ACL，属于防御性质的，但也可能被用于攻击的前置条件，有投毒风险。
其中`DattoRMMAclComponenteAngepasst.ps1`脚本，根据用户选择grant/deny权限，脚本中没有发现直接执行恶意代码的部分，主要作用还是配置ACL权限。因此，投毒风险较低，约10%。

总的来说，这些PoC代码本身不包含直接执行恶意代码的后门，但攻击者可以利用这些脚本作为攻击链的一部分，例如先修改ACL，上传恶意DLL，然后利用漏洞执行代码。因此，PoC代码本身存在一定的被恶意利用的风险。

**项目地址:** [thomas-lauer/PrintNightmare](https://github.com/thomas-lauer/PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---



---

## POC #3

**来源**: [CVE-2021-34527-Amaranese_CVE-2021-34527.md](../2021/CVE-2021-34527-Amaranese_CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致SYSTEM权限的远程代码执行

**影响版本:** 受影响的Windows版本及补丁版本之前

**利用条件:** 攻击者需要能够与目标系统的打印服务通信（通常是445端口，但可能配置为其他端口），并需要用户权限（尽管存在本地提权变种）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以利用此漏洞以 SYSTEM 权限执行任意代码。根据漏洞库信息，多个 Windows 版本都受到影响，直到相应的安全更新发布。搜索结果也表明该漏洞是一个严重的安全问题，并被称为"PrintNightmare"。

**有效性分析：**

提供的 PowerShell 脚本 (CVE-2021-34527.PS1) 旨在利用 PrintNightmare 漏洞。该脚本允许攻击者添加一个新的本地管理员用户，或执行自定义 DLL 代码作为 NT AUTHORITY\SYSTEM。脚本通过 `AddPrinterDriverEx` 函数加载恶意的打印机驱动程序来实现代码执行。

**投毒风险分析：**

虽然脚本的主要功能是利用 PrintNightmare 漏洞，但存在少量投毒风险。

1.  **默认凭据：** 脚本默认创建一个用户名为 `adm1n`，密码为 `P@ssw0rd` 的管理员帐户。如果攻击者直接使用默认配置，可能使得目标系统容易被其他攻击者利用。
2.  **DLL来源：** 脚本允许指定自定义的 DLL。如果攻击者从不可信的来源下载 DLL，则可能执行恶意代码，反过来感染攻击者的系统。
3.  **编码方式：** 使用 `UnicodeEncoding` 可能会引入一些问题，因为有些系统可能使用不同的编码方式。尽管这不是直接的投毒，但可能导致利用失败。
4.  **依赖性：** 脚本依赖于特定的 Windows API 和 DLL 文件。如果这些 API 或 DLL 不可用或行为发生变化，脚本可能无法正常工作。

**利用方式分析：**

利用方式主要步骤如下：

1.  **准备恶意DLL：** 攻击者需要准备一个包含恶意代码的 DLL 文件。提供的脚本可以生成一个默认的 DLL，该 DLL 将创建一个新的本地管理员用户。或者，攻击者可以提供自己的 DLL。
2.  **执行PowerShell脚本：** 攻击者需要在目标系统上执行提供的 PowerShell 脚本。需要具有一定的用户权限才能执行该脚本。
3.  **加载恶意驱动：** 脚本使用 `AddPrinterDriverEx` 函数将恶意 DLL 加载为打印机驱动程序。由于 Print Spooler 服务以 SYSTEM 权限运行，因此 DLL 中的代码也将以 SYSTEM 权限执行。
4.  **代码执行：** 恶意 DLL 中的代码被执行，从而允许攻击者控制目标系统。

**结论：**
提供的 POC 代码有效，但存在少量投毒风险（大约 10%）。攻击者需要注意使用安全的 DLL 来源，并避免使用默认凭据。

**项目地址:** [Amaranese/CVE-2021-34527](https://github.com/Amaranese/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #4

**来源**: [CVE-2021-34527-Eutectico_Printnightmare.md](../2021/CVE-2021-34527-Eutectico_Printnightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响版本见漏洞库信息

**利用条件:** 需要网络访问，且目标系统存在漏洞版本的Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。根据漏洞库信息和搜索引擎结果，该漏洞影响多个Windows版本。提供的POC代码旨在缓解该漏洞，主要通过禁用Print Spooler服务以及拒绝驱动程序安装来实现。漏洞利用方式通常涉及向Print Spooler服务发送特制的打印请求，导致服务加载并执行恶意的DLL文件。 

**有效性：** 提供的POC代码并非漏洞利用代码，而是缓解措施，用于禁用Print Spooler服务并阻止恶意驱动程序的安装。因此，它不能用于验证漏洞的存在，而是用于降低漏洞带来的风险。

**投毒风险：** 提供的代码主要包含PowerShell脚本和CMD脚本，用于禁用Print Spooler服务和配置驱动程序安装权限。初步分析表明，代码本身没有明显的恶意行为，但存在以下潜在风险：

1.  **误用/滥用：** 如果攻击者能够控制这些脚本的执行，他们可能选择性地禁用或启用某些安全措施，从而为进一步的攻击打开方便之门。
2.  **依赖外部文件 (serverlist.txt)：** `disable-spooler.cmd`脚本依赖于`serverlist.txt`文件，如果该文件被篡改，可能导致意外的服务器被禁用Print Spooler服务，从而影响业务连续性。
3.  **权限提升：** 虽然脚本本身没有直接提权操作，但如果运行脚本的用户权限不足，可能会导致脚本执行失败，留下安全隐患。

因此，综合考虑，投毒风险较低，估计在10%左右。 主要的风险在于脚本被恶意修改或被利用进行拒绝服务攻击（禁用打印服务）。

**利用方式：**  PrintNightmare漏洞的利用方式通常涉及以下步骤：

1.  **利用未经授权的打印机驱动程序安装：** 攻击者可以使用`AddPrinterDriverEx`函数，上传并安装恶意的打印机驱动程序。
2.  **DLL注入：** 恶意的驱动程序实际上是一个DLL文件，当Print Spooler服务加载该驱动程序时，DLL中的代码会被执行，从而实现远程代码执行。
3.  **SYSTEM权限获取：** 由于Print Spooler服务以SYSTEM权限运行，因此注入的DLL代码也会以SYSTEM权限执行。

需要注意的是，微软已经发布了针对此漏洞的补丁。建议用户及时安装补丁，并采取其他缓解措施，例如禁用Print Spooler服务（如果不需要打印功能）或限制驱动程序安装权限。

**项目地址:** [Eutectico/Printnightmare](https://github.com/Eutectico/Printnightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #5

**来源**: [CVE-2021-34527-Tomparte_PrintNightmare.md](../2021/CVE-2021-34527-Tomparte_PrintNightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE) / 本地提权 (LPE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致远程代码执行和系统权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 打印服务未打补丁或配置不当，可能需要一定权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的关键漏洞，允许经过身份验证的用户（在某些配置下，甚至可能未经身份验证）以SYSTEM权限执行远程代码。虽然微软发布了补丁，但最初的补丁并不完全有效，特别是对于本地提权（LPE）。

**有效性:**
从搜索结果和漏洞库信息来看，该漏洞是真实存在的，并且已被积极利用。提供的POC代码实际上**并非漏洞利用代码**，而是**缓解措施**。它通过修改注册表键来限制打印客户端连接和禁用安装打印机驱动时的警告和提权提示，以降低漏洞被利用的风险。

**投毒风险:**
该仓库的目的是提供缓解措施，而不是漏洞利用。尽管如此，任何代码库都存在潜在的投毒风险。此处的风险较低，约为10%，原因如下：
*   代码相对简单，易于审查。
*   代码主要操作注册表，影响系统策略，而非直接执行恶意代码。
*   作者提供了多个参考链接，方便用户验证代码的正确性。
但是，仍然存在一些风险：
*   恶意作者可能在脚本中添加额外的注册表修改，导致系统不稳定或出现其他问题。
*   批处理脚本可能被修改以执行其他命令，但这种修改相对容易被发现。

**利用方式:**
根据漏洞信息和搜索结果，攻击者可以利用此漏洞通过以下步骤执行任意代码：
1.  利用不安全的打印机驱动程序安装机制。
2.  上传并安装特制的恶意驱动程序。
3.  该恶意驱动程序以SYSTEM权限运行，允许攻击者完全控制系统。

需要注意的是，提供的POC代码是用来缓解漏洞的，通过修改注册表禁用或限制某些功能以降低攻击面，而不是利用漏洞本身。 它试图通过设置 `RegisterSpoolerRemoteRpcEndPoint`, `NoWarningNoElevationOnInstall`, 和 `UpdatePromptSettings` 注册表项来缓解漏洞，而不是利用漏洞。 然而，也存在潜在的投毒风险，即作者可能在脚本中包含了额外的、未说明的恶意操作。 用户在使用任何第三方脚本之前，都应该进行仔细审查。

**项目地址:** [Tomparte/PrintNightmare](https://github.com/Tomparte/PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #6

**来源**: [CVE-2021-34527-WidespreadPandemic_CVE-2021-34527_ACL_mitigation.md](../2021/CVE-2021-34527-WidespreadPandemic_CVE-2021-34527_ACL_mitigation.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，详见漏洞库信息

**利用条件:** 需要网络可达，目标系统运行Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞允许经过身份验证的攻击者通过不正确的文件操作，以SYSTEM权限在目标系统上执行任意代码。攻击者可以利用该漏洞安装程序、查看、更改或删除数据，或创建具有完全用户权限的新帐户。

**有效性：**
提供的POC代码实际上是缓解脚本，而非漏洞利用代码。这些PowerShell脚本通过修改`%windir%\System32\spool\drivers`目录的ACL，来阻止SYSTEM账户对该目录进行写入操作，从而缓解PrintNightmare漏洞。脚本`CVE-2021-34527_ACL_Mitigation.ps1`添加ACL规则，拒绝SYSTEM用户对该目录进行写入操作，而`CVE-2021-34527_ACL_Mitigation_Rollback.ps1`则移除这些ACL规则。

**投毒风险：**
虽然提供的脚本本身用于缓解漏洞，但仍存在一定的投毒风险。攻击者可能修改这些脚本，例如：
*   **添加恶意代码：** 在缓解脚本中插入额外的命令，在修改ACL的同时执行恶意操作，例如下载和执行恶意软件。
*   **创建后门：** 通过精心设计的ACL规则，允许特定账户（例如攻击者控制的账户）对`drivers`目录进行写入操作，从而创建一个后门。
鉴于以上风险，判断投毒风险为10%，主要风险在于脚本被篡改。

**利用方式：**
真正的漏洞利用方式（未提供具体exp，根据分析）涉及到滥用`AddPrinterDriverEx`函数，允许低权限用户加载任意驱动程序。攻击者可以上传包含恶意代码的驱动程序，并利用Print Spooler服务以SYSTEM权限加载该驱动，从而实现远程代码执行。ACL缓解脚本通过限制SYSTEM账户对`drivers`目录的写入权限，阻止了恶意驱动程序的上传和加载。


**项目地址:** [WidespreadPandemic/CVE-2021-34527_ACL_mitigation](https://github.com/WidespreadPandemic/CVE-2021-34527_ACL_mitigation)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #7

**来源**: [CVE-2021-34527-byt3bl33d3r_ItWasAllADream.md](../2021/CVE-2021-34527-byt3bl33d3r_ItWasAllADream.md)

## CVE-2021-34527 PrintNightmare RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本，包括但不限于Windows 10, Windows Server 2019, Windows 11

**利用条件:** 需要Active Directory域凭据进行身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。从搜索引擎结果和漏洞库信息来看，该漏洞影响多个Windows版本，并允许经过身份验证的攻击者以SYSTEM权限执行任意代码。提供的漏洞利用代码是一个Python扫描器，用于检测目标子网是否存在PrintNightmare RCE漏洞，它通过模拟攻击者使用的RPC调用来判断主机是否脆弱。

**有效性：**
提供的POC代码本身是一个扫描器，而不是直接的漏洞利用程序。它模拟了攻击中使用的RPC调用，以此来判断目标主机是否存在漏洞。因此，可以认为它在漏洞检测方面是有效的。

**投毒风险：**
虽然POC的主要功能是扫描，但考虑到它包含从github下载的exp,存在一定的风险，需要仔细审查exp代码。此外，Dockerfile包含curl和git命令，存在下载恶意脚本的可能性，但代码本身主要是进行漏洞扫描，没有发现明显的恶意代码或后门。考虑到网络下载依赖，投毒风险评估为10%。

**利用方式：**
1.  **身份验证：**  攻击者需要具有Active Directory域的有效凭据才能利用此漏洞。
2.  **RPC调用：**  攻击者使用MS-PAR和MS-RPRN协议中存在的漏洞函数，向Print Spooler服务发送特制的RPC请求。
3.  **DLL注入：**  攻击者通过`AddPrinterDriverEx`函数安装恶意的打印机驱动程序，该驱动程序实际上是一个DLL文件，会被Print Spooler服务加载。
4.  **代码执行：**  当Print Spooler服务加载恶意的DLL驱动程序时，其中的代码将以SYSTEM权限执行，从而允许攻击者完全控制受影响的系统。

该漏洞利用的核心在于滥用`AddPrinterDriverEx`函数，在没有适当权限验证的情况下安装恶意的打印机驱动程序。


**项目地址:** [byt3bl33d3r/ItWasAllADream](https://github.com/byt3bl33d3r/ItWasAllADream)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #8

**来源**: [CVE-2021-34527-cyb3rpeace_CVE-2021-34527.md](../2021/CVE-2021-34527-cyb3rpeace_CVE-2021-34527.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本和补丁版本请参考漏洞库信息

**利用条件:** 需要目标系统存在Print Spooler服务，且攻击者需要拥有一定的权限(例如，已认证的用户)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞在公开后被广泛利用，并且存在公开可用的PoC代码，说明该漏洞的有效性很高。

**投毒风险：**
提供的PowerShell脚本 `CVE-2021-34527.ps1`  分析如下：

1.  **主要功能：** 脚本的主要目的是利用 PrintNightmare 漏洞，通过添加恶意的打印机驱动程序来执行任意代码。默认情况下，它会创建一个新的本地管理员用户，并设置指定的用户名和密码。
2.  **DLL 注入：** 脚本允许用户指定自己的 DLL 文件，或者使用内置的 DLL 文件。
3.  **内置 DLL：** 如果不提供 DLL，脚本会使用一个内置的 payload，该 payload 的目的是创建用户并添加到管理员组。这部分代码存在一定的风险，如果 payload 被篡改，可能会执行恶意操作。
4. **风险分析：**
    *  脚本本身功能就是利用漏洞，目的是执行代码。
    *  脚本允许使用用户提供的 DLL，这本身就存在风险，用户可能提供恶意的 DLL 文件。
    *  脚本中存在内置的 DLL，如果攻击者修改了脚本中的 get_nightmare_dll 函数，使其返回恶意的 DLL，那么在使用默认选项的情况下，会执行攻击者预设的恶意操作。
   *   `get_nightmare_dll` 函数未提供,无法进一步判断。

鉴于以上分析，认为存在一定的投毒风险，但风险主要集中在对脚本和 DLL 的篡改上。脚本本身的目的就是利用漏洞执行代码，因此不能将漏洞利用代码本身视为投毒代码。如果 `get_nightmare_dll` 函数返回的DLL被替换成其他恶意代码，则存在较高投毒风险，这里我们给出 **10%** 的投毒风险概率。

**利用方式：**

1.  **攻击者**需要具备一定的权限，例如已经通过身份验证的用户。
2.  **攻击者**运行 PoC 脚本，脚本将执行以下操作：
    *   如果指定了 DLL 文件，则使用指定的 DLL 文件。
    *   如果没有指定 DLL 文件，则使用内置的 DLL 文件，并根据指定的用户名和密码，修改 DLL 中的相应字段。
    *   将 DLL 文件写入到临时目录。
    *   使用 `AddPrinterDriverEx` 函数添加恶意的打印机驱动程序，该驱动程序将加载 DLL 文件，并执行其中的代码。
3.  **DLL** 中的代码将以 SYSTEM 权限执行，从而允许攻击者执行任意操作，例如添加新的管理员用户、安装恶意软件等。
4.  **修复方案:** 及时安装Microsoft发布的针对CVE-2021-34527的补丁，并确保相关注册表设置正确配置。

**项目地址:** [cyb3rpeace/CVE-2021-34527](https://github.com/cyb3rpeace/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #9

**来源**: [CVE-2021-34527-d0rb_CVE-2021-34527.md](../2021/CVE-2021-34527-d0rb_CVE-2021-34527.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要能够与目标系统的445端口(SMB)通信。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个存在于 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过不当的权限文件操作，利用此漏洞在目标系统上以 SYSTEM 权限执行任意代码。根据漏洞库信息，多个Windows版本都受到影响，且需要设置特定的注册表键值才能缓解此漏洞。提供的PoC代码通过SMB协议发送一个协商协议的请求。虽然这个PoC *本身* 似乎并没有包含直接执行代码的部分，但它代表了攻击的第一阶段，即与目标建立连接。真正的漏洞利用需要进一步的步骤，例如上传恶意驱动程序。根据提供的代码和信息，无法直接判断其是否有效，因为提供的代码仅是一个SMB协商协议的请求，这只是利用该漏洞的其中一步。该仓库中的PoC.py文件没有发现明显的恶意代码或后门,没有执行任何本地文件操作或连接到任何外部恶意服务器的行为，主要实现了发送SMB协议协商请求，所以投毒风险较低，风险概率为0%。

**利用方式：**

1.  **连接目标：** 通过SMB协议（445端口）与目标系统的Print Spooler服务建立连接。
2.  **触发漏洞：**  利用 `RpcAddPrinterDriverEx` 函数安装恶意的打印机驱动程序。这个函数允许在没有适当权限验证的情况下安装驱动程序。
3.  **代码执行：**  恶意的驱动程序被加载，从而允许攻击者以SYSTEM权限执行任意代码。

**需要注意的是，微软已经发布了补丁来修复此漏洞。因此，只有在未打补丁的系统上才能成功利用此漏洞。**

**项目地址:** [d0rb/CVE-2021-34527](https://github.com/d0rb/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #10

**来源**: [CVE-2021-34527-dywhoami_CVE-2021-34527-Scanner-Based-On-cube0x0-POC.md](../2021/CVE-2021-34527-dywhoami_CVE-2021-34527-Scanner-Based-On-cube0x0-POC.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 攻击者需要能够访问目标系统的Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是一个存在于Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作来利用此漏洞，从而以SYSTEM权限在目标系统上运行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是一个已知的、被广泛利用的漏洞。漏洞利用代码 (POC) 通过 `impacket` 库与目标系统的Print Spooler服务建立连接，并尝试添加恶意的打印机驱动程序。如果成功，攻击者可以利用该驱动程序执行任意代码。

搜索结果显示，此漏洞已被积极利用，并且存在缓解措施和检测方法。

**投毒风险分析：**

POC代码主要目的是验证漏洞的存在，并非恶意软件，但依旧存在潜在的投毒风险，包括：

1.  **恶意Payload替换：** 攻击者可能修改POC代码，将原有的测试Payload替换为恶意代码，例如安装后门或窃取敏感数据。
2.  **依赖库篡改：** 攻击者可能通过篡改`impacket`等依赖库，在其中植入恶意代码。
3.  **诱导执行：** 攻击者可能诱导用户以高权限运行修改后的POC代码，从而提升恶意代码的执行权限。

基于以上分析，此POC代码存在10%的投毒风险。

**利用方式分析：**

该漏洞的利用方式主要涉及以下步骤：

1.  **连接Print Spooler服务：** 攻击者使用 `impacket` 库中的函数与目标系统的Print Spooler服务建立连接。
2.  **构建恶意驱动程序容器：** 攻击者构造包含恶意驱动程序路径的`DRIVER_CONTAINER` 结构。POC 中使用了 `C:\Windows\System32\winhttp.dll` 和 `C:\Windows\System32\kernelbase.dll` 作为初始配置，后续尝试 `C:\Windows\System32\spool\drivers\x64\3\old\{0}\{1}` 路径，用于绕过安全检查。
3.  **添加打印机驱动程序：** 攻击者调用 `rprn.hRpcAddPrinterDriverEx` 函数，尝试将恶意的驱动程序添加到目标系统。  通过多次尝试不同的文件路径，利用不当的文件复制操作触发漏洞。
4.  **执行任意代码：** 如果驱动程序添加成功，攻击者可以通过打印操作或其他方式加载该驱动程序，从而以SYSTEM权限执行任意代码。

**项目地址:** [dywhoami/CVE-2021-34527-Scanner-Based-On-cube0x0-POC](https://github.com/dywhoami/CVE-2021-34527-Scanner-Based-On-cube0x0-POC)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #11

**来源**: [CVE-2021-34527-geekbrett_CVE-2021-34527-PrintNightmare-Workaround.md](../2021/CVE-2021-34527-geekbrett_CVE-2021-34527-PrintNightmare-Workaround.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，请参考漏洞库信息

**利用条件:** 攻击者需要能够访问目标系统的打印服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。根据漏洞库信息和搜索结果，攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。利用方式通常涉及向Print Spooler服务发送特制的请求，诱使其加载恶意的DLL文件，从而实现远程代码执行。虽然提供的漏洞利用代码只有GNU GPL协议，不能判断是否有恶意代码，但是参考其他信息，此漏洞利用过程需要上传并加载DLL，所以有一定概率投毒者会篡改DLL，植入后门，因此判定存在10%的投毒风险。

**项目地址:** [geekbrett/CVE-2021-34527-PrintNightmare-Workaround](https://github.com/geekbrett/CVE-2021-34527-PrintNightmare-Workaround)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #12

**来源**: [CVE-2021-34527-glorisonlai_printnightmare.md](../2021/CVE-2021-34527-glorisonlai_printnightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致SYSTEM权限的远程代码执行

**影响版本:** 受影响的Windows版本及其相应版本号详见漏洞库信息

**利用条件:** 需要经过身份验证的用户或者可以通过其他方式触发Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞是真实存在的，并且存在可用的POC代码。 搜索引擎结果中也明确指出存在可利用该漏洞的EXP.

**投毒风险：**
提供的POC代码（README.md）本身不包含可执行代码，因此直接包含恶意代码的可能性较低。但是，`printnightmare` 目录可能包含其他文件，这些文件可能包含恶意代码。 并且考虑到这是一个广泛公开的漏洞，攻击者可能修改公开的exp进行传播。因此，存在一定风险。

初步判断投毒风险为10%，主要基于以下几点：
1.  仅有README.md文件，无法直接判断代码功能
2.  漏洞广泛公开，攻击者可能修改EXP。

**利用方式：**
利用方式通常涉及以下步骤：
1.  攻击者利用经过身份验证的账户或者未经身份验证的情况下，通过网络或其他方式与目标系统的Print Spooler服务通信。
2.  攻击者向Print Spooler服务发送特制的请求，触发漏洞。
3.  漏洞触发后，攻击者可以上传并执行恶意的DLL文件，从而在目标系统上以SYSTEM权限执行任意代码。
4.  通过执行恶意代码，攻击者可以安装程序、查看、更改或删除数据，或者创建具有完全用户权限的新账户。

**修复方案:**
1. 及时安装微软官方发布的补丁。
2. 禁用Print Spooler服务（如果不需要打印功能）。
3. 检查并设置注册表项：HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint下的NoWarningNoElevationOnInstall和UpdatePromptSettings为0。

**项目地址:** [glorisonlai/printnightmare](https://github.com/glorisonlai/printnightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #13

**来源**: [CVE-2021-34527-hackerhouse-opensource_cve-2021-34527.md](../2021/CVE-2021-34527-hackerhouse-opensource_cve-2021-34527.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致系统权限提升和远程代码执行

**影响版本:** Windows Desktop 7, 8, 8.1, 10, 11 & Server 2008, 2012, 2016, 2019，版本受漏洞库信息中具体版本号影响

**利用条件:** 需要目标系统开启Print Spooler服务，可能需要绕过Point and Print策略或满足特定用户权限要求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，又名PrintNightmare，是一个存在于Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作，利用AddPrinterDriverEx()函数加载恶意DLL，从而以SYSTEM权限执行任意代码。漏洞利用代码显示，攻击者需要提供一个线程安全的DLL路径作为参数。虽然代码本身实现了漏洞利用逻辑，但潜在的投毒风险在于，如果攻击者提供的DLL本身包含恶意代码，则可能在目标系统上执行恶意操作。代码中的随机字符串生成函数和对打印机驱动程序的枚举，看似是为了绕过某些安全机制，但也可能被用于混淆攻击行为。尽管代码本身没有明显的后门，但如果攻击者替换或修改了提供的DLL，就可能植入恶意代码，从而实现投毒攻击。根据漏洞利用代码和描述，该漏洞利用方式是通过调用`AddPrinterDriverEx()`函数，并加载攻击者指定的DLL，从而实现SYSTEM权限的代码执行。

**有效性：** 提供的POC代码有效，因为它实现了PrintNightmare漏洞的利用，能够执行任意代码。

**投毒风险：** 存在一定的投毒风险（10%）。主要风险在于攻击者提供的DLL可能包含恶意代码。虽然提供的代码片段本身没有明显的后门，但整个利用过程依赖于外部提供的DLL，这为投毒创造了机会。需要注意的是，这里所说的“投毒”是指攻击者在利用漏洞时，所使用的恶意DLL可能被其他人替换或修改，从而导致意外的或不期望的后果，例如执行了攻击者无法控制的代码。

**利用方式：**
1.  攻击者准备一个恶意的、线程安全的DLL文件。
2.  攻击者执行POC代码，并提供恶意DLL的路径作为参数。
3.  POC代码调用AddPrinterDriverEx()函数，加载并执行攻击者提供的DLL。
4.  由于Print Spooler服务以SYSTEM权限运行，攻击者提供的DLL也将在SYSTEM权限下执行，从而实现权限提升和远程代码执行。

**项目地址:** [hackerhouse-opensource/cve-2021-34527](https://github.com/hackerhouse-opensource/cve-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #14

**来源**: [CVE-2021-34527-m8sec_CVE-2021-34527.md](../2021/CVE-2021-34527-m8sec_CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，攻击者可以以 SYSTEM 权限执行任意代码。

**影响版本:** 受影响的Windows版本众多，具体参见漏洞库信息中的cpes。

**利用条件:** 攻击者需要能够访问目标系统的网络，并且Print Spooler服务处于运行状态。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息和搜索结果，CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的特权文件操作来利用此漏洞，从而以SYSTEM权限执行任意代码。

**有效性：**

根据CISA的ADP记录，此漏洞已被积极利用，因此提供的POC代码很可能有效。搜索结果也表明存在可用的利用代码。

**投毒风险：**

提供的Python POC代码是一个相对完整的漏洞利用框架，包含SMB服务器搭建、目标解析、以及利用Print Spooler服务进行攻击的逻辑。虽然代码中没有明显的恶意功能，但存在以下潜在的投毒风险：

*   **DLL劫持：** 漏洞利用的核心在于上传恶意的DLL文件并在目标系统上加载执行。攻击者可能在上传的DLL文件中包含恶意代码，从而实现持久化控制或其他恶意目的。POC代码中虽然不包含恶意DLL，但是用户在使用时需要自行构建，可能存在风险。
*   **SMB服务器安全：** SMB服务器本身可能存在安全问题，如果配置不当，可能被用于攻击其他系统。POC代码中实现的SMB服务器是一个简易版本，安全性较低。建议在隔离环境中运行。
*   **参数篡改：** 用户在使用POC时，可能因为参数配置错误而导致利用失败，或者产生意料之外的结果。例如，错误的共享路径、IP地址等。

综合以上因素，我评估此仓库中存在10%的作者隐藏的投毒代码的可能性，主要集中在使用用户自行构建的恶意DLL文件和SMB服务器安全风险上。

**利用方式：**

1.  **搭建SMB服务器：** 攻击者首先需要搭建一个SMB服务器，用于托管恶意的DLL文件。
2.  **利用Print Spooler服务：** 攻击者利用Print Spooler服务的AddPrinterDriverEx函数，将恶意的DLL文件上传到目标系统。
3.  **DLL劫持：** Print Spooler服务在加载驱动时，会加载上传的DLL文件，从而执行其中的恶意代码，实现远程代码执行。攻击者可以利用此漏洞获取SYSTEM权限。
4.  **清理：** 清理攻击痕迹，例如删除上传的DLL文件。

**项目地址:** [m8sec/CVE-2021-34527](https://github.com/m8sec/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #15

**来源**: [CVE-2021-34527-nemo-wq_PrintNightmare-CVE-2021-34527.md](../2021/CVE-2021-34527-nemo-wq_PrintNightmare-CVE-2021-34527.md)

## CVE-2021-34527 - PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以 SYSTEM 权限执行任意代码

**影响版本:** 受影响的 Windows 版本包括但不限于 Windows 10, Windows Server 2019, Windows 11 等 (参考漏洞库信息)

**利用条件:** 需要目标系统开启 Print Spooler 服务，并且攻击者需要具备一定的身份验证权限 (参考搜索引擎结果)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过 `RpcAddPrinterDriverEx` 函数不正确地执行特权文件操作来利用此漏洞，从而以 SYSTEM 权限运行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞的POC代码是有效的。多个来源确认了该漏洞的存在和可利用性。

**投毒风险：**

POC代码存在潜在的投毒风险，但概率较低（10%）。

*   **风险点：** 代码中存在多个硬编码的文件路径（如 `C:\Windows\System32\winhttp.dll` 和 `C:\Windows\System32\kernelbase.dll`），以及对共享目录的依赖。攻击者可能通过修改这些路径，引导受害者加载恶意的 DLL 文件，从而实现远程代码执行。
*   **缓解：** 代码需要根据目标环境进行调整，硬编码路径在实际使用中会存在适配问题。经验丰富的渗透测试人员会检查并修改这些路径，降低了直接运行恶意代码的风险。
*   **其他：** 虽然代码本身的功能是利用漏洞执行代码，但精心构造的恶意 DLL 仍然是攻击的核心，不能因为存在后门 DLL 就判定为投毒。

**利用方式：**

1.  **连接目标：** 使用 `impacket` 库建立与目标 Print Spooler 服务的 RPC 连接。
2.  **构建 Payload：** 构造 `DRIVER_CONTAINER` 结构，包含指向恶意 DLL 的路径（通过共享目录提供）。
3.  **触发漏洞：** 调用 `hRpcAddPrinterDriverEx` 函数，将恶意的驱动程序信息添加到 Print Spooler 服务。
4.  **权限提升：** Print Spooler 服务尝试加载指定的 DLL 文件，由于权限提升漏洞，加载过程以 SYSTEM 权限执行，从而实现任意代码执行。
5.  **尝试路径** 通过循环尝试 `C:\Windows\System32\spool\drivers\x64\3\old\{0}\{1}`目录下的DLL。

**项目地址:** [nemo-wq/PrintNightmare-CVE-2021-34527](https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #16

**来源**: [CVE-2021-34527-rdboboia_disable-RegisterSpoolerRemoteRpcEndPoint.md](../2021/CVE-2021-34527-rdboboia_disable-RegisterSpoolerRemoteRpcEndPoint.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许未经授权的用户通过Print Spooler服务远程执行代码，可能导致完全系统控制

**影响版本:** 受影响版本包括多个Windows版本，详见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，且允许网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，也被称为PrintNightmare，是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。根据漏洞库信息和搜索结果，该漏洞影响多个Windows版本。提供的漏洞利用代码实际上是一个缓解脚本，用于禁用Print Spooler接受客户端连接，通过修改注册表键值`HKLM\Software\Policies\Microsoft\Windows NT\Printers\RegisterSpoolerRemoteRpcEndPoint`为2来禁用远程连接。利用方式通常涉及滥用`RpcAddPrinterDriverEx`函数加载恶意驱动程序，从而实现代码执行。缓解方法是安装Microsoft发布的补丁或使用提供的脚本禁用Print Spooler的远程连接。

**有效性:**
根据搜索结果，存在多个POC利用代码。该缓解脚本代码有效，但目的与攻击利用相反。 它只是通过修改注册表来禁用远程连接，从而降低风险，

**投毒风险:**
该脚本本身的功能是禁用远程连接，没有发现直接的投毒代码。但是，存在一定的投毒风险：
*   **依赖外部源:** 该脚本依赖于Windows自身的`reg`命令和`shutdown`命令。攻击者理论上可以通过替换系统命令，诱导用户运行恶意程序(可能性极低)。
*   **误导用户:** 攻击者可能修改脚本描述，诱导用户在不需要的情况下禁用打印服务，从而影响正常使用。
*   **未来修改:** 仓库作者或其他人可能在未来版本中添加恶意代码。
该脚本本身用于缓解漏洞，直接包含恶意代码可能性较低，但考虑到软件供应链的安全风险，仍然存在一定的投毒可能。

**利用方式：**
PrintNightmare漏洞的利用方式通常包含以下步骤：
1.  攻击者利用具有漏洞的`RpcAddPrinterDriverEx`函数。
2.  上传包含恶意代码的驱动程序文件。
3.  Print Spooler服务尝试加载该驱动程序。
4.  由于Print Spooler以SYSTEM权限运行，恶意代码也以SYSTEM权限执行。

**项目地址:** [rdboboia/disable-RegisterSpoolerRemoteRpcEndPoint](https://github.com/rdboboia/disable-RegisterSpoolerRemoteRpcEndPoint)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #17

**来源**: [CVE-2021-34527-syntaxbearror_PowerShell-PrintNightmare.md](../2021/CVE-2021-34527-syntaxbearror_PowerShell-PrintNightmare.md)

## CVE-2021-34527 PrintNightmare Windows Print Spooler Remote Code Execution

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Print Spooler Service

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 需要目标系统启用Print Spooler服务，且攻击者能够通过网络或本地访问Print Spooler服务

**POC 可用性:** 是，但提供的代码并非直接的漏洞利用，而是缓解脚本

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。漏洞利用方式通常涉及向Print Spooler服务发送特制的请求，导致服务加载并执行恶意的DLL文件。提供的POC代码实际上是PowerShell脚本，用于设置注册表项以缓解此漏洞，而不是利用它。servers.ps1配置服务器的PointAndPrint设置，而workstations.ps1旨在阻止工作站上的远程打印连接。这些脚本通过修改注册表项来限制驱动程序安装和禁用远程RPC端点注册。由于脚本目标是缓解漏洞而非利用，因此投毒风险较低，但仍存在一定风险，例如配置错误可能导致打印功能失效，或者被篡改的脚本可能包含恶意代码。 搜索引擎结果表明此漏洞影响广泛，并且已经被积极利用。漏洞库信息也详细列出了受影响的Windows版本。需要注意的是，微软已经发布了安全更新来修复此漏洞，建议尽快安装。综合判断投毒风险约为10%，主要基于对脚本修改的可能性以及配置错误的风险。

**项目地址:** [syntaxbearror/PowerShell-PrintNightmare](https://github.com/syntaxbearror/PowerShell-PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

## POC #18

**来源**: [CVE-2021-34527-thomas-lauer_PrintNightmare.md](../2021/CVE-2021-34527-thomas-lauer_PrintNightmare.md)

## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要Print Spooler服务运行，且用户具有一定权限（至少是域内用户或本地用户）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527，也被称为PrintNightmare，是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过不当的文件操作获得SYSTEM权限，从而安装程序，查看、更改或删除数据，或创建具有完全用户权限的新帐户。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且存在公开的PoC。

**利用方式：**
利用方式主要围绕着对`C:\Windows\System32\spool\drivers`目录的ACL权限进行修改，上传恶意DLL，然后触发打印服务加载该DLL，从而以SYSTEM权限执行任意代码。

**PoC代码分析：**
提供的PoC代码主要分为以下几类：

1.  **备份/恢复ACL：**
    *   `BackupAclPrintSpooler.cmd`和`DattoRMMAclComponenteAngepasst.ps1`用于备份`C:\Windows\System32\spool\drivers`目录的ACL，以便在利用后恢复。
2.  **修改ACL：**
    *   `SetAclPrintSpooler.cmd`和`SetACL.ps1`用于设置ACL，通常是拒绝SYSTEM用户对`C:\Windows\System32\spool\drivers`目录的写入权限（Deny）。
    *  `RemoveAclPrintSpooler.cmd`和`RemoveACL.ps1`用于移除SYSTEM用户对`C:\Windows\System32\spool\drivers`目录的拒绝权限。
    *  `DattoRMMAclComponenteAngepasst.ps1` 脚本允许选择授予或拒绝SYSTEM账户对 spool\drivers 文件夹的访问权限，在不同的利用场景下进行权限控制。
3.  **监控策略：**
    *   `Monitoring Policy SYSMON_PrinterSpooler.pcy`是一个Sysmon策略，用于监控与打印服务相关的事件。
4.  **其他：**
    *   `RestrictDriverInstallationToAdministrators.cmd`通过修改注册表来限制只有管理员才能安装打印驱动程序，是一个缓解措施。
    * `StopUnusedPrinterserver.ps1`尝试停止域内不使用的打印服务，也是缓解措施。

**投毒风险：**
PoC代码本身的功能主要是修改ACL和备份ACL，属于防御性质的，但也可能被用于攻击的前置条件，有投毒风险。
其中`DattoRMMAclComponenteAngepasst.ps1`脚本，根据用户选择grant/deny权限，脚本中没有发现直接执行恶意代码的部分，主要作用还是配置ACL权限。因此，投毒风险较低，约10%。

总的来说，这些PoC代码本身不包含直接执行恶意代码的后门，但攻击者可以利用这些脚本作为攻击链的一部分，例如先修改ACL，上传恶意DLL，然后利用漏洞执行代码。因此，PoC代码本身存在一定的被恶意利用的风险。

**项目地址:** [thomas-lauer/PrintNightmare](https://github.com/thomas-lauer/PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)

---

