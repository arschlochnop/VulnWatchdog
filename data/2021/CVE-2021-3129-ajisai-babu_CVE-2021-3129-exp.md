## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** Laravel开启Debug模式且安装了Ignition组件(版本 < 2.5.2)

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对CVE-2021-3129漏洞设计，漏洞根源在于Laravel默认错误页渲染组件Ignition对file_get_contents()和file_put_contents()的不安全处理。POC通过向`/_ignition/execute-solution`端点发送构造好的JSON请求来实现攻击。其核心逻辑分为几个阶段：首先是探测与环境清理，通过多次调用不同的解构方案确保log文件处于可控状态；其次是Payload植入，利用PHP的quoted-printable编码特性将恶意Phar序列化数据写入Laravel的日志文件中；最后通过`phar://`伪协议触发反序列化。此POC包含了自动化探测、路径获取以及最终的EXP执行模块，能够直接回显PHP版本、系统信息及Web目录，验证逻辑严密。代码中使用了标准的requests库进行HTTP通信，并包含正则表达式提取关键信息，实测在开启Debug模式的Laravel环境中具有极高的成功率。利用步骤：1. 确认目标网站开启Debug模式；2. 访问`/_ignition/execute-solution`确认接口存在；3. 运行POC清空或初始化Laravel日志文件；4. 发送精心构造的Payload，将Phar反序列化数据通过编码方式写入日志；5. 通过Log存储路径触发Phar伪协议读取，执行任意PHP代码；6. 观察回显结果获取敏感信息或写入Webshell。投毒风险分析：该POC脚本代码逻辑清晰，主要依赖requests、json、argparse等Python标准库或常用库，未发现明显的恶意混淆代码或远程下载执行行为。脚本中虽然包含了对目标进行写操作（写入日志及可能的Webshell）的行为，但这属于漏洞利用POC的常规范畴。风险点主要在于：第一，该脚本包含自动利用（EXP）功能，如果被初级攻击者（脚本小子）滥用，可能导致大规模的自动化攻击；第二，由于脚本需要解析复杂的PHP环境回显，如果从非官方渠道下载，攻击者可能在正则解析逻辑中嵌入恶意指令，例如将回显数据异步发送至第三方服务器；第三，脚本中的代理设置（proxy参数）如果被篡改，可能导致渗透测试人员的流量被劫持。总体来看，当前提供的代码段符合防御性研究标准，但在使用时应注意在受控沙箱环境下运行，并仔细核对外部依赖库的安全性。

**项目地址:** [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
