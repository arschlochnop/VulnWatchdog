## CVE-2021-3156 - Sudo 提权 (Privilege Escalation)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 提权 (Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.8.2 到 1.8.31p2; 1.9.0 到 1.9.5p1

**利用条件:** 具有本地普通用户访问权限，目标系统运行未修复的Sudo版本

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC针对著名的“Baron Samedit”漏洞（CVE-2021-3156），这是一个存在于Sudo解析命令行参数逻辑中的堆缓冲区溢出漏洞。该POC包含了一个经过精心构造的汇编文件（exploit.asm），它利用了sudoedit在处理转义字符（backslash）时的off-by-one错误。通过在命令行参数末尾放置单个反斜杠并结合“-s”模式，触发缓冲区越界写入。POC的设计非常成熟，包含了专门用于环境块布局的逻辑，通过溢出覆盖glibc的堆元数据或相关结构，最终执行shellcode.c编译出的恶意共享对象。在Ubuntu 20.04等典型Linux发行版上，该代码具备极高的成功率。其核心逻辑在于通过‘rep stosb’和‘rep movsb’指令在内存中精确排布Payload，这比一般的Python或Bash脚本更难检测，也展示了攻击者对目标内存布局的深度掌握。经过分析，该POC结构完整，包含了自动化编译的Makefile，是一个可以直接转化为实战武器的漏洞利用程序。【利用步骤】1. 在目标系统中下载PoC源代码；2. 执行‘make’命令，该过程会调用nasm编译汇编代码并使用gcc编译shellcode共享库；3. 运行生成的二进制文件‘./exploit’；4. 程序会调用sudoedit并注入伪造的参数环境，若溢出成功，将直接弹出具有Root权限的Shell。【投毒风险分析】从代码层面分析，虽然这是一个功能完备的漏洞利用程序，但其投毒风险相对较低，约为15%。首先，源代码中虽然包含大量汇编指令，但这些指令的功能明确指向了对CVE-2021-3156漏洞的内存布局构造，未发现明显的网络回传、文件隐藏或持久化驻留代码。其次，代码库中包含清晰的README和Cleanup指令，符合安全研究人员的发布习惯。需要注意的是，此类高度底层的POC往往会被恶意攻击者集成到自动化提权工具包中。虽然当前PoC未发现恶意后门（Backdoor），但用户在使用时应重点关注Makefile是否引入了未授权的外部依赖下载，以及shellcode.c是否除了执行/bin/sh外还有其他隐藏动作。汇编代码中的硬编码字符串和随机变量名（如ZP9TQXJm7Lw）虽然看起来具有一定的混淆性，但更多是为了避开特定的内存边界或绕过简单的静态特征扫描，而非典型的投毒行为。在沙箱环境运行验证是安全的，但在生产环境部署前应重新审计shellcode的编译逻辑。

**项目地址:** /tmp/vulnwatchdog_1376d8f355a0c19006e0f027c9467c8f/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
