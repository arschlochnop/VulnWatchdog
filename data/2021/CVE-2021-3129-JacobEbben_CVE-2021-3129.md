## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式且安装了Ignition(2.5.2版本以下)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个功能完善的Python自动化脚本，专门针对Laravel开启Debug模式下的CVE-2021-3129漏洞设计。它通过利用Ignition组件中对file_get_contents()和file_put_contents()函数的不安全调用来实现攻击。POC的核心逻辑通过构造恶意Log文件并触发Phar反序列化来达成RCE。代码结构清晰，包含了URL规范化、代理支持、Payload生成以及日志清理功能。它调用了外部工具phpggc来生成反序列化链，这是一种工业级的标准利用方式，极大地提高了漏洞利用的成功率。脚本能够自动执行清空日志、注入Payload、转换为Phar格式、触发漏洞并清理现场的全流程。经分析，其Payload构造逻辑符合漏洞原理，能够有效地在目标服务器上执行任意系统命令，属于高质量的Exploit脚本。利用步骤：首先，攻击者需要确认目标Laravel站点开启了Debug模式；其次，通过Ignition提供的API接口发送特定的POST请求，利用file_put_contents将Base64编码的Payload写入storage/logs/laravel.log文件；随后，通过多次请求配合php://filter伪协议对日志文件进行处理，将其转换为合法的Phar文件格式；最后，通过phar://协议访问该日志文件触发反序列化。投毒风险分析：该代码段目前表现为专业的渗透测试工具，其逻辑透明且使用了标准库（如requests, argparse, subprocess）。风险点主要集中在以下几个方面：第一，脚本依赖外部的phpggc路径，如果用户从不可信来源获取预配置的二进制文件，可能存在替代风险；第二，脚本中使用了subprocess.getoutput执行本地shell命令来生成Payload，虽然目的是为了调用php，但若输入参数未经过滤，在某些环境下可能造成本地执行风险。然而，代码中没有发现典型的恶意混淆、隐蔽的网络回连、敏感信息窃取（如环境变量上传）或自我复制行为。脚本开头带有明确的免责声明，且代码逻辑完全围绕CVE漏洞利用展开。整体而言，该POC在提供给防御方研究时是安全的，但作为防御研究员，建议在隔离的沙箱环境中运行该脚本，并监控subprocess调用的具体命令流，以防在复杂的本地配置中产生意外侧效。由于代码引用了知名的安全研究博客，其可信度较高，属于低风险等级的合规研究代码。

**项目地址:** [https://pentest-tools.com/blog/exploit-rce-vulnerability-laravel-cve-2021-3129](https://pentest-tools.com/blog/exploit-rce-vulnerability-laravel-cve-2021-3129)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
