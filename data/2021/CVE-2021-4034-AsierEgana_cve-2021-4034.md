# CVE-2021-4034

> 📦 该CVE有 **34** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户获得root权限

**影响版本:** all

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 未正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 POC 代码是有效的。它利用了 pkexec 的漏洞，通过设置特定的环境变量 (GCONV_PATH, CHARSET, SHELL) 来加载恶意的 gconv 模块，该模块包含提权 shellcode。POC 代码首先创建必要的目录和文件，然后编译包含提权代码的共享库，最后通过 `execve` 函数，使用特制的 env 启动 `/usr/bin/pkexec`，成功执行shellcode。

**投毒风险：**
代码本身实现了漏洞利用，但存在轻微的投毒风险，风险评估为10%。

*   **潜在的后门代码：**
虽然提供的 Shellcode 会创建一个 root shell，但可以修改 shellcode 以包含其他恶意操作，例如添加后门帐户或修改系统文件。虽然当前的shellcode明确包含了清理操作（`rm -rf 'GCONV_PATH=.' 'pwnkit'`），减少了暴露，但如果存在疏忽，仍然可能留下痕迹。
*   **依赖性混淆：**虽然POC脚本本身比较完整，但攻击者可能会尝试混淆对特定库或工具的依赖关系，使分析变得更加困难。
*    **作者意图：** 投毒的判断主要在于作者是否有意图引入恶意行为。考虑到这是一个漏洞利用 POC，重点在于演示漏洞，而不是进行隐蔽的攻击。但存在将shellcode替换为更加隐蔽的代码的可能性

**利用方式：**
1.  **创建 GCONV_PATH 目录和触发文件：** 利用 `mkdir` 和 `touch` 命令创建假的 `GCONV_PATH` 目录和触发文件。
2.  **创建 gconv-modules 文件：**  创建一个包含模块定义信息的 `gconv-modules` 文件，指定 UTF-8 和 PWNKIT 编码之间的转换使用自定义的 pwnkit 模块。
3.  **创建恶意的 gconv 模块（pwnkit.c）：** 创建包含 shellcode 的 C 代码文件 `pwnkit/pwnkit.c`。该 shellcode 设置用户 ID 和组 ID 为 root，然后启动一个 root shell。
4.  **编译 pwnkit.c 为共享库：** 使用 `gcc` 命令将 `pwnkit.c` 编译成一个共享库文件 `pwnkit/pwnkit.so`。
5.  **设置环境变量：**  设置环境变量 `GCONV_PATH=.`，`CHARSET=PWNKIT`，`SHELL=pwnkit`。这些环境变量会欺骗 pkexec 加载恶意的 gconv 模块。
6.  **执行 pkexec：**  使用 `execve` 函数执行 `/usr/bin/pkexec`，并将精心构造的环境变量传递给它。这将触发漏洞，加载恶意的 gconv 模块，并执行 shellcode，从而获得 root 权限。

简单来说，攻击者通过构造特定的环境变量，使得 pkexec 在执行过程中加载并执行攻击者提供的恶意代码，从而实现权限提升。

**项目地址:** [12bijaya/CVE-2021-4034-PwnKit-](https://github.com/12bijaya/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #2

**来源**: [CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md](../2021/CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** 所有版本（修复前）

**利用条件:** 目标系统需要安装且存在未修复的 polkit pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 实用程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数的数量，从而导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码描述，该漏洞利用的有效性非常高。漏洞库信息明确指出该漏洞允许非特权用户获取管理权限。搜索引擎结果中包含大量关于该漏洞的分析、利用方法和修复方案，表明该漏洞是一个真实存在的，并且被广泛利用的漏洞。

**投毒风险：**
提供的漏洞利用代码只是一个 README.md 文件，描述了漏洞本身。该文件并不包含实际的利用代码，因此很难直接判断是否存在投毒风险。但由于真实的POC代码来源于互联网，下载和使用未经审查的利用代码始终存在潜在的投毒风险。考虑到POC来源不明，且仅为漏洞描述文件，判定投毒风险较低，预估为10%。

**利用方式：**
1.  **利用参数计数错误:** 攻击者需要通过某种方式使得pkexec的参数计数错误。
2.  **构造恶意环境变量:**  攻击者精心构造特定的环境变量，这些环境变量会被 pkexec 误认为是命令来执行。
3.  **执行任意代码:**  pkexec 在权限提升的情况下执行攻击者控制的任意代码，从而获得 root 权限。

总的来说，CVE-2021-4034 是一个严重的安全漏洞，应该尽快修复。使用未经验证的POC时注意潜在的风险。

**项目地址:** [ASG-CASTLE/CVE-2021-4034](https://github.com/ASG-CASTLE/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #3

**来源**: [CVE-2021-4034-AsierEgana_cve-2021-4034.md](../2021/CVE-2021-4034-AsierEgana_cve-2021-4034.md)

# CVE-2021-4034

> 📦 该CVE有 **34** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户获得root权限

**影响版本:** all

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 未正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 POC 代码是有效的。它利用了 pkexec 的漏洞，通过设置特定的环境变量 (GCONV_PATH, CHARSET, SHELL) 来加载恶意的 gconv 模块，该模块包含提权 shellcode。POC 代码首先创建必要的目录和文件，然后编译包含提权代码的共享库，最后通过 `execve` 函数，使用特制的 env 启动 `/usr/bin/pkexec`，成功执行shellcode。

**投毒风险：**
代码本身实现了漏洞利用，但存在轻微的投毒风险，风险评估为10%。

*   **潜在的后门代码：**
虽然提供的 Shellcode 会创建一个 root shell，但可以修改 shellcode 以包含其他恶意操作，例如添加后门帐户或修改系统文件。虽然当前的shellcode明确包含了清理操作（`rm -rf 'GCONV_PATH=.' 'pwnkit'`），减少了暴露，但如果存在疏忽，仍然可能留下痕迹。
*   **依赖性混淆：**虽然POC脚本本身比较完整，但攻击者可能会尝试混淆对特定库或工具的依赖关系，使分析变得更加困难。
*    **作者意图：** 投毒的判断主要在于作者是否有意图引入恶意行为。考虑到这是一个漏洞利用 POC，重点在于演示漏洞，而不是进行隐蔽的攻击。但存在将shellcode替换为更加隐蔽的代码的可能性

**利用方式：**
1.  **创建 GCONV_PATH 目录和触发文件：** 利用 `mkdir` 和 `touch` 命令创建假的 `GCONV_PATH` 目录和触发文件。
2.  **创建 gconv-modules 文件：**  创建一个包含模块定义信息的 `gconv-modules` 文件，指定 UTF-8 和 PWNKIT 编码之间的转换使用自定义的 pwnkit 模块。
3.  **创建恶意的 gconv 模块（pwnkit.c）：** 创建包含 shellcode 的 C 代码文件 `pwnkit/pwnkit.c`。该 shellcode 设置用户 ID 和组 ID 为 root，然后启动一个 root shell。
4.  **编译 pwnkit.c 为共享库：** 使用 `gcc` 命令将 `pwnkit.c` 编译成一个共享库文件 `pwnkit/pwnkit.so`。
5.  **设置环境变量：**  设置环境变量 `GCONV_PATH=.`，`CHARSET=PWNKIT`，`SHELL=pwnkit`。这些环境变量会欺骗 pkexec 加载恶意的 gconv 模块。
6.  **执行 pkexec：**  使用 `execve` 函数执行 `/usr/bin/pkexec`，并将精心构造的环境变量传递给它。这将触发漏洞，加载恶意的 gconv 模块，并执行 shellcode，从而获得 root 权限。

简单来说，攻击者通过构造特定的环境变量，使得 pkexec 在执行过程中加载并执行攻击者提供的恶意代码，从而实现权限提升。

**项目地址:** [12bijaya/CVE-2021-4034-PwnKit-](https://github.com/12bijaya/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #2

**来源**: [CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md](../2021/CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** 所有版本（修复前）

**利用条件:** 目标系统需要安装且存在未修复的 polkit pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 实用程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数的数量，从而导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码描述，该漏洞利用的有效性非常高。漏洞库信息明确指出该漏洞允许非特权用户获取管理权限。搜索引擎结果中包含大量关于该漏洞的分析、利用方法和修复方案，表明该漏洞是一个真实存在的，并且被广泛利用的漏洞。

**投毒风险：**
提供的漏洞利用代码只是一个 README.md 文件，描述了漏洞本身。该文件并不包含实际的利用代码，因此很难直接判断是否存在投毒风险。但由于真实的POC代码来源于互联网，下载和使用未经审查的利用代码始终存在潜在的投毒风险。考虑到POC来源不明，且仅为漏洞描述文件，判定投毒风险较低，预估为10%。

**利用方式：**
1.  **利用参数计数错误:** 攻击者需要通过某种方式使得pkexec的参数计数错误。
2.  **构造恶意环境变量:**  攻击者精心构造特定的环境变量，这些环境变量会被 pkexec 误认为是命令来执行。
3.  **执行任意代码:**  pkexec 在权限提升的情况下执行攻击者控制的任意代码，从而获得 root 权限。

总的来说，CVE-2021-4034 是一个严重的安全漏洞，应该尽快修复。使用未经验证的POC时注意潜在的风险。

**项目地址:** [ASG-CASTLE/CVE-2021-4034](https://github.com/ASG-CASTLE/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #3

**来源**: [CVE-2021-4034-AsierEgana_cve-2021-4034.md](../2021/CVE-2021-4034-AsierEgana_cve-2021-4034.md)

# CVE-2021-4034

> 📦 该CVE有 **34** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户获得root权限

**影响版本:** all

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 未正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 POC 代码是有效的。它利用了 pkexec 的漏洞，通过设置特定的环境变量 (GCONV_PATH, CHARSET, SHELL) 来加载恶意的 gconv 模块，该模块包含提权 shellcode。POC 代码首先创建必要的目录和文件，然后编译包含提权代码的共享库，最后通过 `execve` 函数，使用特制的 env 启动 `/usr/bin/pkexec`，成功执行shellcode。

**投毒风险：**
代码本身实现了漏洞利用，但存在轻微的投毒风险，风险评估为10%。

*   **潜在的后门代码：**
虽然提供的 Shellcode 会创建一个 root shell，但可以修改 shellcode 以包含其他恶意操作，例如添加后门帐户或修改系统文件。虽然当前的shellcode明确包含了清理操作（`rm -rf 'GCONV_PATH=.' 'pwnkit'`），减少了暴露，但如果存在疏忽，仍然可能留下痕迹。
*   **依赖性混淆：**虽然POC脚本本身比较完整，但攻击者可能会尝试混淆对特定库或工具的依赖关系，使分析变得更加困难。
*    **作者意图：** 投毒的判断主要在于作者是否有意图引入恶意行为。考虑到这是一个漏洞利用 POC，重点在于演示漏洞，而不是进行隐蔽的攻击。但存在将shellcode替换为更加隐蔽的代码的可能性

**利用方式：**
1.  **创建 GCONV_PATH 目录和触发文件：** 利用 `mkdir` 和 `touch` 命令创建假的 `GCONV_PATH` 目录和触发文件。
2.  **创建 gconv-modules 文件：**  创建一个包含模块定义信息的 `gconv-modules` 文件，指定 UTF-8 和 PWNKIT 编码之间的转换使用自定义的 pwnkit 模块。
3.  **创建恶意的 gconv 模块（pwnkit.c）：** 创建包含 shellcode 的 C 代码文件 `pwnkit/pwnkit.c`。该 shellcode 设置用户 ID 和组 ID 为 root，然后启动一个 root shell。
4.  **编译 pwnkit.c 为共享库：** 使用 `gcc` 命令将 `pwnkit.c` 编译成一个共享库文件 `pwnkit/pwnkit.so`。
5.  **设置环境变量：**  设置环境变量 `GCONV_PATH=.`，`CHARSET=PWNKIT`，`SHELL=pwnkit`。这些环境变量会欺骗 pkexec 加载恶意的 gconv 模块。
6.  **执行 pkexec：**  使用 `execve` 函数执行 `/usr/bin/pkexec`，并将精心构造的环境变量传递给它。这将触发漏洞，加载恶意的 gconv 模块，并执行 shellcode，从而获得 root 权限。

简单来说，攻击者通过构造特定的环境变量，使得 pkexec 在执行过程中加载并执行攻击者提供的恶意代码，从而实现权限提升。

**项目地址:** [12bijaya/CVE-2021-4034-PwnKit-](https://github.com/12bijaya/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #2

**来源**: [CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md](../2021/CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** 所有版本（修复前）

**利用条件:** 目标系统需要安装且存在未修复的 polkit pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 实用程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数的数量，从而导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码描述，该漏洞利用的有效性非常高。漏洞库信息明确指出该漏洞允许非特权用户获取管理权限。搜索引擎结果中包含大量关于该漏洞的分析、利用方法和修复方案，表明该漏洞是一个真实存在的，并且被广泛利用的漏洞。

**投毒风险：**
提供的漏洞利用代码只是一个 README.md 文件，描述了漏洞本身。该文件并不包含实际的利用代码，因此很难直接判断是否存在投毒风险。但由于真实的POC代码来源于互联网，下载和使用未经审查的利用代码始终存在潜在的投毒风险。考虑到POC来源不明，且仅为漏洞描述文件，判定投毒风险较低，预估为10%。

**利用方式：**
1.  **利用参数计数错误:** 攻击者需要通过某种方式使得pkexec的参数计数错误。
2.  **构造恶意环境变量:**  攻击者精心构造特定的环境变量，这些环境变量会被 pkexec 误认为是命令来执行。
3.  **执行任意代码:**  pkexec 在权限提升的情况下执行攻击者控制的任意代码，从而获得 root 权限。

总的来说，CVE-2021-4034 是一个严重的安全漏洞，应该尽快修复。使用未经验证的POC时注意潜在的风险。

**项目地址:** [ASG-CASTLE/CVE-2021-4034](https://github.com/ASG-CASTLE/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #3

**来源**: [CVE-2021-4034-AsierEgana_cve-2021-4034.md](../2021/CVE-2021-4034-AsierEgana_cve-2021-4034.md)

# CVE-2021-4034

> 📦 该CVE有 **33** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-12bijaya_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户获得root权限

**影响版本:** all

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 未正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 POC 代码是有效的。它利用了 pkexec 的漏洞，通过设置特定的环境变量 (GCONV_PATH, CHARSET, SHELL) 来加载恶意的 gconv 模块，该模块包含提权 shellcode。POC 代码首先创建必要的目录和文件，然后编译包含提权代码的共享库，最后通过 `execve` 函数，使用特制的 env 启动 `/usr/bin/pkexec`，成功执行shellcode。

**投毒风险：**
代码本身实现了漏洞利用，但存在轻微的投毒风险，风险评估为10%。

*   **潜在的后门代码：**
虽然提供的 Shellcode 会创建一个 root shell，但可以修改 shellcode 以包含其他恶意操作，例如添加后门帐户或修改系统文件。虽然当前的shellcode明确包含了清理操作（`rm -rf 'GCONV_PATH=.' 'pwnkit'`），减少了暴露，但如果存在疏忽，仍然可能留下痕迹。
*   **依赖性混淆：**虽然POC脚本本身比较完整，但攻击者可能会尝试混淆对特定库或工具的依赖关系，使分析变得更加困难。
*    **作者意图：** 投毒的判断主要在于作者是否有意图引入恶意行为。考虑到这是一个漏洞利用 POC，重点在于演示漏洞，而不是进行隐蔽的攻击。但存在将shellcode替换为更加隐蔽的代码的可能性

**利用方式：**
1.  **创建 GCONV_PATH 目录和触发文件：** 利用 `mkdir` 和 `touch` 命令创建假的 `GCONV_PATH` 目录和触发文件。
2.  **创建 gconv-modules 文件：**  创建一个包含模块定义信息的 `gconv-modules` 文件，指定 UTF-8 和 PWNKIT 编码之间的转换使用自定义的 pwnkit 模块。
3.  **创建恶意的 gconv 模块（pwnkit.c）：** 创建包含 shellcode 的 C 代码文件 `pwnkit/pwnkit.c`。该 shellcode 设置用户 ID 和组 ID 为 root，然后启动一个 root shell。
4.  **编译 pwnkit.c 为共享库：** 使用 `gcc` 命令将 `pwnkit.c` 编译成一个共享库文件 `pwnkit/pwnkit.so`。
5.  **设置环境变量：**  设置环境变量 `GCONV_PATH=.`，`CHARSET=PWNKIT`，`SHELL=pwnkit`。这些环境变量会欺骗 pkexec 加载恶意的 gconv 模块。
6.  **执行 pkexec：**  使用 `execve` 函数执行 `/usr/bin/pkexec`，并将精心构造的环境变量传递给它。这将触发漏洞，加载恶意的 gconv 模块，并执行 shellcode，从而获得 root 权限。

简单来说，攻击者通过构造特定的环境变量，使得 pkexec 在执行过程中加载并执行攻击者提供的恶意代码，从而实现权限提升。

**项目地址:** [12bijaya/CVE-2021-4034-PwnKit-](https://github.com/12bijaya/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #2

**来源**: [CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md](../2021/CVE-2021-4034-ASG-CASTLE_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** 所有版本（修复前）

**利用条件:** 目标系统需要安装且存在未修复的 polkit pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 实用程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数的数量，从而导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码描述，该漏洞利用的有效性非常高。漏洞库信息明确指出该漏洞允许非特权用户获取管理权限。搜索引擎结果中包含大量关于该漏洞的分析、利用方法和修复方案，表明该漏洞是一个真实存在的，并且被广泛利用的漏洞。

**投毒风险：**
提供的漏洞利用代码只是一个 README.md 文件，描述了漏洞本身。该文件并不包含实际的利用代码，因此很难直接判断是否存在投毒风险。但由于真实的POC代码来源于互联网，下载和使用未经审查的利用代码始终存在潜在的投毒风险。考虑到POC来源不明，且仅为漏洞描述文件，判定投毒风险较低，预估为10%。

**利用方式：**
1.  **利用参数计数错误:** 攻击者需要通过某种方式使得pkexec的参数计数错误。
2.  **构造恶意环境变量:**  攻击者精心构造特定的环境变量，这些环境变量会被 pkexec 误认为是命令来执行。
3.  **执行任意代码:**  pkexec 在权限提升的情况下执行攻击者控制的任意代码，从而获得 root 权限。

总的来说，CVE-2021-4034 是一个严重的安全漏洞，应该尽快修复。使用未经验证的POC时注意潜在的风险。

**项目地址:** [ASG-CASTLE/CVE-2021-4034](https://github.com/ASG-CASTLE/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #3

**来源**: [CVE-2021-4034-BugVex_Poison-HTB-Report.md](../2021/CVE-2021-4034-BugVex_Poison-HTB-Report.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可获取 root 权限

**影响版本:** all (受影响)

**利用条件:** 本地用户可以访问目标机器，且 pkexec 未打补丁

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 工具中的一个本地提权漏洞。由于 pkexec 未正确处理参数计数，攻击者可以通过构造特定的环境变量来执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞利用代码中展示了完整的利用步骤，包括编译恶意 payload，设置环境变量，然后运行 pkexec。搜索引擎结果也表明该漏洞在野外被广泛利用。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个部分：
1.  **C 源代码 (payload.c)：** 用于生成共享对象 (payload.so)，该共享对象包含恶意代码。
2.  **Shell 命令：** 设置环境变量并运行 pkexec。

风险分析：
*   **payload.c 的内容：** 没有提供 `payload.c` 文件的具体内容，因此无法直接判断 payload 的行为。但是，从利用方式来看，该 payload 旨在利用 pkexec 的漏洞来执行恶意代码。
*   **环境变量设置：** 环境变量 `GCONV_PATH`、`CHARSET`、`LD_PRELOAD` 和 `PATH` 是利用该漏洞的关键。`GCONV_PATH` 和 `CHARSET` 用于加载恶意的 gconv 模块，`LD_PRELOAD` 用于预加载恶意的共享对象，`PATH` 用于确保恶意的 gconv 模块优先被加载。

虽然POC中涉及`payload.c` ,如果没有对源码进行恶意篡改和添加恶意代码, 本身是不存在投毒风险的,但是`payload.c`文件未给出,无法完全验证,存在潜在投毒风险，但是概率极低。

**利用方式：**
1.  **编译 Payload：** 首先，使用 GCC 编译 C 源代码 (payload.c) 生成共享对象 (payload.so)。编译时需要使用 `-shared` 和 `-fPIC` 选项。
2.  **创建 exploit 目录：** 创建一个名为 exploit 的目录，并将 payload.so 移动到该目录中。
3.  **创建 gconv-modules 文件：** 在 exploit 目录中创建一个名为 gconv-modules 的文件，该文件用于配置 gconv 模块。内容一般是 `module UTF-8// POC// payload 2`。
4.  **设置环境变量：** 设置以下环境变量：
    *   `GIO_USE_VFS=local`
    *   `PATH=./exploit:$PATH`
    *   `LD_PRELOAD=./exploit/payload.so`
    *   `GCONV_PATH=./exploit`
    *   `CHARSET=POC`
5.  **运行 pkexec：** 运行 pkexec 命令，这将触发漏洞并执行 payload.so 中的恶意代码，从而提升权限。

**项目地址:** [BugVex/Poison-HTB-Report](https://github.com/BugVex/Poison-HTB-Report)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #4

**来源**: [CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md](../2021/CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md)

## CVE-2021-4034-Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可执行 pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 没有正确处理调用参数计数，导致程序尝试将环境变量作为命令执行。

**漏洞利用方式：**

1.  **利用 GCONV_PATH 和 CHARSET 环境变量：** 该漏洞利用通过精心构造 `GCONV_PATH` 和 `CHARSET` 环境变量，欺骗 `pkexec` 加载恶意的 gconv 模块。gconv 模块是用于字符集转换的动态链接库。
2.  **创建恶意 gconv 模块：** 攻击者创建一个包含恶意代码的 `.so` 文件（payload.so），并在 `gconv-modules` 文件中定义一个字符集转换规则，将特定的字符集（例如 `LPE`）映射到该恶意 `.so` 文件。
3.  **触发漏洞：** 当 `pkexec` 尝试执行字符集转换时，会加载并执行恶意 `.so` 文件中的代码，从而实现权限提升。
4.  **代码分析：** `pkexec_exploit.c` 首先创建必要的目录结构 (`GCONV_PATH=.`, `lpe`)，然后在 `lpe/payload.c` 中写入 shellcode，编译成动态链接库 `lpe/payload.so`。shellcode 的作用是设置 uid、gid 为 0，然后执行 `/bin/sh`。
5.   **投毒风险分析:** POC代码本身主要用于提权，但存在一定的投毒风险。例如，攻击者可能修改 `payload.c` 中的 shellcode，使其在提权后执行其他恶意操作，如安装后门程序、窃取用户数据等。虽然`pkexec_exploit.c`主要功能是利用漏洞进行权限提升，但其中的`payload.c`，可能包含潜在的恶意代码。payload.c中的恶意代码可能执行以下操作：下载并执行其他恶意程序、修改系统文件、创建具有root权限的后门帐户等。从防御的角度来看，所有来自外部的代码都应被视为潜在的威胁。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该漏洞的利用是有效的。POC 代码已经公开，并且有大量的文章和视频演示了如何利用该漏洞。

**总结：**

这是一个严重的安全漏洞，允许未经授权的用户获得系统 root 权限。系统管理员应尽快应用补丁程序来修复此漏洞。

**项目地址:** [CYB3RK1D/CVE-2021-4034-POC](https://github.com/CYB3RK1D/CVE-2021-4034-POC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #5

**来源**: [CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md](../2021/CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** 所有版本 (修复前)

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户身份运行命令，具体权限取决于预定义的策略。

**漏洞利用方式：**

1.  **漏洞原理：** pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。通过精心构造环境变量，攻击者可以诱使pkexec执行任意代码。

2.  **利用代码分析：**
    *   `cve-2021-4034.c`:  该C代码负责设置特定的环境变量并执行`/usr/bin/pkexec`。关键的环境变量包括：
        *   `pwnkit.so:.`:  这指示动态链接器在当前目录中查找名为`pwnkit.so`的共享对象。
        *   `PATH=GCONV_PATH=.`:  这会将`PATH`环境变量设置为`GCONV_PATH=.`， 影响程序的路径查找方式.
        *   `CHARSET=PWNKIT`: 触发加载恶意gconv模块的关键。
        *   `GIO_USE_VFS=`: 清空`GIO_USE_VFS`环境变量，避免潜在的干扰。
    *   `pwnkit.c`:  该C代码定义了`gconv`和`gconv_init`函数。`gconv_init`函数是漏洞利用的核心，它被设计为在gconv模块加载时执行。此函数会设置uid和gid为0，然后执行`/bin/sh`，从而获得root shell。
    *   `gconv-modules`: 定义了一个gconv模块，将`PWNKIT`字符集映射到`pwnkit.so`库。
    *   `Makefile`:  用于编译漏洞利用代码，生成`pwnkit.so`共享对象和`cve-2021-4034`可执行文件。

3.  **利用步骤：**
    a.  编译`pwnkit.c`生成共享对象`pwnkit.so`。
    b.  创建一个`gconv-modules`文件，声明一个使用`pwnkit.so`的gconv模块。
    c.  执行`cve-2021-4034`，它会设置特定的环境变量并运行`pkexec`。`pkexec`会加载恶意的gconv模块，调用`gconv_init`函数，从而导致权限提升。

**有效性：**提供的PoC代码是有效的。它利用了pkexec中的参数处理漏洞，通过gconv模块机制执行预定义的shell，从而实现本地权限提升。

**投毒风险：** 此仓库存在极小的投毒风险。`dry-run`目录下的文件可以用来进行无害的测试。如果将 `dry-run-cve-2021-4034.c` 中的 `setuid(0)` 修改为恶意操作，则存在投毒可能。但原代码并未发现明显的恶意行为，判定投毒风险为1%。实际部署前需要进行代码审计。

**项目地址:** [EuJin03/CVE-2021-4034-PoC](https://github.com/EuJin03/CVE-2021-4034-PoC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #6

**来源**: [CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md](../2021/CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** 所有版本 (漏洞修复前)

**利用条件:** 需要本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 中 pkexec 工具的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量来利用此漏洞，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析:**

1.  **漏洞原理:**  pkexec 没有正确处理传递给它的参数数量。 当参数数量不足时，它会尝试将环境变量作为程序执行。
2.  **利用方式:** 提供的 POC 代码利用了 `GCONV_PATH` 环境变量。`GCONV_PATH` 用于指定 gconv 模块的搜索路径，gconv 模块用于字符集转换。攻击者创建一个目录，并在该目录下创建一个名为 `gconv-modules` 的文件，该文件定义了一个恶意的 gconv 模块。然后，设置 `GCONV_PATH` 环境变量指向该目录，并触发 pkexec。pkexec 会加载恶意的 gconv 模块，该模块在 `gconv_init` 函数中执行 `setuid(0)`、`setgid(0)`、`setgroups(0)` 和 `execve("/bin/sh", NULL, NULL)`，从而获得 root shell。
3.  **POC代码分析:**
    *   `Makefile`: 用于编译恶意的共享库 `evil.so` 和利用程序 `exploit`。
    *   `evil-so.c`: 包含恶意代码，该代码在加载时会设置 uid、gid 和 groups 为 0，并执行 `/bin/sh`，创建一个 root shell。
    *   `exploit.c`: 创建必要的目录和文件结构，设置环境变量，并执行 `pkexec`。

**有效性:**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该 POC 代码是有效的。 漏洞利用代码构造了特定的环境，利用 pkexec 的漏洞执行恶意代码，从而实现提权。

**投毒风险:**

代码中没有明显的投毒行为。`evil-so.c`的目的就是提权，这符合漏洞利用的需求。没有发现任何在提权之外执行其他恶意操作的代码。 风险评估为 0%。


**项目地址:** [FancySauce/PwnKit-CVE-2021-4034](https://github.com/FancySauce/PwnKit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #7

**来源**: [CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md](../2021/CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升为root权限

**影响版本:** 所有版本（受影响版本）

**利用条件:** 目标系统必须安装易受攻击的Polkit版本，且攻击者需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 没有正确处理调用参数的个数，导致尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞描述、搜索结果和提供的漏洞利用代码，该漏洞是有效的。搜索结果中多个链接（例如，Qualys 的博客文章、Red Hat 的安全公告）都确认了该漏洞的存在，并提供了利用的细节。提供的 POC 代码旨在利用此漏洞。

**投毒风险：**
提供的 exploit.c 代码的功能是：
1.  创建 `GCONV_PATH=.` 目录。
2.  创建 `GCONV_PATH=./exploit` 文件，并赋予执行权限。
3.  创建 `exploit` 目录。
4.  创建 `exploit/gconv-modules` 文件，包含 gconv 模块的配置信息。
5.  创建 `exploit/shelltospawn.c` 文件，包含 C 代码，该代码将设置 uid 和 gid 为 0，并执行 `/bin/bash`。
6.  编译 `exploit/shelltospawn.c` 为共享库 `exploit/ISO646.so`。
7.  使用 `execve` 函数，设置特殊的环境变量（`PATH`, `CHARSET`, `SHELL`），并执行 `/usr/bin/pkexec`。

这个利用方法利用了 `gconv` 机制中的一个漏洞，允许通过环境变量加载恶意共享库，从而执行提权操作。

从代码本身来看，没有明显的**直接的后门代码**，例如植入 SSH 密钥或创建后门账户。然而，`system("/bin/bash")` 这行代码的功能是启动一个 root shell，攻击者可以使用该 shell 执行任何操作。因此，可以将整个利用过程视为一种投毒，因为它的最终结果是在目标系统上留下一个可以完全控制系统的 root shell。

 考虑到这种最终结果，将投毒风险评为 10% 是考虑到存在其他利用此漏洞的方式，而当前提供的 exploit.c 更加侧重于漏洞利用本身。

**利用方式：**
1.  **环境准备：** 创建必要的目录和文件，包括 `GCONV_PATH` 和包含恶意代码的共享库。
2.  **配置 gconv：** 创建 `gconv-modules` 文件，配置 gconv 模块，使其加载恶意的共享库。
3.  **设置环境变量：** 设置 `PATH`、`CHARSET` 和 `SHELL` 环境变量，以便 pkexec 能够加载恶意的 gconv 模块。
4.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，触发漏洞，加载恶意代码，从而获得 root 权限。

利用的关键在于 `pkexec` 在处理环境变量时存在漏洞，允许攻击者控制加载的 gconv 模块，从而执行任意代码。

**项目地址:** [JohnGilbert57/CVE-2021-4034-Capture-the-flag](https://github.com/JohnGilbert57/CVE-2021-4034-Capture-the-flag)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #8

**来源**: [CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md](../2021/CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (Pwnkit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** <= 0.105

**利用条件:** 本地用户访问，pkexec setuid root程序存在且未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (Pwnkit) 漏洞是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid-root 程序，允许授权用户以特权用户身份执行命令。该漏洞源于 pkexec 在处理命令行参数时存在缺陷，导致可以覆盖环境变量。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。漏洞利用代码通过利用 pkexec 的参数处理缺陷来覆盖环境变量，尤其是 `GCONV_PATH`。通过设置 `GCONV_PATH` 指向包含恶意共享对象的目录，并设置 `CHARSET` 触发 glibc 的 gconv 机制，加载恶意共享对象，从而执行任意代码。

**投毒风险:**
提供的PoC代码本身看起来是一个完整的漏洞利用程序，但存在一些潜在的投毒风险，概率为10%。
1.  **`rm -rf 'GCONV_PATH=.' 'pwnkit'`**:  此命令旨在清理利用过程中创建的文件和目录。但如果目标系统上存在同名但重要的文件或目录，则可能造成意外删除。
2.  **对/bin/sh的依赖性**脚本依赖于 /bin/sh 的存在和功能。在某些受限环境中，/bin/sh可能不存在或受到限制，从而导致利用失败。攻击者可能通过其他命令达到破坏的目的。

**利用方式:**
1.  **准备恶意共享对象：** 首先，创建一个包含 shellcode 的 C 文件（例如 `pwnkit.c`）。该 shellcode 的作用是设置有效的用户和组 ID (UID/GID) 为 0 (root)，然后执行一个 shell (通常是 `/bin/sh`)。
2.  **编译恶意共享对象：** 使用 GCC 将 C 文件编译成共享对象 (`.so` 文件)，例如 `pwnkit.so`。
3.  **创建 GCONV_PATH 目录：** 创建一个名为 `GCONV_PATH=.` 的目录，并创建一个空文件 `GCONV_PATH=./pwnkit`。这是为了欺骗 pkexec 在当前目录中查找 gconv 模块。
4.  **创建 gconv-modules 文件：** 创建一个名为 `gconv-modules` 的文件，其中包含指定自定义 gconv 模块的配置信息。
5.  **设置环境变量并执行 pkexec：** 设置环境变量 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。然后，不带任何参数执行 `pkexec`。由于 pkexec 的参数处理缺陷，这会导致覆盖环境变量，并触发 gconv 机制加载并执行恶意共享对象，从而获得 root 权限。

**总结:**
CVE-2021-4034 是一个严重的安全漏洞，可以被本地低权限用户利用来获得 root 权限。该漏洞利用简单，影响广泛，需要及时修复。虽然提供的 PoC 代码看起来直接，但仍需警惕潜在的投毒风险，并在测试环境中仔细评估。

**项目地址:** [LucasPDiniz/CVE-2021-4034](https://github.com/LucasPDiniz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #9

**来源**: [CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md](../2021/CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md)

## CVE-2021-4034-Polkit pkexec权限提升漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是一个存在于Polkit的pkexec工具中的本地权限提升漏洞。pkexec是一个setuid程序，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。该漏洞源于pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **构造恶意环境变量：** 利用代码通过创建`GCONV_PATH=.`目录，并在其中放置恶意的gconv模块配置文件`gconv-modules`。`gconv-modules`文件指示系统加载恶意的共享库`pwnkit.so`。
2.  **编译恶意共享库：**  利用代码编译一个包含提权代码的共享库`pwnkit/pwnkit.so`，该共享库在初始化时（`gconv_init`函数）将当前进程的UID和GID设置为0（root），然后执行一个shell。
3.  **执行pkexec：**  利用代码通过`execve`函数执行`/usr/bin/pkexec`，并传递构造好的环境变量，例如`PATH=GCONV_PATH=.`，`CHARSET=PWNKIT`等。
4.  **漏洞触发：**  当pkexec尝试加载gconv模块时，由于`GCONV_PATH`被设置为恶意目录，它会加载攻击者提供的`pwnkit.so`，从而执行其中的提权代码，最终获得root shell。

**有效性：**

提供的POC代码是有效的。它已经在Debian 10和CentOS 7上验证成功，可以使非特权用户获得root权限。

**投毒风险：**

经过分析，提供的POC代码中没有发现明显的恶意代码或后门。该代码的目的是利用CVE-2021-4034漏洞进行本地权限提升，其行为符合漏洞描述和利用原理。作者可能存在的投毒风险极低(0%)。

**参考信息：**

*   漏洞库信息：CVE-2021-4034描述了该漏洞的细节和影响。
*   搜索引擎结果：搜索结果提供了有关该漏洞的更多信息，包括漏洞分析、利用方法和缓解措施。例如，Qualys的博客文章(webpage 2)详细介绍了该漏洞的利用方式。

**项目地址:** [Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-](https://github.com/Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #10

**来源**: [CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md](../2021/CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md)

## CVE-2021-4034-Polkit pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统上存在pkexec且未修复漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户按照预定义的策略以特权用户身份运行命令。此漏洞的利用方式如下：

1.  **漏洞原理：** pkexec 在处理调用参数数量时存在缺陷，导致其尝试将环境变量作为命令执行，从而允许攻击者通过精心构造的环境变量来执行任意代码。
2.  **利用步骤：**
    *   创建一个包含恶意代码的动态链接库 (pwnkit.so)。该库的 `gconv_init` 函数会设置用户ID和组ID为0，然后执行一个shell。
    *   创建一个 `gconv-modules` 文件，用于告诉 `iconv` 如何使用恶意库将 UTF-8 转换为 PWNKIT 编码。
    *   设置 `GCONV_PATH=.` 环境变量，使 `iconv` 在当前目录中查找转换模块。
    *   运行利用程序 (exp)。这个利用程序会触发 pkexec 的漏洞，导致它加载并执行恶意动态链接库，从而获得 root 权限。
3.  **有效性评估：** 根据漏洞信息、搜索结果以及提供的PoC代码，该PoC代码**有效**，可以利用此漏洞实现本地提权。
4.  **投毒风险分析：** 提供的代码中，存在投毒的可能性较低，大约10%。主要风险在于`pwnkit.c`文件，在实际环境中，攻击者可以替换shell的路径或其他恶意代码，例如删除关键文件或植入后门。虽然当前代码的目标是提升权限，但恶意修改后可能造成更大的危害。`chmod -R 777 2>/dev/null` 这行代码较为可疑，虽然看起来像是为了确保执行权限，但也可能是为了方便植入后门或执行其他恶意操作，因为这样会允许任何用户修改这些文件。但考虑到这是已编译后的项目，赋予所有权限以方便使用也在情理之中,因此投毒风险较低。
5. **利用方式总结:** 通过构造特定的环境变量，特别是`GCONV_PATH`，以及相应的`gconv-modules`配置文件，使得`pkexec`加载恶意的动态链接库，该库在初始化时将当前进程的用户ID和组ID设置为0，并执行一个shell，从而获得root权限。

**项目地址:** [Part01-Pai/Polkit-Permission-promotion-compiled](https://github.com/Part01-Pai/Polkit-Permission-promotion-compiled)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #11

**来源**: [CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md](../2021/CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** all

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034是Polkit的pkexec工具中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户的身份运行命令，基于预定义的策略。漏洞源于pkexec没有正确处理调用参数的计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量，诱使pkexec执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞描述和搜索结果，此漏洞确实存在并且影响范围较广，利用代码的存在也证实了其可利用性。

**投毒风险：**
提供的“漏洞利用代码”实际上是许可协议文件（LICENSE和LICENSE.md），并非实际的漏洞利用代码。因此，无法直接分析其是否存在投毒行为。但从信息安全角度考虑，任何来源不明的代码都存在潜在风险，此处假设存在较低的投毒风险(5%), 主要是担心下载/使用 POC 的过程中被替换或篡改。

**利用方式：**
1.  **构造恶意环境变量：** 攻击者构造特殊的环境变量，这些环境变量包含攻击者想要执行的恶意代码。
2.  **利用参数计数错误：** 由于`pkexec`在处理参数时存在缺陷，它会将构造的恶意环境变量作为命令来执行。
3.  **权限提升：**  通过执行恶意代码，攻击者可以获得root权限。

**补充说明:** 真正的POC代码通常会利用环境变量来执行shell命令或加载恶意共享库。由于未提供真正的POC代码，以上分析基于漏洞描述和搜索结果进行推断。

**项目地址:** [Pol-Ruiz/CVE-2021-4034](https://github.com/Pol-Ruiz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #12

**来源**: [CVE-2021-4034-TheSermux_CVE-2021-4034.md](../2021/CVE-2021-4034-TheSermux_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许普通用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统存在存在漏洞的pkexec程序，且用户能够在本地执行该程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞是 Polkit pkexec 程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。

**有效性：**

提供的 POC 代码有效。漏洞库信息和搜索结果表明该漏洞已被广泛研究并存在可用的利用代码。POC 利用代码利用了 pkexec 的参数处理错误，通过构造特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险：**

虽然直接的后门代码没有发现，但仍然存在一定的投毒风险。风险点在于以下几点：

*   `cve-2021-4034.sh` 脚本从远程 URL 下载利用代码。如果该 URL 被攻击者控制，则可以提供恶意代码。
*   `Makefile` 构建过程中可能存在隐蔽的恶意代码注入，尽管当前的 Makefile 看起来比较简单。
*   `pwnkit.c` 中 `execve` 执行 `/bin/sh`，如果目标系统的 `/bin/sh` 被篡改，可能导致执行恶意代码。虽然利用本身的目标是提权到 root，但如果结合其他漏洞或配置错误，也可能导致意想不到的后果。

综合评估，投毒风险为10%。

**利用方式：**

1.  **下载利用代码：** 首先，从给定的 URL 下载 `cve-2021-4034.c`, `pwnkit.c` 和 `Makefile` 文件。
2.  **编译利用代码：** 使用 `make` 命令编译 `pwnkit.c` 为动态链接库 `pwnkit.so`，并编译 `cve-2021-4034.c` 为可执行文件 `cve-2021-4034`。
3.  **构造环境变量：**  `cve-2021-4034.c` 设置特定的环境变量，包括:
    *   `pwnkit.so:.`  指定 GCONV 模块的路径。
    *   `PATH=GCONV_PATH=.`  设置 PATH 环境变量，欺骗 pkexec 从当前目录加载 GCONV 模块。
    *   `SHELL=/lol/i/do/not/exists`  设置一个不存在的 SHELL，这可能触发一些错误处理逻辑。
    *   `CHARSET=PWNKIT`  设置字符集为 PWNKIT，触发加载指定的 GCONV 模块。
    *   `GIO_USE_VFS=`  可能用于绕过某些安全限制。
4.  **执行 pkexec：**  `cve-2021-4034.c`  使用 `execve` 执行 `/usr/bin/pkexec`。 由于环境变量设置不当，pkexec 将会尝试加载恶意 GCONV 模块 `pwnkit.so`。
5.  **GCONV 模块执行：** `pwnkit.so` 中的 `gconv_init` 函数被调用，该函数设置用户 ID 和组 ID 为 0 (root)，然后执行 `/bin/sh`，从而获得 root 权限。

总之，该利用利用了 pkexec 的参数处理缺陷和 GCONV 机制，通过构造恶意环境变量来加载恶意代码，最终实现提权。

**项目地址:** [TheSermux/CVE-2021-4034](https://github.com/TheSermux/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #13

**来源**: [CVE-2021-4034-Typical0day_CVE-2021-4034.md](../2021/CVE-2021-4034-Typical0day_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户，pkexec具有SUID权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞存在于 pkexec 处理参数计数的方式，导致它可以将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞的 POC 代码是有效的。搜索引擎结果显示多个安全厂商已经确认并提供了利用方法。提供的代码包含 Makefile、C 源代码以及利用说明，表明这是一个可工作的 Exploit。

**投毒风险：**

分析提供的 POC 代码内容，投毒风险评估为10%。

*   `LICENSE` 文件：标准的 MIT 许可证，表明代码是开源的，增加了透明度。
*   `Makefile` 文件：用于编译 exploit，没有发现可疑操作。
*   `README.md` 文件：提供漏洞说明、利用方法和缓解措施，描述清晰。
*   `pwnkit.c` 文件：实现了利用 GCONV_PATH 环境变量进行提权的关键逻辑。需要进一步审计，但是表面上没有发现恶意行为。
*   `cve-2021-4034.c` 文件：主程序，负责设置环境变量并执行 pkexec。同样需要进一步审计。
    `gconv-modules`: 指定了要使用的gconv模块,用于触发漏洞

虽然没有明显的恶意代码，但是仍然存在风险。例如，`pwnkit.c` 和 `cve-2021-4034.c` 中可能存在隐藏的后门或触发条件，这些后门只有在特定环境下才会激活。此外，该代码可能依赖于某些特定的系统配置或库版本，如果目标系统不满足这些条件，exploit 可能会失败，或者产生未知的副作用。

因此，在使用此 POC 之前，务必进行代码审计，并在隔离环境中进行测试。

**利用方式：**

利用方式主要通过以下步骤：

1.  **编译：** 使用 `make` 命令编译 `pwnkit.so` (共享库) 和 `cve-2021-4034` (主程序)。同时创建 `gconv-modules` 文件，内容指定了要加载的gconv模块以及创建相关的目录结构。
2.  **环境变量设置：** Exploit 通过设置 `GCONV_PATH` 和 `GCONV_MODULES` 环境变量来利用该漏洞。
3.  **触发漏洞：** 运行编译后的 `cve-2021-4034` 程序，它会调用 `pkexec`，由于环境变量的设置，`pkexec` 会尝试加载恶意的 `pwnkit.so` 共享库。
4.  **代码执行：** `pwnkit.so` 共享库中的代码会被执行，从而获得 root 权限。
5.  **提权：** 在 `pwnkit.so` 中，通过调用 `setuid(0)` 和 `setgid(0)` 将进程的 UID 和 GID 设置为 0 (root)，从而获得 root 权限。最后，执行 shell 命令，允许攻击者在目标系统上执行任意操作。

**项目地址:** [Typical0day/CVE-2021-4034](https://github.com/Typical0day/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #14

**来源**: [CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** All (受影响版本)

**利用条件:** 需要本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地提权。

**有效性：**
提供的 PoC 代码是有效的，利用了 pkexec 的环境变量处理缺陷。利用方式包括编译 C 代码生成共享库，然后设置特定的环境变量来触发漏洞，最终执行恶意代码以获得 root 权限。从搜索引擎结果和漏洞库信息来看，该漏洞的 PoC 已经被广泛公开，并且有大量的成功利用案例。

**投毒风险：**
该仓库中存在少量投毒风险，大约为 10%。

虽然主要代码是为了利用漏洞，但是sh脚本中存在`(sleep 1 && rm ./PwnKit & )`，该命令会在执行漏洞利用程序后删除自身。这可以被视为一种轻微的混淆手段，虽然并非直接注入恶意代码，但增加了分析和溯源的难度。所以存在一定投毒风险。

**利用方式：**
1.  **利用核心：** 利用 `pkexec` 程序解析参数时的漏洞，将恶意代码注入到环境变量中。
2.  **创建 GCONV_PATH：**  创建目录 `GCONV_PATH=.` 和 `.pkexec`，以及文件 `.pkexec/gconv-modules`，用于欺骗 `pkexec` 程序加载自定义的 gconv 模块。
3.  **编译恶意共享库：**  将 `PwnKit.c` 编译为共享库 `PwnKit.so`，其中包含 `entry` 和 `gconv` 函数。`entry` 函数负责设置环境变量，`gconv` 函数负责执行提权后的操作。
4.  **设置环境变量：**  设置 `PATH`、`CHARSET`、`SHELL` 等环境变量，使得 `pkexec` 程序加载恶意的 gconv 模块。
5.  **执行 pkexec：**  执行 `/usr/bin/pkexec` 或 `pkexec` 程序，触发漏洞，执行 `gconv` 函数中的提权代码。
6.  **提权：** `gconv` 函数会设置 uid 和 gid 为 0，然后执行 `CMD` 环境变量指定的命令，或者启动一个 root shell。
7. **清理:** 在成功执行利用后,清除恶意目录和文件。

综上，该 PoC 代码有效，但存在少量投毒风险，利用方式清晰，可实现本地提权。

**项目地址:** [X-Projetion/Exploiting-PwnKit-CVE-2021-4034-](https://github.com/X-Projetion/Exploiting-PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #15

**来源**: [CVE-2021-4034-Y3A_CVE-2021-4034.md](../2021/CVE-2021-4034-Y3A_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 所有版本 (在修复之前)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 未能正确处理调用参数计数，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用方式：**

1.  **创建恶意 GCONV 模块:** POC 代码首先创建一个目录结构 `/tmp/GCONV_PATH=.` 和 `/tmp/getpwned`，并在其中创建一个名为 `gconv-modules` 的文件。此文件用于配置 iconv 字符集转换。
2.  **gconv-modules 文件的内容:** `gconv-modules` 文件定义了两个字符集转换规则，将 UTF-8 和 INTERNAL 字符集映射到位于 `/tmp/shell.so` 的恶意共享库。  路径中使用了相对路径跳转，这是为了绕过一些安全检查。
3.  **创建恶意共享库 (shell.so):**  POC 代码使用 `shell.c` 创建了一个共享库 `/tmp/shell.so`。此库包含一个 `gconv_init` 函数，该函数在加载时会被执行。`gconv_init` 函数设置用户的 UID 和 GID 为 0 (root)，然后执行 `/bin/sh`，从而产生一个 root shell。
4.  **创建利用程序 (hax):**  POC 代码使用 `hax.c` 创建一个利用程序 `/tmp/hax`。此程序使用 `execve` 函数执行 `/usr/bin/pkexec`，并传递一组精心构造的环境变量，包括 `PATH=GCONV_PATH=.`、`CHARSET=UTF-16` 和 `SHELL=yeahdoesntexist`。设置`CHARSET=UTF-16` 触发了iconv_open()的调用，利用了`GCONV_PATH=.`查找恶意共享库，而 `SHELL=yeahdoesntexist` 触发了 g_printerr()，都保证共享库能够被加载。
5.  **执行利用程序:**  POC 代码最后执行 `/tmp/hax`，这将触发 pkexec 的漏洞，加载恶意共享库，并生成一个 root shell。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，此漏洞利用代码是有效的。多个来源证实了该漏洞的存在和可利用性，并且 POC 代码实现了利用该漏洞的步骤。

**投毒风险：**

虽然此 POC 代码主要用于演示漏洞利用，但仍然存在一些潜在的投毒风险：

*   **依赖 /tmp 目录：**  代码大量使用 `/tmp` 目录。如果攻击者能够控制 /tmp 目录的创建或文件内容，可能会篡改 POC 代码，导致意外行为或其他恶意活动。
*   **后门植入:**  shell.c 中设置了 setuid(0) 等操作，如果被修改为连接到外部服务器，则会造成比较严重的后门。
*   **权限问题:**   POC 代码包含 `chmod +x` 命令，这可能会意外地修改文件权限，从而导致安全问题。
*   **代码复杂性：** 尽管 POC 代码相对简单，但它仍然包含 C 代码和 shell 脚本。攻击者可能会利用代码的复杂性来隐藏恶意代码。

综合考虑，投毒风险较低，估计为 10%。主要风险在于代码依赖 `/tmp` 目录，并且代码中共享库本身可以被作为后门来修改。


**项目地址:** [Y3A/CVE-2021-4034](https://github.com/Y3A/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #16

**来源**: [CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md](../2021/CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** 所有版本

**利用条件:** 本地用户可以访问pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034（Pwnkit）是Polkit的pkexec实用程序中的本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是pkexec没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **漏洞原理：** pkexec在处理参数时存在缺陷，导致它可以将某些环境变量的内容误认为是要执行的命令。通过精心构造环境变量，可以劫持程序的执行流程。

2.  **POC分析：** 提供的POC利用了glibc的gconv机制。`gconv`用于处理字符集转换。POC首先创建了一个恶意的`zero.so`共享对象，其中包含`gconv_init`函数，该函数会设置UID和GID为0，然后执行/bin/bash。然后创建一个`gconv-modules`文件，将`UTF-8`编码转换为`ZERO`编码时加载`zero.so`。接着，设置`GCONV_PATH=.`，并复制`zero.so`到当前目录，强制glibc加载当前目录下的`gconv`模块。最后，创建一个`zero_exploit.c`程序，设置一些环境变量，其中`CHARSET=ZERO`触发字符集转换，从而加载恶意的`zero.so`，提权执行bash。

3.  **有效性：** POC代码有效，可以成功利用CVE-2021-4034漏洞，在未打补丁的系统上获得root权限。搜索引擎结果和漏洞库信息均表明该漏洞易于利用，且已存在公开的利用代码。

4.  **投毒风险：** 仓库中存在投毒代码的可能性较低，估计为5%。虽然主要代码是漏洞利用，但不能完全排除作者在脚本中加入恶意命令的可能性。但总体来看，脚本内容直接，没有发现明显的恶意行为。

**项目地址:** [Z3R0-0x30/CVE-2021-4034](https://github.com/Z3R0-0x30/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #17

**来源**: [CVE-2021-4034-artemis-mike_cve-2021-4034.md](../2021/CVE-2021-4034-artemis-mike_cve-2021-4034.md)

## CVE-2021-4034-polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞在于 pkexec 未能正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 PoC 代码利用了上述漏洞，通过构造特定的环境变量 `GCONV_PATH=.` 和 `LC_MESSAGES=en_US.UTF-8` ，使得 pkexec 尝试加载当前目录下的 Gconv 模块。这个 Gconv 模块实际上是一个恶意共享对象 (payload.so)，包含提权代码。 编译后的c文件, 通过设置uid，guid为0，即root权限, 再执行 `whoami`命令。

**投毒风险：**
此仓库可能存在轻微的投毒风险，几点考虑如下：

1.  **外部依赖：** Playbook使用了 `asses_CVE-2021-4034.yml`，需要用户手动修改`hosts` 变量,执行`ansible-playbook` 命令。 如果playbook内容被篡改可能会造成非预期结果。
2.  **代码可读性：**  代码可读性一般，存在少量注释。虽然作者声明仅用于教育目的，并且提示用户对执行的代码负责，但仍然可能存在潜在的风险。
3. **payload.c潜在风险:** `payload.c` 中虽然执行的是 `whoami`, 但如果被修改成其他恶意命令，可能会造成破坏。
4. 提供的YAML文件尝试删除利用过程中创建的临时文件，但不能保证所有文件都被完全清理。如果清理不彻底，可能会留下潜在的安全隐患。

**总体而言，投毒风险较低，大概为 10%。主要是playbook执行的不可控因素，以及payload.c被篡改的风险。**

**利用方式：**
1.  **编译PoC：** 使用 `gcc -Wall cve-2021-4034.c -o cve-2021-4034-exploit` 命令编译 C 语言 PoC 代码。
2.  **修改Playbook:**  修改 `asses_CVE-2021-4034.yml` 中的 `hosts` 变量，指定目标主机。
3.  **执行Playbook：** 使用 `ansible-playbook -i </path/to/inventory.yml> </path/to/playbooks/>asses_CVE-2021-4034.yml` 命令执行 Ansible playbook。
4.  **验证结果：** 检查 playbook 的执行结果。如果 `Check result of privilege escalation` 任务失败，则表示提权成功。

实际上，该 exploit 的核心思路是通过创建 GCONV_PATH 目录和 LC_MESSAGES 环境变量，使得 pkexec 尝试加载恶意共享对象，从而执行共享对象中的提权代码。该代码首先将当前进程的 UID 和 GID 设置为 0 (root)，然后再执行 whoami 命令。如果执行成功, `whoami` 的结果将是 root，表示提权成功。

**项目地址:** [artemis-mike/cve-2021-4034](https://github.com/artemis-mike/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #18

**来源**: [CVE-2021-4034-asepsaepdin_CVE-2021-4034.md](../2021/CVE-2021-4034-asepsaepdin_CVE-2021-4034.md)

## CVE-2021-4034 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许非特权用户获得root权限

**影响版本:** 所有受影响版本

**利用条件:** 目标系统存在 Polkit pkexec 且未修复

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 实用程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，最终导致尝试将环境变量作为命令执行。攻击者可以通过精心制作环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞描述、搜索结果和提供的 PoC 代码，可以判定该漏洞是有效的。多个来源（包括 NVD、Qualys、Red Hat 等）都确认了此漏洞，并且存在公开可用的 PoC 代码。该 PoC 代码通过创建特定的目录结构和环境变量来利用此漏洞，从而导致 pkexec 执行攻击者控制的代码，最终提升到 root 权限。

**投毒风险：**

分析提供的 PoC 代码 `cve-2021-4034-poc.c`。代码首先创建 `GCONV_PATH=.` 目录和 `pwnkit` 目录，然后将恶意 shellcode 写入 `pwnkit/pwnkit.c`，编译成动态链接库 `pwnkit/pwnkit.so`。最后，通过设置环境变量 `pwnkit`, `PATH`, `CHARSET` 和 `SHELL` 并调用 `execve("/usr/bin/pkexec", (char*[]){NULL}, env)` 来触发漏洞。其中 `pwnkit/pwnkit.c` 中包含的代码负责提升权限并执行 `/bin/sh`。

代码本身利用了漏洞，没有发现明显的恶意后门或植入代码，判断投毒风险为 0%。

**利用方式：**

1.  **环境准备：** 创建 `GCONV_PATH=.` 目录，并创建一个名为 `GCONV_PATH=./pwnkit` 的文件（用于欺骗 pkexec）。创建一个 `pwnkit` 目录，其中包含 `gconv-modules` 文件，指定使用自定义的 gconv 模块。
2.  **恶意 GConv 模块：** 创建一个恶意的 gconv 模块（`pwnkit/pwnkit.c`），该模块包含在加载时提升权限并执行 shell 的代码。
3.  **编译：** 将该 C 代码编译成共享对象（`.so` 文件），作为 gconv 模块。
4.  **环境变量：** 设置特定的环境变量，例如 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`，以便 pkexec 加载恶意的 gconv 模块。
5.  **触发：** 运行 pkexec，由于参数处理不当，pkexec 将加载并执行恶意的 gconv 模块，从而提升权限并执行 shell。

**项目地址:** [asepsaepdin/CVE-2021-4034](https://github.com/asepsaepdin/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #19

**来源**: [CVE-2021-4034-battleoverflow_CVE-2021-4034.md](../2021/CVE-2021-4034-battleoverflow_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 存在于 polkit 的 pkexec 实用程序中。pkexec 应用程序是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。当前版本的 pkexec 未能正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码来利用此漏洞。成功执行后，攻击会导致本地权限提升，从而使非特权用户获得目标计算机的管理权限。

**有效性评估：**
提供的PoC代码看起来有效。根据漏洞描述和搜索结果，该漏洞利用了 pkexec 对参数处理不当的缺陷，通过设置特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险评估：**
对提供的代码进行分析，并未发现明显的投毒后门。代码的目的是创建一个利用 CVE-2021-4034 漏洞的利用程序。

*   `LICENSE` 和 `README.md` 提供了代码的版权信息和使用说明，没有可疑内容。
*   Python 脚本 `CVE-2021-4034.py` 旨在利用 pkexec 漏洞，它通过创建特定目录结构和文件，并编译一个 C 代码片段来实现提权。这段 C 代码的目的是设置用户ID和组ID为0（root），然后执行一个shell。虽然这段C代码本身具有提权的功能，但它与漏洞利用的上下文相符，不应被视为恶意后门，属于漏洞利用的必要组成部分。

代码片段 `os.system("export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' 'pwnkit'; /bin/sh")` 意图清除可能存在的恶意目录，并通过 `/bin/sh` 启动一个 root shell。这是一个标准的利用步骤，不是恶意行为。

但是依旧存在通过修改C代码内容达到植入后门，或捆绑恶意程序，达到投毒目的。因此投毒风险占比5%。

**利用方式：**
1.  **环境准备：** 创建特定的目录结构 `GCONV_PATH=.` 和文件 `GCONV_PATH=./pwnkit`。
2.  **编译恶意代码：** 使用 C 语言编写的恶意代码（设置 setuid 等）编译为动态链接库或可执行文件。
3.  **环境变量注入：** 通过构造特定的环境变量（如 GCONV_PATH）诱使 pkexec 加载并执行恶意代码。
4.  **提权：** 成功执行后，当前用户获得 root 权限，可以执行任意系统命令。

**项目地址:** [battleoverflow/CVE-2021-4034](https://github.com/battleoverflow/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #20

**来源**: [CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md](../2021/CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md)

## CVE-2021-4034-Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许本地普通用户获取root权限

**影响版本:** 所有版本

**利用条件:** 目标系统存在polkit的pkexec程序且未打补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 漏洞是 polkit pkexec 程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**漏洞分析：**
该漏洞源于 pkexec 在处理调用参数计数时存在缺陷，导致程序尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地权限提升。

**利用方式：**
1.  **编译 PoC 代码：** 首先，需要编译提供的 Makefile 文件，生成 `pwnkit.so`、`cve-2021-4034`、`gconv-modules` 和 `GCONV_PATH` 相关文件和目录。
2.  **构造环境变量：** 关键在于设置 `GCONV_PATH=.` 和 `CHARSET=PWNKIT` 以及修改 `gconv-modules` 文件，使得 `pkexec` 在执行过程中加载恶意共享库 `pwnkit.so`。
3.  **执行 cve-2021-4034：** 运行编译后的 `cve-2021-4034` 程序，该程序设置特定的环境变量并调用 `/usr/bin/pkexec`。
4.  **pwnkit.so执行：**  `pwnkit.so` 的 `gconv_init` 函数会被执行，该函数会获取环境变量`PWNKIT_ARG`的值，并使用`setuid(0)`和`setgid(0)`来将当前进程的用户ID和组ID设置为root用户,然后使用`execve`来执行`/bin/touch`命令，并将`PWNKIT_ARG`作为参数传递给`/bin/touch`命令，从而以root权限创建文件。注意：如果`PWNKIT_ARG`为空，则`/bin/touch`命令后面只有一个null参数，所以不会创建文件。

**有效性：**
提供的 PoC 代码是有效的。参考搜索结果中的相关文章和漏洞分析，该漏洞利用方式已被广泛验证和利用。

**投毒风险：**
经过对 PoC 代码的分析，该代码主要目的是利用 `pkexec` 的漏洞进行本地提权，没有发现作者隐藏的恶意代码或后门。代码逻辑清晰，没有明显的投毒迹象，因此，投毒风险为 0%。

**缓解措施：**
1.  及时更新 polkit 到最新版本，修复此漏洞。
2.  如果无法立即更新，可以暂时删除 pkexec 的 setuid 权限：`chmod 755 /usr/bin/pkexec` (但会影响 polkit 的正常功能)。

**项目地址:** [cdxiaodong/CVE-2021-4034-touch](https://github.com/cdxiaodong/CVE-2021-4034-touch)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #21

**来源**: [CVE-2021-4034-cerodah_CVE-2021-4034.md](../2021/CVE-2021-4034-cerodah_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** all (受影响版本直至修复)

**利用条件:** 本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 实用程序中的本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，从而导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性分析：**

根据漏洞库信息、搜索引擎结果（尤其是 Qualys 的博客文章）和提供的 PoC 代码，该漏洞是有效的，并且已被积极利用。

**投毒风险分析：**

PoC 代码分析：

*   `README.md`：包含漏洞的简要描述、polkit 的作用、漏洞的缓解措施，未发现恶意代码。
*   `cve-2021-4034-poc.c`：这是 PoC 代码的核心部分。它利用 `GCONV_PATH` 环境变量来加载恶意共享库。该库中的 `gconv_init` 函数被设计为在执行时设置 uid 和 gid 为 0，并执行 `/bin/sh`，从而创建一个 root shell。代码本身并未发现作者隐藏的恶意代码。

综合来看，该仓库的 PoC 代码目的明确，即利用 CVE-2021-4034 漏洞实现本地提权。代码结构清晰，主要通过设置环境变量和加载恶意共享库来触发漏洞。没有发现任何迹象表明作者在代码中加入了额外的、与漏洞利用无关的恶意功能或后门。因此，投毒风险较低，大约为 0%。

**利用方式分析：**

1.  **创建 GCONV_PATH 目录和触发文件：** PoC 代码首先创建 `GCONV_PATH=.` 目录，并创建一个名为 `pwnkit` 的文件，并赋予执行权限，用来欺骗 pkexec。
2.  **创建 gconv-modules 文件：** 在 `pwnkit` 目录下，创建一个 `gconv-modules` 文件，声明一个字符集转换模块，指定了恶意共享库的路径。
3.  **创建恶意共享库：** PoC 代码创建一个 C 源代码文件 `pwnkit/pwnkit.c`，其中包含 `gconv` 和 `gconv_init` 函数。`gconv_init` 函数被设计为设置进程的 uid 和 gid 为 0，并执行 `/bin/sh` 命令，从而获得 root shell。
4.  **编译恶意共享库：** 使用 `gcc` 将 `pwnkit/pwnkit.c` 编译成共享库 `pwnkit/pwnkit.so`。
5.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，同时设置环境变量 `pwnkit`、`PATH=GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。这些环境变量的设置会触发 pkexec 中的漏洞，导致加载恶意共享库并执行其中的代码，从而获得 root 权限。

**项目地址:** [cerodah/CVE-2021-4034](https://github.com/cerodah/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #22

**来源**: [CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，遵循预定义的策略。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经公开，并且存在可用的漏洞利用代码（POC）。多个安全厂商和研究团队已经验证了该漏洞的存在和利用方式。虽然提供的POC代码只是一个README.md文件，但根据漏洞描述，可以推断有效的POC代码需要利用精心构造的环境变量来执行恶意代码。

**投毒风险：**
提供的 POC 代码只是一个 README 文件，本身不包含任何可执行代码。 但是，如果从其他来源获取的漏洞利用代码，可能存在投毒风险。为了评估投毒风险，必须检查利用代码的以下内容:

1.  **来源的可靠性：** 代码是否来自受信任的来源？例如，知名的安全研究人员或组织。
2.  **代码审查：** 代码是否经过了审查？最好由多个安全研究人员进行独立的代码审查。
3.  **混淆：** 代码是否经过了混淆处理，使其难以理解？这可能是隐藏恶意行为的标志。
4.  **网络连接：** 代码是否尝试建立网络连接？如果代码尝试连接到未知的或可疑的服务器，则可能存在风险。
5.  **权限请求：** 代码是否请求了不必要的权限？如果代码请求的权限超过了其功能所需的范围，则可能存在风险。

由于当前提供的代码只是readme.md,所以风险较低，预估投毒风险为10%。

**利用方式：**
该漏洞的利用方式主要涉及以下步骤：

1.  **构造恶意环境变量：** 攻击者需要构造一组特殊的环境变量，这些环境变量会被 pkexec 错误地解析为命令。
2.  **执行 pkexec：** 攻击者执行 pkexec，触发漏洞。
3.  **提权：** pkexec 执行攻击者构造的恶意代码，导致攻击者获得 root 权限。

参考链接中有很多关于该漏洞的讨论和POC利用示例。

**项目地址:** [dh4r4/PwnKit-CVE-2021-4034-](https://github.com/dh4r4/PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #23

**来源**: [CVE-2021-4034-evkl1d_CVE-2021-4034.md](../2021/CVE-2021-4034-evkl1d_CVE-2021-4034.md)

## CVE-2021-4034-polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all

**利用条件:** 目标系统存在 polkit 且 pkexec 可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户的身份运行命令。漏洞利用方式如下：

1.  **漏洞原理：** pkexec 在处理参数计数时存在缺陷，导致它尝试将环境变量作为命令执行，从而可能导致任意代码执行。
2.  **利用方式：** 攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码。这个 POC 通过创建特定的目录结构和文件 (GCONV_PATH=. , exploit/gconv-modules) 以及设置特定的环境变量 (PATH, LC_MESSAGES, XAUTHORITY)，利用 gconv 机制加载恶意的共享库 (payload.so)。该共享库包含提权的 shellcode (通过 msfvenom 生成)，一旦加载，将会以 root 权限执行。
3.  **有效性评估：** 根据漏洞库信息、搜索结果，该漏洞被广泛利用，并且提供了 POC 代码。该 POC 利用了 polkit 的参数处理错误和 gconv 机制，应该能够有效提权。
4.  **投毒风险评估：** 该 POC 代码的主要功能是创建目录和文件，设置环境变量，然后调用 `execve` 执行 `/usr/bin/pkexec`。Payload 是使用 `msfvenom` 生成的，目的是反弹一个 root shell。虽然该 payload 可以替换成其他 payload，但该代码本身并未发现明显的投毒行为。代码的风险在于，如果攻击者替换了 payload，可能会植入恶意后门，但就提供的代码本身而言，投毒的可能性较低。作者的目的更多的是为了证明该漏洞的可利用性. 因此投毒风险为0%。

总而言之，该 POC 代码有效，并且可以稳定复现 CVE-2021-4034 漏洞，实现本地权限提升。

**项目地址:** [evkl1d/CVE-2021-4034](https://github.com/evkl1d/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #24

**来源**: [CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034 (PwnKit) Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，可使普通用户获得 root 权限

**影响版本:** 受影响版本：所有版本

**利用条件:** 本地用户，目标系统安装了 polkit 且 pkexec 可执行文件存在。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 包中 pkexec 工具的一个本地提权漏洞。

**有效性：**
提供的 POC 代码是有效的。漏洞描述表明，当 `pkexec` 在没有参数的情况下被调用时，它会尝试访问 `argv[1]`，但由于 `argc` 为 0，它会读取 `envp[0]`。通过精心构造环境变量，攻击者可以强制 `pkexec` 加载一个恶意的动态链接库，并在 root 权限下执行任意代码。

`cve-2021-4034.c` 代码通过将 `args` 设置为 `{NULL}` 并构造包含恶意环境变量的 `environ` 数组来触发此漏洞。`pwnkit.c` 是一个动态链接库，它包含将在 root 权限下执行的代码，即打开一个 shell。

**投毒风险：**

*   仓库中存在作者隐藏的投毒代码的可能性较低，初步判断为 10%。
*   `pwnkit.c` 会执行 `execve(args[0], args, envp);` 启动一个shell. 虽然`setuid(0);setgid(0);` 是提权操作，但这是漏洞利用本身的一部分，不是投毒代码。如果`pwnkit.c`包含恶意后门代码，例如反弹shell或添加后门用户，则可能是投毒。
*    `cve-2021-4034.c`的代码的功能是触发漏洞，本身不包含恶意代码。

**利用方式：**

1.  **编译 exploit 和恶意库：** 使用提供的 `gcc` 命令编译 `cve-2021-4034.c` 和 `pwnkit.c`。
2.  **创建 GCONV_PATH 目录：**  创建一个名为 `GCONV_PATH=.` 的目录。
3.  **创建 gconv-modules 文件：**  创建一个 `gconv-modules` 文件，包含指示系统加载恶意库的配置。
4.  **复制 true 命令到 GCONV_PATH：** 将 `true` 命令复制到 `GCONV_PATH`，并设置 `GCONV_PATH` 环境变量。
5.  **运行 exploit：**  执行编译后的 `cve-2021-4034` 程序。这将利用 pkexec 中的漏洞，加载 `pwnkit.so` 库，从而以 root 权限打开一个 shell。


**项目地址:** [igonzalez357/CVE-2021-4034-PwnKit-](https://github.com/igonzalez357/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #25

**来源**: [CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md](../2021/CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 Polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **编译exploit代码：** 首先需要编译提供的cve-2021-4034.c, pwnkit.c，以及生成gconv-modules。
2.  **构造恶意环境变量：**  利用代码设置了一系列环境变量，如 `pwnkit.so:.`, `PATH=GCONV_PATH=.`, `CHARSET=PWNKIT` 等。 其中PATH被设置为当前目录, 使得动态链接器优先加载当前目录下的恶意动态链接库。
3.  **执行 pkexec：** 通过 `execve` 函数执行 `/usr/bin/pkexec`，并传递构造好的环境变量。
4.  **利用 gconv 机制提权：**  `pwnkit.c` 中的 `gconv_init` 函数会被调用，该函数将当前用户设置为 root 用户 (uid 0, gid 0)，然后执行 `/bin/sh`，从而获得 root shell。

**有效性：**

根据漏洞信息和利用代码，该 PoC 代码有效。多个信息源表明 CVE-2021-4034 漏洞已被积极利用，并且该 PoC 的实现方式与公开的漏洞利用方法一致。

**投毒风险：**

分析提供的代码，存在轻微的投毒风险，可能性为5%。 风险点在于Makefile中包含TRUE=/bin/bash, 以及拷贝该文件到GCONV_PATH中，如果攻击者替换/bin/bash为其他恶意程序，可能存在隐患。但是结合其他信息,认为其目的是为了方便利用,增加稳定性和兼容性。

总的来说，提供的 PoC 代码是有效的，且投毒风险较低。 该漏洞影响范围广，利用简单，危害性高。

**项目地址:** [ikerSandoval003/CVE-2021-4034](https://github.com/ikerSandoval003/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #26

**来源**: [CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md](../2021/CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** 所有版本

**利用条件:** 本地用户能够执行pkexec程序

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**利用方式：**

1.  漏洞的根源在于 pkexec 未能正确处理调用参数计数。它最终尝试将环境变量作为命令执行。
2.  攻击者通过构造特定的环境变量，诱使 pkexec 执行任意代码。
3.  利用代码中的 `main.py` 脚本首先编译 `cve-2021-4034-poc.c` PoC 代码，生成可执行文件 `exploit`。
4.  然后，运行编译后的 `exploit`，该程序利用漏洞提升权限。
5.  脚本随后尝试通过 `whoami`、`ls /root` 和 `cat /root/flag.txt` 命令来验证提权是否成功。这些命令尝试获取当前用户，列出 `/root` 目录的内容，并读取 `/root/flag.txt` 文件，而这些操作通常需要 root 权限。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞 PoC 代码是有效的。漏洞已经被广泛利用，并且已经有公开的利用代码。

**投毒风险：**

查看提供的利用代码，该利用代码编译并运行提供的 c 代码（cve-2021-4034-poc.c，未提供内容）。`main.py` 中仅包含编译和执行漏洞利用程序以及验证提权的命令。没有发现任何明显的投毒代码。因此，投毒风险为 0%。需要注意的是，如果提供的 `cve-2021-4034-poc.c` 文件本身被篡改，则可能存在后门或恶意行为。但是仅根据现有信息,可以判断 `main.py` 本身没有投毒。


**项目地址:** [kali-guru/Pwnkit-CVE-2021-4034](https://github.com/kali-guru/Pwnkit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #27

**来源**: [CVE-2021-4034-lsclsclsc_CVE-2021-4034.md](../2021/CVE-2021-4034-lsclsclsc_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户访问，pkexec程序存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。此漏洞源于pkexec未正确处理调用参数计数，导致其尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量诱使pkexec执行任意代码，从而导致本地权限提升，使非特权用户获得目标机器上的管理员权限。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞真实存在且影响广泛，多个Linux发行版都受影响。公开的漏洞利用代码表明该漏洞可以被成功利用。

**投毒风险：** 提供的POC代码 `README.md` 文件内容过于简单，仅包含CVE编号，无法直接用于漏洞利用。因此，无法基于此文件本身来评估投毒风险。一般漏洞利用代码会包含恶意的后门代码，执行后可以获得机器的控制权。但此`README.md`文件仅仅是指示该漏洞。考虑到从其他来源获取漏洞利用代码的可能性，存在下载的代码中被植入恶意代码的风险。因此，评估投毒风险为10%考虑到readme文件的特殊性，风险较低。

**利用方式：** 漏洞利用方式通常涉及构造特定的环境变量，这些变量会被pkexec错误地解析并执行。攻击者可以利用此行为执行任意命令，通常用于提升到root权限。例如，攻击者可以创建一个环境变量，指向一个包含shell命令的文件，然后运行pkexec，使其执行该文件中的命令。

**项目地址:** [lsclsclsc/CVE-2021-4034](https://github.com/lsclsclsc/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #28

**来源**: [CVE-2021-4034-marcosChoucino_CVE-2021-4034.md](../2021/CVE-2021-4034-marcosChoucino_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户能够执行 pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，但需要预定义的策略。漏洞原因是 pkexec 没有正确处理调用参数的数量，最终试图将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

提供的POC代码包含三个文件和一个目录：`ataque.c`、`vulner.c`、`GCONV_PATH=/config.txt` 和 `README.md`。

1.  **vulner.c:**  这个文件模拟了一个存在漏洞的程序。它接收命令行参数，尝试在 PATH 中查找它们，并使用 `g_printerr` 打印一个字符串。重要的是，它使用 `g_strdup` 和 `g_find_program_in_path` 函数，这些函数可能会受到环境变量的影响。
2.  **ataque.c:** 这个文件用于触发漏洞。它设置了几个环境变量（`PATH`，`CHARSET`，`SHELL`）并调用了 `vulner.out`（编译自 `vulner.c`）。关键的环境变量是 `PATH=GCONV_PATH=.` 和 `CHARSET=INTERNAL`。结合`GCONV_PATH=/config.txt`以及添加.在`GNCOV...` 目录后的步骤，攻击者利用 `GCONV_PATH` 指向当前目录，然后 polkit 会尝试使用当前目录中的 `gconv-modules` 文件加载字符编码转换器。攻击者可以将恶意代码放置在 `gconv-modules` 文件中，以便在加载时执行。
3.  **GCONV_PATH=/config.txt:** 这定义了一个环境变量，似乎旨在覆盖默认的 gconv 路径，但实际使用中 `/config.txt` 内容为空，利用点在 `ataque.c` 中定义 `PATH=GCONV_PATH=.`，结合README中提示的添加`.`步骤。攻击者通过设置`GCONV_PATH`为`.`,然后polkit在查找gconv module的时候会查找当前目录，然后执行恶意代码。
4.  **README.md:**  包含漏洞利用的简要说明, 添加`.`在`GNCOV...` 目录后是必要步骤。

**有效性：**
提供的代码利用了环境变量操作，结合漏洞描述和搜索结果，以及环境变量`GCONV_PATH`与`CHARSET`的设置，POC代码很可能是有效的。具体需要编译 `ataque.c` 和 `vulner.c`，并在易受攻击的系统上执行 `ataque.out`。

**投毒风险：**
  - 虽然这个POC的主要目的是展示CVE-2021-4034漏洞的利用，但是代码中存在潜在的投毒风险。例如，攻击者可以修改`vulner.c`或者`ataque.c`，在提权之前执行其他恶意操作，如安装后门、收集信息等。但是整体代码的功能还是以演示提权为主。
 - `GCONV_PATH=/config.txt` 中，`/config.txt`文件为空，攻击者可能在上传后通过某种方式向其中写入恶意代码,但这不属于本代码范畴。

因此，投毒的概率较低，大约是5%。投毒风险主要在于利用此漏洞进行提权时，攻击者可能会加入额外的恶意代码。

**利用方式总结：**

1.  利用`pkexec`的参数处理错误，通过设置特殊的环境变量来触发漏洞。
2.  `PATH=GCONV_PATH=.`和`CHARSET=INTERNAL`环境变量的组合至关重要。
3.  设置`GCONV_PATH`为`.`，然后放置恶意的`gconv-modules`文件，诱使pkexec加载并执行其中的代码，从而提升权限。

**项目地址:** [marcosChoucino/CVE-2021-4034](https://github.com/marcosChoucino/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #29

**来源**: [CVE-2021-4034-mutur4_CVE-2021-4034.md](../2021/CVE-2021-4034-mutur4_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得root权限

**影响版本:** 受影响版本 <= 0.105

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱导 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **漏洞原理:** pkexec在没有正确处理参数的情况下，会尝试把环境变量当作命令执行，存在内存越界写入，从而getshell
2.  **POC 代码分析:**

    *   `Makefile`: 用于编译漏洞利用程序 `pwnkit.c`。 使用静态编译 `-static`，可以减少依赖，但会增加二进制文件的大小。
    *   `README.md`: 描述了漏洞和利用方法。
    *   `pwnkit.c`: 主要的漏洞利用代码，包含了利用漏洞的逻辑。

    *   `checkConditions` 函数：检查目标系统是否满足利用条件，例如 `gcc` 和 `pkexec` 是否存在，以及 pkexec 的版本是否在受影响的范围内（<=0.105）。
    *   `exploitVuln` 函数：包含利用漏洞的核心代码。 它创建特定的目录结构和文件，设置特殊的环境变量，并执行 `pkexec`。利用了 `GCONV_PATH` 环境变量来加载恶意共享库，从而实现提权。

3.  **利用过程：**

    *   创建 `GCONV_PATH=.` 和 `tmp` 目录。
    *   创建 `GCONV_PATH=./tmp` 文件。
    *   生成恶意的 gconv 模块 `tmp/gconv-modules`，包含 `module UTF-8// EXPLOIT// preload 2`
    *   编译包含提权代码的共享库 `tmp/preload.c`，该代码在初始化时调用 `setreuid(0, 0)` 和 `setregid(0, 0)`，然后执行 `/bin/sh`。
    *   设置环境变量 `CHARSET=EXPLOIT`，`SHELL=xxx` 和 `PATH=GCONV_PATH=.`。
    *   执行 `pkexec`，由于环境变量的设置，`pkexec` 会加载恶意的 gconv 模块，执行其中的提权代码，从而获得 root shell。

**有效性：**

提供的 POC 代码是有效的，可以成功利用 CVE-2021-4034 漏洞在目标系统上实现本地提权。

**投毒风险：**

代码中存在一定程度的投毒风险。虽然代码的主要目的是利用已知的漏洞，但可能存在以下情况：

*   **后门代码：** 虽然没有发现明显的后门代码，但恶意作者可能会在编译的共享库中添加额外的代码，例如植入持久性后门。
*   **依赖风险：**  此POC代码依赖于gcc和系统环境，如果系统环境被污染，会导致提权失败，或者执行其他恶意代码。
*   **潜在的破坏：**  利用过程可能不稳定，可能导致目标系统崩溃或数据损坏。

因此，在未进行充分审查的情况下，不建议直接在生产环境中使用此 POC 代码。


**项目地址:** [mutur4/CVE-2021-4034](https://github.com/mutur4/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #30

**来源**: [CVE-2021-4034-nagorealbisu_CVE-2021-4034.md](../2021/CVE-2021-4034-nagorealbisu_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec没有正确处理调用参数的计数，导致它尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使pkexec执行任意代码，从而使非特权用户获得目标机器的管理权限。

**利用方式：**

1.  **编译exploit:** 首先，使用提供的Makefile编译`pwnkit.c`生成动态链接库`pwnkit.so`，并编译`cve-2021-4034.c`生成可执行文件`cve-2021-4034`。
2.  **创建GCONV_PATH目录：** 创建`GCONV_PATH=.`目录，并将`true`命令复制到该目录下，重命名为`pwnkit.so:.`。
3.  **构造环境变量：** 设置以下环境变量：
    *   `pwnkit.so:.` (利用glibc的gconv机制)
    *   `PATH=GCONV_PATH=.`
    *   `SHELL=/bin/bash`
    *   `CHARSET=PWNKIT`
    *   `GIO_USE_VFS=`
4.  **执行exploit：** 运行编译好的`cve-2021-4034`可执行文件。该程序会调用`/usr/bin/pkexec`，并传递构造好的环境变量。
5.  **权限提升：** `pkexec`由于漏洞，会加载恶意的`pwnkit.so`动态链接库。`pwnkit.so`中的`gconv_init`函数会被执行，该函数设置uid和gid为0，然后执行`/bin/sh`，从而获得root权限的shell。

**有效性：**

根据漏洞信息和POC代码，该POC代码有效。漏洞库信息和搜索引擎结果均表明CVE-2021-4034是一个可被利用的本地权限提升漏洞，并且POC代码已经公开。

**投毒风险：**

提供的POC代码中未发现明显的恶意代码或后门。该代码的目的是利用pkexec的漏洞提升权限，没有进行任何未经授权的数据收集、修改或远程控制操作。`pwnkit.c` 的作用是劫持程序流程并启动一个root shell，属于漏洞利用的一部分，并非投毒代码。因此，投毒风险较低。

**项目地址:** [nagorealbisu/CVE-2021-4034](https://github.com/nagorealbisu/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #31

**来源**: [CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md](../2021/CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许本地普通用户提升到root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 polkit's pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，前提是符合预定义的策略。该漏洞的根本原因是 pkexec 没有正确处理调用参数的数量，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

1.  **漏洞原理：** pkexec 在处理参数时存在缺陷，会将环境变量当作命令执行。
2.  **利用方式：** 攻击者通过构造恶意的 GCONV_PATH 和 gconv-modules 文件，使得 pkexec 加载一个恶意的共享库 (.so)。这个共享库包含攻击者的 payload，当 pkexec 尝试执行时，payload 就会以 root 权限执行。
3.  **POC 代码分析：**  提供的 python 脚本 `poc-cve-2021-4034.py` 用于自动化利用过程，它执行以下操作：
    *   创建一个包含 payload 的共享库文件（lib-cve-2021-4034.so）。默认的 payload 是一个反向 shell，连接到攻击者指定的 IP 地址和端口。
    *   创建 GCONV_PATH=. 目录，以及 lab-cve-2021-4034 目录。
    *   创建 GCONV_PATH=./lab-cve-2021-4034 文件和 lab-cve-2021-4034/gconv-modules 文件，gconv-modules 文件指向恶意的共享库。
    *   使用构造的环境变量调用 execve 执行 /usr/bin/pkexec。

**有效性：**

根据漏洞描述、搜索结果和提供的 POC 代码，该漏洞利用是有效的，成功利用后可以提升到 root 权限。Qualys 的研究团队已经发现了这个漏洞，并且存在公开可用的利用代码。

**投毒风险：**

该仓库可能存在投毒风险，虽然主要功能是利用漏洞，payload 部分（Base64 编码的共享对象）可能被替换为具有恶意功能的代码，可能性为5%。以下是评估依据：

*   **Payload 的可替换性：** POC 的 payload 是一个 Base64 编码的字符串，攻击者可以轻松地替换为其他恶意代码。
*   **网络连接：** 默认 payload 是一个反向 shell，这意味着执行后会尝试连接到攻击者的服务器。攻击者可以在服务器上执行任意命令。
*   **Setup 脚本分析:** `setup.sh` 脚本主要用于安装依赖和配置 Docker 环境，没有明显的恶意代码。但安装的依赖项，如 docker 等，后续可以被植入恶意镜像。

**结论：**

该漏洞是一个高危漏洞，利用简单，影响广泛。虽然提供的 POC 代码主要是用于演示漏洞利用，但存在被恶意利用的风险，特别是 payload 部分。用户在使用前需要仔细检查 payload 的内容，并确保来源可信。


**项目地址:** [ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection](https://github.com/ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #32

**来源**: [CVE-2021-4034-supportingmx_cve-2021-4034.md](../2021/CVE-2021-4034-supportingmx_cve-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** 所有版本

**利用条件:** 需要本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec未正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱导pkexec执行任意代码，从而将非特权用户提升到目标机器上的管理员权限。

**漏洞利用方式：**

1.  **原理：** pkexec在处理参数时存在缺陷，错误地将环境变量当作程序路径执行。
2.  **利用：** 通过创建包含恶意代码的环境变量，并让pkexec执行，从而获得root权限。

**POC代码分析：**

提供的POC代码利用了`GCONV_PATH`环境变量。该变量用于指定gconv模块的路径，gconv模块用于字符集转换。攻击者通过以下步骤利用漏洞：

1.  创建`GCONV_PATH=.`目录，并创建一个名为`pwnkit`的文件，并修改其权限为可执行。
2.  在`pwnkit`目录下创建`gconv-modules`文件，指定一个自定义的gconv模块`PWNKIT`。
3.  创建`pwnkit/pwnkit.so`，其中包含恶意的shellcode。该shellcode会被`pkexec`执行，从而获得root权限。
4.  运行`fan`程序触发漏洞。

**有效性：**

根据漏洞描述和POC代码，可以判断该漏洞利用是有效的。搜索引擎结果也表明该漏洞已被广泛利用。

**投毒风险：**

该POC代码中存在一定的投毒风险。虽然主要目的是利用`pkexec`的漏洞进行提权，但恶意代码也可以被隐藏在`pwnkit/pwnkit.so` 文件里。例如，可以添加额外的逻辑来修改系统文件、安装后门或者发送敏感信息。但是，该风险较低。用户可以相对容易地检查 `pwnkit/pwnkit.so` 文件，通过反编译等手段来发现其中的恶意代码。并且利用此漏洞的目的就是提权, 增加投毒代码收益不高。因此，评估投毒风险为10%。该代码的作者可能会植入其他恶意代码的可能性较低。

**项目地址:** [supportingmx/cve-2021-4034](https://github.com/supportingmx/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #33

**来源**: [CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md](../2021/CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md)

## CVE-2021-4034 PwnKit 本地权限提升

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** 所有版本（在修复之前）

**利用条件:** 目标系统必须安装了存在漏洞的 polkit pkexec 组件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞，又名 PwnKit，存在于 polkit 的 pkexec 工具中。Pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码（CTF 挑战）都表明该漏洞是真实存在的，并且有可用的利用代码。搜索引擎结果中来自 Qualys、Red Hat 和其他安全机构的报告证实了该漏洞的严重性和影响。

**投毒风险评估：**

提供的代码仓库是一个 CTF 挑战，旨在让参与者利用 CVE-2021-4034 漏洞。虽然代码本身是为了演示和学习目的而编写的，但存在一些潜在的投毒风险。

1.  **依赖项风险：** Dockerfile不完整，依赖玩家手动安装存在漏洞的内核和软件包。如果玩家从不可信的源下载或安装这些依赖项，可能会引入恶意软件。

2.  **CTF 设计陷阱：** CTF 挑战的目的是测试参与者的技能，但也可能包含隐藏的陷阱或后门，这些陷阱或后门可能与漏洞本身无关。这些陷阱可能会误导参与者，或者在不知情的情况下执行恶意代码。

3.  **`shelly.so`潜在风险：** `shelly.so` 被描述为 helper binary，但没有进行详细分析。虽然 CTF 挑战可能需要使用此二进制文件来完成，但始终存在二进制文件中包含恶意代码的可能性。

考虑到以上几点，保守估计投毒风险为 10%。这种风险主要是由不完整的构建环境、CTF 设计陷阱的可能性以及二进制文件的潜在风险造成的。

**利用方式分析：**

1.  **环境准备：** 搭建存在漏洞的 polkit pkexec 环境，包括安装指定版本的 `libpolkit-gobject-1-0`、`libpolkit-agent-1-0` 和 `policykit-1`。
2.  **利用代码：** 利用已知的 PoC 代码（例如，通过构造特殊的环境变量）触发 pkexec 中的漏洞。
3.  **权限提升：** 成功利用漏洞后，攻击者可以执行任意代码，从而获得 root 权限。

**项目地址:** [wechicken456/CVE-2021-4034-CTF-writeup](https://github.com/wechicken456/CVE-2021-4034-CTF-writeup)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---



---

## POC #4

**来源**: [CVE-2021-4034-BugVex_Poison-HTB-Report.md](../2021/CVE-2021-4034-BugVex_Poison-HTB-Report.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可获取 root 权限

**影响版本:** all (受影响)

**利用条件:** 本地用户可以访问目标机器，且 pkexec 未打补丁

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 工具中的一个本地提权漏洞。由于 pkexec 未正确处理参数计数，攻击者可以通过构造特定的环境变量来执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞利用代码中展示了完整的利用步骤，包括编译恶意 payload，设置环境变量，然后运行 pkexec。搜索引擎结果也表明该漏洞在野外被广泛利用。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个部分：
1.  **C 源代码 (payload.c)：** 用于生成共享对象 (payload.so)，该共享对象包含恶意代码。
2.  **Shell 命令：** 设置环境变量并运行 pkexec。

风险分析：
*   **payload.c 的内容：** 没有提供 `payload.c` 文件的具体内容，因此无法直接判断 payload 的行为。但是，从利用方式来看，该 payload 旨在利用 pkexec 的漏洞来执行恶意代码。
*   **环境变量设置：** 环境变量 `GCONV_PATH`、`CHARSET`、`LD_PRELOAD` 和 `PATH` 是利用该漏洞的关键。`GCONV_PATH` 和 `CHARSET` 用于加载恶意的 gconv 模块，`LD_PRELOAD` 用于预加载恶意的共享对象，`PATH` 用于确保恶意的 gconv 模块优先被加载。

虽然POC中涉及`payload.c` ,如果没有对源码进行恶意篡改和添加恶意代码, 本身是不存在投毒风险的,但是`payload.c`文件未给出,无法完全验证,存在潜在投毒风险，但是概率极低。

**利用方式：**
1.  **编译 Payload：** 首先，使用 GCC 编译 C 源代码 (payload.c) 生成共享对象 (payload.so)。编译时需要使用 `-shared` 和 `-fPIC` 选项。
2.  **创建 exploit 目录：** 创建一个名为 exploit 的目录，并将 payload.so 移动到该目录中。
3.  **创建 gconv-modules 文件：** 在 exploit 目录中创建一个名为 gconv-modules 的文件，该文件用于配置 gconv 模块。内容一般是 `module UTF-8// POC// payload 2`。
4.  **设置环境变量：** 设置以下环境变量：
    *   `GIO_USE_VFS=local`
    *   `PATH=./exploit:$PATH`
    *   `LD_PRELOAD=./exploit/payload.so`
    *   `GCONV_PATH=./exploit`
    *   `CHARSET=POC`
5.  **运行 pkexec：** 运行 pkexec 命令，这将触发漏洞并执行 payload.so 中的恶意代码，从而提升权限。

**项目地址:** [BugVex/Poison-HTB-Report](https://github.com/BugVex/Poison-HTB-Report)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #5

**来源**: [CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md](../2021/CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md)

## CVE-2021-4034-Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可执行 pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 没有正确处理调用参数计数，导致程序尝试将环境变量作为命令执行。

**漏洞利用方式：**

1.  **利用 GCONV_PATH 和 CHARSET 环境变量：** 该漏洞利用通过精心构造 `GCONV_PATH` 和 `CHARSET` 环境变量，欺骗 `pkexec` 加载恶意的 gconv 模块。gconv 模块是用于字符集转换的动态链接库。
2.  **创建恶意 gconv 模块：** 攻击者创建一个包含恶意代码的 `.so` 文件（payload.so），并在 `gconv-modules` 文件中定义一个字符集转换规则，将特定的字符集（例如 `LPE`）映射到该恶意 `.so` 文件。
3.  **触发漏洞：** 当 `pkexec` 尝试执行字符集转换时，会加载并执行恶意 `.so` 文件中的代码，从而实现权限提升。
4.  **代码分析：** `pkexec_exploit.c` 首先创建必要的目录结构 (`GCONV_PATH=.`, `lpe`)，然后在 `lpe/payload.c` 中写入 shellcode，编译成动态链接库 `lpe/payload.so`。shellcode 的作用是设置 uid、gid 为 0，然后执行 `/bin/sh`。
5.   **投毒风险分析:** POC代码本身主要用于提权，但存在一定的投毒风险。例如，攻击者可能修改 `payload.c` 中的 shellcode，使其在提权后执行其他恶意操作，如安装后门程序、窃取用户数据等。虽然`pkexec_exploit.c`主要功能是利用漏洞进行权限提升，但其中的`payload.c`，可能包含潜在的恶意代码。payload.c中的恶意代码可能执行以下操作：下载并执行其他恶意程序、修改系统文件、创建具有root权限的后门帐户等。从防御的角度来看，所有来自外部的代码都应被视为潜在的威胁。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该漏洞的利用是有效的。POC 代码已经公开，并且有大量的文章和视频演示了如何利用该漏洞。

**总结：**

这是一个严重的安全漏洞，允许未经授权的用户获得系统 root 权限。系统管理员应尽快应用补丁程序来修复此漏洞。

**项目地址:** [CYB3RK1D/CVE-2021-4034-POC](https://github.com/CYB3RK1D/CVE-2021-4034-POC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #6

**来源**: [CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md](../2021/CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** 所有版本 (修复前)

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户身份运行命令，具体权限取决于预定义的策略。

**漏洞利用方式：**

1.  **漏洞原理：** pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。通过精心构造环境变量，攻击者可以诱使pkexec执行任意代码。

2.  **利用代码分析：**
    *   `cve-2021-4034.c`:  该C代码负责设置特定的环境变量并执行`/usr/bin/pkexec`。关键的环境变量包括：
        *   `pwnkit.so:.`:  这指示动态链接器在当前目录中查找名为`pwnkit.so`的共享对象。
        *   `PATH=GCONV_PATH=.`:  这会将`PATH`环境变量设置为`GCONV_PATH=.`， 影响程序的路径查找方式.
        *   `CHARSET=PWNKIT`: 触发加载恶意gconv模块的关键。
        *   `GIO_USE_VFS=`: 清空`GIO_USE_VFS`环境变量，避免潜在的干扰。
    *   `pwnkit.c`:  该C代码定义了`gconv`和`gconv_init`函数。`gconv_init`函数是漏洞利用的核心，它被设计为在gconv模块加载时执行。此函数会设置uid和gid为0，然后执行`/bin/sh`，从而获得root shell。
    *   `gconv-modules`: 定义了一个gconv模块，将`PWNKIT`字符集映射到`pwnkit.so`库。
    *   `Makefile`:  用于编译漏洞利用代码，生成`pwnkit.so`共享对象和`cve-2021-4034`可执行文件。

3.  **利用步骤：**
    a.  编译`pwnkit.c`生成共享对象`pwnkit.so`。
    b.  创建一个`gconv-modules`文件，声明一个使用`pwnkit.so`的gconv模块。
    c.  执行`cve-2021-4034`，它会设置特定的环境变量并运行`pkexec`。`pkexec`会加载恶意的gconv模块，调用`gconv_init`函数，从而导致权限提升。

**有效性：**提供的PoC代码是有效的。它利用了pkexec中的参数处理漏洞，通过gconv模块机制执行预定义的shell，从而实现本地权限提升。

**投毒风险：** 此仓库存在极小的投毒风险。`dry-run`目录下的文件可以用来进行无害的测试。如果将 `dry-run-cve-2021-4034.c` 中的 `setuid(0)` 修改为恶意操作，则存在投毒可能。但原代码并未发现明显的恶意行为，判定投毒风险为1%。实际部署前需要进行代码审计。

**项目地址:** [EuJin03/CVE-2021-4034-PoC](https://github.com/EuJin03/CVE-2021-4034-PoC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #7

**来源**: [CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md](../2021/CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** 所有版本 (漏洞修复前)

**利用条件:** 需要本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 中 pkexec 工具的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量来利用此漏洞，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析:**

1.  **漏洞原理:**  pkexec 没有正确处理传递给它的参数数量。 当参数数量不足时，它会尝试将环境变量作为程序执行。
2.  **利用方式:** 提供的 POC 代码利用了 `GCONV_PATH` 环境变量。`GCONV_PATH` 用于指定 gconv 模块的搜索路径，gconv 模块用于字符集转换。攻击者创建一个目录，并在该目录下创建一个名为 `gconv-modules` 的文件，该文件定义了一个恶意的 gconv 模块。然后，设置 `GCONV_PATH` 环境变量指向该目录，并触发 pkexec。pkexec 会加载恶意的 gconv 模块，该模块在 `gconv_init` 函数中执行 `setuid(0)`、`setgid(0)`、`setgroups(0)` 和 `execve("/bin/sh", NULL, NULL)`，从而获得 root shell。
3.  **POC代码分析:**
    *   `Makefile`: 用于编译恶意的共享库 `evil.so` 和利用程序 `exploit`。
    *   `evil-so.c`: 包含恶意代码，该代码在加载时会设置 uid、gid 和 groups 为 0，并执行 `/bin/sh`，创建一个 root shell。
    *   `exploit.c`: 创建必要的目录和文件结构，设置环境变量，并执行 `pkexec`。

**有效性:**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该 POC 代码是有效的。 漏洞利用代码构造了特定的环境，利用 pkexec 的漏洞执行恶意代码，从而实现提权。

**投毒风险:**

代码中没有明显的投毒行为。`evil-so.c`的目的就是提权，这符合漏洞利用的需求。没有发现任何在提权之外执行其他恶意操作的代码。 风险评估为 0%。


**项目地址:** [FancySauce/PwnKit-CVE-2021-4034](https://github.com/FancySauce/PwnKit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #8

**来源**: [CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md](../2021/CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升为root权限

**影响版本:** 所有版本（受影响版本）

**利用条件:** 目标系统必须安装易受攻击的Polkit版本，且攻击者需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 没有正确处理调用参数的个数，导致尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞描述、搜索结果和提供的漏洞利用代码，该漏洞是有效的。搜索结果中多个链接（例如，Qualys 的博客文章、Red Hat 的安全公告）都确认了该漏洞的存在，并提供了利用的细节。提供的 POC 代码旨在利用此漏洞。

**投毒风险：**
提供的 exploit.c 代码的功能是：
1.  创建 `GCONV_PATH=.` 目录。
2.  创建 `GCONV_PATH=./exploit` 文件，并赋予执行权限。
3.  创建 `exploit` 目录。
4.  创建 `exploit/gconv-modules` 文件，包含 gconv 模块的配置信息。
5.  创建 `exploit/shelltospawn.c` 文件，包含 C 代码，该代码将设置 uid 和 gid 为 0，并执行 `/bin/bash`。
6.  编译 `exploit/shelltospawn.c` 为共享库 `exploit/ISO646.so`。
7.  使用 `execve` 函数，设置特殊的环境变量（`PATH`, `CHARSET`, `SHELL`），并执行 `/usr/bin/pkexec`。

这个利用方法利用了 `gconv` 机制中的一个漏洞，允许通过环境变量加载恶意共享库，从而执行提权操作。

从代码本身来看，没有明显的**直接的后门代码**，例如植入 SSH 密钥或创建后门账户。然而，`system("/bin/bash")` 这行代码的功能是启动一个 root shell，攻击者可以使用该 shell 执行任何操作。因此，可以将整个利用过程视为一种投毒，因为它的最终结果是在目标系统上留下一个可以完全控制系统的 root shell。

 考虑到这种最终结果，将投毒风险评为 10% 是考虑到存在其他利用此漏洞的方式，而当前提供的 exploit.c 更加侧重于漏洞利用本身。

**利用方式：**
1.  **环境准备：** 创建必要的目录和文件，包括 `GCONV_PATH` 和包含恶意代码的共享库。
2.  **配置 gconv：** 创建 `gconv-modules` 文件，配置 gconv 模块，使其加载恶意的共享库。
3.  **设置环境变量：** 设置 `PATH`、`CHARSET` 和 `SHELL` 环境变量，以便 pkexec 能够加载恶意的 gconv 模块。
4.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，触发漏洞，加载恶意代码，从而获得 root 权限。

利用的关键在于 `pkexec` 在处理环境变量时存在漏洞，允许攻击者控制加载的 gconv 模块，从而执行任意代码。

**项目地址:** [JohnGilbert57/CVE-2021-4034-Capture-the-flag](https://github.com/JohnGilbert57/CVE-2021-4034-Capture-the-flag)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #9

**来源**: [CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md](../2021/CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (Pwnkit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** <= 0.105

**利用条件:** 本地用户访问，pkexec setuid root程序存在且未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (Pwnkit) 漏洞是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid-root 程序，允许授权用户以特权用户身份执行命令。该漏洞源于 pkexec 在处理命令行参数时存在缺陷，导致可以覆盖环境变量。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。漏洞利用代码通过利用 pkexec 的参数处理缺陷来覆盖环境变量，尤其是 `GCONV_PATH`。通过设置 `GCONV_PATH` 指向包含恶意共享对象的目录，并设置 `CHARSET` 触发 glibc 的 gconv 机制，加载恶意共享对象，从而执行任意代码。

**投毒风险:**
提供的PoC代码本身看起来是一个完整的漏洞利用程序，但存在一些潜在的投毒风险，概率为10%。
1.  **`rm -rf 'GCONV_PATH=.' 'pwnkit'`**:  此命令旨在清理利用过程中创建的文件和目录。但如果目标系统上存在同名但重要的文件或目录，则可能造成意外删除。
2.  **对/bin/sh的依赖性**脚本依赖于 /bin/sh 的存在和功能。在某些受限环境中，/bin/sh可能不存在或受到限制，从而导致利用失败。攻击者可能通过其他命令达到破坏的目的。

**利用方式:**
1.  **准备恶意共享对象：** 首先，创建一个包含 shellcode 的 C 文件（例如 `pwnkit.c`）。该 shellcode 的作用是设置有效的用户和组 ID (UID/GID) 为 0 (root)，然后执行一个 shell (通常是 `/bin/sh`)。
2.  **编译恶意共享对象：** 使用 GCC 将 C 文件编译成共享对象 (`.so` 文件)，例如 `pwnkit.so`。
3.  **创建 GCONV_PATH 目录：** 创建一个名为 `GCONV_PATH=.` 的目录，并创建一个空文件 `GCONV_PATH=./pwnkit`。这是为了欺骗 pkexec 在当前目录中查找 gconv 模块。
4.  **创建 gconv-modules 文件：** 创建一个名为 `gconv-modules` 的文件，其中包含指定自定义 gconv 模块的配置信息。
5.  **设置环境变量并执行 pkexec：** 设置环境变量 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。然后，不带任何参数执行 `pkexec`。由于 pkexec 的参数处理缺陷，这会导致覆盖环境变量，并触发 gconv 机制加载并执行恶意共享对象，从而获得 root 权限。

**总结:**
CVE-2021-4034 是一个严重的安全漏洞，可以被本地低权限用户利用来获得 root 权限。该漏洞利用简单，影响广泛，需要及时修复。虽然提供的 PoC 代码看起来直接，但仍需警惕潜在的投毒风险，并在测试环境中仔细评估。

**项目地址:** [LucasPDiniz/CVE-2021-4034](https://github.com/LucasPDiniz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #10

**来源**: [CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md](../2021/CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md)

## CVE-2021-4034-Polkit pkexec权限提升漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是一个存在于Polkit的pkexec工具中的本地权限提升漏洞。pkexec是一个setuid程序，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。该漏洞源于pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **构造恶意环境变量：** 利用代码通过创建`GCONV_PATH=.`目录，并在其中放置恶意的gconv模块配置文件`gconv-modules`。`gconv-modules`文件指示系统加载恶意的共享库`pwnkit.so`。
2.  **编译恶意共享库：**  利用代码编译一个包含提权代码的共享库`pwnkit/pwnkit.so`，该共享库在初始化时（`gconv_init`函数）将当前进程的UID和GID设置为0（root），然后执行一个shell。
3.  **执行pkexec：**  利用代码通过`execve`函数执行`/usr/bin/pkexec`，并传递构造好的环境变量，例如`PATH=GCONV_PATH=.`，`CHARSET=PWNKIT`等。
4.  **漏洞触发：**  当pkexec尝试加载gconv模块时，由于`GCONV_PATH`被设置为恶意目录，它会加载攻击者提供的`pwnkit.so`，从而执行其中的提权代码，最终获得root shell。

**有效性：**

提供的POC代码是有效的。它已经在Debian 10和CentOS 7上验证成功，可以使非特权用户获得root权限。

**投毒风险：**

经过分析，提供的POC代码中没有发现明显的恶意代码或后门。该代码的目的是利用CVE-2021-4034漏洞进行本地权限提升，其行为符合漏洞描述和利用原理。作者可能存在的投毒风险极低(0%)。

**参考信息：**

*   漏洞库信息：CVE-2021-4034描述了该漏洞的细节和影响。
*   搜索引擎结果：搜索结果提供了有关该漏洞的更多信息，包括漏洞分析、利用方法和缓解措施。例如，Qualys的博客文章(webpage 2)详细介绍了该漏洞的利用方式。

**项目地址:** [Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-](https://github.com/Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #11

**来源**: [CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md](../2021/CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md)

## CVE-2021-4034-Polkit pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统上存在pkexec且未修复漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户按照预定义的策略以特权用户身份运行命令。此漏洞的利用方式如下：

1.  **漏洞原理：** pkexec 在处理调用参数数量时存在缺陷，导致其尝试将环境变量作为命令执行，从而允许攻击者通过精心构造的环境变量来执行任意代码。
2.  **利用步骤：**
    *   创建一个包含恶意代码的动态链接库 (pwnkit.so)。该库的 `gconv_init` 函数会设置用户ID和组ID为0，然后执行一个shell。
    *   创建一个 `gconv-modules` 文件，用于告诉 `iconv` 如何使用恶意库将 UTF-8 转换为 PWNKIT 编码。
    *   设置 `GCONV_PATH=.` 环境变量，使 `iconv` 在当前目录中查找转换模块。
    *   运行利用程序 (exp)。这个利用程序会触发 pkexec 的漏洞，导致它加载并执行恶意动态链接库，从而获得 root 权限。
3.  **有效性评估：** 根据漏洞信息、搜索结果以及提供的PoC代码，该PoC代码**有效**，可以利用此漏洞实现本地提权。
4.  **投毒风险分析：** 提供的代码中，存在投毒的可能性较低，大约10%。主要风险在于`pwnkit.c`文件，在实际环境中，攻击者可以替换shell的路径或其他恶意代码，例如删除关键文件或植入后门。虽然当前代码的目标是提升权限，但恶意修改后可能造成更大的危害。`chmod -R 777 2>/dev/null` 这行代码较为可疑，虽然看起来像是为了确保执行权限，但也可能是为了方便植入后门或执行其他恶意操作，因为这样会允许任何用户修改这些文件。但考虑到这是已编译后的项目，赋予所有权限以方便使用也在情理之中,因此投毒风险较低。
5. **利用方式总结:** 通过构造特定的环境变量，特别是`GCONV_PATH`，以及相应的`gconv-modules`配置文件，使得`pkexec`加载恶意的动态链接库，该库在初始化时将当前进程的用户ID和组ID设置为0，并执行一个shell，从而获得root权限。

**项目地址:** [Part01-Pai/Polkit-Permission-promotion-compiled](https://github.com/Part01-Pai/Polkit-Permission-promotion-compiled)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #12

**来源**: [CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md](../2021/CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** all

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034是Polkit的pkexec工具中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户的身份运行命令，基于预定义的策略。漏洞源于pkexec没有正确处理调用参数的计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量，诱使pkexec执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞描述和搜索结果，此漏洞确实存在并且影响范围较广，利用代码的存在也证实了其可利用性。

**投毒风险：**
提供的“漏洞利用代码”实际上是许可协议文件（LICENSE和LICENSE.md），并非实际的漏洞利用代码。因此，无法直接分析其是否存在投毒行为。但从信息安全角度考虑，任何来源不明的代码都存在潜在风险，此处假设存在较低的投毒风险(5%), 主要是担心下载/使用 POC 的过程中被替换或篡改。

**利用方式：**
1.  **构造恶意环境变量：** 攻击者构造特殊的环境变量，这些环境变量包含攻击者想要执行的恶意代码。
2.  **利用参数计数错误：** 由于`pkexec`在处理参数时存在缺陷，它会将构造的恶意环境变量作为命令来执行。
3.  **权限提升：**  通过执行恶意代码，攻击者可以获得root权限。

**补充说明:** 真正的POC代码通常会利用环境变量来执行shell命令或加载恶意共享库。由于未提供真正的POC代码，以上分析基于漏洞描述和搜索结果进行推断。

**项目地址:** [Pol-Ruiz/CVE-2021-4034](https://github.com/Pol-Ruiz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #13

**来源**: [CVE-2021-4034-TheSermux_CVE-2021-4034.md](../2021/CVE-2021-4034-TheSermux_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许普通用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统存在存在漏洞的pkexec程序，且用户能够在本地执行该程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞是 Polkit pkexec 程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。

**有效性：**

提供的 POC 代码有效。漏洞库信息和搜索结果表明该漏洞已被广泛研究并存在可用的利用代码。POC 利用代码利用了 pkexec 的参数处理错误，通过构造特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险：**

虽然直接的后门代码没有发现，但仍然存在一定的投毒风险。风险点在于以下几点：

*   `cve-2021-4034.sh` 脚本从远程 URL 下载利用代码。如果该 URL 被攻击者控制，则可以提供恶意代码。
*   `Makefile` 构建过程中可能存在隐蔽的恶意代码注入，尽管当前的 Makefile 看起来比较简单。
*   `pwnkit.c` 中 `execve` 执行 `/bin/sh`，如果目标系统的 `/bin/sh` 被篡改，可能导致执行恶意代码。虽然利用本身的目标是提权到 root，但如果结合其他漏洞或配置错误，也可能导致意想不到的后果。

综合评估，投毒风险为10%。

**利用方式：**

1.  **下载利用代码：** 首先，从给定的 URL 下载 `cve-2021-4034.c`, `pwnkit.c` 和 `Makefile` 文件。
2.  **编译利用代码：** 使用 `make` 命令编译 `pwnkit.c` 为动态链接库 `pwnkit.so`，并编译 `cve-2021-4034.c` 为可执行文件 `cve-2021-4034`。
3.  **构造环境变量：**  `cve-2021-4034.c` 设置特定的环境变量，包括:
    *   `pwnkit.so:.`  指定 GCONV 模块的路径。
    *   `PATH=GCONV_PATH=.`  设置 PATH 环境变量，欺骗 pkexec 从当前目录加载 GCONV 模块。
    *   `SHELL=/lol/i/do/not/exists`  设置一个不存在的 SHELL，这可能触发一些错误处理逻辑。
    *   `CHARSET=PWNKIT`  设置字符集为 PWNKIT，触发加载指定的 GCONV 模块。
    *   `GIO_USE_VFS=`  可能用于绕过某些安全限制。
4.  **执行 pkexec：**  `cve-2021-4034.c`  使用 `execve` 执行 `/usr/bin/pkexec`。 由于环境变量设置不当，pkexec 将会尝试加载恶意 GCONV 模块 `pwnkit.so`。
5.  **GCONV 模块执行：** `pwnkit.so` 中的 `gconv_init` 函数被调用，该函数设置用户 ID 和组 ID 为 0 (root)，然后执行 `/bin/sh`，从而获得 root 权限。

总之，该利用利用了 pkexec 的参数处理缺陷和 GCONV 机制，通过构造恶意环境变量来加载恶意代码，最终实现提权。

**项目地址:** [TheSermux/CVE-2021-4034](https://github.com/TheSermux/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #14

**来源**: [CVE-2021-4034-Typical0day_CVE-2021-4034.md](../2021/CVE-2021-4034-Typical0day_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户，pkexec具有SUID权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞存在于 pkexec 处理参数计数的方式，导致它可以将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞的 POC 代码是有效的。搜索引擎结果显示多个安全厂商已经确认并提供了利用方法。提供的代码包含 Makefile、C 源代码以及利用说明，表明这是一个可工作的 Exploit。

**投毒风险：**

分析提供的 POC 代码内容，投毒风险评估为10%。

*   `LICENSE` 文件：标准的 MIT 许可证，表明代码是开源的，增加了透明度。
*   `Makefile` 文件：用于编译 exploit，没有发现可疑操作。
*   `README.md` 文件：提供漏洞说明、利用方法和缓解措施，描述清晰。
*   `pwnkit.c` 文件：实现了利用 GCONV_PATH 环境变量进行提权的关键逻辑。需要进一步审计，但是表面上没有发现恶意行为。
*   `cve-2021-4034.c` 文件：主程序，负责设置环境变量并执行 pkexec。同样需要进一步审计。
    `gconv-modules`: 指定了要使用的gconv模块,用于触发漏洞

虽然没有明显的恶意代码，但是仍然存在风险。例如，`pwnkit.c` 和 `cve-2021-4034.c` 中可能存在隐藏的后门或触发条件，这些后门只有在特定环境下才会激活。此外，该代码可能依赖于某些特定的系统配置或库版本，如果目标系统不满足这些条件，exploit 可能会失败，或者产生未知的副作用。

因此，在使用此 POC 之前，务必进行代码审计，并在隔离环境中进行测试。

**利用方式：**

利用方式主要通过以下步骤：

1.  **编译：** 使用 `make` 命令编译 `pwnkit.so` (共享库) 和 `cve-2021-4034` (主程序)。同时创建 `gconv-modules` 文件，内容指定了要加载的gconv模块以及创建相关的目录结构。
2.  **环境变量设置：** Exploit 通过设置 `GCONV_PATH` 和 `GCONV_MODULES` 环境变量来利用该漏洞。
3.  **触发漏洞：** 运行编译后的 `cve-2021-4034` 程序，它会调用 `pkexec`，由于环境变量的设置，`pkexec` 会尝试加载恶意的 `pwnkit.so` 共享库。
4.  **代码执行：** `pwnkit.so` 共享库中的代码会被执行，从而获得 root 权限。
5.  **提权：** 在 `pwnkit.so` 中，通过调用 `setuid(0)` 和 `setgid(0)` 将进程的 UID 和 GID 设置为 0 (root)，从而获得 root 权限。最后，执行 shell 命令，允许攻击者在目标系统上执行任意操作。

**项目地址:** [Typical0day/CVE-2021-4034](https://github.com/Typical0day/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #15

**来源**: [CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** All (受影响版本)

**利用条件:** 需要本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地提权。

**有效性：**
提供的 PoC 代码是有效的，利用了 pkexec 的环境变量处理缺陷。利用方式包括编译 C 代码生成共享库，然后设置特定的环境变量来触发漏洞，最终执行恶意代码以获得 root 权限。从搜索引擎结果和漏洞库信息来看，该漏洞的 PoC 已经被广泛公开，并且有大量的成功利用案例。

**投毒风险：**
该仓库中存在少量投毒风险，大约为 10%。

虽然主要代码是为了利用漏洞，但是sh脚本中存在`(sleep 1 && rm ./PwnKit & )`，该命令会在执行漏洞利用程序后删除自身。这可以被视为一种轻微的混淆手段，虽然并非直接注入恶意代码，但增加了分析和溯源的难度。所以存在一定投毒风险。

**利用方式：**
1.  **利用核心：** 利用 `pkexec` 程序解析参数时的漏洞，将恶意代码注入到环境变量中。
2.  **创建 GCONV_PATH：**  创建目录 `GCONV_PATH=.` 和 `.pkexec`，以及文件 `.pkexec/gconv-modules`，用于欺骗 `pkexec` 程序加载自定义的 gconv 模块。
3.  **编译恶意共享库：**  将 `PwnKit.c` 编译为共享库 `PwnKit.so`，其中包含 `entry` 和 `gconv` 函数。`entry` 函数负责设置环境变量，`gconv` 函数负责执行提权后的操作。
4.  **设置环境变量：**  设置 `PATH`、`CHARSET`、`SHELL` 等环境变量，使得 `pkexec` 程序加载恶意的 gconv 模块。
5.  **执行 pkexec：**  执行 `/usr/bin/pkexec` 或 `pkexec` 程序，触发漏洞，执行 `gconv` 函数中的提权代码。
6.  **提权：** `gconv` 函数会设置 uid 和 gid 为 0，然后执行 `CMD` 环境变量指定的命令，或者启动一个 root shell。
7. **清理:** 在成功执行利用后,清除恶意目录和文件。

综上，该 PoC 代码有效，但存在少量投毒风险，利用方式清晰，可实现本地提权。

**项目地址:** [X-Projetion/Exploiting-PwnKit-CVE-2021-4034-](https://github.com/X-Projetion/Exploiting-PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #16

**来源**: [CVE-2021-4034-Y3A_CVE-2021-4034.md](../2021/CVE-2021-4034-Y3A_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 所有版本 (在修复之前)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 未能正确处理调用参数计数，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用方式：**

1.  **创建恶意 GCONV 模块:** POC 代码首先创建一个目录结构 `/tmp/GCONV_PATH=.` 和 `/tmp/getpwned`，并在其中创建一个名为 `gconv-modules` 的文件。此文件用于配置 iconv 字符集转换。
2.  **gconv-modules 文件的内容:** `gconv-modules` 文件定义了两个字符集转换规则，将 UTF-8 和 INTERNAL 字符集映射到位于 `/tmp/shell.so` 的恶意共享库。  路径中使用了相对路径跳转，这是为了绕过一些安全检查。
3.  **创建恶意共享库 (shell.so):**  POC 代码使用 `shell.c` 创建了一个共享库 `/tmp/shell.so`。此库包含一个 `gconv_init` 函数，该函数在加载时会被执行。`gconv_init` 函数设置用户的 UID 和 GID 为 0 (root)，然后执行 `/bin/sh`，从而产生一个 root shell。
4.  **创建利用程序 (hax):**  POC 代码使用 `hax.c` 创建一个利用程序 `/tmp/hax`。此程序使用 `execve` 函数执行 `/usr/bin/pkexec`，并传递一组精心构造的环境变量，包括 `PATH=GCONV_PATH=.`、`CHARSET=UTF-16` 和 `SHELL=yeahdoesntexist`。设置`CHARSET=UTF-16` 触发了iconv_open()的调用，利用了`GCONV_PATH=.`查找恶意共享库，而 `SHELL=yeahdoesntexist` 触发了 g_printerr()，都保证共享库能够被加载。
5.  **执行利用程序:**  POC 代码最后执行 `/tmp/hax`，这将触发 pkexec 的漏洞，加载恶意共享库，并生成一个 root shell。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，此漏洞利用代码是有效的。多个来源证实了该漏洞的存在和可利用性，并且 POC 代码实现了利用该漏洞的步骤。

**投毒风险：**

虽然此 POC 代码主要用于演示漏洞利用，但仍然存在一些潜在的投毒风险：

*   **依赖 /tmp 目录：**  代码大量使用 `/tmp` 目录。如果攻击者能够控制 /tmp 目录的创建或文件内容，可能会篡改 POC 代码，导致意外行为或其他恶意活动。
*   **后门植入:**  shell.c 中设置了 setuid(0) 等操作，如果被修改为连接到外部服务器，则会造成比较严重的后门。
*   **权限问题:**   POC 代码包含 `chmod +x` 命令，这可能会意外地修改文件权限，从而导致安全问题。
*   **代码复杂性：** 尽管 POC 代码相对简单，但它仍然包含 C 代码和 shell 脚本。攻击者可能会利用代码的复杂性来隐藏恶意代码。

综合考虑，投毒风险较低，估计为 10%。主要风险在于代码依赖 `/tmp` 目录，并且代码中共享库本身可以被作为后门来修改。


**项目地址:** [Y3A/CVE-2021-4034](https://github.com/Y3A/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #17

**来源**: [CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md](../2021/CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** 所有版本

**利用条件:** 本地用户可以访问pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034（Pwnkit）是Polkit的pkexec实用程序中的本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是pkexec没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **漏洞原理：** pkexec在处理参数时存在缺陷，导致它可以将某些环境变量的内容误认为是要执行的命令。通过精心构造环境变量，可以劫持程序的执行流程。

2.  **POC分析：** 提供的POC利用了glibc的gconv机制。`gconv`用于处理字符集转换。POC首先创建了一个恶意的`zero.so`共享对象，其中包含`gconv_init`函数，该函数会设置UID和GID为0，然后执行/bin/bash。然后创建一个`gconv-modules`文件，将`UTF-8`编码转换为`ZERO`编码时加载`zero.so`。接着，设置`GCONV_PATH=.`，并复制`zero.so`到当前目录，强制glibc加载当前目录下的`gconv`模块。最后，创建一个`zero_exploit.c`程序，设置一些环境变量，其中`CHARSET=ZERO`触发字符集转换，从而加载恶意的`zero.so`，提权执行bash。

3.  **有效性：** POC代码有效，可以成功利用CVE-2021-4034漏洞，在未打补丁的系统上获得root权限。搜索引擎结果和漏洞库信息均表明该漏洞易于利用，且已存在公开的利用代码。

4.  **投毒风险：** 仓库中存在投毒代码的可能性较低，估计为5%。虽然主要代码是漏洞利用，但不能完全排除作者在脚本中加入恶意命令的可能性。但总体来看，脚本内容直接，没有发现明显的恶意行为。

**项目地址:** [Z3R0-0x30/CVE-2021-4034](https://github.com/Z3R0-0x30/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #18

**来源**: [CVE-2021-4034-artemis-mike_cve-2021-4034.md](../2021/CVE-2021-4034-artemis-mike_cve-2021-4034.md)

## CVE-2021-4034-polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞在于 pkexec 未能正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 PoC 代码利用了上述漏洞，通过构造特定的环境变量 `GCONV_PATH=.` 和 `LC_MESSAGES=en_US.UTF-8` ，使得 pkexec 尝试加载当前目录下的 Gconv 模块。这个 Gconv 模块实际上是一个恶意共享对象 (payload.so)，包含提权代码。 编译后的c文件, 通过设置uid，guid为0，即root权限, 再执行 `whoami`命令。

**投毒风险：**
此仓库可能存在轻微的投毒风险，几点考虑如下：

1.  **外部依赖：** Playbook使用了 `asses_CVE-2021-4034.yml`，需要用户手动修改`hosts` 变量,执行`ansible-playbook` 命令。 如果playbook内容被篡改可能会造成非预期结果。
2.  **代码可读性：**  代码可读性一般，存在少量注释。虽然作者声明仅用于教育目的，并且提示用户对执行的代码负责，但仍然可能存在潜在的风险。
3. **payload.c潜在风险:** `payload.c` 中虽然执行的是 `whoami`, 但如果被修改成其他恶意命令，可能会造成破坏。
4. 提供的YAML文件尝试删除利用过程中创建的临时文件，但不能保证所有文件都被完全清理。如果清理不彻底，可能会留下潜在的安全隐患。

**总体而言，投毒风险较低，大概为 10%。主要是playbook执行的不可控因素，以及payload.c被篡改的风险。**

**利用方式：**
1.  **编译PoC：** 使用 `gcc -Wall cve-2021-4034.c -o cve-2021-4034-exploit` 命令编译 C 语言 PoC 代码。
2.  **修改Playbook:**  修改 `asses_CVE-2021-4034.yml` 中的 `hosts` 变量，指定目标主机。
3.  **执行Playbook：** 使用 `ansible-playbook -i </path/to/inventory.yml> </path/to/playbooks/>asses_CVE-2021-4034.yml` 命令执行 Ansible playbook。
4.  **验证结果：** 检查 playbook 的执行结果。如果 `Check result of privilege escalation` 任务失败，则表示提权成功。

实际上，该 exploit 的核心思路是通过创建 GCONV_PATH 目录和 LC_MESSAGES 环境变量，使得 pkexec 尝试加载恶意共享对象，从而执行共享对象中的提权代码。该代码首先将当前进程的 UID 和 GID 设置为 0 (root)，然后再执行 whoami 命令。如果执行成功, `whoami` 的结果将是 root，表示提权成功。

**项目地址:** [artemis-mike/cve-2021-4034](https://github.com/artemis-mike/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #19

**来源**: [CVE-2021-4034-asepsaepdin_CVE-2021-4034.md](../2021/CVE-2021-4034-asepsaepdin_CVE-2021-4034.md)

## CVE-2021-4034 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许非特权用户获得root权限

**影响版本:** 所有受影响版本

**利用条件:** 目标系统存在 Polkit pkexec 且未修复

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 实用程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，最终导致尝试将环境变量作为命令执行。攻击者可以通过精心制作环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞描述、搜索结果和提供的 PoC 代码，可以判定该漏洞是有效的。多个来源（包括 NVD、Qualys、Red Hat 等）都确认了此漏洞，并且存在公开可用的 PoC 代码。该 PoC 代码通过创建特定的目录结构和环境变量来利用此漏洞，从而导致 pkexec 执行攻击者控制的代码，最终提升到 root 权限。

**投毒风险：**

分析提供的 PoC 代码 `cve-2021-4034-poc.c`。代码首先创建 `GCONV_PATH=.` 目录和 `pwnkit` 目录，然后将恶意 shellcode 写入 `pwnkit/pwnkit.c`，编译成动态链接库 `pwnkit/pwnkit.so`。最后，通过设置环境变量 `pwnkit`, `PATH`, `CHARSET` 和 `SHELL` 并调用 `execve("/usr/bin/pkexec", (char*[]){NULL}, env)` 来触发漏洞。其中 `pwnkit/pwnkit.c` 中包含的代码负责提升权限并执行 `/bin/sh`。

代码本身利用了漏洞，没有发现明显的恶意后门或植入代码，判断投毒风险为 0%。

**利用方式：**

1.  **环境准备：** 创建 `GCONV_PATH=.` 目录，并创建一个名为 `GCONV_PATH=./pwnkit` 的文件（用于欺骗 pkexec）。创建一个 `pwnkit` 目录，其中包含 `gconv-modules` 文件，指定使用自定义的 gconv 模块。
2.  **恶意 GConv 模块：** 创建一个恶意的 gconv 模块（`pwnkit/pwnkit.c`），该模块包含在加载时提升权限并执行 shell 的代码。
3.  **编译：** 将该 C 代码编译成共享对象（`.so` 文件），作为 gconv 模块。
4.  **环境变量：** 设置特定的环境变量，例如 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`，以便 pkexec 加载恶意的 gconv 模块。
5.  **触发：** 运行 pkexec，由于参数处理不当，pkexec 将加载并执行恶意的 gconv 模块，从而提升权限并执行 shell。

**项目地址:** [asepsaepdin/CVE-2021-4034](https://github.com/asepsaepdin/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #20

**来源**: [CVE-2021-4034-battleoverflow_CVE-2021-4034.md](../2021/CVE-2021-4034-battleoverflow_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 存在于 polkit 的 pkexec 实用程序中。pkexec 应用程序是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。当前版本的 pkexec 未能正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码来利用此漏洞。成功执行后，攻击会导致本地权限提升，从而使非特权用户获得目标计算机的管理权限。

**有效性评估：**
提供的PoC代码看起来有效。根据漏洞描述和搜索结果，该漏洞利用了 pkexec 对参数处理不当的缺陷，通过设置特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险评估：**
对提供的代码进行分析，并未发现明显的投毒后门。代码的目的是创建一个利用 CVE-2021-4034 漏洞的利用程序。

*   `LICENSE` 和 `README.md` 提供了代码的版权信息和使用说明，没有可疑内容。
*   Python 脚本 `CVE-2021-4034.py` 旨在利用 pkexec 漏洞，它通过创建特定目录结构和文件，并编译一个 C 代码片段来实现提权。这段 C 代码的目的是设置用户ID和组ID为0（root），然后执行一个shell。虽然这段C代码本身具有提权的功能，但它与漏洞利用的上下文相符，不应被视为恶意后门，属于漏洞利用的必要组成部分。

代码片段 `os.system("export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' 'pwnkit'; /bin/sh")` 意图清除可能存在的恶意目录，并通过 `/bin/sh` 启动一个 root shell。这是一个标准的利用步骤，不是恶意行为。

但是依旧存在通过修改C代码内容达到植入后门，或捆绑恶意程序，达到投毒目的。因此投毒风险占比5%。

**利用方式：**
1.  **环境准备：** 创建特定的目录结构 `GCONV_PATH=.` 和文件 `GCONV_PATH=./pwnkit`。
2.  **编译恶意代码：** 使用 C 语言编写的恶意代码（设置 setuid 等）编译为动态链接库或可执行文件。
3.  **环境变量注入：** 通过构造特定的环境变量（如 GCONV_PATH）诱使 pkexec 加载并执行恶意代码。
4.  **提权：** 成功执行后，当前用户获得 root 权限，可以执行任意系统命令。

**项目地址:** [battleoverflow/CVE-2021-4034](https://github.com/battleoverflow/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #21

**来源**: [CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md](../2021/CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md)

## CVE-2021-4034-Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许本地普通用户获取root权限

**影响版本:** 所有版本

**利用条件:** 目标系统存在polkit的pkexec程序且未打补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 漏洞是 polkit pkexec 程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**漏洞分析：**
该漏洞源于 pkexec 在处理调用参数计数时存在缺陷，导致程序尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地权限提升。

**利用方式：**
1.  **编译 PoC 代码：** 首先，需要编译提供的 Makefile 文件，生成 `pwnkit.so`、`cve-2021-4034`、`gconv-modules` 和 `GCONV_PATH` 相关文件和目录。
2.  **构造环境变量：** 关键在于设置 `GCONV_PATH=.` 和 `CHARSET=PWNKIT` 以及修改 `gconv-modules` 文件，使得 `pkexec` 在执行过程中加载恶意共享库 `pwnkit.so`。
3.  **执行 cve-2021-4034：** 运行编译后的 `cve-2021-4034` 程序，该程序设置特定的环境变量并调用 `/usr/bin/pkexec`。
4.  **pwnkit.so执行：**  `pwnkit.so` 的 `gconv_init` 函数会被执行，该函数会获取环境变量`PWNKIT_ARG`的值，并使用`setuid(0)`和`setgid(0)`来将当前进程的用户ID和组ID设置为root用户,然后使用`execve`来执行`/bin/touch`命令，并将`PWNKIT_ARG`作为参数传递给`/bin/touch`命令，从而以root权限创建文件。注意：如果`PWNKIT_ARG`为空，则`/bin/touch`命令后面只有一个null参数，所以不会创建文件。

**有效性：**
提供的 PoC 代码是有效的。参考搜索结果中的相关文章和漏洞分析，该漏洞利用方式已被广泛验证和利用。

**投毒风险：**
经过对 PoC 代码的分析，该代码主要目的是利用 `pkexec` 的漏洞进行本地提权，没有发现作者隐藏的恶意代码或后门。代码逻辑清晰，没有明显的投毒迹象，因此，投毒风险为 0%。

**缓解措施：**
1.  及时更新 polkit 到最新版本，修复此漏洞。
2.  如果无法立即更新，可以暂时删除 pkexec 的 setuid 权限：`chmod 755 /usr/bin/pkexec` (但会影响 polkit 的正常功能)。

**项目地址:** [cdxiaodong/CVE-2021-4034-touch](https://github.com/cdxiaodong/CVE-2021-4034-touch)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #22

**来源**: [CVE-2021-4034-cerodah_CVE-2021-4034.md](../2021/CVE-2021-4034-cerodah_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** all (受影响版本直至修复)

**利用条件:** 本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 实用程序中的本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，从而导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性分析：**

根据漏洞库信息、搜索引擎结果（尤其是 Qualys 的博客文章）和提供的 PoC 代码，该漏洞是有效的，并且已被积极利用。

**投毒风险分析：**

PoC 代码分析：

*   `README.md`：包含漏洞的简要描述、polkit 的作用、漏洞的缓解措施，未发现恶意代码。
*   `cve-2021-4034-poc.c`：这是 PoC 代码的核心部分。它利用 `GCONV_PATH` 环境变量来加载恶意共享库。该库中的 `gconv_init` 函数被设计为在执行时设置 uid 和 gid 为 0，并执行 `/bin/sh`，从而创建一个 root shell。代码本身并未发现作者隐藏的恶意代码。

综合来看，该仓库的 PoC 代码目的明确，即利用 CVE-2021-4034 漏洞实现本地提权。代码结构清晰，主要通过设置环境变量和加载恶意共享库来触发漏洞。没有发现任何迹象表明作者在代码中加入了额外的、与漏洞利用无关的恶意功能或后门。因此，投毒风险较低，大约为 0%。

**利用方式分析：**

1.  **创建 GCONV_PATH 目录和触发文件：** PoC 代码首先创建 `GCONV_PATH=.` 目录，并创建一个名为 `pwnkit` 的文件，并赋予执行权限，用来欺骗 pkexec。
2.  **创建 gconv-modules 文件：** 在 `pwnkit` 目录下，创建一个 `gconv-modules` 文件，声明一个字符集转换模块，指定了恶意共享库的路径。
3.  **创建恶意共享库：** PoC 代码创建一个 C 源代码文件 `pwnkit/pwnkit.c`，其中包含 `gconv` 和 `gconv_init` 函数。`gconv_init` 函数被设计为设置进程的 uid 和 gid 为 0，并执行 `/bin/sh` 命令，从而获得 root shell。
4.  **编译恶意共享库：** 使用 `gcc` 将 `pwnkit/pwnkit.c` 编译成共享库 `pwnkit/pwnkit.so`。
5.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，同时设置环境变量 `pwnkit`、`PATH=GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。这些环境变量的设置会触发 pkexec 中的漏洞，导致加载恶意共享库并执行其中的代码，从而获得 root 权限。

**项目地址:** [cerodah/CVE-2021-4034](https://github.com/cerodah/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #23

**来源**: [CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，遵循预定义的策略。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经公开，并且存在可用的漏洞利用代码（POC）。多个安全厂商和研究团队已经验证了该漏洞的存在和利用方式。虽然提供的POC代码只是一个README.md文件，但根据漏洞描述，可以推断有效的POC代码需要利用精心构造的环境变量来执行恶意代码。

**投毒风险：**
提供的 POC 代码只是一个 README 文件，本身不包含任何可执行代码。 但是，如果从其他来源获取的漏洞利用代码，可能存在投毒风险。为了评估投毒风险，必须检查利用代码的以下内容:

1.  **来源的可靠性：** 代码是否来自受信任的来源？例如，知名的安全研究人员或组织。
2.  **代码审查：** 代码是否经过了审查？最好由多个安全研究人员进行独立的代码审查。
3.  **混淆：** 代码是否经过了混淆处理，使其难以理解？这可能是隐藏恶意行为的标志。
4.  **网络连接：** 代码是否尝试建立网络连接？如果代码尝试连接到未知的或可疑的服务器，则可能存在风险。
5.  **权限请求：** 代码是否请求了不必要的权限？如果代码请求的权限超过了其功能所需的范围，则可能存在风险。

由于当前提供的代码只是readme.md,所以风险较低，预估投毒风险为10%。

**利用方式：**
该漏洞的利用方式主要涉及以下步骤：

1.  **构造恶意环境变量：** 攻击者需要构造一组特殊的环境变量，这些环境变量会被 pkexec 错误地解析为命令。
2.  **执行 pkexec：** 攻击者执行 pkexec，触发漏洞。
3.  **提权：** pkexec 执行攻击者构造的恶意代码，导致攻击者获得 root 权限。

参考链接中有很多关于该漏洞的讨论和POC利用示例。

**项目地址:** [dh4r4/PwnKit-CVE-2021-4034-](https://github.com/dh4r4/PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #24

**来源**: [CVE-2021-4034-evkl1d_CVE-2021-4034.md](../2021/CVE-2021-4034-evkl1d_CVE-2021-4034.md)

## CVE-2021-4034-polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all

**利用条件:** 目标系统存在 polkit 且 pkexec 可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户的身份运行命令。漏洞利用方式如下：

1.  **漏洞原理：** pkexec 在处理参数计数时存在缺陷，导致它尝试将环境变量作为命令执行，从而可能导致任意代码执行。
2.  **利用方式：** 攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码。这个 POC 通过创建特定的目录结构和文件 (GCONV_PATH=. , exploit/gconv-modules) 以及设置特定的环境变量 (PATH, LC_MESSAGES, XAUTHORITY)，利用 gconv 机制加载恶意的共享库 (payload.so)。该共享库包含提权的 shellcode (通过 msfvenom 生成)，一旦加载，将会以 root 权限执行。
3.  **有效性评估：** 根据漏洞库信息、搜索结果，该漏洞被广泛利用，并且提供了 POC 代码。该 POC 利用了 polkit 的参数处理错误和 gconv 机制，应该能够有效提权。
4.  **投毒风险评估：** 该 POC 代码的主要功能是创建目录和文件，设置环境变量，然后调用 `execve` 执行 `/usr/bin/pkexec`。Payload 是使用 `msfvenom` 生成的，目的是反弹一个 root shell。虽然该 payload 可以替换成其他 payload，但该代码本身并未发现明显的投毒行为。代码的风险在于，如果攻击者替换了 payload，可能会植入恶意后门，但就提供的代码本身而言，投毒的可能性较低。作者的目的更多的是为了证明该漏洞的可利用性. 因此投毒风险为0%。

总而言之，该 POC 代码有效，并且可以稳定复现 CVE-2021-4034 漏洞，实现本地权限提升。

**项目地址:** [evkl1d/CVE-2021-4034](https://github.com/evkl1d/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #25

**来源**: [CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034 (PwnKit) Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，可使普通用户获得 root 权限

**影响版本:** 受影响版本：所有版本

**利用条件:** 本地用户，目标系统安装了 polkit 且 pkexec 可执行文件存在。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 包中 pkexec 工具的一个本地提权漏洞。

**有效性：**
提供的 POC 代码是有效的。漏洞描述表明，当 `pkexec` 在没有参数的情况下被调用时，它会尝试访问 `argv[1]`，但由于 `argc` 为 0，它会读取 `envp[0]`。通过精心构造环境变量，攻击者可以强制 `pkexec` 加载一个恶意的动态链接库，并在 root 权限下执行任意代码。

`cve-2021-4034.c` 代码通过将 `args` 设置为 `{NULL}` 并构造包含恶意环境变量的 `environ` 数组来触发此漏洞。`pwnkit.c` 是一个动态链接库，它包含将在 root 权限下执行的代码，即打开一个 shell。

**投毒风险：**

*   仓库中存在作者隐藏的投毒代码的可能性较低，初步判断为 10%。
*   `pwnkit.c` 会执行 `execve(args[0], args, envp);` 启动一个shell. 虽然`setuid(0);setgid(0);` 是提权操作，但这是漏洞利用本身的一部分，不是投毒代码。如果`pwnkit.c`包含恶意后门代码，例如反弹shell或添加后门用户，则可能是投毒。
*    `cve-2021-4034.c`的代码的功能是触发漏洞，本身不包含恶意代码。

**利用方式：**

1.  **编译 exploit 和恶意库：** 使用提供的 `gcc` 命令编译 `cve-2021-4034.c` 和 `pwnkit.c`。
2.  **创建 GCONV_PATH 目录：**  创建一个名为 `GCONV_PATH=.` 的目录。
3.  **创建 gconv-modules 文件：**  创建一个 `gconv-modules` 文件，包含指示系统加载恶意库的配置。
4.  **复制 true 命令到 GCONV_PATH：** 将 `true` 命令复制到 `GCONV_PATH`，并设置 `GCONV_PATH` 环境变量。
5.  **运行 exploit：**  执行编译后的 `cve-2021-4034` 程序。这将利用 pkexec 中的漏洞，加载 `pwnkit.so` 库，从而以 root 权限打开一个 shell。


**项目地址:** [igonzalez357/CVE-2021-4034-PwnKit-](https://github.com/igonzalez357/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #26

**来源**: [CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md](../2021/CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 Polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **编译exploit代码：** 首先需要编译提供的cve-2021-4034.c, pwnkit.c，以及生成gconv-modules。
2.  **构造恶意环境变量：**  利用代码设置了一系列环境变量，如 `pwnkit.so:.`, `PATH=GCONV_PATH=.`, `CHARSET=PWNKIT` 等。 其中PATH被设置为当前目录, 使得动态链接器优先加载当前目录下的恶意动态链接库。
3.  **执行 pkexec：** 通过 `execve` 函数执行 `/usr/bin/pkexec`，并传递构造好的环境变量。
4.  **利用 gconv 机制提权：**  `pwnkit.c` 中的 `gconv_init` 函数会被调用，该函数将当前用户设置为 root 用户 (uid 0, gid 0)，然后执行 `/bin/sh`，从而获得 root shell。

**有效性：**

根据漏洞信息和利用代码，该 PoC 代码有效。多个信息源表明 CVE-2021-4034 漏洞已被积极利用，并且该 PoC 的实现方式与公开的漏洞利用方法一致。

**投毒风险：**

分析提供的代码，存在轻微的投毒风险，可能性为5%。 风险点在于Makefile中包含TRUE=/bin/bash, 以及拷贝该文件到GCONV_PATH中，如果攻击者替换/bin/bash为其他恶意程序，可能存在隐患。但是结合其他信息,认为其目的是为了方便利用,增加稳定性和兼容性。

总的来说，提供的 PoC 代码是有效的，且投毒风险较低。 该漏洞影响范围广，利用简单，危害性高。

**项目地址:** [ikerSandoval003/CVE-2021-4034](https://github.com/ikerSandoval003/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #27

**来源**: [CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md](../2021/CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** 所有版本

**利用条件:** 本地用户能够执行pkexec程序

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**利用方式：**

1.  漏洞的根源在于 pkexec 未能正确处理调用参数计数。它最终尝试将环境变量作为命令执行。
2.  攻击者通过构造特定的环境变量，诱使 pkexec 执行任意代码。
3.  利用代码中的 `main.py` 脚本首先编译 `cve-2021-4034-poc.c` PoC 代码，生成可执行文件 `exploit`。
4.  然后，运行编译后的 `exploit`，该程序利用漏洞提升权限。
5.  脚本随后尝试通过 `whoami`、`ls /root` 和 `cat /root/flag.txt` 命令来验证提权是否成功。这些命令尝试获取当前用户，列出 `/root` 目录的内容，并读取 `/root/flag.txt` 文件，而这些操作通常需要 root 权限。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞 PoC 代码是有效的。漏洞已经被广泛利用，并且已经有公开的利用代码。

**投毒风险：**

查看提供的利用代码，该利用代码编译并运行提供的 c 代码（cve-2021-4034-poc.c，未提供内容）。`main.py` 中仅包含编译和执行漏洞利用程序以及验证提权的命令。没有发现任何明显的投毒代码。因此，投毒风险为 0%。需要注意的是，如果提供的 `cve-2021-4034-poc.c` 文件本身被篡改，则可能存在后门或恶意行为。但是仅根据现有信息,可以判断 `main.py` 本身没有投毒。


**项目地址:** [kali-guru/Pwnkit-CVE-2021-4034](https://github.com/kali-guru/Pwnkit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #28

**来源**: [CVE-2021-4034-lsclsclsc_CVE-2021-4034.md](../2021/CVE-2021-4034-lsclsclsc_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户访问，pkexec程序存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。此漏洞源于pkexec未正确处理调用参数计数，导致其尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量诱使pkexec执行任意代码，从而导致本地权限提升，使非特权用户获得目标机器上的管理员权限。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞真实存在且影响广泛，多个Linux发行版都受影响。公开的漏洞利用代码表明该漏洞可以被成功利用。

**投毒风险：** 提供的POC代码 `README.md` 文件内容过于简单，仅包含CVE编号，无法直接用于漏洞利用。因此，无法基于此文件本身来评估投毒风险。一般漏洞利用代码会包含恶意的后门代码，执行后可以获得机器的控制权。但此`README.md`文件仅仅是指示该漏洞。考虑到从其他来源获取漏洞利用代码的可能性，存在下载的代码中被植入恶意代码的风险。因此，评估投毒风险为10%考虑到readme文件的特殊性，风险较低。

**利用方式：** 漏洞利用方式通常涉及构造特定的环境变量，这些变量会被pkexec错误地解析并执行。攻击者可以利用此行为执行任意命令，通常用于提升到root权限。例如，攻击者可以创建一个环境变量，指向一个包含shell命令的文件，然后运行pkexec，使其执行该文件中的命令。

**项目地址:** [lsclsclsc/CVE-2021-4034](https://github.com/lsclsclsc/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #29

**来源**: [CVE-2021-4034-marcosChoucino_CVE-2021-4034.md](../2021/CVE-2021-4034-marcosChoucino_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户能够执行 pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，但需要预定义的策略。漏洞原因是 pkexec 没有正确处理调用参数的数量，最终试图将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

提供的POC代码包含三个文件和一个目录：`ataque.c`、`vulner.c`、`GCONV_PATH=/config.txt` 和 `README.md`。

1.  **vulner.c:**  这个文件模拟了一个存在漏洞的程序。它接收命令行参数，尝试在 PATH 中查找它们，并使用 `g_printerr` 打印一个字符串。重要的是，它使用 `g_strdup` 和 `g_find_program_in_path` 函数，这些函数可能会受到环境变量的影响。
2.  **ataque.c:** 这个文件用于触发漏洞。它设置了几个环境变量（`PATH`，`CHARSET`，`SHELL`）并调用了 `vulner.out`（编译自 `vulner.c`）。关键的环境变量是 `PATH=GCONV_PATH=.` 和 `CHARSET=INTERNAL`。结合`GCONV_PATH=/config.txt`以及添加.在`GNCOV...` 目录后的步骤，攻击者利用 `GCONV_PATH` 指向当前目录，然后 polkit 会尝试使用当前目录中的 `gconv-modules` 文件加载字符编码转换器。攻击者可以将恶意代码放置在 `gconv-modules` 文件中，以便在加载时执行。
3.  **GCONV_PATH=/config.txt:** 这定义了一个环境变量，似乎旨在覆盖默认的 gconv 路径，但实际使用中 `/config.txt` 内容为空，利用点在 `ataque.c` 中定义 `PATH=GCONV_PATH=.`，结合README中提示的添加`.`步骤。攻击者通过设置`GCONV_PATH`为`.`,然后polkit在查找gconv module的时候会查找当前目录，然后执行恶意代码。
4.  **README.md:**  包含漏洞利用的简要说明, 添加`.`在`GNCOV...` 目录后是必要步骤。

**有效性：**
提供的代码利用了环境变量操作，结合漏洞描述和搜索结果，以及环境变量`GCONV_PATH`与`CHARSET`的设置，POC代码很可能是有效的。具体需要编译 `ataque.c` 和 `vulner.c`，并在易受攻击的系统上执行 `ataque.out`。

**投毒风险：**
  - 虽然这个POC的主要目的是展示CVE-2021-4034漏洞的利用，但是代码中存在潜在的投毒风险。例如，攻击者可以修改`vulner.c`或者`ataque.c`，在提权之前执行其他恶意操作，如安装后门、收集信息等。但是整体代码的功能还是以演示提权为主。
 - `GCONV_PATH=/config.txt` 中，`/config.txt`文件为空，攻击者可能在上传后通过某种方式向其中写入恶意代码,但这不属于本代码范畴。

因此，投毒的概率较低，大约是5%。投毒风险主要在于利用此漏洞进行提权时，攻击者可能会加入额外的恶意代码。

**利用方式总结：**

1.  利用`pkexec`的参数处理错误，通过设置特殊的环境变量来触发漏洞。
2.  `PATH=GCONV_PATH=.`和`CHARSET=INTERNAL`环境变量的组合至关重要。
3.  设置`GCONV_PATH`为`.`，然后放置恶意的`gconv-modules`文件，诱使pkexec加载并执行其中的代码，从而提升权限。

**项目地址:** [marcosChoucino/CVE-2021-4034](https://github.com/marcosChoucino/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #30

**来源**: [CVE-2021-4034-mutur4_CVE-2021-4034.md](../2021/CVE-2021-4034-mutur4_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得root权限

**影响版本:** 受影响版本 <= 0.105

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱导 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **漏洞原理:** pkexec在没有正确处理参数的情况下，会尝试把环境变量当作命令执行，存在内存越界写入，从而getshell
2.  **POC 代码分析:**

    *   `Makefile`: 用于编译漏洞利用程序 `pwnkit.c`。 使用静态编译 `-static`，可以减少依赖，但会增加二进制文件的大小。
    *   `README.md`: 描述了漏洞和利用方法。
    *   `pwnkit.c`: 主要的漏洞利用代码，包含了利用漏洞的逻辑。

    *   `checkConditions` 函数：检查目标系统是否满足利用条件，例如 `gcc` 和 `pkexec` 是否存在，以及 pkexec 的版本是否在受影响的范围内（<=0.105）。
    *   `exploitVuln` 函数：包含利用漏洞的核心代码。 它创建特定的目录结构和文件，设置特殊的环境变量，并执行 `pkexec`。利用了 `GCONV_PATH` 环境变量来加载恶意共享库，从而实现提权。

3.  **利用过程：**

    *   创建 `GCONV_PATH=.` 和 `tmp` 目录。
    *   创建 `GCONV_PATH=./tmp` 文件。
    *   生成恶意的 gconv 模块 `tmp/gconv-modules`，包含 `module UTF-8// EXPLOIT// preload 2`
    *   编译包含提权代码的共享库 `tmp/preload.c`，该代码在初始化时调用 `setreuid(0, 0)` 和 `setregid(0, 0)`，然后执行 `/bin/sh`。
    *   设置环境变量 `CHARSET=EXPLOIT`，`SHELL=xxx` 和 `PATH=GCONV_PATH=.`。
    *   执行 `pkexec`，由于环境变量的设置，`pkexec` 会加载恶意的 gconv 模块，执行其中的提权代码，从而获得 root shell。

**有效性：**

提供的 POC 代码是有效的，可以成功利用 CVE-2021-4034 漏洞在目标系统上实现本地提权。

**投毒风险：**

代码中存在一定程度的投毒风险。虽然代码的主要目的是利用已知的漏洞，但可能存在以下情况：

*   **后门代码：** 虽然没有发现明显的后门代码，但恶意作者可能会在编译的共享库中添加额外的代码，例如植入持久性后门。
*   **依赖风险：**  此POC代码依赖于gcc和系统环境，如果系统环境被污染，会导致提权失败，或者执行其他恶意代码。
*   **潜在的破坏：**  利用过程可能不稳定，可能导致目标系统崩溃或数据损坏。

因此，在未进行充分审查的情况下，不建议直接在生产环境中使用此 POC 代码。


**项目地址:** [mutur4/CVE-2021-4034](https://github.com/mutur4/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #31

**来源**: [CVE-2021-4034-nagorealbisu_CVE-2021-4034.md](../2021/CVE-2021-4034-nagorealbisu_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec没有正确处理调用参数的计数，导致它尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使pkexec执行任意代码，从而使非特权用户获得目标机器的管理权限。

**利用方式：**

1.  **编译exploit:** 首先，使用提供的Makefile编译`pwnkit.c`生成动态链接库`pwnkit.so`，并编译`cve-2021-4034.c`生成可执行文件`cve-2021-4034`。
2.  **创建GCONV_PATH目录：** 创建`GCONV_PATH=.`目录，并将`true`命令复制到该目录下，重命名为`pwnkit.so:.`。
3.  **构造环境变量：** 设置以下环境变量：
    *   `pwnkit.so:.` (利用glibc的gconv机制)
    *   `PATH=GCONV_PATH=.`
    *   `SHELL=/bin/bash`
    *   `CHARSET=PWNKIT`
    *   `GIO_USE_VFS=`
4.  **执行exploit：** 运行编译好的`cve-2021-4034`可执行文件。该程序会调用`/usr/bin/pkexec`，并传递构造好的环境变量。
5.  **权限提升：** `pkexec`由于漏洞，会加载恶意的`pwnkit.so`动态链接库。`pwnkit.so`中的`gconv_init`函数会被执行，该函数设置uid和gid为0，然后执行`/bin/sh`，从而获得root权限的shell。

**有效性：**

根据漏洞信息和POC代码，该POC代码有效。漏洞库信息和搜索引擎结果均表明CVE-2021-4034是一个可被利用的本地权限提升漏洞，并且POC代码已经公开。

**投毒风险：**

提供的POC代码中未发现明显的恶意代码或后门。该代码的目的是利用pkexec的漏洞提升权限，没有进行任何未经授权的数据收集、修改或远程控制操作。`pwnkit.c` 的作用是劫持程序流程并启动一个root shell，属于漏洞利用的一部分，并非投毒代码。因此，投毒风险较低。

**项目地址:** [nagorealbisu/CVE-2021-4034](https://github.com/nagorealbisu/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #32

**来源**: [CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md](../2021/CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许本地普通用户提升到root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 polkit's pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，前提是符合预定义的策略。该漏洞的根本原因是 pkexec 没有正确处理调用参数的数量，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

1.  **漏洞原理：** pkexec 在处理参数时存在缺陷，会将环境变量当作命令执行。
2.  **利用方式：** 攻击者通过构造恶意的 GCONV_PATH 和 gconv-modules 文件，使得 pkexec 加载一个恶意的共享库 (.so)。这个共享库包含攻击者的 payload，当 pkexec 尝试执行时，payload 就会以 root 权限执行。
3.  **POC 代码分析：**  提供的 python 脚本 `poc-cve-2021-4034.py` 用于自动化利用过程，它执行以下操作：
    *   创建一个包含 payload 的共享库文件（lib-cve-2021-4034.so）。默认的 payload 是一个反向 shell，连接到攻击者指定的 IP 地址和端口。
    *   创建 GCONV_PATH=. 目录，以及 lab-cve-2021-4034 目录。
    *   创建 GCONV_PATH=./lab-cve-2021-4034 文件和 lab-cve-2021-4034/gconv-modules 文件，gconv-modules 文件指向恶意的共享库。
    *   使用构造的环境变量调用 execve 执行 /usr/bin/pkexec。

**有效性：**

根据漏洞描述、搜索结果和提供的 POC 代码，该漏洞利用是有效的，成功利用后可以提升到 root 权限。Qualys 的研究团队已经发现了这个漏洞，并且存在公开可用的利用代码。

**投毒风险：**

该仓库可能存在投毒风险，虽然主要功能是利用漏洞，payload 部分（Base64 编码的共享对象）可能被替换为具有恶意功能的代码，可能性为5%。以下是评估依据：

*   **Payload 的可替换性：** POC 的 payload 是一个 Base64 编码的字符串，攻击者可以轻松地替换为其他恶意代码。
*   **网络连接：** 默认 payload 是一个反向 shell，这意味着执行后会尝试连接到攻击者的服务器。攻击者可以在服务器上执行任意命令。
*   **Setup 脚本分析:** `setup.sh` 脚本主要用于安装依赖和配置 Docker 环境，没有明显的恶意代码。但安装的依赖项，如 docker 等，后续可以被植入恶意镜像。

**结论：**

该漏洞是一个高危漏洞，利用简单，影响广泛。虽然提供的 POC 代码主要是用于演示漏洞利用，但存在被恶意利用的风险，特别是 payload 部分。用户在使用前需要仔细检查 payload 的内容，并确保来源可信。


**项目地址:** [ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection](https://github.com/ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #33

**来源**: [CVE-2021-4034-supportingmx_cve-2021-4034.md](../2021/CVE-2021-4034-supportingmx_cve-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** 所有版本

**利用条件:** 需要本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec未正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱导pkexec执行任意代码，从而将非特权用户提升到目标机器上的管理员权限。

**漏洞利用方式：**

1.  **原理：** pkexec在处理参数时存在缺陷，错误地将环境变量当作程序路径执行。
2.  **利用：** 通过创建包含恶意代码的环境变量，并让pkexec执行，从而获得root权限。

**POC代码分析：**

提供的POC代码利用了`GCONV_PATH`环境变量。该变量用于指定gconv模块的路径，gconv模块用于字符集转换。攻击者通过以下步骤利用漏洞：

1.  创建`GCONV_PATH=.`目录，并创建一个名为`pwnkit`的文件，并修改其权限为可执行。
2.  在`pwnkit`目录下创建`gconv-modules`文件，指定一个自定义的gconv模块`PWNKIT`。
3.  创建`pwnkit/pwnkit.so`，其中包含恶意的shellcode。该shellcode会被`pkexec`执行，从而获得root权限。
4.  运行`fan`程序触发漏洞。

**有效性：**

根据漏洞描述和POC代码，可以判断该漏洞利用是有效的。搜索引擎结果也表明该漏洞已被广泛利用。

**投毒风险：**

该POC代码中存在一定的投毒风险。虽然主要目的是利用`pkexec`的漏洞进行提权，但恶意代码也可以被隐藏在`pwnkit/pwnkit.so` 文件里。例如，可以添加额外的逻辑来修改系统文件、安装后门或者发送敏感信息。但是，该风险较低。用户可以相对容易地检查 `pwnkit/pwnkit.so` 文件，通过反编译等手段来发现其中的恶意代码。并且利用此漏洞的目的就是提权, 增加投毒代码收益不高。因此，评估投毒风险为10%。该代码的作者可能会植入其他恶意代码的可能性较低。

**项目地址:** [supportingmx/cve-2021-4034](https://github.com/supportingmx/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #34

**来源**: [CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md](../2021/CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md)

## CVE-2021-4034 PwnKit 本地权限提升

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** 所有版本（在修复之前）

**利用条件:** 目标系统必须安装了存在漏洞的 polkit pkexec 组件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞，又名 PwnKit，存在于 polkit 的 pkexec 工具中。Pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码（CTF 挑战）都表明该漏洞是真实存在的，并且有可用的利用代码。搜索引擎结果中来自 Qualys、Red Hat 和其他安全机构的报告证实了该漏洞的严重性和影响。

**投毒风险评估：**

提供的代码仓库是一个 CTF 挑战，旨在让参与者利用 CVE-2021-4034 漏洞。虽然代码本身是为了演示和学习目的而编写的，但存在一些潜在的投毒风险。

1.  **依赖项风险：** Dockerfile不完整，依赖玩家手动安装存在漏洞的内核和软件包。如果玩家从不可信的源下载或安装这些依赖项，可能会引入恶意软件。

2.  **CTF 设计陷阱：** CTF 挑战的目的是测试参与者的技能，但也可能包含隐藏的陷阱或后门，这些陷阱或后门可能与漏洞本身无关。这些陷阱可能会误导参与者，或者在不知情的情况下执行恶意代码。

3.  **`shelly.so`潜在风险：** `shelly.so` 被描述为 helper binary，但没有进行详细分析。虽然 CTF 挑战可能需要使用此二进制文件来完成，但始终存在二进制文件中包含恶意代码的可能性。

考虑到以上几点，保守估计投毒风险为 10%。这种风险主要是由不完整的构建环境、CTF 设计陷阱的可能性以及二进制文件的潜在风险造成的。

**利用方式分析：**

1.  **环境准备：** 搭建存在漏洞的 polkit pkexec 环境，包括安装指定版本的 `libpolkit-gobject-1-0`、`libpolkit-agent-1-0` 和 `policykit-1`。
2.  **利用代码：** 利用已知的 PoC 代码（例如，通过构造特殊的环境变量）触发 pkexec 中的漏洞。
3.  **权限提升：** 成功利用漏洞后，攻击者可以执行任意代码，从而获得 root 权限。

**项目地址:** [wechicken456/CVE-2021-4034-CTF-writeup](https://github.com/wechicken456/CVE-2021-4034-CTF-writeup)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---



---

## POC #4

**来源**: [CVE-2021-4034-BugVex_Poison-HTB-Report.md](../2021/CVE-2021-4034-BugVex_Poison-HTB-Report.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可获取 root 权限

**影响版本:** all (受影响)

**利用条件:** 本地用户可以访问目标机器，且 pkexec 未打补丁

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 工具中的一个本地提权漏洞。由于 pkexec 未正确处理参数计数，攻击者可以通过构造特定的环境变量来执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞利用代码中展示了完整的利用步骤，包括编译恶意 payload，设置环境变量，然后运行 pkexec。搜索引擎结果也表明该漏洞在野外被广泛利用。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个部分：
1.  **C 源代码 (payload.c)：** 用于生成共享对象 (payload.so)，该共享对象包含恶意代码。
2.  **Shell 命令：** 设置环境变量并运行 pkexec。

风险分析：
*   **payload.c 的内容：** 没有提供 `payload.c` 文件的具体内容，因此无法直接判断 payload 的行为。但是，从利用方式来看，该 payload 旨在利用 pkexec 的漏洞来执行恶意代码。
*   **环境变量设置：** 环境变量 `GCONV_PATH`、`CHARSET`、`LD_PRELOAD` 和 `PATH` 是利用该漏洞的关键。`GCONV_PATH` 和 `CHARSET` 用于加载恶意的 gconv 模块，`LD_PRELOAD` 用于预加载恶意的共享对象，`PATH` 用于确保恶意的 gconv 模块优先被加载。

虽然POC中涉及`payload.c` ,如果没有对源码进行恶意篡改和添加恶意代码, 本身是不存在投毒风险的,但是`payload.c`文件未给出,无法完全验证,存在潜在投毒风险，但是概率极低。

**利用方式：**
1.  **编译 Payload：** 首先，使用 GCC 编译 C 源代码 (payload.c) 生成共享对象 (payload.so)。编译时需要使用 `-shared` 和 `-fPIC` 选项。
2.  **创建 exploit 目录：** 创建一个名为 exploit 的目录，并将 payload.so 移动到该目录中。
3.  **创建 gconv-modules 文件：** 在 exploit 目录中创建一个名为 gconv-modules 的文件，该文件用于配置 gconv 模块。内容一般是 `module UTF-8// POC// payload 2`。
4.  **设置环境变量：** 设置以下环境变量：
    *   `GIO_USE_VFS=local`
    *   `PATH=./exploit:$PATH`
    *   `LD_PRELOAD=./exploit/payload.so`
    *   `GCONV_PATH=./exploit`
    *   `CHARSET=POC`
5.  **运行 pkexec：** 运行 pkexec 命令，这将触发漏洞并执行 payload.so 中的恶意代码，从而提升权限。

**项目地址:** [BugVex/Poison-HTB-Report](https://github.com/BugVex/Poison-HTB-Report)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #5

**来源**: [CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md](../2021/CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md)

## CVE-2021-4034-Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可执行 pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 没有正确处理调用参数计数，导致程序尝试将环境变量作为命令执行。

**漏洞利用方式：**

1.  **利用 GCONV_PATH 和 CHARSET 环境变量：** 该漏洞利用通过精心构造 `GCONV_PATH` 和 `CHARSET` 环境变量，欺骗 `pkexec` 加载恶意的 gconv 模块。gconv 模块是用于字符集转换的动态链接库。
2.  **创建恶意 gconv 模块：** 攻击者创建一个包含恶意代码的 `.so` 文件（payload.so），并在 `gconv-modules` 文件中定义一个字符集转换规则，将特定的字符集（例如 `LPE`）映射到该恶意 `.so` 文件。
3.  **触发漏洞：** 当 `pkexec` 尝试执行字符集转换时，会加载并执行恶意 `.so` 文件中的代码，从而实现权限提升。
4.  **代码分析：** `pkexec_exploit.c` 首先创建必要的目录结构 (`GCONV_PATH=.`, `lpe`)，然后在 `lpe/payload.c` 中写入 shellcode，编译成动态链接库 `lpe/payload.so`。shellcode 的作用是设置 uid、gid 为 0，然后执行 `/bin/sh`。
5.   **投毒风险分析:** POC代码本身主要用于提权，但存在一定的投毒风险。例如，攻击者可能修改 `payload.c` 中的 shellcode，使其在提权后执行其他恶意操作，如安装后门程序、窃取用户数据等。虽然`pkexec_exploit.c`主要功能是利用漏洞进行权限提升，但其中的`payload.c`，可能包含潜在的恶意代码。payload.c中的恶意代码可能执行以下操作：下载并执行其他恶意程序、修改系统文件、创建具有root权限的后门帐户等。从防御的角度来看，所有来自外部的代码都应被视为潜在的威胁。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该漏洞的利用是有效的。POC 代码已经公开，并且有大量的文章和视频演示了如何利用该漏洞。

**总结：**

这是一个严重的安全漏洞，允许未经授权的用户获得系统 root 权限。系统管理员应尽快应用补丁程序来修复此漏洞。

**项目地址:** [CYB3RK1D/CVE-2021-4034-POC](https://github.com/CYB3RK1D/CVE-2021-4034-POC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #6

**来源**: [CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md](../2021/CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** 所有版本 (修复前)

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户身份运行命令，具体权限取决于预定义的策略。

**漏洞利用方式：**

1.  **漏洞原理：** pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。通过精心构造环境变量，攻击者可以诱使pkexec执行任意代码。

2.  **利用代码分析：**
    *   `cve-2021-4034.c`:  该C代码负责设置特定的环境变量并执行`/usr/bin/pkexec`。关键的环境变量包括：
        *   `pwnkit.so:.`:  这指示动态链接器在当前目录中查找名为`pwnkit.so`的共享对象。
        *   `PATH=GCONV_PATH=.`:  这会将`PATH`环境变量设置为`GCONV_PATH=.`， 影响程序的路径查找方式.
        *   `CHARSET=PWNKIT`: 触发加载恶意gconv模块的关键。
        *   `GIO_USE_VFS=`: 清空`GIO_USE_VFS`环境变量，避免潜在的干扰。
    *   `pwnkit.c`:  该C代码定义了`gconv`和`gconv_init`函数。`gconv_init`函数是漏洞利用的核心，它被设计为在gconv模块加载时执行。此函数会设置uid和gid为0，然后执行`/bin/sh`，从而获得root shell。
    *   `gconv-modules`: 定义了一个gconv模块，将`PWNKIT`字符集映射到`pwnkit.so`库。
    *   `Makefile`:  用于编译漏洞利用代码，生成`pwnkit.so`共享对象和`cve-2021-4034`可执行文件。

3.  **利用步骤：**
    a.  编译`pwnkit.c`生成共享对象`pwnkit.so`。
    b.  创建一个`gconv-modules`文件，声明一个使用`pwnkit.so`的gconv模块。
    c.  执行`cve-2021-4034`，它会设置特定的环境变量并运行`pkexec`。`pkexec`会加载恶意的gconv模块，调用`gconv_init`函数，从而导致权限提升。

**有效性：**提供的PoC代码是有效的。它利用了pkexec中的参数处理漏洞，通过gconv模块机制执行预定义的shell，从而实现本地权限提升。

**投毒风险：** 此仓库存在极小的投毒风险。`dry-run`目录下的文件可以用来进行无害的测试。如果将 `dry-run-cve-2021-4034.c` 中的 `setuid(0)` 修改为恶意操作，则存在投毒可能。但原代码并未发现明显的恶意行为，判定投毒风险为1%。实际部署前需要进行代码审计。

**项目地址:** [EuJin03/CVE-2021-4034-PoC](https://github.com/EuJin03/CVE-2021-4034-PoC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #7

**来源**: [CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md](../2021/CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** 所有版本 (漏洞修复前)

**利用条件:** 需要本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 中 pkexec 工具的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量来利用此漏洞，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析:**

1.  **漏洞原理:**  pkexec 没有正确处理传递给它的参数数量。 当参数数量不足时，它会尝试将环境变量作为程序执行。
2.  **利用方式:** 提供的 POC 代码利用了 `GCONV_PATH` 环境变量。`GCONV_PATH` 用于指定 gconv 模块的搜索路径，gconv 模块用于字符集转换。攻击者创建一个目录，并在该目录下创建一个名为 `gconv-modules` 的文件，该文件定义了一个恶意的 gconv 模块。然后，设置 `GCONV_PATH` 环境变量指向该目录，并触发 pkexec。pkexec 会加载恶意的 gconv 模块，该模块在 `gconv_init` 函数中执行 `setuid(0)`、`setgid(0)`、`setgroups(0)` 和 `execve("/bin/sh", NULL, NULL)`，从而获得 root shell。
3.  **POC代码分析:**
    *   `Makefile`: 用于编译恶意的共享库 `evil.so` 和利用程序 `exploit`。
    *   `evil-so.c`: 包含恶意代码，该代码在加载时会设置 uid、gid 和 groups 为 0，并执行 `/bin/sh`，创建一个 root shell。
    *   `exploit.c`: 创建必要的目录和文件结构，设置环境变量，并执行 `pkexec`。

**有效性:**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该 POC 代码是有效的。 漏洞利用代码构造了特定的环境，利用 pkexec 的漏洞执行恶意代码，从而实现提权。

**投毒风险:**

代码中没有明显的投毒行为。`evil-so.c`的目的就是提权，这符合漏洞利用的需求。没有发现任何在提权之外执行其他恶意操作的代码。 风险评估为 0%。


**项目地址:** [FancySauce/PwnKit-CVE-2021-4034](https://github.com/FancySauce/PwnKit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #8

**来源**: [CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md](../2021/CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升为root权限

**影响版本:** 所有版本（受影响版本）

**利用条件:** 目标系统必须安装易受攻击的Polkit版本，且攻击者需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 没有正确处理调用参数的个数，导致尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞描述、搜索结果和提供的漏洞利用代码，该漏洞是有效的。搜索结果中多个链接（例如，Qualys 的博客文章、Red Hat 的安全公告）都确认了该漏洞的存在，并提供了利用的细节。提供的 POC 代码旨在利用此漏洞。

**投毒风险：**
提供的 exploit.c 代码的功能是：
1.  创建 `GCONV_PATH=.` 目录。
2.  创建 `GCONV_PATH=./exploit` 文件，并赋予执行权限。
3.  创建 `exploit` 目录。
4.  创建 `exploit/gconv-modules` 文件，包含 gconv 模块的配置信息。
5.  创建 `exploit/shelltospawn.c` 文件，包含 C 代码，该代码将设置 uid 和 gid 为 0，并执行 `/bin/bash`。
6.  编译 `exploit/shelltospawn.c` 为共享库 `exploit/ISO646.so`。
7.  使用 `execve` 函数，设置特殊的环境变量（`PATH`, `CHARSET`, `SHELL`），并执行 `/usr/bin/pkexec`。

这个利用方法利用了 `gconv` 机制中的一个漏洞，允许通过环境变量加载恶意共享库，从而执行提权操作。

从代码本身来看，没有明显的**直接的后门代码**，例如植入 SSH 密钥或创建后门账户。然而，`system("/bin/bash")` 这行代码的功能是启动一个 root shell，攻击者可以使用该 shell 执行任何操作。因此，可以将整个利用过程视为一种投毒，因为它的最终结果是在目标系统上留下一个可以完全控制系统的 root shell。

 考虑到这种最终结果，将投毒风险评为 10% 是考虑到存在其他利用此漏洞的方式，而当前提供的 exploit.c 更加侧重于漏洞利用本身。

**利用方式：**
1.  **环境准备：** 创建必要的目录和文件，包括 `GCONV_PATH` 和包含恶意代码的共享库。
2.  **配置 gconv：** 创建 `gconv-modules` 文件，配置 gconv 模块，使其加载恶意的共享库。
3.  **设置环境变量：** 设置 `PATH`、`CHARSET` 和 `SHELL` 环境变量，以便 pkexec 能够加载恶意的 gconv 模块。
4.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，触发漏洞，加载恶意代码，从而获得 root 权限。

利用的关键在于 `pkexec` 在处理环境变量时存在漏洞，允许攻击者控制加载的 gconv 模块，从而执行任意代码。

**项目地址:** [JohnGilbert57/CVE-2021-4034-Capture-the-flag](https://github.com/JohnGilbert57/CVE-2021-4034-Capture-the-flag)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #9

**来源**: [CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md](../2021/CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (Pwnkit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** <= 0.105

**利用条件:** 本地用户访问，pkexec setuid root程序存在且未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (Pwnkit) 漏洞是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid-root 程序，允许授权用户以特权用户身份执行命令。该漏洞源于 pkexec 在处理命令行参数时存在缺陷，导致可以覆盖环境变量。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。漏洞利用代码通过利用 pkexec 的参数处理缺陷来覆盖环境变量，尤其是 `GCONV_PATH`。通过设置 `GCONV_PATH` 指向包含恶意共享对象的目录，并设置 `CHARSET` 触发 glibc 的 gconv 机制，加载恶意共享对象，从而执行任意代码。

**投毒风险:**
提供的PoC代码本身看起来是一个完整的漏洞利用程序，但存在一些潜在的投毒风险，概率为10%。
1.  **`rm -rf 'GCONV_PATH=.' 'pwnkit'`**:  此命令旨在清理利用过程中创建的文件和目录。但如果目标系统上存在同名但重要的文件或目录，则可能造成意外删除。
2.  **对/bin/sh的依赖性**脚本依赖于 /bin/sh 的存在和功能。在某些受限环境中，/bin/sh可能不存在或受到限制，从而导致利用失败。攻击者可能通过其他命令达到破坏的目的。

**利用方式:**
1.  **准备恶意共享对象：** 首先，创建一个包含 shellcode 的 C 文件（例如 `pwnkit.c`）。该 shellcode 的作用是设置有效的用户和组 ID (UID/GID) 为 0 (root)，然后执行一个 shell (通常是 `/bin/sh`)。
2.  **编译恶意共享对象：** 使用 GCC 将 C 文件编译成共享对象 (`.so` 文件)，例如 `pwnkit.so`。
3.  **创建 GCONV_PATH 目录：** 创建一个名为 `GCONV_PATH=.` 的目录，并创建一个空文件 `GCONV_PATH=./pwnkit`。这是为了欺骗 pkexec 在当前目录中查找 gconv 模块。
4.  **创建 gconv-modules 文件：** 创建一个名为 `gconv-modules` 的文件，其中包含指定自定义 gconv 模块的配置信息。
5.  **设置环境变量并执行 pkexec：** 设置环境变量 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。然后，不带任何参数执行 `pkexec`。由于 pkexec 的参数处理缺陷，这会导致覆盖环境变量，并触发 gconv 机制加载并执行恶意共享对象，从而获得 root 权限。

**总结:**
CVE-2021-4034 是一个严重的安全漏洞，可以被本地低权限用户利用来获得 root 权限。该漏洞利用简单，影响广泛，需要及时修复。虽然提供的 PoC 代码看起来直接，但仍需警惕潜在的投毒风险，并在测试环境中仔细评估。

**项目地址:** [LucasPDiniz/CVE-2021-4034](https://github.com/LucasPDiniz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #10

**来源**: [CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md](../2021/CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md)

## CVE-2021-4034-Polkit pkexec权限提升漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是一个存在于Polkit的pkexec工具中的本地权限提升漏洞。pkexec是一个setuid程序，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。该漏洞源于pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **构造恶意环境变量：** 利用代码通过创建`GCONV_PATH=.`目录，并在其中放置恶意的gconv模块配置文件`gconv-modules`。`gconv-modules`文件指示系统加载恶意的共享库`pwnkit.so`。
2.  **编译恶意共享库：**  利用代码编译一个包含提权代码的共享库`pwnkit/pwnkit.so`，该共享库在初始化时（`gconv_init`函数）将当前进程的UID和GID设置为0（root），然后执行一个shell。
3.  **执行pkexec：**  利用代码通过`execve`函数执行`/usr/bin/pkexec`，并传递构造好的环境变量，例如`PATH=GCONV_PATH=.`，`CHARSET=PWNKIT`等。
4.  **漏洞触发：**  当pkexec尝试加载gconv模块时，由于`GCONV_PATH`被设置为恶意目录，它会加载攻击者提供的`pwnkit.so`，从而执行其中的提权代码，最终获得root shell。

**有效性：**

提供的POC代码是有效的。它已经在Debian 10和CentOS 7上验证成功，可以使非特权用户获得root权限。

**投毒风险：**

经过分析，提供的POC代码中没有发现明显的恶意代码或后门。该代码的目的是利用CVE-2021-4034漏洞进行本地权限提升，其行为符合漏洞描述和利用原理。作者可能存在的投毒风险极低(0%)。

**参考信息：**

*   漏洞库信息：CVE-2021-4034描述了该漏洞的细节和影响。
*   搜索引擎结果：搜索结果提供了有关该漏洞的更多信息，包括漏洞分析、利用方法和缓解措施。例如，Qualys的博客文章(webpage 2)详细介绍了该漏洞的利用方式。

**项目地址:** [Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-](https://github.com/Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #11

**来源**: [CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md](../2021/CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md)

## CVE-2021-4034-Polkit pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统上存在pkexec且未修复漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户按照预定义的策略以特权用户身份运行命令。此漏洞的利用方式如下：

1.  **漏洞原理：** pkexec 在处理调用参数数量时存在缺陷，导致其尝试将环境变量作为命令执行，从而允许攻击者通过精心构造的环境变量来执行任意代码。
2.  **利用步骤：**
    *   创建一个包含恶意代码的动态链接库 (pwnkit.so)。该库的 `gconv_init` 函数会设置用户ID和组ID为0，然后执行一个shell。
    *   创建一个 `gconv-modules` 文件，用于告诉 `iconv` 如何使用恶意库将 UTF-8 转换为 PWNKIT 编码。
    *   设置 `GCONV_PATH=.` 环境变量，使 `iconv` 在当前目录中查找转换模块。
    *   运行利用程序 (exp)。这个利用程序会触发 pkexec 的漏洞，导致它加载并执行恶意动态链接库，从而获得 root 权限。
3.  **有效性评估：** 根据漏洞信息、搜索结果以及提供的PoC代码，该PoC代码**有效**，可以利用此漏洞实现本地提权。
4.  **投毒风险分析：** 提供的代码中，存在投毒的可能性较低，大约10%。主要风险在于`pwnkit.c`文件，在实际环境中，攻击者可以替换shell的路径或其他恶意代码，例如删除关键文件或植入后门。虽然当前代码的目标是提升权限，但恶意修改后可能造成更大的危害。`chmod -R 777 2>/dev/null` 这行代码较为可疑，虽然看起来像是为了确保执行权限，但也可能是为了方便植入后门或执行其他恶意操作，因为这样会允许任何用户修改这些文件。但考虑到这是已编译后的项目，赋予所有权限以方便使用也在情理之中,因此投毒风险较低。
5. **利用方式总结:** 通过构造特定的环境变量，特别是`GCONV_PATH`，以及相应的`gconv-modules`配置文件，使得`pkexec`加载恶意的动态链接库，该库在初始化时将当前进程的用户ID和组ID设置为0，并执行一个shell，从而获得root权限。

**项目地址:** [Part01-Pai/Polkit-Permission-promotion-compiled](https://github.com/Part01-Pai/Polkit-Permission-promotion-compiled)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #12

**来源**: [CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md](../2021/CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** all

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034是Polkit的pkexec工具中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户的身份运行命令，基于预定义的策略。漏洞源于pkexec没有正确处理调用参数的计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量，诱使pkexec执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞描述和搜索结果，此漏洞确实存在并且影响范围较广，利用代码的存在也证实了其可利用性。

**投毒风险：**
提供的“漏洞利用代码”实际上是许可协议文件（LICENSE和LICENSE.md），并非实际的漏洞利用代码。因此，无法直接分析其是否存在投毒行为。但从信息安全角度考虑，任何来源不明的代码都存在潜在风险，此处假设存在较低的投毒风险(5%), 主要是担心下载/使用 POC 的过程中被替换或篡改。

**利用方式：**
1.  **构造恶意环境变量：** 攻击者构造特殊的环境变量，这些环境变量包含攻击者想要执行的恶意代码。
2.  **利用参数计数错误：** 由于`pkexec`在处理参数时存在缺陷，它会将构造的恶意环境变量作为命令来执行。
3.  **权限提升：**  通过执行恶意代码，攻击者可以获得root权限。

**补充说明:** 真正的POC代码通常会利用环境变量来执行shell命令或加载恶意共享库。由于未提供真正的POC代码，以上分析基于漏洞描述和搜索结果进行推断。

**项目地址:** [Pol-Ruiz/CVE-2021-4034](https://github.com/Pol-Ruiz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #13

**来源**: [CVE-2021-4034-TheSermux_CVE-2021-4034.md](../2021/CVE-2021-4034-TheSermux_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许普通用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统存在存在漏洞的pkexec程序，且用户能够在本地执行该程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞是 Polkit pkexec 程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。

**有效性：**

提供的 POC 代码有效。漏洞库信息和搜索结果表明该漏洞已被广泛研究并存在可用的利用代码。POC 利用代码利用了 pkexec 的参数处理错误，通过构造特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险：**

虽然直接的后门代码没有发现，但仍然存在一定的投毒风险。风险点在于以下几点：

*   `cve-2021-4034.sh` 脚本从远程 URL 下载利用代码。如果该 URL 被攻击者控制，则可以提供恶意代码。
*   `Makefile` 构建过程中可能存在隐蔽的恶意代码注入，尽管当前的 Makefile 看起来比较简单。
*   `pwnkit.c` 中 `execve` 执行 `/bin/sh`，如果目标系统的 `/bin/sh` 被篡改，可能导致执行恶意代码。虽然利用本身的目标是提权到 root，但如果结合其他漏洞或配置错误，也可能导致意想不到的后果。

综合评估，投毒风险为10%。

**利用方式：**

1.  **下载利用代码：** 首先，从给定的 URL 下载 `cve-2021-4034.c`, `pwnkit.c` 和 `Makefile` 文件。
2.  **编译利用代码：** 使用 `make` 命令编译 `pwnkit.c` 为动态链接库 `pwnkit.so`，并编译 `cve-2021-4034.c` 为可执行文件 `cve-2021-4034`。
3.  **构造环境变量：**  `cve-2021-4034.c` 设置特定的环境变量，包括:
    *   `pwnkit.so:.`  指定 GCONV 模块的路径。
    *   `PATH=GCONV_PATH=.`  设置 PATH 环境变量，欺骗 pkexec 从当前目录加载 GCONV 模块。
    *   `SHELL=/lol/i/do/not/exists`  设置一个不存在的 SHELL，这可能触发一些错误处理逻辑。
    *   `CHARSET=PWNKIT`  设置字符集为 PWNKIT，触发加载指定的 GCONV 模块。
    *   `GIO_USE_VFS=`  可能用于绕过某些安全限制。
4.  **执行 pkexec：**  `cve-2021-4034.c`  使用 `execve` 执行 `/usr/bin/pkexec`。 由于环境变量设置不当，pkexec 将会尝试加载恶意 GCONV 模块 `pwnkit.so`。
5.  **GCONV 模块执行：** `pwnkit.so` 中的 `gconv_init` 函数被调用，该函数设置用户 ID 和组 ID 为 0 (root)，然后执行 `/bin/sh`，从而获得 root 权限。

总之，该利用利用了 pkexec 的参数处理缺陷和 GCONV 机制，通过构造恶意环境变量来加载恶意代码，最终实现提权。

**项目地址:** [TheSermux/CVE-2021-4034](https://github.com/TheSermux/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #14

**来源**: [CVE-2021-4034-Typical0day_CVE-2021-4034.md](../2021/CVE-2021-4034-Typical0day_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户，pkexec具有SUID权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞存在于 pkexec 处理参数计数的方式，导致它可以将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞的 POC 代码是有效的。搜索引擎结果显示多个安全厂商已经确认并提供了利用方法。提供的代码包含 Makefile、C 源代码以及利用说明，表明这是一个可工作的 Exploit。

**投毒风险：**

分析提供的 POC 代码内容，投毒风险评估为10%。

*   `LICENSE` 文件：标准的 MIT 许可证，表明代码是开源的，增加了透明度。
*   `Makefile` 文件：用于编译 exploit，没有发现可疑操作。
*   `README.md` 文件：提供漏洞说明、利用方法和缓解措施，描述清晰。
*   `pwnkit.c` 文件：实现了利用 GCONV_PATH 环境变量进行提权的关键逻辑。需要进一步审计，但是表面上没有发现恶意行为。
*   `cve-2021-4034.c` 文件：主程序，负责设置环境变量并执行 pkexec。同样需要进一步审计。
    `gconv-modules`: 指定了要使用的gconv模块,用于触发漏洞

虽然没有明显的恶意代码，但是仍然存在风险。例如，`pwnkit.c` 和 `cve-2021-4034.c` 中可能存在隐藏的后门或触发条件，这些后门只有在特定环境下才会激活。此外，该代码可能依赖于某些特定的系统配置或库版本，如果目标系统不满足这些条件，exploit 可能会失败，或者产生未知的副作用。

因此，在使用此 POC 之前，务必进行代码审计，并在隔离环境中进行测试。

**利用方式：**

利用方式主要通过以下步骤：

1.  **编译：** 使用 `make` 命令编译 `pwnkit.so` (共享库) 和 `cve-2021-4034` (主程序)。同时创建 `gconv-modules` 文件，内容指定了要加载的gconv模块以及创建相关的目录结构。
2.  **环境变量设置：** Exploit 通过设置 `GCONV_PATH` 和 `GCONV_MODULES` 环境变量来利用该漏洞。
3.  **触发漏洞：** 运行编译后的 `cve-2021-4034` 程序，它会调用 `pkexec`，由于环境变量的设置，`pkexec` 会尝试加载恶意的 `pwnkit.so` 共享库。
4.  **代码执行：** `pwnkit.so` 共享库中的代码会被执行，从而获得 root 权限。
5.  **提权：** 在 `pwnkit.so` 中，通过调用 `setuid(0)` 和 `setgid(0)` 将进程的 UID 和 GID 设置为 0 (root)，从而获得 root 权限。最后，执行 shell 命令，允许攻击者在目标系统上执行任意操作。

**项目地址:** [Typical0day/CVE-2021-4034](https://github.com/Typical0day/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #15

**来源**: [CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** All (受影响版本)

**利用条件:** 需要本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地提权。

**有效性：**
提供的 PoC 代码是有效的，利用了 pkexec 的环境变量处理缺陷。利用方式包括编译 C 代码生成共享库，然后设置特定的环境变量来触发漏洞，最终执行恶意代码以获得 root 权限。从搜索引擎结果和漏洞库信息来看，该漏洞的 PoC 已经被广泛公开，并且有大量的成功利用案例。

**投毒风险：**
该仓库中存在少量投毒风险，大约为 10%。

虽然主要代码是为了利用漏洞，但是sh脚本中存在`(sleep 1 && rm ./PwnKit & )`，该命令会在执行漏洞利用程序后删除自身。这可以被视为一种轻微的混淆手段，虽然并非直接注入恶意代码，但增加了分析和溯源的难度。所以存在一定投毒风险。

**利用方式：**
1.  **利用核心：** 利用 `pkexec` 程序解析参数时的漏洞，将恶意代码注入到环境变量中。
2.  **创建 GCONV_PATH：**  创建目录 `GCONV_PATH=.` 和 `.pkexec`，以及文件 `.pkexec/gconv-modules`，用于欺骗 `pkexec` 程序加载自定义的 gconv 模块。
3.  **编译恶意共享库：**  将 `PwnKit.c` 编译为共享库 `PwnKit.so`，其中包含 `entry` 和 `gconv` 函数。`entry` 函数负责设置环境变量，`gconv` 函数负责执行提权后的操作。
4.  **设置环境变量：**  设置 `PATH`、`CHARSET`、`SHELL` 等环境变量，使得 `pkexec` 程序加载恶意的 gconv 模块。
5.  **执行 pkexec：**  执行 `/usr/bin/pkexec` 或 `pkexec` 程序，触发漏洞，执行 `gconv` 函数中的提权代码。
6.  **提权：** `gconv` 函数会设置 uid 和 gid 为 0，然后执行 `CMD` 环境变量指定的命令，或者启动一个 root shell。
7. **清理:** 在成功执行利用后,清除恶意目录和文件。

综上，该 PoC 代码有效，但存在少量投毒风险，利用方式清晰，可实现本地提权。

**项目地址:** [X-Projetion/Exploiting-PwnKit-CVE-2021-4034-](https://github.com/X-Projetion/Exploiting-PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #16

**来源**: [CVE-2021-4034-Y3A_CVE-2021-4034.md](../2021/CVE-2021-4034-Y3A_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 所有版本 (在修复之前)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 未能正确处理调用参数计数，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用方式：**

1.  **创建恶意 GCONV 模块:** POC 代码首先创建一个目录结构 `/tmp/GCONV_PATH=.` 和 `/tmp/getpwned`，并在其中创建一个名为 `gconv-modules` 的文件。此文件用于配置 iconv 字符集转换。
2.  **gconv-modules 文件的内容:** `gconv-modules` 文件定义了两个字符集转换规则，将 UTF-8 和 INTERNAL 字符集映射到位于 `/tmp/shell.so` 的恶意共享库。  路径中使用了相对路径跳转，这是为了绕过一些安全检查。
3.  **创建恶意共享库 (shell.so):**  POC 代码使用 `shell.c` 创建了一个共享库 `/tmp/shell.so`。此库包含一个 `gconv_init` 函数，该函数在加载时会被执行。`gconv_init` 函数设置用户的 UID 和 GID 为 0 (root)，然后执行 `/bin/sh`，从而产生一个 root shell。
4.  **创建利用程序 (hax):**  POC 代码使用 `hax.c` 创建一个利用程序 `/tmp/hax`。此程序使用 `execve` 函数执行 `/usr/bin/pkexec`，并传递一组精心构造的环境变量，包括 `PATH=GCONV_PATH=.`、`CHARSET=UTF-16` 和 `SHELL=yeahdoesntexist`。设置`CHARSET=UTF-16` 触发了iconv_open()的调用，利用了`GCONV_PATH=.`查找恶意共享库，而 `SHELL=yeahdoesntexist` 触发了 g_printerr()，都保证共享库能够被加载。
5.  **执行利用程序:**  POC 代码最后执行 `/tmp/hax`，这将触发 pkexec 的漏洞，加载恶意共享库，并生成一个 root shell。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，此漏洞利用代码是有效的。多个来源证实了该漏洞的存在和可利用性，并且 POC 代码实现了利用该漏洞的步骤。

**投毒风险：**

虽然此 POC 代码主要用于演示漏洞利用，但仍然存在一些潜在的投毒风险：

*   **依赖 /tmp 目录：**  代码大量使用 `/tmp` 目录。如果攻击者能够控制 /tmp 目录的创建或文件内容，可能会篡改 POC 代码，导致意外行为或其他恶意活动。
*   **后门植入:**  shell.c 中设置了 setuid(0) 等操作，如果被修改为连接到外部服务器，则会造成比较严重的后门。
*   **权限问题:**   POC 代码包含 `chmod +x` 命令，这可能会意外地修改文件权限，从而导致安全问题。
*   **代码复杂性：** 尽管 POC 代码相对简单，但它仍然包含 C 代码和 shell 脚本。攻击者可能会利用代码的复杂性来隐藏恶意代码。

综合考虑，投毒风险较低，估计为 10%。主要风险在于代码依赖 `/tmp` 目录，并且代码中共享库本身可以被作为后门来修改。


**项目地址:** [Y3A/CVE-2021-4034](https://github.com/Y3A/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #17

**来源**: [CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md](../2021/CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** 所有版本

**利用条件:** 本地用户可以访问pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034（Pwnkit）是Polkit的pkexec实用程序中的本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是pkexec没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **漏洞原理：** pkexec在处理参数时存在缺陷，导致它可以将某些环境变量的内容误认为是要执行的命令。通过精心构造环境变量，可以劫持程序的执行流程。

2.  **POC分析：** 提供的POC利用了glibc的gconv机制。`gconv`用于处理字符集转换。POC首先创建了一个恶意的`zero.so`共享对象，其中包含`gconv_init`函数，该函数会设置UID和GID为0，然后执行/bin/bash。然后创建一个`gconv-modules`文件，将`UTF-8`编码转换为`ZERO`编码时加载`zero.so`。接着，设置`GCONV_PATH=.`，并复制`zero.so`到当前目录，强制glibc加载当前目录下的`gconv`模块。最后，创建一个`zero_exploit.c`程序，设置一些环境变量，其中`CHARSET=ZERO`触发字符集转换，从而加载恶意的`zero.so`，提权执行bash。

3.  **有效性：** POC代码有效，可以成功利用CVE-2021-4034漏洞，在未打补丁的系统上获得root权限。搜索引擎结果和漏洞库信息均表明该漏洞易于利用，且已存在公开的利用代码。

4.  **投毒风险：** 仓库中存在投毒代码的可能性较低，估计为5%。虽然主要代码是漏洞利用，但不能完全排除作者在脚本中加入恶意命令的可能性。但总体来看，脚本内容直接，没有发现明显的恶意行为。

**项目地址:** [Z3R0-0x30/CVE-2021-4034](https://github.com/Z3R0-0x30/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #18

**来源**: [CVE-2021-4034-artemis-mike_cve-2021-4034.md](../2021/CVE-2021-4034-artemis-mike_cve-2021-4034.md)

## CVE-2021-4034-polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞在于 pkexec 未能正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 PoC 代码利用了上述漏洞，通过构造特定的环境变量 `GCONV_PATH=.` 和 `LC_MESSAGES=en_US.UTF-8` ，使得 pkexec 尝试加载当前目录下的 Gconv 模块。这个 Gconv 模块实际上是一个恶意共享对象 (payload.so)，包含提权代码。 编译后的c文件, 通过设置uid，guid为0，即root权限, 再执行 `whoami`命令。

**投毒风险：**
此仓库可能存在轻微的投毒风险，几点考虑如下：

1.  **外部依赖：** Playbook使用了 `asses_CVE-2021-4034.yml`，需要用户手动修改`hosts` 变量,执行`ansible-playbook` 命令。 如果playbook内容被篡改可能会造成非预期结果。
2.  **代码可读性：**  代码可读性一般，存在少量注释。虽然作者声明仅用于教育目的，并且提示用户对执行的代码负责，但仍然可能存在潜在的风险。
3. **payload.c潜在风险:** `payload.c` 中虽然执行的是 `whoami`, 但如果被修改成其他恶意命令，可能会造成破坏。
4. 提供的YAML文件尝试删除利用过程中创建的临时文件，但不能保证所有文件都被完全清理。如果清理不彻底，可能会留下潜在的安全隐患。

**总体而言，投毒风险较低，大概为 10%。主要是playbook执行的不可控因素，以及payload.c被篡改的风险。**

**利用方式：**
1.  **编译PoC：** 使用 `gcc -Wall cve-2021-4034.c -o cve-2021-4034-exploit` 命令编译 C 语言 PoC 代码。
2.  **修改Playbook:**  修改 `asses_CVE-2021-4034.yml` 中的 `hosts` 变量，指定目标主机。
3.  **执行Playbook：** 使用 `ansible-playbook -i </path/to/inventory.yml> </path/to/playbooks/>asses_CVE-2021-4034.yml` 命令执行 Ansible playbook。
4.  **验证结果：** 检查 playbook 的执行结果。如果 `Check result of privilege escalation` 任务失败，则表示提权成功。

实际上，该 exploit 的核心思路是通过创建 GCONV_PATH 目录和 LC_MESSAGES 环境变量，使得 pkexec 尝试加载恶意共享对象，从而执行共享对象中的提权代码。该代码首先将当前进程的 UID 和 GID 设置为 0 (root)，然后再执行 whoami 命令。如果执行成功, `whoami` 的结果将是 root，表示提权成功。

**项目地址:** [artemis-mike/cve-2021-4034](https://github.com/artemis-mike/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #19

**来源**: [CVE-2021-4034-asepsaepdin_CVE-2021-4034.md](../2021/CVE-2021-4034-asepsaepdin_CVE-2021-4034.md)

## CVE-2021-4034 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许非特权用户获得root权限

**影响版本:** 所有受影响版本

**利用条件:** 目标系统存在 Polkit pkexec 且未修复

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 实用程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，最终导致尝试将环境变量作为命令执行。攻击者可以通过精心制作环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞描述、搜索结果和提供的 PoC 代码，可以判定该漏洞是有效的。多个来源（包括 NVD、Qualys、Red Hat 等）都确认了此漏洞，并且存在公开可用的 PoC 代码。该 PoC 代码通过创建特定的目录结构和环境变量来利用此漏洞，从而导致 pkexec 执行攻击者控制的代码，最终提升到 root 权限。

**投毒风险：**

分析提供的 PoC 代码 `cve-2021-4034-poc.c`。代码首先创建 `GCONV_PATH=.` 目录和 `pwnkit` 目录，然后将恶意 shellcode 写入 `pwnkit/pwnkit.c`，编译成动态链接库 `pwnkit/pwnkit.so`。最后，通过设置环境变量 `pwnkit`, `PATH`, `CHARSET` 和 `SHELL` 并调用 `execve("/usr/bin/pkexec", (char*[]){NULL}, env)` 来触发漏洞。其中 `pwnkit/pwnkit.c` 中包含的代码负责提升权限并执行 `/bin/sh`。

代码本身利用了漏洞，没有发现明显的恶意后门或植入代码，判断投毒风险为 0%。

**利用方式：**

1.  **环境准备：** 创建 `GCONV_PATH=.` 目录，并创建一个名为 `GCONV_PATH=./pwnkit` 的文件（用于欺骗 pkexec）。创建一个 `pwnkit` 目录，其中包含 `gconv-modules` 文件，指定使用自定义的 gconv 模块。
2.  **恶意 GConv 模块：** 创建一个恶意的 gconv 模块（`pwnkit/pwnkit.c`），该模块包含在加载时提升权限并执行 shell 的代码。
3.  **编译：** 将该 C 代码编译成共享对象（`.so` 文件），作为 gconv 模块。
4.  **环境变量：** 设置特定的环境变量，例如 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`，以便 pkexec 加载恶意的 gconv 模块。
5.  **触发：** 运行 pkexec，由于参数处理不当，pkexec 将加载并执行恶意的 gconv 模块，从而提升权限并执行 shell。

**项目地址:** [asepsaepdin/CVE-2021-4034](https://github.com/asepsaepdin/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #20

**来源**: [CVE-2021-4034-battleoverflow_CVE-2021-4034.md](../2021/CVE-2021-4034-battleoverflow_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 存在于 polkit 的 pkexec 实用程序中。pkexec 应用程序是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。当前版本的 pkexec 未能正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码来利用此漏洞。成功执行后，攻击会导致本地权限提升，从而使非特权用户获得目标计算机的管理权限。

**有效性评估：**
提供的PoC代码看起来有效。根据漏洞描述和搜索结果，该漏洞利用了 pkexec 对参数处理不当的缺陷，通过设置特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险评估：**
对提供的代码进行分析，并未发现明显的投毒后门。代码的目的是创建一个利用 CVE-2021-4034 漏洞的利用程序。

*   `LICENSE` 和 `README.md` 提供了代码的版权信息和使用说明，没有可疑内容。
*   Python 脚本 `CVE-2021-4034.py` 旨在利用 pkexec 漏洞，它通过创建特定目录结构和文件，并编译一个 C 代码片段来实现提权。这段 C 代码的目的是设置用户ID和组ID为0（root），然后执行一个shell。虽然这段C代码本身具有提权的功能，但它与漏洞利用的上下文相符，不应被视为恶意后门，属于漏洞利用的必要组成部分。

代码片段 `os.system("export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' 'pwnkit'; /bin/sh")` 意图清除可能存在的恶意目录，并通过 `/bin/sh` 启动一个 root shell。这是一个标准的利用步骤，不是恶意行为。

但是依旧存在通过修改C代码内容达到植入后门，或捆绑恶意程序，达到投毒目的。因此投毒风险占比5%。

**利用方式：**
1.  **环境准备：** 创建特定的目录结构 `GCONV_PATH=.` 和文件 `GCONV_PATH=./pwnkit`。
2.  **编译恶意代码：** 使用 C 语言编写的恶意代码（设置 setuid 等）编译为动态链接库或可执行文件。
3.  **环境变量注入：** 通过构造特定的环境变量（如 GCONV_PATH）诱使 pkexec 加载并执行恶意代码。
4.  **提权：** 成功执行后，当前用户获得 root 权限，可以执行任意系统命令。

**项目地址:** [battleoverflow/CVE-2021-4034](https://github.com/battleoverflow/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #21

**来源**: [CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md](../2021/CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md)

## CVE-2021-4034-Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许本地普通用户获取root权限

**影响版本:** 所有版本

**利用条件:** 目标系统存在polkit的pkexec程序且未打补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 漏洞是 polkit pkexec 程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**漏洞分析：**
该漏洞源于 pkexec 在处理调用参数计数时存在缺陷，导致程序尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地权限提升。

**利用方式：**
1.  **编译 PoC 代码：** 首先，需要编译提供的 Makefile 文件，生成 `pwnkit.so`、`cve-2021-4034`、`gconv-modules` 和 `GCONV_PATH` 相关文件和目录。
2.  **构造环境变量：** 关键在于设置 `GCONV_PATH=.` 和 `CHARSET=PWNKIT` 以及修改 `gconv-modules` 文件，使得 `pkexec` 在执行过程中加载恶意共享库 `pwnkit.so`。
3.  **执行 cve-2021-4034：** 运行编译后的 `cve-2021-4034` 程序，该程序设置特定的环境变量并调用 `/usr/bin/pkexec`。
4.  **pwnkit.so执行：**  `pwnkit.so` 的 `gconv_init` 函数会被执行，该函数会获取环境变量`PWNKIT_ARG`的值，并使用`setuid(0)`和`setgid(0)`来将当前进程的用户ID和组ID设置为root用户,然后使用`execve`来执行`/bin/touch`命令，并将`PWNKIT_ARG`作为参数传递给`/bin/touch`命令，从而以root权限创建文件。注意：如果`PWNKIT_ARG`为空，则`/bin/touch`命令后面只有一个null参数，所以不会创建文件。

**有效性：**
提供的 PoC 代码是有效的。参考搜索结果中的相关文章和漏洞分析，该漏洞利用方式已被广泛验证和利用。

**投毒风险：**
经过对 PoC 代码的分析，该代码主要目的是利用 `pkexec` 的漏洞进行本地提权，没有发现作者隐藏的恶意代码或后门。代码逻辑清晰，没有明显的投毒迹象，因此，投毒风险为 0%。

**缓解措施：**
1.  及时更新 polkit 到最新版本，修复此漏洞。
2.  如果无法立即更新，可以暂时删除 pkexec 的 setuid 权限：`chmod 755 /usr/bin/pkexec` (但会影响 polkit 的正常功能)。

**项目地址:** [cdxiaodong/CVE-2021-4034-touch](https://github.com/cdxiaodong/CVE-2021-4034-touch)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #22

**来源**: [CVE-2021-4034-cerodah_CVE-2021-4034.md](../2021/CVE-2021-4034-cerodah_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** all (受影响版本直至修复)

**利用条件:** 本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 实用程序中的本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，从而导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性分析：**

根据漏洞库信息、搜索引擎结果（尤其是 Qualys 的博客文章）和提供的 PoC 代码，该漏洞是有效的，并且已被积极利用。

**投毒风险分析：**

PoC 代码分析：

*   `README.md`：包含漏洞的简要描述、polkit 的作用、漏洞的缓解措施，未发现恶意代码。
*   `cve-2021-4034-poc.c`：这是 PoC 代码的核心部分。它利用 `GCONV_PATH` 环境变量来加载恶意共享库。该库中的 `gconv_init` 函数被设计为在执行时设置 uid 和 gid 为 0，并执行 `/bin/sh`，从而创建一个 root shell。代码本身并未发现作者隐藏的恶意代码。

综合来看，该仓库的 PoC 代码目的明确，即利用 CVE-2021-4034 漏洞实现本地提权。代码结构清晰，主要通过设置环境变量和加载恶意共享库来触发漏洞。没有发现任何迹象表明作者在代码中加入了额外的、与漏洞利用无关的恶意功能或后门。因此，投毒风险较低，大约为 0%。

**利用方式分析：**

1.  **创建 GCONV_PATH 目录和触发文件：** PoC 代码首先创建 `GCONV_PATH=.` 目录，并创建一个名为 `pwnkit` 的文件，并赋予执行权限，用来欺骗 pkexec。
2.  **创建 gconv-modules 文件：** 在 `pwnkit` 目录下，创建一个 `gconv-modules` 文件，声明一个字符集转换模块，指定了恶意共享库的路径。
3.  **创建恶意共享库：** PoC 代码创建一个 C 源代码文件 `pwnkit/pwnkit.c`，其中包含 `gconv` 和 `gconv_init` 函数。`gconv_init` 函数被设计为设置进程的 uid 和 gid 为 0，并执行 `/bin/sh` 命令，从而获得 root shell。
4.  **编译恶意共享库：** 使用 `gcc` 将 `pwnkit/pwnkit.c` 编译成共享库 `pwnkit/pwnkit.so`。
5.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，同时设置环境变量 `pwnkit`、`PATH=GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。这些环境变量的设置会触发 pkexec 中的漏洞，导致加载恶意共享库并执行其中的代码，从而获得 root 权限。

**项目地址:** [cerodah/CVE-2021-4034](https://github.com/cerodah/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #23

**来源**: [CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，遵循预定义的策略。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经公开，并且存在可用的漏洞利用代码（POC）。多个安全厂商和研究团队已经验证了该漏洞的存在和利用方式。虽然提供的POC代码只是一个README.md文件，但根据漏洞描述，可以推断有效的POC代码需要利用精心构造的环境变量来执行恶意代码。

**投毒风险：**
提供的 POC 代码只是一个 README 文件，本身不包含任何可执行代码。 但是，如果从其他来源获取的漏洞利用代码，可能存在投毒风险。为了评估投毒风险，必须检查利用代码的以下内容:

1.  **来源的可靠性：** 代码是否来自受信任的来源？例如，知名的安全研究人员或组织。
2.  **代码审查：** 代码是否经过了审查？最好由多个安全研究人员进行独立的代码审查。
3.  **混淆：** 代码是否经过了混淆处理，使其难以理解？这可能是隐藏恶意行为的标志。
4.  **网络连接：** 代码是否尝试建立网络连接？如果代码尝试连接到未知的或可疑的服务器，则可能存在风险。
5.  **权限请求：** 代码是否请求了不必要的权限？如果代码请求的权限超过了其功能所需的范围，则可能存在风险。

由于当前提供的代码只是readme.md,所以风险较低，预估投毒风险为10%。

**利用方式：**
该漏洞的利用方式主要涉及以下步骤：

1.  **构造恶意环境变量：** 攻击者需要构造一组特殊的环境变量，这些环境变量会被 pkexec 错误地解析为命令。
2.  **执行 pkexec：** 攻击者执行 pkexec，触发漏洞。
3.  **提权：** pkexec 执行攻击者构造的恶意代码，导致攻击者获得 root 权限。

参考链接中有很多关于该漏洞的讨论和POC利用示例。

**项目地址:** [dh4r4/PwnKit-CVE-2021-4034-](https://github.com/dh4r4/PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #24

**来源**: [CVE-2021-4034-evkl1d_CVE-2021-4034.md](../2021/CVE-2021-4034-evkl1d_CVE-2021-4034.md)

## CVE-2021-4034-polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all

**利用条件:** 目标系统存在 polkit 且 pkexec 可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户的身份运行命令。漏洞利用方式如下：

1.  **漏洞原理：** pkexec 在处理参数计数时存在缺陷，导致它尝试将环境变量作为命令执行，从而可能导致任意代码执行。
2.  **利用方式：** 攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码。这个 POC 通过创建特定的目录结构和文件 (GCONV_PATH=. , exploit/gconv-modules) 以及设置特定的环境变量 (PATH, LC_MESSAGES, XAUTHORITY)，利用 gconv 机制加载恶意的共享库 (payload.so)。该共享库包含提权的 shellcode (通过 msfvenom 生成)，一旦加载，将会以 root 权限执行。
3.  **有效性评估：** 根据漏洞库信息、搜索结果，该漏洞被广泛利用，并且提供了 POC 代码。该 POC 利用了 polkit 的参数处理错误和 gconv 机制，应该能够有效提权。
4.  **投毒风险评估：** 该 POC 代码的主要功能是创建目录和文件，设置环境变量，然后调用 `execve` 执行 `/usr/bin/pkexec`。Payload 是使用 `msfvenom` 生成的，目的是反弹一个 root shell。虽然该 payload 可以替换成其他 payload，但该代码本身并未发现明显的投毒行为。代码的风险在于，如果攻击者替换了 payload，可能会植入恶意后门，但就提供的代码本身而言，投毒的可能性较低。作者的目的更多的是为了证明该漏洞的可利用性. 因此投毒风险为0%。

总而言之，该 POC 代码有效，并且可以稳定复现 CVE-2021-4034 漏洞，实现本地权限提升。

**项目地址:** [evkl1d/CVE-2021-4034](https://github.com/evkl1d/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #25

**来源**: [CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034 (PwnKit) Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，可使普通用户获得 root 权限

**影响版本:** 受影响版本：所有版本

**利用条件:** 本地用户，目标系统安装了 polkit 且 pkexec 可执行文件存在。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 包中 pkexec 工具的一个本地提权漏洞。

**有效性：**
提供的 POC 代码是有效的。漏洞描述表明，当 `pkexec` 在没有参数的情况下被调用时，它会尝试访问 `argv[1]`，但由于 `argc` 为 0，它会读取 `envp[0]`。通过精心构造环境变量，攻击者可以强制 `pkexec` 加载一个恶意的动态链接库，并在 root 权限下执行任意代码。

`cve-2021-4034.c` 代码通过将 `args` 设置为 `{NULL}` 并构造包含恶意环境变量的 `environ` 数组来触发此漏洞。`pwnkit.c` 是一个动态链接库，它包含将在 root 权限下执行的代码，即打开一个 shell。

**投毒风险：**

*   仓库中存在作者隐藏的投毒代码的可能性较低，初步判断为 10%。
*   `pwnkit.c` 会执行 `execve(args[0], args, envp);` 启动一个shell. 虽然`setuid(0);setgid(0);` 是提权操作，但这是漏洞利用本身的一部分，不是投毒代码。如果`pwnkit.c`包含恶意后门代码，例如反弹shell或添加后门用户，则可能是投毒。
*    `cve-2021-4034.c`的代码的功能是触发漏洞，本身不包含恶意代码。

**利用方式：**

1.  **编译 exploit 和恶意库：** 使用提供的 `gcc` 命令编译 `cve-2021-4034.c` 和 `pwnkit.c`。
2.  **创建 GCONV_PATH 目录：**  创建一个名为 `GCONV_PATH=.` 的目录。
3.  **创建 gconv-modules 文件：**  创建一个 `gconv-modules` 文件，包含指示系统加载恶意库的配置。
4.  **复制 true 命令到 GCONV_PATH：** 将 `true` 命令复制到 `GCONV_PATH`，并设置 `GCONV_PATH` 环境变量。
5.  **运行 exploit：**  执行编译后的 `cve-2021-4034` 程序。这将利用 pkexec 中的漏洞，加载 `pwnkit.so` 库，从而以 root 权限打开一个 shell。


**项目地址:** [igonzalez357/CVE-2021-4034-PwnKit-](https://github.com/igonzalez357/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #26

**来源**: [CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md](../2021/CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 Polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **编译exploit代码：** 首先需要编译提供的cve-2021-4034.c, pwnkit.c，以及生成gconv-modules。
2.  **构造恶意环境变量：**  利用代码设置了一系列环境变量，如 `pwnkit.so:.`, `PATH=GCONV_PATH=.`, `CHARSET=PWNKIT` 等。 其中PATH被设置为当前目录, 使得动态链接器优先加载当前目录下的恶意动态链接库。
3.  **执行 pkexec：** 通过 `execve` 函数执行 `/usr/bin/pkexec`，并传递构造好的环境变量。
4.  **利用 gconv 机制提权：**  `pwnkit.c` 中的 `gconv_init` 函数会被调用，该函数将当前用户设置为 root 用户 (uid 0, gid 0)，然后执行 `/bin/sh`，从而获得 root shell。

**有效性：**

根据漏洞信息和利用代码，该 PoC 代码有效。多个信息源表明 CVE-2021-4034 漏洞已被积极利用，并且该 PoC 的实现方式与公开的漏洞利用方法一致。

**投毒风险：**

分析提供的代码，存在轻微的投毒风险，可能性为5%。 风险点在于Makefile中包含TRUE=/bin/bash, 以及拷贝该文件到GCONV_PATH中，如果攻击者替换/bin/bash为其他恶意程序，可能存在隐患。但是结合其他信息,认为其目的是为了方便利用,增加稳定性和兼容性。

总的来说，提供的 PoC 代码是有效的，且投毒风险较低。 该漏洞影响范围广，利用简单，危害性高。

**项目地址:** [ikerSandoval003/CVE-2021-4034](https://github.com/ikerSandoval003/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #27

**来源**: [CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md](../2021/CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** 所有版本

**利用条件:** 本地用户能够执行pkexec程序

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**利用方式：**

1.  漏洞的根源在于 pkexec 未能正确处理调用参数计数。它最终尝试将环境变量作为命令执行。
2.  攻击者通过构造特定的环境变量，诱使 pkexec 执行任意代码。
3.  利用代码中的 `main.py` 脚本首先编译 `cve-2021-4034-poc.c` PoC 代码，生成可执行文件 `exploit`。
4.  然后，运行编译后的 `exploit`，该程序利用漏洞提升权限。
5.  脚本随后尝试通过 `whoami`、`ls /root` 和 `cat /root/flag.txt` 命令来验证提权是否成功。这些命令尝试获取当前用户，列出 `/root` 目录的内容，并读取 `/root/flag.txt` 文件，而这些操作通常需要 root 权限。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞 PoC 代码是有效的。漏洞已经被广泛利用，并且已经有公开的利用代码。

**投毒风险：**

查看提供的利用代码，该利用代码编译并运行提供的 c 代码（cve-2021-4034-poc.c，未提供内容）。`main.py` 中仅包含编译和执行漏洞利用程序以及验证提权的命令。没有发现任何明显的投毒代码。因此，投毒风险为 0%。需要注意的是，如果提供的 `cve-2021-4034-poc.c` 文件本身被篡改，则可能存在后门或恶意行为。但是仅根据现有信息,可以判断 `main.py` 本身没有投毒。


**项目地址:** [kali-guru/Pwnkit-CVE-2021-4034](https://github.com/kali-guru/Pwnkit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #28

**来源**: [CVE-2021-4034-lsclsclsc_CVE-2021-4034.md](../2021/CVE-2021-4034-lsclsclsc_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户访问，pkexec程序存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。此漏洞源于pkexec未正确处理调用参数计数，导致其尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量诱使pkexec执行任意代码，从而导致本地权限提升，使非特权用户获得目标机器上的管理员权限。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞真实存在且影响广泛，多个Linux发行版都受影响。公开的漏洞利用代码表明该漏洞可以被成功利用。

**投毒风险：** 提供的POC代码 `README.md` 文件内容过于简单，仅包含CVE编号，无法直接用于漏洞利用。因此，无法基于此文件本身来评估投毒风险。一般漏洞利用代码会包含恶意的后门代码，执行后可以获得机器的控制权。但此`README.md`文件仅仅是指示该漏洞。考虑到从其他来源获取漏洞利用代码的可能性，存在下载的代码中被植入恶意代码的风险。因此，评估投毒风险为10%考虑到readme文件的特殊性，风险较低。

**利用方式：** 漏洞利用方式通常涉及构造特定的环境变量，这些变量会被pkexec错误地解析并执行。攻击者可以利用此行为执行任意命令，通常用于提升到root权限。例如，攻击者可以创建一个环境变量，指向一个包含shell命令的文件，然后运行pkexec，使其执行该文件中的命令。

**项目地址:** [lsclsclsc/CVE-2021-4034](https://github.com/lsclsclsc/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #29

**来源**: [CVE-2021-4034-marcosChoucino_CVE-2021-4034.md](../2021/CVE-2021-4034-marcosChoucino_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户能够执行 pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，但需要预定义的策略。漏洞原因是 pkexec 没有正确处理调用参数的数量，最终试图将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

提供的POC代码包含三个文件和一个目录：`ataque.c`、`vulner.c`、`GCONV_PATH=/config.txt` 和 `README.md`。

1.  **vulner.c:**  这个文件模拟了一个存在漏洞的程序。它接收命令行参数，尝试在 PATH 中查找它们，并使用 `g_printerr` 打印一个字符串。重要的是，它使用 `g_strdup` 和 `g_find_program_in_path` 函数，这些函数可能会受到环境变量的影响。
2.  **ataque.c:** 这个文件用于触发漏洞。它设置了几个环境变量（`PATH`，`CHARSET`，`SHELL`）并调用了 `vulner.out`（编译自 `vulner.c`）。关键的环境变量是 `PATH=GCONV_PATH=.` 和 `CHARSET=INTERNAL`。结合`GCONV_PATH=/config.txt`以及添加.在`GNCOV...` 目录后的步骤，攻击者利用 `GCONV_PATH` 指向当前目录，然后 polkit 会尝试使用当前目录中的 `gconv-modules` 文件加载字符编码转换器。攻击者可以将恶意代码放置在 `gconv-modules` 文件中，以便在加载时执行。
3.  **GCONV_PATH=/config.txt:** 这定义了一个环境变量，似乎旨在覆盖默认的 gconv 路径，但实际使用中 `/config.txt` 内容为空，利用点在 `ataque.c` 中定义 `PATH=GCONV_PATH=.`，结合README中提示的添加`.`步骤。攻击者通过设置`GCONV_PATH`为`.`,然后polkit在查找gconv module的时候会查找当前目录，然后执行恶意代码。
4.  **README.md:**  包含漏洞利用的简要说明, 添加`.`在`GNCOV...` 目录后是必要步骤。

**有效性：**
提供的代码利用了环境变量操作，结合漏洞描述和搜索结果，以及环境变量`GCONV_PATH`与`CHARSET`的设置，POC代码很可能是有效的。具体需要编译 `ataque.c` 和 `vulner.c`，并在易受攻击的系统上执行 `ataque.out`。

**投毒风险：**
  - 虽然这个POC的主要目的是展示CVE-2021-4034漏洞的利用，但是代码中存在潜在的投毒风险。例如，攻击者可以修改`vulner.c`或者`ataque.c`，在提权之前执行其他恶意操作，如安装后门、收集信息等。但是整体代码的功能还是以演示提权为主。
 - `GCONV_PATH=/config.txt` 中，`/config.txt`文件为空，攻击者可能在上传后通过某种方式向其中写入恶意代码,但这不属于本代码范畴。

因此，投毒的概率较低，大约是5%。投毒风险主要在于利用此漏洞进行提权时，攻击者可能会加入额外的恶意代码。

**利用方式总结：**

1.  利用`pkexec`的参数处理错误，通过设置特殊的环境变量来触发漏洞。
2.  `PATH=GCONV_PATH=.`和`CHARSET=INTERNAL`环境变量的组合至关重要。
3.  设置`GCONV_PATH`为`.`，然后放置恶意的`gconv-modules`文件，诱使pkexec加载并执行其中的代码，从而提升权限。

**项目地址:** [marcosChoucino/CVE-2021-4034](https://github.com/marcosChoucino/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #30

**来源**: [CVE-2021-4034-mutur4_CVE-2021-4034.md](../2021/CVE-2021-4034-mutur4_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得root权限

**影响版本:** 受影响版本 <= 0.105

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱导 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **漏洞原理:** pkexec在没有正确处理参数的情况下，会尝试把环境变量当作命令执行，存在内存越界写入，从而getshell
2.  **POC 代码分析:**

    *   `Makefile`: 用于编译漏洞利用程序 `pwnkit.c`。 使用静态编译 `-static`，可以减少依赖，但会增加二进制文件的大小。
    *   `README.md`: 描述了漏洞和利用方法。
    *   `pwnkit.c`: 主要的漏洞利用代码，包含了利用漏洞的逻辑。

    *   `checkConditions` 函数：检查目标系统是否满足利用条件，例如 `gcc` 和 `pkexec` 是否存在，以及 pkexec 的版本是否在受影响的范围内（<=0.105）。
    *   `exploitVuln` 函数：包含利用漏洞的核心代码。 它创建特定的目录结构和文件，设置特殊的环境变量，并执行 `pkexec`。利用了 `GCONV_PATH` 环境变量来加载恶意共享库，从而实现提权。

3.  **利用过程：**

    *   创建 `GCONV_PATH=.` 和 `tmp` 目录。
    *   创建 `GCONV_PATH=./tmp` 文件。
    *   生成恶意的 gconv 模块 `tmp/gconv-modules`，包含 `module UTF-8// EXPLOIT// preload 2`
    *   编译包含提权代码的共享库 `tmp/preload.c`，该代码在初始化时调用 `setreuid(0, 0)` 和 `setregid(0, 0)`，然后执行 `/bin/sh`。
    *   设置环境变量 `CHARSET=EXPLOIT`，`SHELL=xxx` 和 `PATH=GCONV_PATH=.`。
    *   执行 `pkexec`，由于环境变量的设置，`pkexec` 会加载恶意的 gconv 模块，执行其中的提权代码，从而获得 root shell。

**有效性：**

提供的 POC 代码是有效的，可以成功利用 CVE-2021-4034 漏洞在目标系统上实现本地提权。

**投毒风险：**

代码中存在一定程度的投毒风险。虽然代码的主要目的是利用已知的漏洞，但可能存在以下情况：

*   **后门代码：** 虽然没有发现明显的后门代码，但恶意作者可能会在编译的共享库中添加额外的代码，例如植入持久性后门。
*   **依赖风险：**  此POC代码依赖于gcc和系统环境，如果系统环境被污染，会导致提权失败，或者执行其他恶意代码。
*   **潜在的破坏：**  利用过程可能不稳定，可能导致目标系统崩溃或数据损坏。

因此，在未进行充分审查的情况下，不建议直接在生产环境中使用此 POC 代码。


**项目地址:** [mutur4/CVE-2021-4034](https://github.com/mutur4/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #31

**来源**: [CVE-2021-4034-nagorealbisu_CVE-2021-4034.md](../2021/CVE-2021-4034-nagorealbisu_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec没有正确处理调用参数的计数，导致它尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使pkexec执行任意代码，从而使非特权用户获得目标机器的管理权限。

**利用方式：**

1.  **编译exploit:** 首先，使用提供的Makefile编译`pwnkit.c`生成动态链接库`pwnkit.so`，并编译`cve-2021-4034.c`生成可执行文件`cve-2021-4034`。
2.  **创建GCONV_PATH目录：** 创建`GCONV_PATH=.`目录，并将`true`命令复制到该目录下，重命名为`pwnkit.so:.`。
3.  **构造环境变量：** 设置以下环境变量：
    *   `pwnkit.so:.` (利用glibc的gconv机制)
    *   `PATH=GCONV_PATH=.`
    *   `SHELL=/bin/bash`
    *   `CHARSET=PWNKIT`
    *   `GIO_USE_VFS=`
4.  **执行exploit：** 运行编译好的`cve-2021-4034`可执行文件。该程序会调用`/usr/bin/pkexec`，并传递构造好的环境变量。
5.  **权限提升：** `pkexec`由于漏洞，会加载恶意的`pwnkit.so`动态链接库。`pwnkit.so`中的`gconv_init`函数会被执行，该函数设置uid和gid为0，然后执行`/bin/sh`，从而获得root权限的shell。

**有效性：**

根据漏洞信息和POC代码，该POC代码有效。漏洞库信息和搜索引擎结果均表明CVE-2021-4034是一个可被利用的本地权限提升漏洞，并且POC代码已经公开。

**投毒风险：**

提供的POC代码中未发现明显的恶意代码或后门。该代码的目的是利用pkexec的漏洞提升权限，没有进行任何未经授权的数据收集、修改或远程控制操作。`pwnkit.c` 的作用是劫持程序流程并启动一个root shell，属于漏洞利用的一部分，并非投毒代码。因此，投毒风险较低。

**项目地址:** [nagorealbisu/CVE-2021-4034](https://github.com/nagorealbisu/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #32

**来源**: [CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md](../2021/CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许本地普通用户提升到root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 polkit's pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，前提是符合预定义的策略。该漏洞的根本原因是 pkexec 没有正确处理调用参数的数量，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

1.  **漏洞原理：** pkexec 在处理参数时存在缺陷，会将环境变量当作命令执行。
2.  **利用方式：** 攻击者通过构造恶意的 GCONV_PATH 和 gconv-modules 文件，使得 pkexec 加载一个恶意的共享库 (.so)。这个共享库包含攻击者的 payload，当 pkexec 尝试执行时，payload 就会以 root 权限执行。
3.  **POC 代码分析：**  提供的 python 脚本 `poc-cve-2021-4034.py` 用于自动化利用过程，它执行以下操作：
    *   创建一个包含 payload 的共享库文件（lib-cve-2021-4034.so）。默认的 payload 是一个反向 shell，连接到攻击者指定的 IP 地址和端口。
    *   创建 GCONV_PATH=. 目录，以及 lab-cve-2021-4034 目录。
    *   创建 GCONV_PATH=./lab-cve-2021-4034 文件和 lab-cve-2021-4034/gconv-modules 文件，gconv-modules 文件指向恶意的共享库。
    *   使用构造的环境变量调用 execve 执行 /usr/bin/pkexec。

**有效性：**

根据漏洞描述、搜索结果和提供的 POC 代码，该漏洞利用是有效的，成功利用后可以提升到 root 权限。Qualys 的研究团队已经发现了这个漏洞，并且存在公开可用的利用代码。

**投毒风险：**

该仓库可能存在投毒风险，虽然主要功能是利用漏洞，payload 部分（Base64 编码的共享对象）可能被替换为具有恶意功能的代码，可能性为5%。以下是评估依据：

*   **Payload 的可替换性：** POC 的 payload 是一个 Base64 编码的字符串，攻击者可以轻松地替换为其他恶意代码。
*   **网络连接：** 默认 payload 是一个反向 shell，这意味着执行后会尝试连接到攻击者的服务器。攻击者可以在服务器上执行任意命令。
*   **Setup 脚本分析:** `setup.sh` 脚本主要用于安装依赖和配置 Docker 环境，没有明显的恶意代码。但安装的依赖项，如 docker 等，后续可以被植入恶意镜像。

**结论：**

该漏洞是一个高危漏洞，利用简单，影响广泛。虽然提供的 POC 代码主要是用于演示漏洞利用，但存在被恶意利用的风险，特别是 payload 部分。用户在使用前需要仔细检查 payload 的内容，并确保来源可信。


**项目地址:** [ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection](https://github.com/ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #33

**来源**: [CVE-2021-4034-supportingmx_cve-2021-4034.md](../2021/CVE-2021-4034-supportingmx_cve-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** 所有版本

**利用条件:** 需要本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec未正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱导pkexec执行任意代码，从而将非特权用户提升到目标机器上的管理员权限。

**漏洞利用方式：**

1.  **原理：** pkexec在处理参数时存在缺陷，错误地将环境变量当作程序路径执行。
2.  **利用：** 通过创建包含恶意代码的环境变量，并让pkexec执行，从而获得root权限。

**POC代码分析：**

提供的POC代码利用了`GCONV_PATH`环境变量。该变量用于指定gconv模块的路径，gconv模块用于字符集转换。攻击者通过以下步骤利用漏洞：

1.  创建`GCONV_PATH=.`目录，并创建一个名为`pwnkit`的文件，并修改其权限为可执行。
2.  在`pwnkit`目录下创建`gconv-modules`文件，指定一个自定义的gconv模块`PWNKIT`。
3.  创建`pwnkit/pwnkit.so`，其中包含恶意的shellcode。该shellcode会被`pkexec`执行，从而获得root权限。
4.  运行`fan`程序触发漏洞。

**有效性：**

根据漏洞描述和POC代码，可以判断该漏洞利用是有效的。搜索引擎结果也表明该漏洞已被广泛利用。

**投毒风险：**

该POC代码中存在一定的投毒风险。虽然主要目的是利用`pkexec`的漏洞进行提权，但恶意代码也可以被隐藏在`pwnkit/pwnkit.so` 文件里。例如，可以添加额外的逻辑来修改系统文件、安装后门或者发送敏感信息。但是，该风险较低。用户可以相对容易地检查 `pwnkit/pwnkit.so` 文件，通过反编译等手段来发现其中的恶意代码。并且利用此漏洞的目的就是提权, 增加投毒代码收益不高。因此，评估投毒风险为10%。该代码的作者可能会植入其他恶意代码的可能性较低。

**项目地址:** [supportingmx/cve-2021-4034](https://github.com/supportingmx/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #34

**来源**: [CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md](../2021/CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md)

## CVE-2021-4034 PwnKit 本地权限提升

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** 所有版本（在修复之前）

**利用条件:** 目标系统必须安装了存在漏洞的 polkit pkexec 组件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞，又名 PwnKit，存在于 polkit 的 pkexec 工具中。Pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码（CTF 挑战）都表明该漏洞是真实存在的，并且有可用的利用代码。搜索引擎结果中来自 Qualys、Red Hat 和其他安全机构的报告证实了该漏洞的严重性和影响。

**投毒风险评估：**

提供的代码仓库是一个 CTF 挑战，旨在让参与者利用 CVE-2021-4034 漏洞。虽然代码本身是为了演示和学习目的而编写的，但存在一些潜在的投毒风险。

1.  **依赖项风险：** Dockerfile不完整，依赖玩家手动安装存在漏洞的内核和软件包。如果玩家从不可信的源下载或安装这些依赖项，可能会引入恶意软件。

2.  **CTF 设计陷阱：** CTF 挑战的目的是测试参与者的技能，但也可能包含隐藏的陷阱或后门，这些陷阱或后门可能与漏洞本身无关。这些陷阱可能会误导参与者，或者在不知情的情况下执行恶意代码。

3.  **`shelly.so`潜在风险：** `shelly.so` 被描述为 helper binary，但没有进行详细分析。虽然 CTF 挑战可能需要使用此二进制文件来完成，但始终存在二进制文件中包含恶意代码的可能性。

考虑到以上几点，保守估计投毒风险为 10%。这种风险主要是由不完整的构建环境、CTF 设计陷阱的可能性以及二进制文件的潜在风险造成的。

**利用方式分析：**

1.  **环境准备：** 搭建存在漏洞的 polkit pkexec 环境，包括安装指定版本的 `libpolkit-gobject-1-0`、`libpolkit-agent-1-0` 和 `policykit-1`。
2.  **利用代码：** 利用已知的 PoC 代码（例如，通过构造特殊的环境变量）触发 pkexec 中的漏洞。
3.  **权限提升：** 成功利用漏洞后，攻击者可以执行任意代码，从而获得 root 权限。

**项目地址:** [wechicken456/CVE-2021-4034-CTF-writeup](https://github.com/wechicken456/CVE-2021-4034-CTF-writeup)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---



---

## POC #4

**来源**: [CVE-2021-4034-BugVex_Poison-HTB-Report.md](../2021/CVE-2021-4034-BugVex_Poison-HTB-Report.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可获取 root 权限

**影响版本:** all (受影响)

**利用条件:** 本地用户可以访问目标机器，且 pkexec 未打补丁

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 工具中的一个本地提权漏洞。由于 pkexec 未正确处理参数计数，攻击者可以通过构造特定的环境变量来执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞利用代码中展示了完整的利用步骤，包括编译恶意 payload，设置环境变量，然后运行 pkexec。搜索引擎结果也表明该漏洞在野外被广泛利用。

**投毒风险：**
提供的漏洞利用代码主要包含以下几个部分：
1.  **C 源代码 (payload.c)：** 用于生成共享对象 (payload.so)，该共享对象包含恶意代码。
2.  **Shell 命令：** 设置环境变量并运行 pkexec。

风险分析：
*   **payload.c 的内容：** 没有提供 `payload.c` 文件的具体内容，因此无法直接判断 payload 的行为。但是，从利用方式来看，该 payload 旨在利用 pkexec 的漏洞来执行恶意代码。
*   **环境变量设置：** 环境变量 `GCONV_PATH`、`CHARSET`、`LD_PRELOAD` 和 `PATH` 是利用该漏洞的关键。`GCONV_PATH` 和 `CHARSET` 用于加载恶意的 gconv 模块，`LD_PRELOAD` 用于预加载恶意的共享对象，`PATH` 用于确保恶意的 gconv 模块优先被加载。

虽然POC中涉及`payload.c` ,如果没有对源码进行恶意篡改和添加恶意代码, 本身是不存在投毒风险的,但是`payload.c`文件未给出,无法完全验证,存在潜在投毒风险，但是概率极低。

**利用方式：**
1.  **编译 Payload：** 首先，使用 GCC 编译 C 源代码 (payload.c) 生成共享对象 (payload.so)。编译时需要使用 `-shared` 和 `-fPIC` 选项。
2.  **创建 exploit 目录：** 创建一个名为 exploit 的目录，并将 payload.so 移动到该目录中。
3.  **创建 gconv-modules 文件：** 在 exploit 目录中创建一个名为 gconv-modules 的文件，该文件用于配置 gconv 模块。内容一般是 `module UTF-8// POC// payload 2`。
4.  **设置环境变量：** 设置以下环境变量：
    *   `GIO_USE_VFS=local`
    *   `PATH=./exploit:$PATH`
    *   `LD_PRELOAD=./exploit/payload.so`
    *   `GCONV_PATH=./exploit`
    *   `CHARSET=POC`
5.  **运行 pkexec：** 运行 pkexec 命令，这将触发漏洞并执行 payload.so 中的恶意代码，从而提升权限。

**项目地址:** [BugVex/Poison-HTB-Report](https://github.com/BugVex/Poison-HTB-Report)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #5

**来源**: [CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md](../2021/CVE-2021-4034-CYB3RK1D_CVE-2021-4034-POC.md)

## CVE-2021-4034-Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可执行 pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 没有正确处理调用参数计数，导致程序尝试将环境变量作为命令执行。

**漏洞利用方式：**

1.  **利用 GCONV_PATH 和 CHARSET 环境变量：** 该漏洞利用通过精心构造 `GCONV_PATH` 和 `CHARSET` 环境变量，欺骗 `pkexec` 加载恶意的 gconv 模块。gconv 模块是用于字符集转换的动态链接库。
2.  **创建恶意 gconv 模块：** 攻击者创建一个包含恶意代码的 `.so` 文件（payload.so），并在 `gconv-modules` 文件中定义一个字符集转换规则，将特定的字符集（例如 `LPE`）映射到该恶意 `.so` 文件。
3.  **触发漏洞：** 当 `pkexec` 尝试执行字符集转换时，会加载并执行恶意 `.so` 文件中的代码，从而实现权限提升。
4.  **代码分析：** `pkexec_exploit.c` 首先创建必要的目录结构 (`GCONV_PATH=.`, `lpe`)，然后在 `lpe/payload.c` 中写入 shellcode，编译成动态链接库 `lpe/payload.so`。shellcode 的作用是设置 uid、gid 为 0，然后执行 `/bin/sh`。
5.   **投毒风险分析:** POC代码本身主要用于提权，但存在一定的投毒风险。例如，攻击者可能修改 `payload.c` 中的 shellcode，使其在提权后执行其他恶意操作，如安装后门程序、窃取用户数据等。虽然`pkexec_exploit.c`主要功能是利用漏洞进行权限提升，但其中的`payload.c`，可能包含潜在的恶意代码。payload.c中的恶意代码可能执行以下操作：下载并执行其他恶意程序、修改系统文件、创建具有root权限的后门帐户等。从防御的角度来看，所有来自外部的代码都应被视为潜在的威胁。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该漏洞的利用是有效的。POC 代码已经公开，并且有大量的文章和视频演示了如何利用该漏洞。

**总结：**

这是一个严重的安全漏洞，允许未经授权的用户获得系统 root 权限。系统管理员应尽快应用补丁程序来修复此漏洞。

**项目地址:** [CYB3RK1D/CVE-2021-4034-POC](https://github.com/CYB3RK1D/CVE-2021-4034-POC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #6

**来源**: [CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md](../2021/CVE-2021-4034-EuJin03_CVE-2021-4034-PoC.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** 所有版本 (修复前)

**利用条件:** 本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户身份运行命令，具体权限取决于预定义的策略。

**漏洞利用方式：**

1.  **漏洞原理：** pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。通过精心构造环境变量，攻击者可以诱使pkexec执行任意代码。

2.  **利用代码分析：**
    *   `cve-2021-4034.c`:  该C代码负责设置特定的环境变量并执行`/usr/bin/pkexec`。关键的环境变量包括：
        *   `pwnkit.so:.`:  这指示动态链接器在当前目录中查找名为`pwnkit.so`的共享对象。
        *   `PATH=GCONV_PATH=.`:  这会将`PATH`环境变量设置为`GCONV_PATH=.`， 影响程序的路径查找方式.
        *   `CHARSET=PWNKIT`: 触发加载恶意gconv模块的关键。
        *   `GIO_USE_VFS=`: 清空`GIO_USE_VFS`环境变量，避免潜在的干扰。
    *   `pwnkit.c`:  该C代码定义了`gconv`和`gconv_init`函数。`gconv_init`函数是漏洞利用的核心，它被设计为在gconv模块加载时执行。此函数会设置uid和gid为0，然后执行`/bin/sh`，从而获得root shell。
    *   `gconv-modules`: 定义了一个gconv模块，将`PWNKIT`字符集映射到`pwnkit.so`库。
    *   `Makefile`:  用于编译漏洞利用代码，生成`pwnkit.so`共享对象和`cve-2021-4034`可执行文件。

3.  **利用步骤：**
    a.  编译`pwnkit.c`生成共享对象`pwnkit.so`。
    b.  创建一个`gconv-modules`文件，声明一个使用`pwnkit.so`的gconv模块。
    c.  执行`cve-2021-4034`，它会设置特定的环境变量并运行`pkexec`。`pkexec`会加载恶意的gconv模块，调用`gconv_init`函数，从而导致权限提升。

**有效性：**提供的PoC代码是有效的。它利用了pkexec中的参数处理漏洞，通过gconv模块机制执行预定义的shell，从而实现本地权限提升。

**投毒风险：** 此仓库存在极小的投毒风险。`dry-run`目录下的文件可以用来进行无害的测试。如果将 `dry-run-cve-2021-4034.c` 中的 `setuid(0)` 修改为恶意操作，则存在投毒可能。但原代码并未发现明显的恶意行为，判定投毒风险为1%。实际部署前需要进行代码审计。

**项目地址:** [EuJin03/CVE-2021-4034-PoC](https://github.com/EuJin03/CVE-2021-4034-PoC)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #7

**来源**: [CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md](../2021/CVE-2021-4034-FancySauce_PwnKit-CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** 所有版本 (漏洞修复前)

**利用条件:** 需要本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 中 pkexec 工具的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量来利用此漏洞，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析:**

1.  **漏洞原理:**  pkexec 没有正确处理传递给它的参数数量。 当参数数量不足时，它会尝试将环境变量作为程序执行。
2.  **利用方式:** 提供的 POC 代码利用了 `GCONV_PATH` 环境变量。`GCONV_PATH` 用于指定 gconv 模块的搜索路径，gconv 模块用于字符集转换。攻击者创建一个目录，并在该目录下创建一个名为 `gconv-modules` 的文件，该文件定义了一个恶意的 gconv 模块。然后，设置 `GCONV_PATH` 环境变量指向该目录，并触发 pkexec。pkexec 会加载恶意的 gconv 模块，该模块在 `gconv_init` 函数中执行 `setuid(0)`、`setgid(0)`、`setgroups(0)` 和 `execve("/bin/sh", NULL, NULL)`，从而获得 root shell。
3.  **POC代码分析:**
    *   `Makefile`: 用于编译恶意的共享库 `evil.so` 和利用程序 `exploit`。
    *   `evil-so.c`: 包含恶意代码，该代码在加载时会设置 uid、gid 和 groups 为 0，并执行 `/bin/sh`，创建一个 root shell。
    *   `exploit.c`: 创建必要的目录和文件结构，设置环境变量，并执行 `pkexec`。

**有效性:**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，可以判断该 POC 代码是有效的。 漏洞利用代码构造了特定的环境，利用 pkexec 的漏洞执行恶意代码，从而实现提权。

**投毒风险:**

代码中没有明显的投毒行为。`evil-so.c`的目的就是提权，这符合漏洞利用的需求。没有发现任何在提权之外执行其他恶意操作的代码。 风险评估为 0%。


**项目地址:** [FancySauce/PwnKit-CVE-2021-4034](https://github.com/FancySauce/PwnKit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #8

**来源**: [CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md](../2021/CVE-2021-4034-JohnGilbert57_CVE-2021-4034-Capture-the-flag.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升为root权限

**影响版本:** 所有版本（受影响版本）

**利用条件:** 目标系统必须安装易受攻击的Polkit版本，且攻击者需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 没有正确处理调用参数的个数，导致尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞描述、搜索结果和提供的漏洞利用代码，该漏洞是有效的。搜索结果中多个链接（例如，Qualys 的博客文章、Red Hat 的安全公告）都确认了该漏洞的存在，并提供了利用的细节。提供的 POC 代码旨在利用此漏洞。

**投毒风险：**
提供的 exploit.c 代码的功能是：
1.  创建 `GCONV_PATH=.` 目录。
2.  创建 `GCONV_PATH=./exploit` 文件，并赋予执行权限。
3.  创建 `exploit` 目录。
4.  创建 `exploit/gconv-modules` 文件，包含 gconv 模块的配置信息。
5.  创建 `exploit/shelltospawn.c` 文件，包含 C 代码，该代码将设置 uid 和 gid 为 0，并执行 `/bin/bash`。
6.  编译 `exploit/shelltospawn.c` 为共享库 `exploit/ISO646.so`。
7.  使用 `execve` 函数，设置特殊的环境变量（`PATH`, `CHARSET`, `SHELL`），并执行 `/usr/bin/pkexec`。

这个利用方法利用了 `gconv` 机制中的一个漏洞，允许通过环境变量加载恶意共享库，从而执行提权操作。

从代码本身来看，没有明显的**直接的后门代码**，例如植入 SSH 密钥或创建后门账户。然而，`system("/bin/bash")` 这行代码的功能是启动一个 root shell，攻击者可以使用该 shell 执行任何操作。因此，可以将整个利用过程视为一种投毒，因为它的最终结果是在目标系统上留下一个可以完全控制系统的 root shell。

 考虑到这种最终结果，将投毒风险评为 10% 是考虑到存在其他利用此漏洞的方式，而当前提供的 exploit.c 更加侧重于漏洞利用本身。

**利用方式：**
1.  **环境准备：** 创建必要的目录和文件，包括 `GCONV_PATH` 和包含恶意代码的共享库。
2.  **配置 gconv：** 创建 `gconv-modules` 文件，配置 gconv 模块，使其加载恶意的共享库。
3.  **设置环境变量：** 设置 `PATH`、`CHARSET` 和 `SHELL` 环境变量，以便 pkexec 能够加载恶意的 gconv 模块。
4.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，触发漏洞，加载恶意代码，从而获得 root 权限。

利用的关键在于 `pkexec` 在处理环境变量时存在漏洞，允许攻击者控制加载的 gconv 模块，从而执行任意代码。

**项目地址:** [JohnGilbert57/CVE-2021-4034-Capture-the-flag](https://github.com/JohnGilbert57/CVE-2021-4034-Capture-the-flag)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #9

**来源**: [CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md](../2021/CVE-2021-4034-LucasPDiniz_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (Pwnkit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** <= 0.105

**利用条件:** 本地用户访问，pkexec setuid root程序存在且未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (Pwnkit) 漏洞是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid-root 程序，允许授权用户以特权用户身份执行命令。该漏洞源于 pkexec 在处理命令行参数时存在缺陷，导致可以覆盖环境变量。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。漏洞利用代码通过利用 pkexec 的参数处理缺陷来覆盖环境变量，尤其是 `GCONV_PATH`。通过设置 `GCONV_PATH` 指向包含恶意共享对象的目录，并设置 `CHARSET` 触发 glibc 的 gconv 机制，加载恶意共享对象，从而执行任意代码。

**投毒风险:**
提供的PoC代码本身看起来是一个完整的漏洞利用程序，但存在一些潜在的投毒风险，概率为10%。
1.  **`rm -rf 'GCONV_PATH=.' 'pwnkit'`**:  此命令旨在清理利用过程中创建的文件和目录。但如果目标系统上存在同名但重要的文件或目录，则可能造成意外删除。
2.  **对/bin/sh的依赖性**脚本依赖于 /bin/sh 的存在和功能。在某些受限环境中，/bin/sh可能不存在或受到限制，从而导致利用失败。攻击者可能通过其他命令达到破坏的目的。

**利用方式:**
1.  **准备恶意共享对象：** 首先，创建一个包含 shellcode 的 C 文件（例如 `pwnkit.c`）。该 shellcode 的作用是设置有效的用户和组 ID (UID/GID) 为 0 (root)，然后执行一个 shell (通常是 `/bin/sh`)。
2.  **编译恶意共享对象：** 使用 GCC 将 C 文件编译成共享对象 (`.so` 文件)，例如 `pwnkit.so`。
3.  **创建 GCONV_PATH 目录：** 创建一个名为 `GCONV_PATH=.` 的目录，并创建一个空文件 `GCONV_PATH=./pwnkit`。这是为了欺骗 pkexec 在当前目录中查找 gconv 模块。
4.  **创建 gconv-modules 文件：** 创建一个名为 `gconv-modules` 的文件，其中包含指定自定义 gconv 模块的配置信息。
5.  **设置环境变量并执行 pkexec：** 设置环境变量 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。然后，不带任何参数执行 `pkexec`。由于 pkexec 的参数处理缺陷，这会导致覆盖环境变量，并触发 gconv 机制加载并执行恶意共享对象，从而获得 root 权限。

**总结:**
CVE-2021-4034 是一个严重的安全漏洞，可以被本地低权限用户利用来获得 root 权限。该漏洞利用简单，影响广泛，需要及时修复。虽然提供的 PoC 代码看起来直接，但仍需警惕潜在的投毒风险，并在测试环境中仔细评估。

**项目地址:** [LucasPDiniz/CVE-2021-4034](https://github.com/LucasPDiniz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #10

**来源**: [CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md](../2021/CVE-2021-4034-Milad-Rafie_PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-.md)

## CVE-2021-4034-Polkit pkexec权限提升漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是一个存在于Polkit的pkexec工具中的本地权限提升漏洞。pkexec是一个setuid程序，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。该漏洞源于pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **构造恶意环境变量：** 利用代码通过创建`GCONV_PATH=.`目录，并在其中放置恶意的gconv模块配置文件`gconv-modules`。`gconv-modules`文件指示系统加载恶意的共享库`pwnkit.so`。
2.  **编译恶意共享库：**  利用代码编译一个包含提权代码的共享库`pwnkit/pwnkit.so`，该共享库在初始化时（`gconv_init`函数）将当前进程的UID和GID设置为0（root），然后执行一个shell。
3.  **执行pkexec：**  利用代码通过`execve`函数执行`/usr/bin/pkexec`，并传递构造好的环境变量，例如`PATH=GCONV_PATH=.`，`CHARSET=PWNKIT`等。
4.  **漏洞触发：**  当pkexec尝试加载gconv模块时，由于`GCONV_PATH`被设置为恶意目录，它会加载攻击者提供的`pwnkit.so`，从而执行其中的提权代码，最终获得root shell。

**有效性：**

提供的POC代码是有效的。它已经在Debian 10和CentOS 7上验证成功，可以使非特权用户获得root权限。

**投毒风险：**

经过分析，提供的POC代码中没有发现明显的恶意代码或后门。该代码的目的是利用CVE-2021-4034漏洞进行本地权限提升，其行为符合漏洞描述和利用原理。作者可能存在的投毒风险极低(0%)。

**参考信息：**

*   漏洞库信息：CVE-2021-4034描述了该漏洞的细节和影响。
*   搜索引擎结果：搜索结果提供了有关该漏洞的更多信息，包括漏洞分析、利用方法和缓解措施。例如，Qualys的博客文章(webpage 2)详细介绍了该漏洞的利用方式。

**项目地址:** [Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-](https://github.com/Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #11

**来源**: [CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md](../2021/CVE-2021-4034-Part01-Pai_Polkit-Permission-promotion-compiled.md)

## CVE-2021-4034-Polkit pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统上存在pkexec且未修复漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户按照预定义的策略以特权用户身份运行命令。此漏洞的利用方式如下：

1.  **漏洞原理：** pkexec 在处理调用参数数量时存在缺陷，导致其尝试将环境变量作为命令执行，从而允许攻击者通过精心构造的环境变量来执行任意代码。
2.  **利用步骤：**
    *   创建一个包含恶意代码的动态链接库 (pwnkit.so)。该库的 `gconv_init` 函数会设置用户ID和组ID为0，然后执行一个shell。
    *   创建一个 `gconv-modules` 文件，用于告诉 `iconv` 如何使用恶意库将 UTF-8 转换为 PWNKIT 编码。
    *   设置 `GCONV_PATH=.` 环境变量，使 `iconv` 在当前目录中查找转换模块。
    *   运行利用程序 (exp)。这个利用程序会触发 pkexec 的漏洞，导致它加载并执行恶意动态链接库，从而获得 root 权限。
3.  **有效性评估：** 根据漏洞信息、搜索结果以及提供的PoC代码，该PoC代码**有效**，可以利用此漏洞实现本地提权。
4.  **投毒风险分析：** 提供的代码中，存在投毒的可能性较低，大约10%。主要风险在于`pwnkit.c`文件，在实际环境中，攻击者可以替换shell的路径或其他恶意代码，例如删除关键文件或植入后门。虽然当前代码的目标是提升权限，但恶意修改后可能造成更大的危害。`chmod -R 777 2>/dev/null` 这行代码较为可疑，虽然看起来像是为了确保执行权限，但也可能是为了方便植入后门或执行其他恶意操作，因为这样会允许任何用户修改这些文件。但考虑到这是已编译后的项目，赋予所有权限以方便使用也在情理之中,因此投毒风险较低。
5. **利用方式总结:** 通过构造特定的环境变量，特别是`GCONV_PATH`，以及相应的`gconv-modules`配置文件，使得`pkexec`加载恶意的动态链接库，该库在初始化时将当前进程的用户ID和组ID设置为0，并执行一个shell，从而获得root权限。

**项目地址:** [Part01-Pai/Polkit-Permission-promotion-compiled](https://github.com/Part01-Pai/Polkit-Permission-promotion-compiled)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #12

**来源**: [CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md](../2021/CVE-2021-4034-Pol-Ruiz_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** all

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034是Polkit的pkexec工具中的一个本地权限提升漏洞。pkexec是一个setuid工具，旨在允许非特权用户以特权用户的身份运行命令，基于预定义的策略。漏洞源于pkexec没有正确处理调用参数的计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量，诱使pkexec执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞描述和搜索结果，此漏洞确实存在并且影响范围较广，利用代码的存在也证实了其可利用性。

**投毒风险：**
提供的“漏洞利用代码”实际上是许可协议文件（LICENSE和LICENSE.md），并非实际的漏洞利用代码。因此，无法直接分析其是否存在投毒行为。但从信息安全角度考虑，任何来源不明的代码都存在潜在风险，此处假设存在较低的投毒风险(5%), 主要是担心下载/使用 POC 的过程中被替换或篡改。

**利用方式：**
1.  **构造恶意环境变量：** 攻击者构造特殊的环境变量，这些环境变量包含攻击者想要执行的恶意代码。
2.  **利用参数计数错误：** 由于`pkexec`在处理参数时存在缺陷，它会将构造的恶意环境变量作为命令来执行。
3.  **权限提升：**  通过执行恶意代码，攻击者可以获得root权限。

**补充说明:** 真正的POC代码通常会利用环境变量来执行shell命令或加载恶意共享库。由于未提供真正的POC代码，以上分析基于漏洞描述和搜索结果进行推断。

**项目地址:** [Pol-Ruiz/CVE-2021-4034](https://github.com/Pol-Ruiz/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #13

**来源**: [CVE-2021-4034-TheSermux_CVE-2021-4034.md](../2021/CVE-2021-4034-TheSermux_CVE-2021-4034.md)

## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许普通用户获得 root 权限

**影响版本:** all (受影响版本)

**利用条件:** 目标系统存在存在漏洞的pkexec程序，且用户能够在本地执行该程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞是 Polkit pkexec 程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。

**有效性：**

提供的 POC 代码有效。漏洞库信息和搜索结果表明该漏洞已被广泛研究并存在可用的利用代码。POC 利用代码利用了 pkexec 的参数处理错误，通过构造特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险：**

虽然直接的后门代码没有发现，但仍然存在一定的投毒风险。风险点在于以下几点：

*   `cve-2021-4034.sh` 脚本从远程 URL 下载利用代码。如果该 URL 被攻击者控制，则可以提供恶意代码。
*   `Makefile` 构建过程中可能存在隐蔽的恶意代码注入，尽管当前的 Makefile 看起来比较简单。
*   `pwnkit.c` 中 `execve` 执行 `/bin/sh`，如果目标系统的 `/bin/sh` 被篡改，可能导致执行恶意代码。虽然利用本身的目标是提权到 root，但如果结合其他漏洞或配置错误，也可能导致意想不到的后果。

综合评估，投毒风险为10%。

**利用方式：**

1.  **下载利用代码：** 首先，从给定的 URL 下载 `cve-2021-4034.c`, `pwnkit.c` 和 `Makefile` 文件。
2.  **编译利用代码：** 使用 `make` 命令编译 `pwnkit.c` 为动态链接库 `pwnkit.so`，并编译 `cve-2021-4034.c` 为可执行文件 `cve-2021-4034`。
3.  **构造环境变量：**  `cve-2021-4034.c` 设置特定的环境变量，包括:
    *   `pwnkit.so:.`  指定 GCONV 模块的路径。
    *   `PATH=GCONV_PATH=.`  设置 PATH 环境变量，欺骗 pkexec 从当前目录加载 GCONV 模块。
    *   `SHELL=/lol/i/do/not/exists`  设置一个不存在的 SHELL，这可能触发一些错误处理逻辑。
    *   `CHARSET=PWNKIT`  设置字符集为 PWNKIT，触发加载指定的 GCONV 模块。
    *   `GIO_USE_VFS=`  可能用于绕过某些安全限制。
4.  **执行 pkexec：**  `cve-2021-4034.c`  使用 `execve` 执行 `/usr/bin/pkexec`。 由于环境变量设置不当，pkexec 将会尝试加载恶意 GCONV 模块 `pwnkit.so`。
5.  **GCONV 模块执行：** `pwnkit.so` 中的 `gconv_init` 函数被调用，该函数设置用户 ID 和组 ID 为 0 (root)，然后执行 `/bin/sh`，从而获得 root 权限。

总之，该利用利用了 pkexec 的参数处理缺陷和 GCONV 机制，通过构造恶意环境变量来加载恶意代码，最终实现提权。

**项目地址:** [TheSermux/CVE-2021-4034](https://github.com/TheSermux/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #14

**来源**: [CVE-2021-4034-Typical0day_CVE-2021-4034.md](../2021/CVE-2021-4034-Typical0day_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户，pkexec具有SUID权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞存在于 pkexec 处理参数计数的方式，导致它可以将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞的 POC 代码是有效的。搜索引擎结果显示多个安全厂商已经确认并提供了利用方法。提供的代码包含 Makefile、C 源代码以及利用说明，表明这是一个可工作的 Exploit。

**投毒风险：**

分析提供的 POC 代码内容，投毒风险评估为10%。

*   `LICENSE` 文件：标准的 MIT 许可证，表明代码是开源的，增加了透明度。
*   `Makefile` 文件：用于编译 exploit，没有发现可疑操作。
*   `README.md` 文件：提供漏洞说明、利用方法和缓解措施，描述清晰。
*   `pwnkit.c` 文件：实现了利用 GCONV_PATH 环境变量进行提权的关键逻辑。需要进一步审计，但是表面上没有发现恶意行为。
*   `cve-2021-4034.c` 文件：主程序，负责设置环境变量并执行 pkexec。同样需要进一步审计。
    `gconv-modules`: 指定了要使用的gconv模块,用于触发漏洞

虽然没有明显的恶意代码，但是仍然存在风险。例如，`pwnkit.c` 和 `cve-2021-4034.c` 中可能存在隐藏的后门或触发条件，这些后门只有在特定环境下才会激活。此外，该代码可能依赖于某些特定的系统配置或库版本，如果目标系统不满足这些条件，exploit 可能会失败，或者产生未知的副作用。

因此，在使用此 POC 之前，务必进行代码审计，并在隔离环境中进行测试。

**利用方式：**

利用方式主要通过以下步骤：

1.  **编译：** 使用 `make` 命令编译 `pwnkit.so` (共享库) 和 `cve-2021-4034` (主程序)。同时创建 `gconv-modules` 文件，内容指定了要加载的gconv模块以及创建相关的目录结构。
2.  **环境变量设置：** Exploit 通过设置 `GCONV_PATH` 和 `GCONV_MODULES` 环境变量来利用该漏洞。
3.  **触发漏洞：** 运行编译后的 `cve-2021-4034` 程序，它会调用 `pkexec`，由于环境变量的设置，`pkexec` 会尝试加载恶意的 `pwnkit.so` 共享库。
4.  **代码执行：** `pwnkit.so` 共享库中的代码会被执行，从而获得 root 权限。
5.  **提权：** 在 `pwnkit.so` 中，通过调用 `setuid(0)` 和 `setgid(0)` 将进程的 UID 和 GID 设置为 0 (root)，从而获得 root 权限。最后，执行 shell 命令，允许攻击者在目标系统上执行任意操作。

**项目地址:** [Typical0day/CVE-2021-4034](https://github.com/Typical0day/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #15

**来源**: [CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-X-Projetion_Exploiting-PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 - Polkit pkexec 本地提权漏洞 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** All (受影响版本)

**利用条件:** 需要本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 polkit 的 pkexec 工具中。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地提权。

**有效性：**
提供的 PoC 代码是有效的，利用了 pkexec 的环境变量处理缺陷。利用方式包括编译 C 代码生成共享库，然后设置特定的环境变量来触发漏洞，最终执行恶意代码以获得 root 权限。从搜索引擎结果和漏洞库信息来看，该漏洞的 PoC 已经被广泛公开，并且有大量的成功利用案例。

**投毒风险：**
该仓库中存在少量投毒风险，大约为 10%。

虽然主要代码是为了利用漏洞，但是sh脚本中存在`(sleep 1 && rm ./PwnKit & )`，该命令会在执行漏洞利用程序后删除自身。这可以被视为一种轻微的混淆手段，虽然并非直接注入恶意代码，但增加了分析和溯源的难度。所以存在一定投毒风险。

**利用方式：**
1.  **利用核心：** 利用 `pkexec` 程序解析参数时的漏洞，将恶意代码注入到环境变量中。
2.  **创建 GCONV_PATH：**  创建目录 `GCONV_PATH=.` 和 `.pkexec`，以及文件 `.pkexec/gconv-modules`，用于欺骗 `pkexec` 程序加载自定义的 gconv 模块。
3.  **编译恶意共享库：**  将 `PwnKit.c` 编译为共享库 `PwnKit.so`，其中包含 `entry` 和 `gconv` 函数。`entry` 函数负责设置环境变量，`gconv` 函数负责执行提权后的操作。
4.  **设置环境变量：**  设置 `PATH`、`CHARSET`、`SHELL` 等环境变量，使得 `pkexec` 程序加载恶意的 gconv 模块。
5.  **执行 pkexec：**  执行 `/usr/bin/pkexec` 或 `pkexec` 程序，触发漏洞，执行 `gconv` 函数中的提权代码。
6.  **提权：** `gconv` 函数会设置 uid 和 gid 为 0，然后执行 `CMD` 环境变量指定的命令，或者启动一个 root shell。
7. **清理:** 在成功执行利用后,清除恶意目录和文件。

综上，该 PoC 代码有效，但存在少量投毒风险，利用方式清晰，可实现本地提权。

**项目地址:** [X-Projetion/Exploiting-PwnKit-CVE-2021-4034-](https://github.com/X-Projetion/Exploiting-PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #16

**来源**: [CVE-2021-4034-Y3A_CVE-2021-4034.md](../2021/CVE-2021-4034-Y3A_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 所有版本 (在修复之前)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞的根本原因是 pkexec 未能正确处理调用参数计数，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用方式：**

1.  **创建恶意 GCONV 模块:** POC 代码首先创建一个目录结构 `/tmp/GCONV_PATH=.` 和 `/tmp/getpwned`，并在其中创建一个名为 `gconv-modules` 的文件。此文件用于配置 iconv 字符集转换。
2.  **gconv-modules 文件的内容:** `gconv-modules` 文件定义了两个字符集转换规则，将 UTF-8 和 INTERNAL 字符集映射到位于 `/tmp/shell.so` 的恶意共享库。  路径中使用了相对路径跳转，这是为了绕过一些安全检查。
3.  **创建恶意共享库 (shell.so):**  POC 代码使用 `shell.c` 创建了一个共享库 `/tmp/shell.so`。此库包含一个 `gconv_init` 函数，该函数在加载时会被执行。`gconv_init` 函数设置用户的 UID 和 GID 为 0 (root)，然后执行 `/bin/sh`，从而产生一个 root shell。
4.  **创建利用程序 (hax):**  POC 代码使用 `hax.c` 创建一个利用程序 `/tmp/hax`。此程序使用 `execve` 函数执行 `/usr/bin/pkexec`，并传递一组精心构造的环境变量，包括 `PATH=GCONV_PATH=.`、`CHARSET=UTF-16` 和 `SHELL=yeahdoesntexist`。设置`CHARSET=UTF-16` 触发了iconv_open()的调用，利用了`GCONV_PATH=.`查找恶意共享库，而 `SHELL=yeahdoesntexist` 触发了 g_printerr()，都保证共享库能够被加载。
5.  **执行利用程序:**  POC 代码最后执行 `/tmp/hax`，这将触发 pkexec 的漏洞，加载恶意共享库，并生成一个 root shell。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的 POC 代码，此漏洞利用代码是有效的。多个来源证实了该漏洞的存在和可利用性，并且 POC 代码实现了利用该漏洞的步骤。

**投毒风险：**

虽然此 POC 代码主要用于演示漏洞利用，但仍然存在一些潜在的投毒风险：

*   **依赖 /tmp 目录：**  代码大量使用 `/tmp` 目录。如果攻击者能够控制 /tmp 目录的创建或文件内容，可能会篡改 POC 代码，导致意外行为或其他恶意活动。
*   **后门植入:**  shell.c 中设置了 setuid(0) 等操作，如果被修改为连接到外部服务器，则会造成比较严重的后门。
*   **权限问题:**   POC 代码包含 `chmod +x` 命令，这可能会意外地修改文件权限，从而导致安全问题。
*   **代码复杂性：** 尽管 POC 代码相对简单，但它仍然包含 C 代码和 shell 脚本。攻击者可能会利用代码的复杂性来隐藏恶意代码。

综合考虑，投毒风险较低，估计为 10%。主要风险在于代码依赖 `/tmp` 目录，并且代码中共享库本身可以被作为后门来修改。


**项目地址:** [Y3A/CVE-2021-4034](https://github.com/Y3A/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #17

**来源**: [CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md](../2021/CVE-2021-4034-Z3R0-0x30_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** 所有版本

**利用条件:** 本地用户可以访问pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034（Pwnkit）是Polkit的pkexec实用程序中的本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是pkexec没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **漏洞原理：** pkexec在处理参数时存在缺陷，导致它可以将某些环境变量的内容误认为是要执行的命令。通过精心构造环境变量，可以劫持程序的执行流程。

2.  **POC分析：** 提供的POC利用了glibc的gconv机制。`gconv`用于处理字符集转换。POC首先创建了一个恶意的`zero.so`共享对象，其中包含`gconv_init`函数，该函数会设置UID和GID为0，然后执行/bin/bash。然后创建一个`gconv-modules`文件，将`UTF-8`编码转换为`ZERO`编码时加载`zero.so`。接着，设置`GCONV_PATH=.`，并复制`zero.so`到当前目录，强制glibc加载当前目录下的`gconv`模块。最后，创建一个`zero_exploit.c`程序，设置一些环境变量，其中`CHARSET=ZERO`触发字符集转换，从而加载恶意的`zero.so`，提权执行bash。

3.  **有效性：** POC代码有效，可以成功利用CVE-2021-4034漏洞，在未打补丁的系统上获得root权限。搜索引擎结果和漏洞库信息均表明该漏洞易于利用，且已存在公开的利用代码。

4.  **投毒风险：** 仓库中存在投毒代码的可能性较低，估计为5%。虽然主要代码是漏洞利用，但不能完全排除作者在脚本中加入恶意命令的可能性。但总体来看，脚本内容直接，没有发现明显的恶意行为。

**项目地址:** [Z3R0-0x30/CVE-2021-4034](https://github.com/Z3R0-0x30/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #18

**来源**: [CVE-2021-4034-artemis-mike_cve-2021-4034.md](../2021/CVE-2021-4034-artemis-mike_cve-2021-4034.md)

## CVE-2021-4034-polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。漏洞在于 pkexec 未能正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
提供的 PoC 代码利用了上述漏洞，通过构造特定的环境变量 `GCONV_PATH=.` 和 `LC_MESSAGES=en_US.UTF-8` ，使得 pkexec 尝试加载当前目录下的 Gconv 模块。这个 Gconv 模块实际上是一个恶意共享对象 (payload.so)，包含提权代码。 编译后的c文件, 通过设置uid，guid为0，即root权限, 再执行 `whoami`命令。

**投毒风险：**
此仓库可能存在轻微的投毒风险，几点考虑如下：

1.  **外部依赖：** Playbook使用了 `asses_CVE-2021-4034.yml`，需要用户手动修改`hosts` 变量,执行`ansible-playbook` 命令。 如果playbook内容被篡改可能会造成非预期结果。
2.  **代码可读性：**  代码可读性一般，存在少量注释。虽然作者声明仅用于教育目的，并且提示用户对执行的代码负责，但仍然可能存在潜在的风险。
3. **payload.c潜在风险:** `payload.c` 中虽然执行的是 `whoami`, 但如果被修改成其他恶意命令，可能会造成破坏。
4. 提供的YAML文件尝试删除利用过程中创建的临时文件，但不能保证所有文件都被完全清理。如果清理不彻底，可能会留下潜在的安全隐患。

**总体而言，投毒风险较低，大概为 10%。主要是playbook执行的不可控因素，以及payload.c被篡改的风险。**

**利用方式：**
1.  **编译PoC：** 使用 `gcc -Wall cve-2021-4034.c -o cve-2021-4034-exploit` 命令编译 C 语言 PoC 代码。
2.  **修改Playbook:**  修改 `asses_CVE-2021-4034.yml` 中的 `hosts` 变量，指定目标主机。
3.  **执行Playbook：** 使用 `ansible-playbook -i </path/to/inventory.yml> </path/to/playbooks/>asses_CVE-2021-4034.yml` 命令执行 Ansible playbook。
4.  **验证结果：** 检查 playbook 的执行结果。如果 `Check result of privilege escalation` 任务失败，则表示提权成功。

实际上，该 exploit 的核心思路是通过创建 GCONV_PATH 目录和 LC_MESSAGES 环境变量，使得 pkexec 尝试加载恶意共享对象，从而执行共享对象中的提权代码。该代码首先将当前进程的 UID 和 GID 设置为 0 (root)，然后再执行 whoami 命令。如果执行成功, `whoami` 的结果将是 root，表示提权成功。

**项目地址:** [artemis-mike/cve-2021-4034](https://github.com/artemis-mike/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #19

**来源**: [CVE-2021-4034-asepsaepdin_CVE-2021-4034.md](../2021/CVE-2021-4034-asepsaepdin_CVE-2021-4034.md)

## CVE-2021-4034 (PwnKit)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许非特权用户获得root权限

**影响版本:** 所有受影响版本

**利用条件:** 目标系统存在 Polkit pkexec 且未修复

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 Polkit pkexec 实用程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，最终导致尝试将环境变量作为命令执行。攻击者可以通过精心制作环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**

根据漏洞描述、搜索结果和提供的 PoC 代码，可以判定该漏洞是有效的。多个来源（包括 NVD、Qualys、Red Hat 等）都确认了此漏洞，并且存在公开可用的 PoC 代码。该 PoC 代码通过创建特定的目录结构和环境变量来利用此漏洞，从而导致 pkexec 执行攻击者控制的代码，最终提升到 root 权限。

**投毒风险：**

分析提供的 PoC 代码 `cve-2021-4034-poc.c`。代码首先创建 `GCONV_PATH=.` 目录和 `pwnkit` 目录，然后将恶意 shellcode 写入 `pwnkit/pwnkit.c`，编译成动态链接库 `pwnkit/pwnkit.so`。最后，通过设置环境变量 `pwnkit`, `PATH`, `CHARSET` 和 `SHELL` 并调用 `execve("/usr/bin/pkexec", (char*[]){NULL}, env)` 来触发漏洞。其中 `pwnkit/pwnkit.c` 中包含的代码负责提升权限并执行 `/bin/sh`。

代码本身利用了漏洞，没有发现明显的恶意后门或植入代码，判断投毒风险为 0%。

**利用方式：**

1.  **环境准备：** 创建 `GCONV_PATH=.` 目录，并创建一个名为 `GCONV_PATH=./pwnkit` 的文件（用于欺骗 pkexec）。创建一个 `pwnkit` 目录，其中包含 `gconv-modules` 文件，指定使用自定义的 gconv 模块。
2.  **恶意 GConv 模块：** 创建一个恶意的 gconv 模块（`pwnkit/pwnkit.c`），该模块包含在加载时提升权限并执行 shell 的代码。
3.  **编译：** 将该 C 代码编译成共享对象（`.so` 文件），作为 gconv 模块。
4.  **环境变量：** 设置特定的环境变量，例如 `GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`，以便 pkexec 加载恶意的 gconv 模块。
5.  **触发：** 运行 pkexec，由于参数处理不当，pkexec 将加载并执行恶意的 gconv 模块，从而提升权限并执行 shell。

**项目地址:** [asepsaepdin/CVE-2021-4034](https://github.com/asepsaepdin/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #20

**来源**: [CVE-2021-4034-battleoverflow_CVE-2021-4034.md](../2021/CVE-2021-4034-battleoverflow_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，未经授权的用户可以获得root权限

**影响版本:** all

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 存在于 polkit 的 pkexec 实用程序中。pkexec 应用程序是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。当前版本的 pkexec 未能正确处理调用参数计数，最终尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码来利用此漏洞。成功执行后，攻击会导致本地权限提升，从而使非特权用户获得目标计算机的管理权限。

**有效性评估：**
提供的PoC代码看起来有效。根据漏洞描述和搜索结果，该漏洞利用了 pkexec 对参数处理不当的缺陷，通过设置特定的环境变量来执行恶意代码，从而实现提权。

**投毒风险评估：**
对提供的代码进行分析，并未发现明显的投毒后门。代码的目的是创建一个利用 CVE-2021-4034 漏洞的利用程序。

*   `LICENSE` 和 `README.md` 提供了代码的版权信息和使用说明，没有可疑内容。
*   Python 脚本 `CVE-2021-4034.py` 旨在利用 pkexec 漏洞，它通过创建特定目录结构和文件，并编译一个 C 代码片段来实现提权。这段 C 代码的目的是设置用户ID和组ID为0（root），然后执行一个shell。虽然这段C代码本身具有提权的功能，但它与漏洞利用的上下文相符，不应被视为恶意后门，属于漏洞利用的必要组成部分。

代码片段 `os.system("export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' 'pwnkit'; /bin/sh")` 意图清除可能存在的恶意目录，并通过 `/bin/sh` 启动一个 root shell。这是一个标准的利用步骤，不是恶意行为。

但是依旧存在通过修改C代码内容达到植入后门，或捆绑恶意程序，达到投毒目的。因此投毒风险占比5%。

**利用方式：**
1.  **环境准备：** 创建特定的目录结构 `GCONV_PATH=.` 和文件 `GCONV_PATH=./pwnkit`。
2.  **编译恶意代码：** 使用 C 语言编写的恶意代码（设置 setuid 等）编译为动态链接库或可执行文件。
3.  **环境变量注入：** 通过构造特定的环境变量（如 GCONV_PATH）诱使 pkexec 加载并执行恶意代码。
4.  **提权：** 成功执行后，当前用户获得 root 权限，可以执行任意系统命令。

**项目地址:** [battleoverflow/CVE-2021-4034](https://github.com/battleoverflow/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #21

**来源**: [CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md](../2021/CVE-2021-4034-cdxiaodong_CVE-2021-4034-touch.md)

## CVE-2021-4034-Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许本地普通用户获取root权限

**影响版本:** 所有版本

**利用条件:** 目标系统存在polkit的pkexec程序且未打补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 漏洞是 polkit pkexec 程序中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**漏洞分析：**
该漏洞源于 pkexec 在处理调用参数计数时存在缺陷，导致程序尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而实现本地权限提升。

**利用方式：**
1.  **编译 PoC 代码：** 首先，需要编译提供的 Makefile 文件，生成 `pwnkit.so`、`cve-2021-4034`、`gconv-modules` 和 `GCONV_PATH` 相关文件和目录。
2.  **构造环境变量：** 关键在于设置 `GCONV_PATH=.` 和 `CHARSET=PWNKIT` 以及修改 `gconv-modules` 文件，使得 `pkexec` 在执行过程中加载恶意共享库 `pwnkit.so`。
3.  **执行 cve-2021-4034：** 运行编译后的 `cve-2021-4034` 程序，该程序设置特定的环境变量并调用 `/usr/bin/pkexec`。
4.  **pwnkit.so执行：**  `pwnkit.so` 的 `gconv_init` 函数会被执行，该函数会获取环境变量`PWNKIT_ARG`的值，并使用`setuid(0)`和`setgid(0)`来将当前进程的用户ID和组ID设置为root用户,然后使用`execve`来执行`/bin/touch`命令，并将`PWNKIT_ARG`作为参数传递给`/bin/touch`命令，从而以root权限创建文件。注意：如果`PWNKIT_ARG`为空，则`/bin/touch`命令后面只有一个null参数，所以不会创建文件。

**有效性：**
提供的 PoC 代码是有效的。参考搜索结果中的相关文章和漏洞分析，该漏洞利用方式已被广泛验证和利用。

**投毒风险：**
经过对 PoC 代码的分析，该代码主要目的是利用 `pkexec` 的漏洞进行本地提权，没有发现作者隐藏的恶意代码或后门。代码逻辑清晰，没有明显的投毒迹象，因此，投毒风险为 0%。

**缓解措施：**
1.  及时更新 polkit 到最新版本，修复此漏洞。
2.  如果无法立即更新，可以暂时删除 pkexec 的 setuid 权限：`chmod 755 /usr/bin/pkexec` (但会影响 polkit 的正常功能)。

**项目地址:** [cdxiaodong/CVE-2021-4034-touch](https://github.com/cdxiaodong/CVE-2021-4034-touch)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #22

**来源**: [CVE-2021-4034-cerodah_CVE-2021-4034.md](../2021/CVE-2021-4034-cerodah_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** all (受影响版本直至修复)

**利用条件:** 本地用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034（PwnKit）是 polkit 的 pkexec 实用程序中的本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，从而导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性分析：**

根据漏洞库信息、搜索引擎结果（尤其是 Qualys 的博客文章）和提供的 PoC 代码，该漏洞是有效的，并且已被积极利用。

**投毒风险分析：**

PoC 代码分析：

*   `README.md`：包含漏洞的简要描述、polkit 的作用、漏洞的缓解措施，未发现恶意代码。
*   `cve-2021-4034-poc.c`：这是 PoC 代码的核心部分。它利用 `GCONV_PATH` 环境变量来加载恶意共享库。该库中的 `gconv_init` 函数被设计为在执行时设置 uid 和 gid 为 0，并执行 `/bin/sh`，从而创建一个 root shell。代码本身并未发现作者隐藏的恶意代码。

综合来看，该仓库的 PoC 代码目的明确，即利用 CVE-2021-4034 漏洞实现本地提权。代码结构清晰，主要通过设置环境变量和加载恶意共享库来触发漏洞。没有发现任何迹象表明作者在代码中加入了额外的、与漏洞利用无关的恶意功能或后门。因此，投毒风险较低，大约为 0%。

**利用方式分析：**

1.  **创建 GCONV_PATH 目录和触发文件：** PoC 代码首先创建 `GCONV_PATH=.` 目录，并创建一个名为 `pwnkit` 的文件，并赋予执行权限，用来欺骗 pkexec。
2.  **创建 gconv-modules 文件：** 在 `pwnkit` 目录下，创建一个 `gconv-modules` 文件，声明一个字符集转换模块，指定了恶意共享库的路径。
3.  **创建恶意共享库：** PoC 代码创建一个 C 源代码文件 `pwnkit/pwnkit.c`，其中包含 `gconv` 和 `gconv_init` 函数。`gconv_init` 函数被设计为设置进程的 uid 和 gid 为 0，并执行 `/bin/sh` 命令，从而获得 root shell。
4.  **编译恶意共享库：** 使用 `gcc` 将 `pwnkit/pwnkit.c` 编译成共享库 `pwnkit/pwnkit.so`。
5.  **执行 pkexec：** 使用 `execve` 函数执行 `/usr/bin/pkexec`，同时设置环境变量 `pwnkit`、`PATH=GCONV_PATH=.`、`CHARSET=PWNKIT` 和 `SHELL=pwnkit`。这些环境变量的设置会触发 pkexec 中的漏洞，导致加载恶意共享库并执行其中的代码，从而获得 root 权限。

**项目地址:** [cerodah/CVE-2021-4034](https://github.com/cerodah/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #23

**来源**: [CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md](../2021/CVE-2021-4034-dh4r4_PwnKit-CVE-2021-4034-.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，遵循预定义的策略。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经公开，并且存在可用的漏洞利用代码（POC）。多个安全厂商和研究团队已经验证了该漏洞的存在和利用方式。虽然提供的POC代码只是一个README.md文件，但根据漏洞描述，可以推断有效的POC代码需要利用精心构造的环境变量来执行恶意代码。

**投毒风险：**
提供的 POC 代码只是一个 README 文件，本身不包含任何可执行代码。 但是，如果从其他来源获取的漏洞利用代码，可能存在投毒风险。为了评估投毒风险，必须检查利用代码的以下内容:

1.  **来源的可靠性：** 代码是否来自受信任的来源？例如，知名的安全研究人员或组织。
2.  **代码审查：** 代码是否经过了审查？最好由多个安全研究人员进行独立的代码审查。
3.  **混淆：** 代码是否经过了混淆处理，使其难以理解？这可能是隐藏恶意行为的标志。
4.  **网络连接：** 代码是否尝试建立网络连接？如果代码尝试连接到未知的或可疑的服务器，则可能存在风险。
5.  **权限请求：** 代码是否请求了不必要的权限？如果代码请求的权限超过了其功能所需的范围，则可能存在风险。

由于当前提供的代码只是readme.md,所以风险较低，预估投毒风险为10%。

**利用方式：**
该漏洞的利用方式主要涉及以下步骤：

1.  **构造恶意环境变量：** 攻击者需要构造一组特殊的环境变量，这些环境变量会被 pkexec 错误地解析为命令。
2.  **执行 pkexec：** 攻击者执行 pkexec，触发漏洞。
3.  **提权：** pkexec 执行攻击者构造的恶意代码，导致攻击者获得 root 权限。

参考链接中有很多关于该漏洞的讨论和POC利用示例。

**项目地址:** [dh4r4/PwnKit-CVE-2021-4034-](https://github.com/dh4r4/PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #24

**来源**: [CVE-2021-4034-evkl1d_CVE-2021-4034.md](../2021/CVE-2021-4034-evkl1d_CVE-2021-4034.md)

## CVE-2021-4034-polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all

**利用条件:** 目标系统存在 polkit 且 pkexec 可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户的身份运行命令。漏洞利用方式如下：

1.  **漏洞原理：** pkexec 在处理参数计数时存在缺陷，导致它尝试将环境变量作为命令执行，从而可能导致任意代码执行。
2.  **利用方式：** 攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码。这个 POC 通过创建特定的目录结构和文件 (GCONV_PATH=. , exploit/gconv-modules) 以及设置特定的环境变量 (PATH, LC_MESSAGES, XAUTHORITY)，利用 gconv 机制加载恶意的共享库 (payload.so)。该共享库包含提权的 shellcode (通过 msfvenom 生成)，一旦加载，将会以 root 权限执行。
3.  **有效性评估：** 根据漏洞库信息、搜索结果，该漏洞被广泛利用，并且提供了 POC 代码。该 POC 利用了 polkit 的参数处理错误和 gconv 机制，应该能够有效提权。
4.  **投毒风险评估：** 该 POC 代码的主要功能是创建目录和文件，设置环境变量，然后调用 `execve` 执行 `/usr/bin/pkexec`。Payload 是使用 `msfvenom` 生成的，目的是反弹一个 root shell。虽然该 payload 可以替换成其他 payload，但该代码本身并未发现明显的投毒行为。代码的风险在于，如果攻击者替换了 payload，可能会植入恶意后门，但就提供的代码本身而言，投毒的可能性较低。作者的目的更多的是为了证明该漏洞的可利用性. 因此投毒风险为0%。

总而言之，该 POC 代码有效，并且可以稳定复现 CVE-2021-4034 漏洞，实现本地权限提升。

**项目地址:** [evkl1d/CVE-2021-4034](https://github.com/evkl1d/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #25

**来源**: [CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md](../2021/CVE-2021-4034-igonzalez357_CVE-2021-4034-PwnKit-.md)

## CVE-2021-4034 (PwnKit) Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，可使普通用户获得 root 权限

**影响版本:** 受影响版本：所有版本

**利用条件:** 本地用户，目标系统安装了 polkit 且 pkexec 可执行文件存在。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 包中 pkexec 工具的一个本地提权漏洞。

**有效性：**
提供的 POC 代码是有效的。漏洞描述表明，当 `pkexec` 在没有参数的情况下被调用时，它会尝试访问 `argv[1]`，但由于 `argc` 为 0，它会读取 `envp[0]`。通过精心构造环境变量，攻击者可以强制 `pkexec` 加载一个恶意的动态链接库，并在 root 权限下执行任意代码。

`cve-2021-4034.c` 代码通过将 `args` 设置为 `{NULL}` 并构造包含恶意环境变量的 `environ` 数组来触发此漏洞。`pwnkit.c` 是一个动态链接库，它包含将在 root 权限下执行的代码，即打开一个 shell。

**投毒风险：**

*   仓库中存在作者隐藏的投毒代码的可能性较低，初步判断为 10%。
*   `pwnkit.c` 会执行 `execve(args[0], args, envp);` 启动一个shell. 虽然`setuid(0);setgid(0);` 是提权操作，但这是漏洞利用本身的一部分，不是投毒代码。如果`pwnkit.c`包含恶意后门代码，例如反弹shell或添加后门用户，则可能是投毒。
*    `cve-2021-4034.c`的代码的功能是触发漏洞，本身不包含恶意代码。

**利用方式：**

1.  **编译 exploit 和恶意库：** 使用提供的 `gcc` 命令编译 `cve-2021-4034.c` 和 `pwnkit.c`。
2.  **创建 GCONV_PATH 目录：**  创建一个名为 `GCONV_PATH=.` 的目录。
3.  **创建 gconv-modules 文件：**  创建一个 `gconv-modules` 文件，包含指示系统加载恶意库的配置。
4.  **复制 true 命令到 GCONV_PATH：** 将 `true` 命令复制到 `GCONV_PATH`，并设置 `GCONV_PATH` 环境变量。
5.  **运行 exploit：**  执行编译后的 `cve-2021-4034` 程序。这将利用 pkexec 中的漏洞，加载 `pwnkit.so` 库，从而以 root 权限打开一个 shell。


**项目地址:** [igonzalez357/CVE-2021-4034-PwnKit-](https://github.com/igonzalez357/CVE-2021-4034-PwnKit-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #26

**来源**: [CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md](../2021/CVE-2021-4034-ikerSandoval003_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 Polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **编译exploit代码：** 首先需要编译提供的cve-2021-4034.c, pwnkit.c，以及生成gconv-modules。
2.  **构造恶意环境变量：**  利用代码设置了一系列环境变量，如 `pwnkit.so:.`, `PATH=GCONV_PATH=.`, `CHARSET=PWNKIT` 等。 其中PATH被设置为当前目录, 使得动态链接器优先加载当前目录下的恶意动态链接库。
3.  **执行 pkexec：** 通过 `execve` 函数执行 `/usr/bin/pkexec`，并传递构造好的环境变量。
4.  **利用 gconv 机制提权：**  `pwnkit.c` 中的 `gconv_init` 函数会被调用，该函数将当前用户设置为 root 用户 (uid 0, gid 0)，然后执行 `/bin/sh`，从而获得 root shell。

**有效性：**

根据漏洞信息和利用代码，该 PoC 代码有效。多个信息源表明 CVE-2021-4034 漏洞已被积极利用，并且该 PoC 的实现方式与公开的漏洞利用方法一致。

**投毒风险：**

分析提供的代码，存在轻微的投毒风险，可能性为5%。 风险点在于Makefile中包含TRUE=/bin/bash, 以及拷贝该文件到GCONV_PATH中，如果攻击者替换/bin/bash为其他恶意程序，可能存在隐患。但是结合其他信息,认为其目的是为了方便利用,增加稳定性和兼容性。

总的来说，提供的 PoC 代码是有效的，且投毒风险较低。 该漏洞影响范围广，利用简单，危害性高。

**项目地址:** [ikerSandoval003/CVE-2021-4034](https://github.com/ikerSandoval003/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #27

**来源**: [CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md](../2021/CVE-2021-4034-kali-guru_Pwnkit-CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** 所有版本

**利用条件:** 本地用户能够执行pkexec程序

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**利用方式：**

1.  漏洞的根源在于 pkexec 未能正确处理调用参数计数。它最终尝试将环境变量作为命令执行。
2.  攻击者通过构造特定的环境变量，诱使 pkexec 执行任意代码。
3.  利用代码中的 `main.py` 脚本首先编译 `cve-2021-4034-poc.c` PoC 代码，生成可执行文件 `exploit`。
4.  然后，运行编译后的 `exploit`，该程序利用漏洞提升权限。
5.  脚本随后尝试通过 `whoami`、`ls /root` 和 `cat /root/flag.txt` 命令来验证提权是否成功。这些命令尝试获取当前用户，列出 `/root` 目录的内容，并读取 `/root/flag.txt` 文件，而这些操作通常需要 root 权限。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞 PoC 代码是有效的。漏洞已经被广泛利用，并且已经有公开的利用代码。

**投毒风险：**

查看提供的利用代码，该利用代码编译并运行提供的 c 代码（cve-2021-4034-poc.c，未提供内容）。`main.py` 中仅包含编译和执行漏洞利用程序以及验证提权的命令。没有发现任何明显的投毒代码。因此，投毒风险为 0%。需要注意的是，如果提供的 `cve-2021-4034-poc.c` 文件本身被篡改，则可能存在后门或恶意行为。但是仅根据现有信息,可以判断 `main.py` 本身没有投毒。


**项目地址:** [kali-guru/Pwnkit-CVE-2021-4034](https://github.com/kali-guru/Pwnkit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #28

**来源**: [CVE-2021-4034-lsclsclsc_CVE-2021-4034.md](../2021/CVE-2021-4034-lsclsclsc_CVE-2021-4034.md)

## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户访问，pkexec程序存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。此漏洞源于pkexec未正确处理调用参数计数，导致其尝试将环境变量作为命令执行。攻击者可以通过精心设计的环境变量诱使pkexec执行任意代码，从而导致本地权限提升，使非特权用户获得目标机器上的管理员权限。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞真实存在且影响广泛，多个Linux发行版都受影响。公开的漏洞利用代码表明该漏洞可以被成功利用。

**投毒风险：** 提供的POC代码 `README.md` 文件内容过于简单，仅包含CVE编号，无法直接用于漏洞利用。因此，无法基于此文件本身来评估投毒风险。一般漏洞利用代码会包含恶意的后门代码，执行后可以获得机器的控制权。但此`README.md`文件仅仅是指示该漏洞。考虑到从其他来源获取漏洞利用代码的可能性，存在下载的代码中被植入恶意代码的风险。因此，评估投毒风险为10%考虑到readme文件的特殊性，风险较低。

**利用方式：** 漏洞利用方式通常涉及构造特定的环境变量，这些变量会被pkexec错误地解析并执行。攻击者可以利用此行为执行任意命令，通常用于提升到root权限。例如，攻击者可以创建一个环境变量，指向一个包含shell命令的文件，然后运行pkexec，使其执行该文件中的命令。

**项目地址:** [lsclsclsc/CVE-2021-4034](https://github.com/lsclsclsc/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #29

**来源**: [CVE-2021-4034-marcosChoucino_CVE-2021-4034.md](../2021/CVE-2021-4034-marcosChoucino_CVE-2021-4034.md)

## CVE-2021-4034 - polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户能够执行 pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，但需要预定义的策略。漏洞原因是 pkexec 没有正确处理调用参数的数量，最终试图将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

提供的POC代码包含三个文件和一个目录：`ataque.c`、`vulner.c`、`GCONV_PATH=/config.txt` 和 `README.md`。

1.  **vulner.c:**  这个文件模拟了一个存在漏洞的程序。它接收命令行参数，尝试在 PATH 中查找它们，并使用 `g_printerr` 打印一个字符串。重要的是，它使用 `g_strdup` 和 `g_find_program_in_path` 函数，这些函数可能会受到环境变量的影响。
2.  **ataque.c:** 这个文件用于触发漏洞。它设置了几个环境变量（`PATH`，`CHARSET`，`SHELL`）并调用了 `vulner.out`（编译自 `vulner.c`）。关键的环境变量是 `PATH=GCONV_PATH=.` 和 `CHARSET=INTERNAL`。结合`GCONV_PATH=/config.txt`以及添加.在`GNCOV...` 目录后的步骤，攻击者利用 `GCONV_PATH` 指向当前目录，然后 polkit 会尝试使用当前目录中的 `gconv-modules` 文件加载字符编码转换器。攻击者可以将恶意代码放置在 `gconv-modules` 文件中，以便在加载时执行。
3.  **GCONV_PATH=/config.txt:** 这定义了一个环境变量，似乎旨在覆盖默认的 gconv 路径，但实际使用中 `/config.txt` 内容为空，利用点在 `ataque.c` 中定义 `PATH=GCONV_PATH=.`，结合README中提示的添加`.`步骤。攻击者通过设置`GCONV_PATH`为`.`,然后polkit在查找gconv module的时候会查找当前目录，然后执行恶意代码。
4.  **README.md:**  包含漏洞利用的简要说明, 添加`.`在`GNCOV...` 目录后是必要步骤。

**有效性：**
提供的代码利用了环境变量操作，结合漏洞描述和搜索结果，以及环境变量`GCONV_PATH`与`CHARSET`的设置，POC代码很可能是有效的。具体需要编译 `ataque.c` 和 `vulner.c`，并在易受攻击的系统上执行 `ataque.out`。

**投毒风险：**
  - 虽然这个POC的主要目的是展示CVE-2021-4034漏洞的利用，但是代码中存在潜在的投毒风险。例如，攻击者可以修改`vulner.c`或者`ataque.c`，在提权之前执行其他恶意操作，如安装后门、收集信息等。但是整体代码的功能还是以演示提权为主。
 - `GCONV_PATH=/config.txt` 中，`/config.txt`文件为空，攻击者可能在上传后通过某种方式向其中写入恶意代码,但这不属于本代码范畴。

因此，投毒的概率较低，大约是5%。投毒风险主要在于利用此漏洞进行提权时，攻击者可能会加入额外的恶意代码。

**利用方式总结：**

1.  利用`pkexec`的参数处理错误，通过设置特殊的环境变量来触发漏洞。
2.  `PATH=GCONV_PATH=.`和`CHARSET=INTERNAL`环境变量的组合至关重要。
3.  设置`GCONV_PATH`为`.`，然后放置恶意的`gconv-modules`文件，诱使pkexec加载并执行其中的代码，从而提升权限。

**项目地址:** [marcosChoucino/CVE-2021-4034](https://github.com/marcosChoucino/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #30

**来源**: [CVE-2021-4034-mutur4_CVE-2021-4034.md](../2021/CVE-2021-4034-mutur4_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，可使低权限用户获得root权限

**影响版本:** 受影响版本 <= 0.105

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许未经授权的用户根据预定义的策略以特权用户身份运行命令。漏洞原因是 pkexec 在处理调用参数计数时存在缺陷，导致尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱导 pkexec 执行任意代码，从而获得 root 权限。

**利用方式：**

1.  **漏洞原理:** pkexec在没有正确处理参数的情况下，会尝试把环境变量当作命令执行，存在内存越界写入，从而getshell
2.  **POC 代码分析:**

    *   `Makefile`: 用于编译漏洞利用程序 `pwnkit.c`。 使用静态编译 `-static`，可以减少依赖，但会增加二进制文件的大小。
    *   `README.md`: 描述了漏洞和利用方法。
    *   `pwnkit.c`: 主要的漏洞利用代码，包含了利用漏洞的逻辑。

    *   `checkConditions` 函数：检查目标系统是否满足利用条件，例如 `gcc` 和 `pkexec` 是否存在，以及 pkexec 的版本是否在受影响的范围内（<=0.105）。
    *   `exploitVuln` 函数：包含利用漏洞的核心代码。 它创建特定的目录结构和文件，设置特殊的环境变量，并执行 `pkexec`。利用了 `GCONV_PATH` 环境变量来加载恶意共享库，从而实现提权。

3.  **利用过程：**

    *   创建 `GCONV_PATH=.` 和 `tmp` 目录。
    *   创建 `GCONV_PATH=./tmp` 文件。
    *   生成恶意的 gconv 模块 `tmp/gconv-modules`，包含 `module UTF-8// EXPLOIT// preload 2`
    *   编译包含提权代码的共享库 `tmp/preload.c`，该代码在初始化时调用 `setreuid(0, 0)` 和 `setregid(0, 0)`，然后执行 `/bin/sh`。
    *   设置环境变量 `CHARSET=EXPLOIT`，`SHELL=xxx` 和 `PATH=GCONV_PATH=.`。
    *   执行 `pkexec`，由于环境变量的设置，`pkexec` 会加载恶意的 gconv 模块，执行其中的提权代码，从而获得 root shell。

**有效性：**

提供的 POC 代码是有效的，可以成功利用 CVE-2021-4034 漏洞在目标系统上实现本地提权。

**投毒风险：**

代码中存在一定程度的投毒风险。虽然代码的主要目的是利用已知的漏洞，但可能存在以下情况：

*   **后门代码：** 虽然没有发现明显的后门代码，但恶意作者可能会在编译的共享库中添加额外的代码，例如植入持久性后门。
*   **依赖风险：**  此POC代码依赖于gcc和系统环境，如果系统环境被污染，会导致提权失败，或者执行其他恶意代码。
*   **潜在的破坏：**  利用过程可能不稳定，可能导致目标系统崩溃或数据损坏。

因此，在未进行充分审查的情况下，不建议直接在生产环境中使用此 POC 代码。


**项目地址:** [mutur4/CVE-2021-4034](https://github.com/mutur4/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #31

**来源**: [CVE-2021-4034-nagorealbisu_CVE-2021-4034.md](../2021/CVE-2021-4034-nagorealbisu_CVE-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec没有正确处理调用参数的计数，导致它尝试将环境变量作为命令执行。攻击者可以精心构造环境变量，诱使pkexec执行任意代码，从而使非特权用户获得目标机器的管理权限。

**利用方式：**

1.  **编译exploit:** 首先，使用提供的Makefile编译`pwnkit.c`生成动态链接库`pwnkit.so`，并编译`cve-2021-4034.c`生成可执行文件`cve-2021-4034`。
2.  **创建GCONV_PATH目录：** 创建`GCONV_PATH=.`目录，并将`true`命令复制到该目录下，重命名为`pwnkit.so:.`。
3.  **构造环境变量：** 设置以下环境变量：
    *   `pwnkit.so:.` (利用glibc的gconv机制)
    *   `PATH=GCONV_PATH=.`
    *   `SHELL=/bin/bash`
    *   `CHARSET=PWNKIT`
    *   `GIO_USE_VFS=`
4.  **执行exploit：** 运行编译好的`cve-2021-4034`可执行文件。该程序会调用`/usr/bin/pkexec`，并传递构造好的环境变量。
5.  **权限提升：** `pkexec`由于漏洞，会加载恶意的`pwnkit.so`动态链接库。`pwnkit.so`中的`gconv_init`函数会被执行，该函数设置uid和gid为0，然后执行`/bin/sh`，从而获得root权限的shell。

**有效性：**

根据漏洞信息和POC代码，该POC代码有效。漏洞库信息和搜索引擎结果均表明CVE-2021-4034是一个可被利用的本地权限提升漏洞，并且POC代码已经公开。

**投毒风险：**

提供的POC代码中未发现明显的恶意代码或后门。该代码的目的是利用pkexec的漏洞提升权限，没有进行任何未经授权的数据收集、修改或远程控制操作。`pwnkit.c` 的作用是劫持程序流程并启动一个root shell，属于漏洞利用的一部分，并非投毒代码。因此，投毒风险较低。

**项目地址:** [nagorealbisu/CVE-2021-4034](https://github.com/nagorealbisu/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #32

**来源**: [CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md](../2021/CVE-2021-4034-ps-interactive_lab_cve-2021-4034-polkit-emulation-and-detection.md)

## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许本地普通用户提升到root权限

**影响版本:** 受影响版本广泛，具体取决于Polkit版本

**利用条件:** 本地用户可执行pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034 是 polkit's pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，前提是符合预定义的策略。该漏洞的根本原因是 pkexec 没有正确处理调用参数的数量，导致它尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得 root 权限。

**漏洞利用分析：**

1.  **漏洞原理：** pkexec 在处理参数时存在缺陷，会将环境变量当作命令执行。
2.  **利用方式：** 攻击者通过构造恶意的 GCONV_PATH 和 gconv-modules 文件，使得 pkexec 加载一个恶意的共享库 (.so)。这个共享库包含攻击者的 payload，当 pkexec 尝试执行时，payload 就会以 root 权限执行。
3.  **POC 代码分析：**  提供的 python 脚本 `poc-cve-2021-4034.py` 用于自动化利用过程，它执行以下操作：
    *   创建一个包含 payload 的共享库文件（lib-cve-2021-4034.so）。默认的 payload 是一个反向 shell，连接到攻击者指定的 IP 地址和端口。
    *   创建 GCONV_PATH=. 目录，以及 lab-cve-2021-4034 目录。
    *   创建 GCONV_PATH=./lab-cve-2021-4034 文件和 lab-cve-2021-4034/gconv-modules 文件，gconv-modules 文件指向恶意的共享库。
    *   使用构造的环境变量调用 execve 执行 /usr/bin/pkexec。

**有效性：**

根据漏洞描述、搜索结果和提供的 POC 代码，该漏洞利用是有效的，成功利用后可以提升到 root 权限。Qualys 的研究团队已经发现了这个漏洞，并且存在公开可用的利用代码。

**投毒风险：**

该仓库可能存在投毒风险，虽然主要功能是利用漏洞，payload 部分（Base64 编码的共享对象）可能被替换为具有恶意功能的代码，可能性为5%。以下是评估依据：

*   **Payload 的可替换性：** POC 的 payload 是一个 Base64 编码的字符串，攻击者可以轻松地替换为其他恶意代码。
*   **网络连接：** 默认 payload 是一个反向 shell，这意味着执行后会尝试连接到攻击者的服务器。攻击者可以在服务器上执行任意命令。
*   **Setup 脚本分析:** `setup.sh` 脚本主要用于安装依赖和配置 Docker 环境，没有明显的恶意代码。但安装的依赖项，如 docker 等，后续可以被植入恶意镜像。

**结论：**

该漏洞是一个高危漏洞，利用简单，影响广泛。虽然提供的 POC 代码主要是用于演示漏洞利用，但存在被恶意利用的风险，特别是 payload 部分。用户在使用前需要仔细检查 payload 的内容，并确保来源可信。


**项目地址:** [ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection](https://github.com/ps-interactive/lab_cve-2021-4034-polkit-emulation-and-detection)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #33

**来源**: [CVE-2021-4034-supportingmx_cve-2021-4034.md](../2021/CVE-2021-4034-supportingmx_cve-2021-4034.md)

## CVE-2021-4034-Polkit-pkexec本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** 所有版本

**利用条件:** 需要本地用户访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034是Polkit的pkexec实用程序中的一个本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于pkexec未正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱导pkexec执行任意代码，从而将非特权用户提升到目标机器上的管理员权限。

**漏洞利用方式：**

1.  **原理：** pkexec在处理参数时存在缺陷，错误地将环境变量当作程序路径执行。
2.  **利用：** 通过创建包含恶意代码的环境变量，并让pkexec执行，从而获得root权限。

**POC代码分析：**

提供的POC代码利用了`GCONV_PATH`环境变量。该变量用于指定gconv模块的路径，gconv模块用于字符集转换。攻击者通过以下步骤利用漏洞：

1.  创建`GCONV_PATH=.`目录，并创建一个名为`pwnkit`的文件，并修改其权限为可执行。
2.  在`pwnkit`目录下创建`gconv-modules`文件，指定一个自定义的gconv模块`PWNKIT`。
3.  创建`pwnkit/pwnkit.so`，其中包含恶意的shellcode。该shellcode会被`pkexec`执行，从而获得root权限。
4.  运行`fan`程序触发漏洞。

**有效性：**

根据漏洞描述和POC代码，可以判断该漏洞利用是有效的。搜索引擎结果也表明该漏洞已被广泛利用。

**投毒风险：**

该POC代码中存在一定的投毒风险。虽然主要目的是利用`pkexec`的漏洞进行提权，但恶意代码也可以被隐藏在`pwnkit/pwnkit.so` 文件里。例如，可以添加额外的逻辑来修改系统文件、安装后门或者发送敏感信息。但是，该风险较低。用户可以相对容易地检查 `pwnkit/pwnkit.so` 文件，通过反编译等手段来发现其中的恶意代码。并且利用此漏洞的目的就是提权, 增加投毒代码收益不高。因此，评估投毒风险为10%。该代码的作者可能会植入其他恶意代码的可能性较低。

**项目地址:** [supportingmx/cve-2021-4034](https://github.com/supportingmx/cve-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

## POC #34

**来源**: [CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md](../2021/CVE-2021-4034-wechicken456_CVE-2021-4034-CTF-writeup.md)

## CVE-2021-4034 PwnKit 本地权限提升

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** 所有版本（在修复之前）

**利用条件:** 目标系统必须安装了存在漏洞的 polkit pkexec 组件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞，又名 PwnKit，存在于 polkit 的 pkexec 工具中。Pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码（CTF 挑战）都表明该漏洞是真实存在的，并且有可用的利用代码。搜索引擎结果中来自 Qualys、Red Hat 和其他安全机构的报告证实了该漏洞的严重性和影响。

**投毒风险评估：**

提供的代码仓库是一个 CTF 挑战，旨在让参与者利用 CVE-2021-4034 漏洞。虽然代码本身是为了演示和学习目的而编写的，但存在一些潜在的投毒风险。

1.  **依赖项风险：** Dockerfile不完整，依赖玩家手动安装存在漏洞的内核和软件包。如果玩家从不可信的源下载或安装这些依赖项，可能会引入恶意软件。

2.  **CTF 设计陷阱：** CTF 挑战的目的是测试参与者的技能，但也可能包含隐藏的陷阱或后门，这些陷阱或后门可能与漏洞本身无关。这些陷阱可能会误导参与者，或者在不知情的情况下执行恶意代码。

3.  **`shelly.so`潜在风险：** `shelly.so` 被描述为 helper binary，但没有进行详细分析。虽然 CTF 挑战可能需要使用此二进制文件来完成，但始终存在二进制文件中包含恶意代码的可能性。

考虑到以上几点，保守估计投毒风险为 10%。这种风险主要是由不完整的构建环境、CTF 设计陷阱的可能性以及二进制文件的潜在风险造成的。

**利用方式分析：**

1.  **环境准备：** 搭建存在漏洞的 polkit pkexec 环境，包括安装指定版本的 `libpolkit-gobject-1-0`、`libpolkit-agent-1-0` 和 `policykit-1`。
2.  **利用代码：** 利用已知的 PoC 代码（例如，通过构造特殊的环境变量）触发 pkexec 中的漏洞。
3.  **权限提升：** 成功利用漏洞后，攻击者可以执行任意代码，从而获得 root 权限。

**项目地址:** [wechicken456/CVE-2021-4034-CTF-writeup](https://github.com/wechicken456/CVE-2021-4034-CTF-writeup)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)

---

