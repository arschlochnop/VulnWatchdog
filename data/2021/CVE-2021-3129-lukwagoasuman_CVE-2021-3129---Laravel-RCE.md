## CVE-2021-3129 - Laravel / Ignition组件 远程代码执行/反序列化漏洞

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行/反序列化漏洞

**影响应用:** Laravel / Ignition组件

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式 (Laravel自带的错误处理页面Ignition处于激活状态)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞起源于Laravel默认的错误页组件Ignition对log文件路径处理不当。POC代码表现出极高的完整性和专业性。其核心原理是利用php://filter伪协议对Laravel的日志文件进行多次base64编码和解码操作，从而在日志文件中构造出合法的Phar反序列化数据块。POC中定义的CHAINS数组包含了多种phpggc（PHP Generic Gadget Chains）生成的利用链，如laravel/rce1到rce16以及monolog相关链，这极大地提高了在不同环境下的成功率。代码实现逻辑严密，通过session保持状态，支持自动化探测OS环境、寻找Web根目录以及注入Phar包。经过静态分析，代码逻辑闭环，通过调用file_get_contents和file_put_contents的不安全处理触发phar://反序列化，实现在未授权情况下的任意命令执行。利用步骤：1. 首先确认目标主机开启了Debug模式。2. POC会发送特定的请求清理现有的Laravel日志文件，防止干扰。3. 通过特定的Filter过滤链，将经过精心构造的Base64编码后的Payload写入日志。4. 再次利用Filter去除日志中的非Base64字符，使日志文件变成一个纯净的Phar文件。5. 发送触发请求，利用phar://协议读取该日志文件，触发反序列化过程，从而执行系统命令或反弹Shell。投毒风险分析：该POC代码主要使用了Python的标准库（requests, argparse, base64, uuid等），代码结构透明，变量命名规范。风险点在于POC引用了复杂的Gadget Chains（CHAINS数组），且包含随机化的User-Agent。虽然POC中包含subprocess和readline等可能被滥用的模块，但从当前代码段看，其目的是为了提供交互式的Shell体验。代码中并未发现混淆、动态下载外部二进制文件或向非目标IP发送敏感信息的行为。风险处于低位，但在实际部署防范措施时，应警惕代码被二次封装时加入恶意逻辑。由于该POC具有一键式攻击的能力，安全研究人员应在隔离环境中使用，防止因POC被植入后门而导致研究员终端受损。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
