## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中自 2009 年 5 月发布的 polkit 版本

**利用条件:** 攻击者必须拥有目标系统的低权限本地账户访问权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：此POC是针对CVE-2021-4034（又称PwnKit）的高度功能化实现。该漏洞存在于polkit的pkexec实用程序中，由于其对命令行参数处理不当，导致越界读取并允许攻击者将环境变量注入到特权进程的内存空间。代码包含三个主要部分：主程序cve-2021-4034.c、恶意共享库pwnkit.c和自动化编译的Makefile。通过调用execve("/usr/bin/pkexec", NULL, env)，触发pkexec在找不到参数时尝试读取环境变量作为参数的逻辑缺陷。利用步骤如下：1. 使用Makefile编译源代码，生成主执行文件和恶意动态链接库pwnkit.so。2. 创建一个名为'GCONV_PATH=.'的伪造目录，利用GCONV_PATH环境变量重定向glibc的图标转换库加载路径。3. 运行主程序，主程序通过execve触发pkexec。4. pkexec在处理畸形环境变量时，会加载攻击者控制的pwnkit.so。5. pwnkit.so中的gconv_init函数被执行，该函数通过setuid(0)和setgid(0)获取Root权限，并执行/bin/sh。经分析，该POC逻辑严密，直接利用了pkexec在处理argc为0时的漏洞原型，具有极高的实战价值，能稳定在受影响的Linux系统中获取Root Shell。投毒风险分析：该POC代码结构透明，采用标准的C语言编写，未进行任何形式的混淆或加密处理。Makefile中定义的编译流程仅涉及本地文件的创建、删除和编译，不包含任何外部网络连接（curl/wget）或下载第三方脚本的行为。主程序cve-2021-4034.c和payload pwnkit.c的代码逻辑清晰，明确指向提权目的。pwnkit.c中的gconv_init函数虽然执行了提权操作，但这属于漏洞验证的必要Payload，而非隐藏的恶意后门。虽然该漏洞危害巨大，但此特定代码样本本身是纯粹的防御性研究工具，不包含任何窃取敏感数据、安装持久化后门或横向移动的额外恶意逻辑。唯一的风险在于使用TRUE=/bin/bash替换pwnkit.so的操作如果不慎，可能导致本地文件覆盖，但整体投毒风险极低（5%），适合作为组织内部的安全测试基准。建议在隔离的虚拟机环境下进行复现测试，并确保生产环境已更新polkit补丁。

**项目地址:** [https://github.com/arthepsy/CVE-2021-4034](https://github.com/arthepsy/CVE-2021-4034)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
