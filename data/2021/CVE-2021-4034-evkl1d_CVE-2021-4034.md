## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中的 polkit 默认版本 (2009年至今)

**利用条件:** 具有本地普通用户访问权限，目标系统安装了 SUID 权限的 pkexec 程序

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该 Python 版本的 POC 是针对 CVE-2021-4034（又称 PwnKit）的高质量实现。其核心原理是利用 pkexec 在处理命令行参数时的越界写入漏洞。代码首先定义了一个 base64 编码的 ELF 共享对象（payload.so），该 payload 使用 msfvenom 生成并设置了 PrependSetuid=true，这是获取 root 权限的关键。POC 巧妙地绕过了 Python 无法直接调用无参数 execve() 的限制，通过 ctypes 库直接调用 C 标准库中的函数。它在本地创建了一个名为 'GCONV_PATH=.' 的目录和相关的配置文件，强制 pkexec 加载恶意的 gconv 模块。经过测试，这种利用方式非常稳定，能够绕过大多数 Linux 系统上的默认安全限制，快速将普通用户权限提升至 root。代码逻辑清晰，从环境准备、Payload 写入到最终触发漏洞一气呵成。利用步骤：1. 将 POC 代码保存为 py 文件；2. 运行脚本，脚本会自动解码 base64 负载并生成 payload.so；3. 脚本创建伪造的 GCONV_PATH 目录结构和配置文件；4. 通过 ctypes 调用 execve 执行 pkexec，触发环境变量注入；5. pkexec 错误地加载了当前目录下的恶意共享库，执行 payload 中的 /bin/sh，从而弹出 root shell。投毒风险分析：该脚本的投毒风险评级为低（15%）。代码使用了标准的 Python 库（base64, os, sys, ctypes），没有发现任何混淆、外部下载请求或对系统敏感文件（如 /etc/passwd）的恶意修改。脚本中硬编码的 base64 字符串是一个典型的 ELF 共享库，反汇编分析显示其功能仅为执行 shell，符合安全研究 POC 的特征。虽然使用了 ctypes.CDLL(find_library('c')) 来获取 libc 句柄，但这在高级漏洞利用脚本中是标准做法，并非恶意隐藏行为。风险主要在于该 POC 威力巨大且易于使用，如果不加限制地分发，可能被攻击者直接用于实战，但代码本身不具备针对研究员开发环境的后门投毒特征。所有操作均在当前工作目录下进行，且明确标注了作者信息和参考来源，透明度较高。

**项目地址:** [https://haxx.in/files/blasty-vs-pkexec.c](https://haxx.in/files/blasty-vs-pkexec.c) (参考来源)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
