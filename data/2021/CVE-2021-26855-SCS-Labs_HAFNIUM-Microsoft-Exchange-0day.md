# CVE-2021-26855

> ğŸ“¦ è¯¥CVEæœ‰ **25** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-26855-1342486672_Flangvik.md](../2021/CVE-2021-26855-1342486672_Flangvik.md)

## CVE-2021-26855 - Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äº Exchange Server 2013 CU21-CU23, 2016 CU8-CU19, 2019 CU1-CU8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ Exchange Server å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ª Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä½œä¸ºæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚é€šè¿‡ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857, CVE-2021-26858, CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨è¯¥æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘ Exchange åç«¯å‘é€æ¶æ„è¯·æ±‚ã€‚
2.  **åˆ©ç”¨å…¶ä»–æ¼æ´ï¼š** é€šå¸¸éœ€è¦ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ï¼Œå¦‚ä¸å®‰å…¨çš„ deserialization æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ç­‰ï¼Œä»¥æœ€ç»ˆå®ç° RCEã€‚
3.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** åœ¨æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–ç³»ç»Ÿæƒé™ã€‚

**POC æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„ POC ä»£ç æè¿°ï¼Œè¯¥ POC æ—¨åœ¨åˆ©ç”¨ CVE-2021-26855 å®ç°åŠäº¤äº’å¼ web shell æˆ– shellcode æ‰§è¡Œï¼Œè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ç”±äºä»…æä¾›äº† README.md æ–‡ä»¶å†…å®¹ï¼Œæ— æ³•å®Œæ•´åˆ†ææ•´ä¸ªä»£ç ä»“åº“ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š

*   POC ä»£ç å¤æ‚æ€§ï¼šExchange æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œå¯èƒ½å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ã€‚
*   å†å²æ”»å‡»äº‹ä»¶ï¼šProxyLogon æ›¾è¢«å¤§è§„æ¨¡åˆ©ç”¨ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å…¬å¼€çš„ POC è¿›è¡ŒäºŒæ¬¡ä¿®æ”¹å’Œæ”»å‡»ã€‚
*   ç¼ºä¹ä»£ç å®¡æŸ¥ï¼šåœ¨æ²¡æœ‰è¿›è¡Œè¯¦ç»†ä»£ç å®¡æŸ¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ã€‚
*   C# POCä»£ç ï¼Œå¯èƒ½å­˜åœ¨åŠ è½½æ¶æ„dllï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
å› æ­¤ï¼Œåˆæ­¥åˆ¤æ–­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¼°è®¡ä¸º 10%ã€‚ä½¿ç”¨è¯¥ POC ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡æŸ¥å’Œå®‰å…¨è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [1342486672/Flangvik](https://github.com/1342486672/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #2

**æ¥æº**: [CVE-2021-26855-Flangvik_SharpProxyLogon.md](../2021/CVE-2021-26855-Flangvik_SharpProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013, 2016, and 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬å‚è€ƒæ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange Server çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855ï¼ˆProxyLogonï¼‰æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange Server æœ¬èº«è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ C# POC ä»£ç  `SharpProxyLogon` åˆ©ç”¨äº† ProxyLogon æ¼æ´é“¾ã€‚æ ¹æ® README.md ä¸­çš„æè¿°å’Œç¤ºä¾‹ï¼Œæ­¤ POC å…è®¸æ”»å‡»è€…ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶æœ€ç»ˆåœ¨ç›®æ ‡ Exchange Server ä¸Šæ‰§è¡Œä»£ç ã€‚ POC æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€æ˜¯é€šè¿‡ webshell è½åœ°æ‰§è¡Œå‘½ä»¤ï¼ŒäºŒæ˜¯é€šè¿‡ shellcode æ³¨å…¥åˆ° `svchost.exe` è¿›ç¨‹ä¸­ã€‚ä»ç¤ºä¾‹è¾“å‡ºç»“æœæ¥çœ‹ï¼ŒPOC èƒ½å¤ŸæˆåŠŸè·å–ç›®æ ‡ç³»ç»Ÿçš„ SYSTEM æƒé™ï¼Œè¡¨æ˜è¯¥ä»£ç åœ¨æœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿä¸Šæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä»“åº“çš„ä¸»è¦æ–‡ä»¶æ˜¯ `SharpProxyLogon.sln` å’Œ `SharpProxyLogon` ç›®å½•ä¸‹çš„ C# ä»£ç ã€‚æ ¹æ® `README.md` æ–‡ä»¶å’Œä»£ç ç»“æ„æ¥çœ‹ï¼Œè¯¥ POC ä¸»è¦ç”¨äºåˆ©ç”¨ ProxyLogon æ¼æ´é“¾è¿›è¡Œ RCEï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚è™½ç„¶ `SharpProxyLogon` ä½¿ç”¨äº† `TikiTorch` ä»£ç è¿›è¡Œ shellcode æ³¨å…¥ï¼Œä½†è¿™æ˜¯ä¸€ç§å¸¸è§çš„æŠ€æœ¯ï¼Œæœ¬èº«ä¸æ„æˆæŠ•æ¯’ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•æ¥æºä¸æ˜çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½ä¿®æ”¹æˆ–æ·»åŠ æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹Ÿ Exchange Server çš„èº«ä»½å‘é€ HTTP è¯·æ±‚ã€‚
2.  **åç«¯æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰ï¼š** ç»“åˆå…¶ä»–æ¼æ´ï¼Œä¾‹å¦‚ä¸å®‰å…¨çš„åºåˆ—åŒ–æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Webshell è½åœ°ï¼š** POC å¯ä»¥å°† webshell å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ Web ç›®å½•ä¸‹ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚
4.  **Shellcode æ³¨å…¥ï¼š** POC è¿˜å¯ä»¥å°† shellcode æ³¨å…¥åˆ° `svchost.exe` ç­‰è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œã€‚

**æœç´¢å¼•æ“ç»“æœåˆ†æï¼š**

æœç´¢ç»“æœè¯å®äº† CVE-2021-26855 çš„ä¸¥é‡æ€§å’Œè¢«å¹¿æ³›åˆ©ç”¨çš„æƒ…å†µã€‚å¤šä¸ªæ¥æºè¡¨æ˜è¯¥æ¼æ´æ˜¯ä¸€ä¸ª SSRF æ¼æ´ï¼Œå…è®¸æœªç»éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚ã€‚è¯¥æ¼æ´å¸¸ä¸å…¶ä»– Exchange Server æ¼æ´ä¸€èµ·åˆ©ç”¨ï¼Œå½¢æˆ ProxyLogon æ¼æ´é“¾ï¼Œä»è€Œå®ç° RCEã€‚

**é¡¹ç›®åœ°å€:** [Flangvik/SharpProxyLogon](https://github.com/Flangvik/SharpProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #3

**æ¥æº**: [CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md](../2021/CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013, 2016, å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬è§æ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ Web æ¥å£ (OWA/ECP)ã€‚åˆ©ç”¨é“¾ä¸­éœ€è¦ä¸å…¶ä»–æ¼æ´é…åˆï¼ˆå¦‚ CVE-2021-26857ï¼‰ã€‚é€šå¸¸ä¸éœ€è¦èº«ä»½éªŒè¯å³å¯å‘èµ·æ”»å‡»ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨ã€‚é€šè¿‡åˆ©ç”¨æ­¤ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ï¼Œä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç æè¿°ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆä¾‹å¦‚ UpGuardï¼ŒNVDï¼ŒMicrosoft å®˜æ–¹åšå®¢ï¼ŒTenable ç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œè¢«ç§¯æåˆ©ç”¨çš„æƒ…å†µã€‚æä¾›çš„ä»£ç æ–‡ä»¶ `proxylogon.py` ä¼¼ä¹æ˜¯å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„åˆ©ç”¨ç¨‹åºï¼Œå¯ä»¥é“¾å¼åˆ©ç”¨ CVE-2021-26855 å’Œ CVE-2021-26857 æ¥æ‰§è¡Œä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äº`proxylogon.py` ä¸­ä½¿ç”¨`eval(Request["cmd"],"unsafe")` æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„ `cmd` å‚æ•°ï¼Œå…·æœ‰é«˜é£é™©ã€‚æ­¤æ–¹æ³•å…è®¸æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¦‚æœæ”»å‡»è€…æ¶æ„æ„é€  `cmd` çš„å†…å®¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚è™½ç„¶ä½œè€…å¯èƒ½å‡ºäºæ–¹ä¾¿åˆ©ç”¨çš„ç›®çš„æ·»åŠ æ­¤åŠŸèƒ½ï¼Œä½†ä¹Ÿä¸ºæ¶æ„ä½¿ç”¨è€…æ‰“å¼€äº†æ–¹ä¾¿ä¹‹é—¨ã€‚å¦ä¸€ä¸ªé£é™©ç‚¹åœ¨äºï¼Œè„šæœ¬ä¸­çš„powershellå‘½ä»¤ï¼ˆé€šè¿‡`revPSScriptUrl`ä¼ å…¥ï¼‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¥è‡ªä¸å—ä¿¡ä»»æºçš„powershellè„šæœ¬æ˜¯å±é™©çš„ã€‚ç„¶è€Œï¼Œä»£ç ä¸­æä¾›äº†å…è´£å£°æ˜ï¼Œå£°æ˜å…¶ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ï¼Œå¹¶ä¸”ç»™å‡ºäº†Immersive Labsçš„é“¾æ¥ä»¥ä¾›å®‰å…¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œä½¿æ”»å‡»è€…å¯ä»¥å†’å…… Exchange æœåŠ¡å™¨ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ– (CVE-2021-26857):** é€šè¿‡ SSRF æ¼æ´è·å¾—æƒé™åï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Web Shell éƒ¨ç½²:** ä¸Šä¼ å¹¶éƒ¨ç½² Web Shellï¼Œä»¥ä¾¿æ”»å‡»è€…å¯ä»¥æŒç»­è®¿é—® Exchange æœåŠ¡å™¨å¹¶æ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç ä¸­çš„ `shell_payload` å˜é‡å®šä¹‰äº†ç”¨äºéƒ¨ç½² Web shell çš„ JScript ä»£ç ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** ä½¿ç”¨Web Shellæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚æ‰§è¡Œpowershellè„šæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Immersive-Labs-Sec/ProxyLogon](https://github.com/Immersive-Labs-Sec/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #4

**æ¥æº**: [CVE-2021-26855-Nick-Yin12_106362522.md](../2021/CVE-2021-26855-Nick-Yin12_106362522.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, ä»¥åŠ 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡æœåŠ¡å™¨è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿œç¨‹æ‰§è¡Œä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚ æœç´¢å¼•æ“ç»“æœæ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç `/tmp/48fee3cb76dd8f17cfc4f0c4e5929ece/README.md` åªæ˜¯ä¸€ä¸ªæè¿°æ¼æ´çš„ä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢ä¸»è¦è®²è¿°äº†æ¼æ´çš„å‘ç°å’ŒæŠ¥å‘Šè¿‡ç¨‹ï¼Œä»¥åŠå¯¹å¾®è½¯å®‰å…¨é˜²æŠ¤çš„çœ‹æ³•ã€‚å¹¶æ²¡æœ‰å‘ç°ä»»ä½•ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œä½†é‰´äºæ­¤ç±»æ¼æ´ç»å¸¸è¢«æ‰“åŒ…æˆå¤æ‚çš„åˆ©ç”¨å·¥å…·ï¼Œå¹¶ä¸”åˆ©ç”¨è¿‡ç¨‹å¯èƒ½æ¶‰åŠå¤šä¸ªé˜¶æ®µå’Œç»„ä»¶ï¼Œå› æ­¤ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚å¦‚æœå…¶ä»–æ–‡ä»¶å­˜åœ¨æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½è¢«åˆ©ç”¨è¿›è¡ŒæŠ•æ¯’ã€‚è¿™é‡Œç»™å‡ºçš„10%çš„æŠ•æ¯’é£é™©æ˜¯åŸºäºè¯¥æ¼æ´æœ¬èº«çš„é«˜å±æ€§å’Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å¤šç§æ–¹å¼è¿›è¡Œæ”»å‡»çš„ç»¼åˆè€ƒé‡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ï¼Œå†™å…¥æ¶æ„ Web Shell æˆ–å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ã€‚
3.  é€šè¿‡ Web Shell æˆ–å…¶ä»–æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å¾—æœåŠ¡å™¨æ§åˆ¶æƒã€‚

æ­¤æ¼æ´ä¹Ÿè¢«ç§°ä¸º ProxyLogonï¼Œæ˜¯å¤šä¸ª Exchange æ¼æ´åˆ©ç”¨é“¾ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå¸¸ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [Nick-Yin12/106362522](https://github.com/Nick-Yin12/106362522)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #5

**æ¥æº**: [CVE-2021-26855-RickGeex_ProxyLogon.md](../2021/CVE-2021-26855-RickGeex_ProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨ExchangeæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ€ç»ˆä»¥ SYSTEM æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š**  åˆ©ç”¨autodiscover.xmlè·å–LegacyDNä¿¡æ¯ã€‚
3.  **è·å–SIDï¼š** ä½¿ç”¨/mapi/emsmdbç«¯ç‚¹è·å–Security ID (SID)ã€‚
4.  **æ·»åŠ é‚®ç®±æƒé™ï¼š**  ä½¿ç”¨è·å–çš„ SIDï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶å‘ä»»æ„é‚®ç®±æ·»åŠ è®¿é—®æƒé™ã€‚
5.  **å†™å…¥ Webshellï¼š**  æœ€ç»ˆï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å†™å…¥ Webshell ç­‰æ–¹å¼åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ProxyLogon.py` å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„å‰å‡ ä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬ FQDN è§£æã€LegacyDN è·å–å’Œ SID è·å–ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼ŒPOC ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥POCæœ¬èº«ç›®çš„æ˜¯å¤ç°æ¼æ´åˆ©ç”¨ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹payloadå†…å®¹ï¼Œæ¯”å¦‚åœ¨stage3/4ä¸­é€šè¿‡æ‰§è¡Œå‘½ä»¤æ·»åŠ æ¶æ„è´¦æˆ·ã€å®‰è£…åé—¨ï¼Œçš„ç¡®å­˜åœ¨æŠ•æ¯’çš„é£é™©ã€‚ç›®å‰çœ‹ä»£ç æœ¬èº«æ˜¯ä¸ºäº†æ¼æ´å¤ç°ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ä¸èƒ½æ’é™¤è¢«ä¿®æ”¹åè¿›è¡Œä¼ æ’­çš„å¯èƒ½æ€§ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º 5%ã€‚

**é¡¹ç›®åœ°å€:** [RickGeex/ProxyLogon](https://github.com/RickGeex/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #6

**æ¥æº**: [CVE-2021-26855-SCS-Labs_HAFNIUM-Microsoft-Exchange-0day.md](../2021/CVE-2021-26855-SCS-Labs_HAFNIUM-Microsoft-Exchange-0day.md)

# CVE-2021-26855

> ğŸ“¦ è¯¥CVEæœ‰ **25** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-26855-1342486672_Flangvik.md](../2021/CVE-2021-26855-1342486672_Flangvik.md)

## CVE-2021-26855 - Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äº Exchange Server 2013 CU21-CU23, 2016 CU8-CU19, 2019 CU1-CU8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ Exchange Server å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ª Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä½œä¸ºæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚é€šè¿‡ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857, CVE-2021-26858, CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨è¯¥æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘ Exchange åç«¯å‘é€æ¶æ„è¯·æ±‚ã€‚
2.  **åˆ©ç”¨å…¶ä»–æ¼æ´ï¼š** é€šå¸¸éœ€è¦ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ï¼Œå¦‚ä¸å®‰å…¨çš„ deserialization æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ç­‰ï¼Œä»¥æœ€ç»ˆå®ç° RCEã€‚
3.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** åœ¨æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–ç³»ç»Ÿæƒé™ã€‚

**POC æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„ POC ä»£ç æè¿°ï¼Œè¯¥ POC æ—¨åœ¨åˆ©ç”¨ CVE-2021-26855 å®ç°åŠäº¤äº’å¼ web shell æˆ– shellcode æ‰§è¡Œï¼Œè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ç”±äºä»…æä¾›äº† README.md æ–‡ä»¶å†…å®¹ï¼Œæ— æ³•å®Œæ•´åˆ†ææ•´ä¸ªä»£ç ä»“åº“ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š

*   POC ä»£ç å¤æ‚æ€§ï¼šExchange æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œå¯èƒ½å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ã€‚
*   å†å²æ”»å‡»äº‹ä»¶ï¼šProxyLogon æ›¾è¢«å¤§è§„æ¨¡åˆ©ç”¨ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å…¬å¼€çš„ POC è¿›è¡ŒäºŒæ¬¡ä¿®æ”¹å’Œæ”»å‡»ã€‚
*   ç¼ºä¹ä»£ç å®¡æŸ¥ï¼šåœ¨æ²¡æœ‰è¿›è¡Œè¯¦ç»†ä»£ç å®¡æŸ¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ã€‚
*   C# POCä»£ç ï¼Œå¯èƒ½å­˜åœ¨åŠ è½½æ¶æ„dllï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
å› æ­¤ï¼Œåˆæ­¥åˆ¤æ–­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¼°è®¡ä¸º 10%ã€‚ä½¿ç”¨è¯¥ POC ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡æŸ¥å’Œå®‰å…¨è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [1342486672/Flangvik](https://github.com/1342486672/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #2

**æ¥æº**: [CVE-2021-26855-Flangvik_SharpProxyLogon.md](../2021/CVE-2021-26855-Flangvik_SharpProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013, 2016, and 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬å‚è€ƒæ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange Server çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855ï¼ˆProxyLogonï¼‰æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange Server æœ¬èº«è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ C# POC ä»£ç  `SharpProxyLogon` åˆ©ç”¨äº† ProxyLogon æ¼æ´é“¾ã€‚æ ¹æ® README.md ä¸­çš„æè¿°å’Œç¤ºä¾‹ï¼Œæ­¤ POC å…è®¸æ”»å‡»è€…ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶æœ€ç»ˆåœ¨ç›®æ ‡ Exchange Server ä¸Šæ‰§è¡Œä»£ç ã€‚ POC æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€æ˜¯é€šè¿‡ webshell è½åœ°æ‰§è¡Œå‘½ä»¤ï¼ŒäºŒæ˜¯é€šè¿‡ shellcode æ³¨å…¥åˆ° `svchost.exe` è¿›ç¨‹ä¸­ã€‚ä»ç¤ºä¾‹è¾“å‡ºç»“æœæ¥çœ‹ï¼ŒPOC èƒ½å¤ŸæˆåŠŸè·å–ç›®æ ‡ç³»ç»Ÿçš„ SYSTEM æƒé™ï¼Œè¡¨æ˜è¯¥ä»£ç åœ¨æœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿä¸Šæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä»“åº“çš„ä¸»è¦æ–‡ä»¶æ˜¯ `SharpProxyLogon.sln` å’Œ `SharpProxyLogon` ç›®å½•ä¸‹çš„ C# ä»£ç ã€‚æ ¹æ® `README.md` æ–‡ä»¶å’Œä»£ç ç»“æ„æ¥çœ‹ï¼Œè¯¥ POC ä¸»è¦ç”¨äºåˆ©ç”¨ ProxyLogon æ¼æ´é“¾è¿›è¡Œ RCEï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚è™½ç„¶ `SharpProxyLogon` ä½¿ç”¨äº† `TikiTorch` ä»£ç è¿›è¡Œ shellcode æ³¨å…¥ï¼Œä½†è¿™æ˜¯ä¸€ç§å¸¸è§çš„æŠ€æœ¯ï¼Œæœ¬èº«ä¸æ„æˆæŠ•æ¯’ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•æ¥æºä¸æ˜çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½ä¿®æ”¹æˆ–æ·»åŠ æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹Ÿ Exchange Server çš„èº«ä»½å‘é€ HTTP è¯·æ±‚ã€‚
2.  **åç«¯æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰ï¼š** ç»“åˆå…¶ä»–æ¼æ´ï¼Œä¾‹å¦‚ä¸å®‰å…¨çš„åºåˆ—åŒ–æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Webshell è½åœ°ï¼š** POC å¯ä»¥å°† webshell å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ Web ç›®å½•ä¸‹ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚
4.  **Shellcode æ³¨å…¥ï¼š** POC è¿˜å¯ä»¥å°† shellcode æ³¨å…¥åˆ° `svchost.exe` ç­‰è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œã€‚

**æœç´¢å¼•æ“ç»“æœåˆ†æï¼š**

æœç´¢ç»“æœè¯å®äº† CVE-2021-26855 çš„ä¸¥é‡æ€§å’Œè¢«å¹¿æ³›åˆ©ç”¨çš„æƒ…å†µã€‚å¤šä¸ªæ¥æºè¡¨æ˜è¯¥æ¼æ´æ˜¯ä¸€ä¸ª SSRF æ¼æ´ï¼Œå…è®¸æœªç»éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚ã€‚è¯¥æ¼æ´å¸¸ä¸å…¶ä»– Exchange Server æ¼æ´ä¸€èµ·åˆ©ç”¨ï¼Œå½¢æˆ ProxyLogon æ¼æ´é“¾ï¼Œä»è€Œå®ç° RCEã€‚

**é¡¹ç›®åœ°å€:** [Flangvik/SharpProxyLogon](https://github.com/Flangvik/SharpProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #3

**æ¥æº**: [CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md](../2021/CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013, 2016, å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬è§æ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ Web æ¥å£ (OWA/ECP)ã€‚åˆ©ç”¨é“¾ä¸­éœ€è¦ä¸å…¶ä»–æ¼æ´é…åˆï¼ˆå¦‚ CVE-2021-26857ï¼‰ã€‚é€šå¸¸ä¸éœ€è¦èº«ä»½éªŒè¯å³å¯å‘èµ·æ”»å‡»ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨ã€‚é€šè¿‡åˆ©ç”¨æ­¤ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ï¼Œä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç æè¿°ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆä¾‹å¦‚ UpGuardï¼ŒNVDï¼ŒMicrosoft å®˜æ–¹åšå®¢ï¼ŒTenable ç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œè¢«ç§¯æåˆ©ç”¨çš„æƒ…å†µã€‚æä¾›çš„ä»£ç æ–‡ä»¶ `proxylogon.py` ä¼¼ä¹æ˜¯å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„åˆ©ç”¨ç¨‹åºï¼Œå¯ä»¥é“¾å¼åˆ©ç”¨ CVE-2021-26855 å’Œ CVE-2021-26857 æ¥æ‰§è¡Œä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äº`proxylogon.py` ä¸­ä½¿ç”¨`eval(Request["cmd"],"unsafe")` æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„ `cmd` å‚æ•°ï¼Œå…·æœ‰é«˜é£é™©ã€‚æ­¤æ–¹æ³•å…è®¸æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¦‚æœæ”»å‡»è€…æ¶æ„æ„é€  `cmd` çš„å†…å®¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚è™½ç„¶ä½œè€…å¯èƒ½å‡ºäºæ–¹ä¾¿åˆ©ç”¨çš„ç›®çš„æ·»åŠ æ­¤åŠŸèƒ½ï¼Œä½†ä¹Ÿä¸ºæ¶æ„ä½¿ç”¨è€…æ‰“å¼€äº†æ–¹ä¾¿ä¹‹é—¨ã€‚å¦ä¸€ä¸ªé£é™©ç‚¹åœ¨äºï¼Œè„šæœ¬ä¸­çš„powershellå‘½ä»¤ï¼ˆé€šè¿‡`revPSScriptUrl`ä¼ å…¥ï¼‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¥è‡ªä¸å—ä¿¡ä»»æºçš„powershellè„šæœ¬æ˜¯å±é™©çš„ã€‚ç„¶è€Œï¼Œä»£ç ä¸­æä¾›äº†å…è´£å£°æ˜ï¼Œå£°æ˜å…¶ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ï¼Œå¹¶ä¸”ç»™å‡ºäº†Immersive Labsçš„é“¾æ¥ä»¥ä¾›å®‰å…¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œä½¿æ”»å‡»è€…å¯ä»¥å†’å…… Exchange æœåŠ¡å™¨ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ– (CVE-2021-26857):** é€šè¿‡ SSRF æ¼æ´è·å¾—æƒé™åï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Web Shell éƒ¨ç½²:** ä¸Šä¼ å¹¶éƒ¨ç½² Web Shellï¼Œä»¥ä¾¿æ”»å‡»è€…å¯ä»¥æŒç»­è®¿é—® Exchange æœåŠ¡å™¨å¹¶æ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç ä¸­çš„ `shell_payload` å˜é‡å®šä¹‰äº†ç”¨äºéƒ¨ç½² Web shell çš„ JScript ä»£ç ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** ä½¿ç”¨Web Shellæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚æ‰§è¡Œpowershellè„šæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Immersive-Labs-Sec/ProxyLogon](https://github.com/Immersive-Labs-Sec/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #4

**æ¥æº**: [CVE-2021-26855-Nick-Yin12_106362522.md](../2021/CVE-2021-26855-Nick-Yin12_106362522.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, ä»¥åŠ 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡æœåŠ¡å™¨è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿œç¨‹æ‰§è¡Œä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚ æœç´¢å¼•æ“ç»“æœæ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç `/tmp/48fee3cb76dd8f17cfc4f0c4e5929ece/README.md` åªæ˜¯ä¸€ä¸ªæè¿°æ¼æ´çš„ä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢ä¸»è¦è®²è¿°äº†æ¼æ´çš„å‘ç°å’ŒæŠ¥å‘Šè¿‡ç¨‹ï¼Œä»¥åŠå¯¹å¾®è½¯å®‰å…¨é˜²æŠ¤çš„çœ‹æ³•ã€‚å¹¶æ²¡æœ‰å‘ç°ä»»ä½•ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œä½†é‰´äºæ­¤ç±»æ¼æ´ç»å¸¸è¢«æ‰“åŒ…æˆå¤æ‚çš„åˆ©ç”¨å·¥å…·ï¼Œå¹¶ä¸”åˆ©ç”¨è¿‡ç¨‹å¯èƒ½æ¶‰åŠå¤šä¸ªé˜¶æ®µå’Œç»„ä»¶ï¼Œå› æ­¤ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚å¦‚æœå…¶ä»–æ–‡ä»¶å­˜åœ¨æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½è¢«åˆ©ç”¨è¿›è¡ŒæŠ•æ¯’ã€‚è¿™é‡Œç»™å‡ºçš„10%çš„æŠ•æ¯’é£é™©æ˜¯åŸºäºè¯¥æ¼æ´æœ¬èº«çš„é«˜å±æ€§å’Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å¤šç§æ–¹å¼è¿›è¡Œæ”»å‡»çš„ç»¼åˆè€ƒé‡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ï¼Œå†™å…¥æ¶æ„ Web Shell æˆ–å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ã€‚
3.  é€šè¿‡ Web Shell æˆ–å…¶ä»–æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å¾—æœåŠ¡å™¨æ§åˆ¶æƒã€‚

æ­¤æ¼æ´ä¹Ÿè¢«ç§°ä¸º ProxyLogonï¼Œæ˜¯å¤šä¸ª Exchange æ¼æ´åˆ©ç”¨é“¾ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå¸¸ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [Nick-Yin12/106362522](https://github.com/Nick-Yin12/106362522)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #5

**æ¥æº**: [CVE-2021-26855-RickGeex_ProxyLogon.md](../2021/CVE-2021-26855-RickGeex_ProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨ExchangeæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ€ç»ˆä»¥ SYSTEM æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š**  åˆ©ç”¨autodiscover.xmlè·å–LegacyDNä¿¡æ¯ã€‚
3.  **è·å–SIDï¼š** ä½¿ç”¨/mapi/emsmdbç«¯ç‚¹è·å–Security ID (SID)ã€‚
4.  **æ·»åŠ é‚®ç®±æƒé™ï¼š**  ä½¿ç”¨è·å–çš„ SIDï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶å‘ä»»æ„é‚®ç®±æ·»åŠ è®¿é—®æƒé™ã€‚
5.  **å†™å…¥ Webshellï¼š**  æœ€ç»ˆï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å†™å…¥ Webshell ç­‰æ–¹å¼åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ProxyLogon.py` å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„å‰å‡ ä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬ FQDN è§£æã€LegacyDN è·å–å’Œ SID è·å–ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼ŒPOC ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥POCæœ¬èº«ç›®çš„æ˜¯å¤ç°æ¼æ´åˆ©ç”¨ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹payloadå†…å®¹ï¼Œæ¯”å¦‚åœ¨stage3/4ä¸­é€šè¿‡æ‰§è¡Œå‘½ä»¤æ·»åŠ æ¶æ„è´¦æˆ·ã€å®‰è£…åé—¨ï¼Œçš„ç¡®å­˜åœ¨æŠ•æ¯’çš„é£é™©ã€‚ç›®å‰çœ‹ä»£ç æœ¬èº«æ˜¯ä¸ºäº†æ¼æ´å¤ç°ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ä¸èƒ½æ’é™¤è¢«ä¿®æ”¹åè¿›è¡Œä¼ æ’­çš„å¯èƒ½æ€§ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º 5%ã€‚

**é¡¹ç›®åœ°å€:** [RickGeex/ProxyLogon](https://github.com/RickGeex/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #6

**æ¥æº**: [CVE-2021-26855-SCS-Labs_HAFNIUM-Microsoft-Exchange-0day.md](../2021/CVE-2021-26855-SCS-Labs_HAFNIUM-Microsoft-Exchange-0day.md)

# CVE-2021-26855

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-26855-1342486672_Flangvik.md](../2021/CVE-2021-26855-1342486672_Flangvik.md)

## CVE-2021-26855 - Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äº Exchange Server 2013 CU21-CU23, 2016 CU8-CU19, 2019 CU1-CU8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ Exchange Server å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ª Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä½œä¸ºæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚é€šè¿‡ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857, CVE-2021-26858, CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨è¯¥æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘ Exchange åç«¯å‘é€æ¶æ„è¯·æ±‚ã€‚
2.  **åˆ©ç”¨å…¶ä»–æ¼æ´ï¼š** é€šå¸¸éœ€è¦ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ï¼Œå¦‚ä¸å®‰å…¨çš„ deserialization æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ç­‰ï¼Œä»¥æœ€ç»ˆå®ç° RCEã€‚
3.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** åœ¨æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–ç³»ç»Ÿæƒé™ã€‚

**POC æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„ POC ä»£ç æè¿°ï¼Œè¯¥ POC æ—¨åœ¨åˆ©ç”¨ CVE-2021-26855 å®ç°åŠäº¤äº’å¼ web shell æˆ– shellcode æ‰§è¡Œï¼Œè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ç”±äºä»…æä¾›äº† README.md æ–‡ä»¶å†…å®¹ï¼Œæ— æ³•å®Œæ•´åˆ†ææ•´ä¸ªä»£ç ä»“åº“ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š

*   POC ä»£ç å¤æ‚æ€§ï¼šExchange æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œå¯èƒ½å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ã€‚
*   å†å²æ”»å‡»äº‹ä»¶ï¼šProxyLogon æ›¾è¢«å¤§è§„æ¨¡åˆ©ç”¨ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å…¬å¼€çš„ POC è¿›è¡ŒäºŒæ¬¡ä¿®æ”¹å’Œæ”»å‡»ã€‚
*   ç¼ºä¹ä»£ç å®¡æŸ¥ï¼šåœ¨æ²¡æœ‰è¿›è¡Œè¯¦ç»†ä»£ç å®¡æŸ¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ã€‚
*   C# POCä»£ç ï¼Œå¯èƒ½å­˜åœ¨åŠ è½½æ¶æ„dllï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
å› æ­¤ï¼Œåˆæ­¥åˆ¤æ–­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¼°è®¡ä¸º 10%ã€‚ä½¿ç”¨è¯¥ POC ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡æŸ¥å’Œå®‰å…¨è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [1342486672/Flangvik](https://github.com/1342486672/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #2

**æ¥æº**: [CVE-2021-26855-Flangvik_SharpProxyLogon.md](../2021/CVE-2021-26855-Flangvik_SharpProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013, 2016, and 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬å‚è€ƒæ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange Server çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855ï¼ˆProxyLogonï¼‰æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange Server æœ¬èº«è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚CVE-2021-27065ï¼‰ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ C# POC ä»£ç  `SharpProxyLogon` åˆ©ç”¨äº† ProxyLogon æ¼æ´é“¾ã€‚æ ¹æ® README.md ä¸­çš„æè¿°å’Œç¤ºä¾‹ï¼Œæ­¤ POC å…è®¸æ”»å‡»è€…ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶æœ€ç»ˆåœ¨ç›®æ ‡ Exchange Server ä¸Šæ‰§è¡Œä»£ç ã€‚ POC æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€æ˜¯é€šè¿‡ webshell è½åœ°æ‰§è¡Œå‘½ä»¤ï¼ŒäºŒæ˜¯é€šè¿‡ shellcode æ³¨å…¥åˆ° `svchost.exe` è¿›ç¨‹ä¸­ã€‚ä»ç¤ºä¾‹è¾“å‡ºç»“æœæ¥çœ‹ï¼ŒPOC èƒ½å¤ŸæˆåŠŸè·å–ç›®æ ‡ç³»ç»Ÿçš„ SYSTEM æƒé™ï¼Œè¡¨æ˜è¯¥ä»£ç åœ¨æœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿä¸Šæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä»“åº“çš„ä¸»è¦æ–‡ä»¶æ˜¯ `SharpProxyLogon.sln` å’Œ `SharpProxyLogon` ç›®å½•ä¸‹çš„ C# ä»£ç ã€‚æ ¹æ® `README.md` æ–‡ä»¶å’Œä»£ç ç»“æ„æ¥çœ‹ï¼Œè¯¥ POC ä¸»è¦ç”¨äºåˆ©ç”¨ ProxyLogon æ¼æ´é“¾è¿›è¡Œ RCEï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚è™½ç„¶ `SharpProxyLogon` ä½¿ç”¨äº† `TikiTorch` ä»£ç è¿›è¡Œ shellcode æ³¨å…¥ï¼Œä½†è¿™æ˜¯ä¸€ç§å¸¸è§çš„æŠ€æœ¯ï¼Œæœ¬èº«ä¸æ„æˆæŠ•æ¯’ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•æ¥æºä¸æ˜çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½ä¿®æ”¹æˆ–æ·»åŠ æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹Ÿ Exchange Server çš„èº«ä»½å‘é€ HTTP è¯·æ±‚ã€‚
2.  **åç«¯æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰ï¼š** ç»“åˆå…¶ä»–æ¼æ´ï¼Œä¾‹å¦‚ä¸å®‰å…¨çš„åºåˆ—åŒ–æˆ–ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Webshell è½åœ°ï¼š** POC å¯ä»¥å°† webshell å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ Web ç›®å½•ä¸‹ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚
4.  **Shellcode æ³¨å…¥ï¼š** POC è¿˜å¯ä»¥å°† shellcode æ³¨å…¥åˆ° `svchost.exe` ç­‰è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œã€‚

**æœç´¢å¼•æ“ç»“æœåˆ†æï¼š**

æœç´¢ç»“æœè¯å®äº† CVE-2021-26855 çš„ä¸¥é‡æ€§å’Œè¢«å¹¿æ³›åˆ©ç”¨çš„æƒ…å†µã€‚å¤šä¸ªæ¥æºè¡¨æ˜è¯¥æ¼æ´æ˜¯ä¸€ä¸ª SSRF æ¼æ´ï¼Œå…è®¸æœªç»éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚ã€‚è¯¥æ¼æ´å¸¸ä¸å…¶ä»– Exchange Server æ¼æ´ä¸€èµ·åˆ©ç”¨ï¼Œå½¢æˆ ProxyLogon æ¼æ´é“¾ï¼Œä»è€Œå®ç° RCEã€‚

**é¡¹ç›®åœ°å€:** [Flangvik/SharpProxyLogon](https://github.com/Flangvik/SharpProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #3

**æ¥æº**: [CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md](../2021/CVE-2021-26855-Immersive-Labs-Sec_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013, 2016, å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼ˆå…·ä½“ç‰ˆæœ¬è§æ¼æ´åº“ä¿¡æ¯ï¼‰

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ Web æ¥å£ (OWA/ECP)ã€‚åˆ©ç”¨é“¾ä¸­éœ€è¦ä¸å…¶ä»–æ¼æ´é…åˆï¼ˆå¦‚ CVE-2021-26857ï¼‰ã€‚é€šå¸¸ä¸éœ€è¦èº«ä»½éªŒè¯å³å¯å‘èµ·æ”»å‡»ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨ã€‚é€šè¿‡åˆ©ç”¨æ­¤ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ï¼Œä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç æè¿°ï¼Œæ­¤æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆä¾‹å¦‚ UpGuardï¼ŒNVDï¼ŒMicrosoft å®˜æ–¹åšå®¢ï¼ŒTenable ç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œè¢«ç§¯æåˆ©ç”¨çš„æƒ…å†µã€‚æä¾›çš„ä»£ç æ–‡ä»¶ `proxylogon.py` ä¼¼ä¹æ˜¯å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„åˆ©ç”¨ç¨‹åºï¼Œå¯ä»¥é“¾å¼åˆ©ç”¨ CVE-2021-26855 å’Œ CVE-2021-26857 æ¥æ‰§è¡Œä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äº`proxylogon.py` ä¸­ä½¿ç”¨`eval(Request["cmd"],"unsafe")` æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„ `cmd` å‚æ•°ï¼Œå…·æœ‰é«˜é£é™©ã€‚æ­¤æ–¹æ³•å…è®¸æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¦‚æœæ”»å‡»è€…æ¶æ„æ„é€  `cmd` çš„å†…å®¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚è™½ç„¶ä½œè€…å¯èƒ½å‡ºäºæ–¹ä¾¿åˆ©ç”¨çš„ç›®çš„æ·»åŠ æ­¤åŠŸèƒ½ï¼Œä½†ä¹Ÿä¸ºæ¶æ„ä½¿ç”¨è€…æ‰“å¼€äº†æ–¹ä¾¿ä¹‹é—¨ã€‚å¦ä¸€ä¸ªé£é™©ç‚¹åœ¨äºï¼Œè„šæœ¬ä¸­çš„powershellå‘½ä»¤ï¼ˆé€šè¿‡`revPSScriptUrl`ä¼ å…¥ï¼‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¥è‡ªä¸å—ä¿¡ä»»æºçš„powershellè„šæœ¬æ˜¯å±é™©çš„ã€‚ç„¶è€Œï¼Œä»£ç ä¸­æä¾›äº†å…è´£å£°æ˜ï¼Œå£°æ˜å…¶ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ï¼Œå¹¶ä¸”ç»™å‡ºäº†Immersive Labsçš„é“¾æ¥ä»¥ä¾›å®‰å…¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œä½¿æ”»å‡»è€…å¯ä»¥å†’å…… Exchange æœåŠ¡å™¨ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ– (CVE-2021-26857):** é€šè¿‡ SSRF æ¼æ´è·å¾—æƒé™åï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  **Web Shell éƒ¨ç½²:** ä¸Šä¼ å¹¶éƒ¨ç½² Web Shellï¼Œä»¥ä¾¿æ”»å‡»è€…å¯ä»¥æŒç»­è®¿é—® Exchange æœåŠ¡å™¨å¹¶æ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç ä¸­çš„ `shell_payload` å˜é‡å®šä¹‰äº†ç”¨äºéƒ¨ç½² Web shell çš„ JScript ä»£ç ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** ä½¿ç”¨Web Shellæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚æ‰§è¡Œpowershellè„šæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Immersive-Labs-Sec/ProxyLogon](https://github.com/Immersive-Labs-Sec/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #4

**æ¥æº**: [CVE-2021-26855-Nick-Yin12_106362522.md](../2021/CVE-2021-26855-Nick-Yin12_106362522.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, ä»¥åŠ 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡æœåŠ¡å™¨è¿è¡Œå—å½±å“çš„ Microsoft Exchange Server ç‰ˆæœ¬ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿œç¨‹æ‰§è¡Œä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚ æœç´¢å¼•æ“ç»“æœæ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç `/tmp/48fee3cb76dd8f17cfc4f0c4e5929ece/README.md` åªæ˜¯ä¸€ä¸ªæè¿°æ¼æ´çš„ä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢ä¸»è¦è®²è¿°äº†æ¼æ´çš„å‘ç°å’ŒæŠ¥å‘Šè¿‡ç¨‹ï¼Œä»¥åŠå¯¹å¾®è½¯å®‰å…¨é˜²æŠ¤çš„çœ‹æ³•ã€‚å¹¶æ²¡æœ‰å‘ç°ä»»ä½•ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œä½†é‰´äºæ­¤ç±»æ¼æ´ç»å¸¸è¢«æ‰“åŒ…æˆå¤æ‚çš„åˆ©ç”¨å·¥å…·ï¼Œå¹¶ä¸”åˆ©ç”¨è¿‡ç¨‹å¯èƒ½æ¶‰åŠå¤šä¸ªé˜¶æ®µå’Œç»„ä»¶ï¼Œå› æ­¤ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚å¦‚æœå…¶ä»–æ–‡ä»¶å­˜åœ¨æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½è¢«åˆ©ç”¨è¿›è¡ŒæŠ•æ¯’ã€‚è¿™é‡Œç»™å‡ºçš„10%çš„æŠ•æ¯’é£é™©æ˜¯åŸºäºè¯¥æ¼æ´æœ¬èº«çš„é«˜å±æ€§å’Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨å¤šç§æ–¹å¼è¿›è¡Œæ”»å‡»çš„ç»¼åˆè€ƒé‡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ï¼Œå†™å…¥æ¶æ„ Web Shell æˆ–å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ã€‚
3.  é€šè¿‡ Web Shell æˆ–å…¶ä»–æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å¾—æœåŠ¡å™¨æ§åˆ¶æƒã€‚

æ­¤æ¼æ´ä¹Ÿè¢«ç§°ä¸º ProxyLogonï¼Œæ˜¯å¤šä¸ª Exchange æ¼æ´åˆ©ç”¨é“¾ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå¸¸ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [Nick-Yin12/106362522](https://github.com/Nick-Yin12/106362522)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #5

**æ¥æº**: [CVE-2021-26855-RickGeex_ProxyLogon.md](../2021/CVE-2021-26855-RickGeex_ProxyLogon.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨ExchangeæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ€ç»ˆä»¥ SYSTEM æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š**  åˆ©ç”¨autodiscover.xmlè·å–LegacyDNä¿¡æ¯ã€‚
3.  **è·å–SIDï¼š** ä½¿ç”¨/mapi/emsmdbç«¯ç‚¹è·å–Security ID (SID)ã€‚
4.  **æ·»åŠ é‚®ç®±æƒé™ï¼š**  ä½¿ç”¨è·å–çš„ SIDï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶å‘ä»»æ„é‚®ç®±æ·»åŠ è®¿é—®æƒé™ã€‚
5.  **å†™å…¥ Webshellï¼š**  æœ€ç»ˆï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å†™å…¥ Webshell ç­‰æ–¹å¼åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ProxyLogon.py` å®ç°äº† ProxyLogon æ”»å‡»é“¾çš„å‰å‡ ä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬ FQDN è§£æã€LegacyDN è·å–å’Œ SID è·å–ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼ŒPOC ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥POCæœ¬èº«ç›®çš„æ˜¯å¤ç°æ¼æ´åˆ©ç”¨ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹payloadå†…å®¹ï¼Œæ¯”å¦‚åœ¨stage3/4ä¸­é€šè¿‡æ‰§è¡Œå‘½ä»¤æ·»åŠ æ¶æ„è´¦æˆ·ã€å®‰è£…åé—¨ï¼Œçš„ç¡®å­˜åœ¨æŠ•æ¯’çš„é£é™©ã€‚ç›®å‰çœ‹ä»£ç æœ¬èº«æ˜¯ä¸ºäº†æ¼æ´å¤ç°ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ä¸èƒ½æ’é™¤è¢«ä¿®æ”¹åè¿›è¡Œä¼ æ’­çš„å¯èƒ½æ€§ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º 5%ã€‚

**é¡¹ç›®åœ°å€:** [RickGeex/ProxyLogon](https://github.com/RickGeex/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #6

**æ¥æº**: [CVE-2021-26855-ShyTangerine_cve-2021-26855.md](../2021/CVE-2021-26855-ShyTangerine_cve-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œè¯¦è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ ECP æ¥å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1.  **åˆå§‹è¯·æ±‚ï¼š** å‘ `/ecp/x.png` å‘é€ GET è¯·æ±‚ï¼Œå°è¯•è·å– `X-BEResource` Cookieã€‚
2.  **è·å– DN å€¼ï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç”¨æˆ·çš„ DN (Distinguished Name)ã€‚
3.  **Mapi/Emsmdb è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ DN å€¼ï¼Œå‘ `/ecp/x.png` å‘é€åŒ…å« `X-BEResource`ã€`X-Clientinfo` ç­‰å¤´çš„ POST è¯·æ±‚ï¼Œå°è¯•å»ºç«‹ MAPI over HTTP è¿æ¥ã€‚
4.  **è·å– Session å’Œ msExchEcpCanaryï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Negotiate åè®®è·å– ASP.NET Session ID å’Œ `msExchEcpCanary` å€¼ã€‚`msExchEcpCanary` æ˜¯ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œï¼Œç”¨äºé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) æ”»å‡»ã€‚
5.  **è·å– OAB IDï¼š** å‘é€åŒ…å«`msExchEcpCanary` å’Œ Session ID åˆ°`/ecp/x.png`ï¼Œè·å–OAB idï¼Œä¸ºä¸‹ä¸€æ­¥å†™å…¥æ¶æ„ä»£ç ä½œå‡†å¤‡

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´ç¡®å®å­˜åœ¨ä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚è¯¥ POC ä»£ç å±•ç¤ºäº†æ¼æ´åˆ©ç”¨çš„å…³é”®æ­¥éª¤ï¼Œä¾‹å¦‚å¦‚ä½•ç»•è¿‡èº«ä»½éªŒè¯ã€å¦‚ä½•è·å–å¿…è¦çš„å‡­æ®ä¿¡æ¯ç­‰ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯„ä¼°æä¾›çš„ POC ä»£ç ï¼Œå­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œ10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äºï¼š

*   **ç¡¬ç¼–ç çš„ IP åœ°å€å’ŒåŸŸåï¼š** POC ä»£ç ä¸­åŒ…å«ç¡¬ç¼–ç çš„ IP åœ°å€ (ä¾‹å¦‚ `10.255.200.20`, `192.168.170.134`) å’ŒåŸŸå (`EXCHANGE01.xihongdream.com`)ã€‚å¦‚æœç”¨æˆ·ç›´æ¥ä½¿ç”¨è¿™äº›ç¡¬ç¼–ç çš„å€¼ï¼Œå¯èƒ½ä¼šå°†æ”»å‡»æµé‡å¯¼å‘ä½œè€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œæš´éœ²ç›®æ ‡æœåŠ¡å™¨çš„ä¿¡æ¯æˆ–è¢«ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

*   **æ½œåœ¨çš„åé—¨æ¤å…¥ï¼š** è™½ç„¶ POC ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´åˆ©ç”¨è¿‡ç¨‹ï¼Œä½†ä½œè€…æœ‰å¯èƒ½åœ¨ä»£ç ä¸­æ’å…¥åé—¨ï¼Œä¾‹å¦‚ï¼Œåœ¨OABæ“ä½œä¸­ï¼Œå†™å…¥æ¶æ„è„šæœ¬åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œé•¿æœŸæ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚

æ€»çš„æ¥è¯´ï¼Œè¯¥ POC ä»£ç ä¸»è¦æ¼”ç¤ºäº† SSRF çš„åˆ©ç”¨æ–¹å¼ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶åº”è°¨æ…ï¼ŒåŠ¡å¿…ä¿®æ”¹ä»£ç ä¸­çš„ç¡¬ç¼–ç å€¼ï¼Œé¿å…æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [ShyTangerine/cve-2021-26855](https://github.com/ShyTangerine/cve-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #7

**æ¥æº**: [CVE-2021-26855-TheDudeD6_ExchangeSmash.md](../2021/CVE-2021-26855-TheDudeD6_ExchangeSmash.md)

## CVE-2021-26855-Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯è®¿é—®ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å†’å……ç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–åˆæ³•çš„èº«ä»½ã€‚
2.  **è·å–SIDï¼š** ä½¿ç”¨åˆæ³•çš„èº«ä»½ï¼Œè·å–ç”¨æˆ·çš„SID
3.  **ä¼ªé€ ç®¡ç†å‘˜ SIDï¼š** é€šè¿‡ç¯¡æ”¹å·²æ³„éœ²çš„ç”¨æˆ·SIDï¼Œä¼ªé€ ç®¡ç†å‘˜SID
4.  **ProxyLogonï¼š** ä½¿ç”¨ä¼ªé€ çš„ç®¡ç†å‘˜ SID é€šè¿‡ ProxyLogon æ”»å‡»é“¾ï¼Œè·å¾—ç®¡ç†å‘˜æƒé™ã€‚
5.  **å†™å…¥webshellï¼š** åˆ©ç”¨ç®¡ç†å‘˜æƒé™ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥ webshellã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** é€šè¿‡è®¿é—® webshell æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹æä¾›çš„POCä»£ç ï¼Œå‘ç°å…¶åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸åº”å­˜åœ¨æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºä»£ç é€»è¾‘å¤æ‚ï¼Œä¸”ä¾èµ–å¤–éƒ¨åº“ï¼ˆImpacketï¼‰ï¼Œå­˜åœ¨ä½œè€…åœ¨ä»£ç ä¸­æ¤å…¥æ¶æ„é€»è¾‘çš„å¯èƒ½æ€§ã€‚å¦å¤–ï¼Œé€šè¿‡åˆ†æå‘ç°proxylogon.pyä¸­çš„shell_srcå˜é‡å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè¢«æ›¿æ¢æˆæ¶æ„payloadï¼Œåˆ™å­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦é£é™©åœ¨äºä»£ç çš„å¯ä¿¡åº¦ä»¥åŠshell_srcå˜é‡çš„æ›¿æ¢ã€‚

**é¡¹ç›®åœ°å€:** [TheDudeD6/ExchangeSmash](https://github.com/TheDudeD6/ExchangeSmash)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #8

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF to RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (Server-Side Request Forgery) -> RCE (Remote Code Execution)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯ä»¥ä»æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 å­˜åœ¨äº Microsoft Exchange Server ä¸­ï¼Œæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ©ç”¨æ­¤æ¼æ´ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼š** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ SSRF æ¼æ´ï¼Œå‘ Exchange æœåŠ¡å™¨çš„ autodiscover ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å¾—çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **è·å– SIDï¼š** ä» MAPI å“åº”ä¸­æå–ç”¨æˆ·çš„ SIDã€‚
5.  **ProxyLogonï¼š** åˆ©ç”¨ SID ä¼ªé€ èº«ä»½ï¼Œé€šè¿‡ proxyLogon.ecp ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ã€‚
6.  **å†™å…¥ Webshellï¼š** æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„çš„ webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸­ã€‚
7.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„ webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ExchangeSheller.py` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æµç¨‹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åˆ©ç”¨ CVE-2021-26855 æ¼æ´ï¼Œå› æ­¤æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç æœ¬èº«æ‰§è¡Œçš„æ˜¯æ¼æ´åˆ©ç”¨æµç¨‹ï¼Œä¸»è¦åŠŸèƒ½ä¸ºåˆ©ç”¨ SSRF æ¼æ´å¹¶æœ€ç»ˆå†™å…¥ Webshellã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä»£ç æ¥æºï¼š** ä»£ç æ¥è‡ª GitHubï¼Œéœ€è¦éªŒè¯å…¶ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®Œæ•´æ€§ã€‚
*   **Webshell å†…å®¹ï¼š** Webshell çš„å†…å®¹å¯æ§ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ webshell çš„å†…å®¹ï¼Œä½¿å…¶æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ¤å…¥åé—¨ã€çªƒå–æ•°æ®ç­‰ã€‚
*   **éšè—æŒ‡ä»¤ï¼š** ç†è®ºä¸Šï¼Œeval å‡½æ•°ä¸­å¯ä»¥åµŒå…¥éšè”½çš„æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦ä»”ç»†åˆ†æ `ExchangeSheller.py` æ–‡ä»¶ï¼Œå½“å‰åˆ¤æ–­è¯¥é£é™©è¾ƒä½ã€‚

**ç»“è®ºï¼š**

è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹webshellçš„å†…å®¹ï¼Œä½†æ€»ä½“æ¥è¯´ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¸…æ™°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%ã€‚åŠ¡å¿…åœ¨éš”ç¦»ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å¯¹ç”Ÿæˆçš„ webshell è¿›è¡Œå®‰å…¨å®¡è®¡ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855](https://github.com/ZephrFish/Exch-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #9

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨å—å½±å“çš„ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰æ¥å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹æ®Šçš„ URL å’Œè¯·æ±‚å¤´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„è®¿é—®æƒé™ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **ProxyLogon:** é€šè¿‡æ„é€  ProxyLogon è¯·æ±‚ï¼Œä¼ªè£…æˆç®¡ç†å‘˜èº«ä»½ã€‚
5.  **å†™å…¥ Webshell (CVE-2021-27065ï¼Œè™½ç„¶POCæœªç›´æ¥ä½“ç°ï¼Œä½†é€šå¸¸ä¼šç»“åˆä½¿ç”¨):** åœ¨æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åï¼Œåˆ©ç”¨æ¼æ´åœ¨ Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸‹å†™å…¥æ¶æ„çš„ Webshell æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç çš„ JScript ä»£ç ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå†ç°äº† ProxyLogon æ”»å‡»é“¾çš„å…³é”®æ­¥éª¤ï¼ŒåŒ…æ‹¬ SSRFã€æƒé™æå‡å’Œ webshell å†™å…¥ (webshell å†…å®¹åœ¨ä»£ç ä¸­å·²ç»å­˜åœ¨)ã€‚æœç´¢å¼•æ“ç»“æœä¸­ä¹Ÿè¡¨æ˜ CVE-2021-26855 è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†ææä¾›çš„ POC ä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨åˆ©ç”¨ SSRF æ¼æ´è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ï¼Œå¹¶æœ€ç»ˆéƒ¨ç½² webshellã€‚è™½ç„¶ webshell æœ¬èº«æ˜¯ä¸€ç§æ¶æ„ä»£ç ï¼Œä½†è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤ï¼Œè€Œéä½œè€…æœ‰æ„æ·»åŠ çš„æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855_Priv](https://github.com/ZephrFish/Exch-CVE-2021-26855_Priv)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #10

**æ¥æº**: [CVE-2021-26855-dwisiswant0_proxylogscan.md](../2021/CVE-2021-26855-dwisiswant0_proxylogscan.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„ Exchange Server çš„ç½‘ç»œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……ç®¡ç†å‘˜èº«ä»½ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œä¸ CVE-2021-27065 (èº«ä»½éªŒè¯åä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´) ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange Serverï¼Œç»•è¿‡èº«ä»½éªŒè¯å¹¶è·å¾—ç®¡ç†å‘˜æƒé™ã€‚
2.  åˆ©ç”¨è·å¾—çš„ç®¡ç†å‘˜æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ CVE-2021-27065 å°†æ¶æ„ä»£ç å†™å…¥æœåŠ¡å™¨ã€‚
3.  æ‰§è¡Œå†™å…¥çš„æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æï¼š**

æä¾›çš„ POC ä»£ç  `proxylogscan` æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¼–å†™çš„å·¥å…·ï¼Œç”¨äºå¤§è§„æ¨¡æ‰«æå­˜åœ¨ CVE-2021-26855 æ¼æ´çš„ Microsoft Exchange Serverã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯æ‰«ææ¼æ´ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚ è€ƒè™‘åˆ°å·¥å…·çš„ç”¨é€”å’Œä»£ç çš„ç®€æ´æ€§ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯éœ€è¦å¯¹ä»£ç è¿›è¡Œä»”ç»†çš„å®¡æŸ¥ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠç½‘ç»œè¯·æ±‚çš„éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚ æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ä»£ç ä½¿ç”¨go getå®‰è£…ï¼Œå­˜åœ¨ä¸€å®šçš„ä¾èµ–é£é™©,éœ€è¦æ³¨æ„.


**é¡¹ç›®åœ°å€:** [dwisiswant0/proxylogscan](https://github.com/dwisiswant0/proxylogscan)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #11

**æ¥æº**: [CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md](../2021/CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 22 å’Œ 23, Exchange Server 2016 Cumulative Update 12-19, Exchange Server 2019 Cumulative Update 1-8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æœªä¿®è¡¥çš„ Exchange Server å®ä¾‹ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange æœåŠ¡å™¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸ºåç»­åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰åˆ›é€ æ¡ä»¶ã€‚æ¼æ´åˆ©ç”¨é“¾é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–:** é€šè¿‡ SSRF æ¼æ´è·å–çš„æƒé™ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26854, CVE-2021-26857, CVE-2021-27065ï¼‰æ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„ PoC ä»£ç æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ ProxyLogon æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œå®ƒåˆ©ç”¨ CVE-2021-26855 ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªåé—¨ Web shellã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1.  **è‡ªåŠ¨å‘ç° (Autodiscover):** ä½¿ç”¨ Autodiscover åè®®è·å– LegacyDNã€‚
2.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ï¼Œæ¨¡æ‹Ÿç®¡ç†å‘˜æƒé™ã€‚
3.  **Web Shell å†™å…¥:**  å°†åŒ…å«åå‘ shell ä»£ç çš„ aspx Web shell å†™å…¥åˆ°æœåŠ¡å™¨çš„ `Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\test11.aspx` è·¯å¾„ã€‚
4.  **æ‰§è¡Œ Web Shell:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥ Web shell æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥ Web shell æ‰§è¡Œ Powershell å‘½ä»¤ï¼Œå»ºç«‹ä¸€ä¸ªåå‘ TCP è¿æ¥åˆ°æ”»å‡»è€…çš„æŒ‡å®š IP åœ°å€å’Œç«¯å£ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** è¯¥ PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº† ProxyLogon æ¼æ´åˆ©ç”¨ï¼Œå¹¶æˆåŠŸåˆ›å»ºåå‘ shellï¼Œè¯æ˜äº†è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š** å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ä½œè€…åœ¨åŸå§‹PoCåŸºç¡€ä¸Šä¿®æ”¹äº†ä»£ç ï¼Œå¢åŠ äº†åˆ›å»ºç”¨æˆ·å’Œåå‘shellçš„åŠŸèƒ½ï¼Œè¯¥è¡Œä¸ºå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†åå‘shellä¸­çš„IPåœ°å€å’Œç«¯å£ï¼Œåˆ™ä½¿ç”¨è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ é£é™©å¤§çº¦åœ¨10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2021-26855 æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ï¼Œç„¶åé€šè¿‡å†™å…¥ Web shell æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™ä¸ª Web shell ä¼šè¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œå…è®¸æ”»å‡»è€…å®Œå…¨æ§åˆ¶å—æ„ŸæŸ“çš„ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [glen-pearson/ProxyLogon-CVE-2021-26855](https://github.com/glen-pearson/ProxyLogon-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #12

**æ¥æº**: [CVE-2021-26855-hakivvi_proxylogon.md](../2021/CVE-2021-26855-hakivvi_proxylogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„ExchangeæœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 21/22/23, Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„ç½‘ç»œï¼Œå¹¶ä¸”æœåŠ¡å™¨å­˜åœ¨æ¼æ´

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚CVE-2021-27065ï¼‰ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ç®¡ç†å‘˜èº«ä»½é€šè¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ä¼ªé€  HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **ç®¡ç†å‘˜æƒé™è·å–:** åˆ©ç”¨ä¼ªé€ çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜æƒé™ã€‚
3.  **OABè™šæ‹Ÿç›®å½•æ“ä½œ:** ä¿®æ”¹OAB (Offline Address Book)è™šæ‹Ÿç›®å½•çš„ExternalUrlå‚æ•°ï¼Œå°†shellåœ°å€å†™å…¥ã€‚
4.  **Shell å†™å…¥:** é€šè¿‡ä¿®æ”¹çš„ExternalUrlï¼Œæ”»å‡»è€…å°†ä¸€ä¸ª ASPX webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ web å¯è®¿é—®ç›®å½•ï¼ˆé€šå¸¸æ˜¯`C:\inetpub\wwwroot\aspnet_client\`ï¼‰ã€‚ 
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—® webshell çš„ URL å¹¶å‘é€ç‰¹å®šçš„è¯·æ±‚å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**ä»£ç åˆ†æä¸æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç  `proxylogon.py` å®ç°äº†ä¸Šè¿°çš„æ”»å‡»æµç¨‹ã€‚ä»£ç é¦–å…ˆåˆ©ç”¨ SSRF è·å–æœåŠ¡å™¨çš„è®¡ç®—æœºåï¼Œç„¶ååˆ©ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚ä¹‹åï¼Œå®ƒåˆ©ç”¨è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œé€šè¿‡ä¿®æ”¹ OAB è™šæ‹Ÿç›®å½•æ¥å†™å…¥ webshellã€‚æœ€åï¼Œä»£ç è¾“å‡º webshell çš„ URLï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥ URL æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**  POCä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **åé—¨æ¤å…¥:** è™½ç„¶ä¸»è¦çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡ŒRCEï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¼šåœ¨è„šæœ¬ä¸­æ·»åŠ é¢å¤–çš„åé—¨ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨å†™å…¥çš„ webshell ä¸­æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å°†æ¥ä¿æŒå¯¹æœåŠ¡å™¨çš„è®¿é—®ã€‚
*   **ä¿¡æ¯æ”¶é›†:**  æ”»å‡»è€…å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥æ”¶é›†ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·åã€å¯†ç å“ˆå¸Œã€ä»¥åŠå…¶ä»–é…ç½®ä¿¡æ¯ã€‚
*   **æ¶æ„ä¼ æ’­:**  å¦‚æœæ”»å‡»è€…æ§åˆ¶äº†å¤šä¸ª Exchange æœåŠ¡å™¨ï¼Œä»–ä»¬å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥è‡ªåŠ¨ä¼ æ’­æ¶æ„è½¯ä»¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚
*   **ä¾èµ–åº“é£é™©ï¼š**POCä¾èµ–Impacketåº“ï¼Œå¦‚æœImpacketåº“æœ¬èº«è¢«ç¯¡æ”¹æˆ–åŒ…å«æ¶æ„ä»£ç ï¼Œé‚£ä¹ˆä½¿ç”¨æ­¤POCä¹Ÿä¼šå—åˆ°å½±å“ã€‚

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†å°±æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«è€Œè¨€ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚é£é™©ä¸»è¦åœ¨äºè¯¥æ¼æ´æœ¬èº«å¸¦æ¥çš„æƒé™å’Œæ½œåœ¨çš„æ¶æ„ä¿®æ”¹è¡Œä¸ºã€‚POCä¸­ç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„éƒ¨åˆ†(gen())æ˜¯ä¸ºäº†é¿å…æ–‡ä»¶åå†²çªï¼Œæœ¬èº«ä¸æ˜¯æ¶æ„è¡Œä¸ºã€‚åˆ©ç”¨OABVirtualDirectoryä¿®æ”¹ExternalUrlä»¥åŠResetOABVirtualDirectoryä¿®æ”¹FilePathNameçš„è¡Œä¸ºæ˜¯ä¸ºäº†webshellçš„å†™å…¥ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

**æ€»ç»“:** è¯¥æ¼æ´åˆ©ç”¨é“¾çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸º CVE-2021-26855 æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚ æŠ•æ¯’é£é™©ä¸»è¦æ¥è‡ªäºåˆ©ç”¨æ­¤æ¼æ´æˆåŠŸå…¥ä¾µåçš„æ¶æ„è¡Œä¸ºï¼Œè€ŒéPOCä»£ç æœ¬èº«ã€‚ç”±äºä»£ç ä¸­åŒ…å«webshellçš„éƒ¨ç½²ï¼Œå­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†ç›´æ¥åˆ¤å®šä¸ºæŠ•æ¯’ä¸ä¸¥è°¨ï¼Œç»“åˆåˆ†æç»“æœï¼ŒæŠ•æ¯’é£é™©é¢„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [hakivvi/proxylogon](https://github.com/hakivvi/proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #13

**æ¥æº**: [CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md](../2021/CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) -> è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®‰è£…ç›¸å…³è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRF æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶ç»“åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚
2.  é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ã€‚
3.  ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œååºåˆ—åŒ–æ¼æ´ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ªç®€å•çš„ PHP æ–‡ä»¶ï¼ˆhello worldï¼‰ï¼Œä¸€ä¸ª README æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„ Node.js æœåŠ¡å™¨ (demo.js) å’Œä¸€ä¸ª package.json æ–‡ä»¶ã€‚è¿™äº›ä»£ç ç‰‡æ®µæœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨ CVE-2021-26855ã€‚å®ƒä»¬æ›´åƒæ˜¯ç”¨äºæ­å»ºä¸€ä¸ªåŸºç¡€çš„webæœåŠ¡å™¨ç¯å¢ƒï¼Œå¯èƒ½ç”¨äºéªŒè¯æ¼æ´åˆ©ç”¨çš„æŸäº›æ­¥éª¤æˆ–ä½œä¸ºæœ€ç»ˆæ‰§è¡Œçš„payloadçš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå•ç‹¬æ¥çœ‹ï¼Œæä¾›çš„POCä»£ç **æ— æ•ˆ**ï¼Œå®ƒåªæ˜¯åˆ©ç”¨æ•´ä¸ªæ¼æ´é“¾ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„ POC ä»£ç è¾ƒä¸ºç®€å•ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚`demo.js` åªæ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œ`1.php` åªæ˜¯è¾“å‡º "hello world"ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ª Exchange æ¼æ´çš„ POCï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨æ›´å¤æ‚çš„åˆ©ç”¨é“¾ä¸­åˆ©ç”¨è¿™äº›æ–‡ä»¶ï¼Œä¾‹å¦‚å°† `1.php` ä½œä¸º Webshell ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ–è€…åˆ©ç”¨ `demo.js` æ­å»ºä¸€ä¸ªç”¨äºæ¥æ”¶åå¼¹ shell çš„æœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ–¹å¼çš„ç»„åˆï¼Œè€Œéä»£ç æœ¬èº«å­˜åœ¨åé—¨ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

ç”±äºä»£ç åŠŸèƒ½ç®€å•ï¼Œç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†ä½œä¸ºæ¼æ´åˆ©ç”¨é“¾çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½è¢«ç”¨äºæ‰§è¡Œæ¶æ„æ“ä½œï¼Œå› æ­¤æŠ•æ¯’é£é™©è¯„å®šä¸º **20%**ã€‚

**é¡¹ç›®åœ°å€:** [hictf/CVE-2021-26855-CVE-2021-27065](https://github.com/hictf/CVE-2021-26855-CVE-2021-27065)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #14

**æ¥æº**: [CVE-2021-26855-hosch3n_ProxyVulns.md](../2021/CVE-2021-26855-hosch3n_ProxyVulns.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæ— éœ€èº«ä»½éªŒè¯å³å¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** Exchange Serverå¯¹å¤–å¼€æ”¾443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜ã€‚æ­¤æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ï¼Œåç»­å¯ä»¥é…åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­è®¸å¤šé“¾æ¥éƒ½è¡¨æ˜ CVE-2021-26855 å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `26855.py` å®ç°äº†åˆ©ç”¨è¯¥æ¼æ´çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š

1.  **SSRF æ¢æµ‹ï¼š** é€šè¿‡æ„é€ ç‰¹æ®Šçš„ `X-BEResource` è¯·æ±‚å¤´ï¼Œè·å– Exchange åç«¯æœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **LegacyDN è·å–ï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡ï¼Œé€šè¿‡æä¾›ç”¨æˆ·é‚®ç®±åœ°å€è·å– LegacyDNã€‚
3.  **SID æ¬ºéª—ï¼š** ä¼ªé€  MAPI è¯·æ±‚ï¼Œé€šè¿‡ LegacyDN è·å–ç”¨æˆ·çš„ SIDã€‚
4.  **ProxyLogon åˆ©ç”¨ï¼š** åˆ©ç”¨è·å–åˆ°çš„ SIDï¼Œé€šè¿‡ `proxyLogon.ecp` ç»•è¿‡èº«ä»½éªŒè¯ã€‚
5.  **Webshell éƒ¨ç½²ï¼š** å†™å…¥ Webshell åˆ°æœåŠ¡å™¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æ¼æ´åˆ©ç”¨ä»£ç ä¸­å­˜åœ¨è¾ƒä½çš„æŠ•æ¯’é£é™© (å¤§çº¦ 5%)ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†æ”»å‡»è€…å¯èƒ½åœ¨ `webshell_content` ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ `webshell_path` å°†webshellå†™å…¥åˆ°ä¸å¸¸è§çš„ä½ç½®ï¼Œä½¿å¾—åæœŸçš„æƒé™ç»´æŒæˆ–è€…æ¨ªå‘ç§»åŠ¨æ›´åŠ éšè”½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ`webshell_content`åŒ…å«ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶çš„æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯ä¸€ç§æŠ•æ¯’è¡Œä¸ºã€‚ ç›®å‰æä¾›çš„webshellä»£ç è¾ƒä¸ºç®€å•ï¼Œåˆ¤å®šæŠ•æ¯’çš„æ¦‚ç‡è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ (CVE-2021-26855) ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œæ¬ºéª— Exchange æœåŠ¡å™¨ï¼Œä½¿å…¶è®¤ä¸ºæ”»å‡»è€…å·²é€šè¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œå†™å…¥ä»»æ„æ–‡ä»¶ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéƒ¨ç½² Webshellã€‚
4.  æ”»å‡»è€…é€šè¿‡ Webshell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [hosch3n/ProxyVulns](https://github.com/hosch3n/ProxyVulns)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #15

**æ¥æº**: [CVE-2021-26855-kh4sh3i_ProxyLogon.md](../2021/CVE-2021-26855-kh4sh3i_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF/RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Exchange Server 2013ã€2016å’Œ2019çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ã€‚

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858 å’Œ CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** åˆ©ç”¨ SSRF æ¼æ´å†’å…… Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„ Exchange åç«¯èµ„æºã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ååºåˆ—åŒ–/RCEï¼š** åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä¿®æ”¹è™šæ‹Ÿç›®å½•æˆ–å†™å…¥Web shellï¼‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«ä¸€ä¸ª Creative Commons è®¸å¯è¯ï¼Œæœ¬èº«ä¸åŒ…å«ä»»ä½•åˆ©ç”¨ä»£ç æˆ–æ¶æ„ä»£ç ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä½†å®é™…åˆ©ç”¨æ—¶ï¼Œæ”»å‡»è€…éœ€è¦ç»“åˆå…¶ä»–æ¼æ´åˆ©ç”¨å·¥å…·å’Œpayloadæ‰èƒ½å®ç°æœ€ç»ˆçš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ã€‚å­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆè™½ç„¶è¿™é‡Œæ²¡æœ‰ç›´æ¥æä¾›ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜å­˜åœ¨ï¼‰ã€‚æ­¤æ¼æ´è¢« CISA åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œè¡¨æ˜è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æ€»ç»“ï¼š**
CVE-2021-26855 æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ©ç”¨ Exchange æœåŠ¡å™¨æ‰§è¡Œ SSRF æ”»å‡»ï¼Œä¸ºåç»­çš„è¿œç¨‹ä»£ç æ‰§è¡Œé“ºå¹³é“è·¯ã€‚åŠ¡å¿…å°½å¿«åº”ç”¨ Microsoft æä¾›çš„å®‰å…¨æ›´æ–°ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/ProxyLogon](https://github.com/kh4sh3i/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #16

**æ¥æº**: [CVE-2021-26855-mekhalleh_exchange_proxylogon.md](../2021/CVE-2021-26855-mekhalleh_exchange_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ Exchange Server å¿…é¡»å¯ä»ç½‘ç»œè®¿é—®,ä¸”æœªå®‰è£…ç›¸åº”çš„å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å†’å……ç®¡ç†å‘˜ã€‚è¯¥æ¼æ´æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥å¯¼è‡´ RCEï¼Œä½†å¯ä»¥ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªèº«ä»½éªŒè¯åçš„ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ç»“åˆä½¿ç”¨ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š**  æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡ Exchange Server çš„èº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š**  æˆåŠŸåˆ©ç”¨ SSRF åï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange Server çš„ç®¡ç†æƒé™ï¼Œæ— éœ€æä¾›æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥ï¼ˆCVE-2021-27065 æˆ–å…¶ä»–ï¼‰ï¼š**  è·å¾—èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…åˆ©ç”¨ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼Œå°†æ¶æ„ä»£ç å†™å…¥ Exchange Server çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡è®¿é—®å†™å…¥çš„æ¶æ„æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange Server ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Metasploit æ¨¡å— (`exchange_proxylogon.rb`) æ˜¯ä¸€ä¸ªæ‰«æå™¨ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡ Exchange Server æ˜¯å¦å­˜åœ¨ CVE-2021-26855 æ¼æ´ã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ‰«æå™¨æ£€æµ‹åˆ°æ¼æ´ï¼Œåˆ™è¡¨æ˜ç›®æ ‡æœåŠ¡å™¨å®¹æ˜“å—åˆ° ProxyLogon æ”»å‡»ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä»£ç ä¸»è¦æ˜¯ä¸€ä¸ªæ¼æ´éªŒè¯å’Œæ‰«æå·¥å…·ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©ä¼°è®¡ä¸º5%ã€‚ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯Metasploitæ¨¡å—ä¸­ä½¿ç”¨çš„HTTPè¯·æ±‚çš„æ„é€ ï¼Œä»¥åŠæ˜¯å¦ä¼šæ„å¤–åœ°å¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆç ´åã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹æ­¤æ¨¡å—ä»¥è¾¾åˆ°æ¶æ„ç›®çš„ï¼Œä½†åœ¨æä¾›çš„ä»£ç æœ¬èº«ä¸­æ²¡æœ‰å‘ç°æ­¤ç±»è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [mekhalleh/exchange_proxylogon](https://github.com/mekhalleh/exchange_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #17

**æ¥æº**: [CVE-2021-26855-praetorian-inc_proxylogon-exploit.md](../2021/CVE-2021-26855-praetorian-inc_proxylogon-exploit.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21/22/23ï¼ŒMicrosoft Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19ï¼ŒMicrosoft Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸ä¸å…¶ä»–æ¼æ´ç»„åˆåˆ©ç”¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ‰å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´ä¿¡æ¯ï¼Œè¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å®ƒä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œæœ€ç»ˆåœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å« Apache License 2.0 åè®®ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©æä½ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRF æ”»å‡»:** åˆ©ç”¨ CVE-2021-26855 å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨åç«¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡:** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜èº«ä»½è¿›è¡Œåç»­æ“ä½œã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ä»£ç æ‰§è¡Œ:** ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„ä»£ç å†™å…¥ Exchange æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆæ‰§è¡Œä»»æ„ä»£ç ã€‚

 è¯¥æ¼æ´å·²ç»è¢« CISA åŠ å…¥åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½• (KEV)ï¼Œè¡¨æ˜å…¶åœ¨é‡å¤–è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [praetorian-inc/proxylogon-exploit](https://github.com/praetorian-inc/proxylogon-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #18

**æ¥æº**: [CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md](../2021/CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„443ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œæœ€ç»ˆé€šè¿‡ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨ Autodiscover åè®®çš„ç¼ºé™·ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚ç”±äºæœåŠ¡å™¨ä¿¡ä»»æ¥è‡ªè‡ªèº«çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚ LegacyDN æ˜¯ Exchange æœåŠ¡å™¨ä¸­ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
3.  **ä¼ªé€  MAPI è¯·æ±‚ï¼š**  ä½¿ç”¨è·å–çš„ LegacyDNï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„ MAPI (Messaging Application Programming Interface) è¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€åˆ° Exchange æœåŠ¡å™¨ã€‚
4.  **å†™å…¥ Web Shell (CVE-2021-27065):** æ”»å‡»è€…åˆ©ç”¨åç«¯ç»„ä»¶çš„æ¼æ´å°†webshellå†™å…¥æœåŠ¡å™¨ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æˆåŠŸå†™å…¥webshellåï¼Œå³å¯é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶ExchangeæœåŠ¡å™¨ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªç»è¿‡å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„ PoC ä»£ç ã€‚æä¾›çš„ PoC ä»£ç å°è¯•æ¨¡æ‹Ÿ ProxyLogon æ¼æ´é“¾çš„åˆ©ç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ SSRFã€è·å– LegacyDNã€ä¼ªé€  MAPI è¯·æ±‚å’Œå†™å…¥ Web Shellã€‚æ ¹æ®PoCä»£ç å’Œæœç´¢ç»“æœçš„æè¿°ï¼Œæ­¤POCä»£ç å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œä½†æ˜¯éœ€è¦å’Œå…¶å®ƒæ¼æ´é…åˆåˆ©ç”¨ï¼Œæ‰èƒ½è¾¾æˆRCEã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

PoC ä»£ç æœ¬èº«ä¸»è¦åŠŸèƒ½æ˜¯è¿›è¡Œæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œç›´æ¥æ¤å…¥æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒä½ã€‚ ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **æ¶æ„ä»£ç æ··æ·†ï¼š** æ”»å‡»è€…å¯èƒ½å°†æ¶æ„ä»£ç éšè—åœ¨çœ‹ä¼¼æ— å®³çš„å­—ç¬¦ä¸²æˆ–å‡½æ•°ä¸­ã€‚
*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå¤–éƒ¨åº“æˆ–æ¨¡å—ï¼Œå¦‚æœè¿™äº›ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºæä¾›çš„ä»£ç ï¼Œç»è¿‡åˆ†æï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†æ˜¯ä»ç„¶ä¸èƒ½æ’é™¤ã€‚è¯¥ä»£ç å°è¯•åˆ©ç”¨æ¼æ´ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æ˜¯é€šè¿‡å†™å…¥webshellå®ç°çš„ï¼Œå¢åŠ webshellå†™å…¥ä½ç½®çš„éšæœºæ€§æœ‰å¯èƒ½è¢«ç”¨äºé€ƒé¿æ£€æµ‹ï¼Œå› æ­¤æœ‰ä¸€å®šçš„æ¦‚ç‡(10%)è¢«ç”¨äºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [r0xdeadbeef/CVE-2021-26855](https://github.com/r0xdeadbeef/CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #19

**æ¥æº**: [CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md](../2021/CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆProxyLogonï¼‰

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„Exchange Server 2013, 2016, 2019 Cumulative Updates

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ OWA æ¥å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä»æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå­˜åœ¨å…¬å¼€çš„PoCï¼Œå¹¶ä¸”è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ„é€ è¯·æ±‚:** æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªåŒ…å«ç‰¹å®š Cookie çš„ GET è¯·æ±‚ï¼Œåˆ©ç”¨ SSRF æ¼æ´ã€‚
3.  **NTLM è®¤è¯:** ä½¿ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚
4.  **è·å– FQDN:** é€šè¿‡ NTLM type2 åè®®è·å–æœåŠ¡å™¨çš„ FQDN (Fully Qualified Domain Name)ã€‚
5.  **å‘é€æ¶æ„ XML:** æ„é€ æ¶æ„çš„ XML æ•°æ®ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° Exchange Web Services (EWS) ç«¯ç‚¹ï¼Œåˆ©ç”¨åç«¯ç»„ä»¶å¤„ç† XML æ—¶å­˜åœ¨çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚  
6.  **ç”¨æˆ·æšä¸¾:**  PoC ä»£ç è¿˜åŒ…å«ç”¨æˆ·æšä¸¾çš„åŠŸèƒ½ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Go ä»£ç æ˜¯ä¸€ä¸ªå¯ç”¨çš„ PoCã€‚å®ƒåŒ…å«äº†æ¼æ´éªŒè¯ã€NTLM è®¤è¯å’Œå‘é€æ¶æ„ XML æ•°æ®çš„æ­¥éª¤ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘å®Œæ•´ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶ä»£ç çœ‹èµ·æ¥ä¸»è¦å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ï¼Œä½†ä»å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ï¼š
* ç”¨æˆ·æšä¸¾æ¨¡å—å¯èƒ½è¢«æ»¥ç”¨ï¼Œç”¨äºéæ³•æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€‚
* ä»£ç ä¸­å­˜åœ¨ä¸€äº›ç¡¬ç¼–ç çš„å‚æ•°å’Œè·¯å¾„ï¼Œå¯èƒ½åœ¨ç‰¹å®šç¯å¢ƒä¸‹ä¸å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨è€…ä¿®æ”¹ï¼Œå¯èƒ½å­˜åœ¨è¢«è¯±å¯¼ä¿®æ”¹æ¶æ„ä»£ç ã€‚
* é£é™©è¯„ä¼°ä¸º 10%ï¼Œå› ä¸ºä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨ï¼Œè€Œéæ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯å­˜åœ¨è¢«æ»¥ç”¨å’Œä¿®æ”¹çš„æ½œåœ¨é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [shacojx/CVE-2021-26855-exploit-Exchange](https://github.com/shacojx/CVE-2021-26855-exploit-Exchange)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #20

**æ¥æº**: [CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md](../2021/CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®Exchange Serverçš„ç«¯å£ï¼Œé€šå¸¸æ˜¯443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ Exchange æœåŠ¡å™¨çš„èº«ä»½è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç åˆ¤æ–­ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚å¤§é‡çš„ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå¹¶ä¸”CISAå·²çŸ¥å¯åˆ©ç”¨æ¼æ´ç›®å½•ä¸­åŒ…å«äº†æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æ£€è§†æä¾›çš„ä»£ç ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š
1.  `README.md`: åŒ…å«æ¼æ´æè¿°å’Œå›¾ç‰‡ã€‚
2.  `build.xml`: Antæ„å»ºè„šæœ¬ï¼Œç”¨äºç¼–è¯‘Javaé¡¹ç›®ã€‚
3.  `ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºå­˜å‚¨æ˜“å—æ”»å‡»çš„IPåœ°å€åˆ—è¡¨ã€‚
4.  `list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æã€‚
5.  `manifest.mf`: JARæ–‡ä»¶çš„æ¸…å•æ–‡ä»¶ã€‚
6.  `Tool-Build/Run.bat`: ç”¨äºè¿è¡Œç¼–è¯‘åçš„JARæ–‡ä»¶çš„æ‰¹å¤„ç†è„šæœ¬ã€‚
7.  `Tool-Build/ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œä¸ä¸Šé¢çš„`ipVuln.txt`ç›¸åŒã€‚
8.  `Tool-Build/list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æï¼Œä¸ä¸Šé¢çš„`list-ip.txt`ç›¸åŒã€‚
9.  `Tool-Build/Nmap/scripts/http-vuln-cve2021-26855.nse`: Nmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å—CVE-2021-26855æ¼æ´å½±å“ã€‚è¿™ä¸ªè„šæœ¬æ˜¯æ¼æ´æ£€æµ‹çš„æ ¸å¿ƒã€‚

ä¸»è¦é£é™©ç‚¹åœ¨äº`build.xml`æ„å»ºè„šæœ¬å’Œ`http-vuln-cve2021-26855.nse`è¿™ä¸ªNmapè„šæœ¬ã€‚æ„å»ºè„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä»¥åŒ…å«æ¶æ„ä»£ç ï¼Œè™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤éšè”½çš„åé—¨ä»£ç å­˜åœ¨çš„å¯èƒ½æ€§ã€‚Nmapè„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´æ£€æµ‹è„šæœ¬ï¼Œä½†ç†è®ºä¸Šï¼Œå¦‚æœè„šæœ¬è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´æ—¶ï¼Œæ¤å…¥åé—¨æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚
æ€»ä½“è¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ï¼Œå› ä¸ºä¸»è¦çš„ä»£ç åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œè€Œä¸æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä¸”ä»£ç é‡ä¸å¤§ï¼Œå®¹æ˜“å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  **SSRF:** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´å‘ExchangeæœåŠ¡å™¨å‘é€ç²¾å¿ƒæ„é€ çš„HTTPè¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹ŸExchangeæœåŠ¡å™¨ä¸Šçš„å…¶ä»–ç”¨æˆ·ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** åœ¨æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ä¸å®‰å…¨çš„deserializationï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼ŒCVE-2021-26855æ˜¯ProxyLogonæ”»å‡»é“¾çš„åˆå§‹æ¼æ´ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´çš„æœ‰æ•ˆæ€§é«˜ï¼Œåˆ©ç”¨æ–¹å¼è¾ƒä¸ºæ˜ç¡®ï¼Œä½†æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ‰«æè€Œéç›´æ¥åˆ©ç”¨ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡SSRFæ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [shacojx/Scan-Vuln-CVE-2021-26855](https://github.com/shacojx/Scan-Vuln-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #21

**æ¥æº**: [CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md](../2021/CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md)

## CVE-2021-26855 & CVE-2021-27065 - Microsoft Exchange Server RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ (é€šå¸¸æ˜¯443)ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´åˆ©ç”¨é“¾åŒ…æ‹¬ CVE-2021-26855 (SSRF) å’Œ CVE-2021-27065 (ä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´RCE)ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä»»æ„HTTPè¯·æ±‚å¹¶ä¼ªè£…æˆExchangeæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚POCä»£ç é¦–å…ˆå‘é€ä¸€ä¸ªNTLMåå•†è¯·æ±‚åˆ°`/rpc/`ç«¯ç‚¹ï¼Œåˆ©ç”¨è¿”å›çš„`WWW-Authenticate`å¤´ä¸­çš„ä¿¡æ¯æ¥è·å–ç›®æ ‡ExchangeæœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **RCE (CVE-2021-27065):** åˆ©ç”¨è·å–çš„è®¡ç®—æœºåï¼Œç»“åˆä¸€ä¸ªå·²çŸ¥çš„é‚®ç®±åœ°å€æ ¼å¼ï¼Œæ„é€ ä¸€ä¸ªåŒ…å«`LegacyDN`çš„è¯·æ±‚ï¼Œå‘é€åˆ°`/ecp/baba.js`ï¼Œæœ€ç»ˆé€šè¿‡å†™å…¥webshellæ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ`baba.js`æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œä¸Šä¼ ä»»æ„çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯å…¬å¼€çš„ï¼Œå½±å“èŒƒå›´å¹¿æ³›ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

*   **Webshell å†…å®¹ï¼š** Webshellçš„å†…å®¹ï¼ˆ`<script language="JScript" runat="server">function Page_Load(){eval(Request["babanb"],"unsafe");}</script>`ï¼‰æ˜¯å›ºå®šçš„ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹è¿™ä¸ªå†…å®¹ï¼Œæ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…æ¤å…¥æ›´åŠ éšè”½çš„åé—¨ã€‚ç›®å‰æ˜¯ç›´æ¥åœ¨ecpç›®å½•ä¸‹å†™äº†baba.jsçš„æ–‡ä»¶,æ¯”è¾ƒå®¹æ˜“è¢«å‘ç°ã€‚
*   **ä¾èµ–é¡¹é£é™©ï¼š**è™½ç„¶ä»£ç é‡å°‘ï¼Œä½†ä»ç„¶å¯èƒ½å¼•å…¥æœ‰å®‰å…¨é£é™©çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè™½ç„¶è¿™é‡Œæ²¡æœ‰ä½“ç°ã€‚
*  **é‚®ä»¶ç”¨æˆ·åˆ—è¡¨:** ä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·åˆ—è¡¨è¿›è¡Œå°è¯•ã€‚è¿™ä¸ªåˆ—è¡¨å¯èƒ½è¢«ä¿®æ”¹ï¼Œç”¨äºé’ˆå¯¹ç‰¹å®šç›®æ ‡è¿›è¡Œæ”»å‡»ï¼Œæˆ–è€…ç”¨äºæœé›†æ•æ„Ÿä¿¡æ¯ã€‚

è™½ç„¶å­˜åœ¨é£é™©ï¼Œä½†æ•´ä½“ä»£ç é€»è¾‘è¾ƒä¸ºæ¸…æ™°ï¼Œé£é™©è¾ƒä½ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [ssrsec/Microsoft-Exchange-RCE](https://github.com/ssrsec/Microsoft-Exchange-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #22

**æ¥æº**: [CVE-2021-26855-thau0x01_poc_proxylogon.md](../2021/CVE-2021-26855-thau0x01_poc_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Exchange Serverå¼€æ”¾443ç«¯å£ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 (ProxyLogon) æ˜¯ä¸€ç§å­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œèƒ½å¤Ÿä¼ªé€ èº«ä»½å¹¶æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œè¯¥æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ã€‚æä¾›çš„PoCä»£ç å±•ç¤ºäº†åˆ©ç”¨è¯¥æ¼æ´è·å–è¿œç¨‹ä»£ç æ‰§è¡Œæƒé™çš„è¿‡ç¨‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** é¦–å…ˆï¼Œåˆ©ç”¨SSRFæ¼æ´å‘é€ä»»æ„HTTPè¯·æ±‚ï¼Œç›®çš„æ˜¯ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–æœ‰æ•ˆçš„LegacyDNã€‚
2.  **è·å– LegacyDN:** é€šè¿‡æ„é€ Autodiscoverè¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„LegacyDNå»ºç«‹ä¸€ä¸ªMAPIä¼šè¯ã€‚
4.  **è·å– SID:** ä»MAPIå“åº”ä¸­æå–ç”¨æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦ (SID)ã€‚
5.  **ProxyLogon:** åˆ©ç”¨ProxyLogonæœºåˆ¶ï¼Œå°†ç”¨æˆ·SIDä¿®æ”¹ä¸ºç®¡ç†å‘˜SIDï¼Œä»è€Œæå‡æƒé™ã€‚
6.  **å†™å…¥ Webshell:** åˆ©ç”¨æå‡çš„æƒé™ï¼Œå‘æœåŠ¡å™¨å†™å…¥webshellï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸­å­˜åœ¨ä»¥ä¸‹æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

*   **ç¡¬ç¼–ç çš„è·¯å¾„å’Œæ–‡ä»¶åï¼š** `shell_path`å’Œ`shell_absolute_path`ä»¥åŠ`ahihi7.aspx`æ˜¯ç¡¬ç¼–ç çš„ï¼Œè¿™ä½¿å¾—webshellå®¹æ˜“è¢«æ£€æµ‹å’Œç§»é™¤ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è¿™äº›å€¼ï¼Œå¯èƒ½ä¼šå°†webshellå†™å…¥åˆ°æ›´éšè”½çš„ä½ç½®ã€‚
*   **webshell å†…å®¹ï¼š** `shell_content`åŒ…å«æ‰§è¡Œ `whoami` å‘½ä»¤çš„JavaScriptä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•å‘½ä»¤ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹`shell_content`ä»¥æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚è™½ç„¶å½“å‰ä»£ç åªæ˜¯æ‰§è¡Œ`whoami`ï¼Œä½†ä¸èƒ½æ’é™¤æ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥`shell_content`çš„å¯èƒ½æ€§ã€‚è¿™ä¸€éƒ¨åˆ†å­˜åœ¨è¢«æ¶æ„ä¿®æ”¹è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§ã€‚
*   **ä»£ç†URI (`msExchProxyUri`)**: PoCä»£ç ä¸­ `msExchProxyUri` è®¾ç½®ä¸º`http://127.0.0.1:8080/`ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯èƒ½å°è¯•é€šè¿‡æœ¬åœ°ä»£ç†è¿›è¡Œå…¶ä»–æ”»å‡»ï¼Œæˆ–è€…å°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ã€‚è™½ç„¶ç°åœ¨æŒ‡å‘æœ¬åœ°ï¼Œä½†å­˜åœ¨è¢«ä¿®æ”¹æŒ‡å‘æ¶æ„åœ°å€çš„å¯èƒ½æ€§ã€‚

è™½ç„¶è¿™äº›é£é™©å­˜åœ¨ï¼Œä½†æ•´ä½“ä»£ç çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†RCEï¼Œæ²¡æœ‰æ˜æ˜¾çš„éšè—åé—¨æˆ–è€…å…¶ä»–æ¶æ„è¡Œä¸ºã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½, çº¦5%ã€‚

**é¡¹ç›®åœ°å€:** [thau0x01/poc_proxylogon](https://github.com/thau0x01/poc_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #23

**æ¥æº**: [CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md](../2021/CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md)

## CVE-2021-26855-Microsoft Exchange Server-SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶æ¨¡æ‹Ÿ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚æä¾›çš„POCä»£ç å°è¯•é€šè¿‡ `POST /ecp/poc-2021-26855.js HTTP/1.1` å‘é€ SOAP è¯·æ±‚ï¼Œé€šè¿‡ä¿®æ”¹ `X-BEResource` cookie ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè¿›è€Œæ‰§è¡Œå…¶ä»–æ“ä½œã€‚ç”±äºè¯·æ±‚çš„ç›®æ ‡æ˜¯ EWS (Exchange Web Services)ï¼Œè¿™å…è®¸æ”»å‡»è€…è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ã€‚åˆ†æä»£ç ä¸­,æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF æ”»å‡»ï¼š** åˆ©ç”¨ CVE-2021-26855ï¼Œæ”»å‡»è€…å¯ä»¥å‘ Exchange æœåŠ¡å™¨å‘é€ä¼ªé€ çš„ HTTP è¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡æ“çºµ `X-BEResource` cookieï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå†’å……åˆæ³•ç”¨æˆ·ã€‚
3.  **é‚®ç®±è®¿é—®ï¼š** ä¸€æ—¦æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ EWS æ¥å£è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ï¼Œä¾‹å¦‚è¯»å–é‚®ä»¶ã€è”ç³»äººç­‰ã€‚
4.  **é“¾å¼åˆ©ç”¨ï¼š** CVE-2021-26855 é€šå¸¸ä¸å…¶ä»– Exchange æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858ã€CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå½¢æˆ ProxyLogon æ”»å‡»é“¾ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt](https://github.com/timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #24

**æ¥æº**: [CVE-2021-26855-yaoxiaoangry3_Flangvik.md](../2021/CVE-2021-26855-yaoxiaoangry3_Flangvik.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œå…·ä½“ç‰ˆæœ¬å‚è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Microsoft Exchange Serverï¼ŒCVSS è¯„åˆ†ä¸º 9.1ï¼Œè¡¨æ˜å…¶ä¸¥é‡æ€§ã€‚
æœç´¢ç»“æœæ˜¾ç¤ºï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„ PoC å¯ç”¨ï¼Œå‚è€ƒç½‘é¡µæ ‡é¢˜åŒ…å«"ProxyLogon"çš„ç½‘é¡µä¿¡æ¯å¯ä»¥çŸ¥é“ã€‚
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª C# PoCï¼Œæ”¯æŒåŠäº¤äº’å¼çš„ web shell ä»¥åŠ shellcode æ‰§è¡Œã€‚
ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/e24bb8b01b99c84300e1ac6fb58f9709/README.md` åªæ˜¾ç¤ºäº†å…³äº PoC çš„ç®€çŸ­æè¿°ï¼Œæ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ç”±äºæ˜¯ C# PoCï¼ŒæŠ•æ¯’ä»£ç å¯èƒ½éšè—åœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä»…ä»…é€šè¿‡ README.md æ–‡ä»¶åˆ¤æ–­ï¼Œå­˜åœ¨è¯¯åˆ¤å¯èƒ½æ€§ï¼Œä½†æ˜¯æ ¹æ®ä»¥å¾€ç»éªŒï¼Œå¼€æºç¤¾åŒºå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’è¡Œä¸ºï¼Œå› æ­¤ç»™å‡ºä¸€å®šç™¾åˆ†æ¯”ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 çš„ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨åç»­æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰å†™å…¥ä»»æ„æ–‡ä»¶ã€‚
3.  å†™å…¥çš„æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ª ASPX web shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
4.  æˆ–è€…ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ shellcode ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„åˆå§‹å…¥å£ç‚¹ï¼Œä¸ºåç»­æ”»å‡»é“ºå¹³é“è·¯ã€‚

**é¡¹ç›®åœ°å€:** [yaoxiaoangry3/Flangvik](https://github.com/yaoxiaoangry3/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---



---

## POC #7

**æ¥æº**: [CVE-2021-26855-ShyTangerine_cve-2021-26855.md](../2021/CVE-2021-26855-ShyTangerine_cve-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œè¯¦è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ ECP æ¥å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1.  **åˆå§‹è¯·æ±‚ï¼š** å‘ `/ecp/x.png` å‘é€ GET è¯·æ±‚ï¼Œå°è¯•è·å– `X-BEResource` Cookieã€‚
2.  **è·å– DN å€¼ï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç”¨æˆ·çš„ DN (Distinguished Name)ã€‚
3.  **Mapi/Emsmdb è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ DN å€¼ï¼Œå‘ `/ecp/x.png` å‘é€åŒ…å« `X-BEResource`ã€`X-Clientinfo` ç­‰å¤´çš„ POST è¯·æ±‚ï¼Œå°è¯•å»ºç«‹ MAPI over HTTP è¿æ¥ã€‚
4.  **è·å– Session å’Œ msExchEcpCanaryï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Negotiate åè®®è·å– ASP.NET Session ID å’Œ `msExchEcpCanary` å€¼ã€‚`msExchEcpCanary` æ˜¯ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œï¼Œç”¨äºé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) æ”»å‡»ã€‚
5.  **è·å– OAB IDï¼š** å‘é€åŒ…å«`msExchEcpCanary` å’Œ Session ID åˆ°`/ecp/x.png`ï¼Œè·å–OAB idï¼Œä¸ºä¸‹ä¸€æ­¥å†™å…¥æ¶æ„ä»£ç ä½œå‡†å¤‡

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´ç¡®å®å­˜åœ¨ä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚è¯¥ POC ä»£ç å±•ç¤ºäº†æ¼æ´åˆ©ç”¨çš„å…³é”®æ­¥éª¤ï¼Œä¾‹å¦‚å¦‚ä½•ç»•è¿‡èº«ä»½éªŒè¯ã€å¦‚ä½•è·å–å¿…è¦çš„å‡­æ®ä¿¡æ¯ç­‰ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯„ä¼°æä¾›çš„ POC ä»£ç ï¼Œå­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œ10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äºï¼š

*   **ç¡¬ç¼–ç çš„ IP åœ°å€å’ŒåŸŸåï¼š** POC ä»£ç ä¸­åŒ…å«ç¡¬ç¼–ç çš„ IP åœ°å€ (ä¾‹å¦‚ `10.255.200.20`, `192.168.170.134`) å’ŒåŸŸå (`EXCHANGE01.xihongdream.com`)ã€‚å¦‚æœç”¨æˆ·ç›´æ¥ä½¿ç”¨è¿™äº›ç¡¬ç¼–ç çš„å€¼ï¼Œå¯èƒ½ä¼šå°†æ”»å‡»æµé‡å¯¼å‘ä½œè€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œæš´éœ²ç›®æ ‡æœåŠ¡å™¨çš„ä¿¡æ¯æˆ–è¢«ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

*   **æ½œåœ¨çš„åé—¨æ¤å…¥ï¼š** è™½ç„¶ POC ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´åˆ©ç”¨è¿‡ç¨‹ï¼Œä½†ä½œè€…æœ‰å¯èƒ½åœ¨ä»£ç ä¸­æ’å…¥åé—¨ï¼Œä¾‹å¦‚ï¼Œåœ¨OABæ“ä½œä¸­ï¼Œå†™å…¥æ¶æ„è„šæœ¬åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œé•¿æœŸæ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚

æ€»çš„æ¥è¯´ï¼Œè¯¥ POC ä»£ç ä¸»è¦æ¼”ç¤ºäº† SSRF çš„åˆ©ç”¨æ–¹å¼ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶åº”è°¨æ…ï¼ŒåŠ¡å¿…ä¿®æ”¹ä»£ç ä¸­çš„ç¡¬ç¼–ç å€¼ï¼Œé¿å…æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [ShyTangerine/cve-2021-26855](https://github.com/ShyTangerine/cve-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #8

**æ¥æº**: [CVE-2021-26855-TheDudeD6_ExchangeSmash.md](../2021/CVE-2021-26855-TheDudeD6_ExchangeSmash.md)

## CVE-2021-26855-Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯è®¿é—®ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å†’å……ç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–åˆæ³•çš„èº«ä»½ã€‚
2.  **è·å–SIDï¼š** ä½¿ç”¨åˆæ³•çš„èº«ä»½ï¼Œè·å–ç”¨æˆ·çš„SID
3.  **ä¼ªé€ ç®¡ç†å‘˜ SIDï¼š** é€šè¿‡ç¯¡æ”¹å·²æ³„éœ²çš„ç”¨æˆ·SIDï¼Œä¼ªé€ ç®¡ç†å‘˜SID
4.  **ProxyLogonï¼š** ä½¿ç”¨ä¼ªé€ çš„ç®¡ç†å‘˜ SID é€šè¿‡ ProxyLogon æ”»å‡»é“¾ï¼Œè·å¾—ç®¡ç†å‘˜æƒé™ã€‚
5.  **å†™å…¥webshellï¼š** åˆ©ç”¨ç®¡ç†å‘˜æƒé™ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥ webshellã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** é€šè¿‡è®¿é—® webshell æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹æä¾›çš„POCä»£ç ï¼Œå‘ç°å…¶åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸åº”å­˜åœ¨æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºä»£ç é€»è¾‘å¤æ‚ï¼Œä¸”ä¾èµ–å¤–éƒ¨åº“ï¼ˆImpacketï¼‰ï¼Œå­˜åœ¨ä½œè€…åœ¨ä»£ç ä¸­æ¤å…¥æ¶æ„é€»è¾‘çš„å¯èƒ½æ€§ã€‚å¦å¤–ï¼Œé€šè¿‡åˆ†æå‘ç°proxylogon.pyä¸­çš„shell_srcå˜é‡å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè¢«æ›¿æ¢æˆæ¶æ„payloadï¼Œåˆ™å­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦é£é™©åœ¨äºä»£ç çš„å¯ä¿¡åº¦ä»¥åŠshell_srcå˜é‡çš„æ›¿æ¢ã€‚

**é¡¹ç›®åœ°å€:** [TheDudeD6/ExchangeSmash](https://github.com/TheDudeD6/ExchangeSmash)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #9

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF to RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (Server-Side Request Forgery) -> RCE (Remote Code Execution)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯ä»¥ä»æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 å­˜åœ¨äº Microsoft Exchange Server ä¸­ï¼Œæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ©ç”¨æ­¤æ¼æ´ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼š** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ SSRF æ¼æ´ï¼Œå‘ Exchange æœåŠ¡å™¨çš„ autodiscover ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å¾—çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **è·å– SIDï¼š** ä» MAPI å“åº”ä¸­æå–ç”¨æˆ·çš„ SIDã€‚
5.  **ProxyLogonï¼š** åˆ©ç”¨ SID ä¼ªé€ èº«ä»½ï¼Œé€šè¿‡ proxyLogon.ecp ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ã€‚
6.  **å†™å…¥ Webshellï¼š** æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„çš„ webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸­ã€‚
7.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„ webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ExchangeSheller.py` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æµç¨‹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åˆ©ç”¨ CVE-2021-26855 æ¼æ´ï¼Œå› æ­¤æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç æœ¬èº«æ‰§è¡Œçš„æ˜¯æ¼æ´åˆ©ç”¨æµç¨‹ï¼Œä¸»è¦åŠŸèƒ½ä¸ºåˆ©ç”¨ SSRF æ¼æ´å¹¶æœ€ç»ˆå†™å…¥ Webshellã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä»£ç æ¥æºï¼š** ä»£ç æ¥è‡ª GitHubï¼Œéœ€è¦éªŒè¯å…¶ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®Œæ•´æ€§ã€‚
*   **Webshell å†…å®¹ï¼š** Webshell çš„å†…å®¹å¯æ§ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ webshell çš„å†…å®¹ï¼Œä½¿å…¶æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ¤å…¥åé—¨ã€çªƒå–æ•°æ®ç­‰ã€‚
*   **éšè—æŒ‡ä»¤ï¼š** ç†è®ºä¸Šï¼Œeval å‡½æ•°ä¸­å¯ä»¥åµŒå…¥éšè”½çš„æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦ä»”ç»†åˆ†æ `ExchangeSheller.py` æ–‡ä»¶ï¼Œå½“å‰åˆ¤æ–­è¯¥é£é™©è¾ƒä½ã€‚

**ç»“è®ºï¼š**

è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹webshellçš„å†…å®¹ï¼Œä½†æ€»ä½“æ¥è¯´ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¸…æ™°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%ã€‚åŠ¡å¿…åœ¨éš”ç¦»ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å¯¹ç”Ÿæˆçš„ webshell è¿›è¡Œå®‰å…¨å®¡è®¡ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855](https://github.com/ZephrFish/Exch-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #10

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨å—å½±å“çš„ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰æ¥å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹æ®Šçš„ URL å’Œè¯·æ±‚å¤´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„è®¿é—®æƒé™ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **ProxyLogon:** é€šè¿‡æ„é€  ProxyLogon è¯·æ±‚ï¼Œä¼ªè£…æˆç®¡ç†å‘˜èº«ä»½ã€‚
5.  **å†™å…¥ Webshell (CVE-2021-27065ï¼Œè™½ç„¶POCæœªç›´æ¥ä½“ç°ï¼Œä½†é€šå¸¸ä¼šç»“åˆä½¿ç”¨):** åœ¨æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åï¼Œåˆ©ç”¨æ¼æ´åœ¨ Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸‹å†™å…¥æ¶æ„çš„ Webshell æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç çš„ JScript ä»£ç ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå†ç°äº† ProxyLogon æ”»å‡»é“¾çš„å…³é”®æ­¥éª¤ï¼ŒåŒ…æ‹¬ SSRFã€æƒé™æå‡å’Œ webshell å†™å…¥ (webshell å†…å®¹åœ¨ä»£ç ä¸­å·²ç»å­˜åœ¨)ã€‚æœç´¢å¼•æ“ç»“æœä¸­ä¹Ÿè¡¨æ˜ CVE-2021-26855 è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†ææä¾›çš„ POC ä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨åˆ©ç”¨ SSRF æ¼æ´è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ï¼Œå¹¶æœ€ç»ˆéƒ¨ç½² webshellã€‚è™½ç„¶ webshell æœ¬èº«æ˜¯ä¸€ç§æ¶æ„ä»£ç ï¼Œä½†è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤ï¼Œè€Œéä½œè€…æœ‰æ„æ·»åŠ çš„æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855_Priv](https://github.com/ZephrFish/Exch-CVE-2021-26855_Priv)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #11

**æ¥æº**: [CVE-2021-26855-dwisiswant0_proxylogscan.md](../2021/CVE-2021-26855-dwisiswant0_proxylogscan.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„ Exchange Server çš„ç½‘ç»œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……ç®¡ç†å‘˜èº«ä»½ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œä¸ CVE-2021-27065 (èº«ä»½éªŒè¯åä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´) ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange Serverï¼Œç»•è¿‡èº«ä»½éªŒè¯å¹¶è·å¾—ç®¡ç†å‘˜æƒé™ã€‚
2.  åˆ©ç”¨è·å¾—çš„ç®¡ç†å‘˜æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ CVE-2021-27065 å°†æ¶æ„ä»£ç å†™å…¥æœåŠ¡å™¨ã€‚
3.  æ‰§è¡Œå†™å…¥çš„æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æï¼š**

æä¾›çš„ POC ä»£ç  `proxylogscan` æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¼–å†™çš„å·¥å…·ï¼Œç”¨äºå¤§è§„æ¨¡æ‰«æå­˜åœ¨ CVE-2021-26855 æ¼æ´çš„ Microsoft Exchange Serverã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯æ‰«ææ¼æ´ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚ è€ƒè™‘åˆ°å·¥å…·çš„ç”¨é€”å’Œä»£ç çš„ç®€æ´æ€§ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯éœ€è¦å¯¹ä»£ç è¿›è¡Œä»”ç»†çš„å®¡æŸ¥ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠç½‘ç»œè¯·æ±‚çš„éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚ æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ä»£ç ä½¿ç”¨go getå®‰è£…ï¼Œå­˜åœ¨ä¸€å®šçš„ä¾èµ–é£é™©,éœ€è¦æ³¨æ„.


**é¡¹ç›®åœ°å€:** [dwisiswant0/proxylogscan](https://github.com/dwisiswant0/proxylogscan)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #12

**æ¥æº**: [CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md](../2021/CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 22 å’Œ 23, Exchange Server 2016 Cumulative Update 12-19, Exchange Server 2019 Cumulative Update 1-8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æœªä¿®è¡¥çš„ Exchange Server å®ä¾‹ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange æœåŠ¡å™¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸ºåç»­åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰åˆ›é€ æ¡ä»¶ã€‚æ¼æ´åˆ©ç”¨é“¾é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–:** é€šè¿‡ SSRF æ¼æ´è·å–çš„æƒé™ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26854, CVE-2021-26857, CVE-2021-27065ï¼‰æ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„ PoC ä»£ç æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ ProxyLogon æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œå®ƒåˆ©ç”¨ CVE-2021-26855 ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªåé—¨ Web shellã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1.  **è‡ªåŠ¨å‘ç° (Autodiscover):** ä½¿ç”¨ Autodiscover åè®®è·å– LegacyDNã€‚
2.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ï¼Œæ¨¡æ‹Ÿç®¡ç†å‘˜æƒé™ã€‚
3.  **Web Shell å†™å…¥:**  å°†åŒ…å«åå‘ shell ä»£ç çš„ aspx Web shell å†™å…¥åˆ°æœåŠ¡å™¨çš„ `Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\test11.aspx` è·¯å¾„ã€‚
4.  **æ‰§è¡Œ Web Shell:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥ Web shell æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥ Web shell æ‰§è¡Œ Powershell å‘½ä»¤ï¼Œå»ºç«‹ä¸€ä¸ªåå‘ TCP è¿æ¥åˆ°æ”»å‡»è€…çš„æŒ‡å®š IP åœ°å€å’Œç«¯å£ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** è¯¥ PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº† ProxyLogon æ¼æ´åˆ©ç”¨ï¼Œå¹¶æˆåŠŸåˆ›å»ºåå‘ shellï¼Œè¯æ˜äº†è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š** å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ä½œè€…åœ¨åŸå§‹PoCåŸºç¡€ä¸Šä¿®æ”¹äº†ä»£ç ï¼Œå¢åŠ äº†åˆ›å»ºç”¨æˆ·å’Œåå‘shellçš„åŠŸèƒ½ï¼Œè¯¥è¡Œä¸ºå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†åå‘shellä¸­çš„IPåœ°å€å’Œç«¯å£ï¼Œåˆ™ä½¿ç”¨è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ é£é™©å¤§çº¦åœ¨10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2021-26855 æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ï¼Œç„¶åé€šè¿‡å†™å…¥ Web shell æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™ä¸ª Web shell ä¼šè¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œå…è®¸æ”»å‡»è€…å®Œå…¨æ§åˆ¶å—æ„ŸæŸ“çš„ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [glen-pearson/ProxyLogon-CVE-2021-26855](https://github.com/glen-pearson/ProxyLogon-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #13

**æ¥æº**: [CVE-2021-26855-hakivvi_proxylogon.md](../2021/CVE-2021-26855-hakivvi_proxylogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„ExchangeæœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 21/22/23, Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„ç½‘ç»œï¼Œå¹¶ä¸”æœåŠ¡å™¨å­˜åœ¨æ¼æ´

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚CVE-2021-27065ï¼‰ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ç®¡ç†å‘˜èº«ä»½é€šè¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ä¼ªé€  HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **ç®¡ç†å‘˜æƒé™è·å–:** åˆ©ç”¨ä¼ªé€ çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜æƒé™ã€‚
3.  **OABè™šæ‹Ÿç›®å½•æ“ä½œ:** ä¿®æ”¹OAB (Offline Address Book)è™šæ‹Ÿç›®å½•çš„ExternalUrlå‚æ•°ï¼Œå°†shellåœ°å€å†™å…¥ã€‚
4.  **Shell å†™å…¥:** é€šè¿‡ä¿®æ”¹çš„ExternalUrlï¼Œæ”»å‡»è€…å°†ä¸€ä¸ª ASPX webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ web å¯è®¿é—®ç›®å½•ï¼ˆé€šå¸¸æ˜¯`C:\inetpub\wwwroot\aspnet_client\`ï¼‰ã€‚ 
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—® webshell çš„ URL å¹¶å‘é€ç‰¹å®šçš„è¯·æ±‚å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**ä»£ç åˆ†æä¸æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç  `proxylogon.py` å®ç°äº†ä¸Šè¿°çš„æ”»å‡»æµç¨‹ã€‚ä»£ç é¦–å…ˆåˆ©ç”¨ SSRF è·å–æœåŠ¡å™¨çš„è®¡ç®—æœºåï¼Œç„¶ååˆ©ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚ä¹‹åï¼Œå®ƒåˆ©ç”¨è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œé€šè¿‡ä¿®æ”¹ OAB è™šæ‹Ÿç›®å½•æ¥å†™å…¥ webshellã€‚æœ€åï¼Œä»£ç è¾“å‡º webshell çš„ URLï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥ URL æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**  POCä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **åé—¨æ¤å…¥:** è™½ç„¶ä¸»è¦çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡ŒRCEï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¼šåœ¨è„šæœ¬ä¸­æ·»åŠ é¢å¤–çš„åé—¨ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨å†™å…¥çš„ webshell ä¸­æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å°†æ¥ä¿æŒå¯¹æœåŠ¡å™¨çš„è®¿é—®ã€‚
*   **ä¿¡æ¯æ”¶é›†:**  æ”»å‡»è€…å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥æ”¶é›†ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·åã€å¯†ç å“ˆå¸Œã€ä»¥åŠå…¶ä»–é…ç½®ä¿¡æ¯ã€‚
*   **æ¶æ„ä¼ æ’­:**  å¦‚æœæ”»å‡»è€…æ§åˆ¶äº†å¤šä¸ª Exchange æœåŠ¡å™¨ï¼Œä»–ä»¬å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥è‡ªåŠ¨ä¼ æ’­æ¶æ„è½¯ä»¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚
*   **ä¾èµ–åº“é£é™©ï¼š**POCä¾èµ–Impacketåº“ï¼Œå¦‚æœImpacketåº“æœ¬èº«è¢«ç¯¡æ”¹æˆ–åŒ…å«æ¶æ„ä»£ç ï¼Œé‚£ä¹ˆä½¿ç”¨æ­¤POCä¹Ÿä¼šå—åˆ°å½±å“ã€‚

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†å°±æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«è€Œè¨€ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚é£é™©ä¸»è¦åœ¨äºè¯¥æ¼æ´æœ¬èº«å¸¦æ¥çš„æƒé™å’Œæ½œåœ¨çš„æ¶æ„ä¿®æ”¹è¡Œä¸ºã€‚POCä¸­ç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„éƒ¨åˆ†(gen())æ˜¯ä¸ºäº†é¿å…æ–‡ä»¶åå†²çªï¼Œæœ¬èº«ä¸æ˜¯æ¶æ„è¡Œä¸ºã€‚åˆ©ç”¨OABVirtualDirectoryä¿®æ”¹ExternalUrlä»¥åŠResetOABVirtualDirectoryä¿®æ”¹FilePathNameçš„è¡Œä¸ºæ˜¯ä¸ºäº†webshellçš„å†™å…¥ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

**æ€»ç»“:** è¯¥æ¼æ´åˆ©ç”¨é“¾çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸º CVE-2021-26855 æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚ æŠ•æ¯’é£é™©ä¸»è¦æ¥è‡ªäºåˆ©ç”¨æ­¤æ¼æ´æˆåŠŸå…¥ä¾µåçš„æ¶æ„è¡Œä¸ºï¼Œè€ŒéPOCä»£ç æœ¬èº«ã€‚ç”±äºä»£ç ä¸­åŒ…å«webshellçš„éƒ¨ç½²ï¼Œå­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†ç›´æ¥åˆ¤å®šä¸ºæŠ•æ¯’ä¸ä¸¥è°¨ï¼Œç»“åˆåˆ†æç»“æœï¼ŒæŠ•æ¯’é£é™©é¢„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [hakivvi/proxylogon](https://github.com/hakivvi/proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #14

**æ¥æº**: [CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md](../2021/CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) -> è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®‰è£…ç›¸å…³è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRF æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶ç»“åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚
2.  é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ã€‚
3.  ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œååºåˆ—åŒ–æ¼æ´ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ªç®€å•çš„ PHP æ–‡ä»¶ï¼ˆhello worldï¼‰ï¼Œä¸€ä¸ª README æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„ Node.js æœåŠ¡å™¨ (demo.js) å’Œä¸€ä¸ª package.json æ–‡ä»¶ã€‚è¿™äº›ä»£ç ç‰‡æ®µæœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨ CVE-2021-26855ã€‚å®ƒä»¬æ›´åƒæ˜¯ç”¨äºæ­å»ºä¸€ä¸ªåŸºç¡€çš„webæœåŠ¡å™¨ç¯å¢ƒï¼Œå¯èƒ½ç”¨äºéªŒè¯æ¼æ´åˆ©ç”¨çš„æŸäº›æ­¥éª¤æˆ–ä½œä¸ºæœ€ç»ˆæ‰§è¡Œçš„payloadçš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå•ç‹¬æ¥çœ‹ï¼Œæä¾›çš„POCä»£ç **æ— æ•ˆ**ï¼Œå®ƒåªæ˜¯åˆ©ç”¨æ•´ä¸ªæ¼æ´é“¾ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„ POC ä»£ç è¾ƒä¸ºç®€å•ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚`demo.js` åªæ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œ`1.php` åªæ˜¯è¾“å‡º "hello world"ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ª Exchange æ¼æ´çš„ POCï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨æ›´å¤æ‚çš„åˆ©ç”¨é“¾ä¸­åˆ©ç”¨è¿™äº›æ–‡ä»¶ï¼Œä¾‹å¦‚å°† `1.php` ä½œä¸º Webshell ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ–è€…åˆ©ç”¨ `demo.js` æ­å»ºä¸€ä¸ªç”¨äºæ¥æ”¶åå¼¹ shell çš„æœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ–¹å¼çš„ç»„åˆï¼Œè€Œéä»£ç æœ¬èº«å­˜åœ¨åé—¨ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

ç”±äºä»£ç åŠŸèƒ½ç®€å•ï¼Œç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†ä½œä¸ºæ¼æ´åˆ©ç”¨é“¾çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½è¢«ç”¨äºæ‰§è¡Œæ¶æ„æ“ä½œï¼Œå› æ­¤æŠ•æ¯’é£é™©è¯„å®šä¸º **20%**ã€‚

**é¡¹ç›®åœ°å€:** [hictf/CVE-2021-26855-CVE-2021-27065](https://github.com/hictf/CVE-2021-26855-CVE-2021-27065)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #15

**æ¥æº**: [CVE-2021-26855-hosch3n_ProxyVulns.md](../2021/CVE-2021-26855-hosch3n_ProxyVulns.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæ— éœ€èº«ä»½éªŒè¯å³å¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** Exchange Serverå¯¹å¤–å¼€æ”¾443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜ã€‚æ­¤æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ï¼Œåç»­å¯ä»¥é…åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­è®¸å¤šé“¾æ¥éƒ½è¡¨æ˜ CVE-2021-26855 å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `26855.py` å®ç°äº†åˆ©ç”¨è¯¥æ¼æ´çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š

1.  **SSRF æ¢æµ‹ï¼š** é€šè¿‡æ„é€ ç‰¹æ®Šçš„ `X-BEResource` è¯·æ±‚å¤´ï¼Œè·å– Exchange åç«¯æœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **LegacyDN è·å–ï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡ï¼Œé€šè¿‡æä¾›ç”¨æˆ·é‚®ç®±åœ°å€è·å– LegacyDNã€‚
3.  **SID æ¬ºéª—ï¼š** ä¼ªé€  MAPI è¯·æ±‚ï¼Œé€šè¿‡ LegacyDN è·å–ç”¨æˆ·çš„ SIDã€‚
4.  **ProxyLogon åˆ©ç”¨ï¼š** åˆ©ç”¨è·å–åˆ°çš„ SIDï¼Œé€šè¿‡ `proxyLogon.ecp` ç»•è¿‡èº«ä»½éªŒè¯ã€‚
5.  **Webshell éƒ¨ç½²ï¼š** å†™å…¥ Webshell åˆ°æœåŠ¡å™¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æ¼æ´åˆ©ç”¨ä»£ç ä¸­å­˜åœ¨è¾ƒä½çš„æŠ•æ¯’é£é™© (å¤§çº¦ 5%)ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†æ”»å‡»è€…å¯èƒ½åœ¨ `webshell_content` ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ `webshell_path` å°†webshellå†™å…¥åˆ°ä¸å¸¸è§çš„ä½ç½®ï¼Œä½¿å¾—åæœŸçš„æƒé™ç»´æŒæˆ–è€…æ¨ªå‘ç§»åŠ¨æ›´åŠ éšè”½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ`webshell_content`åŒ…å«ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶çš„æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯ä¸€ç§æŠ•æ¯’è¡Œä¸ºã€‚ ç›®å‰æä¾›çš„webshellä»£ç è¾ƒä¸ºç®€å•ï¼Œåˆ¤å®šæŠ•æ¯’çš„æ¦‚ç‡è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ (CVE-2021-26855) ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œæ¬ºéª— Exchange æœåŠ¡å™¨ï¼Œä½¿å…¶è®¤ä¸ºæ”»å‡»è€…å·²é€šè¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œå†™å…¥ä»»æ„æ–‡ä»¶ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéƒ¨ç½² Webshellã€‚
4.  æ”»å‡»è€…é€šè¿‡ Webshell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [hosch3n/ProxyVulns](https://github.com/hosch3n/ProxyVulns)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #16

**æ¥æº**: [CVE-2021-26855-kh4sh3i_ProxyLogon.md](../2021/CVE-2021-26855-kh4sh3i_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF/RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Exchange Server 2013ã€2016å’Œ2019çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ã€‚

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858 å’Œ CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** åˆ©ç”¨ SSRF æ¼æ´å†’å…… Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„ Exchange åç«¯èµ„æºã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ååºåˆ—åŒ–/RCEï¼š** åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä¿®æ”¹è™šæ‹Ÿç›®å½•æˆ–å†™å…¥Web shellï¼‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«ä¸€ä¸ª Creative Commons è®¸å¯è¯ï¼Œæœ¬èº«ä¸åŒ…å«ä»»ä½•åˆ©ç”¨ä»£ç æˆ–æ¶æ„ä»£ç ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä½†å®é™…åˆ©ç”¨æ—¶ï¼Œæ”»å‡»è€…éœ€è¦ç»“åˆå…¶ä»–æ¼æ´åˆ©ç”¨å·¥å…·å’Œpayloadæ‰èƒ½å®ç°æœ€ç»ˆçš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ã€‚å­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆè™½ç„¶è¿™é‡Œæ²¡æœ‰ç›´æ¥æä¾›ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜å­˜åœ¨ï¼‰ã€‚æ­¤æ¼æ´è¢« CISA åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œè¡¨æ˜è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æ€»ç»“ï¼š**
CVE-2021-26855 æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ©ç”¨ Exchange æœåŠ¡å™¨æ‰§è¡Œ SSRF æ”»å‡»ï¼Œä¸ºåç»­çš„è¿œç¨‹ä»£ç æ‰§è¡Œé“ºå¹³é“è·¯ã€‚åŠ¡å¿…å°½å¿«åº”ç”¨ Microsoft æä¾›çš„å®‰å…¨æ›´æ–°ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/ProxyLogon](https://github.com/kh4sh3i/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #17

**æ¥æº**: [CVE-2021-26855-mekhalleh_exchange_proxylogon.md](../2021/CVE-2021-26855-mekhalleh_exchange_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ Exchange Server å¿…é¡»å¯ä»ç½‘ç»œè®¿é—®,ä¸”æœªå®‰è£…ç›¸åº”çš„å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å†’å……ç®¡ç†å‘˜ã€‚è¯¥æ¼æ´æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥å¯¼è‡´ RCEï¼Œä½†å¯ä»¥ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªèº«ä»½éªŒè¯åçš„ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ç»“åˆä½¿ç”¨ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š**  æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡ Exchange Server çš„èº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š**  æˆåŠŸåˆ©ç”¨ SSRF åï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange Server çš„ç®¡ç†æƒé™ï¼Œæ— éœ€æä¾›æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥ï¼ˆCVE-2021-27065 æˆ–å…¶ä»–ï¼‰ï¼š**  è·å¾—èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…åˆ©ç”¨ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼Œå°†æ¶æ„ä»£ç å†™å…¥ Exchange Server çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡è®¿é—®å†™å…¥çš„æ¶æ„æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange Server ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Metasploit æ¨¡å— (`exchange_proxylogon.rb`) æ˜¯ä¸€ä¸ªæ‰«æå™¨ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡ Exchange Server æ˜¯å¦å­˜åœ¨ CVE-2021-26855 æ¼æ´ã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ‰«æå™¨æ£€æµ‹åˆ°æ¼æ´ï¼Œåˆ™è¡¨æ˜ç›®æ ‡æœåŠ¡å™¨å®¹æ˜“å—åˆ° ProxyLogon æ”»å‡»ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä»£ç ä¸»è¦æ˜¯ä¸€ä¸ªæ¼æ´éªŒè¯å’Œæ‰«æå·¥å…·ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©ä¼°è®¡ä¸º5%ã€‚ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯Metasploitæ¨¡å—ä¸­ä½¿ç”¨çš„HTTPè¯·æ±‚çš„æ„é€ ï¼Œä»¥åŠæ˜¯å¦ä¼šæ„å¤–åœ°å¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆç ´åã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹æ­¤æ¨¡å—ä»¥è¾¾åˆ°æ¶æ„ç›®çš„ï¼Œä½†åœ¨æä¾›çš„ä»£ç æœ¬èº«ä¸­æ²¡æœ‰å‘ç°æ­¤ç±»è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [mekhalleh/exchange_proxylogon](https://github.com/mekhalleh/exchange_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #18

**æ¥æº**: [CVE-2021-26855-praetorian-inc_proxylogon-exploit.md](../2021/CVE-2021-26855-praetorian-inc_proxylogon-exploit.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21/22/23ï¼ŒMicrosoft Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19ï¼ŒMicrosoft Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸ä¸å…¶ä»–æ¼æ´ç»„åˆåˆ©ç”¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ‰å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´ä¿¡æ¯ï¼Œè¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å®ƒä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œæœ€ç»ˆåœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å« Apache License 2.0 åè®®ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©æä½ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRF æ”»å‡»:** åˆ©ç”¨ CVE-2021-26855 å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨åç«¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡:** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜èº«ä»½è¿›è¡Œåç»­æ“ä½œã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ä»£ç æ‰§è¡Œ:** ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„ä»£ç å†™å…¥ Exchange æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆæ‰§è¡Œä»»æ„ä»£ç ã€‚

 è¯¥æ¼æ´å·²ç»è¢« CISA åŠ å…¥åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½• (KEV)ï¼Œè¡¨æ˜å…¶åœ¨é‡å¤–è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [praetorian-inc/proxylogon-exploit](https://github.com/praetorian-inc/proxylogon-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #19

**æ¥æº**: [CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md](../2021/CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„443ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œæœ€ç»ˆé€šè¿‡ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨ Autodiscover åè®®çš„ç¼ºé™·ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚ç”±äºæœåŠ¡å™¨ä¿¡ä»»æ¥è‡ªè‡ªèº«çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚ LegacyDN æ˜¯ Exchange æœåŠ¡å™¨ä¸­ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
3.  **ä¼ªé€  MAPI è¯·æ±‚ï¼š**  ä½¿ç”¨è·å–çš„ LegacyDNï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„ MAPI (Messaging Application Programming Interface) è¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€åˆ° Exchange æœåŠ¡å™¨ã€‚
4.  **å†™å…¥ Web Shell (CVE-2021-27065):** æ”»å‡»è€…åˆ©ç”¨åç«¯ç»„ä»¶çš„æ¼æ´å°†webshellå†™å…¥æœåŠ¡å™¨ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æˆåŠŸå†™å…¥webshellåï¼Œå³å¯é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶ExchangeæœåŠ¡å™¨ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªç»è¿‡å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„ PoC ä»£ç ã€‚æä¾›çš„ PoC ä»£ç å°è¯•æ¨¡æ‹Ÿ ProxyLogon æ¼æ´é“¾çš„åˆ©ç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ SSRFã€è·å– LegacyDNã€ä¼ªé€  MAPI è¯·æ±‚å’Œå†™å…¥ Web Shellã€‚æ ¹æ®PoCä»£ç å’Œæœç´¢ç»“æœçš„æè¿°ï¼Œæ­¤POCä»£ç å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œä½†æ˜¯éœ€è¦å’Œå…¶å®ƒæ¼æ´é…åˆåˆ©ç”¨ï¼Œæ‰èƒ½è¾¾æˆRCEã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

PoC ä»£ç æœ¬èº«ä¸»è¦åŠŸèƒ½æ˜¯è¿›è¡Œæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œç›´æ¥æ¤å…¥æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒä½ã€‚ ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **æ¶æ„ä»£ç æ··æ·†ï¼š** æ”»å‡»è€…å¯èƒ½å°†æ¶æ„ä»£ç éšè—åœ¨çœ‹ä¼¼æ— å®³çš„å­—ç¬¦ä¸²æˆ–å‡½æ•°ä¸­ã€‚
*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå¤–éƒ¨åº“æˆ–æ¨¡å—ï¼Œå¦‚æœè¿™äº›ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºæä¾›çš„ä»£ç ï¼Œç»è¿‡åˆ†æï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†æ˜¯ä»ç„¶ä¸èƒ½æ’é™¤ã€‚è¯¥ä»£ç å°è¯•åˆ©ç”¨æ¼æ´ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æ˜¯é€šè¿‡å†™å…¥webshellå®ç°çš„ï¼Œå¢åŠ webshellå†™å…¥ä½ç½®çš„éšæœºæ€§æœ‰å¯èƒ½è¢«ç”¨äºé€ƒé¿æ£€æµ‹ï¼Œå› æ­¤æœ‰ä¸€å®šçš„æ¦‚ç‡(10%)è¢«ç”¨äºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [r0xdeadbeef/CVE-2021-26855](https://github.com/r0xdeadbeef/CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #20

**æ¥æº**: [CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md](../2021/CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆProxyLogonï¼‰

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„Exchange Server 2013, 2016, 2019 Cumulative Updates

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ OWA æ¥å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä»æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå­˜åœ¨å…¬å¼€çš„PoCï¼Œå¹¶ä¸”è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ„é€ è¯·æ±‚:** æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªåŒ…å«ç‰¹å®š Cookie çš„ GET è¯·æ±‚ï¼Œåˆ©ç”¨ SSRF æ¼æ´ã€‚
3.  **NTLM è®¤è¯:** ä½¿ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚
4.  **è·å– FQDN:** é€šè¿‡ NTLM type2 åè®®è·å–æœåŠ¡å™¨çš„ FQDN (Fully Qualified Domain Name)ã€‚
5.  **å‘é€æ¶æ„ XML:** æ„é€ æ¶æ„çš„ XML æ•°æ®ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° Exchange Web Services (EWS) ç«¯ç‚¹ï¼Œåˆ©ç”¨åç«¯ç»„ä»¶å¤„ç† XML æ—¶å­˜åœ¨çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚  
6.  **ç”¨æˆ·æšä¸¾:**  PoC ä»£ç è¿˜åŒ…å«ç”¨æˆ·æšä¸¾çš„åŠŸèƒ½ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Go ä»£ç æ˜¯ä¸€ä¸ªå¯ç”¨çš„ PoCã€‚å®ƒåŒ…å«äº†æ¼æ´éªŒè¯ã€NTLM è®¤è¯å’Œå‘é€æ¶æ„ XML æ•°æ®çš„æ­¥éª¤ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘å®Œæ•´ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶ä»£ç çœ‹èµ·æ¥ä¸»è¦å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ï¼Œä½†ä»å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ï¼š
* ç”¨æˆ·æšä¸¾æ¨¡å—å¯èƒ½è¢«æ»¥ç”¨ï¼Œç”¨äºéæ³•æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€‚
* ä»£ç ä¸­å­˜åœ¨ä¸€äº›ç¡¬ç¼–ç çš„å‚æ•°å’Œè·¯å¾„ï¼Œå¯èƒ½åœ¨ç‰¹å®šç¯å¢ƒä¸‹ä¸å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨è€…ä¿®æ”¹ï¼Œå¯èƒ½å­˜åœ¨è¢«è¯±å¯¼ä¿®æ”¹æ¶æ„ä»£ç ã€‚
* é£é™©è¯„ä¼°ä¸º 10%ï¼Œå› ä¸ºä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨ï¼Œè€Œéæ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯å­˜åœ¨è¢«æ»¥ç”¨å’Œä¿®æ”¹çš„æ½œåœ¨é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [shacojx/CVE-2021-26855-exploit-Exchange](https://github.com/shacojx/CVE-2021-26855-exploit-Exchange)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #21

**æ¥æº**: [CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md](../2021/CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®Exchange Serverçš„ç«¯å£ï¼Œé€šå¸¸æ˜¯443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ Exchange æœåŠ¡å™¨çš„èº«ä»½è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç åˆ¤æ–­ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚å¤§é‡çš„ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå¹¶ä¸”CISAå·²çŸ¥å¯åˆ©ç”¨æ¼æ´ç›®å½•ä¸­åŒ…å«äº†æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æ£€è§†æä¾›çš„ä»£ç ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š
1.  `README.md`: åŒ…å«æ¼æ´æè¿°å’Œå›¾ç‰‡ã€‚
2.  `build.xml`: Antæ„å»ºè„šæœ¬ï¼Œç”¨äºç¼–è¯‘Javaé¡¹ç›®ã€‚
3.  `ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºå­˜å‚¨æ˜“å—æ”»å‡»çš„IPåœ°å€åˆ—è¡¨ã€‚
4.  `list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æã€‚
5.  `manifest.mf`: JARæ–‡ä»¶çš„æ¸…å•æ–‡ä»¶ã€‚
6.  `Tool-Build/Run.bat`: ç”¨äºè¿è¡Œç¼–è¯‘åçš„JARæ–‡ä»¶çš„æ‰¹å¤„ç†è„šæœ¬ã€‚
7.  `Tool-Build/ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œä¸ä¸Šé¢çš„`ipVuln.txt`ç›¸åŒã€‚
8.  `Tool-Build/list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æï¼Œä¸ä¸Šé¢çš„`list-ip.txt`ç›¸åŒã€‚
9.  `Tool-Build/Nmap/scripts/http-vuln-cve2021-26855.nse`: Nmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å—CVE-2021-26855æ¼æ´å½±å“ã€‚è¿™ä¸ªè„šæœ¬æ˜¯æ¼æ´æ£€æµ‹çš„æ ¸å¿ƒã€‚

ä¸»è¦é£é™©ç‚¹åœ¨äº`build.xml`æ„å»ºè„šæœ¬å’Œ`http-vuln-cve2021-26855.nse`è¿™ä¸ªNmapè„šæœ¬ã€‚æ„å»ºè„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä»¥åŒ…å«æ¶æ„ä»£ç ï¼Œè™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤éšè”½çš„åé—¨ä»£ç å­˜åœ¨çš„å¯èƒ½æ€§ã€‚Nmapè„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´æ£€æµ‹è„šæœ¬ï¼Œä½†ç†è®ºä¸Šï¼Œå¦‚æœè„šæœ¬è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´æ—¶ï¼Œæ¤å…¥åé—¨æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚
æ€»ä½“è¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ï¼Œå› ä¸ºä¸»è¦çš„ä»£ç åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œè€Œä¸æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä¸”ä»£ç é‡ä¸å¤§ï¼Œå®¹æ˜“å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  **SSRF:** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´å‘ExchangeæœåŠ¡å™¨å‘é€ç²¾å¿ƒæ„é€ çš„HTTPè¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹ŸExchangeæœåŠ¡å™¨ä¸Šçš„å…¶ä»–ç”¨æˆ·ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** åœ¨æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ä¸å®‰å…¨çš„deserializationï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼ŒCVE-2021-26855æ˜¯ProxyLogonæ”»å‡»é“¾çš„åˆå§‹æ¼æ´ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´çš„æœ‰æ•ˆæ€§é«˜ï¼Œåˆ©ç”¨æ–¹å¼è¾ƒä¸ºæ˜ç¡®ï¼Œä½†æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ‰«æè€Œéç›´æ¥åˆ©ç”¨ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡SSRFæ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [shacojx/Scan-Vuln-CVE-2021-26855](https://github.com/shacojx/Scan-Vuln-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #22

**æ¥æº**: [CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md](../2021/CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md)

## CVE-2021-26855 & CVE-2021-27065 - Microsoft Exchange Server RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ (é€šå¸¸æ˜¯443)ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´åˆ©ç”¨é“¾åŒ…æ‹¬ CVE-2021-26855 (SSRF) å’Œ CVE-2021-27065 (ä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´RCE)ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä»»æ„HTTPè¯·æ±‚å¹¶ä¼ªè£…æˆExchangeæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚POCä»£ç é¦–å…ˆå‘é€ä¸€ä¸ªNTLMåå•†è¯·æ±‚åˆ°`/rpc/`ç«¯ç‚¹ï¼Œåˆ©ç”¨è¿”å›çš„`WWW-Authenticate`å¤´ä¸­çš„ä¿¡æ¯æ¥è·å–ç›®æ ‡ExchangeæœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **RCE (CVE-2021-27065):** åˆ©ç”¨è·å–çš„è®¡ç®—æœºåï¼Œç»“åˆä¸€ä¸ªå·²çŸ¥çš„é‚®ç®±åœ°å€æ ¼å¼ï¼Œæ„é€ ä¸€ä¸ªåŒ…å«`LegacyDN`çš„è¯·æ±‚ï¼Œå‘é€åˆ°`/ecp/baba.js`ï¼Œæœ€ç»ˆé€šè¿‡å†™å…¥webshellæ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ`baba.js`æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œä¸Šä¼ ä»»æ„çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯å…¬å¼€çš„ï¼Œå½±å“èŒƒå›´å¹¿æ³›ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

*   **Webshell å†…å®¹ï¼š** Webshellçš„å†…å®¹ï¼ˆ`<script language="JScript" runat="server">function Page_Load(){eval(Request["babanb"],"unsafe");}</script>`ï¼‰æ˜¯å›ºå®šçš„ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹è¿™ä¸ªå†…å®¹ï¼Œæ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…æ¤å…¥æ›´åŠ éšè”½çš„åé—¨ã€‚ç›®å‰æ˜¯ç›´æ¥åœ¨ecpç›®å½•ä¸‹å†™äº†baba.jsçš„æ–‡ä»¶,æ¯”è¾ƒå®¹æ˜“è¢«å‘ç°ã€‚
*   **ä¾èµ–é¡¹é£é™©ï¼š**è™½ç„¶ä»£ç é‡å°‘ï¼Œä½†ä»ç„¶å¯èƒ½å¼•å…¥æœ‰å®‰å…¨é£é™©çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè™½ç„¶è¿™é‡Œæ²¡æœ‰ä½“ç°ã€‚
*  **é‚®ä»¶ç”¨æˆ·åˆ—è¡¨:** ä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·åˆ—è¡¨è¿›è¡Œå°è¯•ã€‚è¿™ä¸ªåˆ—è¡¨å¯èƒ½è¢«ä¿®æ”¹ï¼Œç”¨äºé’ˆå¯¹ç‰¹å®šç›®æ ‡è¿›è¡Œæ”»å‡»ï¼Œæˆ–è€…ç”¨äºæœé›†æ•æ„Ÿä¿¡æ¯ã€‚

è™½ç„¶å­˜åœ¨é£é™©ï¼Œä½†æ•´ä½“ä»£ç é€»è¾‘è¾ƒä¸ºæ¸…æ™°ï¼Œé£é™©è¾ƒä½ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [ssrsec/Microsoft-Exchange-RCE](https://github.com/ssrsec/Microsoft-Exchange-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #23

**æ¥æº**: [CVE-2021-26855-thau0x01_poc_proxylogon.md](../2021/CVE-2021-26855-thau0x01_poc_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Exchange Serverå¼€æ”¾443ç«¯å£ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 (ProxyLogon) æ˜¯ä¸€ç§å­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œèƒ½å¤Ÿä¼ªé€ èº«ä»½å¹¶æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œè¯¥æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ã€‚æä¾›çš„PoCä»£ç å±•ç¤ºäº†åˆ©ç”¨è¯¥æ¼æ´è·å–è¿œç¨‹ä»£ç æ‰§è¡Œæƒé™çš„è¿‡ç¨‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** é¦–å…ˆï¼Œåˆ©ç”¨SSRFæ¼æ´å‘é€ä»»æ„HTTPè¯·æ±‚ï¼Œç›®çš„æ˜¯ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–æœ‰æ•ˆçš„LegacyDNã€‚
2.  **è·å– LegacyDN:** é€šè¿‡æ„é€ Autodiscoverè¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„LegacyDNå»ºç«‹ä¸€ä¸ªMAPIä¼šè¯ã€‚
4.  **è·å– SID:** ä»MAPIå“åº”ä¸­æå–ç”¨æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦ (SID)ã€‚
5.  **ProxyLogon:** åˆ©ç”¨ProxyLogonæœºåˆ¶ï¼Œå°†ç”¨æˆ·SIDä¿®æ”¹ä¸ºç®¡ç†å‘˜SIDï¼Œä»è€Œæå‡æƒé™ã€‚
6.  **å†™å…¥ Webshell:** åˆ©ç”¨æå‡çš„æƒé™ï¼Œå‘æœåŠ¡å™¨å†™å…¥webshellï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸­å­˜åœ¨ä»¥ä¸‹æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

*   **ç¡¬ç¼–ç çš„è·¯å¾„å’Œæ–‡ä»¶åï¼š** `shell_path`å’Œ`shell_absolute_path`ä»¥åŠ`ahihi7.aspx`æ˜¯ç¡¬ç¼–ç çš„ï¼Œè¿™ä½¿å¾—webshellå®¹æ˜“è¢«æ£€æµ‹å’Œç§»é™¤ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è¿™äº›å€¼ï¼Œå¯èƒ½ä¼šå°†webshellå†™å…¥åˆ°æ›´éšè”½çš„ä½ç½®ã€‚
*   **webshell å†…å®¹ï¼š** `shell_content`åŒ…å«æ‰§è¡Œ `whoami` å‘½ä»¤çš„JavaScriptä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•å‘½ä»¤ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹`shell_content`ä»¥æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚è™½ç„¶å½“å‰ä»£ç åªæ˜¯æ‰§è¡Œ`whoami`ï¼Œä½†ä¸èƒ½æ’é™¤æ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥`shell_content`çš„å¯èƒ½æ€§ã€‚è¿™ä¸€éƒ¨åˆ†å­˜åœ¨è¢«æ¶æ„ä¿®æ”¹è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§ã€‚
*   **ä»£ç†URI (`msExchProxyUri`)**: PoCä»£ç ä¸­ `msExchProxyUri` è®¾ç½®ä¸º`http://127.0.0.1:8080/`ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯èƒ½å°è¯•é€šè¿‡æœ¬åœ°ä»£ç†è¿›è¡Œå…¶ä»–æ”»å‡»ï¼Œæˆ–è€…å°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ã€‚è™½ç„¶ç°åœ¨æŒ‡å‘æœ¬åœ°ï¼Œä½†å­˜åœ¨è¢«ä¿®æ”¹æŒ‡å‘æ¶æ„åœ°å€çš„å¯èƒ½æ€§ã€‚

è™½ç„¶è¿™äº›é£é™©å­˜åœ¨ï¼Œä½†æ•´ä½“ä»£ç çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†RCEï¼Œæ²¡æœ‰æ˜æ˜¾çš„éšè—åé—¨æˆ–è€…å…¶ä»–æ¶æ„è¡Œä¸ºã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½, çº¦5%ã€‚

**é¡¹ç›®åœ°å€:** [thau0x01/poc_proxylogon](https://github.com/thau0x01/poc_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #24

**æ¥æº**: [CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md](../2021/CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md)

## CVE-2021-26855-Microsoft Exchange Server-SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶æ¨¡æ‹Ÿ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚æä¾›çš„POCä»£ç å°è¯•é€šè¿‡ `POST /ecp/poc-2021-26855.js HTTP/1.1` å‘é€ SOAP è¯·æ±‚ï¼Œé€šè¿‡ä¿®æ”¹ `X-BEResource` cookie ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè¿›è€Œæ‰§è¡Œå…¶ä»–æ“ä½œã€‚ç”±äºè¯·æ±‚çš„ç›®æ ‡æ˜¯ EWS (Exchange Web Services)ï¼Œè¿™å…è®¸æ”»å‡»è€…è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ã€‚åˆ†æä»£ç ä¸­,æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF æ”»å‡»ï¼š** åˆ©ç”¨ CVE-2021-26855ï¼Œæ”»å‡»è€…å¯ä»¥å‘ Exchange æœåŠ¡å™¨å‘é€ä¼ªé€ çš„ HTTP è¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡æ“çºµ `X-BEResource` cookieï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå†’å……åˆæ³•ç”¨æˆ·ã€‚
3.  **é‚®ç®±è®¿é—®ï¼š** ä¸€æ—¦æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ EWS æ¥å£è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ï¼Œä¾‹å¦‚è¯»å–é‚®ä»¶ã€è”ç³»äººç­‰ã€‚
4.  **é“¾å¼åˆ©ç”¨ï¼š** CVE-2021-26855 é€šå¸¸ä¸å…¶ä»– Exchange æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858ã€CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå½¢æˆ ProxyLogon æ”»å‡»é“¾ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt](https://github.com/timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #25

**æ¥æº**: [CVE-2021-26855-yaoxiaoangry3_Flangvik.md](../2021/CVE-2021-26855-yaoxiaoangry3_Flangvik.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œå…·ä½“ç‰ˆæœ¬å‚è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Microsoft Exchange Serverï¼ŒCVSS è¯„åˆ†ä¸º 9.1ï¼Œè¡¨æ˜å…¶ä¸¥é‡æ€§ã€‚
æœç´¢ç»“æœæ˜¾ç¤ºï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„ PoC å¯ç”¨ï¼Œå‚è€ƒç½‘é¡µæ ‡é¢˜åŒ…å«"ProxyLogon"çš„ç½‘é¡µä¿¡æ¯å¯ä»¥çŸ¥é“ã€‚
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª C# PoCï¼Œæ”¯æŒåŠäº¤äº’å¼çš„ web shell ä»¥åŠ shellcode æ‰§è¡Œã€‚
ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/e24bb8b01b99c84300e1ac6fb58f9709/README.md` åªæ˜¾ç¤ºäº†å…³äº PoC çš„ç®€çŸ­æè¿°ï¼Œæ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ç”±äºæ˜¯ C# PoCï¼ŒæŠ•æ¯’ä»£ç å¯èƒ½éšè—åœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä»…ä»…é€šè¿‡ README.md æ–‡ä»¶åˆ¤æ–­ï¼Œå­˜åœ¨è¯¯åˆ¤å¯èƒ½æ€§ï¼Œä½†æ˜¯æ ¹æ®ä»¥å¾€ç»éªŒï¼Œå¼€æºç¤¾åŒºå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’è¡Œä¸ºï¼Œå› æ­¤ç»™å‡ºä¸€å®šç™¾åˆ†æ¯”ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 çš„ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨åç»­æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰å†™å…¥ä»»æ„æ–‡ä»¶ã€‚
3.  å†™å…¥çš„æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ª ASPX web shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
4.  æˆ–è€…ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ shellcode ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„åˆå§‹å…¥å£ç‚¹ï¼Œä¸ºåç»­æ”»å‡»é“ºå¹³é“è·¯ã€‚

**é¡¹ç›®åœ°å€:** [yaoxiaoangry3/Flangvik](https://github.com/yaoxiaoangry3/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---



---

## POC #7

**æ¥æº**: [CVE-2021-26855-ShyTangerine_cve-2021-26855.md](../2021/CVE-2021-26855-ShyTangerine_cve-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œè¯¦è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ ECP æ¥å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1.  **åˆå§‹è¯·æ±‚ï¼š** å‘ `/ecp/x.png` å‘é€ GET è¯·æ±‚ï¼Œå°è¯•è·å– `X-BEResource` Cookieã€‚
2.  **è·å– DN å€¼ï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç”¨æˆ·çš„ DN (Distinguished Name)ã€‚
3.  **Mapi/Emsmdb è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ DN å€¼ï¼Œå‘ `/ecp/x.png` å‘é€åŒ…å« `X-BEResource`ã€`X-Clientinfo` ç­‰å¤´çš„ POST è¯·æ±‚ï¼Œå°è¯•å»ºç«‹ MAPI over HTTP è¿æ¥ã€‚
4.  **è·å– Session å’Œ msExchEcpCanaryï¼š** é€šè¿‡å‘ `/ecp/x.png` å‘é€åŒ…å«ç‰¹å®š XML å†…å®¹çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ Negotiate åè®®è·å– ASP.NET Session ID å’Œ `msExchEcpCanary` å€¼ã€‚`msExchEcpCanary` æ˜¯ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œï¼Œç”¨äºé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) æ”»å‡»ã€‚
5.  **è·å– OAB IDï¼š** å‘é€åŒ…å«`msExchEcpCanary` å’Œ Session ID åˆ°`/ecp/x.png`ï¼Œè·å–OAB idï¼Œä¸ºä¸‹ä¸€æ­¥å†™å…¥æ¶æ„ä»£ç ä½œå‡†å¤‡

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´ç¡®å®å­˜åœ¨ä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚è¯¥ POC ä»£ç å±•ç¤ºäº†æ¼æ´åˆ©ç”¨çš„å…³é”®æ­¥éª¤ï¼Œä¾‹å¦‚å¦‚ä½•ç»•è¿‡èº«ä»½éªŒè¯ã€å¦‚ä½•è·å–å¿…è¦çš„å‡­æ®ä¿¡æ¯ç­‰ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯„ä¼°æä¾›çš„ POC ä»£ç ï¼Œå­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œ10%ã€‚ é£é™©ç‚¹ä¸»è¦åœ¨äºï¼š

*   **ç¡¬ç¼–ç çš„ IP åœ°å€å’ŒåŸŸåï¼š** POC ä»£ç ä¸­åŒ…å«ç¡¬ç¼–ç çš„ IP åœ°å€ (ä¾‹å¦‚ `10.255.200.20`, `192.168.170.134`) å’ŒåŸŸå (`EXCHANGE01.xihongdream.com`)ã€‚å¦‚æœç”¨æˆ·ç›´æ¥ä½¿ç”¨è¿™äº›ç¡¬ç¼–ç çš„å€¼ï¼Œå¯èƒ½ä¼šå°†æ”»å‡»æµé‡å¯¼å‘ä½œè€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œæš´éœ²ç›®æ ‡æœåŠ¡å™¨çš„ä¿¡æ¯æˆ–è¢«ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

*   **æ½œåœ¨çš„åé—¨æ¤å…¥ï¼š** è™½ç„¶ POC ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´åˆ©ç”¨è¿‡ç¨‹ï¼Œä½†ä½œè€…æœ‰å¯èƒ½åœ¨ä»£ç ä¸­æ’å…¥åé—¨ï¼Œä¾‹å¦‚ï¼Œåœ¨OABæ“ä½œä¸­ï¼Œå†™å…¥æ¶æ„è„šæœ¬åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œé•¿æœŸæ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚

æ€»çš„æ¥è¯´ï¼Œè¯¥ POC ä»£ç ä¸»è¦æ¼”ç¤ºäº† SSRF çš„åˆ©ç”¨æ–¹å¼ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶åº”è°¨æ…ï¼ŒåŠ¡å¿…ä¿®æ”¹ä»£ç ä¸­çš„ç¡¬ç¼–ç å€¼ï¼Œé¿å…æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [ShyTangerine/cve-2021-26855](https://github.com/ShyTangerine/cve-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #8

**æ¥æº**: [CVE-2021-26855-TheDudeD6_ExchangeSmash.md](../2021/CVE-2021-26855-TheDudeD6_ExchangeSmash.md)

## CVE-2021-26855-Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯è®¿é—®ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å†’å……ç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–åˆæ³•çš„èº«ä»½ã€‚
2.  **è·å–SIDï¼š** ä½¿ç”¨åˆæ³•çš„èº«ä»½ï¼Œè·å–ç”¨æˆ·çš„SID
3.  **ä¼ªé€ ç®¡ç†å‘˜ SIDï¼š** é€šè¿‡ç¯¡æ”¹å·²æ³„éœ²çš„ç”¨æˆ·SIDï¼Œä¼ªé€ ç®¡ç†å‘˜SID
4.  **ProxyLogonï¼š** ä½¿ç”¨ä¼ªé€ çš„ç®¡ç†å‘˜ SID é€šè¿‡ ProxyLogon æ”»å‡»é“¾ï¼Œè·å¾—ç®¡ç†å‘˜æƒé™ã€‚
5.  **å†™å…¥webshellï¼š** åˆ©ç”¨ç®¡ç†å‘˜æƒé™ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥ webshellã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** é€šè¿‡è®¿é—® webshell æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹æä¾›çš„POCä»£ç ï¼Œå‘ç°å…¶åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸åº”å­˜åœ¨æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºä»£ç é€»è¾‘å¤æ‚ï¼Œä¸”ä¾èµ–å¤–éƒ¨åº“ï¼ˆImpacketï¼‰ï¼Œå­˜åœ¨ä½œè€…åœ¨ä»£ç ä¸­æ¤å…¥æ¶æ„é€»è¾‘çš„å¯èƒ½æ€§ã€‚å¦å¤–ï¼Œé€šè¿‡åˆ†æå‘ç°proxylogon.pyä¸­çš„shell_srcå˜é‡å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè¢«æ›¿æ¢æˆæ¶æ„payloadï¼Œåˆ™å­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦é£é™©åœ¨äºä»£ç çš„å¯ä¿¡åº¦ä»¥åŠshell_srcå˜é‡çš„æ›¿æ¢ã€‚

**é¡¹ç›®åœ°å€:** [TheDudeD6/ExchangeSmash](https://github.com/TheDudeD6/ExchangeSmash)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #9

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF to RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (Server-Side Request Forgery) -> RCE (Remote Code Execution)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯ä»¥ä»æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 å­˜åœ¨äº Microsoft Exchange Server ä¸­ï¼Œæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ©ç”¨æ­¤æ¼æ´ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼š** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ SSRF æ¼æ´ï¼Œå‘ Exchange æœåŠ¡å™¨çš„ autodiscover ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å¾—çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **è·å– SIDï¼š** ä» MAPI å“åº”ä¸­æå–ç”¨æˆ·çš„ SIDã€‚
5.  **ProxyLogonï¼š** åˆ©ç”¨ SID ä¼ªé€ èº«ä»½ï¼Œé€šè¿‡ proxyLogon.ecp ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ã€‚
6.  **å†™å…¥ Webshellï¼š** æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„çš„ webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸­ã€‚
7.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„ webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„ POC ä»£ç  `ExchangeSheller.py` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æµç¨‹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åˆ©ç”¨ CVE-2021-26855 æ¼æ´ï¼Œå› æ­¤æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç æœ¬èº«æ‰§è¡Œçš„æ˜¯æ¼æ´åˆ©ç”¨æµç¨‹ï¼Œä¸»è¦åŠŸèƒ½ä¸ºåˆ©ç”¨ SSRF æ¼æ´å¹¶æœ€ç»ˆå†™å…¥ Webshellã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä»£ç æ¥æºï¼š** ä»£ç æ¥è‡ª GitHubï¼Œéœ€è¦éªŒè¯å…¶ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®Œæ•´æ€§ã€‚
*   **Webshell å†…å®¹ï¼š** Webshell çš„å†…å®¹å¯æ§ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ webshell çš„å†…å®¹ï¼Œä½¿å…¶æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ¤å…¥åé—¨ã€çªƒå–æ•°æ®ç­‰ã€‚
*   **éšè—æŒ‡ä»¤ï¼š** ç†è®ºä¸Šï¼Œeval å‡½æ•°ä¸­å¯ä»¥åµŒå…¥éšè”½çš„æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦ä»”ç»†åˆ†æ `ExchangeSheller.py` æ–‡ä»¶ï¼Œå½“å‰åˆ¤æ–­è¯¥é£é™©è¾ƒä½ã€‚

**ç»“è®ºï¼š**

è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹webshellçš„å†…å®¹ï¼Œä½†æ€»ä½“æ¥è¯´ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¸…æ™°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%ã€‚åŠ¡å¿…åœ¨éš”ç¦»ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å¯¹ç”Ÿæˆçš„ webshell è¿›è¡Œå®‰å…¨å®¡è®¡ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855](https://github.com/ZephrFish/Exch-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #10

**æ¥æº**: [CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md](../2021/CVE-2021-26855-ZephrFish_Exch-CVE-2021-26855_Priv.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨å—å½±å“çš„ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åç»“åˆå…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼‰æ¥å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´ï¼Œé€šè¿‡æ„é€ ç‰¹æ®Šçš„ URL å’Œè¯·æ±‚å¤´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„è®¿é—®æƒé™ã€‚
2.  **è·å– LegacyDNï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥ï¼š** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ã€‚
4.  **ProxyLogon:** é€šè¿‡æ„é€  ProxyLogon è¯·æ±‚ï¼Œä¼ªè£…æˆç®¡ç†å‘˜èº«ä»½ã€‚
5.  **å†™å…¥ Webshell (CVE-2021-27065ï¼Œè™½ç„¶POCæœªç›´æ¥ä½“ç°ï¼Œä½†é€šå¸¸ä¼šç»“åˆä½¿ç”¨):** åœ¨æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åï¼Œåˆ©ç”¨æ¼æ´åœ¨ Exchange æœåŠ¡å™¨çš„ OWA ç›®å½•ä¸‹å†™å…¥æ¶æ„çš„ Webshell æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç çš„ JScript ä»£ç ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒå†ç°äº† ProxyLogon æ”»å‡»é“¾çš„å…³é”®æ­¥éª¤ï¼ŒåŒ…æ‹¬ SSRFã€æƒé™æå‡å’Œ webshell å†™å…¥ (webshell å†…å®¹åœ¨ä»£ç ä¸­å·²ç»å­˜åœ¨)ã€‚æœç´¢å¼•æ“ç»“æœä¸­ä¹Ÿè¡¨æ˜ CVE-2021-26855 è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†ææä¾›çš„ POC ä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨åˆ©ç”¨ SSRF æ¼æ´è¿›è¡Œèº«ä»½éªŒè¯ç»•è¿‡ï¼Œå¹¶æœ€ç»ˆéƒ¨ç½² webshellã€‚è™½ç„¶ webshell æœ¬èº«æ˜¯ä¸€ç§æ¶æ„ä»£ç ï¼Œä½†è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤ï¼Œè€Œéä½œè€…æœ‰æ„æ·»åŠ çš„æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [ZephrFish/Exch-CVE-2021-26855_Priv](https://github.com/ZephrFish/Exch-CVE-2021-26855_Priv)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #11

**æ¥æº**: [CVE-2021-26855-dwisiswant0_proxylogscan.md](../2021/CVE-2021-26855-dwisiswant0_proxylogscan.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„ Exchange Server çš„ç½‘ç»œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……ç®¡ç†å‘˜èº«ä»½ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œä¸ CVE-2021-27065 (èº«ä»½éªŒè¯åä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´) ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange Serverï¼Œç»•è¿‡èº«ä»½éªŒè¯å¹¶è·å¾—ç®¡ç†å‘˜æƒé™ã€‚
2.  åˆ©ç”¨è·å¾—çš„ç®¡ç†å‘˜æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ CVE-2021-27065 å°†æ¶æ„ä»£ç å†™å…¥æœåŠ¡å™¨ã€‚
3.  æ‰§è¡Œå†™å…¥çš„æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**POC ä»£ç åˆ†æï¼š**

æä¾›çš„ POC ä»£ç  `proxylogscan` æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¼–å†™çš„å·¥å…·ï¼Œç”¨äºå¤§è§„æ¨¡æ‰«æå­˜åœ¨ CVE-2021-26855 æ¼æ´çš„ Microsoft Exchange Serverã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯æ‰«ææ¼æ´ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚ è€ƒè™‘åˆ°å·¥å…·çš„ç”¨é€”å’Œä»£ç çš„ç®€æ´æ€§ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯éœ€è¦å¯¹ä»£ç è¿›è¡Œä»”ç»†çš„å®¡æŸ¥ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠç½‘ç»œè¯·æ±‚çš„éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚ æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ä»£ç ä½¿ç”¨go getå®‰è£…ï¼Œå­˜åœ¨ä¸€å®šçš„ä¾èµ–é£é™©,éœ€è¦æ³¨æ„.


**é¡¹ç›®åœ°å€:** [dwisiswant0/proxylogscan](https://github.com/dwisiswant0/proxylogscan)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #12

**æ¥æº**: [CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md](../2021/CVE-2021-26855-glen-pearson_ProxyLogon-CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 22 å’Œ 23, Exchange Server 2016 Cumulative Update 12-19, Exchange Server 2019 Cumulative Update 1-8

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æœªä¿®è¡¥çš„ Exchange Server å®ä¾‹ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® Exchange æœåŠ¡å™¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸ºåç»­åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰åˆ›é€ æ¡ä»¶ã€‚æ¼æ´åˆ©ç”¨é“¾é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ã€‚
2.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–:** é€šè¿‡ SSRF æ¼æ´è·å–çš„æƒé™ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26854, CVE-2021-26857, CVE-2021-27065ï¼‰æ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„ PoC ä»£ç æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ ProxyLogon æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œå®ƒåˆ©ç”¨ CVE-2021-26855 ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªåé—¨ Web shellã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1.  **è‡ªåŠ¨å‘ç° (Autodiscover):** ä½¿ç”¨ Autodiscover åè®®è·å– LegacyDNã€‚
2.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„ LegacyDN å»ºç«‹ MAPI è¿æ¥ï¼Œæ¨¡æ‹Ÿç®¡ç†å‘˜æƒé™ã€‚
3.  **Web Shell å†™å…¥:**  å°†åŒ…å«åå‘ shell ä»£ç çš„ aspx Web shell å†™å…¥åˆ°æœåŠ¡å™¨çš„ `Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\test11.aspx` è·¯å¾„ã€‚
4.  **æ‰§è¡Œ Web Shell:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥ Web shell æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥ Web shell æ‰§è¡Œ Powershell å‘½ä»¤ï¼Œå»ºç«‹ä¸€ä¸ªåå‘ TCP è¿æ¥åˆ°æ”»å‡»è€…çš„æŒ‡å®š IP åœ°å€å’Œç«¯å£ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** è¯¥ PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº† ProxyLogon æ¼æ´åˆ©ç”¨ï¼Œå¹¶æˆåŠŸåˆ›å»ºåå‘ shellï¼Œè¯æ˜äº†è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š** å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ä½œè€…åœ¨åŸå§‹PoCåŸºç¡€ä¸Šä¿®æ”¹äº†ä»£ç ï¼Œå¢åŠ äº†åˆ›å»ºç”¨æˆ·å’Œåå‘shellçš„åŠŸèƒ½ï¼Œè¯¥è¡Œä¸ºå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†åå‘shellä¸­çš„IPåœ°å€å’Œç«¯å£ï¼Œåˆ™ä½¿ç”¨è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ é£é™©å¤§çº¦åœ¨10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2021-26855 æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å– Exchange æœåŠ¡å™¨çš„æƒé™ï¼Œç„¶åé€šè¿‡å†™å…¥ Web shell æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™ä¸ª Web shell ä¼šè¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œå…è®¸æ”»å‡»è€…å®Œå…¨æ§åˆ¶å—æ„ŸæŸ“çš„ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [glen-pearson/ProxyLogon-CVE-2021-26855](https://github.com/glen-pearson/ProxyLogon-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #13

**æ¥æº**: [CVE-2021-26855-hakivvi_proxylogon.md](../2021/CVE-2021-26855-hakivvi_proxylogon.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„ExchangeæœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013 Cumulative Update 21/22/23, Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„ç½‘ç»œï¼Œå¹¶ä¸”æœåŠ¡å™¨å­˜åœ¨æ¼æ´

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚CVE-2021-27065ï¼‰ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ç®¡ç†å‘˜èº«ä»½é€šè¿‡èº«ä»½éªŒè¯ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ä¼ªé€  HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **ç®¡ç†å‘˜æƒé™è·å–:** åˆ©ç”¨ä¼ªé€ çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜æƒé™ã€‚
3.  **OABè™šæ‹Ÿç›®å½•æ“ä½œ:** ä¿®æ”¹OAB (Offline Address Book)è™šæ‹Ÿç›®å½•çš„ExternalUrlå‚æ•°ï¼Œå°†shellåœ°å€å†™å…¥ã€‚
4.  **Shell å†™å…¥:** é€šè¿‡ä¿®æ”¹çš„ExternalUrlï¼Œæ”»å‡»è€…å°†ä¸€ä¸ª ASPX webshell å†™å…¥åˆ° Exchange æœåŠ¡å™¨çš„ web å¯è®¿é—®ç›®å½•ï¼ˆé€šå¸¸æ˜¯`C:\inetpub\wwwroot\aspnet_client\`ï¼‰ã€‚ 
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—® webshell çš„ URL å¹¶å‘é€ç‰¹å®šçš„è¯·æ±‚å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**ä»£ç åˆ†æä¸æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç  `proxylogon.py` å®ç°äº†ä¸Šè¿°çš„æ”»å‡»æµç¨‹ã€‚ä»£ç é¦–å…ˆåˆ©ç”¨ SSRF è·å–æœåŠ¡å™¨çš„è®¡ç®—æœºåï¼Œç„¶ååˆ©ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚ä¹‹åï¼Œå®ƒåˆ©ç”¨è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œé€šè¿‡ä¿®æ”¹ OAB è™šæ‹Ÿç›®å½•æ¥å†™å…¥ webshellã€‚æœ€åï¼Œä»£ç è¾“å‡º webshell çš„ URLï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥ URL æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**  POCä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **åé—¨æ¤å…¥:** è™½ç„¶ä¸»è¦çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´è¿›è¡ŒRCEï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¼šåœ¨è„šæœ¬ä¸­æ·»åŠ é¢å¤–çš„åé—¨ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨å†™å…¥çš„ webshell ä¸­æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å°†æ¥ä¿æŒå¯¹æœåŠ¡å™¨çš„è®¿é—®ã€‚
*   **ä¿¡æ¯æ”¶é›†:**  æ”»å‡»è€…å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥æ”¶é›†ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·åã€å¯†ç å“ˆå¸Œã€ä»¥åŠå…¶ä»–é…ç½®ä¿¡æ¯ã€‚
*   **æ¶æ„ä¼ æ’­:**  å¦‚æœæ”»å‡»è€…æ§åˆ¶äº†å¤šä¸ª Exchange æœåŠ¡å™¨ï¼Œä»–ä»¬å¯ä»¥ä¿®æ”¹è„šæœ¬æ¥è‡ªåŠ¨ä¼ æ’­æ¶æ„è½¯ä»¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚
*   **ä¾èµ–åº“é£é™©ï¼š**POCä¾èµ–Impacketåº“ï¼Œå¦‚æœImpacketåº“æœ¬èº«è¢«ç¯¡æ”¹æˆ–åŒ…å«æ¶æ„ä»£ç ï¼Œé‚£ä¹ˆä½¿ç”¨æ­¤POCä¹Ÿä¼šå—åˆ°å½±å“ã€‚

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†å°±æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«è€Œè¨€ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚é£é™©ä¸»è¦åœ¨äºè¯¥æ¼æ´æœ¬èº«å¸¦æ¥çš„æƒé™å’Œæ½œåœ¨çš„æ¶æ„ä¿®æ”¹è¡Œä¸ºã€‚POCä¸­ç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„éƒ¨åˆ†(gen())æ˜¯ä¸ºäº†é¿å…æ–‡ä»¶åå†²çªï¼Œæœ¬èº«ä¸æ˜¯æ¶æ„è¡Œä¸ºã€‚åˆ©ç”¨OABVirtualDirectoryä¿®æ”¹ExternalUrlä»¥åŠResetOABVirtualDirectoryä¿®æ”¹FilePathNameçš„è¡Œä¸ºæ˜¯ä¸ºäº†webshellçš„å†™å…¥ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

**æ€»ç»“:** è¯¥æ¼æ´åˆ©ç”¨é“¾çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸º CVE-2021-26855 æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚ æŠ•æ¯’é£é™©ä¸»è¦æ¥è‡ªäºåˆ©ç”¨æ­¤æ¼æ´æˆåŠŸå…¥ä¾µåçš„æ¶æ„è¡Œä¸ºï¼Œè€ŒéPOCä»£ç æœ¬èº«ã€‚ç”±äºä»£ç ä¸­åŒ…å«webshellçš„éƒ¨ç½²ï¼Œå­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†ç›´æ¥åˆ¤å®šä¸ºæŠ•æ¯’ä¸ä¸¥è°¨ï¼Œç»“åˆåˆ†æç»“æœï¼ŒæŠ•æ¯’é£é™©é¢„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [hakivvi/proxylogon](https://github.com/hakivvi/proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #14

**æ¥æº**: [CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md](../2021/CVE-2021-26855-hictf_CVE-2021-26855-CVE-2021-27065.md)

## CVE-2021-26855 Microsoft Exchange Server SSRF è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** SSRF (æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) -> è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®‰è£…ç›¸å…³è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ª SSRF æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶ç»“åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…åˆ©ç”¨ CVE-2021-26855 æ¼æ´å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚
2.  é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªè£…æˆ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ã€‚
3.  ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œååºåˆ—åŒ–æ¼æ´ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ªç®€å•çš„ PHP æ–‡ä»¶ï¼ˆhello worldï¼‰ï¼Œä¸€ä¸ª README æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„ Node.js æœåŠ¡å™¨ (demo.js) å’Œä¸€ä¸ª package.json æ–‡ä»¶ã€‚è¿™äº›ä»£ç ç‰‡æ®µæœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨ CVE-2021-26855ã€‚å®ƒä»¬æ›´åƒæ˜¯ç”¨äºæ­å»ºä¸€ä¸ªåŸºç¡€çš„webæœåŠ¡å™¨ç¯å¢ƒï¼Œå¯èƒ½ç”¨äºéªŒè¯æ¼æ´åˆ©ç”¨çš„æŸäº›æ­¥éª¤æˆ–ä½œä¸ºæœ€ç»ˆæ‰§è¡Œçš„payloadçš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå•ç‹¬æ¥çœ‹ï¼Œæä¾›çš„POCä»£ç **æ— æ•ˆ**ï¼Œå®ƒåªæ˜¯åˆ©ç”¨æ•´ä¸ªæ¼æ´é“¾ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„ POC ä»£ç è¾ƒä¸ºç®€å•ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚`demo.js` åªæ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œ`1.php` åªæ˜¯è¾“å‡º "hello world"ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ª Exchange æ¼æ´çš„ POCï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨æ›´å¤æ‚çš„åˆ©ç”¨é“¾ä¸­åˆ©ç”¨è¿™äº›æ–‡ä»¶ï¼Œä¾‹å¦‚å°† `1.php` ä½œä¸º Webshell ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ–è€…åˆ©ç”¨ `demo.js` æ­å»ºä¸€ä¸ªç”¨äºæ¥æ”¶åå¼¹ shell çš„æœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ–¹å¼çš„ç»„åˆï¼Œè€Œéä»£ç æœ¬èº«å­˜åœ¨åé—¨ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

ç”±äºä»£ç åŠŸèƒ½ç®€å•ï¼Œç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†ä½œä¸ºæ¼æ´åˆ©ç”¨é“¾çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½è¢«ç”¨äºæ‰§è¡Œæ¶æ„æ“ä½œï¼Œå› æ­¤æŠ•æ¯’é£é™©è¯„å®šä¸º **20%**ã€‚

**é¡¹ç›®åœ°å€:** [hictf/CVE-2021-26855-CVE-2021-27065](https://github.com/hictf/CVE-2021-26855-CVE-2021-27065)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #15

**æ¥æº**: [CVE-2021-26855-hosch3n_ProxyVulns.md](../2021/CVE-2021-26855-hosch3n_ProxyVulns.md)

## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæ— éœ€èº«ä»½éªŒè¯å³å¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**åˆ©ç”¨æ¡ä»¶:** Exchange Serverå¯¹å¤–å¼€æ”¾443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä¼ªè£…æˆ Exchange æœåŠ¡å™¨çš„ç®¡ç†å‘˜ã€‚æ­¤æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…¥å£ç‚¹ï¼Œåç»­å¯ä»¥é…åˆå…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“ç»“æœä¸­è®¸å¤šé“¾æ¥éƒ½è¡¨æ˜ CVE-2021-26855 å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `26855.py` å®ç°äº†åˆ©ç”¨è¯¥æ¼æ´çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š

1.  **SSRF æ¢æµ‹ï¼š** é€šè¿‡æ„é€ ç‰¹æ®Šçš„ `X-BEResource` è¯·æ±‚å¤´ï¼Œè·å– Exchange åç«¯æœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **LegacyDN è·å–ï¼š** åˆ©ç”¨ Autodiscover æœåŠ¡ï¼Œé€šè¿‡æä¾›ç”¨æˆ·é‚®ç®±åœ°å€è·å– LegacyDNã€‚
3.  **SID æ¬ºéª—ï¼š** ä¼ªé€  MAPI è¯·æ±‚ï¼Œé€šè¿‡ LegacyDN è·å–ç”¨æˆ·çš„ SIDã€‚
4.  **ProxyLogon åˆ©ç”¨ï¼š** åˆ©ç”¨è·å–åˆ°çš„ SIDï¼Œé€šè¿‡ `proxyLogon.ecp` ç»•è¿‡èº«ä»½éªŒè¯ã€‚
5.  **Webshell éƒ¨ç½²ï¼š** å†™å…¥ Webshell åˆ°æœåŠ¡å™¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æ¼æ´åˆ©ç”¨ä»£ç ä¸­å­˜åœ¨è¾ƒä½çš„æŠ•æ¯’é£é™© (å¤§çº¦ 5%)ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†æ”»å‡»è€…å¯èƒ½åœ¨ `webshell_content` ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ `webshell_path` å°†webshellå†™å…¥åˆ°ä¸å¸¸è§çš„ä½ç½®ï¼Œä½¿å¾—åæœŸçš„æƒé™ç»´æŒæˆ–è€…æ¨ªå‘ç§»åŠ¨æ›´åŠ éšè”½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ`webshell_content`åŒ…å«ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶çš„æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯ä¸€ç§æŠ•æ¯’è¡Œä¸ºã€‚ ç›®å‰æä¾›çš„webshellä»£ç è¾ƒä¸ºç®€å•ï¼Œåˆ¤å®šæŠ•æ¯’çš„æ¦‚ç‡è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ SSRF æ¼æ´ (CVE-2021-26855) ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œæ¬ºéª— Exchange æœåŠ¡å™¨ï¼Œä½¿å…¶è®¤ä¸ºæ”»å‡»è€…å·²é€šè¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-27065ï¼Œå†™å…¥ä»»æ„æ–‡ä»¶ï¼‰åœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéƒ¨ç½² Webshellã€‚
4.  æ”»å‡»è€…é€šè¿‡ Webshell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [hosch3n/ProxyVulns](https://github.com/hosch3n/ProxyVulns)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #16

**æ¥æº**: [CVE-2021-26855-kh4sh3i_ProxyLogon.md](../2021/CVE-2021-26855-kh4sh3i_ProxyLogon.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF/RCE (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Exchange Server 2013ã€2016å’Œ2019çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ã€‚

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå®ƒæ˜¯ ProxyLogon æ¼æ´é“¾ä¸­çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858 å’Œ CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š** åˆ©ç”¨ SSRF æ¼æ´å†’å…… Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** ç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„ Exchange åç«¯èµ„æºã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ååºåˆ—åŒ–/RCEï¼š** åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä¿®æ”¹è™šæ‹Ÿç›®å½•æˆ–å†™å…¥Web shellï¼‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«ä¸€ä¸ª Creative Commons è®¸å¯è¯ï¼Œæœ¬èº«ä¸åŒ…å«ä»»ä½•åˆ©ç”¨ä»£ç æˆ–æ¶æ„ä»£ç ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä½†å®é™…åˆ©ç”¨æ—¶ï¼Œæ”»å‡»è€…éœ€è¦ç»“åˆå…¶ä»–æ¼æ´åˆ©ç”¨å·¥å…·å’Œpayloadæ‰èƒ½å®ç°æœ€ç»ˆçš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ã€‚å­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆè™½ç„¶è¿™é‡Œæ²¡æœ‰ç›´æ¥æä¾›ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜å­˜åœ¨ï¼‰ã€‚æ­¤æ¼æ´è¢« CISA åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œè¡¨æ˜è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æ€»ç»“ï¼š**
CVE-2021-26855 æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ©ç”¨ Exchange æœåŠ¡å™¨æ‰§è¡Œ SSRF æ”»å‡»ï¼Œä¸ºåç»­çš„è¿œç¨‹ä»£ç æ‰§è¡Œé“ºå¹³é“è·¯ã€‚åŠ¡å¿…å°½å¿«åº”ç”¨ Microsoft æä¾›çš„å®‰å…¨æ›´æ–°ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/ProxyLogon](https://github.com/kh4sh3i/ProxyLogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #17

**æ¥æº**: [CVE-2021-26855-mekhalleh_exchange_proxylogon.md](../2021/CVE-2021-26855-mekhalleh_exchange_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤

**å½±å“ç‰ˆæœ¬:** Exchange 2013 Versions < 15.00.1497.012, Exchange 2016 CU18 < 15.01.2106.013, Exchange 2016 CU19 < 15.01.2176.009, Exchange 2019 CU7 < 15.02.0721.013, Exchange 2019 CU8 < 15.02.0792.010

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ Exchange Server å¿…é¡»å¯ä»ç½‘ç»œè®¿é—®,ä¸”æœªå®‰è£…ç›¸åº”çš„å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å†’å……ç®¡ç†å‘˜ã€‚è¯¥æ¼æ´æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥å¯¼è‡´ RCEï¼Œä½†å¯ä»¥ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼Œä¸€ä¸ªèº«ä»½éªŒè¯åçš„ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼‰ç»“åˆä½¿ç”¨ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRFï¼ˆCVE-2021-26855ï¼‰ï¼š**  æ”»å‡»è€…åˆ©ç”¨ SSRF æ¼æ´å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚ï¼Œç»•è¿‡ Exchange Server çš„èº«ä»½éªŒè¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š**  æˆåŠŸåˆ©ç”¨ SSRF åï¼Œæ”»å‡»è€…å¯ä»¥è·å¾— Exchange Server çš„ç®¡ç†æƒé™ï¼Œæ— éœ€æä¾›æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥ï¼ˆCVE-2021-27065 æˆ–å…¶ä»–ï¼‰ï¼š**  è·å¾—èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…åˆ©ç”¨ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼Œå°†æ¶æ„ä»£ç å†™å…¥ Exchange Server çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡è®¿é—®å†™å…¥çš„æ¶æ„æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Exchange Server ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Metasploit æ¨¡å— (`exchange_proxylogon.rb`) æ˜¯ä¸€ä¸ªæ‰«æå™¨ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡ Exchange Server æ˜¯å¦å­˜åœ¨ CVE-2021-26855 æ¼æ´ã€‚å®ƒé€šè¿‡å‘é€ç‰¹å®šçš„ HTTP è¯·æ±‚æ¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ‰«æå™¨æ£€æµ‹åˆ°æ¼æ´ï¼Œåˆ™è¡¨æ˜ç›®æ ‡æœåŠ¡å™¨å®¹æ˜“å—åˆ° ProxyLogon æ”»å‡»ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä»£ç ä¸»è¦æ˜¯ä¸€ä¸ªæ¼æ´éªŒè¯å’Œæ‰«æå·¥å…·ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä½†ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©ä¼°è®¡ä¸º5%ã€‚ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯Metasploitæ¨¡å—ä¸­ä½¿ç”¨çš„HTTPè¯·æ±‚çš„æ„é€ ï¼Œä»¥åŠæ˜¯å¦ä¼šæ„å¤–åœ°å¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆç ´åã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹æ­¤æ¨¡å—ä»¥è¾¾åˆ°æ¶æ„ç›®çš„ï¼Œä½†åœ¨æä¾›çš„ä»£ç æœ¬èº«ä¸­æ²¡æœ‰å‘ç°æ­¤ç±»è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [mekhalleh/exchange_proxylogon](https://github.com/mekhalleh/exchange_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #18

**æ¥æº**: [CVE-2021-26855-praetorian-inc_proxylogon-exploit.md](../2021/CVE-2021-26855-praetorian-inc_proxylogon-exploit.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®Œå…¨æ§åˆ¶ Exchange æœåŠ¡å™¨ã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21/22/23ï¼ŒMicrosoft Exchange Server 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19ï¼ŒMicrosoft Exchange Server 2019 Cumulative Update 1/2/3/4/5/6/7/8

**åˆ©ç”¨æ¡ä»¶:** æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange æœåŠ¡å™¨çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 443ï¼‰ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸ä¸å…¶ä»–æ¼æ´ç»„åˆåˆ©ç”¨ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œå¹¶æœ‰å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´ä¿¡æ¯ï¼Œè¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å®ƒä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œæœ€ç»ˆåœ¨ Exchange æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å« Apache License 2.0 åè®®ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©æä½ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠï¼š

1.  **SSRF æ”»å‡»:** åˆ©ç”¨ CVE-2021-26855 å‘é€æ¶æ„æ„é€ çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨åç«¯ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡:** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜èº«ä»½è¿›è¡Œåç»­æ“ä½œã€‚
3.  **ä»»æ„æ–‡ä»¶å†™å…¥/ä»£ç æ‰§è¡Œ:** ç»“åˆå…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„ä»£ç å†™å…¥ Exchange æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆæ‰§è¡Œä»»æ„ä»£ç ã€‚

 è¯¥æ¼æ´å·²ç»è¢« CISA åŠ å…¥åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½• (KEV)ï¼Œè¡¨æ˜å…¶åœ¨é‡å¤–è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [praetorian-inc/proxylogon-exploit](https://github.com/praetorian-inc/proxylogon-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #19

**æ¥æº**: [CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md](../2021/CVE-2021-26855-r0xdeadbeef_CVE-2021-26855.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨æœªå®‰è£…ç›¸å…³å®‰å…¨æ›´æ–°ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè®¿é—®ExchangeæœåŠ¡å™¨çš„443ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶å‘é€ä»»æ„ HTTP è¯·æ±‚ï¼Œæœ€ç»ˆé€šè¿‡ä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚ CVE-2021-27065ï¼‰ç»“åˆï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855)ï¼š** åˆ©ç”¨ Autodiscover åè®®çš„ç¼ºé™·ï¼Œå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Exchange æœåŠ¡å™¨ã€‚ç”±äºæœåŠ¡å™¨ä¿¡ä»»æ¥è‡ªè‡ªèº«çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ è¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **è·å– LegacyDNï¼š** é€šè¿‡ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚ LegacyDN æ˜¯ Exchange æœåŠ¡å™¨ä¸­ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
3.  **ä¼ªé€  MAPI è¯·æ±‚ï¼š**  ä½¿ç”¨è·å–çš„ LegacyDNï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„ MAPI (Messaging Application Programming Interface) è¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€åˆ° Exchange æœåŠ¡å™¨ã€‚
4.  **å†™å…¥ Web Shell (CVE-2021-27065):** æ”»å‡»è€…åˆ©ç”¨åç«¯ç»„ä»¶çš„æ¼æ´å°†webshellå†™å…¥æœåŠ¡å™¨ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æˆåŠŸå†™å…¥webshellåï¼Œå³å¯é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ§åˆ¶ExchangeæœåŠ¡å™¨ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2021-26855 æ˜¯ä¸€ä¸ªç»è¿‡å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„ PoC ä»£ç ã€‚æä¾›çš„ PoC ä»£ç å°è¯•æ¨¡æ‹Ÿ ProxyLogon æ¼æ´é“¾çš„åˆ©ç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ SSRFã€è·å– LegacyDNã€ä¼ªé€  MAPI è¯·æ±‚å’Œå†™å…¥ Web Shellã€‚æ ¹æ®PoCä»£ç å’Œæœç´¢ç»“æœçš„æè¿°ï¼Œæ­¤POCä»£ç å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œä½†æ˜¯éœ€è¦å’Œå…¶å®ƒæ¼æ´é…åˆåˆ©ç”¨ï¼Œæ‰èƒ½è¾¾æˆRCEã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

PoC ä»£ç æœ¬èº«ä¸»è¦åŠŸèƒ½æ˜¯è¿›è¡Œæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œç›´æ¥æ¤å…¥æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒä½ã€‚ ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **æ¶æ„ä»£ç æ··æ·†ï¼š** æ”»å‡»è€…å¯èƒ½å°†æ¶æ„ä»£ç éšè—åœ¨çœ‹ä¼¼æ— å®³çš„å­—ç¬¦ä¸²æˆ–å‡½æ•°ä¸­ã€‚
*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå¤–éƒ¨åº“æˆ–æ¨¡å—ï¼Œå¦‚æœè¿™äº›ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºæä¾›çš„ä»£ç ï¼Œç»è¿‡åˆ†æï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†æ˜¯ä»ç„¶ä¸èƒ½æ’é™¤ã€‚è¯¥ä»£ç å°è¯•åˆ©ç”¨æ¼æ´ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æ˜¯é€šè¿‡å†™å…¥webshellå®ç°çš„ï¼Œå¢åŠ webshellå†™å…¥ä½ç½®çš„éšæœºæ€§æœ‰å¯èƒ½è¢«ç”¨äºé€ƒé¿æ£€æµ‹ï¼Œå› æ­¤æœ‰ä¸€å®šçš„æ¦‚ç‡(10%)è¢«ç”¨äºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [r0xdeadbeef/CVE-2021-26855](https://github.com/r0xdeadbeef/CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #20

**æ¥æº**: [CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md](../2021/CVE-2021-26855-shacojx_CVE-2021-26855-exploit-Exchange.md)

## CVE-2021-26855 Microsoft Exchange Server è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆProxyLogonï¼‰

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„Exchange Server 2013, 2016, 2019 Cumulative Updates

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—® Exchange Server çš„ OWA æ¥å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œæ˜¯ ProxyLogon æ”»å‡»é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä½œä¸º Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä»æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åº“ä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå­˜åœ¨å…¬å¼€çš„PoCï¼Œå¹¶ä¸”è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨ SSRF æ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  **æ„é€ è¯·æ±‚:** æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªåŒ…å«ç‰¹å®š Cookie çš„ GET è¯·æ±‚ï¼Œåˆ©ç”¨ SSRF æ¼æ´ã€‚
3.  **NTLM è®¤è¯:** ä½¿ç”¨ NTLM è®¤è¯ç»•è¿‡ã€‚
4.  **è·å– FQDN:** é€šè¿‡ NTLM type2 åè®®è·å–æœåŠ¡å™¨çš„ FQDN (Fully Qualified Domain Name)ã€‚
5.  **å‘é€æ¶æ„ XML:** æ„é€ æ¶æ„çš„ XML æ•°æ®ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€åˆ° Exchange Web Services (EWS) ç«¯ç‚¹ï¼Œåˆ©ç”¨åç«¯ç»„ä»¶å¤„ç† XML æ—¶å­˜åœ¨çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚  
6.  **ç”¨æˆ·æšä¸¾:**  PoC ä»£ç è¿˜åŒ…å«ç”¨æˆ·æšä¸¾çš„åŠŸèƒ½ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Go ä»£ç æ˜¯ä¸€ä¸ªå¯ç”¨çš„ PoCã€‚å®ƒåŒ…å«äº†æ¼æ´éªŒè¯ã€NTLM è®¤è¯å’Œå‘é€æ¶æ„ XML æ•°æ®çš„æ­¥éª¤ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘å®Œæ•´ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶ä»£ç çœ‹èµ·æ¥ä¸»è¦å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ï¼Œä½†ä»å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ï¼š
* ç”¨æˆ·æšä¸¾æ¨¡å—å¯èƒ½è¢«æ»¥ç”¨ï¼Œç”¨äºéæ³•æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€‚
* ä»£ç ä¸­å­˜åœ¨ä¸€äº›ç¡¬ç¼–ç çš„å‚æ•°å’Œè·¯å¾„ï¼Œå¯èƒ½åœ¨ç‰¹å®šç¯å¢ƒä¸‹ä¸å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨è€…ä¿®æ”¹ï¼Œå¯èƒ½å­˜åœ¨è¢«è¯±å¯¼ä¿®æ”¹æ¶æ„ä»£ç ã€‚
* é£é™©è¯„ä¼°ä¸º 10%ï¼Œå› ä¸ºä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨ï¼Œè€Œéæ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯å­˜åœ¨è¢«æ»¥ç”¨å’Œä¿®æ”¹çš„æ½œåœ¨é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [shacojx/CVE-2021-26855-exploit-Exchange](https://github.com/shacojx/CVE-2021-26855-exploit-Exchange)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #21

**æ¥æº**: [CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md](../2021/CVE-2021-26855-shacojx_Scan-Vuln-CVE-2021-26855.md)

## CVE-2021-26855 - Microsoft Exchange Server SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®Exchange Serverçš„ç«¯å£ï¼Œé€šå¸¸æ˜¯443ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ Microsoft Exchange Server ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶ä»¥ Exchange æœåŠ¡å™¨çš„èº«ä»½è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç åˆ¤æ–­ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚å¤§é‡çš„ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ã€è¢«å¹¿æ³›åˆ©ç”¨çš„æ¼æ´ï¼Œå¹¶ä¸”CISAå·²çŸ¥å¯åˆ©ç”¨æ¼æ´ç›®å½•ä¸­åŒ…å«äº†æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æ£€è§†æä¾›çš„ä»£ç ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š
1.  `README.md`: åŒ…å«æ¼æ´æè¿°å’Œå›¾ç‰‡ã€‚
2.  `build.xml`: Antæ„å»ºè„šæœ¬ï¼Œç”¨äºç¼–è¯‘Javaé¡¹ç›®ã€‚
3.  `ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºå­˜å‚¨æ˜“å—æ”»å‡»çš„IPåœ°å€åˆ—è¡¨ã€‚
4.  `list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æã€‚
5.  `manifest.mf`: JARæ–‡ä»¶çš„æ¸…å•æ–‡ä»¶ã€‚
6.  `Tool-Build/Run.bat`: ç”¨äºè¿è¡Œç¼–è¯‘åçš„JARæ–‡ä»¶çš„æ‰¹å¤„ç†è„šæœ¬ã€‚
7.  `Tool-Build/ipVuln.txt`: ç©ºæ–‡ä»¶ï¼Œä¸ä¸Šé¢çš„`ipVuln.txt`ç›¸åŒã€‚
8.  `Tool-Build/list-ip.txt`: åŒ…å«ä¸€ä¸ªIPåœ°å€ï¼ˆ`192.168.1.0`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ‰«æï¼Œä¸ä¸Šé¢çš„`list-ip.txt`ç›¸åŒã€‚
9.  `Tool-Build/Nmap/scripts/http-vuln-cve2021-26855.nse`: Nmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å—CVE-2021-26855æ¼æ´å½±å“ã€‚è¿™ä¸ªè„šæœ¬æ˜¯æ¼æ´æ£€æµ‹çš„æ ¸å¿ƒã€‚

ä¸»è¦é£é™©ç‚¹åœ¨äº`build.xml`æ„å»ºè„šæœ¬å’Œ`http-vuln-cve2021-26855.nse`è¿™ä¸ªNmapè„šæœ¬ã€‚æ„å»ºè„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä»¥åŒ…å«æ¶æ„ä»£ç ï¼Œè™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤éšè”½çš„åé—¨ä»£ç å­˜åœ¨çš„å¯èƒ½æ€§ã€‚Nmapè„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´æ£€æµ‹è„šæœ¬ï¼Œä½†ç†è®ºä¸Šï¼Œå¦‚æœè„šæœ¬è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´æ—¶ï¼Œæ¤å…¥åé—¨æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚
æ€»ä½“è¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ï¼Œå› ä¸ºä¸»è¦çš„ä»£ç åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œè€Œä¸æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä¸”ä»£ç é‡ä¸å¤§ï¼Œå®¹æ˜“å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  **SSRF:** æ”»å‡»è€…åˆ©ç”¨SSRFæ¼æ´å‘ExchangeæœåŠ¡å™¨å‘é€ç²¾å¿ƒæ„é€ çš„HTTPè¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ¨¡æ‹ŸExchangeæœåŠ¡å™¨ä¸Šçš„å…¶ä»–ç”¨æˆ·ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** åœ¨æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨å…¶ä»–æ¼æ´ï¼ˆå¦‚ä¸å®‰å…¨çš„deserializationï¼‰æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼ŒCVE-2021-26855æ˜¯ProxyLogonæ”»å‡»é“¾çš„åˆå§‹æ¼æ´ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´çš„æœ‰æ•ˆæ€§é«˜ï¼Œåˆ©ç”¨æ–¹å¼è¾ƒä¸ºæ˜ç¡®ï¼Œä½†æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ‰«æè€Œéç›´æ¥åˆ©ç”¨ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡SSRFæ¼æ´ç»•è¿‡èº«ä»½éªŒè¯ï¼Œç„¶ååˆ©ç”¨å…¶ä»–æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [shacojx/Scan-Vuln-CVE-2021-26855](https://github.com/shacojx/Scan-Vuln-CVE-2021-26855)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #22

**æ¥æº**: [CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md](../2021/CVE-2021-26855-ssrsec_Microsoft-Exchange-RCE.md)

## CVE-2021-26855 & CVE-2021-27065 - Microsoft Exchange Server RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ Exchange æœåŠ¡å™¨çš„ç½‘ç»œç«¯å£ (é€šå¸¸æ˜¯443)ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´åˆ©ç”¨é“¾åŒ…æ‹¬ CVE-2021-26855 (SSRF) å’Œ CVE-2021-27065 (ä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´RCE)ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** åˆ©ç”¨æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä»»æ„HTTPè¯·æ±‚å¹¶ä¼ªè£…æˆExchangeæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚POCä»£ç é¦–å…ˆå‘é€ä¸€ä¸ªNTLMåå•†è¯·æ±‚åˆ°`/rpc/`ç«¯ç‚¹ï¼Œåˆ©ç”¨è¿”å›çš„`WWW-Authenticate`å¤´ä¸­çš„ä¿¡æ¯æ¥è·å–ç›®æ ‡ExchangeæœåŠ¡å™¨çš„è®¡ç®—æœºåå’ŒåŸŸåã€‚
2.  **RCE (CVE-2021-27065):** åˆ©ç”¨è·å–çš„è®¡ç®—æœºåï¼Œç»“åˆä¸€ä¸ªå·²çŸ¥çš„é‚®ç®±åœ°å€æ ¼å¼ï¼Œæ„é€ ä¸€ä¸ªåŒ…å«`LegacyDN`çš„è¯·æ±‚ï¼Œå‘é€åˆ°`/ecp/baba.js`ï¼Œæœ€ç»ˆé€šè¿‡å†™å…¥webshellæ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ`baba.js`æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œä¸Šä¼ ä»»æ„çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ˜¯å…¬å¼€çš„ï¼Œå½±å“èŒƒå›´å¹¿æ³›ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´ï¼Œä½†å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

*   **Webshell å†…å®¹ï¼š** Webshellçš„å†…å®¹ï¼ˆ`<script language="JScript" runat="server">function Page_Load(){eval(Request["babanb"],"unsafe");}</script>`ï¼‰æ˜¯å›ºå®šçš„ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹è¿™ä¸ªå†…å®¹ï¼Œæ¤å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…æ¤å…¥æ›´åŠ éšè”½çš„åé—¨ã€‚ç›®å‰æ˜¯ç›´æ¥åœ¨ecpç›®å½•ä¸‹å†™äº†baba.jsçš„æ–‡ä»¶,æ¯”è¾ƒå®¹æ˜“è¢«å‘ç°ã€‚
*   **ä¾èµ–é¡¹é£é™©ï¼š**è™½ç„¶ä»£ç é‡å°‘ï¼Œä½†ä»ç„¶å¯èƒ½å¼•å…¥æœ‰å®‰å…¨é£é™©çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè™½ç„¶è¿™é‡Œæ²¡æœ‰ä½“ç°ã€‚
*  **é‚®ä»¶ç”¨æˆ·åˆ—è¡¨:** ä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·åˆ—è¡¨è¿›è¡Œå°è¯•ã€‚è¿™ä¸ªåˆ—è¡¨å¯èƒ½è¢«ä¿®æ”¹ï¼Œç”¨äºé’ˆå¯¹ç‰¹å®šç›®æ ‡è¿›è¡Œæ”»å‡»ï¼Œæˆ–è€…ç”¨äºæœé›†æ•æ„Ÿä¿¡æ¯ã€‚

è™½ç„¶å­˜åœ¨é£é™©ï¼Œä½†æ•´ä½“ä»£ç é€»è¾‘è¾ƒä¸ºæ¸…æ™°ï¼Œé£é™©è¾ƒä½ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [ssrsec/Microsoft-Exchange-RCE](https://github.com/ssrsec/Microsoft-Exchange-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #23

**æ¥æº**: [CVE-2021-26855-thau0x01_poc_proxylogon.md](../2021/CVE-2021-26855-thau0x01_poc_proxylogon.md)

## CVE-2021-26855 Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ï¼šMicrosoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Exchange Serverå¼€æ”¾443ç«¯å£ï¼Œä¸”æœªå®‰è£…ç›¸å…³å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2021-26855 (ProxyLogon) æ˜¯ä¸€ç§å­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç²¾å¿ƒæ„é€ çš„ HTTP è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œèƒ½å¤Ÿä¼ªé€ èº«ä»½å¹¶æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œè¯¥æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ã€‚æä¾›çš„PoCä»£ç å±•ç¤ºäº†åˆ©ç”¨è¯¥æ¼æ´è·å–è¿œç¨‹ä»£ç æ‰§è¡Œæƒé™çš„è¿‡ç¨‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF (CVE-2021-26855):** é¦–å…ˆï¼Œåˆ©ç”¨SSRFæ¼æ´å‘é€ä»»æ„HTTPè¯·æ±‚ï¼Œç›®çš„æ˜¯ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè·å–æœ‰æ•ˆçš„LegacyDNã€‚
2.  **è·å– LegacyDN:** é€šè¿‡æ„é€ Autodiscoverè¯·æ±‚ï¼Œè·å–ç›®æ ‡ç”¨æˆ·çš„ LegacyDNã€‚
3.  **MAPI è¿æ¥:** ä½¿ç”¨è·å–çš„LegacyDNå»ºç«‹ä¸€ä¸ªMAPIä¼šè¯ã€‚
4.  **è·å– SID:** ä»MAPIå“åº”ä¸­æå–ç”¨æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦ (SID)ã€‚
5.  **ProxyLogon:** åˆ©ç”¨ProxyLogonæœºåˆ¶ï¼Œå°†ç”¨æˆ·SIDä¿®æ”¹ä¸ºç®¡ç†å‘˜SIDï¼Œä»è€Œæå‡æƒé™ã€‚
6.  **å†™å…¥ Webshell:** åˆ©ç”¨æå‡çš„æƒé™ï¼Œå‘æœåŠ¡å™¨å†™å…¥webshellï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ä»£ç ä¸­å­˜åœ¨ä»¥ä¸‹æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

*   **ç¡¬ç¼–ç çš„è·¯å¾„å’Œæ–‡ä»¶åï¼š** `shell_path`å’Œ`shell_absolute_path`ä»¥åŠ`ahihi7.aspx`æ˜¯ç¡¬ç¼–ç çš„ï¼Œè¿™ä½¿å¾—webshellå®¹æ˜“è¢«æ£€æµ‹å’Œç§»é™¤ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è¿™äº›å€¼ï¼Œå¯èƒ½ä¼šå°†webshellå†™å…¥åˆ°æ›´éšè”½çš„ä½ç½®ã€‚
*   **webshell å†…å®¹ï¼š** `shell_content`åŒ…å«æ‰§è¡Œ `whoami` å‘½ä»¤çš„JavaScriptä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•å‘½ä»¤ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹`shell_content`ä»¥æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚è™½ç„¶å½“å‰ä»£ç åªæ˜¯æ‰§è¡Œ`whoami`ï¼Œä½†ä¸èƒ½æ’é™¤æ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥`shell_content`çš„å¯èƒ½æ€§ã€‚è¿™ä¸€éƒ¨åˆ†å­˜åœ¨è¢«æ¶æ„ä¿®æ”¹è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§ã€‚
*   **ä»£ç†URI (`msExchProxyUri`)**: PoCä»£ç ä¸­ `msExchProxyUri` è®¾ç½®ä¸º`http://127.0.0.1:8080/`ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯èƒ½å°è¯•é€šè¿‡æœ¬åœ°ä»£ç†è¿›è¡Œå…¶ä»–æ”»å‡»ï¼Œæˆ–è€…å°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ã€‚è™½ç„¶ç°åœ¨æŒ‡å‘æœ¬åœ°ï¼Œä½†å­˜åœ¨è¢«ä¿®æ”¹æŒ‡å‘æ¶æ„åœ°å€çš„å¯èƒ½æ€§ã€‚

è™½ç„¶è¿™äº›é£é™©å­˜åœ¨ï¼Œä½†æ•´ä½“ä»£ç çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†RCEï¼Œæ²¡æœ‰æ˜æ˜¾çš„éšè—åé—¨æˆ–è€…å…¶ä»–æ¶æ„è¡Œä¸ºã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½, çº¦5%ã€‚

**é¡¹ç›®åœ°å€:** [thau0x01/poc_proxylogon](https://github.com/thau0x01/poc_proxylogon)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #24

**æ¥æº**: [CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md](../2021/CVE-2021-26855-timb-machine-mirrors_testanull-CVE-2021-26855_read_poc.txt.md)

## CVE-2021-26855-Microsoft Exchange Server-SSRF

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæœªç»éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶æ¨¡æ‹Ÿ Exchange æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚æä¾›çš„POCä»£ç å°è¯•é€šè¿‡ `POST /ecp/poc-2021-26855.js HTTP/1.1` å‘é€ SOAP è¯·æ±‚ï¼Œé€šè¿‡ä¿®æ”¹ `X-BEResource` cookie ç»•è¿‡èº«ä»½éªŒè¯ï¼Œè¿›è€Œæ‰§è¡Œå…¶ä»–æ“ä½œã€‚ç”±äºè¯·æ±‚çš„ç›®æ ‡æ˜¯ EWS (Exchange Web Services)ï¼Œè¿™å…è®¸æ”»å‡»è€…è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ã€‚åˆ†æä»£ç ä¸­,æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **SSRF æ”»å‡»ï¼š** åˆ©ç”¨ CVE-2021-26855ï¼Œæ”»å‡»è€…å¯ä»¥å‘ Exchange æœåŠ¡å™¨å‘é€ä¼ªé€ çš„ HTTP è¯·æ±‚ã€‚
2.  **èº«ä»½éªŒè¯ç»•è¿‡ï¼š** é€šè¿‡æ“çºµ `X-BEResource` cookieï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå†’å……åˆæ³•ç”¨æˆ·ã€‚
3.  **é‚®ç®±è®¿é—®ï¼š** ä¸€æ—¦æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ EWS æ¥å£è®¿é—®å’Œæ“ä½œé‚®ç®±æ•°æ®ï¼Œä¾‹å¦‚è¯»å–é‚®ä»¶ã€è”ç³»äººç­‰ã€‚
4.  **é“¾å¼åˆ©ç”¨ï¼š** CVE-2021-26855 é€šå¸¸ä¸å…¶ä»– Exchange æ¼æ´ï¼ˆå¦‚ CVE-2021-26857ã€CVE-2021-26858ã€CVE-2021-27065ï¼‰ç»“åˆä½¿ç”¨ï¼Œå½¢æˆ ProxyLogon æ”»å‡»é“¾ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt](https://github.com/timb-machine-mirrors/testanull-CVE-2021-26855_read_poc.txt)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

## POC #25

**æ¥æº**: [CVE-2021-26855-yaoxiaoangry3_Flangvik.md](../2021/CVE-2021-26855-yaoxiaoangry3_Flangvik.md)

## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**æ¼æ´ç¼–å·:** CVE-2021-26855

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft Exchange Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Microsoft Exchange Server 2013ã€2016 å’Œ 2019 çš„å¤šä¸ªç´¯ç§¯æ›´æ–°ç‰ˆæœ¬ï¼Œå…·ä½“ç‰ˆæœ¬å‚è§æ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ExchangeæœåŠ¡å™¨å­˜åœ¨æ¼æ´ä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2021-26855 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Exchange Server ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) æ¼æ´ï¼Œå±äº ProxyLogon æ¼æ´é“¾çš„ä¸€éƒ¨åˆ†ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å‘é€ä»»æ„ HTTP è¯·æ±‚å¹¶å¯èƒ½ç»•è¿‡èº«ä»½éªŒè¯ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Microsoft Exchange Serverï¼ŒCVSS è¯„åˆ†ä¸º 9.1ï¼Œè¡¨æ˜å…¶ä¸¥é‡æ€§ã€‚
æœç´¢ç»“æœæ˜¾ç¤ºï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„ PoC å¯ç”¨ï¼Œå‚è€ƒç½‘é¡µæ ‡é¢˜åŒ…å«"ProxyLogon"çš„ç½‘é¡µä¿¡æ¯å¯ä»¥çŸ¥é“ã€‚
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª C# PoCï¼Œæ”¯æŒåŠäº¤äº’å¼çš„ web shell ä»¥åŠ shellcode æ‰§è¡Œã€‚
ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/e24bb8b01b99c84300e1ac6fb58f9709/README.md` åªæ˜¾ç¤ºäº†å…³äº PoC çš„ç®€çŸ­æè¿°ï¼Œæ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ç”±äºæ˜¯ C# PoCï¼ŒæŠ•æ¯’ä»£ç å¯èƒ½éšè—åœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä»…ä»…é€šè¿‡ README.md æ–‡ä»¶åˆ¤æ–­ï¼Œå­˜åœ¨è¯¯åˆ¤å¯èƒ½æ€§ï¼Œä½†æ˜¯æ ¹æ®ä»¥å¾€ç»éªŒï¼Œå¼€æºç¤¾åŒºå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’è¡Œä¸ºï¼Œå› æ­¤ç»™å‡ºä¸€å®šç™¾åˆ†æ¯”ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æï¼š**
1.  åˆ©ç”¨ CVE-2021-26855 çš„ SSRF æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚
2.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨åç»­æ¼æ´ï¼ˆä¾‹å¦‚ CVE-2021-26857ï¼‰å†™å…¥ä»»æ„æ–‡ä»¶ã€‚
3.  å†™å…¥çš„æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ª ASPX web shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
4.  æˆ–è€…ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ shellcode ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
è¯¥æ¼æ´æ˜¯ ProxyLogon æ”»å‡»é“¾çš„åˆå§‹å…¥å£ç‚¹ï¼Œä¸ºåç»­æ”»å‡»é“ºå¹³é“è·¯ã€‚

**é¡¹ç›®åœ°å€:** [yaoxiaoangry3/Flangvik](https://github.com/yaoxiaoangry3/Flangvik)

**æ¼æ´è¯¦æƒ…:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)

---

