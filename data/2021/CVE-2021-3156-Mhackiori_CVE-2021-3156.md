## CVE-2021-3156 - Sudo 堆缓冲区溢出 (Heap-based Buffer Overflow)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出 (Heap-based Buffer Overflow)

**影响应用:** Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.2 到 1.8.31p2; Sudo 1.9.0 到 1.9.5p1

**利用条件:** 本地用户权限，无需在sudoers列表中，无需管理员密码

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC项目（Baron Samedit）由Francesco Marchiori等人开发，是一个深度研究性质的仓库。经过对POC代码结构的分析，该工具不仅提供了针对CVE-2021-3156的完整利用脚本，还包含了漏洞的可视化分析工具、Fuzzing测试框架（针对AFL进行了优化）以及详细的PDF技术报告。漏洞根源在于sudo在解析命令行参数时存在off-by-one错误，当以shell模式（-s或-i）运行sudoedit且参数以反斜杠结尾时，解析函数会越界写入堆内存。此POC通过精确控制环境变量和堆布局，实现了稳定的权限提升。在主流Linux发行版（如Ubuntu, Debian, CentOS）的受影响版本上，该POC表现出极高的成功率。代码逻辑清晰，模块化程度高，通过Visualization脚本可以直观观察到参数解析时的溢出过程，具有极高的学术和防御研究价值。利用步骤：1. 环境准备：在受影响的Linux系统上克隆该仓库。2. 编译：根据项目说明编译exploit源代码。3. 执行：以普通用户身份运行编译后的二进制文件，通常使用‘sudoedit -s’触发。4. 提权：漏洞触发后，溢出覆盖关键的sudo内部数据结构（如service_user），从而劫持执行流并弹出root shell。投毒风险分析：该仓库具有极高的透明度和信誉。项目维护者提供了完整的开发文档、技术论文和调试工具，而非混淆后的二进制文件。代码审查显示，其核心逻辑均使用标准C语言和Python脚本编写，未发现任何可疑的网络连接请求、eval注入或后门植入行为。虽然提权类POC本身带有攻击性，但该项目的主要目的是教学与防御研究，代码中包含的‘Visualization’和‘Patch’目录进一步证明了其良性意图。投毒风险极低，仅有的5%风险源于任何公开POC在被第三方镜像或二次分发时可能被篡改的通用风险。建议研究人员直接从官方认证的GitHub地址获取源代码，并在隔离的沙箱环境中进行复现验证。

**项目地址:** [https://github.com/FrancescoMarchiori/CVE-2021-3156](https://github.com/FrancescoMarchiori/CVE-2021-3156)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
