# CVE-2021-21239

> 📦 该CVE有 **3** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21239-GrantBirki_redash-vulnerable.md](../2021/CVE-2021-21239-GrantBirki_redash-vulnerable.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份认证绕过，进而未授权访问

**影响版本:** < 6.5.0

**利用条件:** 目标系统使用pysaml2作为SAML认证库，并且使用默认的CryptoBackendXmlSec1后端。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21239是pysaml2中的一个签名验证漏洞。攻击者可以通过构造恶意的SAML响应，利用xmlsec1默认接受任意类型密钥的特性，嵌入RSA密钥并绕过签名验证。  

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断此漏洞是有效的。漏洞库信息明确指出pysaml2 < 6.5.0 存在签名验证问题，且有公开的PoC可以利用。

**利用方式：**
PoC代码 `poc.py` 展示了如何构造恶意的SAML响应。其利用方式为：
1.  生成一个用于伪造签名使用的RSA密钥对。
2.  构造一个包含恶意断言（Assertion）的SAML响应，将攻击者的公钥嵌入到`KeyInfo`标签的`KeyValue`中，而非使用X.509证书。
3.  由于`xmlsec1`默认接受嵌入的RSA密钥，因此在服务端验证签名时，会使用攻击者提供的公钥进行验证，从而绕过正常的证书验证。
4.  将构造的SAML响应发送到目标Redash服务器的SAML回调地址，实现身份认证绕过。

**投毒风险：**
虽然提供的`docker-compose.yml` 和 `README.md`文件可能包含配置相关的信息，帮助搭建漏洞环境，但是核心的攻击代码在`poc.py`中。 检查`poc.py`，发现其主要逻辑是构造恶意的SAML响应以利用漏洞。代码本身没有明显的后门或恶意行为。`docker-compose.yml`中使用的是redash/redash:10.0.0.b50363这个镜像，这是一个公开的Redash镜像，降低了投毒的可能。但是，仍然存在一定的投毒风险，例如：
1.  作者可能在`script/server`脚本中添加了恶意代码。
2.  docker-compose.yml文件中指定的redash镜像可能被篡改。

考虑到redash镜像的公开性和poc.py代码的相对简单性，以及脚本文件中可能存在的隐蔽风险，因此投毒风险较低，估计为10%。

**项目地址:** [GrantBirki/redash-vulnerable](https://github.com/GrantBirki/redash-vulnerable)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #2

**来源**: [CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md](../2021/CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份伪造和权限提升

**影响版本:** < 6.5.0

**利用条件:** 依赖于pysaml2的SAML认证流程，且使用默认的CryptoBackendXmlSec1后端

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2021-21239是pysaml2库中存在的一个签名绕过漏洞。该漏洞源于pysaml2在版本6.5.0之前的版本中，使用默认的CryptoBackendXmlSec1后端时，对SAML文档的签名验证不严格。具体来说，`xmlsec1`工具默认接受多种类型的密钥，而没有强制要求必须是X.509证书。攻击者可以利用这一点，在SAML文档中使用非X.509证书的密钥进行签名，从而绕过签名验证，冒充任意用户。

**有效性：**
提供的POC代码尝试通过以下步骤利用此漏洞：
1.  解析截获的SAML XML文档。
2.  替换文档中的用户名和邮箱信息。
3.  使用一个空的签名块替换原始签名块.
4.  使用 `openssl` 生成新的密钥和证书，然后使用 `xmlsec1` 对修改后的SAML文档进行签名。
由于漏洞在于对密钥类型的验证不足，利用者通过修改SAML文档内容，并使用新的密钥重新签名，可能使pysaml2在旧版本中绕过验证，从而使攻击者成功伪造身份。此POC **有效**。

**投毒风险：**
检查POC代码后，并未发现明显的恶意投毒代码。代码主要集中在XML解析、字符串替换和签名操作。生成密钥对和使用xmlsec1签名是漏洞利用的正常步骤。

但是以下几点需要注意：

*   `subprocess.run(xmlsec_command, shell=True)`: 使用 `shell=True` 存在命令注入的风险。虽然在这个上下文中，命令是由脚本自身构造的，但如果输入的文件名或者用户输入包含恶意字符，仍然可能被利用。但这个风险很小，因为它依赖于攻击者首先控制输入文件或用户输入。

综合评估，投毒风险较低，约为2%。

**利用方式：**
1.  **截获SAML请求：** 攻击者首先需要截获目标用户发送的SAML认证请求。
2.  **修改SAML断言：** 使用提供的POC代码，攻击者可以修改SAML断言中的用户信息（例如用户名、邮箱等）。
3.  **替换签名：**  利用漏洞，移除原始签名，插入一个空的签名快。
4.  **重新签名SAML断言：** 生成新的密钥对，并使用`xmlsec1`工具使用新的密钥对修改后的SAML断言进行签名。
5.  **发送伪造的SAML请求：** 攻击者将重新签名后的SAML请求发送给服务提供商。
6.  **绕过验证，身份伪造：** 由于服务提供商使用的pysaml2版本存在漏洞，且没有强制验证密钥类型，攻击者可以成功绕过签名验证，冒充被篡改用户信息的对应用户。


**项目地址:** [RyanBoomer30/CVE-2021-21239-Exploit](https://github.com/RyanBoomer30/CVE-2021-21239-Exploit)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #3

**来源**: [CVE-2021-21239-illera88_CVE-2021-21239.md](../2021/CVE-2021-21239-illera88_CVE-2021-21239.md)

# CVE-2021-21239

> 📦 该CVE有 **3** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21239-GrantBirki_redash-vulnerable.md](../2021/CVE-2021-21239-GrantBirki_redash-vulnerable.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份认证绕过，进而未授权访问

**影响版本:** < 6.5.0

**利用条件:** 目标系统使用pysaml2作为SAML认证库，并且使用默认的CryptoBackendXmlSec1后端。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21239是pysaml2中的一个签名验证漏洞。攻击者可以通过构造恶意的SAML响应，利用xmlsec1默认接受任意类型密钥的特性，嵌入RSA密钥并绕过签名验证。  

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断此漏洞是有效的。漏洞库信息明确指出pysaml2 < 6.5.0 存在签名验证问题，且有公开的PoC可以利用。

**利用方式：**
PoC代码 `poc.py` 展示了如何构造恶意的SAML响应。其利用方式为：
1.  生成一个用于伪造签名使用的RSA密钥对。
2.  构造一个包含恶意断言（Assertion）的SAML响应，将攻击者的公钥嵌入到`KeyInfo`标签的`KeyValue`中，而非使用X.509证书。
3.  由于`xmlsec1`默认接受嵌入的RSA密钥，因此在服务端验证签名时，会使用攻击者提供的公钥进行验证，从而绕过正常的证书验证。
4.  将构造的SAML响应发送到目标Redash服务器的SAML回调地址，实现身份认证绕过。

**投毒风险：**
虽然提供的`docker-compose.yml` 和 `README.md`文件可能包含配置相关的信息，帮助搭建漏洞环境，但是核心的攻击代码在`poc.py`中。 检查`poc.py`，发现其主要逻辑是构造恶意的SAML响应以利用漏洞。代码本身没有明显的后门或恶意行为。`docker-compose.yml`中使用的是redash/redash:10.0.0.b50363这个镜像，这是一个公开的Redash镜像，降低了投毒的可能。但是，仍然存在一定的投毒风险，例如：
1.  作者可能在`script/server`脚本中添加了恶意代码。
2.  docker-compose.yml文件中指定的redash镜像可能被篡改。

考虑到redash镜像的公开性和poc.py代码的相对简单性，以及脚本文件中可能存在的隐蔽风险，因此投毒风险较低，估计为10%。

**项目地址:** [GrantBirki/redash-vulnerable](https://github.com/GrantBirki/redash-vulnerable)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #2

**来源**: [CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md](../2021/CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份伪造和权限提升

**影响版本:** < 6.5.0

**利用条件:** 依赖于pysaml2的SAML认证流程，且使用默认的CryptoBackendXmlSec1后端

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2021-21239是pysaml2库中存在的一个签名绕过漏洞。该漏洞源于pysaml2在版本6.5.0之前的版本中，使用默认的CryptoBackendXmlSec1后端时，对SAML文档的签名验证不严格。具体来说，`xmlsec1`工具默认接受多种类型的密钥，而没有强制要求必须是X.509证书。攻击者可以利用这一点，在SAML文档中使用非X.509证书的密钥进行签名，从而绕过签名验证，冒充任意用户。

**有效性：**
提供的POC代码尝试通过以下步骤利用此漏洞：
1.  解析截获的SAML XML文档。
2.  替换文档中的用户名和邮箱信息。
3.  使用一个空的签名块替换原始签名块.
4.  使用 `openssl` 生成新的密钥和证书，然后使用 `xmlsec1` 对修改后的SAML文档进行签名。
由于漏洞在于对密钥类型的验证不足，利用者通过修改SAML文档内容，并使用新的密钥重新签名，可能使pysaml2在旧版本中绕过验证，从而使攻击者成功伪造身份。此POC **有效**。

**投毒风险：**
检查POC代码后，并未发现明显的恶意投毒代码。代码主要集中在XML解析、字符串替换和签名操作。生成密钥对和使用xmlsec1签名是漏洞利用的正常步骤。

但是以下几点需要注意：

*   `subprocess.run(xmlsec_command, shell=True)`: 使用 `shell=True` 存在命令注入的风险。虽然在这个上下文中，命令是由脚本自身构造的，但如果输入的文件名或者用户输入包含恶意字符，仍然可能被利用。但这个风险很小，因为它依赖于攻击者首先控制输入文件或用户输入。

综合评估，投毒风险较低，约为2%。

**利用方式：**
1.  **截获SAML请求：** 攻击者首先需要截获目标用户发送的SAML认证请求。
2.  **修改SAML断言：** 使用提供的POC代码，攻击者可以修改SAML断言中的用户信息（例如用户名、邮箱等）。
3.  **替换签名：**  利用漏洞，移除原始签名，插入一个空的签名快。
4.  **重新签名SAML断言：** 生成新的密钥对，并使用`xmlsec1`工具使用新的密钥对修改后的SAML断言进行签名。
5.  **发送伪造的SAML请求：** 攻击者将重新签名后的SAML请求发送给服务提供商。
6.  **绕过验证，身份伪造：** 由于服务提供商使用的pysaml2版本存在漏洞，且没有强制验证密钥类型，攻击者可以成功绕过签名验证，冒充被篡改用户信息的对应用户。


**项目地址:** [RyanBoomer30/CVE-2021-21239-Exploit](https://github.com/RyanBoomer30/CVE-2021-21239-Exploit)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #3

**来源**: [CVE-2021-21239-illera88_CVE-2021-21239.md](../2021/CVE-2021-21239-illera88_CVE-2021-21239.md)

# CVE-2021-21239

> 📦 该CVE有 **3** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21239-GrantBirki_redash-vulnerable.md](../2021/CVE-2021-21239-GrantBirki_redash-vulnerable.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份认证绕过，进而未授权访问

**影响版本:** < 6.5.0

**利用条件:** 目标系统使用pysaml2作为SAML认证库，并且使用默认的CryptoBackendXmlSec1后端。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21239是pysaml2中的一个签名验证漏洞。攻击者可以通过构造恶意的SAML响应，利用xmlsec1默认接受任意类型密钥的特性，嵌入RSA密钥并绕过签名验证。  

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断此漏洞是有效的。漏洞库信息明确指出pysaml2 < 6.5.0 存在签名验证问题，且有公开的PoC可以利用。

**利用方式：**
PoC代码 `poc.py` 展示了如何构造恶意的SAML响应。其利用方式为：
1.  生成一个用于伪造签名使用的RSA密钥对。
2.  构造一个包含恶意断言（Assertion）的SAML响应，将攻击者的公钥嵌入到`KeyInfo`标签的`KeyValue`中，而非使用X.509证书。
3.  由于`xmlsec1`默认接受嵌入的RSA密钥，因此在服务端验证签名时，会使用攻击者提供的公钥进行验证，从而绕过正常的证书验证。
4.  将构造的SAML响应发送到目标Redash服务器的SAML回调地址，实现身份认证绕过。

**投毒风险：**
虽然提供的`docker-compose.yml` 和 `README.md`文件可能包含配置相关的信息，帮助搭建漏洞环境，但是核心的攻击代码在`poc.py`中。 检查`poc.py`，发现其主要逻辑是构造恶意的SAML响应以利用漏洞。代码本身没有明显的后门或恶意行为。`docker-compose.yml`中使用的是redash/redash:10.0.0.b50363这个镜像，这是一个公开的Redash镜像，降低了投毒的可能。但是，仍然存在一定的投毒风险，例如：
1.  作者可能在`script/server`脚本中添加了恶意代码。
2.  docker-compose.yml文件中指定的redash镜像可能被篡改。

考虑到redash镜像的公开性和poc.py代码的相对简单性，以及脚本文件中可能存在的隐蔽风险，因此投毒风险较低，估计为10%。

**项目地址:** [GrantBirki/redash-vulnerable](https://github.com/GrantBirki/redash-vulnerable)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #2

**来源**: [CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md](../2021/CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份伪造和权限提升

**影响版本:** < 6.5.0

**利用条件:** 依赖于pysaml2的SAML认证流程，且使用默认的CryptoBackendXmlSec1后端

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2021-21239是pysaml2库中存在的一个签名绕过漏洞。该漏洞源于pysaml2在版本6.5.0之前的版本中，使用默认的CryptoBackendXmlSec1后端时，对SAML文档的签名验证不严格。具体来说，`xmlsec1`工具默认接受多种类型的密钥，而没有强制要求必须是X.509证书。攻击者可以利用这一点，在SAML文档中使用非X.509证书的密钥进行签名，从而绕过签名验证，冒充任意用户。

**有效性：**
提供的POC代码尝试通过以下步骤利用此漏洞：
1.  解析截获的SAML XML文档。
2.  替换文档中的用户名和邮箱信息。
3.  使用一个空的签名块替换原始签名块.
4.  使用 `openssl` 生成新的密钥和证书，然后使用 `xmlsec1` 对修改后的SAML文档进行签名。
由于漏洞在于对密钥类型的验证不足，利用者通过修改SAML文档内容，并使用新的密钥重新签名，可能使pysaml2在旧版本中绕过验证，从而使攻击者成功伪造身份。此POC **有效**。

**投毒风险：**
检查POC代码后，并未发现明显的恶意投毒代码。代码主要集中在XML解析、字符串替换和签名操作。生成密钥对和使用xmlsec1签名是漏洞利用的正常步骤。

但是以下几点需要注意：

*   `subprocess.run(xmlsec_command, shell=True)`: 使用 `shell=True` 存在命令注入的风险。虽然在这个上下文中，命令是由脚本自身构造的，但如果输入的文件名或者用户输入包含恶意字符，仍然可能被利用。但这个风险很小，因为它依赖于攻击者首先控制输入文件或用户输入。

综合评估，投毒风险较低，约为2%。

**利用方式：**
1.  **截获SAML请求：** 攻击者首先需要截获目标用户发送的SAML认证请求。
2.  **修改SAML断言：** 使用提供的POC代码，攻击者可以修改SAML断言中的用户信息（例如用户名、邮箱等）。
3.  **替换签名：**  利用漏洞，移除原始签名，插入一个空的签名快。
4.  **重新签名SAML断言：** 生成新的密钥对，并使用`xmlsec1`工具使用新的密钥对修改后的SAML断言进行签名。
5.  **发送伪造的SAML请求：** 攻击者将重新签名后的SAML请求发送给服务提供商。
6.  **绕过验证，身份伪造：** 由于服务提供商使用的pysaml2版本存在漏洞，且没有强制验证密钥类型，攻击者可以成功绕过签名验证，冒充被篡改用户信息的对应用户。


**项目地址:** [RyanBoomer30/CVE-2021-21239-Exploit](https://github.com/RyanBoomer30/CVE-2021-21239-Exploit)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #3

**来源**: [CVE-2021-21239-illera88_CVE-2021-21239.md](../2021/CVE-2021-21239-illera88_CVE-2021-21239.md)

# CVE-2021-21239

> 📦 该CVE有 **3** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21239-GrantBirki_redash-vulnerable.md](../2021/CVE-2021-21239-GrantBirki_redash-vulnerable.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份认证绕过，进而未授权访问

**影响版本:** < 6.5.0

**利用条件:** 目标系统使用pysaml2作为SAML认证库，并且使用默认的CryptoBackendXmlSec1后端。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21239是pysaml2中的一个签名验证漏洞。攻击者可以通过构造恶意的SAML响应，利用xmlsec1默认接受任意类型密钥的特性，嵌入RSA密钥并绕过签名验证。  

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断此漏洞是有效的。漏洞库信息明确指出pysaml2 < 6.5.0 存在签名验证问题，且有公开的PoC可以利用。

**利用方式：**
PoC代码 `poc.py` 展示了如何构造恶意的SAML响应。其利用方式为：
1.  生成一个用于伪造签名使用的RSA密钥对。
2.  构造一个包含恶意断言（Assertion）的SAML响应，将攻击者的公钥嵌入到`KeyInfo`标签的`KeyValue`中，而非使用X.509证书。
3.  由于`xmlsec1`默认接受嵌入的RSA密钥，因此在服务端验证签名时，会使用攻击者提供的公钥进行验证，从而绕过正常的证书验证。
4.  将构造的SAML响应发送到目标Redash服务器的SAML回调地址，实现身份认证绕过。

**投毒风险：**
虽然提供的`docker-compose.yml` 和 `README.md`文件可能包含配置相关的信息，帮助搭建漏洞环境，但是核心的攻击代码在`poc.py`中。 检查`poc.py`，发现其主要逻辑是构造恶意的SAML响应以利用漏洞。代码本身没有明显的后门或恶意行为。`docker-compose.yml`中使用的是redash/redash:10.0.0.b50363这个镜像，这是一个公开的Redash镜像，降低了投毒的可能。但是，仍然存在一定的投毒风险，例如：
1.  作者可能在`script/server`脚本中添加了恶意代码。
2.  docker-compose.yml文件中指定的redash镜像可能被篡改。

考虑到redash镜像的公开性和poc.py代码的相对简单性，以及脚本文件中可能存在的隐蔽风险，因此投毒风险较低，估计为10%。

**项目地址:** [GrantBirki/redash-vulnerable](https://github.com/GrantBirki/redash-vulnerable)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #2

**来源**: [CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md](../2021/CVE-2021-21239-RyanBoomer30_CVE-2021-21239-Exploit.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 中危，可能导致身份伪造和权限提升

**影响版本:** < 6.5.0

**利用条件:** 依赖于pysaml2的SAML认证流程，且使用默认的CryptoBackendXmlSec1后端

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2021-21239是pysaml2库中存在的一个签名绕过漏洞。该漏洞源于pysaml2在版本6.5.0之前的版本中，使用默认的CryptoBackendXmlSec1后端时，对SAML文档的签名验证不严格。具体来说，`xmlsec1`工具默认接受多种类型的密钥，而没有强制要求必须是X.509证书。攻击者可以利用这一点，在SAML文档中使用非X.509证书的密钥进行签名，从而绕过签名验证，冒充任意用户。

**有效性：**
提供的POC代码尝试通过以下步骤利用此漏洞：
1.  解析截获的SAML XML文档。
2.  替换文档中的用户名和邮箱信息。
3.  使用一个空的签名块替换原始签名块.
4.  使用 `openssl` 生成新的密钥和证书，然后使用 `xmlsec1` 对修改后的SAML文档进行签名。
由于漏洞在于对密钥类型的验证不足，利用者通过修改SAML文档内容，并使用新的密钥重新签名，可能使pysaml2在旧版本中绕过验证，从而使攻击者成功伪造身份。此POC **有效**。

**投毒风险：**
检查POC代码后，并未发现明显的恶意投毒代码。代码主要集中在XML解析、字符串替换和签名操作。生成密钥对和使用xmlsec1签名是漏洞利用的正常步骤。

但是以下几点需要注意：

*   `subprocess.run(xmlsec_command, shell=True)`: 使用 `shell=True` 存在命令注入的风险。虽然在这个上下文中，命令是由脚本自身构造的，但如果输入的文件名或者用户输入包含恶意字符，仍然可能被利用。但这个风险很小，因为它依赖于攻击者首先控制输入文件或用户输入。

综合评估，投毒风险较低，约为2%。

**利用方式：**
1.  **截获SAML请求：** 攻击者首先需要截获目标用户发送的SAML认证请求。
2.  **修改SAML断言：** 使用提供的POC代码，攻击者可以修改SAML断言中的用户信息（例如用户名、邮箱等）。
3.  **替换签名：**  利用漏洞，移除原始签名，插入一个空的签名快。
4.  **重新签名SAML断言：** 生成新的密钥对，并使用`xmlsec1`工具使用新的密钥对修改后的SAML断言进行签名。
5.  **发送伪造的SAML请求：** 攻击者将重新签名后的SAML请求发送给服务提供商。
6.  **绕过验证，身份伪造：** 由于服务提供商使用的pysaml2版本存在漏洞，且没有强制验证密钥类型，攻击者可以成功绕过签名验证，冒充被篡改用户信息的对应用户。


**项目地址:** [RyanBoomer30/CVE-2021-21239-Exploit](https://github.com/RyanBoomer30/CVE-2021-21239-Exploit)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---

## POC #3

**来源**: [CVE-2021-21239-illera88_CVE-2021-21239.md](../2021/CVE-2021-21239-illera88_CVE-2021-21239.md)

## CVE-2021-21239-pysaml2-签名绕过

**漏洞编号:** CVE-2021-21239

**漏洞类型:** 签名绕过

**影响应用:** pysaml2

**危害等级:** 高危，可能导致用户伪造和权限提升

**影响版本:** < 6.5.0

**利用条件:** 使用默认 CryptoBackendXmlSec1 后端，且需要验证签名的 SAML 文档

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21239 是 pysaml2 库中的一个签名验证绕过漏洞，影响版本低于 6.5.0。该漏洞源于 pysaml2 使用 xmlsec1 验证 SAML 签名时，默认允许使用嵌入在 SAML 响应中的公钥，而没有强制使用配置的 IdP 证书。攻击者可以构造一个包含恶意公钥的 SAML 响应，并使用相应的私钥对其进行签名。由于 xmlsec1 允许使用嵌入的公钥，因此伪造的签名将被验证通过，从而允许攻击者冒充任何用户，并提升权限。

**有效性：**
提供的 POC 代码（来自技术报告）解释了如何利用此漏洞，包括生成密钥对、构造包含恶意公钥的 SAML 响应、修改用户属性（如电子邮件）以冒充管理员，并使用生成的私钥对响应进行签名。报告中还提供了通过 Docker Compose 设置易受攻击的 Redash 实例，配置 SAML SSO，以及使用 Ngrok 将本地 Redash 实例暴露给 Google 的 IdP 进行测试的步骤。 pentesterlab 提供的练习也佐证了该漏洞的可利用性。 因此，可以判定该POC有效。

**投毒风险：**
该代码仓库主要包含 LICENSE，README.md, 描述了漏洞原理和利用方式。检查代码未发现明显的恶意行为，但由于代码仓库的作者可以随时修改代码，存在一定的潜在风险，例如在构建过程中插入恶意代码，或者在某些特定条件下触发恶意行为。考虑到LICENSE文件以及README描述文件的内容，可以判定存在10%的投毒风险。

**利用方式：**
1.  攻击者生成一个 RSA 密钥对。
2.  攻击者构造一个恶意的 SAML 响应，将生成的公钥嵌入到 `<ds:RSAKeyValue>` 元素中。
3.  攻击者修改 SAML 响应中的用户属性（例如，将电子邮件地址更改为管理员的电子邮件地址）。
4.  攻击者使用生成的私钥对 SAML 响应进行签名。
5.  攻击者将伪造的 SAML 响应发送给易受攻击的 pysaml2 应用程序。
6.  pysaml2 应用程序使用 xmlsec1 验证签名，由于 xmlsec1 允许使用嵌入的公钥，因此伪造的签名将被验证通过。
7.  攻击者成功冒充目标用户（例如，管理员），并获得相应的权限。

**项目地址:** [illera88/CVE-2021-21239](https://github.com/illera88/CVE-2021-21239)

**漏洞详情:** [CVE-2021-21239](https://nvd.nist.gov/vuln/detail/CVE-2021-21239)

---



---



---



---

