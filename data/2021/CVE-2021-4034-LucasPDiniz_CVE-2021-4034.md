## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高危 (High)

**CVSS评分:** 7.8

**影响版本:** pkexec版本 <= 0.105 (2009年5月至今的所有版本)

**利用条件:** 本地访问权限，系统中安装有存在漏洞的pkexec程序

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞被称为'PwnKit'，是一个极其稳定且具有破坏性的本地权限提升漏洞。根据POC描述和代码逻辑分析，其有效性源于pkexec对命令行参数处理的逻辑错误。pkexec在处理参数时，如果接收到的参数列表为空（argc为0），其索引值n会默认设置为1。由于缺乏边界检查，pkexec会尝试读取argv[1]，这实际上越界访问到了环境指针数组envp[0]。通过精心构造环境变量，攻击者可以强制pkexec在特权上下文中加载恶意的共享库。该POC文档详细说明了如何利用execve()函数传递空的argv数组来触发溢出。该漏洞不依赖于特定的CPU架构，在绝大多数现代Linux发行版上都能实现100%的成功率。利用步骤：1. 攻击者首先需要在目标Linux系统中获得一个普通用户Shell。2. 编写或下载利用代码，通常包含一个触发pkexec参数溢出的C程序和一个恶意的共享库（.so文件）。3. 在恶意共享库中定义特殊的初始化函数，当pkexec以root身份加载该库时执行提权代码（如执行/bin/sh）。4. 运行编译后的二进制文件，通过execve系统调用传入空参数和特定的环境变量。5. pkexec触发越界写入并加载恶意共享库，最终赋予攻击者root权限。投毒风险分析：该POC文档内容详实且技术原理清晰。目前提供的部分未发现明显的恶意混淆代码或可疑的外部网络连接请求。代码主要侧重于利用C语言的底层特性进行内存操纵，符合典型的安全研究风格。然而，由于此类漏洞的影响范围极大且利用脚本极易编写，互联网上流传的大量'一键提权'脚本存在被恶意篡改的风险。投毒者可能会在提权脚本中嵌入反弹Shell指令、下载远程恶意载荷的URL或静默安装Rootkit。分析发现该POC在README中引用了本地图片资源，属于标准仓库结构。虽然当前文档表现出较高的专业性，但使用者在编译执行任何未经验证的C源码前，必须审查其是否包含非必要的system()调用、硬编码的IP地址或向敏感目录写入后门的逻辑。建议在隔离的沙箱环境中进行测试，并重点监控编译过程及运行后的文件系统变化。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2021-4034](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2021-4034)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
