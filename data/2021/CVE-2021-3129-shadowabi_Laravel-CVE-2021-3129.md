## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 系统开启Debug模式，且使用了受影响版本的Ignition错误页处理组件

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于Laravel框架默认集成的Ignition错误视图渲染组件中。当Debug模式开启时，Ignition提供了一个端点用于执行预定义的‘解决方案’（solutions）。攻击者可以通过此端点调用`file_get_contents()`和`file_put_contents()`，通过构造恶意的Log文件内容并结合PHP的`phar://`协议触发反序列化。提供的POC代码显示了极高的有效性，它通过Exp.py脚本自动化了整个利用链路。脚本首先清空当前的日志文件，利用PHPGGK生成的Monolog或Laravel Gadget Chains生成Phar格式的恶意载荷，并将其写入日志。接着，脚本通过多次利用编码转换（如quoted-printable、base64等）绕过PHP过滤器限制，最终通过phar协议触发Gadget链。此POC涵盖了多个利用链（Monolog/rce1-rce4, Laravel/rce1-rce5），增加了对不同环境的适配性。脚本通过命令行参数接收目标IP、端口和要执行的命令，属于一键式自动化工具。利用步骤：1. 确认目标Laravel开启Debug模式；2. 使用phpggc生成针对Monolog或Laravel的Phar反序列化Payload；3. 通过目标端点多次发送请求，清空日志、写入经编码混淆的Payload、最后利用phar协议包含并触发执行。投毒风险分析：该POC代码逻辑相对透明，主要依赖于标准的requests库和本地的phpggc工具。Exp.py脚本本身不包含混淆后的二进制载荷或未授权的外部连接。代码中的命令生成部分采用了标准的Python字符串格式化。虽然Dockerfile中包含了构建环境的步骤，但其目的主要是为了本地运行phpggc生成Payload，未发现明显的恶意篡改系统配置、窃取本地凭证或下载远程木马的行为。主要的潜在风险在于用户在使用该Exp时，如果使用了来源不明的phpggc二进制文件，可能会导致本地开发环境受损。脚本中的Payload生成部分使用了复杂的hex编码拼接，这属于Exp正常的Payload构造逻辑，而非投毒混淆。整体分析认为，此代码属于高质量的安全研究工具，投毒风险较低，但在执行前仍建议在隔离的沙箱环境中使用。

**项目地址:** [https://github.com/ambionics/phpggc](https://github.com/ambionics/phpggc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
