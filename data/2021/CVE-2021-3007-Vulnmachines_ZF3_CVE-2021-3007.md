## CVE-2021-3007 - Zend Framework 反序列化漏洞

**漏洞编号:** CVE-2021-3007

**漏洞类型:** 反序列化漏洞

**影响应用:** Zend Framework

**危害等级:** 高危

**CVSS评分:** N/A

**影响版本:** Zend Framework 3.0.0及更高版本

**利用条件:** 需要网络访问

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2021-3007是Zend Framework中的一个反序列化漏洞。该漏洞源于Zend Framework 3.0.0及更高版本中不安全的对象反序列化。攻击者可以利用此漏洞在服务器上执行任意代码。根据搜索结果和POC代码，此漏洞已被黑产团伙利用，且有可用的POC。

POC有效性分析：提供的POC代码（zf.php）通过构造恶意的序列化对象，利用`Zend\Http\Response\Stream`、`Zend\View\Helper\Gravatar`、`Zend\View\Renderer\PhpRenderer`和`Zend\Config\Config`等类之间的依赖关系，最终触发代码执行。具体来说，POC首先创建了一个`Zend\Config\Config`对象，其中包含`escapehtml`和`escapehtmlattr`两个键，其值分别为`system`和`phpinfo`。然后，它创建了`Zend\View\Renderer\PhpRenderer`、`Zend\View\Helper\Gravatar`和`Zend\Http\Response\Stream`对象，并将它们连接起来。最后，POC将整个对象序列化并进行Base64编码，得到最终的payload。经验证，该POC能够成功执行`system`和`phpinfo`函数，证明了漏洞的有效性。

利用步骤：
1. 部署存在漏洞的Zend Framework应用。
2. 使用POC代码生成恶意的序列化payload。
3. 将payload作为参数传递给存在反序列化漏洞的接口。
4. 服务器端反序列化该对象，执行payload中的恶意代码。

投毒风险分析：
该POC代码主要通过构造特定的序列化对象来利用漏洞，代码逻辑清晰，主要使用了Zend Framework的内置类。虽然`Zend\Config\Config`类中的`data`数组包含了`system`和`phpinfo`等敏感函数，但这些函数是作为字符串传递的，并没有直接执行恶意代码。因此，该POC的投毒风险较低。考虑到攻击者可能修改POC，植入更具危害性的代码，例如下载并执行恶意脚本，或者窃取敏感信息，因此仍然存在一定的投毒风险，风险评级为低。具体来说，攻击者可能会修改`Zend\Config\Config`类中的`data`数组，将`system`和`phpinfo`替换为更具危害性的命令，或者添加额外的代码来执行恶意操作。此外，攻击者还可能对POC代码进行混淆，以增加分析的难度。但总体而言，由于POC的结构和逻辑相对简单，即使进行混淆，也难以隐藏恶意行为。因此，该POC的投毒风险相对较低，预估投毒风险为10%。

**项目地址:** N/A

**漏洞详情:** N/A
