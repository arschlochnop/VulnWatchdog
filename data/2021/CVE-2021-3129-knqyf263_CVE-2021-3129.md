## CVE-2021-3129 - Laravel (facade/ignition) 远程代码执行/反序列化漏洞

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行/反序列化漏洞

**影响应用:** Laravel (facade/ignition)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** Laravel <= 8.4.2; facade/ignition < 2.5.2

**利用条件:** Laravel框架开启Debug模式（默认在开发环境下开启），且使用了受影响版本的Ignition错误页组件。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC是一个非常完整的自动化漏洞利用工具。它基于Laravel Ignition组件中对file_get_contents()和file_put_contents()函数的不安全处理。核心利用逻辑在于：首先，攻击者利用Ignition提供的‘MakeViewVariableOptionalSolution’修复方案，通过log文件作为中转。POC通过多次请求向Laravel日志文件中写入经过编码的Phar反序列化Payload。接着，利用PHP的quoted-printable-decode过滤器清理日志文件中的无关字符。最后，通过phar://协议触发文件包含，从而实现反序列化并执行任意代码。本POC代码结构清晰，通过Docker-compose构建了完整的靶场环境（victim）和攻击者环境（attacker），其中包含自动化的exploit.py脚本。脚本集成了phpggc工具生成的Monolog/RCE1链，能够实现一键式命令执行。经过分析，其逻辑完全符合该CVE的公开技术细节，具有极高的实战有效性。 【利用步骤】1. 环境准备：使用docker-compose up -d启动包含脆弱版本Laravel（8.4.2）和Ignition（2.5.1）的容器。2. 漏洞探测：攻击者通过attacker容器执行exploit.py，脚本首先检查目标站点是否开启Debug模式。3. 载荷投送：脚本向/_ignition/execute-solution发送POST请求，利用log文件写入恶意Phar数据。4. 载荷触发：通过构造包含phar://路径的请求，迫使系统解析日志中的Phar文件，触发反序列化链。5. 结果返回：成功后，命令执行结果将回显给攻击者。 【投毒风险分析】该POC的投毒风险极低。首先，代码完全开源且逻辑透明，主要使用了Python的requests库和标准的系统命令调用，没有发现任何混淆代码（如加密的Base64执行块或反弹Shell后门）。其次，POC的组件依赖明确，主要通过Docker构建隔离环境，不会对宿主机产生非预期的破坏。第三，脚本中的payload生成逻辑直接调用了知名的第三方工具phpggc，且生成的Payload仅用于验证漏洞。唯一需要注意的是，脚本中包含克隆外部仓库的操作，但在安全研究环境下，这是标准的实验流程。代码中不存在窃取敏感信息、扫描内网或在攻击者机器留后门的恶意行为。整体代码风格符合安全研究员编写习惯，属于高质量且纯净的防御性研究工具。

**项目地址:** [https://github.com/SNCKER/CVE-2021-3129](https://github.com/SNCKER/CVE-2021-3129)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
