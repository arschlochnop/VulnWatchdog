# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md](../2021/CVE-2021-22204-ph-arm_CVE-2021-22204-Gitlab.md)

# CVE-2021-22204

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2021-22204-0xBruno_CVE-2021-22204.md](../2021/CVE-2021-22204-0xBruno_CVE-2021-22204.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ANTaæ ‡ç­¾ä¸­çš„Perlä»£ç æ³¨å…¥ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§:** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ä»£ç ã€‚è¯¥POCè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«Payloadçš„JPEGæ–‡ä»¶ï¼Œç”¨äºŽè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©:** åœ¨æ‰€æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥è„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å«åå‘shellçš„DjVuæ–‡ä»¶ã€‚`exploit.sh` çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆæ¶æ„æ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ exiftool è§¦å‘æ¼æ´žï¼Œå¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•æ¶æ„è¡Œä¸ºã€‚`README.md` ä¹Ÿåªæ˜¯ä¸€ä¸ªè¯´æ˜Žæ–‡æ¡£ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **åˆ›å»ºæ¶æ„DjVuæ–‡ä»¶:** é¦–å…ˆï¼Œè„šæœ¬åˆ›å»ºä¸€ä¸ªç®€å•çš„PBMå›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºDjVuæ ¼å¼ã€‚ç„¶åŽï¼Œå®ƒå°†æ¶æ„çš„ANTaæ ‡ç­¾é™„åŠ åˆ°DjVuæ–‡ä»¶ä¸­ã€‚ANTaæ ‡ç­¾åŒ…å«åµŒå…¥çš„Perlä»£ç ï¼Œè¯¥ä»£ç ç”¨äºŽå»ºç«‹åå‘shellè¿žæŽ¥åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚
2.  **ç”ŸæˆåŒ…å«Payloadçš„JPEG:** åˆ©ç”¨Exiftoolçš„configåŠŸèƒ½ï¼Œå°†DjVu Payload åµŒå…¥åˆ°JPEGæ–‡ä»¶å¤´ä¸­ï¼Œå½“exiftool è§£æžè¿™ä¸ªJPEGæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´ž
3.  **è§¦å‘æ¼æ´ž:** æ”»å‡»è€…éœ€è¦å°†æž„é€ å¥½çš„æ¶æ„DjVuæ–‡ä»¶ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬ã€‚å½“ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªåå‘shellã€‚

**æ€»ç»“:** è¯¥æ¼æ´žåˆ©ç”¨æ¶‰åŠæž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨ExifToolçš„æ¼æ´žæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´žçš„CVSSè¯„åˆ†ä¸ºä¸­ç­‰ï¼Œä½†ç”±äºŽå¯ä»¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå› æ­¤é£Žé™©éžå¸¸é«˜ã€‚è¯¥POCçš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #2

**æ¥æº**: [CVE-2021-22204-Akash7350_CVE-2021-22204.md](../2021/CVE-2021-22204-Akash7350_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æ¶æ„DjVuæ–‡ä»¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ¨¡å—ä¸­ï¼Œå½“è§£æžæ¶æ„å›¾åƒæ—¶ï¼Œç”±äºŽç”¨æˆ·æ•°æ®æœªç»è¿‡é€‚å½“çš„æ¸…ç†ï¼Œå¯¼è‡´ eval æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¶æ„çš„ Perl ä»£ç ã€‚å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ï¼Œè¯´æ˜Žè¯¥æ¼æ´žåœ¨é‡Žå¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** æä¾›çš„exploit.py ä¸»è¦åŠŸèƒ½æ˜¯ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ã€‚åœ¨åˆ†æžä»£ç åŽï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯æž„å»ºåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶æœªå‘çŽ°æœ‰ä¸»åŠ¨åŽé—¨ä»£ç æ¤å…¥æˆ–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€äº›é£Žé™©ï¼Œä¾‹å¦‚ï¼š

*   **ä¾èµ–é—®é¢˜ï¼š** è„šæœ¬ä¾èµ–äºŽ`djvulibre-bin`å’Œ`exiftool`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æºå®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚
*   **å‘½ä»¤æ³¨å…¥é£Žé™©ï¼š** è™½ç„¶è„šæœ¬æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤å–å†³äºŽç”¨æˆ·æä¾›çš„commandå‚æ•°ã€‚å¦‚æžœç”¨æˆ·æä¾›çš„å‘½ä»¤æœ¬èº«æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå±å®³ã€‚
*   **å…ƒæ•°æ®ç¯¡æ”¹ï¼š** é€šè¿‡ä¿®æ”¹å›¾ç‰‡å…ƒæ•°æ®è¿›è¡Œæ”»å‡»ã€‚å°½ç®¡è¿™ä¸ªæ˜¯æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹äº†å›¾ç‰‡å…ƒæ•°æ®ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ç¯¡æ”¹ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é£Žé™©åœ¨äºŽç”¨æˆ·è‡ªå·±æä¾›çš„å‘½ä»¤å’Œä¾èµ–é¡¹çš„æ¥æºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¶æ„ Perl ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†è¯¥æ¶æ„ DjVu æ–‡ä»¶ã€‚
3.  å½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡ŒåµŒå…¥çš„æ¶æ„ Perl ä»£ç ï¼Œä»Žè€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

POCä»£ç ä¸­é¦–å…ˆæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å®‰è£…ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶æ„perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆ©ç”¨äº†ExifToolä¸­çš„evalæ³¨å…¥æ¼æ´žã€‚å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellæ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚æœ€åŽå°†æœ‰æ•ˆè´Ÿè½½æ’å…¥åˆ°JPEGå›¾åƒä¸­ã€‚

**é¡¹ç›®åœ°å€:** [Akash7350/CVE-2021-22204](https://github.com/Akash7350/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #3

**æ¥æº**: [CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md](../2021/CVE-2021-22204-Asaad27_CVE-2021-22204-RSE.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ExifToolï¼Œä¸”ä½¿ç”¨ExifToolå¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—çš„Evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç åµŒå…¥åˆ°æ–‡ä»¶çš„metadataä¸­ã€‚å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
* `mkdira.djvu`ï¼šç”¨äºŽåˆ›å»ºç›®å½•çš„æ¶æ„DjVuæ–‡ä»¶ã€‚
* `reverseshell.dsed`ï¼šç”¨äºŽåˆ›å»ºåå‘shellçš„metadataæ–‡ä»¶ã€‚
* `testshellcommand.dsed`ï¼šç”¨äºŽæµ‹è¯•å‘½ä»¤æ‰§è¡Œçš„metadataæ–‡ä»¶ã€‚
* `test.dsed`ï¼šç”¨äºŽæ‰§è¡Œidå‘½ä»¤çš„metadataæ–‡ä»¶ã€‚
* `src/dockerfile`ï¼šç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žExifToolç‰ˆæœ¬çš„Dockeré•œåƒï¼Œå¹¶æ‰§è¡ŒPOCï¼ŒéªŒè¯æ¼æ´žã€‚

`dockerfile` å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨çš„è¿‡ç¨‹ï¼šå…ˆå®‰è£…åŒ…å«æ¼æ´žç‰ˆæœ¬çš„ ExifToolï¼Œç„¶åŽä½¿ç”¨ `djvumake` å‘½ä»¤å°†æ¶æ„ metadata ä¿¡æ¯åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚å½“ ExifTool å¤„ç†è¿™äº› DjVu æ–‡ä»¶æ—¶ï¼Œ metadata ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

å› æ­¤ï¼Œæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ `dockerfile` å’Œå‡ ä¸ª `.dsed` æ–‡ä»¶ï¼Œå‘çŽ° `dockerfile` ä¸‹è½½äº†å®˜æ–¹çš„Exiftoolæºç ,å¹¶æ— ä»»ä½•ä¿®æ”¹ï¼Œè€Œæ˜¯æ­£å¸¸ç¼–è¯‘å®‰è£…ã€‚`mkdira.djvu`ã€`reverseshell.dsed` ã€`testshellcommand.dsed`å’Œ`test.dsed` è¿™å‡ ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†éªŒè¯æ¼æ´žçš„ï¼Œ`.dsed` è„šæœ¬åˆ©ç”¨äº† Perl æ³¨å…¥ï¼Œåœ¨ DjVu æ–‡ä»¶è¢«å¤„ç†æ—¶æ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžä¼ æ’­æ¶æ„è½¯ä»¶ã€‚å¯èƒ½å­˜åœ¨çš„æŠ•æ¯’é£Žé™©æ˜¯ï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹`reverseshell.dsed` è„šæœ¬ï¼Œå°†åå‘è¿žæŽ¥åœ°å€æŒ‡å‘æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ç”¨æˆ·ä½¿ç”¨è¯¥POCæ—¶ï¼Œå¯èƒ½ä¼šä¸å°å¿ƒå°†æƒé™æŽˆäºˆæ”»å‡»è€…ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£Žé™©è¯„å®šä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æž„å»ºä¸€ä¸ªåŒ…å«æ¶æ„metadataçš„DjVuæ–‡ä»¶ã€‚
2.  è¯¥metadataä¸­åŒ…å«Perlä»£ç ï¼Œåˆ©ç”¨`qx{}`æˆ–`${}`æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  ç›®æ ‡æœºå™¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬æ‰“å¼€/å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolè§£æžDjVuæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œmetadataä¸­çš„Perlä»£ç ï¼Œä»Žè€Œå®žçŽ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚

ç”±äºŽExifToolé€šå¸¸ç”¨äºŽå¤„ç†å›¾åƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ¶æ„DjVuæ–‡ä»¶ä¼ªè£…æˆå›¾åƒæ–‡ä»¶ï¼Œè¯±éª—ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†ï¼Œä»Žè€Œè§¦å‘æ¼æ´žã€‚

**é¡¹ç›®åœ°å€:** [Asaad27/CVE-2021-22204-RSE](https://github.com/Asaad27/CVE-2021-22204-RSE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #4

**æ¥æº**: [CVE-2021-22204-AssassinUKG_CVE-2021-22204.md](../2021/CVE-2021-22204-AssassinUKG_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ–‡ä»¶è§£æžæ¨¡å—ä¸­ï¼Œç”±äºŽå¯¹ç”¨æˆ·æä¾›çš„æ•°æ®æœªè¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ 

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æž„é€ ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åµŒå…¥çš„Perlä»£ç ã€‚å¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆpayloadã€‚
2.  å°†è¯¥DjVuæ–‡ä»¶åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚JPGã€‚æä¾›çš„è„šæœ¬ä½¿ç”¨ `exiftool` å·¥å…·å°†æ¶æ„çš„DjVuæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡å›¾åƒæ–‡ä»¶çš„HasselbladExifå…ƒæ•°æ®ä¸­ã€‚
3.  è¯±éª—å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†è¯¥æ–‡ä»¶ã€‚
4.  å½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒDjVuæ–‡ä»¶ä¸­çš„æ¶æ„Perlä»£ç å°†è¢«æ‰§è¡Œï¼Œæ”»å‡»è€…ä»Žè€ŒæŽ§åˆ¶ç³»ç»Ÿã€‚

**å…³äºŽæŠ•æ¯’é£Žé™©çš„è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„è„šæœ¬å¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½†ä»ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š

*   è„šæœ¬éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£… `djvulibre-bin`ï¼Œå¦‚æžœç”¨æˆ·ä»Žéžå®˜æ–¹æ¸ é“èŽ·å–è¯¥è½¯ä»¶åŒ…ï¼Œå¯èƒ½å­˜åœ¨æ¶æ„è½¯ä»¶ã€‚
*   è„šæœ¬æœ¬èº«å¯èƒ½åŒ…å«åŽé—¨ä»£ç ï¼Œä½†ç»è¿‡åˆ†æžï¼Œå…¶ä¸­æ¤å…¥åŽé—¨çš„æ¦‚çŽ‡è¾ƒä½Žï¼Œè„šæœ¬ä¸»è¦æ˜¯ç”Ÿæˆexpolit.djvu,ç„¶åŽé€šè¿‡exiftoolå†™å…¥åˆ°å›¾ç‰‡ä¸­ã€‚å› æ­¤,æŠ•æ¯’æ¦‚çŽ‡ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #5

**æ¥æº**: [CVE-2021-22204-PenTestical_CVE-2021-22204.md](../2021/CVE-2021-22204-PenTestical_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œä¸”ç”¨æˆ·ä½¿ç”¨ExifToolå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶è§£æžæ¨¡å—å­˜åœ¨çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ åŒ…å«æ¶æ„Perlä»£ç çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç åˆ©ç”¨äº†DjVuæ–‡ä»¶æ ¼å¼è§£æžçš„æ¼æ´žï¼Œé€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„çš„Perlä»£ç æ¥å®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`createFile.sh` è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªåå‘shellçš„Payloadã€‚å¦‚æžœç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolå¤„ç†æ­¤æ–‡ä»¶ï¼Œåˆ™æ”»å‡»è€…èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªshellã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
åˆ†æžæä¾›çš„ `LICENSE`, `README.md`, `createFile.sh` æ–‡ä»¶ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ `createFile.sh` è„šæœ¬çš„åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«payloadçš„ DjVu æ–‡ä»¶ã€‚ è¯¥è„šæœ¬ä»…åŒ…å«æž„é€ æ¼æ´žåˆ©ç”¨çš„å¿…è¦ä»£ç ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•è¯•å›¾åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„è¿¹è±¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…éœ€è¦æ›¿æ¢ `createFile.sh` è„šæœ¬ä¸­çš„IPåœ°å€ï¼ˆé»˜è®¤ä¸º`10.10.10.10`ï¼‰ä¸ºæ”»å‡»è€…è‡ªå·±çš„IPåœ°å€ã€‚
2.  è¿è¡Œ `createFile.sh` è„šæœ¬ï¼Œç”Ÿæˆæ¶æ„çš„ `shell.djvu` æ–‡ä»¶ã€‚
3.  å°† `shell.djvu` æ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚
4.  è¯±å¯¼ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç† `shell.djvu` æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ `sudo /usr/local/bin/exiftool shell.djvu` å‘½ä»¤ï¼‰ã€‚
5.  æ”»å‡»è€…åœ¨å…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ä¸º4444ï¼‰ä¸ŠæŽ¥æ”¶åå‘shellè¿žæŽ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPOCä¸­çš„æ³¨é‡Šè¡¨æ˜Žï¼Œä¸ºäº†æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žï¼ŒExifTooléœ€è¦ä»¥rootæƒé™è¿è¡Œï¼ˆä¾‹å¦‚ä½¿ç”¨`sudo`ï¼‰ã€‚ è¿™æ˜¯ç”±äºŽåå‘shell Payloadéœ€è¦æå‡çš„æƒé™æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚


**é¡¹ç›®åœ°å€:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #6

**æ¥æº**: [CVE-2021-22204-Roronoawjd_CVE-2021-22204.md](../2021/CVE-2021-22204-Roronoawjd_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuæ¨¡å—ä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†ç‰¹åˆ¶çš„DjVuæˆ–åŒ…å«åµŒå…¥DjVuæ•°æ®çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚JPEGï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

è¯¥æ¼æ´žå­˜åœ¨äºŽExifToolçš„DjVuæ¨¡å—ä¸­ï¼Œç”±äºŽæœªèƒ½æ­£ç¡®å¤„ç†DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®ï¼Œå¯¼è‡´äº†ä»£ç æ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚POCåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **Dockerfile**: ç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolå’Œæ‰€éœ€ä¾èµ–é¡¹çš„Dockeré•œåƒã€‚
2.  **README.md**: æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆæ¶æ„`image.jpg`æ–‡ä»¶ã€‚
3.  **configfile**:  ExifToolçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„Exifæ ‡ç­¾ï¼Œç”¨äºŽå°†æ¶æ„DjVuæ•°æ®å†™å…¥å›¾åƒæ–‡ä»¶ã€‚
4.  **docker-compose.yml**:  å®šä¹‰äº†Dockerå®¹å™¨çš„æœåŠ¡é…ç½®ï¼Œæ–¹ä¾¿å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
5.  **exploit.py**:  Pythonè„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«åå¼¹shellçš„æ¶æ„DjVuæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ExifToolå°†è¯¥DjVuæ•°æ®åµŒå…¥åˆ°`image.jpg`æ–‡ä»¶ä¸­ã€‚è„šæœ¬é¦–å…ˆä½¿ç”¨base64ç¼–ç çš„perlä»£ç åˆ›å»ºä¸€ä¸ªåå¼¹shellï¼Œç„¶åŽå°†å…¶æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ï¼Œæœ€åŽå°†DjVuæ•°æ®åµŒå…¥åˆ°image.jpgä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  é…ç½®`exploit.py`ä¸­çš„åå¼¹shell IPåœ°å€å’Œç«¯å£ã€‚
2.  è¿è¡Œ`docker compose up`å¯åŠ¨æ¼æ´žçŽ¯å¢ƒã€‚
3.  è¿›å…¥Dockerå®¹å™¨çš„shellï¼Œæ‰§è¡Œ`/root/exploit.py`ç”ŸæˆåŒ…å«æ¶æ„ä»£ç çš„`image.jpg`æ–‡ä»¶ã€‚
4.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†`image.jpg`æ—¶ï¼Œä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…èŽ·å¾—åå¼¹shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

è¯¥PoCä»£ç åˆ©ç”¨äº†CVE-2021-22204æ¼æ´žï¼Œé€šè¿‡DjVuæ–‡ä»¶åµŒå…¥æ¶æ„Perlä»£ç ï¼Œå½“ExifToolå¤„ç†åŒ…å«è¯¥DjVuæ•°æ®çš„å›¾ç‰‡æ—¶ï¼ŒPerlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥PoCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è™½ç„¶è¯¥ä»“åº“ä¸­åŒ…å«Dockerfileï¼Œå¯ä»¥å¿«é€Ÿæž„å»ºä¸€ä¸ªæ¼æ´žçŽ¯å¢ƒã€‚ä½†æ˜¯ç»è¿‡ä»£ç å®¡è®¡ï¼Œå…¶ä¸­`exploit.py`ä¸­çš„payloadæ‰§è¡Œçš„æ˜¯åå¼¹shellï¼Œå¹¶æ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„ä»£ç ï¼Œä¸”ä½œè€…æœ‰æä¾›å‚è€ƒé“¾æŽ¥ï¼Œå¯ä»¥åˆ¤å®šæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåªæœ‰1%ã€‚



**é¡¹ç›®åœ°å€:** [Roronoawjd/CVE-2021-22204](https://github.com/Roronoawjd/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #7

**æ¥æº**: [CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md](../2021/CVE-2021-22204-UNICORDev_exploit-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸ä»»æ„ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚æ”»å‡»è€…éœ€è¦ä¸Šä¼ æˆ–ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶æ ¼å¼çš„è§£æžè¿‡ç¨‹ä¸­ã€‚å½“ExifToolç‰ˆæœ¬åœ¨7.44åˆ°12.23ä¹‹é—´æ—¶ï¼Œå¤„ç†æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¸­æ˜Žç¡®æŒ‡å‡ºè¯¥æ¼æ´žå…è®¸åœ¨è§£æžæ¶æ„å›¾åƒæ—¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„ä¿®å¤commitå’ŒæŠ¥å‘Šã€‚æä¾›çš„PoCä»£ç ä¹ŸéªŒè¯äº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶çš„è„šæœ¬ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

åˆ†æžæä¾›çš„PoCä»£ç ï¼Œè¯¥ä»£ç ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

*   Dockerfileï¼šç”¨äºŽæž„å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å’Œç›¸å…³ä¾èµ–çš„Dockeré•œåƒã€‚
*   README.mdï¼šæä¾›æ¼æ´žæè¿°ã€åˆ©ç”¨æ–¹æ³•ã€ä½¿ç”¨ç¤ºä¾‹å’Œå…è´£å£°æ˜Žç­‰ä¿¡æ¯ã€‚
*   exploit-CVE-2021-22204.pyï¼šæ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚

è™½ç„¶è¯¥ä»£ç å·²ç»æä¾›äº†ä¸€å®šçš„åŠŸèƒ½éªŒè¯ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è€ƒè™‘æŠ•æ¯’é£Žé™©ã€‚ä¸»è¦å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  **ä»£ç é€»è¾‘å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥`exploit-CVE-2021-22204.py`è„šæœ¬ä¸­çš„ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å¯ç–‘è¡Œä¸ºï¼š
    *   è¿žæŽ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨ï¼Œä¸‹è½½æˆ–ä¸Šä¼ æ•°æ®ã€‚
    *   ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–çŽ¯å¢ƒå˜é‡ã€‚
    *   å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…æˆ–ç»„ä»¶ã€‚
    *   æ‰§è¡ŒæœªçŸ¥çš„æˆ–ä¸å¿…è¦çš„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   éšè—æˆ–æ··æ·†çš„ä»£ç ç‰‡æ®µã€‚
2.  **ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š** æ£€æŸ¥Dockerfileä¸­å®‰è£…çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œç¡®è®¤å®ƒä»¬æ¥è‡ªå¯ä¿¡çš„æ¥æºï¼Œå¹¶ä¸”æ²¡æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´žã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æ£€æŸ¥åˆ©ç”¨è„šæœ¬ä¸­æ˜¯å¦æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚åå¼¹shellçš„IPæ˜¯ä¸æ˜¯æ”»å‡»è€…è‡ªå·±çš„ã€‚

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°å®‰å…¨é£Žé™©ï¼Œä»ç„¶æœ‰10%çš„å¯èƒ½æ€§å­˜åœ¨éšè”½çš„æŠ•æ¯’ä»£ç ã€‚ è¿™éƒ¨åˆ†ä»£ç å¯èƒ½æ—¨åœ¨æ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€æ¤å…¥åŽé—¨æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  æ”»å‡»è€…ä½¿ç”¨`exploit-CVE-2021-22204.py`è„šæœ¬ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ã€‚ è¯¥è„šæœ¬å…è®¸æ”»å‡»è€…æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–ç”Ÿæˆåå‘shellã€‚
2.  æ”»å‡»è€…å°†æ¶æ„DjVuæ–‡ä»¶å‘é€ç»™ç›®æ ‡ç”¨æˆ·ï¼Œæˆ–è€…å°†å…¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
3.  ç›®æ ‡ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»çš„ExifToolç‰ˆæœ¬å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
4.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘æ¼æ´žï¼Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ¶æ„ä»£ç ã€‚ è¿™å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€ç³»ç»Ÿæƒé™æå‡æˆ–ä¿¡æ¯æ³„éœ²ç­‰ã€‚

**æ€»ç»“ï¼š**

CVE-2021-22204æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è™½ç„¶æä¾›çš„PoCä»£ç æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†ä»ç„¶éœ€è¦è°¨æ…Žä½¿ç”¨ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #8

**æ¥æº**: [CVE-2021-22204-battleofthebots_dejavu.md](../2021/CVE-2021-22204-battleofthebots_dejavu.md)

## CVE-2021-22204 ExifTool DjVu è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„ExifToolï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽå¯¹ DjVu æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ•°æ®æœªè¿›è¡Œå……åˆ†çš„å‡€åŒ–å¤„ç†ï¼Œå¯¼è‡´åœ¨è§£æžæ¶æ„å›¾åƒæ—¶å¯èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ANTa æˆ– ANtz chunkä¸­, ä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯è¡¨æ˜Žå­˜åœ¨ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œæ¼æ´žåˆ©ç”¨ä»£ç  `DjVu.pm` è¡¨æ˜Žï¼Œé€šè¿‡ä¿®æ”¹ DjVu æ–‡ä»¶çš„ç‰¹å®šåŒºåŸŸï¼Œä¾‹å¦‚æ³¨é‡Šå— (ANTa æˆ– ANtz)ï¼Œå¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool å¤„ç†è¿™ä¸ªè¢«ç¯¡æ”¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `DjVu.pm` çœ‹èµ·æ¥æ˜¯ ExifTool ä¸­ DjVu æ¨¡å—çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚è™½ç„¶æ— æ³•ä»Žè¿™ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µç¡®å®šæœ€ç»ˆå½±å“å’Œæ”»å‡»æ•ˆæžœï¼Œä½†æ˜¯**ç›´æŽ¥**æŸ¥çœ‹æ­¤ä»“åº“çš„ä»£ç ç‰‡æ®µæœ¬èº«ï¼Œæ— æ³•åˆ¤æ–­ä»“åº“ä½œè€…æ˜¯å¦å­˜åœ¨éšè—çš„æ¶æ„ä»£ç ä»¥è¾¾åˆ°æŠ•æ¯’çš„ç›®çš„ï¼Œå› æ­¤ï¼Œå½“å‰åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§ä¸º0%ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è€…ä¾ç„¶éœ€è¦ä»”ç»†æ£€æŸ¥å®Œæ•´ä»£ç ï¼Œä»¥åŠè¿›ä¸€æ­¥éªŒè¯æ­¤åˆ©ç”¨çš„å®‰å…¨æ€§ã€‚å°¤å…¶éœ€è¦æ³¨æ„`ProcessAnt` å’Œ `ProcessMeta` å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°è´Ÿè´£å¤„ç† DjVu æ³¨é‡Šæ•°æ®ã€‚æ­¤å¤–éœ€è¦å…³æ³¨æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯æ¶æ„æ–‡ä»¶ä¸Šä¼ ç­‰çŽ¯èŠ‚ï¼Œéœ€è¦ä¸¥æ ¼è¿‡æ»¤å’ŒéªŒè¯ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æž„é€ æ¶æ„DjVuæ–‡ä»¶ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦åŒ…å«è¢«ç¯¡æ”¹çš„ANTaæˆ–ANTz chunkï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç ä¼šè¢« ExifTool çš„ DjVu è§£æžæ¨¡å—æ‰§è¡Œã€‚
2.  **ä¸Šä¼ æˆ–ä½¿ç›®æ ‡ç³»ç»Ÿå¤„ç†æ¶æ„æ–‡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œè®©ç›®æ ‡ç³»ç»Ÿä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬æ¥å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¦‚åœ¨ GitLab çš„åœºæ™¯ä¸­ï¼‰ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å°†æ–‡ä»¶æä¾›ç»™ ExifTool è¿›è¡Œå¤„ç†ã€‚
3.  **è§¦å‘ä»£ç æ‰§è¡Œï¼š** å½“ ExifTool è§£æžæ¶æ„ DjVu æ–‡ä»¶æ—¶ï¼ŒANTaæˆ–ANTz chunkä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚å®‰è£…åŽé—¨ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [battleofthebots/dejavu](https://github.com/battleofthebots/dejavu)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #9

**æ¥æº**: [CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md](../2021/CVE-2021-22204-bilkoh_POC-CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ANT-Perlæ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–æ‰§è¡Œæ¶æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å¤„ç†æ¶æ„DjVuæ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶å¤„ç†æ¨¡å—çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žã€‚è¯¥æ¼æ´žæºäºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ï¼Œæœªæ­£ç¡®åœ°è¿‡æ»¤ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨ DjVu æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åµŒå…¥æ¶æ„ä»£ç ã€‚å½“ ExifTool è§£æžåŒ…å«æ¶æ„ä»£ç çš„ DjVu æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚  

**æœ‰æ•ˆæ€§:** æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨ `djvumake` å·¥å…·åˆ›å»ºåŒ…å«æ¶æ„å…ƒæ•°æ®çš„ DjVu å›¾åƒæ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒPOC è„šæœ¬ `build_image.pl` å°†ç”¨æˆ·æä¾›çš„å‘½ä»¤æ³¨å…¥åˆ° DjVu æ–‡ä»¶çš„ ANTa (annotation) åŒºåŸŸã€‚å½“æ˜“å—æ”»å‡»çš„ ExifTool ç‰ˆæœ¬å¤„ç†æ­¤æ–‡ä»¶æ—¶ï¼ŒANTa åŒºåŸŸä¸­çš„ Perl ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©:**  è¯¥ POC ä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œè€Œéžè¿›è¡ŒæŠ•æ¯’ã€‚è¯¥è„šæœ¬åªæ˜¯åˆ›å»ºæ¶æ„ DjVu æ–‡ä»¶ï¼Œå…¶è¡Œä¸ºç¬¦åˆæ¼æ´žæè¿°ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…éšè—çš„ã€è¶…å‡ºæ¼æ´žåˆ©ç”¨èŒƒå›´çš„æ¶æ„ä»£ç ã€‚æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç²¾å¿ƒæž„é€ çš„å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«äº†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚
2.  æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ä½¿ç”¨æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„ DjVu æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶ã€ç½‘ç«™ä¸Šä¼ ç­‰æ–¹å¼ã€‚
3.  å½“ ExifTool è§£æž DjVu æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæå–å…ƒæ•°æ®ã€‚
4.  ç”±äºŽæ¼æ´žï¼ŒExifTool ä¼šæ‰§è¡Œæ¶æ„å…ƒæ•°æ®ä¸­åŒ…å«çš„ Perl ä»£ç ï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žåœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€çªƒå–æ•æ„Ÿä¿¡æ¯ç­‰ã€‚

ç®€å•æ¥è¯´,å°±æ˜¯é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶,åˆ©ç”¨Exiftoolè§£æžDjVuæ–‡ä»¶æ—¶æ‰§è¡Œäº†æ–‡ä»¶å†…çš„æ¶æ„çš„Perlä»£ç ,ä»Žè€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ

**é¡¹ç›®åœ°å€:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #10

**æ¥æº**: [CVE-2021-22204-cc3305_CVE-2021-22204.md](../2021/CVE-2021-22204-cc3305_CVE-2021-22204.md)

## CVE-2021-22204 - ExifTool DjVu ä»»æ„ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œç”¨æˆ·éœ€è¦ä½¿ç”¨ExifToolå¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶å¤„ç†æ¨¡å—ã€‚è¯¥æ¼æ´žæ˜¯ç”±äºŽExifToolæœªèƒ½æ­£ç¡®åœ°è¿‡æ»¤DjVuæ–‡ä»¶ä¸­çš„ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨DjVuæ–‡ä»¶ä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼ŒåµŒå…¥çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç é€šè¿‡ç”ŸæˆåŒ…å«æ¶æ„payloadçš„DjVuæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ¥è§¦å‘æ¼æ´žï¼Œä»Žè€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚POCä»£ç åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1.  æž„å»ºpayloadï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„payloadå­—ç¬¦ä¸²ã€‚
2.  åˆ›å»ºpayloadæ–‡ä»¶ï¼šå°†payloadå†™å…¥åä¸º"payload"çš„æ–‡ä»¶ã€‚
3.  åŽ‹ç¼©payloadï¼šä½¿ç”¨`bzz`å‘½ä»¤åŽ‹ç¼©payloadæ–‡ä»¶ä¸ºpayload.bzzã€‚
4.  ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼šä½¿ç”¨`djvumake`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆmalicious.djvuï¼‰ï¼Œå…¶ä¸­åŒ…å«å¯¹payload.bzzçš„å¼•ç”¨ã€‚
5.  è§¦å‘æ¼æ´žï¼šä½¿ç”¨`exiftool`å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶`configfile`ï¼Œè¯»å–æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåˆ©ç”¨`-HasselbladExif<=malicious.djvu`é€‰é¡¹ï¼Œå°†DjVuæ–‡ä»¶å†…å®¹å†™å…¥HasselbladExifæ ‡ç­¾ï¼Œè§¦å‘æ¼æ´žæ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ä»“åº“æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦1%ï¼‰ã€‚ä¸»è¦ç†ç”±å¦‚ä¸‹ï¼š
*   ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œç›®çš„æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´žã€‚
*   ä»£ç æ‰§è¡Œçš„å‘½ä»¤ä¾èµ–äºŽç”¨æˆ·æä¾›çš„`-C`å‚æ•°ï¼Œå³ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ã€‚
*   è™½ç„¶å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä½†è¯¥é…ç½®æ–‡ä»¶åªæ˜¯ä¸ºäº†å°†HasselbladExifæ ‡ç­¾æ·»åŠ åˆ°IFD0ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚

ä½†æ˜¯ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è°¨æ…Žï¼Œå› ä¸ºï¼š
*   POCä»£ç æœ¬èº«ä¼šæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚æžœç”¨æˆ·æŒ‡å®šäº†æ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚
*   `configfile`çš„å†…å®¹éœ€è¦æ£€æŸ¥ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é…ç½®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ã€‚
2.  å—å®³è€…ä½¿ç”¨ExifToolï¼ˆç‰ˆæœ¬7.44åˆ°12.23ï¼‰å¤„ç†è¯¥DjVuæ–‡ä»¶ã€‚
3.  ExifToolåœ¨è§£æžDjVuæ–‡ä»¶æ—¶ï¼Œç”±äºŽå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿‡æ»¤ä¸å½“ï¼Œæ‰§è¡Œäº†DjVuæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚
4.  æ”»å‡»è€…æˆåŠŸåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [cc3305/CVE-2021-22204](https://github.com/cc3305/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #11

**æ¥æº**: [CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-convisolabs_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå®‰è£…ExifToolå’ŒDjVuLibreå·¥å…·ï¼Œä¸”ExifToolç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­DjVuæ–‡ä»¶æ ¼å¼å¤„ç†ä¸å½“å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«Perlä»£ç ï¼Œå½“ExifToolè§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥Perlä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶ï¼š** exploit.pyè„šæœ¬é¦–å…ˆé€šè¿‡base64ç¼–ç å°†åå¼¹shellçš„Perl payloadåµŒå…¥åˆ°DjVuæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚ç„¶åŽï¼Œè„šæœ¬ä½¿ç”¨`djvumake`å·¥å…·å°†payloadæ’å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚
2.  **å°†æ¶æ„DjVuæ–‡ä»¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ï¼š** ä½¿ç”¨`exiftool`å·¥å…·ï¼Œå°†ç”Ÿæˆçš„æ¶æ„DjVuæ–‡ä»¶ï¼ˆexploit.djvuï¼‰åµŒå…¥åˆ°`image.jpg`çš„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯åˆ©ç”¨äº†ExifToolçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹å†™å…¥åˆ°å…ƒæ•°æ®æ ‡ç­¾ä¸­ã€‚
3.  **è§¦å‘æ¼æ´žï¼š** å½“å—å®³è€…ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ExifToolå¤„ç†åŒ…å«æ¶æ„`HasselbladExif`å…ƒæ•°æ®æ ‡ç­¾çš„`image.jpg`æ–‡ä»¶æ—¶ï¼ŒExifToolä¼šå°è¯•è§£æžDjVuæ–‡ä»¶ï¼Œä»Žè€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„Perlä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†DjVuæ¨¡å—ä¸­çš„evalæ³¨å…¥æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Perlä»£ç ã€‚è„šæœ¬ä¸­åŒ…å«äº†ç”Ÿæˆæ¶æ„DjVuæ–‡ä»¶å¹¶å°†å…¶åµŒå…¥åˆ°å›¾åƒæ–‡ä»¶ä¸­çš„æ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªåå¼¹shellçš„ç¤ºä¾‹payloadã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥äº†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬exploit.py, configfile, labç›®å½•ä¸‹çš„Dockerfile, README.md, application.plç­‰ï¼Œæœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ exploit.py çš„ç›®çš„æ˜¯ç”Ÿæˆæ¼æ´žåˆ©ç”¨ç¨‹åºï¼Œå®ƒåˆ›å»ºæ¶æ„æ–‡ä»¶æ¥è§¦å‘ ExifTool ä¸­çš„æ¼æ´žï¼Œè€Œä¸æ˜¯å¼•å…¥åŽé—¨æˆ–æ¶æ„è¡Œä¸ºã€‚é…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯å®šä¹‰ExifToolä½¿ç”¨çš„è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„ä»£ç ã€‚ lab ç›®å½•åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨äºŽè¯´æ˜Ž ExifTool å¯èƒ½çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸åŒ…å«ä»»ä½•éšè—æˆ–æ¶æ„çš„ä»£ç .  å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æŽ¥ï¼Œåˆ©ç”¨äº†ExifToolåœ¨å¤„ç†DjVuæ–‡ä»¶æ—¶å­˜åœ¨çš„evalæ³¨å…¥æ¼æ´žã€‚æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„ä»£ç çš„DjVuæ–‡ä»¶ï¼Œå¹¶å€ŸåŠ©ExifToolçš„ç‰¹æ€§å°†å…¶åµŒå…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆé€šè¿‡ExifToolè§£æžæ–‡ä»¶è§¦å‘æ¼æ´žï¼Œå®žçŽ°ä»£ç æ‰§è¡Œã€‚æä¾›çš„PoCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆï¼Œå¹¶ä¸”æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [convisolabs/CVE-2021-22204-exiftool](https://github.com/convisolabs/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #12

**æ¥æº**: [CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md](../2021/CVE-2021-22204-mr-tuhin_CVE-2021-22204-exiftool.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”æ”»å‡»è€…å¯ä»¥ä¸Šä¼ æˆ–è®©ç›®æ ‡å¤„ç†ç‰¹åˆ¶çš„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­ DjVu æ–‡ä»¶è§£æžæ¨¡å—çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ¼æ´žåº“ä¿¡æ¯å’ŒPacketstorm Securityæä¾›çš„expä½è¯äº†è¿™ä¸€ç‚¹ã€‚è¯¥POCçš„README.mdæ–‡ä»¶æä¾›äº†æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜Žï¼Œexploit.py è„šæœ¬é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶è§¦å‘æ¼æ´žï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

é€šè¿‡åˆ†æž exploit.py è„šæœ¬çš„å†…å®¹ï¼Œå‘çŽ°å…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”ŸæˆåŒ…å«æ¶æ„é…ç½®çš„ DjVu æ–‡ä»¶ï¼Œä»Žè€Œè§¦å‘ ExifTool çš„ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¶æ„ä»£ç åŒ…å«åœ¨ Image::ExifTool::UserDefinedé…ç½®ä¸­ï¼Œå¹¶é€šè¿‡DjVuçš„æ–‡ä»¶æ ¼å¼æ¥æ‰§è¡Œã€‚è™½ç„¶è„šæœ¬æœ¬èº«å­˜åœ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡`run('clear')`æ¸…ç†å±å¹•ï¼‰ï¼Œä½†è¿™å±žäºŽè¾…åŠ©åŠŸèƒ½ï¼Œä¸æ˜¯æ¶æ„æŠ•æ¯’è¡Œä¸ºã€‚

å¯¹README.mdå’Œexploit.pyæ–‡ä»¶è¿›è¡Œåˆ†æž,åœ¨ä»£ç å’Œæè¿°ä¸­æœªå‘çŽ°ä»»ä½•æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Ž, ä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…ï¼Œè¯¥å—å®³è€…æ­£åœ¨è¿è¡Œæ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ ExifToolã€‚
2.  æ”»å‡»è€…ä½¿ç”¨æä¾›çš„ `exploit.py` è„šæœ¬ï¼ŒæŒ‡å®šæ”»å‡»è€…çš„ IP åœ°å€å’Œç›‘å¬ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ï¼ˆ`image.jpg`ï¼‰ã€‚
3.  æ”»å‡»è€…è¯±éª—å—å®³è€…ä½¿ç”¨ ExifTool å¤„ç†è¿™ä¸ªæ¶æ„çš„ DjVu æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
    *   å°†æ¶æ„æ–‡ä»¶ä¸Šä¼ åˆ°ä½¿ç”¨ ExifTool å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ Web åº”ç”¨ç¨‹åºã€‚
    *   é€šè¿‡ç”µå­é‚®ä»¶å°†æ¶æ„æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚
    *   åœ¨å…±äº«æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„æ–‡ä»¶ã€‚
4.  å½“ ExifTool å¤„ç†æ¶æ„çš„ DjVu æ–‡ä»¶æ—¶ï¼Œæ¼æ´žè¢«è§¦å‘ï¼Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤å°†åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œåå¼¹shellåˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #13

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #14

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---



---

## POC #14

**æ¥æº**: [CVE-2021-22204-sameep0_CVE-2021-22204.md](../2021/CVE-2021-22204-sameep0_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå®‰è£…äº†å—å½±å“ç‰ˆæœ¬çš„ExifToolï¼Œä¸”å…è®¸å¤„ç†æ¶æ„DjVuæ–‡ä»¶ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2021-22204 æ˜¯ ExifTool ä¸­çš„ä¸€ä¸ªä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ DjVu æ–‡ä»¶æ ¼å¼çš„å¤„ç†ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œåˆ©ç”¨ ExifTool åœ¨è§£æžæ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ PoC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº† DjVu æ–‡ä»¶çš„ ANTz å­—æ®µä¸­çš„æ¼æ´žï¼Œé€šè¿‡ eval æ³¨å…¥æ‰§è¡Œ Perl ä»£ç ã€‚ä»£ç é¦–å…ˆç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„ Perl ä»£ç çš„ payloadï¼Œç„¶åŽä½¿ç”¨ `bzz` åŽ‹ç¼©è¯¥ payloadï¼Œå¹¶ä½¿ç”¨ `djvumake` å°†å…¶åµŒå…¥åˆ° DjVu æ–‡ä»¶ä¸­ã€‚æœ€åŽï¼Œå®ƒå°†è¯¥ DjVu æ–‡ä»¶æä¾›ç»™ ExifTool å¤„ç†ï¼Œè§¦å‘æ¼æ´žã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
PoC ä»£ç æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚åå¼¹ shell åˆ°æœªçŸ¥ä¸»æœºæˆ–æ¤å…¥æŒä¹…æ€§åŽé—¨ã€‚è¯¥ä»£ç ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žï¼Œåˆ©ç”¨æ–‡ä»¶æ“ä½œå’Œè¿›ç¨‹è°ƒç”¨å®žçŽ°æŒ‡ä»¤æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œå› æ­¤è¯„ä¼°æŠ•æ¯’é£Žé™©æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š
* **æ¥æºå¯é æ€§ï¼š** è™½ç„¶è¯¥ PoC æ¥æºäºŽ Githubï¼Œä½†éœ€è¦éªŒè¯ä½œè€…çš„ä¿¡èª‰å’Œä»£ç çš„å®‰å…¨æ€§ã€‚ä»£ç çš„è´¡çŒ®åŽ†å²å’Œç¤¾åŒºåé¦ˆå¯ä»¥æä¾›ä¸€äº›çº¿ç´¢ã€‚
* **ä»£ç å®¡æŸ¥ï¼š** ä»”ç»†å®¡æŸ¥ä»£ç é€»è¾‘ï¼Œç¡®è®¤æ²¡æœ‰éšè—çš„æ¶æ„åŠŸèƒ½ã€‚éœ€è¦ç‰¹åˆ«å…³æ³¨ä»»ä½•å¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®ç½‘ç»œæˆ–ä¿®æ”¹æ–‡ä»¶çš„éƒ¨åˆ†ã€‚
* **ä¾èµ–é¡¹ï¼š** ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå¦‚ `djvulibre-bin`, `exiftool`ï¼‰æ¥è‡ªå¯ä¿¡çš„æºï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ PoC ä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º 10%ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å®Œå…¨ä¿¡ä»»è¯¥ä»£ç ã€‚åœ¨å®žé™…ä½¿ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç”ŸæˆPayload:**  é¦–å…ˆï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ¶æ„Perlä»£ç çš„Payloadï¼Œåˆ©ç”¨DjVuæ–‡ä»¶çš„ANTzå­—æ®µï¼Œå®žçŽ°evalæ³¨å…¥ã€‚
2.  **åŽ‹ç¼©Payload:** ä½¿ç”¨bzzå·¥å…·åŽ‹ç¼©è¯¥Payloadã€‚
3.  **åˆ›å»ºDjVuæ–‡ä»¶:**  ä½¿ç”¨djvumakeå·¥å…·å°†åŽ‹ç¼©åŽçš„PayloadåµŒå…¥åˆ°ä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ä¸­ã€‚
4.  **è§¦å‘æ¼æ´ž:**  å°†è¯¥æ¶æ„çš„DjVuæ–‡ä»¶æä¾›ç»™å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è¿›è¡Œè§£æžï¼Œå½“ExifToolå°è¯•è§£æžDjVuæ–‡ä»¶ä¸­çš„æ¶æ„ANTzå­—æ®µæ—¶ï¼Œå…¶ä¸­çš„Perlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°ä»»æ„ä»£ç æ‰§è¡Œã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œä½†ä½¿ç”¨è€…ä»éœ€æ³¨æ„ä»£ç çš„æ¥æºï¼Œé¿å…æŠ•æ¯’è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [sameep0/CVE-2021-22204](https://github.com/sameep0/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #15

**æ¥æº**: [CVE-2021-22204-se162xg_CVE-2021-22204.md](../2021/CVE-2021-22204-se162xg_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVuä»£ç æ³¨å…¥

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ³¨å…¥

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯å¯¼è‡´æœ¬åœ°ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** ç”¨æˆ·éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬å¤„ç†æ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2021-22204æ˜¯ExifToolä¸­çš„ä¸€ä¸ªä»£ç æ³¨å…¥æ¼æ´žï¼Œå­˜åœ¨äºŽDjVuæ–‡ä»¶çš„å¤„ç†æ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ï¼Œåœ¨ExifToolå¤„ç†è¯¥æ–‡ä»¶æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ªBashè„šæœ¬ `craft_a_djvu_exploit.sh`ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæ¶æ„çš„DjVuæ–‡ä»¶ï¼ˆä¼ªè£…æˆjpgï¼‰ï¼Œå½“ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ExifToolç‰ˆæœ¬è§£æžè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº† `djvulibre-bin`ï¼Œå¦‚æžœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å°è¯•ä½¿ç”¨ `apt-get` å®‰è£…ã€‚ç„¶åŽï¼Œæ ¹æ®è¦æ‰§è¡Œçš„å‘½ä»¤çš„é•¿åº¦è®¡ç®—æ‰€éœ€çš„å¡«å……å­—èŠ‚ï¼Œå¹¶å°†å‘½ä»¤æ³¨å…¥åˆ°DjVuæ–‡ä»¶ä¸­ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º5%ã€‚`craft_a_djvu_exploit.sh` è„šæœ¬æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æž„é€ æ¶æ„çš„DjVuæ–‡ä»¶ã€‚å¯èƒ½çš„æŠ•æ¯’æ–¹å¼åŒ…æ‹¬åœ¨å®‰è£…ä¾èµ– `djvulibre-bin` çš„è¿‡ç¨‹ä¸­å¼•å…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…åœ¨ç”Ÿæˆçš„DjVuæ–‡ä»¶ä¸­æ’å…¥éš¾ä»¥å¯Ÿè§‰çš„æ¶æ„æŒ‡ä»¤ï¼Œæ‰§è¡Œéžé¢„æœŸçš„æ“ä½œã€‚ä½†è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½è¾ƒä¸ºæ˜Žç¡®ï¼Œä»¥åŠä¾èµ–åŒ…é€šå¸¸ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€ä»¥æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  è¿è¡Œ `craft_a_djvu_exploit.sh` è„šæœ¬ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ã€‚ ä¾‹å¦‚ï¼š`bash craft_a_djvu_exploit.sh 'cal'`ã€‚
2.  è¯¥è„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `delicate.jpg` çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ªä¼ªè£…æˆjpgçš„æ¶æ„DjVuæ–‡ä»¶ã€‚
3.  ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„ ExifTool ç‰ˆæœ¬å¤„ç† `delicate.jpg` æ–‡ä»¶ï¼š`./exiftool delicate.jpg`ã€‚
4.  å½“ ExifTool è§£æž `delicate.jpg` æ–‡ä»¶æ—¶ï¼Œç”±äºŽDjVuæ¨¡å—çš„æ¼æ´žï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šè°ƒç”¨ `cal` å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [se162xg/CVE-2021-22204](https://github.com/se162xg/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

## POC #16

**æ¥æº**: [CVE-2021-22204-trganda_CVE-2021-22204.md](../2021/CVE-2021-22204-trganda_CVE-2021-22204.md)

## CVE-2021-22204-ExifTool-DjVu-ä»£ç æ‰§è¡Œ

**æ¼æ´žç¼–å·:** CVE-2021-22204

**æ¼æ´žç±»åž‹:** ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** ExifTool

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** >=7.44, <12.24

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·ä½¿ç”¨å—å½±å“ç‰ˆæœ¬çš„ ExifTool å¤„ç†æ¶æ„ DjVu æ–‡ä»¶

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2021-22204 æ¼æ´žå­˜åœ¨äºŽ ExifTool çš„ DjVu æ–‡ä»¶è§£æžæ¨¡å—ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æž„é€ æ¶æ„çš„ DjVu æ–‡ä»¶ï¼Œå½“ ExifTool è§£æžè¯¥æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡åœ¨ DjVu æ–‡ä»¶çš„ç‰¹å®šå­—æ®µä¸­æ³¨å…¥ Perl ä»£ç ï¼Œç”±äºŽ ExifTool åœ¨å¤„ç† DjVu æ–‡ä»¶æ—¶ä½¿ç”¨äº† `eval` å‡½æ•°æ¥åŠ¨æ€æ‰§è¡Œè¿™äº›å­—æ®µä¸­çš„å†…å®¹ï¼Œä»Žè€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ä»Žæä¾›çš„æ¼æ´žä¿¡æ¯æ¥çœ‹ï¼Œè¯¥æ¼æ´žçš„æ”»å‡»å‘é‡ä¸º LOCALï¼Œæ”»å‡»å¤æ‚åº¦ä¸ºLOWï¼Œæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è§¦å‘ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªApache License 2.0åè®®æ–‡ä»¶ï¼Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå› æ­¤æ— æ³•åˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚æ£€æŸ¥æä¾›çš„LICENSEæ–‡ä»¶ï¼Œæœªå‘çŽ°ä»»ä½•æ¶æ„æˆ–æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ€»ç»“ï¼šä¸Šä¼ æ¶æ„æž„é€ çš„DjVuæ–‡ä»¶åˆ°ä½¿ç”¨äº†å­˜åœ¨æ¼æ´žç‰ˆæœ¬ExifToolçš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼Œé€šè¿‡ExifToolè§£æžè¯¥æ–‡ä»¶ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [trganda/CVE-2021-22204](https://github.com/trganda/CVE-2021-22204)

**æ¼æ´žè¯¦æƒ…:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)

---

