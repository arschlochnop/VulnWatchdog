## CVE-2021-3129 - Laravel (Ignition 组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition 组件)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启 Debug 模式且使用 Ignition 错误页面组件

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC代码通过Python脚本封装了针对Laravel Ignition组件（CVE-2021-3129）的自动化利用过程。其核心逻辑依赖于Ignition在Debug模式下提供的‘解决方案（Solutions）’功能，该功能在处理log文件时存在不安全的file_get_contents()和file_put_contents()调用。POC利用了phpggc（PHP通用反序列化链生成工具）生成的多种Laravel和Monolog利用链（如Laravel/RCE1至RCE7）。通过一系列特定的HTTP请求，POC首先清空Laravel的日志文件，接着利用file_put_contents将Base64编码的Phar Payload写入日志，最后通过file_get_contents触发Phar反序列化执行系统命令（默认为'id'）。该POC结构清晰，包含了完整的Gadget链配置和多阶段请求逻辑，经环境适配后具有极高的成功率，能直接获取系统控制权。其自动化程度高，无需目标身份认证，仅需目标处于Debug模式即可完成利用。【利用步骤】1. 环境准备：确保目标Laravel开启Debug模式；2. 探测阶段：通过发送包含非预期编码的请求检测Ignition版本和可写性；3. 清理阶段：清空现有laravel.log以防止干扰；4. 写入阶段：将生成的Phar反序列化Payload以特定的转义格式（如十六进制或Base64）注入日志；5. 触发阶段：通过phar://协议访问该日志文件，触发PHP反序列化执行预设命令。【投毒风险分析】在防御性研究视角下，该POC的投毒风险极低，约为10%。首先，代码逻辑完全透明，主要依赖于标准的requests库和subprocess调用phpggc，未发现任何混淆、加密或尝试从远程服务器下载未知二进制文件的行为。其次，虽然脚本中包含了大量的Hex编码字符串，但这些是Phar反序列化Payload的必要组成部分，而非恶意后门。唯一潜在风险在于Dockerfile中引用的基础镜像'ikerlin/php:7.1-fpm-python3-dev'，如果该镜像被篡改，可能导致运行环境受损。但从exp.py脚本本身来看，其目的是合法的漏洞验证。开发者在使用此POC时，建议在隔离的沙箱或容器环境中运行，并使用自定义的、经过验证的基础镜像重新构建Dockerfile，以完全消除供应链层面的潜在风险。脚本中对urllib3警告的禁用属于常见的网络编程习惯，不构成安全威胁。

**项目地址:** [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits) (参考源)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
