## CVE-2021-3156 - Sudo 提权 (Privilege Escalation)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 提权 (Privilege Escalation)

**影响应用:** Sudo

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo < 1.9.5p2 (1.8.2 到 1.8.31p2 以及 1.9.0 到 1.9.5p1)

**利用条件:** 本地用户访问权限，可以通过执行 sudoedit -s 命令触发。

**POC 可用性:** 3/10

**POC 类型:** 仅说明/漏洞检测脚本

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该漏洞被称为‘Baron Samedit’。提供的POC代码实际上并非一个能够直接获取Root权限的完整Exploit，而是一个简单的环境检测脚本。脚本的核心逻辑是通过解析 `sudo --version` 的输出，提取版本号并与 1.8.28 等硬编码数值进行对比。这种基于版本的判断方法存在明显的局限性：首先，它假设版本号的格式是固定的，且未考虑发行版补丁（Backport）的情况，许多Linux发行版虽然版本号较低，但已经通过安全补丁修复了此漏洞。其次，脚本中使用的 `tr` 和 `awk` 字符串处理逻辑较为脆弱，在不同语言环境或非标准输出下极易失效。README提到的 git clone 仓库地址虽然声称是漏洞利用，但从脚本内容看，它仅实现了‘检测’而非‘利用’。对于防御者而言，此脚本只能作为初步筛选工具，不能作为判断系统安全性的唯一标准。真正的有效性验证应通过执行特定的 sudoedit 命令（如带有反斜杠结尾的参数）来观察是否触发 Segfault 分段错误。【利用步骤】1. 攻击者首先需要获取受影响系统的本地低权限 Shell 访问。2. 验证系统中安装的 Sudo 版本是否在 1.9.5p2 之前。3. 运行提供的检测脚本 `./programa.sh` 查看是否提示‘Exploitável’。4. 在真实攻击场景中，攻击者会构造特殊的 argv 数组，利用 sudoedit 的 `-s` 标志和以单个反斜杠结尾的命令行参数，触发 sudoers.c 中的 `set_cmnd()` 函数内的 off-by-one 堆溢出。5. 通过精心布置堆内存布局，覆盖结构体以重定向程序流执行恶意指令，从而将 UID 提升至 0 (Root)。【投毒风险分析】该 POC 脚本的投毒风险极低（约 5%）。分析其 `programa.sh` 和 `One-Liner` 命令可见，代码逻辑纯粹是由 Linux 标准命令（git, cd, chmod, sudo, tr, cut, awk）组成的工具链。代码中没有发现任何混淆、base64 编码的恶意负载、或尝试建立反向连接（Reverse Shell）的可疑行为。所有的逻辑都在本地执行，目的仅为字符串解析和条件分支判断。脚本开头的 `set +H` 是为了关闭 Bash 的历史扩展功能，防止感叹号引起解析错误，属于正常的脚本编写技巧。虽然项目通过 `git clone` 引入外部代码，但由于该脚本不具备 root 权限执行的要求（检测版本只需普通权限），即便存在恶意行为，其影响范围也被限制在当前用户。然而，安全从业者仍应注意，此类简单的检测脚本往往被用作下载更复杂恶意程序的跳板，在生产环境部署前应仔细核检查其 Git 仓库的后续提交记录。

**项目地址:** [https://github.com/RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
