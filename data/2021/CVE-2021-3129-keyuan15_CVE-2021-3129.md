## CVE-2021-3129 - Laravel (Ignition) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Laravel < 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式 (APP_DEBUG=true)，使用Ignition组件

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞存在于Laravel框架默认集成的Ignition报错页面组件中。当Laravel应用程序开启Debug模式时，Ignition组件提供的某些Solution功能（如MakeViewVariableOptionalSolution）未能对用户输入的参数进行严格校验。攻击者可以利用file_get_contents()和file_put_contents()函数的不安全用法，配合PHP的phar://伪协议触发反序列化。POC代码显示，利用过程首先通过发送特定的Payload清除现有的Laravel日志文件，然后利用phpggc工具生成的反序列化链（如Laravel/RCE、Monolog/RCE系列）作为Payload写入日志。通过多次写入并将Payload转换为经过Base64编码的phar文件，最后再次触发日志文件读取导致反序列化执行。POC中使用了多个phpggc生成的Gadget Chain，涵盖了Laravel 5至8不同版本的常用利用链，具有较高的成功率和自动化程度，是针对该漏洞的典型且成熟的利用方案。【利用步骤】1. 检测目标是否开启Debug模式，访问非正常路径确认报错页面是否由Ignition生成。2. 构造请求利用Ignition的API清理日志文件，防止干扰。3. 使用phpggc生成带有RCE命令的Phar包，并进行特殊的Quoted-printable编码。4. 通过多次构造请求将编码后的Payload分批写入Laravel日志文件（storage/logs/laravel.log）。5. 调用Ignition的Solution功能，使用phar://伪协议去解析该日志文件，触发反序列化。6. 执行系统命令获取Shell或回显数据。【投毒风险分析】在提供的POC代码中，投毒风险处于低位。代码主要依赖标准的requests库和Python系统库进行操作。虽然脚本内部集成了由phpggc生成的序列化Payload，且逻辑涉及日志清除和Phar构造，但这属于利用该特定漏洞的标准技术手段，不应将其判定为恶意投毒。通过分析，代码中未发现隐藏的外部服务器连接（C2回连）、未见混淆后的shellcode注入或对本地敏感文件的非授权抓取。唯一的风险点在于攻击者可能在分发的POC中替换phpggc的Payload为静默安装后门的恶意指令。建议安全研究人员在封闭环境运行此类脚本，并仔细检查脚本中的base64和hex转换逻辑，确保没有恶意的额外命令被执行。目前的脚本结构清晰，逻辑透明，主要用于漏洞复现和安全验证。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
