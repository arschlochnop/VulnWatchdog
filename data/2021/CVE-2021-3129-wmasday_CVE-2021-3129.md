## CVE-2021-3129 - Laravel (Ignition组件) RCE/反序列化

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE/反序列化

**影响应用:** Laravel (Ignition组件)

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** Laravel开启Debug模式

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对CVE-2021-3129漏洞提供了完整的自动化利用链。漏洞核心在于Laravel内置的错误页处理组件Ignition（版本小于2.5.2）在开启Debug模式时，对file_get_contents()和file_put_contents()函数的使用缺乏过滤。POC利用了Ignition中的MakeViewVariableOptionalSolution方案，通过POST请求向/_ignition/execute-solution接口发送恶意构造的数据。该POC通过与外部工具phpggc（PHP Generic Gadget Chains）配合，生成特定的Phar反序列化Payload。其有效性体现在其自动化的处理流程：首先通过发送清空日志的Payload，接着利用PHP的base64-decode过滤器逐步向Laravel日志文件中写入经过编码的恶意Phar内容，最后通过phar://协议触发文件读取，实现反序列化并执行系统命令。利用步骤如下：1. 确认目标环境开启Debug模式并存在接口；2. 本地克隆并调用phpggc工具生成指定的RCE链（如Laravel/RCE7）；3. 构造特定的Log清空请求，确保Payload写入时不会因为日志杂质导致解析失败；4. 分段或一次性通过过滤器将Phar Payload写入storage/logs/laravel.log；5. 发起最后的phar://协议请求触发RCE。 投毒风险分析：该POC脚本属于相对透明的漏洞研究工具，其代码逻辑主要集中在HTTP请求构造和与本地phpggc工具的交互上。主要的风险点在于脚本中的os.system("git clone [https://github.com/ambionics/phpggc.git](https://github.com/ambionics/phpggc.git)")操作。虽然这是为了获取必要的Payload生成工具，但在威胁情报视角下，自动执行外部命令并从远程仓库拉取代码存在被供应链污染的可能。若攻击者克隆的是被篡改的仓库，则会导致安全研究员的主机被感染。此外，脚本中虽然有日志记录和简单的调试开关，但核心逻辑清晰，使用了标准的requests库，未发现混淆代码或隐蔽的外部C2通信。其投毒风险评估为15%，主要源于自动克隆外部工具的潜在风险，建议在使用时预先手动下载并验证phpggc。代码中对于系统命令的调用（如subprocess.getoutput）主要用于本地生成Payload，属于正常的POC逻辑，不判定为针对研究员的恶意行为。

**项目地址:** [https://github.com/ambionics/phpggc](https://github.com/ambionics/phpggc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
