## CVE-2021-3129 - Laravel (Ignition组件) RCE/反序列化漏洞

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE/反序列化漏洞

**影响应用:** Laravel (Ignition组件)

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式且安装了Ignition组件

**POC 可用性:** 7/10

**POC 类型:** 漏洞扫描/概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该提供的Python代码是一个针对CVE-2021-3129的漏洞扫描器。CVE-2021-3129是由于Laravel框架默认安装的Ignition错误页组件（版本2.5.2之前）存在安全缺陷导致的。具体原理在于Ignition组件在处理Laravel日志文件时，对file_get_contents()和file_put_contents()函数的使用不当，允许攻击者通过特定接口（如/_ignition/execute-solution）清空日志文件并向其中注入恶意的Phar序列化载荷。当攻击者再次触发日志读取操作时，会导致Phar反序列化，从而执行任意PHP代码。提供的代码段定义了一个路径列表，涵盖了Ignition的关键接口（如/_ignition/execute-solution）和潜在的敏感文件路径（如laravel.log），这对于识别目标是否存在漏洞非常有效。代码采用了多线程模型（ThreadPoolExecutor），并使用了colorama进行可视化输出，具备较好的工程化基础，但核心的利用链（Payload生成与Phar打包逻辑）在截断部分未完全展现。利用步骤：首先确认目标系统开启了APP_DEBUG=true；其次，攻击者发送恶意请求清空Laravel日志；接着，利用Ignition的‘Make file writable’解决方案将恶意的Phar序列化载荷写入日志文件；最后，利用phar://协议读取该日志文件触发反序列化。投毒风险分析：经过对POC代码结构的审查，该脚本属于典型的自动化安全扫描工具。代码中虽然包含了诸如‘God Of Server’、‘AnonByte’等黑客色彩浓厚的Banner信息，这些通常旨在建立某种‘声望’而非直接投毒。脚本使用了标准的Python库如requests、threading和concurrent.futures，逻辑清晰，未发现明显的恶意混淆（Obfuscation）或外部恶意域名连接。其投毒风险主要集中在两个方面：第一，该类脚本常在非官方渠道分发，可能被第三方二次修改插入反弹Shell等后门；第二，脚本中的‘AnonByte’署名可能暗示其来自非正规安全社区。然而，从目前的代码逻辑来看，其行为主要表现为向目标服务器发起HTTP探测，并未对执行扫描的宿主机产生危害。风险等级定为15%，属于较低范围，用户在使用时应在隔离环境运行并注意检查后续被截断的代码是否包含eval()或exec()等执行宿主机系统命令的危险函数。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
