# CVE-2021-22911

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-22911-ChrisPritchard_CVE-2021-22911-rust.md](../2021/CVE-2021-22911-ChrisPritchard_CVE-2021-22911-rust.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致RCE（远程代码执行）

**影响版本:** 3.11, 3.12, 3.13 (修复版本: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 需要网络访问，且目标服务器运行存在漏洞的Rocket.Chat版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的NoSQL注入漏洞。由于不正确的输入清理，攻击者可以通过未经身份验证的API端点进行NoSQL注入，从而可能导致远程代码执行（RCE）。

**有效性：**根据提供的漏洞库信息、搜索结果和漏洞利用代码，该漏洞的POC是有效的。搜索结果中包含了多个指向expolit-db和github的链接，表明存在公开的POC，可以验证该漏洞。

**投毒风险：**提供的代码片段是`Cargo.lock`文件，它只是用于记录Rust项目依赖项的版本信息，本身不包含任何可执行代码。因此，直接从这个文件判断投毒风险是不可行的。需要分析完整的POC代码才能进行评估。鉴于缺乏完整POC源码，假设部分依赖项存在潜在风险，投毒风险评估为10%。

**利用方式：**

1.  **确定目标版本：** 首先需要确定目标Rocket.Chat服务器的版本是否在受影响的范围内（3.11, 3.12, 3.13）。
2.  **构造恶意请求：** 攻击者构造包含恶意NoSQL查询语句的HTTP请求，发送到存在漏洞的API端点。攻击者利用不正确的输入验证，将恶意的NoSQL代码注入到查询语句中。
3.  **执行任意代码：** 成功注入后，恶意NoSQL查询被执行，导致服务器执行攻击者预先设定的任意代码。这通常通过利用MongoDB的JavaScript执行功能实现，例如 `$where` 操作符。
4.  **远程代码执行：** 通过执行任意代码，攻击者可以获取服务器的控制权，进行诸如数据窃取、恶意软件安装等恶意操作。

**项目地址:** [ChrisPritchard/CVE-2021-22911-rust](https://github.com/ChrisPritchard/CVE-2021-22911-rust)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #2

**来源**: [CVE-2021-22911-CsEnox_CVE-2021-22911.md](../2021/CVE-2021-22911-CsEnox_CVE-2021-22911.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 需要目标Rocket.Chat服务器可访问，无需身份验证即可利用部分漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat 3.11、3.12和3.13版本中存在的NoSQL注入漏洞。此漏洞由于不正确的输入验证导致，允许未经身份验证的攻击者注入恶意NoSQL查询，最终可能导致远程代码执行(RCE)。

**漏洞利用方式：**

1.  **账户劫持 (未授权):** `getPasswordPolicy` 端点中的 `token` 参数存在NoSQL注入，允许使用 `$regex` 操作符进行盲注来获取重置令牌。
2.  **权限提升至管理员 (已授权):**  `users.list` API 端点的 `query` 参数也存在NoSQL注入。通过构造特定的 `$where` 子句并抛出异常，可以检索管理员用户的敏感信息，例如 2FA secret 或密码重置令牌。
3.  **远程代码执行 (已授权 - 管理员):** 利用Rocket.Chat的Integrations功能，创建带有恶意脚本的webhook，当webhook被触发时，脚本会被执行，从而实现RCE。

**POC代码分析：**

POC代码提供了完整的漏洞利用流程，包括：

*   发送密码重置邮件
*   盲注获取重置令牌
*   使用重置令牌更改密码
*   利用`users.list`接口通过NoSQL注入获取管理员的2FA密钥或者reset token。
*   创建包含恶意代码的Integration Webhook，执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的POC代码，此漏洞利用是有效的。 Exploit-DB 和 GitHub 上都存在相关的利用代码。

**投毒风险评估：**

POC代码主要目的是利用漏洞，但存在一定潜在的投毒风险。例如：

*   在创建Integration Webhook时，如果将执行命令部分替换为恶意代码，可能会对目标服务器造成破坏。
*   利用脚本对服务器进行持续性的扫描行为，尝试控制其他服务器。

评估结果： 投毒风险为10%。风险主要存在于使用者利用该POC进行恶意操作的可能性，而非代码本身存在明显的后门。

**利用条件：**

*   目标Rocket.Chat服务器运行在受影响的版本。
*   服务器可以访问。
*   如果管理员启用了2FA，则需要通过NoSQL注入泄露2FA密钥或者重置token。


**项目地址:** [CsEnox/CVE-2021-22911](https://github.com/CsEnox/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #3

**来源**: [CVE-2021-22911-MrDottt_CVE-2021-22911.md](../2021/CVE-2021-22911-MrDottt_CVE-2021-22911.md)

# CVE-2021-22911

> 📦 该CVE有 **7** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-22911-ChrisPritchard_CVE-2021-22911-rust.md](../2021/CVE-2021-22911-ChrisPritchard_CVE-2021-22911-rust.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致RCE（远程代码执行）

**影响版本:** 3.11, 3.12, 3.13 (修复版本: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 需要网络访问，且目标服务器运行存在漏洞的Rocket.Chat版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的NoSQL注入漏洞。由于不正确的输入清理，攻击者可以通过未经身份验证的API端点进行NoSQL注入，从而可能导致远程代码执行（RCE）。

**有效性：**根据提供的漏洞库信息、搜索结果和漏洞利用代码，该漏洞的POC是有效的。搜索结果中包含了多个指向expolit-db和github的链接，表明存在公开的POC，可以验证该漏洞。

**投毒风险：**提供的代码片段是`Cargo.lock`文件，它只是用于记录Rust项目依赖项的版本信息，本身不包含任何可执行代码。因此，直接从这个文件判断投毒风险是不可行的。需要分析完整的POC代码才能进行评估。鉴于缺乏完整POC源码，假设部分依赖项存在潜在风险，投毒风险评估为10%。

**利用方式：**

1.  **确定目标版本：** 首先需要确定目标Rocket.Chat服务器的版本是否在受影响的范围内（3.11, 3.12, 3.13）。
2.  **构造恶意请求：** 攻击者构造包含恶意NoSQL查询语句的HTTP请求，发送到存在漏洞的API端点。攻击者利用不正确的输入验证，将恶意的NoSQL代码注入到查询语句中。
3.  **执行任意代码：** 成功注入后，恶意NoSQL查询被执行，导致服务器执行攻击者预先设定的任意代码。这通常通过利用MongoDB的JavaScript执行功能实现，例如 `$where` 操作符。
4.  **远程代码执行：** 通过执行任意代码，攻击者可以获取服务器的控制权，进行诸如数据窃取、恶意软件安装等恶意操作。

**项目地址:** [ChrisPritchard/CVE-2021-22911-rust](https://github.com/ChrisPritchard/CVE-2021-22911-rust)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #2

**来源**: [CVE-2021-22911-CsEnox_CVE-2021-22911.md](../2021/CVE-2021-22911-CsEnox_CVE-2021-22911.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 需要目标Rocket.Chat服务器可访问，无需身份验证即可利用部分漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat 3.11、3.12和3.13版本中存在的NoSQL注入漏洞。此漏洞由于不正确的输入验证导致，允许未经身份验证的攻击者注入恶意NoSQL查询，最终可能导致远程代码执行(RCE)。

**漏洞利用方式：**

1.  **账户劫持 (未授权):** `getPasswordPolicy` 端点中的 `token` 参数存在NoSQL注入，允许使用 `$regex` 操作符进行盲注来获取重置令牌。
2.  **权限提升至管理员 (已授权):**  `users.list` API 端点的 `query` 参数也存在NoSQL注入。通过构造特定的 `$where` 子句并抛出异常，可以检索管理员用户的敏感信息，例如 2FA secret 或密码重置令牌。
3.  **远程代码执行 (已授权 - 管理员):** 利用Rocket.Chat的Integrations功能，创建带有恶意脚本的webhook，当webhook被触发时，脚本会被执行，从而实现RCE。

**POC代码分析：**

POC代码提供了完整的漏洞利用流程，包括：

*   发送密码重置邮件
*   盲注获取重置令牌
*   使用重置令牌更改密码
*   利用`users.list`接口通过NoSQL注入获取管理员的2FA密钥或者reset token。
*   创建包含恶意代码的Integration Webhook，执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的POC代码，此漏洞利用是有效的。 Exploit-DB 和 GitHub 上都存在相关的利用代码。

**投毒风险评估：**

POC代码主要目的是利用漏洞，但存在一定潜在的投毒风险。例如：

*   在创建Integration Webhook时，如果将执行命令部分替换为恶意代码，可能会对目标服务器造成破坏。
*   利用脚本对服务器进行持续性的扫描行为，尝试控制其他服务器。

评估结果： 投毒风险为10%。风险主要存在于使用者利用该POC进行恶意操作的可能性，而非代码本身存在明显的后门。

**利用条件：**

*   目标Rocket.Chat服务器运行在受影响的版本。
*   服务器可以访问。
*   如果管理员启用了2FA，则需要通过NoSQL注入泄露2FA密钥或者重置token。


**项目地址:** [CsEnox/CVE-2021-22911](https://github.com/CsEnox/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #3

**来源**: [CVE-2021-22911-jayngng_CVE-2021-22911.md](../2021/CVE-2021-22911-jayngng_CVE-2021-22911.md)

## CVE-2021-22911 - Rocket.Chat NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行和数据泄露

**影响版本:** 3.11, 3.12, 3.13 (受影响)

**利用条件:** 目标服务器运行受影响的Rocket.Chat版本，且攻击者可以访问Rocket.Chat服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Rocket.Chat服务器的输入验证中，允许未经身份验证的攻击者通过构造恶意的NoSQL查询来执行任意代码。利用方式如下：

1.  **信息收集：** 收集目标Rocket.Chat服务器的信息，包括版本号等，确定是否存在漏洞。
2.  **密码重置：** 利用未授权的API接口触发密码重置流程，向目标管理员邮箱发送密码重置邮件。
3.  **NoSQL注入获取Token：** 通过构造恶意的NoSQL查询，利用`getPasswordPolicy`接口泄漏管理员的密码重置token。
4.  **密码重置和账户接管：** 使用获取的token重置管理员密码，从而接管管理员账户。
5.  **获取2FA密钥（如果启用）：** 通过API接口获取管理员账户的2FA密钥。
6.  **代码分析与有效性：**
    *   POC代码首先发送管理员的密码重置请求，然后利用NoSQL注入漏洞，通过正则表达式匹配的方式逐步猜解管理员的密码重置token。
    *   成功获取token后，使用该token重置管理员密码，从而控制管理员账户。
    *   如果管理员启用了两因素认证（2FA），POC代码还会尝试通过NoSQL注入获取2FA密钥。
    *   根据 exploit-db 和 github 的信息以及代码功能推断该poc有效。
7.  **投毒风险分析：**
    *   **依赖风险：** 代码中使用了requests, string, time, hashlib, json, oathtool, argparse等模块，使用者可能需要安装，存在一定的依赖风险。
    *   **恶意代码风险：** 代码整体逻辑符合漏洞利用的逻辑。但仍存在作者在代码中植入恶意代码的可能性。例如，在身份验证时，如果判断到某个特定IP或者User-Agent就执行特定恶意代码，但是公开的exp并没有完全展示所有代码逻辑。因此，存在一定投毒风险，个人认为风险比例为10%。主要集中在利用成功后执行的恶意代码。
8.  **缓解措施：**
    *   升级到Rocket.Chat的安全版本（>= 3.13.2, >= 3.12.4, >= 3.11.4）。
    *   实施强输入验证和过滤，以防止NoSQL注入攻击。
    *   启用并强制使用多因素身份验证（MFA）。
    *   定期进行安全审计和漏洞扫描。

**项目地址:** [jayngng/CVE-2021-22911](https://github.com/jayngng/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #4

**来源**: [CVE-2021-22911-octodi_CVE-2021-22911.md](../2021/CVE-2021-22911-octodi_CVE-2021-22911.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，未授权RCE

**影响版本:** 3.11, 3.12 & 3.13

**利用条件:** 目标服务器运行存在漏洞的Rocket.Chat版本，且网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的一个不当输入清理漏洞。此漏洞存在于3.11、3.12和3.13版本中，可能导致未经身份验证的NoSQL注入，从而可能导致远程代码执行（RCE）。

**有效性：**

提供的PoC代码尝试利用NoSQL注入来获得管理员权限，然后更改密码以进行RCE。根据漏洞描述、搜索引擎结果（特别是Exploit-DB和GitHub上的PoC）以及PoC代码本身来看，该PoC**有效**。PoC通过NoSQL注入获取管理员的重置令牌，然后利用此令牌重置管理员密码，从而控制管理员帐户。

**投毒风险：**

PoC代码主要包含以下几个步骤：

1.  向管理员邮箱发送密码重置邮件。
2.  利用NoSQL注入漏洞，通过`getPasswordPolicy`方法泄露密码重置token.
3.  使用泄露的token重置管理员密码。
4.  如果目标启用了2FA，则通过另外的NoSQL注入尝试获取2FA secret.
5.  如果成功获取2FA secret，则使用该secret和重置后的密码登录管理员账户。

代码本身没有明显的恶意行为，例如直接执行系统命令，或者安装后门。代码的目的是利用漏洞获取管理员权限，然后修改密码。
投毒风险评估：**10%**。

风险主要在于以下几个方面：
*   **依赖性风险** 该PoC依赖于第三方库，比如requests, hashlib, json, oathtool，篡改依赖库可能引入恶意代码。
*   **滥用风险**：PoC的公开可能导致漏洞被大规模利用，对Rocket.Chat服务器造成损害。
*   **信息泄露风险**：如果在测试或使用PoC时，不小心泄露了管理员邮箱、密码或其他敏感信息，可能会导致安全问题。

**利用方式：**

1.  **目标确定：** 确定运行着受影响Rocket.Chat版本的服务器。
2.  **发送重置邮件：** 使用`sendForgotPasswordEmail`方法向管理员账户发送密码重置邮件。
3.  **NoSQL注入获取重置token：** 通过构造恶意的NoSQL查询，利用`getPasswordPolicy`方法，提取管理员密码重置token。
4.  **密码重置：** 使用获取的重置token和攻击者指定的密码，通过`resetPassword`方法重置管理员密码。
5.  **（如果需要）获取2FA Secret**: 如果管理员账号启用了两步验证，通过NoSQL注入尝试拿到两步验证的secret，进一步生成验证码进行登录。
6.  **登录管理员账户：** 使用新设置的密码（和两步验证码），登录管理员账户，从而控制整个Rocket.Chat服务器。
7.  **远程代码执行：**  获得管理员权限后，可以通过Rocket.Chat的管理界面或者API执行恶意操作，例如安装恶意插件或修改配置，从而实现远程代码执行。

**项目地址:** [octodi/CVE-2021-22911](https://github.com/octodi/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #5

**来源**: [CVE-2021-22911-optionalCTF_Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911.md](../2021/CVE-2021-22911-optionalCTF_Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911.md)

## CVE-2021-22911 - Rocket.Chat NoSQL 注入导致 RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL 注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致账户接管和远程代码执行

**影响版本:** <= 3.13.1 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标 Rocket.Chat 服务器版本在受影响范围内，且允许未授权访问 API 端点

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911 是 Rocket.Chat 服务器中存在的一个由于不正确的输入清理而导致的 NoSQL 注入漏洞。攻击者可以利用此漏洞在未经身份验证的情况下执行 NoSQL 注入，进而可能导致远程代码执行 (RCE) 和账户接管。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞的 PoC 代码是有效的。存在多个公开的 PoC 证明了该漏洞的可利用性。

**投毒风险评估：**

评估提供的 PoC 代码，发现以下潜在的投毒风险点：

*   **依赖第三方库：** PoC 代码依赖 `requests`，`string`, `time`, `hashlib`, `json`, `oathtool` 和 `argparse`。虽然这些都是常见的 Python 库，但如果攻击者修改 PoC 代码，使其依赖恶意版本的库，可能会引入额外的安全风险。
*   **远程代码执行：** 该漏洞本身就允许 RCE，因此攻击者可能会在成功利用漏洞后，植入恶意代码。
*   **逻辑复杂性：** 账户接管的逻辑较为复杂，攻击者可能在其中添加不易察觉的后门。
*   **2FA绕过承诺：**作者提及会增加2FA绕过功能，这可能导致更严重的安全问题，也增加了代码复杂性。

总体而言，PoC 代码本身看起来相对直接，主要集中在利用 NoSQL 注入实现账户接管。**投毒风险评估约为10%。** 主要风险在于代码的维护者可能引入恶意依赖或添加后门。

**利用方式分析：**

1.  **注册用户（如果不存在）：** 脚本首先尝试使用提供的电子邮件地址注册一个低权限用户。如果用户已经存在，则尝试使用提供的密码进行身份验证。
2.  **密码重置流程：** 如果无法使用提供的密码进行身份验证，脚本会启动密码重置流程。
    *   发送密码重置邮件。
    *   利用 NoSQL 注入漏洞，暴力破解密码重置令牌（token）。
    *   使用破解的令牌更改目标账户的密码。
3.  **登录账户：** 使用新密码登录目标账户。
4.  **远程代码执行 (RCE):** 成功登录后，可以利用NoSQL注入漏洞执行任意代码。
5.  **2FA绕过（如果目标账户启用了双因素身份验证）：** 脚本可能包含绕过双因素身份验证的逻辑。由于此部分代码未提供，具体绕过方式未知，但可能涉及 NoSQL 注入或其它漏洞利用技术。

**总结：**

CVE-2021-22911 是一个高危漏洞，攻击者可以利用该漏洞在未经身份验证的情况下接管 Rocket.Chat 账户并执行任意代码。建议用户尽快升级到安全版本。

**项目地址:** [optionalCTF/Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911](https://github.com/optionalCTF/Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #6

**来源**: [CVE-2021-22911-overgrowncarrot1_CVE-2021-22911.md](../2021/CVE-2021-22911-overgrowncarrot1_CVE-2021-22911.md)

## CVE-2021-22911 Rocket.Chat NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标Rocket.Chat服务器版本在受影响范围内，且允许未授权访问API接口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的一个NoSQL注入漏洞。由于未对用户输入进行充分的清理，攻击者可以通过构造恶意的NoSQL查询语句，绕过身份验证并执行任意代码。

**利用方式：**

1.  **密码重置流程利用：** 攻击者首先利用`sendForgotPasswordEmail`方法向管理员邮箱发送密码重置邮件。由于存在NoSQL注入漏洞，攻击者可以通过`getPasswordPolicy`方法，利用正则表达式盲注获取密码重置Token。
2.  **重置管理员密码：**  获得Token后，攻击者调用`resetPassword`方法重置管理员密码。
3.  **身份验证与RCE：** 使用重置后的密码登录管理员帐户。然后，通过创建Webhook集成，并在集成脚本中嵌入反向Shell代码，实现远程代码执行。具体来说，`process_incoming_request`函数中的`exec`函数被用来执行恶意命令，建立反向连接到攻击者的监听端口。

**关于投毒风险：**

分析提供的Python脚本，该脚本的主要功能是自动化利用CVE-2021-22911漏洞，重置管理员密码，然后通过创建集成并执行反向shell来实现RCE。代码没有明显的投毒行为，例如未经授权的数据收集、恶意文件上传或对目标系统进行破坏性操作。脚本的行为符合漏洞利用的预期。`README.md` 文件提供了如何使用脚本的说明，也没有任何恶意指示。

因此，判断此仓库中不存在作者隐藏的投毒代码的可能性较高，可能性为0%。

**项目地址:** [overgrowncarrot1/CVE-2021-22911](https://github.com/overgrowncarrot1/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #7

**来源**: [CVE-2021-22911-yoohhuu_Rocket-Chat-3.12.1-PoC-CVE-2021-22911-.md](../2021/CVE-2021-22911-yoohhuu_Rocket-Chat-3.12.1-PoC-CVE-2021-22911-.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标系统运行存在漏洞的Rocket.Chat版本，且攻击者能够通过网络访问Rocket.Chat服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat 3.11、3.12和3.13版本中存在的NoSQL注入漏洞。由于未正确过滤输入，未经身份验证的攻击者可以利用此漏洞进行NoSQL注入，最终可能导致远程代码执行(RCE)。

**有效性：**

根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞的POC代码是有效的。 搜索引擎结果中Exploit-DB提供了expolit代码(50108.py), 以及github上存在完整的RCE利用(Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911)。提供的POC代码 (rocketchat.py) 实现了利用该漏洞重置管理员密码并获得管理员权限，然后可执行任意代码。

**投毒风险：**

分析POC代码，发现rocketchat.py脚本中主要功能为利用NoSQL注入重置管理员密码，然后通过修改管理员密码登录并执行命令。未发现明显恶意代码。`README.md`文件提供利用说明，帮助用户完成漏洞验证。但考虑到任何代码都存在潜在风险，作者有可能通过细微修改增加恶意行为，例如上传webshell，添加后门账号等。因此投毒风险较低，估计为10%。

**利用方式：**

1.  **目标识别：** 确定目标Rocket.Chat服务器运行的版本在3.11, 3.12 & 3.13范围内。
2.  **发送密码重置请求：** 针对低权限用户和管理员邮箱，利用`sendForgotPasswordEmail`方法发送密码重置邮件。
3.  **获取Reset Token：** 利用`getPasswordPolicy`方法中的NoSQL注入漏洞，通过正则表达式匹配的方式逐步获取管理员密码重置的token。
4.  **重置管理员密码：** 使用获取到的token，调用`resetPassword`方法重置管理员密码为已知密码。
5.  **双因素认证绕过/获取管理员Token:** 若目标开启双因素认证，则利用NoSQL注入漏洞获取管理员的2FA secret, 获取管理员token后可以执行任意命令实现RCE。
6.  **登录并执行命令:** 使用新密码登录管理员帐户，然后执行任意代码以实现RCE。

总而言之，该漏洞的利用方式较为复杂，需要多个步骤才能最终实现RCE。但由于是不需要授权的NoSQL注入，利用的危害性很高。

**项目地址:** [yoohhuu/Rocket-Chat-3.12.1-PoC-CVE-2021-22911-](https://github.com/yoohhuu/Rocket-Chat-3.12.1-PoC-CVE-2021-22911-)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---



---

## POC #4

**来源**: [CVE-2021-22911-jayngng_CVE-2021-22911.md](../2021/CVE-2021-22911-jayngng_CVE-2021-22911.md)

## CVE-2021-22911 - Rocket.Chat NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行和数据泄露

**影响版本:** 3.11, 3.12, 3.13 (受影响)

**利用条件:** 目标服务器运行受影响的Rocket.Chat版本，且攻击者可以访问Rocket.Chat服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Rocket.Chat服务器的输入验证中，允许未经身份验证的攻击者通过构造恶意的NoSQL查询来执行任意代码。利用方式如下：

1.  **信息收集：** 收集目标Rocket.Chat服务器的信息，包括版本号等，确定是否存在漏洞。
2.  **密码重置：** 利用未授权的API接口触发密码重置流程，向目标管理员邮箱发送密码重置邮件。
3.  **NoSQL注入获取Token：** 通过构造恶意的NoSQL查询，利用`getPasswordPolicy`接口泄漏管理员的密码重置token。
4.  **密码重置和账户接管：** 使用获取的token重置管理员密码，从而接管管理员账户。
5.  **获取2FA密钥（如果启用）：** 通过API接口获取管理员账户的2FA密钥。
6.  **代码分析与有效性：**
    *   POC代码首先发送管理员的密码重置请求，然后利用NoSQL注入漏洞，通过正则表达式匹配的方式逐步猜解管理员的密码重置token。
    *   成功获取token后，使用该token重置管理员密码，从而控制管理员账户。
    *   如果管理员启用了两因素认证（2FA），POC代码还会尝试通过NoSQL注入获取2FA密钥。
    *   根据 exploit-db 和 github 的信息以及代码功能推断该poc有效。
7.  **投毒风险分析：**
    *   **依赖风险：** 代码中使用了requests, string, time, hashlib, json, oathtool, argparse等模块，使用者可能需要安装，存在一定的依赖风险。
    *   **恶意代码风险：** 代码整体逻辑符合漏洞利用的逻辑。但仍存在作者在代码中植入恶意代码的可能性。例如，在身份验证时，如果判断到某个特定IP或者User-Agent就执行特定恶意代码，但是公开的exp并没有完全展示所有代码逻辑。因此，存在一定投毒风险，个人认为风险比例为10%。主要集中在利用成功后执行的恶意代码。
8.  **缓解措施：**
    *   升级到Rocket.Chat的安全版本（>= 3.13.2, >= 3.12.4, >= 3.11.4）。
    *   实施强输入验证和过滤，以防止NoSQL注入攻击。
    *   启用并强制使用多因素身份验证（MFA）。
    *   定期进行安全审计和漏洞扫描。

**项目地址:** [jayngng/CVE-2021-22911](https://github.com/jayngng/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #5

**来源**: [CVE-2021-22911-octodi_CVE-2021-22911.md](../2021/CVE-2021-22911-octodi_CVE-2021-22911.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，未授权RCE

**影响版本:** 3.11, 3.12 & 3.13

**利用条件:** 目标服务器运行存在漏洞的Rocket.Chat版本，且网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的一个不当输入清理漏洞。此漏洞存在于3.11、3.12和3.13版本中，可能导致未经身份验证的NoSQL注入，从而可能导致远程代码执行（RCE）。

**有效性：**

提供的PoC代码尝试利用NoSQL注入来获得管理员权限，然后更改密码以进行RCE。根据漏洞描述、搜索引擎结果（特别是Exploit-DB和GitHub上的PoC）以及PoC代码本身来看，该PoC**有效**。PoC通过NoSQL注入获取管理员的重置令牌，然后利用此令牌重置管理员密码，从而控制管理员帐户。

**投毒风险：**

PoC代码主要包含以下几个步骤：

1.  向管理员邮箱发送密码重置邮件。
2.  利用NoSQL注入漏洞，通过`getPasswordPolicy`方法泄露密码重置token.
3.  使用泄露的token重置管理员密码。
4.  如果目标启用了2FA，则通过另外的NoSQL注入尝试获取2FA secret.
5.  如果成功获取2FA secret，则使用该secret和重置后的密码登录管理员账户。

代码本身没有明显的恶意行为，例如直接执行系统命令，或者安装后门。代码的目的是利用漏洞获取管理员权限，然后修改密码。
投毒风险评估：**10%**。

风险主要在于以下几个方面：
*   **依赖性风险** 该PoC依赖于第三方库，比如requests, hashlib, json, oathtool，篡改依赖库可能引入恶意代码。
*   **滥用风险**：PoC的公开可能导致漏洞被大规模利用，对Rocket.Chat服务器造成损害。
*   **信息泄露风险**：如果在测试或使用PoC时，不小心泄露了管理员邮箱、密码或其他敏感信息，可能会导致安全问题。

**利用方式：**

1.  **目标确定：** 确定运行着受影响Rocket.Chat版本的服务器。
2.  **发送重置邮件：** 使用`sendForgotPasswordEmail`方法向管理员账户发送密码重置邮件。
3.  **NoSQL注入获取重置token：** 通过构造恶意的NoSQL查询，利用`getPasswordPolicy`方法，提取管理员密码重置token。
4.  **密码重置：** 使用获取的重置token和攻击者指定的密码，通过`resetPassword`方法重置管理员密码。
5.  **（如果需要）获取2FA Secret**: 如果管理员账号启用了两步验证，通过NoSQL注入尝试拿到两步验证的secret，进一步生成验证码进行登录。
6.  **登录管理员账户：** 使用新设置的密码（和两步验证码），登录管理员账户，从而控制整个Rocket.Chat服务器。
7.  **远程代码执行：**  获得管理员权限后，可以通过Rocket.Chat的管理界面或者API执行恶意操作，例如安装恶意插件或修改配置，从而实现远程代码执行。

**项目地址:** [octodi/CVE-2021-22911](https://github.com/octodi/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #6

**来源**: [CVE-2021-22911-optionalCTF_Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911.md](../2021/CVE-2021-22911-optionalCTF_Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911.md)

## CVE-2021-22911 - Rocket.Chat NoSQL 注入导致 RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL 注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致账户接管和远程代码执行

**影响版本:** <= 3.13.1 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标 Rocket.Chat 服务器版本在受影响范围内，且允许未授权访问 API 端点

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911 是 Rocket.Chat 服务器中存在的一个由于不正确的输入清理而导致的 NoSQL 注入漏洞。攻击者可以利用此漏洞在未经身份验证的情况下执行 NoSQL 注入，进而可能导致远程代码执行 (RCE) 和账户接管。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞的 PoC 代码是有效的。存在多个公开的 PoC 证明了该漏洞的可利用性。

**投毒风险评估：**

评估提供的 PoC 代码，发现以下潜在的投毒风险点：

*   **依赖第三方库：** PoC 代码依赖 `requests`，`string`, `time`, `hashlib`, `json`, `oathtool` 和 `argparse`。虽然这些都是常见的 Python 库，但如果攻击者修改 PoC 代码，使其依赖恶意版本的库，可能会引入额外的安全风险。
*   **远程代码执行：** 该漏洞本身就允许 RCE，因此攻击者可能会在成功利用漏洞后，植入恶意代码。
*   **逻辑复杂性：** 账户接管的逻辑较为复杂，攻击者可能在其中添加不易察觉的后门。
*   **2FA绕过承诺：**作者提及会增加2FA绕过功能，这可能导致更严重的安全问题，也增加了代码复杂性。

总体而言，PoC 代码本身看起来相对直接，主要集中在利用 NoSQL 注入实现账户接管。**投毒风险评估约为10%。** 主要风险在于代码的维护者可能引入恶意依赖或添加后门。

**利用方式分析：**

1.  **注册用户（如果不存在）：** 脚本首先尝试使用提供的电子邮件地址注册一个低权限用户。如果用户已经存在，则尝试使用提供的密码进行身份验证。
2.  **密码重置流程：** 如果无法使用提供的密码进行身份验证，脚本会启动密码重置流程。
    *   发送密码重置邮件。
    *   利用 NoSQL 注入漏洞，暴力破解密码重置令牌（token）。
    *   使用破解的令牌更改目标账户的密码。
3.  **登录账户：** 使用新密码登录目标账户。
4.  **远程代码执行 (RCE):** 成功登录后，可以利用NoSQL注入漏洞执行任意代码。
5.  **2FA绕过（如果目标账户启用了双因素身份验证）：** 脚本可能包含绕过双因素身份验证的逻辑。由于此部分代码未提供，具体绕过方式未知，但可能涉及 NoSQL 注入或其它漏洞利用技术。

**总结：**

CVE-2021-22911 是一个高危漏洞，攻击者可以利用该漏洞在未经身份验证的情况下接管 Rocket.Chat 账户并执行任意代码。建议用户尽快升级到安全版本。

**项目地址:** [optionalCTF/Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911](https://github.com/optionalCTF/Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #7

**来源**: [CVE-2021-22911-overgrowncarrot1_CVE-2021-22911.md](../2021/CVE-2021-22911-overgrowncarrot1_CVE-2021-22911.md)

## CVE-2021-22911 Rocket.Chat NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标Rocket.Chat服务器版本在受影响范围内，且允许未授权访问API接口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的一个NoSQL注入漏洞。由于未对用户输入进行充分的清理，攻击者可以通过构造恶意的NoSQL查询语句，绕过身份验证并执行任意代码。

**利用方式：**

1.  **密码重置流程利用：** 攻击者首先利用`sendForgotPasswordEmail`方法向管理员邮箱发送密码重置邮件。由于存在NoSQL注入漏洞，攻击者可以通过`getPasswordPolicy`方法，利用正则表达式盲注获取密码重置Token。
2.  **重置管理员密码：**  获得Token后，攻击者调用`resetPassword`方法重置管理员密码。
3.  **身份验证与RCE：** 使用重置后的密码登录管理员帐户。然后，通过创建Webhook集成，并在集成脚本中嵌入反向Shell代码，实现远程代码执行。具体来说，`process_incoming_request`函数中的`exec`函数被用来执行恶意命令，建立反向连接到攻击者的监听端口。

**关于投毒风险：**

分析提供的Python脚本，该脚本的主要功能是自动化利用CVE-2021-22911漏洞，重置管理员密码，然后通过创建集成并执行反向shell来实现RCE。代码没有明显的投毒行为，例如未经授权的数据收集、恶意文件上传或对目标系统进行破坏性操作。脚本的行为符合漏洞利用的预期。`README.md` 文件提供了如何使用脚本的说明，也没有任何恶意指示。

因此，判断此仓库中不存在作者隐藏的投毒代码的可能性较高，可能性为0%。

**项目地址:** [overgrowncarrot1/CVE-2021-22911](https://github.com/overgrowncarrot1/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

## POC #8

**来源**: [CVE-2021-22911-yoohhuu_Rocket-Chat-3.12.1-PoC-CVE-2021-22911-.md](../2021/CVE-2021-22911-yoohhuu_Rocket-Chat-3.12.1-PoC-CVE-2021-22911-.md)

## CVE-2021-22911-Rocket.Chat-NoSQL注入

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in: 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标系统运行存在漏洞的Rocket.Chat版本，且攻击者能够通过网络访问Rocket.Chat服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22911是Rocket.Chat 3.11、3.12和3.13版本中存在的NoSQL注入漏洞。由于未正确过滤输入，未经身份验证的攻击者可以利用此漏洞进行NoSQL注入，最终可能导致远程代码执行(RCE)。

**有效性：**

根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞的POC代码是有效的。 搜索引擎结果中Exploit-DB提供了expolit代码(50108.py), 以及github上存在完整的RCE利用(Rocket.Chat-Automated-Account-Takeover-RCE-CVE-2021-22911)。提供的POC代码 (rocketchat.py) 实现了利用该漏洞重置管理员密码并获得管理员权限，然后可执行任意代码。

**投毒风险：**

分析POC代码，发现rocketchat.py脚本中主要功能为利用NoSQL注入重置管理员密码，然后通过修改管理员密码登录并执行命令。未发现明显恶意代码。`README.md`文件提供利用说明，帮助用户完成漏洞验证。但考虑到任何代码都存在潜在风险，作者有可能通过细微修改增加恶意行为，例如上传webshell，添加后门账号等。因此投毒风险较低，估计为10%。

**利用方式：**

1.  **目标识别：** 确定目标Rocket.Chat服务器运行的版本在3.11, 3.12 & 3.13范围内。
2.  **发送密码重置请求：** 针对低权限用户和管理员邮箱，利用`sendForgotPasswordEmail`方法发送密码重置邮件。
3.  **获取Reset Token：** 利用`getPasswordPolicy`方法中的NoSQL注入漏洞，通过正则表达式匹配的方式逐步获取管理员密码重置的token。
4.  **重置管理员密码：** 使用获取到的token，调用`resetPassword`方法重置管理员密码为已知密码。
5.  **双因素认证绕过/获取管理员Token:** 若目标开启双因素认证，则利用NoSQL注入漏洞获取管理员的2FA secret, 获取管理员token后可以执行任意命令实现RCE。
6.  **登录并执行命令:** 使用新密码登录管理员帐户，然后执行任意代码以实现RCE。

总而言之，该漏洞的利用方式较为复杂，需要多个步骤才能最终实现RCE。但由于是不需要授权的NoSQL注入，利用的危害性很高。

**项目地址:** [yoohhuu/Rocket-Chat-3.12.1-PoC-CVE-2021-22911-](https://github.com/yoohhuu/Rocket-Chat-3.12.1-PoC-CVE-2021-22911-)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)

---

