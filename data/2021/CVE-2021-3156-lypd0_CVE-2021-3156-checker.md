## CVE-2021-3156 - Sudo (类Unix系统的权限管理工具) 堆溢出 (Heap-based Buffer Overflow)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆溢出 (Heap-based Buffer Overflow)

**影响应用:** Sudo (类Unix系统的权限管理工具)

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Sudo 1.8.2 到 1.8.31p2; 1.9.0 到 1.9.5p1

**利用条件:** 攻击者必须拥有本地受限用户权限，能够执行sudoedit命令。

**POC 可用性:** 4/10

**POC 类型:** 概念验证 (检查工具)

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：本提供的Python代码并非完整的漏洞利用脚本（Exploit），而是一个纯粹的版本检测工具（Checker）。该脚本的核心逻辑是通过调用系统命令'sudo --version'获取当前主机的Sudo版本号，并将其与预定义的受影响版本列表进行匹配。从有效性角度来看，这种基于版本的检测方法存在‘漏报’或‘误报’的可能性，因为部分发行版（如Red Hat或Ubuntu）可能会通过补丁回拷（Backporting）的方式在不改变主版本号的情况下修复漏洞。虽然它不能百分之百确认漏洞存在，但作为初步排查工具，其逻辑清晰、无副作用。该脚本并未尝试触发缓冲区溢出攻击，不涉及内存分配或非法字符输入，因此无法直接证明系统确实可被溢出，仅能证明其处于理论风险区间。利用步骤分析：1. 获取目标主机的本地低权限Shell；2. 上传并执行此Python检测脚本；3. 脚本输出当前Sudo版本及风险提示；4. 若确认为漏洞版本，攻击者通常会寻找更深入的C语言编写的Exploit。真正的漏洞利用通常涉及构造特殊的argv参数，并在sudoedit -s模式下利用末尾的反斜杠（\）绕过转义逻辑，从而触发堆溢出。投毒风险分析：该脚本展示了极低的投毒风险（评估为5%）。首先，代码逻辑完全透明，主要依赖Python标准库中的subprocess模块，不涉及网络连接、动态代码执行（exec/eval）或混淆手段。其次，脚本行为仅限于读取sudo版本信息，不涉及敏感文件的读取（如/etc/shadow）或向远程服务器发送数据。脚本开头的ASCII艺术文字仅为装饰性。唯一微小的风险点在于，在不受信任的环境中下载此类脚本时，需确保下载源的安全。目前的实现中，subprocess调用的是系统默认路径下的sudo，不存在明显的路径劫持风险。该脚本是典型的防御性安全工具，其代码的可读性和功能单一性使其成为安全的审计辅助工具，未发现任何恶意载荷或后门植入迹象。

**项目地址:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)
