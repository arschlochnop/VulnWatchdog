## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中包含 polkit 的版本（自 2009 年起）

**利用条件:** 攻击者必须拥有目标系统的本地用户访问权限（Shell 访问）

**POC 可用性:** 4/10

**POC 类型:** 概念验证/重写代码

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：CVE-2021-4034（又称 PwnKit）是 Linux 操作系统中 Polkit 的 pkexec 组件中存在的一个内存损坏漏洞。该漏洞源于 pkexec 对命令行参数（argc）的处理不当。当 argc 为 0 时，pkexec 会尝试读取并执行环境变量作为命令行参数，从而导致越界读取和注入恶意环境变量（如 GCONV_PATH）。通过操纵环境变量，攻击者可以强制 pkexec 加载并执行攻击者控制的共享库文件。本提供的 POC 属于对该漏洞的重写版本。虽然 README 表明其为重写版，但由于缺乏核心利用逻辑代码（如 exploit.c 或 payload 构造部分），仅从 README 判断，其有效性取决于其实现是否完整还原了原有的内存布局破坏过程。利用步骤：1. 攻击者登录具有普通用户权限的 Linux 系统。2. 编译该重写版的 POC 代码。3. 运行编译后的程序，该程序会调用 pkexec 并通过环境变量注入手段触发越界写入。4. 利用系统对 GCONV_PATH 的不当处理，加载恶意的 .so 库文件。5. 恶意库文件执行时获得 root 权限，并通常会派生一个 root shell。投毒风险分析：该项目宣称为‘重写版’（A rewrite of the Polkit vulnerability），在安全社区中，此类项目往往存在投毒风险。风险点主要在于：首先，重写版可能在编译脚本（Makefile）或利用代码中嵌入后门，利用安全研究人员急于验证漏洞的心理进行反向控制。其次，该漏洞利用极其稳定且广泛，导致其成为恶意软件作者的首选模板。在本 POC 案例中，由于仅有 README.md 片段，无法通过静态扫描排除其包含恶意二进制下载或 Shellcode 反弹的可能。由于该漏洞利用涉及本地编译环境，研究人员在运行任何未经审计的‘重写版’代码时，应特别注意其是否修改了本地的 .bashrc 或注入了持久化后门。建议在隔离的沙箱环境中进行验证，并仔细检查 C 源码中是否存在隐藏的系统调用。鉴于目前信息，投毒风险处于低至中等水平（15%），主要源于‘重写’声明可能伴随的非原作者不可控代码注入。

**项目地址:** [https://github.com/tmp/vulnwatchdog_680ac8c6c0ecb9bca7c1e5bbdb69da35/](https://www.google.com/search?q=https://github.com/tmp/vulnwatchdog_680ac8c6c0ecb9bca7c1e5bbdb69da35/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
