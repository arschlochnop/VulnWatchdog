# CVE-2021-31956

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31956-Y3A_CVE-2021-31956.md](../2021/CVE-2021-31956-Y3A_CVE-2021-31956.md)

# CVE-2021-31956

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31956-Y3A_CVE-2021-31956.md](../2021/CVE-2021-31956-Y3A_CVE-2021-31956.md)

# CVE-2021-31956

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31956-Y3A_CVE-2021-31956.md](../2021/CVE-2021-31956-Y3A_CVE-2021-31956.md)

# CVE-2021-31956

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-31956-Y3A_CVE-2021-31956.md](../2021/CVE-2021-31956-Y3A_CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 提权漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致本地权限提升

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31956 是一个 Windows NTFS 权限提升漏洞。根据漏洞信息，攻击者可以利用此漏洞在受影响的系统上提升权限。

**有效性：**
提供的POC代码看起来相当完整和复杂，并且附带了 `README.md` 说明其在 Windows 10 20H2 上相对稳定。代码中包含了解析符号、堆喷射、堆碎片、溢出块、读取池和写入池等步骤，表明它试图精确地控制内存布局以实现提权。搜索结果中`nccgroup.com`的博客文章证实了该漏洞的存在，并讨论了成功利用和清理内存所需的步骤。`arcticwolf.com`的报告也提到该漏洞被恶意利用工具包利用。

**投毒风险：**
查看POC代码，可以发现代码中存在一些可疑的地方，但很难确定是否是恶意的后门或仅仅是调试代码。以下是一些潜在的风险点：
* `createfilea()`路径需要修改为一个实际可写的目录，如果攻击者提供恶意路径可能导致拒绝服务。
* 代码中涉及大量的内存操作，例如堆喷射、堆碎片和内存读写，如果操作不当可能导致系统崩溃。虽然代码本身是漏洞利用，但如果经过修改，可能会包含恶意行为。

综合评估，投毒风险较低，约为10%。 仓库可能被用于传播包含漏洞利用程序的代码，这些代码可能被修改以包含额外的恶意功能。用户应谨慎使用这些代码，并在受控环境中进行测试。

**利用方式：**
该漏洞利用涉及以下主要步骤：
1.  **符号解析：** 使用 `resolve_symbols()` 函数解析所需的 Windows API 函数地址。
2.  **获取EPROCESS：** 使用 `get_eproc()` 函数获取当前进程的 EPROCESS 结构地址。
3.  **堆喷射：** 使用 `spray_heap()` 函数进行堆喷射，创建多个 WNF 状态名称对象。
4.  **堆碎片：** 使用 `fragment_heap()` 函数对堆进行碎片化，为后续的溢出创造条件。
5.  **溢出块：** 使用 `overflow_chunk()` 函数进行堆溢出，覆盖相邻的 WNF 状态数据。
6.  **读取池：** 使用 `read_pool()` 函数读取被覆盖的 WNF 状态数据，用于后续的修改。
7.  **查找WNF_NAME_INSTANCE：**  在读取的数据中查找 `WNF_NAME_INSTANCE` 结构，该结构用于后续的任意写操作。
8.  **修改StateData：**  将找到的 `WNF_NAME_INSTANCE` 结构的 `StateData` 成员修改为目标地址（例如线程列表头）。
9.  **写入池：** 使用 `write_pool()` 函数将修改后的 WNF 状态数据写回内存。
10. **利用NtQueryWnfStateData：**  触发 `NtQueryWnfStateData` 函数，利用被修改的 `StateData` 指针进行任意地址读取或写入。
11. **查找KTHREAD：** 在内存中搜索 _KTHREAD 结构，以便进行进一步的提权操作。
12. **修改KTHREAD->PreviousMode：** 通过计算偏移量，将找到的 _KTHREAD 结构的 PreviousMode 成员修改为 KernelMode，从而实现权限提升。

总的来说，这是一个典型的利用堆溢出漏洞进行权限提升的案例。攻击者通过精确控制堆内存的布局，利用 WNF 机制实现任意地址读写，最终修改进程的 PreviousMode 标志位，从而获得系统权限。

**项目地址:** [Y3A/CVE-2021-31956](https://github.com/Y3A/CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #2

**来源**: [CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md](../2021/CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md)

## CVE-2021-31956 Windows NTFS 特权提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 特权提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致本地提权

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要在本地系统上运行恶意代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956 Windows NTFS特权提升漏洞进行评估如下：

**1. 有效性：**

*   根据漏洞库信息，该漏洞影响多个Windows版本，且存在公开的POC。
*   搜索结果中包含多个关于该漏洞的分析文章，例如NCC Group的文章，以及Arctic Wolf提到该漏洞被用于Magnitude Exploit Kit。
*   提供的POC代码似乎利用了NTFS的扩展属性（EA）的某些机制，结合WNF（Windows Notification Facility），来触发内核内存破坏，从而实现提权。具体来说，代码中`NtSetEaFile`函数被用来设置恶意构造的EA，然后`NtQueryEaFile`函数被用来触发漏洞。代码中使用了堆喷射，通过创建大量的WNF状态名，在内存中占据特定区域，提高漏洞利用的成功率。`OVER_STATEDATA_LENGTH`、`OVER_EA_VALUE_LENGTH`等变量控制了溢出的长度，`TIGGER_EA_NAME`和`OVER_EA_NAME`定义了EA的名称，这些参数需要根据目标环境进行调整。

**因此，综合判断，提供的POC代码具有较高的有效性，可以利用该漏洞实现本地提权。**

**2. 投毒风险：**

*   查看POC代码，`ConsoleApplication11.cpp`。代码主要由`initNtDll()`(加载需要的ntdll函数), `tiggerLeak()`(触发漏洞)和`HeapSpray()`(进行堆喷)三个函数组成。
*   `HeapSpray()` 函数中存在可疑的 `upData` 数组, 其中的值没有被初始化, 可能会导致一些不期望的结果, 但不能确定为恶意投毒代码, 因为其行为是进行堆喷操作. `RtlFillMemory(up`这一行可能存在截断，查看完整代码。
*   总体来说，代码逻辑相对清晰，主要集中在利用NTFS EA和WNF机制触发内核漏洞。**初步评估投毒风险较低，约为10%。** 潜在的投毒方式可能存在于精心构造的溢出数据中，例如，将shellcode隐藏在看起来无害的数据中，或者利用一些不常见的API调用执行恶意操作。

**3. 利用方式：**

该漏洞的利用方式大致如下：

1.  **准备环境：** 在目标Windows系统上创建或选择一个存在的文件。
2.  **构造恶意EA：** 使用`NtSetEaFile`函数设置精心构造的NTFS扩展属性。该EA包含溢出数据，用于破坏内核内存。
3.  **触发漏洞：** 使用`NtQueryEaFile`函数查询该文件的EA，触发内核内存破坏。
4.  **堆喷射：** 使用WNF（Windows Notification Facility） API(`NtCreateWnfStateName`, `NtUpdateWnfStateData`)进行堆喷，在内存中创建大量WNF状态名，从而控制内存布局，提高漏洞利用的成功率。
5.  **提权：** 覆盖内核数据结构，将当前进程的权限提升到SYSTEM。
6.  **执行恶意代码：** 利用提升后的权限执行任意代码。

**漏洞利用的关键在于精确控制内存布局，以及构造合适的溢出数据，以便覆盖关键的内核数据结构。**

**项目地址:** [aazhuliang/CVE-2021-31956-EXP](https://github.com/aazhuliang/CVE-2021-31956-EXP)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #3

**来源**: [CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md](../2021/CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** 受影响的Windows版本包括Windows 7至Windows 10 21H1以及相应的Windows Server版本，具体版本号见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956漏洞进行评估如下：

**有效性：**

根据搜索结果，该漏洞是一个Windows NTFS文件系统中的权限提升漏洞，已被公开利用。NCC Group发布了两篇关于该漏洞的分析文章，表明存在可行的利用方式。Arctic Wolf的报告指出，Magnitude Exploit Kit利用了该漏洞。综合来看，该漏洞的POC代码是有效的。

**投毒风险：**

提供的代码文件包括一个C++源代码文件（Pool-Overflow-CVE-2021-31956.cpp）、一个Visual Studio解决方案文件（Pool-Overflow-CVE-2021-31956.sln）和一个Visual Studio项目文件（Pool-Overflow-CVE-2021-31956.vcxproj）。

*   **代码审查：** 没有提供cpp的内容，无法分析

考虑到以上信息，没有足够的信息来判断是否存在投毒代码。通常，投毒会涉及在看似无害的代码中隐藏恶意行为，例如后门或数据窃取。由于缺少cpp的内容，**无法评估投毒风险，因此投毒风险评估为0%。**

**利用方式：**

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS文件系统中的权限提升漏洞，属于内核内存损坏漏洞。利用方式通常涉及以下步骤：

1.  **触发漏洞：** 通过精心构造的NTFS操作（具体细节取决于漏洞的触发机制，一般涉及恶意的文件或者目录操作，或者WNF交互）。
2.  **内存破坏：** 漏洞触发后，会导致内核内存损坏（Paged Pool Overflow）。
3.  **权限提升：** 攻击者利用内存破坏来覆盖内核对象或数据结构，从而获得SYSTEM权限。

总而言之，该漏洞利用的典型步骤是触发漏洞、实现内存破坏，最终达到权限提升的目的。

**项目地址:** [deletehead/Pool-Overflow-CVE-2021-31956](https://github.com/deletehead/Pool-Overflow-CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #4

**来源**: [CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md](../2021/CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS权限提升漏洞。该漏洞允许本地攻击者通过利用NTFS文件系统中的缺陷，提升自己的权限。

**1. 有效性:**

*   搜索结果表明该漏洞已被公开披露，并存在利用代码。
*   提供的漏洞利用代码是一个Visual Studio解决方案，包含C++源代码，表明该漏洞的利用是可行的。
*   README.md文件提到是WIP PoC, 存在不稳定性。

综合判断，提供的POC代码具有一定的有效性，但可能不够稳定，需要进一步完善。

**2. 投毒风险:**

*   分析提供的C++代码需要反编译和代码审计。
*   README.md文件中提到该代码是从其他项目fork而来，存在引用第三方代码的风险。
*   代码的编译环境可能被植入恶意代码。
*   该PoC代码本身是为了利用漏洞，因此也可能包含一些潜在的风险。

综合判断，此仓库中存在一定投毒代码的风险，估计为30%。

**3. 利用方式:**

*   **漏洞原理：** 该漏洞是由于NTFS文件系统处理特定操作时存在缺陷，导致内核内存损坏，从而允许权限提升。
*   **利用步骤：**
    1.  精心构造特定的NTFS文件系统操作，触发漏洞。
    2.  利用内核内存损坏，覆盖关键数据结构，例如进程令牌(Token)。
    3.  将当前进程的令牌替换为SYSTEM用户的令牌，从而提升权限。

    **利用细节**:
        *   该漏洞利用可能涉及到 Windows Notification Facility (WNF)。
        *   利用需要对内核内存布局和数据结构有深入的了解。
        *   利用过程可能需要进行内存池喷射（Pool Feng Shui）等技术，以提高利用的可靠性。

**4. 排序优先级**

    *   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**
        *   搜索引擎结果提供了漏洞相关的分析文章和利用案例，可以帮助了解漏洞的细节和利用方法。
        *   漏洞利用代码提供了实际的POC代码，可以验证漏洞的存在性和利用效果。
        *   漏洞库信息提供了漏洞的基本信息，例如受影响的版本和CVSS评分，可以帮助评估漏洞的风险。


**项目地址:** [hoangprod/CVE-2021-31956-POC](https://github.com/hoangprod/CVE-2021-31956-POC)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #5

**来源**: [CVE-2021-31956-hzshang_CVE-2021-31956.md](../2021/CVE-2021-31956-hzshang_CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** 受影响的Windows版本：Windows 10 Version 1809, Windows Server 2019, Windows 10 Version 1909, Windows 10 Version 21H1, Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2, Windows 10 Version 1507, Windows 10 Version 1607, Windows Server 2016, Windows 7, Windows 8.1, Windows Server 2008, Windows Server 2012等。

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31956 是一个 Windows NTFS 文件系统中的权限提升漏洞。该漏洞允许经过身份验证的攻击者在本地系统上提升权限。漏洞原理是NTFS处理特定操作时存在缺陷，导致内核内存损坏。从搜索引擎结果来看，该漏洞已经被积极利用，并且有相关的分析文章和利用示例。NCC Group的两篇文章深入分析了该漏洞的利用方式，包括如何实现较高的利用成功率以及所需的清理操作。

漏洞利用代码分析：
提供的C++代码尝试利用此漏洞进行权限提升。代码首先创建一个临时文件，然后使用 NtSetEaFile 设置扩展属性（EA）。利用点在于通过精心构造的 EA 信息，覆盖 WNF (Windows Notification Facility) 状态数据结构。代码通过 `EA_append` 函数构造特殊的EA块，其中包括覆盖WNF数据所需的 PoolHeader 和 WNF_STATE_DATA，从而实现内核内存的破坏。

有效性评估：
根据搜索结果和漏洞利用代码分析，可以判断此漏洞利用方式是有效的。搜索引擎结果中提到了有exp（利用），博客文章也详细描述了漏洞的利用过程，提供的POC代码也实现了构造和触发漏洞的逻辑。

投毒风险评估：
从提供的C++代码来看，主要目的是利用NTFS漏洞进行权限提升，没有发现明显的投毒代码。代码主要包括创建文件、设置EA属性、覆盖内核内存等操作。虽然代码存在潜在的风险，如可能导致系统崩溃，但没有证据表明作者故意插入恶意代码以进行进一步的攻击或者控制受害者系统。因此，投毒风险评估为0%。

利用方式总结：
1.  创建一个临时文件。
2.  构造包含恶意数据的扩展属性 (EA) 块，覆盖 WNF 状态数据结构。
3.  使用 NtCreateFile 创建文件。
4.  使用 NtSetEaFile 将构造的 EA 块写入文件，触发漏洞并覆盖内核内存。
5.  利用覆盖后的 WNF 状态数据，最终提升权限。


**项目地址:** [hzshang/CVE-2021-31956](https://github.com/hzshang/CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---



---

## POC #2

**来源**: [CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md](../2021/CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md)

## CVE-2021-31956 Windows NTFS 特权提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 特权提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致本地提权

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要在本地系统上运行恶意代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956 Windows NTFS特权提升漏洞进行评估如下：

**1. 有效性：**

*   根据漏洞库信息，该漏洞影响多个Windows版本，且存在公开的POC。
*   搜索结果中包含多个关于该漏洞的分析文章，例如NCC Group的文章，以及Arctic Wolf提到该漏洞被用于Magnitude Exploit Kit。
*   提供的POC代码似乎利用了NTFS的扩展属性（EA）的某些机制，结合WNF（Windows Notification Facility），来触发内核内存破坏，从而实现提权。具体来说，代码中`NtSetEaFile`函数被用来设置恶意构造的EA，然后`NtQueryEaFile`函数被用来触发漏洞。代码中使用了堆喷射，通过创建大量的WNF状态名，在内存中占据特定区域，提高漏洞利用的成功率。`OVER_STATEDATA_LENGTH`、`OVER_EA_VALUE_LENGTH`等变量控制了溢出的长度，`TIGGER_EA_NAME`和`OVER_EA_NAME`定义了EA的名称，这些参数需要根据目标环境进行调整。

**因此，综合判断，提供的POC代码具有较高的有效性，可以利用该漏洞实现本地提权。**

**2. 投毒风险：**

*   查看POC代码，`ConsoleApplication11.cpp`。代码主要由`initNtDll()`(加载需要的ntdll函数), `tiggerLeak()`(触发漏洞)和`HeapSpray()`(进行堆喷)三个函数组成。
*   `HeapSpray()` 函数中存在可疑的 `upData` 数组, 其中的值没有被初始化, 可能会导致一些不期望的结果, 但不能确定为恶意投毒代码, 因为其行为是进行堆喷操作. `RtlFillMemory(up`这一行可能存在截断，查看完整代码。
*   总体来说，代码逻辑相对清晰，主要集中在利用NTFS EA和WNF机制触发内核漏洞。**初步评估投毒风险较低，约为10%。** 潜在的投毒方式可能存在于精心构造的溢出数据中，例如，将shellcode隐藏在看起来无害的数据中，或者利用一些不常见的API调用执行恶意操作。

**3. 利用方式：**

该漏洞的利用方式大致如下：

1.  **准备环境：** 在目标Windows系统上创建或选择一个存在的文件。
2.  **构造恶意EA：** 使用`NtSetEaFile`函数设置精心构造的NTFS扩展属性。该EA包含溢出数据，用于破坏内核内存。
3.  **触发漏洞：** 使用`NtQueryEaFile`函数查询该文件的EA，触发内核内存破坏。
4.  **堆喷射：** 使用WNF（Windows Notification Facility） API(`NtCreateWnfStateName`, `NtUpdateWnfStateData`)进行堆喷，在内存中创建大量WNF状态名，从而控制内存布局，提高漏洞利用的成功率。
5.  **提权：** 覆盖内核数据结构，将当前进程的权限提升到SYSTEM。
6.  **执行恶意代码：** 利用提升后的权限执行任意代码。

**漏洞利用的关键在于精确控制内存布局，以及构造合适的溢出数据，以便覆盖关键的内核数据结构。**

**项目地址:** [aazhuliang/CVE-2021-31956-EXP](https://github.com/aazhuliang/CVE-2021-31956-EXP)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #3

**来源**: [CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md](../2021/CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** 受影响的Windows版本包括Windows 7至Windows 10 21H1以及相应的Windows Server版本，具体版本号见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956漏洞进行评估如下：

**有效性：**

根据搜索结果，该漏洞是一个Windows NTFS文件系统中的权限提升漏洞，已被公开利用。NCC Group发布了两篇关于该漏洞的分析文章，表明存在可行的利用方式。Arctic Wolf的报告指出，Magnitude Exploit Kit利用了该漏洞。综合来看，该漏洞的POC代码是有效的。

**投毒风险：**

提供的代码文件包括一个C++源代码文件（Pool-Overflow-CVE-2021-31956.cpp）、一个Visual Studio解决方案文件（Pool-Overflow-CVE-2021-31956.sln）和一个Visual Studio项目文件（Pool-Overflow-CVE-2021-31956.vcxproj）。

*   **代码审查：** 没有提供cpp的内容，无法分析

考虑到以上信息，没有足够的信息来判断是否存在投毒代码。通常，投毒会涉及在看似无害的代码中隐藏恶意行为，例如后门或数据窃取。由于缺少cpp的内容，**无法评估投毒风险，因此投毒风险评估为0%。**

**利用方式：**

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS文件系统中的权限提升漏洞，属于内核内存损坏漏洞。利用方式通常涉及以下步骤：

1.  **触发漏洞：** 通过精心构造的NTFS操作（具体细节取决于漏洞的触发机制，一般涉及恶意的文件或者目录操作，或者WNF交互）。
2.  **内存破坏：** 漏洞触发后，会导致内核内存损坏（Paged Pool Overflow）。
3.  **权限提升：** 攻击者利用内存破坏来覆盖内核对象或数据结构，从而获得SYSTEM权限。

总而言之，该漏洞利用的典型步骤是触发漏洞、实现内存破坏，最终达到权限提升的目的。

**项目地址:** [deletehead/Pool-Overflow-CVE-2021-31956](https://github.com/deletehead/Pool-Overflow-CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #4

**来源**: [CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md](../2021/CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS权限提升漏洞。该漏洞允许本地攻击者通过利用NTFS文件系统中的缺陷，提升自己的权限。

**1. 有效性:**

*   搜索结果表明该漏洞已被公开披露，并存在利用代码。
*   提供的漏洞利用代码是一个Visual Studio解决方案，包含C++源代码，表明该漏洞的利用是可行的。
*   README.md文件提到是WIP PoC, 存在不稳定性。

综合判断，提供的POC代码具有一定的有效性，但可能不够稳定，需要进一步完善。

**2. 投毒风险:**

*   分析提供的C++代码需要反编译和代码审计。
*   README.md文件中提到该代码是从其他项目fork而来，存在引用第三方代码的风险。
*   代码的编译环境可能被植入恶意代码。
*   该PoC代码本身是为了利用漏洞，因此也可能包含一些潜在的风险。

综合判断，此仓库中存在一定投毒代码的风险，估计为30%。

**3. 利用方式:**

*   **漏洞原理：** 该漏洞是由于NTFS文件系统处理特定操作时存在缺陷，导致内核内存损坏，从而允许权限提升。
*   **利用步骤：**
    1.  精心构造特定的NTFS文件系统操作，触发漏洞。
    2.  利用内核内存损坏，覆盖关键数据结构，例如进程令牌(Token)。
    3.  将当前进程的令牌替换为SYSTEM用户的令牌，从而提升权限。

    **利用细节**:
        *   该漏洞利用可能涉及到 Windows Notification Facility (WNF)。
        *   利用需要对内核内存布局和数据结构有深入的了解。
        *   利用过程可能需要进行内存池喷射（Pool Feng Shui）等技术，以提高利用的可靠性。

**4. 排序优先级**

    *   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**
        *   搜索引擎结果提供了漏洞相关的分析文章和利用案例，可以帮助了解漏洞的细节和利用方法。
        *   漏洞利用代码提供了实际的POC代码，可以验证漏洞的存在性和利用效果。
        *   漏洞库信息提供了漏洞的基本信息，例如受影响的版本和CVSS评分，可以帮助评估漏洞的风险。


**项目地址:** [hoangprod/CVE-2021-31956-POC](https://github.com/hoangprod/CVE-2021-31956-POC)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #5

**来源**: [CVE-2021-31956-hzshang_CVE-2021-31956.md](../2021/CVE-2021-31956-hzshang_CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** 受影响的Windows版本：Windows 10 Version 1809, Windows Server 2019, Windows 10 Version 1909, Windows 10 Version 21H1, Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2, Windows 10 Version 1507, Windows 10 Version 1607, Windows Server 2016, Windows 7, Windows 8.1, Windows Server 2008, Windows Server 2012等。

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31956 是一个 Windows NTFS 文件系统中的权限提升漏洞。该漏洞允许经过身份验证的攻击者在本地系统上提升权限。漏洞原理是NTFS处理特定操作时存在缺陷，导致内核内存损坏。从搜索引擎结果来看，该漏洞已经被积极利用，并且有相关的分析文章和利用示例。NCC Group的两篇文章深入分析了该漏洞的利用方式，包括如何实现较高的利用成功率以及所需的清理操作。

漏洞利用代码分析：
提供的C++代码尝试利用此漏洞进行权限提升。代码首先创建一个临时文件，然后使用 NtSetEaFile 设置扩展属性（EA）。利用点在于通过精心构造的 EA 信息，覆盖 WNF (Windows Notification Facility) 状态数据结构。代码通过 `EA_append` 函数构造特殊的EA块，其中包括覆盖WNF数据所需的 PoolHeader 和 WNF_STATE_DATA，从而实现内核内存的破坏。

有效性评估：
根据搜索结果和漏洞利用代码分析，可以判断此漏洞利用方式是有效的。搜索引擎结果中提到了有exp（利用），博客文章也详细描述了漏洞的利用过程，提供的POC代码也实现了构造和触发漏洞的逻辑。

投毒风险评估：
从提供的C++代码来看，主要目的是利用NTFS漏洞进行权限提升，没有发现明显的投毒代码。代码主要包括创建文件、设置EA属性、覆盖内核内存等操作。虽然代码存在潜在的风险，如可能导致系统崩溃，但没有证据表明作者故意插入恶意代码以进行进一步的攻击或者控制受害者系统。因此，投毒风险评估为0%。

利用方式总结：
1.  创建一个临时文件。
2.  构造包含恶意数据的扩展属性 (EA) 块，覆盖 WNF 状态数据结构。
3.  使用 NtCreateFile 创建文件。
4.  使用 NtSetEaFile 将构造的 EA 块写入文件，触发漏洞并覆盖内核内存。
5.  利用覆盖后的 WNF 状态数据，最终提升权限。


**项目地址:** [hzshang/CVE-2021-31956](https://github.com/hzshang/CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---



---

## POC #2

**来源**: [CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md](../2021/CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md)

## CVE-2021-31956 Windows NTFS 特权提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 特权提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致本地提权

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要在本地系统上运行恶意代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956 Windows NTFS特权提升漏洞进行评估如下：

**1. 有效性：**

*   根据漏洞库信息，该漏洞影响多个Windows版本，且存在公开的POC。
*   搜索结果中包含多个关于该漏洞的分析文章，例如NCC Group的文章，以及Arctic Wolf提到该漏洞被用于Magnitude Exploit Kit。
*   提供的POC代码似乎利用了NTFS的扩展属性（EA）的某些机制，结合WNF（Windows Notification Facility），来触发内核内存破坏，从而实现提权。具体来说，代码中`NtSetEaFile`函数被用来设置恶意构造的EA，然后`NtQueryEaFile`函数被用来触发漏洞。代码中使用了堆喷射，通过创建大量的WNF状态名，在内存中占据特定区域，提高漏洞利用的成功率。`OVER_STATEDATA_LENGTH`、`OVER_EA_VALUE_LENGTH`等变量控制了溢出的长度，`TIGGER_EA_NAME`和`OVER_EA_NAME`定义了EA的名称，这些参数需要根据目标环境进行调整。

**因此，综合判断，提供的POC代码具有较高的有效性，可以利用该漏洞实现本地提权。**

**2. 投毒风险：**

*   查看POC代码，`ConsoleApplication11.cpp`。代码主要由`initNtDll()`(加载需要的ntdll函数), `tiggerLeak()`(触发漏洞)和`HeapSpray()`(进行堆喷)三个函数组成。
*   `HeapSpray()` 函数中存在可疑的 `upData` 数组, 其中的值没有被初始化, 可能会导致一些不期望的结果, 但不能确定为恶意投毒代码, 因为其行为是进行堆喷操作. `RtlFillMemory(up`这一行可能存在截断，查看完整代码。
*   总体来说，代码逻辑相对清晰，主要集中在利用NTFS EA和WNF机制触发内核漏洞。**初步评估投毒风险较低，约为10%。** 潜在的投毒方式可能存在于精心构造的溢出数据中，例如，将shellcode隐藏在看起来无害的数据中，或者利用一些不常见的API调用执行恶意操作。

**3. 利用方式：**

该漏洞的利用方式大致如下：

1.  **准备环境：** 在目标Windows系统上创建或选择一个存在的文件。
2.  **构造恶意EA：** 使用`NtSetEaFile`函数设置精心构造的NTFS扩展属性。该EA包含溢出数据，用于破坏内核内存。
3.  **触发漏洞：** 使用`NtQueryEaFile`函数查询该文件的EA，触发内核内存破坏。
4.  **堆喷射：** 使用WNF（Windows Notification Facility） API(`NtCreateWnfStateName`, `NtUpdateWnfStateData`)进行堆喷，在内存中创建大量WNF状态名，从而控制内存布局，提高漏洞利用的成功率。
5.  **提权：** 覆盖内核数据结构，将当前进程的权限提升到SYSTEM。
6.  **执行恶意代码：** 利用提升后的权限执行任意代码。

**漏洞利用的关键在于精确控制内存布局，以及构造合适的溢出数据，以便覆盖关键的内核数据结构。**

**项目地址:** [aazhuliang/CVE-2021-31956-EXP](https://github.com/aazhuliang/CVE-2021-31956-EXP)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #3

**来源**: [CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md](../2021/CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** 受影响的Windows版本包括Windows 7至Windows 10 21H1以及相应的Windows Server版本，具体版本号见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956漏洞进行评估如下：

**有效性：**

根据搜索结果，该漏洞是一个Windows NTFS文件系统中的权限提升漏洞，已被公开利用。NCC Group发布了两篇关于该漏洞的分析文章，表明存在可行的利用方式。Arctic Wolf的报告指出，Magnitude Exploit Kit利用了该漏洞。综合来看，该漏洞的POC代码是有效的。

**投毒风险：**

提供的代码文件包括一个C++源代码文件（Pool-Overflow-CVE-2021-31956.cpp）、一个Visual Studio解决方案文件（Pool-Overflow-CVE-2021-31956.sln）和一个Visual Studio项目文件（Pool-Overflow-CVE-2021-31956.vcxproj）。

*   **代码审查：** 没有提供cpp的内容，无法分析

考虑到以上信息，没有足够的信息来判断是否存在投毒代码。通常，投毒会涉及在看似无害的代码中隐藏恶意行为，例如后门或数据窃取。由于缺少cpp的内容，**无法评估投毒风险，因此投毒风险评估为0%。**

**利用方式：**

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS文件系统中的权限提升漏洞，属于内核内存损坏漏洞。利用方式通常涉及以下步骤：

1.  **触发漏洞：** 通过精心构造的NTFS操作（具体细节取决于漏洞的触发机制，一般涉及恶意的文件或者目录操作，或者WNF交互）。
2.  **内存破坏：** 漏洞触发后，会导致内核内存损坏（Paged Pool Overflow）。
3.  **权限提升：** 攻击者利用内存破坏来覆盖内核对象或数据结构，从而获得SYSTEM权限。

总而言之，该漏洞利用的典型步骤是触发漏洞、实现内存破坏，最终达到权限提升的目的。

**项目地址:** [deletehead/Pool-Overflow-CVE-2021-31956](https://github.com/deletehead/Pool-Overflow-CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #4

**来源**: [CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md](../2021/CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS权限提升漏洞。该漏洞允许本地攻击者通过利用NTFS文件系统中的缺陷，提升自己的权限。

**1. 有效性:**

*   搜索结果表明该漏洞已被公开披露，并存在利用代码。
*   提供的漏洞利用代码是一个Visual Studio解决方案，包含C++源代码，表明该漏洞的利用是可行的。
*   README.md文件提到是WIP PoC, 存在不稳定性。

综合判断，提供的POC代码具有一定的有效性，但可能不够稳定，需要进一步完善。

**2. 投毒风险:**

*   分析提供的C++代码需要反编译和代码审计。
*   README.md文件中提到该代码是从其他项目fork而来，存在引用第三方代码的风险。
*   代码的编译环境可能被植入恶意代码。
*   该PoC代码本身是为了利用漏洞，因此也可能包含一些潜在的风险。

综合判断，此仓库中存在一定投毒代码的风险，估计为30%。

**3. 利用方式:**

*   **漏洞原理：** 该漏洞是由于NTFS文件系统处理特定操作时存在缺陷，导致内核内存损坏，从而允许权限提升。
*   **利用步骤：**
    1.  精心构造特定的NTFS文件系统操作，触发漏洞。
    2.  利用内核内存损坏，覆盖关键数据结构，例如进程令牌(Token)。
    3.  将当前进程的令牌替换为SYSTEM用户的令牌，从而提升权限。

    **利用细节**:
        *   该漏洞利用可能涉及到 Windows Notification Facility (WNF)。
        *   利用需要对内核内存布局和数据结构有深入的了解。
        *   利用过程可能需要进行内存池喷射（Pool Feng Shui）等技术，以提高利用的可靠性。

**4. 排序优先级**

    *   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**
        *   搜索引擎结果提供了漏洞相关的分析文章和利用案例，可以帮助了解漏洞的细节和利用方法。
        *   漏洞利用代码提供了实际的POC代码，可以验证漏洞的存在性和利用效果。
        *   漏洞库信息提供了漏洞的基本信息，例如受影响的版本和CVSS评分，可以帮助评估漏洞的风险。


**项目地址:** [hoangprod/CVE-2021-31956-POC](https://github.com/hoangprod/CVE-2021-31956-POC)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #5

**来源**: [CVE-2021-31956-hzshang_CVE-2021-31956.md](../2021/CVE-2021-31956-hzshang_CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** 受影响的Windows版本：Windows 10 Version 1809, Windows Server 2019, Windows 10 Version 1909, Windows 10 Version 21H1, Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2, Windows 10 Version 1507, Windows 10 Version 1607, Windows Server 2016, Windows 7, Windows 8.1, Windows Server 2008, Windows Server 2012等。

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31956 是一个 Windows NTFS 文件系统中的权限提升漏洞。该漏洞允许经过身份验证的攻击者在本地系统上提升权限。漏洞原理是NTFS处理特定操作时存在缺陷，导致内核内存损坏。从搜索引擎结果来看，该漏洞已经被积极利用，并且有相关的分析文章和利用示例。NCC Group的两篇文章深入分析了该漏洞的利用方式，包括如何实现较高的利用成功率以及所需的清理操作。

漏洞利用代码分析：
提供的C++代码尝试利用此漏洞进行权限提升。代码首先创建一个临时文件，然后使用 NtSetEaFile 设置扩展属性（EA）。利用点在于通过精心构造的 EA 信息，覆盖 WNF (Windows Notification Facility) 状态数据结构。代码通过 `EA_append` 函数构造特殊的EA块，其中包括覆盖WNF数据所需的 PoolHeader 和 WNF_STATE_DATA，从而实现内核内存的破坏。

有效性评估：
根据搜索结果和漏洞利用代码分析，可以判断此漏洞利用方式是有效的。搜索引擎结果中提到了有exp（利用），博客文章也详细描述了漏洞的利用过程，提供的POC代码也实现了构造和触发漏洞的逻辑。

投毒风险评估：
从提供的C++代码来看，主要目的是利用NTFS漏洞进行权限提升，没有发现明显的投毒代码。代码主要包括创建文件、设置EA属性、覆盖内核内存等操作。虽然代码存在潜在的风险，如可能导致系统崩溃，但没有证据表明作者故意插入恶意代码以进行进一步的攻击或者控制受害者系统。因此，投毒风险评估为0%。

利用方式总结：
1.  创建一个临时文件。
2.  构造包含恶意数据的扩展属性 (EA) 块，覆盖 WNF 状态数据结构。
3.  使用 NtCreateFile 创建文件。
4.  使用 NtSetEaFile 将构造的 EA 块写入文件，触发漏洞并覆盖内核内存。
5.  利用覆盖后的 WNF 状态数据，最终提升权限。


**项目地址:** [hzshang/CVE-2021-31956](https://github.com/hzshang/CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---



---

## POC #2

**来源**: [CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md](../2021/CVE-2021-31956-aazhuliang_CVE-2021-31956-EXP.md)

## CVE-2021-31956 Windows NTFS 特权提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 特权提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致本地提权

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要在本地系统上运行恶意代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956 Windows NTFS特权提升漏洞进行评估如下：

**1. 有效性：**

*   根据漏洞库信息，该漏洞影响多个Windows版本，且存在公开的POC。
*   搜索结果中包含多个关于该漏洞的分析文章，例如NCC Group的文章，以及Arctic Wolf提到该漏洞被用于Magnitude Exploit Kit。
*   提供的POC代码似乎利用了NTFS的扩展属性（EA）的某些机制，结合WNF（Windows Notification Facility），来触发内核内存破坏，从而实现提权。具体来说，代码中`NtSetEaFile`函数被用来设置恶意构造的EA，然后`NtQueryEaFile`函数被用来触发漏洞。代码中使用了堆喷射，通过创建大量的WNF状态名，在内存中占据特定区域，提高漏洞利用的成功率。`OVER_STATEDATA_LENGTH`、`OVER_EA_VALUE_LENGTH`等变量控制了溢出的长度，`TIGGER_EA_NAME`和`OVER_EA_NAME`定义了EA的名称，这些参数需要根据目标环境进行调整。

**因此，综合判断，提供的POC代码具有较高的有效性，可以利用该漏洞实现本地提权。**

**2. 投毒风险：**

*   查看POC代码，`ConsoleApplication11.cpp`。代码主要由`initNtDll()`(加载需要的ntdll函数), `tiggerLeak()`(触发漏洞)和`HeapSpray()`(进行堆喷)三个函数组成。
*   `HeapSpray()` 函数中存在可疑的 `upData` 数组, 其中的值没有被初始化, 可能会导致一些不期望的结果, 但不能确定为恶意投毒代码, 因为其行为是进行堆喷操作. `RtlFillMemory(up`这一行可能存在截断，查看完整代码。
*   总体来说，代码逻辑相对清晰，主要集中在利用NTFS EA和WNF机制触发内核漏洞。**初步评估投毒风险较低，约为10%。** 潜在的投毒方式可能存在于精心构造的溢出数据中，例如，将shellcode隐藏在看起来无害的数据中，或者利用一些不常见的API调用执行恶意操作。

**3. 利用方式：**

该漏洞的利用方式大致如下：

1.  **准备环境：** 在目标Windows系统上创建或选择一个存在的文件。
2.  **构造恶意EA：** 使用`NtSetEaFile`函数设置精心构造的NTFS扩展属性。该EA包含溢出数据，用于破坏内核内存。
3.  **触发漏洞：** 使用`NtQueryEaFile`函数查询该文件的EA，触发内核内存破坏。
4.  **堆喷射：** 使用WNF（Windows Notification Facility） API(`NtCreateWnfStateName`, `NtUpdateWnfStateData`)进行堆喷，在内存中创建大量WNF状态名，从而控制内存布局，提高漏洞利用的成功率。
5.  **提权：** 覆盖内核数据结构，将当前进程的权限提升到SYSTEM。
6.  **执行恶意代码：** 利用提升后的权限执行任意代码。

**漏洞利用的关键在于精确控制内存布局，以及构造合适的溢出数据，以便覆盖关键的内核数据结构。**

**项目地址:** [aazhuliang/CVE-2021-31956-EXP](https://github.com/aazhuliang/CVE-2021-31956-EXP)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #3

**来源**: [CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md](../2021/CVE-2021-31956-deletehead_Pool-Overflow-CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** 受影响的Windows版本包括Windows 7至Windows 10 21H1以及相应的Windows Server版本，具体版本号见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，对CVE-2021-31956漏洞进行评估如下：

**有效性：**

根据搜索结果，该漏洞是一个Windows NTFS文件系统中的权限提升漏洞，已被公开利用。NCC Group发布了两篇关于该漏洞的分析文章，表明存在可行的利用方式。Arctic Wolf的报告指出，Magnitude Exploit Kit利用了该漏洞。综合来看，该漏洞的POC代码是有效的。

**投毒风险：**

提供的代码文件包括一个C++源代码文件（Pool-Overflow-CVE-2021-31956.cpp）、一个Visual Studio解决方案文件（Pool-Overflow-CVE-2021-31956.sln）和一个Visual Studio项目文件（Pool-Overflow-CVE-2021-31956.vcxproj）。

*   **代码审查：** 没有提供cpp的内容，无法分析

考虑到以上信息，没有足够的信息来判断是否存在投毒代码。通常，投毒会涉及在看似无害的代码中隐藏恶意行为，例如后门或数据窃取。由于缺少cpp的内容，**无法评估投毒风险，因此投毒风险评估为0%。**

**利用方式：**

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS文件系统中的权限提升漏洞，属于内核内存损坏漏洞。利用方式通常涉及以下步骤：

1.  **触发漏洞：** 通过精心构造的NTFS操作（具体细节取决于漏洞的触发机制，一般涉及恶意的文件或者目录操作，或者WNF交互）。
2.  **内存破坏：** 漏洞触发后，会导致内核内存损坏（Paged Pool Overflow）。
3.  **权限提升：** 攻击者利用内存破坏来覆盖内核对象或数据结构，从而获得SYSTEM权限。

总而言之，该漏洞利用的典型步骤是触发漏洞、实现内存破坏，最终达到权限提升的目的。

**项目地址:** [deletehead/Pool-Overflow-CVE-2021-31956](https://github.com/deletehead/Pool-Overflow-CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #4

**来源**: [CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md](../2021/CVE-2021-31956-hoangprod_CVE-2021-31956-POC.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS权限提升漏洞。该漏洞允许本地攻击者通过利用NTFS文件系统中的缺陷，提升自己的权限。

**1. 有效性:**

*   搜索结果表明该漏洞已被公开披露，并存在利用代码。
*   提供的漏洞利用代码是一个Visual Studio解决方案，包含C++源代码，表明该漏洞的利用是可行的。
*   README.md文件提到是WIP PoC, 存在不稳定性。

综合判断，提供的POC代码具有一定的有效性，但可能不够稳定，需要进一步完善。

**2. 投毒风险:**

*   分析提供的C++代码需要反编译和代码审计。
*   README.md文件中提到该代码是从其他项目fork而来，存在引用第三方代码的风险。
*   代码的编译环境可能被植入恶意代码。
*   该PoC代码本身是为了利用漏洞，因此也可能包含一些潜在的风险。

综合判断，此仓库中存在一定投毒代码的风险，估计为30%。

**3. 利用方式:**

*   **漏洞原理：** 该漏洞是由于NTFS文件系统处理特定操作时存在缺陷，导致内核内存损坏，从而允许权限提升。
*   **利用步骤：**
    1.  精心构造特定的NTFS文件系统操作，触发漏洞。
    2.  利用内核内存损坏，覆盖关键数据结构，例如进程令牌(Token)。
    3.  将当前进程的令牌替换为SYSTEM用户的令牌，从而提升权限。

    **利用细节**:
        *   该漏洞利用可能涉及到 Windows Notification Facility (WNF)。
        *   利用需要对内核内存布局和数据结构有深入的了解。
        *   利用过程可能需要进行内存池喷射（Pool Feng Shui）等技术，以提高利用的可靠性。

**4. 排序优先级**

    *   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**
        *   搜索引擎结果提供了漏洞相关的分析文章和利用案例，可以帮助了解漏洞的细节和利用方法。
        *   漏洞利用代码提供了实际的POC代码，可以验证漏洞的存在性和利用效果。
        *   漏洞库信息提供了漏洞的基本信息，例如受影响的版本和CVSS评分，可以帮助评估漏洞的风险。


**项目地址:** [hoangprod/CVE-2021-31956-POC](https://github.com/hoangprod/CVE-2021-31956-POC)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

## POC #5

**来源**: [CVE-2021-31956-hzshang_CVE-2021-31956.md](../2021/CVE-2021-31956-hzshang_CVE-2021-31956.md)

## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** 受影响的Windows版本：Windows 10 Version 1809, Windows Server 2019, Windows 10 Version 1909, Windows 10 Version 21H1, Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2, Windows 10 Version 1507, Windows 10 Version 1607, Windows Server 2016, Windows 7, Windows 8.1, Windows Server 2008, Windows Server 2012等。

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31956 是一个 Windows NTFS 文件系统中的权限提升漏洞。该漏洞允许经过身份验证的攻击者在本地系统上提升权限。漏洞原理是NTFS处理特定操作时存在缺陷，导致内核内存损坏。从搜索引擎结果来看，该漏洞已经被积极利用，并且有相关的分析文章和利用示例。NCC Group的两篇文章深入分析了该漏洞的利用方式，包括如何实现较高的利用成功率以及所需的清理操作。

漏洞利用代码分析：
提供的C++代码尝试利用此漏洞进行权限提升。代码首先创建一个临时文件，然后使用 NtSetEaFile 设置扩展属性（EA）。利用点在于通过精心构造的 EA 信息，覆盖 WNF (Windows Notification Facility) 状态数据结构。代码通过 `EA_append` 函数构造特殊的EA块，其中包括覆盖WNF数据所需的 PoolHeader 和 WNF_STATE_DATA，从而实现内核内存的破坏。

有效性评估：
根据搜索结果和漏洞利用代码分析，可以判断此漏洞利用方式是有效的。搜索引擎结果中提到了有exp（利用），博客文章也详细描述了漏洞的利用过程，提供的POC代码也实现了构造和触发漏洞的逻辑。

投毒风险评估：
从提供的C++代码来看，主要目的是利用NTFS漏洞进行权限提升，没有发现明显的投毒代码。代码主要包括创建文件、设置EA属性、覆盖内核内存等操作。虽然代码存在潜在的风险，如可能导致系统崩溃，但没有证据表明作者故意插入恶意代码以进行进一步的攻击或者控制受害者系统。因此，投毒风险评估为0%。

利用方式总结：
1.  创建一个临时文件。
2.  构造包含恶意数据的扩展属性 (EA) 块，覆盖 WNF 状态数据结构。
3.  使用 NtCreateFile 创建文件。
4.  使用 NtSetEaFile 将构造的 EA 块写入文件，触发漏洞并覆盖内核内存。
5.  利用覆盖后的 WNF 状态数据，最终提升权限。


**项目地址:** [hzshang/CVE-2021-31956](https://github.com/hzshang/CVE-2021-31956)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)

---

