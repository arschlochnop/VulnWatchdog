## CVE-2021-3129 - Laravel (Ignition组件) RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition < 2.5.2

**利用条件:** 开启Debug模式且安装了Ignition组件

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对Laravel框架中Ignition组件的安全漏洞（CVE-2021-3129）进行了高度自动化的实现。其核心逻辑利用了Ignition在处理错误页面时对file_get_contents()和file_put_contents()函数的不安全调用。POC首先通过探测目标是否开启了Debug模式以及是否使用了受影响的Laravel版本来确认可行性。利用逻辑包含三个主要阶段：第一，通过log_file清理和预热；第二，利用特定的Gadget Chain（通常配合phpggc生成的Phar反序列化链）构造恶意日志文件；第三，通过phar://协议伪协议触发反序列化。此POC包含了参数解析（如自定义Header、Cookie、Proxy）、自动寻找日志路径以及命令执行接口，结构严谨，逻辑清晰。从代码实现来看，它不仅是概念验证，更是一个准工具化的漏洞利用脚本。经过对脚本中requests请求逻辑和关键payload构造部分的分析，其攻击链条完整，能有效绕过常见的初级防护。利用步骤：1. 确认目标环境开启了APP_DEBUG=true。2. 获取目标Laravel日志文件的绝对路径（POC中有自动探测逻辑）。3. 使用phpggc生成针对Laravel框架的Phar反序列化Payload。4. 通过向目标发送带有'Make files writable'等解决方案的恶意请求，将Payload注入到Laravel日志中。5. 清理Payload中的干扰字符，使其符合Phar文件格式。6. 使用phar://伪协议访问该日志文件，触发反序列化并执行用户定义的命令（通过-C参数指定）。投毒风险分析：该POC代码整体呈现出较高的透明度，属于开源安全研究社区中常见的脚本风格。代码中大量使用了Python标准库（argparse, pathlib, subprocess, re, base64）和requests第三方库，未发现明显的代码混淆或加壳行为。风险点主要集中在以下几个方面：首先，脚本使用了subprocess调用外部组件，虽然在POC场景下是为了配合phpggc等工具，但也可能被修改为执行本地恶意脚本。其次，POC中包含了Base64解码和编码操作，虽然目前用于构造Payload，但恶意开发者可以利用类似逻辑隐藏下载远程木马的指令。此外，脚本允许通过-x参数设置代理，这可能被攻击者用来将执行结果回传至攻击者控制的C2服务器。然而，该脚本并未发现任何硬编码的外部恶意URL，也没有删除本地文件或破坏系统环境的隐藏指令，整体行为符合防御性安全研究的范畴。对于组织而言，主要的风险在于内部安全人员直接运行未经审查的此类POC，如果该POC被二次修改加入隐蔽的后门，则可能导致内网渗透。建议在使用前对POC中的网络请求目标和本地子进程调用进行严格审计，并建议在隔离的沙箱环境内运行测试。

**项目地址:** [https://github.com/facade/ignition](https://github.com/facade/ignition)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
