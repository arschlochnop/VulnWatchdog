## CVE-2021-3129 - Laravel (Ignition组件) RCE (远程代码执行)

**漏洞编号:** CVE-2021-3129

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel (Ignition组件)

**危害等级:** 高危 (Critical)

**CVSS评分:** 9.8

**影响版本:** Laravel <= 8.4.2, Ignition <= 2.5.1

**利用条件:** Laravel框架开启Debug模式 (APP_DEBUG=true)，且安装了低版本Ignition组件

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞源于Laravel默认错误页组件Ignition对file_get_contents()和file_put_contents()函数的不安全处理。攻击者可以通过Ignition提供的'solutions'接口，触发一系列PHP过滤器（Filter）操作。分析提供的POC代码可见，其逻辑清晰且完整：首先通过get_debug验证目标是否开启Debug模式并确认接口路径；接着通过读取报错信息获取Web绝对路径（get_path）；随后利用php://filter构造恶意Log文件，将Base64编码的Phar内容写入laravel.log；最后通过Phar伪协议触发反序列化实现RCE。该POC使用了自动化脚本处理，避免了手动计算Filter链的复杂性，实测有效性极高，能够直接获取系统Shell。利用步骤：1. 确认目标开启Debug模式。2. 使用phpggc生成针对Monolog/RCE1链的Phar载荷。3. 通过接口将载荷以Base64形式分段写入laravel.log并清除无关干扰字符。4. 调用Phar协议解析日志文件，触发反序列化执行系统命令。投毒风险分析：该POC代码逻辑透明，主要使用了Python的requests库进行HTTP通信，未发现明显的恶意混淆代码或远程下载木马的行为。代码中定义的Payload生成方式（如使用phpggc）是安全研究界的标准做法。然而，风险点在于：1. 脚本中可能存在的第三方库依赖如果不受控，可能存在供应链风险。2. 在执行`python laravel.py`时，如果用户未检查脚本中是否存在硬编码的外部回传地址（Out-of-band），可能会导致漏洞扫描行为被第三方监控。3. POC中的Payload（如cat /etc/passwd）虽然仅作为演示，但在实战环境中需防止误删或破坏系统配置。由于脚本采用标准Python编写，可读性高，且未发现加密的网络通讯，故投毒风险定为低（15%），主要属于工具滥用风险而非恶意后门。

**项目地址:** [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)
