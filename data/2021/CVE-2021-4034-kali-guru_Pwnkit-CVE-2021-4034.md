## CVE-2021-4034 - Polkit (pkexec) 本地权限提升 (LPE)

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Polkit (pkexec)

**危害等级:** 高危

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 所有主流 Linux 发行版中包含 polkit 的版本 (2009年至今)

**利用条件:** 攻击者必须拥有目标系统的本地用户访问权限

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2021-4034，又被称为 PwnKit，是 Linux 中 polkit 软件包的 pkexec 组件中存在的一个内存破坏漏洞。该漏洞允许非特权用户在默认配置下获得目标主机的全根（root）特权。pkexec 是一个 setuid 程序，旨在允许受限用户以其他用户（通常是 root）的身份运行命令。漏洞产生的根源在于 pkexec 对命令行参数的处理存在逻辑缺陷：当 main 函数接收到的参数计数（argc）为 0 时，pkexec 依然会尝试访问参数数组。由于 pkexec 错误地假设 argc 至少为 1，它会将环境变量数组（envp）的第一个元素误认为参数，并对其进行越界写入。通过精心构造环境变量，攻击者可以诱导 pkexec 执行任意共享库文件，从而实现从普通用户到 root 用户的权限提升。本 POC 代码片段展示了一个自动化执行流程，其有效性分析如下：该 POC 属于包装型脚本，核心逻辑依赖于外部的 'cve-2021-4034-poc.c' 文件。脚本通过 Python 的 os.system 调用 gcc 进行编译，随后执行生成的二进制文件。这种方式在 CTF 比赛或自动化渗透测试中较为常见，但由于其高度依赖外部 C 源文件且缺乏对不同 Linux 环境（如 glibc 版本差异）的兼容性处理，其直接运行的成功率取决于本地是否存在编译器及源码完整性。该漏洞在现代系统中已广泛修补，利用价值主要集中在未更新的旧系统。利用步骤通常包括：1. 准备 C 语言编写的漏洞触发载荷。2. 在目标机器上编译该载荷。3. 执行编译后的程序。4. 利用 pkexec 的 suid 权限绕过身份验证并获得 root shell。5. 验证 UID 为 0。关于投毒风险分析：该 Python 脚本本身代码逻辑清晰，主要使用了 Python 标准库中的 os 模块进行系统命令调用。从代码内容来看，它执行了 'whoami'、'ls /root' 和 'cat /root/flag.txt'，这些属于典型的后渗透验证行为（尤其是针对 CTF 环境），而非恶意的后门投毒。然而，此类 '自动化 Exploit' 脚本存在中低程度的投毒风险，主要风险点在于：第一，脚本依赖外部的 'cve-2021-4034-poc.c'，如果该 C 源码被篡改植入恶意 Shellcode，用户在本地编译执行时会导致系统感染；第二，脚本中的 os.system 命令可能被修改为执行远程下载指令（如 curl/wget 到远程服务器）；第三，当前脚本仅展示了框架，未见明显的代码混淆或网络外传行为，因此评估为低风险。建议用户在运行此类脚本前，必须仔细审查配套的 C 语言源码，并在受控的沙箱环境中进行测试，以防止脚本在提权成功后执行非预期的恶意指令。

**项目地址:** [https://github.com/vulnwatchdog/Pwnkit-CVE-2021-4034](https://www.google.com/search?q=https://github.com/vulnwatchdog/Pwnkit-CVE-2021-4034)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)
