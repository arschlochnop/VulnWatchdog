## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过 / 远程代码执行 (RCE)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过 / 远程代码执行 (RCE)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** TeamCity 2023.05.3 之前的所有版本

**利用条件:** 需要获得有效的 TeamCity 令牌 (Token) 以执行 POC 中的 RCE 步骤；原始 CVE 允许未经身份验证的访问，但此 POC 脚本针对已授权阶段。

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

POC有效性分析：该POC代码展示了在获取TeamCity令牌后如何通过内部调试接口执行任意命令。代码逻辑分为两个主要阶段：首先，通过POST请求修改“internal.properties”文件，将“rest.debug.processes.enable”属性设置为true，从而激活服务器的远程调试进程功能。这一步是利用TeamCity管理接口对敏感配置项缺乏严格限制的弱点。其次，利用“/app/rest/debug/processes”接口，通过exePath参数指定执行环境（/bin/bash），并配合编码后的反弹Shell负载（Base64或URL编码形式）实现RCE。尽管该脚本声明需要令牌，但CVE-2023-42793本身的本质是身份验证绕过，攻击者通常可以利用该漏洞生成此令牌或直接访问受限端点。该POC逻辑清晰，使用了标准的Python subprocess和curl命令，在满足前提条件的情况下，能够稳定地在Linux环境下建立反向Shell连接。利用步骤：1. 准备处于监听状态的攻击机（Netcat）；2. 获取目标TeamCity服务器的URL、端口及有效Token（可通过该漏洞的绕过部分获取）；3. 运行脚本，脚本将自动发送第一个POST请求开启调试模式；4. 脚本随后发送第二个POST请求，将URL编码的bash指令注入调试接口；5. 目标服务器执行指令，回连攻击机。投毒风险分析：经过对提供的Python源代码进行审查，该脚本属于低风险的防御性研究工具。其核心操作依赖于标准的Python argparse和subprocess库，所有调用的外部命令（curl）均直接硬编码在脚本逻辑中，未发现使用eval()、exec()等危险动态执行函数。脚本中不包含任何混淆代码、Base64加密的恶意Payload或试图连接第三方非相关域名的可疑行为。脚本唯一执行的敏感操作是建立反向Shell，但这属于POC功能的预期部分，旨在演示漏洞的危害性。代码中没有发现针对执行机（即研究员的机器）的后门植入、文件窃取或持久化机制。唯一的投毒风险在于用户可能从不受信任的源下载此类脚本，若攻击者在curl请求中替换为恶意地址或在本地添加隐藏的敏感信息收集逻辑。目前提供的代码版本逻辑透明，主要风险在于脚本的使用者而非脚本本身，建议在隔离的沙箱环境中使用，并确保Token不外泄。

**项目地址:** n/a (基于提供的POC内容)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
