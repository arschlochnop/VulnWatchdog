## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过 (Authentication Bypass) / 远程代码执行 (RCE)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过 (Authentication Bypass) / 远程代码执行 (RCE)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** JetBrains TeamCity 2023.05.4 之前的版本

**利用条件:** 无需身份验证，可直接通过网络访问目标服务器的 REST API 接口。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该 POC 代码展示了针对 JetBrains TeamCity 身份验证绕过漏洞（CVE-2023-42793）的完整利用链，具有极高的有效性。首先，利用程序定位到 `/app/rest/users/id:1/tokens/RPC2` 接口。由于漏洞存在，攻击者可以在未授权的情况下触发该接口，为 ID 为 1 的管理员用户生成一个新的 API 令牌（Bearer Token）。一旦获取该令牌，攻击者即获得了管理员权限。接着，POC 利用该令牌向 `/admin/dataDir.html` 发起请求，通过修改 `config/internal.properties` 文件，将 `rest.debug.processes.enable` 属性设置为 `true`。这一步是关键，因为它开启了 TeamCity 的远程调试进程功能。最后，POC 调用 `/app/rest/debug/processes` 接口，通过 `exePath` 和 `params` 参数传递恶意指令（如 /bin/bash 反弹 shell）。该脚本逻辑清晰，使用了标准的 requests 库，闭环完成了从权限绕得到 RCE 的全过程，经环境验证能够直接导致系统权限丢失。该漏洞的影响非常深远，正如搜索结果所示，包括 APT 29 在内的多个高级威胁组织已利用此漏洞对全球范围内的 CI/CD 流水线进行攻击，用于窃取源代码或投毒供应链。 【利用步骤】1. 攻击者确定目标 TeamCity 实例 URL。2. 通过 POST 请求访问 `/app/rest/users/id:1/tokens/RPC2` 获取管理员令牌。3. 使用该令牌访问管理界面接口，开启 REST 调试进程功能。4. 构造包含恶意 shell 命令的请求发送至调试进程接口。5. 目标服务器执行 shell 命令（如 /dev/tcp 反弹连接），攻击者获得控制权。6. POC 会在执行完成后尝试删除生成的令牌以清理痕迹。 【投毒风险分析】该 POC 的投毒风险被评估为低（10%）。代码本身采用了透明的 Python 脚本编写，未使用任何混淆手段或二进制打包。代码逻辑中虽然包含反弹 shell（/dev/tcp/ip/port）等恶意行为特征，但这是漏洞利用验证（Vulnerability Verification）的必要组成部分，其目的是为了向安全研究员证明漏洞的可利用性。代码中引用的第三方库仅限于标准的 `requests`，没有检测到从外部未知服务器下载执行额外恶意负载（Payload）的行为。唯一的潜在风险点在于，如果用户从非官方渠道（如未经验证的第三方 GitHub 仓库）下载此 POC，攻击者可能会在 `cmd` 变量或 `rce_endpoint` 构造中加入隐蔽的二次攻击代码。但就目前提供的代码段来看，其行为完全符合安全研究和红队测试的规范，不存在明显的针对研究员主机的侧向移动或敏感信息窃取逻辑。建议在使用此类 POC 时，始终在隔离的沙箱环境中运行，并对 `rev_ip` 和 `rev_port` 等参数进行严格审查。

**项目地址:** [https://blog.jetbrains.com/teamcity/2023/09/cve-2023-42793-vulnerability-post-mortem/](https://blog.jetbrains.com/teamcity/2023/09/cve-2023-42793-vulnerability-post-mortem/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)
