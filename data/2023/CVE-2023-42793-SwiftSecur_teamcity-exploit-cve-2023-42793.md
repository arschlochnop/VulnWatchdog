## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过导致的远程代码执行 (RCE)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过导致的远程代码执行 (RCE)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2023.05.3 之前的版本

**利用条件:** 远程网络访问，无需任何身份验证（预身份验证利用）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该提供的POC脚本（TeamCity.sh）是一个高度完整且功能强大的利用工具。该漏洞的根源在于TeamCity处理特定REST API端点的授权逻辑存在缺陷，允许未经身份验证的远程攻击者绕过访问控制。脚本通过三步协同实现RCE：首先，它针对 `/app/rest/users/id:1/tokens/RPC2` 发送POST请求，利用该漏洞在无凭据的情况下为管理员用户（ID 1）生成一个有效的访问令牌；其次，脚本利用该令牌修改服务器配置，通过访问 `/admin/dataDir.html` 将 `rest.debug.processes.enable` 设置为 `true`，从而开启TeamCity的调试进程功能；最后，脚本通过 `/app/rest/debug/processes` 接口执行任意系统命令。代码逻辑清晰，通过区分Linux（使用sh和base64编码）和Windows（使用cmd.exe）目标环境，表现出了极高的实战化程度。脚本还包含了清理机制，在执行完攻击后会删除生成的Token，体现了攻击者的隐蔽性考虑。分析表明，该POC具有极高的成功率，能够直接获取服务器权限。 【利用步骤】1. 获取目标TeamCity服务器的URL和端口；2. 运行脚本，提供目标地址、端口及待执行命令（如：./TeamCity.sh target.com 8111 'id'）；3. 脚本交互式询问目标操作系统类型；4. 脚本自动触发Auth Bypass获取管理员Token；5. 脚本自动启用后台调试功能并利用该Token执行指定的RCE命令；6. 脚本清理生成的Token并回显执行结果。 【投毒风险分析】经过对POC源码的严格安全审计，该脚本被判定为低投毒风险。脚本使用标准的Bash编写，依赖项仅为常见的系统命令（curl、grep、jq、base64、awk），不包含任何加密混淆的二进制数据或外部不可信源的下载行为。代码逻辑完全透明，其核心操作（如生成Token、修改配置文件、执行RCE）均指向用户输入的目标服务器，未发现针对攻击者本地系统的恶意行为，如窃取SSH密钥、环境变量或建立反向Shell。虽然脚本涉及敏感操作，但其目的明确为验证漏洞利用效果。唯一需要注意的是，脚本中涉及的 `jq -sRr @uri` 依赖本地安装了jq工具，若无此工具脚本将报错，但这属于环境依赖问题而非投毒。由于代码完全开源且每一步逻辑都可直观审计，建议研究人员在隔离环境运行即可，无需担心供应链投毒风险。

**项目地址:** [https://github.com/Zenmovie/CVE-2023-42793](https://github.com/Zenmovie/CVE-2023-42793)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)
