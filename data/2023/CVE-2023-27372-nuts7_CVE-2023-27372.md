## CVE-2023-27372 - SPIP CMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-27372

**漏洞类型:** RCE (远程代码执行)

**影响应用:** SPIP CMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** SPIP < 4.2.1, 包括 3.2.18 之前, 4.0.10 之前, 4.1.8 之前以及 4.2.1 之前的版本

**利用条件:** 无需认证，远程网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞存在于SPIP内容管理系统的公共区域，具体位于处理表单序列化数据的逻辑中。通过分析提供的Python POC代码，攻击者首先利用 `get_anticsrf` 函数访问 `spip.php?page=spip_pass` 页面，使用 BeautifulSoup 库精准解析 HTML 文档以提取名为 `formulaire_action_args` 的 Anti-CSRF 令牌。随后，`send_payload` 函数构造了一个精心设计的 POST 请求。该漏洞的核心在于 `oubli` 参数处理不当，允许注入经过序列化的 PHP 代码。POC通过构造 `s:N:"<?php system('CMD'); ?>";` 格式的字符串，利用反序列化过程中的逻辑缺陷，实现服务器端的代码执行。由于该漏洞不需要任何身份验证即可触发，且能够直接在底层操作系统执行命令，因此其有效性和危害性极高。利用步骤：1. 确认目标 SPIP 版本是否在受影响范围内（< 4.2.1）。2. 获取目标的基础 URL 地址。3. 使用 Python 环境运行提供的脚本，并传递参数 `-u [URL]` 和 `-c [COMMAND]`。4. 脚本自动获取 Anti-CSRF 令牌并发送包含 PHP system 函数调用的 POST 请求。5. 服务器解析并执行该命令，返回执行结果。投毒风险分析：经过对提供的 Python 源代码进行深度静态分析，该 POC 代码表现出极高的透明度和安全性，符合专业安全研究的标准。首先，脚本使用的库均为 Python 标准库或广为人知的第三方库（requests, bs4, html），不包含任何私有或未知的第三方依赖，消除了依赖投毒的可能性。代码逻辑清晰，其核心功能仅限于获取 CSRF 令牌、构造 Payload 并发送 HTTP POST 请求，不存在任何隐藏的系统调用、文件读写（除标准输出外）或网络回传（C2）行为。脚本并未对代码进行任何形式的混淆或加密处理，所有操作均对审计人员完全可见。代码中定义的 `system` 调用是典型的 POC 验证手段，用于证明 RCE 的存在性，而非恶意后门。考虑到其发布者为 nuts7 且在多个知名漏洞库和安全社区（如 TryHackMe, NVD）有详细记录和复现说明，该 POC 的合法性得到了进一步验证。尽管如此，从防御角度来看，研究人员仍需注意在隔离环境（如虚拟机或容器）中测试任何 POC，以防止因环境配置错误导致的意外损害，但就代码本身而言，其投毒风险极低，仅为 5%（主要作为安全生产的标准预警数值）。

**项目地址:** [https://github.com/nuts7/CVE-2023-27372](https://github.com/nuts7/CVE-2023-27372)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)
