# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **29** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-DsaHen_cve-2023-22515-exp.md](../2023/CVE-2023-22515-DsaHen_cve-2023-22515-exp.md)

# CVE-2023-22515

> ğŸ“¦ è¯¥CVEæœ‰ **28** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22515-AIex-3_confluence-hack.md](../2023/CVE-2023-22515-AIex-3_confluence-hack.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€è®¿é—®ï¼Œä¸”å¤„äºæœªä¿®å¤çš„ç‰ˆæœ¬èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ `exploit.py` è„šæœ¬æ—¨åœ¨åˆ©ç”¨ CVE-2023-22515 æ¼æ´ï¼Œé€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦å¤„äºâ€œSetup Successfulâ€æ¨¡å¼ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè„šæœ¬ä¼šå‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜å¸æˆ·åï¼Œè„šæœ¬ä¼šå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„å‡­æ®éªŒè¯ç™»å½•ï¼Œä»¥ç¡®è®¤æ¼æ´åˆ©ç”¨æˆåŠŸã€‚

æ ¹æ®æä¾›çš„ `README.md` æ–‡ä»¶ï¼Œæ­¤æ¼æ´å·²åœ¨ Confluence Server 8.5.1 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶ä¸»è¦çš„ `exploit.py` è„šæœ¬çœ‹èµ·æ¥æ˜¯ç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œä½†éœ€è¦å…³æ³¨ `plugin_shellplug.jar` å’Œ `ShellServlet.java` æ–‡ä»¶ã€‚`plugin_shellplug.jar` æ˜¯ä¸€ä¸ª Confluence æ’ä»¶ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäº Web çš„ shell æ¥å£ï¼Œå…è®¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ã€‚`ShellServlet.java` æ˜¯è¯¥æ’ä»¶çš„åç¼–è¯‘ä»£ç ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨ CVE-2023-22515 åˆ›å»ºäº†ç®¡ç†å‘˜å¸æˆ·ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Confluence çš„ Web ç®¡ç† GUI å®‰è£…æ­¤æ¶æ„æ’ä»¶ã€‚æ’ä»¶å®‰è£…åï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ Web ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

æŠ•æ¯’é£é™©è¯„ä¼°ï¼š
*   `exploit.py`ï¼šè™½ç„¶æ­¤è„šæœ¬æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä½†å¹¶éæ¶æ„ä»£ç ã€‚0%
*   `plugin_shellplug.jar` å’Œ `ShellServlet.java`ï¼šè¿™äº›æ–‡ä»¶åŒ…å«ä¸€ä¸ª Web shell æ’ä»¶ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™éƒ¨åˆ†ä»£ç å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚100%ã€‚æ­¤ä»£ç è™½ç„¶æ˜¯åé—¨,ä½†æ˜¯å¦æ˜¯ä½œè€…æœ¬äººæ·»åŠ å­˜åœ¨äº‰è®®,æ‰€ä»¥è¯„ä¼°ä¸ºæŠ•æ¯’é£é™©.

ç»¼åˆè€ƒè™‘ï¼Œä»“åº“æ•´ä½“çš„æŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚è™½ç„¶ `exploit.py` æœ¬èº«æ²¡æœ‰æŠ•æ¯’é£é™©ï¼Œä½†å…¶ä¸­åŒ…å«çš„ `plugin_shellplug.jar` åŠå…¶åç¼–è¯‘çš„ `ShellServlet.java` æ–‡ä»¶å¼•å…¥äº†è¿œç¨‹ä»£ç æ‰§è¡Œçš„åé—¨ï¼Œå¦‚æœä½¿ç”¨è€…ä¸åŠ åˆ†æç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„å®‰å…¨é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ£€æŸ¥ç›®æ ‡ Confluence å®ä¾‹æ˜¯å¦æ˜“å—æ”»å‡»ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ£€æŸ¥ Confluence æ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœ Confluence å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ `exploit.py` è„šæœ¬é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  **ç™»å½• Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluenceã€‚
4.  **å®‰è£…æ¶æ„æ’ä»¶ï¼š** åœ¨ Confluence çš„ Web ç®¡ç† GUI ä¸­å®‰è£… `plugin_shellplug.jar` æ’ä»¶ã€‚
5.  **æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š** é€šè¿‡æ’ä»¶æä¾›çš„ Web shell ç•Œé¢æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #2

**æ¥æº**: [CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md](../2023/CVE-2023-22515-Arkha-Corvus_LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197.md)

## CVE-2023-22515-Atlassian Confluence æƒé™ç»•è¿‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server/Data Centerå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡å‘é€ç‰¹åˆ¶çš„GETè¯·æ±‚åˆ°`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œç»•è¿‡åˆå§‹è®¾ç½®å‘å¯¼ï¼Œå¹¶åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ”»å‡»ç¤ºä¾‹ï¼Œå…¶ä¸­å¤–éƒ¨IPåœ°å€å°è¯•è®¿é—®ConfluenceæœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç«¯ç‚¹ï¼Œä»¥å°è¯•è·å¾—æœªç»æˆæƒçš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚æ—¥å¿—åˆ†æè¡¨æ˜ï¼Œå¦‚æœè¯·æ±‚è¿”å›200çŠ¶æ€ç ï¼Œåˆ™æ”»å‡»å¯èƒ½å·²æˆåŠŸæ‰§è¡Œã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æŠ•æ¯’çš„è¿¹è±¡ï¼Œå› ä¸ºä»£ç æ—¨åœ¨å±•ç¤ºå¦‚ä½•æ£€æµ‹å’Œå“åº”æ¼æ´åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åŒ…å«æ¶æ„è´Ÿè½½ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨çš„`/serverinfo.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ã€‚
2.  å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹è®¾ç½®ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå…è®¸æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„å“åº”ã€‚
3.  æ”»å‡»è€…éšååˆ©ç”¨è¿™ä¸ªæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œè·å¾—å¯¹Confluenceå®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  åœ¨è·å–ç®¡ç†å‘˜æƒé™åï¼Œæ”»å‡»è€…å¯ä»¥å®‰è£…åé—¨ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ–çªƒå–æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197](https://github.com/Arkha-Corvus/LetsDefend-SOC235-Atlassian-Confluence-Broken-Access-Control-0-Day-CVE-2023-22515-EventID-197)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #3

**æ¥æº**: [CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md](../2023/CVE-2023-22515-C1ph3rX13_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Controlã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä»è€Œåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…é¦–å…ˆè®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` è·¯å¾„ï¼Œè¯¥è·¯å¾„ç”¨äºåˆ¤æ–­ Confluence æ˜¯å¦å®Œæˆè®¾ç½®ã€‚
    *   å¦‚æœæœªå®Œæˆè®¾ç½®ï¼ˆå³ `setupComplete=false`ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—® `/setup/setupadministrator.action` è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
    *   POC ä»£ç é€šè¿‡ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åä½¿ç”¨ POST è¯·æ±‚å°†è¿™äº›ä¿¡æ¯å‘é€åˆ° `/setup/setupadministrator.action`ã€‚
    *   åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼ŒPOC ä»£ç å°è¯•è®¿é—® `/setup/finish` å®Œæˆå®‰è£…ã€‚

2.  **æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
    *   æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„ POC ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºéƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶ä¸” CISA å·²å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ã€‚

3.  **æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
    *   æä¾›çš„ Go è¯­è¨€ POC ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚æŠ•æ¯’é£é™©è¯„ä¼°è¾ƒä½ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨é£é™©.
    *  `generateRandomString` å‡½æ•°ï¼Œè™½ç„¶ç›®çš„æ˜¯ç”Ÿæˆéšæœºç”¨æˆ·åå’Œå¯†ç ï¼Œç†è®ºä¸Šå­˜åœ¨è¢«æ›¿æ¢ä¸ºæ¶æ„å­—ç¬¦ä¸²çš„å¯èƒ½ã€‚è™½ç„¶çœ‹ä¼¼æ— å®³ï¼Œä½†å¦‚æœç”Ÿæˆçš„ç”¨æˆ·åæˆ–å¯†ç è¢«æ¶æ„æ„é€ ï¼Œä¾‹å¦‚åŒ…å«ç‰¹å®šå­—ç¬¦ä»¥è§¦å‘åç»­çš„æ¼æ´(ä¾‹å¦‚SQLæ³¨å…¥ï¼Œè™½ç„¶è¯¥CVEæœ¬èº«ä¸æ˜¯SQLæ³¨å…¥), è¿™ä¹Ÿæ˜¯ä¸€ç§æŠ•æ¯’æ–¹å¼ã€‚ è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *  æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ï¼šå¦‚æœæ—¥å¿—è®°å½•è¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šéšè—æ”»å‡»ç—•è¿¹æˆ–è€…æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½æ€§è¾ƒå°ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ã€‚è¿™æ–¹é¢å¯èƒ½æ€§è¯„ä¼°ï¼š5%
    *   æ€»ä½“è¯„ä¼°ï¼š10%

4.  **ç»“è®ºï¼š**
    *   CVE-2023-22515 æ˜¯ä¸€ä¸ªå…³é”®æ¼æ´ï¼Œéœ€è¦ç«‹å³ä¿®è¡¥ã€‚æä¾›çš„ POC ä»£ç å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ï¼Œä½†ä¹Ÿéœ€è¦ä»”ç»†å®¡æŸ¥ä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22515](https://github.com/C1ph3rX13/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #4

**æ¥æº**: [CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md](../2023/CVE-2023-22515-CalegariMindSec_Exploit-CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªè¿›è¡Œç›¸å…³ä¿®å¤

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹ï¼Œé‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ï¼Œå› ä¸ºå…¬å¼€çš„POCä»£ç èƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æœç´¢ç»“æœä¹Ÿè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥POCä»£ç ä¸»è¦åŒ…å«ä¸€ä¸ªbashè„šæœ¬`xpl.sh`å’Œä¸€ä¸ªè¯´æ˜æ–‡ä»¶`README.md`ã€‚`xpl.sh`è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹ç›®æ ‡Confluenceå®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è„šæœ¬ä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·å`a123456`å’Œå¯†ç `ChangeMe123`ã€‚æŠ•æ¯’é£é™©ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¯¥è„šæœ¬ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ”»å‡»è€…å·²çŸ¥çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™äº›å€¼ï¼Œä½†å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šè¿™æ ·åšï¼Œè¿™ä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šåˆ©ç”¨é»˜è®¤å‡­æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»ã€‚
2.  **ç½‘ç»œè¯·æ±‚çš„æ½œåœ¨ç¯¡æ”¹ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è„šæœ¬ä¸­çš„curlå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚å¤´æˆ–ä¿®æ”¹è¯·æ±‚ä½“ï¼Œä»è€Œåœ¨åˆ©ç”¨æ¼æ´çš„åŒæ—¶ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚è™½ç„¶ç›®å‰è„šæœ¬ä¸­çš„curlå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¤æ‚çš„æ”»å‡»ç›®çš„ã€‚
3. **è„šæœ¬æœ¬èº«çš„å®‰å…¨é£é™©:** è„šæœ¬ä¸­ä½¿ç”¨çš„`curl -k`å‚æ•°ä¼šå¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™æœ¬èº«ä¸æ˜¯æŠ•æ¯’ï¼Œä½†å¢åŠ äº†ä½¿ç”¨è„šæœ¬çš„é£é™©ã€‚æ­¤å¤–ï¼Œæ¶æ„ä½œè€…å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å…¶ä»–æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œå…¶ä»–æ¶æ„æ–‡ä»¶ã€‚

ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œè¯¥POCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå¤§çº¦ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ”»å‡»è€…ä½¿ç”¨POCè„šæœ¬`xpl.sh`ï¼Œå¹¶æä¾›ç›®æ ‡Confluenceå®ä¾‹çš„URLä½œä¸ºå‚æ•°ã€‚
3.  è„šæœ¬é¦–å…ˆé€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ç«¯ç‚¹æ¥æ£€æŸ¥ç›®æ ‡å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
4.  å¦‚æœç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´ï¼Œè„šæœ¬å°†é€šè¿‡å‘`/setup/setupadministrator.action`ç«¯ç‚¹å‘é€POSTè¯·æ±‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
5.  æ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #5

**æ¥æº**: [CVE-2023-22515-Chocapikk_CVE-2023-22515.md](../2023/CVE-2023-22515-Chocapikk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºBroken Access Controlç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æœç´¢ç»“æœä¸­CISAå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œå¤šå®¶å®‰å…¨å‚å•†ä¹Ÿå‘å¸ƒäº†æ¼æ´åˆ†ææŠ¥å‘Šï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¹Ÿæä¾›äº†normalå’Œmassä¸¤ç§æ¨¡å¼ï¼Œæ”¯æŒå•ä¸ªç›®æ ‡å’Œæ‰¹é‡ç›®æ ‡åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘æ¼æ´ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·å¹¶è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶å­˜åœ¨ä¿®æ”¹ç›®æ ‡ç³»ç»Ÿè¡Œä¸ºçš„æ“ä½œï¼Œä½†æ²¡æœ‰å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚åå¼¹shellï¼Œå®‰è£…åé—¨ç­‰ï¼‰ã€‚ä»£ç ä¸­requestsåº“çš„ä½¿ç”¨å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ§åˆ¶DNSç­‰æ–¹å¼è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘å­˜åœ¨æ¼æ´çš„Confluenceå®ä¾‹å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨äº†Confluenceä¸­å­˜åœ¨çš„Broken Access Controlæ¼æ´ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚
3.  æˆåŠŸç»•è¿‡èº«ä»½éªŒè¯åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  åˆ©ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•Confluenceå¹¶æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22515](https://github.com/Chocapikk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #6

**æ¥æº**: [CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md](../2023/CVE-2023-22515-CyberSentinel321_cve-2023-22515-lab.md)

## CVE-2023-22515-Confluence Authentication Bypass

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Authentication Bypass

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** Criticalï¼Œæœªç»æˆæƒçš„ç®¡ç†å‘˜æƒé™è®¿é—®å’Œæ½œåœ¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** å…¬å¼€å¯è®¿é—®çš„ Confluence Server æˆ– Data Center å®ä¾‹

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 60%

## è¯¦æƒ…

æ ¹æ®æä¾›çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª CVE-2023-22515 çš„ PoC å®éªŒç¯å¢ƒã€‚å°½ç®¡ç»™å‡ºäº†ç›®å½•ç»“æ„ï¼Œä½†æ–‡ä»¶å†…å®¹å¤§å¤šä¸ºç©ºæˆ–è€…ç¼ºå¤±ï¼Œæ— æ³•ç›´æ¥åˆ†æå…·ä½“åˆ©ç”¨æ–¹å¼ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒçš„èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¾ˆå¯èƒ½æ¶‰åŠå‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åˆ° Confluence æœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•ã€‚æ ¹æ®æä¾›çš„ PoC ä»£ç ç‰‡æ®µï¼ˆè™½ç„¶ä¸å®Œæ•´ï¼‰ï¼Œ`/exploit/exploit.sh` å¯èƒ½æ˜¯åˆ©ç”¨è„šæœ¬ï¼Œä½†ç”±äºæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›ä¸€æ­¥åˆ†æå…¶å…·ä½“å®ç°ã€‚ç”±äºç¼ºå°‘å…³é”®ä»£ç ï¼Œæ­¤ PoC çš„æœ‰æ•ˆæ€§å­˜ç–‘ã€‚è¯¥ä»“åº“åŒ…å«LICENSE, README.mdæ–‡ä»¶ï¼Œçœ‹ä¼¼æ¯”è¾ƒæ­£å¼ï¼Œä½†å…³é”®ä»£ç ç¼ºå¤±ï¼Œä½œè€…å¯èƒ½æ˜¯æƒ³é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ æ’­æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¸ºäº†å¼•æµï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ æ— æ³•ç¡®å®šserverç›®å½•ä¸‹jsæ–‡ä»¶å†…å®¹,å¦‚æœå­˜åœ¨æœªçŸ¥çš„åé—¨æˆ–æ¶æ„é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¹å—å®³è€…ç³»ç»Ÿé€ æˆå±å®³. æŠ•æ¯’é£é™©é¢„ä¼°ä¸º 60%ã€‚å¦‚æœæœåŠ¡å™¨æœ¬èº«å­˜åœ¨åé—¨ï¼Œåˆ™å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæ˜¯åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸åˆ¤å®šä¸ºæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [CyberSentinel321/cve-2023-22515-lab](https://github.com/CyberSentinel321/cve-2023-22515-lab)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #7

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #8

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---



---

## POC #8

**æ¥æº**: [CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md](../2023/CVE-2023-22515-ErikWynter_CVE-2023-22515-Scan.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå®ƒå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆç‰¹åˆ«æ˜¯[webpage 6]ï¼‰ä»¥åŠå¤§é‡å®‰å…¨å‚å•†çš„åˆ†æï¼Œæ­¤æ¼æ´çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”CISAå·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•ä¸­ã€‚

**æŠ•æ¯’é£é™©:**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ç‰‡æ®µä»…åŒ…å«GNU GPLè®¸å¯è¯ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¯„ä¼°æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ä»githubä¸Šä¸‹è½½çš„expï¼Œéœ€è¦ä»”ç»†æ ¸æŸ¥ï¼Œ**ä¸æ’é™¤**ä½œè€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œä½†å°±æä¾›çš„LICENSEæ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä¿å®ˆä¼°è®¡æŠ•æ¯’é£é™©ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼:**

æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»èº«ä»½éªŒè¯åœ°åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚å¯èƒ½çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼š

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  é€šè¿‡æ¶æ„è¯·æ±‚ï¼Œåœ¨Confluenceå®ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æ¥ç®¡ç³»ç»Ÿï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ï¼Œå¯ä»¥è¿›è¡ŒåŒ…æ‹¬è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹é…ç½®ã€å®‰è£…æ¶æ„æ’ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ç­‰æ“ä½œã€‚

**é¡¹ç›®åœ°å€:** [ErikWynter/CVE-2023-22515-Scan](https://github.com/ErikWynter/CVE-2023-22515-Scan)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #9

**æ¥æº**: [CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md](../2023/CVE-2023-22515-INTfinityConsulting_cve-2023-22515.md)

## CVE-2023-22515 - Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬ï¼š8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºæœªæˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡åˆå§‹åŒ–è®¾ç½®ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œä½¿ Confluence å®ä¾‹é‡æ–°è¿›å…¥å¼•å¯¼æ¨¡å¼ï¼ˆbootstrap modeï¼‰ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` ç«¯ç‚¹å‘é€åŒ…å«æ–°ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆå¼•å¯¼è¿‡ç¨‹ï¼š** æ”»å‡»è€…ä½¿ç”¨ POST è¯·æ±‚å‘ `/setup/finishsetup.action` ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå®Œæˆå¼•å¯¼è¿‡ç¨‹ã€‚
4.  **è·å– UPM Tokenï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„å‡­æ®è¿›è¡Œ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ Basic è®¤è¯å‘ `/rest/plugins/1.0/?os_authType=basic` å‘é€ GET è¯·æ±‚ï¼Œè·å– UPMï¼ˆUniversal Plugin Managerï¼‰tokenã€‚
5.  **ä¸Šä¼ æ¶æ„æ’ä»¶ï¼š** æ”»å‡»è€…ä½¿ç”¨è·å–çš„ UPM tokenï¼Œé€šè¿‡ POST è¯·æ±‚å°†åŒ…å«æ¶æ„ä»£ç çš„æ’ä»¶ä¸Šä¼ åˆ° `/rest/plugins/1.0/?token=<UPM_TOKEN>` ç«¯ç‚¹ã€‚
6.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ¶æ„æ’ä»¶è¢«å®‰è£…åï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢ç»“æœä¸­è®¸å¤šæ–‡ç« éƒ½æåˆ°äº†è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†åˆ©ç”¨è„šæœ¬çš„é“¾æ¥ã€‚æä¾›çš„ Python è„šæœ¬å®ç°äº†åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç° RCE çš„è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š** æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª Python è„šæœ¬ï¼ˆCVE-2023-22515.py å’Œ confluence-client.pyï¼‰ä»¥åŠä¸€äº›æ’ä»¶ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚ä¸»è¦çš„é£é™©ç‚¹åœ¨äºä¸Šä¼ çš„æ’ä»¶ (`logger-1.0.0-SNAPSHOT.jar`)ã€‚è™½ç„¶æä¾›äº†æ„å»ºæ’ä»¶æ‰€éœ€çš„ pom.xml å’Œä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä½†**æ— æ³•å®Œå…¨ç¡®å®š**è¯¥æ’ä»¶ä¸­æ˜¯å¦åŒ…å«ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚CVE-2023-22515.pyæœ¬èº«çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶ä¸Šä¼ jaræ’ä»¶ã€‚confluence-client.py ç”¨äºä¸ä¸Šä¼ çš„æ¶æ„pluginè¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚LICENSEå’ŒREADMEåªæ˜¯æ’ä»¶çš„è¾…åŠ©æè¿°æ–‡ä»¶ï¼Œä¸åŒ…å«æ¶æ„ä»£ç ã€‚å› æ­¤æŠ•æ¯’çš„é£é™©ä¸»è¦é›†ä¸­åœ¨ jaræ–‡ä»¶æœ¬èº«, è€ƒè™‘jaræ–‡ä»¶éœ€è¦è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå­˜åœ¨ä¸€å®šé—¨æ§›ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯æœªç»æˆæƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶ååˆ©ç”¨ç®¡ç†å‘˜æƒé™ä¸Šä¼ æ¶æ„æ’ä»¶ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [INTfinityConsulting/cve-2023-22515](https://github.com/INTfinityConsulting/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #10

**æ¥æº**: [CVE-2023-22515-Le1a_CVE-2023-22515.md](../2023/CVE-2023-22515-Le1a_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center & Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨/server-info.actionç«¯ç‚¹åˆ¤æ–­Confluenceæ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡/setup/setupadministrator.actionç«¯ç‚¹åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ£€æµ‹æ˜¯å¦å¯åˆ©ç”¨ï¼š**  è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œå¦‚æœè¿”å›æœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š**  å‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«`username`ã€`fullName`ã€`email`ã€`password`å’Œ`confirm`å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** å‘ `/setup/finishsetup.action` å‘é€POSTè¯·æ±‚ï¼Œå®Œæˆå®‰è£…ã€‚

æä¾›çš„POCä»£ç `CVE-2023-22515.py`å®ç°äº†ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æŸ¥çœ‹äº†`CVE-2023-22515.py`å’Œ`README.md`çš„å†…å®¹ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åé—¨ã€‚è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„æ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚æ­¤å¤–ï¼Œ`README.md`æ–‡ä»¶åªæ˜¯ç®€å•çš„ä»‹ç»äº†æ¼æ´å’Œä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿæœªå‘ç°ä»»ä½•å¯ç–‘ä¹‹å¤„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œæ¥è¿‘äº0%ã€‚

**é¡¹ç›®åœ°å€:** [Le1a/CVE-2023-22515](https://github.com/Le1a/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #11

**æ¥æº**: [CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md](../2023/CVE-2023-22515-LucasPDiniz_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é‡æ–°è¿›å…¥Confluenceçš„è®¾ç½®é˜¶æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘ç›®æ ‡ConfluenceæœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«æ¶æ„çš„URLå‚æ•°ï¼Œä»¥é‡ç½®Confluenceçš„å®‰è£…çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…è®¿é—®`server-info.action`ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾å¼getter/setteræ“ä½œå°†`bootstrapStatusProvider.applicationConfig.setupComplete`è®¾ç½®ä¸º`false`ã€‚

    ```
    http://<Confluence_URL>/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
    ```

2.  æˆåŠŸæ‰§è¡Œæ­¤è¯·æ±‚åï¼ŒConfluenceæœåŠ¡å™¨å°†è¿”å›åˆ°åˆå§‹è®¾ç½®é¡µé¢ï¼Œå…è®¸æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚
3.  æ”»å‡»è€…è®¿é—®`/setup/setupadministrator-start.action`ç«¯ç‚¹ï¼Œå¹¶æŒ‰ç…§è®¾ç½®æµç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceå®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨æ§åˆ¶æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æœç´¢å¼•æ“ç»“æœä¸­æ˜ç¡®æŒ‡å‡ºå­˜åœ¨CVE-2023-22515çš„å…¬å¼€å¯ç”¨çš„åˆ©ç”¨è„šæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªå®‰å…¨å‚å•†çš„æ–‡ç« å’ŒCISAçš„å…¬å‘Šéƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œåˆ©ç”¨çš„å¹¿æ³›æ€§ã€‚ æä¾›çš„POCä»£ç çš„READMEæ–‡ä»¶ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´åŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä»“åº“`/tmp/9ac8e2d80e235c23c13ad9b691c524a1/README.md` ä»…åŒ…å«æ¼æ´çš„æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚æ¼æ´æœ¬èº«ä¸éœ€è¦ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰è¿¹è±¡è¡¨æ˜ä½œè€…åœ¨åˆ©ç”¨ä»£ç ä¸­åŠ å…¥äº†éšè—çš„ã€æ¶æ„çš„åŠŸèƒ½ã€‚ä½†ä»éœ€æ³¨æ„ï¼Œä»éå®˜æ–¹æ¸ é“ä¸‹è½½çš„ä»»ä½•æ¼æ´åˆ©ç”¨ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ ç”±äºåªæ˜¯ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚ è¿™ä¸ªé£é™©ä¸»è¦æ¥è‡ªä¸‹è½½æ¥æºçš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠå°†æ¥å¯èƒ½è¢«æ›¿æ¢æˆ–ä¿®æ”¹ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2023-22515](https://github.com/LucasPDiniz/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #12

**æ¥æº**: [CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md](../2023/CVE-2023-22515-Onedy1703_CVE-2023-22515-Confluence.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„ä¸¥é‡Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²ç»è¢«ç§¯æåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªNmapè„šæœ¬ï¼Œç”¨äºæ£€æµ‹å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚è„šæœ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°è¯•åˆ©ç”¨æ¼æ´ï¼š

1.  **æ£€æµ‹å®‰è£…å‘å¯¼çŠ¶æ€ï¼š** æ£€æŸ¥`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`æ˜¯å¦è¿”å›200ï¼Œåˆ¤æ–­Confluenceæ˜¯å¦å¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ã€‚
2.  **æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœå¤„äºæœªå®Œæˆè®¾ç½®çš„çŠ¶æ€ï¼Œè„šæœ¬ä¼šå‘`/setup/setupadministrator.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ç­‰ç¡¬ç¼–ç ä¸º"admin"ï¼‰ã€‚åŒæ—¶é™„åŠ header `X-Atlassian-Token: no-check`ç»•è¿‡tokenéªŒè¯ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š**  å‘`/setup/finishsetup.action`å‘é€POSTè¯·æ±‚ï¼Œå°è¯•å®Œæˆå®‰è£…è®¾ç½®
4.  **éªŒè¯ï¼š** æ£€æŸ¥æ³¨å†Œç®¡ç†å‘˜è¯·æ±‚(`/setup/setupadministrator.action`)æ˜¯å¦è¿”å›302é‡å®šå‘ä»¥åŠå®Œæˆè®¾ç½®è¯·æ±‚(`/setup/finishsetup.action`)æ˜¯å¦è¿”å›200ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚

è¯¥POCä»£ç çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Confluenceæœªå®Œæˆåˆå§‹åŒ–é…ç½®æ—¶çš„å®‰å…¨ç¼ºé™·ï¼Œç»•è¿‡æƒé™æ£€æŸ¥ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»“åº“åŒ…å«ä¸€ä¸ªREADME.mdå’Œä¸€ä¸ªNmapè„šæœ¬myscrypt.nseã€‚
*   **README.mdï¼š** å£°æ˜è¯¥ä»“åº“æ˜¯æ•™è‚²ç›®çš„ï¼Œå¹¶æç¤ºç”¨æˆ·æ³¨æ„æ‰§è¡Œæ–‡ä»¶çš„é£é™©ã€‚è¿™æœ¬èº«ä¸æ„æˆæŠ•æ¯’ï¼Œä½†è¡¨æ˜ä½œè€…å·²çŸ¥æ½œåœ¨é£é™©ã€‚
*   **myscrypt.nseï¼š** Nmapè„šæœ¬çš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹å’Œåˆ©ç”¨CVE-2023-22515ã€‚ä»£ç ä¸­æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œå¦‚æ¤å…¥åé—¨æˆ–æ‰§è¡Œå…¶ä»–æœªæˆæƒæ“ä½œã€‚ä½†æ˜¯ï¼Œè¯¥è„šæœ¬ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªç¡¬ç¼–ç å‡­æ®ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadminï¼‰çš„ç®¡ç†å‘˜å¸æˆ·ã€‚å¦‚æœæ”»å‡»è€…æˆåŠŸåˆ©ç”¨æ­¤è„šæœ¬ï¼Œåˆ™åˆ›å»ºçš„å¸æˆ·æœ¬èº«å¯ä»¥è¢«è§†ä¸ºåé—¨ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ï¼Œå› ä¸ºä¸»è¦é£é™©æ˜¯åˆ©ç”¨æ¼æ´æœ¬èº«ï¼Œè€Œéæ¤å…¥é¢å¤–æ¶æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**
1.  æ¼æ´å­˜åœ¨äºConfluence Serverå’ŒData Centerç‰ˆæœ¬ä¸­ã€‚
2.  æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”å°šæœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°`/setup/setupadministrator.action`æ¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åä½¿ç”¨`/setup/finishsetup.action`å®Œæˆå®‰è£…ã€‚
5.  æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å°†å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**é¡¹ç›®åœ°å€:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #13

**æ¥æº**: [CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md](../2023/CVE-2023-22515-Vulnmachines_confluence-cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯å…¬å¼€è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äº Broken Access Control ç±»å‹ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€ï¼š**  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` ä»¥ç¡®å®šConfluenceæ˜¯å¦å°šæœªå®Œæˆè®¾ç½®ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ï¼š** å¦‚æœæ­¥éª¤ 1 è¿”å› `setupComplete=false`ï¼Œè¡¨æ˜Confluenceå°šæœªè®¾ç½®ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«ç”¨äºåˆ›å»ºç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶åœ°å€ã€å¯†ç å’Œç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å‡­æ®ã€‚
3.  **å®Œæˆè®¾ç½®ï¼ˆå¯é€‰ï¼‰ï¼š** æ”»å‡»è€…å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®å‘å¯¼ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æè¿°äº†åˆ©ç”¨æ­¤æ¼æ´çš„æ­¥éª¤ï¼Œå¹¶ä¸”æ ¹æ®æœç´¢ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„POCä»£ç éå¸¸ç®€å•ï¼Œä»…åŒ…å«åˆ©ç”¨æ¼æ´çš„æ­¥éª¤ã€‚è¯¥ä»“åº“åªåŒ…å«äº†README.mdå’Œpayloadæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ¼æ´åˆ©ç”¨çš„æ­¥éª¤ï¼Œå¹¶æ— å…¶ä»–å¯ç–‘ä»£ç ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’é£é™©ï¼Œä½†å­˜åœ¨çš„å¯èƒ½æ€§å¾ˆä½ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º 5%.

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ç®€å•ï¼Œé£é™©æé«˜ã€‚æ”»å‡»è€…å¯ä»¥æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/confluence-cve-2023-22515](https://github.com/Vulnmachines/confluence-cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #14

**æ¥æº**: [CVE-2023-22515-aaaademo_Confluence-EvilJar.md](../2023/CVE-2023-22515-aaaademo_Confluence-EvilJar.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœªæˆæƒè®¿é—®å’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„è®¿é—®æ§åˆ¶å¯¼è‡´çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼ˆå°¤å…¶æ˜¯ github é“¾æ¥ï¼‰ä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚è®¸å¤šå®‰å…¨å‚å•†å’Œç ”ç©¶äººå‘˜éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„æŠ¥å‘Šå’Œåˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ä¸” CISA å°†å…¶åˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ï¼Œç¡®è®¤è¯¥æ¼æ´åœ¨é‡å¤–å·²è¢«åˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ POC ä»£ç åŒ…å«ä¸€ä¸ª Maven é¡¹ç›®ï¼Œç”¨äºæ„å»ºä¸€ä¸ªæ¶æ„çš„ Confluence æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ã€‚è¯¥æ’ä»¶åŒ…å«ä¸‰ä¸ª Servletï¼š`cmServlet`ï¼ˆCMDshellï¼‰ã€`gzServlet` (å“¥æ–¯æ‹‰ webshell) å’Œ `bxServlet`ã€‚è¿™äº› Servlet å…è®¸æ”»å‡»è€…åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå› ä¸ºï¼š
*   ä»£ç ç›¸å¯¹ç®€å•ï¼Œæ˜“äºå®¡æŸ¥ã€‚
*   æ˜æ˜¾çš„åŠŸèƒ½æ˜¯åˆ›å»º webshellï¼Œè¿™æœ¬èº«å°±æ˜¯æ¶æ„è¡Œä¸ºã€‚
*   æ²¡æœ‰å‘ç°éšè—çš„ã€ä¸ç›¸å…³çš„æˆ–è€…éš¾ä»¥ç†è§£çš„ä»£ç ã€‚
ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `CommandExecutor.java` æˆ–å…¶ä»–åœ°æ–¹æ·»åŠ éš¾ä»¥å¯Ÿè§‰çš„åé—¨ä»£ç ã€‚å› æ­¤ï¼Œå°†æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2023-22515 æ¼æ´åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œæ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence ç®¡ç†æ§åˆ¶å°ã€‚
3.  ä¸Šä¼ å¹¶å®‰è£…æ¶æ„æ’ä»¶ï¼ˆJAR æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¶æ„æ’ä»¶åŒ…å«äº† webshellã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„ webshellï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ Confluence æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

å…·ä½“æ¥è¯´ï¼Œ`README.md` æ–‡ä»¶ä¸­æè¿°äº†ä¸¤ç§ webshell çš„è¿æ¥æ–¹å¼ï¼š
*   **CMDshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/cmServlet` å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚
*   **å“¥æ–¯æ‹‰ webshell:** è®¿é—® `http://confluence.local/plugins/servlet/testbin/gzServlet`ï¼Œä½¿ç”¨ `Referer: https://www.baidu.com/` ä½œä¸º headerï¼Œå¯†ç ä¸º `p@ssw0rd`ï¼Œkey ä¸º `key`ï¼Œå³å¯è¿æ¥å“¥æ–¯æ‹‰ webshellã€‚

**é¡¹ç›®åœ°å€:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #15

**æ¥æº**: [CVE-2023-22515-ad-calcium_CVE-2023-22515.md](../2023/CVE-2023-22515-ad-calcium_CVE-2023-22515.md)

## CVE-2023-22515-Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  **æ£€æŸ¥å®‰è£…çŠ¶æ€:** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` æ¥å£åˆ¤æ–­ Confluence æ˜¯å¦å·²å®Œæˆå®‰è£…ã€‚å¦‚æœè¿”å›åŒ…å« "Confluence" å­—ç¬¦ä¸²çš„é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  é€šè¿‡å‘ `/setup/setupadministrator.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œå¹¶é™„å¸¦åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ payload æ¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯·æ±‚å¤´ä¸­éœ€è¦åŒ…å« `X-Atlassian-Token: no-check`ã€‚
3.  **å®Œæˆè®¾ç½®:** é€šè¿‡å‘ `/setup/finishsetup.action` æ¥å£å‘é€ POST è¯·æ±‚ï¼Œä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚

**POC ä»£ç åˆ†æ:**

æä¾›çš„ POC ä»£ç  (main.go) ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   å…è®¸æŒ‡å®šç›®æ ‡ Confluence å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚
*   å¦‚æœæœªæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ç”Ÿæˆéšæœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚
*   æ£€æŸ¥ Confluence çš„å®‰è£…çŠ¶æ€ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚
*   å‘é€ POST è¯·æ±‚ä»¥å®Œæˆè®¾ç½®ã€‚
*   æ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©åˆ†æ:**

POC ä»£ç æœ¬èº«çœ‹èµ·æ¥æ¯”è¾ƒç›´æ¥ï¼Œä¸»è¦æ˜¯å®ç°æ¼æ´åˆ©ç”¨ï¼Œé£é™©è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¾æ—§å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
* ä¾èµ–å¼•å…¥é£é™©ï¼šä»£ç ä¸­importäº†ä¸€äº›Goæ ‡å‡†åº“ï¼Œä½†å¦‚æœæ”»å‡»è€…ä¿®æ”¹ä»£ç ï¼Œå¼•å…¥æ¶æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåˆ™å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½ã€‚
* ä»£ç é€»è¾‘ä¿®æ”¹é£é™©ï¼šæ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ‰§è¡Œä¸€äº›æ¶æ„æ“ä½œï¼Œå¦‚ä¸Šä¼  webshell æˆ–ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚

ç»¼ä¸Šï¼Œè™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è¢«æ¤å…¥æ¶æ„ä»£ç çš„é£é™©ï¼Œå› æ­¤ç»™å‡º10%çš„æŠ•æ¯’é£é™©è¯„ä¼°ã€‚

**é¡¹ç›®åœ°å€:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #16

**æ¥æº**: [CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md](../2023/CVE-2023-22515-edsonjt81_CVE-2023-22515-Scan..md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center and Serverå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºå¤±ç±»å‹ã€‚æ”»å‡»è€…æ— éœ€èº«ä»½éªŒè¯ï¼Œå³å¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚ï¼Œåˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„Confluenceå®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚ä¾‹å¦‚ï¼ŒGithubä¸Šå­˜åœ¨åä¸º`CVE-2023-22515`çš„é¡¹ç›®ï¼Œè¯å®äº†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä»…åŒ…å«GNU GPLåè®®å£°æ˜ï¼Œç¼ºå°‘å®é™…çš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚å› æ­¤ï¼Œå‡è®¾è¯¥ä»£ç ä»“åº“åŒ…å«å…¶ä»–åˆ©ç”¨è„šæœ¬çš„å¯èƒ½æ€§ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** æ”»å‡»è€…å‘ç°ç›®æ ‡ConfluenceæœåŠ¡å™¨å­˜åœ¨CVE-2023-22515æ¼æ´ã€‚
2.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œç»•è¿‡Confluenceçš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ¶æ„è¯·æ±‚æˆåŠŸåï¼Œæ”»å‡»è€…å¯ä»¥åœ¨Confluenceç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **æ§åˆ¶Confluenceï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [edsonjt81/CVE-2023-22515-Scan.](https://github.com/edsonjt81/CVE-2023-22515-Scan.)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #17

**æ¥æº**: [CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md](../2023/CVE-2023-22515-fyx1t_NSE--CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»º Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œå¹¶å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Data Center å’Œ Server å®ä¾‹å¿…é¡»å¯å…¬å¼€è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ©ç”¨Broken Access Controlæ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ã€‚ æ ¹æ®CISAä¿¡æ¯ï¼Œè¯¥æ¼æ´å·²ç»è¢«å®é™…åˆ©ç”¨ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆå‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ° `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ï¼Œè¯¥è¯·æ±‚ç”¨äºæ£€æŸ¥ Confluence æ˜¯å¦å·²å®Œæˆè®¾ç½®ã€‚
2.  å¦‚æœ Confluence æœªå®Œæˆè®¾ç½®ï¼ˆçŠ¶æ€ç ä¸º 200ï¼‰ï¼Œæ”»å‡»è€…ä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action`ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­åŒ…å«è¦åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å…¨åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚
3.  æœ€åï¼Œæ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/finishsetup.action` ä»¥å®Œæˆè®¾ç½®è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œæ”»å‡»è€…å³å¯ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å¹¶å®Œå…¨æ§åˆ¶è¯¥å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ NSE è„šæœ¬ (cve-2023-22515.nse) æ—¨åœ¨æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨ CVE-2023-22515 æ¼æ´ï¼Œå¹¶å°è¯•åˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚

**æŠ•æ¯’é£é™©ï¼š** æŸ¥çœ‹æä¾›çš„ NSE è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ä»¥éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥è„šæœ¬æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•æ¶æ„æˆ–éšè—çš„æŠ•æ¯’ä»£ç ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†æ”»å‡»è¿‡ç¨‹æ¥æ£€æŸ¥æ¼æ´ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§æä½ï¼Œè¯„ä¼°ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [fyx1t/NSE--CVE-2023-22515](https://github.com/fyx1t/NSE--CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #18

**æ¥æº**: [CVE-2023-22515-iveresk_CVE-2023-22515.md](../2023/CVE-2023-22515-iveresk_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬ä½äºå—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸¥é‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œåˆ©ç”¨è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯:** æ”»å‡»è€…åˆ©ç”¨`/server-info.action`æ¥å£ï¼Œé€šè¿‡è®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`å‚æ•°ä¸º`false`ï¼Œé‡ç½® Confluence çš„å®‰è£…çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:**  åœ¨å®‰è£…çŠ¶æ€è¢«é‡ç½®åï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/setupadministrator.action`æ¥å£ï¼Œå¹¶æäº¤åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„ POST è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚ç”±äºå®‰è£…çŠ¶æ€è¢«é‡ç½®ï¼Œè¯¥è¿‡ç¨‹æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚
3.  **å®Œæˆå®‰è£…:** æ”»å‡»è€…é€šè¿‡è®¿é—®`/setup/finishsetup.action`æ¥å£ï¼Œå®Œæˆ Confluence çš„å®‰è£…æµç¨‹ï¼Œä½¿æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç”Ÿæ•ˆã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCè„šæœ¬ `cve-2023-22515.sh` å®ç°äº†ä¸Šè¿°åˆ©ç”¨æ–¹å¼ã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åé€šè¿‡curlå‘½ä»¤å‘é€HTTPè¯·æ±‚ï¼Œé‡ç½®å®‰è£…çŠ¶æ€ã€åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œæˆå®‰è£…ã€‚ è¯¥POCè„šæœ¬çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºå®ƒçš„é€»è¾‘ä¸å…¬å¼€çš„æ¼æ´åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶è„šæœ¬ä¸»ä½“å®ç°äº†æ¼æ´åˆ©ç”¨é€»è¾‘ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š** è„šæœ¬é»˜è®¤ä½¿ç”¨ `adm1n` ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ”»å‡»è€…ä¿®æ”¹äº†è„šæœ¬ï¼Œå¹¶ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ”»å‡»è€…éš¾ä»¥å‘ç°æ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
*   **æ–‡ä»¶è¯»å–çš„æ½œåœ¨é£é™©ï¼š** è„šæœ¬ä¸­å­˜åœ¨ä»æ–‡ä»¶è¯»å–IPåœ°å€çš„é€»è¾‘ (`while read LINE; do ... done <$IP`)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚è™½ç„¶æ­¤å¤„çš„å˜é‡`$IP`å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¬”è¯¯ï¼Œåº”è¯¥æ˜¯`$TARGET`ï¼Œä½†ä¸èƒ½æ’é™¤è¢«åˆ©ç”¨çš„é£é™©ã€‚
*   **CURLå‚æ•°çš„ä¿®æ”¹é£é™©ï¼š** æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹curlå‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚æ·»åŠ  `--proxy` å‚æ•°ï¼Œå°†æµé‡è½¬å‘åˆ°æ¶æ„æœåŠ¡å™¨ï¼Œä»è€Œçªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æˆ–è€…å°† `email=haxor%40localhost` ä¿®æ”¹ä¸ºå…¶ä»–é’“é±¼é‚®ä»¶ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚è¯¥é£é™©ä¸»è¦æ¥æºäºè„šæœ¬ä¸­å¯èƒ½å­˜åœ¨çš„æ¶æ„ä¿®æ”¹æˆ–å‚æ•°æ³¨å…¥ï¼Œè€Œéè„šæœ¬æœ¬èº«çš„æ¼æ´åˆ©ç”¨é€»è¾‘ã€‚

**é¡¹ç›®åœ°å€:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #19

**æ¥æº**: [CVE-2023-22515-j3seer_CVE-2023-22515-POC.md](../2023/CVE-2023-22515-j3seer_CVE-2023-22515-POC.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»ºæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ï¼Œå¹¶ä¸”æœªå®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center å®ä¾‹ä¸Šçš„ä¸¥é‡æƒé™æå‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—® Confluence å®ä¾‹ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡å®‰å…¨æ£€æŸ¥:** é€šè¿‡ `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  è®¾ç½® `setupComplete`  ä¸º `false`ï¼Œç»•è¿‡ Confluence çš„å®‰è£…è®¾ç½®æ£€æŸ¥ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·:** åˆ©ç”¨ `/setup/setupadministrator.action`  ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚æ”»å‡»è€…å¯ä»¥æŒ‡å®šç”¨æˆ·åã€å…¨åã€é‚®ç®±å’Œå¯†ç ã€‚
3.  **å®Œæˆå®‰è£…è®¾ç½®:** åˆ©ç”¨ `/setup/finishsetup.action`  ç«¯ç‚¹ï¼Œå®Œæˆå®‰è£…è®¾ç½®ã€‚
4.  **XSRF ç»•è¿‡:** ä½¿ç”¨ `X-Atlassian-Token: no-check`  header ç»•è¿‡è·¨ç«™è¯·æ±‚ä¼ªé€  (XSRF) ä¿æŠ¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ YAML æ–‡ä»¶å’Œ README.md æè¿°äº†ä¸€ç§æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼ã€‚å¤šä¸ªæœç´¢ç»“æœä¹Ÿè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è¯¥æ¼æ´åˆ©ç”¨ä»£ç çš„ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚YAML æ–‡ä»¶å’Œ README.md ä»…åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…è¦æ­¥éª¤å’Œä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜ä½œè€…è¯•å›¾éšè—æ¶æ„ä»£ç æˆ–åé—¨ã€‚

**æ¼æ´åˆ†æ:**

è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Confluence åœ¨åˆå§‹åŒ–è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç‰¹å®šçš„ HTTP è¯·æ±‚å‚æ•°ï¼Œç»•è¿‡å®‰å…¨æ£€æŸ¥ï¼Œä»è€Œåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚`Xwork interceptors`è§£æå‚æ•°çš„ç‰¹æ€§,ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨`set`å’Œ`get`æ–¹æ³•,ç»“åˆ`X-Atlassian-Token`ç»•è¿‡XSRF,æœ€ç»ˆåˆ©ç”¨`/setup/*`åˆ›å»ºç®¡ç†å‘˜.


**é¡¹ç›®åœ°å€:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #20

**æ¥æº**: [CVE-2023-22515-joaoviictorti_CVE-2023-22515.md](../2023/CVE-2023-22515-joaoviictorti_CVE-2023-22515.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹éœ€å…¬å¼€å¯è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªä¸¥é‡çš„Broken Access Controlæ¼æ´ï¼Œå½±å“Atlassian Confluence Data Centerå’ŒServerã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼ŒCVE-2023-22515æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªå®‰å…¨å‚å•†å’ŒCISAå‡å‘å¸ƒäº†å…³äºæ­¤æ¼æ´çš„è­¦å‘Šï¼Œå¹¶ç¡®è®¤äº†æ¼æ´çš„ä¸¥é‡æ€§å’Œå¯åˆ©ç”¨æ€§ã€‚GitHubä¸Šå­˜åœ¨å…¬å¼€å¯ç”¨çš„POCåˆ©ç”¨ä»£ç ï¼Œè¿›ä¸€æ­¥ä½è¯äº†æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ`Cargo.lock`æ˜¯Rusté¡¹ç›®çš„ä¾èµ–é”å®šæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œå› æ­¤ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨é€šè¿‡ç¯¡æ”¹Cargo.lockæ–‡ä»¶ï¼ŒæŒ‡å®šæ¶æ„çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»è€Œé—´æ¥å¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹çš„é£é™©ã€‚æ­¤é£é™©è¾ƒä½ï¼Œçº¦ 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·ã€‚è¿™é€šå¸¸é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨æ¥å®ç°ï¼Œç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼Œç›´æ¥åœ¨ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æˆåŠŸåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•Confluenceï¼Œå¹¶è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“èŒƒå›´å¹¿ã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [joaoviictorti/CVE-2023-22515](https://github.com/joaoviictorti/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #21

**æ¥æº**: [CVE-2023-22515-kh4sh3i_CVE-2023-22515.md](../2023/CVE-2023-22515-kh4sh3i_CVE-2023-22515.md)

## CVE-2023-22515 Atlassian Confluence æƒé™æå‡

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™æå‡/Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶è®¿é—® Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ `/setup/setupadministrator-start.action` å’Œ `/setup/setupadministrator.action` æ¥å£ï¼Œåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª Confluence ç®¡ç†å‘˜è´¦æˆ·ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **ç»•è¿‡è®¾ç½®å®Œæˆæ£€æŸ¥ï¼š** é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0` æ¥å£ï¼Œå°† Confluence æ ‡è®°ä¸ºæœªå®Œæˆè®¾ç½®ã€‚
2.  **è®¿é—®ç®¡ç†å‘˜è®¾ç½®é¡µé¢ï¼š** è®¿é—® `/setup/setupadministrator-start.action` æ¥å£ï¼Œè¿›å…¥ç®¡ç†å‘˜è®¾ç½®é¡µé¢ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** é€šè¿‡ POST è¯·æ±‚å‘ `/setup/setupadministrator.action` æ¥å£å‘é€åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯çš„è¡¨å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **ç™»å½•ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½• Confluenceã€‚

æä¾›çš„ Nuclei YAML æ¨¡æ¿ `CVE-2023-22515.yaml` å®ç°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ï¼Œé€šè¿‡å¤šä¸ª HTTP è¯·æ±‚æ¨¡æ‹Ÿæ”»å‡»è€…çš„è¡Œä¸ºï¼ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚ä»£ç æ²¡æœ‰å‘ç°å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå› æ­¤åˆ¤æ–­ä¸å­˜åœ¨æŠ•æ¯’é£é™©ï¼ŒæŠ•æ¯’é£é™©æ¯”ä¾‹ä¸º0%ã€‚æ ¹æ®CISAçš„å…¬å‘Šï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå› æ­¤ç¡®å®šæä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22515](https://github.com/kh4sh3i/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #22

**æ¥æº**: [CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md](../2023/CVE-2023-22515-killvxk_CVE-2023-22515-joaoviictorti.md)

## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸¥é‡æ¼æ´ï¼Œå®ƒå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜å¸æˆ·å¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯æ”»å‡»è€…å¯ä»¥é‡æ–°å¯ç”¨åˆå§‹è®¾ç½®è¿‡ç¨‹ï¼Œä»è€Œè·å¾—åˆ›å»ºæ–°ç®¡ç†å‘˜å¸æˆ·çš„èƒ½åŠ›ã€‚

**æœ‰æ•ˆæ€§ï¼š** åŸºäºæ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªConfluenceç‰ˆæœ¬ï¼Œä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ï¼Œå·²ç»è¢«CISAåˆ—å…¥å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªRust Cargo.lockæ–‡ä»¶ï¼Œç”¨äºè®°å½•é¡¹ç›®ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚åˆ†æè¯¥æ–‡ä»¶æœ¬èº«æ— æ³•ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚Cargo.lockæ–‡ä»¶åªæ˜¯ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå®é™…çš„æŠ•æ¯’å¯èƒ½å­˜åœ¨äºé¡¹ç›®ä¾èµ–çš„æºä»£ç ä¸­ã€‚ ç”±äºæ–‡ä»¶è¾ƒé•¿ï¼Œäººå·¥å®¡è®¡æ‰€æœ‰ä¾èµ–é¡¹çš„å®‰å…¨æ€§æ˜¯ä¸ç°å®çš„ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ç»éªŒï¼Œè™½ç„¶ä¸èƒ½å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ç›´æ¥åœ¨Cargo.lockæ–‡ä»¶ä¸­è¿›è¡ŒæŠ•æ¯’çš„æ¦‚ç‡æä½ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œé‡æ–°è§¦å‘Confluenceçš„å®‰è£…å‘å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·è®¿é—®Confluenceå®ä¾‹å¹¶æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚è¯»å–æ•æ„Ÿæ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [killvxk/CVE-2023-22515-joaoviictorti](https://github.com/killvxk/CVE-2023-22515-joaoviictorti)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #23

**æ¥æº**: [CVE-2023-22515-rxerium_CVE-2023-22515.md](../2023/CVE-2023-22515-rxerium_CVE-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence æƒé™ç»•è¿‡/æœªæˆæƒç®¡ç†å‘˜åˆ›å»º

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** æƒé™ç»•è¿‡/æœªæˆæƒè®¿é—®

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å…¬å¼€å¯è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCåˆ©ç”¨ä»£ç ã€‚æä¾›çš„Nucleiæ¨¡æ¿ç”¨äºæ£€æµ‹æ˜“å—æ”»å‡»çš„Confluenceç‰ˆæœ¬ï¼Œå¯ä»¥è¾…åŠ©éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„Nucleiæ¨¡æ¿ä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œå…¶ç›®çš„æ˜¯ç¡®å®šConfluenceå®ä¾‹æ˜¯å¦è¿è¡Œç€æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ã€‚è¯¥æ¨¡æ¿é€šè¿‡å‘é€HTTP GETè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨çš„ä¸åŒç«¯ç‚¹ï¼ˆ/dologin.action, /, /pages, /confluence, /wikiï¼‰ï¼Œå¹¶ä»å“åº”ä½“ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šå°†æå–çš„ç‰ˆæœ¬ä¸å·²çŸ¥çš„æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬åˆ—è¡¨è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç‰ˆæœ¬åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹å­˜åœ¨æ¼æ´ã€‚

åˆ†æäº†è¯¥ä»£ç ï¼Œå‘ç°æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š
*   **Nuclei æ¨¡æ¿çš„æ€§è´¨ï¼š** Nuclei æ¨¡æ¿ä¸»è¦è®¾è®¡ç”¨äºæ£€æµ‹æ¼æ´ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å‘é€è¯·æ±‚å¹¶æ ¹æ®å“åº”è¿›è¡ŒåŒ¹é…ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **ä»£ç çš„å¯è§æ€§ï¼š** æ¨¡æ¿ä»£ç æ˜¯å…¬å¼€çš„ï¼Œæ˜“äºå®¡æŸ¥ã€‚ä»»ä½•æ½œåœ¨çš„æ¶æ„ä»£ç éƒ½ä¼šå¾ˆå®¹æ˜“è¢«å‘ç°ã€‚
*   **æ¨¡æ¿çš„ç®€å•æ€§ï¼š** è¯¥æ¨¡æ¿çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ¶‰åŠå‘é€ HTTP è¯·æ±‚å’Œè¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚è¿™é™ä½äº†éšè—æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

ç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å¾®å°çš„é£é™©ï¼š
*   **ä¾èµ–é£é™©ï¼š** Nuclei ä¾èµ–äºå¤–éƒ¨åº“å’Œç¯å¢ƒã€‚å¦‚æœ Nuclei æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å…¶ä¾èµ–é¡¹è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚
*   **é…ç½®é”™è¯¯é£é™©ï¼š** å¦‚æœç”¨æˆ·é…ç½® Nuclei ä¸å½“ï¼Œä¾‹å¦‚å…è®¸å…¶æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯èƒ½ä¼šå¢åŠ é£é™©ã€‚

æ€»çš„æ¥è¯´ï¼Œæä¾›çš„ Nuclei æ¨¡æ¿ç”¨äºæ£€æµ‹ CVE-2023-22515 æ¼æ´çš„é£é™©ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å‘ç°ï¼š** ä½¿ç”¨æä¾›çš„Nucleiæ¨¡æ¿æˆ–å…¶ä»–æ¼æ´æ‰«æå·¥å…·è¯†åˆ«å­˜åœ¨CVE-2023-22515æ¼æ´çš„Confluenceå®ä¾‹ã€‚
2.  **ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºï¼š** æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **æƒé™è·å–ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Confluenceï¼Œè·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚
4.  **æ¶æ„è¡Œä¸ºï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚ï¼š
    *   çªƒå–æ•æ„Ÿæ•°æ®
    *   ç¯¡æ”¹æ•°æ®
    *   å®‰è£…æ¶æ„è½¯ä»¶
    *   è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»

**é¡¹ç›®åœ°å€:** [rxerium/CVE-2023-22515](https://github.com/rxerium/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #24

**æ¥æº**: [CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md](../2023/CVE-2023-22515-s1d6point7bugcrowd_CVE-2023-22515-check.md)

## CVE-2023-22515 Atlassian Confluence ç ´æŸçš„è®¿é—®æ§åˆ¶

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** ç ´æŸçš„è®¿é—®æ§åˆ¶

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯¹å¤–å¼€æ”¾ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„ç ´æŸçš„è®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶è®¿é—®Confluenceå®ä¾‹ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“Confluence Data Centerå’ŒServer 8.0.0åˆ°8.5.1ä¹‹é—´çš„å¤šä¸ªç‰ˆæœ¬ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªæ£€æµ‹è„šæœ¬ï¼Œç”¨äºç¡®å®šConfluenceå®ä¾‹æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´ã€‚å®ƒé¦–å…ˆæ£€æŸ¥Confluenceç‰ˆæœ¬ï¼Œç„¶åå°è¯•é€šè¿‡POSTè¯·æ±‚å°†åº”ç”¨è®¾ç½®ä¸ºè®¾ç½®æ¨¡å¼(setup mode)ã€‚å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æˆåŠŸè®¾ç½®äº†è®¾ç½®æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹æ˜“å—æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
è¯¥POCçš„æœ‰æ•ˆæ€§å–å†³äºç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬å’Œæ˜¯å¦èƒ½æˆåŠŸè§¦å‘setup modeã€‚å¦‚æœç›®æ ‡ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥è®¾ç½®ä¸ºsetup modeï¼Œåˆ™è¯¥è„šæœ¬èƒ½æœ‰æ•ˆè¯†åˆ«æ¼æ´çš„å­˜åœ¨ï¼Œä½†å®ƒæœ¬èº«**ä¸èƒ½ç›´æ¥åˆ©ç”¨æ¼æ´**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¯¥è„šæœ¬åªèµ·åˆ°éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥å­˜å‚¨åº“å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚ åŸå› æ˜¯ï¼š
1. è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ£€æµ‹å’Œsetup modeè®¾ç½®ï¼Œæ²¡æœ‰æ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  è™½ç„¶`X-Custom-Header`å¯ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œç†è®ºä¸Šå­˜åœ¨è¿½è¸ªè¡Œä¸ºï¼Œä½†æ˜¯æ­¤è¡Œä¸ºä¸å±äºåé—¨æˆ–è€…æ¶æ„è¡Œä¸ºï¼Œæ‰€ä»¥æŠ•æ¯’é£é™©è¾ƒä½ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç‰ˆæœ¬æ£€æµ‹:**  åˆ©ç”¨è„šæœ¬æˆ–è€…æ‰‹åŠ¨è®¿é—®`login.action`é¡µé¢ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–Confluenceç‰ˆæœ¬å·ã€‚
2.  **Setup Modeæ£€æŸ¥:** å‘é€POSTè¯·æ±‚åˆ°`/server-info.action`ï¼Œè®¾ç½®`bootstrapStatusProvider.applicationConfig.setupComplete`ä¸º`false`å°è¯•è¿›å…¥Setup Modeã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦å·:** å¦‚æœæˆåŠŸè¿›å…¥Setup Modeï¼Œå³å¯åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œä»è€Œæ§åˆ¶Confluenceå®ä¾‹ã€‚éœ€è¦æ³¨æ„ï¼Œæä¾›çš„ä»£ç **ä¸åŒ…å«**åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·çš„æ­¥éª¤ï¼Œåªæ˜¯æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

**é¡¹ç›®åœ°å€:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #25

**æ¥æº**: [CVE-2023-22515-sincere9_CVE-2023-22515.md](../2023/CVE-2023-22515-sincere9_CVE-2023-22515.md)

## CVE-2023-22515-Confluence-Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.1 (å—å½±å“ç‰ˆæœ¬ä¸åŒ…æ‹¬ 8.3.3, 8.4.3, 8.5.2)

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„Broken Access Controlæ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åˆ›å»ºæœªæˆæƒçš„Confluenceç®¡ç†å‘˜è´¦æˆ·ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼š** é€šè¿‡è®¿é—®`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`é¡µé¢æ¥åˆ¤æ–­Confluenceæ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–è®¾ç½®ï¼Œå¦‚æœè¿”å›åŒ…å«"success"ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** å¦‚æœç³»ç»Ÿæœªå®Œæˆè®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€POSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
3.  **å®Œæˆè®¾ç½®ï¼š** åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œå‘é€POSTè¯·æ±‚åˆ°`/setup/finishsetup.action`æ¥å®Œæˆè®¾ç½®ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œæä¾›çš„POCä»£ç æœ‰æ•ˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»ºç®¡ç†å‘˜è´¦å·çš„è¿‡ç¨‹ï¼Œä»è€ŒéªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

è™½ç„¶POCä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä½†æˆ‘ä»¬éœ€è¦è¯„ä¼°æ˜¯å¦å­˜åœ¨ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚å®¡æŸ¥å‘ç°ï¼Œä»£ç ä¸»è¦åŠŸèƒ½ä¸ºå‘é€HTTPè¯·æ±‚ï¼Œç”Ÿæˆéšæœºç”¨æˆ·åå¯†ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼ŒæŠ•æ¯’é£é™©æä½,é£é™©è¯„ä¼°ä¸º1%ã€‚é£é™©ä¸»è¦æ¥æºäºå¯¹ç›®æ ‡URLçš„è¯¯ç”¨å’Œä¾èµ–åº“çš„å®‰å…¨ã€‚

**æœç´¢å¼•æ“ç»“æœï¼š**

æœç´¢ç»“æœè¡¨æ˜CVE-2023-22515æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œè¢«å¹¿æ³›åˆ©ç”¨ã€‚CISAä¹Ÿå‘å¸ƒäº†ç›¸å…³çš„å®‰å…¨å…¬å‘Šï¼Œæ•¦ä¿ƒç”¨æˆ·å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [sincere9/CVE-2023-22515](https://github.com/sincere9/CVE-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #26

**æ¥æº**: [CVE-2023-22515-spareack_CVE-2023-22515-NSE.md](../2023/CVE-2023-22515-spareack_CVE-2023-22515-NSE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¿…é¡»å…¬å¼€å¯è®¿é—®ä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºæœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶å—å½±å“çš„ Confluence å®ä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ Nmap NSE è„šæœ¬ POC ä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘é€è¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„ç«¯ç‚¹å¹¶åˆ†æå“åº”æ¥æ£€æŸ¥æ¼æ´çš„å­˜åœ¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦ç”¨äºæ£€æµ‹æ¼æ´ï¼Œä½†å­˜åœ¨ç»†å¾®çš„é£é™©ï¼Œæ¶æ„æ”»å‡»è€…å¯èƒ½ä¿®æ”¹è¯¥è„šæœ¬ä»¥åŒ…å«åœ¨æˆåŠŸåˆ©ç”¨åæ‰§è¡Œæ¶æ„æ“ä½œçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œè¯¥è„šæœ¬å¯èƒ½ä¼šè¢«ä¿®æ”¹ä¸ºé™é»˜åœ°å®‰è£…åé—¨æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¼æ´æ£€æµ‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç»•è¿‡èº«ä»½éªŒè¯ï¼š** æ”»å‡»è€…æ— éœ€ä»»ä½•å‡­æ®å³å¯ä¸ Confluence æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚
2.  **é‡ç½®å®‰è£…çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `bootstrapStatusProvider.applicationConfig.setupComplete=false`  ç«¯ç‚¹ï¼Œæœ‰æ•ˆåœ°å°† Confluence å®ä¾‹é‡ç½®åˆ°æœªå®‰è£…çŠ¶æ€ã€‚
3.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ª POST è¯·æ±‚åˆ° `/setup/setupadministrator.action` ç«¯ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚
4.  **å®Œå…¨æ§åˆ¶ï¼š** ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥ç™»å½•å¹¶å®Œå…¨æ§åˆ¶ Confluence æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹é…ç½®ä»¥åŠæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ€»ç»“ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ ä¸ª HTTP è¯·æ±‚å³å¯ã€‚POC ä»£ç çš„å­˜åœ¨ä½¿å¾—åˆ©ç”¨æ›´åŠ å®¹æ˜“ã€‚ ç”±äºè¯¥æ¼æ´å…è®¸å®Œå…¨æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„é£é™©ã€‚ å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å·²ä¿®å¤çš„ç‰ˆæœ¬ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

*   CISA å»ºè®®ï¼š[https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-289a)
*   Rapid7 åˆ†æï¼š[https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/](https://www.rapid7.com/blog/post/2023/10/04/etr-cve-2023-22515-zero-day-privilege-escalation-in-confluence-server-and-data-center/)
*   Qualys åˆ†æï¼š[https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515](https://blog.qualys.com/vulnerabilities-threat-research/2023/11/15/atlassian-confluence-broken-access-control-vulnerability-cve-2023-22515)


**é¡¹ç›®åœ°å€:** [spareack/CVE-2023-22515-NSE](https://github.com/spareack/CVE-2023-22515-NSE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #27

**æ¥æº**: [CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md](../2023/CVE-2023-22515-vivigotnotime_CVE-2023-22515-Exploit-Script.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶å—å½±å“çš„å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence Server æˆ– Data Center å®ä¾‹å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„ï¼Œä¸”ä½äºå—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªä¸¥é‡æ¼æ´ï¼Œå±äºæœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„ Confluence å®ä¾‹ä¸Šåˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œè·å¾—å¯¹ Confluence å®ä¾‹çš„å®Œå…¨æ§åˆ¶æƒã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘æ¼æ´:** é¦–å…ˆï¼Œæ”»å‡»è€…é€šè¿‡è®¿é—® `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` URL æ¥è§¦å‘æ¼æ´ï¼Œè¯¥æ“ä½œä¼šå°† Confluence å®ä¾‹ç½®äºæœªè®¾ç½®å®Œæˆçš„çŠ¶æ€ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜å¸æˆ·:** ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡å‘ `/setup/setupadministrator.action` å‘é€ POST è¯·æ±‚ï¼Œåˆ©ç”¨æœªæˆæƒè®¿é—®æ§åˆ¶æ¼æ´åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜å¸æˆ·ã€‚POST è¯·æ±‚åŒ…å«ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ç­‰ç®¡ç†å‘˜å¸æˆ·çš„ä¿¡æ¯ã€‚
3.  **èº«ä»½éªŒè¯:** æœ€åï¼Œæ”»å‡»è€…ä½¿ç”¨æ–°åˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½• Confluence å®ä¾‹ï¼Œå¹¶è·å¾—å®Œå…¨çš„ç®¡ç†æƒé™ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„PoCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¹¶æœªå‘ç°ç›´æ¥çš„æ¶æ„ä»£ç æˆ–åé—¨æ¤å…¥è¡Œä¸ºã€‚PoCä»£ç è™½ç„¶åœ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·åï¼Œä¼šå°†æœåŠ¡å™¨ã€ç”¨æˆ·åå’Œå¯†ç å†™å…¥æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæœ¬èº«ä¸å±äºæŠ•æ¯’ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šé€ æˆå®‰å…¨é£é™©ã€‚ æ­¤å¤–ï¼Œè¯¥PoCä½¿ç”¨äº†ä¸€äº›å¸¸ç”¨çš„åº“å¦‚`requests`, `rich`, `alive-progress`, `fire`ï¼Œè¿™äº›åº“æœ¬èº«è¢«æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†éœ€è¦ç¡®ä¿ä»å®˜æ–¹æºå®‰è£…ï¼Œé¿å…ä½¿ç”¨æ¥æºä¸æ˜çš„ç¬¬ä¸‰æ–¹åº“ã€‚

å› æ­¤ï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º5%ã€‚

**æ€»ç»“ï¼š**

æ­¤æ¼æ´åˆ©ç”¨ä»£ç é’ˆå¯¹ CVE-2023-22515 è¿›è¡Œäº†è‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·ã€‚åˆ©ç”¨è¿‡ç¨‹ç®€å•ï¼Œåªéœ€è¦ç›®æ ‡å®ä¾‹å­˜åœ¨æ¼æ´å³å¯ã€‚è¯¥æ¼æ´çš„é£é™©æé«˜ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [vivigotnotime/CVE-2023-22515-Exploit-Script](https://github.com/vivigotnotime/CVE-2023-22515-Exploit-Script)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #28

**æ¥æº**: [CVE-2023-22515-xorbbo_cve-2023-22515.md](../2023/CVE-2023-22515-xorbbo_cve-2023-22515.md)

## CVE-2023-22515 - Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨æ§åˆ¶ Confluence å®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦å…¬å¼€å¯è®¿é—®ï¼Œä¸”æœªå®Œæˆåˆå§‹åŒ–é…ç½®ï¼ˆsetupComplete = falseï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22515 æ¼æ´æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™ç»•è¿‡æ¼æ´ï¼Œå½±å“ Atlassian Confluence Data Center å’Œ Server å®ä¾‹ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´åˆ›å»ºæœªç»æˆæƒçš„ Confluence ç®¡ç†å‘˜å¸æˆ·ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ Confluence å®ä¾‹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **é‡ç½®è®¾ç½®çŠ¶æ€ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªGETè¯·æ±‚åˆ°`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`ã€‚ è¿™ä¸ªè¯·æ±‚ä¼šå°† Confluence å®ä¾‹é‡ç½®åˆ°è®¾ç½®æ¨¡å¼ï¼Œå³ä½¿å®ƒå·²ç»è¢«è®¾ç½®è¿‡ã€‚
2.  **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š** æ”»å‡»è€…ç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°`/setup/setupadministrator.action`ï¼Œå…¶ä¸­åŒ…å«æ–°ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ä¿¡æ¯ã€‚è¯¥è¯·æ±‚ä¸­çš„`X-Atlassian-Token: no-check` headerç”¨äºç»•è¿‡CSRFä¿æŠ¤ã€‚
3.  **å®Œæˆè®¾ç½®:** æ”»å‡»è€…å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ° `/setup/finishsetup.action`æ¥å…³é—­ Confluenceçš„é…ç½®å®Œæˆæç¤ºã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç ï¼ˆåŒ…æ‹¬ Burp Suite è¯·æ±‚ç¤ºä¾‹å’Œ Nmap NSE è„šæœ¬ï¼‰çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒåŒ…å«äº†åˆ©ç”¨è¯¥æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼šé¦–å…ˆé€šè¿‡ `/server-info.action` æ¥å£å°† Confluence ç½®äºæœªå®‰è£…çŠ¶æ€ï¼Œç„¶ååˆ©ç”¨ `/setup/setupadministrator.action` æ¥å£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œæœ€ååˆ©ç”¨`/setup/finishsetup.action`æ¥å£å…³é—­æç¤ºä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŠ•æ¯’é£é™©è¾ƒä½ (5%)ã€‚ è™½ç„¶ä»»ä½•ç¬¬ä¸‰æ–¹æä¾›çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£é™©ï¼Œä½†æ­¤å¤„çš„ä»£ç ç›¸å¯¹ç®€å•ä¸”ç›´æ¥åœ°å®ç°äº†æ¼æ´åˆ©ç”¨ã€‚ä¸»è¦é£é™©åœ¨äºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ Nmap è„šæœ¬æˆ– Burp Suite è¯·æ±‚ä»¥åŒ…å«å…¶ä»–æ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…åé—¨ã€ä¸Šä¼  webshell æˆ–æ”¶é›†æ•æ„Ÿä¿¡æ¯ã€‚ ä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚

**ç¼“è§£æªæ–½ï¼š**

*   å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ8.3.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.4.3 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œ8.5.2 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚
*   å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œè¯·å‚è€ƒ Atlassian å®˜æ–¹æŒ‡å—é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ã€‚
*   ç›‘æ§ Confluence å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·ã€‚
*   é™åˆ¶å¯¹ Confluence å®ä¾‹çš„ç½‘ç»œè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [xorbbo/cve-2023-22515](https://github.com/xorbbo/cve-2023-22515)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

## POC #29

**æ¥æº**: [CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md](../2023/CVE-2023-22515-youcannotseemeagain_CVE-2023-22515_RCE.md)

## CVE-2023-22515-Atlassian Confluence Broken Access Control

**æ¼æ´ç¼–å·:** CVE-2023-22515

**æ¼æ´ç±»å‹:** Broken Access Control

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºç®¡ç†å‘˜å¸æˆ·å¹¶å®Œå…¨æ§åˆ¶Confluenceå®ä¾‹

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹å¯ä»¥å…¬å¼€è®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22515æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerçš„ä¸¥é‡æ¼æ´ï¼Œå±äºæƒé™æ§åˆ¶ç¼ºé™·ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åˆ›å»ºConfluenceç®¡ç†å‘˜å¸æˆ·ã€‚æœç´¢ç»“æœ[6]æŒ‡å‘GitHubä¸Šå­˜åœ¨åˆ©ç”¨æ­¤æ¼æ´çš„å…¬å¼€PoCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ç§åœ¨è·å¾—åå°æƒé™åè¿›è¡ŒRCEçš„æ–¹å¼ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°ã€‚æ­¤ä»£ç æœ¬èº«æè¿°çš„æ˜¯åæ¸—é€é˜¶æ®µçš„åˆ©ç”¨æ–¹æ³•ï¼Œä¸æ˜¯æ¼æ´è§¦å‘ç‚¹ã€‚å…¶ä¸­å±•ç¤ºäº†ä¸Šä¼ æ’ä»¶çš„æˆªå›¾ï¼Œå¹¶è®¿é—®ç‰¹å®šçš„servletæ¥æ‰§è¡Œå‘½ä»¤ã€‚è¯¥åˆ©ç”¨æ–¹å¼ä¾èµ–äºå·²ç»è·å–çš„ç®¡ç†å‘˜æƒé™ï¼Œæ¼æ´åˆ©ç”¨ä»£ç ä»“åº“æœ¬èº«åªåŒ…å«å›¾ç‰‡å’Œè¯´æ˜æ–‡æ¡£ï¼Œé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶ä»è€Œè¾¾åˆ°äº†RCEç›®çš„ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ç”±äºåˆ©ç”¨æ–¹å¼è¾ƒä¸ºç›´æ¥ï¼Œå¯ä»¥åˆ¤æ–­æ²¡æœ‰æ˜¾è‘—çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ä¸æ’é™¤å›¾ç‰‡ä¸­å¼•ç”¨çš„æ’ä»¶ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šé£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æœªæˆæƒè®¿é—®æ¼æ´(CVE-2023-22515)åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚
2.  ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•Confluenceåå°ã€‚
3.  åœ¨Confluenceåå°ï¼Œæ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªæ¶æ„æ’ä»¶ã€‚
4.  é€šè¿‡è®¿é—®æ¶æ„æ’ä»¶æä¾›çš„Servletæ¥å£ï¼ˆä¾‹å¦‚ `plugins/servlet/com.jsos.shell/ShellServlet`ï¼‰ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

æ­¤æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºé¦–å…ˆè·å¾—ç®¡ç†å‘˜æƒé™ï¼Œç„¶åé€šè¿‡ä¸Šä¼ æ¶æ„æ’ä»¶å®ç°RCEã€‚æä¾›çš„ä»£ç åªæ˜¯RCEçš„æ­¥éª¤ï¼Œè€Œéè·å–ç®¡ç†å‘˜æƒé™çš„PoCã€‚

**é¡¹ç›®åœ°å€:** [youcannotseemeagain/CVE-2023-22515_RCE](https://github.com/youcannotseemeagain/CVE-2023-22515_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)

---

