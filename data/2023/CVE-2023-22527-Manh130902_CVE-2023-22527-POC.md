# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

# CVE-2023-22527

> ğŸ“¦ è¯¥CVEæœ‰ **24** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-Avento_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Confluence Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®ConfluenceæœåŠ¡å™¨çš„ç½‘ç»œã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Confluence Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº`/template/aui/text-inline.vm`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸ç”¨æˆ·æ§åˆ¶ `label` å‚æ•°ï¼Œä»è€Œå¯¼è‡´æ¨¡æ¿æ³¨å…¥ã€‚
2.  **OGNL æ³¨å…¥ï¼š** æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºConfluenceæ²¡æœ‰å……åˆ†è¿‡æ»¤OGNLè¡¨è¾¾å¼è€Œé€ æˆçš„ã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm`ã€‚`label`å‚æ•°çš„å€¼ç»è¿‡ç²¾å¿ƒæ„é€ ï¼ŒåŒ…å«äº† Velocity æ¨¡æ¿å¼•æ“çš„æŒ‡ä»¤ï¼Œç”¨äºæ‰§è¡Œ OGNL è¡¨è¾¾å¼ã€‚
    *   æ¶æ„ OGNL è¡¨è¾¾å¼ä¼šè°ƒç”¨ `freemarker.template.utility.Execute` ç±»çš„ `exec` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
    *   æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœæ”¾åœ¨å“åº”å¤´`X-Cmd-Response`ä¸­è¿”å›ç»™æ”»å‡»è€…ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒåˆ©ç”¨äº†ä¸Šè¿°æ¼æ´ã€‚è„šæœ¬æ¥å—ç›®æ ‡ Confluence URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œå¹¶å‘é€æ„é€ å¥½çš„ POST è¯·æ±‚ã€‚å¦‚æœæ¼æ´å­˜åœ¨ï¼Œè„šæœ¬ä¼šä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¹¶æ‰“å°å‡ºæ¥ï¼Œå¦åˆ™æç¤ºæ— å“åº”ã€‚è¿™ä¸ªPOCä»£ç æ˜¯å¯ä»¥æœ‰æ•ˆåˆ©ç”¨çš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ–‡ä»¶å’Œ `README.md` æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ¼æ´åˆ©ç”¨æ–¹å¼å’Œè¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è™½ç„¶POCä»£ç æœ¬èº«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå­˜åœ¨è¢«æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¿™ä¸å±äºæŠ•æ¯’ã€‚ ä»“åº“ä¸­ Dockerfile å’Œè°ƒè¯•ç«¯å£çš„å­˜åœ¨æ–¹ä¾¿äº†æ¼æ´å¤ç°ï¼Œä½†ä¹Ÿå¢åŠ äº†æ”»å‡»è€…åˆ©ç”¨çš„ä¾¿åˆ©æ€§ã€‚è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—ä¸€äº›ä¸æ˜“å¯Ÿè§‰çš„æ¶æ„ä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œé£é™©æ¯”ä¾‹ä¼°è®¡ä¸º10%ã€‚ä¸»è¦æ˜¯æŒ‡ä¸€äº›éšè”½çš„å‘½ä»¤æ¤å…¥ï¼Œä¾‹å¦‚æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰ã€‚

**é¡¹ç›®åœ°å€:** [Avento/CVE-2023-22527_Confluence_RCE](https://github.com/Avento/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #2

**æ¥æº**: [CVE-2023-22527-AxthonyV_CVE-2023-22527.md](../2023/CVE-2023-22527-AxthonyV_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜ï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶å¯èƒ½è¢«ç”¨äºcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚POCä»£ç æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒé€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€åŒ…å«OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚OGNLè¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„Javaä»£ç ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœã€‚

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºè®¸å¤šæ–‡ç« éƒ½è¡¨æ˜è¯¥æ¼æ´è¢«ç§¯æåˆ©ç”¨ï¼Œä¸”å…¬å¼€çš„POCå…è®¸è¿›è¡ŒRCEã€‚

**æŠ•æ¯’é£é™©ï¼š** æ£€æŸ¥æä¾›çš„POCä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚è¯¥è„šæœ¬ç›´æ¥åˆ©ç”¨OGNLæ³¨å…¥æ‰§è¡Œå‘½ä»¤ã€‚LICENSEæ–‡ä»¶å’ŒREADME.mdæ–‡ä»¶ä¹Ÿç¬¦åˆæ­£å¸¸çš„å¼€æºé¡¹ç›®ç»“æ„ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚
2.  æ”»å‡»è€…å°†åŒ…å«OGNLè¡¨è¾¾å¼çš„payloadé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  ConfluenceæœåŠ¡å™¨è§£æOGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„Javaä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„Javaä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [AxthonyV/CVE-2023-22527](https://github.com/AxthonyV/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #3

**æ¥æº**: [CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md](../2023/CVE-2023-22527-Boogipop_CVE-2023-22527-Godzilla-MEMSHELL.md)

## CVE-2023-22527-Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚
*   æ¼æ´åº“ä¿¡æ¯å°†æ­¤æ¼æ´æ ‡è®°ä¸ºä¸¥é‡ï¼ŒCVSSè¯„åˆ†ä¸º10ï¼Œå¹¶å·²è¢«æ·»åŠ åˆ°CISA KEVç›®å½•ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚
*   æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ï¼Œå‡ºç°äº†æ¶æ„è½¯ä»¶æŠ•æ”¾ã€cryptojackingç”šè‡³ransomwareæ”»å‡»çš„æ¡ˆä¾‹ã€‚
*   æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆCVE-2023-22527-Godzilla-MEMSHELLï¼‰æ—¨åœ¨é€šè¿‡æ³¨å…¥å†…å­˜Shellæ¥å®ç°æŒä¹…çš„è¿œç¨‹è®¿é—®ã€‚README.mdæ–‡ä»¶æä¾›äº†ä½¿ç”¨ç¤ºä¾‹ï¼Œè¡¨æ˜å…¶èƒ½å¤Ÿåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šéƒ¨ç½²Godzilla webshellã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç åï¼Œå­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸»è¦å…³æ³¨ç‚¹åœ¨äºConfluenceFilterMemshell.javaæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è´Ÿè´£å°†å†…å­˜Shellæ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨ä¸­ã€‚
*   `ConfluenceFilterMemshell.java` æ–‡ä»¶é€šè¿‡åå°„åŠ¨æ€åœ°å°†ä¸€ä¸ª ServletRequestListener æ·»åŠ åˆ° Confluence çš„ StandardContext ä¸­ã€‚ è¿™ä¸ª Listener å®é™…ä¸Šæ˜¯ä¸€ä¸ª Proxy å¯¹è±¡ï¼Œä»£ç†äº† ConfluenceFilterMemshell å®ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `backDoor` æ–¹æ³•ã€‚
*   `backDoor` æ–¹æ³•çš„åŠŸèƒ½æœªå®Œå…¨æä¾›ï¼Œå› ä¸ºæä¾›çš„ä»£ç è¢«æˆªæ–­ã€‚ å®Œæ•´çš„ `backDoor` æ–¹æ³•ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åé—¨ï¼Œæ•°æ®æ”¶é›†æˆ–æœªè®°å½•çš„åŠŸèƒ½ã€‚ ä½†ä»ä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªwebshellæ³¨å…¥å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æ¤å…¥webshellã€‚
*   æŠ•æ¯’çš„é£é™©ä¸»è¦å­˜åœ¨äºä½œè€…åœ¨æœªæä¾›çš„ä»£ç éƒ¨åˆ†ï¼ˆ`getMethodByClass`ã€`getFieldValue`ã€`invokeMethod`ï¼Œå®Œæ•´çš„`backDoor`æ–¹æ³•ç­‰ï¼‰ä¸­ï¼Œå¯èƒ½åµŒå…¥äº†é¢å¤–çš„æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚è¿æ¥ç‰¹å®šIPåœ°å€ï¼Œä¸Šä¼ é¢å¤–æ–‡ä»¶ç­‰ã€‚å¦‚æœæ²¡æœ‰å®Œæ•´ä»£ç ï¼Œéš¾ä»¥100%ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç ã€‚

ç»¼åˆè€ƒè™‘ï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è¯¥POCçš„ç›®çš„æ˜¯æ¤å…¥webshellï¼Œè€Œ webshell æœ¬èº«å·²ç»æä¾›äº†éå¸¸é«˜çš„æƒé™ï¼Œé¢å¤–çš„æ¶æ„ä»£ç æ”¶ç›Šä¸é«˜ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…å‡ºäºå…¶ä»–ç›®çš„åµŒå…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç›®æ ‡ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  æä¾›çš„POCä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæ¶æ„çš„ServletRequestListeneræ¥å®ç°å†…å­˜webshellçš„æ¤å…¥ã€‚
3.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚`/template/aui/text-inline.vm`ï¼‰è§¦å‘æ¼æ´ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°ConfluenceæœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚
4.  æˆåŠŸæ³¨å…¥å†…å­˜webshellåï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Godzillaç­‰webshellç®¡ç†å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šçš„å¯†ç å’Œå¯†é’¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #4

**æ¥æº**: [CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md](../2023/CVE-2023-22527-C1ph3rX13_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ª Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¹¶ç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢ç»“æœä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªé¡µé¢è¡¨æ˜è¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ã€‚
æä¾›çš„ Go è¯­è¨€ PoC ä»£ç é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç åº“åŒ…å«ä¸€ä¸ª Go è¯­è¨€çš„ PoCã€ä¸€ä¸ª MIT è®¸å¯è¯å’Œä¸€ä¸ª README æ–‡ä»¶ã€‚PoC ä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸º:

1.  **ä¾èµ–é£é™©:** è¯¥PoCä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“`github.com/go-resty/resty/v2`ï¼Œå¦‚æœè¯¥ä¾èµ–åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½å¼•å…¥æ¶æ„ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶éä½œè€…ç›´æ¥æŠ•æ¯’ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:**  PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨è¯¥ PoC æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæŸå®³ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ¼æ´æœ¬èº«çš„é£é™©ï¼Œè€Œé PoC ä½œè€…æŠ•æ¯’ã€‚
3.  **ç½‘ç»œå®‰å…¨é£é™©:** PoC ä»£ç ä¸­é»˜è®¤ç¦ç”¨äº† TLS éªŒè¯ (`InsecureSkipVerify: true`)ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´äººæ”»å‡»ã€‚è™½ç„¶è¿™ç®€åŒ–äº†æµ‹è¯•ï¼Œä½†ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
4.  **ä¸å®Œå–„çš„é”™è¯¯å¤„ç†:** PoC ä»£ç ä¸­è™½ç„¶æœ‰é”™è¯¯å¤„ç†ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨æ½œåœ¨çš„å´©æºƒæˆ–æœªæ•è·å¼‚å¸¸çš„é£é™©ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»£ç åº“ä¸­å­˜åœ¨ä½œè€…ç›´æ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¸»è¦æ˜¯å› ä¸ºä»£ç åŠŸèƒ½ç®€å•ï¼Œä¸”ä½œè€…æ˜ç¡®å£°æ˜ä»£ç ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚PoC çš„ä¸»è¦é£é™©åœ¨äºå…¶å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»¥åŠæ½œåœ¨çš„ä¾èµ–åº“é£é™©ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç¡®å®šç›®æ ‡ Confluence Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†… (8.0.0 <= version < 8.5.4)ã€‚
2.  ä½¿ç”¨æä¾›çš„ Go è¯­è¨€ PoC ä»£ç ï¼ŒæŒ‡å®šç›®æ ‡ URL å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  PoC ä»£ç å°†æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm` è·¯å¾„ã€‚
4.  å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼ŒConfluence å°†æ‰§è¡Œ OGNL è¡¨è¾¾å¼ä¸­çš„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°å“åº”å¤´ `X-Cmd-Response` ä¸­ã€‚
5.  PoC ä»£ç å°†ä»å“åº”å¤´ä¸­æå–å‘½ä»¤æ‰§è¡Œç»“æœå¹¶æ˜¾ç¤ºã€‚
6. æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ README æ–‡ä»¶ä¸­æä¾›çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ä¿®æ”¹ HTTP è¯·æ±‚ä¸­çš„å‘½ä»¤ï¼Œå‘é€åˆ°ç›®æ ‡åœ°å€ã€‚

**é¡¹ç›®åœ°å€:** [C1ph3rX13/CVE-2023-22527](https://github.com/C1ph3rX13/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #5

**æ¥æº**: [CVE-2023-22527-Chocapikk_CVE-2023-22527.md](../2023/CVE-2023-22527-Chocapikk_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®åˆ°è¯¥å®ä¾‹ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåŒ…å«ä¸€ä¸ª Python è„šæœ¬ (exploit.py)ï¼Œè¯¥è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„ HTTP POST è¯·æ±‚åˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è„šæœ¬ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ HTTP å“åº”å¤´ `X-Cmd-Response` æ¥è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 10%ã€‚`exploit.py` æ–‡ä»¶æœ¬èº«å®ç°äº†æ¼æ´åˆ©ç”¨ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åé—¨æˆ–è€…æ¶æ„ä»£ç ã€‚`docker-compose.yml` æ–‡ä»¶ç”¨äºå¿«é€Ÿæ­å»ºå­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ã€‚`README.md` æ–‡ä»¶æä¾›ä½¿ç”¨è¯´æ˜å’Œå…è´£å£°æ˜ã€‚ä½†æ˜¯ä¸æ’é™¤ä½œè€…åœ¨æœªæ¥æ›´æ–°ç‰ˆæœ¬ä¸­åŠ å…¥æŠ•æ¯’ä»£ç ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚
2.  åœ¨ POST è¯·æ±‚çš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚OGNL è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† `freemarker.template.utility.Execute` ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
3.  æœåŠ¡å™¨æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè®¾ç½®åœ¨ HTTP å“åº”å¤´ `X-Cmd-Response` ä¸­è¿”å›ã€‚
4.  æ”»å‡»è€…ä» HTTP å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #6

**æ¥æº**: [CVE-2023-22527-Drun1baby_CVE-2023-22527.md](../2023/CVE-2023-22527-Drun1baby_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-æ¨¡æ¿æ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬å—å½±å“ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†ï¼š** æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯Confluenceåœ¨å¤„ç†æŸäº›æ¨¡æ¿æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚

2.  **PoCåˆ†æï¼š** æä¾›çš„PoCä»£ç åˆ©ç”¨`text-inline.vm`æ¨¡æ¿ï¼Œé€šè¿‡`label`å‚æ•°æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚`poc`å‚æ•°åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

    *   `POST http://192.168.80.139:8090/template/aui/text-inline.vm HTTP/1.1`ï¼šæŒ‡å®šäº†ç›®æ ‡URLå’ŒHTTPæ–¹æ³•ã€‚
    *   `label=aaa%5Cu0027%2B%23request.get%28%5Cu0027.KEY_velocity.struts2.context%5Cu0027%29.internalGet%28%5Cu0027ognl%5Cu0027%29.findValue%28%23parameters.poc%5B0%5D%2C%7B%7D%29%2B%5Cu0027`ï¼šæ„é€ äº†æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨`#request`å¯¹è±¡è·å–`ognl`ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨`findValue`æ–¹æ³•æ‰§è¡Œ`poc`å‚æ•°ä¸­çš„OGNLè¡¨è¾¾å¼ã€‚
    *   `poc=%40org.apache.struts2.ServletActionContext%40getResponse%28%29.setHeader%28%5Cu0027Cmd-Ret%5Cu0027%2C%28new+freemarker.template.utility.Execute%28%29%29.exec%28%7B%22whoami%22%7D%29%29`ï¼šå®šä¹‰äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ`whoami`ï¼‰ã€‚è¿™ä¸ªOGNLè¡¨è¾¾å¼ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè®¾ç½®åˆ°HTTPå“åº”å¤´`Cmd-Ret`ä¸­ã€‚

3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    a.  æ”»å‡»è€…å‘ç›®æ ‡Confluenceå®ä¾‹çš„`text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼ŒåŒ…å«æ„é€ å¥½çš„payloadã€‚
    b.  ConfluenceæœåŠ¡å™¨è§£æpayloadä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    c.  æœåŠ¡å™¨å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ·»åŠ åˆ°HTTPå“åº”å¤´ä¸­ã€‚
    d.  æ”»å‡»è€…ä»å“åº”å¤´ä¸­è·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚

4.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„PoCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¼æ´çš„å­˜åœ¨ã€‚

5. **æŠ•æ¯’é£é™©:** ç»è¿‡åˆ†æï¼Œæä¾›çš„PoCä»£ç åªæ˜¯æ¼æ´åˆ©ç”¨çš„Payloadï¼Œç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•é¢å¤–çš„æ¶æ„ä»£ç æˆ–åé—¨ï¼Œå› æ­¤ä¸å­˜åœ¨æŠ•æ¯’é£é™©ã€‚

6.  **ç¼“è§£æªæ–½ï¼š** å‡çº§Confluenceåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚

**é¡¹ç›®åœ°å€:** [Drun1baby/CVE-2023-22527](https://github.com/Drun1baby/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #7

**æ¥æº**: [CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md](../2023/CVE-2023-22527-M0untainShley_CVE-2023-22527-MEMSHELL.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨Velocityæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°ConfluenceæœåŠ¡å™¨çš„`/template/aui/text-inline.vm`ç«¯ç‚¹æˆ–å…¶ä»–Velocityæ¨¡æ¿æ¸²æŸ“çš„ç«¯ç‚¹ã€‚
2.  ConfluenceæœåŠ¡å™¨åœ¨æ¸²æŸ“Velocityæ¨¡æ¿æ—¶ï¼Œä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒPOCåˆ©ç”¨äº†javassiståŠ¨æ€ç”Ÿæˆå†…å­˜é©¬ï¼Œæ”¯æŒæ³¨å…¥å†°èå’Œå“¥æ–¯æ‹‰ä¸¤ç§ç±»å‹çš„webshellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€çš„POCã€‚æä¾›çš„POCä»£ç åŠŸèƒ½è¾ƒä¸ºå®Œæ•´ï¼Œæ”¯æŒå¤šç§webshellæ³¨å…¥ï¼Œå¹¶æä¾›HTTPä»£ç†åŠŸèƒ½ï¼Œå› æ­¤åˆ¤æ–­è¯¥POCæœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç æ€»ä½“ç»“æ„æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½é›†ä¸­åœ¨å†…å­˜é©¬æ³¨å…¥ã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼š

1.  **æ¶æ„ä¾èµ–ï¼š** è™½ç„¶ä»£ç ä¸­ä½¿ç”¨äº†javassistå’Œcommons-cliï¼Œä½†æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹pom.xmlæˆ–æ‰‹åŠ¨æ·»åŠ æ¶æ„ä¾èµ–ï¼Œå¼•å…¥åŒ…å«åé—¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚
2.  **åé—¨ä»£ç ï¼š** æ”»å‡»è€…å¯èƒ½åœ¨ç”Ÿæˆpayloadçš„è¿‡ç¨‹ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åœ¨`ctClass.makeClassInitializer().insertBefore`æ’å…¥é¢å¤–çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
3.  **ä»£ç†åŠ«æŒï¼š**  è™½ç„¶POCæ”¯æŒä»£ç†ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ§åˆ¶ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨æµé‡ä¸­æ³¨å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ°ä»£ç çš„å¤æ‚æ€§ï¼Œä¸”å­˜åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„è¡Œä¸ºï¼Œéšè—æ¶æ„ä»£ç çš„æ¦‚ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**æ€»ç»“ï¼š**

CVE-2023-22527æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œåˆ©ç”¨éš¾åº¦ä½ï¼Œå±å®³æ€§é«˜ã€‚å»ºè®®Confluenceç”¨æˆ·å°½å¿«å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œå¹¶å¯¹POCä»£ç è¿›è¡Œä»”ç»†å®¡æŸ¥ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ã€‚

**é¡¹ç›®åœ°å€:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #8

**æ¥æº**: [CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-MaanVader_CVE-2023-22527-POC.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.x, 8.1.x, 8.2.x, 8.3.x, 8.4.x, 8.5.0-8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluenceå®ä¾‹éœ€è¦è¿è¡Œåœ¨å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œä¸”å…è®¸é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluenceä¸­çš„ä¸€ä¸ªOGNLæ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œåˆ©ç”¨æ¨¡æ¿æ³¨å…¥æ¼æ´åœ¨å—å½±å“çš„ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚POCä»£ç ä¸­,è™½ç„¶åŒ…å«äº†`UwU`ç­‰ä¸å¸¸è§çš„å­—ç¬¦ä¸²,ä½†æ˜¯æ•´ä½“é€»è¾‘ç¬¦åˆæ¼æ´åˆ©ç”¨çš„åŸç†,åˆæ­¥åˆ¤æ–­ä¸ºæ­£å¸¸çš„æ¼æ´éªŒè¯ä»£ç ã€‚å­˜åœ¨æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§è¾ƒä½ï¼Œè¯„ä¼°ä¸º5%ï¼Œä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…åœ¨æœªæˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæˆ–å°†æ¶æ„å‘½ä»¤åµŒå…¥åˆ°`command`å‚æ•°ä¸­ã€‚

**é¡¹ç›®åœ°å€:** [MaanVader/CVE-2023-22527-POC](https://github.com/MaanVader/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #9

**æ¥æº**: [CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md](../2023/CVE-2023-22527-Manh130902_CVE-2023-22527-POC.md)

## CVE-2023-22527 - Atlassian Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„POCä»£ç æœ‰æ•ˆã€‚CISAå·²å°†æ­¤æ¼æ´æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨æ¼æ´ç›®å½•(KEV)ï¼Œè¡¨æ˜è¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„Python POCä»£ç å’Œç›¸å…³æ–‡ä»¶è¿›è¡Œåˆ†æåï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚
*   `CVE-2023-22527.py`: æ­¤è„šæœ¬ç”¨äºæ£€æµ‹ Confluence ç‰ˆæœ¬å¹¶å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥è„šæœ¬æœ¬èº«ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œä½†å¦‚æœè¢«åˆ©ç”¨ï¼Œå¯èƒ½å¯¼è‡´ç›®æ ‡ç³»ç»Ÿå—æŸã€‚
*   `CVE-2023-22527.yaml`: è¿™æ˜¯ä¸€ä¸ª Nuclei æ¨¡æ¿ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ­¤æ¼æ´ã€‚å®ƒä¹Ÿä¸åŒ…å«æ¶æ„ä»£ç ã€‚
*   `README.md`: è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è¯´æ˜æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ã€‚
è™½ç„¶è¯¥æ¼æ´æœ¬èº«å…·æœ‰é«˜å±æ€§ï¼Œä½†æä¾›çš„ä»£ç æœªå‘ç°ä½œè€…éšè—çš„æ¶æ„é€»è¾‘ï¼Œå› æ­¤æŠ•æ¯’é£é™©ä¸º 0%ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨è¯¥POCè¿›è¡Œæµ‹è¯•æˆ–æ”»å‡»å…·æœ‰æ½œåœ¨é£é™©ï¼Œåº”åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¡®å®šç›®æ ‡ Confluence ç‰ˆæœ¬ï¼š** POCä»£ç é¦–å…ˆå°è¯•è·å–ç›®æ ‡ Confluence å®ä¾‹çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥ç¡®è®¤å…¶æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼ŒPOC å°†æ„é€ ä¸€ä¸ªåŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œå‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ Java ä»£ç ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  POCä»£ç ä½¿ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡Œcmdå‚æ•°æŒ‡å®šçš„å‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡HTTP Header `X-Cmd-Response`è¿”å›ã€‚
4.  **åˆ©ç”¨å‰æ** æ”»å‡»è€…ä¸éœ€è¦ä»»ä½•èº«ä»½éªŒè¯å³å¯å‘é€è¯·æ±‚ã€‚

**é¡¹ç›®åœ°å€:** [Manh130902/CVE-2023-22527-POC](https://github.com/Manh130902/CVE-2023-22527-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---



---

## POC #10

**æ¥æº**: [CVE-2023-22527-Niuwoo_CVE-2023-22527.md](../2023/CVE-2023-22527-Niuwoo_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚æ¼æ´ä½äº `/template/aui/text-inline.vm` è·¯å¾„ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ Velocity æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„PoCä»£ç æœ‰æ•ˆã€‚å®ƒé€šè¿‡å‘ `/template/aui/text-inline.vm` å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚PoC åŒ…å«æ£€æµ‹å’Œåˆ©ç”¨ä¸¤ä¸ªåŠŸèƒ½ã€‚æ£€æµ‹åŠŸèƒ½æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨å“åº”å¤´ä¸­è¿”å› `X-Cmd-Response` å­—æ®µï¼Œä»¥ç¡®è®¤æ¼æ´å­˜åœ¨ã€‚åˆ©ç”¨åŠŸèƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ `X-Cmd-Response` æ ‡å¤´ä¸­è¿”å›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“ä¸­æœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ï¼Œå¹¶è§£æå“åº”å¤´ã€‚è¯¥PoCåªæ˜¯éªŒè¯æ¼æ´ï¼Œæ²¡æœ‰å‘ç°åé—¨ç­‰æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´å®šä½ï¼š** è¯¥æ¼æ´å­˜åœ¨äºå—å½±å“ Confluence å®ä¾‹çš„ `/template/aui/text-inline.vm` è·¯å¾„ã€‚
2.  **è¯·æ±‚æ„é€ ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œè¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒVelocity æ¨¡æ¿å¼•æ“ä¼šè§£æå¹¶æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  **ç»“æœè·å–ï¼š** å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ `X-Cmd-Response` HTTP å“åº”å¤´è¿”å›ç»™æ”»å‡»è€…ã€‚ 

**æ³¨æ„ï¼š** æ ¹æ®æœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨äºæ”»å‡»ï¼ŒåŒ…æ‹¬åŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶éƒ¨ç½²ã€‚

**é¡¹ç›®åœ°å€:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #11

**æ¥æº**: [CVE-2023-22527-Privia-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-Privia-Security_CVE-2023-22527.md)

## CVE-2023-22527 Atlassian Confluence OGNLæ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center/Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒç”¨æˆ·æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“çš„å®ä¾‹ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨æ­¤æ¼æ´éƒ¨ç½²æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚Elpaco Ransomwareå’ŒCryptojackingç¨‹åºã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„PoCä»£ç é€šè¿‡æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ï¼Œåˆ©ç”¨`text-inline.vm`æ¨¡æ¿æ–‡ä»¶ä¸­çš„æ¼æ´ï¼Œå®ç°åœ¨ConfluenceæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚PoCä¸­é€šè¿‡è®¾ç½®HTTPå“åº”å¤´'Cmd'æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼ˆ`whoami`ï¼‰ã€‚ç”±äºæ¼æ´åˆ©ç”¨æ–¹å¼ç®€å•ä¸”å±å®³å·¨å¤§ï¼Œè¯¥PoCçš„æœ‰æ•ˆæ€§éå¸¸é«˜ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

åˆ†ææä¾›çš„PoCä»£ç ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **ä¾›åº”é“¾é£é™©ï¼š** PoCä¾èµ–äºç¬¬ä¸‰æ–¹åº“`github.com/fatih/color`ï¼Œè™½ç„¶è¯¥åº“æœ¬èº«çœ‹èµ·æ¥æ— å®³ï¼Œä½†å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’çš„æ½œåœ¨é£é™©ã€‚
*   **å‘½ä»¤æ‰§è¡Œé£é™©ï¼š** PoCå…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¿™æ„å‘³ç€å¦‚æœæ”»å‡»è€…ä¿®æ”¹PoCä¸­çš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½¯ä»¶ã€‚
*   **ä¾èµ–æ–‡ä»¶é£é™©:** `cve-2023-22527.exe`ä¸ºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¢åŠ äº†æŠ•æ¯’çš„é£é™©ã€‚

åŸºäºä»¥ä¸Šåˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º20%ã€‚ä¸»è¦é£é™©åœ¨äºä½¿ç”¨è€…ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹PoCæ‰§è¡Œæ¶æ„å‘½ä»¤çš„å¯èƒ½æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ç›®æ ‡URLæ˜¯å—å½±å“Confluenceå®ä¾‹çš„`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼è¢«æ³¨å…¥åˆ°`label`å‚æ•°ä¸­ã€‚
4.  ConfluenceæœåŠ¡å™¨è§£æè¯¥OGNLè¡¨è¾¾å¼ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
5.  æ‰§è¡Œç»“æœé€šè¿‡HTTPå“åº”å¤´è¿”å›ã€‚

**é¡¹ç›®åœ°å€:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #12

**æ¥æº**: [CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md](../2023/CVE-2023-22527-RevoltSecurities_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 20%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ OGNL è¡¨è¾¾å¼æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ— éœ€èº«ä»½éªŒè¯ï¼Œå› æ­¤é£é™©æé«˜ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå£°ç§°å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œå®ƒå…·å¤‡å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ Confluence æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©çš„å¯èƒ½æ€§ã€‚è™½ç„¶ä½œè€…æä¾›äº†licenseï¼Œå¹¶ä¸”æœ‰è”ç³»æ–¹å¼ï¼Œä½†æ˜¯ä»æœ‰å¿…è¦è°¨æ…ã€‚ 

*   **æ½œåœ¨é£é™©ç‚¹ï¼š**
	*   `exploit.py`è„šæœ¬ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå­˜åœ¨å‘æ¶æ„æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„å¯èƒ½æ€§ã€‚
	*   è„šæœ¬å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å‘½ä»¤æ‰§è¡Œä¸‹è½½æ¶æ„payloadå¹¶æ‰§è¡Œã€‚

ç»¼ä¸Šï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 20%ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰è¿›è¡Œä»£ç å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  Confluence æœåŠ¡å™¨è§£æè¯¥è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼è¢«æ‰§è¡Œã€‚
3.  æ”»å‡»è€…åˆ©ç”¨ OGNL è¡¨è¾¾å¼æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚

**é˜²èŒƒæªæ–½ï¼š**
1.  å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ (>= 8.5.4, >= 8.6.0, >= 8.7.1)ã€‚
2.  åº”ç”¨ Atlassian å®˜æ–¹æä¾›çš„å®‰å…¨è¡¥ä¸ã€‚
3.  å®æ–½ç½‘ç»œåˆ†æ®µå’Œè®¿é—®æ§åˆ¶ï¼Œé™åˆ¶å¯¹ Confluence æœåŠ¡å™¨çš„è®¿é—®ã€‚
4.  éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ï¼Œç›‘æ§å’Œé˜»æ­¢æ¶æ„æµé‡ã€‚

**é¡¹ç›®åœ°å€:** [RevoltSecurities/CVE-2023-22527](https://github.com/RevoltSecurities/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #13

**æ¥æº**: [CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md](../2023/CVE-2023-22527-Sudistark_patch-diff-CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/RCE

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­å­˜åœ¨çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ã€‚å¤šä¸ªæœç´¢ç»“æœ(webpage 1, 3, 5, 6, 7, 9)è¡¨æ˜è¯¥æ¼æ´å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œä¸”æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ–¹æ³•å·²ç»è¢«å…¬å¼€ã€‚
æä¾›çš„ä»£ç ç‰‡æ®µä¼¼ä¹æ˜¯Confluenceçš„ Velocity æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶éç›´æ¥çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„åˆ©ç”¨é€šå¸¸æ¶‰åŠåˆ°ä¿®æ”¹æˆ–ä¸Šä¼ æ¶æ„æ¨¡æ¿ï¼Œä»è€Œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™äº›æ¨¡æ¿æœ¬èº«å¹¶æ— æ¶æ„ï¼Œæ˜¯Confluenceæ­£å¸¸ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ”»å‡»è€…ä¼šæ„é€ ç‰¹å®šçš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œè§¦å‘æ¨¡æ¿å¼•æ“æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ä»£ç æ˜¯Confluenceçš„Velocityæ¨¡æ¿æ–‡ä»¶ï¼Œä¾‹å¦‚404.vmã€405.vmç­‰ï¼Œå®ƒä»¬æœ¬èº«ä¸åŒ…å«æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚åˆ¤æ–­æŠ•æ¯’é£é™©éœ€è¦è€ƒè™‘ä½œè€…æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹éšè—äº†æ¶æ„Payloadï¼Œä¾‹å¦‚é€šè¿‡ç¼–ç ã€æ··æ·†ç­‰æ–¹å¼åµŒå…¥åˆ°è¿™äº›æ–‡ä»¶ä¸­ã€‚ç”±äºä»…ä»…æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œ å› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›æ­£å¸¸çš„æ¨¡æ¿æ–‡ä»¶ä½œä¸ºè·³æ¿ï¼Œæ„å»ºæ¶æ„è¯·æ±‚ï¼Œæœ€ç»ˆè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨Confluenceçš„æ¨¡æ¿å¼•æ“æ‰§è¡Œä»»æ„Javaä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ç”±äºè¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘é€æ¶æ„è¯·æ±‚åˆ°ç›®æ ‡ConfluenceæœåŠ¡å™¨ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹æ­¥éª¤ï¼š
1.  ç¡®å®šç›®æ ‡ConfluenceæœåŠ¡å™¨çš„URLã€‚
2.  æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTPè¯·æ±‚ã€‚
3.  å‘é€è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ä¸­çš„OGNLè¡¨è¾¾å¼ï¼Œæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #14

**æ¥æº**: [CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md](../2023/CVE-2023-22527-VNCERT-CC_CVE-2023-22527-confluence.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Atlassian Confluence Server å’Œ Data Center ä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…åœ¨å—å½±å“çš„å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æ˜¯ç”±äºConfluenceä¸­ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆå¯èƒ½æ˜¯ Velocity æˆ– FreeMarkerï¼‰å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„è¡¨è¾¾å¼ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„æ¶æ„è¯·æ±‚ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«ConfluenceæœåŠ¡å™¨è§£æå’Œæ‰§è¡Œã€‚
    *   POCä»£ç é€šè¿‡å°†å‘½ä»¤åˆ†å—å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨freemarkerçš„Executeç±»æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚åˆ©ç”¨çš„å…³é”®ç‚¹åœ¨äºåˆ©ç”¨äº† `/template/aui/text-inline.vm` æ¨¡æ¿æ–‡ä»¶è¿›è¡ŒOGNLæ³¨å…¥ã€‚
    *   æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shell æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ è¯¥POCåˆ©ç”¨äº†OGNLæ³¨å…¥æ¼æ´ï¼Œèƒ½å¤Ÿå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä»£ç ä¸­è™½ç„¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ–‡ä»¶å†™å…¥ï¼š** POCå°†å‘½ä»¤å†™å…¥`/tmp/a`ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå†™å…¥æ¶æ„è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œå±å®³è¾ƒå°ã€‚
*   **ä¾èµ–ç¯å¢ƒï¼š** è¯¥POCä¾èµ–`bun`ç¯å¢ƒï¼Œå¦‚æœ`bun`ç¯å¢ƒå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
*   **ç½‘ç»œè¯·æ±‚ï¼š** POCä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹POCï¼Œå°†å—å®³è€…çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

ç»¼åˆè€ƒè™‘ï¼Œè¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ã€‚ å»ºè®®åœ¨ä½¿ç”¨è¯¥POCæ—¶ï¼Œä»”ç»†æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ¶æ„ä»£ç ã€‚

**å…¶ä»–é£é™©ç‚¹:** æœç´¢å¼•æ“ç»“æœä¸­æåˆ°è¯¥æ¼æ´å·²ç»è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨äºåŠ å¯†è´§å¸æŒ–çŸ¿å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ï¼Œè¡¨æ˜æ­¤æ¼æ´çš„çœŸå®å±å®³æ€§è¾ƒé«˜ã€‚

**é¡¹ç›®åœ°å€:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #15

**æ¥æº**: [CVE-2023-22527-Vozec_CVE-2023-22527.md](../2023/CVE-2023-22527-Vozec_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ä¸­ã€‚æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ï¼Œåœ¨ `label` å‚æ•°ä¸­åŒ…å«æ¶æ„çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç åˆ©ç”¨äº†è¯¥æ¼æ´ï¼Œé€šè¿‡æ„é€ åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚POC ä»£ç å·²ç»åŒ…å«äº†åˆ©ç”¨çš„URLè·¯å¾„ï¼Œä»¥åŠæ‰€éœ€çš„è¯·æ±‚å¤´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»“åº“ä¸­çš„ä¸»è¦ä»£ç æ–‡ä»¶ `CVE-2023-22527.py` çœ‹èµ·æ¥æ˜¯ç›´æ¥åˆ©ç”¨æ¼æ´çš„ POCï¼Œå¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„æˆ–æŠ•æ¯’ä»£ç ã€‚`README.md` æ–‡ä»¶ä¹Ÿåªæ˜¯æä¾›äº†æ¼æ´æè¿°ã€ä½¿ç”¨æ–¹æ³•å’Œå…è´£å£°æ˜ã€‚ä»”ç»†æ£€æŸ¥äº†POCä»£ç çš„æ¯ä¸ªå‡½æ•°ï¼Œæœªå‘ç°æœ‰ä»»ä½•åé—¨è¡Œä¸ºæˆ–æ¶æ„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»ç„¶å­˜åœ¨æä½çš„é£é™©ï¼Œè¿™é‡Œåˆ¤æ–­æŠ•æ¯’é£é™©ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚çš„ `label` å‚æ•°åŒ…å«ä¸€ä¸ª OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  æœåŠ¡å™¨è§£æè¯¥ OGNL è¡¨è¾¾å¼ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¢«å†™å…¥ HTTP å“åº”ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä»å“åº”ä¸­è·å–æ‰§è¡Œç»“æœã€‚

**æ€»ç»“:**
æ­¤æ¼æ´æ˜¯ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œç”±äºå­˜åœ¨å…¬å¼€çš„ POC ä»£ç ï¼Œè¢«åˆ©ç”¨çš„é£é™©éå¸¸é«˜ã€‚å¼ºçƒˆå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Vozec/CVE-2023-22527](https://github.com/Vozec/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #16

**æ¥æº**: [CVE-2023-22527-YongYe-Security_CVE-2023-22527.md](../2023/CVE-2023-22527-YongYe-Security_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** æ¨¡æ¿æ³¨å…¥/OGNLæ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Confluence Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Serverå’ŒData Centerçš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´ä½äº`text-inline.vm`æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚ï¼Œåˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ¥æ‰§è¡Œå‘½ä»¤ã€‚  

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆä¾‹å¦‚NVDã€Rapid7ã€ProjectDiscoveryã€TrendMicroç­‰ï¼‰å’Œæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”PoCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚PoCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç æœ¬èº«å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è™½ç„¶è¯¥PoCç›´æ¥åˆ©ç”¨äº†æ¼æ´å®ç°RCEï¼Œä½†æ˜¯æ‰¹é‡æ‰«æè„šæœ¬ä¼šå‘ç›®æ ‡ç³»ç»Ÿå‘é€æ¶æ„è¯·æ±‚,é€ æˆä¸å¿…è¦çš„æ‰«ææ—¥å¿—ã€‚`README.md`å£°æ˜"I am not responsible for any illegal attacks"ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ä½œè€…æ•…æ„ç•™ä¸‹åé—¨çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»£ç çš„åŠŸèƒ½é›†ä¸­äºæ¼æ´åˆ©ç”¨ï¼Œå¹¶ä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºå®¡æŸ¥ï¼Œæ•…æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  ç›®æ ‡ç³»ç»Ÿå¿…é¡»è¿è¡Œå—å½±å“çš„Confluenceç‰ˆæœ¬ï¼ˆ8.0.0 <= version < 8.5.4ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œå‘é€åˆ°`/template/aui/text-inline.vm`ç«¯ç‚¹ã€‚
3.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡`X-Cmd-Response` headerè¿”å›ç»“æœã€‚

æä¾›çš„PoCä»£ç åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š
1.  **ç‰ˆæœ¬æ£€æµ‹:**  PoCé¦–å…ˆå°è¯•è·å–Confluenceç‰ˆæœ¬ã€‚
2.  **æ¼æ´åˆ©ç”¨:** å¦‚æœç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œåˆ™æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„HTTP POSTè¯·æ±‚ã€‚
3.  **å‘½ä»¤æ‰§è¡Œ:**  æ¶æ„OGNLè¡¨è¾¾å¼ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¹¶å°†è¾“å‡ºå†™å…¥HTTPå“åº”å¤´ã€‚
4. **ç»“æœä¿å­˜:** å°†æˆåŠŸåˆ©ç”¨çš„URLä¿å­˜åœ¨result.txtä¸­

**é¡¹ç›®åœ°å€:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #17

**æ¥æº**: [CVE-2023-22527-adminlove520_CVE-2023-22527.md](../2023/CVE-2023-22527-adminlove520_CVE-2023-22527.md)

## CVE-2023-22527-Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version <= 8.5.3

**åˆ©ç”¨æ¡ä»¶:** Confluence Serveræˆ–Data Centerå®ä¾‹è¿è¡Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªAtlassian Confluence Serverå’ŒData Centerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…é€šè¿‡å‘`/template/aui/text-inline.vm`ç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„`label`å‚æ•°ã€‚è¯¥OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„`exploit`å‡½æ•°å±•ç¤ºäº†å¦‚ä½•æ„é€ å¹¶å‘é€æ­¤è¯·æ±‚ï¼Œ`main`å‡½æ•°åˆ™æä¾›äº†å‘½ä»¤è¡Œå‚æ•°è§£æåŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‡å®šç›®æ ‡åœ°å€å’Œå¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå­˜åœ¨è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œcryptojackingå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»çš„æ¡ˆä¾‹ã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ç”¨äºåœ¨å—å½±å“çš„Confluenceå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç è¾ƒä¸ºç®€æ´ï¼Œç›´æ¥å®ç°äº†æ¼æ´åˆ©ç”¨çš„åŠŸèƒ½ã€‚æ²¡æœ‰å‘ç°ä½œè€…éšè—çš„æ¶æ„ä»£ç ã€‚é£é™©åˆ¤æ–­ä¸º0%

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„POSTè¯·æ±‚ï¼Œç›®æ ‡ä¸º`/template/aui/text-inline.vm`ã€‚
2.  æ¶æ„OGNLè¡¨è¾¾å¼åˆ©ç”¨`freemarker.template.utility.Execute`ç±»æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
3.  å‘½ä»¤æ‰§è¡Œç»“æœé€šè¿‡`X-Cmd-Response` HTTPå¤´éƒ¨è¿”å›ã€‚
4.  æ”»å‡»è€…ä»å“åº”å¤´éƒ¨è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #18

**æ¥æº**: [CVE-2023-22527-cleverg0d_CVE-2023-22527.md](../2023/CVE-2023-22527-cleverg0d_CVE-2023-22527.md)

## CVE-2023-22527 - Confluence OGNL æ³¨å…¥ RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** Confluence å®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´ä½äºå¤„ç† `text-inline.vm` æ¨¡æ¿çš„ä½ç½®ï¼Œåˆ©ç”¨äº† OGNL è¡¨è¾¾å¼æ³¨å…¥ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ POST è¯·æ±‚ï¼Œå°†æ¶æ„çš„ OGNL è¡¨è¾¾å¼ä½œä¸º `label` å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ° `/template/aui/text-inline.vm` ç«¯ç‚¹ã€‚ 

POC ä»£ç é€šè¿‡å‘é€åŒ…å« OGNL è¡¨è¾¾å¼çš„ POST è¯·æ±‚ï¼Œåˆ©ç”¨ `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` è·å– OGNL ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œ `x` å‚æ•°ä¸­çš„ OGNL è¡¨è¾¾å¼ã€‚è¯¥ POC ä½¿ç”¨ `freemarker.template.utility.Execute` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `id`ï¼Œå¹¶å°†ç»“æœé€šè¿‡ HTTP å“åº”å¤´ `X-Cmd-Response` è¿”å›ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…å‘ç›®æ ‡ Confluence æœåŠ¡å™¨çš„ `/template/aui/text-inline.vm` ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„ POST è¯·æ±‚ã€‚
2.  è¯·æ±‚ä½“ä¸­çš„ `label` å‚æ•°åŒ…å« OGNL è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  OGNL è¡¨è¾¾å¼ä½¿ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœé€šè¿‡ HTTP å“åº”å¤´è¿”å›ï¼Œæˆ–è€…ç”¨äºè¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œä¾‹å¦‚éƒ¨ç½²æ¶æ„è½¯ä»¶ã€‚

**æœ‰æ•ˆæ€§:**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œ POC ä»£ç ï¼Œè¯¥ POC ä»£ç **æœ‰æ•ˆ**ï¼Œå› ä¸ºæœç´¢å¼•æ“ç»“æœæŒ‡å‘äº†å¤šä¸ªåˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œ RCE çš„æ¡ˆä¾‹ã€‚

**æŠ•æ¯’é£é™©:**

æŸ¥çœ‹æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªç”¨äºéªŒè¯æ¼æ´çš„POSTè¯·æ±‚ï¼Œå…¶ä¸­æ‰§è¡Œäº†idå‘½ä»¤ã€‚
README.mdæ–‡ä»¶ä¸»è¦æè¿°äº†æ¼æ´ä¿¡æ¯,EPSSè¯„åˆ†å’ŒCISAç›®å½•ã€‚
ç»¼åˆæ¥çœ‹ï¼Œ**ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç ï¼ŒæŠ•æ¯’é£é™©ä¸º 0%**ã€‚

**é¡¹ç›®åœ°å€:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #19

**æ¥æº**: [CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md](../2023/CVE-2023-22527-ga0we1_CVE-2023-22527_Confluence_RCE.md)

## CVE-2023-22527 Confluence RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2023-22527æ˜¯ä¸€ä¸ªå­˜åœ¨äºAtlassian Confluence Data Centerå’ŒServerä¸­çš„æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬8.0.0åˆ°8.5.3ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿè¯å®äº†è¯¥æ¼æ´çš„ä¸¥é‡æ€§å’Œå¹¿æ³›åˆ©ç”¨ã€‚å¤šå®¶å®‰å…¨å‚å•†éƒ½å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šï¼Œå¹¶è§‚å¯Ÿåˆ°æ”»å‡»è€…ç§¯æåˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œæ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚éƒ¨ç½²æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚POCä»£ç å±•ç¤ºäº†ä¿®å¤æ–¹æ¡ˆçš„å…³é”®éƒ¨åˆ†ï¼Œå³é˜»æ­¢æŸäº›OGNLå˜é‡å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µæ¥çœ‹ï¼Œè¿™ä¸ªä»“åº“ä»…åŒ…å«æ¼æ´ä¿¡æ¯å’Œä¿®å¤æ–¹æ¡ˆï¼Œè€Œæ²¡æœ‰åŒ…å«æ¶æ„çš„æˆ–éšè—çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯èƒ½æ€§ä¸º0%ã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„OGNLè¡¨è¾¾å¼çš„è¯·æ±‚åˆ°ConfluenceæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè§£æå¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [ga0we1/CVE-2023-22527_Confluence_RCE](https://github.com/ga0we1/CVE-2023-22527_Confluence_RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #20

**æ¥æº**: [CVE-2023-22527-kh4sh3i_CVE-2023-22527.md](../2023/CVE-2023-22527-kh4sh3i_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚æœªç»è¿‡èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥ OGNL è¡¨è¾¾å¼æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚PoCä»£ç åˆ©ç”¨ `template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ï¼Œé€šè¿‡ POST è¯·æ±‚å‘é€æ¶æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„ PoC ä»£ç ï¼Œæ­¤æ¼æ´çš„ PoC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ª RCE æ¼æ´ï¼Œå¹¶ä¸”CISAå°†å…¶æ·»åŠ åˆ°äº†å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•(KEV)ä¸­ã€‚ æœç´¢ç»“æœä¸­ä¹Ÿæåˆ°äº†è¯¥æ¼æ´å·²è¢«æ­¦å™¨åŒ–ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒæ¥ä¼ é€’æ¶æ„è½¯ä»¶ã€‚PoC ä»£ç å¯ä»¥æˆåŠŸåœ°åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç æœ¬èº«ä¸»è¦åŒ…å«æ¼æ´éªŒè¯å’Œåˆ©ç”¨çš„ä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡å­˜åœ¨ä¸€äº›éšæ‚£:

*   **ä¾èµ–ç®¡ç†ï¼š** PoC ä½¿ç”¨äº† `requests` åº“ï¼Œå¦‚æœ `requests` åº“è¢«æ¶æ„ç‰ˆæœ¬æ›¿æ¢ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’ã€‚
*   **å‘½ä»¤æ‰§è¡Œï¼š** PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¦‚æœæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£é™©ã€‚
*   **ä»£ç å®¡æŸ¥ï¼š** å°½ç®¡ä»£ç çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯äººå·¥å®¡æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿æ²¡æœ‰éšè—çš„æ¼æ´æˆ–åé—¨ã€‚
ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ç‰¹åˆ¶ POST è¯·æ±‚åˆ° `/template/aui/text-inline.vm` ç»ˆç«¯ç‚¹ã€‚
2.  Confluence Server åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºå­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼ŒOGNL è¡¨è¾¾å¼ä¼šè¢«æ‰§è¡Œã€‚
3.  OGNL è¡¨è¾¾å¼åˆ©ç”¨ `freemarker.template.utility.Execute` ç±»æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
4.  å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¼šè¢«å†™å…¥å“åº”ï¼Œå¹¶è¿”å›ç»™æ”»å‡»è€…ã€‚
5.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶ï¼Œçªƒå–æ•°æ®ï¼Œæˆ–è€…æ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #21

**æ¥æº**: [CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md](../2023/CVE-2023-22527-thanhlam-attt_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-OGNLæ³¨å…¥RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ConfluenceæœåŠ¡å¯è®¿é—®ï¼Œä¸”ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­å­˜åœ¨çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æºäºOGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå·²ç»è¢«CISAæ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç åˆ©ç”¨äº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œå‘½ä»¤å’Œåå¼¹shellä¸¤ç§æ–¹å¼ï¼Œè¡¨æ˜POCå…·æœ‰å®é™…çš„åˆ©ç”¨ä»·å€¼ã€‚

**æŠ•æ¯’é£é™©ï¼š**

åˆ†æPOCä»£ç ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯å›´ç»•æ„é€ payloadè¿›è¡ŒRCEï¼Œè¿›è¡Œç®€å•çš„å‘½ä»¤æ‰§è¡Œæˆ–è€…åå¼¹shellã€‚å­˜åœ¨æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ã€‚ä»£ç ä¸­çš„`truncate`å‡½æ•°ç”¨äºåˆ†å‰²urlç¼–ç åçš„å‘½ä»¤ï¼Œå¹¶ä¿®å¤åˆ†å‰²åå¯èƒ½å‡ºç°çš„urlç¼–ç é—®é¢˜ï¼Œå±äºæ­£å¸¸åŠŸèƒ½ã€‚`X-Forwarded-For`è®¾ç½®ä¸ºå›ºå®šIPï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡ç­–ç•¥ï¼Œä¸å±äºæŠ•æ¯’è¡Œä¸ºã€‚ä»£ç ä¸­å­˜åœ¨è¿æ¥å¤–ç½‘çš„è¡Œä¸º(åå¼¹shell)ï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ­£å¸¸è¡Œä¸ºï¼Œä¸ç®—æŠ•æ¯’ã€‚ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´å®šä½ï¼š** æ¼æ´å­˜åœ¨äº Confluence çš„æ¨¡æ¿å¤„ç†åŠŸèƒ½ä¸­ï¼Œå…·ä½“æ˜¯ `text-inline.vm` æ¨¡æ¿ã€‚
2.  **Payloadæ„é€ ï¼š** æ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP POST è¯·æ±‚ï¼Œæ³¨å…¥åˆ° `label` å‚æ•°ä¸­ã€‚
3.  **OGNLæ³¨å…¥ï¼š**  OGNL è¡¨è¾¾å¼å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„ Java ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚`#request.get('.KEY_velocity.struts2.context').internalGet('ognl').findValue(#parameters.poc[0],{})`æ˜¯OGNLæ³¨å…¥çš„å…³é”®ï¼Œå¯ä»¥è·å–OGNLä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œè¡¨è¾¾å¼ã€‚
4.  **å‘½ä»¤æ‰§è¡Œï¼š**  POC ä»£ç æä¾›äº†ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š
    *   ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šé€šè¿‡`freemarker.template.utility.Execute`ç±»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœå†™å…¥HTTP Header `Cmd-Ret`ä¸­ã€‚
    *   åå¼¹ Shellï¼šé€šè¿‡å°†æ¶æ„ä»£ç å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä»è€Œåå¼¹ shellã€‚ä»£ç å°† url ç¼–ç åçš„å‘½ä»¤åˆ†å‰²ä¸ºå°å—ï¼Œå¹¶é€šè¿‡å¤šæ¬¡è¯·æ±‚å†™å…¥æ–‡ä»¶ï¼Œæœ€åæ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›é•¿åº¦é™åˆ¶ã€‚
5.  **ç»•è¿‡æ£€æµ‹ï¼š** POCä»£ç ä½¿ç”¨`X-Forwarded-For`å¤´ï¼Œå¯èƒ½ç”¨äºç»•è¿‡æŸäº›è®¿é—®æ§åˆ¶æˆ–å®‰å…¨æ£€æµ‹ã€‚
6.  **ç‰ˆæœ¬é™åˆ¶:** è¯¥æ¼æ´åªå½±å“8.0.x åˆ° 8.5.3ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [thanhlam-attt/CVE-2023-22527](https://github.com/thanhlam-attt/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #22

**æ¥æº**: [CVE-2023-22527-thompson005_CVE-2023-22527.md](../2023/CVE-2023-22527-thompson005_CVE-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹çš„ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡ OGNL è¡¨è¾¾å¼æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå—å½±å“çš„ç‰ˆæœ¬æ˜¯ä» 8.0.0 åˆ° 8.5.3ã€‚æœç´¢å¼•æ“ç»“æœæ˜¾ç¤ºï¼Œè¯¥æ¼æ´å·²è¢«ç§¯æåˆ©ç”¨ï¼Œå¹¶è¢«ç”¨äºä¼ æ’­æ¶æ„è½¯ä»¶ï¼Œä¾‹å¦‚åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åºå’Œå‹’ç´¢è½¯ä»¶ã€‚æä¾›çš„POCä»£ç  `README.md` æ–‡ä»¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„è¯·æ±‚ï¼Œåœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸­æ³¨å…¥OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡ç›´æ¥æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„OGNLæ³¨å…¥Payloadæ‰èƒ½å®ç°ã€‚å› æ­¤ï¼Œè¯¥`README.md`æ–‡ä»¶æœ¬èº«ä¸å…·å¤‡å®Œæ•´çš„åˆ©ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºåç»­æ›´å®Œæ•´çš„POCä¸Šä¼ ã€‚**æŠ•æ¯’é£é™©åˆ†æï¼š**è™½ç„¶`README.md`æ–‡ä»¶æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œä½†ä¸èƒ½æ’é™¤è¯¥ä»“åº“çš„å…¶ä»–éƒ¨åˆ†æˆ–è€…åç»­æ›´æ–°ä¸­åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼Œè¯¥ä»“åº“å­˜åœ¨æ½œåœ¨æŠ•æ¯’é£é™©ï¼Œæ¯”ä¾‹å¤§çº¦ä¸º10%ã€‚é£é™©ä¸»è¦åœ¨äºåˆ©ç”¨æ¼æ´çš„é«˜å±æ€§å’Œå¹¿æ³›å…³æ³¨åº¦ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡åç»­æ›´æ–°ï¼Œæ·»åŠ æ¶æ„payloadæˆ–åé—¨ä»£ç ï¼Œè¿›è¡ŒæŠ•æ¯’ã€‚

**é¡¹ç›®åœ°å€:** [thompson005/CVE-2023-22527](https://github.com/thompson005/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #23

**æ¥æº**: [CVE-2023-22527-vulncheck-oss_cve-2023-22527.md](../2023/CVE-2023-22527-vulncheck-oss_cve-2023-22527.md)

## CVE-2023-22527-Atlassian Confluence-RCE

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center and Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”æ”»å‡»è€…å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2023-22527æ˜¯Atlassian Confluence Data Centerå’ŒServerä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡OGNLè¡¨è¾¾å¼æ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´æ— éœ€èº«ä»½éªŒè¯å³å¯åˆ©ç”¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæ¼æ´åˆ©ç”¨ä»£ç ï¼ˆä»…æä¾›äº†LICENSEæ–‡ä»¶ï¼Œä½†æ ¹æ®æœç´¢ç»“æœæ¨æ–­å­˜åœ¨æœ‰æ•ˆçš„PoCï¼‰ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºè¡¨æ˜å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCï¼Œä¸”å·²è¢«ç§¯æåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š** æä¾›çš„ä»£ç åªæ˜¯ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ã€‚æ— æ³•ä»è¯¥æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ã€‚ä½†æ˜¯å…¬å¼€çš„POCå¯èƒ½å­˜åœ¨æŠ•æ¯’çš„é£é™©ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œè¯¦ç»†çš„ä»£ç å®¡è®¡ã€‚å› æ­¤ï¼Œæ ¹æ®æä¾›çš„ä¿¡æ¯ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨5%å·¦å³ï¼ˆä¸»è¦è€ƒè™‘ä¸‹è½½å’Œä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœªå®¡è®¡EXPçš„é£é™©ï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ¶æ„çš„OGNLè¡¨è¾¾å¼ã€‚ConfluenceæœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›è¯·æ±‚æ—¶ï¼Œä¼šå°†OGNLè¡¨è¾¾å¼ä½œä¸ºæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ€»ç»“ï¼šæ­¤æ¼æ´æ˜¯ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåº”å°½å¿«ä¿®å¤ã€‚

**é¡¹ç›®åœ°å€:** [vulncheck-oss/cve-2023-22527](https://github.com/vulncheck-oss/cve-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

## POC #24

**æ¥æº**: [CVE-2023-22527-yoryio_CVE-2023-22527.md](../2023/CVE-2023-22527-yoryio_CVE-2023-22527.md)

## CVE-2023-22527 - Atlassian Confluence è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2023-22527

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Atlassian Confluence Data Center å’Œ Server

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªæˆæƒçš„æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 8.0.0 <= version < 8.5.4

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Confluenceå®ä¾‹ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2023-22527 æ˜¯ Atlassian Confluence Data Center å’Œ Server ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¯¥æ¼æ´æºäºå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥æœªè¿›è¡Œå……åˆ†çš„éªŒè¯å’Œæ¸…ç†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„çš„ OGNL è¡¨è¾¾å¼ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚CISA å·²å°†å…¶æ·»åŠ åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´ç›®å½•ä¸­ã€‚å¤šä¸ªå®‰å…¨ç ”ç©¶å›¢é˜Ÿå’Œå‚å•†å·²ç»å‘å¸ƒäº†å…³äºè¯¥æ¼æ´çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ¡ˆä¾‹ï¼Œè¯æ˜äº†å…¶å¯åˆ©ç”¨æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ OGNL è¡¨è¾¾å¼çš„ HTTP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚è¢«å‘é€åˆ°å—å½±å“çš„ Confluence å®ä¾‹çš„ç‰¹å®šç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`/template/aui/text-inline.vm`ï¼‰ã€‚
3.  Confluence æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨ç¼ºé™·ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ shellã€è¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åœ¨æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶ä»»ä½•ä»£ç éƒ½æœ‰æ½œåœ¨çš„æ¶æ„ä½¿ç”¨çš„å¯èƒ½ï¼Œä½†è¯¥ä»£ç æœ¬èº«æ²¡æœ‰æ˜æ˜¾çš„æ¤å…¥åé—¨æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚
ç»è¿‡ä»£ç åˆ†æï¼Œä¸»è¦çš„é£é™©æ˜¯ä½¿ç”¨è€…åˆ©ç”¨è¯¥POCè¿›è¡Œéæˆæƒçš„æ¸—é€æµ‹è¯•ï¼Œä»è€Œé€ æˆæœªæˆæƒçš„å…¥ä¾µã€‚ä½œè€…æœ¬èº«å¹¶æ²¡æœ‰æ¤å…¥åé—¨ï¼Œè¿›è¡Œå¤§èŒƒå›´çš„æ¼æ´åˆ©ç”¨ï¼Œæˆ–è€…ä¿¡æ¯æ”¶é›†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨ 1% å·¦å³ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  å°½å¿«å‡çº§åˆ°ä¸å—å½±å“çš„ Confluence ç‰ˆæœ¬ï¼ˆ>= 8.5.4, >= 8.6.0, >= 8.7.1ï¼‰ã€‚
2.  å¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼Œå¯ä»¥é‡‡å–ä¸´æ—¶ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚ç¦ç”¨å—å½±å“çš„æ¨¡æ¿å¼•æ“åŠŸèƒ½æˆ–é™åˆ¶å¯¹ Confluence å®ä¾‹çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [yoryio/CVE-2023-22527](https://github.com/yoryio/CVE-2023-22527)

**æ¼æ´è¯¦æƒ…:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)

---

