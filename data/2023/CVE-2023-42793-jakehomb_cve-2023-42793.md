## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** TeamCity versions before 2023.05.4

**利用条件:** 无需认证，可通过网络访问受影响的TeamCity服务器

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC使用Go语言编写，针对JetBrains TeamCity的CVE-2023-42793漏洞。该漏洞源于TeamCity处理特定REST API端点时的逻辑缺陷，允许未经身份验证的远程攻击者在受影响的服务器上获取最高权限。POC分为两个核心阶段：首先，通过访问`/app/rest/users/id:1/token/RPC2`尝试绕过身份验证并获取ID为1（通常是管理员）的用户的访问令牌。代码中使用正则表达式从响应体中提取令牌。其次，利用获取的令牌作为Bearer Token，向`/app/rest/users`发送POST请求来创建一个具有管理员权限的新用户。这种利用方式非常直接且有效，因为它直接利用了系统对管理端点的访问控制漏洞。分析代码逻辑可见，其使用了Go标准库（http, encoding/json等），并未发现明显的反向Shell或恶意二进制下载行为。利用步骤：1. 攻击者确定运行受影响TeamCity版本的服务器IP/域名。2. 运行编译后的POC，提供目标URL及预设的管理员用户名和密码。3. POC发送GET请求获取管理员Token。4. POC携带Token发送POST请求，在系统内创建一个自定义的管理员账户。5. 攻击者使用新创建的账户登录Web后台，实现对构建流程和服务器系统的完全控制。投毒风险分析：该代码段目前表现为相对纯净的自动化利用脚本。风险分析显示其投毒概率较低，约为15%。首先，代码逻辑完全透明，使用了Go的标准网络和编码库，没有使用经过混淆的第三方依赖。其次，其导入包列表均属于官方标准库，不存在恶意伪造的依赖项。虽然代码中禁用了TLS证书验证（InsecureSkipVerify: true），但这在PoC类工具中是常见的做法，旨在增加对自签名证书环境的兼容性。潜在风险点在于，如果该脚本被发布在不受信任的GitHub仓库中，攻击者可能会在二进制分发版中植入后门，或者在代码的隐藏部分加入将受害主机IP回传到攻击者控制的C2服务器的操作。但在当前分析的源代码层面，该POC是合法的安全研究工具，其行为符合漏洞验证的逻辑，不包含破坏性或窃取性的恶意载荷。防御者应重点关注TeamCity日志中针对/app/rest/users路径的异常POST请求以及异常的Token生成记录。

**项目地址:** N/A (Derived from provided POC code snippets)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
