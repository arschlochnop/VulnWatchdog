## CVE-2023-4863 - libwebp (广泛应用于 Google Chrome, Android, 以及包含 Java Artifacts 在内的各种图像处理库) 堆缓冲区溢出 (Heap Buffer Overflow)

**漏洞编号:** CVE-2023-4863

**漏洞类型:** 堆缓冲区溢出 (Heap Buffer Overflow)

**影响应用:** libwebp (广泛应用于 Google Chrome, Android, 以及包含 Java Artifacts 在内的各种图像处理库)

**危害等级:** 高危

**CVSS评分:** 8.8

**影响版本:** 0.5.0 至 1.3.1 (不含 1.3.2)

**利用条件:** 受害者加载恶意构造的 .webp 格式图片文件，触发无损压缩算法中的 Huffman 编码解析漏洞。

**POC 可用性:** 8/10

**POC 类型:** 概念验证/检测工具

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞的核心在于 libwebp 库在处理畸形 WebP 图像时，其无损压缩（Lossless）算法中的 VP8LBuildHuffmanTable 函数存在堆溢出风险。提供的 POC 代码并非直接的攻击利用脚本，而是一套高度工程化的防御性检测工具（libwebp-checker.sh）。该工具的有效性基于三个层面的静态与动态检测逻辑：首先，它通过遍历系统中运行进程的内存映射文件（/proc/self/maps 等机制）识别加载的动态库；其次，它利用特定的导出函数（如 WebPCopyPlane 和 WebPCopyPixels）作为版本识别锚点，判断 libwebp 版本是否在 0.5.0 以上；最后，它寻找 1.3.2 安全版本中引入的 VP8LHuffmanTablesAllocate 函数，如果该函数缺失且存在旧函数，则判定为受影响。这种检测方式在生产环境下具有较高的准确性，能有效识别 Jar 包、RPM 包及二进制文件中的依赖风险。利用步骤：1. 攻击者构造一个精心设计的 .webp 图片文件，该文件包含超出预分配空间的 Huffman 表数据。2. 将该图片放置于网站、邮件或任何使用受影响 libwebp 版本进行解码的应用中。3. 当应用程序调用 WebPDecode 相关接口解析该图片时，VP8LBuildHuffmanTable 函数在构建哈夫曼表时会越界写入堆内存。4. 通过控制越界写入的内容，攻击者可能实现任意代码执行（RCE）或拒绝服务（DoS）。投毒风险分析：该检测脚本本身表现出较高的专业性和透明度，属于防御性安全工具。其代码结构清晰，主要逻辑为 shell 脚本驱动的组件扫描。主要的外部交互点在于 MurphySec 平台的 API 认证，用于获取 Maven 中央仓库的组件哈希数据。虽然这种外部连接在离线内网环境下可能被视为敏感行为，但其目的是为了通过云端数据比对提高检测精度，而非窃取数据。脚本中使用了标准的 bash 命令，没有发现 eval 加密、Base64 混淆或恶意的反弹 shell 逻辑。然而，作为威胁情报分析员，仍需注意其 --token 参数的使用。在高度机密的防御环境中，硬编码或在进程列表中暴露 Access Token 存在一定的凭据泄露风险。由于该项目需要从外部平台下载哈希库，若该平台遭到供应链攻击，分发的哈希数据可能被篡改。总体而言，该工具目前的投毒风险等级处于低位，主要风险集中在第三方服务的依赖上。建议在执行前对脚本进行本地审计，并确保在受控的沙箱或预发环境先行验证。

**项目地址:** [https://github.com/murphysecurity/CVE-2023-4863-libwebp-checker](https://www.google.com/search?q=https://github.com/murphysecurity/CVE-2023-4863-libwebp-checker)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4863](https://nvd.nist.gov/vuln/detail/CVE-2023-4863)
