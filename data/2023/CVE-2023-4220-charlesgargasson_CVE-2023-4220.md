## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 1.11.24

**利用条件:** 无需认证，可通过网络直接访问目标服务器端口。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对Chamilo LMS中的'Big Upload'库存在的一个未授权文件上传漏洞。漏洞核心在于`main/inc/lib/javascript/bigupload/inc/bigUpload.php`文件在处理`post-unsupported`操作时，未对上传的文件类型和访问权限进行严格校验。攻击者可以通过简单的HTTP POST请求将任意PHP脚本（Webshell）上传至服务器的`main/inc/lib/javascript/bigupload/files/`目录下。POC中展示的利用逻辑非常清晰且具有高可靠性：首先利用curl工具模拟表单上传，将一个经过Base64编码处理的PHP命令执行脚本（rce.php）发送至目标系统；随后，POC计算待执行命令的Base64编码并进行URL编码，通过GET请求触发已上传的脚本。该POC直接展示了从文件上传到任意命令执行的完整链条。其代码逻辑符合标准的渗透测试流程，没有冗余的混淆操作，能够直接在实验室环境下复现漏洞。利用步骤：1. 确定目标Chamilo LMS版本是否低于或等于1.11.24。2. 构造包含恶意PHP代码（如使用popen或system函数）的本地文件。3. 使用curl或其他HTTP客户端向`main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported`发送POST请求，将文件上传。4. 访问上传后的文件路径`main/inc/lib/javascript/bigupload/files/rce.php`，并携带攻击载荷参数，实现对服务器底层系统的命令控制。投毒风险分析：该POC代码本身表现为高度透明的Bash脚本，主要逻辑依赖于Linux标准命令curl、cat、echo和python3。通过对脚本内容的逐行审查，未发现任何试图修改本地系统文件、窃取当前操作者环境变量、或向第三方未授权地址发送敏感信息的混淆代码。脚本中使用的PHP Payload采用Base64编码处理输入，这是为了规避某些简单的WAF拦截，而非针对研究员的投毒行为。尽管POC本身风险较低，但防御者在从非官方渠道下载此类POC时仍需警惕。潜在的投毒风险通常存在于以下几个方面：第一，脚本可能被植入隐藏的curl请求，在执行时将研究员机器的内网IP或目录结构上传至攻击者服务器；第二，某些变种POC可能会在cat生成文件的过程中注入针对本地shell的溢出字符。本POC中涉及的python3命令解析部分属于标准的URL编码转换，不具备破坏性。综合评估，该POC的投毒风险等级为低（15%），主要风险点在于其作为攻击工具的传播属性，而非针对分析人员的陷阱设计。建议在隔离的沙箱环境中使用，并手动审查Payload内容。

**项目地址:** [https://starlabs.sg/advisories/23/23-4220/](https://starlabs.sg/advisories/23/23-4220/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
