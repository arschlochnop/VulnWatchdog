## CVE-2023-4220 - Chamilo LMS RCE/任意文件上传

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE/任意文件上传

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** <= 1.11.24

**利用条件:** 远程未经身份验证的访问，且目标存在受影响的文件路径

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC针对Chamilo LMS 1.11.24版本中的CVE-2023-4220漏洞。漏洞根源在于`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`组件在处理大文件上传请求（action=post-unsupported）时，未对上传的文件类型进行有效验证，且未对访问者进行身份验证。POC代码逻辑清晰且高度有效：首先，它构建一个POST请求将包含Webshell（shell.php）的恶意文件发送到漏洞接口。上传成功后，Chamilo会将文件存储在`/main/inc/lib/javascript/bigupload/files/`目录下。POC随后通过GET请求验证该路径下的文件是否存在并可执行。如果验证成功，POC进入一个交互式的命令行循环，通过向shell.php发送含有系统命令的GET参数来执行任意命令。此POC完整实现了从利用到命令执行的闭环，且不需要任何凭据，其在标准安装环境下的成功率极高。利用步骤：1. 确认目标系统版本是否在1.11.24以下。2. 准备包含PHP系统执行函数的Webshell文件（如POC中的shell.php）。3. 调用POC脚本，指定目标URL。4. 脚本通过POST请求将Webshell上传至指定的不受限目录。5. 脚本尝试访问上传后的路径以确认执行环境。6. 攻击者通过交互式Shell接口输入命令，利用system()函数在目标服务器上执行任意系统指令。投毒风险分析：经过对提供的POC源码（exploit.py, shell.php）进行静态分析，未发现明显的投毒行为。代码使用了标准的Python `requests` 库和 `sys` 库进行网络通信和参数处理，逻辑直观，没有任何经过混淆（Obfuscation）的字符串或加密的Payload。Webshell部分（shell.php）仅包含单行PHP代码 `system($_GET['cmd']);`，这是典型的漏洞验证用途。代码中没有发现向攻击者控制的第三方域名发送敏感信息（如目标IP、系统环境信息、环境变量）的行为，也没有尝试在本地执行恶意二进制文件或修改本地Host文件的逻辑。虽然README中提到了该脚本是为了HTB平台（Easy PermX机器）编写，增加了其针对性，但作为防御性研究人员，该POC可视为低风险的安全研究工具。然而，由于该漏洞利用门槛极低且破坏力强，建议在受控的沙箱环境中使用此类脚本，以防止因网络误操作对生产环境造成损害。

**项目地址:** [https://github.com/m3m0o/CVE-2023-4220](https://www.google.com/search?q=https://github.com/m3m0o/CVE-2023-4220)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
