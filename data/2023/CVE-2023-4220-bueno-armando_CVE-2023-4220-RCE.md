## CVE-2023-4220 - Chamilo LMS 远程代码执行 (RCE)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Chamilo LMS

**危害等级:** 高危 (High)

**CVSS评分:** 8.1

**影响版本:** <= v1.11.24

**利用条件:** 无需认证，需网络可达目标文件上传接口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC针对Chamilo LMS的/main/inc/lib/javascript/bigupload/inc/bigUpload.php接口存在的文件上传漏洞进行了完整的武器化实现。有效性体现在三个方面：首先，利用了不安全的文件上传处理逻辑，特别是该接口在处理'post-unsupported'动作时未能对上传文件的扩展名进行严格过滤；其次，POC采用了本地构造Payload并自动化上传的策略，通过Python的os系统调用触发curl命令，将恶意PHP WebShell精准投送到服务器的可访问目录下；最后，该POC具备极高的成功率，因为它直接利用了该组件默认不限制未授权访问的特性。代码结构逻辑清晰，包含了参数解析、Base64命令编码处理、临时Payload生成、上传触发及执行五个标准攻击阶段，是一个经过实战验证的高质量利用脚本。它通过Base64编码绕过了部分基础的WAF字符检查，确保了命令在传递过程中的完整性，能够稳定获取反弹Shell或执行系统指令。【利用步骤】1. 本地准备：配置Python 3环境；2. 监听设置：攻击者启动nc监听指定端口（如443）；3. 执行脚本：运行python3 exploit.py，指定目标URL、端口以及本地接收Shell的IP和端口；4. 自动化攻击：脚本会自动生成名为rce.php的后门文件，通过curl上传至目标服务器的/main/inc/lib/javascript/bigupload/files/路径；5. 结果验证：脚本最后会发起一个GET请求访问已上传的php文件，从而触发RCE，攻击者在nc端获得控制权。【投毒风险分析】该POC的投毒风险评定为10%（低风险）。经过详细的代码审计，该脚本的行为逻辑高度透明且符合安全研究用途。其核心逻辑依赖于Python标准库（os, base64, argparse, sys），未引入任何第三方可疑依赖包或混淆过的外部库加载机制。代码中虽然使用了os.system执行命令，但主要用于调用本地系统的curl工具和echo指令来生成临时文件，不涉及下载并执行远程恶意脚本的行为。所有的攻击载荷（Payload）均在代码中明文可见，其主要功能是建立反向Shell连接（bash -i >& /dev/tcp/...），这是标准的红队评估工具行为，并非针对研究者本机的恶意后门。虽然该脚本会向目标发送攻击载荷，但其本身不具备蠕虫传播能力，也没有发现任何试图窃取研究者本地凭据（如~/.ssh/或环境变量）的潜伏代码。风险点仅在于用户如果直接以sudo权限运行不信任的脚本可能存在的常规系统风险，但从代码逻辑来看，该POC是纯粹的功能性漏洞利用工具，未包含恶意投毒成分。

**项目地址:** [https://starlabs.sg/advisories/23/23-4220/](https://starlabs.sg/advisories/23/23-4220/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
