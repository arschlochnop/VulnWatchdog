## CVE-2023-42793 - JetBrains TeamCity RCE (Remote Code Execution)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** RCE (Remote Code Execution)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** TeamCity < 2023.05.4

**利用条件:** 网络可达目标TeamCity服务器，无需身份验证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC是一个高度自动化的漏洞利用脚本，基于YAML格式的Nuclei模板。分析显示该POC逻辑完整且极具实用性。其核心逻辑分为四个阶段：首先通过DELETE和POST请求特定的REST API端点（/app/rest/users/id:1/tokens/RPC2）来绕过身份验证并为管理员账户（ID:1）生成一个新的访问令牌（Token）。其次，利用生成的令牌访问管理后台，通过修改internal.properties配置文件开启远程调试进程功能（rest.debug.processes.enable=true）。第三，通过POST请求触发配置更新。最后，利用/app/rest/debug/processes接口，传入exePath和params参数实现操作系统命令执行（RCE）。该POC不仅包含了针对Windows（cmd.exe）的payload，也包含了针对Linux（/bin/sh）的payload，具备跨平台利用能力。利用步骤：1. 攻击者发送DELETE请求尝试清理已存在的同名Token。2. 发送POST请求触发认证绕过漏洞，获取ID为1的管理员Token。3. 使用该Token作为Authorization Header，向/admin/dataDir.html发送请求，开启调试模式。4. 再次向/admin/admin.html发送请求以持久化配置。5. 最终向/app/rest/debug/processes发送包含恶意指令的POST请求，获取系统权限。投毒风险分析：该POC代码结构清晰，采用标准的Nuclei DSL语法编写，不包含任何混淆逻辑、外部二进制下载或加密的恶意Payload。其代码行为（如修改internal.properties和调用debug/processes）完全符合CVE-2023-42793的技术特征。风险点主要在于此类自动化模板极易被集成到大规模扫描工具中。在投毒风险评估中，该脚本被归类为低风险，因为其所有操作均透明可见，且不包含针对执行者本机的攻击载荷（如读取本地/etc/passwd或执行反弹shell到第三方服务器）。但安全研究员在生产环境测试时需注意，该POC会修改目标系统的配置文件并为管理员生成Token，这可能导致系统留存后门或状态变更，应在测试完成后手动回滚配置并删除生成的Token。总体而言，该代码是合法的安全研究工具，投毒风险极低，但杀伤力极强。

**项目地址:** [https://github.com/projectdiscovery/nuclei-templates](https://github.com/projectdiscovery/nuclei-templates)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
