## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过/RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过/RCE

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** TeamCity 2023.05.3 之前的所有版本

**利用条件:** 无需身份验证，可通过网络直接访问 TeamCity 服务器。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC脚本针对CVE-2023-42793漏洞提供了完整的利用路径。该漏洞存在于JetBrains TeamCity服务器的REST API处理逻辑中，允许攻击者绕过身份验证。POC首先尝试通过DELETE请求删除特定路径下的用户令牌（/app/rest/users/id:1/tokens/RPC2），随后利用漏洞通过POST请求重新生成该令牌。由于权限校验失效，攻击者可以直接获取ID为1的管理员账户令牌。获取令牌后，POC展示了如何利用该令牌以SYSTEM_ADMIN角色创建一个新的恶意管理员账户（用户名格式为H454NSec加随机数）。利用步骤如下：1. 攻击者发送特定构造的HTTP请求到目标TeamCity服务器；2. 触发身份验证绕过逻辑，获取管理员API令牌；3. 使用该令牌调用管理接口，添加具有全局管理员权限的新用户；4. 攻击者登录新账户，通过后台管理功能（如维护脚本或构建配置）执行任意系统命令，实现RCE。此POC逻辑清晰，使用了标准的requests库和xml解析库，证明了该漏洞在未经授权的情况下可完全控制目标CI/CD服务器，风险极高。 投毒风险分析：经过对提供的Python POC代码进行静态分析，该脚本表现为典型的安全研究验证工具，整体投毒风险较低（约15%）。代码结构清晰，使用了公开的第三方库（requests）和内置模块（random, argparse, xml.etree.ElementTree）。其主要行为是自动化的身份验证绕过和新管理员账户创建。虽然脚本中包含了硬编码的User-Agent字符串指向GitHub项目（[https://github.com/H454NSec/CVE-2023-42793](https://github.com/H454NSec/CVE-2023-42793)），但这通常是作者声明版权的方式，而非恶意投毒特征。脚本末尾尝试将成功结果写入‘vulnerable.txt’文件，这是漏洞扫描器常见的行为。代码中未发现明显的Base64混淆执行、反弹Shell后门植入或对分析环境的敏感信息窃取逻辑。唯一潜在的风险点在于其硬编码的默认密码（@H454NSec），如果使用者未加修改直接在生产环境运行，可能导致系统被第三方利用。此外，由于该漏洞已被APT 29（Midnight Blizzard）等高级威胁组织大规模利用，任何来自非官方渠道的变体POC都应在隔离环境中运行，以防攻击者在合法脚本中夹带隐蔽的恶意负载。

**项目地址:** [https://github.com/H454NSec/CVE-2023-42793](https://github.com/H454NSec/CVE-2023-42793)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
