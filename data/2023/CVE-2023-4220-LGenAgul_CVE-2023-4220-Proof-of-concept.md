## CVE-2023-4220 - Chamilo LMS 任意文件上传导致远程代码执行 (RCE)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 任意文件上传导致远程代码执行 (RCE)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= v1.11.24

**利用条件:** 无需认证，可通过网络直接访问受影响的 bigUpload.php 脚本

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞存在于Chamilo LMS的 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 文件中。由于该文件对上传文件的后缀名及存储位置缺乏严格的校验机制，导致远程未授权攻击者可以上传任意PHP脚本。POC代码 `exploit.py` 展示了完整的自动化利用链：首先构造一个包含反弹Shell功能的PHP代码段，随后通过HTTP POST请求发送至目标系统的漏洞接口，利用 `action=post-unsupported` 参数触发文件保存过程。默认情况下，上传的文件会被存储在 `/main/inc/lib/javascript/bigupload/files/` 目录下。该POC随后会通过访问该路径下的Shell文件来触发反弹Shell。经验证，该POC结构清晰，逻辑符合CVE描述的漏洞原理，针对特定环境（如HTB PermX靶机）具有极高的成功率。利用步骤：1. 准备本地监听环境，使用 `nc -lvnp <PORT>` 监听指定端口。2. 运行利用脚本 `python exploit.py <LOCAL_IP> <PORT>`。3. 脚本会自动创建PHP Webshell，并利用 `requests` 库将其上传至目标服务器。4. 脚本最后通过访问上传成功的Webshell路径触发反弹Shell连接。投毒风险分析：该POC代码表现为低风险。首先，代码逻辑完全透明，主要依赖Python标准库 `argparse`, `requests`, `subprocess` 进行操作，未发现任何混淆处理。其次，Webshell部分明确引用了知名的开源安全研究工具 `pentestmonkey` 的代码，这在安全研究领域是标准的做法。代码中定义的反弹Shell目标IP和端口完全由用户通过命令行参数传入，不存在硬编码的外部恶意回连地址。唯一的硬编码URL `http://lms.permx.htb` 是针对特定的HackTheBox靶机环境设置的，用户可以根据实际测试需求轻松修改。脚本中不包含任何删除本地文件、窃取环境变量或下载额外恶意payload的隐藏行为。因此，该代码被判定为纯粹的安全研究与验证工具，不具备投毒特征，但在生产环境中部署防御措施时，仍需警惕此类利用方式被恶意人员直接复用。

**项目地址:** [https://github.com/pentestmonkey/php-reverse-shell](https://github.com/pentestmonkey/php-reverse-shell)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
