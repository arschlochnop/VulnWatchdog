## CVE-2023-4863 - libwebp Heap Buffer Overflow

**漏洞编号:** CVE-2023-4863

**漏洞类型:** Heap Buffer Overflow

**影响应用:** libwebp

**危害等级:** CRITICAL

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)

**影响版本:** libwebp <= 1.3.1, Google Chrome < 116.0.5845.187

**利用条件:** 用户需要使用受影响的libwebp版本加载或处理由攻击者构造的恶意WebP图像。

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC项目包含一个名为'NotEnough'的工具，其核心原理是基于对libwebp库中Huffman编码处理逻辑的深入分析。libwebp在解码WebP图像时，假设Huffman直方图构建的解码树是‘完整树’，并据此预分配内存。此POC通过修改传统的'enough.c'工具，证明了可以构造出一种‘非完整树’结构，使得实际生成的Huffman表项数量（如542个）远超预期的最大限制（如410个）。代码逻辑清晰，提供了具体的参数指导（40 8 15）来重现溢出边界条件。虽然该POC本身不包含执行Shellcode的完整Payload，但它成功演示了OOB（越界写入）的触发机制，具有极高的技术参考价值和复现成功率。利用步骤：1. 环境准备，确保安装GCC编译器及libwebp 1.3.1以下版本的开发环境。2. 编译主程序，运行`gcc -o NotEnough ./main.c`。3. 执行漏洞验证命令`./NotEnough 40 8 15`，观察生成的Huffman表项数量是否触发溢出逻辑。4. 进阶利用可参考README中的提示，使用craft工具修改WebP图片的code_lengths_counts数组，生成恶意webp文件。5. 使用dwebp等工具加载该文件以触发崩溃或溢出。投毒风险分析：经过对POC源代码（main.c及CMakeLists.txt）的深度审计，未发现任何混淆代码、外部恶意下载脚本或反弹Shell等后门行为。项目主要基于Mark Adler的开源代码进行功能性修改，用于计算Huffman表大小。README文档详细引用了知名安全研究员benhawkes的博客及GitHub原始仓库，透明度高。虽然POC提供了利用漏洞的具体技术细节，但其代码结构属于标准的安全研究范畴，无隐蔽的恶意意图。投毒风险极低，仅有的风险在于其作为技术组件可能被恶意利用于自动化武器化框架中，但代码本身是安全的。建议在隔离的沙箱环境中编译运行，以防在漏洞测试过程中意外损坏生产系统的内存稳定性。

**项目地址:** [https://github.com/mistymntncop/CVE-2023-4863](https://github.com/mistymntncop/CVE-2023-4863) (referenced)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4863](https://nvd.nist.gov/vuln/detail/CVE-2023-4863)
