# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

# CVE-2023-21768

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md](../2023/CVE-2023-21768-AiK1d_CVE-2023-21768-POC.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个 Windows WinSock Ancillary Function Driver 中的本地权限提升漏洞。根据漏洞库信息，该漏洞影响 Windows Server 2022 和 Windows 11 的多个版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码。提供的POC代码（Windows_AFD_LPE_CVE-2023-21768.exe）利用该漏洞将目标进程的权限提升到 SYSTEM。利用方式是通过指定要提升权限的进程ID（PID）来运行该程序。根据github上的信息，该exploit在Windows 11 22H2系统上完整可用。由于提供的POC只包含readme和一个exe,无法直接判断投毒风险，假设exe文件为安全,则风险较低，但考虑到二进制文件可能被修改，因此给出较低的投毒风险评估。该漏洞属于CWE-822: Untrusted Pointer Dereference类型。

**项目地址:** [AiK1d/CVE-2023-21768-POC](https://github.com/AiK1d/CVE-2023-21768-POC)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #2

**来源**: [CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md](../2023/CVE-2023-21768-HKxiaoli_Windows_AFD_LPE_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #3

**来源**: [CVE-2023-21768-IlanDudnik_CVE-2023-21768.md](../2023/CVE-2023-21768-IlanDudnik_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升

**影响应用:** Microsoft Windows

**危害等级:** 高危，可使低权限用户提升至SYSTEM权限

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows Ancillary Function Driver (AFD) for WinSock特权提升漏洞。根据漏洞库信息，该漏洞影响Windows Server 2022和Windows 11的特定版本。搜索引擎结果表明，该漏洞允许具有有效系统访问权限的攻击者以提升的权限执行任意代码，属于本地提权漏洞。提供的漏洞利用代码包含一个Visual Studio解决方案文件(WspSocket.sln)和一个C++源文件(ClientServerInit.cpp)。

**有效性：**
从提供的README.md来看, 此exp在Windows 22H2 22621.963上测试通过，表明该漏洞利用代码具有一定的有效性。github链接进一步佐证了POC的有效性。

**投毒风险：**
代码本身是一个简单的客户端-服务器通信示例，用于触发漏洞。其中`ClientServerInit.cpp`文件包含了创建客户端线程和服务器上下文的代码，以及socket通信的相关函数。虽然代码量不大，但仍然存在一定的投毒风险。比如: 替换`payload = 0xdeadbeef`为恶意代码, 或者通过修改`transmitCount` 放大攻击效果。

*   **评估结果：** 代码本身是合法的socket通信代码，但可能被篡改添加恶意行为，例如后门植入。总体投毒风险为10%，主要来自构建项目时的潜在恶意修改。

**利用方式：**
漏洞利用方式是通过AFD驱动程序中的未受信指针解引用漏洞实现的。攻击者利用该漏洞，可以通过构造特定的网络请求或操作，触发AFD驱动程序中的内存错误，从而获得SYSTEM权限。具体步骤可能包括：

1.  利用IO Rings创建 socket，触发漏洞所在函数。
2.  向存在漏洞的socket 发送恶意数据。
3.  利用内存破坏漏洞改写内核数据。
4.  最终实现本地提权。

**项目地址:** [IlanDudnik/CVE-2023-21768](https://github.com/IlanDudnik/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---



---

## POC #4

**来源**: [CVE-2023-21768-Malwareman007_CVE-2023-21768.md](../2023/CVE-2023-21768-Malwareman007_CVE-2023-21768.md)

## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #5

**来源**: [CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md](../2023/CVE-2023-21768-Rosayxy_Recreate-cve-2023-21768.md)

## CVE-2023-21768 Windows AFD Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows AFD.sys

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD.sys) 中的一个权限提升漏洞。攻击者可利用此漏洞在受影响的系统上以 SYSTEM 权限执行任意代码。

**有效性分析：**

根据搜索结果和漏洞利用代码，该漏洞的 POC 是有效的。搜索结果中的网页 7 指出 "Complete exploit works on vulnerable Windows 11 22H2 systems. Write primitive works on all vulnerable systems." 提供的代码也包含了完整的利用程序。

**投毒风险分析：**

漏洞利用代码主要通过以下方式实现提权：
1.  **利用 AFD.sys 漏洞：** 漏洞存在于 `AfdNotifyRemoveIOCompletion` 函数中，该函数在特定条件下会错误地使用用户提供的地址作为内核地址，从而允许任意内核写入。
2.  **利用 IORING：**  POC 使用 IORING 技术来实现任意内核读取和写入。这是通过首先获得一个任意内核写原语（Arbitrary Kernel Write）来实现的，然后利用 IORING 来获得完整的读/写能力。
3.  **绕过安全检查：**  POC 通过构造特定的 `AFD_NOTIFYSOCK_DATA` 结构来绕过 AFD.sys 驱动程序中的各种安全检查。

该漏洞利用代码没有明显的恶意行为或后门。风险主要在于利用复杂，需要对 Windows 内核机制有较深入的理解，因此手动添加恶意代码有一定的难度。`AFD_NOTIFYSOCK_DATA` 结构体中各个成员的赋值，是为了满足函数调用链中的各种检查。尽管代码可能存在未知的安全隐患，但基于目前的信息，投毒的概率较低，估计在 10% 左右。

**利用方式总结：**

1.  **查找 NT 函数：**  通过 `GetNtFunctions` 函数获取 `NtCreateFile`, `NtDeviceIoControlFile`, `NtCreateIoCompletion`, `NtSetIoCompletion`, `NtQuerySystemInformation` 等未公开的 NT 函数地址。
2.  **创建句柄：**  使用 `NtCreateIoCompletion` 创建一个 I/O 完成端口的句柄。
3.  **构造数据：**  构造 `AFD_NOTIFYSOCK_DATA` 结构，其中包含用于绕过安全检查的特定值以及要写入的内核地址。
4.  **触发漏洞：**  通过 `NtDeviceIoControlFile` 向 AFD.sys 驱动程序发送 `AFD_NOTIFYSOCK_IOCTL` 控制码，触发漏洞。
5.  **任意内核写入：**  利用漏洞实现任意内核写入，将精心构造的数据写入到目标内核地址。
6.  **利用 IORING提权：**  使用IORING技术,实现内核任意地址读写，最终实现权限提升。

**项目地址:** [Rosayxy/Recreate-cve-2023-21768](https://github.com/Rosayxy/Recreate-cve-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #6

**来源**: [CVE-2023-21768-SamuelTulach_nullmap.md](../2023/CVE-2023-21768-SamuelTulach_nullmap.md)

## CVE-2023-21768-Windows AFD驱动提权漏洞

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许低权限用户提升到SYSTEM权限

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞执行任意代码并获得 SYSTEM 权限。

**有效性:**
根据搜索结果和提供的漏洞利用代码，该漏洞存在可利用的POC。`https://github.com/Malwareman007/CVE-2023-21768` 这个链接表明存在完整的漏洞利用代码，并且 `https://www.youtube.com/watch?v=qdAZ8mTsTrc` 提供了一个视频演示，佐证了POC的有效性。提供的代码片段展示了使用IoRing进行内存读写的操作, 以及通过修改CR4寄存器来绕过SMEP/SMAP，最终执行用户模式的驱动程序。

**投毒风险:**
代码中存在一些硬编码的偏移量，例如NtGdiGetEmbUFI的偏移量，以及CR4的值。如果这些硬编码值不适用于目标系统，则漏洞利用将失败。另外，作者提到手动映射的驱动程序会分配在ExAllocatePool中，容易被dump。如果攻击者不注意，可能会暴露恶意代码。综上所述，存在一定的投毒风险，为了降低这种风险，攻击者需要对目标系统进行充分的分析，得到正确的偏移量以及CR4的值。此外，作者使用修改CR4寄存器来绕过SMEP/SMAP，这可能导致系统不稳定，蓝屏等问题。攻击者应该使用更加稳定的利用手段。因此，评估仓库中作者隐藏的投毒代码的可能性为30%。

**利用方式:**
1.  **漏洞触发:** 利用AFD驱动中的漏洞，获得在内核中读写内存的能力，该漏洞的根本原因是`CWE-822: Untrusted Pointer Dereference`，也就是非法的指针解引用。
2.  **信息泄露/地址定位:** 泄露必要的内核地址，例如NtGdiGetEmbUFI的地址，以及CR4寄存器的值。
3.  **权限提升:** 禁用SMEP/SMAP(通过修改CR4寄存器)，或者使用其他手段绕过保护机制。
4.  **代码执行:** 将恶意的驱动程序映射到内核空间，并执行该驱动程序。
5.  **清理/隐藏:** 清理痕迹，防止被检测。

总而言之，该漏洞利用比较复杂，需要攻击者具备一定的内核调试和逆向分析能力。

**项目地址:** [SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #7

**来源**: [CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md](../2023/CVE-2023-21768-chompie1337_Windows_LPE_AFD_CVE-2023-21768.md)

## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #8

**来源**: [CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md](../2023/CVE-2023-21768-cl4ym0re_cve-2023-21768-compiled.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，本地权限提升到SYSTEM

**影响版本:** Windows Server 2022 (版本低于 10.0.20348.1487), Windows 11 21H2 (版本低于 10.0.22000.1455), Windows 11 22H2 (版本低于 10.0.22621.1105)

**利用条件:** 需要本地低权限账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是一个Windows AFD驱动中的权限提升漏洞。根据漏洞库信息，攻击者可以利用此漏洞将权限从低权限用户提升到SYSTEM权限。搜索引擎结果显示，该漏洞已被公开披露，并且存在可用的POC。提供的漏洞利用代码包含一个编译后的版本，并在 Windows 11 22H2 22621.963 上进行了测试，并且链接到了原始代码的GitHub仓库（xforcered/Windows_LPE_AFD_CVE-2023-21768）。利用方式是通过向AFD驱动发送精心构造的请求，触发未受信任的指针解引用（CWE-822），从而实现任意代码执行。虽然提供的代码仓库中只有一个README文件和编译后的exe文件，直接运行编译后的文件有一定风险，存在投毒的可能性，但考虑到它引用了另一个代码仓库，且该漏洞已经公开，投毒风险相对较低，约为10%。建议从原始代码仓库编译，或者在虚拟机环境中测试该POC。

**项目地址:** [cl4ym0re/cve-2023-21768-compiled](https://github.com/cl4ym0re/cve-2023-21768-compiled)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #9

**来源**: [CVE-2023-21768-h1bAna_CVE-2023-21768.md](../2023/CVE-2023-21768-h1bAna_CVE-2023-21768.md)

## CVE-2023-21768 Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (afd.sys)

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver for WinSock (afd.sys) 中的一个权限提升漏洞。根据漏洞信息和搜索结果，攻击者可以利用此漏洞在受影响的系统上获得更高的权限。漏洞的根本原因是 afd.sys 中的 `AfdNotifyRemoveIoCompletion` 函数在写入内存之前缺少对用户提供的指针的验证。利用方式如下：

1.  攻击者通过 `DeviceIoControl` 函数，使用 `IOCTL_AFD_NOTIFY_SOCK` 控制代码与 `afd.sys` 驱动程序交互。
2.  `AfdDispatchDeviceControl` 函数根据控制代码在 `AfdIoctlTable` 中查找相应的处理函数，即 `AfdNotifySock`。
3.  `AfdNotifySock` 函数调用 `AfdNotifyRemoveIoCompletion` 函数。
4.  在易受攻击的版本中，`AfdNotifyRemoveIoCompletion` 函数会将 `var_304` 的值写入到 `arg3_1->field_18` 指向的内核内存地址，而没有进行适当的验证，从而导致任意内核写入。
5.  攻击者可以精心构造 `arg3_1->field_18` 指向的地址，从而实现权限提升。

**有效性：**
提供的漏洞利用代码（readme.md）描述了漏洞原理、补丁差异分析，并提供了利用该漏洞的概念验证代码。搜索结果中[webpage 7 begin] [title] Malwareman007/CVE-2023-21768 [description] Complete exploit works on vulnerable Windows 11 22H2 systems.表明存在可用的完整漏洞利用代码。

**投毒风险：**
尽管提供了漏洞利用的详细信息，但是由于缺少实际的可执行代码，并且readme中的代码不完整，因此无法准确评估投毒风险。考虑到攻击者可能利用该漏洞进行恶意活动，存在一定的投毒风险，根据以往经验，以及代码的不完整性，主观评估投毒风险为10%。


**项目地址:** [h1bAna/CVE-2023-21768](https://github.com/h1bAna/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #10

**来源**: [CVE-2023-21768-ldrx30_CVE-2023-21768.md](../2023/CVE-2023-21768-ldrx30_CVE-2023-21768.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver (AFD)

**危害等级:** 高危，允许本地用户以SYSTEM权限执行任意代码

**影响版本:** Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.1487 之间，不包括 10.0.20348.1487)；Windows 11 21H2 (版本介于 10.0.0 和 10.0.22000.1455 之间，不包括 10.0.22000.1455)；Windows 11 22H2 (版本介于 10.0.22621.0 和 10.0.22621.1105 之间，不包括 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768是一个Windows AFD（Ancillary Function Driver for WinSock）驱动中的权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索结果和漏洞利用代码，存在可用的POC，并且已经有利用代码在Github上公开（https://github.com/Malwareman007/CVE-2023-21768）。因此，该漏洞的利用是有效的。

**投毒风险：**
提供的漏洞利用代码（CVE-2023-21768.md）主要包含漏洞分析和补丁diff信息，并没有直接的恶意代码。 然而，由于该漏洞利用代码的最终目标是提升权限，具有极高的潜在危害性。从信息安全角度出发，虽然POC本身不包含明显的恶意代码，但是攻击者可能使用包含恶意代码的自定义POC来利用此漏洞，因此不能完全排除投毒风险。基于以上信息，仓库中直接包含投毒代码的概率较低，推测投毒风险为10%。

**利用方式：**
利用方式主要包括以下几个步骤：

1.  **漏洞定位：**  该漏洞存在于afd.sys驱动中，通过分析补丁可以发现漏洞修复的关键点是增加了一个`ProbeForWrite`的验证。
2.  **IOCTL调用：**  可以通过`DeviceIoControl`进行通信，也可以使用 `NtDeviceIoControlFile` 控制代码直接发送到指定的设备驱动程序。漏洞存在于`AfdFastIoDeviceControl` 和 `AfdDispatchDeviceControl`中，通过`AfdIoctlTable`表找到对应IOCTL。
3.  **触发漏洞：** 通过构造特定的IOCTL请求，绕过验证，导致内核中的指针解引用错误，从而实现任意地址写入。
4.  **权限提升：**  通过任意地址写入，攻击者可以修改内核数据结构，劫持控制流，最终提升权限到SYSTEM。

**项目地址:** [ldrx30/CVE-2023-21768](https://github.com/ldrx30/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #11

**来源**: [CVE-2023-21768-radoi-teodor_CVE-2023-21768.md](../2023/CVE-2023-21768-radoi-teodor_CVE-2023-21768.md)

## CVE-2023-21768-Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升 (LPE)

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2023-21768 存在于Windows AFD驱动中，是一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 根据搜索结果，已经存在公开可用的利用代码，例如Github仓库`Malwareman007/CVE-2023-21768` 。提供的代码表明是从`chompie1337/Windows_LPE_AFD_CVE-2023-21768` fork而来, 并且添加了禁用DSE(驱动签名强制)的功能, 这本身属于提权利用的一部分, 但也增加了潜在的风险。由于该漏洞允许加载未签名的驱动，如果攻击者在编译过程中或运行时替换驱动程序，可能会引入恶意代码，这属于投毒风险。 此代码的投毒风险评估为30%, 考虑因素如下: 代码修改涉及禁用DSE，存在被替换成恶意驱动的可能；该项目是从其他项目 fork 而来，引入了额外的代码修改，增加了潜在的风险。

**项目地址:** [radoi-teodor/CVE-2023-21768](https://github.com/radoi-teodor/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #12

**来源**: [CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md](../2023/CVE-2023-21768-xboxoneresearch_CVE-2023-21768-dotnet.md)

## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

## POC #13

**来源**: [CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md](../2023/CVE-2023-21768-zoemurmure_CVE-2023-21768-AFD-for-WinSock-EoP-exploit.md)

## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)

---

