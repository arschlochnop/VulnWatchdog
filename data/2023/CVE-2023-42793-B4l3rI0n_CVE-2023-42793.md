## CVE-2023-42793 - JetBrains TeamCity RCE (远程代码执行)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** RCE (远程代码执行)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** TeamCity 2023.05.3 之前的所有版本

**利用条件:** 无需认证，远程网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC通过利用JetBrains TeamCity中的身份验证绕过漏洞（CVE-2023-42793）来实现远程代码执行。根据提供的代码逻辑，攻击分为两个核心阶段。第一阶段，exploit.py 脚本利用漏洞允许未经身份验证的访问直接在受影响的服务器上创建一个具备管理员权限的新用户。这一步是利用了JetBrains TeamCity特定API端点在处理请求时未能正确校验访问权限的缺陷。该脚本功能完整，支持自定义用户名、密码和邮件，并能自动捕获并保存生成的Token，证明了其在自动化攻击中的高度有效性。第二阶段，rce_exploit.py 脚本使用第一步获取的管理员权限Token，通过启用TeamCity的调试流程（Debug Processes）接口来执行系统命令。分析代码可知，该POC不仅能执行简单的 whoami 指令，还内置了反弹Shell的Payload构造模板，经过在特定测试平台（如Hack The Box的Runner机器）上的验证，其利用链条闭环且稳定。该漏洞由于其攻击门槛极低且影响深远（SVR等APT组织曾大规模利用），使得该POC具有极高的实战价值和威胁性。利用步骤：1. 环境准备，安装Python3及requests等依赖库；2. 运行 exploit.py，指定目标URL (-u) 以在目标系统创建管理员账号并获取Token；3. 运行 rce.py，携带获取的Token文件 (-t) 和目标指令 (-c)，触发远程代码执行；4. 如需持久化控制，可使用内置的bash反弹命令配合nc监听实现。投毒风险分析：该POC代码结构清晰，使用了标准的Python库（如argparse, requests），未发现明显的代码混淆或加密行为。脚本中的关键逻辑如POST请求发送和Token解析均透明可见，符合安全研究人员的编写规范。然而，在‘For reverse shell’部分提到的外部链接（revshells.com）虽为合法安全工具，但提示用户下载或访问外部资源在复杂的威胁情报环境下仍存在供应链污染的微弱风险。此外，POC作者在README中明确提及了该脚本曾用于HTB（Hack The Box）实验室，这类脚本通常较为纯净，旨在验证漏洞。但作为防御性分析，仍需警惕此类POC被第三方二次打包分发时植入恶意逻辑，例如在执行rce.py时偷偷将目标URL或获取的Token异步回传至攻击者的C2服务器。当前代码本身未见明显的后门插入或恶意自删除逻辑，整体投毒风险评估为低（15%），主要风险点在于外部反弹shell生成的Payload建议手动核对，避免直接运行未经审计的复杂单行命令。建议在使用前在隔离的Sandbox环境或虚拟机中对API请求进行抓包审计，确保其行为符合预期。

**项目地址:** [https://github.com/Zyad-Elsayed/CVE-2023-42793](https://github.com/Zyad-Elsayed/CVE-2023-42793)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
