## CVE-2023-50564 - Pluck-CMS 任意文件上传 (Arbitrary File Upload) 导致远程代码执行 (RCE)

**漏洞编号:** CVE-2023-50564

**漏洞类型:** 任意文件上传 (Arbitrary File Upload) 导致远程代码执行 (RCE)

**影响应用:** Pluck-CMS

**危害等级:** 高危 (Critical)

**CVSS评分:** 未知 (Not provided)

**影响版本:** 4.7.18

**利用条件:** 需要管理员认证，攻击者需具有目标系统的有效管理员凭据，并通过上传特制的ZIP文件利用此漏洞。

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

### POC有效性分析
提供的Python POC脚本（`cve-2023-50564.py`）是一个高度有效且功能完整的漏洞利用工具，专门用于利用Pluck-CMS 4.7.18版本中的CVE-2023-50564任意文件上传漏洞。该脚本通过自动化登录和文件上传过程，成功实现了远程代码执行。

脚本首先通过命令行参数获取目标URL、待上传的ZIP文件路径以及Pluck-CMS的管理员密码。它使用`requests`库模拟POST请求，向`/login.php`页面发送登录凭据。登录成功后，脚本利用`requests_toolbelt.MultipartEncoder`构造一个multipart/form-data请求，将用户指定的ZIP文件上传到`/admin.php?action=installmodule`路径。这个路径是Pluck-CMS用于安装模块的功能，而漏洞恰恰在于其在处理上传的ZIP文件时，缺乏对文件类型和内容的充分验证，导致攻击者可以上传并解压包含恶意PHP代码的ZIP文件。

POC的README文件明确指示用户准备一个包含PHP反弹Shell的ZIP文件，并建议使用`pentestmonkey`提供的标准PHP反弹Shell。脚本在执行文件上传前，会友好地提示用户启动一个监听器，这体现了其作为教育和测试工具的严谨性。整个利用流程清晰，代码逻辑易于理解，且不依赖任何异常或非标准的库，证明了其在实际环境中利用该漏洞的可靠性。因此，该POC能够有效地实现远程代码执行，获得目标系统的控制权。

### 利用步骤
1.  **准备恶意Payload**: 首先，攻击者需要准备一个PHP反弹Shell文件。例如，可以使用`pentestmonkey`提供的`php-reverse-shell.php`，并将其中的`$ip`和`$port`变量修改为攻击者监听的IP地址和端口。
2.  **打包Payload**: 将修改后的PHP反弹Shell文件（例如，命名为`shell.php`）压缩成一个ZIP文件（例如，`shell.zip`）。Pluck-CMS在安装模块时会解压此文件，因此需要确保PHP文件在ZIP包中处于可被Web服务器访问和执行的路径。
3.  **启动监听器**: 在攻击者的机器上，启动一个网络监听器，例如使用Netcat (`nc -lvnp <port>`)，监听在步骤1中配置的端口，等待反弹Shell连接。
4.  **获取CMS凭据**: 攻击者需要获取目标Pluck-CMS系统的有效管理员凭据（用户名和密码）。通过信息收集、弱口令猜测（例如，`admin:admin123`，如搜索结果所示）或其他方式获得。
5.  **执行POC**: 运行提供的Python POC脚本，指定目标Pluck-CMS的URL、打包好的ZIP文件以及管理员密码。命令示例如下：`python3 cve-2023-50564.py -u http://[target_url] -f shell.zip -p [admin_password]`。
6.  **建立Shell**: POC脚本执行后，会首先尝试使用提供的凭据登录到Pluck-CMS。登录成功后，脚本将上传`shell.zip`文件到`admin.php?action=installmodule`模块安装接口。Pluck-CMS处理该文件时，会将其解压，并执行其中的PHP反弹Shell。此时，攻击者在步骤3中启动的监听器将接收到来自目标服务器的反弹Shell连接，从而获得远程代码执行权限。

### 投毒风险分析
该POC代码的投毒风险评估为**低（约5%）**。主要基于以下几点分析：

*   **代码清晰度与可读性**: 脚本代码结构清晰，逻辑直接，未发现任何代码混淆、加密或难以理解的部分。所有导入的模块、函数定义以及主要的HTTP请求流程都易于审查。防御性安全研究人员可以轻松阅读和理解其每一行代码，从而验证其行为是否符合预期。
*   **依赖项分析**: 脚本主要依赖于Python标准库`argparse`以及常用的第三方HTTP请求库`requests`和`requests_toolbelt`。这些库都是Python生态系统中广泛使用且经过严格审查的成熟项目，其本身包含恶意代码的可能性极低。脚本没有引入或执行任何非标准或来源不明的外部库。
*   **外部资源与动态加载**: 该POC代码不涉及从外部URL下载、加载或执行任何脚本或二进制文件。它完全在本地运行，并使用用户提供的ZIP文件作为Payload。这意味着攻击者无法通过修改POC指向的远程资源来注入恶意代码。
*   **行为限定性**: 脚本的行为严格限定于实现CVE-2023-50564漏洞的利用。其核心功能是：解析命令行参数、模拟用户登录、上传一个由用户指定路径的ZIP文件。没有发现任何与漏洞利用无关的额外恶意行为，例如扫描网络、窃取敏感信息、创建持久性后门（用户上传的Shell除外）、修改系统配置或进行其他异常网络通信。
*   **用户控制Payload**: 脚本明确要求用户提供包含恶意PHP代码的ZIP文件作为Payload。这强调了POC本身只是一个传输工具，真正的“恶意”部分（即反弹Shell）是由用户创建和控制的。因此，POC本身不承载恶意代码，其危险性取决于用户选择的Payload。

综合来看，由于代码透明、依赖安全、行为单一且用户高度可控Payload，该POC代码被恶意投毒的风险极低。在进行漏洞复现或测试时，可以放心地对其进行分析和使用，但仍建议始终在隔离环境中运行此类工具。

**项目地址:** https://github.com/Rai2en/CVE-2023-50564_Pluck-v4.7.18_PoC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2023-50564
