## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过/远程代码执行

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** TeamCity 2023.05.3 之前的版本

**利用条件:** 远程网络访问，无需身份验证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2023-42793 是一个存在于 JetBrains TeamCity 服务器中的严重安全漏洞，允许未经身份验证的攻击者绕过身份验证并获得系统管理员权限。POC有效性分析：提供的 Python 代码展示了一个非常高效且直接的利用链。该脚本通过访问受影响服务器的特定 REST API 端点 `/app/rest/users/id:1/tokens/RPC2` 来生成一个属于系统管理员（ID: 1）的新访问令牌。利用步骤如下：首先，脚本向令牌生成接口发送 POST 请求，由于漏洞的存在，该请求无需预先认证即可执行；接着，脚本使用正则表达式从响应中提取生成的 token；最后，脚本携带该 token 调用 `/app/rest/users` 接口，创建一个具有 'SYSTEM_ADMIN' 角色（系统管理员）的新用户。这一过程完全自动化，且由于 TeamCity 在该版本中对特定 REST 路径的权限校验逻辑存在缺陷，攻击者可以稳定地通过此类令牌获取最高权限。一旦获得管理员权限，攻击者可以通过 TeamCity 的正常功能（如创建构建步骤或插件上传）在服务器上执行任意系统命令，从而实现远程代码执行（RCE）。该 POC 逻辑严密，直接指向了漏洞的核心成因，证明了该漏洞在未修复环境中的极高可利用性。投毒风险分析：经过对 POC 代码的逐行审计，该脚本使用了 Python 标准库中的 `sys`、`secrets`、`re` 以及常用的 `requests` 库，未发现任何恶意混淆、未授权的外部域名连接或危险的系统级调用（如硬编码的恶意 shellcode 注入）。脚本中的操作均针对目标 TeamCity 服务器，包括创建随机生成的用户名和密码。唯一的潜在风险在于其自动化程度较高，若在未经授权的情况下运行可能导致目标系统被植入持久化的管理员账号。代码结构清晰，变量命名直观，没有检测到典型的恶意投毒特征（如 Base64 编码的恶意载荷、下载远程执行脚本的行为或静默窃取本地敏感文件的操作）。对于安全研究员而言，该 POC 是一个干净的验证工具，风险主要集中在漏洞本身的破坏力而非代码本身的投毒危害。因此，投毒风险评级为 5%，属于低风险范畴，但在防御端应严格监控此类非法创建管理员用户的 API 调用行为。

**项目地址:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)
