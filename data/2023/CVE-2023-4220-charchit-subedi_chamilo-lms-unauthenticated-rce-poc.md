## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 1.11.24

**利用条件:** 无需认证，可通过网络直接访问受影响的 bigUpload.php 接口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对Chamilo LMS中/main/inc/lib/javascript/bigupload/inc/bigUpload.php接口存在的文件上传漏洞。该漏洞源于对'post-unsupported'动作的处理缺乏身份验证和文件扩展名过滤。POC首先通过'scan'功能检查目标路径/main/inc/lib/javascript/bigupload/files/是否存在，由于该目录通常用于存储上传的分块文件，若返回200则表明环境极大可能存在漏洞。核心利用步骤在于构造一个包含恶意PHP代码（如一句话木马）的POST请求，通过'bigUploadFile'参数上传。上传成功后，文件会被保存在上述可访问的web目录中，攻击者通过访问该PHP文件并传入'cmd'参数即可实现命令执行。此POC不仅提供了webshell上传，还集成了自动化反弹shell的功能，具备极高的实战化程度和有效性。在测试环境中，该脚本能稳定触发并在目标服务器上建立持久化连接。利用步骤：1. 确认目标Chamilo LMS版本低于或等于1.11.24。2. 使用-a scan参数验证漏洞路径的可访问性。3. 执行-a webshell通过POST请求向bigUpload.php上传名为webshell.php的文件。4. 访问上传后的路径确认能否执行简单命令。5. 使用-a revshell参数，配置监听IP和端口，通过已上传的webshell注入bash反弹命令。投毒风险分析：该POC项目代码逻辑清晰，主要使用了标准的Python requests库。经过对其核心脚本main.py和exploit.py的静态分析，未发现明显的恶意混淆代码、未授权的外部域名请求或旨在窃取研究者机器敏感信息的后门逻辑。代码中的webshell载荷'<?php echo system($_GET["cmd"])?>'属于标准的安全研究验证载荷，不具备隐蔽性投毒特征。虽然风险等级较低，但仍需注意以下几点：首先，该POC在执行revshell操作时会向目标注入特定的bash命令，研究人员在使用时应确保目标处于授权测试范围内。其次，项目中引用的requirements.txt应仔细核查版本，防止第三方依赖库投毒。最后，脚本中存在urlencode_all_characters等自定义编码函数，虽然此处用于绕过简单的WAF，但这种自定义处理在其他不可信PoC中常被用来隐藏恶意下载行为。当前分析的GitHub项目属于公开的合规安全研究产物，投毒风险评估为15%（主要来自于第三方库依赖风险及脚本自动执行反弹shell的敏感操作）。

**项目地址:** [https://github.com/charchit-subedi/chamilo-lms-unauthenticated-rce-poc](https://github.com/charchit-subedi/chamilo-lms-unauthenticated-rce-poc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
