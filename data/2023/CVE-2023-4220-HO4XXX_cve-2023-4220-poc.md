## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** < 1.11.24

**利用条件:** 无需认证，可通过网络访问受影响的 Chamilo 实例

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对Chamilo LMS中的CVE-2023-4220漏洞，这是一个由于大文件上传功能（/main/inc/lib/javascript/bigupload/inc/resume.php）中缺乏身份验证和文件过滤导致的存储型XSS及远程代码执行漏洞。分析提供的Python代码发现，其逻辑非常清晰且具有高度可操作性。代码首先通过requests库尝试向目标服务器上传恶意的PHP文件。在利用步骤中，攻击者可以指定自定义文件名、命令或选择直接上传一个反弹Shell。脚本中定义的sendRevshell函数利用了PHP的fsockopen和proc_open函数来建立双向通信，这是一个非常成熟且经典的PHP反弹Shell实现方式。该POC成功利用的关键在于目标服务器没有对上传到bigupload目录的文件进行权限校验。经过代码审计，该脚本没有使用混淆手段，其核心行为（文件上传和触发）逻辑闭环，能够直接导致目标服务器被接管。利用步骤：1. 准备攻击环境，安装Python requests库；2. 确定目标Chamilo LMS的URL地址；3. 使用命令行参数指定攻击模式，例如使用 -r 参数启动反弹Shell模式；4. 运行脚本，脚本会先将恶意PHP payload上传至服务器的指定路径；5. 脚本自动发送HTTP请求触发该PHP文件，从而在攻击者监听的IP和端口上获得系统权限。投毒风险分析：该POC项目展现出较低的投毒风险，整体评分约为15%。首先，代码逻辑完全透明，使用的都是Python的标准库（requests, argparse, io），没有引入任何第三方可疑的二进制包或加密的远程下载指令。代码中虽然包含了一个PHP反弹Shell字符串，但这属于安全研究中POC功能的必要组成部分，用于验证RCE漏洞的威力，而非针对研究者本机的恶意后门。分析poc.py脚本发现，它并没有尝试获取执行脚本者本机的环境变量、SSH密钥或浏览器Cookies，也没有发现任何向非目标域名发送心跳包的行为。唯一的潜在风险点在于用户如果从非官方或不可信的第三方仓库下载此类POC，可能会被植入额外的隐藏payload。在本代码示例中，开发者还特别标注了来源参考，体现了较高的透明度。代码中包含的PHP代码段虽然具有攻击性，但其攻击目标明确指向用户输入的target URL，不存在针对研究者环境的反向控制逻辑。因此，对于防御性安全研究员来说，该脚本在受控环境下是相对安全的，但仍建议在隔离的沙箱或虚拟机中运行任何从公开渠道获取的漏洞利用工具，以防止针对研究人员的供应链攻击。

**项目地址:** [https://starlabs.sg/advisories/23/23-4220/](https://starlabs.sg/advisories/23/23-4220/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
