## CVE-2023-42793 - JetBrains TeamCity RCE/身份认证绕过

**漏洞编号:** CVE-2023-42793

**漏洞类型:** RCE/身份认证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 2023.05.3 之前的所有版本

**利用条件:** 无需认证，仅需网络可达目标服务器的HTTP/HTTPS端口

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：本漏洞属于严重的身份认证绕过漏洞。CVE-2023-42793 存在于 JetBrains TeamCity 的 REST API 模块中。漏洞的根本原因在于某些 REST API 端点在处理请求时未能正确实施访问控制逻辑，允许未经身份验证的攻击者访问敏感的内部接口。提供的 NSE (Nmap Scripting Engine) 脚本针对的是该漏洞的一个核心利用路径，即访问 '/app/rest/users/id:1/tokens/RPC2'。如果服务器存在漏洞，该脚本可以通过向该路径发送 POST 请求，在无需提供任何凭证的情况下，为 ID 为 1 的管理员账户（通常是初始安装时的超级管理员）生成一个身份验证令牌（Token）。POC 代码逻辑清晰，直接利用 http.post 发起请求并尝试捕获返回体中的 token 字符串。该脚本的有效性极高，能够直接证明漏洞的存在，并且一旦成功获取 Token，攻击者即可通过 TeamCity 的 REST API 执行任意管理操作，包括但不限于修改配置、泄露源码、部署恶意代码或直接在构建服务器上执行 shell 命令。利用步骤：1. 确认目标 TeamCity 服务器的运行端口，默认为 8111。2. 使用 Nmap 加载该 NSE 脚本：`nmap -p 8111 --script teamcity-admin-creation --script-args url=http://<target>`。3. 脚本会自动构造针对敏感 API 端点的 POST 请求。4. 如果返回状态码为 200 并包含 Token，则说明漏洞利用成功，攻击者可持有该 Token 进一步接管控制台。投毒风险分析：该 POC 代码基于标准的 Nmap Lua 环境编写，代码结构简洁透明。经过静态分析，代码中使用的库均为 Nmap 的官方标准库，如 'http', 'stdnse', 'json' 等。代码逻辑中不存在任何混淆处理，也没有尝试连接除用户指定目标以外的第三方恶意 IP 或域名。脚本的功能仅限于请求 Token 并将其打印在控制台上，不包含任何自我复制、删除系统文件或建立反弹 Shell 的隐藏逻辑。由于该脚本是作为安全审计工具编写的，其行为特征（如 User-Agent 可能是 Nmap 默认值）可能被 WAF 拦截，但对于使用者本身没有安全隐患。尽管如此，在实际防御研究中，仍需注意此类脚本可能被集成到恶意的自动扫描框架中。从投毒角度评估，该 POC 本身是安全的。考虑到该漏洞曾被俄罗斯 SVR (APT 29) 等高级威胁组织在野利用，防御者应高度警惕任何尝试访问 /app/rest/ 路径的非授权流量。本 POC 是一个典型的、低风险的合规安全检测工具，不具备投毒特征。

**项目地址:** [https://github.com/becrevex](https://github.com/becrevex)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)
