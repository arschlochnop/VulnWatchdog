## CVE-2023-26482 - Nextcloud Server Missing Scope Validation, RCE

**漏洞编号:** CVE-2023-26482

**漏洞类型:** Missing Scope Validation, RCE

**影响应用:** Nextcloud Server

**危害等级:** 高危

**CVSS评分:** 未提供

**影响版本:** Specific vulnerable versions are not provided in the input, but it targets a publicly disclosed and patched vulnerability. Users should update Nextcloud Server and the 'Workflow Script' app to their latest versions.

**利用条件:** 需要认证，且需要安装'Workflow Script'应用

**POC 可用性:** 10/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0%

## 详情

该POC针对CVE-2023-26482，一个存在于Nextcloud Server中的"Missing Scope Validation"漏洞。此漏洞允许经过身份验证的用户创建恶意的全局工作流规则，从而在安装了"Workflow Script"应用程序的环境中实现远程代码执行（RCE）。POC提供了一个完整的Docker Compose环境，用于模拟易受攻击的Nextcloud实例，包括Nextcloud服务、一个数据库和必要的配置。`setup.sh`脚本自动化了Nextcloud实例的初始化，安装了易受攻击的`workflow_script`应用，并创建了一个用于测试的非管理员用户`attacker`。`exploit.py`脚本作为核心利用代码，它能够以非管理员身份登录，然后越权创建一个全局/管理员级别的工作流规则。这个恶意工作流被配置为在上传MIME类型为`text/plain`的文件时执行预定义的命令。POC演示的命令是`touch /tmp/pwned`，这是一个无害的验证命令。通过上传一个简单的文本文件，POC成功触发了容器内的命令执行，并通过`docker-compose exec app ls -l /tmp/pwned`验证了文件`pwned`的存在。整个流程文档齐全，提供了详细的设置、利用和验证步骤，并附有清晰的截图。其模块化的设计（Docker环境、Python脚本）使得复现非常容易，且具有高度的可靠性。该POC明确声明为教育和研究目的，并强调应在隔离环境中部署，未经授权不得用于攻击，显示了其合法的安全研究性质。通过对提供的`README.md`内容的分析，该POC被认为是一个高质量、功能完整的利用示例，能够可靠地重现CVE-2023-26482漏洞及其RCE影响。

利用步骤：
1. 环境启动: 使用`docker-compose up -d`启动包含Nextcloud的Docker环境。
2. 实例配置: 运行`bash setup.sh`脚本，自动安装`workflow_script`应用并创建测试用户。
3. 依赖安装: 使用`pip install -r requirements.txt`安装Python依赖。
4. 执行利用: 运行`python exploit.py`脚本，该脚本将以`attacker`用户身份登录，并创建越权的全局工作流规则，当上传`text/plain`文件时执行`touch /tmp/pwned`命令。
5. 触发RCE: 登录到`http://localhost:8080`，使用`attacker`用户的凭据上传一个文本文件（如`test.txt`）。
6. 验证: 通过`docker-compose exec app ls -l /tmp/pwned`命令检查`/tmp/pwned`文件是否存在于Nextcloud容器中，以确认RCE成功。

投毒风险分析：
该POC代码的投毒风险评估为**低（0%）**。首先，项目的`README.md`文件中包含明确的声明，指出这是一个用于教育和研究目的的公开漏洞复现环境，旨在演示漏洞分析、利用流程和缓解策略。它明确警告用户只能在隔离测试环境中使用，并严禁未经授权的利用。这种透明且负责任的披露态度大大降低了恶意目的的可能性。其次，POC中用于演示远程代码执行的有效载荷是`touch /tmp/pwned`。这是一个典型的、无害的验证命令，其唯一作用是在目标文件系统中创建一个空文件，以证明命令执行成功。它不包含任何删除数据、窃取信息、建立后门、下载恶意软件或进行其他破坏性行为的指令。在代码层面，`exploit.py`脚本主要依赖Python的`requests`库进行HTTP通信，以及标准库进行日志记录和流程控制。没有迹象表明使用了混淆技术、加密字符串、动态加载外部代码、执行`eval()`或`exec()`等危险函数来隐藏恶意行为，也没有尝试与可疑的C2服务器进行通信或进行任何异常的网络活动。整个POC环境通过`docker-compose`定义，其服务配置清晰可见，易于审查。`setup.sh`脚本也仅执行Nextcloud的初始化和应用安装操作，不涉及任何隐藏的恶意逻辑。基于上述分析，该POC的作者显然遵循了负责任的披露原则，旨在提供一个安全、可控的环境供研究人员学习。因此，本团队认为该POC代码不包含任何蓄意投毒或恶意行为。用户在下载和使用该POC时，应始终审查其内容并确保其来源可靠，但就本POC而言，其本身不构成投毒风险。

**项目地址:** 未提供

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2023-26482
