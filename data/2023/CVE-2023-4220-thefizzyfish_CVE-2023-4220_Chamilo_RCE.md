## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= v1.11.24

**利用条件:** 无需身份验证，可直接通过HTTP协议访问目标服务。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC针对Chamilo LMS中`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`组件存在的不受限文件上传漏洞。代码逻辑非常清晰且具有高度可执行性。首先，它定义了两个关键路径：`upload_url`用于利用`post-unsupported`动作上传恶意PHP文件，`exploit_url`用于访问并执行上传的文件。在脚本执行过程中，它通过`requests.post`向目标服务器发送一个多部分表单请求，其中包含一个名为`exploit.php`的Webshell。此Webshell使用了典型的PHP `system()`函数来接收外部命令。上传成功后，脚本通过一个简单的GET请求触发该Webshell，并传递经过URL编码的Bash反弹Shell指令。整个流程符合漏洞利用的闭环逻辑，代码中没有复杂的依赖项，仅使用了标准的Python `requests`和`argparse`库，验证了该漏洞在未经身份验证的情况下即可实现完全的系统控制。利用步骤：1. 准备环境，确保本地监听端口（如使用nc -lvnp 4444）。2. 运行POC脚本，提供目标URL（-H）、本地IP（-l）和监听端口（-p）。3. 脚本会自动构造POST请求，利用bigUpload.php的逻辑缺陷将`exploit.php`上传至服务器。4. 脚本确认上传成功后（状态码200），会自动构造GET请求访问`/main/inc/lib/javascript/bigupload/files/exploit.php`。5. 服务器解析PHP并执行Bash反弹Shell命令，攻击者在监听端获得系统权限。投毒风险分析：经过对提供的Python源代码进行深入审查，该POC表现出极低的投毒风险。代码结构透明，所有变量命名（如`target_host`, `lhost`, `lport`）均符合其功能逻辑，没有发现任何形式的代码混淆或Base64加密的恶意Payload。在网络请求方面，脚本仅与用户指定的`target_host`进行通信，不存在任何后台连接到第三方C2（控制服务器）或向外部发送敏感信息的行为。代码中包含的反弹Shell指令`bash -i >& /dev/tcp/...`是标准的渗透测试行为，其目标地址完全受用户命令行参数控制，不具备隐蔽攻击性。脚本没有尝试在本地执行任何系统级敏感操作，如修改注册表、读取本地密码文件或安装持久化后门。唯一潜在的风险点在于用户需确保输入的目标地址准确，避免对非授权目标造成误伤。综上所述，该POC是一个纯粹的、用于防御性安全研究和漏洞验证的工具，安全性良好。

**项目地址:** [https://github.com/Creastery/CVE-2023-4220](https://www.google.com/search?q=https://github.com/Creastery/CVE-2023-4220)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
