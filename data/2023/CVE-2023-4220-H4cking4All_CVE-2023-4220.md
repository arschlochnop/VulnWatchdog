## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 1.11.24

**利用条件:** 无需身份验证，目标系统开启了BigUpload功能且对应的存储目录具备写权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于Chamilo LMS的`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`组件中。由于系统未对上传文件的扩展名进行严格过滤，攻击者可以通过向`action=post-unsupported`参数发送POST请求，绕过逻辑限制上传任意PHP文件。提供的POC代码结构清晰，利用`requests`库实现了漏洞检测(checkvuln)和漏洞利用(exploit)两种模式。在检测模式下，它通过访问`/main/inc/lib/javascript/bigupload/files`目录的状态码来判断目标是否存在漏洞；在利用模式下，它构造了一个包含`<?php echo system($_GET['cmd']); ?>`的Webshell，并通过POST多部分表单数据将其写入服务器。该POC具有极高的实战价值，其成功率依赖于目标系统是否手动创建了存放上传文件的`files`目录，因为该目录在默认安装中可能不存在，但可通过其他目录遍历漏洞配合生成。利用步骤：1. 使用checkvuln模式扫描目标URL确认漏洞路径可访问。2. 运行exploit模式，指定目标URL。3. 在脚本提示处输入Webshell的文件名。4. 脚本将PHP代码封装在files参数中发出POST请求。5. 攻击者随后通过访问生成的PHP路径并配合CMD参数实现远程指令执行。投毒风险分析：经过对提供的Python源代码进行审查，该脚本主要依赖于标准的`argparse`、`requests`、`sys`以及`pwn`库中的日志组件。代码逻辑透明，所有网络交互均指向用户定义的目标URL，未发现任何试图将受害者数据发送至第三方服务器的混淆代码或隐藏的Socket连接。脚本中的`proxy`变量默认指向本地8080端口，这通常是安全研究员使用Burp Suite进行流量抓取时的习惯配置，不属于恶意行为。尽管项目在README中引导用户从GitHub克隆并安装requirements.txt，这在自动化环境中可能存在依赖包替换风险，但就目前POC主体代码而言，其行为符合合法的安全研究范畴。潜在风险点仅在于其使用的`pwn`库在复杂脚本中可能被用于构造复杂的payload，但在本例中仅用于格式化日志输出。总体而言，该POC是一个典型的防御性研究工具，未见明显的后门注入或恶意指令。建议在使用时依然保持在沙箱环境运行，并检查依赖项的安全性，以规避供应链攻击风险。

**项目地址:** [https://github.com/H4cking4All/CVE-2023-4220.git](https://github.com/H4cking4All/CVE-2023-4220.git)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
