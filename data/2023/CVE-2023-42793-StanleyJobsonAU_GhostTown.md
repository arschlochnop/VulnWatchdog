## CVE-2023-42793 - JetBrains TeamCity RCE (远程代码执行)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** RCE (远程代码执行)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** TeamCity 2023.05.4 之前的版本

**利用条件:** 无需认证，具有网络访问权限即可利用

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2023-42793 是一个位于 JetBrains TeamCity 持续集成/持续部署 (CI/CD) 服务中的关键漏洞，允许未经身份验证的远程攻击者在目标服务器上执行任意代码。该漏洞的核心在于权限绕过，攻击者可以通过特定的 API 端点直接访问敏感功能。在本 POC（GhostTown.py）的有效性分析中，代码清晰地展示了利用路径：首先，它通过访问 `/app/rest/users/id:1/tokens/RPC2` 端点来为管理员用户（ID 1）生成一个新的访问令牌。这一步是整个利用的核心，因为它利用了 TeamCity 在处理特定 REST API 请求时的鉴权缺陷。一旦获得该令牌，攻击者便拥有了管理员权限，可以进一步通过 `/app/rest/debug/processes` 或类似的调试端点上传并执行恶意的 shell 脚本或命令。POC 代码结构完整，包含参数解析、Banner 打印、令牌生成以及后续的 Payload 投递逻辑。利用步骤如下：1. 确认目标 TeamCity 版本是否低于 2023.05.4；2. 运行 Python 脚本，指定目标 URL 以及用于接收反弹 shell 的回调 IP 和端口；3. 脚本首先尝试通过未授权访问 API 生成管理员 Token；4. 成功获取 Token 后，脚本利用该身份通过调试接口执行系统命令，从而实现反向 Shell 连接。此漏洞的威力在于其位于 CI/CD 流程的中心，一旦攻破，攻击者可能获取源代码、凭据以及对生产环境的访问权限。投毒风险分析如下：该 Python 脚本主要使用了 Python 标准库，如 `sys`、`requests` 和 `xml.etree.ElementTree`。代码逻辑直观，变量命名具有语义化，没有发现明显的代码混淆或加密手段。在代码审查过程中，主要关注其网络通信部分。脚本的通信对象仅限于用户指定的 `Target URL` 和 `Callback IP`。并未发现向第三方未知域名发送敏感数据（如环境变量、系统密码文件）的行为。唯一需要警惕的是，由于脚本涉及敏感的 RCE 操作，如果用户在未完全阅读代码的情况下运行，可能会误触生产环境。然而，从‘恶意投毒’的角度来看，该 POC 表现为典型的、纯粹的安全研究工具，没有内置隐藏的后门逻辑。15% 的投毒风险评分主要基于此类自动化渗透工具在分发过程中可能被二次篡改的潜在风险，而非此特定代码片段本身包含恶意载荷。整体而言，该代码对于防御性研究和漏洞验证是相对安全的，但必须在受控的实验室环境中使用。

**项目地址:** [https://github.com/vulnwatchdog/GhostTown](https://www.google.com/search?q=https://github.com/vulnwatchdog/GhostTown)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
