## CVE-2023-4220 - Chamilo LMS 任意文件上传 (Unrestricted File Upload)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 任意文件上传 (Unrestricted File Upload)

**影响应用:** Chamilo LMS

**危害等级:** 高危 (High)

**CVSS评分:** 8.1 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N)

**影响版本:** Chamilo LMS <= 1.11.24

**利用条件:** 无需身份验证，可直接通过网络访问受影响的 bigUpload.php 接口

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC针对 Chamilo LMS 的主程序组件中存在的一个不安全文件上传漏洞。具体漏洞点位于 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php`。在受影响的版本中，该脚本由于缺乏对上传请求的身份验证以及对上传文件类型的严格过滤，允许未经身份验证的远程攻击者通过构造特定的 POST 请求上传任意文件。POC代码通过 Python 的 requests 库实现了自动化利用过程。它向目标 URL 的 `action=post-unsupported` 动作发送一个包含恶意文件（如 WebShell）的 multipart/form-data 请求。由于程序逻辑错误，服务器会将上传的文件保存在可公开访问的 web 目录下（通常是 /main/default_course_document/temp/ 目录）。一旦上传成功，攻击者即可通过浏览器或脚本访问该文件，从而在服务器上执行任意代码。从代码结构来看，该 POC 功能完整，逻辑清晰，能够直接在测试环境中使用，属于高质量的漏洞利用脚本。【利用步骤】1. 准备一个恶意的 PHP WebShell 文件。2. 确认目标 Chamilo LMS 的 URL 地址。3. 使用 Python 环境运行 POC 脚本，命令格式为：`python3 exploit.py -u 'http://target/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported' -f webshell.php`。4. 脚本执行后会输出上传状态，若返回 200 且显示成功，则攻击者可以尝试访问上传后的文件路径以获取服务器控制权。【投毒风险分析】经过对提供的 `exploit.py` 代码进行静态分析，未发现明显恶意投毒行为。代码主要依赖于 Python 标准库 `sys`, `argparse`, `signal` 以及常用的第三方库 `requests` 和 `pyfiglet`。代码逻辑纯粹，完全围绕文件上传功能的实现展开，没有发现任何尝试下载远程恶意二进制文件、修改本地系统 host 文件、窃取环境变量或执行混淆 shellcode 的可疑操作。虽然 `pyfiglet` 被用于展示 Banner 增加视觉效果，但这在合法的渗透测试脚本中非常常见。该脚本的风险点极低，主要的‘投毒’可能点在于用户从非官方渠道下载该 POC 时，恶意第三方可能会在代码中插入类似 `os.system` 的反弹 shell 命令。但就当前提供的代码样本而言，其代码可读性高，逻辑透明，属于安全的漏洞验证工具。建议用户在使用前务必核对 requests 等库的引用是否被替换，并确保运行环境隔离。

**项目地址:** 本地分析提取

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
