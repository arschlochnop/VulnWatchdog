## CVE-2023-50564 - Pluck CMS 未授权文件上传/RCE

**漏洞编号:** CVE-2023-50564

**漏洞类型:** 未授权文件上传/RCE

**影响应用:** Pluck CMS

**危害等级:** 高危

**CVSS评分:** 未提供

**影响版本:** 4.7.18

**利用条件:** 需要认证, 需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

针对CVE-2023-50564的PoC代码及其相关信息显示，此漏洞影响Pluck CMS 4.7.18版本，其核心是未授权文件上传，最终可导致远程代码执行（RCE）。该漏洞的利用点在于Pluck CMS的模块安装功能，攻击者可以通过上传一个包含PHP shell的ZIP文件来绕过安全检查，并在服务器上执行任意代码。

**POC有效性分析：**
该PoC由`README.md`和`poc.py`脚本组成，表现出高度的有效性和功能性。`poc.py`是一个用Python 3编写的脚本，利用标准`requests`和`requests_toolbelt`库进行HTTP通信和multipart表单数据编码，实现了完整的漏洞利用流程。攻击流程分为两个明确的阶段：首先，脚本模拟用户登录到Pluck CMS的管理面板，获取有效的会话；其次，利用认证后的权限，通过模块安装功能上传预先构造好的`payload.zip`文件。`README.md`提供了详尽的说明，包括环境准备（Python依赖安装）、代码库克隆、PoC脚本配置（目标主机、用户名、密码）以及最关键的恶意载荷（PHP reverse shell）的制作方法。脚本的逻辑严谨，正确处理了会话管理和文件上传请求的构建，符合典型的Web漏洞利用模式。`README.md`中提供的输出示例进一步验证了PoC的预期行为，成功登录和文件上传后，即可看到PHP shell的执行结果。该PoC的模块化设计允许用户自定义`shell.php`载荷，增加了其在不同RCE场景下的灵活性。鉴于脚本的完整性、说明的清晰度以及远程代码执行的直接演示，此PoC被评估为高度有效。

**利用步骤：**
1.  **环境准备：** 确保系统已安装Python 3.x，并使用`pip install requests requests_toolbelt`安装必要的Python库。
2.  **克隆代码库：** 执行`git clone https://github.com/Rai2en/CVE-2023-50564_Pluck-v4.7.18_PoC.git`命令，并将目录切换到`CVE-2023-50564_Pluck-v4.7.18_PoC`。
3.  **配置PoC脚本：** 编辑`poc.py`文件，将`hostname`变量替换为目标Pluck CMS实例的IP地址或域名。同时，填入有效的管理面板`username`和`password`，因为漏洞利用需要先进行身份认证。
4.  **创建恶意载荷：** 创建一个名为`payload.zip`的压缩文件。此ZIP文件必须包含一个PHP shell文件（例如`shell.php`）。建议使用[pentestmonkey的PHP reverse shell](https://github.com/pentestmonkey/php-reverse-shell)并根据实际需求修改其中的`<your_ip>`和`<port>`字段，指向攻击者用于接收反向shell的监听IP地址和端口。
5.  **运行PoC：** 在命令行中执行`python exploit.py`。脚本会提示输入ZIP文件路径，例如输入`./path/to/payload.zip`。
6.  **接收反向Shell：** 如果登录和文件上传成功，Pluck CMS在处理模块安装时会解压并执行`shell.php`。此时，攻击者在之前设置的监听器（例如使用`nc -lvnp <port>`）将接收到来自目标服务器的反向shell连接，从而获得远程命令执行权限。

**投毒风险分析：**
在对提供的CVE-2023-50564 PoC 代码进行投毒风险分析时，我们主要关注 PoC 脚本本身是否存在恶意行为，而非其预期利用效果（即上传反向 shell）。一个安全的 PoC 脚本应仅包含必要的漏洞利用逻辑，而不附加任何额外的恶意功能。

该 PoC 脚本 `poc.py` 采用 Python 编写，结构清晰，逻辑透明，具备良好的可读性。它主要依赖 `requests` 和 `requests_toolbelt` 这两个广泛使用的标准 Python 库，用于执行 HTTP 请求和处理 multipart 表单数据。这些库是 Python 生态系统中成熟且受信赖的组件，其本身不包含恶意功能。代码中没有发现任何形式的代码混淆技术，所有功能都一目了然，这大大降低了恶意代码被隐藏的可能性。脚本的核心任务是模拟用户登录 Pluck CMS 系统的管理面板，并通过伪造的 multipart/form-data 请求上传一个用户指定的 ZIP 文件到 `/admin.php?action=installmodule` 路径。

具体来说，对 `poc.py` 进行静态分析，它不包含以下典型的高风险特征：
*   **外部恶意连接：** 脚本没有硬编码连接到除用户指定的目标主机 (`hostname`) 之外的任何外部恶意服务器（例如，攻击者的 C2 服务器、恶意更新源等）。它不会尝试下载或执行来自未知源的额外代码，从而避免了“供应链攻击”的常见向量。所有的网络通信都指向用户明确配置的目标系统。
*   **代码混淆或加密：** 脚本代码完全以明文形式提供，可供任何人阅读、理解和审计。没有使用 base64 编码、异或加密、打包工具或其他任何形式的混淆手段来隐藏其真实意图或关键逻辑，这使得识别潜在恶意行为变得非常容易。
*   **利用系统命令或危险函数：** 脚本主要使用 Python 的标准库功能进行网络通信和本地文件读取操作。它没有直接调用可能导致意外系统破坏或未经授权操作的危险系统命令（如 `os.system`、`subprocess.run` 执行外部shell命令）。此外，脚本不包含 `eval()` 或 `exec()` 等动态代码执行函数来处理来自外部或不可信源的数据，从而避免了潜在的命令注入风险或意外执行恶意载荷。
*   **后门植入或信息窃取：** 脚本本身不具备植入后门、窃取本地操作系统敏感信息（如配置文件、密码哈希）、进行加密货币挖矿、DDoS 攻击或任何其他超出漏洞利用本身范畴的恶意功能。它不收集用户的任何敏感数据，也不会将其发送到任何远程服务器。
*   **依赖恶意第三方库：** 除了 `requests` 和 `requests_toolbelt` 之外，脚本没有引入其他不常见的或可疑的第三方库。

需要明确区分的是，PoC 脚本的最终目的是促使目标系统执行一个恶意的 PHP 文件（由用户创建的 `shell.php`）。这个 `shell.php` 承载了反向 shell 等实际恶意功能，但它是由攻击者自行准备并作为载荷上传的，并非 PoC 脚本本身固有的恶意部分。PoC 脚本仅作为这个恶意载荷的“投递工具”。因此，`shell.php` 的恶意性不应被错误地归咎于 PoC 脚本本身的投毒行为。

鉴于以上深入分析，该 PoC 脚本的投毒风险被评估为 **低风险 (10%)**。这个低风险分数主要反映了任何从外部来源获取并运行的代码都存在的固有风险，即代码可能在未经仔细审查的情况下被修改或注入恶意功能，即使是看起来无害的脚本也可能被篡改。然而，就目前提供的 `poc.py` 代码而言，它是一个非常干净、专注于其既定漏洞利用目的的工具，没有表现出任何额外的恶意负载或投毒意图。用户在将其部署到生产环境或安全敏感场景之前，仍然强烈建议对代码进行独立的全面安全审计。

**项目地址:** https://github.com/Rai2en/CVE-2023-50564_Pluck-v4.7.18_PoC

**漏洞详情:** 
