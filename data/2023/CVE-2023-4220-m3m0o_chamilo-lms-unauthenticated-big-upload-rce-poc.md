## CVE-2023-4220 - Chamilo LMS RCE (远程代码执行)

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Chamilo LMS

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** < 1.11.24

**利用条件:** 无需认证，可通过网络直接访问受影响的 bigupload 组件

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对Chamilo LMS中/main/inc/lib/javascript/bigupload/inc/bigUpload.php接口的文件上传漏洞进行了高度集成的实现。分析显示，该漏洞源于bigupload组件未能对上传文件的存储路径和执行权限进行严格校验。POC包含三个核心模块：扫描（Scan）、Webshell植入和反弹Shell（Revshell）。扫描模块通过探测/main/inc/lib/javascript/bigupload/files/路径是否存在来确认漏洞环境，具有极高的准确性。Webshell模块则利用不安全的文件上传功能，将PHP脚本直接推送到服务器可访问目录，实现持久化控制。反弹Shell模块更进一步，通过Base64编码绕过简单的WAF检测，并利用PHP执行系统命令建立反向连接。整个利用链条逻辑完整，代码采用Python requests库编写，且附带了详细的使用说明和演示截图，在标准安装的Chamilo 1.11.x版本中具有极高的利用成功率。利用步骤：1. 确认目标环境版本低于1.11.24。2. 使用-a scan参数运行脚本，确认目标组件路径可访问且存在漏洞。3. 执行-a webshell命令，脚本将上传一个PHP小马至目标服务器，成功后会返回Webshell的URL。4. 若需进一步控制，配置本地监听端口，执行-a revshell命令，脚本将自动触发反弹连接。投毒风险分析：经过对提供的Python源代码初步审计，该项目目前表现为典型的开源安全研究工具。代码主要依赖requests和typing标准组件，未发现明显的代码混淆、二进制Payload注入或向第三方域名发送敏感数据的行为。代码逻辑清晰，函数命名规范，不存在恶意删除本地文件或执行非法Shellcode的隐含指令。然而，风险点在于该POC高度自动化且威力巨大，极易被集成到非法攻击框架中。脚本中虽包含合法研究声明，但其提供的Revshell功能在非受控环境下具有极强的破坏性。此外，README提到的后续更新Windows Payload可能引入新的不透明Payload。对于防御者而言，使用此POC时应重点检查其依赖项requirements.txt，防止在安装阶段遭遇Pip投毒，同时建议在隔离的沙箱环境内运行，并监控其网络流量，防止该脚本被植入针对研究者本身的Side-channel攻击指令。

**项目地址:** [https://github.com/m3m0o/chamilo-lms-unauthenticated-big-upload-rce-poc](https://github.com/m3m0o/chamilo-lms-unauthenticated-big-upload-rce-poc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)
