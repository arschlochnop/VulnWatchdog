## CVE-2023-27372 - SPIP RCE (反序列化)

**漏洞编号:** CVE-2023-27372

**漏洞类型:** RCE (反序列化)

**影响应用:** SPIP

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** SPIP < 4.2.1 (具体包括 3.2.18, 4.0.10 之前的版本)

**利用条件:** 无需身份验证，可通过公共区域的表单访问

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞源于SPIP内容管理系统在处理公共区域（如密码重置页面 spip.php?page=spip_pass）的表单值时，对序列化数据的处理不当。核心缺陷位于 /ecrire/balise/formulaire_.php 的 protege_champ 函数中。该函数使用正则表达式 `,^[abis]:\d+[:;],` 来检查字符串是否为序列化数据，并尝试调用 unserialize()。然而，该正则校验极易被绕过，且未对反序列化内容进行安全过滤，导致攻击者可以构造恶意序列化对象来实现远程代码执行（RCE）。提供的POC代码完整展示了这一过程：首先通过 GET 请求访问密码重置页面以获取必要的 CSRF 令牌（formulaire_action_args），随后构造包含恶意 payload 的 POST 请求。Payload 利用了 #ENV 标签的解析特性，将 phpinfo() 或系统命令封装在序列化字符串中发送至服务器。经分析，该 POC 逻辑清晰，利用路径明确，在受影响的 SPIP 环境中具有极高的成功率。利用步骤：1. 识别目标网站是否运行受影响版本的 SPIP；2. 访问 spip.php?page=spip_pass 获取页面中的 CSRF 保护参数；3. 构造 POST 请求，将恶意序列化字符串注入到 oubli 参数中；4. 提交请求并观察服务器响应，若成功执行，服务器将返回命令执行结果。投毒风险分析：该 POC 代码基于 Python 开发，使用了 requests, bs4, lxml 等标准安全分析库。代码逻辑结构透明，包含参数解析、令牌提取和 Payload 发送三个标准模块，未发现明显的代码混淆或隐藏的网络回连行为。README 中提供的修复建议和代码补丁进一步证明了其防御性研究的初衷。虽然 POC 中提到了作者的 Twitter 链接（redboltsec），但这属于常规的社区署名。唯一的潜在风险在于此类漏洞的利用门槛极低，一旦 POC 扩散，容易被自动化攻击工具集成。代码本身不含恶意后门，但用户在使用时应在隔离测试环境中运行，避免在未授权的生产系统上操作。整体来看，该脚本是一个标准的安全研究工具，投毒风险评定为低（15%），风险主要来自于工具被滥用而非脚本本身包含恶意代码。

**项目地址:** [https://twitter.com/redboltsec](https://twitter.com/redboltsec)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)
