## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** JetBrains TeamCity

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2023.05.3 之前的版本

**利用条件:** 远程网络访问，无需预先认证

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC脚本详细展示了CVE-2023-42793漏洞的完整利用链路。该漏洞根源于TeamCity REST API路径处理中的逻辑缺陷，允许攻击者通过特定构造的URL绕过常规的身份验证检查。脚本首先尝试删除名为'RPC2'的特定用户令牌（/app/rest/users/id:1/tokens/RPC2），即便该令牌不存在（返回404），利用程序也会继续通过POST请求触发该路径来为管理员账号（ID: 1）强制生成一个新的有效API令牌。一旦获取该令牌，脚本即可代表系统管理员权限执行后续操作。在获取Token后，POC进一步演示了如何利用该权限创建一个具有SYSTEM_ADMIN角色的新用户（*secops[随机数]），并将密码设为'changeme'。通过这种方式，攻击者可以获得Web控制台的完全管理访问权限。该POC代码逻辑清晰，使用了标准的requests库和xml解析库，没有使用混淆技术，能够有效验证目标服务器是否存在此高危绕过风险。在实际防御研究中，该POC可用于验证补丁部署情况，但需注意在测试后清理生成的测试账号。利用步骤：1. 攻击者向目标TeamCity服务器发送DELETE请求到/app/rest/users/id:1/tokens/RPC2，利用身份验证绕过漏洞定位管理接口。2. 发送POST请求到相同路径，利用漏洞绕过认证并获取管理员生成的API Token。3. 解析响应中的XML数据提取Token字符串。4. 使用提取的Token构造Authorization Header，调用/app/rest/users接口创建一个新的全局管理员账户。5. 使用新创建的凭据登录TeamCity控制台，实现RCE或获取敏感CI/CD配置。投毒风险分析：经过对提供的POC代码进行静态审计，未发现明显的恶意投毒行为。代码库引用均为Python标准库（random, argparse, xml.etree.ElementTree）以及合法的第三方库（requests）。代码逻辑完全围绕CVE-2023-42793的漏洞特征展开，包括令牌生成、XML解析和用户创建，不包含任何外部Shell反弹、加密货币挖矿、文件系统擦除或凭据窃取（窃取至第三方服务器）的恶意代码。虽然脚本会自动创建管理员账户，但这是典型的漏洞利用验证逻辑，而非投毒。脚本中的User-Agent包含'Assetnote/1.0.0'，通常用于合法的安全研究和资产扫描。代码没有经过Base64加密、混淆或隐藏在__init*_.py中的非法加载。风险评分处于极低水平（5%），该5%主要源于脚本会自动在受害者系统中留下名为'_secops'的持久化账号，如果不及时清理可能被其他攻击者利用。总体而言，该脚本是一个纯粹的安全研究工具，没有投毒风险。

**项目地址:** [https://github.com/AssetNote/CVE-2023-42793](https://www.google.com/search?q=https://github.com/AssetNote/CVE-2023-42793)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2023-42793](https://nvd.nist.gov/vuln/detail/cve-2023-42793)
