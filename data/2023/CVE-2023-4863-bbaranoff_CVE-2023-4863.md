## CVE-2023-4863 - Google Chrome / libwebp 堆缓冲区溢出

**漏洞编号:** CVE-2023-4863

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Google Chrome / libwebp

**危害等级:** 高危

**CVSS评分:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)

**影响版本:** libwebp < 1.3.2, Google Chrome < 116.0.5845.187

**利用条件:** 用户需要打开恶意的WebP格式图片或访问包含该图片的网页

**POC 可用性:** 9/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞存在于libwebp库的无损压缩（Lossless）解码逻辑中。具体而言，由于Huffman编码表的构建逻辑中存在计算溢出，当解析特意构造的包含极大Huffman编码表的WebP文件时，会触发堆缓冲区溢出。输入的POC代码由@mistymtncop编写，基于Ben Hawkes的研究成果。POC代码展示了如何构造恶意的WebP头部（RIFF/VP8L）以及关键的Huffman编码长度信息。通过调用craft.c生成的bad.webp，可以稳定触发libwebp在处理Huffman码表分配时的溢出，这会导致内存损坏或代码执行。该POC通过C语言直接操作位流，代码逻辑清晰，引用的学术和技术背景资料详尽，证明了其在受影响版本（如libwebp 1.3.1及更早版本）上的高度有效性。在提供的测试步骤中，使用AddressSanitizer（ASan）编译的dwebp程序能够捕获到典型的Heap-buffer-overflow崩溃，验证了漏洞的触发机制。该漏洞属于在野利用漏洞（0-day），其破坏力在于WebP格式的广泛应用，几乎所有基于Chromium的浏览器、系统级图像查看器及使用libwebp的移动端App均受其害。【利用步骤】1. 获取源码并回滚至受影响的Commit ID（如7ba44f80）。2. 使用ASan工具链（makefile.unix）编译libwebp以方便观测溢出。3. 编译POC生成程序craft.c，该程序会根据设定的溢出逻辑生成一个名为bad.webp的触发样本。4. 运行编译出的dwebp解码工具，读取bad.webp，观察ASan报错或程序异常终止。【投毒风险分析】当前POC代码表现出较低的投毒风险。代码（craft.c）主要由标准的C库函数（stdio, malloc, string等）组成，其核心逻辑在于按照WebP格式规范（RIFF容器）手动拼接特定的位流数据。经过审计，代码中未发现任何网络外联行为（如反弹Shell、下载远端恶意脚本）、未见系统敏感文件读写（如/etc/shadow）、也未发现针对特定用户环境的混淆（Obfuscation）手段。代码中虽使用了'lol'等非正式注释，但并未包含shellcode或加密荷载。唯一的潜在风险在于，此类POC可能被二次封装到恶意的图像生成库中，作为攻击武器的一部分进行分发。但对于防御性研究人员而言，目前的源代码版本是安全的，可以作为复现漏洞和特征提取的参考。在组织防御时，重点应放在对二进制文件的哈希比对和对库文件的补丁升级上。

**项目地址:** [https://github.com/mistymntncop/CVE-2023-4863](https://github.com/mistymntncop/CVE-2023-4863)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-4863](https://nvd.nist.gov/vuln/detail/CVE-2023-4863)
