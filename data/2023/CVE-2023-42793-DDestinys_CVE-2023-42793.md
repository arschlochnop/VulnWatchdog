## CVE-2023-42793 - JetBrains TeamCity 认证绕过 / RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 认证绕过 / RCE

**影响应用:** JetBrains TeamCity

**危害等级:** 严重 (CRITICAL)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** TeamCity 2023.05.3 之前的所有版本

**利用条件:** 无需认证，远程网络可达

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】本POC脚本针对JetBrains TeamCity认证绕过漏洞（CVE-2023-42793）编写。该漏洞的核心在于JetBrains TeamCity的特定REST API端点存在逻辑缺陷，允许未经身份验证的攻击者通过构造特定的URL路径（如调用/app/rest/users/id:1/tokens等敏感路径）来绕过安全检查。通过分析提供的Python代码，该脚本实现了自动化的漏洞验证流程：首先利用Session对象禁用SSL验证以提高兼容性，随后通过特定的API调用尝试为管理员用户（通常是ID为1的用户）创建或删除Token（RPC2）。脚本中定义的`create_user_token`方法直接利用了漏洞点，试图获取持久化的访问权限。代码结构清晰，使用了Python的标准库和requests库，逻辑上符合CVE-2023-42793的利用原语，具备极高的实战参考价值和有效性。在防御性研究中，该POC可作为检测工具，通过观察是否能在未授权情况下成功响应Token创建请求来判定目标系统是否修补。利用步骤包括：1. 资产识别，通过扫描Banner特征（如JetBrains/TeamCity关键字）确认目标。2. 权限提升，构造POST请求至受影响的API端点，利用漏洞创建高权限API Token。3. 代码执行，利用获取的Token访问TeamCity的管理接口，执行调试任务或配置恶意构建脚本以实现远程代码执行。【投毒风险分析】在对此POC代码的安全性审查中，评估其投毒风险为低风险（约15%）。分析理由如下：首先，代码逻辑完全透明，主要依赖Python标准库（random, sys, os, threading）和第三方常用库requests，未发现引入任何混淆过的Base64字符串、未知的远程Shellcode下载行为或加密执行逻辑。其次，代码中的函数命名（如generate_username, create_user_token）与其功能完全对应，未见恶意隐藏逻辑。唯一需要关注的是其作为‘批量扫描工具’的属性，这种代码在分发过程中常被攻击者修改。典型的投毒手法通常会在脚本中加入后门，例如在执行扫描的同时，将成功利用的URL或敏感Token异步发送至攻击者的C2服务器。虽然当前提取的代码片段中未见此类恶意外联行为，但脚本中预留了`success_results`列表和文件保存逻辑，研究人员在实际使用时应务必检查脚本最后是否有未显示的requests.post或socket通信代码将结果回传。此外，由于此类漏洞已被APT29等组织在现实中大规模利用，获取此类POC的渠道稳定性至关重要，建议仅在受控环境下使用此脚本进行合规性扫描，并对网络流量进行侧向监控，防止脚本在扫描过程中执行非预期的外部链接请求。

**项目地址:** N/A (基于本地文件提取)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)
