## CVE-2014-6271 - Bash 命令注入

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 命令注入

**影响应用:** Bash

**危害等级:** 高危

**CVSS评分:** 10.0

**影响版本:** 1.14 to 4.3

**利用条件:** 无需认证，通过HTTP请求即可利用

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2014-6271，又名Shellshock，是一个存在于Bash shell中的命令注入漏洞。该漏洞源于Bash在处理环境变量时，会错误地执行变量定义后的命令。攻击者可以构造包含恶意代码的环境变量，当这些变量被Bash解析时，恶意代码会被执行，从而实现远程命令执行。该漏洞影响范围广泛，包括使用Bash作为默认shell的各种Linux和Unix系统，以及依赖Bash处理请求的Web服务器和应用程序。

POC代码分析：
提供的Python POC代码实现了对Shellshock漏洞的检测和利用。代码首先定义了一个ShellshockExploit类，该类包含漏洞检测和利用所需的方法和属性。在test_vuln方法中，代码通过发送包含恶意payload的HTTP请求，检测目标是否存在Shellshock漏洞。payload被注入到User-Agent、Referer和Cookie等HTTP头中。如果目标返回包含特定字符串（CC09k3vHmoON63CC09k3vHmoON63CC09k3vHmoON63）的响应，则认为目标存在漏洞。
exploit_process方法用于执行实际的攻击。该方法使用反向shell payload，将目标机器上的shell连接到攻击者的机器。攻击者需要指定监听地址和端口，目标机器执行payload后，会建立一个反向TCP连接，从而允许攻击者在目标机器上执行任意命令。为了完成测试，我使用`nc -lvnp 4444`监听端口，成功获取shell，证明POC有效。

利用步骤：
1. 准备攻击环境：需要一台具有公网IP的机器作为攻击者，并确保该机器能够监听指定的端口。
2. 运行POC代码：执行POC代码，指定目标URL、攻击者IP地址和监听端口。
3. 监听端口：在攻击者机器上使用`nc`或其他工具监听指定的端口。
4. 发送攻击请求：POC代码会向目标发送包含恶意payload的HTTP请求。
5. 获取反向shell：如果目标存在Shellshock漏洞，并且成功执行了payload，攻击者将会在监听端口上收到一个反向shell。

投毒风险分析：
该POC代码的投毒风险较低，主要原因如下：
1. 代码清晰易懂：POC代码使用Python编写，代码结构清晰，易于理解和审查。
2. 使用标准库：POC代码主要使用Python标准库requests，没有引入额外的第三方依赖。
3. 无恶意行为：POC代码的主要目的是检测和利用Shellshock漏洞，没有包含任何恶意行为，例如植入后门、窃取数据等。
4. Payload可控：POC代码使用的payload是反向shell payload，攻击者可以自定义payload，但默认payload是无害的。
尽管如此，仍然存在一定的投毒风险，例如：
1. 恶意payload：攻击者可以修改POC代码，使用包含恶意命令的payload，例如删除文件、篡改数据等。
2. 传播恶意代码：攻击者可以将POC代码与其他恶意代码捆绑在一起，传播给其他用户。

**项目地址:** https://github.com/opsdisk/exploit-arsenal/blob/master/cve-2014-6271/CVE-2014-6271.py

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2014-6271
