## CVE-2014-6271 - Bash 命令注入

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 命令注入

**影响应用:** Bash

**危害等级:** 高危

**CVSS评分:** 10.0

**影响版本:** All versions before patch

**利用条件:** 需要网络访问，通过CGI脚本传递恶意环境变量

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是一个存在于Bash shell中的严重漏洞，该漏洞允许攻击者通过将恶意代码附加到环境变量中来执行任意命令。该漏洞影响所有在漏洞修复之前发布的Bash版本。该漏洞的产生原因是Bash在解析环境变量时，允许在函数定义之后包含额外的命令，从而导致命令注入。此漏洞的PoC代码演示了如何利用Shellshock漏洞，设置一个包含恶意代码的环境变量，通过CGI脚本传递到Bash，从而在服务器上执行任意命令。 

**POC有效性分析：**
提供的Dockerfile和相关脚本构成了一个易于复现Shellshock漏洞的环境。Dockerfile使用`vulhub/bash:4.3.0-with-httpd`镜像，该镜像预配置了含有漏洞的Bash版本以及Apache HTTP服务器。`victim.cgi`脚本模拟了一个接受环境变量并使用Bash执行的环境，而`safe.cgi`脚本则作为一个对比，展示了安全的环境配置。通过构建并运行此Docker容器，攻击者可以发送特制的HTTP请求，其中包含恶意构造的环境变量，这些变量会被注入到Bash shell中执行，从而实现远程代码执行。PoC的有效性在于它提供了一个简单且可控的环境来验证漏洞的存在和影响。

**利用步骤：**
1.  使用`podman build -t shellshock-victim .`命令构建Docker镜像。
2.  使用`podman run -it -p 80:8080 shellshock-victim`命令运行Docker容器，将容器的8080端口映射到主机的80端口。
3.  构造一个包含恶意代码的HTTP请求头，例如：`GET /victim.cgi HTTP/1.1\r\nUser-Agent: () { :; }; echo vulnerable\r\nHost: localhost:8080\r\nConnection: close\r\n\r\n`。
4.  使用curl或类似的工具发送该HTTP请求到`http://localhost:8080/victim.cgi`。
5.  如果服务器返回"vulnerable"，则表明漏洞成功利用，任意命令已执行。

**投毒风险分析：**
此PoC的投毒风险较低。代码清晰，主要由Dockerfile和CGI脚本组成，没有明显的恶意行为或混淆。Dockerfile使用官方镜像，CGI脚本功能简单，主要用于演示漏洞利用。尽管利用本身会导致远程代码执行，但PoC代码本身没有包含任何后门或恶意payload。然而，需要注意的是，在实际利用中，攻击者可能会使用该漏洞来植入恶意软件或后门。因此，在部署或测试此类PoC时，应采取适当的安全措施，例如在隔离环境中运行，并监控网络流量和系统行为。由于Docker镜像来自可信源`vulhub/bash:4.3.0-with-httpd`，且脚本相对简单，未发现任何潜在的恶意代码或后门，PoC中使用的CGI脚本仅用于演示漏洞，不包含任何额外的恶意功能。因此，投毒风险较低，估计为10%。

**项目地址:** https://github.com/vulhub/vulhub/tree/master/bash/shellshock

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2014-6271
