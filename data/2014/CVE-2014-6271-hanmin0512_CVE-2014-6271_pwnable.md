## CVE-2014-6271 - Bash 命令注入

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 命令注入

**影响应用:** Bash

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** 所有使用Bash 1.14至4.3版本的系统

**利用条件:** 无需认证，网络可达

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是一个存在于Bash shell中的严重漏洞。该漏洞允许攻击者通过特制的环境变量执行任意命令。当Bash shell处理以函数定义开头的环境变量时，它会在函数定义结束后继续执行后续的命令。攻击者可以利用这个特性，构造包含恶意代码的环境变量，当这些变量被传递给Bash shell时，恶意代码就会被执行。

POC有效性分析：提供的POC代码通过`setresuid`和`setresgid`提升权限后，利用`system`函数执行`/home/shellshock/bash -c 'echo shock_me'`命令来验证漏洞的存在。更详细的利用方式展示了如何通过设置恶意环境变量，在Bash执行时注入并执行任意命令。在pwnable.kr的shellshock挑战中，攻击者可以利用此漏洞读取flag文件，即使通常情况下没有读取该文件的权限。这是因为`shellshock.c`程序在执行bash之前提升了用户组ID，从而允许读取flag文件。

利用步骤：
1. 目标系统必须使用受影响的Bash版本。
2. 攻击者需要找到一个可以设置环境变量的入口点，例如CGI脚本、SSH服务器或其他任何调用Bash shell的应用程序。
3. 构造包含恶意代码的环境变量，例如`(){ :; }; /bin/cat flag`。
4. 将该环境变量传递给Bash shell。
5. 如果漏洞存在，恶意代码将被执行，攻击者可以控制系统或执行其他恶意操作。

投毒风险分析：此POC的投毒风险较低。提供的C代码非常简单，没有明显的恶意行为。它只是提升权限并执行一个简单的命令。环境变量的利用方式本身存在一定的风险，因为攻击者可能会修改环境变量以执行恶意命令。但总体而言，此POC的风险相对较低，因为它主要用于演示漏洞的存在和利用方法。虽然可以通过修改环境变量来执行恶意操作，但这种修改是显而易见的，并且可以被安全工具检测到。此外，该POC没有使用任何混淆技术或外部脚本，这进一步降低了投毒风险。如果修改环境变量执行恶意指令，需要对指令本身进行分析来判断是否是恶意代码。由于此漏洞的利用方式依赖于环境变量的设置，因此存在一定的社会工程学风险。攻击者可能会诱使用户设置包含恶意代码的环境变量，从而感染系统。但这种风险可以通过加强安全意识教育和实施严格的环境变量管理措施来降低。

**项目地址:** https://github.com/hanmin0512/CVE-2014-6271_pwnable

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2014-6271
