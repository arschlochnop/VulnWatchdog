## CVE-2020-0796 - Microsoft Windows SMBv3 protocol 远程代码执行 (RCE), 本地提权 (LPE), 拒绝服务 (DoS)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行 (RCE), 本地提权 (LPE), 拒绝服务 (DoS)

**影响应用:** Microsoft Windows SMBv3 protocol

**危害等级:** 高危。该漏洞允许未经身份验证的远程攻击者在目标系统上执行任意代码，或提升权限，甚至导致系统蓝屏死机，对系统机密性、完整性、可用性造成严重影响。

**CVSS评分:** 未提供CVSS评分，但根据漏洞性质和影响，其CVSSv3评分预计在9.0以上（Critical）。

**影响版本:** Microsoft Windows 10 Version 1903及其他受SMBv3协议影响的版本。

**利用条件:** 无需认证，远程网络访问 (需开放SMB端口445)，针对SMBv3协议的特定数据包处理缺陷。

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 35%

## 详情

CVE-2020-0796，也被称为 "SMBGhost" 或 "EternalDarkness"，是Microsoft Windows SMBv3协议中的一个关键漏洞。该漏洞源于SMBv3协议在处理恶意的压缩数据包时存在一个整数溢出缺陷。当未经身份验证的远程攻击者向目标SMB服务器或客户端发送特制的压缩数据包时，该溢出可能被触发。成功利用此漏洞可导致在受影响的系统上实现远程代码执行 (RCE) 或本地提权 (LPE)。攻击者可以通过RCE完全控制受感染的系统，或者通过LPE提升其在系统上的权限。早期披露的POC甚至可以导致系统蓝屏死机（BSOD），表明其对系统稳定性的严重影响。

**POC有效性分析：**
提供的POC“代码”实际上是两个Markdown格式的利用计划文档：`ATTACK_PLAN.md` 和 `Exploitation.md`。这些文档详细概述了如何针对CVE-2020-0796进行伦理利用。它们不是直接可执行的代码，而是提供了详尽的指导和所需工具的引用。文档中明确提到了使用Kali Linux作为攻击者机器，以及Nmap进行端口扫描以确认SMB服务（端口445）的开放。目标系统被指定为安装了Windows 10版本1903或其他受影响版本的虚拟机，并强调了在受控虚拟化环境中进行测试的重要性。

POC文档进一步引用了外部的Python利用脚本，例如来自 `maqeel-git/CVE-2020-0796` 和 `ZecOps/CVE-2020-0796-RCE-POC` 的代码库，这些引用表明了存在经过验证且可用的漏洞利用工具。文档中对攻击流程的描述清晰且逻辑严谨，从识别脆弱系统、编译/获取利用代码、配置攻击环境到执行利用和验证成功，每个步骤都进行了详细说明。鉴于该漏洞的性质、历史公开的POC及其广泛的讨论，以及这些文档的详细程度和对实际利用代码的引用，可以评估这些利用计划是高度有效且可行的。如果遵循这些步骤并使用正确且有效的外部利用脚本，成功利用此漏洞的可能性极高。POC的有效性主要依赖于这些外部引用的实际代码质量，但文档本身作为指导是清晰且全面的。

**利用步骤：**
1.  **准备目标系统：** 在一个隔离的虚拟化环境中（如VMware或VirtualBox），安装并配置一个脆弱的Windows系统，例如Windows 10 Version 1903。确保该系统与攻击者机器处于同一网络中，并开启SMB服务（默认开放端口445）。
2.  **准备攻击者机器：** 使用Kali Linux或其他渗透测试发行版作为攻击者机器。
3.  **识别脆弱系统：** 从Kali Linux终端，使用Nmap工具扫描目标Windows VM的IP地址，确认端口445/tcp是开放的，以验证SMB服务的可用性：`sudo nmap -sS <Windows_IP_Address>`。
4.  **获取利用代码：** 从文档中提及的GitHub仓库（例如 `maqeel-git/CVE-2020-0796` 或 `ZecOps/CVE-2020-0796-RCE-POC`）下载或编译相关的Python利用脚本。
5.  **配置攻击环境：** 根据利用脚本的要求，配置攻击参数，主要是目标Windows系统的IP地址，并选择攻击模式（例如RCE或BSOD）。
6.  **执行漏洞利用：** 在攻击者机器上运行Python利用脚本，针对目标Windows系统的SMBGhost协议进行攻击。
7.  **验证利用成功：** 观察目标Windows系统。成功利用可能表现为获得远程Shell、在目标系统上执行任意命令、提权到SYSTEM权限，或导致系统蓝屏死机。根据利用类型和效果进行验证。

**投毒风险分析：**
提供的POC“代码”实际上是用于指导伦理利用的Markdown文档，它们本身不包含任何可执行代码，因此，这些文档本身直接引入恶意软件或进行投毒的风险极低（低于5%）。文档内容清晰、透明，专注于漏洞的利用方法和步骤，没有发现任何混淆、恶意指令或可疑的外部请求。它们严格遵循了伦理黑客实践的原则。

然而，投毒风险主要存在于文档中引用的**外部利用代码库**。用户在获取或使用这些引用的Python脚本时，必须谨慎。如果攻击者通过修改原始仓库、中间人攻击或钓鱼网站等方式，用恶意代码替换了原始、合法的漏洞利用脚本，那么用户在下载和执行这些“被投毒”的脚本时，就会面临很高的风险。这些恶意脚本可能包含后门、勒索软件、挖矿程序或其他恶意负载，从而导致用户测试环境甚至生产环境被感染。

因此，对于防御性安全研究人员而言，在按照这些POC文档进行操作时，务必：
1.  **验证来源：** 仅从官方或可信赖的GitHub仓库下载利用代码，并仔细检查仓库的信誉、贡献者历史和代码更新频率。
2.  **代码审计：** 在执行任何外部代码之前，对其进行彻底的代码审计，查找潜在的恶意行为、混淆技术、不必要的网络请求或文件操作。
3.  **沙箱环境：** 始终在隔离的沙箱环境（如虚拟机）中执行任何未经审计的POC代码，并监控其行为，以防意外感染。
4.  **网络隔离：** 确保测试环境与生产网络完全隔离，避免潜在的横向移动。

综合来看，提供给我的POC文档（Markdown文件）本身的投毒风险为低（低于5%），因为它只是指导性的文本。但其引用的外部资源带来了中等至高的潜在投毒风险，这取决于用户如何获取和验证这些外部代码。因此，整体投毒风险应被评估为中等，大约为35%，以警示用户对外部代码的潜在威胁。

**项目地址:** https://github.com/maqeel-git/CVE-2020-0796, https://github.com/ZecOps/CVE-2020-0796-RCE-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2020-0796
