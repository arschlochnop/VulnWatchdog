## CVE-2020-0796 - Microsoft Windows Server Message Block 3.1.1 (SMBv3) RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Windows Server Message Block 3.1.1 (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** Windows 10 Version 1903, Windows 10 Version 1909, Windows Server Version 1903, Windows Server Version 1909

**利用条件:** 需要目标开启SMBv3服务，且未安装2020年3月安全补丁；POC利用需预先获取目标内存偏移量或特定环境。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：此POC由ZecOps提供，名为‘SMBleedingGhost’。它针对的是SMBv3协议处理压缩包请求时的缓冲区溢出漏洞。该POC并非‘一键式’通用脚本，而是具有高度的技术针对性。其核心在于利用了SMBv3中的Srv2.sys驱动程序在解压数据时的逻辑缺陷。分析POC代码逻辑，其有效性取决于三个关键因素：首先是环境匹配，明确指出支持Windows 10 1903/1909；其次是内存偏移量，POC要求通过执行calc_target_offsets.bat获取特定内核偏移，这极大地提高了利用的成功率并避免了蓝屏（BSOD）；第三是网络通达性，需要445端口开放。该POC通过构造畸形的压缩数据包触发内核溢出，最终实现从Ring 0级别的权限执行代码，通常表现为反弹一个具有SYSTEM权限的Shell。相较于网络上流传的许多仅能导致崩溃的DoS脚本，此POC提供了完整的提权路径。利用步骤：1. 在目标机执行偏移计算脚本获取内核地址参数。2. 修改SMBleedingGhost.py文件头部的Offsets配置。3. 在攻击机启动ncat监听指定端口。4. 运行Python脚本并传入目标IP、本地IP及端口。5. 等待目标触发漏洞并建立反向连接。投毒风险分析：经过对ZecOps披露的代码结构分析，该项目投毒风险较低。代码逻辑清晰，主要依赖Python标准库及ncat外部工具。未发现代码混淆、base64加密的可执行负载或向未知IP发送心跳包的后门逻辑。POC中包含的shellcode是典型的反弹Shell逻辑，符合安全研究工具的特征。尽管如此，防御者在使用任何非官方二进制辅助工具（如calc_target_offsets.bat）时仍需谨慎，建议在隔离环境的虚拟机中运行。该代码的风险主要在于其高危害性而非恶意投毒，因为一旦泄露或被滥用，可能导致局域网内的大规模蠕虫式感染，故其投毒风险评分为15%，主要针对可能存在的第三方二次修改版本。

**项目地址:** [https://github.com/ZecOps/CVE-2020-0796-RCE-POC](https://github.com/ZecOps/CVE-2020-0796-RCE-POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
