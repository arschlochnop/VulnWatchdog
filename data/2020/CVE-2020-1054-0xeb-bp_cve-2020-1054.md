# CVE-2020-1054

> 📦 该CVE有 **5** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-1054-0xeb-bp_cve-2020-1054.md](../2020/CVE-2020-1054-0xeb-bp_cve-2020-1054.md)

# CVE-2020-1054

> 📦 该CVE有 **4** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-1054-Graham382_CVE-2020-1054.md](../2020/CVE-2020-1054-Graham382_CVE-2020-1054.md)

## CVE-2020-1054 Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，允许低权限用户提升至SYSTEM权限

**影响版本:** 受影响的Windows版本包括但不限于Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

根据漏洞库信息和搜索结果，CVE-2020-1054是Windows内核模式驱动程序在处理内存中的对象时未能正确处理对象而导致的权限提升漏洞。攻击者可以利用此漏洞在本地提升权限。

**有效性：**
提供的PoC代码（CVE-2020-1054.cpp）似乎针对Windows 7 x64，它利用了`DrawIconEx`函数中的漏洞。代码通过操纵GDI对象，特别是位图对象，来实现越界写入，从而覆盖内核内存中的敏感数据，如进程令牌。

**投毒风险：**
该代码主要功能是利用漏洞提升权限，没有发现明显的恶意代码或后门。但是，任何漏洞利用代码都可能被恶意修改并重新发布，因此始终存在一定的投毒风险，评估为1%。风险极低,主要是考虑到安全问题,正常使用风险可忽略不计.

**利用方式：**
1.  **查找目标进程和系统进程的Token地址：** 通过`GetObjectKernelAddress`函数获取当前进程和系统进程的内核对象地址，并计算Token在EPROCESS结构中的偏移。系统进程一般是PID为4的System进程。
2.  **GDI对象操纵：** 代码创建GDI对象（位图）并在内存中分配空间。通过精心构造的位图对象及其相关的内存布局，利用`DrawIconEx`函数中的越界写入漏洞。
3.  **越界写入：**  通过计算目标地址,修改当前进程的Token为系统进程的Token，实现权限提升。
4. **提权:** 利用成功之后,当前进程就具备了System权限.

**总结：**
该漏洞利用方式是典型的Win32k漏洞利用，通过GDI对象操纵和越界写入来修改进程令牌，从而实现权限提升。POC是有效的，但需要针对特定的Windows版本进行调整。投毒风险较低，但使用时仍需谨慎。

**项目地址:** [Graham382/CVE-2020-1054](https://github.com/Graham382/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #2

**来源**: [CVE-2020-1054-Iamgublin_CVE-2020-1054.md](../2020/CVE-2020-1054-Iamgublin_CVE-2020-1054.md)

## CVE-2020-1054 - Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Microsoft Windows

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054 是一个 Windows Win32k 组件中的权限提升漏洞。根据漏洞描述，该漏洞是由于 Windows 内核模式驱动程序未能正确处理内存中的对象而引起的。攻击者可以利用此漏洞在受影响的系统上以提升的权限运行代码。

**漏洞利用有效性：**

根据搜索结果和漏洞利用代码，此漏洞利用的有效性较高。漏洞库信息显示受影响的系统版本范围广泛，并且CISA的已知被利用漏洞目录中也包含此漏洞,这意味着该漏洞已经被广泛利用. 搜索结果中也提供了POC代码的链接，GitHub仓库（0xeb-bp/cve-2020-1054）提供了针对Windows 7 x64的利用程序，说明该漏洞存在可行的利用方法。提供的代码`ConsoleApplication4.cpp` 也印证了这一点。

**投毒风险分析：**

提供的C++代码本身是漏洞利用的尝试，因此具有一定的潜在风险。虽然代码目的是提升权限，但如果代码编写不当，可能会导致系统崩溃或其他不可预测的行为。此外，代码中包含一些内存操作，例如读取和写入内核内存，这些操作具有很高的风险，如果操作不正确，可能会破坏系统。

*   **风险点：**
    *   **缓冲区溢出：** 在`SetBitmapBits`和`GetBitmapBits`的使用中，如果长度计算错误或目标地址不可控，可能导致缓冲区溢出。
    *   **内核内存破坏：** 直接读写内核内存的操作可能导致系统不稳定甚至崩溃。
    *   **权限提升失败：** 虽然目标是提升权限，但如果利用过程出现任何错误，都可能导致利用失败，并可能留下痕迹。

*   **代码分析：**

    代码通过`DrawIconEx`相关的函数利用`Win32k`组件漏洞，实现在内核中任意地址读取和写入的能力。它首先泄露当前进程的EPROCESS地址，并查找SYSTEM进程的EPROCESS地址。然后，它会将当前进程的安全令牌替换为SYSTEM进程的安全令牌，从而获得SYSTEM权限。

    代码中存在`backup`和`recovery`函数，这表明作者可能在利用过程中修改了一些数据，并在利用完成后尝试恢复。然而，如果恢复过程失败，可能会导致系统状态不一致。

   **投毒代码可能性：** 代码中直接操作内核内存的部分具有潜在的风险，可能被用于植入恶意代码或进行其他恶意操作。代码作者可能利用这些操作在系统中安装后门或者进行其他未经授权的更改。虽然代码的主要功能是权限提升，但是不排除其中包含其他恶意代码的可能性，因此，投毒风险评估为10%。

**漏洞利用方式：**

该漏洞的利用方式主要包括以下步骤：

1.  **信息泄露：** 通过`gSharedInfo` 获取内核地址, 通过窗口句柄获取内核中窗口对象(WND)的地址。
2.  **寻找EPROCESS：**通过`WND`结构体找到当前进程的`EPROCESS`结构体地址，从中获得当前进程的安全令牌地址。
3.  **寻找SYSTEM EPROCESS：** 遍历进程链表，找到PID为4（SYSTEM进程）的`EPROCESS`结构体地址，从中获得SYSTEM进程的安全令牌地址。
4.  **权限提升：** 将当前进程的安全令牌替换为SYSTEM进程的安全令牌，从而提升当前进程的权限。

**项目地址:** [Iamgublin/CVE-2020-1054](https://github.com/Iamgublin/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #3

**来源**: [CVE-2020-1054-KaLendsi_CVE-2020-1054.md](../2020/CVE-2020-1054-KaLendsi_CVE-2020-1054.md)

## CVE-2020-1054

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，本地权限提升

**影响版本:** 受影响的Windows版本包括Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server 2008 SP2, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016, Windows Server 2019 以及相应的Server Core安装。

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054 存在于 Windows 内核模式驱动程序中，当驱动程序未能正确处理内存中的对象时，会导致权限提升。根据搜索结果和漏洞利用代码，该漏洞利用了 Win32k 组件中的 `DrawIconEx` 函数的越界写入漏洞。

**有效性：**

提供的 PoC 代码（Visual Studio solution）表明该漏洞的利用是可行的。搜索结果中提到了公开可用的exp，且提供了exp的github链接。

**投毒风险：**

提供的代码片段看起来是合法的漏洞利用程序框架，包含 Visual Studio 工程文件和一些源代码。虽然无法完全排除投毒风险，但目前没有明显的证据表明存在恶意代码。风险较低，约10%。主要考虑到以下几点：

*   PoC 只是一个框架，需要编译才能使用，编译过程中可能引入恶意代码。
*   漏洞利用代码本身就具有破坏性，可能被滥用。

**利用方式：**

该漏洞的利用方式通常涉及以下步骤：

1.  利用 `DrawIconEx` 函数或其他相关函数触发 Win32k 组件中的越界写入漏洞。
2.  通过精心构造的内存布局，覆盖关键的内核数据结构。
3.  劫持程序执行流程，执行攻击者控制的代码。
4.  提升当前进程的权限，从而获得系统管理员权限。

**项目地址:** [KaLendsi/CVE-2020-1054](https://github.com/KaLendsi/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #4

**来源**: [CVE-2020-1054-Naman2701B_CVE-2020-1054.md](../2020/CVE-2020-1054-Naman2701B_CVE-2020-1054.md)

## CVE-2020-1054 Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** 受影响的Windows版本包括但不限于Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 需要在受影响的Windows系统上本地执行

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054是一个Windows Win32k组件中的权限提升漏洞。漏洞原因是Windows内核模式驱动程序未能正确处理内存中的对象。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。根据搜索引擎结果和漏洞利用代码，可以确认此漏洞存在公开可用的POC。提供的C++代码利用`DrawIconEx`函数中的越界写入漏洞来实现权限提升。该POC首先获取当前进程和System进程的Token地址，然后通过构造特定的GDI对象，利用内存布局的缺陷，将当前进程的Token替换为System进程的Token，从而提升权限。shellcode部分执行反向shell，连接到指定IP地址和端口。 

**有效性：** 提供的POC代码在受影响的Windows系统上应该是有效的，可以成功利用该漏洞进行权限提升。

**投毒风险：** 代码中包含反向shell，连接到192.168.223.128:4444。虽然反向shell本身是漏洞利用的一部分，但如果这个IP地址属于恶意攻击者控制，则可能存在投毒风险，即用户运行该POC后，攻击者的服务器可以远程控制受害者系统。评估的投毒风险为10%，主要是因为反向shell的目标IP地址可能被用于恶意目的，但核心漏洞利用代码本身的意图是权限提升。

**利用方式：**
1.  利用`NtQuerySystemInformation`获取当前进程和System进程的内核对象地址。
2.  计算Token的偏移地址（0x208）。
3.  创建GDI对象（HDC和HBITMAP），并利用GDI共享句柄表获取HBITMAP对象的内核地址。
4.  通过精心构造的内存布局，利用`DrawIconEx`函数中的越界写入漏洞，将System进程的Token覆盖到当前进程的Token。
5.  执行shellcode，建立反向shell连接，获取SYSTEM权限。


**项目地址:** [Naman2701B/CVE-2020-1054](https://github.com/Naman2701B/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---



---

## POC #2

**来源**: [CVE-2020-1054-Graham382_CVE-2020-1054.md](../2020/CVE-2020-1054-Graham382_CVE-2020-1054.md)

## CVE-2020-1054 Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，允许低权限用户提升至SYSTEM权限

**影响版本:** 受影响的Windows版本包括但不限于Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

根据漏洞库信息和搜索结果，CVE-2020-1054是Windows内核模式驱动程序在处理内存中的对象时未能正确处理对象而导致的权限提升漏洞。攻击者可以利用此漏洞在本地提升权限。

**有效性：**
提供的PoC代码（CVE-2020-1054.cpp）似乎针对Windows 7 x64，它利用了`DrawIconEx`函数中的漏洞。代码通过操纵GDI对象，特别是位图对象，来实现越界写入，从而覆盖内核内存中的敏感数据，如进程令牌。

**投毒风险：**
该代码主要功能是利用漏洞提升权限，没有发现明显的恶意代码或后门。但是，任何漏洞利用代码都可能被恶意修改并重新发布，因此始终存在一定的投毒风险，评估为1%。风险极低,主要是考虑到安全问题,正常使用风险可忽略不计.

**利用方式：**
1.  **查找目标进程和系统进程的Token地址：** 通过`GetObjectKernelAddress`函数获取当前进程和系统进程的内核对象地址，并计算Token在EPROCESS结构中的偏移。系统进程一般是PID为4的System进程。
2.  **GDI对象操纵：** 代码创建GDI对象（位图）并在内存中分配空间。通过精心构造的位图对象及其相关的内存布局，利用`DrawIconEx`函数中的越界写入漏洞。
3.  **越界写入：**  通过计算目标地址,修改当前进程的Token为系统进程的Token，实现权限提升。
4. **提权:** 利用成功之后,当前进程就具备了System权限.

**总结：**
该漏洞利用方式是典型的Win32k漏洞利用，通过GDI对象操纵和越界写入来修改进程令牌，从而实现权限提升。POC是有效的，但需要针对特定的Windows版本进行调整。投毒风险较低，但使用时仍需谨慎。

**项目地址:** [Graham382/CVE-2020-1054](https://github.com/Graham382/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #3

**来源**: [CVE-2020-1054-Iamgublin_CVE-2020-1054.md](../2020/CVE-2020-1054-Iamgublin_CVE-2020-1054.md)

## CVE-2020-1054 - Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Microsoft Windows

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054 是一个 Windows Win32k 组件中的权限提升漏洞。根据漏洞描述，该漏洞是由于 Windows 内核模式驱动程序未能正确处理内存中的对象而引起的。攻击者可以利用此漏洞在受影响的系统上以提升的权限运行代码。

**漏洞利用有效性：**

根据搜索结果和漏洞利用代码，此漏洞利用的有效性较高。漏洞库信息显示受影响的系统版本范围广泛，并且CISA的已知被利用漏洞目录中也包含此漏洞,这意味着该漏洞已经被广泛利用. 搜索结果中也提供了POC代码的链接，GitHub仓库（0xeb-bp/cve-2020-1054）提供了针对Windows 7 x64的利用程序，说明该漏洞存在可行的利用方法。提供的代码`ConsoleApplication4.cpp` 也印证了这一点。

**投毒风险分析：**

提供的C++代码本身是漏洞利用的尝试，因此具有一定的潜在风险。虽然代码目的是提升权限，但如果代码编写不当，可能会导致系统崩溃或其他不可预测的行为。此外，代码中包含一些内存操作，例如读取和写入内核内存，这些操作具有很高的风险，如果操作不正确，可能会破坏系统。

*   **风险点：**
    *   **缓冲区溢出：** 在`SetBitmapBits`和`GetBitmapBits`的使用中，如果长度计算错误或目标地址不可控，可能导致缓冲区溢出。
    *   **内核内存破坏：** 直接读写内核内存的操作可能导致系统不稳定甚至崩溃。
    *   **权限提升失败：** 虽然目标是提升权限，但如果利用过程出现任何错误，都可能导致利用失败，并可能留下痕迹。

*   **代码分析：**

    代码通过`DrawIconEx`相关的函数利用`Win32k`组件漏洞，实现在内核中任意地址读取和写入的能力。它首先泄露当前进程的EPROCESS地址，并查找SYSTEM进程的EPROCESS地址。然后，它会将当前进程的安全令牌替换为SYSTEM进程的安全令牌，从而获得SYSTEM权限。

    代码中存在`backup`和`recovery`函数，这表明作者可能在利用过程中修改了一些数据，并在利用完成后尝试恢复。然而，如果恢复过程失败，可能会导致系统状态不一致。

   **投毒代码可能性：** 代码中直接操作内核内存的部分具有潜在的风险，可能被用于植入恶意代码或进行其他恶意操作。代码作者可能利用这些操作在系统中安装后门或者进行其他未经授权的更改。虽然代码的主要功能是权限提升，但是不排除其中包含其他恶意代码的可能性，因此，投毒风险评估为10%。

**漏洞利用方式：**

该漏洞的利用方式主要包括以下步骤：

1.  **信息泄露：** 通过`gSharedInfo` 获取内核地址, 通过窗口句柄获取内核中窗口对象(WND)的地址。
2.  **寻找EPROCESS：**通过`WND`结构体找到当前进程的`EPROCESS`结构体地址，从中获得当前进程的安全令牌地址。
3.  **寻找SYSTEM EPROCESS：** 遍历进程链表，找到PID为4（SYSTEM进程）的`EPROCESS`结构体地址，从中获得SYSTEM进程的安全令牌地址。
4.  **权限提升：** 将当前进程的安全令牌替换为SYSTEM进程的安全令牌，从而提升当前进程的权限。

**项目地址:** [Iamgublin/CVE-2020-1054](https://github.com/Iamgublin/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #4

**来源**: [CVE-2020-1054-KaLendsi_CVE-2020-1054.md](../2020/CVE-2020-1054-KaLendsi_CVE-2020-1054.md)

## CVE-2020-1054

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，本地权限提升

**影响版本:** 受影响的Windows版本包括Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server 2008 SP2, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016, Windows Server 2019 以及相应的Server Core安装。

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054 存在于 Windows 内核模式驱动程序中，当驱动程序未能正确处理内存中的对象时，会导致权限提升。根据搜索结果和漏洞利用代码，该漏洞利用了 Win32k 组件中的 `DrawIconEx` 函数的越界写入漏洞。

**有效性：**

提供的 PoC 代码（Visual Studio solution）表明该漏洞的利用是可行的。搜索结果中提到了公开可用的exp，且提供了exp的github链接。

**投毒风险：**

提供的代码片段看起来是合法的漏洞利用程序框架，包含 Visual Studio 工程文件和一些源代码。虽然无法完全排除投毒风险，但目前没有明显的证据表明存在恶意代码。风险较低，约10%。主要考虑到以下几点：

*   PoC 只是一个框架，需要编译才能使用，编译过程中可能引入恶意代码。
*   漏洞利用代码本身就具有破坏性，可能被滥用。

**利用方式：**

该漏洞的利用方式通常涉及以下步骤：

1.  利用 `DrawIconEx` 函数或其他相关函数触发 Win32k 组件中的越界写入漏洞。
2.  通过精心构造的内存布局，覆盖关键的内核数据结构。
3.  劫持程序执行流程，执行攻击者控制的代码。
4.  提升当前进程的权限，从而获得系统管理员权限。

**项目地址:** [KaLendsi/CVE-2020-1054](https://github.com/KaLendsi/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

## POC #5

**来源**: [CVE-2020-1054-Naman2701B_CVE-2020-1054.md](../2020/CVE-2020-1054-Naman2701B_CVE-2020-1054.md)

## CVE-2020-1054 Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** 受影响的Windows版本包括但不限于Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 需要在受影响的Windows系统上本地执行

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1054是一个Windows Win32k组件中的权限提升漏洞。漏洞原因是Windows内核模式驱动程序未能正确处理内存中的对象。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。根据搜索引擎结果和漏洞利用代码，可以确认此漏洞存在公开可用的POC。提供的C++代码利用`DrawIconEx`函数中的越界写入漏洞来实现权限提升。该POC首先获取当前进程和System进程的Token地址，然后通过构造特定的GDI对象，利用内存布局的缺陷，将当前进程的Token替换为System进程的Token，从而提升权限。shellcode部分执行反向shell，连接到指定IP地址和端口。 

**有效性：** 提供的POC代码在受影响的Windows系统上应该是有效的，可以成功利用该漏洞进行权限提升。

**投毒风险：** 代码中包含反向shell，连接到192.168.223.128:4444。虽然反向shell本身是漏洞利用的一部分，但如果这个IP地址属于恶意攻击者控制，则可能存在投毒风险，即用户运行该POC后，攻击者的服务器可以远程控制受害者系统。评估的投毒风险为10%，主要是因为反向shell的目标IP地址可能被用于恶意目的，但核心漏洞利用代码本身的意图是权限提升。

**利用方式：**
1.  利用`NtQuerySystemInformation`获取当前进程和System进程的内核对象地址。
2.  计算Token的偏移地址（0x208）。
3.  创建GDI对象（HDC和HBITMAP），并利用GDI共享句柄表获取HBITMAP对象的内核地址。
4.  通过精心构造的内存布局，利用`DrawIconEx`函数中的越界写入漏洞，将System进程的Token覆盖到当前进程的Token。
5.  执行shellcode，建立反向shell连接，获取SYSTEM权限。


**项目地址:** [Naman2701B/CVE-2020-1054](https://github.com/Naman2701B/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)

---

