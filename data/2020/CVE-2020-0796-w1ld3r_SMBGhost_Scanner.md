## CVE-2020-0796 - Microsoft Windows 10 / Windows Server 2019 (SMBv3) RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Windows 10 / Windows Server 2019 (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 启用SMBv3协议，开启数据压缩功能（默认开启），目标445端口可访问，无需身份验证

**POC 可用性:** 7/10

**POC 类型:** 概念验证/扫描工具

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本POC（SMBGhost Scanner）是一个基于Python开发的漏洞检测工具。其核心逻辑通过构造特定的SMBv3请求包，利用ollypwn提出的检测技术，在不导致目标系统蓝屏死机（BSOD）的前提下，通过观察目标对畸形压缩数据的处理反馈来判断是否存在CVE-2020-0796漏洞。代码集成了masscan用于大规模互联网扫描，并支持Shodan API进行资产指纹增强，具有较高的实用价值。通过对scanner.py源码分析，其导入了socket、struct、ipaddress等标准库，主逻辑围绕建立TCP连接并发送SMB2协议头展开。代码中包含了SMB2_COMPRESSION_CAPABILITIES字段的构造，这是触发SMBGhost漏洞的关键点，即通过对长度字段的溢出处理进行探测。该工具能够快速识别内网或外网中未修补的Windows系统，有效性较高，属于防御性扫描工具。利用步骤：1. 环境准备，安装Python3、pip及依赖库requests。2. 可选安装masscan以实现全网扫描。3. 获取Shodan API Key（可选）以丰富扫描结果。4. 运行scanner.py，使用-t参数指定单个IP或CIDR地址段，例如：python3 scanner.py -t 192.168.1.0/24。5. 程序将自动扫描445端口并尝试发送检测payload，若发现存在漏洞的目标，将结果输出至控制台或指定的json文件。投毒风险分析：该POC代码逻辑清晰，主要使用了Python标准网络库和requests库。经过对代码逻辑的审查，未发现混淆代码、Base64加密的可疑字符串或eval()等高风险函数。其核心行为是建立socket连接并发送特定字节流，属于典型的协议探测行为。唯一的外部依赖是requests库，用于同Shodan API通信，并未发现其尝试将本地敏感数据上传至第三方匿名服务器的情况。项目中包含的README.md文档详尽，且使用了GPLv3开源协议，代码风格符合常规安全研究员的编写习惯。风险点在于：1. 用户在使用该工具进行全网扫描时可能会由于触发IDS/IPS产生大量的流量告警。2. 扫描脚本中预留了SHODAN_API_KEY变量，若用户在公共环境中泄露API密钥可能导致个人额度损耗。3. 虽然当前代码版本安全，但该漏洞影响极大，若攻击者在克隆仓库中插入反向Shell payload或修改requirements.txt引导安装恶意库，仍存在供应链投毒风险。总体而言，该GitHub原始项目的投毒风险处于较低水平（15%），可用于合法的内网资产审计。

**项目地址:** [https://github.com/x1n5h3n/SMBGhost](https://github.com/x1n5h3n/SMBGhost)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
