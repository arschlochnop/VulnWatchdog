## CVE-2020-0796 - Microsoft Windows Server Message Block 3.1.1 (SMBv3) RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Windows Server Message Block 3.1.1 (SMBv3)

**危害等级:** Critical

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, Windows 10 Version 1909, Windows Server Version 1903, Windows Server Version 1909

**利用条件:** Target must have SMBv3 enabled (specifically 3.1.1) and allow incoming traffic on port 445.

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：提供的代码是一个针对CVE-2020-0796（又称SMBGhost）的Nmap NSE脚本。该漏洞存在于SMBv3协议处理压缩数据包的逻辑中。通过发送精心构造的压缩请求，攻击者可以在受影响的服务器或客户端上执行任意代码。该脚本通过探测目标系统是否支持SMB 3.1.1协议版本并尝试特定的数据包头检查来验证漏洞存在性。代码逻辑基于已知的漏洞触发原理，即在处理Srv2DecompressData时由于未对偏移值进行充分校验导致的整数溢出。此POC并非完整的远程执行溢出载荷，而是一个高可靠性的版本识别与漏洞检测工具。由于其不涉及复杂的内存布局操作，误报率较低且不会导致目标服务崩溃。利用步骤：1. 确保安装了Nmap环境；2. 将cve-2020-0796.nse放置在Nmap脚本目录下或直接引用；3. 执行命令 'nmap -p 445 --script cve-2020-0796 <target>'；4. 观察输出结果，若显示 'State: VULNERABLE (Exploitable)' 则表明目标存在漏洞。该漏洞具有'蠕虫级'潜力，因为它不需要任何身份验证且可以通过网络远程触发。投毒风险分析：该脚本代码采用标准的Lua语言编写，用于Nmap引擎执行。经过安全审计，代码主要依赖于Nmap内置的smb、stdnse、nmap和vulns库。代码逻辑清晰地定义了SMB协商包的构造过程，其核心在于检测目标对3.1.1协议的支持以及特定的压缩属性响应。在代码中未发现任何恶意的混淆逻辑、非法外连请求、敏感信息窃取（如环境变量上传或硬编码的远程C2地址）或文件系统破坏性操作。POC中引用的外部链接均指向合法的安全研究GitHub仓库或技术文档。尽管脚本属于高危漏洞扫描器，但其行为完全符合安全合规检测的预期。10%的低风险评估主要源于安全工具本身的传播性风险，即在不受信任的渠道获取此类脚本可能被第三方篡改注入后门。建议从受信任的防御性研究仓库获取并对比哈希值。该脚本不会在目标机器上留下持久性后门，仅执行内存级的探测请求，符合合法的防御性安全研究规范。

**项目地址:** [https://github.com/ollypwn/SMBGhost/](https://github.com/ollypwn/SMBGhost/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2020-0796](https://nvd.nist.gov/vuln/detail/cve-2020-0796)
