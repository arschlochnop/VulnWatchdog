## CVE-2020-0796 - Microsoft Server Message Block 3.1.1 (SMBv3) RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Server Message Block 3.1.1 (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 无需身份验证，目标系统开启SMBv3并启用压缩功能，通过445端口进行网络访问

**POC 可用性:** 7/10

**POC 类型:** 概念验证/拒绝服务

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：本POC针对CVE-2020-0796（又称SMBGhost）漏洞，该漏洞存在于Microsoft SMBv3.1.1协议处理压缩数据包的过程中。POC代码采用了直接构造静态十六进制原始数据包的方式，通过socket向目标主机的445端口发送协商请求。代码逻辑分为两个阶段：第一阶段是探测阶段，通过发送构造好的SMB协商包（SMB_negotiation），根据响应包的特征字节（rcv_buf[72:74]以及结尾标志）判断目标是否支持SMBv3.1.1以及其支持的压缩算法（如LZNT1、LZ77等）。如果目标响应符合SMBv3.1.1特征，则说明存在潜在受威胁风险。第二阶段是漏洞触发阶段（当用户输入'Y'时），POC发送了一个精心构造的畸形包（SMB_crash），该包利用了Srv2DecompressData函数中处理解压缓冲区大小时发生的整数溢出漏洞。由于缺乏长度校验，溢出导致后续内存拷贝越界，从而引发系统蓝屏崩溃（BSOD）。虽然此POC仅实现了拒绝服务（DoS）效果，但其探测逻辑准确，数据包构造符合协议规范。对于防御性研究而言，此脚本能有效验证目标环境是否存在未修补的SMBv3漏洞。利用步骤：1. 环境准备：安装Python 3环境。2. 权限确认：确保攻击机与目标机（Windows 10 1903/1909）网络可达且目标445端口开放。3. 执行扫描：运行命令 'python3 poc-and-scan.py [目标IP] N'，观察输出是否显示检测到LZNT1等压缩支持。4. 触发验证：若需验证崩溃效果，运行 'python3 poc-and-scan.py [目标IP] Y'。投毒风险分析：该POC代码极度精简且透明，风险较低。经过逐行审计，代码仅使用了Python标准库（sys, socket, struct），未引用任何外部第三方库，也未包含任何base64混淆或可疑的十六进制转义执行代码。其网络行为严格受限于命令行输入的IP地址，不存在自动扫描全网或向恶意域名外联的行为。代码中明确包含了一个本地IP校验机制（判断IP前缀是否为10, 127, 172.16-31, 192.168），这是一种负责任的限制措施，防止研究人员误伤公网系统。代码中没有发现任何后门植入、敏感信息搜集（如读取环境变量、SSH密钥等）或持久化操作。唯一需要注意的是，此类脚本常被恶意软件集成以实现‘蠕虫化’传播，但在本代码样本中，其行为是纯粹的防御性验证工具。开发者使用WTFPL许可证，符合开源安全社区的分享惯例，未发现投毒迹象。

**项目地址:** 本地模拟路径/tmp/vulnwatchdog_31f466d7675884b58821f0b84b3778c4/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2020-0796](https://nvd.nist.gov/vuln/detail/cve-2020-0796)
