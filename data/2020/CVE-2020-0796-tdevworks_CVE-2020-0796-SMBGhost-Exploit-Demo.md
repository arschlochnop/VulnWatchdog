## CVE-2020-0796 - Microsoft Windows (SMBv3) RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Windows (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** Windows 10 version 1903, Windows 10 version 1909, Windows Server version 1903, Windows Server version 1909

**利用条件:** 无需身份验证，通过网络访问开启了SMBv3服务的受影响系统(端口445)

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：本POC代码基于ZecOps公开的SMBleedingGhost研究成果，旨在针对CVE-2020-0796（SMBGhost）提供一个端到端的远程代码执行演示。该漏洞源于SMBv3协议处理压缩数据包时的整数溢出漏洞。在Srv2.sys驱动程序中，解压缩逻辑未对头部大小进行充分校验，导致缓冲区溢出。此POC包含两个核心脚本：SMBleedingGhost.py（攻击端）和calc_target_offsets.bat（目标端辅助）。根据输入文档，该POC并非完全自动化，它依赖于获取目标系统的内存偏移量（Offsets）。由于Windows 10具有ASLR（地址空间布局随机化）机制，同一内核版本的不同补丁级别会导致偏移量变化，因此该POC要求攻击者先在目标机器或相同环境下运行脚本获取偏移。这在实际渗透测试中限制了通用性，但在受控实验环境下具有极高的有效性。脚本集成了Netcat反弹Shell流程，若偏移量配置正确，可直接获取System权限。利用步骤：首先，在目标机器上运行calc_target_offsets.bat，记录生成的内存偏移值；其次，在攻击机上安装Python 3和Netcat，并修改SMBleedingGhost.py中的OFFSETS字典，填入获取的数值；然后，启动Netcat监听指定端口（如4321）；最后，执行Python攻击脚本，输入目标IP，成功后将在Netcat窗口获得目标系统的交互式Shell。投毒风险分析：该POC项目主要由描述文档和引用脚本组成，核心利用逻辑链接至知名的ZecOps仓库，来源相对可信。分析代码结构发现，脚本主要依赖标准的Python网络库（如socket）和struct库进行二进制数据包构造。README中提及的GitHub链接为业内公认的原始研究地址，而非混淆过的恶意分发站。然而，风险点在于利用步骤中引用的calc_target_offsets.bat脚本，该脚本在目标机器运行，防御者需注意此类脚本是否被篡改以执行额外静默安装。此外，文档中包含的图片链接指向GitHub user-attachments，这属于常见的文档展示方式，未发现通过外链触发浏览器漏洞的企图。综合评估，该项目属于教育性质的Demo，代码逻辑清晰透明，未发现明显的恶意混淆、Shellcode加密投毒或非法外传敏感信息的行为，投毒风险较低，但仍建议在隔离的沙箱环境中使用。

**项目地址:** [https://github.com/ZecOps/CVE-2020-0796-RCE-POC](https://github.com/ZecOps/CVE-2020-0796-RCE-POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2020-0796](https://nvd.nist.gov/vuln/detail/cve-2020-0796)
