# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

# CVE-2020-13151

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md](../2020/CVE-2020-13151-ByteMe1001_CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---

## POC #2

**æ¥æº**: [CVE-2020-13151-b4ny4n_CVE-2020-13151.md](../2020/CVE-2020-13151-b4ny4n_CVE-2020-13151.md)

## CVE-2020-13151-Aerospike-RCE

**æ¼æ´ç¼–å·:** CVE-2020-13151

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Aerospike Community Edition

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 4.9.0.5

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®AerospikeæœåŠ¡ï¼Œé»˜è®¤ç«¯å£3000

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-13151å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æäº¤å’Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ã€‚è™½ç„¶Aerospikeè¯•å›¾é€šè¿‡ç¦ç”¨`os.execute()`æ¥é™åˆ¶ä»£ç æ‰§è¡Œï¼Œä½†è¿™å¹¶ä¸å……åˆ†ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„Lua UDFï¼Œåˆ©ç”¨å…¶ä»–Luaåº“æˆ–å‡½æ•°ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚æ¼æ´åˆ©ç”¨ä»£ç `exploit.py`é¦–å…ˆè¿æ¥åˆ°Aerospikeæ•°æ®åº“ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„UDFã€‚æœ€åï¼Œå®ƒé€šè¿‡è°ƒç”¨è¯¥UDFæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚POCä¸­åŒ…å«pythonåå¼¹shellå’Œnetcatåå¼¹shellçš„payloadï¼Œå¯ä»¥ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœä»¥åŠPOCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å­˜åœ¨ä¸”å¯ä»¥è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”æä¾›äº†POCä»£ç çš„é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**

`exploit.py` æœ¬èº«åŒ…å«äº†åå¼¹ shell çš„ payloadï¼Œè¿™å±äºæ¼æ´éªŒè¯çš„èŒƒç•´ï¼Œå¹¶éæŠ•æ¯’ã€‚æŠ•æ¯’é£é™©ä¸»è¦æ¥æºäºä½œè€…æ˜¯å¦åœ¨UDFæ³¨å†Œæˆ–å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ¤å…¥å…¶ä»–åé—¨ä»£ç ã€‚

*   ä»£ç æ€»ä½“ç»“æ„è¾ƒä¸ºæ¸…æ™°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¿æ¥ Aerospike æœåŠ¡å™¨ã€æ³¨å†Œ UDF å¹¶æ‰§è¡Œå‘½ä»¤ã€‚ä»”ç»†æ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæœªå‘ç°æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä»£ç ä¸­åŒ…å«çš„payloadåŠŸèƒ½æ˜¯åå¼¹shellã€‚`_send` å‡½æ•°ç”¨äºå‘é€å‘½ä»¤ï¼Œ`_register_udf` å‡½æ•°ç”¨äºæ³¨å†Œ UDFï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æ¯”è¾ƒç›´æ¥ï¼Œæœªå‘ç°ç¯¡æ”¹è¡Œä¸ºã€‚
*  `_version_check` å‡½æ•°ç”¨äºæ£€æŸ¥ Aerospike ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚å¦‚æœæ— æ³•ç¡®å®šç‰ˆæœ¬ï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ•…æ„ç¯¡æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›æ¼æ´å­˜åœ¨ï¼Œåˆ™å¯èƒ½è¯¯å¯¼ç”¨æˆ·ã€‚
*   åœ¨ä»£ç ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»å¤–éƒ¨æºåŠ è½½æˆ–æ‰§è¡Œä»£ç çš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€æ”»å‡»è€…æ— æ³•é€šè¿‡è¿œç¨‹æ–¹å¼æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   ä»£ç ä½¿ç”¨ `aerospike` python åŒ…ï¼Œéœ€è¦ç¡®ä¿è¯¥åŒ…çš„æ¥æºå®‰å…¨ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»ã€‚

ç»¼åˆåˆ†æï¼Œè®¤ä¸ºæ­¤ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä¼°è®¡ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®å®šï¼š** ç¡®å®šå­˜åœ¨æ¼æ´çš„Aerospike Community Edition 4.9.0.5æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚
2.  **è¿æ¥æ•°æ®åº“ï¼š** ä½¿ç”¨`exploit.py`è„šæœ¬è¿æ¥åˆ°Aerospikeæ•°æ®åº“æœåŠ¡å™¨ã€‚
3.  **ç‰ˆæœ¬æ£€æµ‹ï¼š** è„šæœ¬ä¼šæ£€æµ‹Aerospikeçš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬é«˜äº4.9.0.5æˆ–è€…å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè„šæœ¬ä¼šé€€å‡ºã€‚
4.  **UDFæ³¨å†Œï¼š** è„šæœ¬ä¼šæ³¨å†Œä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„Lua UDFã€‚è¿™ä¸ªUDFä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚
5.  **å‘½ä»¤æ‰§è¡Œï¼š** è„šæœ¬é€šè¿‡è°ƒç”¨UDFæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹shellç­‰ã€‚
6.  **è·å–Shellï¼š** å¦‚æœæˆåŠŸæ‰§è¡Œäº†åå¼¹shellå‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æŒ‡å®šçš„IPåœ°å€å’Œç«¯å£ä¸Šç›‘å¬ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„shellè®¿é—®æƒé™ã€‚

**é¡¹ç›®åœ°å€:** [ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-](https://github.com/ByteMe1001/CVE-2020-13151-POC-Aerospike-Server-Host-Command-Execution-RCE-)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)

---



---



---



---



---



---



---



---



---



---



---



---



---



---



---

