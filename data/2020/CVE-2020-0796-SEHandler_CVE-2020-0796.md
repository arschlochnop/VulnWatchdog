## CVE-2020-0796 - Microsoft Windows 10, Windows Server (SMB 3.1.1) RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows 10, Windows Server (SMB 3.1.1)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 目标开启SMBv3服务且未安装补丁，支持压缩功能，无需认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：CVE-2020-0796，又称SMBGhost，是Windows SMBv3协议处理压缩数据包时的整数溢出漏洞。本次分析涉及的POC项目质量极高。chompie1337提供的RCE PoC是该漏洞最著名的公开利用代码之一，它通过精巧的内核偏移计算实现了从内存泄露到系统权限代码执行的跨越。jiansiting的项目提供了远程溢出的基础验证，而ButrintKomoni的扫描器则为安全研究人员提供了非破坏性的探测手段。这些POC在实验室环境下均表现出极高的成功率。该漏洞之所以被称为‘Wormable’（类蠕虫），是因为攻击者只需向目标端口（通常为445）发送特制的压缩数据包，即可在未授权的情况下获得System权限。分析代码结构发现，核心利用逻辑在于通过修改Token或替换进程句柄来实现提权。由于利用过程直接发生在内核态，若偏移量配置不当（例如针对不同补丁版本的系统），极易导致系统蓝屏（BSOD）。利用步骤：1. 使用扫描工具确认目标主机的SMB版本为3.1.1且启用了压缩。2. 根据目标操作系统的具体版本号调整POC中的内核偏移量参数。3. 运行RCE脚本，脚本会先通过内存泄露漏洞获取内核对象基地址。4. 利用整数溢出漏洞向内核内存写入精心构造的数据负载。5. 触发代码执行，获取反弹Shell。投毒风险分析：针对该漏洞的投毒风险总体处于低水平，但需警惕社会工程学利用。由于SMBGhost是一个具有里程碑意义的漏洞，GitHub上存在大量以此命名的仓库。在分析中发现，绝大多数高质量仓库如chompie1337的代码是完全透明且开源的，使用了标准的Python库和C源码，未发现混淆或隐藏的恶意外部连接。低风险（15%）主要来源于一些非官方、小众的‘一键化利用工具’或预编译的EXE二进制文件。这些黑盒工具可能包含隐藏的后门、信息收集脚本（如窃取环境变量、SSH密钥）或在执行RCE的同时将攻击者的机器也变为受控端。防御研究人员在下载此类POC时，应优先选择经过安全社区背书的知名原作者仓库。对于脚本类POC，应重点审计是否存在b64decode、eval等混淆执行逻辑；对于编译后的二进制工具，必须在完全隔离的沙箱环境中运行。SMBGhost的POC代码本身逻辑复杂，编写门槛高，因此普通的‘垃圾投毒’较容易通过代码审计识别，真正的风险在于利用代码被修改后二次发布的版本。

**项目地址:** [https://github.com/chompie1337/SMBGhost_RCE_PoC](https://github.com/chompie1337/SMBGhost_RCE_PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
