## CVE-2020-0796 - Microsoft Windows RCE/LPE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE/LPE

**影响应用:** Microsoft Windows

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** Windows 10 Version 1903, Windows 10 Version 1909, Windows Server Version 1903, Windows Server Version 1909

**利用条件:** 启用SMBv3协议（默认开启），目标系统未安装2020年3月补丁，攻击者需能通过网络访问目标445端口。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本POC（cve-2020-0796.py）是一个典型的针对SMBGhost漏洞的探测性脚本。该脚本通过构造恶意的SMBv3协商请求（Negotiate Request）来验证目标是否存在漏洞。漏洞的核心成因在于Srv2.sys驱动程序在处理经过压缩的SMB2数据包时，未对解压所需的缓冲区大小进行充分校验。脚本中定义了Smb2NegotiateRequest类，特别关注了compression_context字段。在该上下文中，它声明支持LZNT1、LZ77等压缩算法，并构造了一个特定的压缩报文。当存在漏洞的服务端尝试解压此畸形报文时，会发生整数溢出，进而导致内核缓冲区溢出。目前的POC代码主要实现的是‘协商’阶段的恶意构造，其最终效果通常是导致目标系统BSOD（蓝屏死机），证明了内存破坏的可能性。然而，要实现稳定的远程代码执行（RCE），该POC还需要后续的内存布局控制（Heap Spraying）和绕过KASLR等机制，本脚本并未包含这些复杂逻辑。因此，该POC对于脆弱性检测和拒绝服务（DoS）验证是高度有效的，但不能直接作为一键式的RCE利用工具。利用步骤：1. 确认目标IP及445端口开放；2. 环境准备：安装Python 3并确保网络连通；3. 运行脚本：执行`python cve-2020-0796.py <target_ip>`；4. 观察结果：若目标系统立即崩溃并蓝屏，则证明漏洞存在。 投毒风险分析：该POC代码结构简洁清晰，使用了Python的标准库socket和struct进行底层报文构造，没有引入任何混淆过的第三方库或外部加密负载。从防御性安全研究的角度来看，代码透明度极高，研究员可以逐行审计其行为。代码中并未发现任何典型的投毒特征，如尝试连接异常的回连地址、读写本地敏感文件（如/etc/passwd或C:\Windows\System32\config\SAM）、或是调用eval/exec执行外部传入的模糊编码。虽然漏洞本身危害极大，但该脚本仅作为扫描工具使用。风险点在于，部分分发此POC的GitHub仓库或非正规安全站点可能会在README中诱导用户运行名为‘exploit.exe’的预编译二进制文件，这类二进制文件极易携带后门。本次分析的纯Python代码投毒风险极低，仅建议在受控实验环境中使用，以规避可能因误操作导致的生产环境业务中断风险。研究员应重点关注代码中是否包含硬编码的可疑IP地址或base64加密的长字符串，在本样本中未发现此类威胁。

**项目地址:** [https://github.com/Rvn0xsy/CVE_2020_0796_CNA](https://github.com/Rvn0xsy/CVE_2020_0796_CNA)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
