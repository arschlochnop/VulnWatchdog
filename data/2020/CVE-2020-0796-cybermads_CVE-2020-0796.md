## CVE-2020-0796 - Microsoft Windows Server Message Block 3.1.1 (SMBv3) 远程代码执行 (RCE)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Server Message Block 3.1.1 (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, Windows 10 Version 1909, Windows Server Version 1903, Windows Server Version 1909

**利用条件:** 无需认证，攻击者只需发送特制的压缩数据包到受影响的SMBv3服务器，或者诱导客户端连接到恶意SMBv3服务器。

**POC 可用性:** 7/10

**POC 类型:** 概念验证/蓝屏崩溃利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞被称为SMBGhost，源于SMBv3协议处理特制压缩数据包时的整数溢出。在main.py代码中，可以看到攻击者构造了包含Smb2NegotiateRequest的原始套接字数据。该漏洞的核心在于Srv2.sys驱动程序在解压缩SMB数据包时，未对OriginalCompressedSegmentSize和Offset字段进行充分的边界检查。POC通过向目标主机的445端口发送精心构造的SMB2数据包，特别是利用Negotiate Context中的压缩算法扩展，触发目标系统内存破坏。由于该POC代码实现了SMB2头部的结构化封装（Smb2Header类）和协商请求（Smb2NegotiateRequest类），其逻辑清晰且符合协议规范。目前的POC代码主要用于导致目标系统蓝屏（BSOD）或进行本地权限提升，实现稳定的远程代码执行需要极其精准的堆喷射技术。利用步骤：首先，攻击者利用Python的socket库建立与目标Windows主机445端口的TCP连接；其次，构造SMB2协商请求数据包，在NegotiateContext中声明支持压缩功能；最后，发送包含异常OriginalCompressedSegmentSize值的压缩数据段，触发内核整数溢出。投毒风险分析：该POC代码逻辑较为透明，使用了Python标准库socket和struct进行底层数据包构造，未发现明显的恶意行为。代码中引用了已知的GitHub安全研究仓库（jiansiting/CVE-2020-0796），且其包含的Cybermad Banner仅为作者署名。代码不存在混淆处理，且没有尝试连接非目标IP以外的外部控制服务器（C2）。潜在风险点在于Revolt链接（rvlt.gg/b8NFth51），这通常是黑客或研究人员的交流频道，点击此类链接可能面临社会工程学风险。整体来看，该脚本作为防御性研究工具是安全的，但在企业环境中测试时需注意，因其可能导致内核驱动崩溃，直接造成生产服务器宕机（DoS风险）。

**项目地址:** [https://github.com/jiansiting/CVE-2020-0796](https://github.com/jiansiting/CVE-2020-0796)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2020-0796](https://nvd.nist.gov/vuln/detail/cve-2020-0796)
