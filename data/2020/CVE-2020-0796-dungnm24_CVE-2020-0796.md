## CVE-2020-0796 - Microsoft Windows 10 & Windows Server 2016/2019 RCE

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE

**影响应用:** Microsoft Windows 10 & Windows Server 2016/2019

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 启用SMBv3协议，且开启了压缩功能（默认开启）

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本POC针对CVE-2020-0796（SMBGhost）漏洞，该漏洞存在于Microsoft Server Message Block 3.1.1 (SMBv3) 协议处理压缩数据包的过程中。由于对压缩数据的长度校验存在逻辑错误，攻击者通过向目标445端口发送精心构造的SMB3压缩包，可触发内核级的整数溢出，导致缓冲区溢出。代码分析显示，该C++ POC通过Winsock初始化网络连接，调用sendNegotiate建立基本的SMB协商。关键逻辑在于TriggerCrash函数，它构造了一个带有特殊协议标识（0xfc, 0x53, 0x4d, 0x42）的SMB压缩包头，并通过填充特定的buflen触发目标系统的内核崩溃（BSOD）或进一步的内存操作。该代码能够有效验证漏洞的存在性，并演示了如何利用findWinLogon等函数定位关键进程，虽然目前公开的代码片段侧重于本地提权或系统崩溃，但已具备向RCE转化的核心逻辑。利用步骤：1. 在受控主机上编译此C++项目，生成可执行文件。2. 确认目标主机的445端口开放且运行受影响的Windows版本。3. 运行程序，指定目标IP。程序首先通过sendNegotiate函数发送协商包，随后调用TriggerCrash发送构造的畸形压缩包。若目标未打补丁，系统将因内核解压缓冲区溢出而立即蓝屏或被获取高权限。投毒风险分析：该POC代码主要由标准的Windows API和网络编程库（winsock2, ws2tcpip, psapi）构成，代码逻辑清晰且透明，未发现经过混淆的恶意载荷。其引入的ntoskrnl.h属于标准的内核研究头文件。虽然README中引用的hackmd外链可能包含动态变化的内容，但就本地代码而言，并未发现诸如窃取本地凭据、反弹不明IP Shell或自我传播等典型投毒行为。风险点主要在于：此类高价值漏洞的公开POC常被二次加工，攻击者可能在编译好的二进制文件中植入木马。从源码上看，其通过EnumProcessModules搜索winlogon.exe是典型的权限提升辅助逻辑，并非针对防御者的投毒攻击。总体投毒风险评估为低，属于安全研究用途的正规POC代码。

**项目地址:** [https://hackmd.io/@AWXkSundSBCbyTFFTFC98Q/r1fAaeaH3](https://hackmd.io/@AWXkSundSBCbyTFFTFC98Q/r1fAaeaH3)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
