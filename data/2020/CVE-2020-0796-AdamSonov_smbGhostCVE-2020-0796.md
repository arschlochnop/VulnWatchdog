## CVE-2020-0796 - Microsoft Windows 10 和 Windows Server (SMBv3) RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows 10 和 Windows Server (SMBv3)

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 无需身份验证，通过网络访问 445 端口即可利用

**POC 可用性:** 7/10

**POC 类型:** 概念验证 (Scanner)

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：本POC主要由三个文件组成：requirements.txt、scanner.py和smbCVE-2020-0796.py。其中核心逻辑位于scanner.py中。该脚本通过构造一个特殊的SMB2压缩数据包并发送至目标主机的445端口。漏洞的根本原因在于Srv2.sys驱动程序在处理经压缩的SMB3.1.1协议数据包时，未对解压缓冲区的大小进行充分校验，导致整数叠加溢出。POC通过发送Negotiate请求，并观察服务器返回的响应包特征（特定偏移位置的字节码 0x11, 0x03 和 0x02, 0x00）来判断目标是否存在漏洞。这种扫描方式不需要实际触发崩溃或注入Shellcode，因此对业务系统的稳定性影响较小。经过分析，该代码逻辑严谨，能够有效识别开启了SMB压缩功能的Windows 10系统，是一个高质量的漏洞检测工具。利用步骤：1. 确保环境安装了python3和netaddr库。2. 运行主程序smbCVE-2020-0796.py，传入目标IP或包含IP列表的文件。3. 程序会调用内部的scanner.py对目标445端口进行探测。4. 根据返回的十六进制特征码，程序会输出‘Vulnerable’或‘Not vulnerable’。投毒风险分析：该POC代码表现出极高的透明度和安全性，投毒风险评级为低（10%）。代码主要使用了Python标准库（socket, struct, sys, subprocess）以及合法的第三方库netaddr。整个逻辑流程清晰：解析命令行参数 -> 读取IP列表 -> 建立TCP连接 -> 发送探测包 -> 对比响应特征。代码中没有发现任何混淆、加密混淆或动态执行（eval/exec）的可疑行为。没有尝试连接外部异常域名或IP，也没有对本地文件系统进行非授权的读写操作。唯一需要注意的是，用户在运行此类脚本时，应确保是从可信来源获取，因为恶意人员可能会在看似合法的扫描逻辑中插入反弹Shell指令，但在本分析样本中，代码完全聚焦于漏洞检测，不含任何恶意payload或后门功能。

**项目地址:** [https://github.com/chompie1337/SMBGhost](https://www.google.com/search?q=https://github.com/chompie1337/SMBGhost)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
