# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #13

**来源**: [CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md](../2020/CVE-2020-11651-ssrsec_CVE-2020-11651-CVE-2020-11652-EXP.md)

# CVE-2020-11651

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2020-11651-0xc0d_CVE-2020-11651.md](../2020/CVE-2020-11651-0xc0d_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2020-11651

**漏洞类型:** Authentication Bypass and Remote Code Execution

**影响应用:** SaltStack

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** before 2019.2.4 and 3000 before 3000.2

**利用条件:** 需要网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000 3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从salt master检索用户令牌，和/或在salt minions上运行任意命令。\n\n**漏洞利用方式：**\n1. **身份验证绕过：** 攻击者可以利用ClearFuncs类中未正确验证的方法，绕过身份验证。\n2. **信息泄露：** 绕过身份验证后，攻击者可以检索敏感信息，例如rootkey和用户token。\n3. **远程命令执行：** 攻击者可以使用检索到的令牌或利用其他未授权方法，在Salt Minion或者Master上执行任意命令。\n\n**POC代码分析：**\nPOC代码通过`salt.transport.client.ReqChannel`创建一个未加密的通信通道（`crypt="clear"`），绕过身份验证。然后，它使用此通道向Salt Master发送恶意构造的消息，利用未授权的方法执行命令。PoC中提供了ping，获取rootkey，在minion执行命令，在master执行命令，上传下载文件等功能。\n\n**投毒风险分析：**\nPoC代码本身主要功能是验证漏洞，但是存在一定的投毒风险。代码中使用了`pip`动态安装依赖库，这为潜在的供应链投毒打开了大门，虽然安装的是`salt`库。此外，`master`函数利用`cmd.exec_code`执行python代码，具有很高的权限，若攻击者修改代码，可以植入持久后门。经过分析，PoC中作者隐藏恶意代码的可能性为10%。主要依据是代码结构清晰，功能直接，虽然存在动态安装依赖，但安装的是salt官方库。主要风险在于使用者可能被其他恶意仓库替换，导致投毒。

**项目地址:** [0xc0d/CVE-2020-11651](https://github.com/0xc0d/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #2

**来源**: [CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md](../2020/CVE-2020-11651-Drew-Alleman_CVE-2020-11651.md)

## CVE-2020-11651 SaltStack 认证绕过/远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 3000.2, < 2019.2.4, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master端口（默认4505和4506）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack 中 ClearFuncs 类方法调用验证不当导致的认证绕过漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 Salt Master 上的用户令牌和/或在 Salt Minion 上执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索结果（尤其是packetstormsecurity的漏洞利用）和提供的漏洞利用代码，此漏洞利用的有效性较高。PoC代码旨在通过未授权访问来读取文件和写入文件，从而实现远程代码执行。

**投毒风险：**

分析提供的PoC代码，发现存在一定的投毒风险。虽然PoC的主要功能是利用漏洞添加用户，但是`write_file`函数存在向任意路径写入文件的能力，该函数中使用了`../../../../../../../../{path}`，虽然看似为了写入`/etc/`下的文件，但也存在构造恶意路径绕过限制写入其他敏感文件的可能性，因此具有一定的投毒风险。此外，代码中虽然有日志记录，但攻击者可以修改代码删除日志，从而隐藏其恶意行为。

**利用方式：**

1.  **认证绕过：** 利用 Salt Master 进程 ClearFuncs 类中方法调用验证不当的漏洞，绕过身份验证。
2.  **获取 Root Key：** 通过`_prep_auth_info`方法获取 Salt Master 的 Root Key。
3.  **读取任意文件：** 使用 Root Key，利用`file_roots.read` wheel 函数读取 Salt Master 上的任意文件，例如`/etc/shadow`，`/etc/passwd`文件，泄露敏感信息。
4.  **写入任意文件：** 使用 Root Key，利用`file_roots.write` wheel 函数向 Salt Master 上的任意文件写入内容，例如修改`/etc/shadow`或`/etc/passwd`文件添加恶意用户，或者写入webshell。
5.  **远程代码执行：** 通过写入恶意文件或者执行 Salt 命令，最终在 Salt Minion 上实现远程代码执行。

PoC 代码主要通过添加用户的方式进行利用，首先生成一个包含随机密码的用户，然后调用`file_roots.write` wheel 函数将用户添加到 `/etc/passwd` 和 `/etc/shadow` 文件中。代码中通过`req_channel`函数建立未授权连接，攻击者无需身份验证即可与 Salt Master 通信。


**项目地址:** [Drew-Alleman/CVE-2020-11651](https://github.com/Drew-Alleman/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #3

**来源**: [CVE-2020-11651-RakhithJK_CVE-2020-11651.md](../2020/CVE-2020-11651-RakhithJK_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack-认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器的4506端口对外开放且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 2019.2.4 之前和 3000.2 之前的版本中。Salt-master 进程的 ClearFuncs 类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可用于从 Salt Master 检索用户令牌和/或在 Salt Minion 上运行任意命令。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞被广泛利用，并且存在公开可用的PoC代码。提供的PoC代码 (poc.py) 实现了以下功能：
*   读取Root Key (`-k` 参数)：利用未授权访问漏洞，获取Salt Master的Root Key，为后续利用提供凭据。
*   在所有Minion上执行命令 (`-m` 参数)：允许攻击者在所有连接到Salt Master的Minion上执行任意命令。
*   读取Salt Master服务器上的任意文件 (`-r` 参数)：允许读取Salt Master服务器上的敏感信息，例如配置文件。
*   写入文件到Salt Master服务器 (`-w` 参数)：允许写入任意文件到Salt Master服务器，可以用来植入后门或修改配置文件。

**投毒风险分析：**
分析提供的PoC代码后，可以发现：
*   `poc.py` 主要功能是利用漏洞进行信息收集 (Root Key) 和命令执行。代码本身未发现明显的恶意行为，例如删除文件、上传恶意程序等。
*   `README.md` 和 `LICENSE` 文件都是标准的说明文档，未包含恶意代码。
*   **潜在风险：** 攻击者可能修改 `poc.py` 文件，添加恶意功能，例如在利用成功后，自动下载并执行恶意脚本。因此，使用未经验证的PoC代码存在一定的风险。
综合评估，此仓库中存在作者隐藏的投毒代码的可能性较低，但不能完全排除，风险评估为10%。

**利用方式总结：**
1.  **确定目标：** 找到运行着存在漏洞的SaltStack Master的服务器，通常是4506端口。
2.  **运行PoC：** 使用提供的PoC脚本 (`poc.py`)，可以执行以下操作：
    *   **获取Root Key：** 运行 `python3 poc.py -k <target_ip>` 获取Root Key。
    *   **远程命令执行：** 运行 `python3 poc.py -m -c '<command>' <target_ip>` 在所有Minion上执行命令。 例如, `python3 poc.py -m -c 'id' <target_ip>` 。
    *   **读取文件：** 运行 `python3 poc.py -r '<file_path>' <target_ip>` 读取Salt Master服务器上的文件。 例如, `python3 poc.py -r '/etc/shadow' <target_ip>` 。
    *   **写入文件：** 运行 `python3 poc.py -w '<file_path>' -f '<local_file>' <target_ip>` 写入文件到 Salt Master 服务器.
3.  **控制系统：** 通过远程命令执行或文件读写，最终获取对Salt Master服务器以及所有Minion的控制权。

**项目地址:** [RakhithJK/CVE-2020-11651](https://github.com/RakhithJK/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #4

**来源**: [CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md](../2020/CVE-2020-11651-appcheck-ng_salt-rce-scanner-CVE-2020-11651-CVE-2020-11652.md)

## CVE-2020-11651 SaltStack 认证绕过及远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 极高，可导致完全控制 Salt Master 和 Minion

**影响版本:** 2019.2.4 之前和 3000.2 之前的版本

**利用条件:** 攻击者能够连接到 Salt Master 的请求服务器端口 (默认 4506)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 中，由于 salt-master 进程的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。利用此漏洞，攻击者可以从 Salt Master 检索用户令牌，并在 Salt Minion 上执行任意命令。根据漏洞描述、搜索结果以及提供的漏洞利用代码，可以得出以下结论：

**有效性：**
提供的 POC 代码 (`jasperla/CVE-2020-11651-poc` 和 `AppCheck` 提供的工具) 旨在利用 CVE-2020-11651 和 CVE-2020-11652。搜索引擎结果中也有许多提及该漏洞和 PoC 的信息，包括 Rapid7 的漏洞数据库条目，以及针对 Cisco 产品的安全公告。这些信息表明，该漏洞是真实存在的，并且存在可用的 PoC 代码，因此，提供的 POC 代码很可能是有效的。

**投毒风险：**
分析提供的漏洞利用代码（AppCheck 的 `salt_rce_scanner.py` 相关文件）：

*   代码包含一个 MIT 许可证，表明作者声明了代码的版权和使用条款。
*   `README.txt` 文件详细描述了该工具的功能、安装和使用方法。
*   该工具包含两种检测方法：令牌泄露和远程代码执行（通过 DNS 查询进行带外验证）。
*   `README.txt` 中提到了 AppCheck Sentinel，用于带外检测远程代码执行。

代码中存在通过DNS查询AppCheck Sentinel服务器来验证命令执行的功能,这意味着AppCheck可以获取目标服务器的信息。虽然这不是传统意义上的“投毒”，但存在一定的安全和隐私风险，因为目标服务器的信息可能会被泄露给AppCheck。假设投毒是指作者故意在POC中隐藏恶意代码，此POC的投毒风险为10%，主要风险点在于收集目标信息。

**利用方式：**
根据漏洞信息和 PoC 代码描述，利用方式如下：

1.  攻击者连接到 Salt Master 的 4506 端口。
2.  攻击者利用 ClearFuncs 类中缺少身份验证的漏洞，调用未经授权的方法。
3.  攻击者可以通过未授权的方法检索 Salt Master 上的用户令牌。
4.  攻击者可以使用检索到的令牌在 Salt Minion 上执行任意命令。

AppCheck 提供的 POC 代码提供了两种利用方式：

*   **令牌泄露：** 尝试读取 Salt root 令牌。
*   **远程代码执行：** 通过执行 `nslookup` 命令触发 DNS 查询，来验证远程代码执行是否成功。

**项目地址:** [appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652](https://github.com/appcheck-ng/salt-rce-scanner-CVE-2020-11651-CVE-2020-11652)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #5

**来源**: [CVE-2020-11651-bravery9_SaltStack-Exp.md](../2020/CVE-2020-11651-bravery9_SaltStack-Exp.md)

## CVE-2020-11651 SaltStack 认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4 和 3000 < 3000.2

**利用条件:** 需要能够与Salt Master的4505/4506端口建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651漏洞存在于SaltStack Salt的salt-master进程中，由于ClearFuncs类未正确验证方法调用，未经身份验证的远程用户可以访问某些方法，从而可以从Salt Master检索用户令牌，或者在Salt Minion上执行任意命令。

**有效性：**
提供的POC代码利用了未经身份验证的访问来执行多种操作，包括读取文件、上传文件、执行命令，甚至获取反向shell。根据漏洞库信息和搜索结果，该漏洞利用的有效性很高。

**投毒风险：**
* 代码主要分为几个功能模块：连接Salt Master，检查漏洞版本，读取文件，上传文件，反弹shell，执行命令
* 代码中包含从GitHub仓库引用的代码，但经过代码阅读确认，引入的是正常的POC代码。
* 代码中存在远程连接功能，可能存在被利用执行恶意操作的风险。例如，攻击者可能修改代码，将反向shell的目标IP地址和端口更改为攻击者控制的服务器，从而实现恶意控制。
* 存在少量投毒风险，例如利用`cmd.exec_code`执行恶意代码。总体来看, 投毒风险预估为10%。大部分代码还是漏洞利用相关。

**利用方式：**
1.  **版本检测：**  POC首先检测Salt Master的版本，确认目标是否在受影响的范围内。
2.  **连接建立：**  POC会尝试与Salt Master建立连接，利用clear类型的连接方式绕过认证。
3.  **读取root key：**  通过_prep_auth_info方法在未授权的情况下读取root key.
4.  **文件读取/写入：**  利用读取到的root key, 可以读取Salt Master服务器上的任意文件。同理也可以上传文件。
5.  **命令执行：**  利用root key，通过`cmd.exec_code`在Salt Master或者Minion上执行任意命令。
6.  **反向Shell：**  利用root key, 可以执行反向shell代码，从而获得Salt Master的shell控制权限。
总体来说，该漏洞的利用方式是利用未经授权的访问权限，结合SaltStack的内部机制，最终实现远程代码执行。

**项目地址:** [bravery9/SaltStack-Exp](https://github.com/bravery9/SaltStack-Exp)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #6

**来源**: [CVE-2020-11651-chef-cft_salt-vulnerabilities.md](../2020/CVE-2020-11651-chef-cft_salt-vulnerabilities.md)

## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #7

**来源**: [CVE-2020-11651-dozernz_cve-2020-11651.md](../2020/CVE-2020-11651-dozernz_cve-2020-11651.md)

## CVE-2020-11651 SaltStack 身份验证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标Salt Master服务器开放4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 salt-master 进程的 ClearFuncs 类中，由于其未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，该漏洞利用有效。漏洞库和搜索引擎结果均表明该漏洞允许未经身份验证的远程代码执行。提供的 POC 代码旨在利用此漏洞，通过绕过身份验证，从 Salt Master 获取 root key，并在 Salt Minion 上执行任意命令或在 Salt Master 上获得 shell。

**投毒风险：**
提供的 POC 代码主要功能是利用漏洞，风险较低。代码逻辑较为清晰，未发现明显的恶意代码。但仍存在极小的风险：

*   **依赖风险：** 代码依赖 `salt` 库，如果该库本身被投毒，可能间接影响此 POC 的安全性。
*   **命令执行风险：**  `send_command_to_minions` 和 `master_shell` 函数允许执行任意命令，如果攻击者使用此 POC 执行恶意命令，可能对目标系统造成损害。使用者如果不对命令进行严格的审查，会存在风险。
*   **潜在后门：** 理论上，攻击者可以在 `master_shell` 中植入持久性的后门，例如修改系统文件或添加计划任务，但当前代码并未包含此类功能，需要攻击者自行添加。

综合分析，该 POC 的投毒风险较低，约为 5%。风险主要来自于使用者对命令的控制和对依赖库的信任。

**利用方式：**

1.  **漏洞定位：**  攻击者识别运行存在漏洞版本的 SaltStack Master 的目标系统。
2.  **身份验证绕过：**  利用 CVE-2020-11651 绕过 Salt Master 的身份验证。
3.  **获取 Root Key：**  通过未经授权的 ClearFuncs 方法调用，从 Salt Master 获取 Root Key。
4.  **远程代码执行：**
    *   **Minion 执行：**  使用 Root Key，通过 `_send_pub` 函数向所有 Salt Minion 发送命令，实现远程代码执行。
    *   **Master 执行：**  使用 Root Key，创建 `runner` 并调用 `cmd.exec_code` 函数，在 Salt Master 上执行任意 Python 代码，从而获得 Shell。

总而言之，该漏洞允许未经授权的攻击者在 Salt Master 和 Minion 上执行任意命令，具有极高的危害性。

**项目地址:** [dozernz/cve-2020-11651](https://github.com/dozernz/cve-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #8

**来源**: [CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md](../2020/CVE-2020-11651-hardsoftsecurity_CVE-2020-11651-PoC.md)

## CVE-2020-11651-SaltStack-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可能导致数据泄露和远程代码执行，完全控制受影响的Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 < 3000.2, 2017.*, 2018.*

**利用条件:** 需要网络访问Salt Master的4505和4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 是 SaltStack Salt 中存在的一个身份验证绕过漏洞。Salt Master 进程中的 ClearFuncs 类未能正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。通过利用这些方法，攻击者可以从 Salt Master 检索用户令牌，以及/或者在 Salt Minion 上执行任意命令。

**有效性：**

根据漏洞描述和提供的 PoC 代码，可以确定该漏洞的 PoC 代码是有效的。漏洞库信息和搜索结果都表明该漏洞是可被利用的，并且存在公开可用的 PoC 代码。

**投毒风险：**

在提供的 PoC 代码中，投毒风险较低。 代码的主要目的是验证漏洞的存在，并执行一些简单的操作，例如读取文件和写入文件。尽管代码中包含文件读取和写入操作，但这些操作都是为了验证漏洞是否存在，而不是为了植入恶意代码。但是，在实际利用中，如果攻击者使用该 PoC 代码，可以修改代码来执行恶意操作，例如下载和执行恶意软件，或者修改系统配置。因此，在使用该 PoC 代码时，需要谨慎，并采取必要的安全措施。
仔细分析代码，发现其通过 `salt.transport.client.ReqChannel.factory` 创建了一个未加密的通信通道（`crypt='clear'`），这本身是漏洞利用的一部分，而非恶意投毒。`check_CVE_2020_11652_write1`函数试图写入 `/tmp/salt_CVE_2020_11652` 文件，并在成功写入后删除该文件。这部分代码是在测试写入权限，虽然存在潜在的利用可能，但主要目的仍然是漏洞验证。
总体来看，该PoC的主要目的是验证漏洞的存在，而非实施恶意攻击。但是，需要注意，任何漏洞利用代码都可能被恶意修改和利用。

**利用方式：**

1.  **未授权访问：** 攻击者利用 ClearFuncs 类中的身份验证绕过漏洞，无需身份验证即可与 Salt Master 进行通信。
2.  **信息泄露：** 攻击者可以利用未经授权的访问来检索敏感信息，例如用户令牌和 Salt Master 的配置信息。
3.  **任意文件读取：** 攻击者可以通过 `file_roots.read` wheel 函数读取 Salt Master 上的任意文件。
4.  **任意文件写入：** 攻击者可以通过 `file_roots.write` 或 `config.update_config` wheel 函数在 Salt Master 上写入任意文件。
5.  **远程代码执行：** 攻击者可以利用文件写入漏洞来执行任意代码。例如，攻击者可以写入恶意 Salt 状态文件，然后使用 Salt Master 将其应用到 Salt Minion，从而在 Salt Minion 上执行任意命令。

攻击者通常通过以下步骤利用此漏洞：

1.  建立与目标 Salt Master 的未授权连接。
2.  利用 CVE-2020-11651 绕过身份验证。
3.  利用 CVE-2020-11652 读取敏感文件（例如 Salt Master 的 root key）。
4.  使用 root key 执行任意 wheel 函数，例如 `file_roots.write` 来写入恶意文件，或 `config.update_config` 来修改 Salt Master 的配置。
5.  在 Salt Minion 上执行任意命令。

**项目地址:** [hardsoftsecurity/CVE-2020-11651-PoC](https://github.com/hardsoftsecurity/CVE-2020-11651-PoC)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #9

**来源**: [CVE-2020-11651-jasperla_CVE-2020-11651-poc.md](../2020/CVE-2020-11651-jasperla_CVE-2020-11651-poc.md)

## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #10

**来源**: [CVE-2020-11651-kevthehermit_CVE-2020-11651.md](../2020/CVE-2020-11651-kevthehermit_CVE-2020-11651.md)

## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #11

**来源**: [CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md](../2020/CVE-2020-11651-lovelyjuice_cve-2020-11651-exp-plus.md)

## CVE-2020-11651/CVE-2020-11652 SaltStack 身份验证绕过和任意文件读取/写入漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 身份验证绕过/任意文件读取/写入

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 需要网络访问Salt Master的4505/4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 允许未经身份验证的攻击者调用 `ClearFuncs` 类中的某些方法，利用这些方法可以检索用户令牌或者在Salt Minion上执行任意命令。提供的POC代码通过 `_prep_auth_info` 方法尝试绕过身份验证，并获取 root 用户的 key，此key在后续的CVE-2020-11652利用中会被使用。

CVE-2020-11652 允许使用通过CVE-2020-11651获得的root key读取和写入Salt Master服务器上的任意文件。提供的POC代码尝试利用 `file_roots.read` 读取敏感文件，例如token文件。同时，POC也尝试使用 `file_roots.write` 写入文件到 `/tmp` 目录，验证写入权限。

**利用方式：**

1.  **身份验证绕过：**  利用CVE-2020-11651绕过Salt Master的身份验证。
2.  **获取Root Key：**  通过未授权的 `_prep_auth_info` 方法获取Root Key。
3.  **任意文件读取：**  使用Root Key和 `file_roots.read` 方法读取Salt Master上的敏感文件。
4.  **任意文件写入：**  使用Root Key和 `file_roots.write` 方法在Salt Master上写入任意文件，实现远程代码执行。

**投毒风险分析：**

该POC代码主要用于漏洞验证，但存在一定的投毒风险。例如，代码中删除了原始的版本检查逻辑，可能导致用户在已修复的系统上误判为存在漏洞，从而执行不必要的操作。另外，虽然代码本身没有明显的恶意行为，但攻击者可以修改POC，在成功利用漏洞后植入后门或执行其他恶意操作。

**投毒风险评估：**

*   **可能性：**  POC代码修改自现有脚本，作者可能在修改过程中引入恶意代码或逻辑。虽然表面上是为了方便使用，但存在潜在风险。
*   **影响：**  如果POC被修改为包含恶意代码，可能导致目标系统被植入后门，长期受控于攻击者。

**建议：**

*   使用POC时，务必从可信来源获取，并仔细审查代码，确保没有恶意行为。
*   在非生产环境中进行POC验证，避免对生产系统造成影响。
*   及时更新SaltStack到最新版本，修复漏洞。

**项目地址:** [lovelyjuice/cve-2020-11651-exp-plus](https://github.com/lovelyjuice/cve-2020-11651-exp-plus)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---

## POC #12

**来源**: [CVE-2020-11651-rossengeorgiev_salt-security-backports.md](../2020/CVE-2020-11651-rossengeorgiev_salt-security-backports.md)

## CVE-2020-11651 SaltStack 认证绕过和远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 目标系统运行存在漏洞版本的 Salt Master，攻击者需要能够与 Salt Master 建立网络连接（通常是4505和4506端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 漏洞存在于 SaltStack Salt 的 salt-master 进程中，由于 ClearFuncs 类未正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法。这些方法可用于从 salt master 检索用户令牌，或者在 salt minions 上执行任意命令。

**有效性：**
根据漏洞描述和搜索结果，以及POC代码，可以判断该漏洞利用代码有效。该漏洞在野外被积极利用。

**投毒风险：**
提供的代码是用于修补漏洞的patch文件，并非可以直接运行的利用代码。其中一个patch文件（2016.11.10_CVE-2020-11651.patch）修改了 salt/master.py 文件，通过引入 `TransportMethods` 类和 `get_method` 方法，并对 `ClearFuncs` 和 `AESFuncs` 类中允许远程调用的方法进行了显式定义，从而修复了认证绕过漏洞。 另一个patch(2016.11.10_CVE-2020-11652.patch)修复了路径遍历漏洞，可以防止token泄露。

虽然直接的投毒风险不高，但是也不能排除作者在提交历史或其它相关文件中隐藏恶意代码的可能性。此处评估的投毒风险为10%，主要考虑是需要检查整个代码仓库，才能完全排除风险。

**利用方式：**
攻击者可以利用未经身份验证的连接，调用 ClearFuncs 或 AESFuncs 中暴露的方法，实现以下目的：
1.  **获取 Minion 密钥：** 通过调用某些方法，攻击者可以获取已连接的 Minion 的密钥，从而冒充 Minion 与 Master 通信。
2.  **远程代码执行：** 获取 Minion 密钥后，攻击者可以向 Minion 发送任意命令，实现远程代码执行。

总而言之，此漏洞允许未经身份验证的攻击者在 Salt Master 和 Minion 上执行任意代码，风险极高。需要尽快升级到安全版本。

**项目地址:** [rossengeorgiev/salt-security-backports](https://github.com/rossengeorgiev/salt-security-backports)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)

---



---



---



---



---



---



---

