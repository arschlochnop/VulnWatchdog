## CVE-2020-0796 - Microsoft Windows (SMBv3) RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows (SMBv3)

**危害等级:** CRITICAL (紧急)

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 目标系统开启了SMBv3服务且支持压缩功能，无需身份验证，通过445端口进行网络访问。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：此POC代码针对的是著名的'SMBGhost'漏洞。通过分析提供的Python代码，该POC尝试通过构造特殊的SMB2 Negotiate Request数据包来触发漏洞。它定义了Smb2Header和Smb2NegotiateRequest类，特别关注了SMB 3.1.1引入的压缩上下文（Compression Context）。代码通过设置特定的压缩算法（LZNT1, LZ77）并构建畸形的协商请求，旨在测试服务端在解压不当输入时是否存在缓冲区溢出漏洞。然而，当前截断的代码仅展示了数据包的构造部分，缺乏完整的网络发送逻辑和溢出后的Payload执行部分。从安全研究角度看，该POC能有效验证目标是否存在响应异常，但不能直接实现远程代码执行。利用步骤：1. 确认目标IP地址并确保445端口可达。2. 准备Python运行环境。3. 构造包含恶意压缩上下文偏移量的SMB2协商包。4. 向目标主机发送该数据包。5. 观察目标主机是否产生蓝屏死机（BSOD）或响应中断，以验证溢出点的触发。投毒风险分析：该POC代码逻辑清晰，主要使用了Python的标准库如socket和struct，未发现任何混淆处理。代码中定义的数据包结构符合SMB2/3协议规范，没有发现尝试连接外部恶意服务器、下载远程脚本、读写系统敏感文件或执行base64编码的可疑命令。其唯一的网络活动是针对用户指定的IP和端口发送测试包，属于典型的安全漏洞扫描和验证逻辑。由于不涉及复杂的第三方依赖且逻辑完全透明，投毒风险极低，被评估为5%，主要风险仅在于安全研究人员在测试时可能因未授权操作导致目标生产系统崩溃（蓝屏）。建议在使用此类POC前，务必在隔离的实验环境中进行测试。

**项目地址:** [https://packetstormsecurity.com/files/156731/SMBGhost-Proof-Of-Concept.html](https://www.google.com/search?q=https://packetstormsecurity.com/files/156731/SMBGhost-Proof-Of-Concept.html)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
