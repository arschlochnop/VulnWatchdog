## CVE-2020-0796 - Microsoft Windows 10, Windows Server (SMBv3) RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows 10, Windows Server (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 versions 1903, 1909; Windows Server versions 1903, 1909

**利用条件:** 需要目标开启SMBv3.1.1协议（默认开启），且未安装2020年3月补丁；无需身份验证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个针对CVE-2020-0796（SMBGhost）的综合性自动化工具。它集成了由chompie1337开发的RCE利用代码和ioncodes编写的扫描器，能够自动完成漏洞检测与溢出攻击。CVE-2020-0796是由于SMBv3.1.1协议在处理压缩的数据包（Srv2.sys）时存在整数溢出漏洞，攻击者可以通过发送构造精良的压缩请求包触发缓冲区溢出。此POC的有效性极高，已在Windows 10 v1903（Build 18362.113）上测试通过。它支持通过msfvenom生成的x64反弹Shell（Stageless），并允许加载最大600字节的自定义Shellcode。利用步骤：1. 使用--check参数对目标IP进行扫描，确认是否存在SMBv3漏洞；2. 配置本地监听环境（LHOST/LPORT）；3. 使用-e参数执行漏洞利用，或通过--load-shellcode加载预先生成的恶意二进制payload。4. 漏洞触发后，系统内核会执行溢出后的Shellcode，从而获得SYSTEM权限。需要注意的是，由于利用过程涉及内核内存分配（Heap Manipulation），稳定性并非100%，可能导致目标系统蓝屏（BSOD），POC中已加入二次重试机制以提高成功率。投毒风险分析：经过对提供的代码结构分析，该项目属于典型的防御性研究封装工具。其核心逻辑依赖于公开的知名安全研究员仓库。代码中未发现明显的混淆、加密下载器或非预期网络外连行为。README文档中提供了合法的测试镜像链接（MEGA），虽属于第三方存储，但属于该研究领域的常见分享方式。风险点在于：1. 脚本通过shellcode加载功能允许执行任意指令，如果用户从未经核实的来源获取shellcode，存在执行后门风险。2. 虽然此封装脚本本身相对透明，但其依赖的外部仓库如果发生供应链篡改（如chompie1337原始仓库被劫持），则使用该工具的防御者将面临风险。3. 自动化程度高意味着该工具易被脚本小子利用于恶意目的。总体而言，该代码逻辑清晰，使用标准库，不包含恶意投毒代码，属于低至中等风险水平，主要风险来自于对外部Payload的引用和内核操作的不稳定性。

**项目地址:** [https://github.com/chompie1337/SMBGhost_RCE_PoC](https://github.com/chompie1337/SMBGhost_RCE_PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
