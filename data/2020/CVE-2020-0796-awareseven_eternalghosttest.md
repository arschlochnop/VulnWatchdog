## CVE-2020-0796 - Microsoft Windows / SMBv3 RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows / SMBv3

**危害等级:** CRITICAL (紧急)

**CVSS评分:** 10.0

**影响版本:** Windows 10 Version 1903, 1909 (32-bit, x64, ARM64); Windows Server Version 1903, 1909 (Server Core)

**利用条件:** 目标系统开启SMBv3协议并启用压缩功能；攻击者需能通过TCP端口445访问目标系统。

**POC 可用性:** 4/10

**POC 类型:** 概念验证 (漏洞检测)

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2020-0796（又称SMBGhost）是存在于Windows 10和Windows Server 2019中SMBv3.1.1协议实现的远程代码执行漏洞。该漏洞源于srv2.sys驱动程序在处理经过压缩的SMB2_WRITE请求时，未对用户提供的长度字段进行充分校验，导致在计算缓冲区大小时发生整数溢出。攻击者通过发送精心构造的压缩数据包，可以触发堆溢出，进而控制内核执行流。在POC有效性分析方面，当前提供的'eternalghost'脚本属于轻量级的概念验证工具。它并不具备执行任意代码的能力，而是通过发送协商请求（Negotiate Request）来识别服务器是否支持SMBv3.1.1以及是否启用了压缩功能。这种检测方式基于漏洞触发的前提条件，而非触发漏洞本身，因此在生产环境中运行相对安全，不会导致系统崩溃（BSOD）。该脚本通过验证目标是否具备受影响的特征来评估风险，对于防御者快速摸排内网资产漏洞情况具有较高的实用价值。利用步骤通常分为三步：首先是利用此类检测POC定位内网中暴露的445端口且满足SMBv3特征的主机；其次是针对特定偏移量构造数据包以尝试内存泄露（如需绕过KASLR）；最后是利用精心构造的恶意数据包实现代码执行。投毒风险分析显示，该POC属于低至中等风险范畴。代码逻辑清晰，主要使用标准Python网络库构建原始套接字包，未发现经过混淆的Base64指令、外部shell下载或异常的eval调用。README文档提供了德语和英语双语说明，并引用了Microsoft官方的ADV200005建议和AWARE7安全团队的博客，具有较高的可信度背景。其投毒风险主要体现在：1. 脚本中可能存在的第三方库依赖风险（如果未来添加了恶意的setup.py）；2. 社交工程学风险，攻击者可能分发修改版的.py文件，在验证逻辑后附加反弹shell代码。当前的15%风险评分主要基于此类脚本在安全社区传播中可能被中间人篡改的通用风险，而非该代码库本身包含恶意逻辑。作为防御性研究员，建议在使用前对源码进行静态审计，确保socket交互部分仅限于SMB协商报文。

**项目地址:** [https://github.com/aware7/eternalghost](https://www.google.com/search?q=https://github.com/aware7/eternalghost)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
