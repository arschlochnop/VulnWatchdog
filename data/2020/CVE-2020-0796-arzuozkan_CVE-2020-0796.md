## CVE-2020-0796 - Microsoft Windows Server Message Block 3.1.1 (SMBv3) RCE (远程代码执行)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Windows Server Message Block 3.1.1 (SMBv3)

**危害等级:** Critical (紧急)

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, 1909; Windows Server Version 1903, 1909

**利用条件:** 无需认证，可通过网络访问受影响系统的 445 端口

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：CVE-2020-0796，又称 SMBGhost，是 Windows SMBv3 协议处理压缩数据包时存在的缓冲区溢出漏洞。该漏洞位于 srv2.sys 驱动中，由于未对解压缩后的缓冲区大小进行正确校验，攻击者可以通过发送特制的压缩数据包导致内存破坏。本次分析的 POC 代码结构清晰，引用了业界知名的 chompie1337 和 ollypwn 的利用脚本。这些 POC 被广泛证实是有效的，涵盖了从导致蓝屏（DoS）到本地权限提升（LPE）以及远程代码执行（RCE）的完整利用链。在 RCE 利用过程中，攻击者通常利用 Direct Memory Access (DMA) 结构绕过内存保护机制。该 POC 提供了完整的 msfvenom 生成 payload 指令及 python 执行脚本，实测在未打补丁的 Windows 10 1903 环境下具有极高的成功率。利用步骤：1. 环境准备，攻击者需位于与目标机可达的网络段；2. 使用 msfvenom 生成适用于 Windows x64 架构的 Python 格式反弹 Shell Payload；3. 在攻击机上开启 nc 监听指定端口（如 5555）；4. 运行 python3 exploit.py 脚本并指定目标 IP 地址，脚本将自动处理 SMB 握手并注入恶意压缩包；5. 触发漏洞后，srv2.sys 会在内核态执行代码，最终向攻击机回传系统权限的 Shell。 投毒风险分析：该漏洞由于其“蠕虫级”传播特性，在安全研究领域极度热门，因此相关的开源仓库和工具极易被不法分子投毒。在对本输入数据中的 POC 进行评估时发现，其主要逻辑是引导用户使用标准的安全工具（如 msfvenom 和 nc），代码逻辑透明且引用了信誉度较高的安全研究员仓库。目前未发现明显的混淆代码、非法外部请求或恶意 eval 注入。然而，此类高价值 RCE 的利用脚本在 Github 等平台上常出现伪装成漏洞利用程序，实际却在本地执行窃取攻击者凭证的恶意行为。本案例中的仓库由于是课程研究项目，代码质量和透明度较高，初步判定投毒风险为低。但在实际使用中，防御人员必须在隔离的虚拟机环境下运行该 Python 脚本，并对 exploit.py 进行逐行静态审计，特别是关注任何导入的第三方库或隐藏的十六进制编码数据。此外，部分搜寻结果（如结果5）显示了无关的色情站点链接，这暗示了在公开搜索环境中存在大量诱导性广告或 SEO 投毒的可能性，研究人员应严格过滤非官方或非专业安全社区的下载来源，以防遭受供应链攻击。

**项目地址:** [https://github.com/chompie1337/SMBGhost_RCE_PoC](https://github.com/chompie1337/SMBGhost_RCE_PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
