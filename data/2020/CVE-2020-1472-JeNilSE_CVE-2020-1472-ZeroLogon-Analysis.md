## CVE-2020-1472 - Microsoft Windows Server / Samba 特权提升/身份认证绕过

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 特权提升/身份认证绕过

**影响应用:** Microsoft Windows Server / Samba

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** Windows Server 2008 R2及以后版本至2019; Samba 4.0及更高版本

**利用条件:** 攻击者需具备与域控制器(DC)的网络连接能力，无需任何初始身份认证凭据。

**POC 可用性:** 4/10

**POC 类型:** 概念验证/仅说明

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该项目提供的README文档记录了一次针对CVE-2020-1472（ZeroLogon）的复现尝试。该漏洞存在于Netlogon远程协议（MS-NRPC）中，由于AES-CFB8加密模式在使用全零初始化向量（IV）时存在缺陷，导致攻击者可以通过持续尝试（平均256次）来伪造身份认证。在该POC描述中，作者使用了Python、Impacket框架以及著名的zerologon_tester.py脚本。尽管作者声称在实验环境中因库兼容性问题导致最终提权步骤失败，但其记录的验证逻辑是准确的：首先通过补零填充利用加密缺陷，随后尝试将域控制器的机器账户密码设置为空字符串。此POC虽然不包含完整的、开箱即用的自动化攻击脚本，但其提供的思路和引用的第三方工具（如Impacket）是经过安全社区验证的有效手段。对于防御者而言，该项目提供的失败日志和故障排除信息反而具有极高的防御参考价值，明确了环境依赖和检测点。【利用步骤】1. 网络探测：使用nmap或类似工具扫描目标DC的445及动态RPC端口。2. 漏洞检测：运行zerologon_tester.py，通过持续发送带有全零挑战值的Netlogon身份验证请求，验证目标是否存在响应异常。3. 密码重置：利用POC逻辑调用NetrServerPasswordSet2函数，将DC机器账户的密码散列值覆盖为空字符串的散列。4. 权限提升：使用重置后的空密码通过secretsdump等工具导出域内所有账户凭据（NTLM Hash）。5. 恢复环境：为了隐蔽，攻击者通常需要将机器账户密码恢复，以避免引起域服务中断。【投毒风险分析】该存储库的投毒风险极低（约5%）。分析理由如下：1. 代码透明度：README内容清晰，主要作为实验笔记存在，未提供混淆处理的二进制文件或复杂的自动化安装脚本。2. 依赖合规：项目提及的工具如Impacket是业内知名的开源安全框架，而非来源不明的闭源黑盒软件。3. 行为特征：作者坦诚地记录了复现失败的过程和遇到的环境问题，这种行为符合安全研究员的合规研究习惯，而非恶意诱导用户下载执行。4. 恶意行为排查：文档中提到的检测点（如Event ID 5805）体现了其防御性导向，而非攻击性导向。在分析过程中未发现恶意外部域名连接、非法持久化脚本或敏感信息外传代码。然而，作为防御方仍需注意，在从GitHub克隆类似复现项目时，应始终在隔离环境中安装依赖包，防止某些变体POC在setup.py或requirements.txt中注入恶意的后门指令。本案例中的内容纯粹为技术归档，不存在投毒意图。

**项目地址:** [https://github.com/JeNilSE](https://github.com/JeNilSE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2020-1472](https://nvd.nist.gov/vuln/detail/cve-2020-1472)
