## CVE-2020-0796 - Microsoft Windows Server Message Block 3.1.1 (SMBv3) RCE/DoS

**漏洞编号:** CVE-2020-0796

**漏洞类型:** RCE/DoS

**影响应用:** Microsoft Windows Server Message Block 3.1.1 (SMBv3)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Windows 10 Version 1903, Windows 10 Version 1909, Windows Server Version 1903, Windows Server Version 1909

**利用条件:** 无需身份验证，需通过网络访问开启了SMBv3服务的受影响系统

**POC 可用性:** 8/10

**POC 类型:** 概念验证/拒绝服务

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC代码旨在验证CVE-2020-0796（又称SMBGhost）的漏洞存在性。该漏洞根源于Windows SMBv3协议在处理畸形的压缩数据包时，未对解压转换头中的‘Offset’字段进行严格的边界检查。POC通过修改smbprotocol库，在SMB2CompressionTransformHeader中将original_size设置为实际大小，但将offset字段强制设置为4294967295（即0xFFFFFFFF）。当受影响的Windows系统接收到此非法偏移值并尝试进行解压操作时，内部子程序会发生整数溢出，导致内核缓冲区溢出，最终引发系统蓝屏死机（BSOD）。该POC功能完整，直接展示了触发内存损坏的关键点，其代码逻辑清晰地对应了漏洞成因，虽仅实现了拒绝服务（DoS）效果，但其构造的溢出路径是实现远程代码执行（RCE）的基础。有效性极高，能够稳定触发受影响系统的崩溃。【利用步骤】1. 准备一台安装有Python 3环境的攻击机；2. 安装必要的依赖（如cryptography等，注意README中提到的smbprotocol修改版）；3. 运行脚本并指定目标主机的IP或主机名：`./CVE-2020-0796.py <Target_IP>`；4. 脚本会与目标主机的445端口建立SMB连接，并发送带有畸形压缩偏移字段的认证请求；5. 目标系统因内核驱动（srv2.sys）在处理请求时发生内存破坏而立即崩溃重启。【投毒风险分析】经过对提供的POC代码（CVE-2020-0796.py）及README的静态审计，其投毒风险极低（约5%）。首先，代码逻辑完全基于标准的smbclient库扩展，主要逻辑集中在对SMB2协议报文结构的字段修改，不存在混淆、加壳或动态加密行为。其次，代码中没有发现任何试图外连未知IP、下载远程Payload或执行本地Shellcode的可疑动作。README文档详细解释了漏洞原理和利用方式，引用了正规的开源库（jborean93/smbprotocol和you0708/lznt1），这符合安全研究人员的分享习惯。唯一潜在的风险点在于requirements-test.txt中可能存在的供应链依赖，但基于目前展示的核心POC代码片段，未见恶意后门或数据外泄行为。该脚本属于典型的漏洞原理验证代码，而非封装好的恶意攻击工具，适合防御方进行漏洞复现和防火墙签名规则验证。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2020-0796](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2020-0796)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)
