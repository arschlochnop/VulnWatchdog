## CVE-2020-1472 - Microsoft Windows Server 特权提升

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 特权提升

**影响应用:** Microsoft Windows Server

**危害等级:** 紧急

**CVSS评分:** 10.0

**影响版本:** Windows Server 2008 R2 up to Windows Server 2019

**利用条件:** 需要能够通过网络访问域控制器，无需初始认证凭据

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC针对的是CVE-2020-1472（Zerologon）漏洞，这是一个极其严重的加密实现漏洞。Netlogon远程协议（MS-NRPC）在身份验证过程中错误地使用了AES-CFB8加密模式，且其初始化向量（IV）被硬编码为全零。由于AES-CFB8的特性，当明文和密钥的某些位满足特定条件时，全零的IV会导致全零的密文。在Netlogon的挑战-响应机制中，攻击者通过发送全零的客户端挑战，平均每256次尝试就有一次能通过校验。该POC实现了完整的利用链：首先通过约2000次的循环调用尝试（确保极高成功率）绕过身份验证；随后利用I_NetServerPasswordSet2接口，将目标域控制器的机器账户密码重置为空（NT hash为31d6cfe0d16ae931b73c59d7e0c089c0）。利用步骤如下：1. 侦察阶段，获取目标域控制器的FQDN、NetBIOS名称及机器账户名（通常为hostname$）。2. 爆破阶段，持续向DC发送包含8字节全零挑战的NetServerReqChallenge和NetServerAuthenticate2请求，直到服务器返回成功状态码。3. 密码重置阶段，一旦认证通过，立即调用NetServerPasswordSet2函数将机器账户密码设为空。4. 后渗透阶段，使用空密码通过Pass-the-Hash技术提取域内所有账号凭据。此POC逻辑清晰，直接调用RPC接口，是高度有效的利用工具。投毒风险分析：该POC代码结构透明，主要由C++编写并配合Visual Studio编译环境。分析其提供的README和逻辑流程，代码的核心功能集中在Netlogon协议的RPC通信上。虽然这是一个极其危险的漏洞利用脚本，但从安全研究角度看，其代码行为符合漏洞验证的预期。投毒风险主要存在于以下几个方面：首先，此类针对核心基础设施（AD域控）的工具常被黑客二次打包，在第三方下载渠道可能被植入异步执行的Shellcode或反弹Shell。其次，由于该漏洞利用后会破坏域控的机器账户密码，导致域控脱离域环境（脱域），若POC中未包含自动恢复密码的restore逻辑，将对生产环境造成不可逆的破坏，这种‘破坏性利用’在某种意义上也被视为一种恶意行为。然而，就目前分析的代码片段而言，其依赖项为标准的Windows SDK，未发现混淆代码、隐藏的外部网络请求或Base64加密的恶意payload，其投毒风险处于低位（约10%），主要风险点在于其破坏性后果而非代码层面的后门。建议防御者在受控隔离环境中使用，并确保拥有恢复机器账户密码的备份方案。

**项目地址:** [https://github.com/dirkjanm/CVE-2020-1472](https://github.com/dirkjanm/CVE-2020-1472)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)
