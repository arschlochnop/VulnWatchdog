## CVE-2020-1472 - Microsoft Windows Server 特权提升/加密实现缺陷

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 特权提升/加密实现缺陷

**影响应用:** Microsoft Windows Server

**危害等级:** 关键 (Critical)

**CVSS评分:** 10.0

**影响版本:** Windows Server 2008 R2 up to Windows Server 2019

**利用条件:** 需要网络访问权限，可直接访问域控制器（DC）的Netlogon服务端口，无需初始认证凭据。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：此披露的POC代码是针对CVE-2020-1472（Zerologon）漏洞的高度完整实现。该漏洞源于Netlogon远程协议中AES-CFB8加密算法的不当使用，特别是将初始化向量（IV）固定为全零，导致在256次身份验证尝试中平均有一次会成功。提供的POC详细展示了从目标选择、挑战请求到身份验证绕过的全过程。代码逻辑清晰，涵盖了关键的I_NetServerReqChallenge和I_NetServerAuthenticate2调用。该POC不仅证明了漏洞的存在（Tester模式），还包含了破坏性的利用逻辑（Exploit模式），即通过I_NetServerPasswordSet2接口强制将域控机器账户的密码重置为空（NT hash为31d6cfe0d16ae931b73c59d7e0c089c0）。通过这种方式，攻击者可以瞬间获取域管权限。经分析，该POC逻辑符合已知的技术细节，能够实现在未授权情况下接管AD域控，具有极高的实战有效性和破坏力。利用步骤：首先，攻击者需要定位目标域控制器的FQDN和NetBIOS名称；其次，通过发送全零的Client Challenge持续尝试与Netlogon服务建立安全通道，直至绕过校验；一旦绕过成功，立即调用密码设置函数将DC机器账户密码置空；最后，利用置空后的哈希值通过Pass-the-Hash（如使用impacket工具包中的secretsdump）导出域内所有账户凭据。投毒风险分析：该POC项目主要由C#编写（针对Visual Studio环境），代码结构规范，使用了标准的Windows API和网络库，未发现明显的恶意混淆、加密shellcode插入或非必要的外部域名请求。从提供的README和代码片段看，其行为完全符合漏洞利用的技术路径。然而，作为一种具备‘一键式’重置密码功能的极高危险工具，风险点在于：1. 破坏性风险：该POC在执行成功后会直接修改域控机器账户密码，这会导致域控与域内其他服务器的同步中断，若不及时执行密码恢复脚本（如restorepassword.py），将造成生产环境瘫痪。2. 获取来源风险：虽然此POC本身代码透明度高，但由于其威力巨大，在非法黑产分发渠道中极易被二次打包，植入反弹Shell或键盘记录器。3. 误报风险：安全研究员在测试时若不慎在真实环境运行，其造成的密码更改行为会被EDR或监控系统判定为最高级别的安全事件。综合评估，该原生代码库投毒风险较低，属于开源安全研究范畴，但使用过程中的环境破坏风险极高，必须在受控实验室内进行。

**项目地址:** [https://github.com/dirkjanm/CVE-2020-1472](https://github.com/dirkjanm/CVE-2020-1472)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)
