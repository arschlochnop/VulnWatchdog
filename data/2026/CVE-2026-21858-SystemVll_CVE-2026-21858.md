## CVE-2026-21858 - n8n Workflow Automation Platform 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n Workflow Automation Platform

**危害等级:** 关键 (Critical)

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

**影响版本:** 1.65.0 - 1.120.x

**利用条件:** 无需认证，需要网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2026-21858，代号“Ni8mare”，是n8n工作流自动化平台中发现的一个极其严重的远程代码执行（RCE）漏洞，影响版本1.65.0至1.120.x。该漏洞的CVSSv3.1评分为10.0（Critical），表明其具有最高级别的危害性。未经身份验证的远程攻击者可利用此漏洞，完全控制受影响的n8n实例及其底层服务器。

**漏洞技术细节与攻击链：**
该漏洞的根源在于n8n的表单（Form）节点在处理用户提供的HTTP请求时，存在对Content-Type头部验证不足以及输入参数净化不当的问题。具体而言，当n8n的工作流通过公共访问的表单触发器接收和处理用户提交的数据时，它未能正确识别和处理恶意构造的Content-Type头部，同时结合了路径控制缺陷。这使得攻击者能够绕过预期的数据处理逻辑和安全沙箱。攻击链通常涉及以下几个关键步骤：
1.  **Content-Type混淆与路径控制**：攻击者利用Content-Type验证的弱点，结合路径遍历或文件包含技术，能够诱导n8n应用程序读取或写入非预期的文件路径。
2.  **任意文件读取（Arbitrary File Read）**：通过上述技术，攻击者能够读取服务器上的敏感文件，例如配置文件、环境变量、会话令牌或API密钥等，这些文件可能包含用于鉴权或进一步攻击的关键信息。
3.  **令牌伪造（Token Forge）**：获取到敏感信息后，攻击者可以利用这些数据伪造有效的认证令牌，从而绕过n8n的身份验证机制，获得更高的操作权限，甚至以管理员身份访问系统。
4.  **沙箱绕过（Sandbox Bypass）**：n8n作为工作流自动化平台，通常会使用沙箱机制来限制工作流的执行权限。然而，此漏洞允许攻击者通过特定方式绕过这些限制，使得恶意代码能够在沙箱外部或以更高权限执行。
5.  **远程代码执行（RCE）**：最终，通过上述步骤的组合，攻击者可以上传恶意Payload并在服务器上执行任意代码，实现对整个n8n实例及底层操作系统的完全控制。这可能导致数据泄露、系统篡改或彻底瘫痪。

**POC有效性分析：**
提供的POC内容是针对CVE-2026-21858漏洞的一个安全研究工具的README文档。该文档具备高度的专业性和完整性，详细阐述了漏洞的各项要素，包括其标识符、CVSS评分、CWE分类、受影响的供应商和产品、披露日期、补丁可用性等。更重要的是，它提供了关于漏洞利用的执行摘要、影响评估、受影响版本、技术分析（包括漏洞根源、攻击向量、利用复杂性）、前置条件、安装指南、使用方法、输出参考、检测方法、缓解措施以及安全声明。这种详尽的文档结构和内容表明，该POC不仅仅是概念性的验证，而是一个功能完备、可用于实际检测和验证漏洞的工具。它明确指出攻击者可利用特制的表单工作流，实现未经授权的文件系统访问和命令执行，印证了其作为“完整利用”类型POC的有效性。其清晰的指导和对漏洞深层机制的揭示，使其在安全研究和防御部署中具有极高的实用价值。

**利用步骤：**
1.  **目标识别**：攻击者首先扫描并识别互联网上运行的、存在漏洞版本（1.65.0 - 1.120.x）的n8n实例，这些实例通常暴露了公开可访问的表单节点。
2.  **构造恶意请求**：攻击者利用Content-Type混淆和路径控制缺陷，精心构造包含恶意Payload的HTTP请求，目标直指n8n的表单工作流端点。Payload旨在触发文件读取、令牌伪造和沙箱绕过等前置步骤。
3.  **Payload注入与执行**：通过表单输入字段将恶意Payload注入到n8n的处理流程中。由于输入验证不足，Payload被n8n应用程序处理，并以n8n服务账户的权限在底层系统上执行。
4.  **实现完全控制**：一旦Payload成功执行，攻击者即可实现任意文件操作、执行系统命令，并最终获得对n8n实例及承载服务器的远程代码执行能力，从而实现对系统的完全控制，包括数据窃取、篡改或植入后门。

**投毒风险分析：**
对于提供的POC代码——即该安全研究工具的README文档，其本身是纯文本文件，不包含任何可执行代码。因此，其直接被注入恶意代码（投毒）的风险评估为极低，接近于0%。文档内容专注于漏洞的合法研究和技术分析，未显示任何代码混淆、链接至可疑外部资源或暗示恶意行为的迹象。基于此，我们将其投毒风险百分比设置为5%，以反映理论上存在的极小可能性（例如，文档本身的意外损坏或极罕见的文本注入攻击）。
然而，需要强调的是，尽管POC描述本身是安全的，但如果用户从非官方、不可信的渠道获取并下载由该README所描述的实际可执行POC工具，则面临的投毒风险会显著增高。恶意行为者经常利用热门漏洞的POC作为诱饵，在其中捆绑恶意软件，如后门、加密货币挖矿程序或信息窃取器，从而对下载并执行这些工具的用户造成“二次感染”。为最大限度地降低此类供应链攻击风险，建议组织和个人始终遵循以下最佳实践：
*   **信任来源**：仅从n8n官方安全公告、NVD（国家漏洞数据库）、知名安全厂商报告或可信赖的开源项目（如GitHub上的官方仓库）获取漏洞分析报告和POC工具。
*   **验证完整性**：下载后务必对文件进行哈希（如SHA256）校验，并与官方提供的哈希值进行比对，确保文件在传输过程中未被篡改。
*   **隔离环境**：在独立的、与生产环境隔离的沙箱或虚拟机环境中测试任何新的POC工具，限制其潜在的恶意影响。
*   **安全审计**：对任何第三方安全工具的源代码进行安全审计（如果可行），确保其行为符合预期且不包含恶意组件。
遵循这些预防措施对于保护系统免受攻击至关重要，尤其是在处理高危远程代码执行漏洞相关的安全工具时。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
