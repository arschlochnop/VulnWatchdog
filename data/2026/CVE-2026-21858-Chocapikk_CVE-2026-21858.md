## CVE-2026-21858 - n8n (自动化工作流平台) 未授权远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 未授权远程代码执行 (RCE)

**影响应用:** n8n (自动化工作流平台)

**危害等级:** CRITICAL (严重)

**CVSS评分:** 10.0

**影响版本:** <= 1.65.0

**利用条件:** 无，受影响的实例需暴露于互联网，且配置有特定工作流（如带有文件上传表单的Respond节点）

**POC 可用性:** 9/10

**POC 类型:** 完整利用链 (Full Chain)

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC展示了一个名为'Ni8mare'的高完整性利用链，结合了两个CVE漏洞：CVE-2026-21858（任意文件读取）和CVE-2025-68613（沙箱绕过/表达式注入）。POC的有效性极高，因为它通过Content-Type混淆手段绕过了身份验证，直接读取服务器上的敏感配置文件。关键点在于利用n8n对多部分表单数据处理不当，允许攻击者读取'/proc/self/environ'获取HOME目录，进而读取'$HOME/.n8n/config'获取加密密钥（encryptionKey），并提取'$HOME/.n8n/database.sqlite'中的管理员凭据。通过这些敏感信息，POC能够伪造合法的管理员JWT令牌。一旦获得管理权限，攻击者利用CVE-2025-68613在表达式引擎中注入恶意JavaScript代码。由于n8n的JS沙箱在旧版本中存在缺陷，攻击者可以通过特定的原型链污染或vm2/node原生对象调用逃逸出沙箱，最终实现底层系统的命令执行。与Cyera最初报告的利用方式相比，此POC更具威胁性，因为它不依赖于默认禁用的'Execute Command'节点，而是利用了默认开启的表达式注入，且整个过程已被自动化Python脚本覆盖。利用步骤：1. 发起构造的HTTP POST请求，利用CVE-2026-21858读取目标服务器的'/proc/self/environ'以定位n8n根目录。2. 顺藤摸瓜读取数据库文件和配置文件，提取加密盐值和管理员Hash。3. 在本地利用提取的encryptionKey离线生成伪造的管理员会话Cookie（JWT）。4. 携带伪造的Cookie调用n8n API创建一个包含恶意表达式的工作流。5. 触发该工作流，通过表达式注入实现沙箱逃逸并执行系统命令。投毒风险分析：该POC来源具有一定的专业背景，代码逻辑清晰，主要使用了Python的标准网络请求库，未发现明显的代码混淆或恶意二进制包下载行为。然而，由于该脚本具有高度的自动化属性（一键RCE），且在披露后仅9小时即由AI辅助生成，其作为武器化工具的倾向非常明显。虽然脚本本身暂未检测到植入后门或窃取研究者信息的恶意代码，但其集成的自动化攻击模块极易被不法分子直接引用。研究人员在运行此类POC时，应严格在隔离的沙箱环境（如Docker）中操作。此外，考虑到脚本提到使用了AI自动化patch diff生成的代码，其对目标环境的探测逻辑可能包含一些不确定的侧信道请求，虽不属于传统意义上的投毒，但可能导致非预期的网络泄露。整体评估，代码投毒风险较低，但工具本身的破坏性极强，属于高威胁资产。

**项目地址:** [https://github.com/Chocapikk/CVE-2026-21858](https://github.com/Chocapikk/CVE-2026-21858)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2026-21858](https://www.google.com/search?q=https://nvd.nist.gov/vuln/detail/CVE-2026-21858)
