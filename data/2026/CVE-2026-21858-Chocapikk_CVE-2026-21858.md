## CVE-2026-21858 - n8n 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** n8n <= 1.65.0 (CVE-2026-21858); n8n >= 0.211.0 (CVE-2025-68613)

**利用条件:** 需要目标配置有包含文件上传或表单响应的特定工作流（Workflow），无需初始身份认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC展示了一个名为‘Ni8mare’的高级漏洞利用链，通过结合CVE-2026-21858（任意文件读取）和CVE-2025-68613（沙盒绕过与表达式注入）实现完整的远程代码执行。利用过程首先利用CVE-2026-21858的Content-Type混淆漏洞绕过认证读取系统敏感文件。POC能够精准定位并读取/proc/self/environ以获取环境变量及HOME目录，进而读取n8n的config文件获取encryptionKey，并从database.sqlite中提取管理员凭据。通过这些信息，POC在本地伪造有效的Admin JWT令牌。第二阶段利用CVE-2025-68613，通过已获得的管理员权限创建一个包含恶意表达式注入的工作流。由于n8n在处理某些表达式时存在沙盒绕过缺陷，攻击者可以执行任意系统命令。该POC的有效性极高，因为它摒弃了原始研究中需要AI组件的限制，转而利用更通用的表单响应节点，且提供了全自动化的Python脚本，将原本复杂的攻击链简化为一键式操作。经过对README和代码结构的分析，其逻辑闭环且针对性极强。利用步骤：1. 扫描目标n8n实例是否存在暴露的Form/Webhook节点；2. 发送构造的恶意请求触发CVE-2026-21858读取敏感配置文件和SQLite数据库；3. 本地解析数据库并使用提取的密钥生成伪造的管理员Session Cookie；4. 使用伪造Cookie调用API创建恶意工作流；5. 在工作流节点中注入Payload，通过沙盒绕过执行宿主机命令；6. 触发工作流完成RCE。投毒风险分析：该POC目前表现为较低风险的开源防御研究代码，但仍需高度警惕。代码逻辑清晰，使用了标准的Python库（如requests, sqlite3等），未发现明显的代码混淆、远程Shellcode拉取或二进制后门注入行为。README中明确标注了这是一项针对性的POC而非通用利用工具，且公开了开发者GitHub身份（Chocapikk）。然而，考虑到此类漏洞的高危害性（CVSS 10.0），存在被第三方“二次打包”投毒的可能。防御者在下载此类POC进行复现时，应重点检查脚本中是否存在向非常规外部IP发送数据的socket通信，或是在生成的JWT令牌中是否硬编码了攻击者控制的私钥。此外，自动化脚本中关于数据库解析的部分，如果存在恶意构造的二进制处理逻辑，可能会在分析机本地触发溢出漏洞。当前版本的POC主要风险在于其极高的易用性，极大降低了攻击者的门槛，而非代码本身的恶意投毒倾向。

**项目地址:** [https://github.com/Chocapikk/CVE-2026-21858](https://github.com/Chocapikk/CVE-2026-21858)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2026-21858](https://www.google.com/search?q=https://nvd.nist.gov/vuln/detail/CVE-2026-21858)
