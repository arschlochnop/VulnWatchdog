## CVE-2026-21858 - n8n Workflow Automation Platform 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n Workflow Automation Platform

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** 1.65.0 to 1.121.0 (exclusive)

**利用条件:** 无需认证, 网络可访问, 无需用户交互

**POC 可用性:** 9/10

**POC 类型:** 漏洞检测 (Detection)

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2026-21858，代号“Ni8mare”，是n8n工作流自动化平台中一个极其严重的未认证远程代码执行（RCE）漏洞。该漏洞的根源在于“基于表单工作流中的Content-Type混淆”以及“不当的Webhook请求处理”，这使得攻击者能够执行任意文件读取、绕过认证，并最终实现对服务器的完全控制。

**POC有效性分析：**
所提供的POC是一个Nuclei YAML模板（CVE-2026-21858.yaml），其明确设计目的是用于**检测**，而非直接利用该漏洞。此POC旨在通过检查n8n实例公开的版本信息来识别易受攻击的目标。模板通过向n8n应用程序的常见入口点（如`/signin`、`/login`以及根路径`/`）发起良性的HTTP GET请求。当收到HTTP 200 OK响应后，模板会细致地解析HTML响应体，特别是查找形如`<meta name="n8n:config:sentry" content="[BASE64_STRING]"`的meta标签。此标签通常包含base64编码的配置数据，其中经常包含应用程序的版本信息。接着，从`content`属性中提取出的base64字符串被解码，并应用正则表达式（`.*n8n@([0-9]+\.[0-9]+\.[0-9]+).*`）来精确提取n8n的版本号（例如“1.65.0”）。最后，提取到的版本号会通过一个DSL（领域特定语言）条件`compare_versions(version, "< 1.121.0")`进行比对，以判断其是否小于1.121.0，该版本是已知的漏洞修复阈值。如果满足HTTP 200状态码、响应体包含“n8n”字样以及版本号符合漏洞条件，POC便会报告发现漏洞。这种方法对于其旨在**被动检测**的目标而言是高效且可靠的。它能在不进行任何认证或复杂交互的情况下，准确识别易受攻击的n8n部署，且不会对目标系统造成任何潜在的损害。然而，需要明确的是，此模板仅用于指示系统存在漏洞，不包含实际的RCE利用载荷；真正的RCE利用需要单独的、主动的攻击手段来利用Content-Type混淆的特性。

**利用步骤：**
1.  **环境准备**：确保本地已安装Nuclei扫描器，并将此CVE-2026-21858的Nuclei模板导入。此模板可作为防御性安全检查的一部分。
2.  **目标识别**：运行Nuclei扫描器，将此模板应用于疑似运行n8n的目标实例。例如，执行命令`nuclei -t CVE-2026-21858.yaml -u http://target-n8n.com`。
3.  **信息收集**：模板会自动向目标n8n应用程序的`/signin`、`/login`或根路径发送HTTP GET请求，以获取公开可用的HTML内容。
4.  **版本分析**：在接收到目标服务器的HTTP 200 OK响应后，模板会解析HTML，从中提取`<meta name="n8n:config:sentry"`标签内的base64编码内容。此内容随后被解码，并通过预设的正则表达式（`.*n8n@([0-9]+\.[0-9]+\.[0-9]+).*`）解析出精确的n8n版本号。
5.  **漏洞确认**：如果解析出的n8n版本号被判断为低于`1.121.0`（即符合漏洞条件），且响应体中包含“n8n”字样，则该模板会确认目标系统存在CVE-2026-21858漏洞。此结果表明目标系统容易受到Ni8mare攻击。
6.  **实际利用（额外步骤）**：一旦检测到目标系统存在漏洞，攻击者若要实现远程代码执行，将需要依赖专门的利用工具或手工构造恶意的HTTP请求。根据漏洞的特性（Content-Type混淆和不当的Webhook处理），攻击者将构造特定的请求，例如恶意的webhook请求或带有特制表单数据的请求，以欺骗n8n服务器执行任意命令。这可能涉及远程文件上传、绕过身份验证机制，最终导致在n8n服务器上执行任意代码，从而获得服务器的完全控制权。请注意，本POC仅提供检测能力，不包含用于实际利用的攻击载荷。

**投毒风险分析：**
对所提供的Nuclei POC模板进行详尽分析后，可以明确评估其投毒风险为0%。此模板是纯粹的声明式YAML文件，其功能仅限于发送HTTP GET请求和解析响应中的文本数据。代码中不包含任何可执行脚本（如Shell、Python、JavaScript等），也没有引用外部可执行文件或通过`eval`等函数执行动态代码。所有的数据处理操作（如base64解码和正则表达式匹配）均由Nuclei引擎在本地安全地执行，不会对目标系统造成任何写入、修改或破坏性的操作。POC的行为高度透明，只针对目标n8n Web服务器的几个标准公共路径发起GET请求，属于被动且非侵入性的信息收集范畴。它不涉及任何尝试上传文件、注入数据库、篡改系统配置或进行任何可能导致系统不稳定的行为。此外，该模板没有任何外部可疑依赖，不尝试连接任何C2服务器、下载恶意载荷或进行其他未经授权的外部通信。其代码未经过任何混淆或加密处理，可读性极高，易于安全研究人员审计其完整操作流程。综上所述，该Nuclei POC是一个完全良性且无害的漏洞检测工具。组织可以安全地利用此POC来评估其n8n部署的安全性，而无需担心引入任何恶意软件或对系统造成损害。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
