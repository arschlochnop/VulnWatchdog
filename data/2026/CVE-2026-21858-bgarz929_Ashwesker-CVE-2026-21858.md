## CVE-2026-21858 - n8n 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n

**危害等级:** Critical

**CVSS评分:** 10.0

**影响版本:** 小于 1.121.0

**利用条件:** 无需认证，通过网络访问公开的Webhook或表单端点即可利用

**POC 可用性:** 8

**POC 类型:** 概念验证 (仅检测)

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2026-21858，代号“Ni8mare”，是n8n自动化工作流平台中一个严重的未经身份验证的远程代码执行（RCE）漏洞。该漏洞的CVSS评分为10.0（最高严重性），影响所有版本低于1.121.0的n8n自托管实例。漏洞的核心在于n8n的表单（Form）节点在处理HTTP请求时，未能正确验证`Content-Type`头部，导致存在“Content-Type混淆”逻辑错误。`prepareFormReturnItem`函数在未验证请求类型的情况下，盲目信任`req.body.files`的内容。攻击者可以利用此缺陷，通过类型混淆覆盖`req.body.files`对象，操纵文件路径参数。未经身份认证的攻击者可通过构造特定JSON请求，在暴露的Webhook或表单端点上实现任意文件读取、身份验证绕过，并最终完全接管n8n服务器。n8n通常存储API令牌、OAuth凭证、数据库访问权限和云密钥等敏感信息，因此该漏洞一旦被利用，攻击者可迅速以此为跳板，渗透到更广泛的企业基础设施中，造成极其严重的后果。此漏洞于2026年1月7日披露。

POC有效性分析
提供的POC是一个Nuclei模板 (`CVE-2026-21858.yaml`)，明确设计用于漏洞的“检测”，而非完整的RCE利用。该模板通过GET请求访问n8n实例的常见登录或主页路径（`/signin`, `/login`, `/`），从HTML响应中提取`n8n:config:sentry` meta标签内容（Base64编码的配置信息）。POC随后解码此Base64字符串，并使用正则表达式提取n8n的版本号。最后，通过Nuclei DSL的`compare_versions`函数，将检测到的版本号与已知易受攻击的版本范围（小于1.121.0）进行比较。如果版本符合条件且HTTP状态码为200，响应体包含“n8n”，则判定目标可能存在漏洞。此POC检测逻辑清晰有效，利用了n8n在公共页面暴露版本信息的特性。对于防御方，这是一个非常有用的非侵入性工具，可快速扫描环境中的n8n实例是否存在风险。但需明确，该POC本身不包含任何用于实际触发RCE的Payload或利用链，仅为版本识别器。因此，其“POC质量评分”为8分，因其是一个功能完整且可靠的“检测”型POC，但并非“完整利用”型。

利用步骤
1.  目标识别: 攻击者通过Shodan等搜索引擎，结合POC中提供的`shodan-query`指纹信息识别暴露在互联网上的n8n实例。
2.  版本检测: 攻击者使用类似提供的Nuclei模板，访问n8n公共页面（如`/signin`、`/login`），从HTML响应的`<meta name="n8n:config:sentry" ...>`标签中提取并解码Base64编码的配置信息，获取n8n版本号。
3.  漏洞判断: 如果检测到的n8n版本低于1.121.0，则判定实例易受攻击。
4.  构造恶意请求: 攻击者根据漏洞原理（“Content-Type混淆”和对`req.body.files`的未验证信任），构造恶意的HTTP请求。此请求将针对n8n的表单Webhook端点，混淆`Content-Type`头部，并在请求体中包含特制JSON数据以操纵文件路径参数。
5.  触发RCE: 发送构造好的恶意HTTP请求到目标n8n实例的Webhook或表单端点。n8n处理该请求时，由于逻辑缺陷，恶意文件路径参数被信任并处理，最终导致远程代码执行。这可实现任意文件读取、写入或直接执行系统命令，从而完全控制n8n服务器。
6.  后续渗透: RCE成功后，攻击者可访问n8n存储的API令牌、OAuth凭证等敏感信息，并以此为跳板渗透到企业内部网络或云环境。

投毒风险分析
提供的POC代码（`CVE-2026-21858.yaml`）在投毒风险方面被评估为0%。这一低风险评级基于对代码内容的严格审查和分析。该POC是一个标准的Nuclei模板文件，结构和语法符合Nuclei的安全规范，不包含任何可执行二进制文件、混淆代码、恶意外部链接或嵌入恶意负载。POC的操作完全透明，仅执行以下操作：向目标URL发送常规GET请求（访问公共可访问路径，如`/signin`、`/login`），从HTTP响应HTML中提取特定`<meta>`标签属性（被动信息收集），对提取到的Base64编码字符串进行本地解码，使用正则表达式提取版本信息，以及使用Nuclei DSL功能进行版本号比较。所有这些步骤旨在非侵入性地识别目标n8n实例的版本并判断其是否易受攻击。代码中未发现任何尝试下载或执行外部脚本、利用`eval()`函数、进行DNS解析请求到可疑域，或进行其他可能导致恶意行为的API调用。该POC的目的是帮助安全研究人员和防御团队快速识别易受CVE-2026-21858攻击的n8n实例，以便及时修补。鉴于其行为的透明性和无害性，使用此POC进行安全扫描不会引入额外的投毒风险，可放心用于防御性安全评估。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
