## CVE-2026-21858 - n8n Workflow Automation Platform 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n Workflow Automation Platform

**危害等级:** Critical

**CVSS评分:** 10.0 (Maximum)

**影响版本:** 1.65.0 to 1.121.0 (exclusive)

**利用条件:** Unauthenticated, network-accessible, no user interaction required.

**POC 可用性:** 9/10

**POC 类型:** Detection (Nuclei Template)

**攻击复杂度:** Low

**投毒风险:** 0%

## 详情

CVE-2026-21858，代号“Ni8mare”，是一个针对n8n工作流自动化平台的关键级未授权远程代码执行（RCE）漏洞。该漏洞因基于表单工作流中的Content-Type混淆引起，允许攻击者进行任意文件读取、绕过认证，并最终实现对整个服务器的完全控制。该漏洞的CVSS评分为10.0（最高分），表明其具有极高的危害性。攻击复杂度低，无需认证和用户交互即可通过网络进行利用，使其成为极具吸引力的攻击目标。

**POC有效性分析：**
提供的POC是一个名为`CVE-2026-21858.yaml`的Nuclei模板，其明确目的为“n8n Ni8mare RCE (Detection)”，即漏洞检测。该模板通过向目标n8n实例的常见入口路径（如`/signin`、`/login`、`/`）发送标准的HTTP GET请求来运作。它会从这些页面返回的HTML响应中，通过正则表达式提取`n8n:config:sentry`元标签中Base64编码的配置数据。随后，该POC会在Nuclei运行时环境中对Base64字符串进行解码，并再次使用正则表达式从解码后的内容中准确提取n8n的版本号。最后，它将检测到的版本号与已知的易受攻击版本范围（即小于`1.121.0`）进行比较，以判断目标系统是否存在该漏洞。此POC在检测易受攻击的n8n实例方面非常有效且精准，全程不会执行任何破坏性操作，仅进行信息收集和版本判断。它的结构清晰，逻辑严谨，易于理解和部署，是进行资产发现和漏洞评估的可靠工具。虽然此POC不包含直接的漏洞利用代码，但其作为漏洞存在性的验证手段，具有高度的实用价值和质量。

**漏洞利用步骤：**
CVE-2026-21858的利用主要依赖于Content-Type混淆机制，使得未经身份验证的攻击者能够向基于表单的工作流发送特制HTTP请求。其一般的利用流程包括：
1.  **初始发现与访问：** 攻击者首先识别出部署在网络上的n8n实例。由于漏洞是未授权的，攻击者可以直接通过网络访问目标，无需任何用户凭据或用户交互。
2.  **构造恶意请求：** 攻击者利用Content-Type混淆漏洞，构造一个特制的HTTP请求。这个请求旨在欺骗n8n服务器，使其以非预期的方式处理输入，从而绕过安全验证。
3.  **任意文件读取：** 初步的利用通常允许攻击者读取服务器上的任意敏感文件。例如，公开的POC信息中提及了使用`exploit.py`脚本来读取`/etc/passwd`或`/etc/shadow`等包含系统用户信息的关键文件，或者n8n的配置文件以获取数据库凭据、API密钥等敏感数据。
4.  **认证绕过与权限提升：** 通过获取到的敏感信息，攻击者可以进一步绕过n8n的认证机制，获取到管理面板的访问权限或其他高权限操作。
5.  **远程代码执行：** 在获取到足够权限后，攻击者可以利用n8n的工作流或其底层功能，注入并执行任意系统命令。这可能涉及修改现有工作流以包含恶意脚本、上传并执行Web Shell，或者利用与工作流执行相关的其他漏洞点实现RCE。
6.  **完全服务器控制：** 最终，攻击者能够实现对运行n8n服务器的操作系统进行完全控制，从而能够安装恶意软件、窃取所有敏感数据、将服务器整合到僵尸网络中，或将其作为跳板攻击组织内部的其他系统。

**投毒风险分析：**
针对提供的`CVE-2026-21858.yaml` Nuclei模板，其投毒风险评估为**低 (0%)**。此模板的代码结构清晰，完全遵循标准的Nuclei模板语法和最佳实践，没有发现任何可疑的行为模式。它不依赖于任何外部代码或库（除了Nuclei引擎本身），并且所有的数据处理操作（如Base64解码和正则表达式匹配）都在本地Nuclei运行时环境中安全完成。模板中未检测到任何形式的代码混淆、向未知域发送请求、执行外部系统命令或试图写入文件的恶意行为。其核心功能仅限于发送HTTP GET请求、从响应内容中提取元数据并进行版本判断，这纯粹是为了漏洞检测目的，不涉及任何攻击性载荷。因此，作为合法的防御性安全研究工作的一部分，使用此POC进行漏洞扫描是完全安全的，用户可以信任其行为，无需担忧潜在的供应链攻击或恶意负载植入。

**项目地址:** https://github.com/Chocapikk/CVE-2026-21858.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
