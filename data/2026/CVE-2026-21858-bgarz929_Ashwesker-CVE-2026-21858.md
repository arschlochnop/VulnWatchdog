## CVE-2026-21858 - n8n Workflow Automation 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n Workflow Automation

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** < 1.121.0

**利用条件:** 无需认证, 网络可达, 无需用户交互

**POC 可用性:** 9/10

**POC 类型:** 概念验证 (仅检测)

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

n8n是一款流行的开源低代码工作流自动化平台。CVE-2026-21858，代号“Ni8mare”，是一个极其严重的未经身份验证的远程代码执行（RCE）漏洞，其CVSS评分高达10.0。该漏洞源于n8n表单（Form）节点在处理请求时，未能正确验证Content-Type头部，导致攻击者可以通过类型混淆操纵文件路径参数。这是一个多阶段的攻击链，可从任意文件读取升级为完整的服务器接管。

**POC有效性分析:**
所提供的POC代码是一个Nuclei检测模板（`CVE-2026-21858.yaml`）。该模板旨在通过访问n8n的公共页面（如`/signin`、`/login`或根路径`/`）来检测目标系统是否运行易受攻击的n8n版本。它通过正则表达式从HTML元数据中提取Base64编码的配置字符串，解码后获取n8n的版本号，并将其与已知易受攻击的版本范围（小于`1.121.0`）进行比较。这个检测POC的逻辑清晰，利用了n8n公开页面中包含版本信息的特性。其检测机制是有效的，能够可靠地识别出潜在的脆弱实例。然而，需要明确的是，该POC本身是一个*检测工具*，而不是一个*利用工具*。它不会执行任何攻击载荷，也不会尝试利用漏洞进行远程代码执行。它的主要价值在于帮助安全团队快速识别其网络中是否存在易受攻击的n8n服务。

**利用步骤:**
根据公开披露的漏洞分析报告和搜索结果，CVE-2026-21858的完整攻击链是一个复杂的多阶段过程，包括：
1.  **Content-Type 混淆**: 漏洞的起点是n8n的表单节点未能正确验证HTTP请求中的Content-Type头部。攻击者可以发送一个Content-Type被篡改的请求，绕过服务器的初步校验。
2.  **文件路径操纵与任意文件读取**: 利用Content-Type混淆，攻击者可以覆盖或操纵请求体中的 `req.body.files` 对象，从而控制文件上传或文件处理逻辑中的文件路径参数。这使得攻击者能够读取服务器上的任意敏感文件，例如配置文件、密钥或用户凭证。
3.  **认证绕过/Token伪造**: 通过读取敏感文件（如加密密钥或会话令牌），攻击者可以伪造有效的认证凭证或绕过认证机制，获得对n8n实例的未授权访问权限。
4.  **沙盒绕过**: n8n通常会在执行工作流时使用沙盒机制来限制代码的权限。攻击者在获得初步访问后，会利用平台内部的逻辑缺陷或特定功能绕过沙盒限制，以便执行更高级别的操作。
5.  **远程代码执行 (RCE)**: 一旦沙盒被绕过并获得足够的权限，攻击者就可以通过n8n的工作流或表达式引擎执行任意系统命令，从而完全控制底层的服务器操作系统。这一系列步骤无需任何身份验证即可从外部网络发起，对受影响的系统构成极端威胁。

**投毒风险分析:**
提供的`CVE-2026-21858.yaml`文件是一个标准Nuclei模板，代码结构简单明了，易于理解和审计。它仅包含HTTP GET请求、正则表达式匹配和DSL函数调用，用于从HTTP响应中提取并比较版本信息。该模板没有包含以下可疑行为：执行外部脚本或二进制文件、进行混淆处理的代码、向未知IP地址或域名发送数据、使用 `eval` 或其他动态代码执行函数、下载或修改系统文件、试图进行实际的利用攻击。因此，该Nuclei检测模板本身的投毒风险被评估为**低 (0%)**。它是一个合法且无害的工具，用于被动地检测漏洞。然而，需要注意的是，由于CVE-2026-21858是一个具有完整利用链的严重RCE漏洞，且相关攻击工具已在网上公开。即使这个特定的检测POC是干净的，攻击者也可能在其他地方发布包含恶意载荷的利用POC，或将恶意代码植入到看似无害的检测脚本中。组织在部署任何第三方提供的POC或利用工具时，都应进行严格的代码审查和沙盒测试，以防范潜在的投毒风险。对于此类高危漏洞，应优先修补受影响的系统，而非仅仅依赖检测工具。

**项目地址:** https://www.cyera.com/research-labs/ni8mare-unauthenticated-remote-code-execution-in-n8n-cve-2026-21858

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
