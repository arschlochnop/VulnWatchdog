## CVE-2026-21858 - n8n (工作流自动化平台) 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n (工作流自动化平台)

**危害等级:** 严重 (Critical)

**CVSS评分:** 10.0

**影响版本:** 1.65.0 至 1.120.0

**利用条件:** 无需认证，需要目标n8n实例配置有包含文件上传功能的表单，且该表单连接到Respond节点。攻击者需要网络访问。

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (Full Exploit)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2026-21858（别名：Ni8mare）是n8n工作流自动化平台中的一个严重漏洞链，最终可导致未经认证的远程代码执行（RCE）。该漏洞链结合了多个弱点，包括未经认证的任意文件读取（CVE-2026-21858）、管理员令牌伪造以及沙箱绕过和代码执行（CVE-2025-68613）。POC提供了一个自动化Python脚本，旨在利用这些漏洞实现完整的攻击链。

**POC有效性分析**:
该POC代码通过一个Dockerfile展示了如何搭建一个运行n8n 1.65.0版本的易受攻击环境，这与漏洞披露中提及的受影响版本范围（1.65.0至1.120.0）一致。POC的README文件详细阐述了攻击的各个阶段：首先利用内容类型混淆漏洞（CVE-2026-21858）实现未经认证的任意文件读取，这使得攻击者能够获取敏感配置信息，如加密密钥和数据库中的管理员凭证。随后，这些信息被用于伪造一个有效的管理员JWT令牌。最后，通过一个表达注入漏洞（CVE-2025-68613），攻击者能够绕过n8n的沙箱限制，并在目标系统上执行任意命令，从而实现完全的远程代码执行。根据搜索结果，该POC由安全研究员Chocapikk在GitHub上发布，并提供了明确的利用指令（如通过`exploit.py`脚本读取`/etc/passwd`）。这些信息表明该POC具有高度的有效性和功能性，能够成功复现并利用所述的漏洞链。其“完全自动化Python脚本”的特性，使其在满足特定先决条件时，可以非常高效地执行攻击。尽管README中提到“不是一个通用型利用”，因为它需要特定的工作流配置（例如，一个带有文件上传功能的表单并连接到Respond节点），但在满足这些条件的情况下，其利用能力是毋庸置疑的。

**利用步骤**:
攻击者首先需要通过侦察，识别出运行在互联网上的n8n实例，并确认其版本处于受影响的范围（例如，1.65.0至1.120.0之间）。接着，攻击者必须找到一个在目标n8n实例上配置的工作流，该工作流包含一个允许文件上传的表单，并且该表单的输出连接到一个“Respond”节点。一旦这些条件得到满足，攻击者可以执行以下自动化步骤：
1. **识别敏感文件路径**: 利用任意文件读取漏洞，攻击者首先读取系统环境变量文件（如`/proc/self/environ`）以确定n8n实例的`HOME`目录。
2. **窃取配置与凭证**: 随后，攻击者读取`$HOME/.n8n/config`文件以获取n8n的加密密钥，并读取`$HOME/.n8n/database.sqlite`数据库文件以提取管理员用户的凭证信息。
3. **伪造管理员JWT**: 攻击者利用获取到的加密密钥和管理员凭证，推导出用于JWT签名的密钥，进而伪造一个有效的管理员权限JSON Web Token (JWT)。
4. **沙箱绕过与RCE**: 凭借伪造的管理员JWT，攻击者可以利用表达注入漏洞。通过精心构造的表达式，攻击者能够绕过n8n的沙箱环境限制，并在底层操作系统上执行任意的系统命令，从而完全控制受感染的n8n服务器。整个过程由POC提供的Python脚本自动化完成。

**投毒风险分析**:
根据提供的Dockerfile和README文件内容，该POC的投毒风险被评估为低（5%）。Dockerfile清晰地展示了如何从官方`node:20-slim`镜像构建一个包含`n8n@1.65.0`的易受攻击环境，未使用任何可疑第三方依赖。README文件详细说明了漏洞原理、攻击链和利用先决条件，其目的是安全研究和教育。未发现任何代码混淆、可疑外部请求、隐蔽执行代码（如`eval()`）、或试图安装持久性后门的特征。尽管POC利用了一个远程代码执行漏洞，但POC本身是演示漏洞利用的工具，功能符合其“概念验证”的描述，专注于重现漏洞而非执行恶意操作。GitHub上引用的Python脚本通常由信誉良好的安全研究人员发布。因此，只要从官方且可信的来源获取此POC，并严格在隔离的测试环境中运行，其作为防御性安全研究工具的风险是可控且极低的。组织应遵循严格的审查流程，确保工具来源可信并进行细致分析，以防范意外风险。

**项目地址:** https://github.com/Chocapikk/CVE-2026-21858

**漏洞详情:** 
