## CVE-2026-21858 - n8n 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** n8n

**危害等级:** Critical / 严重

**CVSS评分:** 10.0

**影响版本:** n8n <= 1.65.0

**利用条件:** 未经身份验证的远程攻击；需要特定的工作流配置（例如，带有文件上传功能的表单节点和Respond节点）。

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

CVE-2026-21858，代号“Ni8mare”，是一个针对AI自动化平台n8n的超高危漏洞链，被赋予CVSS 10.0的最高评分。该漏洞允许未经身份验证的远程攻击者完全控制受影响的n8n实例。提供的POC代码虽然仅包含用于环境搭建的Dockerfile和漏洞描述的README，但README中详细介绍了完整的利用链，并声明存在一个“完全自动化”的Python脚本。这个脚本能够从未经身份验证的任意文件读取（CVE-2026-21858）升级到管理员令牌伪造，最终通过表达式注入实现沙箱绕过，进而达到远程代码执行（CVE-2025-68613）。

POC的有效性体现在其能够将多个独立的漏洞环节串联成一个完整的攻击路径，并声称能够作用于n8n的默认安装配置（通过表达式注入而不是依赖“执行命令”节点），这使得其威胁等级极高。虽然该POC并非“通用型利用”，仍需要目标n8n实例配置有特定的工作流（例如包含文件上传功能的表单节点和Respond节点），但考虑到n8n作为自动化平台的广泛应用，此类配置并不少见。Dockerfile明确指定了测试版本`n8n@1.65.0`，这与README中列出的受影响版本`<= 1.65.0`相符，验证了环境的可复现性。搜索结果中多个安全厂商和研究机构均已成功复现该漏洞，进一步证实了其真实性和严重性。LeakIX的搜索结果也显示存在大量公开可访问的受影响实例，表明该漏洞具备广泛的利用潜力。

**利用步骤:**
该漏洞链的利用主要分为三个阶段：
1. **未经身份验证的任意文件读取 (CVE-2026-21858)**：攻击者首先利用Content-Type混淆漏洞，通过特定的HTTP请求，无需任何认证即可远程读取服务器上的任意文件。利用此能力，攻击者会首先读取`/proc/self/environ`以获取n8n应用程序的运行环境信息，从而发现其HOME目录。随后，攻击者将读取`$HOME/.n8n/config`文件，以提取用于加密敏感数据的`encryptionKey`。紧接着，攻击者会读取`$HOME/.n8n/database.sqlite`数据库文件，从中获取存储在数据库中的管理员凭证（如用户名、哈希密码等）。
2. **管理员令牌伪造 (Admin Token Forge)**：在获取了`encryptionKey`和管理员凭证后，攻击者能够通过`encryptionKey`派生出JWT的秘密密钥。利用这个密钥和此前窃取的管理员信息，攻击者可以伪造一个有效的管理员JWT（JSON Web Token）。这个伪造的令牌将赋予攻击者完整的管理员权限，无需实际登录或破解密码。
3. **远程代码执行 (CVE-2025-68613)**：获得管理员权限后，攻击者利用n8n平台中的表达式注入漏洞，绕过其内置的沙箱机制。通过构造恶意的表达式，攻击者可以在n8n实例运行的底层操作系统上执行任意系统命令，从而实现完全的远程代码执行。整个过程，从初始的未经授权访问到最终的RCE，都被描述为可通过自动化脚本完成，极大地降低了攻击门槛。

**投毒风险分析:**
本次分析所依据的POC代码仅包含一个`Dockerfile`和一个`README.md`文件。`Dockerfile`的设计目标是构建一个特定版本的`n8n`应用环境（`n8n@1.65.0`），以便研究人员或安全团队能够搭建一个可复现漏洞的测试环境。其内容清晰、直接，没有包含任何可疑的指令、外部下载源或复杂的混淆代码。它仅用于安装官方的`n8n`软件包并启动服务。

`README.md`文件则详细地描述了漏洞的背景、攻击链、受影响版本以及作者的开发过程。此文件主要是文本说明，不包含任何可执行代码。它明确指出了外部的Python利用脚本链接（`https://github.com/Chocapikk/CVE-2026-21858`）。

基于此，针对**本次提供的POC代码（`Dockerfile`和`README.md`）本身，其投毒风险评估为极低（0%）**。这些文件是典型的安全研究资料，用于漏洞复现、分析和文档化。它们不包含任何恶意负载、后门、代码混淆、可疑的外部网络请求或对系统完整性构成威胁的行为。它们的目的是帮助用户理解和验证漏洞，而非传播恶意软件或攻击用户系统。然而，如果用户选择从`README.md`中引用的外部GitHub链接下载并执行第三方提供的利用脚本，则该脚本的安全性需要单独评估，因为外部脚本可能存在未知的恶意行为，但在本分析的范围内，我们仅评估了输入数据中明确提供的文件。用户在复现或使用任何来自第三方的代码时，都应保持高度警惕并进行严格的安全审计。

**项目地址:** https://github.com/Chocapikk/CVE-2026-21858

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
