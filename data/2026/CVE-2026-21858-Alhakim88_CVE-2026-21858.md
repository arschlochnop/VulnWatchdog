## CVE-2026-21858 - n8n 远程代码执行 (RCE), 包含任意文件读取、管理令牌伪造和沙箱绕过

**漏洞编号:** CVE-2026-21858

**漏洞类型:** 远程代码执行 (RCE), 包含任意文件读取、管理令牌伪造和沙箱绕过

**影响应用:** n8n

**危害等级:** 最高严重性 (Critical)

**CVSS评分:** 10.0

**影响版本:** <= 1.65.0 (任意文件读取), >= 0.211.0 (远程代码执行), 修复版本为 1.121.0 及 1.120.4+

**利用条件:** 未经身份认证，要求 n8n 实例的公开 Webhook 或表单端点暴露，且存在配置为文件上传的表单工作流，并包含 Respond 节点。

**POC 可用性:** 9/10

**POC 类型:** 完整利用 (概念验证性质，需特定工作流配置)

**攻击复杂度:** 低 (攻击者无需认证，利用过程可自动化，但需目标 n8n 实例存在特定配置的工作流)

**投毒风险:** 0%

## 详情

该POC针对n8n自动化工作流平台，是一个完整的未认证远程代码执行（RCE）利用链，结合了CVE-2026-21858（任意文件读取）和CVE-2025-68613（沙箱绕过RCE）。该POC具有高度的有效性和自动化程度，README文件详细描述了其攻击链和与Cyera原始研究的区别。它通过一个全自动化的Python脚本实现攻击，并提供了Dockerfile用于搭建易受攻击的环境。虽然README指出这不是一个“通用利用”（`NOT a universal exploit`），需要特定的工作流配置（例如，任何带有文件上传功能的表单，并且该表单需要包含“Respond”节点），但它明确指出与Cyera的早期研究相比，该POC的RCE方法（Expression Injection）在默认安装上是有效的，并且不需要“Execute Command”节点。这意味着对于满足特定前提条件的n8n实例，该POC能够可靠地重现并利用漏洞，实现未经认证的RCE。其高质量的文档和清晰的攻击步骤使其成为一个非常具有说服力和可操作性的概念验证。泄露检测工具LeakIX也已经发现了大量可能受影响的公开实例，进一步验证了漏洞的普遍性和POC的实际价值。

**利用步骤：**
该漏洞的完整利用链分为四个主要阶段，实现了从未经认证到远程代码执行的目标：
1.  **未经认证的信息收集**: 攻击者首先利用CVE-2026-21858中的Content-Type混淆漏洞，实现任意文件读取。通过读取`/proc/self/environ`文件找到n8n的`HOME`目录。接着，读取`$HOME/.n8n/config`文件以获取`encryptionKey`，并读取`$HOME/.n8n/database.sqlite`文件以获取管理员凭据。
2.  **管理令牌伪造**: 利用第一步获取到的`encryptionKey`和管理员凭据，攻击者能够推导出JWT密钥，进而伪造一个有效的管理员JWT令牌。
3.  **沙箱绕过与RCE**: 获得管理员权限后，攻击者利用CVE-2025-68613中的表达式注入漏洞，绕过n8n的沙箱机制，最终实现远程代码执行。这通常涉及在某个n8n表达式中注入恶意代码。
4.  **命令执行**: 一旦沙箱被绕过，攻击者便能够在目标系统上执行任意命令，完全控制n8n实例及其底层系统。整个链条通过自动化的Python脚本完成，攻击者无需手动干预每个步骤。

**投毒风险分析：**
该POC材料的投毒风险评估为低，具体来说是0%。分析过程中，我们主要关注了Dockerfile和README文件，它们是构建和理解POC的关键组成部分。Dockerfile的内容非常直观，仅包含基于`node:20-slim`镜像安装`n8n@1.65.0`的指令。这个安装过程使用了官方的npm包管理器，并没有引入任何第三方或可疑的外部脚本或二进制文件。这意味着POC环境的搭建过程是透明且可控的，没有隐藏的安装步骤或恶意依赖。README文件则专注于对CVE-2026-21858和CVE-2025-68613这两个漏洞的详细技术描述，包括漏洞原理、影响范围、利用链以及与社区其他研究成果的对比。它的目的是为了清晰地阐述如何利用这些漏洞，帮助安全研究人员理解和复现。文中提到的“Exploit: [Chocapikk](https://github.com/Chocapikk/CVE-2026-21858)”链接指向一个GitHub仓库，这是开源社区中常见的POC共享方式。通常，如果POC存在投毒风险，可能会表现为以下几种情况：在Dockerfile中包含额外的、非必要的或来源不明的包安装；在README中引导用户执行可疑的命令或下载不明文件；POC脚本（如果提供）中包含混淆代码、连接到未知C2服务器、执行加密操作、或尝试修改系统关键配置等。然而，在此次审查中，这些潜在的风险迹象均未发现。该POC的设计和呈现方式完全符合合法安全研究和漏洞验证的标准实践。它提供了一个明确的环境来重现漏洞，其核心代码（根据描述应为Python脚本）旨在利用n8n自身的缺陷，而不是通过在POC载体中植入恶意代码来造成损害。因此，我们认为这个POC是纯净的，不存在以恶意软件或后门形式投毒的风险，可以安全地用于防御性安全研究和内部测试目的。

**项目地址:** https://github.com/Chocapikk/CVE-2026-21858

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-21858
