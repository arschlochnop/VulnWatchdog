## CVE-2018-10933 - libssh 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** libssh 0.6.x (所有版本), 0.7.x (0.7.6之前), 0.8.x (0.8.4之前)

**利用条件:** 目标服务器运行受影响版本的libssh服务，攻击者需具备网络访问权限。

**POC 可用性:** 7/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2018-10933 是 libssh 服务端状态机中的一个极其严重的逻辑漏洞。该漏洞源于 libssh 在处理 SSH2_MSG_USERAUTH_SUCCESS 消息时缺乏必要的状态检查。攻击者可以向正在进行身份验证的服务器发送该消息，从而欺骗服务器认为身份验证已成功，进而无需任何密码或密钥即可获得对服务器的访问权限。在 POC 有效性分析方面，提供的 Python 代码 `ssh.py` 表现出了较高的逻辑完整性。代码首先通过 socket 连接获取目标的 Banner 信息，根据版本号（如 0.6.x、0.7.5 以下或 0.8.3 以下）自动判断目标的易感性。虽然提供的代码片段在关键的利用逻辑处被截断，但从其导入 `paramiko` 库以及对状态机的处理逻辑来看，它旨在通过底层 socket 发送伪造的成功认证报文，这完全符合该漏洞的利用原理。该脚本具备自动化探测和针对性利用的能力，经过少量修复（如补全被截断的利用核心函数）后，在实验室环境下具有极高的成功率。利用步骤如下：1. 攻击者确定目标 IP 和 SSH 服务端口。2. 脚本建立 TCP 连接并读取 Banner，确认 libssh 版本。3. 脚本初始化 SSH 传输层，但在发送认证请求后，直接向服务端注入 SSH2_MSG_USERAUTH_SUCCESS 消息。4. 绕过验证后，脚本尝试开启通道并执行远程命令。投毒风险分析方面，该 POC 的风险较低。代码主要使用了 Python 标准库 `sys`, `getopt`, `socket` 以及通用的安全库 `paramiko`。通过分析代码逻辑，其核心功能集中在漏洞验证和简单的命令执行上。代码中虽然有自定义的 ASCII 艺术字打印，这在安全工具中很常见，不属于恶意混淆。虽然代码提及了外部 YouTube 链接作为参考，但这属于文档性质。在代码层面，未发现明显的反连木马（Reverse Shell）、敏感信息窃取（如搜集执行主机的 SSH 密钥）或对本地文件系统的恶意破坏逻辑。唯一的潜在风险点在于用户在使用此类 POC 时，若从不可信的第三方源下载，可能会被植入额外的恶意后门。但就目前分析的这份代码副本而言，其行为是透明且符合安全研究用途的。

**项目地址:** [https://www.youtube.com/watch?v=ZSWQjmfcn4g](https://www.youtube.com/watch?v=ZSWQjmfcn4g)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-10933](https://nvd.nist.gov/vuln/detail/cve-2018-10933)
