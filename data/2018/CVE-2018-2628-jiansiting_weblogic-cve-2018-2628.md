## CVE-2018-2628 - Oracle WebLogic Server RCE

**漏洞编号:** CVE-2018-2628

**漏洞类型:** RCE

**影响应用:** Oracle WebLogic Server

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 10.3.6.0.0, 12.1.3.0.0, 12.2.1.2.0, 12.2.1.3.0

**利用条件:** 通过T3协议可达，目标未应用相应安全补丁

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 45%

## 详情

【POC有效性分析】该POC脚本是一个针对Oracle WebLogic Server T3协议反序列化漏洞（CVE-2018-2628）的Python实现。通过对代码的静态分析可见，脚本逻辑分为三个核心阶段：首先是t3handshake函数，它向目标服务器发送特定的十六进制序列（7433...）来触发T3协议握手，这是利用WebLogic私有协议漏洞的标准起始步骤。其次，buildT3RequestObject函数构造了复杂的T3请求头，模拟了合法的协议交互。最关键的部分在于PAYLOAD变量，其中包含了一段以'aced0005'开头的Java序列化流。经过解码，该序列化数据利用了JRMPClient（java.rmi.server.RemoteObjectInvocationHandler）来绕过WebLogic之前的补丁黑名单，通过导出一个远程对象使目标服务器向攻击者指定的IP地址发起JRMP连接。这种利用方式在2018年公开时具有极高的成功率，因为它利用了WebLogic对T3协议处理逻辑中的缺陷。脚本中硬编码的PAYLOAD指向了特定的IP地址（104.251.228.50），这意味着该POC在不经过修改的情况下，只会尝试让受害者服务器连接到该特定节点，而非攻击者自己的控制端。这显著降低了脚本的直接可用性，用户需要具备一定的Java反序列化知识，使用如ysoserial等工具重新生成PAYLOAD并替换十六进制字符串才能实现自定义攻击。总体而言，代码结构清晰，协议模拟准确，是一个功能完整但带有特定指向性的利用脚本。【利用步骤】1. 环境准备：确保目标WebLogic服务器开启了T3协议监听（默认7001端口）。2. 准备受控端：在公网VPS上运行一个JRMPListener（如ysoserial.exploit.JRMPListener），设置好待执行的命令。3. 修改POC：将脚本PAYLOAD部分中的IP地址和端口替换为自己VPS的地址。4. 执行攻击：使用Python 2.7运行该脚本，指定目标IP和端口。5. 触发回调：目标服务器反序列化恶意对象后，会回连VPS，触发RCE。【投毒风险分析】该脚本存在中等程度的投毒风险（约45%）。主要的风险点在于PAYLOAD中硬编码的远程地址（104.251.228.50）。在威胁情报视角下，这类硬编码往往具有双重属性：它可能仅仅是原作者演示漏洞时的测试环境，但也极有可能是恶意分子散播的“蜜罐回连”或“流量重定向”陷阱。如果安全研究人员直接运行此脚本，其受害者服务器的行为日志将直接暴露在该IP持有者的视野中。此外，PAYLOAD以长字符串形式硬编码，对于不熟悉Java反序列化二进制格式的研究员来说，很难直观判断其中是否嵌套了额外的恶意逻辑（例如除了触发JRMP连接外，是否还执行了其他隐蔽的系统指令）。脚本使用了.decode('hex')等混淆手段来处理协议数据，虽然这在Exploit编写中是常见做法，但也为隐藏恶意负载提供了便利。建议在隔离环境中使用，并务必通过十六进制编辑器或反序列化分析工具检查PAYLOAD的具体类链指向，严禁在未修改硬编码地址的情况下对生产系统进行扫描。

**项目地址:** 本地存储: /tmp/vulnwatchdog_c7ed3063f2e7b2a2f8de217aa062b1e0/weblogic-cve-2018-2628.py

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-2628](https://nvd.nist.gov/vuln/detail/cve-2018-2628)
