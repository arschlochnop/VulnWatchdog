## CVE-2018-15133 - Laravel Framework RCE/反序列化漏洞

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE/反序列化漏洞

**影响应用:** Laravel Framework

**危害等级:** 高危

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要获取受害站点的 APP_KEY (API_KEY)

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞源于Laravel框架在处理带有X-XSRF-TOKEN头部的请求时，未能正确验证加密载荷。由于Laravel使用OpenSSL进行加密和解密，且其解密逻辑中包含了不安全的反序列化操作，当攻击者获取到站点的APP_KEY后，可以构造恶意的序列化对象，通过AES-256-CBC加密并生成相应的HMAC签名。提供的C++源代码（main.cpp）展示了一个功能完整的漏洞利用程序。该程序通过包含openssl/hmac.h和evp.h，实现了根据指定的APP_KEY生成合法签名的逻辑。代码定义了payload、key、cipher和iv等结构体，清晰地模拟了Laravel内部的加密解密数据包格式。利用步骤如下：首先，通过信息泄露（如.env文件、Debug页面或日志）获取目标网站的APP_KEY；其次，使用本POC程序或PHPGGC工具生成针对Laravel框架受影响版本的反序列化Payload（如GuzzleHttp/Promises链）；接着，程序会执行AES加密并附带正确的MAC校验值；最后，将生成的Base64载荷填入HTTP头部的X-XSRF-TOKEN字段发送给目标服务器，服务器在解密后触发反序列化，从而执行攻击者预设的系统命令。该POC代码逻辑清晰，调用了标准的OpenSSL库，具备高度的实战有效性。投毒风险分析：经过对提供的C++源码及构建脚本分析，其投毒风险较低，约为15%。代码库主要依赖于libpop2目录下的辅助类（如socket、httpprotocol、stringz等），这是典型的自定义网络库封装。在build.sh中，编译器开启了-fsanitize=address，这通常是安全研究人员用于检测内存损坏的调试行为，而非恶意软件常见的隐藏特征。主要风险点在于libpop2目录下的闭源或未完全展示的源代码，防御者应重点检查其nix_socket.cpp和httpprotocol.cpp中是否含有硬编码的外部回传（C2）地址。当前主程序main.cpp的行为逻辑严格遵循漏洞利用路径：解析参数、构造Payload、执行加密、发起请求，未见明显的代码混淆、非法持久化植入或敏感信息（如本地环境变量）的窃取逻辑。由于其需要编译运行，建议在隔离沙箱环境中进行构建，以防止其依赖库中可能存在的隐藏后门。整体而言，该POC是一个较为纯粹的技术验证工具，但使用时仍需警惕编译后的二进制文件是否产生异常的网络连接。

**项目地址:** [https://github.com/aljavier/exploit_laravel_cve-2018-15133](https://github.com/aljavier/exploit_laravel_cve-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)
