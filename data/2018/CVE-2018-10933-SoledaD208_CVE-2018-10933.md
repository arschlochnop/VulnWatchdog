## CVE-2018-10933 - libssh 身份验证绕过

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 0.6.0 及以上版本，但在 0.7.6 和 0.8.4 之前

**利用条件:** 目标服务器运行受影响版本的 libssh 且启用服务器模式，攻击者需具备网络访问权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该漏洞源于 libssh 服务端状态机逻辑缺陷。在正常的 SSH 身份验证流程中，客户端应发送 SSH2_MSG_USERAUTH_REQUEST，而服务端应处于等待验证请求的状态。然而，受影响版本的 libssh 未能正确限制状态迁移，当客户端直接发送 SSH2_MSG_USERAUTH_SUCCESS 消息时，服务端会错误地认为身份验证已成功，从而允许攻击者绕过密码或密钥检查直接进入会话阶段。提供的 Python POC 代码利用了 Paramiko 库来构建底层的 SSH 传输层。代码首先通过 socket 建立 TCP 连接，然后初始化 Transport 对象并启动客户端模式。关键步骤在于其直接调用 `m.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)` 手动构造了一个验证成功消息并发送给服务器。随后，POC 尝试开启会话（open_session）并调用 Shell（invoke_shell）。由于 libssh 服务端的缺陷，此操作在无需任何凭据的情况下即可成功。该 POC 逻辑清晰，完全符合 CVE-2018-10933 的技术特征。通过 README 提供的复现步骤（编译 libssh-0.7.4 并运行 samplesshd-cb 示例程序），安全研究员可以非常容易地在受控环境中验证此漏洞。该 POC 脚本不依赖复杂的第三方框架，仅使用了标准的 paramiko 库，具有极高的可用性和验证价值。利用步骤：1. 确保安装 paramiko 2.4.2。2. 针对运行受影响 libssh 服务的端口（如 2222）运行脚本。3. 脚本若能成功分配会话频道并打开 Shell，则表示存在漏洞。此漏洞的影响范围极广，且利用方式异常简单，是防御性研究中必须优先关注的典型状态机漏洞案例。

【投毒风险分析】经过对 POC 代码的深度静态审计，判定该脚本的投毒风险极低（约 5%）。首先，代码结构透明，导入的模块均为标准库（sys, socket, argparse, logging）以及知名的安全辅助库（paramiko），不存在任何动态导入（如 __import__）或混淆手段。代码逻辑严格限制在漏洞验证范围内，即建立连接、发送特定字节码、尝试开启 Channel。其次，脚本中没有任何外联行为，除了与用户指定的 hostname 和 port 通信外，未发现向第三方服务器发送数据（如上传被攻击主机的元数据或敏感环境变量）的代码。再者，README 文件提供了详细的编译和本地复现指导，说明该项目的初衷是教学与安全评估。虽然 requirements.txt 中指定了特定版本的 paramiko，但这属于确保 POC 稳定性的正常操作，而非依赖投毒攻击。在执行此类 POC 时，建议防御者依然遵循最佳实践：在隔离的沙箱环境中运行，并使用网络抓包工具（如 Wireshark）确认脚本发出的流量仅限于 SSH 协议交互。总体而言，该 POC 代码由合法的安全社区维护或分发，代码逻辑纯粹，未隐藏恶意负载，可安全用于组织的防御性测试和漏洞扫描任务。唯一潜在风险在于使用者如果未验证 paramiko 库本身的安全性（虽概率极低），可能会面临供应链层面的间接风险，但代码本身是干净的。

**项目地址:** [https://www.libssh.org/security/advisories/CVE-2018-10933.txt](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)
