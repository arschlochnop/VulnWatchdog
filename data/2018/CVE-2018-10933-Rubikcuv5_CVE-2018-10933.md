## CVE-2018-10933 - libssh 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** libssh

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** libssh 0.6 及更高版本，且早于 0.7.6 或 0.8.4 版本

**利用条件:** 目标服务器运行受影响版本的 libssh 库，且攻击者具有网络访问权限。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞源于libssh服务器端状态机的逻辑错误。在正常的SSH身份验证流程中，客户端应发送SSH2_MSG_USERAUTH_REQUEST。然而，受影响版本的libssh在接收到客户端主动发送的SSH2_MSG_USERAUTH_SUCCESS消息时，会错误地认为身份验证已成功完成，从而允许客户端直接进入后续的通道创建阶段。提供的POC代码基于Python开发，利用了paramiko库或底层socket构造。代码结构清晰，通过直接向目标主机发送‘成功’信号（MSG_USERAUTH_SUCCESS）而非请求信号，验证了该逻辑漏洞的存在。POC包含版本检测（-t）、单次命令执行（-c）和交互式Shell（-i）功能。经过分析，该POC逻辑与libssh官方安全公告描述的漏洞机理完全一致，能够实现非授权的远程访问和命令执行。POC的实现依赖于对SSH协议消息类型的精准控制，代码中展示了如何跳过标准的认证握手环节，证明了其在实际渗透测试环境中的高有效性。【利用步骤】1. 环境准备：安装Python3并安装依赖库，如rich、paramiko等。2. 目标扫描：利用探测参数‘-t’扫描目标IP的22端口（或其他SSH服务端口），确认其libssh版本是否处于受影响范围。3. 漏洞触发：使用‘-c’参数紧随其后输入想要执行的系统命令，例如‘cat /etc/passwd’。4. 获取权限：若命令成功返回结果，则说明目标存在漏洞。此时可以使用‘-i’参数进入交互模式，获取对目标系统的非授权控制权限。【投毒风险分析】该POC代码托管于GitHub仓库（EmmanuelCruzL/CVE-2018-10933），主要依赖Python标准库、socket以及常用的paramiko库。通过对main.py代码片段的静态分析，未发现明显的恶意混淆（Obfuscation）或反调试技巧。其导入的第三方库均为合法的安全研究常用组件。风险点在于：首先，攻击者可能会在安装依赖过程中修改requirements.txt，引入恶意的镜像包；其次，虽然当前展示的代码逻辑是合法的PoC验证，但由于其具备交互式Shell功能，若在不受控的环境下运行，可能导致操作失误或被他人截获敏感信息。然而，代码本身并未发现向非相关地址发送数据包、窃取本地SSH密钥或执行隐蔽删除指令的行为。该项目主要用于安全演示和研究，因此投毒风险评级为低（10%），主要风险源于供应链环节而非代码逻辑本身。建议研究人员在隔离环境（虚拟机或沙箱）中运行此POC，并对所有外发网络流量进行监控。

**项目地址:** [https://github.com/EmmanuelCruzL/CVE-2018-10933](https://github.com/EmmanuelCruzL/CVE-2018-10933)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-10933](https://nvd.nist.gov/vuln/detail/cve-2018-10933)
