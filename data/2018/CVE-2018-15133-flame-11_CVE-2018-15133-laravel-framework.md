## CVE-2018-15133 - Laravel Framework RCE/反序列化漏洞

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE/反序列化漏洞

**影响应用:** Laravel Framework

**危害等级:** 高危

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8)

**影响版本:** Laravel Framework 5.5.40 及以下版本，5.6.x 5.6.29 及以下版本

**利用条件:** 需要获取受害站点的 APP_KEY（通常存储在 .env 文件中）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞源于Laravel框架在开启了API模式或特定配置下，未能正确处理带有X-XSRF-TOKEN头部的恶意构造请求。由于Laravel使用APP_KEY对Cookie和Token进行签名及加解密，若攻击者获取了APP_KEY，即可利用PHP反序列化机制触发远程代码执行。本次提供的POC代码包含一个完整的Docker化实验环境，基于PHP 7.2和Laravel 5.6.21/5.6.29构建。Dockerfile通过手动回退Debian存档镜像地址解决了由于系统EOL导致的构建失败问题，并准确配置了Laravel的目录权限、Composer依赖及Apache重写规则。此实验环境高度还原了真实漏洞场景，通过修改vendor中的installed.json结构兼容了Composer v2，证明了该POC在现代开发环境下依然具有极高的复现成功率。漏洞的核心在于Illuminate/Encryption/Encrypter.php中的decrypt方法，当传入恶意构造的序列化对象时，会调用unserialize()，配合PHPGGC生成的Gadget Chain，可实现完全的系统接管。分析显示，该POC不仅提供了环境搭建脚本，还指明了利用链的构造方向，对于防御性研究具有极高的参考价值。利用步骤包括：1. 启动Docker环境并获取WEB服务的APP_KEY。2. 使用工具（如PHPGGC）基于Laravel/RCE1等Gadget生成恶意Payload。3. 使用APP_KEY对Payload进行AES加密并进行Base64编码。4. 将生成的字符串作为X-XSRF-TOKEN请求头发送至服务器任意路由。服务器在解析CSRF Token时会进行解密并触发反序列化，从而执行命令。【投毒风险分析】该POC代码包主要由Dockerfile、README.md和基础配置文件组成，代码逻辑清晰，主要操作为标准的系统包管理、Composer依赖安装和Apache配置修改。在Dockerfile中，虽然涉及到了从外部（getcomposer.org）下载脚本，但属于官方渠道，且指定了具体版本2.7.8，风险可控。代码中通过sed命令修改了Debian镜像源为archive.debian.org，这是处理老旧镜像构建的常规手段，不属于恶意投毒行为。PHP脚本部分用于修正Composer版本间的JSON结构差异，逻辑透明，未见混淆或外部C2通信。然而，搜索结果显示，CVE-2018-15133是Androxgh0st、Mozi和PBot等多个僵尸网络频繁利用的对象。尽管当前提供的POC本身是安全的，但由于该漏洞利用门槛极低且互联网上存在大量泄露APP_KEY的自动化扫描工具，研究人员在下载第三方封装的利用工具（如PHPGGC集成版）时需警惕。总结：本POC仓库代码纯净，无恶意混淆或后门植入，属于高质量的教学与研究资源，投毒风险评级为低（15%），主要风险点在于其依赖的第三方Gadget生成工具的安全性。

**项目地址:** [https://github.com/kozmic/laravel-poc-CVE-2018-15133](https://github.com/kozmic/laravel-poc-CVE-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)
