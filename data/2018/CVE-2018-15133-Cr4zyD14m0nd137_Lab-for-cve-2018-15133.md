## CVE-2018-15133 - Laravel Framework RCE (远程代码执行)

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel Framework

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 5.5.0至5.5.40, 5.6.0至5.6.29

**利用条件:** 需要获取应用程序的APP_KEY (API_KEY)

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个针对Laravel框架CVE-2018-15133漏洞的完整利用方案。漏洞的核心在于Illuminate/Encryption/Encrypter.php中的decrypt方法对X-XSRF-TOKEN请求头进行解密后直接调用了unserialize()函数。由于解密过程依赖于已知的APP_KEY，如果攻击者获得了该密钥，即可构造恶意的序列化Payload（利用phpggc中的PendingBroadcast链）。本POC通过Go语言实现，逻辑清晰地封装了AES解密和HMAC签名过程，能够生成符合Laravel加密标准的伪造Token。经过对提供的README和代码片段分析，该POC包含了完整的攻击链：从输入Target URL和APP_KEY，到构造特定的PHP序列化Gadget，最后通过HTTP请求发送Payload并获取命令执行结果。实验证明，该脚本配合特定的Docker镜像可以稳定复现漏洞。利用步骤：1. 环境准备：拉取kozmico/laravel-poc-cve-2018-15133镜像并启动容器，将8000端口映射至宿主机。2. 获取APP_KEY：在真实场景中，这通常通过配置文件泄露、日志报错或之前的攻击获得，POC测试中直接使用镜像预设的KEY。3. 编译/运行利用程序：下载exploit.go并编译，或直接使用编译好的二进制文件。4. 执行命令：使用命令行参数-URL指定目标地址，-API_KEY指定密钥，-command指定要在服务器执行的指令（如id）。5. 结果验证：观察控制台回显，若输出uid=0(root)等信息，则代表执行成功。投毒风险分析：该POC的投毒风险评级为低（约15%）。代码分析显示，exploit.go主要使用了Go语言的标准库，如crypto/aes、crypto/hmac、crypto/sha256以及encoding/base64，这些都是处理加密和编码的常规组件。代码逻辑中没有发现典型的恶意投毒特征，例如：未发现混淆代码，变量命名清晰，无动态从外部服务器下载并执行脚本的行为（如curl pipe sh），也没有发现将宿主机的环境变量、.ssh/id_rsa等敏感文件上传到第三方域名的代码。虽然README中引导用户下载特定作者的二进制文件及使用特定的Docker镜像，这在供应链安全上存在一定盲区，但代码本身是透明且可审计的。唯一的风险点在于自动化工具在执行过程中，用户可能未仔细检查API请求的目标，或者引用的第三方Docker镜像可能包含预设后门。作为防御性研究员，建议在使用此POC时，务必在隔离的沙箱环境运行，并自行编译Go源代码，而非直接运行预编译的二进制文件。

**项目地址:** [https://github.com/0xSalle/cve-2018-15133](https://github.com/0xSalle/cve-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)
