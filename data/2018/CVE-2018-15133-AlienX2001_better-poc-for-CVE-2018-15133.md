## CVE-2018-15133 - Laravel Framework RCE (远程代码执行)

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel Framework

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Laravel Framework <= 5.5.40 且 5.6.x <= 5.6.29

**利用条件:** 已知受害服务器的 APP_KEY 且 X-Vnd-Laravel-Payload 请求头未受过滤

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该公开的POC代码具有极高的有效性且逻辑完整。其核心利用逻辑基于Laravel框架在处理带有 X-Vnd-Laravel-Payload 请求头的请求时，会对该字段内容进行解密并执行 unserialize() 操作。由于解密过程依赖于配置文件中的 APP_KEY，攻击者若获取了该密钥，即可伪造合法的加密载荷。POC包含两个核心组件：一个Bash自动化脚本(betterpoc.sh)和一个PHP加密转换脚本(cve-2018-15133.php)。betterpoc.sh 实现了自动化的命令执行循环，利用 phpggc 工具生成针对 Laravel/RCE1 链的 Base64 序列化载荷，随后通过 PHP 脚本完成符合 Laravel 规范的 AES-256-CBC 加密和 HMAC 签名。最终通过 curl 发送构造好的 POST 请求，将载荷置于 Header 中触发。此 POC 能够实现交互式的伪终端效果，证明了漏洞利用的低门槛和高危害性，在真实环境中只要获取到 APP_KEY，该代码几乎可以实现一键式命令执行。【利用步骤】1. 获取目标 Laravel 应用的 APP_KEY（通常通过配置文件泄露、.env 文件读取获得）。2. 准备 phpggc 工具用于生成反序列化 Payload。3. 运行 betterpoc.sh 脚本，输入目标的 URL 和端口。4. 输入获取到的 Base64 编码后的 APP_KEY。5. 脚本自动调用 PHP 脚本计算 MAC 签名并加密 Payload，将其封装入 X-Vnd-Laravel-Payload 请求头发送。6. 在返回的 SHELL 提示符中输入系统命令（如 whoami），获取回显结果。【投毒风险分析】在对此 POC 代码进行安全审查后发现，其投毒风险处于低水平（约 10%）。代码逻辑清晰透明，betterpoc.sh 主要是简单的 shell 逻辑封装，cve-2018-15133.php 则完全使用了 PHP 原生的 openssl 和 hash_hmac 函数，没有发现任何代码混淆、远程反弹后门、未授权的敏感信息外发或破坏宿主机的恶意行为。该 POC 明确引用了原始作者 kozmic，且其功能点完全聚焦于漏洞验证。唯一的潜在风险在于其依赖项 phpggc，用户在从第三方非官方仓库下载 phpggc 时可能面临供应链安全威胁，但本 POC 脚本本身是安全的。脚本中虽然包含了 chmod +x 操作，但仅针对配套的 PHP 脚本，属于正常的权限初始化。防御者在使用时应在受控的沙箱环境下运行，并注意脚本中 curl 请求的目标地址，防止误伤非测试目标。

**项目地址:** [https://github.com/kozmic/laravel-poc-CVE-2018-15133](https://github.com/kozmic/laravel-poc-CVE-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-15133](https://nvd.nist.gov/vuln/detail/cve-2018-15133)
