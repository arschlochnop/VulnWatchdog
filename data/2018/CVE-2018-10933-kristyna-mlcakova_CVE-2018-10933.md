## CVE-2018-10933 - libssh 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 0.6.x 及其后续版本 (在 0.7.6 和 0.8.4 中修复)

**利用条件:** 目标服务器运行受影响版本的 libssh 服务，且攻击者可以建立网络连接。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：提供的Python代码利用了libssh服务器代码中的逻辑错误。该漏洞的核心在于服务器端在处理身份验证请求时，未能正确验证状态机的转换。正常流程中，客户端应发送 SSH2_MSG_USERAUTH_REQUEST 以启动认证，但受影响的 libssh 版本在收到 SSH2_MSG_USERAUTH_SUCCESS 消息时，会错误地认为认证已成功完成，从而允许攻击者绕过密码或密钥检查。此POC通过 paramiko 库直接构造并发送该成功消息，然后尝试开启一个会话并执行指定的命令（默认 ls -a; whoami;）。代码逻辑清晰，直接针对协议层缺陷，验证步骤完整且高效。利用步骤：1. 确保安装 paramiko 环境。2. 指定目标 IP、端口和待执行命令。3. 脚本建立 TCP 连接并初始化 Transport 对象。4. 关键步骤：跳过发送认证请求，直接构造 SSH2_MSG_USERAUTH_SUCCESS 字节码并通过私有方法 _send_message 发送给服务端。5. 若服务端存在漏洞，将进入已认证状态。6. 脚本随后打开会话通道并执行命令，获取返回结果并打印。投毒风险分析：该脚本主要基于标准库 socket、argparse 以及流行的安全库 paramiko 开发。通过代码审计发现，其逻辑直接且透明，不存在任何混淆处理、未授权的外部域名请求或敏感数据（如本机环境变量、SSH 密钥）的窃取行为。脚本中的 _send_message 虽调用了 paramiko 的内部方法，但这属于实现协议绕过的必要手段，而非恶意行为。虽然在野外存在利用此类漏洞脚本植入后门的风险，但本特定 POC 代码本身并不包含恶意负载或自传播逻辑。唯一的风险点在于其对 paramiko 私有 API 的依赖可能因版本更新失效，且如果来源不受信任，攻击者可能在 command 默认值中嵌入恶意指令，但就目前代码结构而言，投毒风险评级为低。组织应重点关注此类直接通过协议报文欺骗导致的认证失效风险。

**项目地址:** [https://www.libssh.org/security/advisories/CVE-2018-10933.txt](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-10933](https://nvd.nist.gov/vuln/detail/cve-2018-10933)
