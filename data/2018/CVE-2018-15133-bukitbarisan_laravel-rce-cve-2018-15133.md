## CVE-2018-15133 - Laravel Framework RCE

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE

**影响应用:** Laravel Framework

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 5.5.0 - 5.5.40, 5.6.0 - 5.6.29

**利用条件:** 需要获取目标应用的APP_KEY，且应用未对X-XSRF-TOKEN请求头进行足够安全的反序列化检查。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC（cve.php）是一个功能完整的漏洞利用程序，旨在利用Laravel框架中的反序列化漏洞。通过分析代码，其利用逻辑清晰：首先，利用本地安装的phpggc（PHP Generic Gadget Chains）工具生成针对Laravel/RCE1链的Payload，攻击者通过POST参数传入命令。其次，POC提取目标应用的APP_KEY，使用OpenSSL库配合AES-256-CBC算法对Payload进行加密，并计算HMAC签名。这是由于Laravel的X-XSRF-TOKEN在处理时会尝试解密并反序列化内容。最后，通过CURL发送带有加密Payload的Cookie头部请求至目标URL。代码中使用了phpggc作为Payload生成核心，验证了利用链的存在性。此POC实现了从参数输入到加密封装再到自动发送的一键化过程，在已知APP_KEY的情况下，其有效性极高，能够直接在远程服务器上执行系统命令（如默认的uname -a）。该脚本主要用于漏洞复现，但其依赖外部二进制文件phpggc，在实际部署时需确保环境依赖完整。\n\n【利用步骤】1. 获取目标Laravel应用的APP_KEY（通常从.env文件泄露获得）。2. 部署此POC脚本至支持PHP的环境中。3. 在Web界面输入框中填入目标APP_KEY。4. 输入目标受影响站点的完整URL。5. 在payload框输入欲执行的指令，如 'id' 或 'ls /'。6. 点击 'Gasskeun' 按钮，脚本将自动完成Payload生成、加密并执行请求，执行结果将回显在下方的文本域中。\n\n【投毒风险分析】本POC的投毒风险评级为低（15%）。代码主体部分（cve.php）逻辑透明，使用了标准的PHP加密函数和CURL组件，未发现明显的代码混淆或隐藏的恶意远程下载行为。唯一的潜在风险点在于其调用的'phpggc'文件。由于phpggc通常是一个复杂的PHP脚本集合，如果攻击者对该文件进行篡改，可能在安全研究人员本地执行Payload生成逻辑时触发本地代码执行。但在本案例中，代码中的shell_exec指令仅用于本地调用phpggc和curl，符合此类Exploit工具的常规编写习惯。未发现向第三方C2服务器发送敏感信息（如APP_KEY或目标URL）的隐蔽网络请求。为了安全起见，用户在使用此类开源POC时，应重点审查phpggc组件的来源可靠性，并在隔离环境（如Docker容器）中运行，以防范潜在的本地环境污染。

**项目地址:** [https://github.com/vulnwatchdog/laravel-rce-cve-2018-15133](https://www.google.com/search?q=https://github.com/vulnwatchdog/laravel-rce-cve-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-15133](https://nvd.nist.gov/vuln/detail/cve-2018-15133)
