## CVE-2018-0114 - Cisco node-jose JWT伪造

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT伪造

**影响应用:** Cisco node-jose

**危害等级:** 高危

**CVSS评分:** 未知

**影响版本:** 未知

**利用条件:** 需要目标服务器使用node-jose库处理JWT

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2018-0114 存在于Cisco的node-jose库中，允许攻击者通过在token header中嵌入公钥来伪造JWT token。该漏洞的产生原因是服务器在验证JWT签名时，信任了JWT header中的`jwk` (JSON Web Key) 对象，该对象包含了用于构造公钥的参数 `n` (模数) 和 `e` (指数)。攻击者可以生成新的RSA密钥对，提取 `n` 和 `e`，并将其注入到JWT header的`jwk`对象中。然后，攻击者可以修改JWT body中的任意值，并使用其私钥对token进行签名。由于服务器使用攻击者的公钥来验证签名，因此验证会成功，从而允许攻击者伪造JWT token。

POC代码分析:
提供的POC代码包含一个名为`jwt-spoof-tool`的工具，该工具旨在自动化利用CVE-2018-0114漏洞，而无需依赖BurpSuite等工具。代码结构清晰，注释完善，易于理解和使用。该工具的核心功能是生成RSA密钥对，提取公钥的`n`和`e`参数，构造包含恶意`jwk`对象的JWT header，修改JWT body，并使用攻击者的私钥对token进行签名。POC代码还包含一个验证函数，用于确认JWT是否成功被利用，通过使用攻击者的公钥（`n`和`e`）来解码JWT。利用步骤如下：
1.  使用POC代码生成新的RSA密钥对。
2.  从生成的密钥对中提取`n`和`e`参数。
3.  将`n`和`e`参数注入到目标JWT header的`jwk`对象中。
4.  修改JWT body中的任意声明。
5.  使用攻击者的私钥对修改后的JWT进行签名。
6.  将伪造的JWT发送到目标服务器。
7.  目标服务器使用攻击者的公钥验证签名，验证通过。
8.  攻击成功。

投毒风险分析:
该POC的主要功能是生成密钥对和伪造JWT，本身不包含恶意代码或后门。它使用标准的加密库（cryptography和jwcrypto）来完成密钥生成和签名操作。然而，如果攻击者修改POC代码，例如添加恶意payload到JWT body中，或者将生成的密钥对发送到外部服务器，则可能存在投毒风险。由于该POC依赖于用户提供的原始JWT和修改后的声明，因此也存在用户误用的风险，例如，用户可能会将敏感信息添加到JWT body中，从而导致信息泄露。综合考虑，该POC的投毒风险较低，约为10%。

**项目地址:** https://github.com/HaHwul/jwt-spoof-tool

**漏洞详情:** https://www.cve.org/CVERecord?id=CVE-2018-0114
