## CVE-2018-15133 - Laravel Framework RCE (远程代码执行)

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel Framework

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Laravel Framework <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要获取受害站点的APP_KEY（通常存储在.env文件中）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞源于Laravel框架在处理带有X-XSRF-TOKEN请求头的数据时，未能正确验证解密后的数据，导致不可信数据被传入unserialize()函数。提供的POC代码通过Docker环境完美复现了漏洞场景。该POC包含了一个易受攻击的Laravel 5.6.29版本镜像，并配置了一个POST路由。其核心逻辑在于利用已知的APP_KEY对恶意构造的PHP反序列化载荷进行加密，并将其放置在HTTP请求头的X-XSRF-TOKEN字段中。由于Laravel默认会解密此字段并执行反序列化，攻击者可以借此触发PHP反序列化漏洞链（POP Chain），实现远程命令执行。POC中使用了PHPGGC工具生成针对Laravel/RCE1的载荷，这证明了在已知APP_KEY的情况下，该漏洞具有极高的利用成功率和实战价值。利用步骤：首先，攻击者需通过信息泄露或其他手段获取目标站点的APP_KEY；其次，使用PHPGGC等工具根据目标环境生成对应的反序列化Payload（如执行uname -a）；然后，利用获取的APP_KEY对Payload进行AES加密并进行Base64编码；最后，构造一个向目标站点发送的POST请求，将加密后的Payload放入X-XSRF-TOKEN请求头中。若漏洞存在，服务器将执行Payload中的系统命令。投毒风险分析：该POC项目主要由Dockerfile、README和利用脚本组成，代码逻辑清晰，主要使用了标准的Docker指令和PHP原生加密库。投毒风险处于低位（约15%），主要风险点在于其依赖外部工具PHPGGC的集成。在自动化利用脚本中，如果攻击者修改了Payload生成逻辑，例如在加密层中嵌入静默执行的恶意后门代码，普通研究员仅看流量很难察觉。此外，由于该漏洞近期被Androxgh0st、Mozi等僵尸网络及威胁组织广泛利用，互联网上流传的许多所谓‘一键化检测脚本’可能包含混淆的Base64编码或远程下载指令（如curl | sh），此类脚本具有极高的恶意投毒风险。本POC代码本身未发现明显恶意混淆，但建议在隔离的沙箱环境中使用，并仔细核对PHPGGC生成的Payload内容，以防在复现过程中反向被控制。组织应严格检查.env文件权限，防止APP_KEY泄露。

**项目地址:** [https://github.com/kozmic/laravel-poc-CVE-2018-15133](https://github.com/kozmic/laravel-poc-CVE-2018-15133)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)
