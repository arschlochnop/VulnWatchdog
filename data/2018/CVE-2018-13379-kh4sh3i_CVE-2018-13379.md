## CVE-2018-13379 - Fortinet FortiGate SSL VPN 路径遍历 (Path Traversal)

**漏洞编号:** CVE-2018-13379

**漏洞类型:** 路径遍历 (Path Traversal)

**影响应用:** Fortinet FortiGate SSL VPN

**危害等级:** 高危 - 未经身份验证的攻击者可访问受限目录之外的敏感系统文件，导致信息泄露。

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)

**影响版本:** FortiOS 5.4.6至5.4.12版本、5.6.3至5.6.7版本及6.0.0至6.0.4版本

**利用条件:** 需要网络访问、无需认证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 0%

## 详情

POC有效性分析: 该Python POC脚本，`CVE-2018-13379.py`，是一个针对Fortinet FortiGate SSL VPN 目录遍历漏洞 (CVE-2018-13379) 的完整利用工具。脚本功能健全且设计良好，能够有效利用目标漏洞。它通过向目标FortiGate设备的`/remote/fgt_lang`接口发送一个特制的HTTP GET请求，并在`lang`参数中嵌入路径遍历序列`lang=/../../../..//////////dev/cmdb/sslvpn_websession`，从而绕过访问控制，下载通常受保护的`sslvpn_websession`文件。该文件通常包含活跃或历史的VPN会话信息，包括用户名和会话令牌。

脚本的有效性体现在以下几个方面：
1.  **目标定位准确**: 直接针对漏洞存在的核心URL和参数。
2.  **数据提取能力**: 成功下载`sslvpn_websession`文件后，脚本会对其进行本地保存和解析。它使用正则表达式`username\s*=\s*"([^"]+)"`和`websession":"([a-f0-9]+)"`来准确匹配并提取文件中的用户名和会话令牌。
3.  **异常处理**: 脚本包含了对连接错误和读取超时的处理，增强了其在不理想网络环境下的健壮性。
4.  **多目标支持**: 利用`multiprocessing`模块，该脚本可以并行处理多个目标IP地址，极大地提高了扫描效率。
5.  **清晰的输出**: 成功提取到信息后，脚本会清晰地打印出发现的用户名和会话令牌，并提供进一步利用的建议。尽管脚本默认使用HTTPS并禁用了SSL验证（`verify=False`），这在某些部署中可能需要调整，但它依然能够成功复现漏洞并窃取敏感信息，证明其作为一个完整利用POC的可靠性。其无需认证的特性，结合对敏感会话信息的直接访问，使得该漏洞具有极高的潜在危害。

利用步骤:
1.  **目标识别**: 攻击者首先需要识别暴露在互联网上的Fortinet FortiGate SSL VPN设备。这通常通过端口扫描（例如，FortiGate VPN常用端口如10443）或使用Shodan等搜索引擎完成。
2.  **脚本准备**: 获取并准备`CVE-2018-13379.py`脚本。确保Python环境和必要的库（如`requests`）已安装。
3.  **执行攻击**: 攻击者使用脚本针对目标IP地址或IP列表执行攻击。例如：`python CVE-2018-13379.py -i <目标IP>` 或 `python CVE-2018-13379.py -f <IP列表文件>`。
4.  **数据获取**: 脚本会尝试通过路径遍历漏洞下载`sslvpn_websession`文件。如果成功，文件将保存到本地，并且脚本会自动解析该文件，提取出其中包含的用户名和会话令牌。
5.  **会话劫持**: 攻击者可以利用获取到的会话令牌，在没有密码的情况下重放或劫持合法的VPN会话。这通常涉及将获取到的会话令牌作为Cookie注入到浏览器或通过其他工具进行请求，从而绕过认证过程，以受害用户的身份访问内部网络资源。这个过程是自动化且无需认证的，极大地降低了攻击门槛和复杂度。

投毒风险分析: 对`CVE-2018-13379.py`的POC代码进行全面分析后，可以确定其投毒风险为0%，属于低风险范畴。
1.  **代码清晰度**: 脚本代码结构清晰，逻辑一目了然，所有函数和变量都命名规范，易于阅读和理解。没有发现任何代码混淆或加密现象。
2.  **依赖库**: 脚本仅依赖于Python标准库和常用的第三方库（如`requests`、`optparse`、`multiprocessing`、`re`），这些库都是业界广泛接受且经过安全审查的。脚本没有引入任何可疑的外部依赖项或动态加载外部代码的行为。
3.  **恶意行为检测**: 脚本的核心功能是向目标FortiGate设备发送HTTP/HTTPS请求，并将响应数据（`sslvpn_websession`文件）保存到本地，然后解析该本地文件。此行为完全符合漏洞验证和利用的预期目的。所有的网络请求都直接指向用户指定的目标IP，没有发现向未知或恶意服务器发送数据、指令或其他通信的行为。文件操作仅限于将从目标设备下载的数据写入到本地，以及读取该本地文件进行解析。没有发现删除、修改系统文件，创建后门，植入恶意程序等非法文件操作。脚本没有执行任何系统命令，也没有尝试修改系统配置或权限。
4.  **资源滥用**: 脚本使用了`multiprocessing`进行并发处理，这是一种正常的性能优化手段，不属于资源滥用。综上所述，该POC代码严格遵循了漏洞利用验证的边界，未包含任何超出其声明功能的恶意载荷或行为。其设计和实现透明、安全，因此可以安全地用于防御性安全研究和测试。

**项目地址:** N/A

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2018-13379
