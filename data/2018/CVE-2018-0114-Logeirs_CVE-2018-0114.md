## CVE-2018-0114 - Cisco node-jose library JWT Token Forging

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT Token Forging

**影响应用:** Cisco node-jose library

**危害等级:** Critical

**CVSS评分:** CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**影响版本:** Prior to version 0.11.0

**利用条件:** No authentication required, network access

**POC 可用性:** 9/10

**POC 类型:** Full exploit

**攻击复杂度:** Low

**投毒风险:** 10%

## 详情

CVE-2018-0114 is a critical vulnerability affecting the Cisco node-jose library, which allows attackers to forge JWT tokens. The vulnerability stems from insufficient validation of the public key embedded within the JWT header. An attacker can craft a malicious JWT by embedding a crafted public key in the "jwk" field of the header. The server, upon receiving this JWT, uses the provided public key to verify the token's signature. Since the attacker controls the public key, they can generate a corresponding private key and sign the token, effectively bypassing authentication. 

The provided POC code `CVE-2018-0114.py` demonstrates this vulnerability. The script takes a payload as an argument, generates a new RSA key pair, crafts a JWT header containing the public key, signs the JWT with the corresponding private key, and prints the forged JWT. The script begins by generating a new RSA key pair (public and private keys) or loading existing keys from 'pubkey.pem' and 'privkey.pem' if they exist. These keys are used to create a forged JWT. The script encodes the public key's modulus ('n') and exponent ('e') into base64 URL-safe strings. It then constructs a JWT header including these encoded values within the 'jwk' parameter.  The header also specifies the algorithm as RS256 (RSA Signature with SHA-256). The provided payload is also base64 URL-safe encoded. The crafted header and payload are combined, and the resulting string is signed using the generated private key, creating a forged signature. Finally, the script combines the encoded header, encoded payload, and encoded signature to form the complete JWT, which is then printed to standard output. A successful exploit allows an attacker to impersonate any user or gain unauthorized access to resources protected by JWT authentication.

**Exploitation Steps:**
1.  Run the Python script `CVE-2018-0114.py` with the desired payload as an argument (e.g., `python CVE-2018-0114.py '{"user":"admin"}'`).
2.  The script will generate (or load from file) an RSA key pair and construct a forged JWT.
3.  The script outputs the forged JWT. Send the forged JWT to the vulnerable server.
4.  The server, upon receiving the JWT, will use the embedded public key to verify the signature.
5.  Because the attacker controls the public key, the signature verification will succeed, granting the attacker access.

**投毒风险分析:**
The POC code itself has a low poisoning risk. It primarily utilizes standard Python libraries like `rsa` and `base64`. The code generates RSA keys, encodes data, and constructs a JWT, which are all legitimate cryptographic operations. There are no immediately obvious attempts to inject malicious code or execute arbitrary commands. However, the risk arises if the generated key pair, particularly the private key, were to be exfiltrated or shared. If this occurred, an attacker could use the private key to generate further malicious JWTs, impersonating legitimate users. The risk is categorized as low (10%) because the code's primary function is to demonstrate a known vulnerability. The reliance on RSA key generation, which could introduce subtle weaknesses if not handled correctly, contributes slightly to the risk.

**项目地址:** https://pentesterlab.com/exercises/cve-2018-0114

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2018-0114
