## CVE-2018-10933 - libssh 身份验证绕过

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 0.6.0 及以上版本 (在 0.7.6 和 0.8.4 中修复)

**利用条件:** 目标服务器运行受影响版本的 libssh 且启用服务端功能，攻击者可直接通过网络访问。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：提供的 Python 代码是一个针对 CVE-2018-10933 的基础扫描器。从代码结构来看，它的有效性仅限于通过 Banner 识别（Banner Grabbing）来检测目标是否运行 libssh 0.6.0 版本。虽然标题声称是漏洞扫描器，但其核心逻辑极其简陋，仅仅是建立 Socket 连接并检查返回的 Banner 字符串中是否包含 '0.6.0'。这种检测方式存在极高的误报率和漏报率，因为它忽略了 0.7.x 和 0.8.x 等同样受影响的版本，且无法处理 Banner 混淆的情况。真正的 CVE-2018-10933 漏洞利用逻辑在于协议层面的操作：在服务器期望接收 SSH2_MSG_USERAUTH_REQUEST 消息以开始认证流程时，攻击者发送一个 SSH2_MSG_USERAUTH_SUCCESS 消息。由于 libssh 服务端代码在处理消息时缺乏状态机的一致性检查，它会误认为认证已经成功完成，从而直接授予攻击者 shell 访问权限。本 POC 代码并未实现这一核心的协议绕过逻辑，仅能作为一个非常初级的资产探测工具，而非深度的漏洞验证工具。利用步骤：1. 攻击者准备包含目标 IP 或列表的输入文件。2. 运行脚本并指定目标（-t）或文件（-f）。3. 脚本建立 TCP 连接并发送一个空字节触发 Banner 返回。4. 脚本正则匹配字符串。5. 若匹配成功，可选调用 ipinfo.io 的 API 进行地理位置查询。投毒风险分析：该脚本目前的投毒风险处于低水平。代码使用了标准的 Python 库如 socket、argparse 和 urllib，以及常见的第三方库 colorama。在静态代码审计中，并未发现明显的恶意混淆、加密 Payload 或反弹 Shell 代码。然而，值得警惕的是脚本中的 geolocation 函数：它将目标的 IP 地址发送到了外部 API (ipinfo.io)。虽然这在扫描器中是常见功能，但在受控环境下，这会导致扫描行为被第三方平台记录，可能造成扫描意图泄露。此外，脚本头部打印了 Facebook 社交链接（RELDSEC），此类带有强烈个人或组织色彩的 POC 往往带有宣传目的，使用时需防范后续版本引入自动上传扫描结果的逻辑。目前版本未见 eval() 等危险函数，代码逻辑透明，但因其功能过于简单且依赖外部 API，不建议在对保密性要求极高的内网环境中使用。

**项目地址:** N/A

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)
