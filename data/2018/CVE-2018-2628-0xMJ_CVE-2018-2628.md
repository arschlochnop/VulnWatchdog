## CVE-2018-2628 - Oracle WebLogic Server 反序列化RCE

**漏洞编号:** CVE-2018-2628

**漏洞类型:** 反序列化RCE

**影响应用:** Oracle WebLogic Server

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3

**利用条件:** 通过T3协议进行网络访问，无需身份验证

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对Oracle WebLogic Server的T3协议漏洞实现。该漏洞本质上是WebLogic在处理T3协议请求时，由于对Java反序列化过程缺乏足够的过滤，导致攻击者可以通过精心构造的序列化对象绕过补丁机制（特别是绕过之前的CVE-2015-4852黑名单）。POC通过三个关键步骤实现利用：首先，模拟T3协议的握手过程（t3_handshake），发送特定的协议头部字符串，从而与目标端口（通常为7001）建立T3连接。其次，利用ysoserial工具生成特定的JRMPClient有效载荷。关键点在于POC构造了一个包含JRMPClient对象的T3请求包，利用反序列化机制诱导WebLogic服务器向攻击者控制的远程JRMPListener发起连接。最后，通过攻击者主机上运行的JRMPListener返回恶意的CommonsCollections等利用链，实现在目标服务器上的远程命令执行。此POC代码逻辑严密，直接操作Socket字节流，对T3数据包进行了精细构造，具备极高的实操性，且包含了对多种JRMPClient变体（如Registry和Activator）的支持，能够有效覆盖不同补丁环境下的利用场景。利用步骤：1. 在攻击者可控的主机上启动JRMPListener（推荐使用ysoserial-pri-beta版本），设置监听端口并指定要执行的系统命令，如反弹Shell；2. 启动本地监听器（如nc -lvp）接收反弹的Shell连接；3. 运行此Python脚本，参数包括目标WebLogic服务器IP、端口、ysoserial路径以及JRMPListener的地址信息；4. 脚本完成T3握手并注入载荷，触发服务器回调，完成RCE。投毒风险分析：对POC代码进行静态审计后发现，该脚本主要使用Python标准库（socket, binascii, os）编写，逻辑透明，主要功能是构造网络发包和调用本地ysoserial工具，未发现明显的代码混淆或恶意隐藏行为。风险点主要集中在外部依赖上：脚本注释中提供的ysoserial下载链接（[github.com/brianwrf](https://github.com/brianwrf)）为第三方维护的分支，虽然在漏洞利用界广为人知，但在防御性研究中，直接下载并运行未经审计的第三方二进制JAR包存在‘供应链投毒’的潜在风险。攻击者可能在编译JAR包时植入针对渗透测试者主机的后门。此外，脚本中的os.system调用直接拼接了命令行参数，若用户在本地环境中传入恶意的参数路径，可能导致本地命令注入风险。综合评估，该Python脚本本身是安全的，但其引导下载的第三方工具包具有中低度投毒风险，建议在沙箱环境中使用官方编译的ysoserial。针对此类防御研究，应重点关注T3协议的访问控制，建议组织通过防火墙禁用T3协议外部访问或升级至Oracle发布的最新补丁。 

**项目地址:** [https://github.com/brianwrf/ysoserial/releases/tag/0.0.6-pri-beta](https://www.google.com/search?q=https://github.com/brianwrf/ysoserial/releases/tag/0.0.6-pri-beta)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-2628](https://nvd.nist.gov/vuln/detail/CVE-2018-2628)
