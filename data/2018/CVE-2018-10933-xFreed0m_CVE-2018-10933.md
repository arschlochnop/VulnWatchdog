## CVE-2018-10933 - libssh 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** libssh 0.6.0 及以上版本，在 0.7.6 和 0.8.4 版本之前受影响

**利用条件:** 目标服务器运行受影响版本的 libssh 且开启了服务器端功能，攻击者需能够通过网络连接到该 SSH 服务端口。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞的根源在于 libssh 服务器端状态机处理逻辑错误。正常流程中，客户端应发送 SSH2_MSG_USERAUTH_REQUEST 请求开始认证，但由于代码逻辑缺陷，如果攻击者直接向服务器发送 SSH2_MSG_USERAUTH_SUCCESS 消息，服务器会错误地将其解释为认证已成功，并允许攻击者在未提供任何凭据的情况下进入。提供的 Python POC 代码利用 paramiko 库构建了一个底层传输通道，通过 `msg.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)` 直接注入成功信号。代码通过 `transport._send_message(msg)` 发送伪造消息后，立即尝试 `open_session` 并执行 `exec_command`。这种利用方式直接触及了漏洞核心逻辑，在受影响的旧版本服务器上具有极高的成功率。POC 结构完整，包含了版本检测（Banner Grab）和命令执行两个功能模块，逻辑清晰且具备实战价值。利用步骤：首先，攻击者利用 socket 连接目标主机的 SSH 端口并获取 Banner 字符串，通过匹配版本号（如 0.7.x 或 0.8.x 的特定范围）初步判断是否存在漏洞。其次，初始化 paramiko 传输层，在不调用常规 auth_password 或 auth_publickey 方法的情况下，手动构造一个包含认证成功字节码的消息包并发送。最后，若服务器接受该消息，攻击者即可开启一个新的 Channel 并通过 exec_command 执行任意系统命令，获取返回的 stdout 和 stderr 流。投毒风险分析：该 POC 代码表现出较低的恶意投毒风险，但存在几点需要防御者注意。代码中包含一个 `pip_installer` 函数，该函数使用 `subprocess.call` 自动调用系统 shell 安装 `paramiko` 和 `termcolor` 库。虽然这在工具易用性上是有益的，但在安全审计中，这种静默执行安装脚本的行为常被视为潜在风险点，可能被利用来下载带有后门的依赖包。代码逻辑本身是透明的，主要使用了标准库 `socket` 和流行的第三方库 `paramiko`，未发现明显的代码混淆、远程 Shell 反弹至第三方服务器或敏感文件窃取行为。代码中的 `vuln1` 和 `vuln2` 判断逻辑存在一处逻辑小缺陷（使用 `or` 判断字符串成员关系时不够严谨），但这属于编程质量问题而非恶意投毒迹象。整体而言，该脚本作为安全研究和防御性测试工具是安全的，但在执行前建议在隔离沙箱环境中手动安装依赖，以规避 `pip_installer` 可能带来的供应链风险。

**项目地址:** [https://www.libssh.org/security/advisories/CVE-2018-10933.txt](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)
