## CVE-2018-10933 - libssh 身份验证绕过 (Authentication Bypass)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过 (Authentication Bypass)

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** libssh 0.6 及更高版本，且早于 0.7.6 或 0.8.4

**利用条件:** 目标服务器运行受影响版本的 libssh 且作为 SSH 服务端运行；攻击者能够通过网络访问该服务的端口（通常为 22 或 2222）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本漏洞的核心逻辑在于 libssh 状态机的逻辑缺陷。正常流程下，SSH 客户端应发送 SSH2_MSG_USERAUTH_REQUEST 开始认证。然而，在受影响的版本中，服务端代码在未收到请求的情况下，若直接收到客户端发送的 SSH2_MSG_USERAUTH_SUCCESS 消息，会错误地将内部状态机直接更新为‘已认证’状态，从而跳过所有密码或密钥检查。提供的 POC 包含了一个 Dockerfile 环境，用于构建一个特定易受攻击的 0.8.3 版本 libssh 服务器示例（ssh_server_fork）。通过 patch 文件手动引入漏洞并编译，确保了环境的确定性。此 POC 属于高价值的实验室复现环境，攻击者只需使用简单的 Python 脚本（利用 Paramiko 或 libssh 绑定）发送特定的成功消息即可直接开启 Channel（如 shell 或 exec），验证逻辑极为简单且高度可靠。利用步骤：1. 使用提供的 Dockerfile 构建镜像并启动容器。2. 容器内部会运行一个监听在特定端口（如 22）的 libssh 示例服务器。3. 攻击者编写客户端脚本，初始化 SSH 连接。4. 在认证阶段，不发送任何凭据请求，直接构造并发送一个字节码为 SSH2_MSG_USERAUTH_SUCCESS 的数据包。5. 观察服务端反馈，若连接未断开且允许打开 Session/Channel，则绕过成功。6. 进一步通过该 Channel 执行命令。投毒风险分析：该 POC 主要由 Dockerfile、Patch 补丁和 README 组成。经过静态代码审计，Dockerfile 使用了 Arch Linux 基础镜像并安装了标准的开发工具链（cmake, gcc, make），下载地址指向 libssh 官方或镜像源，未发现 curl 恶意 shell 脚本或指向可疑域名的行为。Patch 文件仅用于修改 libssh 源码以复现漏洞逻辑，不包含后门代码。README 文件提供了基础的使用说明。虽然该 POC 的利用价值极高，但代码结构透明，所有编译过程均在容器内完成，对宿主机的污染风险极低。风险点主要在于用户如果直接运行不明来源的二进制 patch 或预编译镜像，可能存在中间人劫持风险，但在当前代码片段中，所有指令均属于合规的安全研究范畴，未发现混淆代码或隐藏的系统级持久化后门。建议在隔离的沙箱环境中进行构建和测试，以防潜在的依赖项投毒。

**项目地址:** [https://github.com/libssh/libssh](https://www.google.com/search?q=https://github.com/libssh/libssh)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)
