## CVE-2018-10933 - libssh 身份验证绕过/远程代码执行 (RCE)

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 身份验证绕过/远程代码执行 (RCE)

**影响应用:** libssh

**危害等级:** CRITICAL

**CVSS评分:** 9.1 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** libssh 0.6 及更高版本 (0.8.4 和 0.7.6 之前的版本)

**利用条件:** 目标服务器启用了 libssh 服务端代码，且攻击者可以建立网络连接。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC代码利用了libssh库服务端实现中的一个逻辑漏洞。正常SSH握手过程中，客户端应发送MSG_USERAUTH_REQUEST来开始认证，但在受影响的版本中，如果客户端直接向服务端发送MSG_USERAUTH_SUCCESS消息，libssh的服务端状态机将直接跳转到认证成功状态，而无需任何密码或密钥验证。本POC通过Python的paramiko库底层调用手动构造了cMSG_USERAUTH_SUCCESS消息，在start_client初始化后直接触发该状态。分析代码逻辑：s.connect连接目标，trans.start_client启动客户端传输层，接着调用trans._send_message(msg)发送伪造的成功响应。由于libssh服务端不检查该消息是否由服务端自己发出，连接会直接进入已认证状态。之后脚本通过open_session和exec_command执行命令并读取输出。该POC逻辑清晰，直接针对协议状态机缺陷，利用效率极高，在实验室环境下具有极高的复现成功率。利用步骤如下：1. 安装依赖库paramiko；2. 准备受影响的libssh容器环境；3. 运行脚本并指定目标IP、端口及要执行的命令；4. 脚本建立连接并发送绕过包，成功后返回远程命令执行结果。 【投毒风险分析】经过对提供的POC代码（CVE-2018-10933.py）进行静态分析，未发现明显的恶意混淆或后门植入迹象。脚本引用的库均为标准库（sys, socket）和常用的第三方安全库（paramiko）。代码逻辑中，虽然出现了paramiko.util.log_to_file("filename.log")，这属于标准的日志记录行为，不构成窃取凭据的恶意行为。脚本的主要功能是演示漏洞利用，其输出（Output: ...）仅限于命令回显。项目README中提到的捐赠链接（paypal.me）属于开发者个人的打赏请求，不属于技术层面的恶意攻击。评估认为，该代码属于清晰、直观的研究脚本，投毒风险极低（约10%）。风险主要来源于用户在未经审计的情况下从非官方渠道下载可能被二次修改的版本。目前的脚本仅执行用户输入的命令行参数，不具备自我复制、敏感文件外传或执行加密勒索等恶意Payload。防御建议：组织应立即升级libssh至最新补丁版本，并利用防火墙限制不必要的SSH端口暴露，同时监控异常的SSH认证状态转移日志。

**项目地址:** [https://www.youtube.com/watch?v=2mBNS2vxSIU](https://www.youtube.com/watch?v=2mBNS2vxSIU)

**漏洞详情:** [https://www.libssh.org/security/advisories/CVE-2018-10933.txt](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)
