## CVE-2018-13379 - Fortinet FortiOS, FortiGate SSL VPN 路径遍历/任意文件读取

**漏洞编号:** CVE-2018-13379

**漏洞类型:** 路径遍历/任意文件读取

**影响应用:** Fortinet FortiOS, FortiGate SSL VPN

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** FortiOS 5.4.6至5.4.12, 5.6.3至5.6.7, 6.0.0至6.0.4

**利用条件:** 无需认证,通过网络访问

**POC 可用性:** 8/10

**POC 类型:** 概念验证(检测)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

Fortinet FortiOS SSL VPN中存在一个严重的路径遍历漏洞（CVE-2018-13379），该漏洞允许未经身份验证的远程攻击者通过构造特殊的HTTP请求，读取系统上的敏感文件。此漏洞的根源在于FortiGate SSL VPN的HTTP接口未能正确地过滤和处理请求路径中的特殊元素，例如，攻击者可以利用`/remote/fgt_lang`接口，通过在`lang`参数中插入`../`等目录遍历字符，来访问受限目录之外的文件系统。成功的利用可导致攻击者下载包含敏感配置信息、用户会话数据甚至用户明文凭据的文件。例如，攻击者常常利用此漏洞读取会话文件以获取用户名和密码，从而绕过身份验证，进而可能与FortiOS的其他漏洞（如CVE-2018-13383堆溢出漏洞）结合，实现完整的远程代码执行。由于无需认证即可利用，且攻击复杂度低，此漏洞对受影响的FortiGate设备构成重大风险，已在野外被广泛利用。

**POC有效性分析**
提供的Go语言POC工具名为“At Doom Fortigate”，其设计目标是通过Tor网络匿名扫描Rapid7 Project Sonar数据中可能存在CVE-2018-13379漏洞的Fortigate主机。该工具的有效性非常高，它直接针对漏洞的核心检测机制进行实现。它通过向目标FortiGate设备的SSL VPN接口（通常是TCP 10443端口）发送特制的HTTP GET请求，例如构造包含`../../..`的路径，尝试读取FortiOS系统上的特定配置文件。具体而言，POC的`CheckVuln`函数会发送请求，并检查HTTP响应中是否包含FortiOS配置文件特有的字符串（如`<item key="locale_config"`, `[global]`, `Language =`等）。如果响应体中包含这些特征字符串，则工具会判定目标主机存在路径遍历漏洞，并成功泄露了系统文件内容。此POC并非用于远程代码执行的完整利用工具，而是一个健壮的漏洞检测工具，能够精确地验证目标系统是否容易受到CVE-2018-13379的攻击。它符合防御性安全研究的目的，通过自动化扫描大规模识别潜在的受影响资产，从而协助组织进行漏洞修复和防御。该工具使用Go语言编写，代码结构清晰，依赖Go标准库以及`zerolog`（日志）和`gjson`（JSON解析）这两个知名的第三方库，代码质量较高，易于理解和审计，确保了其功能性和可靠性。其利用步骤明确，只需要获取Rapid7数据、配置Tor代理后即可运行。

**利用步骤**
1.  **获取Rapid7扫描数据**: 从Rapid7 Project Sonar下载端口10443的HTTPS扫描数据（JSON格式），并将该文件放置在`at-doom-fortigate`工具指定的`/data`目录下。
2.  **配置Tor网络**: 启动Tor浏览器或独立的Tor服务，确保主机能够通过Tor网络进行匿名连接。工具在启动时会检查Tor的连接状态。
3.  **编译与运行工具**: 下载`at-doom-fortigate`项目的源代码，使用Go编译器进行编译（`go build -v -a .`），然后运行编译后的可执行文件。
4.  **执行漏洞扫描**: 工具将自动遍历Rapid7数据中的每个IP地址或域名，通过Tor网络向目标FortiGate设备的SSL VPN接口（通常监听在10443端口）发送构造的HTTP请求，尝试利用路径遍历漏洞读取预设的系统敏感文件。
5.  **输出扫描结果**: 扫描完成后，所有被检测为存在CVE-2018-13379漏洞的主机信息将输出到`results.txt`文件中。

**投毒风险分析**
根据对提供的POC代码的详细分析，该项目的投毒风险评估为**低（5%）**。评估依据如下：
1.  **代码透明度与结构**: POC代码具有清晰的GitHub仓库地址、明确的README文件和规范的Go语言源代码结构。代码可读性高，未发现任何代码混淆或加密，使得其内部逻辑易于审查。
2.  **依赖库分析**: 项目仅依赖`github.com/rs/zerolog`和`github.com/tidwall/gjson`这两个Go模块。`zerolog`是一个流行的日志库，而`gjson`则是一个高效的JSON解析库，两者均为Go社区中广泛使用且信誉良好的开源项目。未发现任何不常见的、可疑的或已知的恶意第三方依赖。
3.  **核心功能验证**: 工具的核心功能是针对CVE-2018-13379漏洞的检测与扫描。其网络请求行为是向目标FortiGate设备发送特制的HTTP请求以验证路径遍历漏洞，并通过检查响应内容来确认漏洞是否存在。这种行为完全符合漏洞验证的预期，不涉及任何攻击或恶意操作。
4.  **无恶意载荷或后门**: 代码中没有发现执行任意系统命令、下载并执行外部可疑文件、篡改系统配置、植入后门、进行加密货币挖矿或其他任何非预期的恶意行为。所有的网络连接都是通过Tor代理，且仅针对FortiGate目标，用于合法的漏洞检测。
5.  **无外部脚本或动态加载**: 代码中没有使用`eval`函数、动态加载外部脚本、反射性地执行外部代码或任何可能隐藏恶意逻辑的代码混淆技术。
6.  **匿名性要求**: 工具明确要求用户通过Tor网络进行匿名扫描，这是一种标准的、合法的安全研究实践，旨在保护研究人员的身份，而非掩盖恶意活动。
综上所述，该POC代码是为合法的安全研究和漏洞检测目的而设计，其代码透明、行为可预测，且使用的依赖库无异常，因此投毒风险极低。该工具应被视为一种防御性资源，旨在帮助组织识别并保护受影响的系统。

**项目地址:** https://github.com/jpiechowka/at-doom-fortigate.git

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2018-13379
