## CVE-2018-15133 - Laravel Framework RCE (远程代码执行)

**漏洞编号:** CVE-2018-15133

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Laravel Framework

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Laravel Framework <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要获取受害站点的 APP_KEY (通常源于 .env 文件泄露或配置不当)；目标开启了 XSRF 保护功能。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】：该POC是一个使用Go语言编写的成熟利用工具，针对CVE-2018-15133漏洞提供了极高的实用价值。漏洞根源在于Laravel在处理带有X-XSRF-TOKEN请求头的数据时，会使用APP_KEY对加密内容进行解密，随后直接调用unserialize()进行反序列化，导致了不安全的反序列化风险。POC通过模拟这一过程，接收用户输入的APP_KEY和命令，自动选择合适的PHP反序列化链（内置了四种不同的RCE Payload模式，涵盖了Laravel常见的PendingBroadcast或Faker/Generator链），并利用AES加密算法和HMAC签名生成符合Laravel安全校验逻辑的数据包。在测试记录中，POC成功执行了'id'和'cat /etc/passwd'命令并返回了服务器敏感信息。由于该漏洞利用不需要传统的认证登录，且Laravel广泛使用XSRF中间件，只要APP_KEY泄露，该POC的成功率极高，具备全自动化的潜力，是目前针对该CVE最直接且最具杀伤力的利用脚本之一。

【利用步骤】：1. 确定目标Laravel站点的APP_KEY（通常通过搜素公开暴露的.env文件或历史泄露数据获取）。2. 准备该Go语言编写的POC工具。3. 执行命令格式为：./CVE-2018-15133 -URL [目标地址] -API_KEY [Base64编码的APP_KEY] -command [待执行命令]。4. 可通过更改-method参数尝试不同的Payload链以适配特定的小版本差异。5. 观察返回结果确认命令执行成功。

【投毒风险分析】：经过对POC源码（main.go）的深度审计，未发现明显的恶意行为。代码逻辑清晰，依赖项均属于Go标准库（如crypto/aes, crypto/hmac, encoding/json等），未引入不可信的外部二进制文件或远程脚本下载。其核心逻辑集中在PHP反序列化字符串的构建、AES加密、以及构造符合Laravel标准的JSON负载（包含iv, value, mac字段）。代码中的网络交互部分仅指向用户通过命令行指定的URL参数，不存在向第三方服务器发送敏感数据（如泄露的APP_KEY或受害者IP）的隐蔽后门。虽然代码具有较强的破坏性，但其属于纯粹的漏洞验证工具，不具备蠕虫传播、文件加密或驻留后门等恶意软件特征。由于代码开源且逻辑透明，攻击者难以在不引起注意的情况下植入混淆代码，因此投毒风险评级极低（5%），主要风险在于工具本身被脚本小子用于非法攻击。

**项目地址:** N/A (本地分析文件: /tmp/vulnwatchdog_0515af99038e86519a7780402e05d3ae)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2018-15133](https://nvd.nist.gov/vuln/detail/cve-2018-15133)
