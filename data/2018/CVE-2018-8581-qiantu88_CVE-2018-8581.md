## CVE-2018-8581 - Microsoft Exchange Server SSRF/权限提升

**漏洞编号:** CVE-2018-8581

**漏洞类型:** SSRF/权限提升

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危

**CVSS评分:** 7.4

**影响版本:** Exchange 2010 SP1/SP2/SP3, Exchange 2013, Exchange 2016

**利用条件:** 需要拥有一个有效的低权限Exchange邮箱账号、网络可达

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

关于POC有效性的详细分析：CVE-2018-8581是一个位于Microsoft Exchange Server中的重大漏洞，其根本原因在于Exchange允许任何通过身份验证的用户订阅其自身的推送通知。通过操纵Exchange服务器向攻击者控制的恶意HTTP服务器发送请求（SSRF），攻击者可以利用NTLM重放攻击，将请求转发回Exchange服务器的EWS接口。由于Exchange服务（SYSTEM权限）在与自身通信时会默认信任其来源，攻击者可以借此伪造管理员身份执行操作。提供的Python脚本功能非常完整，不仅包含了NTLM身份验证的握手逻辑（使用ntlm库），还预设了不同版本的Exchange SOAP请求模板（如AddDelegate操作）。该POC通过HTTPServer监听本地端口，准备接收来自Exchange服务器的重放连接，其核心逻辑严密，涵盖了从身份验证到提权的关键步骤，在满足网络通达且拥有基础账号的前提下，该利用程序具有极高的实战有效性。利用步骤如下：1. 配置脚本中的目标Exchange服务器IP（mail.target_domain.com）和端口。2. 填入已获取的普通用户邮箱凭据（USER/PASS）。3. 设置目标管理员邮箱（TARGET_EMAIL）。4. 启动脚本，脚本会先通过EWS发送一个Subscribe请求，并诱导Exchange服务器连接攻击者的HTTP服务器。5. 脚本拦截NTLM挑战并进行重放，通过AddDelegate接口将攻击者的账号添加为目标管理员邮箱的代理，从而获取其邮件读取权限。关于投毒风险的深度分析：该POC代码结构清晰，主要依赖Python标准库（httplib, ssl, BaseHTTPServer）和开源的ntlm认证库，未发现明显的恶意混淆或后门植入行为。代码中的外部链接指向已知的GitHub安全研究仓库（WyAtu/CVE-2018-8581），属于公开的安全研究成果。脚本中的变量命名规范且逻辑直观，所有网络请求均围绕Exchange的EWS接口展开，没有向第三方未知IP发送敏感信息的行为。唯一的外部依赖是ntlm库，建议在隔离环境中使用pip进行安装，以防供应链投毒。代码中关于EVIL_HTTPSERVER_URL的配置属于该利用链中必要的攻击基础设施设置，并非恶意投毒。整体来看，该脚本是一个纯粹的防御性/渗透测试工具，投毒风险评级为低（10%），主要风险点在于用户可能从非官方渠道下载到被篡改的版本。

**项目地址:** [https://github.com/WyAtu/CVE-2018-8581](https://github.com/WyAtu/CVE-2018-8581)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-8581](https://nvd.nist.gov/vuln/detail/CVE-2018-8581)
