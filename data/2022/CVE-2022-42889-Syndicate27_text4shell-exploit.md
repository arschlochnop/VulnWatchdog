## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 受影响的应用使用了 Apache Commons Text 的 StringSubstitutor 类，并配置了默认的插值器（Interpolators），且将未经清洗的用户输入传递给该类进行解析。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC针对Apache Commons Text的Text4Shell漏洞（CVE-2022-42889）提供了极高完整性的利用代码。漏洞核心在于StringSubstitutor类支持多种插值器，其中'script'、'dns'和'url'等协议在默认配置下极具威胁。POC利用了'script'插值器，配合JavaScript引擎（如Nashorn）在JVM中执行恶意代码。代码通过Python构造了一个带有'${script:javascript:...}'格式的Payload。有效性方面，POC通过构建一个包含反弹Shell指令的Java Runtime执行语句，并将其进行URL编码后嵌入到HTTP请求的查询参数中。该代码逻辑严密，利用了标准库http.client进行低层级的请求构造，绕过了常规高级库可能存在的解析差异，非常适合在受控环境进行漏洞复现。利用步骤：1. 在攻击机（callback_ip）上启动监听器（如nc -nlvp 4444）。2. 确认目标应用暴露了接收字符串插值处理的接口。3. 执行Python脚本，传入目标IP、监听IP及端口。4. 脚本发出POST请求，触发目标服务器执行Bash反弹Shell命令，从而获取系统控制权。分析表明，该漏洞利用无需任何身份验证，且攻击载荷构造简单，对暴露在外的Java Web应用具有极高的威胁。 【投毒风险分析】经过对提供的Python源代码（text4shell.py）进行深入审查，该脚本的投毒风险评级为极低（5%）。代码结构清晰且透明，主要使用了Python标准库如urllib.parse、http.client和sys，未发现引入任何第三方混淆包或外部恶意依赖。其核心Payload构造逻辑完全公开，即通过字符串格式化生成的JavaScript代码块，这在安全研究中属于标准的、可预期的行为。脚本不包含任何隐蔽的网络通信逻辑（除了向用户指定的target_ip发送请求以及Payload中明确声明的反弹Shell回连），也没有对本地文件系统进行读写、窃取敏感凭证或植入持久化后门的操作。Readme文档提供了清晰的使用指南和免责声明，符合开源安全研究的规范。唯一需要注意的风险点是用户在执行POC时必须手动替换Payload中的IP地址，这防止了代码被直接用于预设目标的僵尸网络攻击。总体而言，该代码是一个纯粹的教育与防御研究工具，未发现任何针对使用者的恶意投毒意图或潜在的供应链攻击特征。

**项目地址:** n/a (Local File Path: /tmp/vulnwatchdog_b18f555ff44f73dec67c2cf23a08ba3c/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
