## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; WSO2 Identity Server 5.2.0 - 5.11.0; WSO2 Identity Server Analytics 5.4.0 - 5.6.0; WSO2 Identity Server as Key Manager 5.3.0 - 5.10.0; WSO2 Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需认证，可通过网络直接访问/fileupload端点

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞是由于WSO2产品中fileupload端点的输入验证不足导致的。分析提供的main.py代码，脚本通过生成随机命名的JSP文件，利用目录穿越漏洞（../../../../）将恶意的Webshell上传到服务器的webapps/authenticationendpoint/目录下。该POC代码逻辑清晰，使用了标准的requests库进行POST请求上传文件，随后通过GET请求触发执行。脚本包含了完整的攻击链条：随机化文件名以避开特征检测、利用特定的文件上传路径绕过权限限制、以及最后的验证步骤。代码中使用了time.sleep(15)等待服务器部署上传的WAR/JSP文件，显示了开发者对WSO2热部署机制的了解。利用步骤：1. 准备目标主机列表和待执行的系统命令。2. 脚本生成一个包含Java Runtime.exec执行逻辑的JSP Webshell。3. 向目标的/fileupload/toolsAny接口发送POST请求，将Webshell写入持久化目录。4. 等待15秒让Webshell生效。5. 访问上传后的URL并传递cmd参数以获取执行结果。投毒风险分析：该POC项目属于较低风险。代码审查显示其主要逻辑是标准的漏洞利用演示，使用了常见的第三方库如requests和colored，并未发现明显的代码混淆、非法外部连接、环境变量窃取或针对执行机（安全研究员机器）的恶意行为。代码中的'randomString'和'formatConsoleDate'功能均使用标准Python库实现，没有隐藏的base64加密payload。虽然README中提到的GitHub地址'SystemVll/CVE-2022-29464-loader.git'需要谨慎访问以防供应链攻击，但就目前分析的脚本本身而言，主要风险在于其作为武器化工具可能被滥用，而非对使用者进行投毒。建议在使用此类POC时，在隔离沙箱环境中运行，并使用Burp Suite等工具截获其发出的所有出站流量，以确保没有未经授权的数据传输。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
