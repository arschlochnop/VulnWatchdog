## CVE-2022-26134 - Atlassian Confluence Server and Data Center OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** All versions before 7.4.17, from 7.13.0 before 7.13.7, from 7.14.0 before 7.14.3, from 7.15.0 before 7.15.2, from 8.0.0 before 8.0.3, from 8.1.0 before 8.1.3, from 8.2.0 before 8.2.2

**利用条件:** 无需认证，网络可达

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2022-26134 是 Atlassian Confluence Server 和 Data Center 中的一个 OGNL 注入漏洞。该漏洞允许未经身份验证的攻击者在 Confluence Server 或 Data Center 实例上执行任意代码。PoC 代码通过构造包含恶意 OGNL 表达式的 URL，利用了 Confluence Server 在处理特定请求时对 OGNL 表达式的解析过程中的缺陷。该漏洞存在于处理 URL 参数的过程中，允许攻击者通过精心构造的参数注入恶意的 OGNL 代码，从而执行任意系统命令。PoC 提供的 Python 脚本 `CVE_2022_26134.py` 模拟了这一攻击过程。该脚本首先检查目标 Confluence 实例是否在线，然后尝试获取 Confluence 的版本信息。如果目标在线且版本信息成功获取，脚本会构造一个包含 OGNL 表达式的 URL，并将其发送到目标服务器。OGNL 表达式的目标是执行用户指定的命令，并将命令的输出通过 HTTP 响应头 `X-Cmd-Response` 返回。脚本使用 `requests` 库发送 HTTP 请求，并使用 `BeautifulSoup` 库解析 HTML 响应。脚本会检查 HTTP 响应的状态码和响应头，以确定攻击是否成功。如果状态码为 302 且响应头中包含 `X-Cmd-Response`，则认为攻击成功，并将命令的输出打印到控制台。如果攻击失败，脚本会打印错误消息。利用步骤如下：
1. 运行 PoC 脚本，指定目标 Confluence 实例的 URL 和要执行的命令。
2. 脚本会发送包含恶意 OGNL 表达式的 HTTP 请求到目标服务器。
3. 目标服务器执行 OGNL 表达式，从而执行用户指定的命令。
4. 命令的输出通过 HTTP 响应头返回给攻击者。

投毒风险分析：此 PoC 代码的投毒风险较低。代码结构清晰，主要使用了 `requests` 和 `BeautifulSoup` 两个标准库，没有发现明显的恶意行为。代码中包含免责声明，明确指出该工具仅用于教育目的，禁止用于非法攻击。虽然该 PoC 允许执行任意命令，但它本身并没有包含任何恶意代码或后门程序。然而，攻击者可能会修改 PoC 代码，添加恶意功能，例如植入后门、窃取敏感数据等。因此，在使用该 PoC 时，需要仔细审查代码，确保其安全性。PoC 中唯一的潜在风险在于，攻击者可能会将执行命令的输出作为字符串传递到 HTTP 响应头中。虽然这本身不是一个直接的投毒行为，但攻击者可能会利用这一点，将恶意代码注入到响应头中，从而实现更隐蔽的攻击。总之，该 PoC 代码本身的投毒风险较低，但需要注意潜在的恶意修改和利用。

**项目地址:** https://github.com/topics/cve-2022-26134

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2022-26134
