## CVE-2022-29464 - WSO2 API Manager, Identity Server, Analytics, Enterprise Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, Identity Server, Analytics, Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0及以上, Identity Server 5.2.0及以上, 多个其他WSO2产品

**利用条件:** 无需认证，可通过互联网直接访问受影响的 /fileupload 端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞由安全研究员Orange Tsai发现，是一个极其严重且易于利用的漏洞。其根本原因在于WSO2产品中的FileUploadServlet对上传路径缺乏有效的访问控制。在WSO2的架构中，/fileupload端点在identity.xml中被配置为secured="false"，且在Java代码的handleSecurity方法中，CarbonUILoginUtil.handleLoginPageRequest会显式地对包含/fileupload的路径返回CONTINUE或RETURN_TRUE，从而绕过了所有的认证检查。攻击者可以利用这一特性，通过构造恶意的HTTP POST请求，将任意JSP脚本文件上传到服务器的Web根目录下（如../repository/deployment/server/webapps/目录）。由于上传的文件无需认证即可执行，攻击者只需随后通过浏览器访问上传的JSP路径，即可在服务器上下文中执行任意操作系统命令。该POC代码展示了完整的利用链，包括分析FileUploadServlet的源代码以及如何通过特制的请求绕过安全过滤，其有效性极高。利用步骤：1. 确认目标系统存在 /fileupload 接口且未修复补丁；2. 构造一个多部分表单数据（multipart/form-data）的POST请求；3. 在文件名中使用目录遍历符号（如 ../../ ）以确保文件被放置在可解析的Web目录下；4. 上传包含恶意指令的JSP Webshell；5. 访问上传后的文件路径（例如 https://target/authenticationendpoint/shell.jsp）执行命令。投毒风险分析：该POC项目主要由技术文档和核心漏洞逻辑组成，代码逻辑清晰透明。通过对hakivvi/CVE-2022-29464仓库的分析，代码使用了标准的Java Web交互逻辑，没有发现混淆代码、未授权的外部域名请求或恶意后门植入。投毒风险极低，仅为5%。此5%的风险主要源于此类高价值RCE漏洞的POC往往会被第三方镜像或非官方分发渠道篡改。研究人员在使用时应直接参考原始GitHub仓库或官方公告，避免运行来自不可信来源的可执行二进制利用工具。在受控环境测试时，建议将JSP内容替换为无害的指令（如whoami或id），以验证漏洞存在性而非执行破坏性操作。整体而言，该仓库是一个纯粹的防御性研究资源，其包含的Java源码片段和利用说明是为了帮助防御者理解攻击原理，以便配置WAF规则或及时更新补丁。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
