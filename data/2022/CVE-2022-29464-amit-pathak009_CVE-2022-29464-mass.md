## CVE-2022-29464 - WSO2 Carbon Server (API Manager, Identity Server, Enterprise Integrator, etc.) RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 Carbon Server (API Manager, Identity Server, Enterprise Integrator, etc.)

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Identity Server Analytics 5.4.0 - 5.6.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需身份验证（Pre-auth），需能够通过网络访问受影响产品的 /fileupload 接口。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个基于Python编写的完整利用工具，具有极高的实战价值。其核心逻辑非常直接：利用WSO2 Carbon框架中FileUploadServlet组件的漏洞，通过向 /fileupload/toolsAny 端点发送POST请求，将恶意的JSP Webshell上传到服务器。POC中巧妙地利用了目录穿越路径（../../../../repository/deployment/server/webapps/）将文件写入到Web可访问的目录中，从而绕过安全限制实现远程代码执行。代码中包含了详细的利用载荷，且集成了批量扫描功能和Rich库美化的输出，是一份高质量的自动化渗透工具。该POC不仅验证了漏洞的存在，还提供了直接获取命令执行权限的手段。利用步骤：1. 确认目标系统属于受影响的WSO2版本；2. 使用POC中的exploit.py脚本，通过-u参数指定目标URL；3. 脚本会自动构造包含JSP Webshell的多部分表单数据（Multipart Form Data），通过POST请求发送至 /fileupload/toolsAny；4. 脚本利用路径穿越将Webshell部署在 /authenticationendpoint/trkn0x.jsp；5. 攻击者随后访问该路径，通过cmd参数执行系统命令。投毒风险分析：该代码段投毒风险较低，属于常规的安全研究脚本。经过静态代码审计，未发现明显的混淆、外部恶意域名回连或敏感信息窃取逻辑。代码中导入的库（requests, urllib3, argparse, rich）均为Python标准库或常用的开源库，无异常依赖。POC中虽然包含了一个JSP Webshell的Payload，并指向了一个外部图片地址（b.top4top.io），但这在Webshell模板中常作为作者标识，不构成针对攻击者机器的投毒威胁。脚本的核心功能仅限于漏洞验证和利用，逻辑透明。风险主要在于该POC工具的易用性极高，可能被初级攻击者（脚本小子）用于大规模扫描。在防御性研究中使用此类脚本时，应在受控环境中运行，并监控其是否会产生非预期的网络流量。虽然目前未见恶意行为，但使用第三方提供的 exploit 脚本仍需保持警惕，防止在后续更新中被植入针对渗透测试人员的后门。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
