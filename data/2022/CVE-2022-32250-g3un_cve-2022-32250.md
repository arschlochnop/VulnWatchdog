# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

# CVE-2022-32250

> ğŸ“¦ è¯¥CVEæœ‰ **6** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-32250-Kristal-g_CVE-2022-32250.md](../2022/CVE-2022-32250-Kristal-g_CVE-2022-32250.md)

## CVE-2022-32250 - Linux Kernel Use-After-Free in Netfilter

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„èƒ½åŠ›ã€‚éå®¹å™¨åŒ–çš„ Red Hat Enterprise Linux 8 å—å½±å“ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äº Linux kernel çš„ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ª Use-After-Free æ¼æ´ï¼Œç”±äºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥å¯¼è‡´ã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆexploit.cï¼‰ä½¿ç”¨ libmnl å’Œ libnftnl åº“ä¸ Netfilter å­ç³»ç»Ÿäº¤äº’ï¼Œæ„å»ºå’Œå‘é€ Netlink æ¶ˆæ¯ã€‚
2.  è¯¥æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«äº†ä¸€äº›å¿…è¦çš„å¤´æ–‡ä»¶ï¼Œå¦‚ linux/netlink.hã€linux/netfilter.h å’Œ libmnl/libmnl.h ç­‰ã€‚
3.  åˆ©ç”¨ä»£ç å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ç›¸å…³çš„ KMALLOC_64_OBJS_PER_SLAB å’Œ KMALLOC_96_OBJS_PER_SLABï¼Œä»¥åŠå†…æ ¸åœ°å€åç§»ï¼Œç”¨äºåœ¨ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚
4.  è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä½¿ç”¨ä¸€ç³»åˆ— Netfilter æ“ä½œæ¥è§¦å‘ Use-After-Free æ¼æ´ï¼Œå¹¶éšååˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚
5.  æ¼æ´åˆ©ç”¨å¯èƒ½æ¶‰åŠåˆ›å»º nf_tables çš„ table, set, rule, chain ç­‰å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„æ“ä½œåºåˆ—è§¦å‘ UAFã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢ç»“æœï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„ POC ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚ç†è®ºä¸Šï¼Œè¯¥ POC å¯ä»¥åœ¨å—å½±å“çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°æœ¬åœ°ææƒã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»æä¾›çš„ä»£ç æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†ä»£ç æ˜¯ç”¨äºæ¼æ´åˆ©ç”¨ï¼Œä½†ç”±äºæ˜¯äºŒè¿›åˆ¶å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ å†…æ ¸åœ°å€ï¼Œæœ‰é€šè¿‡ä¿®æ”¹å†…æ ¸åœ°å€çš„æ–¹å¼æ¤å…¥åé—¨ä»£ç çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œåˆ¤æ–­å­˜åœ¨5%çš„æŠ•æ¯’é£é™©ã€‚ä¸»è¦é£é™©ç‚¹åŒ…æ‹¬ï¼š

*   å†…æ ¸åœ°å€ç¡¬ç¼–ç ï¼šåˆ©ç”¨ä»£ç åŒ…å«å†…æ ¸åœ°å€åç§» (offset_*)ï¼Œå¦‚æœè¿™äº›åç§»é‡è¢«æ¶æ„ä¿®æ”¹æŒ‡å‘å…¶ä»–å†…æ ¸å‡½æ•°æˆ–æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å†…æ ¸è¡Œä¸ºã€‚
*   åˆ©ç”¨æµç¨‹ç¯¡æ”¹ï¼šå¦‚æœæ„å»º Netfilter è§„åˆ™å’Œæ“ä½œçš„é¡ºåºè¢«ä¿®æ”¹ï¼Œå¯èƒ½ä¼šè§¦å‘å…¶ä»–æ¼æ´æˆ–å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚
*   ROPé“¾ç¯¡æ”¹: å¯èƒ½ä¼šæ›¿æ¢ROPé“¾ä¸­çš„æŒ‡ä»¤,ä»¥å®ç°æ¶æ„ç›®çš„

å°½ç®¡å­˜åœ¨è¿™äº›é£é™©ï¼Œä½†ä»ä»£ç æ•´ä½“æ¥çœ‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„ UAF æ¼æ´ï¼Œè€Œéæ•…æ„å¼•å…¥æ–°çš„æ¶æ„ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [Kristal-g/CVE-2022-32250](https://github.com/Kristal-g/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #2

**æ¥æº**: [CVE-2022-32250-KuanKuanQAQ_cve-testing.md](../2022/CVE-2022-32250-KuanKuanQAQ_cve-testing.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF ææƒ

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net namespaces çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux kernel ä¸­ netfilter å­ç³»ç»Ÿ net/netfilter/nf_tables_api.c æ–‡ä»¶ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚é€šè¿‡ä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼‰å¯ä»¥å°†æƒé™æå‡åˆ° rootã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœ(ç‰¹åˆ«æ˜¯theori.ioçš„åšå®¢å’Œgithubé“¾æ¥)ï¼Œå·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”å·²ç»æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åœ¨ Ubuntu 22.04 ä¸Šå®ç° root æƒé™æå‡ã€‚å› æ­¤ï¼Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç å¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**
æä¾›çš„ä»£ç ç‰‡æ®µæ˜¯ COPYING å’Œ CREDITS æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„æŠ•æ¯’é£é™©ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ¼æ´åˆ©ç”¨ä»£ç é€šå¸¸éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œï¼Œæ¶æ„ä¿®æ”¹æˆ–æ·»åŠ åé—¨çš„å¯èƒ½æ€§è¾ƒä½ã€‚è¯„ä¼°è¯¥å‹ç¼©åŒ…å…¶ä»–ä»£ç ï¼ŒCOPYING å’Œ CREDITS æ–‡ä»¶ä¸å¤ªå¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œé¢„ä¼°æŠ•æ¯’æ¦‚ç‡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æ:**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ–¹å¼çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š

1.  **è§¦å‘æ¡ä»¶ï¼š** æ”»å‡»è€…éœ€è¦æœ‰åˆ›å»º user/net namespaces çš„æƒé™ã€‚è¿™é€šå¸¸æ„å‘³ç€æ”»å‡»éœ€è¦åœ¨éå®¹å™¨åŒ–çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæˆ–è€…åœ¨å®¹å™¨ä¸­å…·æœ‰ CAP_SYS_ADMIN æƒé™ã€‚
2.  **æ¼æ´ç‚¹ï¼š** æ¼æ´å­˜åœ¨äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®å¯¼è‡´ UAFã€‚
3.  **åˆ©ç”¨æ­¥éª¤ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ ç‰¹å®šçš„ netfilter è§„åˆ™ï¼Œè§¦å‘ UAF æ¼æ´ã€‚é€šå¸¸æ¶‰åŠåˆ›å»ºå’Œåˆ é™¤ nf_tables setï¼Œåˆ©ç”¨ UAF è¦†ç›–å†…æ ¸å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è¿›ç¨‹çš„å‡­æ®ä¿¡æ¯ï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
4.  **ç¼“è§£æªæ–½ï¼š** æ›´æ–° Linux å†…æ ¸åˆ°å—å½±å“ç‰ˆæœ¬ä¹‹åï¼Œæˆ–è€…ç¦ç”¨ user/net namespace åˆ›å»ºï¼Œå¯ä»¥ç¼“è§£æ­¤æ¼æ´ã€‚ Red Hatæåˆ°éå®¹å™¨åŒ–éƒ¨ç½²çš„ RHEL 8 å—å½±å“ã€‚

**é¡¹ç›®åœ°å€:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #3

**æ¥æº**: [CVE-2022-32250-g3un_cve-2022-32250.md](../2022/CVE-2022-32250-g3un_cve-2022-32250.md)

## CVE-2022-32250-Linux Kernel Netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter å­ç³»ç»Ÿä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ”»å‡»è€…å¦‚æœèƒ½å¤Ÿåˆ›å»º user/net å‘½åç©ºé—´ï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡åˆ° rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœï¼Œå·²ç»æœ‰ç›¸å…³çš„åˆ©ç”¨ä»£ç å’Œåˆ†ææ–‡ç« å…¬å¼€ï¼ˆä¾‹å¦‚ï¼šhttps://github.com/theori-io/CVE-2022-32250-exploit å’Œ https://www.nccgroup.com/us/research-blog/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/ ï¼‰ã€‚è¿™è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚

ä½†æ˜¯ï¼Œæä¾›çš„ POC ä»£ç  `/tmp/f2ab93d92009870f2107b6f0c402dd40/README.md` ä»…ä»…æ˜¯ä¸€ä¸ª README æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œ**ä¸èƒ½ç›´æ¥éªŒè¯POCçš„æœ‰æ•ˆæ€§**ï¼Œéœ€è¦è·å–å®é™…å¯æ‰§è¡Œçš„PoCä»£ç æ‰è¡Œã€‚å°½ç®¡å¦‚æ­¤ï¼Œè€ƒè™‘åˆ°å·²ç»æœ‰å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ï¼Œå¯ä»¥åˆ¤å®šå­˜åœ¨æœ‰æ•ˆçš„POCã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ–‡ä»¶ `/tmp/f2ab93d92009870f2107b6f0c402dd40/README.md` ä»…ä»…åŒ…å« `# CVE-2022-32250`ï¼Œ**æ˜¯ä¸€ä¸ªç©ºçš„ README æ–‡ä»¶ï¼Œä¸åŒ…å«ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ï¼Œå› æ­¤ç›´æ¥çš„æŠ•æ¯’é£é™©è¾ƒä½ã€‚** ä½†è€ƒè™‘åˆ°å¯èƒ½è¢«å…¶ä»–æ¶æ„æ–‡ä»¶è¦†ç›–ï¼Œæˆ–è¢«ç”¨ä½œåç»­æŠ•æ¯’çš„å ä½ç¬¦ï¼Œé£é™©ä¸å¯å¿½ç•¥ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚æ›´é«˜æ¦‚ç‡åœ¨äºï¼Œä¸‹è½½åˆ©ç”¨ä»£ç æ—¶å¼•å…¥äº†æœªçŸ¥çš„æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š
1.  æ”»å‡»è€…éœ€è¦å…·å¤‡åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›ã€‚
2.  æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ï¼Œç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´ use-after-freeã€‚
3.  é€šè¿‡ç²¾å¿ƒæ„é€ çš„ netfilter è§„åˆ™ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚
4.  åˆ©ç”¨ use-after-free æ¼æ´è¿›è¡Œå†…å­˜æ“ä½œï¼Œæœ€ç»ˆå®ç°æƒé™æå‡ã€‚

æ€»ä½“è€Œè¨€ï¼ŒCVE-2022-32250 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è·å¾— root æƒé™ã€‚åŠæ—¶æ›´æ–°å†…æ ¸ç‰ˆæœ¬æ˜¯é˜²èŒƒæ­¤æ¼æ´çš„æœ‰æ•ˆæ–¹æ³•ã€‚

**é¡¹ç›®åœ°å€:** [g3un/cve-2022-32250](https://github.com/g3un/cve-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---



---

## POC #4

**æ¥æº**: [CVE-2022-32250-seadragnol_CVE-2022-32250.md](../2022/CVE-2022-32250-seadragnol_CVE-2022-32250.md)

## CVE-2022-32250-Linux Kernel netfilter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·ææƒè‡³root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespacesçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux Kernel netfilter å­ç³»ç»Ÿ nf_tables_api.c ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚æ¼æ´å­˜åœ¨äº 5.18.1 ä¹‹å‰çš„ Linux kernel ä¸­ã€‚ å…·æœ‰åˆ›å»º user/net å‘½åç©ºé—´æƒé™çš„æœ¬åœ°ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æƒé™æå‡ä¸º rootï¼Œå› ä¸ºä¸æ­£ç¡®çš„ NFT_STATEFUL_EXPR æ£€æŸ¥ä¼šå¯¼è‡´ use-after-freeã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºï¼š
*   æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨ã€‚
*   å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¹¶ä¸”æœ‰åšå®¢æ–‡ç« è¯¦ç»†æè¿°äº†åˆ©ç”¨è¿‡ç¨‹ã€‚
*   README.md æ–‡ä»¶ä¸­è¯´æ˜äº†æµ‹è¯•å†…æ ¸ç‰ˆæœ¬ (5.13) å’ŒæˆåŠŸç‡ (~70%)ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚è™½ç„¶ä»£ç çš„ç›®çš„æ˜¯åˆ©ç”¨ CVE-2022-32250ï¼Œä½†ä»ç„¶å­˜åœ¨æ¶æ„ä¿®æ”¹ä»£ç çš„å¯èƒ½ï¼Œä»¥è¾¾åˆ°å…¶ä»–ç›®çš„ï¼Œå¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚`ex.sh`è„šæœ¬å¤åˆ¶ä¸€äº›æœªçŸ¥æ–‡ä»¶ï¼ˆx, dummyï¼‰åˆ°/tmp ç›®å½•ï¼Œè™½ç„¶è„šæœ¬ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ‰§è¡Œï¼Œä½†è¿™äº›æ–‡ä»¶çš„å…·ä½“å†…å®¹å’Œä½œç”¨æœªçŸ¥ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚

Makefile ä¸­ä½¿ç”¨äº† `-static -no-pie` é€‰é¡¹, è™½ç„¶å¯ä»¥æé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¢åŠ æ”»å‡»è€…åœ¨ç¼–è¯‘æ—¶åµŒå…¥æ¶æ„ä»£ç çš„éš¾åº¦. exploit.c ä¸­çš„`fuse_spray.h`ï¼Œæ„å‘³ç€ä½¿ç”¨äº†fuseå–·å°„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†`fuse_spray.c`æ–‡ä»¶ã€‚è€Œfuseå–·å°„æŠ€æœ¯çš„å¯é æ€§ä¸æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ç›¸å…³ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€å®šçš„å¤±è´¥æ¦‚ç‡. ä»£ç ä¸­è¿˜åŒ…å«`monke.c`ï¼Œä½†æœªåŒ…å«ä»£ç å†…å®¹ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„é£é™©

åŸºäºä¸Šè¿°åˆ†æï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç¯å¢ƒå‡†å¤‡ï¼š** è®¾ç½® user å’Œ network å‘½åç©ºé—´ï¼Œè¿™é€šå¸¸éœ€è¦ root æƒé™æˆ–è€…å…·æœ‰ CAP_SYS_ADMIN èƒ½åŠ›ã€‚
2.  **æ¼æ´è§¦å‘ï¼š** åˆ›å»ºä¸€ä¸ª netfilter è¡¨ã€é“¾å’Œé›†åˆï¼Œå¹¶é…ç½®çŠ¶æ€è¡¨è¾¾å¼ã€‚æ¼æ´æ˜¯ç”±äº NFT_STATEFUL_EXPR çš„ä¸æ­£ç¡®æ£€æŸ¥å¯¼è‡´çš„ï¼Œä¼šé€ æˆ UAFã€‚
3.  **å †å–·å°„ï¼ˆHeap Sprayï¼‰ï¼š** åˆ©ç”¨ FUSE è¿›è¡Œå †å–·å°„ï¼Œå°†å¯æ§æ•°æ®å¡«å……åˆ°é‡Šæ”¾çš„å†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿åœ¨ UAF å‘ç”Ÿæ—¶è¦†ç›–è¯¥å†…å­˜ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµç¨‹ã€‚
4.  **æƒé™æå‡ï¼š** è¦†ç›–çš„å†…å­˜å†…å®¹è¢«æ„é€ ä¸ºæŒ‡å‘æ¶æ„ä»£ç æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæœ€ç»ˆå°†æƒé™æå‡ä¸º rootã€‚`ex.sh`ä¸­æ‰§è¡Œ`monke`ä»¥åŠ`dummy`æœ‰å¯èƒ½æ˜¯è§¦å‘ææƒçš„æ“ä½œã€‚å…¶ä¸­`dummy`å¯èƒ½ç”¨æ¥å æ®å†…å­˜ï¼Œ`monke`æ˜¯æœ€ç»ˆææƒçš„payloadã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¼æ´åˆ©ç”¨ï¼Œéœ€è¦å¯¹ Linux å†…æ ¸ã€netfilter å’Œå †ç®¡ç†æœºåˆ¶æœ‰æ·±å…¥çš„ç†è§£ã€‚

**é¡¹ç›®åœ°å€:** [seadragnol/CVE-2022-32250](https://github.com/seadragnol/CVE-2022-32250)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #5

**æ¥æº**: [CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md](../2022/CVE-2022-32250-theori-io_CVE-2022-32250-exploit.md)

## CVE-2022-32250-Linux Kernel Privilege Escalation

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·å¯æå‡è‡³rootæƒé™

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»ºuser/net namespaceçš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-32250 å­˜åœ¨äºLinux kernelçš„netfilteræ¨¡å—çš„nf_tables_api.cä¸­ã€‚æ¼æ´æ˜¯ç”±äºä¸æ­£ç¡®çš„NFT_STATEFUL_EXPRæ£€æŸ¥å¯¼è‡´use-after-freeã€‚æœ¬åœ°ç”¨æˆ·å¦‚æœå¯ä»¥åˆ›å»ºuser/net namespaceï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™è‡³rootã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœï¼Œä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´åº“ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·ææƒï¼Œå¹¶æä¾›äº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚æœç´¢å¼•æ“ç»“æœä¸­ï¼Œæœ‰å¤šä¸ªé“¾æ¥æŒ‡å‘äº†æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨ï¼Œä¾‹å¦‚ theori.io çš„åšå®¢ï¼Œä»¥åŠ NCC Group çš„ç ”ç©¶åšå®¢ï¼Œè¿™äº›éƒ½è¡¨æ˜è¯¥æ¼æ´æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚POCä»£ç æœ¬èº«ä¹Ÿæä¾›äº†ç¼–è¯‘å’Œè¿è¡Œçš„æŒ‡å¯¼ï¼Œä»¥åŠä¸€ä¸ªDemoè§†é¢‘é“¾æ¥ã€‚

**æŠ•æ¯’é£é™©ï¼š**
å¯¹æä¾›çš„exp.cä»£ç è¿›è¡Œäº†åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ç¼–è¯‘ä¾èµ–ï¼š** ä»£ç éœ€è¦ä¾èµ– `libmnl` å’Œ `libnftnl` åº“ã€‚å¦‚æœè¿™äº›åº“è¢«ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚
2.  **slab ç ´åè­¦å‘Šï¼š**  ä»£ç ä¸­çš„æ³¨é‡Šæ˜ç¡®æŒ‡å‡º â€œThis exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.â€ è™½ç„¶è¿™æœ¬èº«æ˜¯æ¼æ´åˆ©ç”¨çš„å‰¯ä½œç”¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ¥ä½œä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚
3.  **rootæƒé™æ‰§è¡Œbash:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.å¦‚æœæ”»å‡»è€…ç¯¡æ”¹äº†ä»£ç ,å°† bashæ›¿æ¢ä¸ºå…¶ä»–æ¶æ„ç¨‹åºï¼Œå°±ä¼šé€ æˆè¿œç«¯æ‰§è¡Œã€‚

ç»¼ä¸Šï¼Œåˆ¤æ–­æŠ•æ¯’é£é™©çš„æ¦‚ç‡çº¦ä¸º10%ã€‚è¯¥é£é™©ä¸»è¦æ¥è‡ªäºä¾›åº”é“¾æŠ•æ¯’(åº“è¢«ç¯¡æ”¹)å’Œåˆ©ç”¨ä»£ç è¢«ç¯¡æ”¹åä¼ æ’­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **è§¦å‘UAFï¼š** æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒæ˜¯è§¦å‘use-after-freeã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„netfilterè§„åˆ™ï¼Œåˆ©ç”¨NFT_STATEFUL_EXPRçš„é”™è¯¯æ£€æŸ¥é‡Šæ”¾æœ¬ä¸åº”è¯¥é‡Šæ”¾çš„å†…å­˜ã€‚
2.  **å †å–·å°„ï¼š** é‡Šæ”¾åï¼Œè¿›è¡Œå †å–·å°„ï¼Œç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å¡«å……é‡Šæ”¾çš„å†…å­˜ã€‚
3.  **è¦†ç›–ï¼š** è¦†ç›–å…³é”®çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ task_struct ç»“æ„ä½“ä¸­çš„ cred å­—æ®µã€‚
4.  **ææƒï¼š** é€šè¿‡ä¿®æ”¹ cred å­—æ®µï¼Œå°†å½“å‰è¿›ç¨‹çš„ uidã€gid ç­‰æƒé™ä¿¡æ¯ä¿®æ”¹ä¸º root æƒé™ã€‚
5.  **get shell:** ä»£ç åˆ©ç”¨æˆåŠŸä¼šè°ƒç”¨system("bash")è·å–shell.

**é¡¹ç›®åœ°å€:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

## POC #6

**æ¥æº**: [CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md](../2022/CVE-2022-32250-ysanatomic_CVE-2022-32250-LPE.md)

## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**æ¼æ´ç¼–å·:** CVE-2022-32250

**æ¼æ´ç±»å‹:** Use-After-Free (UAF)

**å½±å“åº”ç”¨:** Linux Kernel Netfilter

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ç”¨æˆ·æƒé™æå‡è‡³ root

**å½±å“ç‰ˆæœ¬:** <= 5.18.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦åˆ›å»º user/net å‘½åç©ºé—´çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-32250 æ˜¯ Linux å†…æ ¸ netfilter æ¨¡å—ä¸­çš„ä¸€ä¸ªä½¿ç”¨åé‡Šæ”¾æ¼æ´ã€‚æ¼æ´ä½äº `net/netfilter/nf_tables_api.c` æ–‡ä»¶ä¸­ã€‚ç”±äº `NFT_STATEFUL_EXPR` æ£€æŸ¥ä¸æ­£ç¡®ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å°†æœ¬åœ°ç”¨æˆ·æƒé™æå‡åˆ° root æƒé™ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è§¦å‘ UAFï¼š** åˆ›å»ºä¸€ä¸ªåŒ…å« `nft_lookup` æ“ä½œçš„ netfilter è§„åˆ™é›†ï¼Œè¯¥æ“ä½œå¼•ç”¨ä¸€ä¸ªå‘½åé›†åˆã€‚åœ¨åˆ›å»ºé›†åˆæ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è®¾ç½® `NFT_STATEFUL_EXPR` æ ‡å¿—ï¼Œå¯¼è‡´é‡Šæ”¾åä»ç„¶å¯ä»¥è®¿é—®é›†åˆã€‚
2.  **å †å–·å°„ï¼š** ä½¿ç”¨æˆ·ç©ºé—´ key payload æ¥è¦†ç›– UAF åçš„å†…å­˜ï¼Œæ§åˆ¶å†…å­˜ä¸­çš„æ•°æ®ã€‚
3.  **KASLR ç»•è¿‡:** é€šè¿‡å †æ³„æ¼åˆ©ç”¨UAFæ¥è·å–kernelåœ°å€,ç»•è¿‡KASLRã€‚
4.  **æƒé™æå‡ï¼š** åˆ©ç”¨UAFä¿®æ”¹`modprobe_path`å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¶æ„è„šæœ¬ã€‚å½“å†…æ ¸å°è¯•åŠ è½½ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„æ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œ `modprobe_path` æŒ‡å‘çš„è„šæœ¬ï¼Œä»è€Œè·å¾— root æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„ POC ä»£ç å£°ç§°åœ¨ 5.12.0 ç‰ˆæœ¬ä¸Šæœ‰æ•ˆã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å­˜åœ¨äº Linux kernel 5.18.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤è¯¥ POC ä»£ç å¾ˆå¯èƒ½æœ‰æ•ˆã€‚

**æŠ•æ¯’é£é™©ï¼š**

æŸ¥çœ‹äº†æä¾›çš„ exploit.c ä»£ç å’Œ README.md æ–‡ä»¶ã€‚è™½ç„¶ä¸èƒ½å®Œå…¨ä¿è¯æ²¡æœ‰éšè—çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä»ä»£ç çš„ç»“æ„å’Œé€»è¾‘æ¥çœ‹ï¼Œä»¥åŠä½œè€…åœ¨ README.md ä¸­çš„å£°æ˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚ ä»£ç ä¸»è¦æµç¨‹æ˜¯åˆ©ç”¨ netfilter çš„ UAF æ¼æ´è¿›è¡Œå †å–·å°„å’Œ `modprobe_path` è¦†ç›–ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ ä½†æ˜¯ï¼Œä»å­˜åœ¨æå°çš„å¯èƒ½æ€§ä½œè€…å­˜åœ¨éšè—åé—¨ä»£ç ï¼Œæ•…æ¦‚ç‡ä¸º1%ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ­¤æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ã€‚

**é¡¹ç›®åœ°å€:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)

---

