## CVE-2022-29464 - WSO2 Identity Server, API Manager, Enterprise Integrator 任意文件上传/RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传/RCE

**影响应用:** WSO2 Identity Server, API Manager, Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需认证，可通过网络直接访问目标接口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC代码具有极高的实用性和有效性。它针对WSO2产品中fileupload/toolsAny接口的路径穿越漏洞进行了精准实现。代码首先定义了一个标准的Java JSP WebShell，能够接收'cmd'参数并通过Runtime.getRuntime().exec()执行系统命令。利用的核心在于构建了一个恶意的Multipart请求，其中的文件名部分使用了路径穿越字符'../../../../'，将WebShell强制写入到webapps/authenticationendpoint目录下，这是因为该目录具有可执行JSP权限且无需认证即可访问。POC中包含了自动化的Banner展示、主机格式校验、POST请求发送以及后续的GET请求存活性验证，逻辑闭环。通过分析可见，该POC能够直接将受害服务器权限交由攻击者控制，是典型的‘一键式’利用工具。利用步骤：1. 攻击者准备一个包含Java后门代码的JSP文件。2. 构造一个指向目标服务器/fileupload/toolsAny接口的POST请求。3. 在HTTP请求的form-data中，将filename参数修改为包含路径穿越序列的字符串，指向Web服务可公开访问的路径（如authenticationendpoint）。4. 发送请求后，服务器由于缺乏对上传路径的过滤，会将文件写入指定目录。5. 攻击者通过浏览器或脚本访问上传后的JSP路径（如https://target/authenticationendpoint/shell.jsp），通过URL参数传递指令实现远程代码执行。投毒风险分析：经过对提供的Python代码进行静态分析，未发现明显的恶意行为或投毒迹象。代码主要使用了requests、urllib3和colorama等标准/常用第三方库，没有进行代码混淆（Obfuscation）。其逻辑清晰，主要功能集中在构造HTTP请求和处理服务器响应上。虽然代码中定义了一个JSP WebShell字符串，但那是攻击载荷（Payload）的一部分，用于验证漏洞存在，而非针对运行此脚本的渗透测试人员的攻击行为。代码中没有发现向外部异常IP回传数据、删除本地文件或执行系统级Shell指令的隐藏逻辑。投毒风险评级为低（10%），该风险主要源于网络安全工具普遍存在的潜在供应链风险。建议使用者在执行前，重点核查requests.post中的目标URL是否被硬编码指向了第三方监控服务器，目前此样本中目标完全由用户命令行输入控制，属于安全的漏洞验证工具。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
