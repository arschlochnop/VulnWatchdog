## CVE-2022-47966 - Zoho ManageEngine 多款产品 (包括 ServiceDesk Plus, Endpoint Central, PAM360 等) 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-47966

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Zoho ManageEngine 多款产品 (包括 ServiceDesk Plus, Endpoint Central, PAM360 等)

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** ServiceDesk Plus < 14003, Endpoint Central < 10.1.2228.11 等 24 款产品的特定旧版本

**利用条件:** 受影响产品必须已配置并启用基于 SAML 的单点登录 (SSO)

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞源于 ManageEngine 多款产品中使用的 Apache Santuario (xmlsec) 库在处理 SAML 响应时的不安全实现。提供的 POC 代码是一个典型的 SAMLResponse XML 负载，核心利用点在于对 `<ds:Transform>` 标签中 XSLT 转换的滥用。通过 `http://www.w3.org/TR/1999/REC-xslt-19991116` 算法，攻击者可以注入恶意的 XSLT 样式表。在 POC 示例中，利用了 Apache Xalan 的 Java 扩展功能，通过调用 `rt:getRuntime()` 获取运行时环境并执行 `rt:exec()`。此 POC 具备高度的实战价值，因为它直接展示了如何绕过签名验证之前的逻辑来触发代码执行。POC 演示了执行 `powershell nslookup yourserver` 命令，这是一种经典的带外数据 (OOB) 验证方法，用于确认命令是否成功执行而不直接返回结果。该 payload 结构完整，包含了 SAML 响应所需的全部核心组件，如 Issuer、Status、Assertion 和 Signature 部分。通过将此 XML 进行 Base64 编码并提交至系统的 SAML 处理端点，可在未授权的情况下实现远程系统命令执行，攻击面极广且利用稳定。【利用步骤】1. 识别目标 ManageEngine 实例是否启用了 SAML SSO 认证。2. 构造恶意的 SAMLResponse XML 负载，在 XSLT Transform 部分填入目标执行命令。3. 将整个 XML 负载进行 Base64 编码。4. 构造一个 POST 请求发送至目标的 `/SamlResponseServlet` 路径。5. 将编码后的负载填入 `SAMLResponse` 参数中。6. 观察目标服务器是否执行了预定指令（如 DNS 请求或反弹 Shell）。【投毒风险分析】该 POC 脚本及 README 文档表现出较高的透明度，属于典型的安全研究产物。代码逻辑清晰，主要使用了标准化的 XML 标签和 XSLT 语法，没有进行任何混淆或加密处理。POC 中执行的命令为 `nslookup`，这被广泛认为是无害的探测行为，用于验证漏洞存在而非进行破坏。风险评估方面，由于该代码不涉及第三方二进制下载、隐藏的 Shell 脚本或外部未经授权的 IP 连接，其投毒风险极低（约 10%）。风险点仅在于攻击者可能通过修改 payload 实现更具破坏性的行为，但作为防御性分析的样本，该代码本身是安全的。建议在隔离的沙箱环境中进行验证，重点关注 Xalan Java 扩展类的调用行为，以建立相应的 EDR 或 WAF 检测规则。

**项目地址:** [https://github.com/vulnwatchdog/PoC-for-ME-SAML-Vulnerability](https://www.google.com/search?q=https://github.com/vulnwatchdog/PoC-for-ME-SAML-Vulnerability)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-47966](https://nvd.nist.gov/vuln/detail/cve-2022-47966)
