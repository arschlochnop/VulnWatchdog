## CVE-2022-29464 - WSO2 API Manager, Identity Server, Analytics, Enterprise Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, Identity Server, Analytics, Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Identity Server as Key Manager 5.3.0 - 5.11.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需身份验证，可通过网络直接访问受影响的 /fileupload 端点

**POC 可用性:** 8/10

**POC 类型:** 概念验证(NSE探测脚本)

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC是一个基于Nmap脚本引擎(NSE)编写的探测工具，旨在识别受CVE-2022-29464漏洞影响的WSO2服务器。该漏洞源于WSO2多个产品中存在的一处未经身份验证且无限制的任意文件上传缺陷。通过分析代码，该NSE脚本通过向目标主机的 /fileupload/toolsAny 端点发送特定的HTTP POST请求来模拟攻击行为。POC逻辑清晰，使用了Nmap标准的 http 和 vulns 库，具备高度的自动化探测能力。脚本允许用户自定义上传路径(path)和文件名(filename)，默认为 shell.jsp。此POC并不包含复杂的恶意负载，而是侧重于通过尝试上传或探测特定路径的存在性来验证漏洞，对于安全研究员进行资产测绘和漏洞修复确认具有极高的实用价值。利用该漏洞，攻击者可以上传一个包含恶意JSP代码（如WebShell）的文件到服务器的可访问目录（如 /authenticationendpoint/），由于服务器未对上传文件进行严格校验且上传目录具有执行权限，攻击者可以直接通过浏览器或工具访问该JSP文件，从而在目标服务器上执行任意系统命令，获取系统权限。【利用步骤】1. 确定目标主机的WSO2服务端口（通常为9443或443）。2. 构造一个包含恶意JSP负载的HTTP POST请求，目标端点为 /fileupload/toolsAny 或其他受影响的上传接口。3. 在请求头中设置正确的 Content-Type（通常为 multipart/form-data）。4. 将JSP文件内容嵌入到请求体中，指定上传路径为 webapps 目录下的可访问路径。5. 发送请求后，通过访问 https://<target>/authenticationendpoint/uploaded_file.jsp 触发代码执行。【投毒风险分析】经过对提供的NSE脚本源代码进行静态分析，未发现明显的投毒行为或恶意后门。脚本的代码逻辑完全遵循Nmap NSE的开发规范，使用的模块均为系统标准库（http, stdnse, shortport, vulns）。脚本的主要功能是执行漏洞探测，其核心操作是发送HTTP请求并解析响应，没有发现任何尝试下载远程二进制文件、反弹Shell到攻击者服务器或加密本地文件的混淆代码。作者信息明确为 Grzegorz Piechnik，且代码开源在知名的威胁情报社区中。尽管如此，从防御角度看，用户在使用此类脚本时应始终在受控环境下运行，防止误触发。该脚本的投毒风险极低（5%左右），主要的潜在风险在于用户可能从非官方渠道下载到被篡改的版本。建议在部署到生产环境探测前，仔细检查脚本的 action 函数部分，确保其请求的目标URL和参数不包含指向第三方恶意域名的硬编码字符串。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
