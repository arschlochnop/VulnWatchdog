## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; Identity Server 5.2.0及以上至5.11.0; Identity Server Analytics 5.4.0, 5.4.1, 5.5.0及以上; Enterprise Integrator 6.2.0及以上

**利用条件:** 无需身份验证，可从网络直接访问/fileupload端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞的根源在于WSO2产品的Carbon框架中，FileUploadServlet对上传路径的校验不严，且在配置中被错误地设置为无需身份验证即可访问。分析提供的代码片段可见，'handleSecurity'方法在处理URI时，若匹配到'/fileupload'，'CarbonUILoginUtil.handleLoginPageRequest'会返回允许访问的标志，导致攻击者能够绕过IAM安全检查。POC通过向该端点发送精心构造的HTTP POST请求，利用绝对路径穿越或特定的存储路径，将恶意的JSP Webshell上传至Web服务器的可访问目录中。由于WSO2服务器通常以较高权限运行且JSP引擎会自动解析上传的文件，攻击者只需访问上传后的JSP路径即可获取服务器控制权。该POC代码逻辑清晰，直接针对脆弱的servlet进行操作，具有极高的利用成功率。利用步骤：1. 确认目标系统存在公开的/fileupload端点。2. 构造一个多部分表单数据（multipart/form-data）的POST请求。3. 在请求中指定上传的文件名及路径（通常利用目录穿越指向../webapps/目录下）。4. 上传包含恶意Java代码的JSP文件。5. 通过浏览器或脚本访问上传后的URL，执行系统命令。投毒风险分析：经过对POC项目结构的审计，该项目主要包含README说明文档和核心Exploit逻辑。代码编写风格符合安全研究员的标准，使用的是标准的Java/HTTP客户端库，未发现经过混淆的二进制片段或Base64加密的异常指令。在POC中，上传的Webshell通常为简单的命令执行脚本（如执行id或whoami），这属于正常的漏洞验证行为，而非恶意后门。虽然该POC允许执行任意代码，但其本身并未包含自动下载外部木马、向攻击者服务器发送敏感凭证或通过反向Shell隐蔽建立持久化连接的逻辑。项目主要托管在合规的GitHub仓库中，维护者信用较好，因此投毒风险极低。建议防御者在测试时，将Webshell中的命令替换为无害的echo语句，并确保在隔离的实验环境中运行。整体而言，该代码是用于合法的安全基准测试和防御加固的工具。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
