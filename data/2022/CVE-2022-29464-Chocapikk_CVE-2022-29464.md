## CVE-2022-29464 - WSO2 API Manager, Identity Server, Analytics, Micro Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, Identity Server, Analytics, Micro Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Identity Server Analytics 5.4.0 - 5.6.0; Identity Server as Key Manager 5.3.0 - 5.10.0; API Manager Analytics 2.2.0 - 2.5.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需身份验证 (Pre-auth), 需能够访问受影响组件的 /fileupload 接口

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 45%

## 详情

POC有效性分析：该漏洞源于WSO2产品中文件上传功能的路径遍历缺陷。攻击者可以通过构造特殊的Content-Disposition头信息，利用/fileupload端点将恶意的JSP文件上传到Web应用程序的根目录或其他任意可访问目录中。提供的POC代码展示了完整的利用链：首先，它包含一个标准的WebShell JSP，用于执行任意操作系统命令；其次，它包含一个反弹Shell的JSP，用于建立持久化连接。exploit-v2.py脚本利用Python的requests库，向目标发送POST请求，精确指向受影响的端点。此漏洞的利用门槛极低，因为该接口在默认配置下不要求身份验证，且可以直接通过浏览器或简单的脚本触发，具有极高的现实威胁性。利用步骤：1. 识别目标WSO2服务的版本，确认其处于受影响范围内。2. 使用dork（如Zoomeye或Shodan）搜索潜在的目标IP。3. 准备恶意JSP脚本（如WebShell）。4. 发送HTTP POST请求至目标的/fileupload接口，在Content-Disposition中设置带有路径遍历字符（如 ../../../../repository/deployment/server/webapps/）的文件名。5. 访问上传后的URL路径触发JSP执行。 投毒风险分析：该POC存在中等程度的投毒风险。在分析提供的exploit-v2.py代码时，发现其reverse_jsp部分硬编码了一个外部连接地址 '8.tcp.ngrok.io:12508'。虽然这在安全研究中常用于演示反弹Shell，但对于直接下载并运行该脚本的研究员来说，如果未仔细检查代码并修改该地址，执行后会将受害主机的Shell直接反弹给ngrok代理后的第三方服务器，这构成了典型的‘意图劫持’或‘后门投毒’行为。此外，脚本引入了多个外部依赖，虽然目前看到的逻辑相对清晰，但由于其设计为自动化扫描和攻击工具，极易被二次修改并植入恶意下载器或信息窃取脚本。使用者在使用此类POC时，必须在沙箱环境中运行，并彻底审查所有网络请求的目标地址，防止在防御性研究过程中意外泄露敏感权限或导致本地机器被控。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
