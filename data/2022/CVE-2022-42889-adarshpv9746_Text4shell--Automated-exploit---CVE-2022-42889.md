## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 through 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor 类进行插值处理。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC（Text4Shell）是一个非常完整且具有高度可操作性的安全研究案例。它通过一个基于Spring Boot和Apache Commons Text 1.9构建的漏洞镜像展示了CVE-2022-42889的利用过程。代码结构包含Dockerfile、Maven构建脚本（pom.xml）以及PHP/Shell利用脚本。其核心逻辑在于利用Apache Commons Text的StringSubstitutor类对特定前缀（如script、dns、url）的解析特性。在POC中，攻击者通过构造 '${script:javascript:...}' 形式的Payload，触发Nashorn JavaScript引擎执行Java代码。经过分析，该POC在本地Docker环境中能够完美复现，通过简单的HTTP GET请求即可实现远程系统命令执行，如创建一个文件或反弹Shell。利用步骤：1. 使用Maven编译项目生成JAR包。2. 使用Dockerfile构建包含漏洞环境的镜像并运行，将8080端口映射至本地80端口。3. 构造Payload，例如利用脚本中的 '${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}'。4. 将Payload进行URL编码后，作为参数发送至漏洞接口：http://localhost/text4shell/attack?search=编码后的Payload。5. 验证攻击效果，进入Docker容器查看 /tmp 目录下是否生成对应文件。对于反弹Shell，则需启动NC监听对应端口并运行exploit.php。投毒风险分析：该POC项目主要由标准的Java代码、Dockerfile和辅助Shell脚本组成，代码透明度较高，逻辑清晰，未发现明显的恶意混淆或后门植入。脚本中的 'nc' 命令和 'php' 反弹脚本均属于常规渗透测试范畴，且目标明确指向localhost或Docker内网IP，无隐蔽的远程外发请求。虽然使用了 PHP 的 file_get_contents 发起请求，但这是为了自动化Payload的传递。风险点在于，自动化脚本（install.sh）中包含 'sudo docker kill $(sudo docker ps -q)' 命令，这会停止本地所有运行中的容器，具有破坏性操作，但属于实验室环境清理行为。整体而言，该项目作为一个公开的学习和研究资源，投毒风险较低，但在执行 shell 脚本前仍建议审阅其中的 IP 地址和端口设置，防止误触。建议在隔离的虚拟机或容器环境中运行此POC以确保宿主机安全。

**项目地址:** [https://github.com/karthic-webdev/text4shell-poc](https://www.google.com/search?q=https://github.com/karthic-webdev/text4shell-poc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
