## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 Enterprise Integrator, WSO2 Identity Server as Key Manager RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 Enterprise Integrator, WSO2 Identity Server as Key Manager

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; WSO2 Identity Server 5.2.0及以上至5.11.0; WSO2 Identity Server as Key Manager 5.3.0及以上至5.11.0; WSO2 Enterprise Integrator 6.2.0及以上至6.6.0

**利用条件:** 无需认证，可通过网络直接访问受影响的 /fileupload 端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC脚本（exploit.py）针对CVE-2022-29464漏洞表现出极高的有效性。漏洞根源在于WSO2产品中`/fileupload`端点（尤其是`toolsAny`路径）存在不受限制的任意文件上传漏洞。脚本首先通过`check`函数尝试上传一个空的`404.jsp`文件到`authenticationendpoint`目录下并进行访问验证，如果服务器返回状态正常且文件存在，则确认存在漏洞。随后，`exploit`函数构造了一个带有JSP WebShell的POST请求。利用步骤如下：1. 构造恶意文件名，使用路径遍历字符`../../../../`将文件重定位到Web应用目录下（如`repository/deployment/server/webapps/authenticationendpoint/`）。2. 将包含Java运行时执行（Runtime.getRuntime().exec）逻辑的JSP代码作为文件内容发送。3. 脚本成功上传后会打印WebShell的访问地址。此POC代码逻辑清晰，依赖项为标准的python库（requests, pwn, termcolor），利用过程直接、高效且易于复现。它完整展示了从目录遍历到文件写入再到代码执行的攻击链条。投毒风险分析：经过对POC源代码的审查，该脚本目前的投毒风险处于低水平（约10%）。脚本的主要功能集中在漏洞利用和验证上，未发现明显的代码混淆、二进制Payload注入或针对攻击者本机的恶意操作。脚本中导入的库如`requests`、`pwn`和`termcolor`均为安全社区常用的合法工具库。虽然脚本中包含了WebShell代码，但该代码属于POC的攻击载荷，旨在向目标系统写入后门，而非针对执行脚本的防御性研究员。唯一潜在的微小风险在于脚本使用了`requests.post`向外部URL发送请求，在未受控的环境下运行可能导致攻击行为被监控。代码逻辑完全透明，不包含任何恶意下载器、反弹Shell到第三方服务器或窃取本地凭据的行为。研究人员在使用时应注意脚本运行环境的隔离，并确保URL来源的安全性。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
