## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 1.5.0 至 1.10.0 之前版本

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且通过 StringLookup 接口处理了不可信的用户输入。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞被称为 Text4Shell。其根本原因在于 Apache Commons Text 库中的 StringSubstitutor 类默认使用的查找器（Lookups）包含了能够执行代码或进行网络访问的处理器，如 script、dns 和 url。提供的 POC 代码（exploit.py）具有极高的有效性。它通过构造包含特定插值语法的 Payload，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('...')}`，并将其发送至目标 Web 应用。分析 POC 代码可见，脚本自动化程度很高，支持通过命令行参数指定单个目标（-u）或目标列表（-i），并集成了 OOB（带外数据）测试框架 Interactsh 以验证漏洞。代码逻辑清晰，通过 requests.Session 发送精心构造的 HTTP 请求。由于该漏洞利用只需要发送一个包含恶意字符串的 GET 或 POST 请求，且无需任何身份验证，因此在实际环境中极易被复现。该 POC 完整展示了如何利用 script 引擎触发 JVM 层面的系统命令执行，是评估系统脆弱性的重要参考。利用步骤如下：1. 部署受影响的 Docker 镜像作为靶机；2. 启动 Interactsh 客户端获取监听域名；3. 运行 exploit.py 脚本，将目标 URL 和监听域名作为参数传入；4. 在 Interactsh 终端观察 DNS 或 HTTP 回显请求，确认远程命令（如 ping）已成功执行。 【投毒风险分析】该 POC 项目的投毒风险极低（约 10%）。经过对 exploit.py 的静态代码分析，发现其逻辑主要依赖于 Python 标准库（如 argparse, urllib.parse）和常用的 requests 库。代码中不存在恶意混淆、未授权的敏感数据上传或隐藏的后门逻辑。脚本核心功能是构造合法的安全测试 Payload（ping 命令）用于带外验证，这是安全研究中的标准做法。虽然代码中定义了 bcolors 类用于格式化输出，但这属于常见的 UI 美化。唯一的外部风险点在于用户可能从不可信的 Docker 仓库（如 gokul2/text4shell-poc）拉取靶机镜像，虽然在研究环境中这很常见，但在生产辅助环境下仍需谨慎。该 POC 脚本不包含任何针对执行者主机的破坏性指令，其行为仅限于向指定的目标发送漏洞触发请求。建议研究人员在隔离的 Sandbox 环境中运行此类脚本，并使用抓包工具（如 Burp Suite 或 Wireshark）监控流量，以确保脚本行为符合预期，防止在复杂的渗透测试流程中被引入不必要的供应链风险。

**项目地址:** [https://github.com/securekomodo/text4shell-poc](https://github.com/securekomodo/text4shell-poc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
