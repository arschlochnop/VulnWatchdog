## CVE-2022-29464 - WSO2 API Manager, WSO2 IS, WSO2 Enterprise Integrator, WSO2 Identity Server RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE

**影响应用:** WSO2 API Manager, WSO2 IS, WSO2 Enterprise Integrator, WSO2 Identity Server

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0及更高版本至4.0.0; WSO2 Identity Server 5.2.0及更高版本至5.11.0; WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0, 5.6.0; WSO2 Identity Server as Key Manager 5.3.0及更高版本至5.11.0; WSO2 Enterprise Integrator 6.2.0及更高版本至6.6.0

**利用条件:** 无需认证，可通过网络访问受影响的 /fileupload 端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞由安全研究员Orange Tsai发现，本质上是由于WSO2产品中`/fileupload`端点存在未授权且无限制的任意文件上传漏洞。该POC（由Pushkarup维护）质量极高，提供了完整的利用链。它不仅包含基础的漏洞检测脚本（基于Python），还集成了一个功能强大的JSP Webshell。该Webshell具备图形化界面，支持异步请求，显著提升了操作体验。通过分析POC代码，其利用逻辑清晰：首先通过POST请求将恶意JSP文件上传至服务器的特定目录（如Webapps目录），由于服务器未对上传路径和文件扩展名进行有效校验，攻击者可直接通过浏览器或脚本访问上传的文件，从而在服务器上下文执行任意命令。该POC支持单目标扫描和基于文件的多目标批量扫描，并利用Python的多线程库提高了执行效率。利用步骤：1. 攻击者准备包含恶意指令的JSP文件或使用POC自带的Webshell脚本。2. 使用`requests`库向目标服务器的`/fileupload`路径发送POST请求，其中`Content-Type`头部构造为特定的分段数据，指向受影响的组件。3. 如果上传成功，服务器将返回存储路径，通常位于可解析JSP的目录下。4. 攻击者访问该JSP URL，通过POC提供的UI或直接发送参数执行系统命令。5. 获得服务器控制权。投毒风险分析：经过对提供的POC代码片段及相关信息审查，该项目的主要目的是安全研究和教育。代码结构清晰，依赖项包括`requests`、`colorama`和`urllib3`等标准安全开发库，未发现明显的恶意混淆代码或未经授权的外部回连请求。然而，作为防御性研究员，仍需警惕此类针对高价值RCE漏洞的POC。由于其集成的Webshell功能非常成熟（如内置30个预定义命令），如果开发者在脚本中隐蔽地插入了第三方日志记录或OOB（带外）检测域名，可能会导致测试人员的攻击记录被第三方窃取。此外，GitHub上存在多个针对CVE-2022-29464的克隆仓库，部分仓库可能被恶意分子篡改，在Python利用脚本中注入Base64加密的Payload，以实现对研究员本机的反向控制。建议在隔离的沙箱环境中使用此类POC，并严格检查`requirements.txt`中的依赖包版本，防止供应链攻击。

**项目地址:** [https://github.com/Pushkarup/CVE-2022-29464](https://github.com/Pushkarup/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
