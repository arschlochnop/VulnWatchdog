## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 1.5 - 1.9

**利用条件:** 应用程序使用了默认的变量插值（Interpolation）机制，且处理了未经身份验证的用户提供的不可信输入数据。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞被称为“Text4Shell”，其根源在于Apache Commons Text库中的StringSubstitutor类在执行变量插值时，默认启用了具有危险功能的插值器。分析POC代码及其描述可知，该工具利用了“script”、“dns”和“url”三种前缀。其中“script”前缀最为致命，它允许通过JVM脚本引擎（如Nashorn）执行任意Java代码。POC通过构建类似“${script:javascript:java.lang.Runtime.getRuntime().exec('id')}”的Payload发送至目标应用，如果应用对这些特殊格式的字符串进行了插值处理，则会导致代码执行。本POC集成了nmap扫描和服务探测功能，显著提高了自动化攻击的效率，具备较高的实用价值，能够有效验证目标环境是否存在该高危漏洞。利用步骤：1. 准备环境，安装Python 3.9+及依赖库（python-nmap, requests等）。2. 使用POC提供的扫描功能，探测目标服务器是否运行了受影响的服务。3. 构造包含恶意插值前缀（如script:js）的HTTP请求参数。4. 将Payload发送至目标接口。5. 观察目标服务器是否执行了预定指令（如反弹Shell或DNS解析）。投毒风险分析：该POC项目代码逻辑相对透明，主要依赖标准的requests和nmap库进行网络交互。虽然README中提到了“Linux reverseshell payload obfuscation（Linux反弹shell载荷混淆）”这一待办事项，但在目前的结构中，代码主要用于安全研究和漏洞验证。其投毒风险主要体现在：第一，该项目声明正在开发载荷混淆功能，这通常是恶意软件规避安全检测的手段；第二，POC中包含对外部自动化工具（如nmap, ncat）的调用，如果用户从非官方渠道下载该POC，攻击者可能会在main.py或其依赖项中植入恶意后门代码（如在执行exp过程中静默下载并运行木马）。然而，从现有代码片段看，其主要目的是合法的防御性安全测试。研究人员在使用时应重点检查main.py中是否有未知的base64解密并执行（exec/eval）的操作，以及是否存在向非预期IP发送心跳包的行为。由于该POC集成了扫描和利用的一体化功能，一旦被恶意修改分发，其危害性极大，建议在隔离的沙箱环境内进行审计和运行。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2022-42889-PoC](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2022-42889-PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
