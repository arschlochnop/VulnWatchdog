## CVE-2022-29464 - WSO2 API Manager / Identity Server / Enterprise Integrator RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 API Manager / Identity Server / Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0-4.0.0; Identity Server 5.2.0-5.11.0; Identity Server Analytics 5.4.0-5.6.0; Identity Server as Key Manager 5.3.0-5.10.0; Enterprise Integrator 6.2.0-6.6.0

**利用条件:** 无须认证，可通过网络直接访问/fileupload接口

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC针对CVE-2022-29464漏洞，这是一个存在于多个WSO2产品中的严重漏洞。漏洞根源在于/fileupload端点未进行身份验证且未对上传的文件路径和类型进行严格限制。提供的Python脚本展示了高度的实用性，它通过构造一个包含路径穿越（directory traversal）序列“../../../../”的Multipart表单请求，将恶意的JSP文件直接写入Web服务器的可访问目录（如authenticationendpoint目录）。脚本中清晰地展示了两个Payload阶段：Payload1尝试直接上传，而Payload2则利用路径穿越将exp.jsp部署到特定的webapps目录下。一旦上传成功，攻击者可以通过访问部署后的URL并传递'cmd'参数来执行任意系统命令。此POC逻辑清晰，使用了标准的requests库和urllib3库，对于防御性安全研究人员来说，可以非常直观地验证环境是否存在风险。利用步骤如下：1. 识别目标WSO2服务的版本及开放端口；2. 运行脚本，通过HTTP POST请求向/fileupload接口发送包含JSP Webshell内容的Multipart数据包；3. 脚本利用路径穿越漏洞将Webshell放置在Web应用目录下；4. 攻击者通过浏览器或自动化工具访问该Webshell（如https://target/authenticationendpoint/exp.jsp?cmd=whoami）获取服务器控制权。投毒风险分析：经过对提供的Python源代码进行静态分析，未发现明显的恶意行为或投毒迹象。代码主要使用了Python标准库和第三方requests库，逻辑透明。脚本中虽然配置了本地代理（127.0.0.1:8080），但这通常是开发者为了调试或配合Burp Suite使用而留下的习惯，不属于恶意投毒。Payload内容为典型的JSP Webshell，用于证明RCE漏洞的存在，符合POC的定义。脚本未见任何混淆处理（如base64编码的隐藏指令或exec/eval函数调用），也没有向除目标服务器以外的第三方IP/域名发送敏感数据的外联请求。由于代码结构简单、依赖清晰，研究人员可以轻松审计。总体而言，该POC是一个典型的安全研究工具，投毒风险极低，但在下载和运行任何来自非官方渠道的工具时，仍建议在受控的沙箱环境或虚拟机中进行，并持续关注代码中的外部库调用是否被篡改。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
