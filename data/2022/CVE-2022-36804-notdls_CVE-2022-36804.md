# CVE-2022-36804

> ğŸ“¦ è¯¥CVEæœ‰ **17** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰æœ‰æ•ˆçš„`BITBUCKETSESSIONID` cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¯¥æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ä¸”å­˜åœ¨ç›¸åº”çš„ä¿®å¤ç‰ˆæœ¬ã€‚æœç´¢ç»“æœä¹Ÿç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’ŒPoCã€‚æä¾›çš„PoCä»£ç ï¼ˆ`CVE-2022-36804-ReverseShell`ï¼‰æè¿°ä¸ºä¸€ä¸ªâ€œsomewhat reliable PoC exploitâ€ï¼Œè¡¨æ˜å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ç¨³å®šï¼Œä½†è¿™é€šå¸¸ä¸ç¯å¢ƒç›¸å…³ï¼Œä¸å½±å“æ¼æ´çš„æ•´ä½“æœ‰æ•ˆæ€§ã€‚PoCä¹Ÿè¯´æ˜æ”¯æŒå…¬æœ‰ä»“åº“ï¼Œå¹¶ä¸”å¯¹ç§æœ‰ä»“åº“å¯ä»¥ä½¿ç”¨session cookieï¼Œå¢åŠ äº†å…¶å¯ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©:**
PoCä»£ç ä¸­å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§è¾ƒä½ï¼ˆä¼°è®¡ä¸º10%ï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š
*   ä»£ç æ¥æºï¼šè¯¥ä»“åº“åŸºäº [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) è¿›è¡Œä¿®æ”¹ï¼Œç”±Chocapikkè¿›è¡Œmass exploitå’Œreverse shellåŠŸèƒ½çš„æ·»åŠ ã€‚è¿™æ„å‘³ç€å­˜åœ¨å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚
*   æ‰¹é‡åˆ©ç”¨ï¼šPoC åŒ…å«æ‰¹é‡æ‰«æå’Œåˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ä»£ç ä»¥å¤§è§„æ¨¡ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚
*   å‘½ä»¤æ‰§è¡Œï¼š PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è™½ç„¶è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿä¸ºæ¤å…¥åé—¨æˆ–æ¶æ„ä»£ç æä¾›äº†é€”å¾„ã€‚
éœ€è¦ä»”ç»†å®¡æŸ¥ `main.py` æ–‡ä»¶ï¼Œç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
    *   æ˜¯å¦æœ‰é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°è¯•ä¸‹è½½æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬ã€‚
    *   reverse shellæ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ˜¯å¦è¿æ¥æœªçŸ¥çš„åœ°å€å’Œç«¯å£ã€‚
    *   å‚æ•°è§£æéƒ¨åˆ†ï¼Œæ˜¯å¦æœ‰éšè—çš„å‚æ•°å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚
    *   æ‰¹é‡æ‰«æå’Œåˆ©ç”¨åŠŸèƒ½ï¼Œæ˜¯å¦å­˜åœ¨å°†ç»“æœå‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„é€»è¾‘ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **è‡ªåŠ¨/æ‰‹åŠ¨ æŸ¥æ‰¾ Repository:** PoC æä¾›äº†è‡ªåŠ¨æŸ¥æ‰¾å¯åˆ©ç”¨ Repository çš„åŠŸèƒ½ã€‚å¦‚æœè‡ªåŠ¨æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Repositoryã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  åˆ©ç”¨è„šæœ¬æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œç›®æ ‡ Bitbucket æœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›å‚æ•°æ—¶ï¼Œä¼šç”±äºå‚æ•°æ³¨å…¥æ¼æ´æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
3.  **æ‰§è¡Œå‘½ä»¤:** æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **åå¼¹shell:** å¯ä»¥ä½¿ç”¨ `--lhost` å’Œ `--lport` å‚æ•°å»ºç«‹åå‘ shellï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚
5. **ä¼šè¯ç»´æŒ:** å¯¹äºç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--session` å‚æ•°ï¼Œæä¾›æœ‰æ•ˆçš„ `BITBUCKETSESSIONID` cookieã€‚


**é¡¹ç›®åœ°å€:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**æ¥æº**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆç‰¹åˆ«æ˜¯Rapid7çš„åˆ†æå’ŒAssetNoteçš„ç ”ç©¶ï¼‰ä»¥åŠæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚PoC ä»£ç æä¾›äº†ä¸€ç§ç›¸å¯¹å¯é çš„åˆ©ç”¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¯ç”¨äº†å…¬å…±ä»“åº“çš„å®ä¾‹ã€‚å³ä½¿ç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookie è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ³¨å…¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«è‡ªåŠ¨æ£€æµ‹ä»“åº“çš„åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç›®æ ‡ã€æ‰§è¡Œå‘½ä»¤ã€åå¼¹shellç­‰é€‰é¡¹ã€‚æ½œåœ¨çš„æŠ•æ¯’é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **æ¶æ„å‘½ä»¤é»˜è®¤å€¼ï¼š**  è™½ç„¶`--command`å‚æ•°é»˜è®¤ä¸º`whoami`ï¼Œä½†æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹é»˜è®¤å€¼ï¼Œä½¿å…¶æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚
2.  **åå¼¹ Shell åŠŸèƒ½ï¼š**  `--lhost` å’Œ `--lport` å‚æ•°ç”¨äºè®¾ç½®åå¼¹ shellï¼Œå¦‚æœæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·è¿è¡Œæ­¤ PoC å¹¶è¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½å¯¼è‡´å—å®³è€…ç³»ç»Ÿè¢«å®Œå…¨æ§åˆ¶ã€‚
3.  **æ‰¹é‡æ‰«æçš„æ½œåœ¨é£é™©ï¼š**  `--file` å‚æ•°å…è®¸æ‰¹é‡æ‰«æç›®æ ‡ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨æ­¤åŠŸèƒ½è¿›è¡Œå¤§è§„æ¨¡æ”»å‡»ï¼Œæˆ–è€…åœ¨æ‰«æè¿‡ç¨‹ä¸­æ¤å…¥æ¶æ„ä»£ç ã€‚
4. **ä»£ç é€»è¾‘ç¼ºé™·**: ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ½œåœ¨çš„é€»è¾‘ç¼ºé™·æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œæ„å¤–çš„æ“ä½œã€‚

ç»¼åˆæ¥çœ‹ï¼Œè™½ç„¶PoCä»£ç ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å­˜åœ¨è¢«æ»¥ç”¨æˆ–ä¿®æ”¹ä»¥è¿›è¡Œæ¶æ„æ”»å‡»çš„é£é™©ã€‚åˆæ­¥åˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ Bitbucket Server/Data Center ç‰ˆæœ¬ï¼š** ç¡®è®¤ç›®æ ‡ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ< 8.3.1ï¼‰ã€‚
2.  **è·å–ä»“åº“ä¿¡æ¯ï¼š** å¦‚æœå¯ç”¨äº†å…¬å…±ä»“åº“ï¼ŒPoCä»£ç å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¯åˆ©ç”¨çš„ä»“åº“ã€‚å¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œåˆ™éœ€è¦æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookieã€‚
3.  **æ„é€ æ¶æ„ HTTP è¯·æ±‚ï¼š**  PoCä»£ç ä¼šè‡ªåŠ¨æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œå‘é€åˆ°æ˜“å—æ”»å‡»çš„ API ç«¯ç‚¹ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š**  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€åå¼¹ shell ç­‰ã€‚
5. **åˆ©ç”¨å‚æ•°ä¼ é€’å‘½ä»¤**: é€šè¿‡ `--command` å‚æ•°æˆ– `--file` å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ¶æ„å‘½ä»¤,è¿›è¡Œæ¼æ´æ”»å‡».

**æ€»ç»“ï¼š**

CVE-2022-36804 æ˜¯ä¸€ä¸ªé«˜å±çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼ˆéœ€è¦è¯»å–æƒé™ï¼‰ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„PoCä»£ç ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨ Bitbucket Server/Data Center æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚éœ€è¦åŠæ—¶å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**æ¥æº**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ `git archive` å‘½ä»¤çš„ `--exec` å‚æ•°æ³¨å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…éœ€è¦åœ¨URLä¸­æ’å…¥ç»è¿‡ç¼–ç çš„æ¶æ„å‚æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `id` å‘½ä»¤æ¥éªŒè¯æ¼æ´ï¼Œæˆ–è€…ä½¿ç”¨ `cat /etc/passwd` å‘½ä»¤æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚é£é™©åœ¨äºPOCä¸­å¯èƒ½å­˜åœ¨éšè”½çš„ä¸‹è½½è„šæœ¬,æˆ–è€…åŒ…å«å…¶ä»–æ¶æ„è¿æ¥. å› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**æ¥æº**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œå…·æœ‰å…¬å¼€ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰ä»“åº“è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œå¤šä¸ªå®‰å…¨å›¢é˜Ÿå·²ç»å‘ç°äº†æ­¤æ¼æ´å¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ–¹å¼ã€‚æ¼æ´å­˜åœ¨äºå¤šä¸ªAPIç«¯ç‚¹ä¸­ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„gitå‘½ä»¤ï¼Œåˆ©ç”¨`--exec`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å«äº†ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æä¾›çš„POCä»£ç çš„æœ‰æ•ˆæ€§ã€‚

ç”±äºæä¾›çš„ä»£ç åªæ˜¯è®¸å¯è¯æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥åˆ¤å®šæ­¤ä»“åº“ä¸­ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£é™©ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©ä¸º0%ã€‚

æ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™ï¼ˆå…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„gitå‘½ä»¤çš„HTTPè¯·æ±‚å‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œç”±äºæ²¡æœ‰å……åˆ†è¿‡æ»¤å’Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**æ¥æº**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 ç›´åˆ° 7.6.17, 7.7.0 ç›´åˆ° 7.17.10, 7.18.0 ç›´åˆ° 7.21.4, 8.0.0 ç›´åˆ° 8.0.3, 8.1.0 ç›´åˆ° 8.1.3, 8.2.0 ç›´åˆ° 8.2.2, 8.3.0 ç›´åˆ° 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰Bitbucketä»“åº“è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š`CVE-2022-36804-mass.py` å’Œ `README.md`ã€‚

*   `CVE-2022-36804-mass.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å°ä¸€ä¸ªåŒ…å«ä»˜æ¬¾é“¾æ¥çš„å­—ç¬¦ä¸²ï¼Œè¿™è¡¨æ˜å®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªè¯±é¥µæˆ–è¯ˆéª—ã€‚
*   `README.md` æ–‡ä»¶æè¿°äº†æ¼æ´ï¼Œå£°ç§°æä¾›äº†ä¸€ä¸ªPythonç¼–å†™çš„å¤šåŠŸèƒ½PoCï¼Œä½†å®é™…çš„PoCéœ€è¦é€šè¿‡æä¾›çš„ä»˜æ¬¾é“¾æ¥è·å–ï¼Œå¹¶ä¸”æåŠå­˜åœ¨åŒ…å«å¤§é‡æ˜“å—æ”»å‡»æœåŠ¡å™¨çš„åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½œè€…æ„å›¾é€šè¿‡å‡ºå”®æˆ–ä»¥å…¶ä»–æ–¹å¼åˆ†å‘æ‰€è°“çš„PoCè·åˆ©ï¼Œè¿›ä¸€æ­¥æé«˜äº†æŠ•æ¯’é£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥ä»“åº“ä¸­çš„PoCå¾ˆå¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œæˆ–è€…è¯´æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„è¯±é¥µã€‚è¦æ±‚ä»˜æ¬¾çš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ï¼Œè¡¨æ˜ä½œè€…å¯èƒ½è¯•å›¾ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ ¹æ®rapid7.com(webpage 1)å’Œassetnote.io(webpage 3)ä¸Šçš„æè¿°ï¼Œè¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `--exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…éœ€è¦å¯¹ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚æ¥è§¦å‘è¯¥æ¼æ´ã€‚

**æœ‰æ•ˆæ€§ï¼š** ä»æä¾›çš„æ–‡ä»¶æ¥çœ‹ï¼Œæä¾›çš„PoCä»£ç å¯èƒ½æ— æ•ˆæˆ–è€…åŒ…å«æ¶æ„å†…å®¹, éœ€è¦è¿›ä¸€æ­¥éªŒè¯æ‰èƒ½ç¡®è®¤å…¶çœŸå®åŠŸèƒ½ã€‚æ ¹æ®å…¶ä»–æœç´¢ç»“æœï¼Œæ¼æ´æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¶ä»–çš„å¯åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š** æé«˜ã€‚`CVE-2022-36804-mass.py`åªæ˜¯ä¸€ä¸ªè¯±é¥µï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®ä»˜æ¬¾é“¾æ¥ã€‚çœŸæ­£çš„æ”»å‡»ä»£ç å¯èƒ½éšè—åœ¨ä»˜æ¬¾åçš„ä¸‹è½½é“¾æ¥ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚`README.md` çš„å£°æ˜ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“å­˜åœ¨æé«˜çš„æŠ•æ¯’é£é™©(95%)ã€‚

**é¡¹ç›®åœ°å€:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**æ¥æº**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°ã€æœç´¢ç»“æœä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä¸¤ä¸ªpayloadï¼Œç”¨äºè§¦å‘å‘½ä»¤æ³¨å…¥ã€‚
*   `payload` æ–‡ä»¶é€šè¿‡æ„é€ åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚  
*   `payload2` æ–‡ä»¶åŒæ ·æ„é€ äº†åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `id` å‘½ä»¤ã€‚ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

ä»“åº“ä¸­çš„`README.md`åªæ˜¯åŒ…å«PoCçš„æ¼”ç¤ºå›¾ç‰‡ä»¥åŠä½œè€…çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚

ç»¼åˆè¯„ä¼°ï¼Œç”±äºPOCæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œå¹¶éä¸ºäº†ä¼ æ’­æ¶æ„ä»£ç ï¼Œä»“åº“ä¸­ä¸»è¦çš„æ–‡ä»¶æ˜¯ç”¨äºæ¼”ç¤ºå’Œè¯´æ˜æ¼æ´çš„ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚æ­¤å¤„çš„é£é™©ä¸»è¦æ¥æºäºPOCå¯èƒ½è¢«ä»–äººä¿®æ”¹åä¼ æ’­ï¼Œä»è€Œæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­åˆ©ç”¨äº†gitå‘½ä»¤çš„ `--exec` å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­æ’å…¥åŒ…å« `--exec` å’Œæ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

1.  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ç‰¹å®šçš„APIç«¯ç‚¹ï¼Œä¾‹å¦‚ `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`ã€‚
2.  åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­ï¼Œæ’å…¥ç±»ä¼¼ `%00--exec=<command>%00--remote=origin` çš„å­—ç¬¦ä¸²ã€‚
3.  å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡BitbucketæœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„å‘½ä»¤ã€‚

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**æ¥æº**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±æˆ–ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢å¼•æ“ç»“æœï¼ˆå°¤å…¶æ˜¯ `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`ï¼‰ï¼Œæ­¤æ¼æ´åˆ©ç”¨ PoC ä»£ç æœ‰æ•ˆã€‚æä¾›çš„ PoC ä»£ç åŒ…å«æ„å»ºæ˜“å—æ”»å‡»ç¯å¢ƒçš„ Dockerfile å’Œåˆ©ç”¨æ¼æ´çš„ Python è„šæœ¬ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ï¼Œç”¨äºéªŒè¯ RCE å¹¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œç”šè‡³å»ºç«‹åå‘ shellã€‚

**æŠ•æ¯’é£é™©:** åˆ†æ PoC ä»£ç ï¼Œç‰¹åˆ«æ˜¯ `cve-2022-36804.py` è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€æ¶æ„è¯·æ±‚ä»¥è§¦å‘å‘½ä»¤æ³¨å…¥ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚æ½œåœ¨çš„é£é™©å¯èƒ½å­˜åœ¨äºè„šæœ¬ä¸­ä½¿ç”¨çš„ User-Agent å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚å¤´éƒ¨çš„å…¶ä»–å­—æ®µä¸­ï¼Œä½œè€…å¯èƒ½æš—ä¸­æœé›†ä½¿ç”¨è€…ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDockerfile ä¸‹è½½çš„ Bitbucket ç‰ˆæœ¬å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶,ä½†è¿™ä¸åœ¨æœ¬æ¬¡è¯„ä¼°èŒƒå›´å†…ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹ç›®æ ‡ Bitbucket ä»“åº“çš„è¯»å–æƒé™ï¼ˆå…¬å…±æˆ–ç§æœ‰ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œè¯¥å‘½ä»¤ä¼šè¢«æ³¨å…¥åˆ° git å‘½ä»¤çš„ `--exec` å‚æ•°ä¸­ã€‚
3.  æœåŠ¡å™¨åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  PoC ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ `id`ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹åå‘ shellã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶ Bitbucket æœåŠ¡å™¨ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ï¼Œç¯¡æ”¹ä»£ç ï¼Œæˆ–è€…å°†æœåŠ¡å™¨ä½œä¸ºè·³æ¿æ”»å‡»å…¶ä»–å†…éƒ¨ç³»ç»Ÿã€‚

**é¡¹ç›®åœ°å€:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**æ¥æº**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–æ‹¥æœ‰æœ‰æ•ˆçš„session cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ï¼Œå¹¶ä¸”å­˜åœ¨å¯ç”¨çš„PoCä»£ç ã€‚Rapid7 å’Œ AssetNote çš„åˆ†æéƒ½è¡¨æ˜è¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ã€‚

æä¾›çš„PoCä»£ç ï¼ˆBenHays142/CVE-2022-36804-PoC-Exploitï¼‰çš„README.mdæ˜¾ç¤ºï¼Œè¯¥æ¼æ´éœ€è¦å¼€å¯å…¬å…±ä»“åº“ï¼Œæˆ–ä½¿ç”¨æœ‰æ•ˆçš„BITBUCKETSESSIONID cookieï¼ˆå¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼‰ã€‚åˆ©ç”¨æ–¹å¼æ˜¯å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°å—å½±å“çš„APIç«¯ç‚¹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸­æ£€æµ‹åˆ°è‡ªåŠ¨æŸ¥æ‰¾repoçš„åŠŸèƒ½ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚è™½ç„¶è¿™äº›åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚åœ¨è‡ªåŠ¨æŸ¥æ‰¾repoæ—¶ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹äº†repoçš„å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿›ä¸€æ­¥åˆ†æ `main.py`ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥è„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„repoï¼ˆ`detect_repo` å‡½æ•°ï¼‰ã€‚
2.  æ‰§è¡Œå‘½ä»¤ï¼ˆ`exec_stuff` å‡½æ•°ï¼‰ã€‚
3.  æ£€æŸ¥ç›®æ ‡æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆ`check_vuln` å‡½æ•°ï¼‰ã€‚

è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯ä½¿ç”¨æ­¤PoCä»ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹PoCä»£ç ä»¥åŒ…å«æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„ `--exec` å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡åœ¨URLä¸­åµŒå…¥ç‰¹æ®Šçš„payloadï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

`main.py` è„šæœ¬åˆ©ç”¨ `archive` APIï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šæ„é€ çš„ `prefix` å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

å…¶ä¸­ï¼Œ`{cmd}` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`%00` æ˜¯ NULL å­—èŠ‚ï¼Œç”¨äºæˆªæ–­å­—ç¬¦ä¸²ï¼Œä»è€Œä½¿ `--exec` å‚æ•°ç”Ÿæ•ˆã€‚æœåŠ¡å™¨åœ¨å¤„ç†æ­¤è¯·æ±‚æ—¶ï¼Œç”±äºæœªæ­£ç¡®è¿‡æ»¤æˆ–è½¬ä¹‰å‚æ•°ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚

**æ¼æ´å½±å“ï¼š**

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨BitbucketæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å—æŸï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡ä¸­æ–­ç­‰ä¸¥é‡åæœã€‚

**é¡¹ç›®åœ°å€:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**æ¥æº**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ‹¥æœ‰å¯¹å…¬å…±æˆ–ç§æœ‰ Bitbucket ä»“åº“çš„è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚ Rapid7, AssetNote, Sangfor ç­‰ï¼‰éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œå¯åˆ©ç”¨æ€§ã€‚POCä»£ç ä¸­æä¾›çš„ `payload.txt` æ–‡ä»¶åŒ…å«åˆ©ç”¨å‚æ•° `--remote` å’Œ `--exec` è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„payloadã€‚`id` å‘½ä»¤å¯ä»¥ä½œä¸ºæµ‹è¯•æœ‰æ•ˆè½½è·ï¼Œç”¨äºéªŒè¯å‘½ä»¤æ‰§è¡Œã€‚Assetnoteçš„æ–‡ç« ä¹Ÿæåˆ°äº†é€šè¿‡ `--exec` å‚æ•°åˆ©ç”¨ git å‘½ä»¤è¿›è¡Œæ”»å‡»

**æŠ•æ¯’é£é™©ï¼š**
`README.md` æ–‡ä»¶çœ‹èµ·æ¥æ˜¯æ ‡å‡†çš„æ¼æ´æè¿°ã€‚`payload.txt` æ–‡ä»¶åŒ…å«æ˜æ˜¾çš„åˆ©ç”¨payloadã€‚ç†è®ºä¸Šï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹å…¶ä»–æ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œä»…åŸºäºç›®å‰æä¾›çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®è®¤å­˜åœ¨æ¶æ„ä»£ç ã€‚è¯¥ä»“åº“åªæä¾›äº†PoCçš„payloadï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»æ¨¡å—ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨10%å·¦å³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦é›†ä¸­äºæ„é€ æ¶æ„çš„ `archive` è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç‰¹æ®Šçš„å‚æ•°ï¼Œåˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„å‚æ•°æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `--remote` å’Œ `--exec` å‚æ•°æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚å—å½±å“çš„ API ç«¯ç‚¹æ¥å—è¿™äº›å‚æ•°ï¼Œå¹¶æ²¡æœ‰æ­£ç¡®åœ°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

æ”»å‡»è€…éœ€è¦åšçš„ï¼š
1.  ç¡®å®šç›®æ ‡ Bitbucket Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚ `archive?format=zip&path=bighax&prefix=vulnmachines/%00â€“remote=/%00â€“exec=%60id%60%00â€“prefix=/`ã€‚
3.  å‘é€è¯¥è¯·æ±‚åˆ°å—å½±å“çš„ API ç«¯ç‚¹ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**æ¥æº**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨å…·æœ‰è¯»å–æƒé™çš„è´¦å·ï¼Œå‘å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œé€šè¿‡`git archive`å‘½ä»¤çš„`--exec`å‚æ•°æ³¨å…¥æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼åŒ…æ‹¬å‘é€ç‰¹åˆ¶çš„URLï¼Œå…¶ä¸­åŒ…å«ç»è¿‡URLç¼–ç çš„å‘½ä»¤ã€‚ä¾‹å¦‚`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`ï¼Œæ­¤POCä»£ç çš„ç›®çš„æ˜¯éªŒè¯æ¼æ´å­˜åœ¨ä»¥åŠæ‰§è¡Œå‘½ä»¤ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**æ¥æº**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucketå‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–è€…ç§æœ‰ä»“åº“æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±å­˜å‚¨åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼šåˆ©ç”¨git archiveå‘½ä»¤çš„`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚POCä»£ç ä¸­ï¼Œ`mexploit.py`è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„URLï¼Œå°†æ¶æ„å‘½ä»¤æ³¨å…¥åˆ°`--exec`å‚æ•°ä¸­ï¼Œä»è€Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`README.md`æ–‡ä»¶ä»…åŒ…å«æ¼æ´æè¿°å’Œè„šæœ¬ä½¿ç”¨è¯´æ˜ï¼Œæœªå‘ç°æ¶æ„ä»£ç ã€‚åˆæ­¥åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä»éœ€è°¨æ…è¯„ä¼°è„šæœ¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠè„šæœ¬æ˜¯å¦å­˜åœ¨å…¶ä»–éšè—çš„æ¶æ„è¡Œä¸ºã€‚`walnutsecurity/cve-2022-36804`ç­‰ä»“åº“ä¹Ÿæä¾›äº†æ­¤æ¼æ´çš„POCï¼Œå¯ä½œä¸ºå‚è€ƒå¯¹æ¯”ã€‚

**é¡¹ç›®åœ°å€:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**æ¥æº**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2022-36804 å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨å­˜åœ¨æ¼æ´çš„ Bitbucket Server å’Œ Data Center å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ª API ç«¯ç‚¹ä¸­å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´å¯¼è‡´çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨è¯¥æ¼æ´ã€‚å®ƒé¦–å…ˆä½¿ç”¨ `httpx` æŸ¥æ‰¾å…¬å¼€çš„ Bitbucket ä»“åº“ï¼Œç„¶åæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLï¼Œè¯¥å‚æ•°ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`id` å‘½ä»¤è¢«ç”¨ä½œ PoCï¼Œç”¨äºéªŒè¯æ˜¯å¦æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º 10%ã€‚ ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å‘ç°Bitbucketä»“åº“å¹¶æ„é€ åˆ©ç”¨URLã€‚æŠ•æ¯’çš„é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹æ–¹é¢ï¼š

1.  **ä¾èµ–åº“é£é™©:** è„šæœ¬ä¾èµ–äºå¤–éƒ¨åº“ï¼Œå¦‚ `requests` å’Œå‘½ä»¤è¡Œå·¥å…·å¦‚`httpx`, è¿™äº›ä¾èµ–é¡¹å¯èƒ½å­˜åœ¨æ½œåœ¨çš„ä¾›åº”é“¾å®‰å…¨é£é™©ï¼Œè™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†éœ€è¦è€ƒè™‘ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:** è„šæœ¬ä½¿ç”¨äº† `os.system` æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶ç”¨äºè°ƒç”¨ `httpx`ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ targets æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å‘½ä»¤æ³¨å…¥é£é™©ã€‚è¿™éƒ¨åˆ†çš„é£é™©è¾ƒä½ï¼Œå–å†³äº `targets` æ–‡ä»¶çš„å¯æ§ç¨‹åº¦ã€‚
3.  **URL æ„é€ é£é™©:** è„šæœ¬æ„é€  URL çš„é€»è¾‘å­˜åœ¨ä¸€å®šçš„å¤æ‚æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å¯¹ URL çš„å¤„ç†æ–¹å¼ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‘½ä»¤æ‰§è¡Œæˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æŸ¥æ‰¾å…¬å¼€ä»“åº“ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°å…¬å¼€å¯è®¿é—®çš„ Bitbucket ä»“åº“æˆ–å…·æœ‰è¯»å–æƒé™çš„ç§æœ‰ä»“åº“ã€‚
2.  **æ„é€ æ¶æ„ URLï¼š** æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLã€‚è¯¥ URL çš„æ ¼å¼å¦‚ä¸‹ï¼š
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    å…¶ä¸­ï¼Œ`<command>` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  **å‘é€ HTTP è¯·æ±‚ï¼š** æ”»å‡»è€…å‘ Bitbucket æœåŠ¡å™¨å‘é€åŒ…å«æ¶æ„ URL çš„ HTTP è¯·æ±‚ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œåˆ™ä¼šæ‰§è¡Œ URL ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**æ¥æº**: [CVE-2022-36804-notdls_CVE-2022-36804.md](../2022/CVE-2022-36804-notdls_CVE-2022-36804.md)

# CVE-2022-36804

> ğŸ“¦ è¯¥CVEæœ‰ **17** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰æœ‰æ•ˆçš„`BITBUCKETSESSIONID` cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¯¥æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ä¸”å­˜åœ¨ç›¸åº”çš„ä¿®å¤ç‰ˆæœ¬ã€‚æœç´¢ç»“æœä¹Ÿç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’ŒPoCã€‚æä¾›çš„PoCä»£ç ï¼ˆ`CVE-2022-36804-ReverseShell`ï¼‰æè¿°ä¸ºä¸€ä¸ªâ€œsomewhat reliable PoC exploitâ€ï¼Œè¡¨æ˜å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ç¨³å®šï¼Œä½†è¿™é€šå¸¸ä¸ç¯å¢ƒç›¸å…³ï¼Œä¸å½±å“æ¼æ´çš„æ•´ä½“æœ‰æ•ˆæ€§ã€‚PoCä¹Ÿè¯´æ˜æ”¯æŒå…¬æœ‰ä»“åº“ï¼Œå¹¶ä¸”å¯¹ç§æœ‰ä»“åº“å¯ä»¥ä½¿ç”¨session cookieï¼Œå¢åŠ äº†å…¶å¯ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©:**
PoCä»£ç ä¸­å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§è¾ƒä½ï¼ˆä¼°è®¡ä¸º10%ï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š
*   ä»£ç æ¥æºï¼šè¯¥ä»“åº“åŸºäº [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) è¿›è¡Œä¿®æ”¹ï¼Œç”±Chocapikkè¿›è¡Œmass exploitå’Œreverse shellåŠŸèƒ½çš„æ·»åŠ ã€‚è¿™æ„å‘³ç€å­˜åœ¨å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚
*   æ‰¹é‡åˆ©ç”¨ï¼šPoC åŒ…å«æ‰¹é‡æ‰«æå’Œåˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ä»£ç ä»¥å¤§è§„æ¨¡ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚
*   å‘½ä»¤æ‰§è¡Œï¼š PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è™½ç„¶è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿä¸ºæ¤å…¥åé—¨æˆ–æ¶æ„ä»£ç æä¾›äº†é€”å¾„ã€‚
éœ€è¦ä»”ç»†å®¡æŸ¥ `main.py` æ–‡ä»¶ï¼Œç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
    *   æ˜¯å¦æœ‰é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°è¯•ä¸‹è½½æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬ã€‚
    *   reverse shellæ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ˜¯å¦è¿æ¥æœªçŸ¥çš„åœ°å€å’Œç«¯å£ã€‚
    *   å‚æ•°è§£æéƒ¨åˆ†ï¼Œæ˜¯å¦æœ‰éšè—çš„å‚æ•°å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚
    *   æ‰¹é‡æ‰«æå’Œåˆ©ç”¨åŠŸèƒ½ï¼Œæ˜¯å¦å­˜åœ¨å°†ç»“æœå‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„é€»è¾‘ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **è‡ªåŠ¨/æ‰‹åŠ¨ æŸ¥æ‰¾ Repository:** PoC æä¾›äº†è‡ªåŠ¨æŸ¥æ‰¾å¯åˆ©ç”¨ Repository çš„åŠŸèƒ½ã€‚å¦‚æœè‡ªåŠ¨æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Repositoryã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  åˆ©ç”¨è„šæœ¬æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œç›®æ ‡ Bitbucket æœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›å‚æ•°æ—¶ï¼Œä¼šç”±äºå‚æ•°æ³¨å…¥æ¼æ´æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
3.  **æ‰§è¡Œå‘½ä»¤:** æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **åå¼¹shell:** å¯ä»¥ä½¿ç”¨ `--lhost` å’Œ `--lport` å‚æ•°å»ºç«‹åå‘ shellï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚
5. **ä¼šè¯ç»´æŒ:** å¯¹äºç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--session` å‚æ•°ï¼Œæä¾›æœ‰æ•ˆçš„ `BITBUCKETSESSIONID` cookieã€‚


**é¡¹ç›®åœ°å€:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**æ¥æº**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆç‰¹åˆ«æ˜¯Rapid7çš„åˆ†æå’ŒAssetNoteçš„ç ”ç©¶ï¼‰ä»¥åŠæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚PoC ä»£ç æä¾›äº†ä¸€ç§ç›¸å¯¹å¯é çš„åˆ©ç”¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¯ç”¨äº†å…¬å…±ä»“åº“çš„å®ä¾‹ã€‚å³ä½¿ç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookie è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ³¨å…¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«è‡ªåŠ¨æ£€æµ‹ä»“åº“çš„åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç›®æ ‡ã€æ‰§è¡Œå‘½ä»¤ã€åå¼¹shellç­‰é€‰é¡¹ã€‚æ½œåœ¨çš„æŠ•æ¯’é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **æ¶æ„å‘½ä»¤é»˜è®¤å€¼ï¼š**  è™½ç„¶`--command`å‚æ•°é»˜è®¤ä¸º`whoami`ï¼Œä½†æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹é»˜è®¤å€¼ï¼Œä½¿å…¶æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚
2.  **åå¼¹ Shell åŠŸèƒ½ï¼š**  `--lhost` å’Œ `--lport` å‚æ•°ç”¨äºè®¾ç½®åå¼¹ shellï¼Œå¦‚æœæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·è¿è¡Œæ­¤ PoC å¹¶è¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½å¯¼è‡´å—å®³è€…ç³»ç»Ÿè¢«å®Œå…¨æ§åˆ¶ã€‚
3.  **æ‰¹é‡æ‰«æçš„æ½œåœ¨é£é™©ï¼š**  `--file` å‚æ•°å…è®¸æ‰¹é‡æ‰«æç›®æ ‡ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨æ­¤åŠŸèƒ½è¿›è¡Œå¤§è§„æ¨¡æ”»å‡»ï¼Œæˆ–è€…åœ¨æ‰«æè¿‡ç¨‹ä¸­æ¤å…¥æ¶æ„ä»£ç ã€‚
4. **ä»£ç é€»è¾‘ç¼ºé™·**: ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ½œåœ¨çš„é€»è¾‘ç¼ºé™·æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œæ„å¤–çš„æ“ä½œã€‚

ç»¼åˆæ¥çœ‹ï¼Œè™½ç„¶PoCä»£ç ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å­˜åœ¨è¢«æ»¥ç”¨æˆ–ä¿®æ”¹ä»¥è¿›è¡Œæ¶æ„æ”»å‡»çš„é£é™©ã€‚åˆæ­¥åˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ Bitbucket Server/Data Center ç‰ˆæœ¬ï¼š** ç¡®è®¤ç›®æ ‡ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ< 8.3.1ï¼‰ã€‚
2.  **è·å–ä»“åº“ä¿¡æ¯ï¼š** å¦‚æœå¯ç”¨äº†å…¬å…±ä»“åº“ï¼ŒPoCä»£ç å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¯åˆ©ç”¨çš„ä»“åº“ã€‚å¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œåˆ™éœ€è¦æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookieã€‚
3.  **æ„é€ æ¶æ„ HTTP è¯·æ±‚ï¼š**  PoCä»£ç ä¼šè‡ªåŠ¨æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œå‘é€åˆ°æ˜“å—æ”»å‡»çš„ API ç«¯ç‚¹ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š**  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€åå¼¹ shell ç­‰ã€‚
5. **åˆ©ç”¨å‚æ•°ä¼ é€’å‘½ä»¤**: é€šè¿‡ `--command` å‚æ•°æˆ– `--file` å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ¶æ„å‘½ä»¤,è¿›è¡Œæ¼æ´æ”»å‡».

**æ€»ç»“ï¼š**

CVE-2022-36804 æ˜¯ä¸€ä¸ªé«˜å±çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼ˆéœ€è¦è¯»å–æƒé™ï¼‰ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„PoCä»£ç ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨ Bitbucket Server/Data Center æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚éœ€è¦åŠæ—¶å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**æ¥æº**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ `git archive` å‘½ä»¤çš„ `--exec` å‚æ•°æ³¨å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…éœ€è¦åœ¨URLä¸­æ’å…¥ç»è¿‡ç¼–ç çš„æ¶æ„å‚æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `id` å‘½ä»¤æ¥éªŒè¯æ¼æ´ï¼Œæˆ–è€…ä½¿ç”¨ `cat /etc/passwd` å‘½ä»¤æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚é£é™©åœ¨äºPOCä¸­å¯èƒ½å­˜åœ¨éšè”½çš„ä¸‹è½½è„šæœ¬,æˆ–è€…åŒ…å«å…¶ä»–æ¶æ„è¿æ¥. å› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**æ¥æº**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œå…·æœ‰å…¬å¼€ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰ä»“åº“è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œå¤šä¸ªå®‰å…¨å›¢é˜Ÿå·²ç»å‘ç°äº†æ­¤æ¼æ´å¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ–¹å¼ã€‚æ¼æ´å­˜åœ¨äºå¤šä¸ªAPIç«¯ç‚¹ä¸­ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„gitå‘½ä»¤ï¼Œåˆ©ç”¨`--exec`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å«äº†ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æä¾›çš„POCä»£ç çš„æœ‰æ•ˆæ€§ã€‚

ç”±äºæä¾›çš„ä»£ç åªæ˜¯è®¸å¯è¯æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥åˆ¤å®šæ­¤ä»“åº“ä¸­ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£é™©ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©ä¸º0%ã€‚

æ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™ï¼ˆå…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„gitå‘½ä»¤çš„HTTPè¯·æ±‚å‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œç”±äºæ²¡æœ‰å……åˆ†è¿‡æ»¤å’Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**æ¥æº**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 ç›´åˆ° 7.6.17, 7.7.0 ç›´åˆ° 7.17.10, 7.18.0 ç›´åˆ° 7.21.4, 8.0.0 ç›´åˆ° 8.0.3, 8.1.0 ç›´åˆ° 8.1.3, 8.2.0 ç›´åˆ° 8.2.2, 8.3.0 ç›´åˆ° 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰Bitbucketä»“åº“è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š`CVE-2022-36804-mass.py` å’Œ `README.md`ã€‚

*   `CVE-2022-36804-mass.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å°ä¸€ä¸ªåŒ…å«ä»˜æ¬¾é“¾æ¥çš„å­—ç¬¦ä¸²ï¼Œè¿™è¡¨æ˜å®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªè¯±é¥µæˆ–è¯ˆéª—ã€‚
*   `README.md` æ–‡ä»¶æè¿°äº†æ¼æ´ï¼Œå£°ç§°æä¾›äº†ä¸€ä¸ªPythonç¼–å†™çš„å¤šåŠŸèƒ½PoCï¼Œä½†å®é™…çš„PoCéœ€è¦é€šè¿‡æä¾›çš„ä»˜æ¬¾é“¾æ¥è·å–ï¼Œå¹¶ä¸”æåŠå­˜åœ¨åŒ…å«å¤§é‡æ˜“å—æ”»å‡»æœåŠ¡å™¨çš„åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½œè€…æ„å›¾é€šè¿‡å‡ºå”®æˆ–ä»¥å…¶ä»–æ–¹å¼åˆ†å‘æ‰€è°“çš„PoCè·åˆ©ï¼Œè¿›ä¸€æ­¥æé«˜äº†æŠ•æ¯’é£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥ä»“åº“ä¸­çš„PoCå¾ˆå¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œæˆ–è€…è¯´æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„è¯±é¥µã€‚è¦æ±‚ä»˜æ¬¾çš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ï¼Œè¡¨æ˜ä½œè€…å¯èƒ½è¯•å›¾ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ ¹æ®rapid7.com(webpage 1)å’Œassetnote.io(webpage 3)ä¸Šçš„æè¿°ï¼Œè¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `--exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…éœ€è¦å¯¹ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚æ¥è§¦å‘è¯¥æ¼æ´ã€‚

**æœ‰æ•ˆæ€§ï¼š** ä»æä¾›çš„æ–‡ä»¶æ¥çœ‹ï¼Œæä¾›çš„PoCä»£ç å¯èƒ½æ— æ•ˆæˆ–è€…åŒ…å«æ¶æ„å†…å®¹, éœ€è¦è¿›ä¸€æ­¥éªŒè¯æ‰èƒ½ç¡®è®¤å…¶çœŸå®åŠŸèƒ½ã€‚æ ¹æ®å…¶ä»–æœç´¢ç»“æœï¼Œæ¼æ´æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¶ä»–çš„å¯åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š** æé«˜ã€‚`CVE-2022-36804-mass.py`åªæ˜¯ä¸€ä¸ªè¯±é¥µï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®ä»˜æ¬¾é“¾æ¥ã€‚çœŸæ­£çš„æ”»å‡»ä»£ç å¯èƒ½éšè—åœ¨ä»˜æ¬¾åçš„ä¸‹è½½é“¾æ¥ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚`README.md` çš„å£°æ˜ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“å­˜åœ¨æé«˜çš„æŠ•æ¯’é£é™©(95%)ã€‚

**é¡¹ç›®åœ°å€:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**æ¥æº**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°ã€æœç´¢ç»“æœä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä¸¤ä¸ªpayloadï¼Œç”¨äºè§¦å‘å‘½ä»¤æ³¨å…¥ã€‚
*   `payload` æ–‡ä»¶é€šè¿‡æ„é€ åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚  
*   `payload2` æ–‡ä»¶åŒæ ·æ„é€ äº†åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `id` å‘½ä»¤ã€‚ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

ä»“åº“ä¸­çš„`README.md`åªæ˜¯åŒ…å«PoCçš„æ¼”ç¤ºå›¾ç‰‡ä»¥åŠä½œè€…çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚

ç»¼åˆè¯„ä¼°ï¼Œç”±äºPOCæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œå¹¶éä¸ºäº†ä¼ æ’­æ¶æ„ä»£ç ï¼Œä»“åº“ä¸­ä¸»è¦çš„æ–‡ä»¶æ˜¯ç”¨äºæ¼”ç¤ºå’Œè¯´æ˜æ¼æ´çš„ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚æ­¤å¤„çš„é£é™©ä¸»è¦æ¥æºäºPOCå¯èƒ½è¢«ä»–äººä¿®æ”¹åä¼ æ’­ï¼Œä»è€Œæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­åˆ©ç”¨äº†gitå‘½ä»¤çš„ `--exec` å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­æ’å…¥åŒ…å« `--exec` å’Œæ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

1.  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ç‰¹å®šçš„APIç«¯ç‚¹ï¼Œä¾‹å¦‚ `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`ã€‚
2.  åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­ï¼Œæ’å…¥ç±»ä¼¼ `%00--exec=<command>%00--remote=origin` çš„å­—ç¬¦ä¸²ã€‚
3.  å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡BitbucketæœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„å‘½ä»¤ã€‚

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**æ¥æº**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±æˆ–ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢å¼•æ“ç»“æœï¼ˆå°¤å…¶æ˜¯ `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`ï¼‰ï¼Œæ­¤æ¼æ´åˆ©ç”¨ PoC ä»£ç æœ‰æ•ˆã€‚æä¾›çš„ PoC ä»£ç åŒ…å«æ„å»ºæ˜“å—æ”»å‡»ç¯å¢ƒçš„ Dockerfile å’Œåˆ©ç”¨æ¼æ´çš„ Python è„šæœ¬ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ï¼Œç”¨äºéªŒè¯ RCE å¹¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œç”šè‡³å»ºç«‹åå‘ shellã€‚

**æŠ•æ¯’é£é™©:** åˆ†æ PoC ä»£ç ï¼Œç‰¹åˆ«æ˜¯ `cve-2022-36804.py` è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€æ¶æ„è¯·æ±‚ä»¥è§¦å‘å‘½ä»¤æ³¨å…¥ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚æ½œåœ¨çš„é£é™©å¯èƒ½å­˜åœ¨äºè„šæœ¬ä¸­ä½¿ç”¨çš„ User-Agent å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚å¤´éƒ¨çš„å…¶ä»–å­—æ®µä¸­ï¼Œä½œè€…å¯èƒ½æš—ä¸­æœé›†ä½¿ç”¨è€…ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDockerfile ä¸‹è½½çš„ Bitbucket ç‰ˆæœ¬å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶,ä½†è¿™ä¸åœ¨æœ¬æ¬¡è¯„ä¼°èŒƒå›´å†…ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹ç›®æ ‡ Bitbucket ä»“åº“çš„è¯»å–æƒé™ï¼ˆå…¬å…±æˆ–ç§æœ‰ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œè¯¥å‘½ä»¤ä¼šè¢«æ³¨å…¥åˆ° git å‘½ä»¤çš„ `--exec` å‚æ•°ä¸­ã€‚
3.  æœåŠ¡å™¨åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  PoC ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ `id`ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹åå‘ shellã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶ Bitbucket æœåŠ¡å™¨ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ï¼Œç¯¡æ”¹ä»£ç ï¼Œæˆ–è€…å°†æœåŠ¡å™¨ä½œä¸ºè·³æ¿æ”»å‡»å…¶ä»–å†…éƒ¨ç³»ç»Ÿã€‚

**é¡¹ç›®åœ°å€:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**æ¥æº**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–æ‹¥æœ‰æœ‰æ•ˆçš„session cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ï¼Œå¹¶ä¸”å­˜åœ¨å¯ç”¨çš„PoCä»£ç ã€‚Rapid7 å’Œ AssetNote çš„åˆ†æéƒ½è¡¨æ˜è¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ã€‚

æä¾›çš„PoCä»£ç ï¼ˆBenHays142/CVE-2022-36804-PoC-Exploitï¼‰çš„README.mdæ˜¾ç¤ºï¼Œè¯¥æ¼æ´éœ€è¦å¼€å¯å…¬å…±ä»“åº“ï¼Œæˆ–ä½¿ç”¨æœ‰æ•ˆçš„BITBUCKETSESSIONID cookieï¼ˆå¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼‰ã€‚åˆ©ç”¨æ–¹å¼æ˜¯å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°å—å½±å“çš„APIç«¯ç‚¹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸­æ£€æµ‹åˆ°è‡ªåŠ¨æŸ¥æ‰¾repoçš„åŠŸèƒ½ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚è™½ç„¶è¿™äº›åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚åœ¨è‡ªåŠ¨æŸ¥æ‰¾repoæ—¶ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹äº†repoçš„å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿›ä¸€æ­¥åˆ†æ `main.py`ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥è„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„repoï¼ˆ`detect_repo` å‡½æ•°ï¼‰ã€‚
2.  æ‰§è¡Œå‘½ä»¤ï¼ˆ`exec_stuff` å‡½æ•°ï¼‰ã€‚
3.  æ£€æŸ¥ç›®æ ‡æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆ`check_vuln` å‡½æ•°ï¼‰ã€‚

è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯ä½¿ç”¨æ­¤PoCä»ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹PoCä»£ç ä»¥åŒ…å«æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„ `--exec` å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡åœ¨URLä¸­åµŒå…¥ç‰¹æ®Šçš„payloadï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

`main.py` è„šæœ¬åˆ©ç”¨ `archive` APIï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šæ„é€ çš„ `prefix` å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

å…¶ä¸­ï¼Œ`{cmd}` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`%00` æ˜¯ NULL å­—èŠ‚ï¼Œç”¨äºæˆªæ–­å­—ç¬¦ä¸²ï¼Œä»è€Œä½¿ `--exec` å‚æ•°ç”Ÿæ•ˆã€‚æœåŠ¡å™¨åœ¨å¤„ç†æ­¤è¯·æ±‚æ—¶ï¼Œç”±äºæœªæ­£ç¡®è¿‡æ»¤æˆ–è½¬ä¹‰å‚æ•°ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚

**æ¼æ´å½±å“ï¼š**

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨BitbucketæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å—æŸï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡ä¸­æ–­ç­‰ä¸¥é‡åæœã€‚

**é¡¹ç›®åœ°å€:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**æ¥æº**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ‹¥æœ‰å¯¹å…¬å…±æˆ–ç§æœ‰ Bitbucket ä»“åº“çš„è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚ Rapid7, AssetNote, Sangfor ç­‰ï¼‰éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œå¯åˆ©ç”¨æ€§ã€‚POCä»£ç ä¸­æä¾›çš„ `payload.txt` æ–‡ä»¶åŒ…å«åˆ©ç”¨å‚æ•° `--remote` å’Œ `--exec` è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„payloadã€‚`id` å‘½ä»¤å¯ä»¥ä½œä¸ºæµ‹è¯•æœ‰æ•ˆè½½è·ï¼Œç”¨äºéªŒè¯å‘½ä»¤æ‰§è¡Œã€‚Assetnoteçš„æ–‡ç« ä¹Ÿæåˆ°äº†é€šè¿‡ `--exec` å‚æ•°åˆ©ç”¨ git å‘½ä»¤è¿›è¡Œæ”»å‡»

**æŠ•æ¯’é£é™©ï¼š**
`README.md` æ–‡ä»¶çœ‹èµ·æ¥æ˜¯æ ‡å‡†çš„æ¼æ´æè¿°ã€‚`payload.txt` æ–‡ä»¶åŒ…å«æ˜æ˜¾çš„åˆ©ç”¨payloadã€‚ç†è®ºä¸Šï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹å…¶ä»–æ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œä»…åŸºäºç›®å‰æä¾›çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®è®¤å­˜åœ¨æ¶æ„ä»£ç ã€‚è¯¥ä»“åº“åªæä¾›äº†PoCçš„payloadï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»æ¨¡å—ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨10%å·¦å³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦é›†ä¸­äºæ„é€ æ¶æ„çš„ `archive` è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç‰¹æ®Šçš„å‚æ•°ï¼Œåˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„å‚æ•°æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `--remote` å’Œ `--exec` å‚æ•°æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚å—å½±å“çš„ API ç«¯ç‚¹æ¥å—è¿™äº›å‚æ•°ï¼Œå¹¶æ²¡æœ‰æ­£ç¡®åœ°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

æ”»å‡»è€…éœ€è¦åšçš„ï¼š
1.  ç¡®å®šç›®æ ‡ Bitbucket Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚ `archive?format=zip&path=bighax&prefix=vulnmachines/%00â€“remote=/%00â€“exec=%60id%60%00â€“prefix=/`ã€‚
3.  å‘é€è¯¥è¯·æ±‚åˆ°å—å½±å“çš„ API ç«¯ç‚¹ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**æ¥æº**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨å…·æœ‰è¯»å–æƒé™çš„è´¦å·ï¼Œå‘å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œé€šè¿‡`git archive`å‘½ä»¤çš„`--exec`å‚æ•°æ³¨å…¥æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼åŒ…æ‹¬å‘é€ç‰¹åˆ¶çš„URLï¼Œå…¶ä¸­åŒ…å«ç»è¿‡URLç¼–ç çš„å‘½ä»¤ã€‚ä¾‹å¦‚`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`ï¼Œæ­¤POCä»£ç çš„ç›®çš„æ˜¯éªŒè¯æ¼æ´å­˜åœ¨ä»¥åŠæ‰§è¡Œå‘½ä»¤ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**æ¥æº**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucketå‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–è€…ç§æœ‰ä»“åº“æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±å­˜å‚¨åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼šåˆ©ç”¨git archiveå‘½ä»¤çš„`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚POCä»£ç ä¸­ï¼Œ`mexploit.py`è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„URLï¼Œå°†æ¶æ„å‘½ä»¤æ³¨å…¥åˆ°`--exec`å‚æ•°ä¸­ï¼Œä»è€Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`README.md`æ–‡ä»¶ä»…åŒ…å«æ¼æ´æè¿°å’Œè„šæœ¬ä½¿ç”¨è¯´æ˜ï¼Œæœªå‘ç°æ¶æ„ä»£ç ã€‚åˆæ­¥åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä»éœ€è°¨æ…è¯„ä¼°è„šæœ¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠè„šæœ¬æ˜¯å¦å­˜åœ¨å…¶ä»–éšè—çš„æ¶æ„è¡Œä¸ºã€‚`walnutsecurity/cve-2022-36804`ç­‰ä»“åº“ä¹Ÿæä¾›äº†æ­¤æ¼æ´çš„POCï¼Œå¯ä½œä¸ºå‚è€ƒå¯¹æ¯”ã€‚

**é¡¹ç›®åœ°å€:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**æ¥æº**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2022-36804 å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨å­˜åœ¨æ¼æ´çš„ Bitbucket Server å’Œ Data Center å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ª API ç«¯ç‚¹ä¸­å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´å¯¼è‡´çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨è¯¥æ¼æ´ã€‚å®ƒé¦–å…ˆä½¿ç”¨ `httpx` æŸ¥æ‰¾å…¬å¼€çš„ Bitbucket ä»“åº“ï¼Œç„¶åæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLï¼Œè¯¥å‚æ•°ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`id` å‘½ä»¤è¢«ç”¨ä½œ PoCï¼Œç”¨äºéªŒè¯æ˜¯å¦æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º 10%ã€‚ ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å‘ç°Bitbucketä»“åº“å¹¶æ„é€ åˆ©ç”¨URLã€‚æŠ•æ¯’çš„é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹æ–¹é¢ï¼š

1.  **ä¾èµ–åº“é£é™©:** è„šæœ¬ä¾èµ–äºå¤–éƒ¨åº“ï¼Œå¦‚ `requests` å’Œå‘½ä»¤è¡Œå·¥å…·å¦‚`httpx`, è¿™äº›ä¾èµ–é¡¹å¯èƒ½å­˜åœ¨æ½œåœ¨çš„ä¾›åº”é“¾å®‰å…¨é£é™©ï¼Œè™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†éœ€è¦è€ƒè™‘ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:** è„šæœ¬ä½¿ç”¨äº† `os.system` æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶ç”¨äºè°ƒç”¨ `httpx`ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ targets æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å‘½ä»¤æ³¨å…¥é£é™©ã€‚è¿™éƒ¨åˆ†çš„é£é™©è¾ƒä½ï¼Œå–å†³äº `targets` æ–‡ä»¶çš„å¯æ§ç¨‹åº¦ã€‚
3.  **URL æ„é€ é£é™©:** è„šæœ¬æ„é€  URL çš„é€»è¾‘å­˜åœ¨ä¸€å®šçš„å¤æ‚æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å¯¹ URL çš„å¤„ç†æ–¹å¼ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‘½ä»¤æ‰§è¡Œæˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æŸ¥æ‰¾å…¬å¼€ä»“åº“ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°å…¬å¼€å¯è®¿é—®çš„ Bitbucket ä»“åº“æˆ–å…·æœ‰è¯»å–æƒé™çš„ç§æœ‰ä»“åº“ã€‚
2.  **æ„é€ æ¶æ„ URLï¼š** æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLã€‚è¯¥ URL çš„æ ¼å¼å¦‚ä¸‹ï¼š
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    å…¶ä¸­ï¼Œ`<command>` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  **å‘é€ HTTP è¯·æ±‚ï¼š** æ”»å‡»è€…å‘ Bitbucket æœåŠ¡å™¨å‘é€åŒ…å«æ¶æ„ URL çš„ HTTP è¯·æ±‚ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œåˆ™ä¼šæ‰§è¡Œ URL ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**æ¥æº**: [CVE-2022-36804-notdls_CVE-2022-36804.md](../2022/CVE-2022-36804-notdls_CVE-2022-36804.md)

# CVE-2022-36804

> ğŸ“¦ è¯¥CVEæœ‰ **17** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰æœ‰æ•ˆçš„`BITBUCKETSESSIONID` cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¯¥æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ä¸”å­˜åœ¨ç›¸åº”çš„ä¿®å¤ç‰ˆæœ¬ã€‚æœç´¢ç»“æœä¹Ÿç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’ŒPoCã€‚æä¾›çš„PoCä»£ç ï¼ˆ`CVE-2022-36804-ReverseShell`ï¼‰æè¿°ä¸ºä¸€ä¸ªâ€œsomewhat reliable PoC exploitâ€ï¼Œè¡¨æ˜å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ç¨³å®šï¼Œä½†è¿™é€šå¸¸ä¸ç¯å¢ƒç›¸å…³ï¼Œä¸å½±å“æ¼æ´çš„æ•´ä½“æœ‰æ•ˆæ€§ã€‚PoCä¹Ÿè¯´æ˜æ”¯æŒå…¬æœ‰ä»“åº“ï¼Œå¹¶ä¸”å¯¹ç§æœ‰ä»“åº“å¯ä»¥ä½¿ç”¨session cookieï¼Œå¢åŠ äº†å…¶å¯ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©:**
PoCä»£ç ä¸­å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§è¾ƒä½ï¼ˆä¼°è®¡ä¸º10%ï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š
*   ä»£ç æ¥æºï¼šè¯¥ä»“åº“åŸºäº [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) è¿›è¡Œä¿®æ”¹ï¼Œç”±Chocapikkè¿›è¡Œmass exploitå’Œreverse shellåŠŸèƒ½çš„æ·»åŠ ã€‚è¿™æ„å‘³ç€å­˜åœ¨å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚
*   æ‰¹é‡åˆ©ç”¨ï¼šPoC åŒ…å«æ‰¹é‡æ‰«æå’Œåˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ä»£ç ä»¥å¤§è§„æ¨¡ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚
*   å‘½ä»¤æ‰§è¡Œï¼š PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è™½ç„¶è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿä¸ºæ¤å…¥åé—¨æˆ–æ¶æ„ä»£ç æä¾›äº†é€”å¾„ã€‚
éœ€è¦ä»”ç»†å®¡æŸ¥ `main.py` æ–‡ä»¶ï¼Œç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
    *   æ˜¯å¦æœ‰é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°è¯•ä¸‹è½½æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬ã€‚
    *   reverse shellæ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ˜¯å¦è¿æ¥æœªçŸ¥çš„åœ°å€å’Œç«¯å£ã€‚
    *   å‚æ•°è§£æéƒ¨åˆ†ï¼Œæ˜¯å¦æœ‰éšè—çš„å‚æ•°å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚
    *   æ‰¹é‡æ‰«æå’Œåˆ©ç”¨åŠŸèƒ½ï¼Œæ˜¯å¦å­˜åœ¨å°†ç»“æœå‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„é€»è¾‘ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **è‡ªåŠ¨/æ‰‹åŠ¨ æŸ¥æ‰¾ Repository:** PoC æä¾›äº†è‡ªåŠ¨æŸ¥æ‰¾å¯åˆ©ç”¨ Repository çš„åŠŸèƒ½ã€‚å¦‚æœè‡ªåŠ¨æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Repositoryã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  åˆ©ç”¨è„šæœ¬æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œç›®æ ‡ Bitbucket æœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›å‚æ•°æ—¶ï¼Œä¼šç”±äºå‚æ•°æ³¨å…¥æ¼æ´æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
3.  **æ‰§è¡Œå‘½ä»¤:** æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **åå¼¹shell:** å¯ä»¥ä½¿ç”¨ `--lhost` å’Œ `--lport` å‚æ•°å»ºç«‹åå‘ shellï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚
5. **ä¼šè¯ç»´æŒ:** å¯¹äºç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--session` å‚æ•°ï¼Œæä¾›æœ‰æ•ˆçš„ `BITBUCKETSESSIONID` cookieã€‚


**é¡¹ç›®åœ°å€:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**æ¥æº**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆç‰¹åˆ«æ˜¯Rapid7çš„åˆ†æå’ŒAssetNoteçš„ç ”ç©¶ï¼‰ä»¥åŠæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚PoC ä»£ç æä¾›äº†ä¸€ç§ç›¸å¯¹å¯é çš„åˆ©ç”¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¯ç”¨äº†å…¬å…±ä»“åº“çš„å®ä¾‹ã€‚å³ä½¿ç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookie è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ³¨å…¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«è‡ªåŠ¨æ£€æµ‹ä»“åº“çš„åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç›®æ ‡ã€æ‰§è¡Œå‘½ä»¤ã€åå¼¹shellç­‰é€‰é¡¹ã€‚æ½œåœ¨çš„æŠ•æ¯’é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **æ¶æ„å‘½ä»¤é»˜è®¤å€¼ï¼š**  è™½ç„¶`--command`å‚æ•°é»˜è®¤ä¸º`whoami`ï¼Œä½†æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹é»˜è®¤å€¼ï¼Œä½¿å…¶æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚
2.  **åå¼¹ Shell åŠŸèƒ½ï¼š**  `--lhost` å’Œ `--lport` å‚æ•°ç”¨äºè®¾ç½®åå¼¹ shellï¼Œå¦‚æœæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·è¿è¡Œæ­¤ PoC å¹¶è¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½å¯¼è‡´å—å®³è€…ç³»ç»Ÿè¢«å®Œå…¨æ§åˆ¶ã€‚
3.  **æ‰¹é‡æ‰«æçš„æ½œåœ¨é£é™©ï¼š**  `--file` å‚æ•°å…è®¸æ‰¹é‡æ‰«æç›®æ ‡ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨æ­¤åŠŸèƒ½è¿›è¡Œå¤§è§„æ¨¡æ”»å‡»ï¼Œæˆ–è€…åœ¨æ‰«æè¿‡ç¨‹ä¸­æ¤å…¥æ¶æ„ä»£ç ã€‚
4. **ä»£ç é€»è¾‘ç¼ºé™·**: ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ½œåœ¨çš„é€»è¾‘ç¼ºé™·æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œæ„å¤–çš„æ“ä½œã€‚

ç»¼åˆæ¥çœ‹ï¼Œè™½ç„¶PoCä»£ç ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å­˜åœ¨è¢«æ»¥ç”¨æˆ–ä¿®æ”¹ä»¥è¿›è¡Œæ¶æ„æ”»å‡»çš„é£é™©ã€‚åˆæ­¥åˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ Bitbucket Server/Data Center ç‰ˆæœ¬ï¼š** ç¡®è®¤ç›®æ ‡ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ< 8.3.1ï¼‰ã€‚
2.  **è·å–ä»“åº“ä¿¡æ¯ï¼š** å¦‚æœå¯ç”¨äº†å…¬å…±ä»“åº“ï¼ŒPoCä»£ç å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¯åˆ©ç”¨çš„ä»“åº“ã€‚å¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œåˆ™éœ€è¦æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookieã€‚
3.  **æ„é€ æ¶æ„ HTTP è¯·æ±‚ï¼š**  PoCä»£ç ä¼šè‡ªåŠ¨æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œå‘é€åˆ°æ˜“å—æ”»å‡»çš„ API ç«¯ç‚¹ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š**  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€åå¼¹ shell ç­‰ã€‚
5. **åˆ©ç”¨å‚æ•°ä¼ é€’å‘½ä»¤**: é€šè¿‡ `--command` å‚æ•°æˆ– `--file` å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ¶æ„å‘½ä»¤,è¿›è¡Œæ¼æ´æ”»å‡».

**æ€»ç»“ï¼š**

CVE-2022-36804 æ˜¯ä¸€ä¸ªé«˜å±çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼ˆéœ€è¦è¯»å–æƒé™ï¼‰ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„PoCä»£ç ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨ Bitbucket Server/Data Center æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚éœ€è¦åŠæ—¶å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**æ¥æº**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ `git archive` å‘½ä»¤çš„ `--exec` å‚æ•°æ³¨å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…éœ€è¦åœ¨URLä¸­æ’å…¥ç»è¿‡ç¼–ç çš„æ¶æ„å‚æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `id` å‘½ä»¤æ¥éªŒè¯æ¼æ´ï¼Œæˆ–è€…ä½¿ç”¨ `cat /etc/passwd` å‘½ä»¤æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚é£é™©åœ¨äºPOCä¸­å¯èƒ½å­˜åœ¨éšè”½çš„ä¸‹è½½è„šæœ¬,æˆ–è€…åŒ…å«å…¶ä»–æ¶æ„è¿æ¥. å› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**æ¥æº**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œå…·æœ‰å…¬å¼€ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰ä»“åº“è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œå¤šä¸ªå®‰å…¨å›¢é˜Ÿå·²ç»å‘ç°äº†æ­¤æ¼æ´å¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ–¹å¼ã€‚æ¼æ´å­˜åœ¨äºå¤šä¸ªAPIç«¯ç‚¹ä¸­ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„gitå‘½ä»¤ï¼Œåˆ©ç”¨`--exec`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å«äº†ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æä¾›çš„POCä»£ç çš„æœ‰æ•ˆæ€§ã€‚

ç”±äºæä¾›çš„ä»£ç åªæ˜¯è®¸å¯è¯æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥åˆ¤å®šæ­¤ä»“åº“ä¸­ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£é™©ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©ä¸º0%ã€‚

æ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™ï¼ˆå…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„gitå‘½ä»¤çš„HTTPè¯·æ±‚å‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œç”±äºæ²¡æœ‰å……åˆ†è¿‡æ»¤å’Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**æ¥æº**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 ç›´åˆ° 7.6.17, 7.7.0 ç›´åˆ° 7.17.10, 7.18.0 ç›´åˆ° 7.21.4, 8.0.0 ç›´åˆ° 8.0.3, 8.1.0 ç›´åˆ° 8.1.3, 8.2.0 ç›´åˆ° 8.2.2, 8.3.0 ç›´åˆ° 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰Bitbucketä»“åº“è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š`CVE-2022-36804-mass.py` å’Œ `README.md`ã€‚

*   `CVE-2022-36804-mass.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å°ä¸€ä¸ªåŒ…å«ä»˜æ¬¾é“¾æ¥çš„å­—ç¬¦ä¸²ï¼Œè¿™è¡¨æ˜å®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªè¯±é¥µæˆ–è¯ˆéª—ã€‚
*   `README.md` æ–‡ä»¶æè¿°äº†æ¼æ´ï¼Œå£°ç§°æä¾›äº†ä¸€ä¸ªPythonç¼–å†™çš„å¤šåŠŸèƒ½PoCï¼Œä½†å®é™…çš„PoCéœ€è¦é€šè¿‡æä¾›çš„ä»˜æ¬¾é“¾æ¥è·å–ï¼Œå¹¶ä¸”æåŠå­˜åœ¨åŒ…å«å¤§é‡æ˜“å—æ”»å‡»æœåŠ¡å™¨çš„åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½œè€…æ„å›¾é€šè¿‡å‡ºå”®æˆ–ä»¥å…¶ä»–æ–¹å¼åˆ†å‘æ‰€è°“çš„PoCè·åˆ©ï¼Œè¿›ä¸€æ­¥æé«˜äº†æŠ•æ¯’é£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥ä»“åº“ä¸­çš„PoCå¾ˆå¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œæˆ–è€…è¯´æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„è¯±é¥µã€‚è¦æ±‚ä»˜æ¬¾çš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ï¼Œè¡¨æ˜ä½œè€…å¯èƒ½è¯•å›¾ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ ¹æ®rapid7.com(webpage 1)å’Œassetnote.io(webpage 3)ä¸Šçš„æè¿°ï¼Œè¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `--exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…éœ€è¦å¯¹ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚æ¥è§¦å‘è¯¥æ¼æ´ã€‚

**æœ‰æ•ˆæ€§ï¼š** ä»æä¾›çš„æ–‡ä»¶æ¥çœ‹ï¼Œæä¾›çš„PoCä»£ç å¯èƒ½æ— æ•ˆæˆ–è€…åŒ…å«æ¶æ„å†…å®¹, éœ€è¦è¿›ä¸€æ­¥éªŒè¯æ‰èƒ½ç¡®è®¤å…¶çœŸå®åŠŸèƒ½ã€‚æ ¹æ®å…¶ä»–æœç´¢ç»“æœï¼Œæ¼æ´æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¶ä»–çš„å¯åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š** æé«˜ã€‚`CVE-2022-36804-mass.py`åªæ˜¯ä¸€ä¸ªè¯±é¥µï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®ä»˜æ¬¾é“¾æ¥ã€‚çœŸæ­£çš„æ”»å‡»ä»£ç å¯èƒ½éšè—åœ¨ä»˜æ¬¾åçš„ä¸‹è½½é“¾æ¥ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚`README.md` çš„å£°æ˜ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“å­˜åœ¨æé«˜çš„æŠ•æ¯’é£é™©(95%)ã€‚

**é¡¹ç›®åœ°å€:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**æ¥æº**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°ã€æœç´¢ç»“æœä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä¸¤ä¸ªpayloadï¼Œç”¨äºè§¦å‘å‘½ä»¤æ³¨å…¥ã€‚
*   `payload` æ–‡ä»¶é€šè¿‡æ„é€ åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚  
*   `payload2` æ–‡ä»¶åŒæ ·æ„é€ äº†åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `id` å‘½ä»¤ã€‚ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

ä»“åº“ä¸­çš„`README.md`åªæ˜¯åŒ…å«PoCçš„æ¼”ç¤ºå›¾ç‰‡ä»¥åŠä½œè€…çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚

ç»¼åˆè¯„ä¼°ï¼Œç”±äºPOCæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œå¹¶éä¸ºäº†ä¼ æ’­æ¶æ„ä»£ç ï¼Œä»“åº“ä¸­ä¸»è¦çš„æ–‡ä»¶æ˜¯ç”¨äºæ¼”ç¤ºå’Œè¯´æ˜æ¼æ´çš„ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚æ­¤å¤„çš„é£é™©ä¸»è¦æ¥æºäºPOCå¯èƒ½è¢«ä»–äººä¿®æ”¹åä¼ æ’­ï¼Œä»è€Œæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­åˆ©ç”¨äº†gitå‘½ä»¤çš„ `--exec` å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­æ’å…¥åŒ…å« `--exec` å’Œæ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

1.  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ç‰¹å®šçš„APIç«¯ç‚¹ï¼Œä¾‹å¦‚ `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`ã€‚
2.  åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­ï¼Œæ’å…¥ç±»ä¼¼ `%00--exec=<command>%00--remote=origin` çš„å­—ç¬¦ä¸²ã€‚
3.  å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡BitbucketæœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„å‘½ä»¤ã€‚

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**æ¥æº**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±æˆ–ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢å¼•æ“ç»“æœï¼ˆå°¤å…¶æ˜¯ `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`ï¼‰ï¼Œæ­¤æ¼æ´åˆ©ç”¨ PoC ä»£ç æœ‰æ•ˆã€‚æä¾›çš„ PoC ä»£ç åŒ…å«æ„å»ºæ˜“å—æ”»å‡»ç¯å¢ƒçš„ Dockerfile å’Œåˆ©ç”¨æ¼æ´çš„ Python è„šæœ¬ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ï¼Œç”¨äºéªŒè¯ RCE å¹¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œç”šè‡³å»ºç«‹åå‘ shellã€‚

**æŠ•æ¯’é£é™©:** åˆ†æ PoC ä»£ç ï¼Œç‰¹åˆ«æ˜¯ `cve-2022-36804.py` è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€æ¶æ„è¯·æ±‚ä»¥è§¦å‘å‘½ä»¤æ³¨å…¥ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚æ½œåœ¨çš„é£é™©å¯èƒ½å­˜åœ¨äºè„šæœ¬ä¸­ä½¿ç”¨çš„ User-Agent å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚å¤´éƒ¨çš„å…¶ä»–å­—æ®µä¸­ï¼Œä½œè€…å¯èƒ½æš—ä¸­æœé›†ä½¿ç”¨è€…ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDockerfile ä¸‹è½½çš„ Bitbucket ç‰ˆæœ¬å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶,ä½†è¿™ä¸åœ¨æœ¬æ¬¡è¯„ä¼°èŒƒå›´å†…ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹ç›®æ ‡ Bitbucket ä»“åº“çš„è¯»å–æƒé™ï¼ˆå…¬å…±æˆ–ç§æœ‰ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œè¯¥å‘½ä»¤ä¼šè¢«æ³¨å…¥åˆ° git å‘½ä»¤çš„ `--exec` å‚æ•°ä¸­ã€‚
3.  æœåŠ¡å™¨åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  PoC ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ `id`ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹åå‘ shellã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶ Bitbucket æœåŠ¡å™¨ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ï¼Œç¯¡æ”¹ä»£ç ï¼Œæˆ–è€…å°†æœåŠ¡å™¨ä½œä¸ºè·³æ¿æ”»å‡»å…¶ä»–å†…éƒ¨ç³»ç»Ÿã€‚

**é¡¹ç›®åœ°å€:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**æ¥æº**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–æ‹¥æœ‰æœ‰æ•ˆçš„session cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ï¼Œå¹¶ä¸”å­˜åœ¨å¯ç”¨çš„PoCä»£ç ã€‚Rapid7 å’Œ AssetNote çš„åˆ†æéƒ½è¡¨æ˜è¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ã€‚

æä¾›çš„PoCä»£ç ï¼ˆBenHays142/CVE-2022-36804-PoC-Exploitï¼‰çš„README.mdæ˜¾ç¤ºï¼Œè¯¥æ¼æ´éœ€è¦å¼€å¯å…¬å…±ä»“åº“ï¼Œæˆ–ä½¿ç”¨æœ‰æ•ˆçš„BITBUCKETSESSIONID cookieï¼ˆå¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼‰ã€‚åˆ©ç”¨æ–¹å¼æ˜¯å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°å—å½±å“çš„APIç«¯ç‚¹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸­æ£€æµ‹åˆ°è‡ªåŠ¨æŸ¥æ‰¾repoçš„åŠŸèƒ½ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚è™½ç„¶è¿™äº›åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚åœ¨è‡ªåŠ¨æŸ¥æ‰¾repoæ—¶ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹äº†repoçš„å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿›ä¸€æ­¥åˆ†æ `main.py`ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥è„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„repoï¼ˆ`detect_repo` å‡½æ•°ï¼‰ã€‚
2.  æ‰§è¡Œå‘½ä»¤ï¼ˆ`exec_stuff` å‡½æ•°ï¼‰ã€‚
3.  æ£€æŸ¥ç›®æ ‡æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆ`check_vuln` å‡½æ•°ï¼‰ã€‚

è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯ä½¿ç”¨æ­¤PoCä»ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹PoCä»£ç ä»¥åŒ…å«æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„ `--exec` å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡åœ¨URLä¸­åµŒå…¥ç‰¹æ®Šçš„payloadï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

`main.py` è„šæœ¬åˆ©ç”¨ `archive` APIï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šæ„é€ çš„ `prefix` å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

å…¶ä¸­ï¼Œ`{cmd}` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`%00` æ˜¯ NULL å­—èŠ‚ï¼Œç”¨äºæˆªæ–­å­—ç¬¦ä¸²ï¼Œä»è€Œä½¿ `--exec` å‚æ•°ç”Ÿæ•ˆã€‚æœåŠ¡å™¨åœ¨å¤„ç†æ­¤è¯·æ±‚æ—¶ï¼Œç”±äºæœªæ­£ç¡®è¿‡æ»¤æˆ–è½¬ä¹‰å‚æ•°ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚

**æ¼æ´å½±å“ï¼š**

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨BitbucketæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å—æŸï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡ä¸­æ–­ç­‰ä¸¥é‡åæœã€‚

**é¡¹ç›®åœ°å€:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**æ¥æº**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ‹¥æœ‰å¯¹å…¬å…±æˆ–ç§æœ‰ Bitbucket ä»“åº“çš„è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚ Rapid7, AssetNote, Sangfor ç­‰ï¼‰éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œå¯åˆ©ç”¨æ€§ã€‚POCä»£ç ä¸­æä¾›çš„ `payload.txt` æ–‡ä»¶åŒ…å«åˆ©ç”¨å‚æ•° `--remote` å’Œ `--exec` è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„payloadã€‚`id` å‘½ä»¤å¯ä»¥ä½œä¸ºæµ‹è¯•æœ‰æ•ˆè½½è·ï¼Œç”¨äºéªŒè¯å‘½ä»¤æ‰§è¡Œã€‚Assetnoteçš„æ–‡ç« ä¹Ÿæåˆ°äº†é€šè¿‡ `--exec` å‚æ•°åˆ©ç”¨ git å‘½ä»¤è¿›è¡Œæ”»å‡»

**æŠ•æ¯’é£é™©ï¼š**
`README.md` æ–‡ä»¶çœ‹èµ·æ¥æ˜¯æ ‡å‡†çš„æ¼æ´æè¿°ã€‚`payload.txt` æ–‡ä»¶åŒ…å«æ˜æ˜¾çš„åˆ©ç”¨payloadã€‚ç†è®ºä¸Šï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹å…¶ä»–æ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œä»…åŸºäºç›®å‰æä¾›çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®è®¤å­˜åœ¨æ¶æ„ä»£ç ã€‚è¯¥ä»“åº“åªæä¾›äº†PoCçš„payloadï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»æ¨¡å—ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨10%å·¦å³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦é›†ä¸­äºæ„é€ æ¶æ„çš„ `archive` è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç‰¹æ®Šçš„å‚æ•°ï¼Œåˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„å‚æ•°æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `--remote` å’Œ `--exec` å‚æ•°æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚å—å½±å“çš„ API ç«¯ç‚¹æ¥å—è¿™äº›å‚æ•°ï¼Œå¹¶æ²¡æœ‰æ­£ç¡®åœ°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

æ”»å‡»è€…éœ€è¦åšçš„ï¼š
1.  ç¡®å®šç›®æ ‡ Bitbucket Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚ `archive?format=zip&path=bighax&prefix=vulnmachines/%00â€“remote=/%00â€“exec=%60id%60%00â€“prefix=/`ã€‚
3.  å‘é€è¯¥è¯·æ±‚åˆ°å—å½±å“çš„ API ç«¯ç‚¹ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**æ¥æº**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨å…·æœ‰è¯»å–æƒé™çš„è´¦å·ï¼Œå‘å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œé€šè¿‡`git archive`å‘½ä»¤çš„`--exec`å‚æ•°æ³¨å…¥æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼åŒ…æ‹¬å‘é€ç‰¹åˆ¶çš„URLï¼Œå…¶ä¸­åŒ…å«ç»è¿‡URLç¼–ç çš„å‘½ä»¤ã€‚ä¾‹å¦‚`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`ï¼Œæ­¤POCä»£ç çš„ç›®çš„æ˜¯éªŒè¯æ¼æ´å­˜åœ¨ä»¥åŠæ‰§è¡Œå‘½ä»¤ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**æ¥æº**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucketå‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–è€…ç§æœ‰ä»“åº“æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±å­˜å‚¨åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼šåˆ©ç”¨git archiveå‘½ä»¤çš„`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚POCä»£ç ä¸­ï¼Œ`mexploit.py`è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„URLï¼Œå°†æ¶æ„å‘½ä»¤æ³¨å…¥åˆ°`--exec`å‚æ•°ä¸­ï¼Œä»è€Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`README.md`æ–‡ä»¶ä»…åŒ…å«æ¼æ´æè¿°å’Œè„šæœ¬ä½¿ç”¨è¯´æ˜ï¼Œæœªå‘ç°æ¶æ„ä»£ç ã€‚åˆæ­¥åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä»éœ€è°¨æ…è¯„ä¼°è„šæœ¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠè„šæœ¬æ˜¯å¦å­˜åœ¨å…¶ä»–éšè—çš„æ¶æ„è¡Œä¸ºã€‚`walnutsecurity/cve-2022-36804`ç­‰ä»“åº“ä¹Ÿæä¾›äº†æ­¤æ¼æ´çš„POCï¼Œå¯ä½œä¸ºå‚è€ƒå¯¹æ¯”ã€‚

**é¡¹ç›®åœ°å€:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**æ¥æº**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2022-36804 å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨å­˜åœ¨æ¼æ´çš„ Bitbucket Server å’Œ Data Center å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ª API ç«¯ç‚¹ä¸­å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´å¯¼è‡´çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨è¯¥æ¼æ´ã€‚å®ƒé¦–å…ˆä½¿ç”¨ `httpx` æŸ¥æ‰¾å…¬å¼€çš„ Bitbucket ä»“åº“ï¼Œç„¶åæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLï¼Œè¯¥å‚æ•°ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`id` å‘½ä»¤è¢«ç”¨ä½œ PoCï¼Œç”¨äºéªŒè¯æ˜¯å¦æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º 10%ã€‚ ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å‘ç°Bitbucketä»“åº“å¹¶æ„é€ åˆ©ç”¨URLã€‚æŠ•æ¯’çš„é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹æ–¹é¢ï¼š

1.  **ä¾èµ–åº“é£é™©:** è„šæœ¬ä¾èµ–äºå¤–éƒ¨åº“ï¼Œå¦‚ `requests` å’Œå‘½ä»¤è¡Œå·¥å…·å¦‚`httpx`, è¿™äº›ä¾èµ–é¡¹å¯èƒ½å­˜åœ¨æ½œåœ¨çš„ä¾›åº”é“¾å®‰å…¨é£é™©ï¼Œè™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†éœ€è¦è€ƒè™‘ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:** è„šæœ¬ä½¿ç”¨äº† `os.system` æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶ç”¨äºè°ƒç”¨ `httpx`ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ targets æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å‘½ä»¤æ³¨å…¥é£é™©ã€‚è¿™éƒ¨åˆ†çš„é£é™©è¾ƒä½ï¼Œå–å†³äº `targets` æ–‡ä»¶çš„å¯æ§ç¨‹åº¦ã€‚
3.  **URL æ„é€ é£é™©:** è„šæœ¬æ„é€  URL çš„é€»è¾‘å­˜åœ¨ä¸€å®šçš„å¤æ‚æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å¯¹ URL çš„å¤„ç†æ–¹å¼ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‘½ä»¤æ‰§è¡Œæˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æŸ¥æ‰¾å…¬å¼€ä»“åº“ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°å…¬å¼€å¯è®¿é—®çš„ Bitbucket ä»“åº“æˆ–å…·æœ‰è¯»å–æƒé™çš„ç§æœ‰ä»“åº“ã€‚
2.  **æ„é€ æ¶æ„ URLï¼š** æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLã€‚è¯¥ URL çš„æ ¼å¼å¦‚ä¸‹ï¼š
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    å…¶ä¸­ï¼Œ`<command>` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  **å‘é€ HTTP è¯·æ±‚ï¼š** æ”»å‡»è€…å‘ Bitbucket æœåŠ¡å™¨å‘é€åŒ…å«æ¶æ„ URL çš„ HTTP è¯·æ±‚ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œåˆ™ä¼šæ‰§è¡Œ URL ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**æ¥æº**: [CVE-2022-36804-notdls_CVE-2022-36804.md](../2022/CVE-2022-36804-notdls_CVE-2022-36804.md)

# CVE-2022-36804

> ğŸ“¦ è¯¥CVEæœ‰ **17** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰æœ‰æ•ˆçš„`BITBUCKETSESSIONID` cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¯¥æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ä¸”å­˜åœ¨ç›¸åº”çš„ä¿®å¤ç‰ˆæœ¬ã€‚æœç´¢ç»“æœä¹Ÿç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’ŒPoCã€‚æä¾›çš„PoCä»£ç ï¼ˆ`CVE-2022-36804-ReverseShell`ï¼‰æè¿°ä¸ºä¸€ä¸ªâ€œsomewhat reliable PoC exploitâ€ï¼Œè¡¨æ˜å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ç¨³å®šï¼Œä½†è¿™é€šå¸¸ä¸ç¯å¢ƒç›¸å…³ï¼Œä¸å½±å“æ¼æ´çš„æ•´ä½“æœ‰æ•ˆæ€§ã€‚PoCä¹Ÿè¯´æ˜æ”¯æŒå…¬æœ‰ä»“åº“ï¼Œå¹¶ä¸”å¯¹ç§æœ‰ä»“åº“å¯ä»¥ä½¿ç”¨session cookieï¼Œå¢åŠ äº†å…¶å¯ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©:**
PoCä»£ç ä¸­å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§è¾ƒä½ï¼ˆä¼°è®¡ä¸º10%ï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š
*   ä»£ç æ¥æºï¼šè¯¥ä»“åº“åŸºäº [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) è¿›è¡Œä¿®æ”¹ï¼Œç”±Chocapikkè¿›è¡Œmass exploitå’Œreverse shellåŠŸèƒ½çš„æ·»åŠ ã€‚è¿™æ„å‘³ç€å­˜åœ¨å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚
*   æ‰¹é‡åˆ©ç”¨ï¼šPoC åŒ…å«æ‰¹é‡æ‰«æå’Œåˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ä»£ç ä»¥å¤§è§„æ¨¡ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚
*   å‘½ä»¤æ‰§è¡Œï¼š PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è™½ç„¶è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿä¸ºæ¤å…¥åé—¨æˆ–æ¶æ„ä»£ç æä¾›äº†é€”å¾„ã€‚
éœ€è¦ä»”ç»†å®¡æŸ¥ `main.py` æ–‡ä»¶ï¼Œç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
    *   æ˜¯å¦æœ‰é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°è¯•ä¸‹è½½æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬ã€‚
    *   reverse shellæ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ˜¯å¦è¿æ¥æœªçŸ¥çš„åœ°å€å’Œç«¯å£ã€‚
    *   å‚æ•°è§£æéƒ¨åˆ†ï¼Œæ˜¯å¦æœ‰éšè—çš„å‚æ•°å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚
    *   æ‰¹é‡æ‰«æå’Œåˆ©ç”¨åŠŸèƒ½ï¼Œæ˜¯å¦å­˜åœ¨å°†ç»“æœå‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„é€»è¾‘ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **è‡ªåŠ¨/æ‰‹åŠ¨ æŸ¥æ‰¾ Repository:** PoC æä¾›äº†è‡ªåŠ¨æŸ¥æ‰¾å¯åˆ©ç”¨ Repository çš„åŠŸèƒ½ã€‚å¦‚æœè‡ªåŠ¨æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Repositoryã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  åˆ©ç”¨è„šæœ¬æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œç›®æ ‡ Bitbucket æœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›å‚æ•°æ—¶ï¼Œä¼šç”±äºå‚æ•°æ³¨å…¥æ¼æ´æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
3.  **æ‰§è¡Œå‘½ä»¤:** æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **åå¼¹shell:** å¯ä»¥ä½¿ç”¨ `--lhost` å’Œ `--lport` å‚æ•°å»ºç«‹åå‘ shellï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚
5. **ä¼šè¯ç»´æŒ:** å¯¹äºç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--session` å‚æ•°ï¼Œæä¾›æœ‰æ•ˆçš„ `BITBUCKETSESSIONID` cookieã€‚


**é¡¹ç›®åœ°å€:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**æ¥æº**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆç‰¹åˆ«æ˜¯Rapid7çš„åˆ†æå’ŒAssetNoteçš„ç ”ç©¶ï¼‰ä»¥åŠæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚PoC ä»£ç æä¾›äº†ä¸€ç§ç›¸å¯¹å¯é çš„åˆ©ç”¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¯ç”¨äº†å…¬å…±ä»“åº“çš„å®ä¾‹ã€‚å³ä½¿ç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookie è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ³¨å…¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«è‡ªåŠ¨æ£€æµ‹ä»“åº“çš„åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç›®æ ‡ã€æ‰§è¡Œå‘½ä»¤ã€åå¼¹shellç­‰é€‰é¡¹ã€‚æ½œåœ¨çš„æŠ•æ¯’é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **æ¶æ„å‘½ä»¤é»˜è®¤å€¼ï¼š**  è™½ç„¶`--command`å‚æ•°é»˜è®¤ä¸º`whoami`ï¼Œä½†æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹é»˜è®¤å€¼ï¼Œä½¿å…¶æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚
2.  **åå¼¹ Shell åŠŸèƒ½ï¼š**  `--lhost` å’Œ `--lport` å‚æ•°ç”¨äºè®¾ç½®åå¼¹ shellï¼Œå¦‚æœæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·è¿è¡Œæ­¤ PoC å¹¶è¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½å¯¼è‡´å—å®³è€…ç³»ç»Ÿè¢«å®Œå…¨æ§åˆ¶ã€‚
3.  **æ‰¹é‡æ‰«æçš„æ½œåœ¨é£é™©ï¼š**  `--file` å‚æ•°å…è®¸æ‰¹é‡æ‰«æç›®æ ‡ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨æ­¤åŠŸèƒ½è¿›è¡Œå¤§è§„æ¨¡æ”»å‡»ï¼Œæˆ–è€…åœ¨æ‰«æè¿‡ç¨‹ä¸­æ¤å…¥æ¶æ„ä»£ç ã€‚
4. **ä»£ç é€»è¾‘ç¼ºé™·**: ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ½œåœ¨çš„é€»è¾‘ç¼ºé™·æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œæ„å¤–çš„æ“ä½œã€‚

ç»¼åˆæ¥çœ‹ï¼Œè™½ç„¶PoCä»£ç ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å­˜åœ¨è¢«æ»¥ç”¨æˆ–ä¿®æ”¹ä»¥è¿›è¡Œæ¶æ„æ”»å‡»çš„é£é™©ã€‚åˆæ­¥åˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ Bitbucket Server/Data Center ç‰ˆæœ¬ï¼š** ç¡®è®¤ç›®æ ‡ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ< 8.3.1ï¼‰ã€‚
2.  **è·å–ä»“åº“ä¿¡æ¯ï¼š** å¦‚æœå¯ç”¨äº†å…¬å…±ä»“åº“ï¼ŒPoCä»£ç å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¯åˆ©ç”¨çš„ä»“åº“ã€‚å¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œåˆ™éœ€è¦æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookieã€‚
3.  **æ„é€ æ¶æ„ HTTP è¯·æ±‚ï¼š**  PoCä»£ç ä¼šè‡ªåŠ¨æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œå‘é€åˆ°æ˜“å—æ”»å‡»çš„ API ç«¯ç‚¹ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š**  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€åå¼¹ shell ç­‰ã€‚
5. **åˆ©ç”¨å‚æ•°ä¼ é€’å‘½ä»¤**: é€šè¿‡ `--command` å‚æ•°æˆ– `--file` å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ¶æ„å‘½ä»¤,è¿›è¡Œæ¼æ´æ”»å‡».

**æ€»ç»“ï¼š**

CVE-2022-36804 æ˜¯ä¸€ä¸ªé«˜å±çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼ˆéœ€è¦è¯»å–æƒé™ï¼‰ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„PoCä»£ç ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨ Bitbucket Server/Data Center æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚éœ€è¦åŠæ—¶å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**æ¥æº**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ `git archive` å‘½ä»¤çš„ `--exec` å‚æ•°æ³¨å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…éœ€è¦åœ¨URLä¸­æ’å…¥ç»è¿‡ç¼–ç çš„æ¶æ„å‚æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `id` å‘½ä»¤æ¥éªŒè¯æ¼æ´ï¼Œæˆ–è€…ä½¿ç”¨ `cat /etc/passwd` å‘½ä»¤æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚é£é™©åœ¨äºPOCä¸­å¯èƒ½å­˜åœ¨éšè”½çš„ä¸‹è½½è„šæœ¬,æˆ–è€…åŒ…å«å…¶ä»–æ¶æ„è¿æ¥. å› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**æ¥æº**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œå…·æœ‰å…¬å¼€ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰ä»“åº“è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œå¤šä¸ªå®‰å…¨å›¢é˜Ÿå·²ç»å‘ç°äº†æ­¤æ¼æ´å¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ–¹å¼ã€‚æ¼æ´å­˜åœ¨äºå¤šä¸ªAPIç«¯ç‚¹ä¸­ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„gitå‘½ä»¤ï¼Œåˆ©ç”¨`--exec`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å«äº†ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æä¾›çš„POCä»£ç çš„æœ‰æ•ˆæ€§ã€‚

ç”±äºæä¾›çš„ä»£ç åªæ˜¯è®¸å¯è¯æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥åˆ¤å®šæ­¤ä»“åº“ä¸­ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£é™©ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©ä¸º0%ã€‚

æ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™ï¼ˆå…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„gitå‘½ä»¤çš„HTTPè¯·æ±‚å‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œç”±äºæ²¡æœ‰å……åˆ†è¿‡æ»¤å’Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**æ¥æº**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 ç›´åˆ° 7.6.17, 7.7.0 ç›´åˆ° 7.17.10, 7.18.0 ç›´åˆ° 7.21.4, 8.0.0 ç›´åˆ° 8.0.3, 8.1.0 ç›´åˆ° 8.1.3, 8.2.0 ç›´åˆ° 8.2.2, 8.3.0 ç›´åˆ° 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰Bitbucketä»“åº“è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š`CVE-2022-36804-mass.py` å’Œ `README.md`ã€‚

*   `CVE-2022-36804-mass.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å°ä¸€ä¸ªåŒ…å«ä»˜æ¬¾é“¾æ¥çš„å­—ç¬¦ä¸²ï¼Œè¿™è¡¨æ˜å®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªè¯±é¥µæˆ–è¯ˆéª—ã€‚
*   `README.md` æ–‡ä»¶æè¿°äº†æ¼æ´ï¼Œå£°ç§°æä¾›äº†ä¸€ä¸ªPythonç¼–å†™çš„å¤šåŠŸèƒ½PoCï¼Œä½†å®é™…çš„PoCéœ€è¦é€šè¿‡æä¾›çš„ä»˜æ¬¾é“¾æ¥è·å–ï¼Œå¹¶ä¸”æåŠå­˜åœ¨åŒ…å«å¤§é‡æ˜“å—æ”»å‡»æœåŠ¡å™¨çš„åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½œè€…æ„å›¾é€šè¿‡å‡ºå”®æˆ–ä»¥å…¶ä»–æ–¹å¼åˆ†å‘æ‰€è°“çš„PoCè·åˆ©ï¼Œè¿›ä¸€æ­¥æé«˜äº†æŠ•æ¯’é£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥ä»“åº“ä¸­çš„PoCå¾ˆå¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œæˆ–è€…è¯´æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„è¯±é¥µã€‚è¦æ±‚ä»˜æ¬¾çš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ï¼Œè¡¨æ˜ä½œè€…å¯èƒ½è¯•å›¾ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ ¹æ®rapid7.com(webpage 1)å’Œassetnote.io(webpage 3)ä¸Šçš„æè¿°ï¼Œè¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `--exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…éœ€è¦å¯¹ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚æ¥è§¦å‘è¯¥æ¼æ´ã€‚

**æœ‰æ•ˆæ€§ï¼š** ä»æä¾›çš„æ–‡ä»¶æ¥çœ‹ï¼Œæä¾›çš„PoCä»£ç å¯èƒ½æ— æ•ˆæˆ–è€…åŒ…å«æ¶æ„å†…å®¹, éœ€è¦è¿›ä¸€æ­¥éªŒè¯æ‰èƒ½ç¡®è®¤å…¶çœŸå®åŠŸèƒ½ã€‚æ ¹æ®å…¶ä»–æœç´¢ç»“æœï¼Œæ¼æ´æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¶ä»–çš„å¯åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š** æé«˜ã€‚`CVE-2022-36804-mass.py`åªæ˜¯ä¸€ä¸ªè¯±é¥µï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®ä»˜æ¬¾é“¾æ¥ã€‚çœŸæ­£çš„æ”»å‡»ä»£ç å¯èƒ½éšè—åœ¨ä»˜æ¬¾åçš„ä¸‹è½½é“¾æ¥ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚`README.md` çš„å£°æ˜ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“å­˜åœ¨æé«˜çš„æŠ•æ¯’é£é™©(95%)ã€‚

**é¡¹ç›®åœ°å€:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**æ¥æº**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°ã€æœç´¢ç»“æœä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä¸¤ä¸ªpayloadï¼Œç”¨äºè§¦å‘å‘½ä»¤æ³¨å…¥ã€‚
*   `payload` æ–‡ä»¶é€šè¿‡æ„é€ åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚  
*   `payload2` æ–‡ä»¶åŒæ ·æ„é€ äº†åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `id` å‘½ä»¤ã€‚ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

ä»“åº“ä¸­çš„`README.md`åªæ˜¯åŒ…å«PoCçš„æ¼”ç¤ºå›¾ç‰‡ä»¥åŠä½œè€…çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚

ç»¼åˆè¯„ä¼°ï¼Œç”±äºPOCæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œå¹¶éä¸ºäº†ä¼ æ’­æ¶æ„ä»£ç ï¼Œä»“åº“ä¸­ä¸»è¦çš„æ–‡ä»¶æ˜¯ç”¨äºæ¼”ç¤ºå’Œè¯´æ˜æ¼æ´çš„ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚æ­¤å¤„çš„é£é™©ä¸»è¦æ¥æºäºPOCå¯èƒ½è¢«ä»–äººä¿®æ”¹åä¼ æ’­ï¼Œä»è€Œæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­åˆ©ç”¨äº†gitå‘½ä»¤çš„ `--exec` å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­æ’å…¥åŒ…å« `--exec` å’Œæ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

1.  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ç‰¹å®šçš„APIç«¯ç‚¹ï¼Œä¾‹å¦‚ `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`ã€‚
2.  åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­ï¼Œæ’å…¥ç±»ä¼¼ `%00--exec=<command>%00--remote=origin` çš„å­—ç¬¦ä¸²ã€‚
3.  å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡BitbucketæœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„å‘½ä»¤ã€‚

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**æ¥æº**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±æˆ–ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢å¼•æ“ç»“æœï¼ˆå°¤å…¶æ˜¯ `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`ï¼‰ï¼Œæ­¤æ¼æ´åˆ©ç”¨ PoC ä»£ç æœ‰æ•ˆã€‚æä¾›çš„ PoC ä»£ç åŒ…å«æ„å»ºæ˜“å—æ”»å‡»ç¯å¢ƒçš„ Dockerfile å’Œåˆ©ç”¨æ¼æ´çš„ Python è„šæœ¬ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ï¼Œç”¨äºéªŒè¯ RCE å¹¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œç”šè‡³å»ºç«‹åå‘ shellã€‚

**æŠ•æ¯’é£é™©:** åˆ†æ PoC ä»£ç ï¼Œç‰¹åˆ«æ˜¯ `cve-2022-36804.py` è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€æ¶æ„è¯·æ±‚ä»¥è§¦å‘å‘½ä»¤æ³¨å…¥ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚æ½œåœ¨çš„é£é™©å¯èƒ½å­˜åœ¨äºè„šæœ¬ä¸­ä½¿ç”¨çš„ User-Agent å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚å¤´éƒ¨çš„å…¶ä»–å­—æ®µä¸­ï¼Œä½œè€…å¯èƒ½æš—ä¸­æœé›†ä½¿ç”¨è€…ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDockerfile ä¸‹è½½çš„ Bitbucket ç‰ˆæœ¬å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶,ä½†è¿™ä¸åœ¨æœ¬æ¬¡è¯„ä¼°èŒƒå›´å†…ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹ç›®æ ‡ Bitbucket ä»“åº“çš„è¯»å–æƒé™ï¼ˆå…¬å…±æˆ–ç§æœ‰ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œè¯¥å‘½ä»¤ä¼šè¢«æ³¨å…¥åˆ° git å‘½ä»¤çš„ `--exec` å‚æ•°ä¸­ã€‚
3.  æœåŠ¡å™¨åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  PoC ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ `id`ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹åå‘ shellã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶ Bitbucket æœåŠ¡å™¨ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ï¼Œç¯¡æ”¹ä»£ç ï¼Œæˆ–è€…å°†æœåŠ¡å™¨ä½œä¸ºè·³æ¿æ”»å‡»å…¶ä»–å†…éƒ¨ç³»ç»Ÿã€‚

**é¡¹ç›®åœ°å€:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**æ¥æº**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–æ‹¥æœ‰æœ‰æ•ˆçš„session cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ï¼Œå¹¶ä¸”å­˜åœ¨å¯ç”¨çš„PoCä»£ç ã€‚Rapid7 å’Œ AssetNote çš„åˆ†æéƒ½è¡¨æ˜è¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ã€‚

æä¾›çš„PoCä»£ç ï¼ˆBenHays142/CVE-2022-36804-PoC-Exploitï¼‰çš„README.mdæ˜¾ç¤ºï¼Œè¯¥æ¼æ´éœ€è¦å¼€å¯å…¬å…±ä»“åº“ï¼Œæˆ–ä½¿ç”¨æœ‰æ•ˆçš„BITBUCKETSESSIONID cookieï¼ˆå¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼‰ã€‚åˆ©ç”¨æ–¹å¼æ˜¯å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°å—å½±å“çš„APIç«¯ç‚¹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸­æ£€æµ‹åˆ°è‡ªåŠ¨æŸ¥æ‰¾repoçš„åŠŸèƒ½ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚è™½ç„¶è¿™äº›åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚åœ¨è‡ªåŠ¨æŸ¥æ‰¾repoæ—¶ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹äº†repoçš„å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿›ä¸€æ­¥åˆ†æ `main.py`ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥è„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„repoï¼ˆ`detect_repo` å‡½æ•°ï¼‰ã€‚
2.  æ‰§è¡Œå‘½ä»¤ï¼ˆ`exec_stuff` å‡½æ•°ï¼‰ã€‚
3.  æ£€æŸ¥ç›®æ ‡æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆ`check_vuln` å‡½æ•°ï¼‰ã€‚

è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯ä½¿ç”¨æ­¤PoCä»ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹PoCä»£ç ä»¥åŒ…å«æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„ `--exec` å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡åœ¨URLä¸­åµŒå…¥ç‰¹æ®Šçš„payloadï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

`main.py` è„šæœ¬åˆ©ç”¨ `archive` APIï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šæ„é€ çš„ `prefix` å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

å…¶ä¸­ï¼Œ`{cmd}` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`%00` æ˜¯ NULL å­—èŠ‚ï¼Œç”¨äºæˆªæ–­å­—ç¬¦ä¸²ï¼Œä»è€Œä½¿ `--exec` å‚æ•°ç”Ÿæ•ˆã€‚æœåŠ¡å™¨åœ¨å¤„ç†æ­¤è¯·æ±‚æ—¶ï¼Œç”±äºæœªæ­£ç¡®è¿‡æ»¤æˆ–è½¬ä¹‰å‚æ•°ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚

**æ¼æ´å½±å“ï¼š**

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨BitbucketæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å—æŸï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡ä¸­æ–­ç­‰ä¸¥é‡åæœã€‚

**é¡¹ç›®åœ°å€:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**æ¥æº**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ‹¥æœ‰å¯¹å…¬å…±æˆ–ç§æœ‰ Bitbucket ä»“åº“çš„è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚ Rapid7, AssetNote, Sangfor ç­‰ï¼‰éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œå¯åˆ©ç”¨æ€§ã€‚POCä»£ç ä¸­æä¾›çš„ `payload.txt` æ–‡ä»¶åŒ…å«åˆ©ç”¨å‚æ•° `--remote` å’Œ `--exec` è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„payloadã€‚`id` å‘½ä»¤å¯ä»¥ä½œä¸ºæµ‹è¯•æœ‰æ•ˆè½½è·ï¼Œç”¨äºéªŒè¯å‘½ä»¤æ‰§è¡Œã€‚Assetnoteçš„æ–‡ç« ä¹Ÿæåˆ°äº†é€šè¿‡ `--exec` å‚æ•°åˆ©ç”¨ git å‘½ä»¤è¿›è¡Œæ”»å‡»

**æŠ•æ¯’é£é™©ï¼š**
`README.md` æ–‡ä»¶çœ‹èµ·æ¥æ˜¯æ ‡å‡†çš„æ¼æ´æè¿°ã€‚`payload.txt` æ–‡ä»¶åŒ…å«æ˜æ˜¾çš„åˆ©ç”¨payloadã€‚ç†è®ºä¸Šï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹å…¶ä»–æ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œä»…åŸºäºç›®å‰æä¾›çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®è®¤å­˜åœ¨æ¶æ„ä»£ç ã€‚è¯¥ä»“åº“åªæä¾›äº†PoCçš„payloadï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»æ¨¡å—ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨10%å·¦å³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦é›†ä¸­äºæ„é€ æ¶æ„çš„ `archive` è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç‰¹æ®Šçš„å‚æ•°ï¼Œåˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„å‚æ•°æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `--remote` å’Œ `--exec` å‚æ•°æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚å—å½±å“çš„ API ç«¯ç‚¹æ¥å—è¿™äº›å‚æ•°ï¼Œå¹¶æ²¡æœ‰æ­£ç¡®åœ°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

æ”»å‡»è€…éœ€è¦åšçš„ï¼š
1.  ç¡®å®šç›®æ ‡ Bitbucket Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚ `archive?format=zip&path=bighax&prefix=vulnmachines/%00â€“remote=/%00â€“exec=%60id%60%00â€“prefix=/`ã€‚
3.  å‘é€è¯¥è¯·æ±‚åˆ°å—å½±å“çš„ API ç«¯ç‚¹ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**æ¥æº**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨å…·æœ‰è¯»å–æƒé™çš„è´¦å·ï¼Œå‘å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œé€šè¿‡`git archive`å‘½ä»¤çš„`--exec`å‚æ•°æ³¨å…¥æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼åŒ…æ‹¬å‘é€ç‰¹åˆ¶çš„URLï¼Œå…¶ä¸­åŒ…å«ç»è¿‡URLç¼–ç çš„å‘½ä»¤ã€‚ä¾‹å¦‚`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`ï¼Œæ­¤POCä»£ç çš„ç›®çš„æ˜¯éªŒè¯æ¼æ´å­˜åœ¨ä»¥åŠæ‰§è¡Œå‘½ä»¤ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**æ¥æº**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucketå‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–è€…ç§æœ‰ä»“åº“æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±å­˜å‚¨åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼šåˆ©ç”¨git archiveå‘½ä»¤çš„`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚POCä»£ç ä¸­ï¼Œ`mexploit.py`è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„URLï¼Œå°†æ¶æ„å‘½ä»¤æ³¨å…¥åˆ°`--exec`å‚æ•°ä¸­ï¼Œä»è€Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`README.md`æ–‡ä»¶ä»…åŒ…å«æ¼æ´æè¿°å’Œè„šæœ¬ä½¿ç”¨è¯´æ˜ï¼Œæœªå‘ç°æ¶æ„ä»£ç ã€‚åˆæ­¥åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä»éœ€è°¨æ…è¯„ä¼°è„šæœ¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠè„šæœ¬æ˜¯å¦å­˜åœ¨å…¶ä»–éšè—çš„æ¶æ„è¡Œä¸ºã€‚`walnutsecurity/cve-2022-36804`ç­‰ä»“åº“ä¹Ÿæä¾›äº†æ­¤æ¼æ´çš„POCï¼Œå¯ä½œä¸ºå‚è€ƒå¯¹æ¯”ã€‚

**é¡¹ç›®åœ°å€:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**æ¥æº**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2022-36804 å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨å­˜åœ¨æ¼æ´çš„ Bitbucket Server å’Œ Data Center å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ª API ç«¯ç‚¹ä¸­å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´å¯¼è‡´çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨è¯¥æ¼æ´ã€‚å®ƒé¦–å…ˆä½¿ç”¨ `httpx` æŸ¥æ‰¾å…¬å¼€çš„ Bitbucket ä»“åº“ï¼Œç„¶åæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLï¼Œè¯¥å‚æ•°ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`id` å‘½ä»¤è¢«ç”¨ä½œ PoCï¼Œç”¨äºéªŒè¯æ˜¯å¦æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º 10%ã€‚ ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å‘ç°Bitbucketä»“åº“å¹¶æ„é€ åˆ©ç”¨URLã€‚æŠ•æ¯’çš„é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹æ–¹é¢ï¼š

1.  **ä¾èµ–åº“é£é™©:** è„šæœ¬ä¾èµ–äºå¤–éƒ¨åº“ï¼Œå¦‚ `requests` å’Œå‘½ä»¤è¡Œå·¥å…·å¦‚`httpx`, è¿™äº›ä¾èµ–é¡¹å¯èƒ½å­˜åœ¨æ½œåœ¨çš„ä¾›åº”é“¾å®‰å…¨é£é™©ï¼Œè™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†éœ€è¦è€ƒè™‘ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:** è„šæœ¬ä½¿ç”¨äº† `os.system` æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶ç”¨äºè°ƒç”¨ `httpx`ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ targets æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å‘½ä»¤æ³¨å…¥é£é™©ã€‚è¿™éƒ¨åˆ†çš„é£é™©è¾ƒä½ï¼Œå–å†³äº `targets` æ–‡ä»¶çš„å¯æ§ç¨‹åº¦ã€‚
3.  **URL æ„é€ é£é™©:** è„šæœ¬æ„é€  URL çš„é€»è¾‘å­˜åœ¨ä¸€å®šçš„å¤æ‚æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å¯¹ URL çš„å¤„ç†æ–¹å¼ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‘½ä»¤æ‰§è¡Œæˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æŸ¥æ‰¾å…¬å¼€ä»“åº“ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°å…¬å¼€å¯è®¿é—®çš„ Bitbucket ä»“åº“æˆ–å…·æœ‰è¯»å–æƒé™çš„ç§æœ‰ä»“åº“ã€‚
2.  **æ„é€ æ¶æ„ URLï¼š** æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLã€‚è¯¥ URL çš„æ ¼å¼å¦‚ä¸‹ï¼š
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    å…¶ä¸­ï¼Œ`<command>` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  **å‘é€ HTTP è¯·æ±‚ï¼š** æ”»å‡»è€…å‘ Bitbucket æœåŠ¡å™¨å‘é€åŒ…å«æ¶æ„ URL çš„ HTTP è¯·æ±‚ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œåˆ™ä¼šæ‰§è¡Œ URL ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**æ¥æº**: [CVE-2022-36804-notdls_CVE-2022-36804.md](../2022/CVE-2022-36804-notdls_CVE-2022-36804.md)

# CVE-2022-36804

> ğŸ“¦ è¯¥CVEæœ‰ **16** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰æœ‰æ•ˆçš„`BITBUCKETSESSIONID` cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ 

**æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§å¾ˆé«˜ã€‚æ¼æ´åº“ä¿¡æ¯è¡¨æ˜è¯¥æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ä¸”å­˜åœ¨ç›¸åº”çš„ä¿®å¤ç‰ˆæœ¬ã€‚æœç´¢ç»“æœä¹Ÿç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’ŒPoCã€‚æä¾›çš„PoCä»£ç ï¼ˆ`CVE-2022-36804-ReverseShell`ï¼‰æè¿°ä¸ºä¸€ä¸ªâ€œsomewhat reliable PoC exploitâ€ï¼Œè¡¨æ˜å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ç¨³å®šï¼Œä½†è¿™é€šå¸¸ä¸ç¯å¢ƒç›¸å…³ï¼Œä¸å½±å“æ¼æ´çš„æ•´ä½“æœ‰æ•ˆæ€§ã€‚PoCä¹Ÿè¯´æ˜æ”¯æŒå…¬æœ‰ä»“åº“ï¼Œå¹¶ä¸”å¯¹ç§æœ‰ä»“åº“å¯ä»¥ä½¿ç”¨session cookieï¼Œå¢åŠ äº†å…¶å¯ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©:**
PoCä»£ç ä¸­å­˜åœ¨ä¸€å®šæŠ•æ¯’é£é™©ï¼Œä½†å¯èƒ½æ€§è¾ƒä½ï¼ˆä¼°è®¡ä¸º10%ï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š
*   ä»£ç æ¥æºï¼šè¯¥ä»“åº“åŸºäº [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) è¿›è¡Œä¿®æ”¹ï¼Œç”±Chocapikkè¿›è¡Œmass exploitå’Œreverse shellåŠŸèƒ½çš„æ·»åŠ ã€‚è¿™æ„å‘³ç€å­˜åœ¨å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚
*   æ‰¹é‡åˆ©ç”¨ï¼šPoC åŒ…å«æ‰¹é‡æ‰«æå’Œåˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ä»£ç ä»¥å¤§è§„æ¨¡ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚
*   å‘½ä»¤æ‰§è¡Œï¼š PoC å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è™½ç„¶è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿä¸ºæ¤å…¥åé—¨æˆ–æ¶æ„ä»£ç æä¾›äº†é€”å¾„ã€‚
éœ€è¦ä»”ç»†å®¡æŸ¥ `main.py` æ–‡ä»¶ï¼Œç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
    *   æ˜¯å¦æœ‰é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°è¯•ä¸‹è½½æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬ã€‚
    *   reverse shellæ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ˜¯å¦è¿æ¥æœªçŸ¥çš„åœ°å€å’Œç«¯å£ã€‚
    *   å‚æ•°è§£æéƒ¨åˆ†ï¼Œæ˜¯å¦æœ‰éšè—çš„å‚æ•°å¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚
    *   æ‰¹é‡æ‰«æå’Œåˆ©ç”¨åŠŸèƒ½ï¼Œæ˜¯å¦å­˜åœ¨å°†ç»“æœå‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„é€»è¾‘ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **è‡ªåŠ¨/æ‰‹åŠ¨ æŸ¥æ‰¾ Repository:** PoC æä¾›äº†è‡ªåŠ¨æŸ¥æ‰¾å¯åˆ©ç”¨ Repository çš„åŠŸèƒ½ã€‚å¦‚æœè‡ªåŠ¨æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Repositoryã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  åˆ©ç”¨è„šæœ¬æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œç›®æ ‡ Bitbucket æœåŠ¡å™¨åœ¨å¤„ç†è¿™äº›å‚æ•°æ—¶ï¼Œä¼šç”±äºå‚æ•°æ³¨å…¥æ¼æ´æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚
3.  **æ‰§è¡Œå‘½ä»¤:** æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **åå¼¹shell:** å¯ä»¥ä½¿ç”¨ `--lhost` å’Œ `--lport` å‚æ•°å»ºç«‹åå‘ shellï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚
5. **ä¼šè¯ç»´æŒ:** å¯¹äºç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--session` å‚æ•°ï¼Œæä¾›æœ‰æ•ˆçš„ `BITBUCKETSESSIONID` cookieã€‚


**é¡¹ç›®åœ°å€:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**æ¥æº**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœï¼ˆç‰¹åˆ«æ˜¯Rapid7çš„åˆ†æå’ŒAssetNoteçš„ç ”ç©¶ï¼‰ä»¥åŠæä¾›çš„PoCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚PoC ä»£ç æä¾›äº†ä¸€ç§ç›¸å¯¹å¯é çš„åˆ©ç”¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¯ç”¨äº†å…¬å…±ä»“åº“çš„å®ä¾‹ã€‚å³ä½¿ç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookie è¿›è¡Œåˆ©ç”¨ã€‚

**æŠ•æ¯’é£é™©ï¼š**

PoCä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ³¨å…¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä»£ç ä¸­åŒ…å«è‡ªåŠ¨æ£€æµ‹ä»“åº“çš„åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç›®æ ‡ã€æ‰§è¡Œå‘½ä»¤ã€åå¼¹shellç­‰é€‰é¡¹ã€‚æ½œåœ¨çš„æŠ•æ¯’é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **æ¶æ„å‘½ä»¤é»˜è®¤å€¼ï¼š**  è™½ç„¶`--command`å‚æ•°é»˜è®¤ä¸º`whoami`ï¼Œä½†æ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹é»˜è®¤å€¼ï¼Œä½¿å…¶æ‰§è¡Œæ›´å…·ç ´åæ€§çš„æ“ä½œã€‚
2.  **åå¼¹ Shell åŠŸèƒ½ï¼š**  `--lhost` å’Œ `--lport` å‚æ•°ç”¨äºè®¾ç½®åå¼¹ shellï¼Œå¦‚æœæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·è¿è¡Œæ­¤ PoC å¹¶è¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½å¯¼è‡´å—å®³è€…ç³»ç»Ÿè¢«å®Œå…¨æ§åˆ¶ã€‚
3.  **æ‰¹é‡æ‰«æçš„æ½œåœ¨é£é™©ï¼š**  `--file` å‚æ•°å…è®¸æ‰¹é‡æ‰«æç›®æ ‡ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨æ­¤åŠŸèƒ½è¿›è¡Œå¤§è§„æ¨¡æ”»å‡»ï¼Œæˆ–è€…åœ¨æ‰«æè¿‡ç¨‹ä¸­æ¤å…¥æ¶æ„ä»£ç ã€‚
4. **ä»£ç é€»è¾‘ç¼ºé™·**: ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ½œåœ¨çš„é€»è¾‘ç¼ºé™·æˆ–æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œæ„å¤–çš„æ“ä½œã€‚

ç»¼åˆæ¥çœ‹ï¼Œè™½ç„¶PoCä»£ç ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å­˜åœ¨è¢«æ»¥ç”¨æˆ–ä¿®æ”¹ä»¥è¿›è¡Œæ¶æ„æ”»å‡»çš„é£é™©ã€‚åˆæ­¥åˆ¤æ–­å­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ Bitbucket Server/Data Center ç‰ˆæœ¬ï¼š** ç¡®è®¤ç›®æ ‡ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ï¼ˆ< 8.3.1ï¼‰ã€‚
2.  **è·å–ä»“åº“ä¿¡æ¯ï¼š** å¦‚æœå¯ç”¨äº†å…¬å…±ä»“åº“ï¼ŒPoCä»£ç å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¯åˆ©ç”¨çš„ä»“åº“ã€‚å¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œåˆ™éœ€è¦æœ‰æ•ˆçš„ 'BITBUCKETSESSIONID' cookieã€‚
3.  **æ„é€ æ¶æ„ HTTP è¯·æ±‚ï¼š**  PoCä»£ç ä¼šè‡ªåŠ¨æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œå‘é€åˆ°æ˜“å—æ”»å‡»çš„ API ç«¯ç‚¹ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š**  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€åå¼¹ shell ç­‰ã€‚
5. **åˆ©ç”¨å‚æ•°ä¼ é€’å‘½ä»¤**: é€šè¿‡ `--command` å‚æ•°æˆ– `--file` å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ¶æ„å‘½ä»¤,è¿›è¡Œæ¼æ´æ”»å‡».

**æ€»ç»“ï¼š**

CVE-2022-36804 æ˜¯ä¸€ä¸ªé«˜å±çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼ˆéœ€è¦è¯»å–æƒé™ï¼‰ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„PoCä»£ç ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨ Bitbucket Server/Data Center æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚éœ€è¦åŠæ—¶å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**æ¥æº**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ `git archive` å‘½ä»¤çš„ `--exec` å‚æ•°æ³¨å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ï¼Œæ”»å‡»è€…éœ€è¦åœ¨URLä¸­æ’å…¥ç»è¿‡ç¼–ç çš„æ¶æ„å‚æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `id` å‘½ä»¤æ¥éªŒè¯æ¼æ´ï¼Œæˆ–è€…ä½¿ç”¨ `cat /etc/passwd` å‘½ä»¤æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚é£é™©åœ¨äºPOCä¸­å¯èƒ½å­˜åœ¨éšè”½çš„ä¸‹è½½è„šæœ¬,æˆ–è€…åŒ…å«å…¶ä»–æ¶æ„è¿æ¥. å› æ­¤è¯„ä¼°æŠ•æ¯’é£é™©ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**æ¥æº**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œå…·æœ‰å…¬å¼€ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰ä»“åº“è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œå¤šä¸ªå®‰å…¨å›¢é˜Ÿå·²ç»å‘ç°äº†æ­¤æ¼æ´å¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææŠ¥å‘Šå’Œåˆ©ç”¨æ–¹å¼ã€‚æ¼æ´å­˜åœ¨äºå¤šä¸ªAPIç«¯ç‚¹ä¸­ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„gitå‘½ä»¤ï¼Œåˆ©ç”¨`--exec`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åªåŒ…å«äº†ä¸€ä¸ªApache License 2.0çš„è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥è¯„ä¼°æä¾›çš„POCä»£ç çš„æœ‰æ•ˆæ€§ã€‚

ç”±äºæä¾›çš„ä»£ç åªæ˜¯è®¸å¯è¯æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥åˆ¤å®šæ­¤ä»“åº“ä¸­ä¸å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£é™©ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©ä¸º0%ã€‚

æ¼æ´çš„åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™ï¼ˆå…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„gitå‘½ä»¤çš„HTTPè¯·æ±‚å‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œç”±äºæ²¡æœ‰å……åˆ†è¿‡æ»¤å’Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**æ¥æº**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 ç›´åˆ° 7.6.17, 7.7.0 ç›´åˆ° 7.17.10, 7.18.0 ç›´åˆ° 7.21.4, 8.0.0 ç›´åˆ° 8.0.3, 8.1.0 ç›´åˆ° 8.1.3, 8.2.0 ç›´åˆ° 8.2.2, 8.3.0 ç›´åˆ° 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œå…·æœ‰å…¬å…±ä»“åº“è®¿é—®æƒé™æˆ–ç§æœ‰Bitbucketä»“åº“è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æœç´¢å¼•æ“ç»“æœè¡¨æ˜è¯¥æ¼æ´åˆ©ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„PoCã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š`CVE-2022-36804-mass.py` å’Œ `README.md`ã€‚

*   `CVE-2022-36804-mass.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å°ä¸€ä¸ªåŒ…å«ä»˜æ¬¾é“¾æ¥çš„å­—ç¬¦ä¸²ï¼Œè¿™è¡¨æ˜å®ƒä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªè¯±é¥µæˆ–è¯ˆéª—ã€‚
*   `README.md` æ–‡ä»¶æè¿°äº†æ¼æ´ï¼Œå£°ç§°æä¾›äº†ä¸€ä¸ªPythonç¼–å†™çš„å¤šåŠŸèƒ½PoCï¼Œä½†å®é™…çš„PoCéœ€è¦é€šè¿‡æä¾›çš„ä»˜æ¬¾é“¾æ¥è·å–ï¼Œå¹¶ä¸”æåŠå­˜åœ¨åŒ…å«å¤§é‡æ˜“å—æ”»å‡»æœåŠ¡å™¨çš„åˆ—è¡¨ã€‚è¿™æ„å‘³ç€ä½œè€…æ„å›¾é€šè¿‡å‡ºå”®æˆ–ä»¥å…¶ä»–æ–¹å¼åˆ†å‘æ‰€è°“çš„PoCè·åˆ©ï¼Œè¿›ä¸€æ­¥æé«˜äº†æŠ•æ¯’é£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥ä»“åº“ä¸­çš„PoCå¾ˆå¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œæˆ–è€…è¯´æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„è¯±é¥µã€‚è¦æ±‚ä»˜æ¬¾çš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ï¼Œè¡¨æ˜ä½œè€…å¯èƒ½è¯•å›¾ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š** æ ¹æ®rapid7.com(webpage 1)å’Œassetnote.io(webpage 3)ä¸Šçš„æè¿°ï¼Œè¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `--exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…éœ€è¦å¯¹ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚æ¥è§¦å‘è¯¥æ¼æ´ã€‚

**æœ‰æ•ˆæ€§ï¼š** ä»æä¾›çš„æ–‡ä»¶æ¥çœ‹ï¼Œæä¾›çš„PoCä»£ç å¯èƒ½æ— æ•ˆæˆ–è€…åŒ…å«æ¶æ„å†…å®¹, éœ€è¦è¿›ä¸€æ­¥éªŒè¯æ‰èƒ½ç¡®è®¤å…¶çœŸå®åŠŸèƒ½ã€‚æ ¹æ®å…¶ä»–æœç´¢ç»“æœï¼Œæ¼æ´æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¶ä»–çš„å¯åˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©ï¼š** æé«˜ã€‚`CVE-2022-36804-mass.py`åªæ˜¯ä¸€ä¸ªè¯±é¥µï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®ä»˜æ¬¾é“¾æ¥ã€‚çœŸæ­£çš„æ”»å‡»ä»£ç å¯èƒ½éšè—åœ¨ä»˜æ¬¾åçš„ä¸‹è½½é“¾æ¥ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚`README.md` çš„å£°æ˜ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œä¹Ÿå¢åŠ äº†æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯¥ä»“åº“å­˜åœ¨æé«˜çš„æŠ•æ¯’é£é™©(95%)ã€‚

**é¡¹ç›®åœ°å€:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**æ¥æº**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´æè¿°ã€æœç´¢ç»“æœä»¥åŠæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤æ¼æ´æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ä¸»è¦åŒ…å«ä¸¤ä¸ªpayloadï¼Œç”¨äºè§¦å‘å‘½ä»¤æ³¨å…¥ã€‚
*   `payload` æ–‡ä»¶é€šè¿‡æ„é€ åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚çœ‹èµ·æ¥æ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚  
*   `payload2` æ–‡ä»¶åŒæ ·æ„é€ äº†åŒ…å« `--exec` å‚æ•°çš„HTTPè¯·æ±‚ï¼Œæ‰§è¡Œ `id` å‘½ä»¤ã€‚ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

ä»“åº“ä¸­çš„`README.md`åªæ˜¯åŒ…å«PoCçš„æ¼”ç¤ºå›¾ç‰‡ä»¥åŠä½œè€…çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚

ç»¼åˆè¯„ä¼°ï¼Œç”±äºPOCæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†éªŒè¯æ¼æ´ï¼Œå¹¶éä¸ºäº†ä¼ æ’­æ¶æ„ä»£ç ï¼Œä»“åº“ä¸­ä¸»è¦çš„æ–‡ä»¶æ˜¯ç”¨äºæ¼”ç¤ºå’Œè¯´æ˜æ¼æ´çš„ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œè¯„ä¼°ä¸º10%ã€‚æ­¤å¤„çš„é£é™©ä¸»è¦æ¥æºäºPOCå¯èƒ½è¢«ä»–äººä¿®æ”¹åä¼ æ’­ï¼Œä»è€Œæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­åˆ©ç”¨äº†gitå‘½ä»¤çš„ `--exec` å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­æ’å…¥åŒ…å« `--exec` å’Œæ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

1.  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚ç‰¹å®šçš„APIç«¯ç‚¹ï¼Œä¾‹å¦‚ `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`ã€‚
2.  åœ¨ `path` æˆ– `prefix` å‚æ•°ä¸­ï¼Œæ’å…¥ç±»ä¼¼ `%00--exec=<command>%00--remote=origin` çš„å­—ç¬¦ä¸²ã€‚
3.  å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡BitbucketæœåŠ¡å™¨ã€‚
4.  æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„å‘½ä»¤ã€‚

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**æ¥æº**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center è¿œç¨‹ä»£ç æ‰§è¡Œ

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±æˆ–ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API ç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´æè¿°å’Œæœç´¢å¼•æ“ç»“æœï¼ˆå°¤å…¶æ˜¯ `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`ï¼‰ï¼Œæ­¤æ¼æ´åˆ©ç”¨ PoC ä»£ç æœ‰æ•ˆã€‚æä¾›çš„ PoC ä»£ç åŒ…å«æ„å»ºæ˜“å—æ”»å‡»ç¯å¢ƒçš„ Dockerfile å’Œåˆ©ç”¨æ¼æ´çš„ Python è„šæœ¬ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ï¼Œç”¨äºéªŒè¯ RCE å¹¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œç”šè‡³å»ºç«‹åå‘ shellã€‚

**æŠ•æ¯’é£é™©:** åˆ†æ PoC ä»£ç ï¼Œç‰¹åˆ«æ˜¯ `cve-2022-36804.py` è„šæœ¬ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘é€æ¶æ„è¯·æ±‚ä»¥è§¦å‘å‘½ä»¤æ³¨å…¥ã€‚æŠ•æ¯’é£é™©è¾ƒä½ï¼Œçº¦ä¸º10%ã€‚æ½œåœ¨çš„é£é™©å¯èƒ½å­˜åœ¨äºè„šæœ¬ä¸­ä½¿ç”¨çš„ User-Agent å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚å¤´éƒ¨çš„å…¶ä»–å­—æ®µä¸­ï¼Œä½œè€…å¯èƒ½æš—ä¸­æœé›†ä½¿ç”¨è€…ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDockerfile ä¸‹è½½çš„ Bitbucket ç‰ˆæœ¬å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶,ä½†è¿™ä¸åœ¨æœ¬æ¬¡è¯„ä¼°èŒƒå›´å†…ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹ç›®æ ‡ Bitbucket ä»“åº“çš„è¯»å–æƒé™ï¼ˆå…¬å…±æˆ–ç§æœ‰ï¼‰ã€‚
2.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œè¯¥å‘½ä»¤ä¼šè¢«æ³¨å…¥åˆ° git å‘½ä»¤çš„ `--exec` å‚æ•°ä¸­ã€‚
3.  æœåŠ¡å™¨åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„æ¶æ„å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
4.  PoC ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚ `id`ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹åå‘ shellã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶ Bitbucket æœåŠ¡å™¨ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ï¼Œç¯¡æ”¹ä»£ç ï¼Œæˆ–è€…å°†æœåŠ¡å™¨ä½œä¸ºè·³æ¿æ”»å‡»å…¶ä»–å†…éƒ¨ç³»ç»Ÿã€‚

**é¡¹ç›®åœ°å€:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**æ¥æº**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–æ‹¥æœ‰æœ‰æ•ˆçš„session cookie

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ªAPIç«¯ç‚¹ä¸­çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å…¬å¼€æŠ«éœ²ï¼Œå¹¶ä¸”å­˜åœ¨å¯ç”¨çš„PoCä»£ç ã€‚Rapid7 å’Œ AssetNote çš„åˆ†æéƒ½è¡¨æ˜è¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ã€‚

æä¾›çš„PoCä»£ç ï¼ˆBenHays142/CVE-2022-36804-PoC-Exploitï¼‰çš„README.mdæ˜¾ç¤ºï¼Œè¯¥æ¼æ´éœ€è¦å¼€å¯å…¬å…±ä»“åº“ï¼Œæˆ–ä½¿ç”¨æœ‰æ•ˆçš„BITBUCKETSESSIONID cookieï¼ˆå¦‚æœç›®æ ‡ä»“åº“æ˜¯ç§æœ‰çš„ï¼‰ã€‚åˆ©ç”¨æ–¹å¼æ˜¯å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚åˆ°å—å½±å“çš„APIç«¯ç‚¹ã€‚

**æŠ•æ¯’é£é™©ï¼š**

ä»£ç ä¸­æ£€æµ‹åˆ°è‡ªåŠ¨æŸ¥æ‰¾repoçš„åŠŸèƒ½ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚è™½ç„¶è¿™äº›åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŠ•æ¯’é£é™©ï¼Œä¾‹å¦‚åœ¨è‡ªåŠ¨æŸ¥æ‰¾repoæ—¶ï¼Œå¦‚æœæ¶æ„ä¿®æ”¹äº†repoçš„å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿›ä¸€æ­¥åˆ†æ `main.py`ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥è„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1.  æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„repoï¼ˆ`detect_repo` å‡½æ•°ï¼‰ã€‚
2.  æ‰§è¡Œå‘½ä»¤ï¼ˆ`exec_stuff` å‡½æ•°ï¼‰ã€‚
3.  æ£€æŸ¥ç›®æ ‡æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆ`check_vuln` å‡½æ•°ï¼‰ã€‚

è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºï¼Œä½†æ˜¯ä½¿ç”¨æ­¤PoCä»ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹PoCä»£ç ä»¥åŒ…å«æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„ `--exec` å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡åœ¨URLä¸­åµŒå…¥ç‰¹æ®Šçš„payloadï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

`main.py` è„šæœ¬åˆ©ç”¨ `archive` APIï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šæ„é€ çš„ `prefix` å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

å…¶ä¸­ï¼Œ`{cmd}` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`%00` æ˜¯ NULL å­—èŠ‚ï¼Œç”¨äºæˆªæ–­å­—ç¬¦ä¸²ï¼Œä»è€Œä½¿ `--exec` å‚æ•°ç”Ÿæ•ˆã€‚æœåŠ¡å™¨åœ¨å¤„ç†æ­¤è¯·æ±‚æ—¶ï¼Œç”±äºæœªæ­£ç¡®è¿‡æ»¤æˆ–è½¬ä¹‰å‚æ•°ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚

**æ¼æ´å½±å“ï¼š**

æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨BitbucketæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å—æŸï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡ä¸­æ–­ç­‰ä¸¥é‡åæœã€‚

**é¡¹ç›®åœ°å€:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**æ¥æº**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è¯»å–æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ‹¥æœ‰å¯¹å…¬å…±æˆ–ç§æœ‰ Bitbucket ä»“åº“çš„è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚ Rapid7, AssetNote, Sangfor ç­‰ï¼‰éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œå¯åˆ©ç”¨æ€§ã€‚POCä»£ç ä¸­æä¾›çš„ `payload.txt` æ–‡ä»¶åŒ…å«åˆ©ç”¨å‚æ•° `--remote` å’Œ `--exec` è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„payloadã€‚`id` å‘½ä»¤å¯ä»¥ä½œä¸ºæµ‹è¯•æœ‰æ•ˆè½½è·ï¼Œç”¨äºéªŒè¯å‘½ä»¤æ‰§è¡Œã€‚Assetnoteçš„æ–‡ç« ä¹Ÿæåˆ°äº†é€šè¿‡ `--exec` å‚æ•°åˆ©ç”¨ git å‘½ä»¤è¿›è¡Œæ”»å‡»

**æŠ•æ¯’é£é™©ï¼š**
`README.md` æ–‡ä»¶çœ‹èµ·æ¥æ˜¯æ ‡å‡†çš„æ¼æ´æè¿°ã€‚`payload.txt` æ–‡ä»¶åŒ…å«æ˜æ˜¾çš„åˆ©ç”¨payloadã€‚ç†è®ºä¸Šï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹å…¶ä»–æ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åé—¨æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œä»…åŸºäºç›®å‰æä¾›çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®è®¤å­˜åœ¨æ¶æ„ä»£ç ã€‚è¯¥ä»“åº“åªæä¾›äº†PoCçš„payloadï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»æ¨¡å—ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡åœ¨10%å·¦å³ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦é›†ä¸­äºæ„é€ æ¶æ„çš„ `archive` è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç‰¹æ®Šçš„å‚æ•°ï¼Œåˆ©ç”¨äº† `git archive` å‘½ä»¤ä¸­çš„å‚æ•°æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `--remote` å’Œ `--exec` å‚æ•°æ³¨å…¥ä»»æ„å‘½ä»¤ã€‚å—å½±å“çš„ API ç«¯ç‚¹æ¥å—è¿™äº›å‚æ•°ï¼Œå¹¶æ²¡æœ‰æ­£ç¡®åœ°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚

æ”»å‡»è€…éœ€è¦åšçš„ï¼š
1.  ç¡®å®šç›®æ ‡ Bitbucket Server æˆ– Data Center çš„ç‰ˆæœ¬æ˜¯å¦åœ¨å—å½±å“çš„èŒƒå›´å†…ã€‚
2.  æ„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚ `archive?format=zip&path=bighax&prefix=vulnmachines/%00â€“remote=/%00â€“exec=%60id%60%00â€“prefix=/`ã€‚
3.  å‘é€è¯¥è¯·æ±‚åˆ°å—å½±å“çš„ API ç«¯ç‚¹ã€‚
4.  å¦‚æœæ¼æ´åˆ©ç”¨æˆåŠŸï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**æ¥æº**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€æˆ–ç§æœ‰Bitbucketä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨å…·æœ‰è¯»å–æƒé™çš„è´¦å·ï¼Œå‘å­˜åœ¨æ¼æ´çš„APIç«¯ç‚¹å‘é€æ¶æ„HTTPè¯·æ±‚ï¼Œé€šè¿‡`git archive`å‘½ä»¤çš„`--exec`å‚æ•°æ³¨å…¥æ¶æ„ä»£ç ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼åŒ…æ‹¬å‘é€ç‰¹åˆ¶çš„URLï¼Œå…¶ä¸­åŒ…å«ç»è¿‡URLç¼–ç çš„å‘½ä»¤ã€‚ä¾‹å¦‚`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`ï¼Œæ­¤POCä»£ç çš„ç›®çš„æ˜¯éªŒè¯æ¼æ´å­˜åœ¨ä»¥åŠæ‰§è¡Œå‘½ä»¤ï¼Œæœªå‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**æ¥æº**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucketå‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“æˆ–è€…ç§æœ‰ä»“åº“æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804æ˜¯Atlassian Bitbucket Serverå’ŒData Centerä¸­å¤šä¸ªAPIç«¯ç‚¹å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚å…·æœ‰å…¬å…±å­˜å‚¨åº“è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰Bitbucketå­˜å‚¨åº“å…·æœ‰è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„HTTPè¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼šåˆ©ç”¨git archiveå‘½ä»¤çš„`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚POCä»£ç ä¸­ï¼Œ`mexploit.py`è„šæœ¬é€šè¿‡æ„é€ ç‰¹å®šçš„URLï¼Œå°†æ¶æ„å‘½ä»¤æ³¨å…¥åˆ°`--exec`å‚æ•°ä¸­ï¼Œä»è€Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`README.md`æ–‡ä»¶ä»…åŒ…å«æ¼æ´æè¿°å’Œè„šæœ¬ä½¿ç”¨è¯´æ˜ï¼Œæœªå‘ç°æ¶æ„ä»£ç ã€‚åˆæ­¥åˆ¤æ–­æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä»éœ€è°¨æ…è¯„ä¼°è„šæœ¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠè„šæœ¬æ˜¯å¦å­˜åœ¨å…¶ä»–éšè—çš„æ¶æ„è¡Œä¸ºã€‚`walnutsecurity/cve-2022-36804`ç­‰ä»“åº“ä¹Ÿæä¾›äº†æ­¤æ¼æ´çš„POCï¼Œå¯ä½œä¸ºå‚è€ƒå¯¹æ¯”ã€‚

**é¡¹ç›®åœ°å€:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**æ¥æº**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ Bitbucket ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2022-36804 å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨å­˜åœ¨æ¼æ´çš„ Bitbucket Server å’Œ Data Center å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¤šä¸ª API ç«¯ç‚¹ä¸­å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´å¯¼è‡´çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ `git --exec` å‚æ•°æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„ POC ä»£ç å°è¯•åˆ©ç”¨è¯¥æ¼æ´ã€‚å®ƒé¦–å…ˆä½¿ç”¨ `httpx` æŸ¥æ‰¾å…¬å¼€çš„ Bitbucket ä»“åº“ï¼Œç„¶åæ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLï¼Œè¯¥å‚æ•°ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚`id` å‘½ä»¤è¢«ç”¨ä½œ PoCï¼Œç”¨äºéªŒè¯æ˜¯å¦æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è¯¥ä»“åº“çš„æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¤§çº¦ä¸º 10%ã€‚ ä»£ç é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å‘ç°Bitbucketä»“åº“å¹¶æ„é€ åˆ©ç”¨URLã€‚æŠ•æ¯’çš„é£é™©å¯èƒ½å­˜åœ¨äºä»¥ä¸‹æ–¹é¢ï¼š

1.  **ä¾èµ–åº“é£é™©:** è„šæœ¬ä¾èµ–äºå¤–éƒ¨åº“ï¼Œå¦‚ `requests` å’Œå‘½ä»¤è¡Œå·¥å…·å¦‚`httpx`, è¿™äº›ä¾èµ–é¡¹å¯èƒ½å­˜åœ¨æ½œåœ¨çš„ä¾›åº”é“¾å®‰å…¨é£é™©ï¼Œè™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†éœ€è¦è€ƒè™‘ã€‚
2.  **å‘½ä»¤æ‰§è¡Œé£é™©:** è„šæœ¬ä½¿ç”¨äº† `os.system` æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶ç”¨äºè°ƒç”¨ `httpx`ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ targets æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å‘½ä»¤æ³¨å…¥é£é™©ã€‚è¿™éƒ¨åˆ†çš„é£é™©è¾ƒä½ï¼Œå–å†³äº `targets` æ–‡ä»¶çš„å¯æ§ç¨‹åº¦ã€‚
3.  **URL æ„é€ é£é™©:** è„šæœ¬æ„é€  URL çš„é€»è¾‘å­˜åœ¨ä¸€å®šçš„å¤æ‚æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å¯¹ URL çš„å¤„ç†æ–¹å¼ä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‘½ä»¤æ‰§è¡Œæˆ–å…¶ä»–å®‰å…¨é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æŸ¥æ‰¾å…¬å¼€ä»“åº“ï¼š** æ”»å‡»è€…é¦–å…ˆéœ€è¦æ‰¾åˆ°å…¬å¼€å¯è®¿é—®çš„ Bitbucket ä»“åº“æˆ–å…·æœ‰è¯»å–æƒé™çš„ç§æœ‰ä»“åº“ã€‚
2.  **æ„é€ æ¶æ„ URLï¼š** æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ URLã€‚è¯¥ URL çš„æ ¼å¼å¦‚ä¸‹ï¼š
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    å…¶ä¸­ï¼Œ`<command>` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
3.  **å‘é€ HTTP è¯·æ±‚ï¼š** æ”»å‡»è€…å‘ Bitbucket æœåŠ¡å™¨å‘é€åŒ…å«æ¶æ„ URL çš„ HTTP è¯·æ±‚ã€‚
4.  **æ‰§è¡Œä»»æ„ä»£ç ï¼š** å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œåˆ™ä¼šæ‰§è¡Œ URL ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**æ¥æº**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œæ”»å‡»è€…éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚æœç´¢å¼•æ“ç»“æœè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œ PoC ä»£ç çš„ GitHub é“¾æ¥ã€‚æä¾›çš„ PoC ä»£ç  `CVE-2022-36804.py` åŒ…å«ç”¨äºæ£€æŸ¥æ¼æ´ã€æ‰§è¡Œ SSRF å’Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•° `--remote` å’Œ `--exec` æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯å‘å—å½±å“çš„ Bitbucket å®ä¾‹å‘é€åŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ç‰¹åˆ¶ HTTP è¯·æ±‚ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº†æ¼æ´æè¿°ä¸­æåˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç ä¸»è¦ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œä½†ä¹Ÿå­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚PoC åˆ©ç”¨äº†`--exec` å‚æ•°ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `PAYLOAD` å˜é‡ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»£ç ä¸­åŒ…å«äº†ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚ User-Agent è®¾ç½®å’Œ SSL è¯ä¹¦éªŒè¯ç¦ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ¶æ„ä¾èµ–ï¼š**  PoC è„šæœ¬ä¾èµ–äºå¤šä¸ª Python åº“ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¯¡æ”¹è¿™äº›åº“æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   **åé—¨æ¤å…¥ï¼š**  æ”»å‡»è€…å¯èƒ½åœ¨ PoC è„šæœ¬ä¸­æ·»åŠ åé—¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡ŒæŒä¹…åŒ–æ”»å‡»ã€‚
*   **ä¿¡æ¯æ³„éœ²ï¼š**  PoC è„šæœ¬å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰ã€‚

ç”±äºè„šæœ¬ä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ‰€ä»¥æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ï¼Œé¢„ä¼°ä¸º 10%ã€‚è¯¥æ¯”ä¾‹åŸºäºä»£ç çš„å¤æ‚æ€§å’Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œæ¶æ„ä¿®æ”¹çš„ç¨‹åº¦è¯„ä¼°å¾—å‡ºã€‚ä¸»è¦æ˜¯å› ä¸ºä»£ç æœ‰è¿œç¨‹è¿æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå¯èƒ½å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `check` åŠŸèƒ½ï¼Œé€šè¿‡å‘é€åŒ…å« `%00--help%00--%00` çš„æ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥ç›®æ ‡ Bitbucket å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
2.  **SSRFï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `ssrf` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--remote` å‚æ•°ï¼Œä½¿ç›®æ ‡ Bitbucket å®ä¾‹å‘æŒ‡å®šçš„ DNS åŸŸåå‘èµ·è¯·æ±‚ï¼ŒéªŒè¯ SSRF æ¼æ´ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `rce` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--exec` å‚æ•°ï¼Œåœ¨ç›®æ ‡ Bitbucket å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚PoC ä»£ç æ”¯æŒä½¿ç”¨ `reverse_shell` åŠŸèƒ½ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨åå‘ shellã€‚
4.  **æ–‡ä»¶ä¸‹è½½:** å¯ä»¥æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ï¼Œå°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚

åˆ©ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bitbucket å®ä¾‹å¯èƒ½å­˜åœ¨å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œå› æ­¤æ”»å‡»è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ PoC ä»£ç ï¼Œä¾‹å¦‚ç»•è¿‡ WAFã€èº«ä»½éªŒè¯ç­‰ã€‚


**é¡¹ç›®åœ°å€:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #14

**æ¥æº**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å­˜åœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ å…·æœ‰è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨ Git çš„ `--exec` å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚PoC ä»£ç é¦–å…ˆè·å– Bitbucket å®ä¾‹ä¸­çš„æ‰€æœ‰é¡¹ç›®å’Œä»“åº“ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªä»“åº“ï¼Œæ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ URL å‘é€è¯·æ±‚ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼ŒPoC é€šè¿‡æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å« `/etc/passwd` çš„å†…å®¹æ¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœªå‘ç°ä½œè€…æ¤å…¥æ¶æ„ä»£ç çš„å«Œç–‘ã€‚

**é¡¹ç›®åœ°å€:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**æ¥æº**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åªéœ€å…·å¤‡å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™å³å¯ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ï¼š** æ”»å‡»è€…éœ€è¦ç¡®å®šå­˜åœ¨æ¼æ´çš„ Bitbucket Server æˆ– Data Center å®ä¾‹ã€‚
2.  **è·å–é¡¹ç›®ä¿¡æ¯ï¼š** åˆ©ç”¨`/repos?visibility=public`æ¥å£è·å–å¯è®¿é—®çš„å…¬å…±é¡¹ç›®å’Œä»“åº“ä¿¡æ¯ã€‚
3.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š**  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚Payload ä½äºURLä¸­, ä½¿ç”¨`%60`è¿›è¡Œè½¬ä¹‰ã€‚
4.  **å‘é€è¯·æ±‚ï¼š** å°†æ„é€ çš„æ¶æ„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Bitbucket æœåŠ¡å™¨ã€‚
5.  **æ‰§è¡Œä»£ç ï¼š**  å¦‚æœæ¼æ´å­˜åœ¨ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„POCä»£ç å°è¯•è‡ªåŠ¨åŒ–ä¸Šè¿°æ­¥éª¤ã€‚å®ƒä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡URLï¼Œç„¶åå°è¯•åˆ©ç”¨æ¼æ´ã€‚POCä»£ç é¦–å…ˆå°è¯•ä»å…¬å…±ä»“åº“è¯»å–ä¿¡æ¯ï¼Œä»¥ç¡®å®šé¡¹ç›®å’Œä»“åº“çš„åç§°ï¼Œå¹¶æ„å»ºåˆ©ç”¨URLã€‚ç„¶åï¼Œå®ƒå‘ç›®æ ‡å‘é€å¸¦æœ‰æ³¨å…¥å‘½ä»¤çš„è¯·æ±‚ï¼Œå¹¶æ‰“å°å“åº”ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

åœ¨æ‰€æä¾›çš„POCä»£ç ä¸­ï¼Œè™½ç„¶ä½œè€…è¯•å›¾é€šè¿‡æ‰§è¡Œä»»æ„å‘½ä»¤æ¥å®ç°RCEï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä¾‹å¦‚ï¼Œä»£ç æ²¡æœ‰å°è¯•ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€å®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆ–è€…æœªç»æˆæƒè®¿é—®å…¶ä»–èµ„æºã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè™½ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†å¯ä»¥å°†æŠ•æ¯’é£é™©å®šä¹‰ä¸ºè¾ƒä½çš„æ¦‚ç‡ï¼Œå®šä¹‰ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**æ¥æº**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **æ¼æ´åŸç†ï¼š**  ç”±äºBitbucket Serverå’ŒData Centeråœ¨å¤„ç†ç‰¹å®šAPIè¯·æ±‚æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„è¾“å…¥è¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚
2.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ã€‚
    *   æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIæ¥å£ã€‚
    *   æœåŠ¡å™¨åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºè¾“å…¥æœªç»è¿‡æ»¤ï¼Œå°†æ¶æ„å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç é€šè¿‡dockerç¯å¢ƒæ­å»ºäº†å­˜åœ¨æ¼æ´çš„Bitbucket Serverï¼Œå¹¶æä¾›äº†Pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡HTTPè¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œè¯æ˜è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ‰æ•ˆã€‚
4.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯éªŒè¯å’Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶æœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ ä½†æ˜¯å› ä¸ºæ­¤æ¼æ´æ˜¯RCEç±»å‹æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ³¨å…¥çš„æ–¹å¼æ¤å…¥åé—¨ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
*Dockerfile* ç”¨äºæ­å»ºæ¼æ´ç¯å¢ƒï¼Œè„šæœ¬ç”¨äºæµ‹è¯•æ¼æ´æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®æŠ•æ¯’é£é™©è¾ƒä½.

  **æœç´¢å¼•æ“ç»“æœä½è¯ï¼š**  å¤šä¸ªæœç´¢ç»“æœ(Rapid7, AssetNote, Sangforç­‰)éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---



---

## POC #14

**æ¥æº**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œæ”»å‡»è€…éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚æœç´¢å¼•æ“ç»“æœè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œ PoC ä»£ç çš„ GitHub é“¾æ¥ã€‚æä¾›çš„ PoC ä»£ç  `CVE-2022-36804.py` åŒ…å«ç”¨äºæ£€æŸ¥æ¼æ´ã€æ‰§è¡Œ SSRF å’Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•° `--remote` å’Œ `--exec` æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯å‘å—å½±å“çš„ Bitbucket å®ä¾‹å‘é€åŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ç‰¹åˆ¶ HTTP è¯·æ±‚ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº†æ¼æ´æè¿°ä¸­æåˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç ä¸»è¦ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œä½†ä¹Ÿå­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚PoC åˆ©ç”¨äº†`--exec` å‚æ•°ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `PAYLOAD` å˜é‡ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»£ç ä¸­åŒ…å«äº†ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚ User-Agent è®¾ç½®å’Œ SSL è¯ä¹¦éªŒè¯ç¦ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ¶æ„ä¾èµ–ï¼š**  PoC è„šæœ¬ä¾èµ–äºå¤šä¸ª Python åº“ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¯¡æ”¹è¿™äº›åº“æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   **åé—¨æ¤å…¥ï¼š**  æ”»å‡»è€…å¯èƒ½åœ¨ PoC è„šæœ¬ä¸­æ·»åŠ åé—¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡ŒæŒä¹…åŒ–æ”»å‡»ã€‚
*   **ä¿¡æ¯æ³„éœ²ï¼š**  PoC è„šæœ¬å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰ã€‚

ç”±äºè„šæœ¬ä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ‰€ä»¥æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ï¼Œé¢„ä¼°ä¸º 10%ã€‚è¯¥æ¯”ä¾‹åŸºäºä»£ç çš„å¤æ‚æ€§å’Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œæ¶æ„ä¿®æ”¹çš„ç¨‹åº¦è¯„ä¼°å¾—å‡ºã€‚ä¸»è¦æ˜¯å› ä¸ºä»£ç æœ‰è¿œç¨‹è¿æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå¯èƒ½å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `check` åŠŸèƒ½ï¼Œé€šè¿‡å‘é€åŒ…å« `%00--help%00--%00` çš„æ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥ç›®æ ‡ Bitbucket å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
2.  **SSRFï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `ssrf` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--remote` å‚æ•°ï¼Œä½¿ç›®æ ‡ Bitbucket å®ä¾‹å‘æŒ‡å®šçš„ DNS åŸŸåå‘èµ·è¯·æ±‚ï¼ŒéªŒè¯ SSRF æ¼æ´ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `rce` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--exec` å‚æ•°ï¼Œåœ¨ç›®æ ‡ Bitbucket å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚PoC ä»£ç æ”¯æŒä½¿ç”¨ `reverse_shell` åŠŸèƒ½ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨åå‘ shellã€‚
4.  **æ–‡ä»¶ä¸‹è½½:** å¯ä»¥æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ï¼Œå°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚

åˆ©ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bitbucket å®ä¾‹å¯èƒ½å­˜åœ¨å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œå› æ­¤æ”»å‡»è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ PoC ä»£ç ï¼Œä¾‹å¦‚ç»•è¿‡ WAFã€èº«ä»½éªŒè¯ç­‰ã€‚


**é¡¹ç›®åœ°å€:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**æ¥æº**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å­˜åœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ å…·æœ‰è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨ Git çš„ `--exec` å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚PoC ä»£ç é¦–å…ˆè·å– Bitbucket å®ä¾‹ä¸­çš„æ‰€æœ‰é¡¹ç›®å’Œä»“åº“ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªä»“åº“ï¼Œæ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ URL å‘é€è¯·æ±‚ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼ŒPoC é€šè¿‡æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å« `/etc/passwd` çš„å†…å®¹æ¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœªå‘ç°ä½œè€…æ¤å…¥æ¶æ„ä»£ç çš„å«Œç–‘ã€‚

**é¡¹ç›®åœ°å€:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**æ¥æº**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åªéœ€å…·å¤‡å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™å³å¯ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ï¼š** æ”»å‡»è€…éœ€è¦ç¡®å®šå­˜åœ¨æ¼æ´çš„ Bitbucket Server æˆ– Data Center å®ä¾‹ã€‚
2.  **è·å–é¡¹ç›®ä¿¡æ¯ï¼š** åˆ©ç”¨`/repos?visibility=public`æ¥å£è·å–å¯è®¿é—®çš„å…¬å…±é¡¹ç›®å’Œä»“åº“ä¿¡æ¯ã€‚
3.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š**  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚Payload ä½äºURLä¸­, ä½¿ç”¨`%60`è¿›è¡Œè½¬ä¹‰ã€‚
4.  **å‘é€è¯·æ±‚ï¼š** å°†æ„é€ çš„æ¶æ„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Bitbucket æœåŠ¡å™¨ã€‚
5.  **æ‰§è¡Œä»£ç ï¼š**  å¦‚æœæ¼æ´å­˜åœ¨ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„POCä»£ç å°è¯•è‡ªåŠ¨åŒ–ä¸Šè¿°æ­¥éª¤ã€‚å®ƒä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡URLï¼Œç„¶åå°è¯•åˆ©ç”¨æ¼æ´ã€‚POCä»£ç é¦–å…ˆå°è¯•ä»å…¬å…±ä»“åº“è¯»å–ä¿¡æ¯ï¼Œä»¥ç¡®å®šé¡¹ç›®å’Œä»“åº“çš„åç§°ï¼Œå¹¶æ„å»ºåˆ©ç”¨URLã€‚ç„¶åï¼Œå®ƒå‘ç›®æ ‡å‘é€å¸¦æœ‰æ³¨å…¥å‘½ä»¤çš„è¯·æ±‚ï¼Œå¹¶æ‰“å°å“åº”ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

åœ¨æ‰€æä¾›çš„POCä»£ç ä¸­ï¼Œè™½ç„¶ä½œè€…è¯•å›¾é€šè¿‡æ‰§è¡Œä»»æ„å‘½ä»¤æ¥å®ç°RCEï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä¾‹å¦‚ï¼Œä»£ç æ²¡æœ‰å°è¯•ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€å®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆ–è€…æœªç»æˆæƒè®¿é—®å…¶ä»–èµ„æºã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè™½ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†å¯ä»¥å°†æŠ•æ¯’é£é™©å®šä¹‰ä¸ºè¾ƒä½çš„æ¦‚ç‡ï¼Œå®šä¹‰ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #17

**æ¥æº**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **æ¼æ´åŸç†ï¼š**  ç”±äºBitbucket Serverå’ŒData Centeråœ¨å¤„ç†ç‰¹å®šAPIè¯·æ±‚æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„è¾“å…¥è¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚
2.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ã€‚
    *   æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIæ¥å£ã€‚
    *   æœåŠ¡å™¨åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºè¾“å…¥æœªç»è¿‡æ»¤ï¼Œå°†æ¶æ„å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç é€šè¿‡dockerç¯å¢ƒæ­å»ºäº†å­˜åœ¨æ¼æ´çš„Bitbucket Serverï¼Œå¹¶æä¾›äº†Pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡HTTPè¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œè¯æ˜è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ‰æ•ˆã€‚
4.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯éªŒè¯å’Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶æœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ ä½†æ˜¯å› ä¸ºæ­¤æ¼æ´æ˜¯RCEç±»å‹æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ³¨å…¥çš„æ–¹å¼æ¤å…¥åé—¨ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
*Dockerfile* ç”¨äºæ­å»ºæ¼æ´ç¯å¢ƒï¼Œè„šæœ¬ç”¨äºæµ‹è¯•æ¼æ´æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®æŠ•æ¯’é£é™©è¾ƒä½.

  **æœç´¢å¼•æ“ç»“æœä½è¯ï¼š**  å¤šä¸ªæœç´¢ç»“æœ(Rapid7, AssetNote, Sangforç­‰)éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---



---

## POC #14

**æ¥æº**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œæ”»å‡»è€…éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚æœç´¢å¼•æ“ç»“æœè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œ PoC ä»£ç çš„ GitHub é“¾æ¥ã€‚æä¾›çš„ PoC ä»£ç  `CVE-2022-36804.py` åŒ…å«ç”¨äºæ£€æŸ¥æ¼æ´ã€æ‰§è¡Œ SSRF å’Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•° `--remote` å’Œ `--exec` æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯å‘å—å½±å“çš„ Bitbucket å®ä¾‹å‘é€åŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ç‰¹åˆ¶ HTTP è¯·æ±‚ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº†æ¼æ´æè¿°ä¸­æåˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç ä¸»è¦ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œä½†ä¹Ÿå­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚PoC åˆ©ç”¨äº†`--exec` å‚æ•°ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `PAYLOAD` å˜é‡ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»£ç ä¸­åŒ…å«äº†ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚ User-Agent è®¾ç½®å’Œ SSL è¯ä¹¦éªŒè¯ç¦ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ¶æ„ä¾èµ–ï¼š**  PoC è„šæœ¬ä¾èµ–äºå¤šä¸ª Python åº“ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¯¡æ”¹è¿™äº›åº“æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   **åé—¨æ¤å…¥ï¼š**  æ”»å‡»è€…å¯èƒ½åœ¨ PoC è„šæœ¬ä¸­æ·»åŠ åé—¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡ŒæŒä¹…åŒ–æ”»å‡»ã€‚
*   **ä¿¡æ¯æ³„éœ²ï¼š**  PoC è„šæœ¬å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰ã€‚

ç”±äºè„šæœ¬ä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ‰€ä»¥æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ï¼Œé¢„ä¼°ä¸º 10%ã€‚è¯¥æ¯”ä¾‹åŸºäºä»£ç çš„å¤æ‚æ€§å’Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œæ¶æ„ä¿®æ”¹çš„ç¨‹åº¦è¯„ä¼°å¾—å‡ºã€‚ä¸»è¦æ˜¯å› ä¸ºä»£ç æœ‰è¿œç¨‹è¿æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå¯èƒ½å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `check` åŠŸèƒ½ï¼Œé€šè¿‡å‘é€åŒ…å« `%00--help%00--%00` çš„æ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥ç›®æ ‡ Bitbucket å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
2.  **SSRFï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `ssrf` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--remote` å‚æ•°ï¼Œä½¿ç›®æ ‡ Bitbucket å®ä¾‹å‘æŒ‡å®šçš„ DNS åŸŸåå‘èµ·è¯·æ±‚ï¼ŒéªŒè¯ SSRF æ¼æ´ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `rce` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--exec` å‚æ•°ï¼Œåœ¨ç›®æ ‡ Bitbucket å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚PoC ä»£ç æ”¯æŒä½¿ç”¨ `reverse_shell` åŠŸèƒ½ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨åå‘ shellã€‚
4.  **æ–‡ä»¶ä¸‹è½½:** å¯ä»¥æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ï¼Œå°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚

åˆ©ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bitbucket å®ä¾‹å¯èƒ½å­˜åœ¨å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œå› æ­¤æ”»å‡»è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ PoC ä»£ç ï¼Œä¾‹å¦‚ç»•è¿‡ WAFã€èº«ä»½éªŒè¯ç­‰ã€‚


**é¡¹ç›®åœ°å€:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**æ¥æº**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å­˜åœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ å…·æœ‰è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨ Git çš„ `--exec` å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚PoC ä»£ç é¦–å…ˆè·å– Bitbucket å®ä¾‹ä¸­çš„æ‰€æœ‰é¡¹ç›®å’Œä»“åº“ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªä»“åº“ï¼Œæ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ URL å‘é€è¯·æ±‚ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼ŒPoC é€šè¿‡æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å« `/etc/passwd` çš„å†…å®¹æ¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœªå‘ç°ä½œè€…æ¤å…¥æ¶æ„ä»£ç çš„å«Œç–‘ã€‚

**é¡¹ç›®åœ°å€:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**æ¥æº**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åªéœ€å…·å¤‡å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™å³å¯ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ï¼š** æ”»å‡»è€…éœ€è¦ç¡®å®šå­˜åœ¨æ¼æ´çš„ Bitbucket Server æˆ– Data Center å®ä¾‹ã€‚
2.  **è·å–é¡¹ç›®ä¿¡æ¯ï¼š** åˆ©ç”¨`/repos?visibility=public`æ¥å£è·å–å¯è®¿é—®çš„å…¬å…±é¡¹ç›®å’Œä»“åº“ä¿¡æ¯ã€‚
3.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š**  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚Payload ä½äºURLä¸­, ä½¿ç”¨`%60`è¿›è¡Œè½¬ä¹‰ã€‚
4.  **å‘é€è¯·æ±‚ï¼š** å°†æ„é€ çš„æ¶æ„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Bitbucket æœåŠ¡å™¨ã€‚
5.  **æ‰§è¡Œä»£ç ï¼š**  å¦‚æœæ¼æ´å­˜åœ¨ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„POCä»£ç å°è¯•è‡ªåŠ¨åŒ–ä¸Šè¿°æ­¥éª¤ã€‚å®ƒä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡URLï¼Œç„¶åå°è¯•åˆ©ç”¨æ¼æ´ã€‚POCä»£ç é¦–å…ˆå°è¯•ä»å…¬å…±ä»“åº“è¯»å–ä¿¡æ¯ï¼Œä»¥ç¡®å®šé¡¹ç›®å’Œä»“åº“çš„åç§°ï¼Œå¹¶æ„å»ºåˆ©ç”¨URLã€‚ç„¶åï¼Œå®ƒå‘ç›®æ ‡å‘é€å¸¦æœ‰æ³¨å…¥å‘½ä»¤çš„è¯·æ±‚ï¼Œå¹¶æ‰“å°å“åº”ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

åœ¨æ‰€æä¾›çš„POCä»£ç ä¸­ï¼Œè™½ç„¶ä½œè€…è¯•å›¾é€šè¿‡æ‰§è¡Œä»»æ„å‘½ä»¤æ¥å®ç°RCEï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä¾‹å¦‚ï¼Œä»£ç æ²¡æœ‰å°è¯•ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€å®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆ–è€…æœªç»æˆæƒè®¿é—®å…¶ä»–èµ„æºã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè™½ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†å¯ä»¥å°†æŠ•æ¯’é£é™©å®šä¹‰ä¸ºè¾ƒä½çš„æ¦‚ç‡ï¼Œå®šä¹‰ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #17

**æ¥æº**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **æ¼æ´åŸç†ï¼š**  ç”±äºBitbucket Serverå’ŒData Centeråœ¨å¤„ç†ç‰¹å®šAPIè¯·æ±‚æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„è¾“å…¥è¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚
2.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ã€‚
    *   æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIæ¥å£ã€‚
    *   æœåŠ¡å™¨åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºè¾“å…¥æœªç»è¿‡æ»¤ï¼Œå°†æ¶æ„å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç é€šè¿‡dockerç¯å¢ƒæ­å»ºäº†å­˜åœ¨æ¼æ´çš„Bitbucket Serverï¼Œå¹¶æä¾›äº†Pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡HTTPè¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œè¯æ˜è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ‰æ•ˆã€‚
4.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯éªŒè¯å’Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶æœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ ä½†æ˜¯å› ä¸ºæ­¤æ¼æ´æ˜¯RCEç±»å‹æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ³¨å…¥çš„æ–¹å¼æ¤å…¥åé—¨ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
*Dockerfile* ç”¨äºæ­å»ºæ¼æ´ç¯å¢ƒï¼Œè„šæœ¬ç”¨äºæµ‹è¯•æ¼æ´æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®æŠ•æ¯’é£é™©è¾ƒä½.

  **æœç´¢å¼•æ“ç»“æœä½è¯ï¼š**  å¤šä¸ªæœç´¢ç»“æœ(Rapid7, AssetNote, Sangforç­‰)éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---



---

## POC #14

**æ¥æº**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œæ”»å‡»è€…éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚æœç´¢å¼•æ“ç»“æœè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œ PoC ä»£ç çš„ GitHub é“¾æ¥ã€‚æä¾›çš„ PoC ä»£ç  `CVE-2022-36804.py` åŒ…å«ç”¨äºæ£€æŸ¥æ¼æ´ã€æ‰§è¡Œ SSRF å’Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•° `--remote` å’Œ `--exec` æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯å‘å—å½±å“çš„ Bitbucket å®ä¾‹å‘é€åŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ç‰¹åˆ¶ HTTP è¯·æ±‚ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº†æ¼æ´æè¿°ä¸­æåˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç ä¸»è¦ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œä½†ä¹Ÿå­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚PoC åˆ©ç”¨äº†`--exec` å‚æ•°ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `PAYLOAD` å˜é‡ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»£ç ä¸­åŒ…å«äº†ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚ User-Agent è®¾ç½®å’Œ SSL è¯ä¹¦éªŒè¯ç¦ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ¶æ„ä¾èµ–ï¼š**  PoC è„šæœ¬ä¾èµ–äºå¤šä¸ª Python åº“ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¯¡æ”¹è¿™äº›åº“æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   **åé—¨æ¤å…¥ï¼š**  æ”»å‡»è€…å¯èƒ½åœ¨ PoC è„šæœ¬ä¸­æ·»åŠ åé—¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡ŒæŒä¹…åŒ–æ”»å‡»ã€‚
*   **ä¿¡æ¯æ³„éœ²ï¼š**  PoC è„šæœ¬å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰ã€‚

ç”±äºè„šæœ¬ä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ‰€ä»¥æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ï¼Œé¢„ä¼°ä¸º 10%ã€‚è¯¥æ¯”ä¾‹åŸºäºä»£ç çš„å¤æ‚æ€§å’Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œæ¶æ„ä¿®æ”¹çš„ç¨‹åº¦è¯„ä¼°å¾—å‡ºã€‚ä¸»è¦æ˜¯å› ä¸ºä»£ç æœ‰è¿œç¨‹è¿æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå¯èƒ½å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `check` åŠŸèƒ½ï¼Œé€šè¿‡å‘é€åŒ…å« `%00--help%00--%00` çš„æ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥ç›®æ ‡ Bitbucket å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
2.  **SSRFï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `ssrf` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--remote` å‚æ•°ï¼Œä½¿ç›®æ ‡ Bitbucket å®ä¾‹å‘æŒ‡å®šçš„ DNS åŸŸåå‘èµ·è¯·æ±‚ï¼ŒéªŒè¯ SSRF æ¼æ´ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `rce` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--exec` å‚æ•°ï¼Œåœ¨ç›®æ ‡ Bitbucket å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚PoC ä»£ç æ”¯æŒä½¿ç”¨ `reverse_shell` åŠŸèƒ½ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨åå‘ shellã€‚
4.  **æ–‡ä»¶ä¸‹è½½:** å¯ä»¥æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ï¼Œå°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚

åˆ©ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bitbucket å®ä¾‹å¯èƒ½å­˜åœ¨å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œå› æ­¤æ”»å‡»è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ PoC ä»£ç ï¼Œä¾‹å¦‚ç»•è¿‡ WAFã€èº«ä»½éªŒè¯ç­‰ã€‚


**é¡¹ç›®åœ°å€:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**æ¥æº**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å­˜åœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ å…·æœ‰è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨ Git çš„ `--exec` å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚PoC ä»£ç é¦–å…ˆè·å– Bitbucket å®ä¾‹ä¸­çš„æ‰€æœ‰é¡¹ç›®å’Œä»“åº“ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªä»“åº“ï¼Œæ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ URL å‘é€è¯·æ±‚ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼ŒPoC é€šè¿‡æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å« `/etc/passwd` çš„å†…å®¹æ¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœªå‘ç°ä½œè€…æ¤å…¥æ¶æ„ä»£ç çš„å«Œç–‘ã€‚

**é¡¹ç›®åœ°å€:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**æ¥æº**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åªéœ€å…·å¤‡å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™å³å¯ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ï¼š** æ”»å‡»è€…éœ€è¦ç¡®å®šå­˜åœ¨æ¼æ´çš„ Bitbucket Server æˆ– Data Center å®ä¾‹ã€‚
2.  **è·å–é¡¹ç›®ä¿¡æ¯ï¼š** åˆ©ç”¨`/repos?visibility=public`æ¥å£è·å–å¯è®¿é—®çš„å…¬å…±é¡¹ç›®å’Œä»“åº“ä¿¡æ¯ã€‚
3.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š**  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚Payload ä½äºURLä¸­, ä½¿ç”¨`%60`è¿›è¡Œè½¬ä¹‰ã€‚
4.  **å‘é€è¯·æ±‚ï¼š** å°†æ„é€ çš„æ¶æ„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Bitbucket æœåŠ¡å™¨ã€‚
5.  **æ‰§è¡Œä»£ç ï¼š**  å¦‚æœæ¼æ´å­˜åœ¨ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„POCä»£ç å°è¯•è‡ªåŠ¨åŒ–ä¸Šè¿°æ­¥éª¤ã€‚å®ƒä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡URLï¼Œç„¶åå°è¯•åˆ©ç”¨æ¼æ´ã€‚POCä»£ç é¦–å…ˆå°è¯•ä»å…¬å…±ä»“åº“è¯»å–ä¿¡æ¯ï¼Œä»¥ç¡®å®šé¡¹ç›®å’Œä»“åº“çš„åç§°ï¼Œå¹¶æ„å»ºåˆ©ç”¨URLã€‚ç„¶åï¼Œå®ƒå‘ç›®æ ‡å‘é€å¸¦æœ‰æ³¨å…¥å‘½ä»¤çš„è¯·æ±‚ï¼Œå¹¶æ‰“å°å“åº”ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

åœ¨æ‰€æä¾›çš„POCä»£ç ä¸­ï¼Œè™½ç„¶ä½œè€…è¯•å›¾é€šè¿‡æ‰§è¡Œä»»æ„å‘½ä»¤æ¥å®ç°RCEï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä¾‹å¦‚ï¼Œä»£ç æ²¡æœ‰å°è¯•ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€å®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆ–è€…æœªç»æˆæƒè®¿é—®å…¶ä»–èµ„æºã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè™½ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†å¯ä»¥å°†æŠ•æ¯’é£é™©å®šä¹‰ä¸ºè¾ƒä½çš„æ¦‚ç‡ï¼Œå®šä¹‰ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #17

**æ¥æº**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **æ¼æ´åŸç†ï¼š**  ç”±äºBitbucket Serverå’ŒData Centeråœ¨å¤„ç†ç‰¹å®šAPIè¯·æ±‚æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„è¾“å…¥è¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚
2.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ã€‚
    *   æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIæ¥å£ã€‚
    *   æœåŠ¡å™¨åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºè¾“å…¥æœªç»è¿‡æ»¤ï¼Œå°†æ¶æ„å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç é€šè¿‡dockerç¯å¢ƒæ­å»ºäº†å­˜åœ¨æ¼æ´çš„Bitbucket Serverï¼Œå¹¶æä¾›äº†Pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡HTTPè¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œè¯æ˜è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ‰æ•ˆã€‚
4.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯éªŒè¯å’Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶æœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ ä½†æ˜¯å› ä¸ºæ­¤æ¼æ´æ˜¯RCEç±»å‹æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ³¨å…¥çš„æ–¹å¼æ¤å…¥åé—¨ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
*Dockerfile* ç”¨äºæ­å»ºæ¼æ´ç¯å¢ƒï¼Œè„šæœ¬ç”¨äºæµ‹è¯•æ¼æ´æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®æŠ•æ¯’é£é™©è¾ƒä½.

  **æœç´¢å¼•æ“ç»“æœä½è¯ï¼š**  å¤šä¸ªæœç´¢ç»“æœ(Rapid7, AssetNote, Sangforç­‰)éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---



---

## POC #14

**æ¥æº**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å¼€ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨å¤šä¸ª API ç«¯ç‚¹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´åº“ä¿¡æ¯ï¼Œæ”»å‡»è€…éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™ã€‚æœç´¢å¼•æ“ç»“æœè¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œ PoC ä»£ç çš„ GitHub é“¾æ¥ã€‚æä¾›çš„ PoC ä»£ç  `CVE-2022-36804.py` åŒ…å«ç”¨äºæ£€æŸ¥æ¼æ´ã€æ‰§è¡Œ SSRF å’Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•° `--remote` å’Œ `--exec` æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯å‘å—å½±å“çš„ Bitbucket å®ä¾‹å‘é€åŒ…å«æ¶æ„ `--exec` å‚æ•°çš„ç‰¹åˆ¶ HTTP è¯·æ±‚ï¼Œè¯¥å‚æ•°å…è®¸æ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§ï¼š**
PoC ä»£ç æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå®ç°äº†æ¼æ´æè¿°ä¸­æåˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡ä¿®æ”¹ `git archive` å‘½ä»¤çš„å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoC ä»£ç ä¸»è¦ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨ï¼Œä½†ä¹Ÿå­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚PoC åˆ©ç”¨äº†`--exec` å‚æ•°ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `PAYLOAD` å˜é‡ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»£ç ä¸­åŒ…å«äº†ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚ User-Agent è®¾ç½®å’Œ SSL è¯ä¹¦éªŒè¯ç¦ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹æ½œåœ¨é£é™©ï¼š

*   **æ¶æ„ä¾èµ–ï¼š**  PoC è„šæœ¬ä¾èµ–äºå¤šä¸ª Python åº“ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¯¡æ”¹è¿™äº›åº“æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚
*   **åé—¨æ¤å…¥ï¼š**  æ”»å‡»è€…å¯èƒ½åœ¨ PoC è„šæœ¬ä¸­æ·»åŠ åé—¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡ŒæŒä¹…åŒ–æ”»å‡»ã€‚
*   **ä¿¡æ¯æ³„éœ²ï¼š**  PoC è„šæœ¬å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰ã€‚

ç”±äºè„šæœ¬ä¸»è¦æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ‰€ä»¥æŠ•æ¯’çš„é£é™©è¾ƒä½ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤ï¼Œé¢„ä¼°ä¸º 10%ã€‚è¯¥æ¯”ä¾‹åŸºäºä»£ç çš„å¤æ‚æ€§å’Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œæ¶æ„ä¿®æ”¹çš„ç¨‹åº¦è¯„ä¼°å¾—å‡ºã€‚ä¸»è¦æ˜¯å› ä¸ºä»£ç æœ‰è¿œç¨‹è¿æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå¯èƒ½å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `check` åŠŸèƒ½ï¼Œé€šè¿‡å‘é€åŒ…å« `%00--help%00--%00` çš„æ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥ç›®æ ‡ Bitbucket å®ä¾‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚
2.  **SSRFï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `ssrf` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--remote` å‚æ•°ï¼Œä½¿ç›®æ ‡ Bitbucket å®ä¾‹å‘æŒ‡å®šçš„ DNS åŸŸåå‘èµ·è¯·æ±‚ï¼ŒéªŒè¯ SSRF æ¼æ´ã€‚
3.  **è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ï¼š** ä½¿ç”¨ PoC ä»£ç çš„ `rce` åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹ `--exec` å‚æ•°ï¼Œåœ¨ç›®æ ‡ Bitbucket å®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ shell å‘½ä»¤ã€‚PoC ä»£ç æ”¯æŒä½¿ç”¨ `reverse_shell` åŠŸèƒ½ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨åå‘ shellã€‚
4.  **æ–‡ä»¶ä¸‹è½½:** å¯ä»¥æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ï¼Œå°†è¿œç¨‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚

åˆ©ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bitbucket å®ä¾‹å¯èƒ½å­˜åœ¨å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œå› æ­¤æ”»å‡»è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ PoC ä»£ç ï¼Œä¾‹å¦‚ç»•è¿‡ WAFã€èº«ä»½éªŒè¯ç­‰ã€‚


**é¡¹ç›®åœ°å€:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**æ¥æº**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server å’Œ Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å­˜åœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ å…·æœ‰è¯»å–æƒé™çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨ Git çš„ `--exec` å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚PoC ä»£ç é¦–å…ˆè·å– Bitbucket å®ä¾‹ä¸­çš„æ‰€æœ‰é¡¹ç›®å’Œä»“åº“ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªä»“åº“ï¼Œæ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ URL å‘é€è¯·æ±‚ã€‚ å¦‚æœæœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼ŒPoC é€šè¿‡æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å« `/etc/passwd` çš„å†…å®¹æ¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœªå‘ç°ä½œè€…æ¤å…¥æ¶æ„ä»£ç çš„å«Œç–‘ã€‚

**é¡¹ç›®åœ°å€:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**æ¥æº**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server and Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“å…·æœ‰è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“å…·æœ‰è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´æè¿°ï¼Œæ”»å‡»è€…åªéœ€å…·å¤‡å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™æˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™å³å¯ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¡®å®šç›®æ ‡ï¼š** æ”»å‡»è€…éœ€è¦ç¡®å®šå­˜åœ¨æ¼æ´çš„ Bitbucket Server æˆ– Data Center å®ä¾‹ã€‚
2.  **è·å–é¡¹ç›®ä¿¡æ¯ï¼š** åˆ©ç”¨`/repos?visibility=public`æ¥å£è·å–å¯è®¿é—®çš„å…¬å…±é¡¹ç›®å’Œä»“åº“ä¿¡æ¯ã€‚
3.  **æ„é€ æ¶æ„è¯·æ±‚ï¼š**  æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨`--exec`å‚æ•°è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚Payload ä½äºURLä¸­, ä½¿ç”¨`%60`è¿›è¡Œè½¬ä¹‰ã€‚
4.  **å‘é€è¯·æ±‚ï¼š** å°†æ„é€ çš„æ¶æ„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Bitbucket æœåŠ¡å™¨ã€‚
5.  **æ‰§è¡Œä»£ç ï¼š**  å¦‚æœæ¼æ´å­˜åœ¨ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„å‘½ä»¤ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„POCä»£ç å°è¯•è‡ªåŠ¨åŒ–ä¸Šè¿°æ­¥éª¤ã€‚å®ƒä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡URLï¼Œç„¶åå°è¯•åˆ©ç”¨æ¼æ´ã€‚POCä»£ç é¦–å…ˆå°è¯•ä»å…¬å…±ä»“åº“è¯»å–ä¿¡æ¯ï¼Œä»¥ç¡®å®šé¡¹ç›®å’Œä»“åº“çš„åç§°ï¼Œå¹¶æ„å»ºåˆ©ç”¨URLã€‚ç„¶åï¼Œå®ƒå‘ç›®æ ‡å‘é€å¸¦æœ‰æ³¨å…¥å‘½ä»¤çš„è¯·æ±‚ï¼Œå¹¶æ‰“å°å“åº”ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

åœ¨æ‰€æä¾›çš„POCä»£ç ä¸­ï¼Œè™½ç„¶ä½œè€…è¯•å›¾é€šè¿‡æ‰§è¡Œä»»æ„å‘½ä»¤æ¥å®ç°RCEï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä¾‹å¦‚ï¼Œä»£ç æ²¡æœ‰å°è¯•ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€å®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆ–è€…æœªç»æˆæƒè®¿é—®å…¶ä»–èµ„æºã€‚ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè™½ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œä½†å¯ä»¥å°†æŠ•æ¯’é£é™©å®šä¹‰ä¸ºè¾ƒä½çš„æ¦‚ç‡ï¼Œå®šä¹‰ä¸º5%ã€‚

**é¡¹ç›®åœ°å€:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #17

**æ¥æº**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-å‘½ä»¤æ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2022-36804

**æ¼æ´ç±»å‹:** å‘½ä»¤æ³¨å…¥

**å½±å“åº”ç”¨:** Atlassian Bitbucket Server/Data Center

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 1%

## è¯¦æƒ…

CVE-2022-36804 æ˜¯ Atlassian Bitbucket Server å’Œ Data Center ä¸­å¤šä¸ª API æ¥å£å­˜åœ¨çš„ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡å‘é€æ¶æ„çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºï¼š

1.  **æ¼æ´åŸç†ï¼š**  ç”±äºBitbucket Serverå’ŒData Centeråœ¨å¤„ç†ç‰¹å®šAPIè¯·æ±‚æ—¶ï¼Œæœªå¯¹ç”¨æˆ·å¯æ§çš„è¾“å…¥è¿›è¡Œå……åˆ†çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚
2.  **åˆ©ç”¨æ–¹å¼ï¼š**
    *   æ”»å‡»è€…éœ€è¦å…·æœ‰å¯¹å…¬å…±ä»“åº“çš„è®¿é—®æƒé™ï¼Œæˆ–è€…å¯¹ç§æœ‰ä»“åº“çš„è¯»å–æƒé™ã€‚
    *   æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„HTTPè¯·æ±‚ï¼Œå‘é€åˆ°å­˜åœ¨æ¼æ´çš„APIæ¥å£ã€‚
    *   æœåŠ¡å™¨åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ï¼Œç”±äºè¾“å…¥æœªç»è¿‡æ»¤ï¼Œå°†æ¶æ„å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **POCæœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç é€šè¿‡dockerç¯å¢ƒæ­å»ºäº†å­˜åœ¨æ¼æ´çš„Bitbucket Serverï¼Œå¹¶æä¾›äº†Pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡HTTPè¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œè¯æ˜è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ‰æ•ˆã€‚
4.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
è¯¥æ¼æ´åˆ©ç”¨ä»£ç æœ¬èº«çš„åŠŸèƒ½æ˜¯éªŒè¯å’Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶æœªå‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ ä½†æ˜¯å› ä¸ºæ­¤æ¼æ´æ˜¯RCEç±»å‹æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ³¨å…¥çš„æ–¹å¼æ¤å…¥åé—¨ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
*Dockerfile* ç”¨äºæ­å»ºæ¼æ´ç¯å¢ƒï¼Œè„šæœ¬ç”¨äºæµ‹è¯•æ¼æ´æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®æŠ•æ¯’é£é™©è¾ƒä½.

  **æœç´¢å¼•æ“ç»“æœä½è¯ï¼š**  å¤šä¸ªæœç´¢ç»“æœ(Rapid7, AssetNote, Sangforç­‰)éƒ½è¯å®äº†è¯¥æ¼æ´çš„å­˜åœ¨ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚

**é¡¹ç›®åœ°å€:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

