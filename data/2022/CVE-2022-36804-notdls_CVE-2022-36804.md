# CVE-2022-36804

> 📦 该CVE有 **17** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-0xEleven_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 8.3.1

**利用条件:** 需要对公共仓库具有读取权限或对私有仓库具有有效的`BITBUCKETSESSIONID` cookie

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。具有公共仓库访问权限或对私有 Bitbucket 仓库具有读取权限的攻击者，可以通过发送恶意的 HTTP 请求来执行任意代码。 

**有效性:**
根据漏洞信息、搜索结果和提供的POC代码，该漏洞利用的有效性很高。漏洞库信息表明该漏洞已被公开披露且存在相应的修复版本。搜索结果也确认了该漏洞的存在，并提供了相关的分析和PoC。提供的PoC代码（`CVE-2022-36804-ReverseShell`）描述为一个“somewhat reliable PoC exploit”，表明它在某些情况下可能不稳定，但这通常与环境相关，不影响漏洞的整体有效性。PoC也说明支持公有仓库，并且对私有仓库可以使用session cookie，增加了其可用性。

**投毒风险:**
PoC代码中存在一定投毒风险，但可能性较低（估计为10%）。原因如下：
*   代码来源：该仓库基于 [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) 进行修改，由Chocapikk进行mass exploit和reverse shell功能的添加。这意味着存在引入恶意代码的可能性。
*   批量利用：PoC 包含批量扫描和利用的功能，攻击者可能会修改代码以大规模传播恶意软件。
*   命令执行： PoC 允许执行任意命令。虽然这是漏洞利用的一部分，但也为植入后门或恶意代码提供了途径。
需要仔细审查 `main.py` 文件，特别关注以下方面：
    *   是否有额外的网络请求，尝试下载或执行其他脚本。
    *   reverse shell是否被篡改，是否连接未知的地址和端口。
    *   参数解析部分，是否有隐藏的参数可以被恶意利用。
    *   批量扫描和利用功能，是否存在将结果发送到外部服务器的逻辑。

**利用方式:**
1.  **自动/手动 查找 Repository:** PoC 提供了自动查找可利用 Repository 的功能。如果自动查找失败，也可以手动指定 Repository。
2.  **发送恶意请求:**  利用脚本构造包含恶意参数的 HTTP 请求，目标 Bitbucket 服务器在处理这些参数时，会由于参数注入漏洞执行攻击者指定的命令。
3.  **执行命令:** 成功利用漏洞后，攻击者可以在目标服务器上执行任意命令。
4.  **反弹shell:** 可以使用 `--lhost` 和 `--lport` 参数建立反向 shell，从而完全控制目标服务器。
5. **会话维持:** 对于私有仓库，可以使用 `--session` 参数，提供有效的 `BITBUCKETSESSIONID` cookie。


**项目地址:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #2

**来源**: [CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md](../2022/CVE-2022-36804-Chocapikk_CVE-2022-36804-ReverseShell.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Bitbucket Server/Data Center

**危害等级:** 高危，可远程代码执行

**影响版本:** < 8.3.1

**利用条件:** 需要对公开或私有Bitbucket仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。攻击者可以通过发送恶意 HTTP 请求，利用多个 API 端点中的漏洞执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是Rapid7的分析和AssetNote的研究）以及提供的PoC代码，可以判断该漏洞是有效的。PoC 代码提供了一种相对可靠的利用方式，特别是对于启用了公共仓库的实例。即使目标仓库是私有的，也可以使用有效的 'BITBUCKETSESSIONID' cookie 进行利用。

**投毒风险：**

PoC代码的主要功能是利用命令注入漏洞执行任意命令。代码中包含自动检测仓库的功能，以及通过命令行参数指定目标、执行命令、反弹shell等选项。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令默认值：**  虽然`--command`参数默认为`whoami`，但攻击者可能会修改默认值，使其执行更具破坏性的操作。
2.  **反弹 Shell 功能：**  `--lhost` 和 `--lport` 参数用于设置反弹 shell，如果攻击者诱使用户运行此 PoC 并连接到攻击者控制的服务器，则可能导致受害者系统被完全控制。
3.  **批量扫描的潜在风险：**  `--file` 参数允许批量扫描目标，攻击者可能会利用此功能进行大规模攻击，或者在扫描过程中植入恶意代码。
4. **代码逻辑缺陷**: 代码中可能存在潜在的逻辑缺陷或未处理的异常，可能导致程序崩溃或执行意外的操作。

综合来看，虽然PoC代码主要目的是验证漏洞，但存在被滥用或修改以进行恶意攻击的风险。初步判断存在10%的投毒风险。

**利用方式：**

1.  **确定目标 Bitbucket Server/Data Center 版本：** 确认目标版本是否在受影响的范围内（< 8.3.1）。
2.  **获取仓库信息：** 如果启用了公共仓库，PoC代码可以自动检测可利用的仓库。如果目标仓库是私有的，则需要有效的 'BITBUCKETSESSIONID' cookie。
3.  **构造恶意 HTTP 请求：**  PoC代码会自动构造包含恶意命令的 HTTP 请求，发送到易受攻击的 API 端点。
4.  **执行任意代码：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意代码，例如执行系统命令、反弹 shell 等。
5. **利用参数传递命令**: 通过 `--command` 参数或 `--file` 参数指定要执行的恶意命令,进行漏洞攻击.

**总结：**

CVE-2022-36804 是一个高危的命令注入漏洞，利用条件相对宽松（需要读取权限），且存在公开的PoC代码。攻击者可以利用该漏洞在 Bitbucket Server/Data Center 服务器上执行任意代码，造成严重的安全威胁。需要及时升级到安全版本。

**项目地址:** [Chocapikk/CVE-2022-36804-ReverseShell](https://github.com/Chocapikk/CVE-2022-36804-ReverseShell)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #3

**来源**: [CVE-2022-36804-ColdFusionX_CVE-2022-36804.md](../2022/CVE-2022-36804-ColdFusionX_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公共仓库的访问权限或对私有仓库的读取权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 端点存在的一个命令注入漏洞。攻击者通过发送特制的 HTTP 请求，可以利用 `git archive` 命令的 `--exec` 参数注入恶意命令，从而实现远程代码执行。根据漏洞利用代码，攻击者需要在URL中插入经过编码的恶意参数，从而执行任意命令。例如，可以使用 `id` 命令来验证漏洞，或者使用 `cat /etc/passwd` 命令来读取服务器上的敏感文件。风险在于POC中可能存在隐蔽的下载脚本,或者包含其他恶意连接. 因此评估投毒风险为5%。

**项目地址:** [ColdFusionX/CVE-2022-36804](https://github.com/ColdFusionX/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #4

**来源**: [CVE-2022-36804-Inplex-sys_CVE-2022-36804.md](../2022/CVE-2022-36804-Inplex-sys_CVE-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公开或私有Bitbucket仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中的一个命令注入漏洞。根据漏洞描述，具有公开仓库访问权限或私有仓库读取权限的攻击者可以通过发送恶意HTTP请求来执行任意代码。从搜索结果来看，多个安全团队已经发现了此漏洞并发布了相关的分析报告和利用方式。漏洞存在于多个API端点中，利用方式是通过构造恶意的git命令，利用`--exec`参数执行任意命令。

提供的漏洞利用代码只包含了一个Apache License 2.0的许可证文件，没有实际的漏洞利用代码。因此，无法直接评估提供的POC代码的有效性。

由于提供的代码只是许可证文件，因此可以判定此仓库中不存在作者隐藏的投毒代码的风险。所以投毒风险为0%。

漏洞的利用方式：攻击者需要对目标Bitbucket仓库具有读取权限（公共仓库或私有仓库的读取权限）。然后，攻击者通过构造包含恶意git命令的HTTP请求发送到存在漏洞的API端点，服务器在处理这个请求时，由于没有充分过滤和转义特殊字符，导致恶意命令被执行，从而实现远程代码执行。

**项目地址:** [Inplex-sys/CVE-2022-36804](https://github.com/Inplex-sys/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #5

**来源**: [CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md](../2022/CVE-2022-36804-JRandomSage_CVE-2022-36804-MASS-RCE.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 直到 7.6.17, 7.7.0 直到 7.17.10, 7.18.0 直到 7.21.4, 8.0.0 直到 8.0.3, 8.1.0 直到 8.1.3, 8.2.0 直到 8.2.2, 8.3.0 直到 8.3.1

**利用条件:** 需要对公共仓库的访问权限或对私有Bitbucket仓库的读取权限

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。根据漏洞库信息，具有公共仓库访问权限或私有Bitbucket仓库读取权限的远程攻击者可以通过发送恶意HTTP请求来执行任意代码。搜索引擎结果表明该漏洞利用相对容易，并且存在公开可用的PoC。

提供的漏洞利用代码包含两个文件：`CVE-2022-36804-mass.py` 和 `README.md`。

*   `CVE-2022-36804-mass.py` 的主要功能是打印一个包含付款链接的字符串，这表明它不是一个实际的漏洞利用程序，而可能是一个诱饵或诈骗。
*   `README.md` 文件描述了漏洞，声称提供了一个Python编写的多功能PoC，但实际的PoC需要通过提供的付款链接获取，并且提及存在包含大量易受攻击服务器的列表。这意味着作者意图通过出售或以其他方式分发所谓的PoC获利，进一步提高了投毒风险。

综合来看，该仓库中的PoC很可能是无效的，或者说是经过精心设计的诱饵。要求付款的行为是一个危险信号，表明作者可能试图传播恶意软件或窃取用户凭据。

**利用方式：** 根据rapid7.com(webpage 1)和assetnote.io(webpage 3)上的描述，该漏洞是由于多个API端点存在命令注入漏洞，攻击者可以利用 `--exec` 参数执行任意命令。攻击者需要对仓库具有读取权限，可以通过构造恶意的HTTP请求来触发该漏洞。

**有效性：** 从提供的文件来看，提供的PoC代码可能无效或者包含恶意内容, 需要进一步验证才能确认其真实功能。根据其他搜索结果，漏洞本身是有效的，并且存在其他的可利用方式。

**投毒风险：** 极高。`CVE-2022-36804-mass.py`只是一个诱饵，引导用户访问付款链接。真正的攻击代码可能隐藏在付款后的下载链接中，并可能包含恶意软件。`README.md` 的声明与实际代码不符，也增加了投毒的可能性。因此，该仓库存在极高的投毒风险(95%)。

**项目地址:** [JRandomSage/CVE-2022-36804-MASS-RCE](https://github.com/JRandomSage/CVE-2022-36804-MASS-RCE)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #6

**来源**: [CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md](../2022/CVE-2022-36804-Vulnmachines_bitbucket-cve-2022-36804.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，允许远程代码执行

**影响版本:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库具有访问权限或者对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中的一个命令注入漏洞。攻击者可以通过发送恶意HTTP请求，利用多个API端点中的漏洞执行任意代码。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，可以判断此漏洞是有效的，并且已经存在公开的利用方法。

**投毒风险：**

提供的漏洞利用代码主要包含两个payload，用于触发命令注入。
*   `payload` 文件通过构造包含 `--exec` 参数的HTTP请求，执行 `whoami` 命令。看起来是为了验证漏洞是否存在。  
*   `payload2` 文件同样构造了包含 `--exec` 参数的HTTP请求，执行 `id` 命令。也是为了验证漏洞是否存在。

仓库中的`README.md`只是包含PoC的演示图片以及作者的社交媒体链接，没有发现恶意代码。

综合评估，由于POC文件本身是为了验证漏洞，并非为了传播恶意代码，仓库中主要的文件是用于演示和说明漏洞的，因此投毒风险较低，评估为10%。此处的风险主要来源于POC可能被他人修改后传播，从而植入恶意代码。

**利用方式：**

利用方式主要通过构造特殊的HTTP请求，该请求中利用了git命令的 `--exec` 参数，该参数允许执行任意系统命令。攻击者通过在 `path` 或 `prefix` 参数中插入包含 `--exec` 和恶意命令的字符串，最终导致命令注入。

具体利用步骤如下：

1.  构造包含恶意命令的HTTP请求，请求特定的API端点，例如 `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`。
2.  在 `path` 或 `prefix` 参数中，插入类似 `%00--exec=<command>%00--remote=origin` 的字符串。
3.  发送构造好的HTTP请求到目标Bitbucket服务器。
4.  服务器解析请求，执行被注入的命令。

成功利用此漏洞可以导致远程代码执行，可能导致服务器被完全控制。

**项目地址:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #7

**来源**: [CVE-2022-36804-asepsaepdin_CVE-2022-36804.md](../2022/CVE-2022-36804-asepsaepdin_CVE-2022-36804.md)

## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center 远程代码执行

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**利用条件:** 需要对公共或私有Bitbucket存储库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 端点存在的一个命令注入漏洞。攻击者通过发送恶意的 HTTP 请求，利用 `git --exec` 参数执行任意命令。

**有效性:** 根据漏洞描述和搜索引擎结果（尤其是 `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`），此漏洞利用 PoC 代码有效。提供的 PoC 代码包含构建易受攻击环境的 Dockerfile 和利用漏洞的 Python 脚本，以及使用说明，用于验证 RCE 并执行自定义命令，甚至建立反向 shell。

**投毒风险:** 分析 PoC 代码，特别是 `cve-2022-36804.py` 脚本，主要功能是发送恶意请求以触发命令注入。投毒风险较低，约为10%。潜在的风险可能存在于脚本中使用的 User-Agent 字符串或者请求头部的其他字段中，作者可能暗中搜集使用者信息。此外，Dockerfile 下载的 Bitbucket 版本可能包含恶意软件,但这不在本次评估范围内。

**利用方式:**

1.  攻击者需要具有对目标 Bitbucket 仓库的读取权限（公共或私有）。
2.  攻击者构造包含恶意命令的 HTTP 请求，该命令会被注入到 git 命令的 `--exec` 参数中。
3.  服务器在执行 git 命令时，会执行攻击者注入的恶意命令，从而导致远程代码执行。
4.  PoC 代码演示了如何利用该漏洞执行任意系统命令，例如 `id`，以及如何建立反向 shell。

利用此漏洞，攻击者可以完全控制 Bitbucket 服务器，窃取敏感数据，篡改代码，或者将服务器作为跳板攻击其他内部系统。

**项目地址:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #8

**来源**: [CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md](../2022/CVE-2022-36804-benjaminhays_CVE-2022-36804-PoC-Exploit.md)

## CVE-2022-36804-Bitbucket 命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 8.3.1

**利用条件:** 需要对公共仓库或私有仓库具有读取权限，或拥有有效的session cookie

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中存在的一个命令注入漏洞。攻击者通过发送恶意的HTTP请求，利用多个API端点中的漏洞，可以在目标系统上执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已被公开披露，并且存在可用的PoC代码。Rapid7 和 AssetNote 的分析都表明该漏洞很容易被利用。

提供的PoC代码（BenHays142/CVE-2022-36804-PoC-Exploit）的README.md显示，该漏洞需要开启公共仓库，或使用有效的BITBUCKETSESSIONID cookie（如果目标仓库是私有的）。利用方式是发送特制的HTTP请求到受影响的API端点。

**投毒风险：**

代码中检测到自动查找repo的功能，以及命令执行的功能。虽然这些功能是漏洞利用的一部分，但是也增加了投毒风险，例如在自动查找repo时，如果恶意修改了repo的参数，可能会造成拒绝服务攻击。进一步分析 `main.py`，没有明显的恶意代码，该脚本主要功能是：

1.  检测是否存在可利用的repo（`detect_repo` 函数）。
2.  执行命令（`exec_stuff` 函数）。
3.  检查目标是否容易受到攻击（`check_vuln` 函数）。

虽然代码本身看起来没有明显的恶意行为，但是使用此PoC仍然存在风险，因为攻击者可能会修改PoC代码以包含恶意功能。因此，投毒风险评估为5%。

**利用方式：**

该漏洞的利用方式是通过构造恶意的HTTP请求，该请求利用了 `git archive` 命令中的 `--exec` 参数。具体来说，通过在URL中嵌入特殊的payload，攻击者可以在服务器上执行任意命令。

`main.py` 脚本利用 `archive` API，并使用特殊构造的 `prefix` 参数来执行命令：

```
/rest/api/latest/projects/{project}/repos/{repo}/archive?format=zip&path=aaa&prefix=test/%00--remote=/%00--exec=%60{cmd}%60%00--prefix=/
```

其中，`{cmd}` 是要执行的命令，`%00` 是 NULL 字节，用于截断字符串，从而使 `--exec` 参数生效。服务器在处理此请求时，由于未正确过滤或转义参数，导致命令注入漏洞。

**漏洞影响：**

成功利用此漏洞的攻击者可以在Bitbucket服务器上执行任意代码，这可能导致系统完全受损，数据泄露，服务中断等严重后果。

**项目地址:** [benjaminhays/CVE-2022-36804-PoC-Exploit](https://github.com/benjaminhays/CVE-2022-36804-PoC-Exploit)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #9

**来源**: [CVE-2022-36804-devengpk_CVE-2022-36804.md](../2022/CVE-2022-36804-devengpk_CVE-2022-36804.md)

## CVE-2022-36804 - Bitbucket 命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程代码执行

**影响版本:** 7.0.0 < version < 7.6.17, 7.7.0 < version < 7.17.10, 7.18.0 < version < 7.21.4, 8.0.0 < version < 8.0.3, 8.1.0 < version < 8.1.3, 8.2.0 < version < 8.2.2, 8.3.0 < 8.3.1

**利用条件:** 需要对公共仓库具有读取权限，或者对私有仓库具有读取权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。根据漏洞描述，拥有对公共或私有 Bitbucket 仓库的读取权限的远程攻击者可以通过发送恶意 HTTP 请求来执行任意代码。

**有效性：**
根据搜索结果和提供的POC代码，该漏洞的利用是有效的。多个来源（如 Rapid7, AssetNote, Sangfor 等）都证实了该漏洞的存在和可利用性。POC代码中提供的 `payload.txt` 文件包含利用参数 `--remote` 和 `--exec` 进行命令注入的payload。`id` 命令可以作为测试有效载荷，用于验证命令执行。Assetnote的文章也提到了通过 `--exec` 参数利用 git 命令进行攻击

**投毒风险：**
`README.md` 文件看起来是标准的漏洞描述。`payload.txt` 文件包含明显的利用payload。理论上，攻击者可能通过修改其他文件来注入恶意代码，例如植入后门或进行其他恶意行为。但是，仅基于目前提供的信息，无法确认存在恶意代码。该仓库只提供了PoC的payload，并没有看到进一步的攻击模块，因此，投毒风险较低，估计在10%左右。

**利用方式：**
利用方式主要集中于构造恶意的 `archive` 请求，该请求包含特殊的参数，利用了 `git archive` 命令中的参数注入漏洞。攻击者可以使用 `--remote` 和 `--exec` 参数注入任意命令。受影响的 API 端点接受这些参数，并没有正确地对输入进行验证和过滤，导致命令注入。

攻击者需要做的：
1.  确定目标 Bitbucket Server 或 Data Center 的版本是否在受影响的范围内。
2.  构造包含恶意参数的 HTTP 请求，例如 `archive?format=zip&path=bighax&prefix=vulnmachines/%00–remote=/%00–exec=%60id%60%00–prefix=/`。
3.  发送该请求到受影响的 API 端点。
4.  如果漏洞利用成功，服务器将执行注入的命令。

**项目地址:** [devengpk/CVE-2022-36804](https://github.com/devengpk/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #10

**来源**: [CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md](../2022/CVE-2022-36804-imbas007_Atlassian-Bitbucket-CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, <8.3.1

**利用条件:** 需要对公开或私有Bitbucket仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中的一个命令注入漏洞。攻击者利用具有读取权限的账号，向存在漏洞的API端点发送恶意HTTP请求，通过`git archive`命令的`--exec`参数注入恶意代码，最终实现远程命令执行。利用方式包括发送特制的URL，其中包含经过URL编码的命令。例如`url+'/rest/api/latest/projects/'+project_key+'/repos/'+repo_name+'/archive?filename=kiE0h&at=refs%2`，此POC代码的目的是验证漏洞存在以及执行命令，未发现明显的投毒代码。

**项目地址:** [imbas007/Atlassian-Bitbucket-CVE-2022-36804](https://github.com/imbas007/Atlassian-Bitbucket-CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #11

**来源**: [CVE-2022-36804-khal4n1_CVE-2022-36804.md](../2022/CVE-2022-36804-khal4n1_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公共仓库或者私有仓库有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中多个API端点存在的一个命令注入漏洞。具有公共存储库访问权限或对私有Bitbucket存储库具有读取权限的攻击者可以通过发送恶意HTTP请求来执行任意代码。漏洞利用方式为：利用git archive命令的`--exec`参数进行命令注入。POC代码中，`mexploit.py`脚本通过构造特定的URL，将恶意命令注入到`--exec`参数中，从而在目标服务器上执行任意命令。`README.md`文件仅包含漏洞描述和脚本使用说明，未发现恶意代码。初步判断投毒风险较低，但仍需谨慎评估脚本执行的命令是否安全，以及脚本是否存在其他隐藏的恶意行为。`walnutsecurity/cve-2022-36804`等仓库也提供了此漏洞的POC，可作为参考对比。

**项目地址:** [khal4n1/CVE-2022-36804](https://github.com/khal4n1/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #12

**来源**: [CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md](../2022/CVE-2022-36804-kljunowsky_CVE-2022-36804-POC.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公开仓库具有访问权限，或者对私有 Bitbucket 仓库具有读取权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息和搜索结果，CVE-2022-36804 允许远程攻击者通过发送恶意 HTTP 请求，在存在漏洞的 Bitbucket Server 和 Data Center 实例上执行任意代码。该漏洞是由于多个 API 端点中存在命令注入漏洞导致的，攻击者可以利用 `git --exec` 参数执行恶意命令。

**有效性：**
提供的 POC 代码尝试利用该漏洞。它首先使用 `httpx` 查找公开的 Bitbucket 仓库，然后构造一个包含恶意 `--exec` 参数的 URL，该参数会导致服务器执行任意命令。`id` 命令被用作 PoC，用于验证是否成功执行命令。

**投毒风险：**
该仓库的投毒风险较低，大约为 10%。 代码逻辑相对简单，主要是发现Bitbucket仓库并构造利用URL。投毒的风险可能存在于以下方面：

1.  **依赖库风险:** 脚本依赖于外部库，如 `requests` 和命令行工具如`httpx`, 这些依赖项可能存在潜在的供应链安全风险，虽然不太可能，但需要考虑。
2.  **命令执行风险:** 脚本使用了 `os.system` 执行命令，虽然用于调用 `httpx`，但如果攻击者能够控制 targets 文件内容，可能会导致额外的命令注入风险。这部分的风险较低，取决于 `targets` 文件的可控程度。
3.  **URL 构造风险:** 脚本构造 URL 的逻辑存在一定的复杂性，如果服务器对 URL 的处理方式与预期不符，可能会导致意外的命令执行或其他安全问题。

**利用方式：**
1.  **查找公开仓库：** 攻击者首先需要找到公开可访问的 Bitbucket 仓库或具有读取权限的私有仓库。
2.  **构造恶意 URL：** 攻击者构造一个包含恶意 `--exec` 参数的 URL。该 URL 的格式如下：
    `/rest/api/latest/projects/{project-path}/archive?filename=kiE0h&at=kiE0h&path=kiE0h&prefix=ax%00--exec=%60<command>%60%00--remote=origin`
    其中，`<command>` 是要执行的命令。
3.  **发送 HTTP 请求：** 攻击者向 Bitbucket 服务器发送包含恶意 URL 的 HTTP 请求。
4.  **执行任意代码：** 如果服务器存在漏洞，则会执行 URL 中指定的命令。

**项目地址:** [kljunowsky/CVE-2022-36804-POC](https://github.com/kljunowsky/CVE-2022-36804-POC)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #13

**来源**: [CVE-2022-36804-notdls_CVE-2022-36804.md](../2022/CVE-2022-36804-notdls_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库的访问权限或者对私有仓库的读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 存在于 Atlassian Bitbucket Server 和 Data Center 的多个 API 接口中。 具有公共仓库访问权限或私有仓库读取权限的远程攻击者可以通过发送恶意 HTTP 请求来执行任意代码。漏洞原因是由于`git archive`命令的`--exec`参数存在参数注入漏洞。攻击者可以通过构造特定的URL，利用`%00`字符截断参数，并插入恶意的`--exec`参数执行任意命令。

**有效性：**
根据漏洞描述、搜索结果以及提供的PoC代码，该漏洞利用是有效的。多个来源（NVD, Rapid7, Atlassian, AssetNote等）证实了该漏洞的存在，并且提供了利用细节。

**投毒风险：**
提供的PoC代码主要包含一个 exploit.py 脚本和一个 README.md 文件。 exploit.py 脚本用于发送恶意请求以触发漏洞，README.md 文件提供了漏洞的描述和使用方法。检查了 exploit.py 脚本，未发现直接的恶意代码或后门，代码逻辑看起来是利用漏洞本身执行命令。投毒风险较低，但仍存在一定的风险，例如：

*   **依赖项投毒：** exploit.py 脚本依赖于 requests 和 urllib.parse 库，如果这些库被投毒，可能会影响 exploit.py 脚本的安全性。
*   **命令执行风险：** PoC本身需要用户提供要执行的命令。如果用户执行了恶意的命令，可能会对系统造成损害。

综合来看，投毒的风险较低，约占 10%。

**利用方式：**
1.  攻击者需要访问目标 Bitbucket Server 或 Data Center 实例。
2.  如果目标仓库是私有的，攻击者需要有效的会话 cookie (`BITBUCKETSESSIONID`)，否则需要目标存在公开仓库。
3.  攻击者构造包含恶意参数的 HTTP 请求发送到受影响的 API 接口。
4.  恶意请求中包含经过 URL 编码的命令，该命令将由服务器执行。
5.  攻击者可以利用该漏洞执行任意命令，例如建立反向 shell 或窃取敏感信息。

**项目地址:** [notdls/CVE-2022-36804](https://github.com/notdls/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #14

**来源**: [CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md](../2022/CVE-2022-36804-notxesh_CVE-2022-36804-PoC.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公开仓库具有访问权限，或对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。攻击者可以通过发送恶意 HTTP 请求，利用多个 API 端点执行任意代码。根据漏洞库信息，攻击者需要对公共仓库具有访问权限，或对私有仓库具有读取权限。搜索引擎结果证实了该漏洞的存在和利用方式，并提供了相关的分析文章和 PoC 代码的 GitHub 链接。提供的 PoC 代码 `CVE-2022-36804.py` 包含用于检查漏洞、执行 SSRF 和远程代码执行的功能。该脚本通过修改 `git archive` 命令的参数 `--remote` 和 `--exec` 来实现这些功能。具体来说，利用方式是向受影响的 Bitbucket 实例发送包含恶意 `--exec` 参数的特制 HTTP 请求，该参数允许执行任意 shell 命令。

**有效性：**
PoC 代码有效，因为它实现了漏洞描述中提到的利用方式，即通过修改 `git archive` 命令的参数来执行任意代码。

**投毒风险：**
PoC 代码主要用于漏洞验证和利用，但也存在潜在的投毒风险。PoC 利用了`--exec` 参数直接执行命令，攻击者可能会在 `PAYLOAD` 变量中插入恶意代码。此外，虽然代码中包含了一些安全措施，例如 User-Agent 设置和 SSL 证书验证禁用，但仍然存在以下潜在风险：

*   **恶意依赖：**  PoC 脚本依赖于多个 Python 库，攻击者可能通过篡改这些库来注入恶意代码。
*   **后门植入：**  攻击者可能在 PoC 脚本中添加后门代码，以便在目标系统上执行持久化攻击。
*   **信息泄露：**  PoC 脚本可能会泄露敏感信息，例如 API 密钥、数据库密码等。

由于脚本主要是利用已知的漏洞，所以投毒的风险较低，但无法完全排除，预估为 10%。该比例基于代码的复杂性和可能被利用进行恶意修改的程度评估得出。主要是因为代码有远程连接，执行命令等操作，可能存在被篡改的风险。

**利用方式：**
1.  **漏洞检测：** 使用 PoC 代码的 `check` 功能，通过发送包含 `%00--help%00--%00` 的恶意请求，检查目标 Bitbucket 实例是否存在漏洞。
2.  **SSRF：** 使用 PoC 代码的 `ssrf` 功能，通过修改 `--remote` 参数，使目标 Bitbucket 实例向指定的 DNS 域名发起请求，验证 SSRF 漏洞。
3.  **远程代码执行 (RCE)：** 使用 PoC 代码的 `rce` 功能，通过修改 `--exec` 参数，在目标 Bitbucket 实例上执行任意 shell 命令。PoC 代码支持使用 `reverse_shell` 功能，在目标系统上启动反向 shell。
4.  **文件下载:** 可以指定远程的文件，将远程文件下载到本地。

利用过程中需要注意的是，由于 Bitbucket 实例可能存在安全防护措施，因此攻击者需要根据实际情况调整 PoC 代码，例如绕过 WAF、身份验证等。


**项目地址:** [notxesh/CVE-2022-36804-PoC](https://github.com/notxesh/CVE-2022-36804-PoC)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #15

**来源**: [CVE-2022-36804-tahtaciburak_cve-2022-36804.md](../2022/CVE-2022-36804-tahtaciburak_cve-2022-36804.md)

## CVE-2022-36804 - Bitbucket 命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 <= version < 7.6.17, 7.7.0 <= version < 7.17.10, 7.18.0 <= version < 7.21.4, 8.0.0 <= version < 8.0.3, 8.1.0 <= version < 8.1.3, 8.2.0 <= version < 8.2.2, 8.3.0 <= version < 8.3.1

**利用条件:** 需要对公共仓库具有访问权限，或对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中存在的命令注入漏洞。 具有读取权限的远程攻击者可以通过发送恶意 HTTP 请求来执行任意代码。 该漏洞的利用方式是利用 Git 的 `--exec` 参数进行命令注入。PoC 代码首先获取 Bitbucket 实例中的所有项目和仓库，然后针对每个仓库，构造包含恶意命令的 URL 发送请求。 如果服务器存在漏洞，服务器会执行注入的命令，PoC 通过检查响应中是否包含 `/etc/passwd` 的内容来判断漏洞是否存在。该漏洞利用代码未发现作者植入恶意代码的嫌疑。

**项目地址:** [tahtaciburak/cve-2022-36804](https://github.com/tahtaciburak/cve-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #16

**来源**: [CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md](../2022/CVE-2022-36804-ui-bootstrap_CVE-2022-36804.md)

## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库具有访问权限或对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 接口存在的一个命令注入漏洞。攻击者利用此漏洞，可以通过发送恶意 HTTP 请求，在目标系统上执行任意代码。根据漏洞描述，攻击者只需具备对公共仓库的访问权限或对私有仓库的读取权限即可。

**漏洞利用方式：**

1.  **确定目标：** 攻击者需要确定存在漏洞的 Bitbucket Server 或 Data Center 实例。
2.  **获取项目信息：** 利用`/repos?visibility=public`接口获取可访问的公共项目和仓库信息。
3.  **构造恶意请求：**  构造包含恶意命令的 HTTP 请求，利用`--exec`参数进行命令注入。Payload 位于URL中, 使用`%60`进行转义。
4.  **发送请求：** 将构造的恶意请求发送到目标 Bitbucket 服务器。
5.  **执行代码：**  如果漏洞存在，服务器将执行攻击者注入的命令。

**有效性分析：**

提供的POC代码尝试自动化上述步骤。它从文件中读取目标URL，然后尝试利用漏洞。POC代码首先尝试从公共仓库读取信息，以确定项目和仓库的名称，并构建利用URL。然后，它向目标发送带有注入命令的请求，并打印响应。

**投毒风险分析：**

在所提供的POC代码中，虽然作者试图通过执行任意命令来实现RCE，但是并没有明显的投毒代码。例如，代码没有尝试修改系统文件、安装恶意软件，或者未经授权访问其他资源。代码的主要功能是利用漏洞并显示命令执行的结果，虽然存在一定风险，但可以将投毒风险定义为较低的概率，定义为5%。

**项目地址:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

## POC #17

**来源**: [CVE-2022-36804-walnutsecurity_cve-2022-36804.md](../2022/CVE-2022-36804-walnutsecurity_cve-2022-36804.md)

## CVE-2022-36804-Atlassian Bitbucket Server/Data Center-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server/Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**利用条件:** 需要对公共仓库的访问权限，或对私有仓库的读取权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 接口存在的一个命令注入漏洞。攻击者通过发送恶意的HTTP请求，可以执行任意代码。漏洞利用方式为：

1.  **漏洞原理：**  由于Bitbucket Server和Data Center在处理特定API请求时，未对用户可控的输入进行充分的过滤，导致攻击者可以在操作系统层面执行恶意命令。
2.  **利用方式：**
    *   攻击者需要具有对公共仓库的访问权限，或者对私有仓库的读取权限。
    *   攻击者构造包含恶意命令的HTTP请求，发送到存在漏洞的API接口。
    *   服务器在处理该请求时，由于输入未经过滤，将恶意命令传递给操作系统执行，从而导致远程代码执行。
3.  **POC有效性：** 提供的POC代码通过docker环境搭建了存在漏洞的Bitbucket Server，并提供了Python脚本，可以通过HTTP请求执行命令，证明该漏洞利用代码有效。
4.  **投毒风险分析：**
该漏洞利用代码本身的功能是验证和利用漏洞，并未发现明显的恶意代码或后门。 但是因为此漏洞是RCE类型漏洞，可以通过命令注入的方式植入后门，所以存在一定的风险。
*Dockerfile* 用于搭建漏洞环境，脚本用于测试漏洞是否可以利用，所以该项目投毒风险较低.

  **搜索引擎结果佐证：**  多个搜索结果(Rapid7, AssetNote, Sangfor等)都证实了该漏洞的存在以及远程代码执行的能力。

**项目地址:** [walnutsecurity/cve-2022-36804](https://github.com/walnutsecurity/cve-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)

---

