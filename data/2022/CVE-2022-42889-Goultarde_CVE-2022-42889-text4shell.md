## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 受影响应用程序使用了 Apache Commons Text 库，并且通过 StringSubstitutor 类处理了不可信的用户输入，且未禁用受影响的查找器（如 script, dns, url）。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC代码针对CVE-2022-42889（Text4Shell）漏洞提供了高度完整的自动化利用实现。代码逻辑清晰，主要通过构建恶意的StringSubstitutor语法触发漏洞。在提供的python脚本中，攻击者利用了'script:javascript'查找器，这是Apache Commons Text中由于内插字符串处理不当导致的缺陷。脚本详细展示了如何将Java Runtime执行环境与Base64或直接命令结合。具体分析显示，脚本采用了精细的手动URL编码（urllib.parse.quote），以确保在通过HTTP GET请求发送复杂Payload时，Java/Bash转义字符（如反斜杠和引号）不会被Web服务器或Requests库误处理，这保证了Payload在服务端解析时的完整性。脚本支持自定义目标IP、端口、路径及参数，具备极强的实战通用性，能够成功在目标主机上触发反弹Shell，属于高质量的Exploit代码。利用步骤：1. 环境准备：安装Python 3及requests库；2. 攻击者监听：在本地使用nc或其他工具监听指定端口（如：nc -lvnp 139）；3. 执行脚本：运行命令 'python3 exploit.py -t <目标IP> -p <端口> -u <路径> -param <参数> -L <本地IP> -P <监听端口>'；4. 漏洞触发：脚本构建包含 '${script:javascript:...}' 的URL并发送，目标服务器解析该字符串时执行嵌入的Java代码，从而建立反向连接。投毒风险分析：经过深度代码审计，该POC的投毒风险极低（评估为5%）。脚本逻辑透明，使用了Python标准库（argparse, urllib, sys）和常见的第三方库（requests），未发现任何代码混淆、字节码注入或加密的二进制载荷。其核心功能严格限制在生成Payload和发起网络请求。脚本中虽然包含反弹Shell的代码段（/dev/tcp/...），但该部分是作为Payload发送至目标机，而非在攻击者本地执行。代码库中没有发现外部域名请求、敏感信息读取（如读取本地~/.ssh/）或自我复制逻辑。开发者提供的README文档详细说明了用途及免责声明，符合安全研究社区的规范。尽管如此，防御者在使用此类脚本时仍应在隔离环境运行，防止误操作导致的网络流量异常。整体而言，该代码是合法的安全研究辅助工具，未见恶意后门植入迹象。

**项目地址:** [https://www.exploit-db.com/exploits/52261](https://www.exploit-db.com/exploits/52261)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
