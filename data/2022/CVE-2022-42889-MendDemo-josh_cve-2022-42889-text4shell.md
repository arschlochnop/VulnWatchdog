## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 1.5 to 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text库，并调用了StringLookupFactory.INSTANCE.interpolatorStringLookup().lookup()方法处理了未经清洗的用户输入数据。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC是一个基于Docker容器化的Spring Boot应用程序，完整地展示了CVE-2022-42889（Text4Shell）的触发过程。代码结构清晰，包含Dockerfile、pom.xml以及详细的README说明。通过分析pom.xml可知，该项目通过引入旧版本的Apache Commons Text库来复现环境。利用步骤分为：1. 环境准备，使用Maven编译生成Jar包；2. 镜像构建，利用Dockerfile构建包含漏洞环境的容器；3. 部署运行，将容器端口映射至主机；4. 攻击触发，通过构造特殊的HTTP GET请求，在search参数中注入包含“script:javascript”前缀的插值字符串。该POC的有效性极高，其Payload `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}` 能够直接调用Java运行时执行系统命令，通过在容器内部检查/tmp/foo文件的存在与否，可以直观地验证远程代码执行的成功。相比于Log4Shell，Text4Shell的利用门槛同样很低，只需目标应用对外部输入执行了变量插值处理即可。该POC还提示了dns和url前缀的利用方式，进一步拓宽了验证维度。 投毒风险分析：经过对提供的POC源码及项目结构的深度审计，该仓库的投毒风险极低，约为5%。项目采用标准的Maven构建流程和官方的OpenJDK镜像。核心逻辑主要集中在演示漏洞的触发点，并未发现任何恶意混淆代码、反弹Shell到可疑IP地址或下载外部未知二进制文件的行为。Dockerfile中虽然执行了apk update，但这属于标准的镜像构建操作。README中所提供的Payload `'touch /tmp/foo'` 属于典型的良性安全验证操作，旨在证明文件写入权限而非破坏系统。项目代码库中没有发现对敏感环境变量的窃取或隐藏的后门逻辑。唯一需要警惕的是在实际生产环境中使用此类POC时，由于其利用了JavaScript引擎（JEXL, Nashorn等），在不同版本的JDK环境下可能存在表现差异，但在该POC提供的Java 8环境中表现稳定。整体而言，该POC是一个合法的、用于防御性安全研究和教学的开源项目，安全性良好。

**项目地址:** [https://github.com/cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)
