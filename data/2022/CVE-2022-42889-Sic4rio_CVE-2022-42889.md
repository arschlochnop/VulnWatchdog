## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且通过 StringLookupFactory 提供的默认插值器（Default Interpolators）处理了不受信任的用户输入，特别是未禁用 script、dns 或 url 查找器的情况。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：提供的Python脚本针对CVE-2022-42889（又称Text4Shell）提供了完整的自动化利用流程。该脚本通过构造特定的Payload，利用了Apache Commons Text中StringSubstitutor类的变量插值功能。有效的Payload结构为`${script:javascript:java.lang.Runtime.getRuntime().exec('...')}`，此路径触发了内置的JavaScript引擎（通常是Nashorn）来执行任意系统命令。分析POC代码发现，它不仅在URL查询参数中注入了Payload，还在User-Agent头中同步注入，这种多维度尝试增加了在不同Web架构下触发漏洞的可能性。脚本使用了requests库进行同步HTTP请求，代码结构清晰，通过TerminalColors类增强了交互体验，并包含必要的Banner和用户输入提示，是一个功能完备且直接可用的利用程序。在实验环境下，该脚本能成功调用目标系统的busybox或nc命令反弹Shell，验证了漏洞的严重性。利用步骤：1. 环境准备：确保目标应用使用了Apache Commons Text 1.5-1.9版本；2. 获取信息：确定攻击者的监听IP和端口；3. 执行脚本：运行Text4Shell.py，按提示输入目标URL、监听IP及端口；4. 触发漏洞：脚本会自动将编码后的插值表达式嵌入到HTTP GET请求的search参数及Header中发送至服务端；5. 建立连接：服务端在解析字符串时触发脚本引擎执行，攻击者在对应端口接收到反弹的Shell。投毒风险分析：该POC代码的投毒风险评估为15%，属于低风险范畴。代码逻辑透明，主要使用了标准库如requests、time、sys和urllib。代码中未发现混淆处理、动态下载执行第三方不明脚本或上传敏感信息的隐藏行为。主要的敏感操作集中在字符串拼接构造Payload处，即`${script:javascript:...}`，这完全符合CVE-2022-42889的漏洞特征，属于正常的漏洞验证逻辑而非恶意后门。虽然脚本中出现了‘SICARI0 23’等黑客组织或作者的署名标签，但并未发现其在后台执行静默的系统破坏或凭据窃取动作。然而，作为防御性安全研究员，仍需警惕此类工具在分发过程中可能被二次打包。在该版本中，所有的网络请求均指向用户手动输入的target和ip_address，无硬编码的远程恶意指令分发服务器（C2）。整体来看，该POC是一个用于安全审计的合法工具，但在生产环境下载时应始终对比哈希值以防中途被篡改投毒。

**项目地址:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
