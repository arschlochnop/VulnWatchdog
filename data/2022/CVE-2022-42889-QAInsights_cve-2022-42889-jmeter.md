## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且在处理不受信任的输入时使用了 StringSubstitutor 类进行插值处理，且未对默认查找器进行限制。

**POC 可用性:** 4/10

**POC 类型:** 概念验证/补丁脚本

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：本输入中提供的代码并非传统意义上的漏洞攻击载荷（Exploit），而是一个针对特定工具 JMeter 的安全修复脚本。该脚本旨在检测并替换 JMeter 目录中受影响的 commons-text-1.9.jar 为安全的 1.10.0 版本。脚本逻辑清晰，使用了标准的 wget 工具从 Apache 镜像服务器下载二进制包，并引入了关键的安全校验步骤：通过 curl 获取官方提供的 SHA-512 校验和，并使用 sha512sum 命令对下载文件进行本地比对。只有在校验和完全匹配的情况下，才会执行解压、移动文件和清理旧版本文件的操作。这种逻辑设计在防御性安全运维中是高度有效的，能够确保补丁包的完整性。然而，从‘攻击性POC’的角度来看，它并不包含触发 CVE-2022-42889 漏洞的代码（如经典的 ${script:javascript:...} 注入字符串），因此其作为攻击验证的价值较低，更多作为缓解措施示例。利用步骤：1. 攻击者需识别目标应用是否将用户输入传递给 org.apache.commons.text.lookup.StringSubstitutor。2. 构造包含插值关键词的恶意字符串，例如使用 'script'、'dns' 或 'url' 查找器。3. 发送载荷如 `${script:javascript:java.lang.Runtime.getRuntime().exec('id')}`。4. 漏洞触发后，受影响的服务器将在其上下文中执行该命令。投毒风险分析：该 POC 代码的投毒风险极低。分析脚本内容可见其所有操作均透明且有明确的目的指向。其一，下载地址指向了官方的 Apache 归档服务器（dlcdn.apache.org/archive.apache.org），而非第三方可疑域名。其二，脚本内含强制性的 SHA-512 校验机制，这极大地降低了供应链污染的风险，因为即使镜像站点被劫持，错误的哈希值也会触发脚本退出。其三，代码中没有出现任何混淆字符、Base64 加密的隐藏指令或反弹 Shell 的外联请求。脚本的操作范围仅限于 JMeter 的安装目录和临时文件夹。唯一潜在的微小风险在于脚本使用了 $USER 变量定位路径，如果攻击者能够诱导管理员以 root 权限运行未经审计的变体脚本，可能导致非预期的文件覆盖，但就目前此特定脚本而言，其行为完全符合安全维护规范，属于纯净的防御性工具，不具备投毒特征。

**项目地址:** [https://github.com/QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
