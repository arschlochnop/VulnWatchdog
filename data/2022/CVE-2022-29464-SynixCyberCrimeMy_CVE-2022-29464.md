## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 IS as Key Manager, WSO2 Enterprise Integrator 任意文件上传 (Unrestricted File Upload)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传 (Unrestricted File Upload)

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 IS as Key Manager, WSO2 Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; WSO2 Identity Server 5.2.0 - 5.11.0; WSO2 Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 远程网络访问，无需身份验证 (Unauthenticated)

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：提供的Python代码是一个功能齐全的批量利用工具。其核心逻辑在于利用WSO2产品中/fileupload/toolsAny接口的路径穿越漏洞，将恶意的JSP文件上传至Web服务器的可访问目录（如/authenticationendpoint/）。该POC通过requests库构造了multipart/form-data请求，并在文件名中使用'../../../../'前缀来实现目录遍历，将shell.jsp写入预期的Web根路径。代码中包含了批量扫描（mass_scan）和单目标扫描（single_scan）的功能，并使用了多线程处理（Pool），这使其在实际渗透测试中具有极高的效率和实用性。经分析，其利用路径和参数与已知的CVE漏洞原理高度吻合，能够稳定触发。利用步骤：1. 准备攻击负载，即名为shell.jsp的Webshell文件。2. 运行脚本，提供目标IP或URL列表。3. 脚本向目标服务器发送POST请求，请求路径为/fileupload/toolsAny。4. 请求体包含通过路径穿越构造的文件路径。5. 如果服务器响应200且返回内容不含Java异常报错，则认为上传成功。6. 攻击者通过浏览器或客户端访问http://target/authenticationendpoint/shell.jsp获取远程命令执行权限。投毒风险分析：该POC代码结构透明，主要依赖于标准库如requests、colorama和concurrent.futures，未发现明显的代码混淆或加密行为。脚本虽然包含os.system命令用于清理屏幕（cls/clear），但这属于合法的用户界面操作，并非恶意指令。在风险评估中，需要注意该脚本尝试在本地创建'Results'文件夹并写入成功利用的URL，这种行为在安全工具中是正常的。代码中不含远程下载第三方二进制文件或向不明C2服务器回传敏感信息的逻辑。然而，作为威胁情报研究员，仍需警惕'Files/shell.jsp'这个外部文件的内容。由于POC本身不生成JSP负载而是依赖外部文件，如果该JSP文件被替换为包含持久化后门或信息窃取逻辑的恶意脚本，则会构成对使用者的间接投毒风险。目前的Python主程序本身表现出较低的投毒倾向，主要风险集中在供应链的完整性及配套负载的安全性上。

**项目地址:** [https://github.com/SynixCyberCrimeMy/CVE-2022-29464](https://github.com/SynixCyberCrimeMy/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
