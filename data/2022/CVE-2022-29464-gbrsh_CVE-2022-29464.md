## CVE-2022-29464 - WSO2 API Manager, Identity Server, Enterprise Integrator RCE (Remote Code Execution)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (Remote Code Execution)

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** API Manager 2.2.0-4.0.0; Identity Server 5.2.0-5.11.0; IS Analytics 5.4.0-5.6.0; IS as Key Manager 5.3.0-5.10.0; Enterprise Integrator 6.2.0-6.6.0

**利用条件:** 远程网络访问，无需身份验证，目标存在受影响的/fileupload接口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC脚本针对WSO2产品中的CVE-2022-29464漏洞提供了极高完整性的利用实现。该漏洞源于WSO2在处理文件上传请求时，未对上传路径和文件类型进行严格限制，允许攻击者通过目录穿越（Directory Traversal）将任意文件写入到Web根目录下。POC代码清晰地展示了这一过程：首先，它构造了一个恶意的JSP Webshell payload，该payload利用Java Runtime执行系统命令。接着，通过POST请求向'/fileupload/toolsAny'端点发送数据，关键点在于文件名使用了'../../../../'前缀，成功将evil.jsp强行写入到系统的'authenticationendpoint'目录中。脚本随后通过两次GET请求验证上传是否成功：第一次检查HTTP状态码，第二次尝试执行'uname -a'或'wmic'命令以探测操作系统类型。脚本最后提供了一个交互式的Shell环境，极大地方便了安全研究员进行漏洞验证。代码逻辑符合漏洞原理，攻击向量准确，是高质量的防御性测试工具。 【利用步骤】1. 环境准备：确保安装了Python3及requests、colorama等依赖库。2. 运行脚本：执行命令'python3 CVE-2022-29464.py <目标URL>'。3. 触发漏洞：脚本会自动向目标发送包含目录穿越路径的POST请求，将JSP后门写入Web服务器目录。4. 自动验证：脚本会自动检测Payload是否生效并返回系统信息。5. 交互控制：验证成功后，用户可以在提示符'>>'下直接输入系统命令（如whoami, ls等）获取结果。 【投毒风险分析】经过对提供的POC代码进行静态审计，未发现明显的投毒行为或恶意植入。代码逻辑透明，仅引用了标准的第三方库（requests, colorama, urllib3）。脚本的主要功能是上传一个JSP Webshell用于演示执行权限，这是此类POC的常规验证手段，而非针对攻击者本人的恶意行为。其Payload内容清晰可见，不涉及Base64混淆、远程拉取恶意脚本或窃取本地环境变量等行为。此外，脚本显式地禁用了SSL证书验证，这在渗透测试环境中是标准操作。风险评估为低（5%），仅需注意在执行任何未经验证的公开POC时，应在隔离的沙箱环境或虚拟机中运行，以防潜在的供应链污染或未被发现的代码混淆。该脚本作为安全研究工具，其安全性在可控范围内。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
