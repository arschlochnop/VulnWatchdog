## CVE-2022-47966 - Zoho ManageEngine (Multiple OnPremise products including AdSelfService Plus, ServiceDesk Plus, etc.) RCE (Remote Code Execution)

**漏洞编号:** CVE-2022-47966

**漏洞类型:** RCE (Remote Code Execution)

**影响应用:** Zoho ManageEngine (Multiple OnPremise products including AdSelfService Plus, ServiceDesk Plus, etc.)

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** AdSelfService Plus versions 6210 and below; ServiceDesk Plus versions 14003 and below; and other products mentioned in the advisory.

**利用条件:** 受影响的ManageEngine产品已启用SAML SSO（单点登录），且攻击者能够访问对应的SAML端点。利用不需要身份验证。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC针对CVE-2022-47966漏洞，这是一种由于过时的Apache Santuario库（XML安全性）导致的未授权远程代码执行漏洞。该漏洞的核心在于XML数字签名验证过程中的XSLT转换漏洞。提供的Python代码利用了SAML响应中的签名部分，注入了一个包含恶意Java反射代码的XSLT样式表。从代码结构看，该POC通过构造恶意的SAMLResponse XML文档，在其中嵌套了`xmlns:rt="http://xml.apache.org/xalan/java/java.lang.Runtime"`命名空间，并使用XSLT模板调用Java运行时执行系统命令。代码逻辑使用了Python的requests库和threading库进行多线程扫描，支持Base64编码payload，符合真实的漏洞利用向量。它能够通过单个HTTP POST请求将恶意XML发送到受影响的端点（如/SamlResponseServlet），如果目标系统未打补丁且开启了SAML，系统会解析并执行注入的XSLT指令，从而实现命令执行。该POC具备极高的实战性，能够直接在Windows或Linux环境下针对ManageEngine全家桶产品进行批量扫描和深度利用，是一个非常完整且危险的利用工具。利用步骤通常包括：1. 确认目标系统是否开启了SAML SSO；2. 准备包含目标列表的txt文件；3. 执行python3 main.py，脚本将自动生成带有攻击载荷的SAML响应并发送给目标，触发后端Apache Santuario解析器执行攻击者定义的命令。【投毒风险分析】在对此POC代码的静态分析中，主要评估了其作为‘hgrab-framework’一部分的安全性。代码逻辑相对清晰，使用了标准的第三方库如requests、urllib3和colored，未发现显眼的混淆逻辑（如大段不明Base64或十六进制编码）。然而，风险点主要存在于其依赖的框架环境。该POC隶属于一个非官方的、由SystemVll维护的GitHub仓库。投毒风险主要体现在以下几个方面：首先，脚本使用了`urllib3.disable_warnings`忽略证书验证，这虽然在漏洞扫描中常见，但也可能隐藏中间人攻击风险。其次，作为自动化扫描工具，该代码包含了动态生成随机字符串和多线程执行的逻辑，若在不受信任的执行环境下运行，该工具本身可能通过‘hgrab-framework’的其他组件进行回传敏感数据（如攻击者的扫描列表或执行结果）。虽然此main.py本身没有发现直接的恶意后门代码（如反弹Shell回传至攻击者服务器），但漏洞利用工具本身就是高风险资产，攻击者常利用此类‘实用工具’诱导安全从业者在内网执行，进而通过子模块或后续更新引入恶意软件。目前该代码段投毒风险处于低至中等水平（15%），建议在隔离的沙箱环境中审计其引用的所有库文件后再行使用，以防供应链投毒风险。

**项目地址:** [https://github.com/SystemVll/CVE-2022-47966.git](https://github.com/SystemVll/CVE-2022-47966.git)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-47966](https://nvd.nist.gov/vuln/detail/CVE-2022-47966)
