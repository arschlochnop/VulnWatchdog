## CVE-2022-29464 - WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0-4.0.0; Identity Server 5.2.0-5.11.0; Enterprise Integrator 6.2.0-6.6.0; Open Banking AM/KM 1.4.0-2.0.0

**利用条件:** 无需身份验证，可通过网络直接访问漏洞端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2022-29464是由安全研究员Orange Tsai发现的一个影响WSO2多个产品的严重漏洞。该漏洞源于FileUploadServlet组件中对上传路径和文件类型的校验不严，攻击者可以通过构造特殊的带有目录穿越字符（如../）的多部分表单数据请求，将任意JSP文件上传至Web服务器的根目录或部署目录。由于WSO2产品通常以高权限运行且该端点不需要任何身份验证，攻击者可以随后访问上传的JSP脚本，从而实现远程代码执行（RCE）。分析POC代码发现，其逻辑非常清晰且高度自动化：脚本首先读取目标URL，构造包含恶意JSP Shell的POST请求，目标指向漏洞路径（通常是/fileupload/toolsAny或类似的servlet路径）。POC中包含的JSP Shell是一个标准的功能性后门，允许用户通过cmd参数在浏览器界面中直接输入并执行系统级命令。该POC的有效性极高，因为它直接利用了底层的文件写入缺陷，不依赖于复杂的内存溢出或特定环境配置，在未打补丁的目标上成功率几乎达到100%。利用步骤通常包括：1. 确认目标是否存在受影响的服务端口（如9443）；2. 使用自动化工具发送Payload；3. 访问生成的Webshell链接执行命令。对于防御者而言，此漏洞的影响是毁灭性的，因为攻击者可以在几秒钟内获取系统的完全控制权。关于投毒风险分析，该POC项目主要由Python编写，依赖项仅为requests、rich和urllib3等标准或常用库。通过对run.py源码的审查，未发现任何明显的恶意混淆代码、Base64加密的恶意Payload或尝试窃取本地凭据、扫描内网等行为。虽然代码中禁用了InsecureRequestWarning，但这在渗透测试脚本中是常见做法，用于处理自签名证书的HTTPS站点。主要的潜在风险在于用户在使用git clone下载或通过pip安装某些非官方库时可能遭遇供应链攻击，但该POC本身逻辑透明，投毒风险评级为低。防御方应重点检查是否已应用WSO2-2021-1738安全补丁，或通过WAF拦截带有路径穿越特征的FileUpload请求。

**项目地址:** [https://github.com/Pasch0/WSO2RCE](https://github.com/Pasch0/WSO2RCE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
