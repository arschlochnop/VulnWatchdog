## CVE-2022-26134 - Atlassian Confluence 远程代码执行(RCE)

**漏洞编号:** CVE-2022-26134

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Atlassian Confluence

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Confluence Server and Data Center 7.4.0 before version 7.4.17, 7.13.0 before version 7.13.7, 7.14.0 before version 7.14.3, 7.15.0 before version 7.15.2, 8.0.0 before version 8.0.3, 8.1.0 before version 8.1.4 and 8.2.0 before version 8.2.2

**利用条件:** 无需认证，网络可达

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 50%

## 详情

CVE-2022-26134是Atlassian Confluence Server和Data Center中的一个OGNL注入漏洞。攻击者可以通过发送特制的请求，在目标系统上执行任意代码。该漏洞存在于多个版本的Confluence Server和Data Center中，包括7.4.0之前的所有7.4.x版本，7.13.0之前的所有7.13.x版本，7.14.0之前的所有7.14.x版本，7.15.0之前的所有7.15.x版本，8.0.0之前的所有8.0.x版本，8.1.0之前的所有8.1.x版本和8.2.0之前的所有8.2.x版本。

POC有效性分析：
提供的POC代码是一个Java程序，旨在利用CVE-2022-26134漏洞在Confluence服务器上部署冰蝎（Behinder）内存马。该POC通过发送包含恶意OGNL表达式的HTTP请求，利用Confluence的OGNL注入漏洞，执行任意代码。POC首先构造一个包含OGNL表达式的HTTP请求，该表达式使用`javax.script.ScriptEngineManager`来执行JavaScript代码，从而加载并执行Base64编码的payload。这个payload实际上是一个冰蝎的内存马，它允许攻击者通过冰蝎客户端远程控制Confluence服务器。该POC项目地址修改自BeichenDream/CVE-2022-26134-Godzilla-MEMSHELL项目，修改为连接冰蝎内存Shell。通过分析POC代码，可以确认其能够成功利用该漏洞，并在目标系统上部署内存马。

利用步骤：
1.  编译并运行POC代码：`java -jar CVE-2022-26134_Behinder_MemShell.jar http://<Confluence服务器地址>:<端口>/ <冰蝎连接密码>`
2.  POC代码将发送一个包含恶意OGNL表达式的HTTP请求到Confluence服务器。
3.  Confluence服务器执行OGNL表达式，从而部署冰蝎内存马。
4.  使用冰蝎客户端连接Confluence服务器，密码为POC中指定的密码。
5.  成功连接后，攻击者可以执行任意命令，并完全控制Confluence服务器。

投毒风险分析：
该POC的投毒风险较高，主要体现在以下几个方面：
1.  **内存马部署：** POC直接在Confluence服务器的内存中部署冰蝎内存马。内存马的隐蔽性极高，很难通过传统的安全检测手段发现。
2.  **恶意代码执行：** POC通过OGNL注入执行JavaScript代码，然后加载并执行Base64编码的payload。这种动态代码执行方式使得恶意代码难以被静态分析检测到。
3.  **远程控制：** 冰蝎是一个功能强大的webshell工具，允许攻击者远程控制Confluence服务器，执行任意命令，上传和下载文件，以及访问数据库等敏感信息。
4.  **依赖外部资源：** POC依赖于冰蝎客户端，攻击者需要在本地安装冰蝎客户端才能连接Confluence服务器。虽然POC本身不包含病毒或木马，但冰蝎客户端可能被用于传播恶意软件。
5.  POC中使用了MiTM.trustAllHttpsCertificates()方法，该方法会信任所有HTTPS证书，存在中间人攻击的风险。

考虑到以上因素，该POC的投毒风险评定为中等偏高，约为50%。尽管POC本身不包含明显的恶意代码，但它部署的内存马和依赖的冰蝎客户端具有很高的潜在危害性。因此，在使用该POC时需要格外小心，并采取相应的安全措施，以防止被恶意利用。

**项目地址:** https://github.com/BeichenDream/CVE-2022-26134-Godzilla-MEMSHELL

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2022-26134
