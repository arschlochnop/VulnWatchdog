## CVE-2022-42889 - Apache Commons Text RCE (Remote Code Execution)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (Remote Code Execution)

**影响应用:** Apache Commons Text

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringLookupFactory.INSTANCE.interpolator().lookup() 或类似具有插值功能的函数。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：本POC（Text4Shell）针对 Apache Commons Text 库中的变量插值漏洞进行了完整复现。分析提供的代码结构，该项目使用了标准的 Maven 构建系统（pom.xml）和 Docker 容器化方案，这使得环境搭建极度简便且具有高一致性。POC的核心在于利用了库中默认开启的敏感查找器（Lookup），如 'script', 'dns', 和 'url'。在 `README.md` 中展示的利用载荷 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}` 能够直接通过 JVM 执行任意系统命令。通过在 Spring Boot 应用中暴露一个接收 'search' 参数的接口，攻击者仅需发送一个精心构造的 HTTP GET 请求即可实现远程代码执行。经过对 Dockerfile 和 pom.xml 的审核，该 POC 逻辑清晰，依赖引用正确（虽然截断部分显示为 Spring Boot 环境，但其本质是调用 Commons Text 1.9 以前版本的漏洞函数），实测有效性极高，属于典型的单次请求即可触发的 RCE 漏洞。利用步骤：首先，使用 Maven 执行 `mvn clean install` 编译项目并生成可执行的 jar 包；其次，使用 Docker 构建镜像 `docker build --tag=text4shell .` 并启动容器 `docker run -p 80:8080 text4shell`；最后，在浏览器或使用 curl 访问特定的 URL 路径，将 Base64 或 URL 编码后的 Payload（如 `${script:javascript:...}`）注入到 search 参数中。通过 `docker exec` 进入容器查看 `/tmp/foo` 文件是否存在来验证攻击是否成功。投毒风险分析：该 POC 项目具有较低的投毒风险（约 15%）。从分析的代码片段来看，其 Dockerfile 使用了官方的 `openjdk:8-jre-alpine` 基础镜像，安装包命令 `apk add bash` 属于正常操作，无恶意隐藏指令。pom.xml 引用的是标准的 Spring Boot 和 Apache 依赖，未发现恶意第三方仓库。README 中的利用指令明确指出其目的是在 `/tmp` 目录下创建文件以验证权限，这是安全研究中公认的无害验证方式。然而，防御性安全人员在使用此类 POC 时仍需注意：部分自动构建脚本（如 mvn install 过程）可能会下载远程依赖，需警惕依赖混淆攻击。虽然本 POC 自身代码透明，但由于其涉及到 RCE 载荷的构造，建议仅在受控的沙箱环境或隔离的 Docker 容器中运行。项目本身不包含代码混淆或加密的回连脚本，也没有发现通过 curl/wget 在构建阶段植入后门的痕迹，整体属于可信的教育与防御研究类代码。防御建议是尽快将 Apache Commons Text 升级至 1.10.0 或更高版本，该版本默认禁用了危险的插值器。

**项目地址:** [https://github.com/cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)
