## CVE-2022-47966 - Zoho ManageEngine (Multiple On-Premise Products) RCE (远程代码执行)

**漏洞编号:** CVE-2022-47966

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Zoho ManageEngine (Multiple On-Premise Products)

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** AdSelfService Plus versions 6210 and below; Endpoint Central versions 10.1.2137.2 and below; Multiple other On-Premise versions using SAML with enabled SSO.

**利用条件:** 受影响产品需开启SAML SSO功能；若产品版本较旧且之前未开启SSO，攻击者可能需要更多前置条件，但在多数现代部署中为未授权利用。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC针对CVE-2022-47966漏洞进行了高度有效的实现。漏洞核心源于过时的Apache Santuario库（XML签名处理）在处理SAML响应时存在缺陷，允许通过XSLT转换执行任意Java代码。该POC构造了一个精简的SAML响应报文，并在ds:Transform元素中嵌入了恶意XSLT样式表。代码中利用了xalan/java命名空间下的java.lang.Runtime类，通过rt:getRuntime()和rt:exec()方法直接调用操作系统的命令行。由于该漏洞在解析签名之前就已经触发了XSLT转换，因此攻击者无需拥有有效的数字签名或认证凭据即可实现未授权远程代码执行。从代码结构看，POC通过argparse处理目标URL和待执行命令，并使用requests库向目标的SAML端点发送POST请求，逻辑清晰且具备极高的实战转化率。利用步骤：1. 环境准备：安装Python3及requests、urllib3库。2. 确定目标：确认ManageEngine受影响组件（如AdSelfService Plus）的SAML Assertion Consumer Service (ACS) URL。3. 执行测试：运行脚本并指定--url参数为目标ACS地址，--command参数为测试命令（如ping或touch /tmp/success）。4. 验证结果：观察目标服务器是否执行了指定的系统指令。投毒风险分析：该POC代码本身表现为标准的防御性安全研究脚本，投毒风险较低（约15%）。代码主要使用Python内置库和标准的第三方requests库，逻辑透明，未见任何Base64加密的混淆载荷（Payload中的Base64为SAML规范所需，非代码混淆）。脚本中不包含向第三方恶意服务器回传敏感数据的逻辑，也没有检测到静默修改系统Host、下载后门脚本或持久化操作的行为。然而，由于该POC涉及XSLT注入这种极其危险的利用方式，使用者需注意其执行的{command}参数。由于该脚本在命令行直接传递指令，若脚本在不可信的自动化扫描器中运行，可能导致非预期的本地命令执行风险。此外，由于此类高价值CVE的POC常被黑客利用进行“二次投毒”（即在看似合法的脚本中嵌入静默执行的Shell），防御研究人员在下载此类POC时，应始终在隔离沙箱环境中审计代码，并重点检查ds:SignatureValue以外的额外HTTP请求或本地文件操作。目前该样本属于干净的PoC工具，未发现植入迹象。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2022-47966](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2022-47966)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-47966](https://nvd.nist.gov/vuln/detail/CVE-2022-47966)
