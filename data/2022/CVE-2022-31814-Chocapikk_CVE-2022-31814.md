## CVE-2022-31814 - pfSense pfBlockerNG 插件 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-31814

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** pfSense pfBlockerNG 插件

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 2.1.4_26

**利用条件:** 无需身份验证，目标系统需安装并启用 pfBlockerNG 插件，且 Web 服务可被远程访问。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个功能完整的Python渗透测试脚本，专门针对pfSense的pfBlockerNG插件中的未授权远程代码执行漏洞。该漏洞源于插件在处理特定HTTP头部（如Host）时未进行充分的过滤，导致恶意注入的代码被传递至系统命令执行环境。POC通过构造包含Base64编码的PHP WebShell的恶意Host头请求，利用受影响脚本（/pfblockerng/www/index.php）将其写入Web目录。经过分析，该POC包含完整的生命周期管理：首先验证目标是否存在漏洞路径，随后通过精心构造的Payload上传名为system_advanced_control.php的持久化后门。它支持单目标模式和多目标线程扫描，具备良好的交互式Shell功能，并能自动清理痕迹，这使得该POC在防御性安全研究和实战评估中具有极高的有效性。利用步骤：1. 确认目标pfSense系统暴露了Web界面并安装了pfBlockerNG版本2.1.4_26或更早版本。2. 执行POC脚本，使用 -i 参数指定目标URL，利用脚本会自动向 /pfblockerng/www/index.php 发送包含命令注入载荷的HTTP请求。3. 脚本通过注入 echo 命令将Base64编码后的PHP代码写入到服务器的 /usr/local/www/ 目录下。4. 成功后，脚本会通过访问新生成的PHP文件执行任意系统命令，并通过交互式界面回显结果。投毒风险分析：经过对提供的Python源代码进行静态分析，未发现明显的投毒迹象或恶意后门。脚本导入的库如requests、concurrent.futures、rich和prompt_toolkit均为标准的Python开发和命令行美化库，未见加载远程不明二进制文件或加密Shellcode的行为。脚本中的Payload部分虽涉及Base64编码，但解码后确认为用于漏洞利用的WebShell逻辑，并非针对攻击者机器的恶意载荷。然而，由于该POC包含自动扫描和批量攻击功能（-l 参数），在未受控的环境下运行可能导致意外的法律风险或对目标系统造成不可逆的破坏。虽然代码本身透明且清晰，但鉴于此类漏洞在野利用活跃，用户在从第三方GitHub仓库下载此类脚本时，仍需警惕开发者可能在未公开的代码段中加入针对攻击者IP的追踪脚本或在Payload中隐藏第二层后门。当前版本代码逻辑单纯，属于低风险等级的防御研究工具。

**项目地址:** [https://github.com/HassanKhanYusufzai/CVE-2022-31814](https://www.google.com/search?q=https://github.com/HassanKhanYusufzai/CVE-2022-31814)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-31814](https://nvd.nist.gov/vuln/detail/CVE-2022-31814)
