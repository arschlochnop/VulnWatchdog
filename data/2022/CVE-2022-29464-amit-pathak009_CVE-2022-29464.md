## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 Analytics, WSO2 Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; WSO2 Identity Server 5.2.0及以上至5.11.0; WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0及以上; WSO2 Enterprise Integrator 6.2.0及以上

**利用条件:** 无需认证，可通过互联网直接访问受影响的/fileupload端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC利用了WSO2产品中FileUploadServlet对上传路径校验不严的缺陷。漏洞核心在于/fileupload接口未经过身份验证过滤，且允许攻击者通过目录穿越或直接在Web可访问目录下写入任意文件。分析提供的代码片段可见，程序在handleSecurity安全检查中显式放行了以/fileupload结尾或包含该路径的请求，导致攻击者能够绕过IAM认证框架。通过向该端点发送包含恶意JSP脚本的多部分表单数据，攻击者可以将Webshell直接写入服务器目录。此POC逻辑清晰，直接针对FileUploadServlet的实现逻辑进行构造，利用过程仅需构造一个特定的HTTP POST请求，成功率极高，属于高可靠性的RCE漏洞利用方案。针对该漏洞的利用通常涉及将JSP文件写入../repository/deployment/server/webapps/目录下，从而实现持久化访问。【利用步骤】1. 识别目标系统是否暴露WSO2管理界面。2. 构造包含恶意Payload的JSP Webshell。3. 使用HTTP POST请求发送至/fileupload端点，并在Content-Disposition头部指定文件名及路径。4. 通过浏览器或命令行访问上传后的JSP文件URL以触发代码执行。5. 获取系统权限进行后续渗透操作。【投毒风险分析】目前披露的hakivvi开源仓库代码结构透明，主要使用Python编写，且逻辑仅限于漏洞触发演示，未发现混淆代码或异常的外部链接。然而，由于该漏洞影响范围极广且危害极大，此类POC经常被黑客修改并重新发布在非官方渠道。潜在风险点包括：1. 恶意修改利用逻辑，在上传JSP的同时静默下载并执行勒索软件或挖矿程序。2. POC工具可能被植入DNSLog外带脚本，用于收集执行此脚本的防御研究员的资产信息。3. 某些变体可能会包含Base64混淆的Payload，试图绕过EDR检测的同时在研究员本地环境执行破坏性操作。经评估，本POC仓库源码库目前处于安全范围内，但研究员在下载使用第三方编译版本或脚本时应保持警惕，建议在隔离环境测试。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
