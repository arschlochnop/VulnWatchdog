## CVE-2022-29464 - WSO2 API Manager, Identity Server, Analytics, Micro Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, Identity Server, Analytics, Micro Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Identity Server Analytics 5.4.0 - 5.6.0; Identity Server as Key Manager 5.3.0 - 5.11.0; Micro Integrator 1.0.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无须认证，能够访问 /fileupload 接口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC是一个针对CVE-2022-29464的高效利用脚本。该漏洞源于WSO2多个产品中对文件上传路径校验不严，存在路径穿越漏洞。POC代码通过Python的requests库向目标服务器的 /fileupload/toolsAny 接口发送一个POST请求。其核心逻辑在于构造了一个特殊的multipart表单数据，其中的文件名通过路径穿越符号 '../../../../repository/deployment/server/webapps/authenticationendpoint/' 将JSP木马写入到Web可访问的目录下。由于WSO2的这些组件默认配置下对该目录具有执行权限，攻击者可以直接通过HTTP请求访问上传的JSP文件，从而在服务器上下文执行系统命令。该POC包含了完整的WebShell Payload，使用了Java的Runtime.getRuntime().exec()方法来处理命令执行并捕获回显，是一个极具实战价值且验证门槛极低的工具。从技术角度看，此POC直接利用了WSO2 Carbon框架中处理上传的逻辑缺陷，攻击者无需任何预备知识或账户凭证即可获取目标服务器的完全控制权。利用步骤：1. 确认目标主机运行了受影响版本的WSO2产品并暴露了9443或其他管理端口。2. 准备Python3环境并安装requests库。3. 运行脚本：python3 exploit.py <目标URL> <自定义文件名.jsp>。4. 脚本会通过POST请求将内置的JSP WebShell上传至 /authenticationendpoint/ 目录下。5. 成功后，访问返回的URL，在页面输入框中输入系统命令（如 id, whoami）并提交，即可在网页端查看命令输出结果。投毒风险分析：该POC代码逻辑清晰、透明，主要依赖Python标准库及requests库。经过对exploit.py源码的静态审计，未发现任何恶意混淆代码、外部非法请求（如反弹Shell回传到第三方IP）或敏感信息窃取行为。脚本中定义的代理变量（proxies）默认指向本地127.0.0.1:8080，这通常是安全研究员为了方便通过Burp Suite进行抓包调试而留下的设置，属于正常的开发习惯，而非恶意投毒迹象。POC中包含的JSP WebShell是用于证明漏洞存在及其危害性的标准Payload，其行为是响应用户的命令输入并在页面回显，没有发现自动下载并运行挖矿程序、勒索软件或其他持久化后门的隐藏逻辑。代码结构简洁，所有操作均在用户的显式操作下执行，未发现任何尝试绕过用户意识的后台静默操作。因此，该POC被判定为低投毒风险，可以作为合法的防御性安全研究参考，但仍建议在隔离的沙箱环境或受控的实验室网络中运行，以防万一。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
