## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor 类进行插值解析。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC是一个结构完整的防御性研究示例，包含了Dockerfile、README文档和基础的Maven项目结构。其核心利用逻辑基于Apache Commons Text的StringSubstitutor类在处理特定前缀（如script、dns、url）时的缺陷。代码中展示了三种典型的利用向量：首先是使用'script:javascript'前缀执行Java运行时命令，例如'java.lang.Runtime.getRuntime().exec()'，这可以直接在目标服务器上实现任意命令执行；其次是利用'dns'和'url'前缀进行带外（OOB）攻击验证。经分析，该POC通过Docker容器化部署，提供了一个预配置的Spring Boot Web环境，用户只需发送一个包含恶意插值字符串的HTTP请求即可触发漏洞。README详细记录了从构建到验证（创建/tmp/blop文件及反弹Shell）的全过程。该POC在防御研究中极具价值，因为它清晰地演示了受影响类的调用方式及Payload的构造逻辑。利用步骤：1. 环境准备：确保本地安装有Docker、Java和Maven；2. 编译项目：运行'mvn clean package'生成可执行JAR包；3. 构建镜像：使用'docker build'命令基于提供的Dockerfile构建容器；4. 启动服务：运行容器并将8081端口映射到宿主机；5. 漏洞触发：通过浏览器或curl访问目标URL，提交Payload如'${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}'；6. 验证结果：通过'docker exec'查看容器内部/tmp目录是否生成测试文件，或启动nc监听实现反弹Shell。投毒风险分析：该POC的投毒风险极低。首先，源代码结构透明，使用的mvnw包装器和pom.xml配置均指向官方镜像源或标准Maven库，未发现混淆代码或隐蔽的下载脚本。其次，README中提到的外部Docker镜像（korteke/text4shell）属于已知的安全研究员分享，且其Dockerfile内容与本地代码一致，不含恶意后门。虽然该POC包含反弹Shell的演示，但这属于安全研究中标准的功能验证，而非针对研究者本机的攻击。唯一需要注意的是，在未受信任的环境中直接运行预构建的二进制文件或镜像存在常规风险，但在本项目中，由于提供了完整的源代码和Dockerfile，研究员可以完全通过源码审计和本地构建来规避潜在的供应链干扰。整体来看，该存储库是一个纯粹的教学与研究工具，未发现针对防御方的恶意投毒意图。

**项目地址:** [https://github.com/korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
