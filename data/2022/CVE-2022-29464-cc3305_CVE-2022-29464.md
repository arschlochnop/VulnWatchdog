## CVE-2022-29464 - WSO2 Identity Server / API Manager / Enterprise Integrator 任意文件上传导致RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传导致RCE

**影响应用:** WSO2 Identity Server / API Manager / Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Enterprise Integrator 6.2.0 - 6.6.0; 等

**利用条件:** 无需身份验证，远程网络可访问目标服务器端点

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

CVE-2022-29464是由安全研究员Orange Tsai发现的一个严重漏洞，存在于WSO2多个产品的fileupload端点中。该漏洞的根源在于文件上传逻辑中缺乏足够的路径过滤和身份验证，导致攻击者可以通过构建特定的HTTP POST请求，将任意JSP文件上传至服务器的Web运行目录下。一旦文件上传成功，攻击者便可以通过访问该JSP页面实现远程代码执行（RCE）。【POC有效性分析】：输入的POC代码是一个成熟的Python利用脚本，由cc3305开发。代码结构严谨，使用了argparse处理参数，支持代理、自定义Header和Cookie。关键逻辑在于利用`/fileupload/toolsAny`端点进行上传，代码通过multipart/form-data格式封装payload，目标路径通常硬编码或自动推导为服务器的部署目录。脚本还包含了一个`-C`参数用于执行后续命令，体现了从上传到执行的完整利用链。根据搜索结果验证，该POC与GitHub上流传的主流利用方案一致，在复现环境中表现出极高的成功率。【利用步骤】：1. 确定目标地址及对应的fileupload端点（通常为/fileupload/toolsAny）。2. 准备Webshell载荷（如JSP木马）。3. 运行脚本，指定目标URL及Payload文件，脚本会自动尝试将文件写入Web目录。4. 访问上传后的URL路径触发JSP解析。5. 通过返回的Shell环境执行系统命令。【投毒风险分析】：经过对提供的Python源代码进行深入静态审计，未发现明显的恶意行为。代码逻辑清晰，主要依赖requests和urllib3等标准库，未见混淆处理、未授权的外部域名通信或隐藏的本地文件读写操作。虽然脚本具有攻击性，但其行为完全受控于用户输入的参数。常见的投毒风险点如内嵌Base64加密的可执行文件、自动化收集环境信息的后门代码在此POC中均不存在。风险评分极低，主要风险在于使用者若不具备代码审计能力，在从不可信来源下载衍生版本时可能遭遇二次打包注入。该POC目前被视为安全研究和防御性测试的合法工具，但在使用时建议在隔离环境内运行，并严格监控网络出口流量。通过对GitHub相关仓库的交叉比对，目前的开源实现大多为学术及渗透测试用途，投毒概率处于安全红线以下。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
