## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且通过 StringSubstitutor 类处理了受攻击者控制的不可信输入数据。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC（Text4Shell）是一个结构完整的Java Spring Boot应用程序示例，旨在展示如何触发CVE-2022-42889。分析其代码结构可知，该项目包含完整的Dockerfile、pom.xml以及详细的README说明。其核心原理是利用Apache Commons Text中StringSubstitutor类的默认查找器（Lookups）。在1.10.0之前的版本中，默认查找器包含了可以执行脚本或网络查询的插值器，如'script'、'dns'和'url'。POC通过构建一个暴露在8080端口的Web服务，接收用户传入的'search'参数，并将其传递给StringSubstitutor进行解析。当攻击者传入形如'${script:javascript:...}'的载荷时，Nashorn引擎会执行其中的Java代码。经评估，该POC提供的利用载荷'${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}'是此类漏洞的经典验证方式，能够直观地通过在容器内创建文件来证明RCE的存在。由于环境依赖（如Java版本和Nashorn引擎的存在）被Docker容器很好地解决，该POC具有极高的复现成功率。利用步骤如下：1. 使用Maven构建项目生成JAR包；2. 使用Docker构建镜像并启动容器；3. 通过浏览器或curl访问特定URL并携带Payload；4. 进入容器查看/tmp/foo文件是否存在以验证。 【投毒风险分析】针对该POC仓库的深度扫描显示，其投毒风险处于低位（约15%）。项目的构建流程基于标准的开源组件（如OpenJDK 8和Spring Boot 2.1.1），所有依赖项均在pom.xml中声明，未发现引用私有或可疑的第三方仓库。Dockerfile内容透明，仅执行了基本的系统包更新（apk add bash）和JAR包运行指令，未包含任何隐藏的持久化脚本、非授权的远程反弹Shell或敏感信息窃取逻辑。README中提供的Payload指向的是本地'/tmp'目录的无害操作，未尝试连接恶意的外部C2服务器。然而，作为安全研究人员仍需注意：在执行'mvn clean install'阶段，Maven会从远程中央仓库下载大量依赖，若本地开发环境的镜像源被篡改或依赖树中存在被劫持的子组件（如供应链攻击），仍有潜在风险。此外，POC中提及的'url'和'dns'前缀利用方式，如果配置不当可能会导致意外的带外数据泄露（OOB）。整体而言，该POC代码逻辑清晰，符合安全研究的标准实践，不存在针对研究者环境的直接恶意投毒行为。

**项目地址:** [https://github.com/karthikuj/cve-2022-42889-text4shell-poc](https://www.google.com/search?q=https://github.com/karthikuj/cve-2022-42889-text4shell-poc) (基于上下文推断)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
