## CVE-2022-26134 - Confluence RCE

**漏洞编号:** CVE-2022-26134

**漏洞类型:** RCE

**影响应用:** Confluence

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** 未提供明确的版本范围，需根据实际情况判断

**利用条件:** Pre-Auth, 需要网络可达

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2022-26134是Confluence中的一个远程代码执行（RCE）漏洞，允许未经身份验证的攻击者执行任意代码。该漏洞的根本原因是OGNL注入。POC代码的有效性分析如下：

POC代码（`exploit.py`）首先检查目标Confluence实例的版本。它通过发送一个GET请求到`/login.action`端点，然后解析响应中的`<span id='footer-build-information'>`标签来提取版本信息。如果无法确定版本，它仍然会尝试利用该漏洞。该脚本使用精心构造的HTTP GET请求来触发OGNL注入漏洞。特别构造的URL包含一个OGNL表达式，该表达式利用`@java.lang.Runtime@getRuntime().exec()`执行操作系统命令。命令执行的结果通过`@org.apache.commons.io.IOUtils@toString()`读取，并通过`X-Cmd-Response` HTTP头返回。漏洞利用过程无需身份验证，并且可以通过简单的HTTP请求触发，这使得攻击复杂度非常低。

利用步骤如下：

1.  克隆POC代码库：`git clone https://github.com/crowsec-edtech/CVE-2022-26134`
2.  进入POC代码目录：`cd CVE-2022-26134`
3.  运行exploit.py脚本，提供目标Confluence实例的URL和要执行的命令：`python3 exploit.py https://target.com 'id'`。例如, 使用命令`id`可以用来验证漏洞是否存在，并获得被攻击服务器的用户身份。
4.  检查脚本的输出，它应该包含命令执行的结果。

投毒风险分析：

该POC代码的投毒风险较低，约为15%。主要原因如下：

*   代码清晰易懂：`exploit.py`脚本使用标准的Python库（requests，BeautifulSoup）实现，代码结构清晰，没有使用混淆技术。容易检查出是否存在恶意代码。
*   依赖可信库：脚本依赖于requests和BeautifulSoup4库，这些库是广泛使用的，并且经过了安全审查。
*   无恶意行为：脚本的主要目的是利用漏洞执行命令，没有发现任何试图安装后门、窃取数据或进行其他恶意活动的代码。
*   请求头控制：攻击者可以控制User-Agent请求头, 有轻微的信息泄露风险。

尽管风险较低，但仍需注意以下几点：

*   该脚本可能被修改为执行恶意命令，因此在使用前应仔细审查代码。
*   攻击者可能会创建类似的POC代码，其中包含恶意功能，因此需要保持警惕。
总而言之，CVE-2022-26134是一个严重的安全漏洞，需要尽快修补。提供的POC代码是一个有价值的工具，可以用来验证漏洞是否存在，但使用时需要谨慎，并仔细审查代码以确保安全。

**项目地址:** https://github.com/crowsec-edtech/CVE-2022-26134

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2022-26134
