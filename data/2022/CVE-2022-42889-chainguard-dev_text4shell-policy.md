## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序必须使用受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor.replace() 或 StringLookupFactory 中的变量替换功能。默认情况下，导致该漏洞的脚本引擎插值器（script/dns/url）在受影响版本中是开启的。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞被称为 Text4shell。其核心原因在于 Apache Commons Text 库中的 StringSubstitutor 类提供的插值功能过于强大，默认支持包括 'script'、'dns' 和 'url' 在内的多种前缀。攻击者可以通过构造形如 ${script:javascript:java.lang.Runtime.getRuntime().exec('command')} 的 payload，利用 Nashorn 脚本引擎执行任意 Java 代码。提供的 POC 搜索结果显示，漏洞利用主要针对 1.5 到 1.9 版本。POC 代码库 cryxnet/CVE-2022-42889-RCE 提供了一个清晰的 Java 实现示例，演示了如何通过暴露的 API 触发代码执行。虽然该漏洞在知名度上曾被比作 Log4shell，但由于 StringSubstitutor 在业务代码中的暴露程度远低于 Log4j 的日志接口，其大规模自动化的影响面相对受限，但在特定应用场景下依然是毁灭性的。利用步骤如下：1. 识别目标应用是否使用了 Apache Commons Text 且暴露了字符串替换接口；2. 构造包含脚本插值符的 HTTP 请求（如 GET 参数或 POST Body）；3. 目标服务器解析字符串时触发 script 查找器；4. 执行 payload 中定义的恶意指令。 【投毒风险分析】目前公开的 POC 项目如 cryxnet 及其相关 Docker 演示镜像主要用于安全研究和合规性验证（如 Sigstore 签名校验演示）。通过对提供的文件分析，Dockerfile 基于 Chainguard 的 JDK 镜像，README 指向了合规性工具 Cosign 的使用。这些资源本身并非投毒脚本，其目的是为了展示安全扫描和镜像验证流程。然而，由于该漏洞利用门槛极低且 Payload 为纯字符串，在威胁情报市场中，容易出现伪装成漏洞测试脚本（Exploit Script）的投毒包。例如，一些 Python 封装的自动检测工具可能会在后台通过 eval() 或 os.system() 执行攻击者自己的后门代码。但在当前提供的输入数据中，代码透明度较高，主要集中在 Maven 构建配置和云原生部署声明上，未发现明显的代码混淆、非法外部连接或恶意注入逻辑，投毒风险处于较低水平（10%）。建议防御者在从非官方 GitHub 仓库下载此类 POC 时，重点检查脚本中的网络通信模块和 Base64 加密的命令执行部分，防止在测试过程中被反向控台。

**项目地址:** [https://github.com/cryxnet/CVE-2022-42889-RCE](https://github.com/cryxnet/CVE-2022-42889-RCE)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)
