## CVE-2022-31814 - pfSense pfBlockerNG插件 RCE/命令注入

**漏洞编号:** CVE-2022-31814

**漏洞类型:** RCE/命令注入

**影响应用:** pfSense pfBlockerNG插件

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** pfBlockerNG <= 2.1.4_26

**利用条件:** 远程未经身份验证的网络访问

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个功能完善的渗透测试工具包，被命名为'SenselessViolence'。它通过针对pfSense的pfBlockerNG插件中的Host头注入漏洞来实现远程代码执行（RCE）。该脚本的有效性极高，因为它不仅提供了基础的攻击向量，还集成了类似NSA设计理念的模块化结构。其核心逻辑通过四个阶段（touch, probe, exploit, cleanup）确保护送载荷的成功率。其中'probe'模式通过注入不同时长的sleep命令（1秒和10秒）并测量响应时间差来验证漏洞存在，这是一种非常可靠且低噪声的非破坏性检测方法。'exploit'模式通过三步走策略：首先利用GET请求植入Webshell，随后利用该Webshell通过POST请求上传真正的木马文件，最后触发执行。这种多阶段上传方式能绕过许多简单的WAF过滤。此外，POC还提供了自动化的Nuclei扫描模板，能够批量识别潜在目标，使其从一个简单的脚本提升到了武器化工具的级别。利用步骤：1. 使用'touch'模式验证目标是否为pfSense系统及插件路径是否存在。2. 使用'probe'模式进行带外时间差检测，确认注入点有效。3. 配置本地监听环境（cbhost/cbport）。4. 执行'exploit'模式，脚本将自动完成Webshell植入、载荷上传和命令触发。5. 攻击完成后，运行'cleanup'模式，利用预设的脚本清理日志和删除残留文件。投毒风险分析：经过对该POC描述及代码逻辑的审计，其投毒风险较低。代码主要使用标准Python库编写，且作者明确表示不直接运行从NSA泄露的nopen二进制文件，而是提供了一个透明的Python反弹Shell载荷作为替代，这体现了较高的透明度。脚本中虽然包含自动化清理功能，但这属于攻击工具的常规隐藏属性，而非针对研究者本人的恶意行为。然而，由于该工具支持加载外部‘trojan’文件，用户需警惕来源不明的二进制载荷。在防御性研究场景下，风险点在于‘cleanup’模式可能由于权限或路径问题清理不彻底，或者在高度监控的环境中触发告警。总体而言，该代码逻辑清晰，没有发现针对执行者的混淆代码、隐藏的后门网络连接或敏感信息窃取行为，主要的风险来自于其强大的破坏力可能导致研究人员在未授权测试时造成目标系统宕机或数据丢失。

**项目地址:** [https://github.com/IHTeam/Pfsense-CVE-2022-31814](https://www.google.com/search?q=https://github.com/IHTeam/Pfsense-CVE-2022-31814)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-31814](https://nvd.nist.gov/vuln/detail/CVE-2022-31814)
