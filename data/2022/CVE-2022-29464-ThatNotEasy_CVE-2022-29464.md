## CVE-2022-29464 - WSO2 Identity Server / API Manager / Enterprise Integrator RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 Identity Server / API Manager / Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; Identity Server 5.2.0及以上至5.11.0; IS as Key Manager 5.3.0及以上至5.11.0; Enterprise Integrator 6.2.0及以上至6.6.0

**利用条件:** 无需认证，可通过网络直接访问受影响的 /fileupload 接口

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC由Pari Malam编写，是一个基于Python的多线程漏洞利用工具。代码逻辑显示其旨在扫描并利用WSO2产品中的CVE-2022-29464漏洞。该漏洞的本质是由于WSO2内部FileUploadServlet组件中路径遍历导致的非授权文件上传。POC通过向受影响的端点（如/fileupload/toolsAny）发送包含恶意JSP脚本的多部分表单数据。如果服务器存在漏洞，它将无法正确验证上传路径，允许攻击者将JSP文件写入Web根目录下的任意位置（通常是../repository/deployment/server/webapps/目录下）。一旦上传成功，攻击者通过直接访问该JSP的URL路径即可触发远程代码执行。从代码结构看，该POC包含了目标导入、存活检测、Payload发送及结果记录功能。由于使用了concurrent.futures进行多线程并发，其大规模扫描效率较高。POC中调用的requests库设置了verify=False，以忽略HTTPS证书验证，这是渗透测试工具的常规做法。利用步骤：1. 准备目标列表文件。2. 运行wso.py，工具会自动创建Results目录。3. 程序通过HTTP POST请求尝试向目标的/fileupload接口上传伪造的JSP shell。4. 若服务器返回200状态码并确认文件路径存在，则判定为漏洞存在。5. 攻击者通过浏览器或curl访问上传后的URL获取服务器权限。投毒风险分析：该POC属于低到中度投毒风险级别。代码中虽然使用了os.system('clear' if os.name == 'posix' else 'cls')等系统调用，但主要用于界面清理，不具备恶意持久化特征。代码库导入了标准的requests和colorama，未发现引入第三方混淆加密的二进制文件。然而，风险点在于：第一，该工具作者在README中使用了极具个人色彩且带有挑衅意味的语言（如'Don't suyyyyyyyy me'），此类匿名性较高的开发者发布的工具往往存在后续更新中植入后门的可能。第二，虽然当前分析的部分代码未见反弹Shell到攻击者服务器的行为，但README中提及的'Get start with'引导用户执行git clone并运行pip install，这在供应链攻击中是常见的投毒路径。若仓库的依赖文件requirements.txt中被篡改，或wso.py后续包含混淆的base64字符串，则可能在执行过程中静默下载并执行恶意Payload。防御建议：组织应立即自查WSO2相关服务的补丁情况，禁用不必要的/fileupload端点，并在WAF上配置针对路径遍历字符（如../）和.jsp文件上传的拦截规则。

**项目地址:** [https://github.com/Pari-Malam/CVE-2022-29464](https://github.com/Pari-Malam/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
