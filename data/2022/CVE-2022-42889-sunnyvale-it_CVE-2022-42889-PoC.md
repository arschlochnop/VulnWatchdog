## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 through 1.9

**利用条件:** 无需身份验证，目标应用需使用了受影响版本的 Apache Commons Text 库，并且通过 StringLookupFactory 默认插值器处理了用户可控的不可信输入。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC项目是一个极其完整且标准化的防御性安全研究示例。它基于Spring Boot构建了一个易受攻击的Web服务环境，并通过Docker容器化技术实现了环境的快速部署。其核心逻辑在于展示了如何通过Apache Commons Text的插值器（Interpolators）特性触发远程代码执行。在POC代码中，通过传入带有特定前缀（如script:javascript）的字符串，利用Java ScriptEngine机制执行任意代码。在该示例中，利用代码为`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/p0wned')}`，这是一个经典的无害化验证（Proof of Work），通过在容器内创建特定文件来证明代码执行权限。代码逻辑清晰，依赖关系明确（Maven构建），经分析其利用链条完整且与官方披露的Text4Shell原理完全吻合。利用步骤如下：1. 使用Docker构建镜像，自动拉取Maven依赖并编译Spring Boot应用；2. 启动容器并映射8080端口；3. 使用curl向目标发送精心构造的URL编码后的Payload；4. 通过docker exec命令检查容器内/tmp/p0wned文件是否存在以验证结果。该POC对于安全研究人员理解漏洞触发点、测试扫描器的检出率具有极高的价值。其利用方式简单直接，极易被转化为自动化扫描工具，因此在防御层面，必须尽快升级Apache Commons Text版本至1.10.0或更高。 【投毒风险分析】经过深入的代码审计，该POC项目的投毒风险极低（约5%）。项目结构采用标准的Java Maven目录，Dockerfile文件内容透明，其构建过程完全依赖官方合规镜像（maven:3.8.6和openjdk:8-jdk-alpine），未发现隐藏的外部恶意下载链接或镜像劫持行为。README文档详细说明了利用逻辑，Payload仅为touch命令，不涉及反弹Shell或窃取敏感信息的恶意操作。分析其源码，未见任何代码混淆、base64加密的恶意payload、或者在构建阶段插入的预处理器钩子。虽然该POC能实现RCE，但其设计初衷显然是教学与验证。低风险评分主要是基于互联网上此类公开POC可能被恶意第三方克隆并二次修改的可能性，建议研究人员在使用前务必核对源码及依赖项（pom.xml），防止攻击者在依赖仓库中引入恶意组件。当前提供的代码片段及结构是安全且可用于研究的。

**项目地址:** [https://github.com/sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
