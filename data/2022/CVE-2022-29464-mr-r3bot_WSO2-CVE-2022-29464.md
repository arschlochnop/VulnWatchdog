## CVE-2022-29464 - WSO2 API Manager, Identity Server, Enterprise Integrator, Dashboard, API Microgateway RCE/任意文件上传

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE/任意文件上传

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Dashboard, API Microgateway

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; Identity Server 5.2.0及以上至5.11.0; Identity Server Analytics 5.4.0, 5.4.1, 5.5.0及以上至5.6.0; Enterprise Integrator 6.2.0及以上至6.6.0

**利用条件:** 无需认证，可通过网络直接访问受影响的/fileupload端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞是由于WSO2产品中负责文件上传的servlet未进行身份验证，且在处理文件名时未过滤路径遍历序列（../）导致的。提供的POC代码包含一个Python利用脚本（exploit.py）和一个标准的Java JSP一句话木马（cmd.jsp）。分析代码发现，exploit.py通过POST请求将cmd.jsp上传至服务器。利用的核心在于请求的文件名参数被构造为'../../../../repository/deployment/server/webapps/authenticationendpoint/cmd.jsp'，这利用了路径遍历漏洞将JSP文件写入到Web应用程序的根目录下，从而允许通过浏览器直接访问。该POC非常完整且有效，攻击者只需指定目标URL，脚本即可自动完成上传并返回Webshell地址。利用步骤：1. 攻击者准备包含恶意Java代码的JSP文件。2. 使用requests库向目标的/fileupload/toolsAny端点发送Multipart POST请求。3. 在文件名部分使用目录遍历符，将JSP文件强制写入Web目录。4. 访问上传后的路径执行系统命令。该漏洞已列入CISA已知被利用漏洞清单，证明了其实际威胁极大。投毒风险分析：经过对提供的POC源码进行静态审计，未发现明显的投毒行为。exploit.py代码逻辑清晰，仅依赖标准的argparse和requests库，没有引入第三方不可信依赖。其代码操作仅限于向指定URL发送POST请求，并没有尝试窃取本地环境变量、SSH密钥或执行除上传逻辑外的任何本地系统命令。cmd.jsp是一个经典的JSP交互式Shell，其功能是接收cmd参数并执行Runtime.exec()，这是安全研究中常用的Payload，其行为是透明且可控的。脚本中虽然关闭了SSL校验（verify=False），但这在针对自签名证书的内部系统测试中是常规做法。唯一的风险点在于攻击者可能通过修改URL或在JSP中注入恶意回连代码来实现持久化，但就目前的POC内容来看，它是一个干净、纯粹的安全研究工具，不存在恶意投毒特征。建议用户在隔离的沙箱环境中运行此类脚本，以确保绝对安全。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
