## CVE-2022-29464 - WSO2 API Manager, WSO2 Identity Server, WSO2 IS as Key Manager, WSO2 Enterprise Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 IS as Key Manager, WSO2 Enterprise Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0及以上至4.0.0; WSO2 Identity Server 5.2.0及以上至5.11.0; WSO2 IS as Key Manager 5.3.0及以上至5.11.0; WSO2 Enterprise Integrator 6.2.0及以上至6.6.0

**利用条件:** 无需身份验证，可通过网络直接访问受影响的 /fileupload 端点

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC代码针对CVE-2022-29464漏洞展示了极高的有效性和实用性。漏洞核心源于WSO2产品中`/fileupload`端点存在的未授权任意文件上传漏洞。代码通过构造一个多部分表单（multipart/form-data）请求，利用路径遍历字符`../../../../`将恶意的JSP Webshell上传至服务器的可访问Web目录（如`authenticationendpoint`）。分析POC代码可知，其逻辑清晰：首先定义了一个包含标准Java命令执行能力的JSP脚本，然后通过`requests.post`方法将该脚本发送至目标系统的`/fileupload/toolsAny`接口。由于受影响版本缺乏对上传路径和文件类型的校验，攻击者可以跨越目录限制，将文件放置在Tomcat或其他Web容器会自动解析的目录下。此POC之所以有效，是因为它精准捕捉了WSO2在文件上传处理器中的逻辑缺陷，且不需要任何凭据即可完成攻击。该脚本仅依赖标准的Python库（requests, urllib3），且在代码层面直接展示了利用链条，从上传到回显路径的构造都符合漏洞披露的技术特征，是一个高度可用的武器化工具。【利用步骤】1. 环境准备：确保安装了Python 3及requests库。2. 确定目标：获取目标WSO2服务器的URL（通常端口为9443）。3. 执行脚本：运行命令 `python3 exploit.py <target> <filename>`。4. 漏洞触发：脚本会自动构造路径遍历负载并将JSP Webshell写入服务器目录。5. 远程控制：成功后，访问脚本输出的URL，通过Web表单输入系统命令即可获取服务器控制权。【投毒风险分析】经过深入的代码审计，该POC的投毒风险极低（约5%）。首先，代码结构非常透明，逻辑完全暴露，没有进行任何形式的混淆或加密处理。其次，脚本中使用的所有库均为Python标准库或广为人知的第三方库（requests），不涉及从外部服务器下载可执行文件或执行未知的远程二进制流。在关键的Shell部分，虽然包含了一个典型的Java反序列化执行逻辑，但这是为了证明RCE漏洞存在的必要Payload，而非隐藏的恶意后门。唯一潜在的风险在于用户可能会在未经授权的情况下对他人的系统执行此代码，但这属于工具滥用而非代码投毒。该POC没有发现窃取本地凭据（如环境变量、SSH Key或浏览器Cookie）的行为，也没有发现任何外连C2（指挥与控制）服务器的痕迹。对于防御性安全研究员而言，此代码是安全的，可以直接用于受控环境下的漏洞复现和安全验证。建议在使用前自行检查Webshell的内容，以确保其仅包含预期的测试功能。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)
