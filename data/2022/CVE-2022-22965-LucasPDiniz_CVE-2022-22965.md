# CVE-2022-22965

> ðŸ“¦ è¯¥CVEæœ‰ **26** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22965-0xrobiul_CVE-2022-22965.md](../2022/CVE-2022-22965-0xrobiul_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨éœ€è¦éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚æœç´¢å¼•æ“Žç»“æžœè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åªåŒ…å« GNU GPL åè®®ï¼Œä¸åŒ…å«ä»»ä½•ä¸Žæ¼æ´žåˆ©ç”¨ç›¸å…³çš„ä»£ç ã€‚æ— æ³•é€šè¿‡æ­¤ä»£ç åˆ†æžæ˜¯å¦å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚ç”±äºŽæä¾›çš„ä»£ç å¹¶éžå®žé™…çš„POCä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®žé™…çŽ¯å¢ƒä¸­åˆ©ç”¨ä»£ç å¯èƒ½å­˜åœ¨æŠ•æ¯’ï¼Œä½†éœ€è¿›ä¸€æ­¥åˆ†æžå…·ä½“POCä»£ç æ‰èƒ½åˆ¤æ–­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ¼æ´žåˆ©ç”¨æ–¹å¼ä¸»è¦æ¶‰åŠåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ° Web ç›®å½•ï¼Œç„¶åŽå†™å…¥æ¶æ„ JSP ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å’Œå…¶ä»–ç›¸å…³å±žæ€§æ¥å®žçŽ° RCEã€‚ä¸€äº›åˆ©ç”¨æ–¹å¼è¿˜æ¶‰åŠ Spring Expression Language (SpEL) æ³¨å…¥ã€‚

**æŽ’åºä¼˜å…ˆçº§ç†ç”±ï¼š**
*   **æœç´¢å¼•æ“Žç»“æžœï¼š** ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†å…³äºŽè¯¥æ¼æ´žçš„å®žé™…åˆ©ç”¨æƒ…å†µå’Œå½±å“çš„æœ€æ–°ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²è¢«ç§¯æžåˆ©ç”¨çš„è¯æ®ã€‚
*   **æ¼æ´žåˆ©ç”¨ä»£ç ï¼š** ä¼˜å…ˆçº§ç¬¬äºŒï¼Œå› ä¸ºçœŸå®žçš„POCä»£ç èƒ½æä¾›æœ€ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨æ–¹å¼éªŒè¯ï¼Œä½†æœ¬æ¬¡æä¾›çš„ä¸æ˜¯æœ‰æ•ˆPOCä»£ç ï¼Œæ— æ³•æœ‰æ•ˆåˆ†æžæ¼æ´žã€‚
*   **æ¼æ´žåº“ä¿¡æ¯ï¼š** ä¼˜å…ˆçº§æœ€ä½Žï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸åªæä¾›æ¼æ´žçš„æ¦‚è¦æè¿°ï¼Œè€Œä¸æä¾›å®žé™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚


**é¡¹ç›®åœ°å€:** [0xrobiul/CVE-2022-22965](https://github.com/0xrobiul/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #2

**æ¥æº**: [CVE-2022-22965-Aur3ns_Block-Spring4Shell.md](../2022/CVE-2022-22965-Aur3ns_Block-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X (prior to 5.3.18+), 5.2.x (prior to 5.2.20+) å’Œæ‰€æœ‰æ—§ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WARéƒ¨ç½²ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨ç­‰å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žæ˜¯ä¸€ä¸ªçœŸå®žå­˜åœ¨ä¸”å·²è¢«ç§¯æžåˆ©ç”¨çš„æ¼æ´žã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™æœåŠ¡å™¨ï¼Œæ—¨åœ¨æ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„æ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´žã€‚å› æ­¤ï¼ŒPOCä»£ç æœ¬èº«çš„æœ‰æ•ˆæ€§åœ¨äºŽå…¶é˜²å¾¡èƒ½åŠ›ï¼Œè€Œéžæ”»å‡»èƒ½åŠ›ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

åˆ†æžæä¾›çš„ frs.py è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„é˜²ç«å¢™ï¼Œç”¨æ¥æ£€æµ‹ç‰¹å®šçš„payloadå’Œheaderã€‚è™½ç„¶ä»£ç æœ¬èº«å®žçŽ°äº†é˜²å¾¡ Spring4Shell æ”»å‡»çš„åŠŸèƒ½ï¼Œä½†æ½œåœ¨çš„é£Žé™©ç‚¹åœ¨äºŽï¼š
*   **ç»•è¿‡è§„åˆ™ï¼š** ç²¾æ˜Žçš„æ”»å‡»è€…å¯ä»¥ç ”ç©¶è¿™äº›è§„åˆ™ï¼Œè®¾è®¡ç»•è¿‡è¿™äº›è§„åˆ™çš„payloadã€‚å¦‚æžœè§„åˆ™è¿‡äºŽç®€å•ï¼Œå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚
*   **æ€§èƒ½é—®é¢˜ï¼š** å¤æ‚çš„è§„åˆ™å¯èƒ½ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æµé‡æƒ…å†µä¸‹ã€‚
*   **è¯¯æŠ¥é£Žé™©ï¼š** è¿‡äºŽå®½æ³›çš„è§„åˆ™å¯èƒ½ä¼šå¯¼è‡´è¯¯æŠ¥ï¼Œé˜»æ­¢åˆæ³•çš„è¯·æ±‚ã€‚

æ£€æŸ¥ä»£ç ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥é¡¹ç›®æ›´åƒæ˜¯æä¾›é˜²å¾¡æŽªæ–½è€Œéžä¸»åŠ¨æ”»å‡»ï¼Œä½†ä½œè€…å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ·»åŠ æ¶æ„ç¨‹åºï¼Œå»ºè®®è°¨æ…Žã€‚
å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º5%ã€‚ä¸»è¦çš„é£Žé™©åœ¨äºŽè§„åˆ™çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åŒ…å«æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æžï¼š**

1.  **ç›®æ ‡ï¼š** æ”»å‡»è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸­ä½œä¸ºWARåŒ…ã€‚
2.  **æœºåˆ¶ï¼š** åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—é…ç½®å’ŒWeb shellè·¯å¾„ã€‚
3.  **æ­¥éª¤ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ä¿®æ”¹Tomcatè®¿é—®æ—¥å¿—çš„ç›®å½•ä¸ºWebç›®å½•ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„åŽç¼€ï¼Œä½¿å…¶æˆä¸ºå¯æ‰§è¡Œçš„JSPæ–‡ä»¶ã€‚
    *   æœ€åŽï¼Œå†™å…¥æ¶æ„ä»£ç åˆ°è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ€»ç»“ï¼š**

CVE-2022-22965æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºçš„é…ç½®å’Œè¡¥ä¸çŠ¶æ€ã€‚è¯¥é¡¹ç›®æä¾›çš„ä»£ç æ—¨åœ¨é˜²å¾¡è¿™ç§æ”»å‡»ï¼Œä½†éœ€è¦æ³¨æ„è§„åˆ™çš„æœ‰æ•ˆæ€§å’Œæ½œåœ¨çš„ç»•è¿‡é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Aur3ns/Block-Spring4Shell](https://github.com/Aur3ns/Block-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #3

**æ¥æº**: [CVE-2022-22965-BKLockly_CVE-2022-22965.md](../2022/CVE-2022-22965-BKLockly_CVE-2022-22965.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨ Tomcat ä½œä¸º WAR éƒ¨ç½²çš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åº

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šï¼Œåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆJDK 9+ï¼ŒTomcat WARéƒ¨ç½²ï¼‰ï¼Œåˆ©ç”¨æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®è®¤ï¼š** ç¡®è®¤ç›®æ ‡åº”ç”¨ç¨‹åºä½¿ç”¨å—å½±å“çš„Spring Frameworkç‰ˆæœ¬ï¼Œå¹¶ä¸”æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ˆJDKç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼ï¼‰ã€‚
2.  **å‚æ•°æ“çºµï¼š**  é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œæ“çºµ`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å‚æ•°ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„Web Shellã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** è®¿é—®æ¶æ„Web Shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªGoç¨‹åºï¼Œå®ƒåŒ…å«äº†æ¼æ´žæ£€æµ‹(POC)å’Œåˆ©ç”¨(Exploit)åŠŸèƒ½ã€‚é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šç›®æ ‡URLã€è¦æ‰§è¡Œçš„å‘½ä»¤ã€åå¼¹shellçš„åœ°å€å’Œç«¯å£ç­‰ã€‚ä»Žä»£ç ç»“æž„ä¸Šçœ‹ï¼ŒPOCç¨‹åºä¼šé¦–å…ˆæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žï¼Œå¦‚æžœå­˜åœ¨åˆ™å°è¯•è¿›è¡Œåˆ©ç”¨ï¼Œæ ¹æ®å‚æ•°å†³å®šæ˜¯å¦åå¼¹shellã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»£ç æœ¬èº«åŒ…å«ç½‘ç»œè¯·æ±‚å’Œå‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ï¼Œå…·æœ‰ä¸€å®šçš„é£Žé™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ç‚¹ï¼š

*   **ç¡¬ç¼–ç çš„æ¶æ„å‘½ä»¤ï¼š** è™½ç„¶POCæä¾›äº†`-c`å‚æ•°æŒ‡å®šå‘½ä»¤ï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­éšè—äº†ç‰¹å®šçš„æ¶æ„å‘½ä»¤ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œã€‚
*   **åå¼¹shellçš„éšè”½åŽé—¨ï¼š**  åå¼¹shellåŠŸèƒ½æœ¬èº«å°±å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œå¦‚æžœä½œè€…åœ¨åå¼¹shellçš„ä»£ç ä¸­åŠ å…¥é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚æ”¶é›†ç›®æ ‡ä¿¡æ¯å¹¶å›žä¼ ï¼Œå°±æž„æˆäº†ä¸€ä¸ªéšè”½çš„åŽé—¨ã€‚
*   **ä¾èµ–åŒ…é£Žé™©ï¼š** è™½ç„¶`go.mod`å’Œ`go.sum`æ–‡ä»¶çœ‹èµ·æ¥æ­£å¸¸ï¼Œä½†ä»ç„¶å­˜åœ¨ä¾èµ–åŒ…è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºŽä»¥ä¸Šåˆ†æžï¼Œè®¤ä¸ºè¯¥POCä»£ç å­˜åœ¨**10%**çš„æŠ•æ¯’é£Žé™©ã€‚éœ€è¦ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚ã€å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shellç›¸å…³çš„éƒ¨åˆ†ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„ä¾èµ–åŒ…çš„å®‰å…¨æ€§ã€‚

**å…¶ä»–è¯´æ˜Ž:** è¯¥POCä»£ç çš„READMEæè¿°äº†å•ä¸ªIPæ‰«æå’Œæ‰¹é‡æ‰«æçš„ä½¿ç”¨æ–¹æ³•å’Œæ•ˆæžœã€‚åŒæ—¶ï¼Œæåˆ°ç¬¬ä¸€æ¬¡æ‰§è¡Œexpå¯èƒ½æŠ¥é”™ï¼Œä½†å…¶å®žå·²ç»ä¸Šä¼ æˆåŠŸï¼Œéœ€è¦ç­‰å¾…ä¸€ä¼šã€‚è¿™è¡¨æ˜Žè¯¥POCæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¯èƒ½å­˜åœ¨åˆ©ç”¨æˆåŠŸçŽ‡ä¸é«˜çš„é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [BKLockly/CVE-2022-22965](https://github.com/BKLockly/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #4

**æ¥æº**: [CVE-2022-22965-DDuarte_springshell-rce-poc.md](../2022/CVE-2022-22965-DDuarte_springshell-rce-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat with WAR deployment, vulnerable Spring version, no blocklist on WebDataBinder/InitBinder, parameter bind with POJOs directly, writeable file system

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žåˆ©ç”¨æºäºŽåœ¨JDK 9+çŽ¯å¢ƒä¸­ï¼Œå½“åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œæ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨æ¥ä¿®æ”¹Tomcatçš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„çš„JSP webshellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„indexç«¯ç‚¹ã€‚è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„æ—¥å¿—è®°å½•ç®¡é“ï¼Œç‰¹åˆ«æ˜¯é…ç½®ä¸€ä¸ªloggerï¼Œå°†JSPä»£ç å†™å…¥åˆ°webapps/ROOTç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆtomcatwar.jspï¼‰ã€‚ç„¶åŽï¼ŒPOCå°è¯•è®¿é—®è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå¦‚æžœæˆåŠŸè®¿é—®å¹¶è¿”å›ž500é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºwebshellå·²æˆåŠŸéƒ¨ç½²ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’cmdå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚Dockerfileæž„å»ºäº†ä¸€ä¸ªæ˜“å—æ”»å‡»çš„Springåº”ç”¨ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°TomcatæœåŠ¡å™¨ä¸Šï¼Œä¸ºæ¼æ´žåˆ©ç”¨æä¾›çŽ¯å¢ƒã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œè¯¥POCåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆå¦‚JDKç‰ˆæœ¬ã€Tomcatéƒ¨ç½²æ–¹å¼ã€Springç‰ˆæœ¬ç­‰ï¼‰åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚
*   Dockerfileä¸­çš„æž„å»ºè¿‡ç¨‹ç›¸å¯¹é€æ˜Žï¼Œä¸»è¦ä¾èµ–äºŽå®˜æ–¹Mavenå’ŒTomcaté•œåƒã€‚è™½å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’é£Žé™©ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚
*   pom.xmlæ–‡ä»¶æŒ‡å®šäº†ä¾èµ–é¡¹ï¼Œå­˜åœ¨å¼•å…¥æ¶æ„ä¾èµ–çš„é£Žé™©ï¼Œä½†å½“å‰ä¾èµ–é¡¹å‡ä¸ºå¸¸è§çš„Springç»„ä»¶ï¼Œç›´æŽ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žã€‚
*   poc.pyè„šæœ¬ä¸»è¦ç”¨äºŽæ¼æ´žåˆ©ç”¨ï¼Œè™½ç„¶æœ¬èº«æ˜¯æ”»å‡»ä»£ç ï¼Œä½†ä¸ŽæŠ•æ¯’æ— å…³ã€‚
*   æ€»ä½“è€Œè¨€ï¼Œä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é›†ä¸­åœ¨ä¾›åº”é“¾æ”»å‡»å±‚é¢ï¼Œä¾‹å¦‚Mavenä¸­å¤®ä»“åº“çš„ä¾èµ–åŒ…è¢«ç¯¡æ”¹ã€‚ä½†è€ƒè™‘åˆ°å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»“åº“é€šå¸¸ä¼šæŽ¥å—å®‰å…¨ç¤¾åŒºçš„å®¡æŸ¥ï¼Œæ¶æ„æŠ•æ¯’çš„æ¦‚çŽ‡ç›¸å¯¹è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«ç‰¹æ®Šæž„é€ çš„å‚æ•°çš„HTTPè¯·æ±‚åˆ°Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®ï¼š** è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹TomcatæœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹æ—¥å¿—é…ç½®ï¼Œå°†ä¸€ä¸ªæ¶æ„çš„JSP webshellå†™å…¥åˆ°Tomcatçš„webappsç›®å½•ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„JSP webshellï¼Œä¼ é€’å‘½ä»¤å‚æ•°ï¼Œå®žçŽ°åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [DDuarte/springshell-rce-poc](https://github.com/DDuarte/springshell-rce-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #5

**æ¥æº**: [CVE-2022-22965-ESSAFAR_Firewall-Rules.md](../2022/CVE-2022-22965-ESSAFAR_Firewall-Rules.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨Tomcatä¸Šï¼Œéƒ¨ç½²ä¸ºWARåŒ…ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œä¾‹å¦‚ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åŽç¼€åä¸ºjspï¼Œç„¶åŽå‘æ—¥å¿—æ–‡ä»¶å†™å…¥webshellï¼Œä»Žè€ŒèŽ·å¾—æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°è¯¥æ¼æ´žå¯èƒ½å¯¼è‡´RCEï¼Œå¹¶è¢«CISAæ”¶å½•åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­ä¹ŸæåŠäº†è¯¥æ¼æ´žçš„åˆ©ç”¨å’Œåˆ†æžï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„é˜²ç«å¢™æœåŠ¡å™¨è„šæœ¬ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´ä¸­åŒ…å«çš„ç‰¹å®šæ¨¡å¼æ¥è¯†åˆ«å¯èƒ½çš„æ”»å‡»è¯·æ±‚ã€‚å› æ­¤ï¼Œä»£ç æœ¬èº«å¹¶ä¸æ˜¯POCï¼Œè€Œæ˜¯é˜²å¾¡å·¥å…·ï¼Œä½†æ˜¯ä¾§é¢éªŒè¯äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„pythonè„šæœ¬æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œå¤´éƒ¨ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªè¯¥è¯·æ±‚ã€‚å¦‚æžœè¯·æ±‚çš„è·¯å¾„åŒ…å«`/tomcatwar.jsp`ï¼Œæˆ–è€…HTTPå¤´éƒ¨åŒ…å«ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼ˆå¦‚`suffix=%>//`ï¼Œ `c1=Runtime`ï¼Œ`c2=<%`ç­‰ï¼‰ï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«æ‹¦æˆªã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡é’ˆå¯¹CVE-2022-22965çš„æ”»å‡»ï¼Œ**å¹¶æœªå‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%**ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   ä½¿ç”¨Spring MVCæˆ–Spring WebFluxæ¡†æž¶ã€‚
    *   è¿è¡Œåœ¨JDK 9åŠä»¥ä¸Šç‰ˆæœ¬ã€‚
    *   éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”æ˜¯WARåŒ…éƒ¨ç½²ã€‚
2.  **æ”»å‡»æ–¹æ³•ï¼š** æ”»å‡»è€…é€šè¿‡å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`çš„å€¼ä¸ºåŒ…å«webshellçš„æ¶æ„ä»£ç ,å¹¶ä¸”ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.suffix`çš„å€¼ä¸º`.jsp`,ä»¥åŠ`class.module.classLoader.resources.context.parent.pipeline.first.directory`è®¾ç½®ä¸º`webapps/[åº”ç”¨å]`ï¼Œä»Žè€Œå°†webshellå†™å…¥åˆ°å¯æ‰§è¡Œçš„JSPæ–‡ä»¶ä¸­ã€‚
3.  **RCEå®žçŽ°ï¼š** å†™å…¥webshellåŽï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [ESSAFAR/Firewall-Rules](https://github.com/ESSAFAR/Firewall-Rules)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #6

**æ¥æº**: [CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md](../2022/CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md)

# CVE-2022-22965

> ðŸ“¦ è¯¥CVEæœ‰ **26** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22965-0xrobiul_CVE-2022-22965.md](../2022/CVE-2022-22965-0xrobiul_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨éœ€è¦éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚æœç´¢å¼•æ“Žç»“æžœè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åªåŒ…å« GNU GPL åè®®ï¼Œä¸åŒ…å«ä»»ä½•ä¸Žæ¼æ´žåˆ©ç”¨ç›¸å…³çš„ä»£ç ã€‚æ— æ³•é€šè¿‡æ­¤ä»£ç åˆ†æžæ˜¯å¦å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚ç”±äºŽæä¾›çš„ä»£ç å¹¶éžå®žé™…çš„POCä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®žé™…çŽ¯å¢ƒä¸­åˆ©ç”¨ä»£ç å¯èƒ½å­˜åœ¨æŠ•æ¯’ï¼Œä½†éœ€è¿›ä¸€æ­¥åˆ†æžå…·ä½“POCä»£ç æ‰èƒ½åˆ¤æ–­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ¼æ´žåˆ©ç”¨æ–¹å¼ä¸»è¦æ¶‰åŠåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ° Web ç›®å½•ï¼Œç„¶åŽå†™å…¥æ¶æ„ JSP ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å’Œå…¶ä»–ç›¸å…³å±žæ€§æ¥å®žçŽ° RCEã€‚ä¸€äº›åˆ©ç”¨æ–¹å¼è¿˜æ¶‰åŠ Spring Expression Language (SpEL) æ³¨å…¥ã€‚

**æŽ’åºä¼˜å…ˆçº§ç†ç”±ï¼š**
*   **æœç´¢å¼•æ“Žç»“æžœï¼š** ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†å…³äºŽè¯¥æ¼æ´žçš„å®žé™…åˆ©ç”¨æƒ…å†µå’Œå½±å“çš„æœ€æ–°ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²è¢«ç§¯æžåˆ©ç”¨çš„è¯æ®ã€‚
*   **æ¼æ´žåˆ©ç”¨ä»£ç ï¼š** ä¼˜å…ˆçº§ç¬¬äºŒï¼Œå› ä¸ºçœŸå®žçš„POCä»£ç èƒ½æä¾›æœ€ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨æ–¹å¼éªŒè¯ï¼Œä½†æœ¬æ¬¡æä¾›çš„ä¸æ˜¯æœ‰æ•ˆPOCä»£ç ï¼Œæ— æ³•æœ‰æ•ˆåˆ†æžæ¼æ´žã€‚
*   **æ¼æ´žåº“ä¿¡æ¯ï¼š** ä¼˜å…ˆçº§æœ€ä½Žï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸åªæä¾›æ¼æ´žçš„æ¦‚è¦æè¿°ï¼Œè€Œä¸æä¾›å®žé™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚


**é¡¹ç›®åœ°å€:** [0xrobiul/CVE-2022-22965](https://github.com/0xrobiul/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #2

**æ¥æº**: [CVE-2022-22965-Aur3ns_Block-Spring4Shell.md](../2022/CVE-2022-22965-Aur3ns_Block-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X (prior to 5.3.18+), 5.2.x (prior to 5.2.20+) å’Œæ‰€æœ‰æ—§ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WARéƒ¨ç½²ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨ç­‰å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žæ˜¯ä¸€ä¸ªçœŸå®žå­˜åœ¨ä¸”å·²è¢«ç§¯æžåˆ©ç”¨çš„æ¼æ´žã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™æœåŠ¡å™¨ï¼Œæ—¨åœ¨æ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„æ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´žã€‚å› æ­¤ï¼ŒPOCä»£ç æœ¬èº«çš„æœ‰æ•ˆæ€§åœ¨äºŽå…¶é˜²å¾¡èƒ½åŠ›ï¼Œè€Œéžæ”»å‡»èƒ½åŠ›ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

åˆ†æžæä¾›çš„ frs.py è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„é˜²ç«å¢™ï¼Œç”¨æ¥æ£€æµ‹ç‰¹å®šçš„payloadå’Œheaderã€‚è™½ç„¶ä»£ç æœ¬èº«å®žçŽ°äº†é˜²å¾¡ Spring4Shell æ”»å‡»çš„åŠŸèƒ½ï¼Œä½†æ½œåœ¨çš„é£Žé™©ç‚¹åœ¨äºŽï¼š
*   **ç»•è¿‡è§„åˆ™ï¼š** ç²¾æ˜Žçš„æ”»å‡»è€…å¯ä»¥ç ”ç©¶è¿™äº›è§„åˆ™ï¼Œè®¾è®¡ç»•è¿‡è¿™äº›è§„åˆ™çš„payloadã€‚å¦‚æžœè§„åˆ™è¿‡äºŽç®€å•ï¼Œå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚
*   **æ€§èƒ½é—®é¢˜ï¼š** å¤æ‚çš„è§„åˆ™å¯èƒ½ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æµé‡æƒ…å†µä¸‹ã€‚
*   **è¯¯æŠ¥é£Žé™©ï¼š** è¿‡äºŽå®½æ³›çš„è§„åˆ™å¯èƒ½ä¼šå¯¼è‡´è¯¯æŠ¥ï¼Œé˜»æ­¢åˆæ³•çš„è¯·æ±‚ã€‚

æ£€æŸ¥ä»£ç ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥é¡¹ç›®æ›´åƒæ˜¯æä¾›é˜²å¾¡æŽªæ–½è€Œéžä¸»åŠ¨æ”»å‡»ï¼Œä½†ä½œè€…å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ·»åŠ æ¶æ„ç¨‹åºï¼Œå»ºè®®è°¨æ…Žã€‚
å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º5%ã€‚ä¸»è¦çš„é£Žé™©åœ¨äºŽè§„åˆ™çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åŒ…å«æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æžï¼š**

1.  **ç›®æ ‡ï¼š** æ”»å‡»è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸­ä½œä¸ºWARåŒ…ã€‚
2.  **æœºåˆ¶ï¼š** åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—é…ç½®å’ŒWeb shellè·¯å¾„ã€‚
3.  **æ­¥éª¤ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ä¿®æ”¹Tomcatè®¿é—®æ—¥å¿—çš„ç›®å½•ä¸ºWebç›®å½•ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„åŽç¼€ï¼Œä½¿å…¶æˆä¸ºå¯æ‰§è¡Œçš„JSPæ–‡ä»¶ã€‚
    *   æœ€åŽï¼Œå†™å…¥æ¶æ„ä»£ç åˆ°è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ€»ç»“ï¼š**

CVE-2022-22965æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºçš„é…ç½®å’Œè¡¥ä¸çŠ¶æ€ã€‚è¯¥é¡¹ç›®æä¾›çš„ä»£ç æ—¨åœ¨é˜²å¾¡è¿™ç§æ”»å‡»ï¼Œä½†éœ€è¦æ³¨æ„è§„åˆ™çš„æœ‰æ•ˆæ€§å’Œæ½œåœ¨çš„ç»•è¿‡é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Aur3ns/Block-Spring4Shell](https://github.com/Aur3ns/Block-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #3

**æ¥æº**: [CVE-2022-22965-BKLockly_CVE-2022-22965.md](../2022/CVE-2022-22965-BKLockly_CVE-2022-22965.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨ Tomcat ä½œä¸º WAR éƒ¨ç½²çš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åº

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šï¼Œåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆJDK 9+ï¼ŒTomcat WARéƒ¨ç½²ï¼‰ï¼Œåˆ©ç”¨æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®è®¤ï¼š** ç¡®è®¤ç›®æ ‡åº”ç”¨ç¨‹åºä½¿ç”¨å—å½±å“çš„Spring Frameworkç‰ˆæœ¬ï¼Œå¹¶ä¸”æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ˆJDKç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼ï¼‰ã€‚
2.  **å‚æ•°æ“çºµï¼š**  é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œæ“çºµ`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å‚æ•°ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„Web Shellã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** è®¿é—®æ¶æ„Web Shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªGoç¨‹åºï¼Œå®ƒåŒ…å«äº†æ¼æ´žæ£€æµ‹(POC)å’Œåˆ©ç”¨(Exploit)åŠŸèƒ½ã€‚é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šç›®æ ‡URLã€è¦æ‰§è¡Œçš„å‘½ä»¤ã€åå¼¹shellçš„åœ°å€å’Œç«¯å£ç­‰ã€‚ä»Žä»£ç ç»“æž„ä¸Šçœ‹ï¼ŒPOCç¨‹åºä¼šé¦–å…ˆæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žï¼Œå¦‚æžœå­˜åœ¨åˆ™å°è¯•è¿›è¡Œåˆ©ç”¨ï¼Œæ ¹æ®å‚æ•°å†³å®šæ˜¯å¦åå¼¹shellã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»£ç æœ¬èº«åŒ…å«ç½‘ç»œè¯·æ±‚å’Œå‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ï¼Œå…·æœ‰ä¸€å®šçš„é£Žé™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ç‚¹ï¼š

*   **ç¡¬ç¼–ç çš„æ¶æ„å‘½ä»¤ï¼š** è™½ç„¶POCæä¾›äº†`-c`å‚æ•°æŒ‡å®šå‘½ä»¤ï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­éšè—äº†ç‰¹å®šçš„æ¶æ„å‘½ä»¤ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œã€‚
*   **åå¼¹shellçš„éšè”½åŽé—¨ï¼š**  åå¼¹shellåŠŸèƒ½æœ¬èº«å°±å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œå¦‚æžœä½œè€…åœ¨åå¼¹shellçš„ä»£ç ä¸­åŠ å…¥é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚æ”¶é›†ç›®æ ‡ä¿¡æ¯å¹¶å›žä¼ ï¼Œå°±æž„æˆäº†ä¸€ä¸ªéšè”½çš„åŽé—¨ã€‚
*   **ä¾èµ–åŒ…é£Žé™©ï¼š** è™½ç„¶`go.mod`å’Œ`go.sum`æ–‡ä»¶çœ‹èµ·æ¥æ­£å¸¸ï¼Œä½†ä»ç„¶å­˜åœ¨ä¾èµ–åŒ…è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºŽä»¥ä¸Šåˆ†æžï¼Œè®¤ä¸ºè¯¥POCä»£ç å­˜åœ¨**10%**çš„æŠ•æ¯’é£Žé™©ã€‚éœ€è¦ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚ã€å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shellç›¸å…³çš„éƒ¨åˆ†ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„ä¾èµ–åŒ…çš„å®‰å…¨æ€§ã€‚

**å…¶ä»–è¯´æ˜Ž:** è¯¥POCä»£ç çš„READMEæè¿°äº†å•ä¸ªIPæ‰«æå’Œæ‰¹é‡æ‰«æçš„ä½¿ç”¨æ–¹æ³•å’Œæ•ˆæžœã€‚åŒæ—¶ï¼Œæåˆ°ç¬¬ä¸€æ¬¡æ‰§è¡Œexpå¯èƒ½æŠ¥é”™ï¼Œä½†å…¶å®žå·²ç»ä¸Šä¼ æˆåŠŸï¼Œéœ€è¦ç­‰å¾…ä¸€ä¼šã€‚è¿™è¡¨æ˜Žè¯¥POCæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¯èƒ½å­˜åœ¨åˆ©ç”¨æˆåŠŸçŽ‡ä¸é«˜çš„é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [BKLockly/CVE-2022-22965](https://github.com/BKLockly/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #4

**æ¥æº**: [CVE-2022-22965-DDuarte_springshell-rce-poc.md](../2022/CVE-2022-22965-DDuarte_springshell-rce-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat with WAR deployment, vulnerable Spring version, no blocklist on WebDataBinder/InitBinder, parameter bind with POJOs directly, writeable file system

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žåˆ©ç”¨æºäºŽåœ¨JDK 9+çŽ¯å¢ƒä¸­ï¼Œå½“åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œæ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨æ¥ä¿®æ”¹Tomcatçš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„çš„JSP webshellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„indexç«¯ç‚¹ã€‚è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„æ—¥å¿—è®°å½•ç®¡é“ï¼Œç‰¹åˆ«æ˜¯é…ç½®ä¸€ä¸ªloggerï¼Œå°†JSPä»£ç å†™å…¥åˆ°webapps/ROOTç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆtomcatwar.jspï¼‰ã€‚ç„¶åŽï¼ŒPOCå°è¯•è®¿é—®è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå¦‚æžœæˆåŠŸè®¿é—®å¹¶è¿”å›ž500é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºwebshellå·²æˆåŠŸéƒ¨ç½²ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’cmdå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚Dockerfileæž„å»ºäº†ä¸€ä¸ªæ˜“å—æ”»å‡»çš„Springåº”ç”¨ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°TomcatæœåŠ¡å™¨ä¸Šï¼Œä¸ºæ¼æ´žåˆ©ç”¨æä¾›çŽ¯å¢ƒã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œè¯¥POCåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆå¦‚JDKç‰ˆæœ¬ã€Tomcatéƒ¨ç½²æ–¹å¼ã€Springç‰ˆæœ¬ç­‰ï¼‰åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚
*   Dockerfileä¸­çš„æž„å»ºè¿‡ç¨‹ç›¸å¯¹é€æ˜Žï¼Œä¸»è¦ä¾èµ–äºŽå®˜æ–¹Mavenå’ŒTomcaté•œåƒã€‚è™½å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’é£Žé™©ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚
*   pom.xmlæ–‡ä»¶æŒ‡å®šäº†ä¾èµ–é¡¹ï¼Œå­˜åœ¨å¼•å…¥æ¶æ„ä¾èµ–çš„é£Žé™©ï¼Œä½†å½“å‰ä¾èµ–é¡¹å‡ä¸ºå¸¸è§çš„Springç»„ä»¶ï¼Œç›´æŽ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žã€‚
*   poc.pyè„šæœ¬ä¸»è¦ç”¨äºŽæ¼æ´žåˆ©ç”¨ï¼Œè™½ç„¶æœ¬èº«æ˜¯æ”»å‡»ä»£ç ï¼Œä½†ä¸ŽæŠ•æ¯’æ— å…³ã€‚
*   æ€»ä½“è€Œè¨€ï¼Œä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é›†ä¸­åœ¨ä¾›åº”é“¾æ”»å‡»å±‚é¢ï¼Œä¾‹å¦‚Mavenä¸­å¤®ä»“åº“çš„ä¾èµ–åŒ…è¢«ç¯¡æ”¹ã€‚ä½†è€ƒè™‘åˆ°å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»“åº“é€šå¸¸ä¼šæŽ¥å—å®‰å…¨ç¤¾åŒºçš„å®¡æŸ¥ï¼Œæ¶æ„æŠ•æ¯’çš„æ¦‚çŽ‡ç›¸å¯¹è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«ç‰¹æ®Šæž„é€ çš„å‚æ•°çš„HTTPè¯·æ±‚åˆ°Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®ï¼š** è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹TomcatæœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹æ—¥å¿—é…ç½®ï¼Œå°†ä¸€ä¸ªæ¶æ„çš„JSP webshellå†™å…¥åˆ°Tomcatçš„webappsç›®å½•ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„JSP webshellï¼Œä¼ é€’å‘½ä»¤å‚æ•°ï¼Œå®žçŽ°åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [DDuarte/springshell-rce-poc](https://github.com/DDuarte/springshell-rce-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #5

**æ¥æº**: [CVE-2022-22965-ESSAFAR_Firewall-Rules.md](../2022/CVE-2022-22965-ESSAFAR_Firewall-Rules.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨Tomcatä¸Šï¼Œéƒ¨ç½²ä¸ºWARåŒ…ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œä¾‹å¦‚ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åŽç¼€åä¸ºjspï¼Œç„¶åŽå‘æ—¥å¿—æ–‡ä»¶å†™å…¥webshellï¼Œä»Žè€ŒèŽ·å¾—æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°è¯¥æ¼æ´žå¯èƒ½å¯¼è‡´RCEï¼Œå¹¶è¢«CISAæ”¶å½•åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­ä¹ŸæåŠäº†è¯¥æ¼æ´žçš„åˆ©ç”¨å’Œåˆ†æžï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„é˜²ç«å¢™æœåŠ¡å™¨è„šæœ¬ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´ä¸­åŒ…å«çš„ç‰¹å®šæ¨¡å¼æ¥è¯†åˆ«å¯èƒ½çš„æ”»å‡»è¯·æ±‚ã€‚å› æ­¤ï¼Œä»£ç æœ¬èº«å¹¶ä¸æ˜¯POCï¼Œè€Œæ˜¯é˜²å¾¡å·¥å…·ï¼Œä½†æ˜¯ä¾§é¢éªŒè¯äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„pythonè„šæœ¬æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œå¤´éƒ¨ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªè¯¥è¯·æ±‚ã€‚å¦‚æžœè¯·æ±‚çš„è·¯å¾„åŒ…å«`/tomcatwar.jsp`ï¼Œæˆ–è€…HTTPå¤´éƒ¨åŒ…å«ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼ˆå¦‚`suffix=%>//`ï¼Œ `c1=Runtime`ï¼Œ`c2=<%`ç­‰ï¼‰ï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«æ‹¦æˆªã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡é’ˆå¯¹CVE-2022-22965çš„æ”»å‡»ï¼Œ**å¹¶æœªå‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%**ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   ä½¿ç”¨Spring MVCæˆ–Spring WebFluxæ¡†æž¶ã€‚
    *   è¿è¡Œåœ¨JDK 9åŠä»¥ä¸Šç‰ˆæœ¬ã€‚
    *   éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”æ˜¯WARåŒ…éƒ¨ç½²ã€‚
2.  **æ”»å‡»æ–¹æ³•ï¼š** æ”»å‡»è€…é€šè¿‡å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`çš„å€¼ä¸ºåŒ…å«webshellçš„æ¶æ„ä»£ç ,å¹¶ä¸”ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.suffix`çš„å€¼ä¸º`.jsp`,ä»¥åŠ`class.module.classLoader.resources.context.parent.pipeline.first.directory`è®¾ç½®ä¸º`webapps/[åº”ç”¨å]`ï¼Œä»Žè€Œå°†webshellå†™å…¥åˆ°å¯æ‰§è¡Œçš„JSPæ–‡ä»¶ä¸­ã€‚
3.  **RCEå®žçŽ°ï¼š** å†™å…¥webshellåŽï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [ESSAFAR/Firewall-Rules](https://github.com/ESSAFAR/Firewall-Rules)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #6

**æ¥æº**: [CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md](../2022/CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md)

# CVE-2022-22965

> ðŸ“¦ è¯¥CVEæœ‰ **26** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22965-0xrobiul_CVE-2022-22965.md](../2022/CVE-2022-22965-0xrobiul_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨éœ€è¦éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚æœç´¢å¼•æ“Žç»“æžœè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åªåŒ…å« GNU GPL åè®®ï¼Œä¸åŒ…å«ä»»ä½•ä¸Žæ¼æ´žåˆ©ç”¨ç›¸å…³çš„ä»£ç ã€‚æ— æ³•é€šè¿‡æ­¤ä»£ç åˆ†æžæ˜¯å¦å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚ç”±äºŽæä¾›çš„ä»£ç å¹¶éžå®žé™…çš„POCä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®žé™…çŽ¯å¢ƒä¸­åˆ©ç”¨ä»£ç å¯èƒ½å­˜åœ¨æŠ•æ¯’ï¼Œä½†éœ€è¿›ä¸€æ­¥åˆ†æžå…·ä½“POCä»£ç æ‰èƒ½åˆ¤æ–­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ¼æ´žåˆ©ç”¨æ–¹å¼ä¸»è¦æ¶‰åŠåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ° Web ç›®å½•ï¼Œç„¶åŽå†™å…¥æ¶æ„ JSP ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å’Œå…¶ä»–ç›¸å…³å±žæ€§æ¥å®žçŽ° RCEã€‚ä¸€äº›åˆ©ç”¨æ–¹å¼è¿˜æ¶‰åŠ Spring Expression Language (SpEL) æ³¨å…¥ã€‚

**æŽ’åºä¼˜å…ˆçº§ç†ç”±ï¼š**
*   **æœç´¢å¼•æ“Žç»“æžœï¼š** ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†å…³äºŽè¯¥æ¼æ´žçš„å®žé™…åˆ©ç”¨æƒ…å†µå’Œå½±å“çš„æœ€æ–°ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²è¢«ç§¯æžåˆ©ç”¨çš„è¯æ®ã€‚
*   **æ¼æ´žåˆ©ç”¨ä»£ç ï¼š** ä¼˜å…ˆçº§ç¬¬äºŒï¼Œå› ä¸ºçœŸå®žçš„POCä»£ç èƒ½æä¾›æœ€ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨æ–¹å¼éªŒè¯ï¼Œä½†æœ¬æ¬¡æä¾›çš„ä¸æ˜¯æœ‰æ•ˆPOCä»£ç ï¼Œæ— æ³•æœ‰æ•ˆåˆ†æžæ¼æ´žã€‚
*   **æ¼æ´žåº“ä¿¡æ¯ï¼š** ä¼˜å…ˆçº§æœ€ä½Žï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸åªæä¾›æ¼æ´žçš„æ¦‚è¦æè¿°ï¼Œè€Œä¸æä¾›å®žé™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚


**é¡¹ç›®åœ°å€:** [0xrobiul/CVE-2022-22965](https://github.com/0xrobiul/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #2

**æ¥æº**: [CVE-2022-22965-Aur3ns_Block-Spring4Shell.md](../2022/CVE-2022-22965-Aur3ns_Block-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X (prior to 5.3.18+), 5.2.x (prior to 5.2.20+) å’Œæ‰€æœ‰æ—§ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WARéƒ¨ç½²ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨ç­‰å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žæ˜¯ä¸€ä¸ªçœŸå®žå­˜åœ¨ä¸”å·²è¢«ç§¯æžåˆ©ç”¨çš„æ¼æ´žã€‚æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™æœåŠ¡å™¨ï¼Œæ—¨åœ¨æ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„æ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ¼æ´žã€‚å› æ­¤ï¼ŒPOCä»£ç æœ¬èº«çš„æœ‰æ•ˆæ€§åœ¨äºŽå…¶é˜²å¾¡èƒ½åŠ›ï¼Œè€Œéžæ”»å‡»èƒ½åŠ›ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

åˆ†æžæä¾›çš„ frs.py è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„é˜²ç«å¢™ï¼Œç”¨æ¥æ£€æµ‹ç‰¹å®šçš„payloadå’Œheaderã€‚è™½ç„¶ä»£ç æœ¬èº«å®žçŽ°äº†é˜²å¾¡ Spring4Shell æ”»å‡»çš„åŠŸèƒ½ï¼Œä½†æ½œåœ¨çš„é£Žé™©ç‚¹åœ¨äºŽï¼š
*   **ç»•è¿‡è§„åˆ™ï¼š** ç²¾æ˜Žçš„æ”»å‡»è€…å¯ä»¥ç ”ç©¶è¿™äº›è§„åˆ™ï¼Œè®¾è®¡ç»•è¿‡è¿™äº›è§„åˆ™çš„payloadã€‚å¦‚æžœè§„åˆ™è¿‡äºŽç®€å•ï¼Œå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚
*   **æ€§èƒ½é—®é¢˜ï¼š** å¤æ‚çš„è§„åˆ™å¯èƒ½ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æµé‡æƒ…å†µä¸‹ã€‚
*   **è¯¯æŠ¥é£Žé™©ï¼š** è¿‡äºŽå®½æ³›çš„è§„åˆ™å¯èƒ½ä¼šå¯¼è‡´è¯¯æŠ¥ï¼Œé˜»æ­¢åˆæ³•çš„è¯·æ±‚ã€‚

æ£€æŸ¥ä»£ç ï¼Œæœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œè¯¥é¡¹ç›®æ›´åƒæ˜¯æä¾›é˜²å¾¡æŽªæ–½è€Œéžä¸»åŠ¨æ”»å‡»ï¼Œä½†ä½œè€…å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æ·»åŠ æ¶æ„ç¨‹åºï¼Œå»ºè®®è°¨æ…Žã€‚
å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º5%ã€‚ä¸»è¦çš„é£Žé™©åœ¨äºŽè§„åˆ™çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åŒ…å«æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼åˆ†æžï¼š**

1.  **ç›®æ ‡ï¼š** æ”»å‡»è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸­ä½œä¸ºWARåŒ…ã€‚
2.  **æœºåˆ¶ï¼š** åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—é…ç½®å’ŒWeb shellè·¯å¾„ã€‚
3.  **æ­¥éª¤ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ä¿®æ”¹Tomcatè®¿é—®æ—¥å¿—çš„ç›®å½•ä¸ºWebç›®å½•ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„åŽç¼€ï¼Œä½¿å…¶æˆä¸ºå¯æ‰§è¡Œçš„JSPæ–‡ä»¶ã€‚
    *   æœ€åŽï¼Œå†™å…¥æ¶æ„ä»£ç åˆ°è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æ€»ç»“ï¼š**

CVE-2022-22965æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºçš„é…ç½®å’Œè¡¥ä¸çŠ¶æ€ã€‚è¯¥é¡¹ç›®æä¾›çš„ä»£ç æ—¨åœ¨é˜²å¾¡è¿™ç§æ”»å‡»ï¼Œä½†éœ€è¦æ³¨æ„è§„åˆ™çš„æœ‰æ•ˆæ€§å’Œæ½œåœ¨çš„ç»•è¿‡é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [Aur3ns/Block-Spring4Shell](https://github.com/Aur3ns/Block-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #3

**æ¥æº**: [CVE-2022-22965-BKLockly_CVE-2022-22965.md](../2022/CVE-2022-22965-BKLockly_CVE-2022-22965.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨ Tomcat ä½œä¸º WAR éƒ¨ç½²çš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åº

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šï¼Œåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆJDK 9+ï¼ŒTomcat WARéƒ¨ç½²ï¼‰ï¼Œåˆ©ç”¨æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ç¡®è®¤ï¼š** ç¡®è®¤ç›®æ ‡åº”ç”¨ç¨‹åºä½¿ç”¨å—å½±å“çš„Spring Frameworkç‰ˆæœ¬ï¼Œå¹¶ä¸”æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ˆJDKç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼ï¼‰ã€‚
2.  **å‚æ•°æ“çºµï¼š**  é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œæ“çºµ`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å‚æ•°ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„Web Shellã€‚
3.  **ä»£ç æ‰§è¡Œï¼š** è®¿é—®æ¶æ„Web Shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æžï¼š**

æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªGoç¨‹åºï¼Œå®ƒåŒ…å«äº†æ¼æ´žæ£€æµ‹(POC)å’Œåˆ©ç”¨(Exploit)åŠŸèƒ½ã€‚é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šç›®æ ‡URLã€è¦æ‰§è¡Œçš„å‘½ä»¤ã€åå¼¹shellçš„åœ°å€å’Œç«¯å£ç­‰ã€‚ä»Žä»£ç ç»“æž„ä¸Šçœ‹ï¼ŒPOCç¨‹åºä¼šé¦–å…ˆæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žï¼Œå¦‚æžœå­˜åœ¨åˆ™å°è¯•è¿›è¡Œåˆ©ç”¨ï¼Œæ ¹æ®å‚æ•°å†³å®šæ˜¯å¦åå¼¹shellã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»£ç æœ¬èº«åŒ…å«ç½‘ç»œè¯·æ±‚å’Œå‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ï¼Œå…·æœ‰ä¸€å®šçš„é£Žé™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ç‚¹ï¼š

*   **ç¡¬ç¼–ç çš„æ¶æ„å‘½ä»¤ï¼š** è™½ç„¶POCæä¾›äº†`-c`å‚æ•°æŒ‡å®šå‘½ä»¤ï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­éšè—äº†ç‰¹å®šçš„æ¶æ„å‘½ä»¤ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œã€‚
*   **åå¼¹shellçš„éšè”½åŽé—¨ï¼š**  åå¼¹shellåŠŸèƒ½æœ¬èº«å°±å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œå¦‚æžœä½œè€…åœ¨åå¼¹shellçš„ä»£ç ä¸­åŠ å…¥é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚æ”¶é›†ç›®æ ‡ä¿¡æ¯å¹¶å›žä¼ ï¼Œå°±æž„æˆäº†ä¸€ä¸ªéšè”½çš„åŽé—¨ã€‚
*   **ä¾èµ–åŒ…é£Žé™©ï¼š** è™½ç„¶`go.mod`å’Œ`go.sum`æ–‡ä»¶çœ‹èµ·æ¥æ­£å¸¸ï¼Œä½†ä»ç„¶å­˜åœ¨ä¾èµ–åŒ…è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚

åŸºäºŽä»¥ä¸Šåˆ†æžï¼Œè®¤ä¸ºè¯¥POCä»£ç å­˜åœ¨**10%**çš„æŠ•æ¯’é£Žé™©ã€‚éœ€è¦ä»”ç»†å®¡æŸ¥ä»£ç ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚ã€å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shellç›¸å…³çš„éƒ¨åˆ†ï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„æ¶æ„é€»è¾‘ã€‚åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„ä¾èµ–åŒ…çš„å®‰å…¨æ€§ã€‚

**å…¶ä»–è¯´æ˜Ž:** è¯¥POCä»£ç çš„READMEæè¿°äº†å•ä¸ªIPæ‰«æå’Œæ‰¹é‡æ‰«æçš„ä½¿ç”¨æ–¹æ³•å’Œæ•ˆæžœã€‚åŒæ—¶ï¼Œæåˆ°ç¬¬ä¸€æ¬¡æ‰§è¡Œexpå¯èƒ½æŠ¥é”™ï¼Œä½†å…¶å®žå·²ç»ä¸Šä¼ æˆåŠŸï¼Œéœ€è¦ç­‰å¾…ä¸€ä¼šã€‚è¿™è¡¨æ˜Žè¯¥POCæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¯èƒ½å­˜åœ¨åˆ©ç”¨æˆåŠŸçŽ‡ä¸é«˜çš„é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [BKLockly/CVE-2022-22965](https://github.com/BKLockly/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #4

**æ¥æº**: [CVE-2022-22965-DDuarte_springshell-rce-poc.md](../2022/CVE-2022-22965-DDuarte_springshell-rce-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat with WAR deployment, vulnerable Spring version, no blocklist on WebDataBinder/InitBinder, parameter bind with POJOs directly, writeable file system

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ¼æ´žåˆ©ç”¨æºäºŽåœ¨JDK 9+çŽ¯å¢ƒä¸­ï¼Œå½“åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œæ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨æ¥ä¿®æ”¹Tomcatçš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„çš„JSP webshellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚åˆ°æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„indexç«¯ç‚¹ã€‚è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„æ—¥å¿—è®°å½•ç®¡é“ï¼Œç‰¹åˆ«æ˜¯é…ç½®ä¸€ä¸ªloggerï¼Œå°†JSPä»£ç å†™å…¥åˆ°webapps/ROOTç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆtomcatwar.jspï¼‰ã€‚ç„¶åŽï¼ŒPOCå°è¯•è®¿é—®è¿™ä¸ªJSPæ–‡ä»¶ï¼Œå¦‚æžœæˆåŠŸè®¿é—®å¹¶è¿”å›ž500é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºwebshellå·²æˆåŠŸéƒ¨ç½²ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’cmdå‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚Dockerfileæž„å»ºäº†ä¸€ä¸ªæ˜“å—æ”»å‡»çš„Springåº”ç”¨ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°TomcatæœåŠ¡å™¨ä¸Šï¼Œä¸ºæ¼æ´žåˆ©ç”¨æä¾›çŽ¯å¢ƒã€‚

**æœ‰æ•ˆæ€§ï¼š**æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œè¯¥POCåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆå¦‚JDKç‰ˆæœ¬ã€Tomcatéƒ¨ç½²æ–¹å¼ã€Springç‰ˆæœ¬ç­‰ï¼‰åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** è¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚
*   Dockerfileä¸­çš„æž„å»ºè¿‡ç¨‹ç›¸å¯¹é€æ˜Žï¼Œä¸»è¦ä¾èµ–äºŽå®˜æ–¹Mavenå’ŒTomcaté•œåƒã€‚è™½å­˜åœ¨ä¾›åº”é“¾æŠ•æ¯’é£Žé™©ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚
*   pom.xmlæ–‡ä»¶æŒ‡å®šäº†ä¾èµ–é¡¹ï¼Œå­˜åœ¨å¼•å…¥æ¶æ„ä¾èµ–çš„é£Žé™©ï¼Œä½†å½“å‰ä¾èµ–é¡¹å‡ä¸ºå¸¸è§çš„Springç»„ä»¶ï¼Œç›´æŽ¥æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žã€‚
*   poc.pyè„šæœ¬ä¸»è¦ç”¨äºŽæ¼æ´žåˆ©ç”¨ï¼Œè™½ç„¶æœ¬èº«æ˜¯æ”»å‡»ä»£ç ï¼Œä½†ä¸ŽæŠ•æ¯’æ— å…³ã€‚
*   æ€»ä½“è€Œè¨€ï¼Œä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¸»è¦é›†ä¸­åœ¨ä¾›åº”é“¾æ”»å‡»å±‚é¢ï¼Œä¾‹å¦‚Mavenä¸­å¤®ä»“åº“çš„ä¾èµ–åŒ…è¢«ç¯¡æ”¹ã€‚ä½†è€ƒè™‘åˆ°å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»“åº“é€šå¸¸ä¼šæŽ¥å—å®‰å…¨ç¤¾åŒºçš„å®¡æŸ¥ï¼Œæ¶æ„æŠ•æ¯’çš„æ¦‚çŽ‡ç›¸å¯¹è¾ƒä½Žã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«ç‰¹æ®Šæž„é€ çš„å‚æ•°çš„HTTPè¯·æ±‚åˆ°Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®ï¼š** è¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹TomcatæœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹æ—¥å¿—é…ç½®ï¼Œå°†ä¸€ä¸ªæ¶æ„çš„JSP webshellå†™å…¥åˆ°Tomcatçš„webappsç›®å½•ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…é€šè¿‡è®¿é—®å†™å…¥çš„JSP webshellï¼Œä¼ é€’å‘½ä»¤å‚æ•°ï¼Œå®žçŽ°åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [DDuarte/springshell-rce-poc](https://github.com/DDuarte/springshell-rce-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #5

**æ¥æº**: [CVE-2022-22965-ESSAFAR_Firewall-Rules.md](../2022/CVE-2022-22965-ESSAFAR_Firewall-Rules.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼Œè¿è¡Œåœ¨Tomcatä¸Šï¼Œéƒ¨ç½²ä¸ºWARåŒ…ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œä¾‹å¦‚ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åŽç¼€åä¸ºjspï¼Œç„¶åŽå‘æ—¥å¿—æ–‡ä»¶å†™å…¥webshellï¼Œä»Žè€ŒèŽ·å¾—æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žæ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žåº“ä¿¡æ¯ä¸­æåˆ°è¯¥æ¼æ´žå¯èƒ½å¯¼è‡´RCEï¼Œå¹¶è¢«CISAæ”¶å½•åˆ°å·²çŸ¥è¢«åˆ©ç”¨çš„æ¼æ´žç›®å½•ä¸­ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­ä¹ŸæåŠäº†è¯¥æ¼æ´žçš„åˆ©ç”¨å’Œåˆ†æžï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢é’ˆå¯¹æ­¤æ¼æ´žçš„é˜²ç«å¢™æœåŠ¡å™¨è„šæœ¬ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´ä¸­åŒ…å«çš„ç‰¹å®šæ¨¡å¼æ¥è¯†åˆ«å¯èƒ½çš„æ”»å‡»è¯·æ±‚ã€‚å› æ­¤ï¼Œä»£ç æœ¬èº«å¹¶ä¸æ˜¯POCï¼Œè€Œæ˜¯é˜²å¾¡å·¥å…·ï¼Œä½†æ˜¯ä¾§é¢éªŒè¯äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„pythonè„šæœ¬æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œå¤´éƒ¨ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªè¯¥è¯·æ±‚ã€‚å¦‚æžœè¯·æ±‚çš„è·¯å¾„åŒ…å«`/tomcatwar.jsp`ï¼Œæˆ–è€…HTTPå¤´éƒ¨åŒ…å«ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼ˆå¦‚`suffix=%>//`ï¼Œ `c1=Runtime`ï¼Œ`c2=<%`ç­‰ï¼‰ï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«æ‹¦æˆªã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡é’ˆå¯¹CVE-2022-22965çš„æ”»å‡»ï¼Œ**å¹¶æœªå‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%**ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   ä½¿ç”¨Spring MVCæˆ–Spring WebFluxæ¡†æž¶ã€‚
    *   è¿è¡Œåœ¨JDK 9åŠä»¥ä¸Šç‰ˆæœ¬ã€‚
    *   éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”æ˜¯WARåŒ…éƒ¨ç½²ã€‚
2.  **æ”»å‡»æ–¹æ³•ï¼š** æ”»å‡»è€…é€šè¿‡å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`çš„å€¼ä¸ºåŒ…å«webshellçš„æ¶æ„ä»£ç ,å¹¶ä¸”ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.suffix`çš„å€¼ä¸º`.jsp`,ä»¥åŠ`class.module.classLoader.resources.context.parent.pipeline.first.directory`è®¾ç½®ä¸º`webapps/[åº”ç”¨å]`ï¼Œä»Žè€Œå°†webshellå†™å…¥åˆ°å¯æ‰§è¡Œçš„JSPæ–‡ä»¶ä¸­ã€‚
3.  **RCEå®žçŽ°ï¼š** å†™å…¥webshellåŽï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [ESSAFAR/Firewall-Rules](https://github.com/ESSAFAR/Firewall-Rules)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #6

**æ¥æº**: [CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md](../2022/CVE-2022-22965-LucasPDiniz_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions, running on JDK 9+ with Tomcat as a WAR deployment.

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡åº”ç”¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ï¼šSpring MVCæˆ–Spring WebFluxåº”ç”¨ï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šï¼Œå¹¶ä¸”ä½¿ç”¨äº†å—å½±å“çš„Spring Frameworkç‰ˆæœ¬ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ª Spring Framework è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµç±»åŠ è½½å™¨ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶é…ç½®ï¼Œä»Žè€Œå†™å…¥æ¶æ„ JSP webshell åˆ°æœåŠ¡å™¨ï¼Œæœ€ç»ˆæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æä¾›çš„ POC ä»£ç  `poc.py` æ—¨åœ¨åˆ©ç”¨è¯¥æ¼æ´žã€‚å®ƒé€šè¿‡æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP POST è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve é…ç½®ã€‚è¿™äº›å‚æ•°ç”¨äºŽè®¾ç½® webshell çš„æ–‡ä»¶åã€åŽç¼€ã€ç›®å½•å’Œå†…å®¹ï¼ˆshell ä»£ç ï¼‰ã€‚ä¸€æ—¦ webshell è¢«å†™å…¥ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è®¿é—®è¯¥ webshell æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**
æŸ¥çœ‹poc.pyçš„å†…å®¹ï¼Œè¯¥è„šæœ¬çš„ç›®çš„æ˜¯å†™å…¥ webshellï¼Œé€šè¿‡è¯·æ±‚å‚æ•°`cmd`çš„å€¼æ‰§è¡Œå‘½ä»¤ã€‚æ²¡æœ‰å‘çŽ°ä½œè€…æ¤å…¥å…¶ä»–æ¶æ„æˆ–éšè—çš„ä»£ç ã€‚å› æ­¤æŠ•æ¯’é£Žé™©ä¸º0%.

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒç¡®è®¤ï¼š** ç¡®è®¤ç›®æ ‡åº”ç”¨æ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨æ¡ä»¶ (Spring MVC/WebFlux, JDK 9+, WARéƒ¨ç½², Tomcat)ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** ä½¿ç”¨ `poc.py` è„šæœ¬ï¼ŒæŒ‡å®šç›®æ ‡ URLã€webshell æ–‡ä»¶åã€å¯†ç å’Œå­˜æ”¾ç›®å½•ã€‚è„šæœ¬ä¼šå‘é€ä¸€ä¸ªç²¾å¿ƒæž„é€ çš„ HTTP POST è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
3.  **å†™å…¥ Webshellï¼š** å¦‚æžœæ¼æ´žå­˜åœ¨ï¼ŒæœåŠ¡å™¨ä¼šå°†åŒ…å«æ¶æ„ä»£ç çš„ JSP æ–‡ä»¶å†™å…¥æŒ‡å®šçš„ç›®å½•ã€‚
4.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®å†™å…¥çš„ webshell (ä¾‹å¦‚ `http://target/filename.jsp?pwd=password&cmd=whoami`) æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [LucasPDiniz/CVE-2022-22965](https://github.com/LucasPDiniz/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #7

**æ¥æº**: [CVE-2022-22965-Nosie12_fire-wall-server.md](../2022/CVE-2022-22965-Nosie12_fire-wall-server.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªé«˜å±çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”éœ€è¦éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…çš„å½¢å¼éƒ¨ç½²ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œå…è®¸æ”»å‡»è€…ä¼ å…¥æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œä»Žè€Œå†™å…¥ webshell æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨ç¡®å®žå­˜åœ¨å¹¶ä¸”è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ã€‚æä¾›çš„Pythonä»£ç å®žé™…ä¸Šæ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢åˆ©ç”¨ Spring4Shell æ¼æ´žçš„æ¶æ„è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ä¸­æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¶æ„æ¨¡å¼æ¥å·¥ä½œã€‚å› æ­¤ï¼Œæä¾›çš„ Python ä»£ç å¹¶ä¸èƒ½ç›´æŽ¥éªŒè¯æ¼æ´žçš„æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºé˜²å¾¡æŽªæ–½ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
å¯¹æä¾›çš„ Python ä»£ç  `firewall_server.py` è¿›è¡Œäº†åˆ†æžï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹å’Œé˜»æ­¢åŒ…å«ç‰¹å®šæ¶æ„æ¨¡å¼çš„HTTPè¯·æ±‚ã€‚è„šæœ¬ä¸­å®šä¹‰äº† `BLOCKED_PATTERNS` åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†è¯¸å¦‚ `/tomcatwar.jsp`ï¼Œ`class.module.classLoader.resources.context.parent.pipeline` å’Œä¸€äº›ç¼–ç åŽçš„å­—ç¬¦ä¸²ç­‰æ¨¡å¼ã€‚è„šæœ¬ä¼šæ£€æŸ¥ä¼ å…¥çš„è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ï¼Œå¦‚æžœå‘çŽ°ä»»ä½•åŒ¹é…çš„æ¨¡å¼ï¼Œå®ƒå°†è¿”å›žä¸€ä¸ª `403 Forbidden` å“åº”ã€‚å› æ­¤ï¼Œä»Žä»£ç çš„åŠŸèƒ½å’Œå†…å®¹æ¥çœ‹ï¼Œè¯¥è„šæœ¬æœ¬èº«ä¸åŒ…å«ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å¯ä»¥è®¤ä¸ºæŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼ŒSpring4Shell çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„æž„é€ çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚çš„ç›®æ ‡æ˜¯ Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
2.  æ¶æ„è¯·æ±‚ä¸­çš„å‚æ•°ä¼šåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œå°è¯•ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ã€‚
3.  é€šè¿‡ä¿®æ”¹ AccessLogValve çš„å±žæ€§ï¼Œæ”»å‡»è€…å¯ä»¥æŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„ä½ç½®å’Œæ ¼å¼ï¼Œä»Žè€Œå†™å…¥ä»»æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª webshellï¼‰ã€‚
4.  ä¸€æ—¦ webshell è¢«å†™å…¥ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡å®ƒæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [Nosie12/fire-wall-server](https://github.com/Nosie12/fire-wall-server)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #8

**æ¥æº**: [CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md](../2022/CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md)

## CVE-2022-22965-Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä½¿ç”¨Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢ç»“æžœå’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æä¾›äº†ä¸€ä¸ªå¯ docker åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå®¹æ˜“å—åˆ° Spring4Shell æ¼æ´ž (CVE-2022-22965) çš„æ”»å‡»ã€‚Dockerfile ä½¿ç”¨äº†ç‰¹å®šç‰ˆæœ¬çš„ Tomcat é•œåƒ (lunasec/tomcat-9.0.59-jdk11)ï¼Œè¯¥ç‰ˆæœ¬åœ¨æ¼æ´žä¿®å¤ä¹‹å‰ã€‚pom.xml æ–‡ä»¶é…ç½®äº† Spring Boot ç‰ˆæœ¬ 2.6.3ï¼Œè¯¥ç‰ˆæœ¬å¯èƒ½å—æ¼æ´žå½±å“ï¼ˆå…·ä½“å–å†³äºŽ Spring Framework çš„ç‰ˆæœ¬ï¼‰ã€‚æž„å»ºè¿‡ç¨‹åŒ…æ‹¬ä½¿ç”¨ Maven æ‰“åŒ…åº”ç”¨ç¨‹åºä¸º WAR æ–‡ä»¶ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ° Tomcat çš„ webapps ç›®å½•ã€‚æè¿°æ–‡ä»¶ä¹Ÿæè¿°è¿™æ˜¯ä¸€ä¸ªPOCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»“åº“çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤º CVE-2022-22965 æ¼æ´žã€‚ç„¶è€Œï¼Œå§‹ç»ˆå­˜åœ¨ä»£ç ä¸­åŒ…å«æ¶æ„æˆ–åŽé—¨ä»£ç çš„é£Žé™©ï¼Œå³ä½¿ä½œè€…çš„æ„å›¾æ˜¯è‰¯æ€§çš„ã€‚ä»£ç ä¸­æ£€æµ‹åˆ°æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žã€‚é£Žé™©ä¼°è®¡ä¸º 10%ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š

*   Dockerfileï¼šå®ƒä¸‹è½½äº†ä¸€ä¸ªæŒ‡å®šçš„tomcatç‰ˆæœ¬ï¼Œå¦‚æžœè¯¥dockerå­˜åœ¨åŽé—¨ï¼Œåˆ™å­˜åœ¨é£Žé™©
*   `README.md` æŽ¨èäº†LunaSecçš„åˆ†æ”¯ï¼Œå¯ä»¥æŽ¨æ–­æ˜¯å®˜æ–¹çš„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ¶‰åŠæ“çºµç±»åŠ è½½å™¨å’Œ servlet ä¸Šä¸‹æ–‡ä»¥å†™å…¥æ¶æ„ JSP æ–‡ä»¶åˆ° Tomcat çš„ webapp ç›®å½•ä¸­ï¼Œç„¶åŽæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹å®šæž„é€ çš„ HTTP è¯·æ±‚æ¥è§¦å‘è¯¥ JSP æ–‡ä»¶ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¯¥ POC ä»£ç ä¼¼ä¹Žæœ‰æ•ˆï¼Œä½†ä½¿ç”¨å’Œéƒ¨ç½² POC éœ€è¦è°¨æ…Žï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚å§‹ç»ˆå»ºè®®åœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ZapcoMan/spring4shell-vulnerable-application](https://github.com/ZapcoMan/spring4shell-vulnerable-application)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #9

**æ¥æº**: [CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md](../2022/CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), å­˜åœ¨RequestMappingå’ŒPOJOå‚æ•°

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨å¯èƒ½å—åˆ°å½±å“ã€‚è¯¥æ¼æ´žåˆ©ç”¨éœ€è¦åº”ç”¨éƒ¨ç½²ä¸ºTomcat WARåŒ…ã€‚å¦‚æžœéƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨æ•°æ®ç»‘å®šï¼Œå°†æ¶æ„å±žæ€§å†™å…¥åˆ°`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å±žæ€§ä¸­ï¼Œæœ€ç»ˆå†™å…¥æ¶æ„webshellã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellã€‚webshellçš„è·¯å¾„å’Œæ–‡ä»¶åå¯ä»¥é€šè¿‡è¯·æ±‚å‚æ•°æŒ‡å®šã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œæ—¨åœ¨é˜»æ­¢åˆ©ç”¨CVE-2022-22965çš„æ¶æ„è¯·æ±‚ã€‚å®ƒé€šè¿‡æ£€æŸ¥è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´æ¥è¯†åˆ«æ¶æ„æµé‡ï¼Œå¹¶è¿”å›ž403 Forbiddené”™è¯¯ã€‚æ­¤ä»£ç æœ¬èº«**ä¸åŒ…å«ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨**ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®ƒä¸»è¦é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¶æ„è¯·æ±‚ï¼Œå¦‚è¯·æ±‚è·¯å¾„åŒ…å«`/tomcatwar.jsp`æˆ–è€…HTTPå¤´éƒ¨åŒ…å«`suffix=%>//`ç­‰ç‰¹å¾ã€‚è¿™ä¸ªè„šæœ¬çš„ç›®çš„æ˜¯é˜²å¾¡Spring4Shellæ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨å®ƒã€‚

**é¡¹ç›®åœ°å€:** [bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-](https://github.com/bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #10

**æ¥æº**: [CVE-2022-22965-brunoh6_web-threat-mitigation.md](../2022/CVE-2022-22965-brunoh6_web-threat-mitigation.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², å¹¶ä¸”åº”ç”¨ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„ WebShell åˆ°æœåŠ¡å™¨ï¼Œæœ€ç»ˆå®žçŽ° RCEã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹ï¼ˆJDK 9+, Tomcat WARéƒ¨ç½²ï¼‰å¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç ï¼ˆ`web-threat-mitigation`ä»“åº“ï¼‰ä¹Ÿè¯å®žäº†è¿™ä¸€ç‚¹ï¼Œè¯¥ä»“åº“æä¾›äº†ä¸€ä¸ªä½¿ç”¨Metasploitè¿›è¡Œæ¼æ´žåˆ©ç”¨çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨æœ‰WAFå’Œæ— WAFçš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨çš„æˆåŠŸä¸Žå¤±è´¥ã€‚å› æ­¤ï¼Œå¯ä»¥åˆ¤æ–­POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©:**
åˆ†æžæä¾›çš„ä»£ç ä»“åº“ï¼Œä¸»è¦æ˜¯æ¼”ç¤ºå¦‚ä½•æ£€æµ‹å’Œç¼“è§£webåº”ç”¨ç¨‹åºå¨èƒï¼Œé€šè¿‡ OWASP ZAP, Burp Suite, å’Œ ModSecurity WAFã€‚å®ƒè¿˜åŒ…æ‹¬äº†CVE-2022-22965 (Spring4Shell)çš„æ¼æ´žåˆ©ç”¨ã€‚ä»£ç ä»“åº“ä¸­æ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åŽé—¨, ä½†æ˜¯è€ƒè™‘åˆ°ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹å’Œä¼ æ’­è¿™äº›ä»£ç ï¼Œä»¥åŠå®žé™…çŽ¯å¢ƒä¸­å¯èƒ½å­˜åœ¨çš„å¤æ‚æ€§ï¼Œä»ç„¶ä¸èƒ½å®Œå…¨æŽ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚ é£Žé™©ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **ç¡®å®šç›®æ ‡çŽ¯å¢ƒ:**  æ£€æŸ¥ç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ (Spring MVC/WebFlux, JDK 9+, Tomcat WARéƒ¨ç½²)ã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹Tomcatçš„`AccessLogValve`ç»„ä»¶å±žæ€§ã€‚
3.  **å†™å…¥WebShell:** é€šè¿‡ä¿®æ”¹`directory`ã€`prefix`ã€`suffix`å’Œ`pattern`å±žæ€§ï¼Œå°†WebShellå†™å…¥åˆ°æœåŠ¡å™¨ä¸Šçš„å¯è®¿é—®ç›®å½•ã€‚
4.  **æ‰§è¡Œå‘½ä»¤:**  é€šè¿‡è®¿é—®å†™å…¥çš„WebShellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é˜²å¾¡å»ºè®®:**
*   å‡çº§Spring Frameworkåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ (5.3.18+, 5.2.20+)ã€‚
*   ä½¿ç”¨WAF (å¦‚ModSecurity) å¹¶é…ç½®OWASP CRSæ¥æ£€æµ‹å’Œé˜»æ­¢æ¶æ„è¯·æ±‚ã€‚
*   é™åˆ¶æ•°æ®ç»‘å®šçš„ä½¿ç”¨ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥ç›´æŽ¥ç»‘å®šåˆ°æ•æ„Ÿå¯¹è±¡å±žæ€§ã€‚

**é¡¹ç›®åœ°å€:** [brunoh6/web-threat-mitigation](https://github.com/brunoh6/web-threat-mitigation)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #11

**æ¥æº**: [CVE-2022-22965-c33dd_CVE-2022-22965.md](../2022/CVE-2022-22965-c33dd_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ç§è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ Spring Framework ä¸­ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æ­¤æ¼æ´žï¼Œå‘æŸäº›å‚æ•°ä¼ é€’ç‰¹åˆ¶çš„æ¶æ„è¯·æ±‚ï¼Œä»Žè€ŒèŽ·å¾—å¯¹æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºéœ€è¦è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚ä½¿ç”¨ Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æ¼æ´žè§¦å‘ï¼š** æ¼æ´žåˆ©ç”¨æ¶‰åŠæ“çºµç±»åŠ è½½å™¨ç»•è¿‡å®‰å…¨æœºåˆ¶ã€‚é€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œå¯ä»¥å†™å…¥æ¶æ„ Web shellã€‚
3.  **å…·ä½“æ­¥éª¤ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ã€‚è¿™äº›å‚æ•°è¢« Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶å¤„ç†ï¼Œå¯¼è‡´ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§è¢«ä¿®æ”¹ï¼Œä»Žè€Œå†™å…¥ Web shell åˆ°æœåŠ¡å™¨çš„å¯è®¿é—®ä½ç½®ã€‚
4.  **ä»£ç åˆ†æžï¼š** æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªCç¨‹åºï¼Œè¯¥ç¨‹åºå°è¯•é€šè¿‡HTTPè¯·æ±‚ä¸Žç›®æ ‡æœåŠ¡å™¨é€šä¿¡ï¼Œå¹¶æ£€æŸ¥å“åº”çŠ¶æ€ç ä»¥ç¡®å®šæ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å…³é”®éƒ¨åˆ†åœ¨äºŽæž„é€ ç‰¹å®šçš„HTTPå¤´ï¼Œä¾‹å¦‚`suffix`å’Œ`c1`ï¼Œä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žã€‚ä»£ç ä¸­æ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„Cä»£ç ç‰‡æ®µçœ‹èµ·æ¥åƒæ˜¯æ¼æ´žåˆ©ç”¨çš„å‰æœŸæ£€æŸ¥å·¥å…·ï¼Œç”¨äºŽéªŒè¯ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®šheaderçš„HTTPè¯·æ±‚å¹¶æ£€æŸ¥å“åº”æ¥å°è¯•åˆ©ç”¨è¯¥æ¼æ´žã€‚å¦‚æžœæœåŠ¡å™¨è¿”å›ž 2XX çŠ¶æ€ç ï¼Œåˆ™è®¤ä¸ºæ¼æ´žå­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ä»”ç»†å®¡æŸ¥æä¾›çš„Cä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„ã€æ¶æ„çš„æˆ–éšè—çš„åŽé—¨ä»£ç ã€‚ä»£ç çš„åŠŸèƒ½ä¸»è¦æ˜¯å‘é€HTTPè¯·æ±‚ï¼Œè¯»å–å“åº”ï¼Œå¹¶æ ¹æ®å“åº”ç åˆ¤æ–­æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚ å› æ­¤ï¼Œè¯„ä¼°çš„æŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [c33dd/CVE-2022-22965](https://github.com/c33dd/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #12

**æ¥æº**: [CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md](../2022/CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼Œæ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

ä»Žæä¾›çš„æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´žåº“ä¿¡æ¯æ˜Žç¡®æŒ‡å‡ºå­˜åœ¨RCEçš„å¯èƒ½ï¼Œå¹¶æåŠäº†åˆ©ç”¨æ¡ä»¶ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­åŒ…å«å¤§é‡å…³äºŽè¯¥æ¼æ´žçš„åˆ†æžå’Œåˆ©ç”¨æ–‡ç« ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«å¹¿æ³›ç ”ç©¶å’Œåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å®žçŽ°äº†åˆ©ç”¨è¯¥æ¼æ´žä¸Šä¼ webshellçš„åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹classloaderç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚æ‰§è¡ŒçŠ¶æ€åˆ¤æ–­è¡¨æ˜Žï¼ŒPOC è‡³å°‘èƒ½å¤Ÿå®Œæˆwebshellçš„ä¸Šä¼ è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»”ç»†åˆ†æžæä¾›çš„ exploit1.py å’Œ exploit2.py è„šæœ¬ï¼Œä»¥åŠ README.md æ–‡ä»¶ï¼Œä¸»è¦é£Žé™©ç‚¹åœ¨äºŽï¼š

*   **ç¡¬ç¼–ç å¯†ç ï¼š** exploit1.py ä¸­å­˜åœ¨é»˜è®¤å¯†ç  `thm`ï¼Œå¦‚æžœæ”»å‡»è€…æ²¡æœ‰ä¿®æ”¹å¯†ç å°±ç›´æŽ¥ä½¿ç”¨ï¼Œå­˜åœ¨è¢«å…¶ä»–æ¶æ„ç”¨æˆ·åˆ©ç”¨çš„é£Žé™©ã€‚è™½ç„¶è¿™ä¸ç®—æ˜¯ä»£ç å±‚é¢çš„æŠ•æ¯’ï¼Œä½†å±žäºŽé…ç½®ä¸å½“å¯èƒ½å¯¼è‡´çš„é£Žé™©ã€‚
*   **æ–‡ä»¶åå’Œç›®å½•ï¼š** é»˜è®¤çš„æ–‡ä»¶å `tomcatwar.jsp` å’Œç›®å½• `ROOT` å¯èƒ½ä¼šè¢«ç›‘æŽ§ç³»ç»Ÿæ£€æµ‹åˆ°ï¼Œä½†è¿™æ›´å¤šæ˜¯æ–¹ä¾¿åˆ©ç”¨ï¼Œè€Œéžéšè—çš„æ¶æ„è¡Œä¸ºã€‚
*   **ä¾èµ–é¡¹é£Žé™©ï¼š** README.md ä¸­æåˆ°äº† Maven ç¼–è¯‘å’Œ Tomcat ä¾èµ–ï¼Œå¦‚æžœä½¿ç”¨çš„ Maven ä»“åº“æˆ– Tomcat é•œåƒè¢«æ¶æ„ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚è¿™å±žäºŽä¾›åº”é“¾é£Žé™©ï¼Œè€Œéžä»£ç æœ¬èº«æŠ•æ¯’ã€‚
*    **ä»£ç†æœåŠ¡å™¨é£Žé™©**: åœ¨ exploit1.py è„šæœ¬ä¸­ï¼Œæ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¿žæŽ¥ï¼Œè™½ç„¶æ˜¯æ–¹ä¾¿è¿›è¡ŒHTTPæ¶ˆæ¯æ‹¦æˆªï¼Œä½†ä¹Ÿå­˜åœ¨ä»£ç†æœåŠ¡å™¨æ”¶é›†è¯·æ±‚ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚è¿™ä¸å±žäºŽæ˜¯POCæŠ•æ¯’èŒƒç•´ï¼Œæ˜¯å±žäºŽä½¿ç”¨è€…ä¿¡æ¯å®‰å…¨èŒƒç•´ã€‚
*   **å…è´£å£°æ˜Žå’Œå­¦ä¹ ç›®çš„ï¼š** README.md ä¸­å£°æ˜Ž PoC ä»…ç”¨äºŽå­¦ä¹ ç›®çš„ï¼Œä½†æ— æ³•ä¿è¯ä½¿ç”¨è€…ä¸ä¼šå°†å…¶ç”¨äºŽéžæ³•ç”¨é€”ã€‚

ç»¼åˆæ¥çœ‹ï¼Œä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†å­˜åœ¨ä¸€äº›é…ç½®é£Žé™©å’Œä¾èµ–é¡¹é£Žé™©ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º **10%**ã€‚è¿™ä¸ªç™¾åˆ†æ¯”ä¸»è¦è€ƒè™‘ä½¿ç”¨è€…åœ¨ä½¿ç”¨é»˜è®¤é…ç½®å¯èƒ½å¸¦æ¥çš„é£Žé™©ä»¥åŠå¼•å…¥æ¶æ„ä¾èµ–çš„æ½œåœ¨å¯èƒ½ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…å½¢å¼éƒ¨ç½²ã€‚åº”ç”¨ä½¿ç”¨äº† Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP POST è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ `AccessLogValve` ç»„ä»¶çš„å±žæ€§ã€‚
3.  **ä¿®æ”¹æ—¥å¿—é…ç½®ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ `pattern` å±žæ€§ï¼Œå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚`directory`ã€`prefix`ã€`suffix` å’Œ `fileDateFormat` å±žæ€§ç”¨äºŽæŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ï¼Œç¡®ä¿ JSP ä»£ç èƒ½å¤Ÿå†™å…¥åˆ° webapps ç›®å½•ä¸‹ï¼Œå¹¶ä»¥ JSP æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚
4.  **ä¸Šä¼  Webshellï¼š**  æˆåŠŸä¿®æ”¹æ—¥å¿—é…ç½®åŽï¼ŒTomcat ä¼šå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ webapps ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª Webshellã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š**  æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell çš„ URLï¼Œæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [cxzero/CVE-2022-22965-spring4shell](https://github.com/cxzero/CVE-2022-22965-spring4shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #13

**æ¥æº**: [CVE-2022-22965-dbgee_Spring4Shell.md](../2022/CVE-2022-22965-dbgee_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œä¹Ÿè¢«ç§°ä¸º Spring4Shellï¼Œæ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥ä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„ Web shellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œç¡®è®¤è¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨ä»£ç ã€‚æ¼æ´žçš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ï¼šè¿è¡Œåœ¨ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šï¼Œå¹¶ä½¿ç”¨ Spring MVC æˆ– Spring WebFluxã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/654a99bf9ba51c6c41107b986ba46894/mvnw` çœ‹èµ·æ¥æ˜¯ Maven Wrapper è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åœ¨æ²¡æœ‰å®‰è£… Maven çš„çŽ¯å¢ƒä¸‹ä¹Ÿèƒ½æž„å»º Maven é¡¹ç›®ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨ä»£ç ã€‚æŠ•æ¯’çš„é£Žé™©åœ¨äºŽï¼š

*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ Maven é¡¹ç›®çš„ `pom.xml` æ–‡ä»¶ï¼Œæ·»åŠ æ¶æ„çš„ä¾èµ–é¡¹ã€‚å½“ Maven Wrapper æž„å»ºé¡¹ç›®æ—¶ï¼Œä¼šä¸‹è½½å¹¶æ‰§è¡Œè¿™äº›æ¶æ„ä¾èµ–é¡¹ä¸­çš„ä»£ç ï¼Œä»Žè€Œå®žçŽ°æŠ•æ¯’ã€‚è™½ç„¶ä»£ç ç‰‡æ®µæœ¬èº«æ²¡æœ‰æ¶æ„ï¼Œä½† Maven æž„å»ºè¿‡ç¨‹çš„æ€§è´¨å†³å®šäº†å­˜åœ¨è¿™ç§é£Žé™©ã€‚
*   **é…ç½®æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ Maven çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æž„å»ºè¿‡ç¨‹ï¼Œæ’å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ° Maven Wrapper çš„åŠŸèƒ½ä»¥åŠæ½œåœ¨çš„æž„å»ºè¿‡ç¨‹ç¯¡æ”¹ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåˆ©ç”¨æ–¹å¼ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1.  **ç¡®å®šç›®æ ‡ï¼š** æ‰¾åˆ°æ»¡è¶³æ¼æ´žåˆ©ç”¨æ¡ä»¶çš„ Spring åº”ç”¨ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ä¼šä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥ Web Shellï¼š** é€šè¿‡ä¿®æ”¹è®¿é—®æ—¥å¿—é…ç½®ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ Web shellï¼‰å†™å…¥åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ã€‚
4.  **æ‰§è¡Œå‘½ä»¤ï¼š** é€šè¿‡è®¿é—®å†™å…¥çš„ Web shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œå¦‚æžœç›®æ ‡åº”ç”¨ç¨‹åºæ»¡è¶³åˆ©ç”¨æ¡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ©ç”¨è¯¥æ¼æ´žæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [dbgee/Spring4Shell](https://github.com/dbgee/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #14

**æ¥æº**: [CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md](../2022/CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md)

## CVE-2022-22965 Spring4Shell è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.0 to 5.3.17, 5.2.0 to 5.2.19 and older versions

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ“çºµClassLoaderï¼Œä»Žè€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žå·²è¢«å…¬å¼€åˆ©ç”¨ï¼Œå¹¶æœ‰å¯ç”¨çš„POCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æŸ¥çœ‹æä¾›çš„exploit.pyä»£ç ï¼Œä»£ç ç»“æž„éžå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æžå™¨ï¼Œä½†runå’Œcheckå‡½æ•°å‡æœªå®žçŽ°ï¼Œæ˜¯æœªå®Œæˆçš„POCã€‚ç›´æŽ¥åˆ†æžæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ç”±äºŽä»£ç ä¸å®Œæ•´ï¼Œæœªæ¥å­˜åœ¨è¢«ä¿®æ”¹å¹¶æ·»åŠ æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»“åº“æœ¬èº«æ˜¯PoCæ€§è´¨ï¼Œä»¥åŠä»£ç çš„æœªå®ŒæˆçŠ¶æ€ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚è¯¥ä»“åº“è¿˜å¼•ç”¨äº†å…¶ä»–ä»“åº“ï¼Œéœ€è¦æ³¨æ„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** åº”ç”¨ç¨‹åºå¿…é¡»è¿è¡Œåœ¨JDK 9+ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºä¼ ç»Ÿçš„WARåŒ…åœ¨TomcatæœåŠ¡å™¨ä¸­ã€‚
2.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpring Frameworkçš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚å½“ä½¿ç”¨`RequestMapping`æ³¨è§£å’ŒPOJOå‚æ•°æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹`class.module.classLoader`ç­‰å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—ç›®å½•ï¼Œå†™å…¥webshellæˆ–å…¶ä»–æ¶æ„ä»£ç ã€‚
3.  **æ”»å‡»æ­¥éª¤ï¼ˆåŸºäºŽå·²çŸ¥åˆ©ç”¨æ–¹å¼ï¼‰ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`å±žæ€§ï¼Œå°†Tomcatçš„access logé…ç½®ä¸ºwebshellã€‚
    *   è®¿é—®webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [gokul-ramesh/Spring4Shell-PoC-exploit](https://github.com/gokul-ramesh/Spring4Shell-PoC-exploit)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #15

**æ¥æº**: [CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md](../2022/CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcatä½œä¸ºWARéƒ¨ç½²ï¼Œä½¿ç”¨Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªåœ¨ Spring Framework ä¸­å‘çŽ°çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šï¼Œæ“çºµæŸäº›å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä½¿ç”¨JDK 9+å¹¶ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šçš„Springåº”ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ©ç”¨æ¡ä»¶:**  éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
    *   éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚
    *   ä½¿ç”¨å—å½±å“çš„ Spring Framework ç‰ˆæœ¬ (5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+)ã€‚
2.  **æ¼æ´žåŽŸç†:** é€šè¿‡æ“çºµ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellåˆ°å¯è®¿é—®çš„ç›®å½•ã€‚
3.  **åˆ©ç”¨æ­¥éª¤:**
    *   å‘é€æ¶æ„æž„é€ çš„HTTPè¯·æ±‚ï¼ŒåŒ…å«ç²¾å¿ƒè®¾è®¡çš„å‚æ•°ï¼Œä»¥ä¿®æ”¹Tomcatçš„æ—¥å¿—è®¾ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°Webå¯è®¿é—®çš„ç›®å½•ã€‚
    *   æ—¥å¿—å†…å®¹åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚JSP webshellã€‚
    *   é€šè¿‡è®¿é—®webshellçš„URLï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç  (`spring4shell.py`) æ—¨åœ¨è‡ªåŠ¨åŒ–ä¸Šè¿°è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

æä¾›çš„Pythonè„šæœ¬`spring4shell.py`ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨CVE-2022-22965æ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®å†™å…¥webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è™½ç„¶è¯¥è„šæœ¬æœ¬èº«æ˜¯ä¸ºäº†æ”»å‡»åˆ©ç”¨è€Œç¼–å†™çš„ï¼Œä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨è€…ç›´æŽ¥ä¸‹è½½å¹¶ä½¿ç”¨æœªç»ä»”ç»†å®¡æŸ¥çš„ä»£ç æ—¶ã€‚

å…·ä½“åˆ†æžå¦‚ä¸‹ï¼š

*   **é£Žé™©ç‚¹1ï¼š**  è„šæœ¬ä¸­å¯èƒ½ä¼šåŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åŽé—¨ã€æ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å¤–ä¼ ç­‰ã€‚è™½ç„¶ç›®å‰çš„ä»£ç ç‰‡æ®µçœ‹èµ·æ¥ç›¸å¯¹ç›´æŽ¥ï¼Œä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ é¢å¤–çš„æ¶æ„åŠŸèƒ½ã€‚
*   **é£Žé™©ç‚¹2ï¼š**  è¯¥è„šæœ¬ä¾èµ–äºŽç¬¬ä¸‰æ–¹åº“ (`requests`, `bs4`)ï¼Œè¿™äº›åº“æœ¬èº«å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´žï¼Œæˆ–è€…è¢«æ”»å‡»è€…æ›¿æ¢ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚è™½ç„¶`pip3 install bs4` å’Œ `pip3 install requests`  æ˜¯å®‰è£…å¸¸ç”¨åº“ï¼Œä½†å¦‚æžœæºè¢«åŠ«æŒï¼Œå¯èƒ½ä¼šå®‰è£…æ¶æ„ç‰ˆæœ¬ã€‚
*   **é£Žé™©ç‚¹3ï¼š**  è„šæœ¬ä¸­çš„é»˜è®¤å‚æ•°ï¼Œä¾‹å¦‚webshellçš„æ–‡ä»¶åã€å¯†ç ã€ä¸Šä¼ ç›®å½•ç­‰ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚å¦‚æžœæ”»å‡»è€…èƒ½å¤Ÿé¢„æµ‹æˆ–æŽ§åˆ¶è¿™äº›å‚æ•°ï¼Œå°±å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡ŒåŽç»­æ”»å‡»ã€‚

ç”±äºŽå­˜åœ¨ä»¥ä¸Šæ½œåœ¨é£Žé™©ï¼Œåœ¨ä½¿ç”¨ä»»ä½•å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¹‹å‰ï¼Œéƒ½å¿…é¡»è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ï¼Œç¡®ä¿ä»£ç çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚æ­¤å¤–ï¼Œå»ºè®®ä¿®æ”¹é»˜è®¤å‚æ•°ï¼Œå¢žåŠ æ”»å‡»éš¾åº¦ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**
è€ƒè™‘åˆ°ä»£ç åŠŸèƒ½ç›¸å¯¹é›†ä¸­äºŽæ¼æ´žåˆ©ç”¨ï¼Œä¸”ä½œè€…ä¹Ÿç»™å‡ºäº†GitHubåœ°å€ï¼Œåˆæ­¥åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£Žé™©ä¸º10%ã€‚è¿™ä¸ªæ¦‚çŽ‡è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—æ¶æ„ä»£ç ï¼Œæˆ–è€…å°†æ¥ä»£ç ä»“åº“è¢«å…¥ä¾µåŽæ¤å…¥æ¶æ„ä»£ç çš„æƒ…å†µã€‚

**é¡¹ç›®åœ°å€:** [guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965](https://github.com/guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #16

**æ¥æº**: [CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md](../2022/CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions on JDK 9+ with Tomcat as WAR deployment.

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡åº”ç”¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„Spring Frameworkç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å—å½±å“çš„Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æŸäº›ç‰¹æ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå½±å“è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨ç¨‹åºå¿…é¡»ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨ä»£ç é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®žçŽ°RCEï¼š

1.  **é‡ç½®æ—¥å¿—å˜é‡:** é€šè¿‡ä¿®æ”¹`fileDateFormat`å‚æ•°æ¥åˆå§‹åŒ–ã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®:** æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºæ ¼å¼è®¾ç½®ä¸ºåŒ…å«å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„JSPä»£ç ã€‚
3.  **å†™å…¥ Webshell:**  é€šè¿‡headerå¤´ä¼ é€’åŒ…å«Runtimeçš„å‚æ•°å’Œå‘½ä»¤æ‰§è¡Œçš„é€»è¾‘ï¼Œé€šè¿‡ä¿®æ”¹è¿‡çš„æ—¥å¿—é…ç½®å†™å…¥webshellåˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ã€‚
4.  **å‘½ä»¤æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®å†™å…¥çš„webshellï¼Œä¼ é€’`cmd`å‚æ•°æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
5.  **æ¸…ç†æ—¥å¿—å˜é‡:** æ¸…ç†ä¹‹å‰ä¿®æ”¹çš„æ—¥å¿—å˜é‡ï¼Œé˜²æ­¢æ¶æ„å†™å…¥ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ©ç”¨äº†ä¸å®‰å…¨çš„é…ç½®ä¿®æ”¹æ¥å†™å…¥ Webshell.

**æŠ•æ¯’é£Žé™©è¯„ä¼°:** æ­¤ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦10%ã€‚Dockerfileä¸­ä½¿ç”¨lunasec/tomcat-9.0.59-jdk11ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™æœ¬èº«å…·å¤‡ä¸€å®šçš„å®‰å…¨æ€§ï¼Œmavenæž„å»ºæµç¨‹ç›¸å¯¹æ ‡å‡†ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç æ³¨å…¥è¡Œä¸ºï¼Œæœ€ä¸»è¦çš„é£Žé™©ç‚¹åœ¨äºŽ`vulnerable-app`ç›®å½•ä¸‹çš„æºä»£ç ï¼Œå¦‚æžœè¯¥ç›®å½•ä¸‹çš„æºä»£ç åŒ…å«æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“:** è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯å…ˆä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºé‡å®šå‘åˆ°Webç›®å½•ï¼Œå¹¶è®¾ç½®æ—¥å¿—å†…å®¹ä¸ºå¯æ‰§è¡Œçš„JSPä»£ç ã€‚ç„¶åŽï¼Œå‘é€åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œä½¿Tomcatå°†JSPä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œä»Žè€Œåœ¨Webç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªwebshellã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [jakabakos/CVE-2022-22965-Spring4Shell](https://github.com/jakabakos/CVE-2022-22965-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #17

**æ¥æº**: [CVE-2022-22965-jashan-lefty_Spring4Shell.md](../2022/CVE-2022-22965-jashan-lefty_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux application

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽSpring Frameworkä¸­ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œè¯¥æ¼æ´žåªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯è¢«åˆ©ç”¨ï¼Œå³ï¼š

*   è¿è¡Œåœ¨JDK 9+ä¹‹ä¸Šã€‚
*   ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šã€‚
*   ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFluxã€‚

**POCæœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„`test.py`è„šæœ¬å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚å®ƒé€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°Tomcatçš„webapps/ROOTç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°RCEã€‚è„šæœ¬å°è¯•è®¾ç½®`pattern`å±žæ€§ï¼ˆç”¨äºŽå®šä¹‰JSPæ–‡ä»¶çš„å†…å®¹ï¼ŒåŒ…å«åŽé—¨ä»£ç ï¼‰ï¼Œ`suffix`å±žæ€§ï¼ˆè®¾ç½®ä¸º.jspï¼‰ï¼Œ`directory`å±žæ€§ï¼ˆè®¾ç½®ä¸ºwebapps/ROOTï¼‰ï¼Œ`prefix`å±žæ€§ï¼ˆè®¾ç½®ä¸ºtomcatwarï¼‰ï¼Œä»¥åŠ`fileDateFormat`å±žæ€§ã€‚

æ ¹æ®æœç´¢å¼•æ“Žç»“æžœï¼Œæ­¤æ¼æ´žåœ¨é‡Žå¤–å·²è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚`test.py`è„šæœ¬ä¸­çš„payloadç»“æž„ä¸Žå…¬å¼€çš„Spring4Shellåˆ©ç”¨æ–¹å¼ç›¸ç¬¦ï¼Œæ‰€ä»¥è¯¥POCä»£ç æœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

è¯¥ä»“åº“åŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š`README.md`ï¼Œ`fw_handler.py` å’Œ `test.py`ã€‚

*   `README.md` æè¿°äº†å¯¹æ¼æ´žçš„åˆ†æžå’Œé˜²å¾¡æŽªæ–½ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `fw_handler.py` å®žçŽ°äº†ç®€å•çš„é˜²ç«å¢™ï¼Œç”¨äºŽé˜»æ­¢åŒ…å«ç‰¹å®špayloadçš„è¯·æ±‚ï¼Œç”¨äºŽé˜²å¾¡æ”»å‡»ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `test.py` åŒ…å«æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œæ—¨åœ¨éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®špayloadçš„POSTè¯·æ±‚ï¼Œå°è¯•åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥æ¶æ„çš„JSPæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªåŽé—¨ï¼Œå…è®¸é€šè¿‡`pwd`å’Œ`cmd`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ­¤éƒ¨åˆ†**å¹¶éž**æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯æ¼æ´žéªŒè¯å’Œåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

è™½ç„¶æ•´ä¸ªä»“åº“çš„ä¸»é¢˜æ˜¯å…³äºŽæ¼æ´žåˆ†æžå’Œé˜²å¾¡ï¼Œä½† `test.py` ä¸­çš„åˆ©ç”¨ä»£ç å¦‚æžœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£Žé™©ã€‚ä½†å°±ä»“åº“æœ¬èº«è€Œè¨€ï¼Œä½œè€…ç›´æŽ¥æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œ`fw_handler.py`åè€Œæ˜¯é˜²å¾¡æ‰‹æ®µ, æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ˜¯åˆ©ç”¨æ¼æ´žçš„æ‰‹æ®µï¼Œä¸åº”è¢«è§†ä¸ºæŠ•æ¯’ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º10%ã€‚è¿™ä¸ª10%ä¸»è¦è€ƒè™‘çš„æ˜¯ä»“åº“çš„ç»´æŠ¤è€…å¯èƒ½è¢«é»‘å®¢å…¥ä¾µï¼Œç„¶åŽæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ç”¨äºŽä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§çš„payloadã€‚
2.  è¿™äº›å±žæ€§çš„ä¿®æ”¹å…è®¸æ”»å‡»è€…åœ¨Tomcatçš„webapps/ROOTç›®å½•ä¸‹å†™å…¥ä»»æ„JSPæ–‡ä»¶ã€‚
3.  å†™å…¥çš„JSPæ–‡ä»¶åŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ä¸€ä¸ªWebshellï¼‰ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [jashan-lefty/Spring4Shell](https://github.com/jashan-lefty/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #18

**æ¥æº**: [CVE-2022-22965-likewhite_CVE-2022-22965.md](../2022/CVE-2022-22965-likewhite_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´žå­˜åœ¨äºŽè¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶ä¸”éœ€è¦ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡ŒjaråŒ…ï¼Œåˆ™ä¸æ˜“å—æ­¤æ¼æ´žå½±å“ã€‚æœç´¢ç»“æžœè¯å®žäº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æŒ‡å‡ºè¯¥æ¼æ´žæ˜“äºŽåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å°è¯•åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve çš„å±žæ€§æ¥å†™å…¥ webshellã€‚è¯¥åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡ç³»ç»Ÿæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ Spring ç‰ˆæœ¬ã€JDK ç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼å’Œ Tomcat é…ç½®ç­‰ã€‚è™½ç„¶`teamserver`å’Œ`readme.md`æ–‡ä»¶çœ‹èµ·æ¥ä¸ç›¸å…³ï¼Œä½†`CVE-2022-22965.py`æ–‡ä»¶æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚`teamserver`æ–‡ä»¶æ˜¯Cobalt Strikeçš„å¯åŠ¨è„šæœ¬ï¼Œä¸Žæ¼æ´žåˆ©ç”¨æ— å…³ã€‚`readme.md`åªæ˜¯æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ¡ä»¶ï¼Œå¹¶æ²¡æœ‰åŒ…å«æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ç½‘ç»œèµ„æºå¯èƒ½è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä¾ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’å¯èƒ½ï¼ˆ5%ï¼‰ï¼Œä½†ç›®å‰æ— æ³•ç›´æŽ¥ä»Žä»£ç ä¸­å¾—å‡ºç»“è®ºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹AccessLogValveï¼š**  åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼ŒåŠ¨æ€ä¿®æ”¹Tomcatçš„AccessLogValveç»„ä»¶çš„å±žæ€§ï¼Œä¾‹å¦‚`directory`ï¼Œ`prefix`ï¼Œ`suffix`å’Œ`pattern`ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹`pattern`å±žæ€§ï¼Œå°†ä¸€æ®µåŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼‰çš„JSPä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ç›®å½•å’Œæ–‡ä»¶åçš„Webshellä¸­ã€‚
4.  **æ‰§è¡ŒWebshellï¼š**  æ”»å‡»è€…è®¿é—®å†™å…¥çš„Webshellï¼Œå¹¶ä¼ é€’å‘½ä»¤å‚æ•°ï¼Œä»Žè€Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [likewhite/CVE-2022-22965](https://github.com/likewhite/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #19

**æ¥æº**: [CVE-2022-22965-osungjinwoo_CVE-2022-22965.md](../2022/CVE-2022-22965-osungjinwoo_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„å’Œä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´žæ˜¯ Spring4Shellï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ï¼Œå†™å…¥æ¶æ„ webshell æ–‡ä»¶åˆ° webapps ç›®å½•ä¸‹ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼ŒåŒ…æ‹¬ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…çš„ Tomcatï¼Œä»¥åŠä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚æä¾›çš„ Python å’Œ Bash è„šæœ¬å‡æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´žã€‚å­˜åœ¨è½»å¾®æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨è„šæœ¬å¯èƒ½åŒ…å«ä¸‹è½½å…¶ä»–æ¶æ„æ–‡ä»¶çš„ä»£ç æˆ–è€…ä¿®æ”¹æœåŠ¡å™¨é…ç½®ç­‰ï¼Œä½†ä¸»è¦åŠŸèƒ½æ˜¯å®žçŽ°RCEï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æœ‰æ•ˆæ€§åˆ†æž:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰ç§¯æžçš„åˆ©ç”¨æ¡ˆä¾‹ã€‚POC ä»£ç å°è¯•ä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ä»¥å†™å…¥ Webshellï¼Œè¿™æ˜¯ä¸€ç§å·²çŸ¥çš„åˆ©ç”¨æ–¹å¼ï¼Œå› æ­¤æä¾›çš„POCä»£ç **æœ‰æ•ˆ**ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æž:** æŸ¥çœ‹æä¾›çš„è„šæœ¬`spring4shell.py`å’Œ`spring4shell.sh`ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žä¸Šä¼ webshellï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºæ¯”å¦‚åˆ é™¤æ–‡ä»¶ï¼Œåå‘è¿žæŽ¥æ¶æ„æœåŠ¡å™¨ç­‰ã€‚`README.md`ä¸­å¼•ç”¨äº†å¤–éƒ¨é“¾æŽ¥ï¼Œå­˜åœ¨ä¸€å®šçš„è·³è½¬é£Žé™©ï¼Œä½†ä»£ç æœ¬èº«ä¸»è¦æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæ•…æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåˆ¤æ–­ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æ¼æ´žåŽŸç†ï¼š**  æ”»å‡»è€…é€šè¿‡æ“çºµ class.module.classLoader.resources.context.parent.pipeline.first çš„å±žæ€§ï¼Œä¿®æ”¹ Tomcat AccessLogValve çš„é…ç½®ï¼Œç‰¹åˆ«æ˜¯ pattern å±žæ€§ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æž„é€ åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œé€šè¿‡ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„ pattern å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
    *   ç”±äºŽ Tomcat çš„æ—¥å¿—æ–‡ä»¶é€šå¸¸ä½äºŽ webapps ç›®å½•ä¸‹ï¼Œå› æ­¤æ¶æ„ä»£ç å®žé™…ä¸Šè¢«å†™å…¥äº†ä¸€ä¸ª JSP æ–‡ä»¶ï¼ˆwebshellï¼‰ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥ JSP æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  **POCä»£ç åˆ†æž:**
    *   `spring4shell.py` è„šæœ¬ä½¿ç”¨ `requests` åº“å‘é€ POST è¯·æ±‚ï¼ŒåŒ…å«æž„é€ çš„æ¶æ„æ•°æ®ï¼Œç›®æ ‡ URL æ˜¯å­˜åœ¨æ¼æ´žçš„ Spring åº”ç”¨ã€‚
    *   `spring4shell.sh` è„šæœ¬åŒæ ·å‘é€æž„é€ çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ã€‚
    *   ä¸¤ä¸ªè„šæœ¬éƒ½è®¾ç½®äº†webshellå¯†ç ï¼Œä¸Šä¼ ç›®å½•ï¼Œwebshellæ–‡ä»¶åï¼Œæ”»å‡»æˆåŠŸåŽé€šè¿‡webshell urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚
4.  **å…ˆå†³æ¡ä»¶ï¼š**
    *   ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨éƒ¨ç½²ä¸º WAR åŒ…åˆ° Tomcat ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨ä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚
    *   éœ€è¦ç›®æ ‡æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®

**é¡¹ç›®åœ°å€:** [osungjinwoo/CVE-2022-22965](https://github.com/osungjinwoo/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #20

**æ¥æº**: [CVE-2022-22965-salo-404_firewall.md](../2022/CVE-2022-22965-salo-404_firewall.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ã€‚å¦å¤–ï¼ŒæœåŠ¡å™¨éœ€å­˜åœ¨å¯å†™ç›®å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡ä¿®æ”¹classLoaderæ¥å†™å…¥æ¶æ„web shell,ä»Žè€Œå¯¼è‡´RCEã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ­¤æ¼æ´žæ˜¯çœŸå®žä¸”å¯è¢«åˆ©ç”¨çš„ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡Spring4Shellæ”»å‡»ï¼Œæœ¬èº«ä¸åŒ…å«æ”»å‡»è½½è·ï¼Œä½†æ˜¯èƒ½å¤Ÿæ£€æµ‹åˆ©ç”¨å°è¯•ï¼Œè¿™é—´æŽ¥è¯æ˜Žäº†æ­¤æ¼æ´žçš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ªæ¨¡æ‹Ÿé˜²ç«å¢™çš„Pythonè„šæœ¬ï¼ˆfirewall_server.pyï¼‰ã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ£€æµ‹å¹¶é˜»æ­¢Spring4Shellæ¼æ´žçš„åˆ©ç”¨ã€‚å®¡æŸ¥è¯¥è„šæœ¬åŽï¼Œå‘çŽ°å®ƒä¸»è¦é€šè¿‡æ£€æŸ¥HTTP POSTæ•°æ®ä¸­çš„æ¶æ„é”®ã€headerã€æœ‰æ•ˆè½½è·ç‰¹å¾æ¥å·¥ä½œã€‚æ²¡æœ‰å‘çŽ°ä»»ä½•è¿¹è±¡è¡¨æ˜Žä½œè€…è¯•å›¾åœ¨ä»£ç ä¸­éšè—ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º10%ã€‚é£Žé™©ä¸»è¦æ¥è‡ªäºŽå¯¹äºŽæ‹¦æˆªè§„åˆ™çš„ç»•è¿‡å’Œæœªæ¥æ½œåœ¨çš„æ¶æ„ä¿®æ”¹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpringæ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå®ƒå…è®¸å°†HTTPè¯·æ±‚å‚æ•°è‡ªåŠ¨ç»‘å®šåˆ°Javaå¯¹è±¡çš„å±žæ€§ä¸Šã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`classLoader`ç­‰å…³é”®å¯¹è±¡ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ã€‚
    *   éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ï¼ˆSpring Bootå¯æ‰§è¡Œjaré»˜è®¤éƒ¨ç½²æ–¹å¼ä¸å—å½±å“ï¼‰ã€‚
    *   ç›®æ ‡åº”ç”¨å­˜åœ¨å¯å†™ç›®å½•
3.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTP POSTè¯·æ±‚åˆ°å­˜åœ¨æ¼æ´žçš„ç«¯ç‚¹ã€‚
    *   æ¶æ„å‚æ•°ä¼šä¿®æ”¹Tomcatçš„æ—¥å¿—ç›®å½•ã€URIç¼–ç ç­‰é…ç½®ã€‚
    *   æ”»å‡»è€…ä¸Šä¼ åŒ…å«æ¶æ„ä»£ç çš„JSPæ–‡ä»¶åˆ°ä¿®æ”¹åŽçš„æ—¥å¿—ç›®å½•ï¼Œä»Žè€Œåˆ›å»ºä¸€ä¸ªwebshellã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [salo-404/firewall](https://github.com/salo-404/firewall)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #21

**æ¥æº**: [CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md](../2022/CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ä»¥åŠä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼Œå—å½±å“çš„ Spring Framework ç‰ˆæœ¬

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯Spring Frameworkä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚å®ƒå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåœ¨è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ç‰¹å®šçš„åˆ©ç”¨æ–¹å¼è¦æ±‚åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºTomcatä¸Šçš„WARåŒ…ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼šåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ“çºµç±»åŠ è½½å™¨å’Œè®¿é—®æ—¥å¿—ç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°æœåŠ¡å™¨ä¸­ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„ä»£ç ä¸»è¦æ˜¯è´¡çŒ®è€…è¡Œä¸ºå‡†åˆ™å’Œæäº¤è§„èŒƒï¼Œä¸åŒ…å«åŽé—¨ä»£ç ,å­˜åœ¨è½»å¾®æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œç¯¡æ”¹è´¡çŒ®æŒ‡å—ä»¥åŒ…å«æ¶æ„é“¾æŽ¥ï¼Œä½†ç›´æŽ¥ RCE åˆ©ç”¨çš„å¯èƒ½æ€§ä¸ºä½Žã€‚

**é¡¹ç›®åœ°å€:** [shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE](https://github.com/shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #22

**æ¥æº**: [CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md](../2022/CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** åˆ©ç”¨äº† Spring Framework åœ¨ JDK 9+ ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ—¶ï¼Œç”±äºŽç±»åŠ è½½å™¨æœºåˆ¶çš„æ”¹å˜ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first` çš„å±žæ€§ï¼Œæ¥ä¿®æ”¹ Tomcat çš„ access log valve çš„é…ç½®ï¼Œä»Žè€Œå†™å…¥æ¶æ„ JSP æ–‡ä»¶ã€‚

2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   JDK 9+
    *   å—å½±å“çš„ Spring Framework ç‰ˆæœ¬
    *   Tomcat ä½œä¸º WAR éƒ¨ç½²
    *   ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
    *   è¿™äº›æ¶æ„å‚æ•°ä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ï¼Œå°† pattern è®¾ç½®ä¸ºåŒ…å«æ¶æ„ä»£ç çš„ JSPã€‚
    *   Tomcat å°†æ¶æ„ä»£ç å†™å…¥åˆ° webapps/ROOT ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª JSP shell æ–‡ä»¶ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—® JSP shell æ–‡ä»¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

4.  **POC ä»£ç åˆ†æžï¼š** æä¾›çš„ `exploit.py` è„šæœ¬å®žçŽ°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ã€‚
    *   è„šæœ¬æž„é€ äº†åŒ…å«æ¶æ„å‚æ•°çš„ POST è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ã€‚
    *   `headers` å­—å…¸å®šä¹‰äº†è¯·æ±‚å¤´ï¼Œ`data` å˜é‡å®šä¹‰äº† POST è¯·æ±‚çš„æ•°æ®ï¼ŒåŒ…å«äº†ä¿®æ”¹ access log valve çš„ payloadã€‚
    *   è„šæœ¬å‘é€ POST è¯·æ±‚åˆ°ç›®æ ‡ URLï¼Œç„¶åŽå°è¯•è®¿é—®ç”Ÿæˆçš„ JSP shell æ–‡ä»¶ã€‚
    *   å¦‚æžœ JSP shell æ–‡ä»¶æˆåŠŸç”Ÿæˆå¹¶å¯ä»¥è®¿é—®ï¼Œè„šæœ¬ä¼šè¾“å‡º shell çš„ URLã€‚

5.  **æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žåœ¨æ»¡è¶³æ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

6.  **æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª JSP shellï¼Œ å…è®¸è¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚è„šæœ¬æœ¬èº«å¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•éšè—çš„ã€è¶…å‡ºæ­¤èŒƒå›´çš„æ¶æ„è¡Œä¸ºï¼Œå³æ²¡æœ‰å‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚è¯¥è„šæœ¬çš„åŠŸèƒ½ä¸Žæ¼æ´žåˆ©ç”¨æœ¬èº«ç›¸å…³ï¼Œæ—¨åœ¨éªŒè¯å’Œåˆ©ç”¨æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥æ¶æ„åŽé—¨ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ“çºµTomcatçš„æ—¥å¿—é…ç½®æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåœ°å®žçŽ°è¿™ä¸€æ”»å‡»ï¼Œä¸”æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚

**é¡¹ç›®åœ°å€:** [sohamsharma966/Spring4Shell-CVE-2022-22965](https://github.com/sohamsharma966/Spring4Shell-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #23

**æ¥æº**: [CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md](../2022/CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ ä»¥åŠæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ä¸”éƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡åº”ç”¨å¿…é¡»æ»¡è¶³ï¼šä½¿ç”¨Spring MVCæˆ–Spring WebFluxï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œé€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç›¸å…³çš„å±žæ€§ï¼ˆå¦‚`directory`, `prefix`, `suffix`, `pattern`ç­‰ï¼‰ï¼Œæ¥æŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥ä¸€ä¸ªæ¶æ„JSP webshellã€‚
2.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   é¦–å…ˆï¼Œåˆ©ç”¨POSTè¯·æ±‚é‡ç½®`fileDateFormat`å±žæ€§ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡POSTè¯·æ±‚è®¾ç½®Tomcatæ—¥å¿—é…ç½®ï¼ŒåŒ…æ‹¬æ—¥å¿—ç›®å½•ã€æ–‡ä»¶åå‰ç¼€ã€åŽç¼€å’ŒåŒ…å«æ¶æ„ä»£ç çš„æ—¥å¿—æ¨¡å¼ï¼Œè¿™äº›å‚æ•°è¢«ç¼–ç åœ¨URLä¸­ã€‚
    *   å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œè§¦å‘æ—¥å¿—è®°å½•ï¼Œå¹¶å°†æ¶æ„JSP webshellå†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚
    *   webshellåœ°å€ä¸º`http://ç›®æ ‡/å‰ç¼€.jsp?cmd=å‘½ä»¤`ã€‚
3.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ ¹æ®READMEçš„è¯´æ˜Žï¼Œå¯ä»¥æˆåŠŸåœ¨æ»¡è¶³æ¼æ´žæ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **æŠ•æ¯’é£Žé™©ï¼š**  è™½ç„¶ä¸»è¦ä»£ç æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œ`exploit-core.py`è„šæœ¬ä¸­ï¼Œæ¶æ„ä»£ç çš„å†™å…¥ç›®æ ‡ï¼ˆJSP webshellï¼‰æ˜¯ç¡¬ç¼–ç çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹è¿™äº›å‚æ•°ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ¤å…¥æ›´éšè”½æˆ–æ›´å…·ç ´åæ€§çš„åŽé—¨ã€‚Dockerfileä¸­çš„lunasec/tomcat-9.0.59-jdk11é•œåƒæ¥æºæœªç»éªŒè¯ï¼Œæœ‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä½†æ˜¯æ­¤ä»“åº“çš„é‡ç‚¹åœ¨äºŽspringæ¼æ´žåˆ©ç”¨ã€‚å‡è®¾Dockerfileä¸­çš„åŸºç¡€é•œåƒæ²¡æœ‰é—®é¢˜ï¼ŒæŠ•æ¯’é£Žé™©æ¯”ä¾‹çº¦ä¸º10%ã€‚
5.  **æ€»ç»“ï¼š** æ­¤æ¼æ´žçš„åˆ©ç”¨éœ€è¦ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼ŒåŠ¨æ€åœ°ä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ç›®æ ‡æœåŠ¡å™¨çš„çŽ¯å¢ƒæœ‰ä¸€å®šè¦æ±‚ï¼Œéœ€è¦ç‰¹å®šçš„Springç‰ˆæœ¬ã€JDKç‰ˆæœ¬å’Œéƒ¨ç½²æ–¹å¼ã€‚POCä»£ç çš„æœ‰æ•ˆæ€§å·²ç»ç¡®è®¤ï¼Œä½†ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [sunnyvale-it/CVE-2022-22965-PoC](https://github.com/sunnyvale-it/CVE-2022-22965-PoC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #24

**æ¥æº**: [CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md](../2022/CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcatä½œä¸ºWARéƒ¨ç½²

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†åœ¨JDK 9+çŽ¯å¢ƒä¸‹ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨çš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹classloaderä¸­çš„å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥webshellï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå·²åœ¨é‡Žå¤–è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„POCä»£ç ã€‚æä¾›çš„POCä»£ç åˆ©ç”¨äº†ä¿®æ”¹ Tomcat access log pattern çš„æ–¹å¼å†™å…¥ webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥æä¾›çš„POCä»£ç åŽï¼Œè™½ç„¶POCåˆ©ç”¨äº†å¸¸è§çš„æ¼æ´žåˆ©ç”¨æ–¹æ³•ï¼ˆå†™å…¥Webshellï¼‰ï¼Œä½†ä»£ç ä¸­åŒ…å«ä¸€ä¸ªå¯†ç éªŒè¯é€»è¾‘ `--password`ã€‚å¦‚æžœæ”»å‡»è€…ä¸æä¾›æ­£ç¡®çš„å¯†ç ï¼Œwebshellå°†æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä»Žè€Œå¢žåŠ äº†é˜²å¾¡çš„éš¾åº¦ï¼Œå­˜åœ¨ä¸€å®šæ¦‚çŽ‡ä¸ºåŽé—¨ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚è™½ç„¶webshellçš„å†™å…¥è¡Œä¸ºæœ¬èº«å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œä½†æ•´ä½“ä»£ç è¾ƒä¸ºç›´æŽ¥ï¼ŒæŠ•æ¯’å¯èƒ½æ€§è¾ƒä½Žã€‚é£Žé™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ã€‚
2.  è¯·æ±‚ä¸­åŒ…å«çš„å‚æ•°åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œwebshellï¼‰å†™å…¥Tomcatçš„access log patternã€‚
3.  è®¿é—®ç›®æ ‡åº”ç”¨çš„ç›¸åº”URLï¼Œè§¦å‘webshellæ‰§è¡Œã€‚
4.  æ”»å‡»è€…é€šè¿‡webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [viniciuspereiras/CVE-2022-22965-poc](https://github.com/viniciuspereiras/CVE-2022-22965-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #25

**æ¥æº**: [CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md](../2022/CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµclassloaderæ¥å†™å…¥webshellæˆ–è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œéœ€è¦JDK 9+ï¼Œå¹¶ä¸”åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œã€‚å¦‚æžœåº”ç”¨ä»¥Spring Boot executable jarï¼ˆé»˜è®¤æ–¹å¼ï¼‰éƒ¨ç½²ï¼Œåˆ™ä¸æ˜“å—åˆ°è¯¥æ¼æ´žå½±å“ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚POCåˆ©ç”¨äº†Spring Data Bindingçš„ç‰¹æ€§ï¼Œé€šè¿‡ä¿®æ”¹class.module.classLoader.resources.context.parent.pipeline.firstçš„å€¼ï¼Œä¿®æ”¹äº†Tomcatçš„access log patternï¼Œä»Žè€Œå†™å…¥webshellã€‚é€šè¿‡webshellçš„`Tomcat=S&cmd=`å‚æ•°å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„POCä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚å®ƒç›´æŽ¥åˆ©ç”¨äº†æ¼æ´žæ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•å°è¯•æ¥ä¿®æ”¹æˆ–ç ´åç›®æ ‡ç³»ç»Ÿä¸Šçš„å…¶ä»–æ–‡ä»¶æˆ–ç»„ä»¶ã€‚ä»£ç ç›®çš„æ˜Žç¡®ï¼Œå°±æ˜¯åˆ©ç”¨æ¼æ´žæ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œæ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„æ„å›¾çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©å¯ä»¥è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTP POSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸­åŒ…å«æ¶æ„çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„access log patternã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1.  å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚ï¼Œä¾‹å¦‚ï¼š
    ```
    class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22S%22.equals(request.getParameter(%22Tomcat%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=Shell&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=
    ```
2.  ä¸Šè¿°è¯·æ±‚ä¼šåœ¨`webapps/ROOT`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`Shell.jsp`çš„webshellã€‚ webshellå†…å®¹æ˜¯è¯»å–`cmd`å‚æ•°å¹¶æ‰§è¡Œã€‚
3.  è®¿é—®webshellï¼Œå¹¶é€šè¿‡`Tomcat=S&cmd=`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
    ```
    http://target.com/Shell.jsp?Tomcat=S&cmd=whoami
    ```

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªwebshellæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [xsxtw/SpringFramework_CVE-2022-22965_RCE](https://github.com/xsxtw/SpringFramework_CVE-2022-22965_RCE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #26

**æ¥æº**: [CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md](../2022/CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versionsï¼ŒJDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²

**åˆ©ç”¨æ¡ä»¶:** Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åºï¼Œè¿è¡Œåœ¨ JDK 9+ ä¸Šï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šã€‚éœ€è¦ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ä¸å½“çš„è¾“å…¥éªŒè¯ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

*   **å—å½±å“çš„Springç‰ˆæœ¬ï¼š** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions
*   **JDK ç‰ˆæœ¬ï¼š** JDK 9 åŠä»¥ä¸Š
*   **éƒ¨ç½²æ–¹å¼ï¼š** åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯ Spring Boot å¯æ‰§è¡Œ JARã€‚
*   **åˆ©ç”¨æ–¹å¼ï¼š**  æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„JSP Webshellåˆ°TomcatæœåŠ¡å™¨ï¼Œè¿›è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æ¼æ´žåˆ©ç”¨ä»£ç åˆ†æžï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªåŸºäºŽ JavaFx å¼€å‘çš„å›¾å½¢åŒ–å·¥å…· (Rexbb.jar)ã€‚å®ƒç®€åŒ–äº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1.  **å‘é€ Payloadï¼š**  è‡ªåŠ¨æž„é€ å’Œå‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæ¼æ´žã€‚
2.  **RCE æ£€æµ‹ï¼š**  åœ¨æˆåŠŸå†™å…¥ Webshell åŽï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æžœå›žæ˜¾ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  å…è®¸ç”¨æˆ·è¾“å…¥è‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚

è¯¥å·¥å…·é€šè¿‡å›¾å½¢ç•Œé¢å°è£…äº†æ¼æ´žåˆ©ç”¨çš„ç»†èŠ‚ï¼Œé™ä½Žäº†åˆ©ç”¨é—¨æ§›ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCå·¥å…·æœ¬èº«å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚è™½ç„¶ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨Spring4Shellæ¼æ´žï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­åŠ å…¥æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚ï¼š

*   **åŽé—¨æ¤å…¥ï¼š**  åœ¨ Webshell ä¸­æ·»åŠ é¢å¤–çš„åŽé—¨ï¼Œæ–¹ä¾¿æ”»å‡»è€…é•¿æœŸæŽ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚
*   **ä¿¡æ¯çªƒå–ï¼š**  åœ¨å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å‘é€åˆ°æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ã€‚
*   **æ¶æ„ä¼ æ’­ï¼š**  åˆ©ç”¨æ¼æ´žæ„ŸæŸ“å…¶ä»–ç³»ç»Ÿã€‚

ç”±äºŽæ— æ³•ç›´æŽ¥å®¡æŸ¥ Rexbb.jar çš„æºä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„ä¿¡ä»»é£Žé™©ã€‚å»ºè®®åœ¨ä½¿ç”¨æ­¤ç±»å·¥å…·æ—¶ï¼Œä¿æŒè­¦æƒ•ï¼Œåœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶è¿›è¡Œä»£ç å®¡è®¡ï¼Œä»¥ç¡®ä¿å·¥å…·çš„å®‰å…¨æ€§ã€‚

**æŠ•æ¯’å¯èƒ½æ€§è¯„ä¼°ï¼š**

è™½ç„¶ä¸èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ï¼Œä½†æ ¹æ®ä»£ç çš„æ€§è´¨ï¼Œä½œè€…å…·å¤‡æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç›¸å¯¹æ¥è¯´ï¼Œä½œè€…è¯¦ç»†è¯´æ˜Žäº†POCä½¿ç”¨æ–¹å¼ä»¥åŠåŽŸç†ï¼Œé™ä½Žäº†æŠ•æ¯’å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [zangcc/CVE-2022-22965-rexbb](https://github.com/zangcc/CVE-2022-22965-rexbb)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---



---

## POC #7

**æ¥æº**: [CVE-2022-22965-Nosie12_fire-wall-server.md](../2022/CVE-2022-22965-Nosie12_fire-wall-server.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªé«˜å±çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”éœ€è¦éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…çš„å½¢å¼éƒ¨ç½²ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œå…è®¸æ”»å‡»è€…ä¼ å…¥æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œä»Žè€Œå†™å…¥ webshell æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨ç¡®å®žå­˜åœ¨å¹¶ä¸”è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ã€‚æä¾›çš„Pythonä»£ç å®žé™…ä¸Šæ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢åˆ©ç”¨ Spring4Shell æ¼æ´žçš„æ¶æ„è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ä¸­æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¶æ„æ¨¡å¼æ¥å·¥ä½œã€‚å› æ­¤ï¼Œæä¾›çš„ Python ä»£ç å¹¶ä¸èƒ½ç›´æŽ¥éªŒè¯æ¼æ´žçš„æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºé˜²å¾¡æŽªæ–½ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
å¯¹æä¾›çš„ Python ä»£ç  `firewall_server.py` è¿›è¡Œäº†åˆ†æžï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹å’Œé˜»æ­¢åŒ…å«ç‰¹å®šæ¶æ„æ¨¡å¼çš„HTTPè¯·æ±‚ã€‚è„šæœ¬ä¸­å®šä¹‰äº† `BLOCKED_PATTERNS` åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†è¯¸å¦‚ `/tomcatwar.jsp`ï¼Œ`class.module.classLoader.resources.context.parent.pipeline` å’Œä¸€äº›ç¼–ç åŽçš„å­—ç¬¦ä¸²ç­‰æ¨¡å¼ã€‚è„šæœ¬ä¼šæ£€æŸ¥ä¼ å…¥çš„è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ï¼Œå¦‚æžœå‘çŽ°ä»»ä½•åŒ¹é…çš„æ¨¡å¼ï¼Œå®ƒå°†è¿”å›žä¸€ä¸ª `403 Forbidden` å“åº”ã€‚å› æ­¤ï¼Œä»Žä»£ç çš„åŠŸèƒ½å’Œå†…å®¹æ¥çœ‹ï¼Œè¯¥è„šæœ¬æœ¬èº«ä¸åŒ…å«ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å¯ä»¥è®¤ä¸ºæŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼ŒSpring4Shell çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„æž„é€ çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚çš„ç›®æ ‡æ˜¯ Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
2.  æ¶æ„è¯·æ±‚ä¸­çš„å‚æ•°ä¼šåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œå°è¯•ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ã€‚
3.  é€šè¿‡ä¿®æ”¹ AccessLogValve çš„å±žæ€§ï¼Œæ”»å‡»è€…å¯ä»¥æŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„ä½ç½®å’Œæ ¼å¼ï¼Œä»Žè€Œå†™å…¥ä»»æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª webshellï¼‰ã€‚
4.  ä¸€æ—¦ webshell è¢«å†™å…¥ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡å®ƒæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [Nosie12/fire-wall-server](https://github.com/Nosie12/fire-wall-server)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #8

**æ¥æº**: [CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md](../2022/CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md)

## CVE-2022-22965-Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä½¿ç”¨Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢ç»“æžœå’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æä¾›äº†ä¸€ä¸ªå¯ docker åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå®¹æ˜“å—åˆ° Spring4Shell æ¼æ´ž (CVE-2022-22965) çš„æ”»å‡»ã€‚Dockerfile ä½¿ç”¨äº†ç‰¹å®šç‰ˆæœ¬çš„ Tomcat é•œåƒ (lunasec/tomcat-9.0.59-jdk11)ï¼Œè¯¥ç‰ˆæœ¬åœ¨æ¼æ´žä¿®å¤ä¹‹å‰ã€‚pom.xml æ–‡ä»¶é…ç½®äº† Spring Boot ç‰ˆæœ¬ 2.6.3ï¼Œè¯¥ç‰ˆæœ¬å¯èƒ½å—æ¼æ´žå½±å“ï¼ˆå…·ä½“å–å†³äºŽ Spring Framework çš„ç‰ˆæœ¬ï¼‰ã€‚æž„å»ºè¿‡ç¨‹åŒ…æ‹¬ä½¿ç”¨ Maven æ‰“åŒ…åº”ç”¨ç¨‹åºä¸º WAR æ–‡ä»¶ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ° Tomcat çš„ webapps ç›®å½•ã€‚æè¿°æ–‡ä»¶ä¹Ÿæè¿°è¿™æ˜¯ä¸€ä¸ªPOCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»“åº“çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤º CVE-2022-22965 æ¼æ´žã€‚ç„¶è€Œï¼Œå§‹ç»ˆå­˜åœ¨ä»£ç ä¸­åŒ…å«æ¶æ„æˆ–åŽé—¨ä»£ç çš„é£Žé™©ï¼Œå³ä½¿ä½œè€…çš„æ„å›¾æ˜¯è‰¯æ€§çš„ã€‚ä»£ç ä¸­æ£€æµ‹åˆ°æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žã€‚é£Žé™©ä¼°è®¡ä¸º 10%ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š

*   Dockerfileï¼šå®ƒä¸‹è½½äº†ä¸€ä¸ªæŒ‡å®šçš„tomcatç‰ˆæœ¬ï¼Œå¦‚æžœè¯¥dockerå­˜åœ¨åŽé—¨ï¼Œåˆ™å­˜åœ¨é£Žé™©
*   `README.md` æŽ¨èäº†LunaSecçš„åˆ†æ”¯ï¼Œå¯ä»¥æŽ¨æ–­æ˜¯å®˜æ–¹çš„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ¶‰åŠæ“çºµç±»åŠ è½½å™¨å’Œ servlet ä¸Šä¸‹æ–‡ä»¥å†™å…¥æ¶æ„ JSP æ–‡ä»¶åˆ° Tomcat çš„ webapp ç›®å½•ä¸­ï¼Œç„¶åŽæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹å®šæž„é€ çš„ HTTP è¯·æ±‚æ¥è§¦å‘è¯¥ JSP æ–‡ä»¶ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¯¥ POC ä»£ç ä¼¼ä¹Žæœ‰æ•ˆï¼Œä½†ä½¿ç”¨å’Œéƒ¨ç½² POC éœ€è¦è°¨æ…Žï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚å§‹ç»ˆå»ºè®®åœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ZapcoMan/spring4shell-vulnerable-application](https://github.com/ZapcoMan/spring4shell-vulnerable-application)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #9

**æ¥æº**: [CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md](../2022/CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), å­˜åœ¨RequestMappingå’ŒPOJOå‚æ•°

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨å¯èƒ½å—åˆ°å½±å“ã€‚è¯¥æ¼æ´žåˆ©ç”¨éœ€è¦åº”ç”¨éƒ¨ç½²ä¸ºTomcat WARåŒ…ã€‚å¦‚æžœéƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨æ•°æ®ç»‘å®šï¼Œå°†æ¶æ„å±žæ€§å†™å…¥åˆ°`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å±žæ€§ä¸­ï¼Œæœ€ç»ˆå†™å…¥æ¶æ„webshellã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellã€‚webshellçš„è·¯å¾„å’Œæ–‡ä»¶åå¯ä»¥é€šè¿‡è¯·æ±‚å‚æ•°æŒ‡å®šã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œæ—¨åœ¨é˜»æ­¢åˆ©ç”¨CVE-2022-22965çš„æ¶æ„è¯·æ±‚ã€‚å®ƒé€šè¿‡æ£€æŸ¥è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´æ¥è¯†åˆ«æ¶æ„æµé‡ï¼Œå¹¶è¿”å›ž403 Forbiddené”™è¯¯ã€‚æ­¤ä»£ç æœ¬èº«**ä¸åŒ…å«ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨**ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®ƒä¸»è¦é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¶æ„è¯·æ±‚ï¼Œå¦‚è¯·æ±‚è·¯å¾„åŒ…å«`/tomcatwar.jsp`æˆ–è€…HTTPå¤´éƒ¨åŒ…å«`suffix=%>//`ç­‰ç‰¹å¾ã€‚è¿™ä¸ªè„šæœ¬çš„ç›®çš„æ˜¯é˜²å¾¡Spring4Shellæ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨å®ƒã€‚

**é¡¹ç›®åœ°å€:** [bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-](https://github.com/bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #10

**æ¥æº**: [CVE-2022-22965-brunoh6_web-threat-mitigation.md](../2022/CVE-2022-22965-brunoh6_web-threat-mitigation.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², å¹¶ä¸”åº”ç”¨ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„ WebShell åˆ°æœåŠ¡å™¨ï¼Œæœ€ç»ˆå®žçŽ° RCEã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹ï¼ˆJDK 9+, Tomcat WARéƒ¨ç½²ï¼‰å¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç ï¼ˆ`web-threat-mitigation`ä»“åº“ï¼‰ä¹Ÿè¯å®žäº†è¿™ä¸€ç‚¹ï¼Œè¯¥ä»“åº“æä¾›äº†ä¸€ä¸ªä½¿ç”¨Metasploitè¿›è¡Œæ¼æ´žåˆ©ç”¨çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨æœ‰WAFå’Œæ— WAFçš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨çš„æˆåŠŸä¸Žå¤±è´¥ã€‚å› æ­¤ï¼Œå¯ä»¥åˆ¤æ–­POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©:**
åˆ†æžæä¾›çš„ä»£ç ä»“åº“ï¼Œä¸»è¦æ˜¯æ¼”ç¤ºå¦‚ä½•æ£€æµ‹å’Œç¼“è§£webåº”ç”¨ç¨‹åºå¨èƒï¼Œé€šè¿‡ OWASP ZAP, Burp Suite, å’Œ ModSecurity WAFã€‚å®ƒè¿˜åŒ…æ‹¬äº†CVE-2022-22965 (Spring4Shell)çš„æ¼æ´žåˆ©ç”¨ã€‚ä»£ç ä»“åº“ä¸­æ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åŽé—¨, ä½†æ˜¯è€ƒè™‘åˆ°ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹å’Œä¼ æ’­è¿™äº›ä»£ç ï¼Œä»¥åŠå®žé™…çŽ¯å¢ƒä¸­å¯èƒ½å­˜åœ¨çš„å¤æ‚æ€§ï¼Œä»ç„¶ä¸èƒ½å®Œå…¨æŽ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚ é£Žé™©ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **ç¡®å®šç›®æ ‡çŽ¯å¢ƒ:**  æ£€æŸ¥ç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ (Spring MVC/WebFlux, JDK 9+, Tomcat WARéƒ¨ç½²)ã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹Tomcatçš„`AccessLogValve`ç»„ä»¶å±žæ€§ã€‚
3.  **å†™å…¥WebShell:** é€šè¿‡ä¿®æ”¹`directory`ã€`prefix`ã€`suffix`å’Œ`pattern`å±žæ€§ï¼Œå°†WebShellå†™å…¥åˆ°æœåŠ¡å™¨ä¸Šçš„å¯è®¿é—®ç›®å½•ã€‚
4.  **æ‰§è¡Œå‘½ä»¤:**  é€šè¿‡è®¿é—®å†™å…¥çš„WebShellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é˜²å¾¡å»ºè®®:**
*   å‡çº§Spring Frameworkåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ (5.3.18+, 5.2.20+)ã€‚
*   ä½¿ç”¨WAF (å¦‚ModSecurity) å¹¶é…ç½®OWASP CRSæ¥æ£€æµ‹å’Œé˜»æ­¢æ¶æ„è¯·æ±‚ã€‚
*   é™åˆ¶æ•°æ®ç»‘å®šçš„ä½¿ç”¨ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥ç›´æŽ¥ç»‘å®šåˆ°æ•æ„Ÿå¯¹è±¡å±žæ€§ã€‚

**é¡¹ç›®åœ°å€:** [brunoh6/web-threat-mitigation](https://github.com/brunoh6/web-threat-mitigation)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #11

**æ¥æº**: [CVE-2022-22965-c33dd_CVE-2022-22965.md](../2022/CVE-2022-22965-c33dd_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ç§è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ Spring Framework ä¸­ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æ­¤æ¼æ´žï¼Œå‘æŸäº›å‚æ•°ä¼ é€’ç‰¹åˆ¶çš„æ¶æ„è¯·æ±‚ï¼Œä»Žè€ŒèŽ·å¾—å¯¹æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºéœ€è¦è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚ä½¿ç”¨ Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æ¼æ´žè§¦å‘ï¼š** æ¼æ´žåˆ©ç”¨æ¶‰åŠæ“çºµç±»åŠ è½½å™¨ç»•è¿‡å®‰å…¨æœºåˆ¶ã€‚é€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œå¯ä»¥å†™å…¥æ¶æ„ Web shellã€‚
3.  **å…·ä½“æ­¥éª¤ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ã€‚è¿™äº›å‚æ•°è¢« Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶å¤„ç†ï¼Œå¯¼è‡´ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§è¢«ä¿®æ”¹ï¼Œä»Žè€Œå†™å…¥ Web shell åˆ°æœåŠ¡å™¨çš„å¯è®¿é—®ä½ç½®ã€‚
4.  **ä»£ç åˆ†æžï¼š** æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªCç¨‹åºï¼Œè¯¥ç¨‹åºå°è¯•é€šè¿‡HTTPè¯·æ±‚ä¸Žç›®æ ‡æœåŠ¡å™¨é€šä¿¡ï¼Œå¹¶æ£€æŸ¥å“åº”çŠ¶æ€ç ä»¥ç¡®å®šæ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å…³é”®éƒ¨åˆ†åœ¨äºŽæž„é€ ç‰¹å®šçš„HTTPå¤´ï¼Œä¾‹å¦‚`suffix`å’Œ`c1`ï¼Œä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žã€‚ä»£ç ä¸­æ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„Cä»£ç ç‰‡æ®µçœ‹èµ·æ¥åƒæ˜¯æ¼æ´žåˆ©ç”¨çš„å‰æœŸæ£€æŸ¥å·¥å…·ï¼Œç”¨äºŽéªŒè¯ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®šheaderçš„HTTPè¯·æ±‚å¹¶æ£€æŸ¥å“åº”æ¥å°è¯•åˆ©ç”¨è¯¥æ¼æ´žã€‚å¦‚æžœæœåŠ¡å™¨è¿”å›ž 2XX çŠ¶æ€ç ï¼Œåˆ™è®¤ä¸ºæ¼æ´žå­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ä»”ç»†å®¡æŸ¥æä¾›çš„Cä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„ã€æ¶æ„çš„æˆ–éšè—çš„åŽé—¨ä»£ç ã€‚ä»£ç çš„åŠŸèƒ½ä¸»è¦æ˜¯å‘é€HTTPè¯·æ±‚ï¼Œè¯»å–å“åº”ï¼Œå¹¶æ ¹æ®å“åº”ç åˆ¤æ–­æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚ å› æ­¤ï¼Œè¯„ä¼°çš„æŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [c33dd/CVE-2022-22965](https://github.com/c33dd/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #12

**æ¥æº**: [CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md](../2022/CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼Œæ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

ä»Žæä¾›çš„æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´žåº“ä¿¡æ¯æ˜Žç¡®æŒ‡å‡ºå­˜åœ¨RCEçš„å¯èƒ½ï¼Œå¹¶æåŠäº†åˆ©ç”¨æ¡ä»¶ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­åŒ…å«å¤§é‡å…³äºŽè¯¥æ¼æ´žçš„åˆ†æžå’Œåˆ©ç”¨æ–‡ç« ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«å¹¿æ³›ç ”ç©¶å’Œåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å®žçŽ°äº†åˆ©ç”¨è¯¥æ¼æ´žä¸Šä¼ webshellçš„åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹classloaderç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚æ‰§è¡ŒçŠ¶æ€åˆ¤æ–­è¡¨æ˜Žï¼ŒPOC è‡³å°‘èƒ½å¤Ÿå®Œæˆwebshellçš„ä¸Šä¼ è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»”ç»†åˆ†æžæä¾›çš„ exploit1.py å’Œ exploit2.py è„šæœ¬ï¼Œä»¥åŠ README.md æ–‡ä»¶ï¼Œä¸»è¦é£Žé™©ç‚¹åœ¨äºŽï¼š

*   **ç¡¬ç¼–ç å¯†ç ï¼š** exploit1.py ä¸­å­˜åœ¨é»˜è®¤å¯†ç  `thm`ï¼Œå¦‚æžœæ”»å‡»è€…æ²¡æœ‰ä¿®æ”¹å¯†ç å°±ç›´æŽ¥ä½¿ç”¨ï¼Œå­˜åœ¨è¢«å…¶ä»–æ¶æ„ç”¨æˆ·åˆ©ç”¨çš„é£Žé™©ã€‚è™½ç„¶è¿™ä¸ç®—æ˜¯ä»£ç å±‚é¢çš„æŠ•æ¯’ï¼Œä½†å±žäºŽé…ç½®ä¸å½“å¯èƒ½å¯¼è‡´çš„é£Žé™©ã€‚
*   **æ–‡ä»¶åå’Œç›®å½•ï¼š** é»˜è®¤çš„æ–‡ä»¶å `tomcatwar.jsp` å’Œç›®å½• `ROOT` å¯èƒ½ä¼šè¢«ç›‘æŽ§ç³»ç»Ÿæ£€æµ‹åˆ°ï¼Œä½†è¿™æ›´å¤šæ˜¯æ–¹ä¾¿åˆ©ç”¨ï¼Œè€Œéžéšè—çš„æ¶æ„è¡Œä¸ºã€‚
*   **ä¾èµ–é¡¹é£Žé™©ï¼š** README.md ä¸­æåˆ°äº† Maven ç¼–è¯‘å’Œ Tomcat ä¾èµ–ï¼Œå¦‚æžœä½¿ç”¨çš„ Maven ä»“åº“æˆ– Tomcat é•œåƒè¢«æ¶æ„ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚è¿™å±žäºŽä¾›åº”é“¾é£Žé™©ï¼Œè€Œéžä»£ç æœ¬èº«æŠ•æ¯’ã€‚
*    **ä»£ç†æœåŠ¡å™¨é£Žé™©**: åœ¨ exploit1.py è„šæœ¬ä¸­ï¼Œæ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¿žæŽ¥ï¼Œè™½ç„¶æ˜¯æ–¹ä¾¿è¿›è¡ŒHTTPæ¶ˆæ¯æ‹¦æˆªï¼Œä½†ä¹Ÿå­˜åœ¨ä»£ç†æœåŠ¡å™¨æ”¶é›†è¯·æ±‚ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚è¿™ä¸å±žäºŽæ˜¯POCæŠ•æ¯’èŒƒç•´ï¼Œæ˜¯å±žäºŽä½¿ç”¨è€…ä¿¡æ¯å®‰å…¨èŒƒç•´ã€‚
*   **å…è´£å£°æ˜Žå’Œå­¦ä¹ ç›®çš„ï¼š** README.md ä¸­å£°æ˜Ž PoC ä»…ç”¨äºŽå­¦ä¹ ç›®çš„ï¼Œä½†æ— æ³•ä¿è¯ä½¿ç”¨è€…ä¸ä¼šå°†å…¶ç”¨äºŽéžæ³•ç”¨é€”ã€‚

ç»¼åˆæ¥çœ‹ï¼Œä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†å­˜åœ¨ä¸€äº›é…ç½®é£Žé™©å’Œä¾èµ–é¡¹é£Žé™©ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º **10%**ã€‚è¿™ä¸ªç™¾åˆ†æ¯”ä¸»è¦è€ƒè™‘ä½¿ç”¨è€…åœ¨ä½¿ç”¨é»˜è®¤é…ç½®å¯èƒ½å¸¦æ¥çš„é£Žé™©ä»¥åŠå¼•å…¥æ¶æ„ä¾èµ–çš„æ½œåœ¨å¯èƒ½ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…å½¢å¼éƒ¨ç½²ã€‚åº”ç”¨ä½¿ç”¨äº† Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP POST è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ `AccessLogValve` ç»„ä»¶çš„å±žæ€§ã€‚
3.  **ä¿®æ”¹æ—¥å¿—é…ç½®ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ `pattern` å±žæ€§ï¼Œå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚`directory`ã€`prefix`ã€`suffix` å’Œ `fileDateFormat` å±žæ€§ç”¨äºŽæŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ï¼Œç¡®ä¿ JSP ä»£ç èƒ½å¤Ÿå†™å…¥åˆ° webapps ç›®å½•ä¸‹ï¼Œå¹¶ä»¥ JSP æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚
4.  **ä¸Šä¼  Webshellï¼š**  æˆåŠŸä¿®æ”¹æ—¥å¿—é…ç½®åŽï¼ŒTomcat ä¼šå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ webapps ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª Webshellã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š**  æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell çš„ URLï¼Œæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [cxzero/CVE-2022-22965-spring4shell](https://github.com/cxzero/CVE-2022-22965-spring4shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #13

**æ¥æº**: [CVE-2022-22965-dbgee_Spring4Shell.md](../2022/CVE-2022-22965-dbgee_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œä¹Ÿè¢«ç§°ä¸º Spring4Shellï¼Œæ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥ä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„ Web shellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œç¡®è®¤è¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨ä»£ç ã€‚æ¼æ´žçš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ï¼šè¿è¡Œåœ¨ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šï¼Œå¹¶ä½¿ç”¨ Spring MVC æˆ– Spring WebFluxã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/654a99bf9ba51c6c41107b986ba46894/mvnw` çœ‹èµ·æ¥æ˜¯ Maven Wrapper è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åœ¨æ²¡æœ‰å®‰è£… Maven çš„çŽ¯å¢ƒä¸‹ä¹Ÿèƒ½æž„å»º Maven é¡¹ç›®ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨ä»£ç ã€‚æŠ•æ¯’çš„é£Žé™©åœ¨äºŽï¼š

*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ Maven é¡¹ç›®çš„ `pom.xml` æ–‡ä»¶ï¼Œæ·»åŠ æ¶æ„çš„ä¾èµ–é¡¹ã€‚å½“ Maven Wrapper æž„å»ºé¡¹ç›®æ—¶ï¼Œä¼šä¸‹è½½å¹¶æ‰§è¡Œè¿™äº›æ¶æ„ä¾èµ–é¡¹ä¸­çš„ä»£ç ï¼Œä»Žè€Œå®žçŽ°æŠ•æ¯’ã€‚è™½ç„¶ä»£ç ç‰‡æ®µæœ¬èº«æ²¡æœ‰æ¶æ„ï¼Œä½† Maven æž„å»ºè¿‡ç¨‹çš„æ€§è´¨å†³å®šäº†å­˜åœ¨è¿™ç§é£Žé™©ã€‚
*   **é…ç½®æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ Maven çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æž„å»ºè¿‡ç¨‹ï¼Œæ’å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ° Maven Wrapper çš„åŠŸèƒ½ä»¥åŠæ½œåœ¨çš„æž„å»ºè¿‡ç¨‹ç¯¡æ”¹ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåˆ©ç”¨æ–¹å¼ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1.  **ç¡®å®šç›®æ ‡ï¼š** æ‰¾åˆ°æ»¡è¶³æ¼æ´žåˆ©ç”¨æ¡ä»¶çš„ Spring åº”ç”¨ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ä¼šä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥ Web Shellï¼š** é€šè¿‡ä¿®æ”¹è®¿é—®æ—¥å¿—é…ç½®ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ Web shellï¼‰å†™å…¥åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ã€‚
4.  **æ‰§è¡Œå‘½ä»¤ï¼š** é€šè¿‡è®¿é—®å†™å…¥çš„ Web shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œå¦‚æžœç›®æ ‡åº”ç”¨ç¨‹åºæ»¡è¶³åˆ©ç”¨æ¡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ©ç”¨è¯¥æ¼æ´žæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [dbgee/Spring4Shell](https://github.com/dbgee/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #14

**æ¥æº**: [CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md](../2022/CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md)

## CVE-2022-22965 Spring4Shell è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.0 to 5.3.17, 5.2.0 to 5.2.19 and older versions

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ“çºµClassLoaderï¼Œä»Žè€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žå·²è¢«å…¬å¼€åˆ©ç”¨ï¼Œå¹¶æœ‰å¯ç”¨çš„POCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æŸ¥çœ‹æä¾›çš„exploit.pyä»£ç ï¼Œä»£ç ç»“æž„éžå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æžå™¨ï¼Œä½†runå’Œcheckå‡½æ•°å‡æœªå®žçŽ°ï¼Œæ˜¯æœªå®Œæˆçš„POCã€‚ç›´æŽ¥åˆ†æžæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ç”±äºŽä»£ç ä¸å®Œæ•´ï¼Œæœªæ¥å­˜åœ¨è¢«ä¿®æ”¹å¹¶æ·»åŠ æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»“åº“æœ¬èº«æ˜¯PoCæ€§è´¨ï¼Œä»¥åŠä»£ç çš„æœªå®ŒæˆçŠ¶æ€ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚è¯¥ä»“åº“è¿˜å¼•ç”¨äº†å…¶ä»–ä»“åº“ï¼Œéœ€è¦æ³¨æ„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** åº”ç”¨ç¨‹åºå¿…é¡»è¿è¡Œåœ¨JDK 9+ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºä¼ ç»Ÿçš„WARåŒ…åœ¨TomcatæœåŠ¡å™¨ä¸­ã€‚
2.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpring Frameworkçš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚å½“ä½¿ç”¨`RequestMapping`æ³¨è§£å’ŒPOJOå‚æ•°æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹`class.module.classLoader`ç­‰å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—ç›®å½•ï¼Œå†™å…¥webshellæˆ–å…¶ä»–æ¶æ„ä»£ç ã€‚
3.  **æ”»å‡»æ­¥éª¤ï¼ˆåŸºäºŽå·²çŸ¥åˆ©ç”¨æ–¹å¼ï¼‰ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`å±žæ€§ï¼Œå°†Tomcatçš„access logé…ç½®ä¸ºwebshellã€‚
    *   è®¿é—®webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [gokul-ramesh/Spring4Shell-PoC-exploit](https://github.com/gokul-ramesh/Spring4Shell-PoC-exploit)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #15

**æ¥æº**: [CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md](../2022/CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcatä½œä¸ºWARéƒ¨ç½²ï¼Œä½¿ç”¨Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªåœ¨ Spring Framework ä¸­å‘çŽ°çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šï¼Œæ“çºµæŸäº›å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä½¿ç”¨JDK 9+å¹¶ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šçš„Springåº”ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ©ç”¨æ¡ä»¶:**  éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
    *   éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚
    *   ä½¿ç”¨å—å½±å“çš„ Spring Framework ç‰ˆæœ¬ (5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+)ã€‚
2.  **æ¼æ´žåŽŸç†:** é€šè¿‡æ“çºµ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellåˆ°å¯è®¿é—®çš„ç›®å½•ã€‚
3.  **åˆ©ç”¨æ­¥éª¤:**
    *   å‘é€æ¶æ„æž„é€ çš„HTTPè¯·æ±‚ï¼ŒåŒ…å«ç²¾å¿ƒè®¾è®¡çš„å‚æ•°ï¼Œä»¥ä¿®æ”¹Tomcatçš„æ—¥å¿—è®¾ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°Webå¯è®¿é—®çš„ç›®å½•ã€‚
    *   æ—¥å¿—å†…å®¹åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚JSP webshellã€‚
    *   é€šè¿‡è®¿é—®webshellçš„URLï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç  (`spring4shell.py`) æ—¨åœ¨è‡ªåŠ¨åŒ–ä¸Šè¿°è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

æä¾›çš„Pythonè„šæœ¬`spring4shell.py`ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨CVE-2022-22965æ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®å†™å…¥webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è™½ç„¶è¯¥è„šæœ¬æœ¬èº«æ˜¯ä¸ºäº†æ”»å‡»åˆ©ç”¨è€Œç¼–å†™çš„ï¼Œä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨è€…ç›´æŽ¥ä¸‹è½½å¹¶ä½¿ç”¨æœªç»ä»”ç»†å®¡æŸ¥çš„ä»£ç æ—¶ã€‚

å…·ä½“åˆ†æžå¦‚ä¸‹ï¼š

*   **é£Žé™©ç‚¹1ï¼š**  è„šæœ¬ä¸­å¯èƒ½ä¼šåŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åŽé—¨ã€æ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å¤–ä¼ ç­‰ã€‚è™½ç„¶ç›®å‰çš„ä»£ç ç‰‡æ®µçœ‹èµ·æ¥ç›¸å¯¹ç›´æŽ¥ï¼Œä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ é¢å¤–çš„æ¶æ„åŠŸèƒ½ã€‚
*   **é£Žé™©ç‚¹2ï¼š**  è¯¥è„šæœ¬ä¾èµ–äºŽç¬¬ä¸‰æ–¹åº“ (`requests`, `bs4`)ï¼Œè¿™äº›åº“æœ¬èº«å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´žï¼Œæˆ–è€…è¢«æ”»å‡»è€…æ›¿æ¢ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚è™½ç„¶`pip3 install bs4` å’Œ `pip3 install requests`  æ˜¯å®‰è£…å¸¸ç”¨åº“ï¼Œä½†å¦‚æžœæºè¢«åŠ«æŒï¼Œå¯èƒ½ä¼šå®‰è£…æ¶æ„ç‰ˆæœ¬ã€‚
*   **é£Žé™©ç‚¹3ï¼š**  è„šæœ¬ä¸­çš„é»˜è®¤å‚æ•°ï¼Œä¾‹å¦‚webshellçš„æ–‡ä»¶åã€å¯†ç ã€ä¸Šä¼ ç›®å½•ç­‰ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚å¦‚æžœæ”»å‡»è€…èƒ½å¤Ÿé¢„æµ‹æˆ–æŽ§åˆ¶è¿™äº›å‚æ•°ï¼Œå°±å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡ŒåŽç»­æ”»å‡»ã€‚

ç”±äºŽå­˜åœ¨ä»¥ä¸Šæ½œåœ¨é£Žé™©ï¼Œåœ¨ä½¿ç”¨ä»»ä½•å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¹‹å‰ï¼Œéƒ½å¿…é¡»è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ï¼Œç¡®ä¿ä»£ç çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚æ­¤å¤–ï¼Œå»ºè®®ä¿®æ”¹é»˜è®¤å‚æ•°ï¼Œå¢žåŠ æ”»å‡»éš¾åº¦ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**
è€ƒè™‘åˆ°ä»£ç åŠŸèƒ½ç›¸å¯¹é›†ä¸­äºŽæ¼æ´žåˆ©ç”¨ï¼Œä¸”ä½œè€…ä¹Ÿç»™å‡ºäº†GitHubåœ°å€ï¼Œåˆæ­¥åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£Žé™©ä¸º10%ã€‚è¿™ä¸ªæ¦‚çŽ‡è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—æ¶æ„ä»£ç ï¼Œæˆ–è€…å°†æ¥ä»£ç ä»“åº“è¢«å…¥ä¾µåŽæ¤å…¥æ¶æ„ä»£ç çš„æƒ…å†µã€‚

**é¡¹ç›®åœ°å€:** [guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965](https://github.com/guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #16

**æ¥æº**: [CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md](../2022/CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions on JDK 9+ with Tomcat as WAR deployment.

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡åº”ç”¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„Spring Frameworkç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å—å½±å“çš„Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æŸäº›ç‰¹æ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå½±å“è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨ç¨‹åºå¿…é¡»ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨ä»£ç é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®žçŽ°RCEï¼š

1.  **é‡ç½®æ—¥å¿—å˜é‡:** é€šè¿‡ä¿®æ”¹`fileDateFormat`å‚æ•°æ¥åˆå§‹åŒ–ã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®:** æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºæ ¼å¼è®¾ç½®ä¸ºåŒ…å«å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„JSPä»£ç ã€‚
3.  **å†™å…¥ Webshell:**  é€šè¿‡headerå¤´ä¼ é€’åŒ…å«Runtimeçš„å‚æ•°å’Œå‘½ä»¤æ‰§è¡Œçš„é€»è¾‘ï¼Œé€šè¿‡ä¿®æ”¹è¿‡çš„æ—¥å¿—é…ç½®å†™å…¥webshellåˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ã€‚
4.  **å‘½ä»¤æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®å†™å…¥çš„webshellï¼Œä¼ é€’`cmd`å‚æ•°æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
5.  **æ¸…ç†æ—¥å¿—å˜é‡:** æ¸…ç†ä¹‹å‰ä¿®æ”¹çš„æ—¥å¿—å˜é‡ï¼Œé˜²æ­¢æ¶æ„å†™å…¥ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ©ç”¨äº†ä¸å®‰å…¨çš„é…ç½®ä¿®æ”¹æ¥å†™å…¥ Webshell.

**æŠ•æ¯’é£Žé™©è¯„ä¼°:** æ­¤ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦10%ã€‚Dockerfileä¸­ä½¿ç”¨lunasec/tomcat-9.0.59-jdk11ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™æœ¬èº«å…·å¤‡ä¸€å®šçš„å®‰å…¨æ€§ï¼Œmavenæž„å»ºæµç¨‹ç›¸å¯¹æ ‡å‡†ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç æ³¨å…¥è¡Œä¸ºï¼Œæœ€ä¸»è¦çš„é£Žé™©ç‚¹åœ¨äºŽ`vulnerable-app`ç›®å½•ä¸‹çš„æºä»£ç ï¼Œå¦‚æžœè¯¥ç›®å½•ä¸‹çš„æºä»£ç åŒ…å«æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“:** è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯å…ˆä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºé‡å®šå‘åˆ°Webç›®å½•ï¼Œå¹¶è®¾ç½®æ—¥å¿—å†…å®¹ä¸ºå¯æ‰§è¡Œçš„JSPä»£ç ã€‚ç„¶åŽï¼Œå‘é€åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œä½¿Tomcatå°†JSPä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œä»Žè€Œåœ¨Webç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªwebshellã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [jakabakos/CVE-2022-22965-Spring4Shell](https://github.com/jakabakos/CVE-2022-22965-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #17

**æ¥æº**: [CVE-2022-22965-jashan-lefty_Spring4Shell.md](../2022/CVE-2022-22965-jashan-lefty_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux application

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽSpring Frameworkä¸­ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œè¯¥æ¼æ´žåªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯è¢«åˆ©ç”¨ï¼Œå³ï¼š

*   è¿è¡Œåœ¨JDK 9+ä¹‹ä¸Šã€‚
*   ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šã€‚
*   ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFluxã€‚

**POCæœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„`test.py`è„šæœ¬å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚å®ƒé€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°Tomcatçš„webapps/ROOTç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°RCEã€‚è„šæœ¬å°è¯•è®¾ç½®`pattern`å±žæ€§ï¼ˆç”¨äºŽå®šä¹‰JSPæ–‡ä»¶çš„å†…å®¹ï¼ŒåŒ…å«åŽé—¨ä»£ç ï¼‰ï¼Œ`suffix`å±žæ€§ï¼ˆè®¾ç½®ä¸º.jspï¼‰ï¼Œ`directory`å±žæ€§ï¼ˆè®¾ç½®ä¸ºwebapps/ROOTï¼‰ï¼Œ`prefix`å±žæ€§ï¼ˆè®¾ç½®ä¸ºtomcatwarï¼‰ï¼Œä»¥åŠ`fileDateFormat`å±žæ€§ã€‚

æ ¹æ®æœç´¢å¼•æ“Žç»“æžœï¼Œæ­¤æ¼æ´žåœ¨é‡Žå¤–å·²è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚`test.py`è„šæœ¬ä¸­çš„payloadç»“æž„ä¸Žå…¬å¼€çš„Spring4Shellåˆ©ç”¨æ–¹å¼ç›¸ç¬¦ï¼Œæ‰€ä»¥è¯¥POCä»£ç æœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

è¯¥ä»“åº“åŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š`README.md`ï¼Œ`fw_handler.py` å’Œ `test.py`ã€‚

*   `README.md` æè¿°äº†å¯¹æ¼æ´žçš„åˆ†æžå’Œé˜²å¾¡æŽªæ–½ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `fw_handler.py` å®žçŽ°äº†ç®€å•çš„é˜²ç«å¢™ï¼Œç”¨äºŽé˜»æ­¢åŒ…å«ç‰¹å®špayloadçš„è¯·æ±‚ï¼Œç”¨äºŽé˜²å¾¡æ”»å‡»ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `test.py` åŒ…å«æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œæ—¨åœ¨éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®špayloadçš„POSTè¯·æ±‚ï¼Œå°è¯•åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥æ¶æ„çš„JSPæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªåŽé—¨ï¼Œå…è®¸é€šè¿‡`pwd`å’Œ`cmd`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ­¤éƒ¨åˆ†**å¹¶éž**æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯æ¼æ´žéªŒè¯å’Œåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

è™½ç„¶æ•´ä¸ªä»“åº“çš„ä¸»é¢˜æ˜¯å…³äºŽæ¼æ´žåˆ†æžå’Œé˜²å¾¡ï¼Œä½† `test.py` ä¸­çš„åˆ©ç”¨ä»£ç å¦‚æžœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£Žé™©ã€‚ä½†å°±ä»“åº“æœ¬èº«è€Œè¨€ï¼Œä½œè€…ç›´æŽ¥æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œ`fw_handler.py`åè€Œæ˜¯é˜²å¾¡æ‰‹æ®µ, æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ˜¯åˆ©ç”¨æ¼æ´žçš„æ‰‹æ®µï¼Œä¸åº”è¢«è§†ä¸ºæŠ•æ¯’ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º10%ã€‚è¿™ä¸ª10%ä¸»è¦è€ƒè™‘çš„æ˜¯ä»“åº“çš„ç»´æŠ¤è€…å¯èƒ½è¢«é»‘å®¢å…¥ä¾µï¼Œç„¶åŽæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ç”¨äºŽä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§çš„payloadã€‚
2.  è¿™äº›å±žæ€§çš„ä¿®æ”¹å…è®¸æ”»å‡»è€…åœ¨Tomcatçš„webapps/ROOTç›®å½•ä¸‹å†™å…¥ä»»æ„JSPæ–‡ä»¶ã€‚
3.  å†™å…¥çš„JSPæ–‡ä»¶åŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ä¸€ä¸ªWebshellï¼‰ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [jashan-lefty/Spring4Shell](https://github.com/jashan-lefty/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #18

**æ¥æº**: [CVE-2022-22965-likewhite_CVE-2022-22965.md](../2022/CVE-2022-22965-likewhite_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´žå­˜åœ¨äºŽè¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶ä¸”éœ€è¦ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡ŒjaråŒ…ï¼Œåˆ™ä¸æ˜“å—æ­¤æ¼æ´žå½±å“ã€‚æœç´¢ç»“æžœè¯å®žäº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æŒ‡å‡ºè¯¥æ¼æ´žæ˜“äºŽåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å°è¯•åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve çš„å±žæ€§æ¥å†™å…¥ webshellã€‚è¯¥åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡ç³»ç»Ÿæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ Spring ç‰ˆæœ¬ã€JDK ç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼å’Œ Tomcat é…ç½®ç­‰ã€‚è™½ç„¶`teamserver`å’Œ`readme.md`æ–‡ä»¶çœ‹èµ·æ¥ä¸ç›¸å…³ï¼Œä½†`CVE-2022-22965.py`æ–‡ä»¶æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚`teamserver`æ–‡ä»¶æ˜¯Cobalt Strikeçš„å¯åŠ¨è„šæœ¬ï¼Œä¸Žæ¼æ´žåˆ©ç”¨æ— å…³ã€‚`readme.md`åªæ˜¯æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ¡ä»¶ï¼Œå¹¶æ²¡æœ‰åŒ…å«æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ç½‘ç»œèµ„æºå¯èƒ½è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä¾ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’å¯èƒ½ï¼ˆ5%ï¼‰ï¼Œä½†ç›®å‰æ— æ³•ç›´æŽ¥ä»Žä»£ç ä¸­å¾—å‡ºç»“è®ºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹AccessLogValveï¼š**  åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼ŒåŠ¨æ€ä¿®æ”¹Tomcatçš„AccessLogValveç»„ä»¶çš„å±žæ€§ï¼Œä¾‹å¦‚`directory`ï¼Œ`prefix`ï¼Œ`suffix`å’Œ`pattern`ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹`pattern`å±žæ€§ï¼Œå°†ä¸€æ®µåŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼‰çš„JSPä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ç›®å½•å’Œæ–‡ä»¶åçš„Webshellä¸­ã€‚
4.  **æ‰§è¡ŒWebshellï¼š**  æ”»å‡»è€…è®¿é—®å†™å…¥çš„Webshellï¼Œå¹¶ä¼ é€’å‘½ä»¤å‚æ•°ï¼Œä»Žè€Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [likewhite/CVE-2022-22965](https://github.com/likewhite/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #19

**æ¥æº**: [CVE-2022-22965-osungjinwoo_CVE-2022-22965.md](../2022/CVE-2022-22965-osungjinwoo_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„å’Œä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´žæ˜¯ Spring4Shellï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ï¼Œå†™å…¥æ¶æ„ webshell æ–‡ä»¶åˆ° webapps ç›®å½•ä¸‹ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼ŒåŒ…æ‹¬ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…çš„ Tomcatï¼Œä»¥åŠä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚æä¾›çš„ Python å’Œ Bash è„šæœ¬å‡æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´žã€‚å­˜åœ¨è½»å¾®æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨è„šæœ¬å¯èƒ½åŒ…å«ä¸‹è½½å…¶ä»–æ¶æ„æ–‡ä»¶çš„ä»£ç æˆ–è€…ä¿®æ”¹æœåŠ¡å™¨é…ç½®ç­‰ï¼Œä½†ä¸»è¦åŠŸèƒ½æ˜¯å®žçŽ°RCEï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æœ‰æ•ˆæ€§åˆ†æž:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰ç§¯æžçš„åˆ©ç”¨æ¡ˆä¾‹ã€‚POC ä»£ç å°è¯•ä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ä»¥å†™å…¥ Webshellï¼Œè¿™æ˜¯ä¸€ç§å·²çŸ¥çš„åˆ©ç”¨æ–¹å¼ï¼Œå› æ­¤æä¾›çš„POCä»£ç **æœ‰æ•ˆ**ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æž:** æŸ¥çœ‹æä¾›çš„è„šæœ¬`spring4shell.py`å’Œ`spring4shell.sh`ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žä¸Šä¼ webshellï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºæ¯”å¦‚åˆ é™¤æ–‡ä»¶ï¼Œåå‘è¿žæŽ¥æ¶æ„æœåŠ¡å™¨ç­‰ã€‚`README.md`ä¸­å¼•ç”¨äº†å¤–éƒ¨é“¾æŽ¥ï¼Œå­˜åœ¨ä¸€å®šçš„è·³è½¬é£Žé™©ï¼Œä½†ä»£ç æœ¬èº«ä¸»è¦æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæ•…æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåˆ¤æ–­ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æ¼æ´žåŽŸç†ï¼š**  æ”»å‡»è€…é€šè¿‡æ“çºµ class.module.classLoader.resources.context.parent.pipeline.first çš„å±žæ€§ï¼Œä¿®æ”¹ Tomcat AccessLogValve çš„é…ç½®ï¼Œç‰¹åˆ«æ˜¯ pattern å±žæ€§ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æž„é€ åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œé€šè¿‡ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„ pattern å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
    *   ç”±äºŽ Tomcat çš„æ—¥å¿—æ–‡ä»¶é€šå¸¸ä½äºŽ webapps ç›®å½•ä¸‹ï¼Œå› æ­¤æ¶æ„ä»£ç å®žé™…ä¸Šè¢«å†™å…¥äº†ä¸€ä¸ª JSP æ–‡ä»¶ï¼ˆwebshellï¼‰ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥ JSP æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  **POCä»£ç åˆ†æž:**
    *   `spring4shell.py` è„šæœ¬ä½¿ç”¨ `requests` åº“å‘é€ POST è¯·æ±‚ï¼ŒåŒ…å«æž„é€ çš„æ¶æ„æ•°æ®ï¼Œç›®æ ‡ URL æ˜¯å­˜åœ¨æ¼æ´žçš„ Spring åº”ç”¨ã€‚
    *   `spring4shell.sh` è„šæœ¬åŒæ ·å‘é€æž„é€ çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ã€‚
    *   ä¸¤ä¸ªè„šæœ¬éƒ½è®¾ç½®äº†webshellå¯†ç ï¼Œä¸Šä¼ ç›®å½•ï¼Œwebshellæ–‡ä»¶åï¼Œæ”»å‡»æˆåŠŸåŽé€šè¿‡webshell urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚
4.  **å…ˆå†³æ¡ä»¶ï¼š**
    *   ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨éƒ¨ç½²ä¸º WAR åŒ…åˆ° Tomcat ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨ä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚
    *   éœ€è¦ç›®æ ‡æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®

**é¡¹ç›®åœ°å€:** [osungjinwoo/CVE-2022-22965](https://github.com/osungjinwoo/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #20

**æ¥æº**: [CVE-2022-22965-salo-404_firewall.md](../2022/CVE-2022-22965-salo-404_firewall.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ã€‚å¦å¤–ï¼ŒæœåŠ¡å™¨éœ€å­˜åœ¨å¯å†™ç›®å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡ä¿®æ”¹classLoaderæ¥å†™å…¥æ¶æ„web shell,ä»Žè€Œå¯¼è‡´RCEã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ­¤æ¼æ´žæ˜¯çœŸå®žä¸”å¯è¢«åˆ©ç”¨çš„ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡Spring4Shellæ”»å‡»ï¼Œæœ¬èº«ä¸åŒ…å«æ”»å‡»è½½è·ï¼Œä½†æ˜¯èƒ½å¤Ÿæ£€æµ‹åˆ©ç”¨å°è¯•ï¼Œè¿™é—´æŽ¥è¯æ˜Žäº†æ­¤æ¼æ´žçš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ªæ¨¡æ‹Ÿé˜²ç«å¢™çš„Pythonè„šæœ¬ï¼ˆfirewall_server.pyï¼‰ã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ£€æµ‹å¹¶é˜»æ­¢Spring4Shellæ¼æ´žçš„åˆ©ç”¨ã€‚å®¡æŸ¥è¯¥è„šæœ¬åŽï¼Œå‘çŽ°å®ƒä¸»è¦é€šè¿‡æ£€æŸ¥HTTP POSTæ•°æ®ä¸­çš„æ¶æ„é”®ã€headerã€æœ‰æ•ˆè½½è·ç‰¹å¾æ¥å·¥ä½œã€‚æ²¡æœ‰å‘çŽ°ä»»ä½•è¿¹è±¡è¡¨æ˜Žä½œè€…è¯•å›¾åœ¨ä»£ç ä¸­éšè—ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º10%ã€‚é£Žé™©ä¸»è¦æ¥è‡ªäºŽå¯¹äºŽæ‹¦æˆªè§„åˆ™çš„ç»•è¿‡å’Œæœªæ¥æ½œåœ¨çš„æ¶æ„ä¿®æ”¹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpringæ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå®ƒå…è®¸å°†HTTPè¯·æ±‚å‚æ•°è‡ªåŠ¨ç»‘å®šåˆ°Javaå¯¹è±¡çš„å±žæ€§ä¸Šã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`classLoader`ç­‰å…³é”®å¯¹è±¡ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ã€‚
    *   éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ï¼ˆSpring Bootå¯æ‰§è¡Œjaré»˜è®¤éƒ¨ç½²æ–¹å¼ä¸å—å½±å“ï¼‰ã€‚
    *   ç›®æ ‡åº”ç”¨å­˜åœ¨å¯å†™ç›®å½•
3.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTP POSTè¯·æ±‚åˆ°å­˜åœ¨æ¼æ´žçš„ç«¯ç‚¹ã€‚
    *   æ¶æ„å‚æ•°ä¼šä¿®æ”¹Tomcatçš„æ—¥å¿—ç›®å½•ã€URIç¼–ç ç­‰é…ç½®ã€‚
    *   æ”»å‡»è€…ä¸Šä¼ åŒ…å«æ¶æ„ä»£ç çš„JSPæ–‡ä»¶åˆ°ä¿®æ”¹åŽçš„æ—¥å¿—ç›®å½•ï¼Œä»Žè€Œåˆ›å»ºä¸€ä¸ªwebshellã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [salo-404/firewall](https://github.com/salo-404/firewall)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #21

**æ¥æº**: [CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md](../2022/CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ä»¥åŠä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼Œå—å½±å“çš„ Spring Framework ç‰ˆæœ¬

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯Spring Frameworkä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚å®ƒå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåœ¨è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ç‰¹å®šçš„åˆ©ç”¨æ–¹å¼è¦æ±‚åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºTomcatä¸Šçš„WARåŒ…ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼šåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ“çºµç±»åŠ è½½å™¨å’Œè®¿é—®æ—¥å¿—ç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°æœåŠ¡å™¨ä¸­ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„ä»£ç ä¸»è¦æ˜¯è´¡çŒ®è€…è¡Œä¸ºå‡†åˆ™å’Œæäº¤è§„èŒƒï¼Œä¸åŒ…å«åŽé—¨ä»£ç ,å­˜åœ¨è½»å¾®æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œç¯¡æ”¹è´¡çŒ®æŒ‡å—ä»¥åŒ…å«æ¶æ„é“¾æŽ¥ï¼Œä½†ç›´æŽ¥ RCE åˆ©ç”¨çš„å¯èƒ½æ€§ä¸ºä½Žã€‚

**é¡¹ç›®åœ°å€:** [shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE](https://github.com/shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #22

**æ¥æº**: [CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md](../2022/CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** åˆ©ç”¨äº† Spring Framework åœ¨ JDK 9+ ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ—¶ï¼Œç”±äºŽç±»åŠ è½½å™¨æœºåˆ¶çš„æ”¹å˜ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first` çš„å±žæ€§ï¼Œæ¥ä¿®æ”¹ Tomcat çš„ access log valve çš„é…ç½®ï¼Œä»Žè€Œå†™å…¥æ¶æ„ JSP æ–‡ä»¶ã€‚

2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   JDK 9+
    *   å—å½±å“çš„ Spring Framework ç‰ˆæœ¬
    *   Tomcat ä½œä¸º WAR éƒ¨ç½²
    *   ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
    *   è¿™äº›æ¶æ„å‚æ•°ä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ï¼Œå°† pattern è®¾ç½®ä¸ºåŒ…å«æ¶æ„ä»£ç çš„ JSPã€‚
    *   Tomcat å°†æ¶æ„ä»£ç å†™å…¥åˆ° webapps/ROOT ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª JSP shell æ–‡ä»¶ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—® JSP shell æ–‡ä»¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

4.  **POC ä»£ç åˆ†æžï¼š** æä¾›çš„ `exploit.py` è„šæœ¬å®žçŽ°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ã€‚
    *   è„šæœ¬æž„é€ äº†åŒ…å«æ¶æ„å‚æ•°çš„ POST è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ã€‚
    *   `headers` å­—å…¸å®šä¹‰äº†è¯·æ±‚å¤´ï¼Œ`data` å˜é‡å®šä¹‰äº† POST è¯·æ±‚çš„æ•°æ®ï¼ŒåŒ…å«äº†ä¿®æ”¹ access log valve çš„ payloadã€‚
    *   è„šæœ¬å‘é€ POST è¯·æ±‚åˆ°ç›®æ ‡ URLï¼Œç„¶åŽå°è¯•è®¿é—®ç”Ÿæˆçš„ JSP shell æ–‡ä»¶ã€‚
    *   å¦‚æžœ JSP shell æ–‡ä»¶æˆåŠŸç”Ÿæˆå¹¶å¯ä»¥è®¿é—®ï¼Œè„šæœ¬ä¼šè¾“å‡º shell çš„ URLã€‚

5.  **æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žåœ¨æ»¡è¶³æ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

6.  **æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª JSP shellï¼Œ å…è®¸è¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚è„šæœ¬æœ¬èº«å¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•éšè—çš„ã€è¶…å‡ºæ­¤èŒƒå›´çš„æ¶æ„è¡Œä¸ºï¼Œå³æ²¡æœ‰å‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚è¯¥è„šæœ¬çš„åŠŸèƒ½ä¸Žæ¼æ´žåˆ©ç”¨æœ¬èº«ç›¸å…³ï¼Œæ—¨åœ¨éªŒè¯å’Œåˆ©ç”¨æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥æ¶æ„åŽé—¨ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ“çºµTomcatçš„æ—¥å¿—é…ç½®æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåœ°å®žçŽ°è¿™ä¸€æ”»å‡»ï¼Œä¸”æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚

**é¡¹ç›®åœ°å€:** [sohamsharma966/Spring4Shell-CVE-2022-22965](https://github.com/sohamsharma966/Spring4Shell-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #23

**æ¥æº**: [CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md](../2022/CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ ä»¥åŠæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ä¸”éƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡åº”ç”¨å¿…é¡»æ»¡è¶³ï¼šä½¿ç”¨Spring MVCæˆ–Spring WebFluxï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œé€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç›¸å…³çš„å±žæ€§ï¼ˆå¦‚`directory`, `prefix`, `suffix`, `pattern`ç­‰ï¼‰ï¼Œæ¥æŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥ä¸€ä¸ªæ¶æ„JSP webshellã€‚
2.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   é¦–å…ˆï¼Œåˆ©ç”¨POSTè¯·æ±‚é‡ç½®`fileDateFormat`å±žæ€§ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡POSTè¯·æ±‚è®¾ç½®Tomcatæ—¥å¿—é…ç½®ï¼ŒåŒ…æ‹¬æ—¥å¿—ç›®å½•ã€æ–‡ä»¶åå‰ç¼€ã€åŽç¼€å’ŒåŒ…å«æ¶æ„ä»£ç çš„æ—¥å¿—æ¨¡å¼ï¼Œè¿™äº›å‚æ•°è¢«ç¼–ç åœ¨URLä¸­ã€‚
    *   å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œè§¦å‘æ—¥å¿—è®°å½•ï¼Œå¹¶å°†æ¶æ„JSP webshellå†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚
    *   webshellåœ°å€ä¸º`http://ç›®æ ‡/å‰ç¼€.jsp?cmd=å‘½ä»¤`ã€‚
3.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ ¹æ®READMEçš„è¯´æ˜Žï¼Œå¯ä»¥æˆåŠŸåœ¨æ»¡è¶³æ¼æ´žæ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **æŠ•æ¯’é£Žé™©ï¼š**  è™½ç„¶ä¸»è¦ä»£ç æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œ`exploit-core.py`è„šæœ¬ä¸­ï¼Œæ¶æ„ä»£ç çš„å†™å…¥ç›®æ ‡ï¼ˆJSP webshellï¼‰æ˜¯ç¡¬ç¼–ç çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹è¿™äº›å‚æ•°ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ¤å…¥æ›´éšè”½æˆ–æ›´å…·ç ´åæ€§çš„åŽé—¨ã€‚Dockerfileä¸­çš„lunasec/tomcat-9.0.59-jdk11é•œåƒæ¥æºæœªç»éªŒè¯ï¼Œæœ‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä½†æ˜¯æ­¤ä»“åº“çš„é‡ç‚¹åœ¨äºŽspringæ¼æ´žåˆ©ç”¨ã€‚å‡è®¾Dockerfileä¸­çš„åŸºç¡€é•œåƒæ²¡æœ‰é—®é¢˜ï¼ŒæŠ•æ¯’é£Žé™©æ¯”ä¾‹çº¦ä¸º10%ã€‚
5.  **æ€»ç»“ï¼š** æ­¤æ¼æ´žçš„åˆ©ç”¨éœ€è¦ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼ŒåŠ¨æ€åœ°ä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ç›®æ ‡æœåŠ¡å™¨çš„çŽ¯å¢ƒæœ‰ä¸€å®šè¦æ±‚ï¼Œéœ€è¦ç‰¹å®šçš„Springç‰ˆæœ¬ã€JDKç‰ˆæœ¬å’Œéƒ¨ç½²æ–¹å¼ã€‚POCä»£ç çš„æœ‰æ•ˆæ€§å·²ç»ç¡®è®¤ï¼Œä½†ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [sunnyvale-it/CVE-2022-22965-PoC](https://github.com/sunnyvale-it/CVE-2022-22965-PoC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #24

**æ¥æº**: [CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md](../2022/CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcatä½œä¸ºWARéƒ¨ç½²

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†åœ¨JDK 9+çŽ¯å¢ƒä¸‹ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨çš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹classloaderä¸­çš„å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥webshellï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå·²åœ¨é‡Žå¤–è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„POCä»£ç ã€‚æä¾›çš„POCä»£ç åˆ©ç”¨äº†ä¿®æ”¹ Tomcat access log pattern çš„æ–¹å¼å†™å…¥ webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥æä¾›çš„POCä»£ç åŽï¼Œè™½ç„¶POCåˆ©ç”¨äº†å¸¸è§çš„æ¼æ´žåˆ©ç”¨æ–¹æ³•ï¼ˆå†™å…¥Webshellï¼‰ï¼Œä½†ä»£ç ä¸­åŒ…å«ä¸€ä¸ªå¯†ç éªŒè¯é€»è¾‘ `--password`ã€‚å¦‚æžœæ”»å‡»è€…ä¸æä¾›æ­£ç¡®çš„å¯†ç ï¼Œwebshellå°†æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä»Žè€Œå¢žåŠ äº†é˜²å¾¡çš„éš¾åº¦ï¼Œå­˜åœ¨ä¸€å®šæ¦‚çŽ‡ä¸ºåŽé—¨ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚è™½ç„¶webshellçš„å†™å…¥è¡Œä¸ºæœ¬èº«å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œä½†æ•´ä½“ä»£ç è¾ƒä¸ºç›´æŽ¥ï¼ŒæŠ•æ¯’å¯èƒ½æ€§è¾ƒä½Žã€‚é£Žé™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ã€‚
2.  è¯·æ±‚ä¸­åŒ…å«çš„å‚æ•°åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œwebshellï¼‰å†™å…¥Tomcatçš„access log patternã€‚
3.  è®¿é—®ç›®æ ‡åº”ç”¨çš„ç›¸åº”URLï¼Œè§¦å‘webshellæ‰§è¡Œã€‚
4.  æ”»å‡»è€…é€šè¿‡webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [viniciuspereiras/CVE-2022-22965-poc](https://github.com/viniciuspereiras/CVE-2022-22965-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #25

**æ¥æº**: [CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md](../2022/CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµclassloaderæ¥å†™å…¥webshellæˆ–è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œéœ€è¦JDK 9+ï¼Œå¹¶ä¸”åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œã€‚å¦‚æžœåº”ç”¨ä»¥Spring Boot executable jarï¼ˆé»˜è®¤æ–¹å¼ï¼‰éƒ¨ç½²ï¼Œåˆ™ä¸æ˜“å—åˆ°è¯¥æ¼æ´žå½±å“ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚POCåˆ©ç”¨äº†Spring Data Bindingçš„ç‰¹æ€§ï¼Œé€šè¿‡ä¿®æ”¹class.module.classLoader.resources.context.parent.pipeline.firstçš„å€¼ï¼Œä¿®æ”¹äº†Tomcatçš„access log patternï¼Œä»Žè€Œå†™å…¥webshellã€‚é€šè¿‡webshellçš„`Tomcat=S&cmd=`å‚æ•°å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„POCä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚å®ƒç›´æŽ¥åˆ©ç”¨äº†æ¼æ´žæ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•å°è¯•æ¥ä¿®æ”¹æˆ–ç ´åç›®æ ‡ç³»ç»Ÿä¸Šçš„å…¶ä»–æ–‡ä»¶æˆ–ç»„ä»¶ã€‚ä»£ç ç›®çš„æ˜Žç¡®ï¼Œå°±æ˜¯åˆ©ç”¨æ¼æ´žæ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œæ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„æ„å›¾çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©å¯ä»¥è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTP POSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸­åŒ…å«æ¶æ„çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„access log patternã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1.  å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚ï¼Œä¾‹å¦‚ï¼š
    ```
    class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22S%22.equals(request.getParameter(%22Tomcat%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=Shell&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=
    ```
2.  ä¸Šè¿°è¯·æ±‚ä¼šåœ¨`webapps/ROOT`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`Shell.jsp`çš„webshellã€‚ webshellå†…å®¹æ˜¯è¯»å–`cmd`å‚æ•°å¹¶æ‰§è¡Œã€‚
3.  è®¿é—®webshellï¼Œå¹¶é€šè¿‡`Tomcat=S&cmd=`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
    ```
    http://target.com/Shell.jsp?Tomcat=S&cmd=whoami
    ```

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªwebshellæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [xsxtw/SpringFramework_CVE-2022-22965_RCE](https://github.com/xsxtw/SpringFramework_CVE-2022-22965_RCE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #26

**æ¥æº**: [CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md](../2022/CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versionsï¼ŒJDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²

**åˆ©ç”¨æ¡ä»¶:** Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åºï¼Œè¿è¡Œåœ¨ JDK 9+ ä¸Šï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šã€‚éœ€è¦ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ä¸å½“çš„è¾“å…¥éªŒè¯ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

*   **å—å½±å“çš„Springç‰ˆæœ¬ï¼š** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions
*   **JDK ç‰ˆæœ¬ï¼š** JDK 9 åŠä»¥ä¸Š
*   **éƒ¨ç½²æ–¹å¼ï¼š** åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯ Spring Boot å¯æ‰§è¡Œ JARã€‚
*   **åˆ©ç”¨æ–¹å¼ï¼š**  æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„JSP Webshellåˆ°TomcatæœåŠ¡å™¨ï¼Œè¿›è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æ¼æ´žåˆ©ç”¨ä»£ç åˆ†æžï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªåŸºäºŽ JavaFx å¼€å‘çš„å›¾å½¢åŒ–å·¥å…· (Rexbb.jar)ã€‚å®ƒç®€åŒ–äº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1.  **å‘é€ Payloadï¼š**  è‡ªåŠ¨æž„é€ å’Œå‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæ¼æ´žã€‚
2.  **RCE æ£€æµ‹ï¼š**  åœ¨æˆåŠŸå†™å…¥ Webshell åŽï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æžœå›žæ˜¾ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  å…è®¸ç”¨æˆ·è¾“å…¥è‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚

è¯¥å·¥å…·é€šè¿‡å›¾å½¢ç•Œé¢å°è£…äº†æ¼æ´žåˆ©ç”¨çš„ç»†èŠ‚ï¼Œé™ä½Žäº†åˆ©ç”¨é—¨æ§›ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCå·¥å…·æœ¬èº«å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚è™½ç„¶ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨Spring4Shellæ¼æ´žï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­åŠ å…¥æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚ï¼š

*   **åŽé—¨æ¤å…¥ï¼š**  åœ¨ Webshell ä¸­æ·»åŠ é¢å¤–çš„åŽé—¨ï¼Œæ–¹ä¾¿æ”»å‡»è€…é•¿æœŸæŽ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚
*   **ä¿¡æ¯çªƒå–ï¼š**  åœ¨å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å‘é€åˆ°æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ã€‚
*   **æ¶æ„ä¼ æ’­ï¼š**  åˆ©ç”¨æ¼æ´žæ„ŸæŸ“å…¶ä»–ç³»ç»Ÿã€‚

ç”±äºŽæ— æ³•ç›´æŽ¥å®¡æŸ¥ Rexbb.jar çš„æºä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„ä¿¡ä»»é£Žé™©ã€‚å»ºè®®åœ¨ä½¿ç”¨æ­¤ç±»å·¥å…·æ—¶ï¼Œä¿æŒè­¦æƒ•ï¼Œåœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶è¿›è¡Œä»£ç å®¡è®¡ï¼Œä»¥ç¡®ä¿å·¥å…·çš„å®‰å…¨æ€§ã€‚

**æŠ•æ¯’å¯èƒ½æ€§è¯„ä¼°ï¼š**

è™½ç„¶ä¸èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ï¼Œä½†æ ¹æ®ä»£ç çš„æ€§è´¨ï¼Œä½œè€…å…·å¤‡æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç›¸å¯¹æ¥è¯´ï¼Œä½œè€…è¯¦ç»†è¯´æ˜Žäº†POCä½¿ç”¨æ–¹å¼ä»¥åŠåŽŸç†ï¼Œé™ä½Žäº†æŠ•æ¯’å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [zangcc/CVE-2022-22965-rexbb](https://github.com/zangcc/CVE-2022-22965-rexbb)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---



---

## POC #7

**æ¥æº**: [CVE-2022-22965-Nosie12_fire-wall-server.md](../2022/CVE-2022-22965-Nosie12_fire-wall-server.md)

## CVE-2022-22965 Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªé«˜å±çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå½±å“è¿è¡Œåœ¨ JDK 9+ ä¸Šçš„ Spring MVC æˆ– Spring WebFlux åº”ç”¨ï¼Œå¹¶ä¸”éœ€è¦éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…çš„å½¢å¼éƒ¨ç½²ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œå…è®¸æ”»å‡»è€…ä¼ å…¥æ¶æ„æž„é€ çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œä»Žè€Œå†™å…¥ webshell æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨ç¡®å®žå­˜åœ¨å¹¶ä¸”è¢«å¹¿æ³›è®¨è®ºå’Œåˆ©ç”¨ã€‚æä¾›çš„Pythonä»£ç å®žé™…ä¸Šæ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œç”¨äºŽæ£€æµ‹å’Œé˜»æ­¢åˆ©ç”¨ Spring4Shell æ¼æ´žçš„æ¶æ„è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«ã€‚å®ƒé€šè¿‡æ£€æµ‹è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ä¸­æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¶æ„æ¨¡å¼æ¥å·¥ä½œã€‚å› æ­¤ï¼Œæä¾›çš„ Python ä»£ç å¹¶ä¸èƒ½ç›´æŽ¥éªŒè¯æ¼æ´žçš„æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºé˜²å¾¡æŽªæ–½ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
å¯¹æä¾›çš„ Python ä»£ç  `firewall_server.py` è¿›è¡Œäº†åˆ†æžï¼Œè¯¥è„šæœ¬çš„åŠŸèƒ½æ˜¯æ£€æµ‹å’Œé˜»æ­¢åŒ…å«ç‰¹å®šæ¶æ„æ¨¡å¼çš„HTTPè¯·æ±‚ã€‚è„šæœ¬ä¸­å®šä¹‰äº† `BLOCKED_PATTERNS` åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†è¯¸å¦‚ `/tomcatwar.jsp`ï¼Œ`class.module.classLoader.resources.context.parent.pipeline` å’Œä¸€äº›ç¼–ç åŽçš„å­—ç¬¦ä¸²ç­‰æ¨¡å¼ã€‚è„šæœ¬ä¼šæ£€æŸ¥ä¼ å…¥çš„è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚ä½“ï¼Œå¦‚æžœå‘çŽ°ä»»ä½•åŒ¹é…çš„æ¨¡å¼ï¼Œå®ƒå°†è¿”å›žä¸€ä¸ª `403 Forbidden` å“åº”ã€‚å› æ­¤ï¼Œä»Žä»£ç çš„åŠŸèƒ½å’Œå†…å®¹æ¥çœ‹ï¼Œè¯¥è„šæœ¬æœ¬èº«ä¸åŒ…å«ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å¯ä»¥è®¤ä¸ºæŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼ŒSpring4Shell çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
1.  æ”»å‡»è€…å‘é€ä¸€ä¸ªåŒ…å«æ¶æ„æž„é€ çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚çš„ç›®æ ‡æ˜¯ Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
2.  æ¶æ„è¯·æ±‚ä¸­çš„å‚æ•°ä¼šåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œå°è¯•ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ã€‚
3.  é€šè¿‡ä¿®æ”¹ AccessLogValve çš„å±žæ€§ï¼Œæ”»å‡»è€…å¯ä»¥æŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„ä½ç½®å’Œæ ¼å¼ï¼Œä»Žè€Œå†™å…¥ä»»æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª webshellï¼‰ã€‚
4.  ä¸€æ—¦ webshell è¢«å†™å…¥ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡å®ƒæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [Nosie12/fire-wall-server](https://github.com/Nosie12/fire-wall-server)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #8

**æ¥æº**: [CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md](../2022/CVE-2022-22965-ZapcoMan_spring4shell-vulnerable-application.md)

## CVE-2022-22965-Spring4Shell

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä½¿ç”¨Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢ç»“æžœå’Œæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯„ä¼°å¦‚ä¸‹ï¼š

**æœ‰æ•ˆæ€§ï¼š**
è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æä¾›äº†ä¸€ä¸ªå¯ docker åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå®¹æ˜“å—åˆ° Spring4Shell æ¼æ´ž (CVE-2022-22965) çš„æ”»å‡»ã€‚Dockerfile ä½¿ç”¨äº†ç‰¹å®šç‰ˆæœ¬çš„ Tomcat é•œåƒ (lunasec/tomcat-9.0.59-jdk11)ï¼Œè¯¥ç‰ˆæœ¬åœ¨æ¼æ´žä¿®å¤ä¹‹å‰ã€‚pom.xml æ–‡ä»¶é…ç½®äº† Spring Boot ç‰ˆæœ¬ 2.6.3ï¼Œè¯¥ç‰ˆæœ¬å¯èƒ½å—æ¼æ´žå½±å“ï¼ˆå…·ä½“å–å†³äºŽ Spring Framework çš„ç‰ˆæœ¬ï¼‰ã€‚æž„å»ºè¿‡ç¨‹åŒ…æ‹¬ä½¿ç”¨ Maven æ‰“åŒ…åº”ç”¨ç¨‹åºä¸º WAR æ–‡ä»¶ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ° Tomcat çš„ webapps ç›®å½•ã€‚æè¿°æ–‡ä»¶ä¹Ÿæè¿°è¿™æ˜¯ä¸€ä¸ªPOCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»“åº“çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤º CVE-2022-22965 æ¼æ´žã€‚ç„¶è€Œï¼Œå§‹ç»ˆå­˜åœ¨ä»£ç ä¸­åŒ…å«æ¶æ„æˆ–åŽé—¨ä»£ç çš„é£Žé™©ï¼Œå³ä½¿ä½œè€…çš„æ„å›¾æ˜¯è‰¯æ€§çš„ã€‚ä»£ç ä¸­æ£€æµ‹åˆ°æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žã€‚é£Žé™©ä¼°è®¡ä¸º 10%ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š

*   Dockerfileï¼šå®ƒä¸‹è½½äº†ä¸€ä¸ªæŒ‡å®šçš„tomcatç‰ˆæœ¬ï¼Œå¦‚æžœè¯¥dockerå­˜åœ¨åŽé—¨ï¼Œåˆ™å­˜åœ¨é£Žé™©
*   `README.md` æŽ¨èäº†LunaSecçš„åˆ†æ”¯ï¼Œå¯ä»¥æŽ¨æ–­æ˜¯å®˜æ–¹çš„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ¶‰åŠæ“çºµç±»åŠ è½½å™¨å’Œ servlet ä¸Šä¸‹æ–‡ä»¥å†™å…¥æ¶æ„ JSP æ–‡ä»¶åˆ° Tomcat çš„ webapp ç›®å½•ä¸­ï¼Œç„¶åŽæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹å®šæž„é€ çš„ HTTP è¯·æ±‚æ¥è§¦å‘è¯¥ JSP æ–‡ä»¶ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¯¥ POC ä»£ç ä¼¼ä¹Žæœ‰æ•ˆï¼Œä½†ä½¿ç”¨å’Œéƒ¨ç½² POC éœ€è¦è°¨æ…Žï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚å§‹ç»ˆå»ºè®®åœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä»”ç»†å®¡æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [ZapcoMan/spring4shell-vulnerable-application](https://github.com/ZapcoMan/spring4shell-vulnerable-application)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #9

**æ¥æº**: [CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md](../2022/CVE-2022-22965-bL34cHig0_Telstra-Cybersecurity-Virtual-Experience-.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), å­˜åœ¨RequestMappingå’ŒPOJOå‚æ•°

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨å¯èƒ½å—åˆ°å½±å“ã€‚è¯¥æ¼æ´žåˆ©ç”¨éœ€è¦åº”ç”¨éƒ¨ç½²ä¸ºTomcat WARåŒ…ã€‚å¦‚æžœéƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨æ•°æ®ç»‘å®šï¼Œå°†æ¶æ„å±žæ€§å†™å…¥åˆ°`class.module.classLoader.resources.context.parent.pipeline.first.pattern`ç­‰å±žæ€§ä¸­ï¼Œæœ€ç»ˆå†™å…¥æ¶æ„webshellã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²è¢«ç§¯æžåˆ©ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…é€šè¿‡å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellã€‚webshellçš„è·¯å¾„å’Œæ–‡ä»¶åå¯ä»¥é€šè¿‡è¯·æ±‚å‚æ•°æŒ‡å®šã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ªé˜²ç«å¢™è„šæœ¬ï¼Œæ—¨åœ¨é˜»æ­¢åˆ©ç”¨CVE-2022-22965çš„æ¶æ„è¯·æ±‚ã€‚å®ƒé€šè¿‡æ£€æŸ¥è¯·æ±‚è·¯å¾„å’ŒHTTPå¤´æ¥è¯†åˆ«æ¶æ„æµé‡ï¼Œå¹¶è¿”å›ž403 Forbiddené”™è¯¯ã€‚æ­¤ä»£ç æœ¬èº«**ä¸åŒ…å«ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨**ï¼Œå› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚å®ƒä¸»è¦é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¶æ„è¯·æ±‚ï¼Œå¦‚è¯·æ±‚è·¯å¾„åŒ…å«`/tomcatwar.jsp`æˆ–è€…HTTPå¤´éƒ¨åŒ…å«`suffix=%>//`ç­‰ç‰¹å¾ã€‚è¿™ä¸ªè„šæœ¬çš„ç›®çš„æ˜¯é˜²å¾¡Spring4Shellæ”»å‡»ï¼Œè€Œä¸æ˜¯åˆ©ç”¨å®ƒã€‚

**é¡¹ç›®åœ°å€:** [bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-](https://github.com/bL34cHig0/Telstra-Cybersecurity-Virtual-Experience-)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #10

**æ¥æº**: [CVE-2022-22965-brunoh6_web-threat-mitigation.md](../2022/CVE-2022-22965-brunoh6_web-threat-mitigation.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², å¹¶ä¸”åº”ç”¨ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„ WebShell åˆ°æœåŠ¡å™¨ï¼Œæœ€ç»ˆå®žçŽ° RCEã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§:**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹ï¼ˆJDK 9+, Tomcat WARéƒ¨ç½²ï¼‰å¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç ï¼ˆ`web-threat-mitigation`ä»“åº“ï¼‰ä¹Ÿè¯å®žäº†è¿™ä¸€ç‚¹ï¼Œè¯¥ä»“åº“æä¾›äº†ä¸€ä¸ªä½¿ç”¨Metasploitè¿›è¡Œæ¼æ´žåˆ©ç”¨çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨æœ‰WAFå’Œæ— WAFçš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨çš„æˆåŠŸä¸Žå¤±è´¥ã€‚å› æ­¤ï¼Œå¯ä»¥åˆ¤æ–­POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£Žé™©:**
åˆ†æžæä¾›çš„ä»£ç ä»“åº“ï¼Œä¸»è¦æ˜¯æ¼”ç¤ºå¦‚ä½•æ£€æµ‹å’Œç¼“è§£webåº”ç”¨ç¨‹åºå¨èƒï¼Œé€šè¿‡ OWASP ZAP, Burp Suite, å’Œ ModSecurity WAFã€‚å®ƒè¿˜åŒ…æ‹¬äº†CVE-2022-22965 (Spring4Shell)çš„æ¼æ´žåˆ©ç”¨ã€‚ä»£ç ä»“åº“ä¸­æ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–è€…åŽé—¨, ä½†æ˜¯è€ƒè™‘åˆ°ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹å’Œä¼ æ’­è¿™äº›ä»£ç ï¼Œä»¥åŠå®žé™…çŽ¯å¢ƒä¸­å¯èƒ½å­˜åœ¨çš„å¤æ‚æ€§ï¼Œä»ç„¶ä¸èƒ½å®Œå…¨æŽ’é™¤æŠ•æ¯’çš„å¯èƒ½ã€‚ é£Žé™©ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼:**
1.  **ç¡®å®šç›®æ ‡çŽ¯å¢ƒ:**  æ£€æŸ¥ç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ (Spring MVC/WebFlux, JDK 9+, Tomcat WARéƒ¨ç½²)ã€‚
2.  **å‘é€æ¶æ„è¯·æ±‚:**  æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹Tomcatçš„`AccessLogValve`ç»„ä»¶å±žæ€§ã€‚
3.  **å†™å…¥WebShell:** é€šè¿‡ä¿®æ”¹`directory`ã€`prefix`ã€`suffix`å’Œ`pattern`å±žæ€§ï¼Œå°†WebShellå†™å…¥åˆ°æœåŠ¡å™¨ä¸Šçš„å¯è®¿é—®ç›®å½•ã€‚
4.  **æ‰§è¡Œå‘½ä»¤:**  é€šè¿‡è®¿é—®å†™å…¥çš„WebShellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é˜²å¾¡å»ºè®®:**
*   å‡çº§Spring Frameworkåˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬ (5.3.18+, 5.2.20+)ã€‚
*   ä½¿ç”¨WAF (å¦‚ModSecurity) å¹¶é…ç½®OWASP CRSæ¥æ£€æµ‹å’Œé˜»æ­¢æ¶æ„è¯·æ±‚ã€‚
*   é™åˆ¶æ•°æ®ç»‘å®šçš„ä½¿ç”¨ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥ç›´æŽ¥ç»‘å®šåˆ°æ•æ„Ÿå¯¹è±¡å±žæ€§ã€‚

**é¡¹ç›®åœ°å€:** [brunoh6/web-threat-mitigation](https://github.com/brunoh6/web-threat-mitigation)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #11

**æ¥æº**: [CVE-2022-22965-c33dd_CVE-2022-22965.md](../2022/CVE-2022-22965-c33dd_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ç§è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽ Spring Framework ä¸­ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æ­¤æ¼æ´žï¼Œå‘æŸäº›å‚æ•°ä¼ é€’ç‰¹åˆ¶çš„æ¶æ„è¯·æ±‚ï¼Œä»Žè€ŒèŽ·å¾—å¯¹æœåŠ¡å™¨çš„æŽ§åˆ¶æƒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ï¼š** ç›®æ ‡åº”ç”¨ç¨‹åºéœ€è¦è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚ä½¿ç”¨ Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æ¼æ´žè§¦å‘ï¼š** æ¼æ´žåˆ©ç”¨æ¶‰åŠæ“çºµç±»åŠ è½½å™¨ç»•è¿‡å®‰å…¨æœºåˆ¶ã€‚é€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶ï¼Œå¯ä»¥å†™å…¥æ¶æ„ Web shellã€‚
3.  **å…·ä½“æ­¥éª¤ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ã€‚è¿™äº›å‚æ•°è¢« Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶å¤„ç†ï¼Œå¯¼è‡´ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§è¢«ä¿®æ”¹ï¼Œä»Žè€Œå†™å…¥ Web shell åˆ°æœåŠ¡å™¨çš„å¯è®¿é—®ä½ç½®ã€‚
4.  **ä»£ç åˆ†æžï¼š** æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ªCç¨‹åºï¼Œè¯¥ç¨‹åºå°è¯•é€šè¿‡HTTPè¯·æ±‚ä¸Žç›®æ ‡æœåŠ¡å™¨é€šä¿¡ï¼Œå¹¶æ£€æŸ¥å“åº”çŠ¶æ€ç ä»¥ç¡®å®šæ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å…³é”®éƒ¨åˆ†åœ¨äºŽæž„é€ ç‰¹å®šçš„HTTPå¤´ï¼Œä¾‹å¦‚`suffix`å’Œ`c1`ï¼Œä»¥åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žã€‚ä»£ç ä¸­æ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„Cä»£ç ç‰‡æ®µçœ‹èµ·æ¥åƒæ˜¯æ¼æ´žåˆ©ç”¨çš„å‰æœŸæ£€æŸ¥å·¥å…·ï¼Œç”¨äºŽéªŒè¯ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´žã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®šheaderçš„HTTPè¯·æ±‚å¹¶æ£€æŸ¥å“åº”æ¥å°è¯•åˆ©ç”¨è¯¥æ¼æ´žã€‚å¦‚æžœæœåŠ¡å™¨è¿”å›ž 2XX çŠ¶æ€ç ï¼Œåˆ™è®¤ä¸ºæ¼æ´žå­˜åœ¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

ä»”ç»†å®¡æŸ¥æä¾›çš„Cä»£ç åŽï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„ã€æ¶æ„çš„æˆ–éšè—çš„åŽé—¨ä»£ç ã€‚ä»£ç çš„åŠŸèƒ½ä¸»è¦æ˜¯å‘é€HTTPè¯·æ±‚ï¼Œè¯»å–å“åº”ï¼Œå¹¶æ ¹æ®å“åº”ç åˆ¤æ–­æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚ å› æ­¤ï¼Œè¯„ä¼°çš„æŠ•æ¯’é£Žé™©ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [c33dd/CVE-2022-22965](https://github.com/c33dd/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #12

**æ¥æº**: [CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md](../2022/CVE-2022-22965-cxzero_CVE-2022-22965-spring4shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼Œæ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

ä»Žæä¾›çš„æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæ¼æ´žåˆ©ç”¨ä»£ç æ¥çœ‹ï¼Œæ­¤æ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚æ¼æ´žåº“ä¿¡æ¯æ˜Žç¡®æŒ‡å‡ºå­˜åœ¨RCEçš„å¯èƒ½ï¼Œå¹¶æåŠäº†åˆ©ç”¨æ¡ä»¶ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­åŒ…å«å¤§é‡å…³äºŽè¯¥æ¼æ´žçš„åˆ†æžå’Œåˆ©ç”¨æ–‡ç« ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå·²è¢«å¹¿æ³›ç ”ç©¶å’Œåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å®žçŽ°äº†åˆ©ç”¨è¯¥æ¼æ´žä¸Šä¼ webshellçš„åŠŸèƒ½ï¼Œé€šè¿‡ä¿®æ”¹classloaderç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚æ‰§è¡ŒçŠ¶æ€åˆ¤æ–­è¡¨æ˜Žï¼ŒPOC è‡³å°‘èƒ½å¤Ÿå®Œæˆwebshellçš„ä¸Šä¼ è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

ä»”ç»†åˆ†æžæä¾›çš„ exploit1.py å’Œ exploit2.py è„šæœ¬ï¼Œä»¥åŠ README.md æ–‡ä»¶ï¼Œä¸»è¦é£Žé™©ç‚¹åœ¨äºŽï¼š

*   **ç¡¬ç¼–ç å¯†ç ï¼š** exploit1.py ä¸­å­˜åœ¨é»˜è®¤å¯†ç  `thm`ï¼Œå¦‚æžœæ”»å‡»è€…æ²¡æœ‰ä¿®æ”¹å¯†ç å°±ç›´æŽ¥ä½¿ç”¨ï¼Œå­˜åœ¨è¢«å…¶ä»–æ¶æ„ç”¨æˆ·åˆ©ç”¨çš„é£Žé™©ã€‚è™½ç„¶è¿™ä¸ç®—æ˜¯ä»£ç å±‚é¢çš„æŠ•æ¯’ï¼Œä½†å±žäºŽé…ç½®ä¸å½“å¯èƒ½å¯¼è‡´çš„é£Žé™©ã€‚
*   **æ–‡ä»¶åå’Œç›®å½•ï¼š** é»˜è®¤çš„æ–‡ä»¶å `tomcatwar.jsp` å’Œç›®å½• `ROOT` å¯èƒ½ä¼šè¢«ç›‘æŽ§ç³»ç»Ÿæ£€æµ‹åˆ°ï¼Œä½†è¿™æ›´å¤šæ˜¯æ–¹ä¾¿åˆ©ç”¨ï¼Œè€Œéžéšè—çš„æ¶æ„è¡Œä¸ºã€‚
*   **ä¾èµ–é¡¹é£Žé™©ï¼š** README.md ä¸­æåˆ°äº† Maven ç¼–è¯‘å’Œ Tomcat ä¾èµ–ï¼Œå¦‚æžœä½¿ç”¨çš„ Maven ä»“åº“æˆ– Tomcat é•œåƒè¢«æ¶æ„ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¼•å…¥æ¶æ„ä»£ç ã€‚è¿™å±žäºŽä¾›åº”é“¾é£Žé™©ï¼Œè€Œéžä»£ç æœ¬èº«æŠ•æ¯’ã€‚
*    **ä»£ç†æœåŠ¡å™¨é£Žé™©**: åœ¨ exploit1.py è„šæœ¬ä¸­ï¼Œæ”¯æŒé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¿žæŽ¥ï¼Œè™½ç„¶æ˜¯æ–¹ä¾¿è¿›è¡ŒHTTPæ¶ˆæ¯æ‹¦æˆªï¼Œä½†ä¹Ÿå­˜åœ¨ä»£ç†æœåŠ¡å™¨æ”¶é›†è¯·æ±‚ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚è¿™ä¸å±žäºŽæ˜¯POCæŠ•æ¯’èŒƒç•´ï¼Œæ˜¯å±žäºŽä½¿ç”¨è€…ä¿¡æ¯å®‰å…¨èŒƒç•´ã€‚
*   **å…è´£å£°æ˜Žå’Œå­¦ä¹ ç›®çš„ï¼š** README.md ä¸­å£°æ˜Ž PoC ä»…ç”¨äºŽå­¦ä¹ ç›®çš„ï¼Œä½†æ— æ³•ä¿è¯ä½¿ç”¨è€…ä¸ä¼šå°†å…¶ç”¨äºŽéžæ³•ç”¨é€”ã€‚

ç»¼åˆæ¥çœ‹ï¼Œä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†å­˜åœ¨ä¸€äº›é…ç½®é£Žé™©å’Œä¾èµ–é¡¹é£Žé™©ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º **10%**ã€‚è¿™ä¸ªç™¾åˆ†æ¯”ä¸»è¦è€ƒè™‘ä½¿ç”¨è€…åœ¨ä½¿ç”¨é»˜è®¤é…ç½®å¯èƒ½å¸¦æ¥çš„é£Žé™©ä»¥åŠå¼•å…¥æ¶æ„ä¾èµ–çš„æ½œåœ¨å¯èƒ½ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨ Tomcat ä¸­ï¼Œä»¥ WAR åŒ…å½¢å¼éƒ¨ç½²ã€‚åº”ç”¨ä½¿ç”¨äº† Spring MVC æˆ– Spring WebFlux æ¡†æž¶ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP POST è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ `AccessLogValve` ç»„ä»¶çš„å±žæ€§ã€‚
3.  **ä¿®æ”¹æ—¥å¿—é…ç½®ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ `pattern` å±žæ€§ï¼Œå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚`directory`ã€`prefix`ã€`suffix` å’Œ `fileDateFormat` å±žæ€§ç”¨äºŽæŽ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ï¼Œç¡®ä¿ JSP ä»£ç èƒ½å¤Ÿå†™å…¥åˆ° webapps ç›®å½•ä¸‹ï¼Œå¹¶ä»¥ JSP æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚
4.  **ä¸Šä¼  Webshellï¼š**  æˆåŠŸä¿®æ”¹æ—¥å¿—é…ç½®åŽï¼ŒTomcat ä¼šå°†æ¶æ„ JSP ä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ webapps ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª Webshellã€‚
5.  **è¿œç¨‹ä»£ç æ‰§è¡Œï¼š**  æ”»å‡»è€…é€šè¿‡è®¿é—® Webshell çš„ URLï¼Œæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»Žè€ŒæŽ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [cxzero/CVE-2022-22965-spring4shell](https://github.com/cxzero/CVE-2022-22965-spring4shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #13

**æ¥æº**: [CVE-2022-22965-dbgee_Spring4Shell.md](../2022/CVE-2022-22965-dbgee_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œä¹Ÿè¢«ç§°ä¸º Spring4Shellï¼Œæ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥ä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ï¼Œè¿›è€Œå†™å…¥æ¶æ„ Web shellï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œç¡®è®¤è¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„åˆ©ç”¨ä»£ç ã€‚æ¼æ´žçš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„å…ˆå†³æ¡ä»¶ï¼šè¿è¡Œåœ¨ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šï¼Œå¹¶ä½¿ç”¨ Spring MVC æˆ– Spring WebFluxã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µ `/tmp/654a99bf9ba51c6c41107b986ba46894/mvnw` çœ‹èµ·æ¥æ˜¯ Maven Wrapper è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åœ¨æ²¡æœ‰å®‰è£… Maven çš„çŽ¯å¢ƒä¸‹ä¹Ÿèƒ½æž„å»º Maven é¡¹ç›®ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«ç›´æŽ¥çš„æ¼æ´žåˆ©ç”¨ä»£ç ã€‚æŠ•æ¯’çš„é£Žé™©åœ¨äºŽï¼š

*   **ä¾èµ–é¡¹æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ Maven é¡¹ç›®çš„ `pom.xml` æ–‡ä»¶ï¼Œæ·»åŠ æ¶æ„çš„ä¾èµ–é¡¹ã€‚å½“ Maven Wrapper æž„å»ºé¡¹ç›®æ—¶ï¼Œä¼šä¸‹è½½å¹¶æ‰§è¡Œè¿™äº›æ¶æ„ä¾èµ–é¡¹ä¸­çš„ä»£ç ï¼Œä»Žè€Œå®žçŽ°æŠ•æ¯’ã€‚è™½ç„¶ä»£ç ç‰‡æ®µæœ¬èº«æ²¡æœ‰æ¶æ„ï¼Œä½† Maven æž„å»ºè¿‡ç¨‹çš„æ€§è´¨å†³å®šäº†å­˜åœ¨è¿™ç§é£Žé™©ã€‚
*   **é…ç½®æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ Maven çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æž„å»ºè¿‡ç¨‹ï¼Œæ’å…¥æ¶æ„ä»£ç ã€‚

è€ƒè™‘åˆ° Maven Wrapper çš„åŠŸèƒ½ä»¥åŠæ½œåœ¨çš„æž„å»ºè¿‡ç¨‹ç¯¡æ”¹ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåˆ©ç”¨æ–¹å¼ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1.  **ç¡®å®šç›®æ ‡ï¼š** æ‰¾åˆ°æ»¡è¶³æ¼æ´žåˆ©ç”¨æ¡ä»¶çš„ Spring åº”ç”¨ã€‚
2.  **æž„é€ æ¶æ„è¯·æ±‚ï¼š** æž„é€ åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ä¼šä¿®æ”¹ Tomcat çš„è®¿é—®æ—¥å¿—é…ç½®ã€‚
3.  **å†™å…¥ Web Shellï¼š** é€šè¿‡ä¿®æ”¹è®¿é—®æ—¥å¿—é…ç½®ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ Web shellï¼‰å†™å…¥åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ã€‚
4.  **æ‰§è¡Œå‘½ä»¤ï¼š** é€šè¿‡è®¿é—®å†™å…¥çš„ Web shellï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œå¦‚æžœç›®æ ‡åº”ç”¨ç¨‹åºæ»¡è¶³åˆ©ç”¨æ¡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ©ç”¨è¯¥æ¼æ´žæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**é¡¹ç›®åœ°å€:** [dbgee/Spring4Shell](https://github.com/dbgee/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #14

**æ¥æº**: [CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md](../2022/CVE-2022-22965-gokul-ramesh_Spring4Shell-PoC-exploit.md)

## CVE-2022-22965 Spring4Shell è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.0 to 5.3.17, 5.2.0 to 5.2.19 and older versions

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+ï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œåˆ©ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ“çºµClassLoaderï¼Œä»Žè€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´žå·²è¢«å…¬å¼€åˆ©ç”¨ï¼Œå¹¶æœ‰å¯ç”¨çš„POCã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æŸ¥çœ‹æä¾›çš„exploit.pyä»£ç ï¼Œä»£ç ç»“æž„éžå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æžå™¨ï¼Œä½†runå’Œcheckå‡½æ•°å‡æœªå®žçŽ°ï¼Œæ˜¯æœªå®Œæˆçš„POCã€‚ç›´æŽ¥åˆ†æžæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºï¼Œä½†æ˜¯ç”±äºŽä»£ç ä¸å®Œæ•´ï¼Œæœªæ¥å­˜åœ¨è¢«ä¿®æ”¹å¹¶æ·»åŠ æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚è€ƒè™‘åˆ°ä»“åº“æœ¬èº«æ˜¯PoCæ€§è´¨ï¼Œä»¥åŠä»£ç çš„æœªå®ŒæˆçŠ¶æ€ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚è¯¥ä»“åº“è¿˜å¼•ç”¨äº†å…¶ä»–ä»“åº“ï¼Œéœ€è¦æ³¨æ„ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **ç›®æ ‡çŽ¯å¢ƒï¼š** åº”ç”¨ç¨‹åºå¿…é¡»è¿è¡Œåœ¨JDK 9+ä¸Šï¼Œå¹¶ä¸”éƒ¨ç½²ä¸ºä¼ ç»Ÿçš„WARåŒ…åœ¨TomcatæœåŠ¡å™¨ä¸­ã€‚
2.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpring Frameworkçš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚å½“ä½¿ç”¨`RequestMapping`æ³¨è§£å’ŒPOJOå‚æ•°æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹`class.module.classLoader`ç­‰å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—ç›®å½•ï¼Œå†™å…¥webshellæˆ–å…¶ä»–æ¶æ„ä»£ç ã€‚
3.  **æ”»å‡»æ­¥éª¤ï¼ˆåŸºäºŽå·²çŸ¥åˆ©ç”¨æ–¹å¼ï¼‰ï¼š**
    *   å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚ï¼Œä¾‹å¦‚ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern`å±žæ€§ï¼Œå°†Tomcatçš„access logé…ç½®ä¸ºwebshellã€‚
    *   è®¿é—®webshellï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [gokul-ramesh/Spring4Shell-PoC-exploit](https://github.com/gokul-ramesh/Spring4Shell-PoC-exploit)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #15

**æ¥æº**: [CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md](../2022/CVE-2022-22965-guigui237_Expoitation-de-la-vuln-rabilit-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcatä½œä¸ºWARéƒ¨ç½²ï¼Œä½¿ç”¨Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ªåœ¨ Spring Framework ä¸­å‘çŽ°çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ•°æ®ç»‘å®šï¼Œæ“çºµæŸäº›å±žæ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ¼æ´žåˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä½¿ç”¨JDK 9+å¹¶ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šçš„Springåº”ç”¨ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ©ç”¨æ¡ä»¶:**  éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
    *   è¿è¡Œåœ¨ JDK 9 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   Spring MVC æˆ– Spring WebFlux åº”ç”¨ã€‚
    *   éƒ¨ç½²ä¸º Tomcat WAR åŒ…ã€‚
    *   ä½¿ç”¨å—å½±å“çš„ Spring Framework ç‰ˆæœ¬ (5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+)ã€‚
2.  **æ¼æ´žåŽŸç†:** é€šè¿‡æ“çºµ `class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå†™å…¥webshellåˆ°å¯è®¿é—®çš„ç›®å½•ã€‚
3.  **åˆ©ç”¨æ­¥éª¤:**
    *   å‘é€æ¶æ„æž„é€ çš„HTTPè¯·æ±‚ï¼ŒåŒ…å«ç²¾å¿ƒè®¾è®¡çš„å‚æ•°ï¼Œä»¥ä¿®æ”¹Tomcatçš„æ—¥å¿—è®¾ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°Webå¯è®¿é—®çš„ç›®å½•ã€‚
    *   æ—¥å¿—å†…å®¹åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚JSP webshellã€‚
    *   é€šè¿‡è®¿é—®webshellçš„URLï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç  (`spring4shell.py`) æ—¨åœ¨è‡ªåŠ¨åŒ–ä¸Šè¿°è¿‡ç¨‹ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

æä¾›çš„Pythonè„šæœ¬`spring4shell.py`ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨CVE-2022-22965æ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®å†™å…¥webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è™½ç„¶è¯¥è„šæœ¬æœ¬èº«æ˜¯ä¸ºäº†æ”»å‡»åˆ©ç”¨è€Œç¼–å†™çš„ï¼Œä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨è€…ç›´æŽ¥ä¸‹è½½å¹¶ä½¿ç”¨æœªç»ä»”ç»†å®¡æŸ¥çš„ä»£ç æ—¶ã€‚

å…·ä½“åˆ†æžå¦‚ä¸‹ï¼š

*   **é£Žé™©ç‚¹1ï¼š**  è„šæœ¬ä¸­å¯èƒ½ä¼šåŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚æ¤å…¥åŽé—¨ã€æ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å¤–ä¼ ç­‰ã€‚è™½ç„¶ç›®å‰çš„ä»£ç ç‰‡æ®µçœ‹èµ·æ¥ç›¸å¯¹ç›´æŽ¥ï¼Œä¸»è¦å…³æ³¨æ¼æ´žåˆ©ç”¨ï¼Œä½†æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ é¢å¤–çš„æ¶æ„åŠŸèƒ½ã€‚
*   **é£Žé™©ç‚¹2ï¼š**  è¯¥è„šæœ¬ä¾èµ–äºŽç¬¬ä¸‰æ–¹åº“ (`requests`, `bs4`)ï¼Œè¿™äº›åº“æœ¬èº«å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´žï¼Œæˆ–è€…è¢«æ”»å‡»è€…æ›¿æ¢ä¸ºæ¶æ„ç‰ˆæœ¬ã€‚è™½ç„¶`pip3 install bs4` å’Œ `pip3 install requests`  æ˜¯å®‰è£…å¸¸ç”¨åº“ï¼Œä½†å¦‚æžœæºè¢«åŠ«æŒï¼Œå¯èƒ½ä¼šå®‰è£…æ¶æ„ç‰ˆæœ¬ã€‚
*   **é£Žé™©ç‚¹3ï¼š**  è„šæœ¬ä¸­çš„é»˜è®¤å‚æ•°ï¼Œä¾‹å¦‚webshellçš„æ–‡ä»¶åã€å¯†ç ã€ä¸Šä¼ ç›®å½•ç­‰ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚å¦‚æžœæ”»å‡»è€…èƒ½å¤Ÿé¢„æµ‹æˆ–æŽ§åˆ¶è¿™äº›å‚æ•°ï¼Œå°±å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡ŒåŽç»­æ”»å‡»ã€‚

ç”±äºŽå­˜åœ¨ä»¥ä¸Šæ½œåœ¨é£Žé™©ï¼Œåœ¨ä½¿ç”¨ä»»ä½•å…¬å¼€çš„æ¼æ´žåˆ©ç”¨ä»£ç ä¹‹å‰ï¼Œéƒ½å¿…é¡»è¿›è¡Œå½»åº•çš„å®‰å…¨å®¡æŸ¥ï¼Œç¡®ä¿ä»£ç çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚æ­¤å¤–ï¼Œå»ºè®®ä¿®æ”¹é»˜è®¤å‚æ•°ï¼Œå¢žåŠ æ”»å‡»éš¾åº¦ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**
è€ƒè™‘åˆ°ä»£ç åŠŸèƒ½ç›¸å¯¹é›†ä¸­äºŽæ¼æ´žåˆ©ç”¨ï¼Œä¸”ä½œè€…ä¹Ÿç»™å‡ºäº†GitHubåœ°å€ï¼Œåˆæ­¥åˆ¤æ–­æŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£Žé™©ä¸º10%ã€‚è¿™ä¸ªæ¦‚çŽ‡è€ƒè™‘åˆ°ä½œè€…å¯èƒ½éšè—æ¶æ„ä»£ç ï¼Œæˆ–è€…å°†æ¥ä»£ç ä»“åº“è¢«å…¥ä¾µåŽæ¤å…¥æ¶æ„ä»£ç çš„æƒ…å†µã€‚

**é¡¹ç›®åœ°å€:** [guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965](https://github.com/guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #16

**æ¥æº**: [CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md](../2022/CVE-2022-22965-jakabakos_CVE-2022-22965-Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions on JDK 9+ with Tomcat as WAR deployment.

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡åº”ç”¨ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„Spring Frameworkç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å—å½±å“çš„Spring MVCæˆ–Spring WebFluxã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨æŸäº›ç‰¹æ€§æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå½±å“è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨ç¨‹åºå¿…é¡»ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡Œjarï¼Œåˆ™ä¸å—å½±å“ã€‚æ¼æ´žåˆ©ç”¨ä»£ç é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®žçŽ°RCEï¼š

1.  **é‡ç½®æ—¥å¿—å˜é‡:** é€šè¿‡ä¿®æ”¹`fileDateFormat`å‚æ•°æ¥åˆå§‹åŒ–ã€‚
2.  **ä¿®æ”¹Tomcatæ—¥å¿—é…ç½®:** æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæž„é€ çš„è¯·æ±‚ï¼Œä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºæ ¼å¼è®¾ç½®ä¸ºåŒ…å«å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„JSPä»£ç ã€‚
3.  **å†™å…¥ Webshell:**  é€šè¿‡headerå¤´ä¼ é€’åŒ…å«Runtimeçš„å‚æ•°å’Œå‘½ä»¤æ‰§è¡Œçš„é€»è¾‘ï¼Œé€šè¿‡ä¿®æ”¹è¿‡çš„æ—¥å¿—é…ç½®å†™å…¥webshellåˆ°æœåŠ¡å™¨çš„webappsç›®å½•ä¸‹ã€‚
4.  **å‘½ä»¤æ‰§è¡Œ:** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®å†™å…¥çš„webshellï¼Œä¼ é€’`cmd`å‚æ•°æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
5.  **æ¸…ç†æ—¥å¿—å˜é‡:** æ¸…ç†ä¹‹å‰ä¿®æ”¹çš„æ—¥å¿—å˜é‡ï¼Œé˜²æ­¢æ¶æ„å†™å…¥ã€‚

**æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œå¯ä»¥åˆ¤æ–­è¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ©ç”¨äº†ä¸å®‰å…¨çš„é…ç½®ä¿®æ”¹æ¥å†™å…¥ Webshell.

**æŠ•æ¯’é£Žé™©è¯„ä¼°:** æ­¤ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦10%ã€‚Dockerfileä¸­ä½¿ç”¨lunasec/tomcat-9.0.59-jdk11ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™æœ¬èº«å…·å¤‡ä¸€å®šçš„å®‰å…¨æ€§ï¼Œmavenæž„å»ºæµç¨‹ç›¸å¯¹æ ‡å‡†ï¼Œæ²¡æœ‰å‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç æ³¨å…¥è¡Œä¸ºï¼Œæœ€ä¸»è¦çš„é£Žé™©ç‚¹åœ¨äºŽ`vulnerable-app`ç›®å½•ä¸‹çš„æºä»£ç ï¼Œå¦‚æžœè¯¥ç›®å½•ä¸‹çš„æºä»£ç åŒ…å«æ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å­˜åœ¨æŠ•æ¯’é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“:** è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼æ˜¯å…ˆä¿®æ”¹Tomcatçš„æ—¥å¿—é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºé‡å®šå‘åˆ°Webç›®å½•ï¼Œå¹¶è®¾ç½®æ—¥å¿—å†…å®¹ä¸ºå¯æ‰§è¡Œçš„JSPä»£ç ã€‚ç„¶åŽï¼Œå‘é€åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œä½¿Tomcatå°†JSPä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œä»Žè€Œåœ¨Webç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªwebshellã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [jakabakos/CVE-2022-22965-Spring4Shell](https://github.com/jakabakos/CVE-2022-22965-Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #17

**æ¥æº**: [CVE-2022-22965-jashan-lefty_Spring4Shell.md](../2022/CVE-2022-22965-jashan-lefty_Spring4Shell.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat WAR deployment, Spring MVC or Spring WebFlux application

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œå­˜åœ¨äºŽSpring Frameworkä¸­ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œè¯¥æ¼æ´žåªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯è¢«åˆ©ç”¨ï¼Œå³ï¼š

*   è¿è¡Œåœ¨JDK 9+ä¹‹ä¸Šã€‚
*   ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨Tomcatä¸Šã€‚
*   ä½¿ç”¨äº†Spring MVCæˆ–Spring WebFluxã€‚

**POCæœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„`test.py`è„šæœ¬å°è¯•åˆ©ç”¨æ­¤æ¼æ´žã€‚å®ƒé€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶åˆ°Tomcatçš„webapps/ROOTç›®å½•ä¸‹ï¼Œä»Žè€Œå®žçŽ°RCEã€‚è„šæœ¬å°è¯•è®¾ç½®`pattern`å±žæ€§ï¼ˆç”¨äºŽå®šä¹‰JSPæ–‡ä»¶çš„å†…å®¹ï¼ŒåŒ…å«åŽé—¨ä»£ç ï¼‰ï¼Œ`suffix`å±žæ€§ï¼ˆè®¾ç½®ä¸º.jspï¼‰ï¼Œ`directory`å±žæ€§ï¼ˆè®¾ç½®ä¸ºwebapps/ROOTï¼‰ï¼Œ`prefix`å±žæ€§ï¼ˆè®¾ç½®ä¸ºtomcatwarï¼‰ï¼Œä»¥åŠ`fileDateFormat`å±žæ€§ã€‚

æ ¹æ®æœç´¢å¼•æ“Žç»“æžœï¼Œæ­¤æ¼æ´žåœ¨é‡Žå¤–å·²è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€çš„POCã€‚`test.py`è„šæœ¬ä¸­çš„payloadç»“æž„ä¸Žå…¬å¼€çš„Spring4Shellåˆ©ç”¨æ–¹å¼ç›¸ç¬¦ï¼Œæ‰€ä»¥è¯¥POCä»£ç æœ‰æ•ˆã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

è¯¥ä»“åº“åŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š`README.md`ï¼Œ`fw_handler.py` å’Œ `test.py`ã€‚

*   `README.md` æè¿°äº†å¯¹æ¼æ´žçš„åˆ†æžå’Œé˜²å¾¡æŽªæ–½ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `fw_handler.py` å®žçŽ°äº†ç®€å•çš„é˜²ç«å¢™ï¼Œç”¨äºŽé˜»æ­¢åŒ…å«ç‰¹å®špayloadçš„è¯·æ±‚ï¼Œç”¨äºŽé˜²å¾¡æ”»å‡»ï¼Œæ— æŠ•æ¯’é£Žé™©ã€‚
*   `test.py` åŒ…å«æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œæ—¨åœ¨éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚å®ƒé€šè¿‡å‘é€åŒ…å«ç‰¹å®špayloadçš„POSTè¯·æ±‚ï¼Œå°è¯•åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™å…¥æ¶æ„çš„JSPæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªåŽé—¨ï¼Œå…è®¸é€šè¿‡`pwd`å’Œ`cmd`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ­¤éƒ¨åˆ†**å¹¶éž**æŠ•æ¯’ä»£ç ï¼Œè€Œæ˜¯æ¼æ´žéªŒè¯å’Œåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

è™½ç„¶æ•´ä¸ªä»“åº“çš„ä¸»é¢˜æ˜¯å…³äºŽæ¼æ´žåˆ†æžå’Œé˜²å¾¡ï¼Œä½† `test.py` ä¸­çš„åˆ©ç”¨ä»£ç å¦‚æžœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£Žé™©ã€‚ä½†å°±ä»“åº“æœ¬èº«è€Œè¨€ï¼Œä½œè€…ç›´æŽ¥æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼Œ`fw_handler.py`åè€Œæ˜¯é˜²å¾¡æ‰‹æ®µ, æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ˜¯åˆ©ç”¨æ¼æ´žçš„æ‰‹æ®µï¼Œä¸åº”è¢«è§†ä¸ºæŠ•æ¯’ã€‚æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä¼°è®¡ä¸º10%ã€‚è¿™ä¸ª10%ä¸»è¦è€ƒè™‘çš„æ˜¯ä»“åº“çš„ç»´æŠ¤è€…å¯èƒ½è¢«é»‘å®¢å…¥ä¾µï¼Œç„¶åŽæ¤å…¥æ¶æ„ä»£ç ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  æ”»å‡»è€…å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ç”¨äºŽä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`å±žæ€§çš„payloadã€‚
2.  è¿™äº›å±žæ€§çš„ä¿®æ”¹å…è®¸æ”»å‡»è€…åœ¨Tomcatçš„webapps/ROOTç›®å½•ä¸‹å†™å…¥ä»»æ„JSPæ–‡ä»¶ã€‚
3.  å†™å…¥çš„JSPæ–‡ä»¶åŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ä¸€ä¸ªWebshellï¼‰ã€‚
4.  æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®è¯¥JSPæ–‡ä»¶æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [jashan-lefty/Spring4Shell](https://github.com/jashan-lefty/Spring4Shell)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #18

**æ¥æº**: [CVE-2022-22965-likewhite_CVE-2022-22965.md](../2022/CVE-2022-22965-likewhite_CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat (WAR deployment), Spring MVC or Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´žå­˜åœ¨äºŽè¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶ä¸”éœ€è¦ä»¥WARåŒ…å½¢å¼éƒ¨ç½²åœ¨TomcatæœåŠ¡å™¨ä¸Šã€‚å¦‚æžœåº”ç”¨éƒ¨ç½²ä¸ºSpring Bootå¯æ‰§è¡ŒjaråŒ…ï¼Œåˆ™ä¸æ˜“å—æ­¤æ¼æ´žå½±å“ã€‚æœç´¢ç»“æžœè¯å®žäº†è¯¥æ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æŒ‡å‡ºè¯¥æ¼æ´žæ˜“äºŽåˆ©ç”¨ã€‚æä¾›çš„POCä»£ç å°è¯•åˆ©ç”¨æ•°æ®ç»‘å®šæ¼æ´žï¼Œé€šè¿‡ä¿®æ”¹ Tomcat çš„ AccessLogValve çš„å±žæ€§æ¥å†™å…¥ webshellã€‚è¯¥åˆ©ç”¨ä»£ç çš„æœ‰æ•ˆæ€§å–å†³äºŽç›®æ ‡ç³»ç»Ÿæ˜¯å¦æ»¡è¶³æ¼æ´žåˆ©ç”¨çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ Spring ç‰ˆæœ¬ã€JDK ç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼å’Œ Tomcat é…ç½®ç­‰ã€‚è™½ç„¶`teamserver`å’Œ`readme.md`æ–‡ä»¶çœ‹èµ·æ¥ä¸ç›¸å…³ï¼Œä½†`CVE-2022-22965.py`æ–‡ä»¶æœ¬èº«å¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚`teamserver`æ–‡ä»¶æ˜¯Cobalt Strikeçš„å¯åŠ¨è„šæœ¬ï¼Œä¸Žæ¼æ´žåˆ©ç”¨æ— å…³ã€‚`readme.md`åªæ˜¯æè¿°äº†æ¼æ´žå’Œåˆ©ç”¨æ¡ä»¶ï¼Œå¹¶æ²¡æœ‰åŒ…å«æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ç½‘ç»œèµ„æºå¯èƒ½è¢«ç¯¡æ”¹çš„é£Žé™©ï¼Œä¾ç„¶å­˜åœ¨è½»å¾®çš„æŠ•æ¯’å¯èƒ½ï¼ˆ5%ï¼‰ï¼Œä½†ç›®å‰æ— æ³•ç›´æŽ¥ä»Žä»£ç ä¸­å¾—å‡ºç»“è®ºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **å‘é€æ¶æ„è¯·æ±‚ï¼š** æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ç¨‹åºã€‚
2.  **ä¿®æ”¹AccessLogValveï¼š**  åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼ŒåŠ¨æ€ä¿®æ”¹Tomcatçš„AccessLogValveç»„ä»¶çš„å±žæ€§ï¼Œä¾‹å¦‚`directory`ï¼Œ`prefix`ï¼Œ`suffix`å’Œ`pattern`ã€‚
3.  **å†™å…¥Webshellï¼š** é€šè¿‡ä¿®æ”¹`pattern`å±žæ€§ï¼Œå°†ä¸€æ®µåŒ…å«æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼‰çš„JSPä»£ç å†™å…¥åˆ°æŒ‡å®šçš„ç›®å½•å’Œæ–‡ä»¶åçš„Webshellä¸­ã€‚
4.  **æ‰§è¡ŒWebshellï¼š**  æ”»å‡»è€…è®¿é—®å†™å…¥çš„Webshellï¼Œå¹¶ä¼ é€’å‘½ä»¤å‚æ•°ï¼Œä»Žè€Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [likewhite/CVE-2022-22965](https://github.com/likewhite/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #19

**æ¥æº**: [CVE-2022-22965-osungjinwoo_CVE-2022-22965.md](../2022/CVE-2022-22965-osungjinwoo_CVE-2022-22965.md)

## CVE-2022-22965 - Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„å’Œä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½²ï¼ŒSpring MVC æˆ– Spring WebFlux åº”ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

è¯¥æ¼æ´žæ˜¯ Spring4Shellï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ•°æ®ç»‘å®šï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ï¼Œå†™å…¥æ¶æ„ webshell æ–‡ä»¶åˆ° webapps ç›®å½•ä¸‹ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽç‰¹å®šçš„çŽ¯å¢ƒé…ç½®ï¼ŒåŒ…æ‹¬ JDK 9+ï¼Œéƒ¨ç½²ä¸º WAR åŒ…çš„ Tomcatï¼Œä»¥åŠä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚æä¾›çš„ Python å’Œ Bash è„šæœ¬å‡æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´žã€‚å­˜åœ¨è½»å¾®æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨è„šæœ¬å¯èƒ½åŒ…å«ä¸‹è½½å…¶ä»–æ¶æ„æ–‡ä»¶çš„ä»£ç æˆ–è€…ä¿®æ”¹æœåŠ¡å™¨é…ç½®ç­‰ï¼Œä½†ä¸»è¦åŠŸèƒ½æ˜¯å®žçŽ°RCEï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚

**æœ‰æ•ˆæ€§åˆ†æž:** æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœä»¥åŠæä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´žæ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œå¹¶ä¸”æœ‰ç§¯æžçš„åˆ©ç”¨æ¡ˆä¾‹ã€‚POC ä»£ç å°è¯•ä¿®æ”¹ Tomcat çš„æ—¥å¿—é…ç½®ä»¥å†™å…¥ Webshellï¼Œè¿™æ˜¯ä¸€ç§å·²çŸ¥çš„åˆ©ç”¨æ–¹å¼ï¼Œå› æ­¤æä¾›çš„POCä»£ç **æœ‰æ•ˆ**ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æž:** æŸ¥çœ‹æä¾›çš„è„šæœ¬`spring4shell.py`å’Œ`spring4shell.sh`ï¼Œè„šæœ¬ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žä¸Šä¼ webshellï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„è¡Œä¸ºæ¯”å¦‚åˆ é™¤æ–‡ä»¶ï¼Œåå‘è¿žæŽ¥æ¶æ„æœåŠ¡å™¨ç­‰ã€‚`README.md`ä¸­å¼•ç”¨äº†å¤–éƒ¨é“¾æŽ¥ï¼Œå­˜åœ¨ä¸€å®šçš„è·³è½¬é£Žé™©ï¼Œä½†ä»£ç æœ¬èº«ä¸»è¦æ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæ•…æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œåˆ¤æ–­ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æ¼æ´žåŽŸç†ï¼š**  æ”»å‡»è€…é€šè¿‡æ“çºµ class.module.classLoader.resources.context.parent.pipeline.first çš„å±žæ€§ï¼Œä¿®æ”¹ Tomcat AccessLogValve çš„é…ç½®ï¼Œç‰¹åˆ«æ˜¯ pattern å±žæ€§ã€‚
2.  **æ”»å‡»è¿‡ç¨‹ï¼š**
    *   æž„é€ åŒ…å«æ¶æ„ä»£ç çš„è¯·æ±‚ï¼Œé€šè¿‡ Spring çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶çš„ pattern å±žæ€§ï¼Œå°†æ¶æ„ä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
    *   ç”±äºŽ Tomcat çš„æ—¥å¿—æ–‡ä»¶é€šå¸¸ä½äºŽ webapps ç›®å½•ä¸‹ï¼Œå› æ­¤æ¶æ„ä»£ç å®žé™…ä¸Šè¢«å†™å…¥äº†ä¸€ä¸ª JSP æ–‡ä»¶ï¼ˆwebshellï¼‰ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥ JSP æ–‡ä»¶ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
3.  **POCä»£ç åˆ†æž:**
    *   `spring4shell.py` è„šæœ¬ä½¿ç”¨ `requests` åº“å‘é€ POST è¯·æ±‚ï¼ŒåŒ…å«æž„é€ çš„æ¶æ„æ•°æ®ï¼Œç›®æ ‡ URL æ˜¯å­˜åœ¨æ¼æ´žçš„ Spring åº”ç”¨ã€‚
    *   `spring4shell.sh` è„šæœ¬åŒæ ·å‘é€æž„é€ çš„ HTTP è¯·æ±‚ï¼Œä¿®æ”¹ Tomcat çš„ AccessLogValve ç»„ä»¶å±žæ€§ã€‚
    *   ä¸¤ä¸ªè„šæœ¬éƒ½è®¾ç½®äº†webshellå¯†ç ï¼Œä¸Šä¼ ç›®å½•ï¼Œwebshellæ–‡ä»¶åï¼Œæ”»å‡»æˆåŠŸåŽé€šè¿‡webshell urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚
4.  **å…ˆå†³æ¡ä»¶ï¼š**
    *   ç›®æ ‡åº”ç”¨è¿è¡Œåœ¨ JDK 9+ ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨éƒ¨ç½²ä¸º WAR åŒ…åˆ° Tomcat ä¸Šã€‚
    *   ç›®æ ‡åº”ç”¨ä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬çš„ Spring Frameworkã€‚
    *   éœ€è¦ç›®æ ‡æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®

**é¡¹ç›®åœ°å€:** [osungjinwoo/CVE-2022-22965](https://github.com/osungjinwoo/CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #20

**æ¥æº**: [CVE-2022-22965-salo-404_firewall.md](../2022/CVE-2022-22965-salo-404_firewall.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ï¼Œå¹¶ä¸”éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ã€‚å¦å¤–ï¼ŒæœåŠ¡å™¨éœ€å­˜åœ¨å¯å†™ç›®å½•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡ä¿®æ”¹classLoaderæ¥å†™å…¥æ¶æ„web shell,ä»Žè€Œå¯¼è‡´RCEã€‚ 

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œæ­¤æ¼æ´žæ˜¯çœŸå®žä¸”å¯è¢«åˆ©ç”¨çš„ã€‚æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªé˜²ç«å¢™ï¼Œç”¨äºŽé˜²å¾¡Spring4Shellæ”»å‡»ï¼Œæœ¬èº«ä¸åŒ…å«æ”»å‡»è½½è·ï¼Œä½†æ˜¯èƒ½å¤Ÿæ£€æµ‹åˆ©ç”¨å°è¯•ï¼Œè¿™é—´æŽ¥è¯æ˜Žäº†æ­¤æ¼æ´žçš„å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ªæ¨¡æ‹Ÿé˜²ç«å¢™çš„Pythonè„šæœ¬ï¼ˆfirewall_server.pyï¼‰ã€‚è¯¥è„šæœ¬çš„ç›®çš„æ˜¯æ£€æµ‹å¹¶é˜»æ­¢Spring4Shellæ¼æ´žçš„åˆ©ç”¨ã€‚å®¡æŸ¥è¯¥è„šæœ¬åŽï¼Œå‘çŽ°å®ƒä¸»è¦é€šè¿‡æ£€æŸ¥HTTP POSTæ•°æ®ä¸­çš„æ¶æ„é”®ã€headerã€æœ‰æ•ˆè½½è·ç‰¹å¾æ¥å·¥ä½œã€‚æ²¡æœ‰å‘çŽ°ä»»ä½•è¿¹è±¡è¡¨æ˜Žä½œè€…è¯•å›¾åœ¨ä»£ç ä¸­éšè—ä»»ä½•æ¶æ„åŠŸèƒ½æˆ–åŽé—¨ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œçº¦ä¸º10%ã€‚é£Žé™©ä¸»è¦æ¥è‡ªäºŽå¯¹äºŽæ‹¦æˆªè§„åˆ™çš„ç»•è¿‡å’Œæœªæ¥æ½œåœ¨çš„æ¶æ„ä¿®æ”¹ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´žåŽŸç†ï¼š** è¯¥æ¼æ´žæºäºŽSpringæ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œå®ƒå…è®¸å°†HTTPè¯·æ±‚å‚æ•°è‡ªåŠ¨ç»‘å®šåˆ°Javaå¯¹è±¡çš„å±žæ€§ä¸Šã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚å‚æ•°ï¼Œä¿®æ”¹`classLoader`ç­‰å…³é”®å¯¹è±¡ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   è¿è¡Œåœ¨JDK 9+çš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ã€‚
    *   éƒ¨ç½²åœ¨Tomcatä¸Šä½œä¸ºWARåŒ…ï¼ˆSpring Bootå¯æ‰§è¡Œjaré»˜è®¤éƒ¨ç½²æ–¹å¼ä¸å—å½±å“ï¼‰ã€‚
    *   ç›®æ ‡åº”ç”¨å­˜åœ¨å¯å†™ç›®å½•
3.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„HTTP POSTè¯·æ±‚åˆ°å­˜åœ¨æ¼æ´žçš„ç«¯ç‚¹ã€‚
    *   æ¶æ„å‚æ•°ä¼šä¿®æ”¹Tomcatçš„æ—¥å¿—ç›®å½•ã€URIç¼–ç ç­‰é…ç½®ã€‚
    *   æ”»å‡»è€…ä¸Šä¼ åŒ…å«æ¶æ„ä»£ç çš„JSPæ–‡ä»¶åˆ°ä¿®æ”¹åŽçš„æ—¥å¿—ç›®å½•ï¼Œä»Žè€Œåˆ›å»ºä¸€ä¸ªwebshellã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—®è¯¥webshellæ‰§è¡Œä»»æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [salo-404/firewall](https://github.com/salo-404/firewall)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #21

**æ¥æº**: [CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md](../2022/CVE-2022-22965-shoucheng3_spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ å’Œæ‰€æœ‰æ—§çš„ä»¥åŠä¸æ”¯æŒçš„ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²ï¼Œå—å½±å“çš„ Spring Framework ç‰ˆæœ¬

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯Spring Frameworkä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚å®ƒå…è®¸æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåœ¨è¿è¡Œåœ¨JDK 9+ä¸Šçš„Spring MVCæˆ–Spring WebFluxåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ç‰¹å®šçš„åˆ©ç”¨æ–¹å¼è¦æ±‚åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºTomcatä¸Šçš„WARåŒ…ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼šåˆ©ç”¨ Spring æ¡†æž¶çš„æ•°æ®ç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡æ“çºµç±»åŠ è½½å™¨å’Œè®¿é—®æ—¥å¿—ç­‰å±žæ€§ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°æœåŠ¡å™¨ä¸­ï¼Œæœ€ç»ˆå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„ä»£ç ä¸»è¦æ˜¯è´¡çŒ®è€…è¡Œä¸ºå‡†åˆ™å’Œæäº¤è§„èŒƒï¼Œä¸åŒ…å«åŽé—¨ä»£ç ,å­˜åœ¨è½»å¾®æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œç¯¡æ”¹è´¡çŒ®æŒ‡å—ä»¥åŒ…å«æ¶æ„é“¾æŽ¥ï¼Œä½†ç›´æŽ¥ RCE åˆ©ç”¨çš„å¯èƒ½æ€§ä¸ºä½Žã€‚

**é¡¹ç›®åœ°å€:** [shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE](https://github.com/shoucheng3/spring-projects__spring-framework_CVE-2022-22965_5-2-19-RELEASE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #22

**æ¥æº**: [CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md](../2022/CVE-2022-22965-sohamsharma966_Spring4Shell-CVE-2022-22965.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat ä½œä¸º WAR éƒ¨ç½², ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965 (Spring4Shell) æ˜¯ä¸€ä¸ª Spring Framework ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** åˆ©ç”¨äº† Spring Framework åœ¨ JDK 9+ ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨æ•°æ®ç»‘å®šåŠŸèƒ½æ—¶ï¼Œç”±äºŽç±»åŠ è½½å™¨æœºåˆ¶çš„æ”¹å˜ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹ `class.module.classLoader.resources.context.parent.pipeline.first` çš„å±žæ€§ï¼Œæ¥ä¿®æ”¹ Tomcat çš„ access log valve çš„é…ç½®ï¼Œä»Žè€Œå†™å…¥æ¶æ„ JSP æ–‡ä»¶ã€‚

2.  **åˆ©ç”¨æ¡ä»¶ï¼š**
    *   JDK 9+
    *   å—å½±å“çš„ Spring Framework ç‰ˆæœ¬
    *   Tomcat ä½œä¸º WAR éƒ¨ç½²
    *   ä¾èµ– spring-webmvc å’Œ/æˆ– spring-webflux

3.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   æ”»å‡»è€…å‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
    *   è¿™äº›æ¶æ„å‚æ•°ä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ï¼Œå°† pattern è®¾ç½®ä¸ºåŒ…å«æ¶æ„ä»£ç çš„ JSPã€‚
    *   Tomcat å°†æ¶æ„ä»£ç å†™å…¥åˆ° webapps/ROOT ç›®å½•ä¸‹ï¼Œå½¢æˆä¸€ä¸ª JSP shell æ–‡ä»¶ã€‚
    *   æ”»å‡»è€…é€šè¿‡è®¿é—® JSP shell æ–‡ä»¶æ‰§è¡Œä»»æ„ä»£ç ã€‚

4.  **POC ä»£ç åˆ†æžï¼š** æä¾›çš„ `exploit.py` è„šæœ¬å®žçŽ°äº†ä¸Šè¿°æ”»å‡»æµç¨‹ã€‚
    *   è„šæœ¬æž„é€ äº†åŒ…å«æ¶æ„å‚æ•°çš„ POST è¯·æ±‚ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹ Tomcat çš„ access log valve é…ç½®ã€‚
    *   `headers` å­—å…¸å®šä¹‰äº†è¯·æ±‚å¤´ï¼Œ`data` å˜é‡å®šä¹‰äº† POST è¯·æ±‚çš„æ•°æ®ï¼ŒåŒ…å«äº†ä¿®æ”¹ access log valve çš„ payloadã€‚
    *   è„šæœ¬å‘é€ POST è¯·æ±‚åˆ°ç›®æ ‡ URLï¼Œç„¶åŽå°è¯•è®¿é—®ç”Ÿæˆçš„ JSP shell æ–‡ä»¶ã€‚
    *   å¦‚æžœ JSP shell æ–‡ä»¶æˆåŠŸç”Ÿæˆå¹¶å¯ä»¥è®¿é—®ï¼Œè„šæœ¬ä¼šè¾“å‡º shell çš„ URLã€‚

5.  **æœ‰æ•ˆæ€§ï¼š** æ ¹æ®æ¼æ´žä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´žåœ¨æ»¡è¶³æ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

6.  **æŠ•æ¯’é£Žé™©ï¼š** è¯¥POCä»£ç çš„åŠŸèƒ½æ˜¯åˆ©ç”¨æ¼æ´žåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª JSP shellï¼Œ å…è®¸è¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚è„šæœ¬æœ¬èº«å¹¶æ²¡æœ‰å‘çŽ°ä»»ä½•éšè—çš„ã€è¶…å‡ºæ­¤èŒƒå›´çš„æ¶æ„è¡Œä¸ºï¼Œå³æ²¡æœ‰å‘çŽ°ä»»ä½•æŠ•æ¯’ä»£ç ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º0%ã€‚è¯¥è„šæœ¬çš„åŠŸèƒ½ä¸Žæ¼æ´žåˆ©ç”¨æœ¬èº«ç›¸å…³ï¼Œæ—¨åœ¨éªŒè¯å’Œåˆ©ç”¨æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥æ¶æ„åŽé—¨ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ“çºµTomcatçš„æ—¥å¿—é…ç½®æ¥å†™å…¥æ¶æ„JSPæ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æä¾›çš„POCä»£ç èƒ½å¤Ÿæœ‰æ•ˆåœ°å®žçŽ°è¿™ä¸€æ”»å‡»ï¼Œä¸”æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¿¹è±¡ã€‚

**é¡¹ç›®åœ°å€:** [sohamsharma966/Spring4Shell-CVE-2022-22965](https://github.com/sohamsharma966/Spring4Shell-CVE-2022-22965)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #23

**æ¥æº**: [CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md](../2022/CVE-2022-22965-sunnyvale-it_CVE-2022-22965-PoC.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨æŽ§åˆ¶å—å½±å“çš„æœåŠ¡å™¨

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ ä»¥åŠæ‰€æœ‰æ—§çš„ã€ä¸å—æ”¯æŒçš„ç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨JDK 9+ä¸”éƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡åº”ç”¨å¿…é¡»æ»¡è¶³ï¼šä½¿ç”¨Spring MVCæˆ–Spring WebFluxï¼Œè¿è¡Œåœ¨JDK 9+ï¼Œéƒ¨ç½²ä¸ºWARåŒ…åˆ°TomcatæœåŠ¡å™¨ä¸Š

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žï¼Œé€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´žåŽŸç†ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç›¸å…³çš„å±žæ€§ï¼ˆå¦‚`directory`, `prefix`, `suffix`, `pattern`ç­‰ï¼‰ï¼Œæ¥æŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥ä¸€ä¸ªæ¶æ„JSP webshellã€‚
2.  **åˆ©ç”¨æ­¥éª¤ï¼š**
    *   é¦–å…ˆï¼Œåˆ©ç”¨POSTè¯·æ±‚é‡ç½®`fileDateFormat`å±žæ€§ã€‚
    *   ç„¶åŽï¼Œé€šè¿‡POSTè¯·æ±‚è®¾ç½®Tomcatæ—¥å¿—é…ç½®ï¼ŒåŒ…æ‹¬æ—¥å¿—ç›®å½•ã€æ–‡ä»¶åå‰ç¼€ã€åŽç¼€å’ŒåŒ…å«æ¶æ„ä»£ç çš„æ—¥å¿—æ¨¡å¼ï¼Œè¿™äº›å‚æ•°è¢«ç¼–ç åœ¨URLä¸­ã€‚
    *   å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œè§¦å‘æ—¥å¿—è®°å½•ï¼Œå¹¶å°†æ¶æ„JSP webshellå†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚
    *   webshellåœ°å€ä¸º`http://ç›®æ ‡/å‰ç¼€.jsp?cmd=å‘½ä»¤`ã€‚
3.  **æœ‰æ•ˆæ€§ï¼š** æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œæ ¹æ®READMEçš„è¯´æ˜Žï¼Œå¯ä»¥æˆåŠŸåœ¨æ»¡è¶³æ¼æ´žæ¡ä»¶çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
4.  **æŠ•æ¯’é£Žé™©ï¼š**  è™½ç„¶ä¸»è¦ä»£ç æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œ`exploit-core.py`è„šæœ¬ä¸­ï¼Œæ¶æ„ä»£ç çš„å†™å…¥ç›®æ ‡ï¼ˆJSP webshellï¼‰æ˜¯ç¡¬ç¼–ç çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹è¿™äº›å‚æ•°ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ¤å…¥æ›´éšè”½æˆ–æ›´å…·ç ´åæ€§çš„åŽé—¨ã€‚Dockerfileä¸­çš„lunasec/tomcat-9.0.59-jdk11é•œåƒæ¥æºæœªç»éªŒè¯ï¼Œæœ‰å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä½†æ˜¯æ­¤ä»“åº“çš„é‡ç‚¹åœ¨äºŽspringæ¼æ´žåˆ©ç”¨ã€‚å‡è®¾Dockerfileä¸­çš„åŸºç¡€é•œåƒæ²¡æœ‰é—®é¢˜ï¼ŒæŠ•æ¯’é£Žé™©æ¯”ä¾‹çº¦ä¸º10%ã€‚
5.  **æ€»ç»“ï¼š** æ­¤æ¼æ´žçš„åˆ©ç”¨éœ€è¦ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼ŒåŠ¨æ€åœ°ä¿®æ”¹TomcatæœåŠ¡å™¨çš„æ—¥å¿—é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ç›®æ ‡æœåŠ¡å™¨çš„çŽ¯å¢ƒæœ‰ä¸€å®šè¦æ±‚ï¼Œéœ€è¦ç‰¹å®šçš„Springç‰ˆæœ¬ã€JDKç‰ˆæœ¬å’Œéƒ¨ç½²æ–¹å¼ã€‚POCä»£ç çš„æœ‰æ•ˆæ€§å·²ç»ç¡®è®¤ï¼Œä½†ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [sunnyvale-it/CVE-2022-22965-PoC](https://github.com/sunnyvale-it/CVE-2022-22965-PoC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #24

**æ¥æº**: [CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md](../2022/CVE-2022-22965-viniciuspereiras_CVE-2022-22965-poc.md)

## CVE-2022-22965-Spring4Shell-RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+ï¼ŒTomcatä½œä¸ºWARéƒ¨ç½²

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 1%

## è¯¦æƒ…

CVE-2022-22965ï¼ˆSpring4Shellï¼‰æ˜¯ä¸€ä¸ªå­˜åœ¨äºŽSpring Frameworkä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žåˆ©ç”¨äº†åœ¨JDK 9+çŽ¯å¢ƒä¸‹ï¼ŒSpring MVCæˆ–Spring WebFluxåº”ç”¨çš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„è¯·æ±‚ï¼Œä¿®æ”¹classloaderä¸­çš„å±žæ€§ï¼Œè¿›è€ŒæŽ§åˆ¶Tomcatçš„æ—¥å¿—è®°å½•è¡Œä¸ºï¼Œæœ€ç»ˆå†™å…¥webshellï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢å¼•æ“Žç»“æžœï¼Œè¯¥æ¼æ´žå·²åœ¨é‡Žå¤–è¢«ç§¯æžåˆ©ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨å…¬å¼€å¯ç”¨çš„POCä»£ç ã€‚æä¾›çš„POCä»£ç åˆ©ç”¨äº†ä¿®æ”¹ Tomcat access log pattern çš„æ–¹å¼å†™å…¥ webshellï¼Œä»Žè€Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æ£€æŸ¥æä¾›çš„POCä»£ç åŽï¼Œè™½ç„¶POCåˆ©ç”¨äº†å¸¸è§çš„æ¼æ´žåˆ©ç”¨æ–¹æ³•ï¼ˆå†™å…¥Webshellï¼‰ï¼Œä½†ä»£ç ä¸­åŒ…å«ä¸€ä¸ªå¯†ç éªŒè¯é€»è¾‘ `--password`ã€‚å¦‚æžœæ”»å‡»è€…ä¸æä¾›æ­£ç¡®çš„å¯†ç ï¼Œwebshellå°†æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä»Žè€Œå¢žåŠ äº†é˜²å¾¡çš„éš¾åº¦ï¼Œå­˜åœ¨ä¸€å®šæ¦‚çŽ‡ä¸ºåŽé—¨ï¼Œä½†æ¦‚çŽ‡è¾ƒä½Žã€‚è™½ç„¶webshellçš„å†™å…¥è¡Œä¸ºæœ¬èº«å…·æœ‰ä¸€å®šçš„é£Žé™©ï¼Œä½†æ•´ä½“ä»£ç è¾ƒä¸ºç›´æŽ¥ï¼ŒæŠ•æ¯’å¯èƒ½æ€§è¾ƒä½Žã€‚é£Žé™©é¢„ä¼°ä¸º1%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  æ”»å‡»è€…å‘é€ç²¾å¿ƒæž„é€ çš„HTTPè¯·æ±‚åˆ°ç›®æ ‡Springåº”ç”¨ã€‚
2.  è¯·æ±‚ä¸­åŒ…å«çš„å‚æ•°åˆ©ç”¨Springçš„æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first.pattern` å±žæ€§ï¼Œå°†æ¶æ„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œwebshellï¼‰å†™å…¥Tomcatçš„access log patternã€‚
3.  è®¿é—®ç›®æ ‡åº”ç”¨çš„ç›¸åº”URLï¼Œè§¦å‘webshellæ‰§è¡Œã€‚
4.  æ”»å‡»è€…é€šè¿‡webshellæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå®žçŽ°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

**é¡¹ç›®åœ°å€:** [viniciuspereiras/CVE-2022-22965-poc](https://github.com/viniciuspereiras/CVE-2022-22965-poc)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #25

**æ¥æº**: [CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md](../2022/CVE-2022-22965-xsxtw_SpringFramework_CVE-2022-22965_RCE.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**åˆ©ç”¨æ¡ä»¶:** JDK 9+, Tomcat as WAR deployment, Spring MVCæˆ–Spring WebFlux

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2022-22965ï¼ŒåˆåSpring4Shellï¼Œæ˜¯ä¸€ä¸ªSpring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµclassloaderæ¥å†™å…¥webshellæˆ–è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œéœ€è¦JDK 9+ï¼Œå¹¶ä¸”åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸ºWARåŒ…åœ¨Tomcatä¸Šè¿è¡Œã€‚å¦‚æžœåº”ç”¨ä»¥Spring Boot executable jarï¼ˆé»˜è®¤æ–¹å¼ï¼‰éƒ¨ç½²ï¼Œåˆ™ä¸æ˜“å—åˆ°è¯¥æ¼æ´žå½±å“ã€‚

**æœ‰æ•ˆæ€§åˆ†æžï¼š**
æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚POCåˆ©ç”¨äº†Spring Data Bindingçš„ç‰¹æ€§ï¼Œé€šè¿‡ä¿®æ”¹class.module.classLoader.resources.context.parent.pipeline.firstçš„å€¼ï¼Œä¿®æ”¹äº†Tomcatçš„access log patternï¼Œä»Žè€Œå†™å…¥webshellã€‚é€šè¿‡webshellçš„`Tomcat=S&cmd=`å‚æ•°å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„POCä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚å®ƒç›´æŽ¥åˆ©ç”¨äº†æ¼æ´žæ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•å°è¯•æ¥ä¿®æ”¹æˆ–ç ´åç›®æ ‡ç³»ç»Ÿä¸Šçš„å…¶ä»–æ–‡ä»¶æˆ–ç»„ä»¶ã€‚ä»£ç ç›®çš„æ˜Žç¡®ï¼Œå°±æ˜¯åˆ©ç”¨æ¼æ´žæ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œæ²¡æœ‰å‘çŽ°å…¶ä»–æ¶æ„æ„å›¾çš„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£Žé™©å¯ä»¥è¯„ä¼°ä¸º0%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTP POSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸­åŒ…å«æ¶æ„çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°ç”¨äºŽä¿®æ”¹Tomcatçš„access log patternã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1.  å‘é€åŒ…å«æ¶æ„å‚æ•°çš„POSTè¯·æ±‚ï¼Œä¾‹å¦‚ï¼š
    ```
    class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22S%22.equals(request.getParameter(%22Tomcat%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=Shell&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=
    ```
2.  ä¸Šè¿°è¯·æ±‚ä¼šåœ¨`webapps/ROOT`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`Shell.jsp`çš„webshellã€‚ webshellå†…å®¹æ˜¯è¯»å–`cmd`å‚æ•°å¹¶æ‰§è¡Œã€‚
3.  è®¿é—®webshellï¼Œå¹¶é€šè¿‡`Tomcat=S&cmd=`å‚æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
    ```
    http://target.com/Shell.jsp?Tomcat=S&cmd=whoami
    ```

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªwebshellæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä»Žè€ŒæŽ§åˆ¶æœåŠ¡å™¨ã€‚

**é¡¹ç›®åœ°å€:** [xsxtw/SpringFramework_CVE-2022-22965_RCE](https://github.com/xsxtw/SpringFramework_CVE-2022-22965_RCE)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

## POC #26

**æ¥æº**: [CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md](../2022/CVE-2022-22965-zangcc_CVE-2022-22965-rexbb.md)

## CVE-2022-22965 Spring4Shell RCE

**æ¼æ´žç¼–å·:** CVE-2022-22965

**æ¼æ´žç±»åž‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versionsï¼ŒJDK 9+ï¼ŒTomcat ä½œä¸º WAR éƒ¨ç½²

**åˆ©ç”¨æ¡ä»¶:** Spring MVC æˆ– Spring WebFlux åº”ç”¨ç¨‹åºï¼Œè¿è¡Œåœ¨ JDK 9+ ä¸Šï¼Œéƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šã€‚éœ€è¦ç½‘ç»œå¯è¾¾ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2022-22965ï¼Œåˆå Spring4Shellï¼Œæ˜¯ä¸€ä¸ªSpringæ¡†æž¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´žã€‚è¯¥æ¼æ´žå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡æ•°æ®ç»‘å®šåˆ©ç”¨ä¸å½“çš„è¾“å…¥éªŒè¯ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´žåˆ©ç”¨ä¾èµ–äºŽä»¥ä¸‹æ¡ä»¶ï¼š

*   **å—å½±å“çš„Springç‰ˆæœ¬ï¼š** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions
*   **JDK ç‰ˆæœ¬ï¼š** JDK 9 åŠä»¥ä¸Š
*   **éƒ¨ç½²æ–¹å¼ï¼š** åº”ç”¨å¿…é¡»éƒ¨ç½²ä¸º WAR åŒ…åœ¨ Tomcat ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯ Spring Boot å¯æ‰§è¡Œ JARã€‚
*   **åˆ©ç”¨æ–¹å¼ï¼š**  æ”»å‡»è€…é€šè¿‡æž„é€ æ¶æ„çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨Springçš„æ•°æ®ç»‘å®šåŠŸèƒ½ä¿®æ”¹`class.module.classLoader.resources.context.parent.pipeline.first`ç­‰å±žæ€§ï¼Œä»Žè€Œå†™å…¥æ¶æ„JSP Webshellåˆ°TomcatæœåŠ¡å™¨ï¼Œè¿›è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

**æ¼æ´žåˆ©ç”¨ä»£ç åˆ†æžï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªåŸºäºŽ JavaFx å¼€å‘çš„å›¾å½¢åŒ–å·¥å…· (Rexbb.jar)ã€‚å®ƒç®€åŒ–äº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1.  **å‘é€ Payloadï¼š**  è‡ªåŠ¨æž„é€ å’Œå‘é€åŒ…å«æ¶æ„å‚æ•°çš„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨ Spring çš„æ•°æ®ç»‘å®šæ¼æ´žã€‚
2.  **RCE æ£€æµ‹ï¼š**  åœ¨æˆåŠŸå†™å…¥ Webshell åŽï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†ç»“æžœå›žæ˜¾ã€‚
3.  **å‘½ä»¤æ‰§è¡Œï¼š**  å…è®¸ç”¨æˆ·è¾“å…¥è‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚

è¯¥å·¥å…·é€šè¿‡å›¾å½¢ç•Œé¢å°è£…äº†æ¼æ´žåˆ©ç”¨çš„ç»†èŠ‚ï¼Œé™ä½Žäº†åˆ©ç”¨é—¨æ§›ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCå·¥å…·æœ¬èº«å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚è™½ç„¶ä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨Spring4Shellæ¼æ´žï¼Œä½†ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­åŠ å…¥æ¶æ„é€»è¾‘ï¼Œä¾‹å¦‚ï¼š

*   **åŽé—¨æ¤å…¥ï¼š**  åœ¨ Webshell ä¸­æ·»åŠ é¢å¤–çš„åŽé—¨ï¼Œæ–¹ä¾¿æ”»å‡»è€…é•¿æœŸæŽ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚
*   **ä¿¡æ¯çªƒå–ï¼š**  åœ¨å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ”¶é›†æ•æ„Ÿä¿¡æ¯å¹¶å‘é€åˆ°æ”»å‡»è€…æŽ§åˆ¶çš„æœåŠ¡å™¨ã€‚
*   **æ¶æ„ä¼ æ’­ï¼š**  åˆ©ç”¨æ¼æ´žæ„ŸæŸ“å…¶ä»–ç³»ç»Ÿã€‚

ç”±äºŽæ— æ³•ç›´æŽ¥å®¡æŸ¥ Rexbb.jar çš„æºä»£ç ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„ä¿¡ä»»é£Žé™©ã€‚å»ºè®®åœ¨ä½¿ç”¨æ­¤ç±»å·¥å…·æ—¶ï¼Œä¿æŒè­¦æƒ•ï¼Œåœ¨å®‰å…¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶è¿›è¡Œä»£ç å®¡è®¡ï¼Œä»¥ç¡®ä¿å·¥å…·çš„å®‰å…¨æ€§ã€‚

**æŠ•æ¯’å¯èƒ½æ€§è¯„ä¼°ï¼š**

è™½ç„¶ä¸èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æŠ•æ¯’ä»£ç ï¼Œä½†æ ¹æ®ä»£ç çš„æ€§è´¨ï¼Œä½œè€…å…·å¤‡æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç›¸å¯¹æ¥è¯´ï¼Œä½œè€…è¯¦ç»†è¯´æ˜Žäº†POCä½¿ç”¨æ–¹å¼ä»¥åŠåŽŸç†ï¼Œé™ä½Žäº†æŠ•æ¯’å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [zangcc/CVE-2022-22965-rexbb](https://github.com/zangcc/CVE-2022-22965-rexbb)

**æ¼æ´žè¯¦æƒ…:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)

---

