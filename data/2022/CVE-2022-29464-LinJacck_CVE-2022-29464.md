## CVE-2022-29464 - WSO2 API Manager, Identity Server, Analytics, Micro Integrator RCE (远程代码执行)

**漏洞编号:** CVE-2022-29464

**漏洞类型:** RCE (远程代码执行)

**影响应用:** WSO2 API Manager, Identity Server, Analytics, Micro Integrator

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0; Identity Server 5.2.0 - 5.11.0; Identity Server Analytics 5.4.0 - 5.6.0; Identity Server as Key Manager 5.3.0 - 5.11.0; Enterprise Integrator 6.2.0 - 6.6.0

**利用条件:** 无需身份验证，可直接通过网络访问目标服务器的 /fileupload 端口

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该提供的Python脚本是一个针对CVE-2022-29464的完整漏洞利用工具。CVE-2022-29464源于WSO2产品中文件上传功能的一个严重路径遍历漏洞。分析代码可见，脚本通过构造一个包含路径遍历序列（../../../../repository/deployment/server/webapps/）的文件名字段，将JSP WebShell上传到服务器的Web根目录下。POC脚本逻辑清晰，包含了‘check’探测模块和‘exploit’执行模块。其探测逻辑通过尝试上传一个空的404.jsp文件并检查其返回状态来验证漏洞存在，这是一种非破坏性的高效检测方式。利用逻辑则直接上传一个带有交互式表单的JSP Shell，通过Java Runtime.getRuntime().exec()方法执行系统命令。代码使用了标准的requests库进行HTTP通信，且针对SSL验证做了禁用处理，这在安全渗透测试场景中非常典型。从代码结构来看，脚本具有参数解析功能（argparse），支持批量检测或单个利用，功能完整，实战性极高。该POC能够稳定触发漏洞，主要原因是WSO2的fileupload端点未对上传路径进行严格过滤，导致攻击者可以越权将脚本写入Web服务目录。该脚本无需任何复杂混淆即可执行，是该漏洞研究的典型参考实现。

【利用步骤】1. 攻击者准备攻击载荷，本例中为一段具有命令执行能力的JSP代码。2. 构造一个多部分表单（multipart/form-data）的POST请求。3. 在文件名字段中使用目录遍历字符，将目标路径指向WSO2的webapps目录，如/authenticationendpoint/目录下。4. 发送请求至目标服务器的/fileupload/toolsAny接口。5. 服务器解析请求并将JSP文件写入磁盘。6. 攻击者通过浏览器或自动化脚本访问新上传的JSP路径（例如：http://target/authenticationendpoint/shell.jsp）。7. 此时，攻击者即可通过HTTP请求中的参数（如'update'）在服务器上执行任意系统命令，完全控制目标系统。

【投毒风险分析】在对此POC代码的安全性审查中，未发现明显的恶意投毒行为。代码逻辑完全透明，使用的库如requests、pwn、termcolor、urllib3均为Python社区公认的安全标准库。脚本中的pwn库虽常用于二进制溢出，但在本脚本中仅用于基础的格式化处理或作为渗透测试环境的依赖，未见其执行任何非预期的本地系统调用。脚本的核心功能——上传WebShell——是漏洞利用的预期行为，不应被视为针对研究者本人的投毒。代码中不存在eval()、base64混淆执行或连接到可疑外部C2服务器的闭源二进制段。脚本在处理文件读取时使用了标准的with open语句，没有针对运行环境进行敏感信息窃取（如读取~/.ssh或env变量并上传）。唯一的潜在风险在于研究者如果直接运行该POC去攻击未经授权的目标，可能会产生法律后果。对于防御性研究员而言，该代码是安全的，可以放在隔离沙箱中进行深入分析和指纹提取，但建议在使用前移除或修改硬编码的Shell内容，以符合合规性扫描要求。整体而言，该代码属于高质量、低风险的公开安全研究资源，投毒可能性极低。

**项目地址:** [https://github.com/hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-29464](https://nvd.nist.gov/vuln/detail/cve-2022-29464)
