## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 - 1.9

**利用条件:** 应用程序使用了受影响版本的Apache Commons Text库，并且将未经处理的用户输入传递给StringSubstitutor解析器。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该POC是一个基于Maven和Jetty服务器构建的Web应用程序，名为'Commons-Text Goat'。通过分析提供的pom.xml和README.md，可以确认其准确复现了CVE-2022-42889漏洞环境。项目依赖明确指向了受影响的org.apache.commons:commons-text:1.9版本。代码逻辑上，它创建了一个Servlet接口，将用户通过URL参数'cmd'传入的字符串直接嵌入到'${}'占位符中，并调用StringSubstitutor进行解析。这种设计完美契合了该漏洞的触发机理，即Apache Commons Text在1.10.0版本之前默认启用了包含'script'、'dns'和'url'在内的危险插值器。攻击者可以通过构造如'${script:js:java.lang.Runtime.getRuntime().exec("...")}'的Payload实现任意代码执行。该POC具备高度的可操作性，能够稳定复现漏洞，是极佳的防御性研究样本。利用步骤：1. 环境准备：安装JDK 1.7+及Maven。2. 编译运行：在项目根目录执行'mvn package exec:java'，启动后程序将监听8080端口。3. 构造请求：访问 http://localhost:8080/api?cmd=[Payload]。4. 注入Payload：例如使用script插值器执行系统命令：'script:javascript:java.lang.Runtime.getRuntime().exec("touch /tmp/pwned")'。5. 验证结果：检查目标服务器是否成功执行了指定命令。投毒风险分析：经过对提供的POC文件（README.md和pom.xml）的深度审查，未发现任何恶意投毒迹象。pom.xml中的依赖项均指向标准的公共仓库（Maven Central），如jakarta.servlet、jetty-server和commons-text等，没有引入可疑的第三方库或私有仓库。README中虽然提到了程序监听在0.0.0.0并建议不要在不信任的网络中运行，但这属于正常的安全提醒，目的是防止研究者自己的实验环境被外部攻击。代码库中没有发现混淆代码、Base64编码的隐藏脚本、反弹Shell的恶意逻辑或尝试向外部服务器发送敏感信息的请求。整体代码结构清晰，遵循标准的开源Java项目规范。由于该项目是作为一个'Goat'（故意设计的漏洞靶场）存在，其所有行为均在预期范围内，不存在针对开发者的供应链攻击风险。其唯一可能的危害是由于其本身存在的已知高危漏洞，如果部署在公网环境中会被真实攻击者利用，因此其风险评级极低，仅需注意运行环境的隔离即可。

**项目地址:** [https://github.com/tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)
