## CVE-2022-31814 - pfSense pfBlockerNG 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-31814

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** pfSense pfBlockerNG

**危害等级:** 严重 (CRITICAL)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 2.1.4_26

**利用条件:** 远程网络访问，无需身份验证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞存在于pfSense的pfBlockerNG插件中，主要原因是Web服务在处理HTTP请求头（如Host头）时，未能对Shell元字符进行有效过滤，导致攻击者可以通过精心构造的Payload实现任意系统命令注入。提供的Python脚本是一个功能完整的利用工具。脚本首先通过检测‘/pfblockerng/www/index.php’路径来确认目标是否安装了受影响的组件。其核心逻辑在于利用HTTP Host头的注入点，通过echo命令配合Base64编码将恶意PHP WebShell写入到Web根目录下的‘system_advanced_control.php’文件中。利用步骤包括：1. 确认目标URL或IP；2. 发送带有Base64编码Payload的恶意HTTP请求；3. 脚本会自动验证Shell是否成功上传并执行指定的‘id’等初始命令；4. 提供交互式或单次命令执行界面，并在操作完成后尝试删除上传的临时文件以进行痕迹清理。该POC代码逻辑清晰，依赖项为标准的requests和concurrent.futures库，具有极高的实战化程度。 投毒风险分析：该POC脚本属于低至中等风险级别。通过对代码逻辑的静态分析发现，脚本主要引用了requests、argparse、rich和prompt_toolkit等公开且安全的第三方库，未发现引入混淆后的恶意二进制文件或未知的外部下载请求。关键的Payload部分采用Base64编码，这是安全研究领域中为了规避WAF检测和保证Payload在传输过程中字符完整性的常见做法，经解码验证其内容确实为向服务器写入PHP Shell的操作，并非针对执行者本机的恶意后门。然而，脚本中存在针对外部URL的请求操作（如对目标的检测和Shell写入），在使用时若不谨慎，可能会被目标系统的防御机制记录并上溯至执行者。此外，虽然代码中没有明显的恶意针对执行者的投毒行为，但鉴于此类利用工具通常在非信任渠道流转，建议在隔离的沙箱环境中运行。脚本虽然包含了清理逻辑，但若执行失败可能在目标系统残留WebShell，这在防御性研究中需特别注意，避免造成二次安全灾害。整体代码可读性强，无恶意混淆，投毒风险较低，但在执行大规模扫描（-l 选项）时，需防范该脚本是否会将结果隐蔽地发送至第三方服务器，目前分析未见此类行为。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2022-31814](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2022-31814)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-31814](https://nvd.nist.gov/vuln/detail/CVE-2022-31814)
