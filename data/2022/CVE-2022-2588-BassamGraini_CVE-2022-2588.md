# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **9** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-BassamGraini_CVE-2022-2588.md](../2022/CVE-2022-2588-BassamGraini_CVE-2022-2588.md)

# CVE-2022-2588

> ğŸ“¦ è¯¥CVEæœ‰ **8** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-2588-ASkyeye_2022-LPE-UAF.md](../2022/CVE-2022-2588-ASkyeye_2022-LPE-UAF.md)

## CVE-2022-2588-Linux Kernel Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·å‘½åç©ºé—´æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä¸­çš„ use-after-free æ¼æ´ï¼Œå­˜åœ¨äº cls_route è¿‡æ»¤å™¨å®ç°ä¸­ã€‚å½“è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§çš„è¿‡æ»¤å™¨ï¼Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æœç´¢ç»“æœï¼Œå­˜åœ¨å¤šä¸ªå…³äºæ­¤æ¼æ´çš„æŠ¥å‘Šå’ŒPoCä»£ç ã€‚ç»“åˆæ¼æ´åº“ä¿¡æ¯ï¼Œè¯¥æ¼æ´åœ¨ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ã€‚æä¾›çš„ä»£ç ä»“åº“ [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¡¨æ˜å­˜åœ¨å¯åˆ©ç”¨çš„PoCï¼ŒéªŒè¯äº†è¯¥æ¼æ´çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**

æä¾›çš„ä¸¤ä¸ª C ä»£ç æ–‡ä»¶ `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç›´æ¥å¯¹åº” CVE-2022-2588ã€‚`CVE-2022-2585.c` ä¼¼ä¹åˆ©ç”¨timeræœºåˆ¶è§¦å‘æ¼æ´ï¼Œè€Œ `CVE-2022-2586.c` é€šè¿‡ netfilter (nftables) æ¥è®¾ç½®ä¸€äº›è§„åˆ™å’Œå¯¹è±¡ã€‚è™½ç„¶`CVE-2022-2586.c`åˆ›å»ºäº†è¡¨ã€å¯¹è±¡ã€é›†åˆï¼Œçœ‹èµ·æ¥æœ‰åˆ©ç”¨çš„æ½œåŠ›ï¼Œä½†å¾ˆéš¾æ˜ç¡®åˆ¤æ–­æ˜¯å¦å­˜åœ¨éšè—çš„æŠ•æ¯’ä»£ç ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†ææ‰èƒ½ç¡®å®šæ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚åˆæ­¥åˆ¤æ–­ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 10%ã€‚è¿™é‡Œè®¤ä¸º `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c`çš„å‘½åæœ‰è¯¯ï¼Œåº”æ˜¯ç”¨äºè¾…åŠ©åˆ©ç”¨CVE-2022-2588çš„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¼æ´çš„POCã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®å¥æŸ„ä¸º 0ã€‚
2.  é‡Šæ”¾è¯¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  å†æ¬¡ä½¿ç”¨è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ use-after-freeã€‚
4. `CVE-2022-2586.c` æ„é€  netfilter å¯¹è±¡å’Œ rulesï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åˆ©ç”¨use-after-freeçš„æ—¶å€™ï¼Œæ›´å®¹æ˜“æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼Œæå‡æƒé™ã€‚
5. `CVE-2022-2585.c`åˆ™ä½¿ç”¨äº†ç”¨æˆ·å‘½åç©ºé—´æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨timerè§¦å‘pocï¼Œå¯èƒ½ä¸ºäº†ç»•è¿‡ä¸€äº›ç¼“è§£æªæ–½ï¼Œæˆ–è€…åˆ›é€ å¹¶å‘æ¡ä»¶ã€‚

**é¡¹ç›®åœ°å€:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #2

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #3

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---



---

## POC #3

**æ¥æº**: [CVE-2022-2588-Igr1s-red_CVE-2022-2588.md](../2022/CVE-2022-2588-Igr1s-red_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“å…·æœ‰å¥æŸ„å€¼ 0 çš„æ—§è¿‡æ»¤å™¨ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¹‹å‰è¢«é‡Šæ”¾æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚æ¼æ´åˆ©ç”¨ä»£ç æ˜¾ç¤ºï¼Œé€šè¿‡åˆ›å»ºå¥æŸ„ä¸º0çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ›¿æ¢å®ƒï¼Œå¯ä»¥è§¦å‘ double-freeï¼Œå¦‚æœå¯ç”¨äº† CONFIG_NET_CLS_ACTï¼Œåˆ™ä¼šå¯¼è‡´ route4_filter å¯¹è±¡å’Œ route4_filter->exts.action å¯¹è±¡ä¸Šçš„ double-freeã€‚è¿™ç§double freeå¯èƒ½å¯¼è‡´ææƒã€‚é‰´äºä»£ç æ¥è‡ªå…¬å¼€çš„æ¼æ´æŠ¥å‘Šå’Œåˆ©ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”åªåŒ…å«æ ‡å‡†åˆ©ç”¨ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œä½†ä¹Ÿéœ€è¦äººå·¥å®¡è®¡ã€‚æœç´¢å¼•æ“ç»“æœä¹Ÿå°è¯äº†è¯¥æ¼æ´çš„å­˜åœ¨æ€§å’Œææƒçš„å¯èƒ½æ€§ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼ä¸ºæœ¬åœ°ç”¨æˆ·åˆ©ç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¥æŸ„ä¸º0çš„ cls_route è¿‡æ»¤å™¨ï¼Œç„¶åé€šè¿‡å†æ¬¡åˆ›å»ºåŒå¥æŸ„è¿‡æ»¤å™¨æ¥æ›¿æ¢æ—§è¿‡æ»¤å™¨ï¼Œè§¦å‘ use-after-free æ¼æ´ï¼Œæœ€ç»ˆå¯¼è‡´ double freeã€‚


**é¡¹ç›®åœ°å€:** [Igr1s-red/CVE-2022-2588](https://github.com/Igr1s-red/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #4

**æ¥æº**: [CVE-2022-2588-Markakd_CVE-2022-2588.md](../2022/CVE-2022-2588-Markakd_CVE-2022-2588.md)

## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡å’Œæƒé™æå‡ï¼ˆæ ¹æ®æœç´¢ç»“æœå’ŒCVEæè¿°ï¼‰

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œæœ¬åœ°ç”¨æˆ·æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 2%

## è¯¦æƒ…

CVE-2022-2588æ˜¯Linuxå†…æ ¸cls_routeè¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚å½“filterçš„handleå€¼ä¸º0æ—¶ï¼Œ`route4_change`å‡½æ•°åœ¨é‡Šæ”¾æ—§çš„è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´double freeã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç ï¼ˆ`exp_file_credential.c`ï¼ŒMakefileï¼ŒREADME.mdï¼‰æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚README.mdæ–‡ä»¶è¯¦ç»†æè¿°äº†è¯¥æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚æ ¹æ®æè¿°ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä¾èµ–äºdouble-freeï¼Œå¹¶ä¸”ä¸CVE-2021-3715ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨DirtyCredæŠ€æœ¯ã€‚
ä»ä»£ç ç»“æ„æ¥çœ‹ï¼Œæä¾›äº†ç¼–è¯‘è¯´æ˜(Makefile)ï¼Œå’Œæ¼æ´åŸç†çš„æè¿°(README.md)ï¼Œä»¥åŠåˆ©ç”¨ä»£ç ï¼Œæ•´ä½“è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä»¥åˆ¤æ–­æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œèƒ½å¤ç°æ¼æ´åœºæ™¯ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„Makefileä»…åŒ…å«ç¼–è¯‘æŒ‡ä»¤ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„README.mdä»…åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ï¼Œæ²¡æœ‰å‘ç°æ¶æ„ä»£ç ã€‚
æä¾›çš„exp_file_credential.c æ²¡æœ‰åœ¨æ­¤æ¬¡åˆ†æèŒƒå›´å†….
åŸºäºä»¥ä¸Šåˆ†æï¼Œè®¤ä¸ºè¯¥ä»“åº“å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚**æŠ•æ¯’é£é™©è¯„ä¼°ä¸º2%**ï¼Œä¸»è¦è€ƒè™‘åˆ°ä»»ä½•æ¥æºçš„ä»£ç éƒ½å­˜åœ¨ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡æ‰èƒ½å®Œå…¨æ’é™¤ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **åˆ›å»ºhandleä¸º0çš„filter:**  é¦–å…ˆï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªcls_route filterï¼Œå…¶handleå€¼ä¸º0ã€‚
2.  **æ›¿æ¢filter:**  ç„¶åï¼Œæ”»å‡»è€…è§¦å‘è¯¥filterçš„æ›¿æ¢æ“ä½œï¼Œè¿™å°†å¯¼è‡´æ—§çš„filterè¢«é‡Šæ”¾ï¼Œä½†ç”±äºhandleä¸º0ï¼Œå®ƒæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
3.  **Double-Free:** å†æ¬¡é‡Šæ”¾ç›¸åŒçš„filterï¼Œä»è€Œè§¦å‘double-freeæ¼æ´ï¼Œå¦‚æœ`CONFIG_NET_CLS_ACT` å¯ç”¨ï¼Œåˆ™è§¦å‘`route4_filter->exts.action`å¯¹è±¡ä¸Šçš„double free.
4.  **åˆ©ç”¨Double-Free:** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨double-freeæ¼æ´æ¥ç ´åå†…æ ¸å†…å­˜ï¼Œä»è€Œå®ç°æƒé™æå‡æˆ–å…¶ä»–æ¶æ„ç›®çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ©ç”¨DirtyCredæŠ€æœ¯è¦†ç›–task_structçš„credç»“æ„ä½“ï¼‰ã€‚

æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´ç¡®å®å­˜åœ¨å¹¶ä¸”å¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œæƒé™æå‡ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ã€‚

**é¡¹ç›®åœ°å€:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #5

**æ¥æº**: [CVE-2022-2588-dom4570_CVE-2022-2588.md](../2022/CVE-2022-2588-dom4570_CVE-2022-2588.md)

## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å± (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦User Namespacesæ”¯æŒï¼Œä½æƒé™æœ¬åœ°ç”¨æˆ·ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“handleå€¼ä¸º0æ—¶ï¼Œ`route4_change` å‡½æ•°åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œå¯¼è‡´å¯ä»¥å†æ¬¡è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„README.mdï¼Œè¯¥æ¼æ´åœ¨ Linux v3.17 ä¸­å¼•å…¥ï¼Œå¹¶åœ¨ v5.19 ä¸­ä¿®å¤ã€‚è§¦å‘æ¼æ´éœ€è¦ User Namespacesã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  åˆ›å»ºä¸€ä¸ª cls_route è¿‡æ»¤å™¨ï¼Œå…¶ handle å€¼ä¸º 0ã€‚
2.  æ›¿æ¢è¯¥è¿‡æ»¤å™¨ã€‚
3.  ç”±äºhandleå€¼ä¸º0ï¼Œæ—§çš„è¿‡æ»¤å™¨ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šè¢«é‡Šæ”¾ã€‚
4.  å†æ¬¡å°è¯•è®¿é—®è¯¥è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ Use-After-Freeã€‚
5.  è¿›ä¸€æ­¥åˆ©ç”¨ double-free æ¼æ´å¯ä»¥å®ç°æƒé™æå‡ï¼ˆDirtyCredç±»ä¼¼æ€è·¯ï¼‰ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:**

æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯ã€æœç´¢å¼•æ“ç»“æœä»¥åŠæ¼æ´åˆ©ç”¨ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥æ¼æ´çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºï¼ˆåŒ…æ‹¬NVDã€RedHatã€nsfocusglobalç­‰ï¼‰éƒ½ç¡®è®¤äº†è¯¥æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç›¸å…³æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„README.mdæ–‡ä»¶ä¹Ÿè¯¦ç»†è§£é‡Šäº†æ¼æ´çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:**

åˆ†ææä¾›çš„ä»£ç ï¼ŒMakefileæ–‡ä»¶åªåŒ…å«ç¼–è¯‘é€‰é¡¹ï¼ŒREADME.mdæ–‡ä»¶åŒ…å«æ¼æ´æè¿°å’Œåˆ©ç”¨è¯´æ˜ã€‚å”¯ä¸€éœ€è¦å…³æ³¨çš„æ–‡ä»¶æ˜¯exp_file_credential.cï¼ˆæœªæä¾›ï¼‰ã€‚è€ƒè™‘åˆ°ä»“åº“çš„ç›®çš„æ˜¯å¤ç°æ¼æ´ï¼Œä½œè€…å°†æ¶æ„ä»£ç éšè—åœ¨exp_file_credential.cä¸­çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼ˆæ¯”å¦‚é€šè¿‡æŸç§æ–¹æ³•åœ¨exp_file_credential.cé‡Œæ”¾ç½®åé—¨ä»£ç ï¼‰ã€‚ç»“åˆæ²¡æœ‰å®Œå…¨å®¡æŸ¥exp_file_credential.cæ–‡ä»¶ä»¥åŠæ¼æ´å¤ç°çš„æ€§è´¨ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚åœ¨å®é™…ä½¿ç”¨å‰ï¼ŒåŠ¡å¿…å¯¹`exp_file_credential.c`è¿›è¡Œä»£ç å®¡è®¡ã€‚

**æ’åºä¼˜å…ˆçº§è§£é‡Š:**

*   **æœç´¢å¼•æ“ç»“æœ > æ¼æ´åˆ©ç”¨ä»£ç  > æ¼æ´åº“ä¿¡æ¯:**  æœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„å¹¿æ³›å½±å“å’Œä¿®å¤æƒ…å†µï¼Œå› æ­¤ä¼˜å…ˆçº§æœ€é«˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç ç›´æ¥å±•ç¤ºäº†æ¼æ´çš„åˆ©ç”¨æ–¹å¼å’ŒPOCï¼Œå› æ­¤ä¼˜å…ˆçº§é«˜äºæ¼æ´åº“ä¿¡æ¯ã€‚æ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„åŸºæœ¬ä¿¡æ¯ï¼Œä½†ç¼ºä¹å®é™…çš„åˆ©ç”¨ç»†èŠ‚ã€‚

**é¡¹ç›®åœ°å€:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #6

**æ¥æº**: [CVE-2022-2588-konoha279_2022-LPE-UAF.md](../2022/CVE-2022-2588-konoha279_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æœ¬åœ°æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œæ—§çš„è¿‡æ»¤å™¨åœ¨è¢«é‡Šæ”¾å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´UAFã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„ PoC æ˜¯å¯ç”¨çš„ã€‚å‚è€ƒé“¾æ¥ï¼š[https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) è¯´æ˜æ­¤æ¼æ´å­˜åœ¨å¯åˆ©ç”¨æ€§ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°:** æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª C æ–‡ä»¶ï¼šCVE-2022-2585.c å’Œ CVE-2022-2586.cã€‚ CVE-2022-2585.c åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶åœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œ "./poc" (poc1)ã€‚CVE-2022-2586.c ä¸»è¦é’ˆå¯¹ netfilter æ¨¡å—ï¼Œåˆ›å»ºè¡¨ï¼Œå¯¹è±¡å’Œé›†åˆã€‚
ä»£ç åˆ†æè¡¨æ˜ï¼ŒCVE-2022-2586.c åˆ©ç”¨äº† `NFT_SET_OBJECT` æ ‡å¿—ï¼Œè¿™å…è®¸é›†åˆåŒ…å«å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡åœ¨åˆ é™¤è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ è¿™ç§å¼•ç”¨å¯ä»¥å¯¼è‡´ Use-After-Freeï¼Œå› ä¸ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ä»ç„¶è¢«é›†åˆå¼•ç”¨çš„æƒ…å†µä¸‹è¢«é‡Šæ”¾ã€‚
æä¾›çš„ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯åˆæ³•çš„æ¼æ´åˆ©ç”¨å°è¯•ï¼Œæ—¨åœ¨è§¦å‘ Use-After-Free æ¼æ´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯,å¦‚æœå­˜åœ¨`./poc`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç . è¿™é‡Œå‡è®¾ä¸å­˜åœ¨.

**åˆ©ç”¨æ–¹å¼åˆ†æ:**

1.  **æ¼æ´è§¦å‘:** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ netfilter è¡¨å’Œå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾ç½®ä¸­ä½¿ç”¨å¯¹è±¡å¼•ç”¨ã€‚
2.  **UAF åˆ©ç”¨:** é€šè¿‡åœ¨å¯¹è±¡è¢«åˆ é™¤åä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯ä»¥è§¦å‘ Use-After-Freeã€‚
3.  **æƒé™æå‡ (å¯èƒ½æ€§):**  è™½ç„¶ CVSS è¯„åˆ†æ˜¾ç¤ºå®Œæ•´æ€§å½±å“è¾ƒä½ï¼Œä½†æœç´¢ç»“æœè¡¨æ˜è¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚è¿™æ˜¯é€šè¿‡ UAF æ¼æ´çš„ç»å…¸åˆ©ç”¨æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¦†ç›–å†…æ ¸æ•°æ®ç»“æ„ä»¥è·å¾—ç‰¹æƒã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒPOC ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”é£é™©åœ¨äºåˆ©ç”¨ UAF æ¼æ´æ¥å®ç°æƒé™æå‡ã€‚ç”±äºæœªåœ¨æä¾›çš„PoCä»£ç ä¸­å‘ç°æ˜æ˜¾æ¶æ„ä»£ç ï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½, å› æ­¤è¯„åˆ¤ä¸º 0%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æä»»ä½•ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶(`poc`).

**é¡¹ç›®åœ°å€:** [konoha279/2022-LPE-UAF](https://github.com/konoha279/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #7

**æ¥æº**: [CVE-2022-2588-nopgadget_CVE-2022-2588.md](../2022/CVE-2022-2588-nopgadget_CVE-2022-2588.md)

## CVE-2022-2588 - Linux kernel cls_route UAF

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ CAP_NET_ADMIN æƒé™ï¼Œå¯èƒ½éœ€è¦ User Namespaces

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å®ç°ä¸­çš„ä¸€ä¸ªé‡Šæ”¾åä½¿ç”¨ï¼ˆUse-After-Freeï¼‰æ¼æ´ã€‚å½“ cls_route è¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œå†…æ ¸åœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ã€‚\n\n**æœ‰æ•ˆæ€§ï¼š**\n
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœï¼Œè¯¥æ¼æ´å­˜åœ¨ä¸”å½±å“ Linux kernel 6.0 rc1 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å·²å­˜åœ¨å…¬å¼€çš„PoCä»£ç ï¼Œgithubä¸Šä¹Ÿæœ‰è¯¥æ¼æ´çš„exp,è¯´æ˜è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚\n\n**æŠ•æ¯’é£é™©ï¼š**\n
æä¾›çš„PoCä»£ç ä»“åº“ä¸»è¦åŒ…å«ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œç”¨äºæè¿°æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨æ¡ä»¶ã€‚ä»ç›®å‰æä¾›çš„å†…å®¹æ¥çœ‹ï¼Œç›´æ¥çš„æŠ•æ¯’ä»£ç å¯èƒ½æ€§è¾ƒä½ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æ’é™¤ä»¥ä¸‹æƒ…å†µï¼š\n\n*   **éšè”½çš„åˆ©ç”¨æ–¹å¼ï¼š** PoC ä»£ç å¯èƒ½è®¾è®¡ä¸ºéœ€è¦ç‰¹å®šé…ç½®æˆ–ç¯å¢ƒæ‰èƒ½è§¦å‘ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚\n*   **ä¾èµ–é¡¹é£é™©ï¼š** PoC ä»£ç å¯èƒ½ä¾èµ–äºå…¶ä»–æœªçŸ¥çš„åº“æˆ–ç»„ä»¶ï¼Œè¿™äº›ä¾èµ–é¡¹å¯èƒ½åŒ…å«æ¶æ„ä»£ç ã€‚\n\nç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©è¾ƒä½ï¼Œä¼°è®¡ä¸º 5%ã€‚éœ€è¦è¿›ä¸€æ­¥åˆ†æå®Œæ•´çš„ PoC ä»£ç æ‰èƒ½è¿›è¡Œæ›´å‡†ç¡®çš„åˆ¤æ–­ã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n
1.  **è§¦å‘æ¼æ´ï¼š** é€šè¿‡åˆ›å»ºå’Œåˆ é™¤ cls_route è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨å¥æŸ„ä¸º 0 çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚\n2.  **æ§åˆ¶é‡Šæ”¾åçš„å†…å­˜ï¼š** åˆ©ç”¨å †å–·å°„ç­‰æŠ€æœ¯ï¼Œæ§åˆ¶è¢«é‡Šæ”¾å†…å­˜çš„å†…å®¹ï¼Œä½¿å…¶æŒ‡å‘æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„åœ°å€ã€‚\n3.  **æƒé™æå‡ï¼š** é€šè¿‡ä¿®æ”¹å†…æ ¸æ•°æ®ç»“æ„ï¼Œå°†å½“å‰ç”¨æˆ·çš„æƒé™æå‡ä¸º root æƒé™ã€‚\n\næ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å…è®¸æœ¬åœ°ç”¨æˆ·å´©æºƒç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚åˆ©ç”¨éœ€è¦ CAP_NET_ADMIN æƒé™ã€‚ç¼“è§£æªæ–½åŒ…æ‹¬ç¦ç”¨ cls_route æˆ–ä½¿ç”¨ modprobe è¿›è¡Œé…ç½®ã€‚

**é¡¹ç›®åœ°å€:** [nopgadget/CVE-2022-2588](https://github.com/nopgadget/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #8

**æ¥æº**: [CVE-2022-2588-pirenga_2022-LPE-UAF.md](../2022/CVE-2022-2588-pirenga_2022-LPE-UAF.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’Œ User Namespaces æ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux kernel ä¸­ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª use-after-free æ¼æ´ã€‚å½“è¿‡æ»¤å™¨å¥æŸ„å€¼ä¸º 0 æ—¶ï¼Œåœ¨é‡Šæ”¾æ—§è¿‡æ»¤å™¨ä¹‹å‰ï¼Œä¸ä¼šå°†å…¶ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚æ ¹æ®æœç´¢ç»“æœï¼Œè¯¥æ¼æ´å¯èƒ½å¯¼è‡´æœ¬åœ°ç”¨æˆ·æƒé™æå‡ã€‚åˆ©ç”¨ä»£ç ä¸­åŒ…å« `CVE-2022-2585.c` å’Œ `CVE-2022-2586.c` ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰ç›´æ¥ç»™å‡º CVE-2022-2588 çš„åˆ©ç”¨ä»£ç ã€‚ç”±äºCVE-2022-2585å’ŒCVE-2022-2586çš„åˆ©ç”¨æ€è·¯ä¸CVE-2022-2588ä¸€è‡´ï¼Œå¯ä»¥æ¨æµ‹è¯¥POCæœ‰æ•ˆã€‚`CVE-2022-2585.c` åˆ©ç”¨å®šæ—¶å™¨åˆ›å»ºå­è¿›ç¨‹å¹¶æ‰§è¡Œ poc ç¨‹åºï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶æˆ–èµ„æºè€—å°½ã€‚`CVE-2022-2586.c` åˆ›å»º netfilter è¡¨ã€å¯¹è±¡å’Œé›†åˆï¼Œå¹¶å°è¯•åœ¨åˆ é™¤è¡¨åé€šè¿‡é›†åˆå¼•ç”¨å¯¹è±¡ï¼Œè§¦å‘ use-after-free æ¼æ´ã€‚æ²¡æœ‰å‘ç°ç›´æ¥çš„åé—¨æˆ–æ¶æ„è¡Œä¸ºï¼Œå› æ­¤æŠ•æ¯’é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿½ç•¥ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ¶‰åŠç½‘ç»œåç§°ç©ºé—´å’Œ netfilter çš„é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ç½‘ç»œæµé‡å’Œè¿‡æ»¤å™¨è§„åˆ™æ¥è§¦å‘æ¼æ´ã€‚

**é¡¹ç›®åœ°å€:** [pirenga/2022-LPE-UAF](https://github.com/pirenga/2022-LPE-UAF)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

## POC #9

**æ¥æº**: [CVE-2022-2588-veritas501_CVE-2022-2588.md](../2022/CVE-2022-2588-veritas501_CVE-2022-2588.md)

## CVE-2022-2588

**æ¼æ´ç¼–å·:** CVE-2022-2588

**æ¼æ´ç±»å‹:** Use-After-Free

**å½±å“åº”ç”¨:** Linux Kernel

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡æˆ–æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** < 6.0~rc1

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™å’ŒUser Namespacesæ”¯æŒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-2588 æ˜¯ Linux å†…æ ¸ cls_route è¿‡æ»¤å™¨å®ç°ä¸­çš„ä¸€ä¸ª Use-After-Free æ¼æ´ã€‚å¦‚æœè¿‡æ»¤å™¨çš„å¥æŸ„å€¼ä¸º 0ï¼Œåˆ™åœ¨é‡Šæ”¾ä¹‹å‰ä¸ä¼šä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æ—§è¿‡æ»¤å™¨ã€‚ 

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¼æ´è§¦å‘ï¼š** è¯¥æ¼æ´æ˜¯ç”± `cls_route` è¿‡æ»¤å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¥æŸ„ä¸º0ï¼‰é‡Šæ”¾åæ²¡æœ‰ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å¯¼è‡´çš„ã€‚
2.  **åˆ©ç”¨æ¡ä»¶ï¼š** æ¼æ´åˆ©ç”¨éœ€è¦æœ¬åœ°ç”¨æˆ·æƒé™ï¼Œå¹¶ä¸”éœ€è¦å¯ç”¨User Namespacesã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   åˆ†é…ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å¯¹è±¡ã€‚
    *   é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä½†ç”±äºæ¼æ´ï¼Œè¯¥å¯¹è±¡å¹¶æœªä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚
    *   åŒé‡é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œå¯¼è‡´Use-After-Freeã€‚
    *   é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ–‡ä»¶å–·å°„ï¼‰åœ¨é‡Šæ”¾çš„å†…å­˜ä½ç½®åˆ†é…æ–°çš„å¯¹è±¡ï¼Œå®ç°å†…å­˜é‡ç”¨ã€‚
    *   åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦çš„é‡å ï¼Œé€šè¿‡æ…¢é€Ÿå†™å…¥è¦†ç›–/etc/passwd æ–‡ä»¶ï¼Œå®ç°ææƒã€‚
4.  **POC ä»£ç åˆ†æï¼š**
    *   `exp.c` åŒ…å«åˆ©ç”¨è¯¥æ¼æ´çš„å®Œæ•´expä»£ç ã€‚è¯¥ä»£ç é¦–å…ˆä¼šé€šè¿‡å†…å­˜ç¢ç‰‡æ•´ç†æ¥ç¡®ä¿å†…å­˜å¸ƒå±€ã€‚ç„¶ååˆ†é…å¹¶é‡Šæ”¾å­˜åœ¨æ¼æ´çš„å¯¹è±¡ï¼Œè§¦å‘UAFï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶å–·å°„å æ®é‡Šæ”¾çš„å†…å­˜ã€‚
    *   `Makefile` ç”¨äºç¼–è¯‘exp.cæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿˜åŒ…æ‹¬å¯åŠ¨QEMUçš„å‘½ä»¤ã€‚
    *   `boot.sh` æ˜¯ç”¨äºå¯åŠ¨ QEMU è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œé…ç½®äº†å†…æ ¸ã€initrdã€å†…å­˜ç­‰å‚æ•°ã€‚
5.  **æŠ•æ¯’é£é™©åˆ†æï¼š**
    *   ä»£ç ä¸­ä½¿ç”¨äº†`attack_data`è¦†ç›–`/etc/passwd`ï¼Œä¿®æ”¹åå¯èƒ½ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨å‡½æ•°ã€‚
    *  POC åˆ©ç”¨çš„åŸç†å’Œè¿‡ç¨‹ç›¸å¯¹æ¸…æ™°ï¼Œä¸»è¦é›†ä¸­åœ¨æ¼æ´åˆ©ç”¨æœ¬èº«ã€‚
    *   `#define ATTACK_FILE "/etc/passwd"`è¡¨æ˜ç›®æ ‡æ˜¯`/etc/passwd`, å…·æœ‰ä¸€å®šçš„ç ´åæ€§, æ›´æ”¹`/etc/passwd`å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜, å°†æ¯”ä¾‹ä¸Šè°ƒåˆ°10%.

**æœ‰æ•ˆæ€§ï¼š** æ ¹æ®POCä»£ç å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç ç›¸å¯¹æœ‰æ•ˆï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®ç°æœ¬åœ°æƒé™æå‡ã€‚

ç»¼ä¸Šï¼Œè¯¥æ¼æ´åˆ©ç”¨æ–¹å¼ç›¸å¯¹æ¸…æ™°ï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ã€‚

**é¡¹ç›®åœ°å€:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)

---

