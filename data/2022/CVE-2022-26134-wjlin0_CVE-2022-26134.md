## CVE-2022-26134 - Atlassian Confluence Server and Data Center OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** All versions before the fixed versions

**利用条件:** 无需认证，网络可达

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2022-26134是一个存在于Atlassian Confluence Server和Data Center产品中的OGNL注入漏洞。攻击者可以利用此漏洞在目标系统上执行任意代码。该漏洞的触发点在于Confluence处理OGNL表达式的方式，未经授权的攻击者可以通过构造恶意的OGNL表达式，借助网络请求发送给Confluence服务器，进而执行任意命令。经验证，提供的POC代码有效。该POC使用Go语言编写，通过发送包含恶意OGNL表达式的HTTP GET请求到目标Confluence服务器。该表达式尝试通过java.lang.Runtime类执行系统命令"whoami"，并将结果设置到HTTP响应头 "X-Cmd-Response"中。如果目标服务器存在漏洞，则会返回状态码302，并且响应头中包含whoami命令的执行结果。利用步骤如下：
1. 准备：确保目标Confluence服务器已启动并运行。
2. 执行：运行POC脚本，并指定目标Confluence服务器的URL作为参数。
3. 验证：检查响应头中是否包含"X-Cmd-Response"字段，以及其对应的值是否为执行"whoami"命令后的结果。此外还可以通过list参数指定批量URL进行检测。
投毒风险分析：该POC代码使用标准Go语言库，功能相对独立，未发现明显的恶意行为或外部脚本调用。但是，POC脚本包含执行系统命令的功能，存在一定的风险。例如，攻击者可能修改POC代码，将"whoami"命令替换为更具破坏性的命令，如删除文件、创建后门或下载恶意软件。此外，POC代码中使用的OGNL表达式本身也可能被用于执行恶意操作。因此，在使用POC代码时，务必保持警惕，并采取必要的安全措施，例如：
1. 仔细审查POC代码，确保其不包含任何恶意行为。
2. 在受控环境中运行POC代码，避免对生产系统造成影响。
3. 限制POC代码的执行权限，防止其执行敏感操作。
4. 定期扫描系统，检查是否存在恶意软件或后门。

该POC的投毒风险较低，因为代码本身比较清晰，主要依赖于标准库，且直接执行系统命令的结果通过HTTP头返回，虽然存在潜在的恶意利用可能，但整体风险可控，判定投毒风险为15%。

**项目地址:** https://github.com/topics/cve-2022-26134

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2022-26134
