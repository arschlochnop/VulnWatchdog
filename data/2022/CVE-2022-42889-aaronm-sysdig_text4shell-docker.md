## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor API 进行插值处理。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】本POC（Text4Shell）针对 Apache Commons Text 库中的变量插值漏洞进行了高度还原。该漏洞源于 StringSubstitutor 类默认使用的插值器集合过于宽泛，包含了 script、dns 和 url 等具有危险能力的查找器。分析所提供的 Dockerfile 和 README 发现，该 POC 构建了一个基于 Java 8 和 Maven 的典型脆弱环境。Dockerfile-vuln 明确使用了 openjdk:8-jre-alpine 作为基础镜像，这与漏洞利用所需的 Java 环境契合。POC 核心通过构造特定的 payload 字符串（如 ${script:javascript:...}）并将其作为 URL 参数传递。在后台，当程序调用 StringSubstitutor.replace() 方法处理该参数时，会触发 Nashorn 脚本引擎执行 JavaScript 代码，进而通过 java.lang.Runtime 接口实现任意系统命令执行。该 POC 流程闭环，从构建脚本、环境配置到具体的攻击 URL 路径均清晰可见，能有效复现 touch /tmp/foo 的命令执行效果，是一个极高质量且有效的漏洞验证程序。利用步骤如下：1. 使用 Maven 构建项目生成包含脆弱依赖的 Fat JAR；2. 通过 Docker 构建镜像并启动容器，将 8080 端口映射至宿主机；3. 访问特定的攻击端点并携带 URL 编码后的 Payload；4. 容器内检查 /tmp 目录下是否生成指定文件以确认漏洞利用成功。【投毒风险分析】经过对提供的 POC 代码（Dockerfile、README、项目结构）的详细安全审计，其投毒风险极低，约为 5%。首先，Dockerfile 采用了标准的 Maven 和 Alpine 官方镜像，未发现通过 curl 或 wget 从非官方地址下载二进制文件的恶意行为。Dockerfile-patched 甚至展示了防御性加固逻辑（升级 musl 和 libcrypto 库并使用非 root 用户），这符合防御性研究的特征。README 中的利用指令均指向 localhost，未见恶意重定向或通过 nslookup/curl 将本地敏感数据外传至 OAST 平台的隐蔽指令。Payload 部分使用的 'touch /tmp/foo' 是典型的良性验证命令，不具备破坏性。唯一需要注意的风险点在于 pom-vuln.xml 或 pom-patched.xml 可能引用的第三方 Maven 仓库，但在常规防御研究场景下，这种依赖下载行为属于标准构建过程。代码中不存在混淆逻辑、反射调用恶意字节码或隐藏的系统后门，整体表现为一个纯粹的、用于教育和防御测试的开源安全示例。

**项目地址:** [https://github.com/karthikuj/cve-2022-42889-text4shell-poc](https://www.google.com/search?q=https://github.com/karthikuj/cve-2022-42889-text4shell-poc)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
