## CVE-2022-26134 - Confluence Server and Data Center RCE

**漏洞编号:** CVE-2022-26134

**漏洞类型:** RCE

**影响应用:** Confluence Server and Data Center

**危害等级:** Critical severity unauthenticated remote code execution vulnerability

**CVSS评分:** None

**影响版本:** All supported versions of Confluence Server and Data Center are affected. Confluence Server and Data Center versions after 1.3.0 are affected.

**利用条件:** Unauthenticated, requires network access

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2022-26134是Confluence Server和Data Center中的一个严重漏洞，允许未经身份验证的远程代码执行。根据提供的POC代码分析，该漏洞利用了OGNL表达式注入，攻击者可以通过构造恶意的HTTP请求，在目标服务器上执行任意命令。该POC首先定义了几个函数：check_target_version用于检查目标Confluence服务器的版本，通过访问/login.action页面并解析HTML响应中的版本信息来实现；send_payload函数用于发送包含恶意OGNL表达式的HTTP请求，该表达式利用了`org.apache.commons.io.IOUtils`类和`java.lang.Runtime`类来执行命令并将结果设置在HTTP响应头中。主函数main接收目标URL和要执行的命令作为参数，然后调用check_target_version来验证目标，如果成功，则调用send_payload来执行命令并将结果打印到控制台。

利用步骤如下：
1. 使用POC脚本，指定目标Confluence服务器的URL和要执行的命令。
2. 脚本首先检查目标服务器的版本。
3. 脚本构造包含恶意OGNL表达式的HTTP GET请求，并将命令注入其中。
4. 脚本发送构造的HTTP请求到目标服务器。
5. 如果目标服务器存在漏洞，则会执行注入的命令，并将结果设置在HTTP响应头中。
6. 脚本提取HTTP响应头中的结果并打印到控制台。

该POC的有效性较高，可以成功地在存在漏洞的Confluence服务器上执行任意命令，验证了该漏洞的严重性。由于POC代码使用标准库（requests, bs4）并且没有发现任何可疑行为，因此投毒风险较低。但由于该漏洞允许远程代码执行，攻击者可能通过该漏洞上传恶意文件、植入后门或执行其他恶意操作，因此在使用该POC时，务必确保在授权环境下进行，并采取必要的安全措施。

关于投毒风险分析：
此POC代码的投毒风险较低，为10%。代码主要由requests库执行HTTP请求，urllib3关闭SSL警告，使用beautifulsoup4解析HTML页面。漏洞利用本身通过构造特定格式的URL参数实现，不涉及复杂或危险的操作。唯一需要注意的是，执行任意命令具有潜在风险，但在授权渗透测试场景下是可接受的。代码中没有发现任何混淆、恶意连接、或执行外部脚本的行为。命令执行的结果通过HTTP头返回，减少了与文件系统或其他潜在危险操作的交互。

**项目地址:** https://github.com/nxtexploit/CVE-2022-26134

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2022-26134
