## CVE-2022-42889 - Apache Commons Text RCE (远程代码执行)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5.0 至 1.9.0

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor 类的 replace() 或 lookup() 方法。目标环境通常需要支持特定插值器（如 script, dns, url）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】 该项目名为 text4shellburpscanner，是一个专门针对 CVE-2022-42889（又称 Text4Shell）漏洞编写的 Burp Suite 扫描插件。分析提供的 POC 代码及 README 文档，其核心逻辑是通过修改 log4j2burpscanner 框架来实现。该漏洞的根源在于 Apache Commons Text 的 StringSubstitutor 类默认使用的插值器集合包含了一些具有危险功能的处理器，如 'script'（使用 Nashorn 引擎执行 JavaScript）、'dns' 和 'url'。POC 项目中明确提供了配套的 Docker 靶场地址 (karthikuj/cve-2022-42889-text4shell-docker) 以及具体的验证路径 '/text4shell/attack?search=111'。通过在 search 参数中注入特定的插值表达式（如 ${script:javascript:java.lang.Runtime.getRuntime().exec('id')}），攻击者可以直接在服务器上执行系统命令。该 POC 的有效性极高，因为它将扫描逻辑集成到了 Burp Suite 这一主流渗透测试工具中，实现了对 HTTP 请求参数的自动化监测，能够有效识别处理流程中存在的文本替换漏洞。 【利用步骤】 1. 编译环境准备：使用 Maven 对提供的 Java 项目进行构建，生成带有依赖的 JAR 包。 2. 插件安装：将生成的 JAR 文件加载到 Burp Suite 的 Extender 模块中。 3. 靶场部署：使用提供的 Docker 命令 'docker run -p 85:8080 text4shell' 启动包含漏洞的 Web 应用。 4. 漏洞探测：通过浏览器或 Burp Repeater 访问目标地址，在 URL 参数或 POST 数据中尝试注入测试 payload。 5. 结果验证：插件会自动捕获并识别响应，若目标存在漏洞，插件页面会显示漏洞告警信息，并可通过反弹 shell 或 DNSlog 确认命令执行结果。 【投毒风险分析】 该 POC 项目的投毒风险评级为低（10%）。代码库结构清晰，主要基于成熟的开源扫描插件框架进行二次开发。主要的风险点在于 README 中引导用户关注公众号获取“编译好的靶场”或“扫描器”，这种引导外部下载的行为可能存在供应链投毒风险，即预编译的二进制文件可能被植入后门。然而，针对当前提供的源码部分（pom.xml 和插件逻辑说明），并未发现明显的恶意混淆代码、非法外连或窃取敏感信息的逻辑。代码主要依赖标准的 Burp Extender API 和 Maven 插件，未引入可疑的第三方闭源 SDK。防御者在使用时，应优先选择自行审计源码并手动编译 JAR 包，避免直接运行来源不明的二进制程序。整体而言，该代码是一个合法的安全研究和防御性扫描工具，其逻辑符合安全研究人员的预期行为。

**项目地址:** [https://github.com/f0ng/text4shellburpscanner](https://www.google.com/search?q=https://github.com/f0ng/text4shellburpscanner)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)
