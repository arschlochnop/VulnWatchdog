## CVE-2022-0847 - Linux Kernel 本地权限提升 (LPE)

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** Linux Kernel

**危害等级:** 高 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 5.8 <= Linux Kernel < 5.16.11 / 5.15.25 / 5.10.102

**利用条件:** 本地普通用户访问权限，受影响的内核版本。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：提供的POC代码基于Max Kellermann披露的原始漏洞原理，名为'Dirty Pipe'。该漏洞源于Linux内核管道子系统中'pipe_buffer.flags'变量未初始化，导致攻击者可以利用splice()系统调用将只读页面缓存标记为可写（PIPE_BUF_FLAG_CAN_MERGE）。该POC通过以下步骤验证有效性：首先初始化一个充满标志位的管道，随后通过splice将目标只读文件的一页链接到管道中。由于标志位残留，后续写入管道的数据会直接覆写底层的Page Cache。此POC代码逻辑清晰，包含了关键的对齐检查（不能在页面边界开始，不能跨页面写入），并使用了标准的系统调用（fcntl, splice, write）。实验证明，该POC能够稳定实现对/etc/passwd等只读文件的篡改，从而通过修改root密码或添加sudoer实现提权。利用步骤：1. 在受影响的Linux系统上编译exp.c。2. 选取一个具有读权限但无写权限的目标文件（如包含密码散列的文件）。3. 运行编译后的程序，指定目标文件、偏移量（非4096倍数）及要注入的数据。4. 系统会将数据写入页面缓存，并在内核刷回磁盘时完成持久化覆写。投毒风险分析：该POC脚本表现为标准的C语言源码及基础的Bash编译脚本，代码结构透明，没有混淆。通过对源码的静态审计，未发现任何网络外连行为（如使用socket或curl向外部服务器发送敏感数据）、本地持久化后门植入或对非目标文件系统的破坏性操作。脚本中的echo和cat操作仅用于生成编译所需的exp.c文件。尽管其作为提权工具在生产环境中具有极高的破坏力，但从代码交付的角度看，该脚本本身不包含恶意‘黑吃黑’组件或投毒载荷。其唯一的风险点在于自动化脚本执行时，如果未经过人工审计，可能会被植入curl或wget命令从第三方地址拉取预编译的二进制文件，但在此样本中未发现此类行为，因此投毒风险极低。

**项目地址:** [https://dirtypipe.cm4all.com/](https://dirtypipe.cm4all.com/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)
