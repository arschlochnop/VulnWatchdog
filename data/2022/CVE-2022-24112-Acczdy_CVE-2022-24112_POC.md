# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **10** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md](../2022/CVE-2022-24112-Acczdy_CVE-2022-24112_POC.md)

# CVE-2022-24112

> 📦 该CVE有 **9** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #2

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---



---

## POC #2

**来源**: [CVE-2022-24112-CrackerCat_CVE-2022-24112.md](../2022/CVE-2022-24112-CrackerCat_CVE-2022-24112.md)

## CVE-2022-24112 - Apache APISIX Batch Requests RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, >= 1.3

**利用条件:** 需要开启 batch-requests 插件，且使用默认 API key 或未限制 Admin API 访问 IP。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以通过构造特殊的请求，绕过 Admin API 的 IP 限制，然后通过 Admin API 创建恶意的路由，在路由的 filter_func 中执行任意 Lua 代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 batch-requests 插件的漏洞，通过 X-REAL-IP 头欺骗 APISIX，绕过 Admin API 的 IP 访问控制。
2.  攻击者向 /apisix/batch-requests 发送包含恶意配置的请求，该请求会创建或修改路由，并在 filter_func 字段中注入恶意 Lua 代码。
3.  当有流量匹配到该恶意路由时，filter_func 中的 Lua 代码会被执行，从而实现远程代码执行。
4.  POC 代码首先构造一个包含恶意配置的 JSON 数据，该数据经过 Base64 编码后通过 /apisix/batch-requests 接口发送给 APISIX 服务器。恶意配置会在 APISIX 中创建一个路由，并将 `filter_func` 设置为执行命令的 Lua 代码。exp.py中将curl命令结果发送到dnslog服务器。然后，POC 代码向该路由发送一个 GET 请求，触发 filter_func 的执行，从而实现远程代码执行。

**投毒风险分析：**

该 POC 主要利用已知的漏洞进行 RCE，直接执行命令。但其中存在一定的投毒风险，
1.  **潜在的恶意命令修改：** POC中的命令`curl localhost.xxx.dnslog.cn`，虽然目前是用来验证漏洞的存在，但如果被替换成其他恶意命令，例如删除文件、下载恶意软件等，则会直接对目标系统造成危害。不过这个风险较低，因为使用者可以检查和修改命令。

因此，综合评估投毒风险较低，约 5%。主要集中在使用者未仔细审查POC代码可能存在的恶意行为。


**项目地址:** [CrackerCat/CVE-2022-24112](https://github.com/CrackerCat/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #3

**来源**: [CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md](../2022/CVE-2022-24112-M4xSec_Apache-APISIX-CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要启用batch-requests插件，并且使用默认API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认 API 密钥配置，则可能导致远程代码执行。

**有效性分析：**
提供的 POC 代码利用了 batch-requests 插件的缺陷，通过构造包含恶意 Lua 代码的请求，可以在服务器端执行任意命令。搜索引擎结果也表明该漏洞被广泛关注并存在公开可用的利用代码，因此该 POC 代码有效。

**投毒风险分析：**
POC 代码中存在一定的投毒风险，主要体现在以下几个方面：
1.  **X-API-KEY:**  POC使用了默认的`edd1c9f034335f136f87ad84b625c8f1`。如果目标已经修改了默认密钥，该POC将无法直接使用。虽然不是直接的投毒，但这种硬编码的默认值，可能会导致攻击者在未充分了解环境的情况下进行攻击，从而暴露自身。
2.  **硬编码的 Payload:**  `filter_func` 字段中包含了反弹 shell 的 Lua 代码。这段代码会被直接注入到 APISIX 的配置中。虽然这个反弹shell是攻击者期望的行为，但是也可能被用于植入其他恶意代码或者后门程序。例如, 如果攻击者修改了`os.execute`中的命令，可能会对目标系统造成进一步的危害。
3.  **目标依赖：**该利用代码依赖于目标APISIX使用默认配置，包括API Key等。如果目标修改了默认配置，攻击者直接运行此POC可能导致利用失败，甚至可能触发报警。
总体来说，该 POC 存在一定的投毒风险，但主要集中在利用的便捷性和潜在的二次利用可能性上。该风险评估为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要向 `/apisix/batch-requests` 端点发送 POST 请求，该请求的 body 包含一个 JSON 对象，其中 `pipeline` 数组定义了一系列需要执行的请求。
2.  **IP 限制绕过：** 在 `pipeline` 中，攻击者设置了 `X-Real-IP` 头，试图绕过 Admin API 的 IP 限制。由于 batch-requests 插件的缺陷，这个头会被错误地信任，从而允许攻击者从任意 IP 地址访问 Admin API。
3.  **远程代码执行：** 在 `pipeline` 中，攻击者创建或更新一个 route (路由)，并在 route 的 `filter_func` 字段中插入恶意的 Lua 代码。这段 Lua 代码使用 `os.execute` 函数执行 shell 命令，从而实现远程代码执行。POC中使用反弹shell，将目标机器的shell反弹到攻击者的监听端口。
4.  **触发Payload:** 访问payload中指定的uri，触发payload。

**项目地址:** [M4xSec/Apache-APISIX-CVE-2022-24112](https://github.com/M4xSec/Apache-APISIX-CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #4

**来源**: [CVE-2022-24112-Mah1ndra_CVE-2022-24112.md](../2022/CVE-2022-24112-Mah1ndra_CVE-2022-24112.md)

## CVE-2022-24112: Apache APISIX 远程代码执行漏洞

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Apache APISIX 2.12.1之前版本，Apache APISIX 2.10.4之前版本，Apache APISIX 1.3及更早版本

**利用条件:** 默认配置的Apache APISIX（带有默认API密钥）且batch-requests插件已启用。更改了admin key或admin api端口到与数据面板不同的端口，风险会降低。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞是 Apache APISIX 中的一个远程代码执行漏洞。攻击者可以利用 batch-requests 插件绕过 Admin API 的 IP 限制，从而执行恶意代码。

**漏洞利用方式：**

1.  **利用 batch-requests 插件绕过 IP 限制：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP header，从而绕过 Admin API 的 IP 访问限制。
2.  **使用默认 API 密钥：** 如果 Apache APISIX 使用默认的 API 密钥，攻击者可以直接使用该密钥访问 Admin API。
3.  **注册恶意路由：** 攻击者可以构造包含恶意 Lua 脚本的路由，并将其注册到 Apache APISIX 中。该 Lua 脚本可以执行任意命令。

**POC 分析：**

提供的 POC 代码 `apisix-exploit.go` 实现了以下步骤：

1.  **生成请求体：** `genReqBody` 函数生成包含恶意 Lua 脚本的请求体。该 Lua 脚本使用 `io.open` 函数读取指定文件（由 `-c` 参数指定，代表要执行的命令）的内容，并通过 `ngx.say` 函数输出到响应中。
2.  **注册路由：** `registerRoute` 函数使用 batch-requests 插件将恶意路由注册到 Apache APISIX 中。它通过 POST 请求发送构造的请求体到 `/apisix/batch-requests` 接口。
3.  **竞争条件（Race Condition）：** `race` 函数通过循环调用 `registerRoute` 函数，尝试注册路由。如果返回的 ContentLength 大于 500，则认为路由注册成功。这是为了应对某些情况下的注册失败，增加利用的成功率。
4.  **执行命令：** `invokeRoute` 函数调用已注册的路由，从而执行恶意 Lua 脚本。它通过 GET 请求访问之前通过 `-p` 参数指定的路径。

**投毒风险分析：**

该 POC 代码的主要功能是利用漏洞执行命令。仔细检查代码，没有发现明显的投毒行为。代码逻辑清晰，目的是为了利用漏洞进行远程命令执行。 因此，投毒风险为 0%。该工具只是为了验证漏洞，利用成功后可以通过`-c`执行恶意指令。务必在授权情况下使用。


**项目地址:** [Mah1ndra/CVE-2022-24112](https://github.com/Mah1ndra/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #5

**来源**: [CVE-2022-24112-Mr-xn_CVE-2022-24112.md](../2022/CVE-2022-24112-Mr-xn_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** APISIX默认配置，batch-requests插件启用，默认API密钥未更改，管理API端口为默认端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而通过Admin API执行恶意操作，最终可导致远程代码执行。漏洞利用需要以下条件：

1.  **batch-requests 插件已启用**： 这是利用此漏洞的前提条件。
2.  **默认 API 密钥未更改**： 如果管理员已更改默认API密钥，则漏洞利用难度会增加，但仍可能绕过数据面板的IP限制。
3.  **管理 API 端口为默认端口**： 如果管理API端口被更改为非数据面板端口，则漏洞利用的影响会降低。

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/apisix/batch-requests`端点。
2.  在请求体中，攻击者通过`X-Real-IP` header 伪造客户端IP地址，绕过Admin API的IP访问限制。
3.  攻击者构造一个PUT请求，通过Admin API创建一个新的路由，该路由包含恶意的`filter_func`。
4.  `filter_func` 使用 `os.execute` 函数执行任意命令，实现远程代码执行。
5.  攻击者发送GET请求触发路由，执行`filter_func`，导致RCE。

**关于投毒风险：**

提供的yaml文件包含LICENSE声明，为Apache License 2.0，较为正式，代码内容主要为漏洞验证代码，大概率是为了验证漏洞的存在或自动化利用。但仍不能完全排除作者出于某种目的，添加一些隐蔽的、不易被察觉的恶意代码，例如，修改执行的shell命令，添加反弹shell等，导致利用此POC的用户受到攻击，所以此处投毒风险给到1%。

**总结：**

此漏洞利用有效性高，风险极高，利用条件较为苛刻，需要默认配置。 POC代码通过构造特殊请求实现RCE，需要注意潜在的投毒风险。

**项目地址:** [Mr-xn/CVE-2022-24112](https://github.com/Mr-xn/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #6

**来源**: [CVE-2022-24112-SecNN_CVE-2022-24112.md](../2022/CVE-2022-24112-SecNN_CVE-2022-24112.md)

## CVE-2022-24112 Apache APISIX RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 默认配置，batch-requests插件启用，admin key为默认值或已知，或存在绕过IP限制的可能性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以利用该插件绕过Admin API的IP限制。如果使用了默认的API密钥，则可以直接利用RCE。即使更改了API密钥，仍然可能绕过数据面板的IP限制。利用方式是：

1.  攻击者构造包含恶意命令的payload。
2.  该payload被编码为base64字符串。
3.  攻击者发送一个POST请求到`/apisix/batch-requests`端点，其中包含base64编码的payload，并覆盖`X-REAL-IP`头以绕过IP限制。
4.  服务器解码payload并执行其中的恶意命令，例如创建一个新的路由，该路由的`filter_func`会执行任意代码。
5.  攻击者访问新创建的路由，触发恶意代码执行。

**投毒风险分析：**

该POC代码主要功能是利用漏洞执行命令。潜在的投毒风险可能存在于以下几个方面：

1.  **恶意命令注入：**  `cmd = input("Cmd:")` 允许用户输入命令，如果用户不小心执行了恶意命令，可能会对目标系统造成损害。然而，这并非作者主动投毒。
2.  **后门植入：** POC代码中，RCE后创建的路由具有`filter_func`，可能被修改为植入持久性后门。
3.  **依赖项风险：** 虽然代码本身只使用了requests和base64这两个标准库，但如果README.md中推荐的安装步骤包含安装其他的第三方库，则这些库可能存在恶意代码。

综合来看，作者主动投毒的概率较低，但使用者需要注意命令注入风险，以及RCE后被植入后门的风险。因此，评估的投毒风险为10%，主要来自于使用者在不理解代码的情况下，直接将poc应用在生产环境中，可能引入恶意命令，或RCE之后被恶意人员植入后门。

**项目地址:** [SecNN/CVE-2022-24112](https://github.com/SecNN/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #7

**来源**: [CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md](../2022/CVE-2022-24112-btar1gan_exploit_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #8

**来源**: [CVE-2022-24112-fatkz_CVE-2022-24112.md](../2022/CVE-2022-24112-fatkz_CVE-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #9

**来源**: [CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md](../2022/CVE-2022-24112-kavishkagihan_CVE-2022-24112-POC.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

## POC #10

**来源**: [CVE-2022-24112-twseptian_cve-2022-24112.md](../2022/CVE-2022-24112-twseptian_cve-2022-24112.md)

## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 需要开启batch-requests插件，默认API Key或者未修改的管理API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中，攻击者可以通过构造特殊的请求，绕过Admin API的IP限制，如果使用默认API Key，则可以直接利用Admin API执行任意命令。POC代码提供了两种利用方式：poc.py和poc2.py，都可以实现远程代码执行并获取反弹shell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码中，两个脚本（poc.py和poc2.py）都提供了RCE的利用方式，并有成功获取反弹shell的示例。因此，提供的POC代码是有效的。

**投毒风险：**

代码仓库包含Dockerfile，docker-compose.yml等文件，相对完整，模拟复现步骤，更容易让使用者运行，存在一定风险，考虑到代码仓库中的poc.py和poc2.py主要功能为漏洞利用，本身不包含恶意功能，投毒风险较低。

*   **README.md**: 描述了如何使用Docker Compose搭建存在漏洞的APISIX环境，以及如何使用提供的POC脚本进行漏洞利用，属于正常的漏洞利用说明文档。
*   **poc.py & poc2.py**: 这两个脚本是漏洞利用的核心，用于发送恶意请求并执行命令。从代码分析来看，主要功能是构造payload，利用漏洞获取shell，没有发现额外恶意代码，但使用者通过修改命令，可以植入后门。  

综合分析，仓库存在微小投毒风险的可能性，主要是使用者可能会被引导执行恶意命令。所以判定投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 首先需要搭建一个存在漏洞的Apache APISIX环境，版本低于2.12.1，且开启了batch-requests插件。可以使用提供的docker-compose.yml快速搭建。
2.  **漏洞触发：** 利用batch-requests插件的缺陷，通过构造包含`X-REAL-IP` header的恶意请求，绕过Admin API的IP限制。
3.  **代码执行：** 绕过IP限制后，如果Admin API使用了默认的API Key，或者攻击者已知有效的API Key，就可以通过Admin API创建路由或执行其他管理操作，从而执行任意命令。
4.  **反弹Shell：** POC代码中通常会利用命令执行功能反弹一个shell到攻击者的机器上，从而获取对服务器的控制权。

**总结：**

CVE-2022-24112是一个高危漏洞，利用门槛较低，且存在公开的POC代码。攻击者可以利用该漏洞绕过IP限制，执行任意命令，从而完全控制服务器。建议受影响的用户尽快升级到安全版本，或者禁用batch-requests插件。

**项目地址:** [twseptian/cve-2022-24112](https://github.com/twseptian/cve-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)

---

