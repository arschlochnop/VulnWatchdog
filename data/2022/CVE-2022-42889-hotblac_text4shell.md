## CVE-2022-42889 - Apache Commons Text 远程代码执行 (RCE)

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 1.5 至 1.9

**利用条件:** 应用程序使用了受影响版本的 Apache Commons Text 库，并且将未经处理的用户输入传递给 StringSubstitutor 类进行插值处理（Interpolation）。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：本POC是一个基于Spring Boot构建的演示应用程序，通过Maven依赖显式引入了受影响的 apache:commons-text:1.9 版本。该代码展示了典型的 Text4Shell 漏洞场景。核心漏洞点在于 Apache Commons Text 的 StringSubstitutor 类在进行变量插值时，默认启用了 script、dns 和 url 等不安全的查找器（Lookups）。当应用程序调用 StringSubstitutor.replace() 处理恶意构造的字符串（如使用 script:javascript:prefix 格式）时，会触发远程代码执行。从提供的源码看，pom.xml 配置正确，README 文档指向了详细的技术博客，代码结构完整，可直接编译运行以复现漏洞环境，具有很高的实战防御参考价值。利用步骤：1. 启动该 Spring Boot 应用。2. 构造包含恶意插值字符串的 HTTP 请求，例如访问特定的 URL 参数。3. 注入类似 ${script:javascript:java.lang.Runtime.getRuntime().exec('calc')} 的 payload。4. 服务器端的 StringSubstitutor 会解析该字符串并执行 Java 代码。投毒风险分析：该 POC 项目代码清晰透明，属于标准的防御性安全研究示例。pom.xml 依赖均来自官方仓库，无混淆代码或可疑的外部请求脚本。src/main/resources 中的 application.properties 虽然包含明文凭据，但显式标注为 demo 使用，不属于恶意投毒。README.md 提供的链接指向了知名的安全技术博客 dontpanicblog.co.uk，而非恶意网站。整体代码逻辑遵循标准的 Spring Boot 开发规范，未发现任何后门植入、环境变量窃取或恶意二进制文件下载行为。由于其目的是用于教学和漏洞演示，代码中虽包含危险的依赖版本，但均带有警告注释。因此，该仓库被判定为低投毒风险，可安全用于内部安全培训和防御性检测规则的制定。

**项目地址:** [https://github.com/alexis-m-p/text4shell](https://www.google.com/search?q=https://github.com/alexis-m-p/text4shell) (推测自项目路径与内容)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/cve-2022-42889](https://nvd.nist.gov/vuln/detail/cve-2022-42889)
