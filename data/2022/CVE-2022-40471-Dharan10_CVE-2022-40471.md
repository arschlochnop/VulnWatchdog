## CVE-2022-40471 - Clinic's Patient Management System (CPMS) RCE (远程代码执行)

**漏洞编号:** CVE-2022-40471

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Clinic's Patient Management System (CPMS)

**危害等级:** 高危 (High)

**CVSS评分:** 8.8

**影响版本:** 未知具体补丁版本，通常指2022年之前的版本

**利用条件:** 需要有效的用户认证凭据（用户名和密码）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 5%

## 详情

POC有效性分析：该POC代码针对Clinic's Patient Management System (CPMS)中的文件上传漏洞进行了高度结构化的实现。代码通过Python的requests库模拟了完整的攻击路径：首先利用`/index.php`（或默认登录页）进行表单认证，获取有效的Session会话；随后，利用认证后的权限向`users.php`发送POST请求。关键漏洞点在于系统未对`profile_picture`参数上传的文件扩展名进行严格校验。POC构造了一个包含PHP一句话木马（`system($_GET['cmd'])`）的恶意文件`shell.php`，并将其MIME类型设置为`application/octet-stream`以绕过前端检测。分析显示，该POC逻辑严密，包含异常处理和结果验证，能够准确返回Webshell的预期存储路径（通常在`user_images/`目录下）。利用步骤：1. 攻击者准备有效的CPMS系统登录账号。2. 执行脚本，提供目标主机、端口、基础路径及凭据。3. 脚本自动化完成登录并获取Cookie。4. 脚本访问`users.php`上传名为`shell.php`的恶意文件。5. 攻击者通过访问生成的URL并附带`cmd`参数来执行系统命令。投毒风险分析：经过对提供的Python源代码进行深入静态审计，未发现任何混淆代码、外部非法请求（Out-of-band）或恶意的本地文件操作。脚本仅引用了标准的`requests`、`sys`和`urllib3`库，所有网络流量均指向用户定义的`target`地址。脚本中存在的敏感操作（如上传PHP木马）属于合法的渗透测试概念验证行为，并非针对研究员主机的后门投毒。代码注释清晰，包含作者署名（Dharan Ragunathan），且没有使用`eval()`、`base64.decode`等常见的隐藏恶意载荷手段。唯一的潜在风险在于用户在使用此类POC时，若未在受控环境中运行，可能会因目标系统的不可控导致自身IP暴露。综合评估，该POC属于高质量、低风险的防御性研究工具。

**项目地址:** [https://github.com/DharanRagunathan/CVE-2022-40471](https://www.google.com/search?q=https://github.com/DharanRagunathan/CVE-2022-40471)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-40471](https://nvd.nist.gov/vuln/detail/CVE-2022-40471)
