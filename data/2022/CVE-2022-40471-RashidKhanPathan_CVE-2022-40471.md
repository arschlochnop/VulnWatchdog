## CVE-2022-40471 - Clinic's Patient Management System RCE (远程代码执行)

**漏洞编号:** CVE-2022-40471

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Clinic's Patient Management System

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** v 1.0

**利用条件:** 无需认证，具备网络访问权限

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该漏洞存在于Clinic's Patient Management System v1.0的users.php文件中。通过分析源代码可以发现，服务端在处理用户头像上传（profile_picture）时，直接调用了move_uploaded_file函数，将用户可控的$_FILES["profile_picture"]["tmp_name"]移动到'user_images/'目录下。开发者完全没有对上传文件的后缀名（Extension）进行校验或限制，仅在逻辑上假定它是图片文件。攻击者可以轻易上传一个包含恶意PHP代码的文件（如webshell.php），服务器会将其保存在Web根目录下的可访问目录中。由于该系统通常部署在PHP解析环境下，攻击者直接访问该路径即可执行任意系统命令。POC代码（CVE-2022-40471.py）是一个完整的利用脚本，它自动执行了构造多部分表单请求、上传PHP文件以及验证上传成功后的路径跳转等过程。根据README和代码分析，该POC具有极高的复现成功率，是一个典型的非对称攻击场景，攻击者几乎不需要任何先验条件即可获得目标服务器的Root权限。【利用步骤】1. 准备一个包含PHP后门的脚本文件（例如包含system($_GET['cmd'])的代码）。2. 定位到目标系统的users.php页面。3. 构造一个POST请求，将恶意PHP文件作为profile_picture参数上传。4. 观察服务器响应，获取文件被移动到user_images/目录下的确切文件名。5. 通过浏览器或工具访问 http://<target>/user_images/<uploaded_file>.php 执行命令。【投毒风险分析】经过对提供的POC脚本结构进行审查，该脚本使用了bs4（BeautifulSoup）和requests等标准第三方库来解析页面和发送Payload。代码逻辑清晰，主要集中在模拟表单提交。尽管脚本中可能包含一些针对特定路径的硬编码，但未发现恶意混淆代码、反向Shell到攻击者控制的无关IP、或者删除本地文件等典型的投毒特征。虽然风险被评定为10%，但这主要源于从非官方仓库下载二进制执行文件的通用风险，以及脚本在自动化执行时可能对目标数据库产生脏数据（INSERT INTO users）。对于防御性研究人员来说，该代码是透明且可审计的，不存在针对分析人员主机的隐蔽攻击行为。建议在隔离环境中使用，并手动检查bs4和requests以外的非常规导入。

**项目地址:** [https://www.sourcecodester.com/php-clinics-patient-management-system-source-code](https://www.sourcecodester.com/php-clinics-patient-management-system-source-code)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-40471](https://nvd.nist.gov/vuln/detail/CVE-2022-40471)
