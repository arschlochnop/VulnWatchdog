# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

# CVE-2022-22536

> ğŸ“¦ è¯¥CVEæœ‰ **4** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md](../2022/CVE-2022-22536-BecodoExploit-mrCAT_SAPGateBreaker-Exploit.md)

## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æƒé™ç»•è¿‡ã€ç¼“å­˜æŠ•æ¯’ã€ä¿¡æ¯æ³„éœ²ã€å®Œå…¨æ§åˆ¶ç³»ç»Ÿ

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 åŠå—å½±å“çš„ SAP Web Dispatcher å’Œ SAP Content Server ç‰ˆæœ¬

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦èƒ½å¤Ÿè®¿é—®å—å½±å“çš„ SAP NetWeaver ç»„ä»¶çš„ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver ä¸­ä¸€ä¸ªä¸¥é‡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œåœ¨å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´é€ æˆè¯·æ±‚è§£æå·®å¼‚ï¼Œä»è€Œå°†æ¶æ„è¯·æ±‚â€œèµ°ç§â€åˆ°åç«¯ã€‚\n\n**æœ‰æ•ˆæ€§åˆ†æï¼š** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆSAPGateBreaker-Exploitï¼‰ï¼Œè¯¥æ¼æ´åˆ©ç”¨å°è¯•åˆ©ç”¨ Content-Length å¤´éƒ¨è¿›è¡Œè¯·æ±‚èµ°ç§ã€‚æ¼æ´åˆ©ç”¨ä»£ç çš„æè¿°æåˆ°ï¼Œä¼ ç»Ÿçš„ chunked ç¼–ç æ–¹å¼å¯èƒ½è¢« SAP ICM æ‹’ç»ï¼Œå› æ­¤è¯¥ PoC è½¬å‘ä½¿ç”¨ Content-Length è¿›è¡Œ desynchronizationã€‚ç”±äºCISA KEVå·²æ”¶å½•ï¼Œè¯´æ˜æ¼æ´çœŸå®å­˜åœ¨ä¸”åˆ©ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚è¯¥ PoC çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ POST è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåµŒå…¥å¼çš„ GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è®¿é—®å†…éƒ¨èµ„æºã€‚è¿™ç§æ–¹æ³•é€šå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå‰ç«¯æœåŠ¡å™¨å¯èƒ½æ ¹æ® Content-Length åªè¯»å–éƒ¨åˆ†è¯·æ±‚ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼ŒPoC å¤§æ¦‚ç‡æœ‰æ•ˆã€‚\n\n**æŠ•æ¯’é£é™©åˆ†æï¼š** æŸ¥çœ‹æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦åŒ…å« LICENSEã€README.md å’Œ exploit è„šæœ¬ã€‚LICENSE å£°æ˜äº† MIT è®¸å¯ï¼Œè¡¨æ˜ä»£ç å¼€æºã€‚README.md æ–‡ä»¶æè¿°äº†æ¼æ´å’Œ PoC çš„åŸºæœ¬ä¿¡æ¯ã€‚æ²¡æœ‰ç›´æ¥å‘ç°æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œç”±äºHTTPè¯·æ±‚èµ°ç§æœ¬èº«çš„å¤æ‚æ€§ï¼Œä»¥åŠSAPç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¸æ’é™¤ä½œè€…å¯èƒ½åœ¨ä»£ç ä¸­æ¤å…¥ä¸æ˜“å¯Ÿè§‰çš„åé—¨æˆ–æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œè¯¥ PoC å¯èƒ½ä¼šå°è¯•è®¿é—®ä¸€äº›ä¸åº”è¯¥è®¿é—®çš„å†…éƒ¨ç«¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ä¸€äº›æ„å¤–è¡Œä¸ºã€‚éœ€è¦å¯¹PoCä»£ç è¿›è¡Œä»”ç»†åˆ†æï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨æœªçŸ¥çš„æ¼æ´æˆ–ä¸å®‰å…¨è¡Œä¸ºã€‚\n\n**åˆ©ç”¨æ–¹å¼ï¼š**\n1.  æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è´Ÿè½½çš„ HTTP è¯·æ±‚ã€‚\n2.  æ¶æ„è´Ÿè½½åˆ©ç”¨ Content-Length æˆ– Transfer-Encoding å¤´éƒ¨ï¼Œä½¿å¾—å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œçš„è§£æä¸ä¸€è‡´ã€‚\n3.  å‰ç«¯æœåŠ¡å™¨å°†éƒ¨åˆ†æ¶æ„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚\n4.  åç«¯æœåŠ¡å™¨å°†æ¶æ„è¯·æ±‚ä½œä¸ºåˆæ³•è¯·æ±‚å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæœªæˆæƒæ“ä½œï¼Œä¾‹å¦‚ç»•è¿‡èº«ä»½éªŒè¯ã€è®¿é—®å†…éƒ¨èµ„æºæˆ–ç¯¡æ”¹æ•°æ®ã€‚

**é¡¹ç›®åœ°å€:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #2

**æ¥æº**: [CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md](../2022/CVE-2022-22536-ZZ-SOCMAP_CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** HTTP Request Smuggling/Concatenation

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€ç¼“å­˜æŠ•æ¯’ã€æ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹ç½‘ç»œè¿æ¥ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 0%

## è¯¦æƒ…

CVE-2022-22536 æ˜¯ SAP NetWeaver å¹³å°ä¸Šçš„ä¸€ä¸ª HTTP è¯·æ±‚èµ°ç§/ä¸²è”æ¼æ´ã€‚æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥å°†æ¶æ„æ•°æ®æ·»åŠ åˆ°å—å®³è€…çš„è¯·æ±‚ä¸­ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨å´©æºƒã€‚ 

**æ¼æ´åˆ©ç”¨æ–¹å¼åˆ†æï¼š**

1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ SAP Web Dispatcher æˆ– SAP åº”ç”¨æœåŠ¡å™¨åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¯¹ Content-Length å’Œ Transfer-Encoding ç­‰å¤´éƒ¨è§£æä¸ä¸€è‡´ï¼Œå¯¼è‡´è¯·æ±‚è¾¹ç•Œæ··æ·†ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå°†å¤šä¸ªè¯·æ±‚æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°å°†æ¶æ„è¯·æ±‚çš„ä¸€éƒ¨åˆ†è§£é‡Šä¸ºä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚

2.  **POC ä»£ç åˆ†æï¼š** æä¾›çš„ POC ä»£ç æ—¨åœ¨åˆ©ç”¨æ­¤æ¼æ´ã€‚è¯¥ä»£ç é¦–å…ˆå°è¯•éªŒè¯å’Œç¼“å­˜èµ„æºã€‚ç„¶åï¼Œå®ƒæ„é€ ä¸€ä¸ªåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚çš„æ¶æ„ HTTP è¯·æ±‚ã€‚å¡«å……æ•°æ®æ—¨åœ¨åˆ©ç”¨ Content-Length çš„å·®å¼‚ï¼Œè€Œä»£ç†å¯¹é½è¯·æ±‚æ—¨åœ¨ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å¤„ç†å“åº”ã€‚ä»£ç å‘é€è¿™ä¸ªæ¶æ„è¯·æ±‚ï¼Œå¹¶è§£ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥åˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚å…·ä½“æ¥è¯´:
    * `craft_payload` å‡½æ•°æ„é€ æ¶æ„ payloadï¼ŒåŒ…å«äº†å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½è¯·æ±‚ã€‚
    * `validate_resource_and_cache` å‡½æ•°éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆå¹¶ç¼“å­˜ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚
    * `send_payload` å‡½æ•°è´Ÿè´£å‘é€payloadå¹¶æ¥æ”¶å“åº”ã€‚
    * `parse_response` å‡½æ•°è§£æå“åº”ï¼Œæå–çŠ¶æ€ç ç­‰ä¿¡æ¯ã€‚

3. **æœ‰æ•ˆæ€§:** æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæä¾›çš„POCä»£ç , æ­¤POCä»£ç å¯ä»¥éªŒè¯å¹¶åˆ©ç”¨ CVE-2022-22536ã€‚

4. **æŠ•æ¯’é£é™©:** æ£€æŸ¥äº†æ•´ä¸ªä»£ç ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æŠ•æ¯’ä»£ç ã€‚ä»£ç é€»è¾‘ä¸»è¦é›†ä¸­åœ¨æ„å»ºå’Œå‘é€æ¶æ„ HTTP è¯·æ±‚ï¼Œä»¥åŠè§£ææœåŠ¡å™¨å“åº”ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ¼æ´åˆ©ç”¨çš„èŒƒç•´å†…ã€‚å› æ­¤ï¼ŒæŠ•æ¯’é£é™©è¯„ä¼°ä¸º 0%ã€‚

**é¡¹ç›®åœ°å€:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #3

**æ¥æº**: [CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md](../2022/CVE-2022-22536-abrewer251_CVE-2022-22536_SAP_Request_Smuggling_Scanner.md)

## CVE-2022-22536 SAP Request Smuggling

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§ (Request Smuggling)

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡ã€æ•°æ®æ³„éœ²ã€ç¼“å­˜æŠ•æ¯’å’Œæ‹’ç»æœåŠ¡

**å½±å“ç‰ˆæœ¬:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å…è®¸HTTP/HTTPSè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536æ˜¯SAP NetWeaverå’ŒABAPå¹³å°ä¸­çš„ä¸€ä¸ªè¯·æ±‚èµ°ç§æ¼æ´ã€‚æœªç»éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ±¡æŸ“ä¸­é—´Webç¼“å­˜ã€‚æ¼æ´åˆ©ç”¨ä»£ç scanner.pyæ˜¯ä¸€ä¸ªé’ˆå¯¹CVE-2022-22536çš„æ‰«æå™¨ï¼Œå®ƒé€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚æ¥æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™ä¸ªPOCä»£ç é€šè¿‡æ„é€ ç•¸å½¢çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingå¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°†æ¶æ„è¯·æ±‚éšè—åœ¨çœ‹ä¼¼æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œç¬¬ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šå°†æ¶æ„è¯·æ±‚å½“åšä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°èµ°ç§è¯·æ±‚çš„ç›®çš„ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´æè¿°å’ŒPOCä»£ç ï¼Œè¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒæ—¨åœ¨éªŒè¯ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯·æ±‚èµ°ç§æ”»å‡»ã€‚è¯¥ä»£ç é€šè¿‡å‘é€æ„é€ çš„HTTPè¯·æ±‚å¹¶åˆ†æå“åº”æ¥æ£€æµ‹æ­¤æ¼æ´ã€‚

**æŠ•æ¯’é£é™©ï¼š**
ä»£ç ä¸­å­˜åœ¨æä½çš„æŠ•æ¯’é£é™©ï¼ˆçº¦10%ï¼‰ã€‚é£é™©ç‚¹åœ¨äºï¼š

1.  **ä¾èµ–é¡¹ï¼š** ä»£ç ä¾èµ–äº`tqdm`åº“ã€‚è™½ç„¶`tqdm`æ˜¯ä¸€ä¸ªå¸¸è§çš„åº“ï¼Œä½†å§‹ç»ˆå­˜åœ¨ä¾èµ–é¡¹è¢«åŠ«æŒæˆ–æ¶æ„ç‰ˆæœ¬æ›¿ä»£çš„é£é™©ã€‚
2.  **è¯ä¹¦éªŒè¯æ§åˆ¶ï¼š** è„šæœ¬å…è®¸ç¦ç”¨SSLè¯ä¹¦éªŒè¯ (`cert_verify=False`)ã€‚è™½ç„¶è¿™åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¼•å…¥ä¸­é—´äººæ”»å‡»çš„é£é™©ã€‚

æ€»ä½“è€Œè¨€ï¼Œä»£ç ç›¸å¯¹ç®€å•ä¸”æ˜“äºå®¡è®¡ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ„é€ å’Œå‘é€HTTPè¯·æ±‚ä»¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æ“ä½œã€‚ç„¶è€Œï¼Œå§‹ç»ˆå»ºè®®åœ¨è¿è¡Œä»»ä½•ç¬¬ä¸‰æ–¹ä»£ç ä¹‹å‰è¿›è¡Œå½»åº•å®¡æŸ¥ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡åˆ—è¡¨ï¼š** æ‰«æå™¨ä»æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡IPåœ°å€å’Œç«¯å£åˆ—è¡¨ã€‚
2.  **åè®®åå•†ï¼š** æ‰«æå™¨æ”¯æŒé€šè¿‡HTTPæˆ–HTTPSè¿›è¡Œè¿æ¥ï¼Œå¹¶å¯é€‰åœ°éªŒè¯SSLè¯ä¹¦ã€‚
3.  **æ¼æ´éªŒè¯ï¼š** æ‰«æå™¨é€šè¿‡å‘é€ç‰¹åˆ¶çš„HTTPè¯·æ±‚ï¼ˆåŒ…å«å¡«å……æ•°æ®å’Œä»£ç†å¯¹é½æœ‰æ•ˆè´Ÿè½½ï¼‰æ¥è§¦å‘è¯·æ±‚èµ°ç§æ¼æ´ã€‚è¿™äº›è¯·æ±‚æ—¨åœ¨åˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthå’ŒTransfer-Encodingçš„å¤„ç†å·®å¼‚ã€‚
4.  **ç»“æœåˆ†æï¼š** æ‰«æå™¨åˆ†ææœåŠ¡å™¨çš„å“åº”ï¼Œä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæœåŠ¡å™¨ä»¥æ„å¤–çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ã€‚
5.  **æŠ¥å‘Šï¼š** æ‰«æå™¨ç”ŸæˆCSVæ ¼å¼çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‰«æç»“æœçš„ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---

## POC #4

**æ¥æº**: [CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md](../2022/CVE-2022-22536-tess-ss_SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536.md)

## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**æ¼æ´ç¼–å·:** CVE-2022-22536

**æ¼æ´ç±»å‹:** è¯·æ±‚èµ°ç§/è¯·æ±‚ä¸²è”

**å½±å“åº”ç”¨:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€æƒé™æå‡ã€æ‹’ç»æœåŠ¡ä»¥åŠä¸­é—´Webç¼“å­˜æŠ•æ¯’

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬ï¼šKERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 (ä»¥åŠ Web Dispatcher 7.49, 7.53, 7.77, 7.81, 7.85, 7.22EXT, 7.86, 7.87 å’Œ Content Server 7.53)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å—å½±å“çš„SAPç»„ä»¶ï¼Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2022-22536 æ¼æ´æ˜¯ SAP NetWeaver åŠå…¶ç›¸å…³ç»„ä»¶ä¸­çš„è¯·æ±‚èµ°ç§å’Œè¯·æ±‚ä¸²è”æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å—å®³è€…è¯·æ±‚å‰æ·»åŠ æ¶æ„æ•°æ®æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œå†’å……å—å®³è€…æ‰§è¡ŒåŠŸèƒ½æˆ–æ¯’åŒ–ä¸­é—´ Web ç¼“å­˜ã€‚æ”»å‡»è€…å‘é€æ„é€ å¥½çš„HTTPè¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨å¯¹Content-Lengthçš„å¤„ç†å·®å¼‚ï¼Œå®ç°è¯·æ±‚èµ°ç§ï¼Œåç»­åˆæ³•çš„ç”¨æˆ·è¯·æ±‚å¯èƒ½ä¼šå—åˆ°æ”»å‡»è€…æ¶æ„è¯·æ±‚çš„å½±å“ã€‚PoCåˆ©ç”¨äº† Content-Length å­—æ®µï¼Œé€šè¿‡å‘é€å¤§é‡'A'å­—ç¬¦æ¥å°è¯•é€ æˆ Desynchronizationï¼Œä»è€Œå½±å“åç»­è¯·æ±‚ã€‚é«˜å±æ€§ä½“ç°åœ¨ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´è·å¾—å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶ï¼ŒåŒ…æ‹¬æ•°æ®çš„æœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§ã€‚æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ï¼Œä¸»è¦åŸå› æ˜¯è™½ç„¶åŸç†ä¸Šå¯ä»¥é€šè¿‡ç¯¡æ”¹ç¼“å­˜ç­‰æ–¹å¼æŠ•æ¯’ï¼Œä½†æä¾›çš„PoC ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´çš„å­˜åœ¨ï¼Œç›´æ¥åŒ…å«æ¶æ„ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šé£é™©ï¼Œæ¯”å¦‚åˆ©ç”¨è¯¥æ¼æ´å®æ–½è¿›ä¸€æ­¥çš„æ”»å‡»ï¼Œæ¯”å¦‚ç¼“å­˜æŠ•æ¯’ç­‰ã€‚æ­¤ä»“åº“ä¸­åŒ…å«æŒ‡å‘ Onapsis å’Œ antx-code æä¾›çš„æ¼æ´éªŒè¯è„šæœ¬çš„é“¾æ¥ã€‚

**é¡¹ç›®åœ°å€:** [tess-ss/SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536](https://github.com/tess-ss/SAP-memory-pipes-desynchronization-vulnerability-MPI-CVE-2022-22536)

**æ¼æ´è¯¦æƒ…:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)

---



---



---



---



---



---

