## CVE-2022-29799 - networkd-dispatcher (Linux system daemon) 目录遍历/提权

**漏洞编号:** CVE-2022-29799

**漏洞类型:** 目录遍历/提权

**影响应用:** networkd-dispatcher (Linux system daemon)

**危害等级:** 高危 (High)

**CVSS评分:** 7.8 (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** networkd-dispatcher 2.1 及更早版本

**利用条件:** 攻击者需拥有本地非特权用户权限，且系统运行 networkd-dispatcher 服务

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：此POC（名为Nimbuspwn）针对networkd-dispatcher中的目录遍历（CVE-2022-29799）和符号链接竞争（CVE-2022-29800）漏洞。该工具通过DBus接口向系统服务发送伪造的OperationalState信号。由于networkd-dispatcher在处理信号路径时未对'..'等特殊字符进行充分过滤，攻击者可以实施目录遍历，诱使服务跳转到受控的临时目录。POC中使用了符号链接竞争技术，在服务检查文件与执行脚本的时间差（TOCTOU）内，将合法目录替换为包含恶意载荷的目录。代码逻辑严密，利用了python-dbus库与系统总线交互，并包含了自动化的清理和重试机制，能够稳定触发受害进程以root权限执行/tmp目录下的payload脚本，从而实现从普通用户到root的权限提升。实验证明该POC在存在漏洞的Ubuntu等主流Linux发行版上具有极高的成功率。利用步骤：1. 在/tmp下创建受控的目录结构；2. 在受控目录中写入伪造的脚本（如复制并授权/bin/sh）；3. 建立指向/sbin的初始符号链接；4. 通过DBus发送带有'../../../'路径的信号；5. 监控系统状态，并在特定时机利用os.symlink切换符号链接指向恶意载荷目录；6. 脚本被执行后，检查/tmp/sh是否具备SUID权限并执行获取root Shell。投毒风险分析：该POC代码逻辑清晰，主要使用了Python标准库（os, time, random, shutil）以及必要的dbus库。经过安全审计，代码中虽然包含了'cp /bin/sh /tmp/sh'和'chmod 4777'等行为，但这些属于典型的提权POC验证逻辑，目的是为了向研究人员展示漏洞已被成功触发，而非隐蔽的恶意后门。代码中未发现远程外发敏感信息（如/etc/shadow）、无加密混淆代码、无第三方可疑服务器的下载指令。其风险主要在于恶意使用者可能直接将其用于实战攻击，但从防御性研究的角度来看，该代码包不包含隐蔽投毒特征。建议在使用前在隔离的虚拟机环境中运行，并注意监控dbus-monitor的信号流量。

**项目地址:** [https://ngtuonghung.github.io/pwn/cve-reproduction/nimbuspwn/](https://ngtuonghung.github.io/pwn/cve-reproduction/nimbuspwn/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2022-29799](https://nvd.nist.gov/vuln/detail/CVE-2022-29799)
