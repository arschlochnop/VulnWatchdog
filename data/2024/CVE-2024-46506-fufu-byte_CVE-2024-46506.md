## CVE-2024-46506 - NetAlertX 远程代码执行 (RCE)

**漏洞编号:** CVE-2024-46506

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** NetAlertX

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** 23.01.14 至 24.9.12

**利用条件:** 远程网络访问，无需身份验证

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC代码针对NetAlertX中的CVE-2024-46506漏洞提供了完整的自动化利用流程。漏洞的核心在于NetAlertX的`util.php`组件在处理`savesettings`和`addToExecutionQueue`功能时，未对用户输入的参数进行充分的身份验证和过滤。POC首先通过请求`maintenance.php`并解析HTML中的版本号来确认目标的脆弱性，版本判断逻辑严密（23.01.14-24.9.12）。随后，利用代码通过POST请求向`/php/server/util.php`发送构造好的`savesettings`指令，将恶意命令注入到数据库清理命令（DBCLNP_CMD）配置中，并调整调度计划。最后，通过`addToExecutionQueue`函数强行触发任务执行。代码结构清晰，使用了Python的requests库和uuid模块，具备极高的实战有效性，能够直接在未授权的情况下获取目标系统的shell执行权限。利用步骤：1. 自动化探测目标系统的版本，确认其在受影响范围内。2. 构造POST请求，调用`savesettings`功能，将攻击者自定义的系统命令（如反弹shell或简单的id命令）写入系统的`DBCLNP_CMD`配置项。3. 构造第二个POST请求，通过`addToExecutionQueue`功能，利用uuid生成的随机标识符触发执行队列。4. 系统在后台执行定时任务或被触发执行时，恶意命令将以Web服务器权限运行。投毒风险分析：经过对提供的POC代码进行静态审计，未发现明显的恶意混淆或后门植入行为。代码使用了标准的Python库（requests, json, uuid, re），逻辑直观，所有网络交互均指向用户定义的`target_url`。代码中虽然包含执行系统命令的逻辑，但那是漏洞利用的核心功能，并非针对执行POC的攻击者本机的恶意行为。然而，由于该漏洞属于高价值的未授权RCE，此类公开的POC脚本常被不法分子进行二次包装。风险点主要在于：如果用户从非官方或不可信的第三方仓库下载此类脚本，攻击者可能会在`requests.post`之后添加一段隐藏的Python代码，将攻击者的IP、地理位置甚至环境变量通过DNS Log或OOB通道回传；或者在执行Exploit的同时，在本地静默下载并执行一个远端的可执行文件。目前的这段代码本身是安全的、学术性的防御研究工具，但在分发过程中存在中低程度的供应链投毒风险。建议研究人员在隔离的沙箱环境中使用，并始终核对代码指纹。

**项目地址:** [https://github.com/metasploit-framework/metasploit-framework/pull/19876](https://www.google.com/search?q=https://github.com/metasploit-framework/metasploit-framework/pull/19876)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-46506](https://nvd.nist.gov/vuln/detail/CVE-2024-46506)
