## CVE-2024-28397 - js2py RCE

**漏洞编号:** CVE-2024-28397

**漏洞类型:** RCE

**影响应用:** js2py

**危害等级:** Medium

**CVSS评分:** 5.3

**影响版本:** <=0.74

**利用条件:** Parsing user-controlled JavaScript or JSON

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2024-28397是js2py（0.74及更早版本）中的一个远程代码执行漏洞。该漏洞源于js2py中的不完整沙箱，攻击者可以构造特制的JavaScript代码，通过Python的内部对象模型访问危险类（如subprocess.Popen），从而导致任意命令执行。PoC通过访问`__class__`、`__base__`和`__subclasses__()`来定位`subprocess.Popen`，然后执行shell命令并捕获输出。利用此漏洞，攻击者可以突破JavaScript沙箱，在Python环境中执行任意命令，从而完全控制受影响的系统。PoC的有效性在于它能够绕过`js2py.disable_pyimport()`的限制，直接访问Python内部对象并执行代码。 

**利用步骤：**
1. 应用程序解析用户提供的JavaScript或JSON。
2. PoC使用JavaScript代码来遍历Python对象图，查找`subprocess.Popen`。
3. PoC执行shell命令并捕获输出。
4. 最终结果以字符串形式返回。

**POC有效性分析：**
该PoC的有效性在于它展示了如何通过JavaScript代码访问Python内部对象，并利用这些对象执行任意命令。这种攻击方式绕过了js2py的沙箱限制，直接威胁到运行js2py的系统的安全。通过提供的PoC代码，可以清晰地看到攻击者如何构造恶意JavaScript代码，并利用该代码执行系统命令。由于js2py被广泛用于解析JavaScript代码，因此该漏洞具有广泛的影响。

**投毒风险分析：**
此PoC的投毒风险较低，因为代码结构清晰，主要使用标准JavaScript语法和Python内部对象访问。虽然PoC执行了命令，但没有发现任何混淆、恶意行为或外部脚本调用。PoC代码直接展示了如何利用漏洞，没有试图隐藏或掩盖其行为。因此，该PoC的投毒风险较低，大约在15%左右。但是，如果攻击者修改此PoC，例如添加混淆代码或尝试下载和执行其他恶意脚本，则投毒风险会显著增加。在实际应用中，需要对PoC代码进行仔细审查，以确保其安全性。

**项目地址:** https://github.com/Marven11/CVE-2024-28397-js2py-Sandbox-Escape

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-28397
