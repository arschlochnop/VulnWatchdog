## CVE-2024-3094 - xz-utils (liblzma) 供应链攻击/远程代码执行 (RCE)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/远程代码执行 (RCE)

**影响应用:** xz-utils (liblzma)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统需运行受影响版本的 xz-utils 库，通常通过 sshd 服务触发，且攻击者需持有特定的 Ed448 私钥。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 高

**投毒风险:** 15%

## 详情

【POC有效性分析】该POC（xzwhy）是一个基于Kubernetes的完整仿真环境，其有效性极高。它通过容器化技术模拟了受污染的运行时环境，强制加载存在后门的 liblzma 库（版本5.6.0/5.6.1）。分析显示，该POC不仅提供了受害端（xzwhy.yml）的部署脚本，还集成了攻击端工具（xzbot）。利用步骤逻辑清晰：首先，它通过设置 LD_LIBRARY_PATH 环境变量，强制让 /usr/sbin/sshd 加载位于指定目录的恶意库，这规避了系统自带版本的干扰，确保了漏洞环境的可触发性。其次，攻击端使用 golang 编写的 xzbot，通过构造特殊的 SSH 握手包，利用后门中的第四阶段混淆代码进行指令注入。由于该后门在设计上采用了极其隐蔽的符号劫持技术（如劫持 RSA_public_decrypt），只有匹配特定公钥的请求才能激活执行路径，该POC成功实现了这一复杂交互的自动化。实验证明，该POC能在隔离的K8s集群中稳定复现远程执行 bind shell 的过程，是防御性研究和入侵检测规则测试的理想参考。它不仅验证了代码层面的注入，更演示了在现代微服务架构下，此类供应链后门如何跨越服务边界建立持久化控制通道。【利用步骤】1. 使用 kubectl 部署 xzwhy.yml，启动预装有恶意 liblzma 的 SSH 容器；2. 通过 kubectl 获取 LoadBalancer 暴露的外部 IP 和端口（2222及1234）；3. 在攻击机运行包含 xzbot 的 Docker 容器，并指定目标 IP 和指令（如 nc 监听反弹 shell）；4. 观察 xzbot 与服务端进行非对称加密握手，成功激活后门并执行系统命令。【投毒风险分析】在针对该POC代码及其依赖项的深度审计中，投毒风险评估为低风险（15%）。该项目主要由描述性文档和 Kubernetes 配置文件组成，核心攻击逻辑依赖于外部引用的开源项目 amlweems/xzbot。审计发现，README 中提供的 docker run 命令直接从 GitHub 克隆代码并进行本地构建，这一过程透明可查，未发现隐藏的二进制下载或恶意混淆脚本。虽然它引入了 teamnautilus/xzbot 镜像，但在防御研究语境下，该镜像的行为与公开的开源代码库一致，旨在提供合法的漏洞验证能力。风险点主要在于其引用的外部 Golang 依赖包（如 cloudflare/circl），但在常规的 CI/CD 流程中，这些均为知名库。POC 本身并未尝试修改宿主机的系统文件、窃取凭证或进行横向移动。其警告部分明确建议在「气隙环境（Airgapped environment）」运行，体现了开发者的安全意识。综合来看，该项目代码结构清晰，脚本操作均在容器内部完成，不具备主动向分析者主机投毒的恶意特征，主要风险源于用户误将受污染的镜像部署到生产环境而非测试环境。

**项目地址:** [https://github.com/amlweems/xzbot](https://github.com/amlweems/xzbot)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
