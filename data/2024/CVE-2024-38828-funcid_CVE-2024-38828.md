# CVE-2024-38828

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-38828-First-Roman_sprig-mvc-demo-patch.md](../2024/CVE-2024-38828-First-Roman_sprig-mvc-demo-patch.md)

## CVE-2024-38828 - Spring MVC @RequestBody byte[] DoS

**æ¼æ´ç¼–å·:** CVE-2024-38828

**æ¼æ´ç±»å‹:** æ‹’ç»æœåŠ¡ (DoS)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

**å½±å“ç‰ˆæœ¬:** < 5.3.42

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡åº”ç”¨ä½¿ç”¨äº†Spring MVCï¼Œä¸”å­˜åœ¨æ¥æ”¶ @RequestBody byte[] å‚æ•°çš„Controlleræ–¹æ³•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-38828 æ¼æ´å­˜åœ¨äº Spring Framework ä¸­ï¼Œå…·ä½“æ˜¯å½“ Spring MVC Controller æ–¹æ³•ä½¿ç”¨ `@RequestBody byte[]` ä½œä¸ºå‚æ•°æ—¶ï¼Œæœªç»åˆç†é™åˆ¶çš„è¯·æ±‚ä½“å¤§å°å¯èƒ½å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä»è€Œå¼•å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§:**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„POCæ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºç¡®è®¤äº†æ­¤æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æè¿°äº†åˆ©ç”¨æ–¹å¼ã€‚

**åˆ©ç”¨æ–¹å¼:**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å¤§é‡æ•°æ®æˆ–æ„é€ ç‰¹æ®Šçš„æ•°æ®åŒ…åˆ°ä½¿ç”¨äº† `@RequestBody byte[]` å‚æ•°çš„ Controller æ–¹æ³•ï¼Œå¯¼è‡´æœåŠ¡å™¨å†…å­˜æº¢å‡ºæˆ–CPUèµ„æºè€—å°½ï¼Œä»è€Œä½¿æœåŠ¡ä¸å¯ç”¨ã€‚POCä»£ç å°è¯•é€šè¿‡è‡ªå®šä¹‰è½¬æ¢å™¨é™åˆ¶ä¸Šä¼ å¤§å°æ¥ç¼“è§£æ­¤é—®é¢˜ï¼Œä½†æœªæ¶‰åŠServletè¶…æ—¶è®¾ç½®å’Œä¼˜åŒ– multipart/form-data å¤„ç†ï¼Œå¯èƒ½æ— æ³•å®Œå…¨é˜²å¾¡è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©:**
POCä»£ç åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰çš„ `ByteArrayConverter`ï¼Œè¯¥è½¬æ¢å™¨å°è¯•é™åˆ¶æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ç»„çš„å¤§å°ã€‚è™½ç„¶è¿™ä¸ªè½¬æ¢å™¨æœ¬èº«æ˜¯ä¸ºäº†ç¼“è§£ DoS æ¼æ´ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ‰¾åˆ°ç»•è¿‡è¯¥é™åˆ¶çš„æ–¹æ³•ï¼Œæˆ–è€…è¯¥è½¬æ¢å™¨å­˜åœ¨å…¶ä»–ç¼ºé™·ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé™åˆ¶å¤§å°çš„é€»è¾‘å­˜åœ¨é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–å…¶ä»–ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚æ­¤å¤–ï¼ŒREADMEæåˆ°ï¼Œä¸ºå®Œå…¨è¦†ç›–è¯¥æ¼æ´éœ€è¦å®‰è£… servlet è¶…æ—¶ï¼Œå¦‚æœç”¨æˆ·æœªå®‰è£…ï¼Œåˆ™å¯èƒ½å­˜åœ¨éƒ¨åˆ†é£é™©ã€‚POM.xmlä¸­ä½¿ç”¨çš„æ˜¯spring-boot-starter-parent 2.3.3.RELEASEç‰ˆæœ¬ï¼Œå­˜åœ¨ä¸€å®šçš„å®‰å…¨é£é™©ï¼Œå› ä¸ºè¯¥ç‰ˆæœ¬æ¯”è¾ƒè€æ—§ã€‚æ‰€ä»¥è¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [First-Roman/sprig-mvc-demo-patch](https://github.com/First-Roman/sprig-mvc-demo-patch)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-38828](https://nvd.nist.gov/vuln/detail/CVE-2024-38828)

---

## POC #2

**æ¥æº**: [CVE-2024-38828-funcid_CVE-2024-38828.md](../2024/CVE-2024-38828-funcid_CVE-2024-38828.md)

# CVE-2024-38828

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-38828-First-Roman_sprig-mvc-demo-patch.md](../2024/CVE-2024-38828-First-Roman_sprig-mvc-demo-patch.md)

## CVE-2024-38828 - Spring MVC @RequestBody byte[] DoS

**æ¼æ´ç¼–å·:** CVE-2024-38828

**æ¼æ´ç±»å‹:** æ‹’ç»æœåŠ¡ (DoS)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

**å½±å“ç‰ˆæœ¬:** < 5.3.42

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®ï¼Œç›®æ ‡åº”ç”¨ä½¿ç”¨äº†Spring MVCï¼Œä¸”å­˜åœ¨æ¥æ”¶ @RequestBody byte[] å‚æ•°çš„Controlleræ–¹æ³•ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-38828 æ¼æ´å­˜åœ¨äº Spring Framework ä¸­ï¼Œå…·ä½“æ˜¯å½“ Spring MVC Controller æ–¹æ³•ä½¿ç”¨ `@RequestBody byte[]` ä½œä¸ºå‚æ•°æ—¶ï¼Œæœªç»åˆç†é™åˆ¶çš„è¯·æ±‚ä½“å¤§å°å¯èƒ½å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä»è€Œå¼•å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚

**æœ‰æ•ˆæ€§:**
æ ¹æ®æä¾›çš„æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´çš„POCæ˜¯æœ‰æ•ˆçš„ã€‚å¤šä¸ªæ¥æºç¡®è®¤äº†æ­¤æ¼æ´çš„å­˜åœ¨ï¼Œå¹¶æè¿°äº†åˆ©ç”¨æ–¹å¼ã€‚

**åˆ©ç”¨æ–¹å¼:**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å¤§é‡æ•°æ®æˆ–æ„é€ ç‰¹æ®Šçš„æ•°æ®åŒ…åˆ°ä½¿ç”¨äº† `@RequestBody byte[]` å‚æ•°çš„ Controller æ–¹æ³•ï¼Œå¯¼è‡´æœåŠ¡å™¨å†…å­˜æº¢å‡ºæˆ–CPUèµ„æºè€—å°½ï¼Œä»è€Œä½¿æœåŠ¡ä¸å¯ç”¨ã€‚POCä»£ç å°è¯•é€šè¿‡è‡ªå®šä¹‰è½¬æ¢å™¨é™åˆ¶ä¸Šä¼ å¤§å°æ¥ç¼“è§£æ­¤é—®é¢˜ï¼Œä½†æœªæ¶‰åŠServletè¶…æ—¶è®¾ç½®å’Œä¼˜åŒ– multipart/form-data å¤„ç†ï¼Œå¯èƒ½æ— æ³•å®Œå…¨é˜²å¾¡è¯¥æ¼æ´ã€‚

**æŠ•æ¯’é£é™©:**
POCä»£ç åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰çš„ `ByteArrayConverter`ï¼Œè¯¥è½¬æ¢å™¨å°è¯•é™åˆ¶æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ç»„çš„å¤§å°ã€‚è™½ç„¶è¿™ä¸ªè½¬æ¢å™¨æœ¬èº«æ˜¯ä¸ºäº†ç¼“è§£ DoS æ¼æ´ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æ‰¾åˆ°ç»•è¿‡è¯¥é™åˆ¶çš„æ–¹æ³•ï¼Œæˆ–è€…è¯¥è½¬æ¢å™¨å­˜åœ¨å…¶ä»–ç¼ºé™·ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé™åˆ¶å¤§å°çš„é€»è¾‘å­˜åœ¨é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–å…¶ä»–ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚æ­¤å¤–ï¼ŒREADMEæåˆ°ï¼Œä¸ºå®Œå…¨è¦†ç›–è¯¥æ¼æ´éœ€è¦å®‰è£… servlet è¶…æ—¶ï¼Œå¦‚æœç”¨æˆ·æœªå®‰è£…ï¼Œåˆ™å¯èƒ½å­˜åœ¨éƒ¨åˆ†é£é™©ã€‚POM.xmlä¸­ä½¿ç”¨çš„æ˜¯spring-boot-starter-parent 2.3.3.RELEASEç‰ˆæœ¬ï¼Œå­˜åœ¨ä¸€å®šçš„å®‰å…¨é£é™©ï¼Œå› ä¸ºè¯¥ç‰ˆæœ¬æ¯”è¾ƒè€æ—§ã€‚æ‰€ä»¥è¯„ä¼°æŠ•æ¯’é£é™©ä¸º10%ã€‚

**é¡¹ç›®åœ°å€:** [First-Roman/sprig-mvc-demo-patch](https://github.com/First-Roman/sprig-mvc-demo-patch)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-38828](https://nvd.nist.gov/vuln/detail/CVE-2024-38828)

---

## POC #2

**æ¥æº**: [CVE-2024-38828-funcid_CVE-2024-38828.md](../2024/CVE-2024-38828-funcid_CVE-2024-38828.md)

## CVE-2024-38828 - Spring MVC DoS

**æ¼æ´ç¼–å·:** CVE-2024-38828

**æ¼æ´ç±»å‹:** æ‹’ç»æœåŠ¡ (DoS)

**å½±å“åº”ç”¨:** Spring Framework

**å±å®³ç­‰çº§:** ä¸­å±ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­

**å½±å“ç‰ˆæœ¬:** < 5.3.42

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç½‘ç»œè®¿é—®Spring MVCæ§åˆ¶å™¨ï¼Œè¯¥æ§åˆ¶å™¨ä½¿ç”¨ @RequestBody byte[] ä½œä¸ºæ–¹æ³•å‚æ•°ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2024-38828 æ˜¯ Spring Framework ä¸­çš„ä¸€ä¸ªæ‹’ç»æœåŠ¡æ¼æ´ã€‚å½“ Spring MVC æ§åˆ¶å™¨æ–¹æ³•ä½¿ç”¨ `@RequestBody byte[]` å‚æ•°æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å¸¦æœ‰å·¨å¤§ `Content-Length` å¤´éƒ¨ä½†å®é™… payload å¾ˆå°çš„ HTTP POST è¯·æ±‚æ¥è§¦å‘å†…å­˜è€—å°½ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´åº“ä¿¡æ¯ã€æœç´¢ç»“æœå’Œæä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚æ¼æ´åˆ©ç”¨ä»£ç ä¸­çš„ `load_test.py` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»ï¼Œé€šè¿‡å‘é€å¸¦æœ‰å¤§çš„ `Content-Length` ï¼ˆ2^31 - 1ï¼‰ å¤´éƒ¨ï¼Œä½† payload ä»…ä¸º 1 å­—èŠ‚çš„ POST è¯·æ±‚ï¼Œæ¥æ¶ˆè€—æœåŠ¡å™¨çš„å†…å­˜èµ„æºã€‚

**æŠ•æ¯’é£é™©åˆ†æï¼š**

è¯¥ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„é£é™©è¾ƒä½ï¼Œçº¦ä¸º 5%ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   **ä¸»è¦åŠŸèƒ½æ˜ç¡®ï¼š** è¯¥ä»“åº“çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤º CVE-2024-38828 æ¼æ´ï¼Œå¹¶æä¾›ä¿®å¤æ–¹æ¡ˆã€‚
*   **åŒ…å«ä¿®å¤æ–¹æ¡ˆï¼š** ä»“åº“åŒ…å« `SafeByteArrayHttpMessageConverter.java` ï¼Œè¡¨æ˜ä½œè€…æä¾›äº†ç¼“è§£è¯¥ DoS æ¼æ´çš„æªæ–½ï¼Œè¿™é™ä½äº†ä½œè€…æ¶æ„æŠ•æ¯’çš„å¯èƒ½æ€§ã€‚
*   **æµ‹è¯•ä»£ç æ¸…æ™°ï¼š** `load_test.py` è„šæœ¬çš„ç›®çš„æ˜¯è§¦å‘ DoSï¼Œä»£ç æœ¬èº«ç›¸å¯¹ç®€å•ç›´æ¥ï¼Œæ²¡æœ‰å‘ç°éšè—çš„æ¶æ„ä»£ç ã€‚ä½†å§‹ç»ˆéœ€è¦è¿›è¡Œäººå·¥å®¡æŸ¥ï¼Œæ¥æ¶ˆé™¤æ½œåœ¨çš„é£é™©ã€‚
*   **ç»†å¾®é£é™©ï¼š**build.gradle.ktsä¸­æŒ‡å®šäº†spring-webçš„ç‰ˆæœ¬ä¸º5.3.39ï¼Œè™½ç„¶ä½äº5.3.42ï¼Œç¬¦åˆæ¼æ´ç‰ˆæœ¬èŒƒå›´ï¼Œä½†æ˜¯ä¾èµ–äº†spring-boot-starter-web 2.7.18ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å…¶ä»–çš„ä¾èµ–å’Œé…ç½®ï¼Œå­˜åœ¨ä¸€å®šçš„è¢«åˆ©ç”¨é£é™©ï¼Œä½†æ•´ä½“é£é™©å¯æ§ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç›®æ ‡ï¼š** å­˜åœ¨æ¼æ´çš„ Spring MVC åº”ç”¨ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨ `@RequestBody byte[]` ä½œä¸ºå‚æ•°çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚
2.  **æ”»å‡»ï¼š** æ”»å‡»è€…æ„é€ æ¶æ„çš„ HTTP POST è¯·æ±‚ã€‚
3.  **è¯·æ±‚å¤´éƒ¨ï¼š** è®¾ç½® `Content-Length` å¤´éƒ¨ä¸ºä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼ˆä¾‹å¦‚ 2^31 - 1ï¼‰ã€‚
4.  **è¯·æ±‚ä½“ï¼š** å‘é€ä¸€ä¸ªå¾ˆå°çš„è¯·æ±‚ä½“ï¼ˆä¾‹å¦‚ 1 å­—èŠ‚ï¼‰ã€‚
5.  **ç»“æœï¼š** Spring Framework ä¼šæ ¹æ® `Content-Length` çš„å€¼åˆ†é…å¤§é‡çš„å†…å­˜ï¼Œä½†å®é™…çš„æ•°æ®é‡å¾ˆå°ã€‚å¦‚æœæ”»å‡»è€…å‘é€å¤§é‡è¿™æ ·çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨çš„å†…å­˜å°†è¢«è€—å°½ï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚

**é¡¹ç›®åœ°å€:** [funcid/CVE-2024-38828](https://github.com/funcid/CVE-2024-38828)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-38828](https://nvd.nist.gov/vuln/detail/CVE-2024-38828)

---



---

