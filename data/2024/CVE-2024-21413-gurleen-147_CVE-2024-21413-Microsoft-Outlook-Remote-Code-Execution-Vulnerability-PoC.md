## CVE-2024-21413 - Microsoft Outlook / Microsoft Office RCE (远程代码执行)

**漏洞编号:** CVE-2024-21413

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Outlook / Microsoft Office

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Microsoft Office 2016, Office 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise

**利用条件:** 无需身份验证，攻击者通过发送包含恶意MonikerLink的电子邮件，受害者在预览窗格或打开邮件时触发漏洞。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC展示了被称为'MonikerLink'的攻击向量，利用了Outlook在处理file://协议链接时的逻辑缺陷。有效性体现在其成功绕过了Outlook内置的受保护视图（Protected View）和安全限制。通过在链接末尾添加特殊字符（如'!'），攻击者可以诱使Outlook将该链接视为复合文档链接，从而调用COM组件并在不触发安全警告的情况下尝试访问远程SMB共享。这种行为会导致两个核心安全问题：首先，它会触发NetNTLMv2身份验证，使攻击者能够捕获用户的NTLM哈希（如POC中Responder工具所示）；其次，在某些条件下，由于COM对象的处理机制，可能导致远程代码执行。POC代码逻辑清晰，使用了标准的smtplib进行邮件投递，并明确指出了如何修改攻击机与受害机的IP配置，证明了漏洞的可重复性。利用步骤：1. 攻击者准备一台运行Responder的Linux主机以监听SMB流量。2. 编写Python脚本构造包含恶意链接（例如 file://攻击者IP/test!exploit）的HTML邮件。3. 通过SMTP服务器将邮件发送至目标Outlook用户。4. 受害者仅需打开或预览该邮件。5. Outlook自动尝试连接远程SMB路径，Responder捕获受害者的NetNTLMv2哈希。投毒风险分析：该POC代码主要基于Python标准库（smtplib）编写，逻辑透明，未发现混淆代码或可疑的二进制下载行为。代码中明确引用了上游开发者CMNatic的开源项目，符合安全研究社区的规范。风险点在于该POC所引用的外部环境（如TryHackMe Lab）是受控的，但在野外传播时，攻击者可能将此类简单的Python发信脚本与恶意Payload生成器集成。目前POC本身是安全的，属于合法的安全研究范畴。分析过程中未发现恶意后门植入，主要代码功能仅限于发送特制邮件以触发SMB回连。建议防御者在测试时，务必在隔离的网络环境中使用，防止NTLM哈希意外泄露到公网。从防御角度看，应重点监测网络层面的SMB（445端口）出站连接以及邮件网关中包含'!'字符的file://链接。

**项目地址:** [https://github.com/CMNatic/CVE-2024-21413](https://github.com/CMNatic/CVE-2024-21413)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
