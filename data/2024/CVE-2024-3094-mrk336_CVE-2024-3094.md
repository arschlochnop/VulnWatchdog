## CVE-2024-3094 - XZ Utils (liblzma) 供应链攻击 / 后门 (Supply Chain Backdoor)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击 / 后门 (Supply Chain Backdoor)

**影响应用:** XZ Utils (liblzma)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统需安装受影响版本的XZ Utils，且通常涉及通过liblzma链接的远程公开服务（如sshd），攻击者需持有特定的私钥。

**POC 可用性:** 4/10

**POC 类型:** 概念验证 / 示例说明

**攻击复杂度:** 高

**投毒风险:** 20%

## 详情

【POC有效性分析】该提供的POC代码是一个高度简化的模拟逻辑，并非XZ后门事件中真实的复杂二进制混淆载荷。真实漏洞涉及复杂的IFUNC挂钩、多层解密载荷以及对OpenSSH身份验证流程的深度干扰。此处的POC代码通过修改`src/compress.c`并在`xz_compress`函数中注入硬编码的SSH密钥写入逻辑（`/home/admin/.ssh/authorized_keys`），仅用于演示攻击者如何篡改源码以获得持久化访问。在实际生产环境中，这种明文注入极易被静态审计工具和代码扫描发现，其有效性仅限于教学演示。它验证了供应链攻击的核心概念：即通过篡改基础库，在下游应用（如SSH服务）中引入未经授权的访问权限。然而，由于该POC直接操作文件系统且缺乏原版漏洞中的身份验证保护，任何拥有该库的用户都可能面临安全威胁。利用步骤包括：1. 获取XZ源码；2. 应用该补丁；3. 编译并替换系统中的liblzma库；4. 触发压缩操作以触发文件写入逻辑。该POC证明了开发者对构建流程失去控制的严重后果。【投毒风险分析】此特定POC代码的投毒风险评级为20%。风险主要来源于其自动向`~/.ssh/authorized_keys`追加内容的恶意行为。如果一个不具警惕性的安全研究员在生产环境或未隔离的开发机上编译运行此POC，其系统账户将被植入后门。虽然代码逻辑清晰且未包含混淆，不属于典型的『投毒代码』（即旨在感染下载者的恶意软件），但其行为本质上是破坏性的。由于代码中使用了`fopen`和`fwrite`直接修改敏感系统文件，这符合恶意软件的持久化特征。然而，考虑到其作为防御性研究文档的一部分，且代码逻辑完全透明，对于有经验的研究员来说风险可控。建议仅在完全隔离的沙盒或虚拟机环境中运行此类带有文件操作逻辑的POC，并严禁在任何连接到生产网络的机器上部署编译后的库文件。防御者应重点关注包管理器的签名校验，防止此类篡改后的二进制文件进入软件分发链。

**项目地址:** [https://github.com/xzdev/xz](https://github.com/xzdev/xz) (仅为POC参考路径)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
