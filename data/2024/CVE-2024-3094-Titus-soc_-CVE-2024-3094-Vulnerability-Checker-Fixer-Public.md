## CVE-2024-3094 - XZ Utils / liblzma 供应链攻击/后门植入/远程代码执行(RCE)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门植入/远程代码执行(RCE)

**影响应用:** XZ Utils / liblzma

**危害等级:** 紧急 (Critical)

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的系统运行特定的Linux发行版(通常为Debian/Fedora/openSUSE等测试版或非稳定版)，且该系统对外开放了SSHD服务。攻击者通过特定的Ed448公钥触发后门，绕过SSH认证执行任意命令。

**POC 可用性:** 3/10

**POC 类型:** 仅说明/防御性脚本

**攻击复杂度:** 高

**投毒风险:** 10%

## 详情

CVE-2024-3094是一个复杂的供应链攻击。攻击者Jia Tan通过长期潜伏，在XZ Utils的5.6.0和5.6.1版本中植入了恶意代码。其核心逻辑在于，在构建过程中，利用高度混淆的脚本修改了liblzma的源代码，在RSA_public_decrypt函数中注入了钩子(Hook)。当SSHD服务链接到受污染的liblzma库时，攻击者可以通过特定的数据包触发后门。POC有效性分析：本输入中提供的脚本并非漏洞利用工具(Exploit)，而是一个防御性的加固脚本(Security Hardening Script)，旨在检测并修复受影响的版本。该脚本通过包管理器检查xz版本，识别是否为5.6.0或5.6.1，并尝试回滚或升级到稳定的5.4.6版本。从防御角度看，该脚本逻辑清晰，使用了标准的Shell命令，不具备攻击性。真正的漏洞利用POC在公开渠道极为罕见，因为其触发机制依赖于特定的加密签名验证，且只在满足特定条件的glibc和SSHD环境中生效。利用步骤：1. 识别目标系统是否安装了5.6.0/5.6.1版本的liblzma。2. 确认SSHD是否动态链接了liblzma。3. 攻击者发送经过特制的Ed448公钥认证请求。4. 后门拦截认证过程，验证攻击者身份后，将请求中的负载直接作为系统命令执行。投毒风险分析：针对所提供的POC代码(由Aloke Majumder编写的脚本)，其投毒风险极低，约为10%。代码逻辑完全透明，主要操作为版本比对和利用系统自带包管理器(apt/dnf/zypper)进行软件更新，未见任何混淆、外部恶意下载(除SourceForge官方源码地址外)或敏感信息回传行为。然而，对于CVE-2024-3094本身而言，其‘投毒’发生在源码分发阶段。攻击者在测试用例中隐藏了二进制‘随机’数据，这些数据在编译时被解密并织入目标库文件，这种混淆手段极难被传统扫描器发现。在分析此类漏洞的POC时，研究员需格外警惕那些声称能够‘一键检测’但包含不可读二进制文件或执行curl/wget下载未知脚本的工具，因为该漏洞本身就是一种投毒艺术，防御者很容易成为二次投毒的目标。

**项目地址:** [https://github.com/alokemajumder](https://github.com/alokemajumder)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
