## CVE-2024-3094 - xz-utils (liblzma) 供应链后门 / 远程代码执行 (RCE)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门 / 远程代码执行 (RCE)

**影响应用:** xz-utils (liblzma)

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的xz-utils版本被编译进支持systemd通知的sshd，且暴露在互联网上。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 高

**投毒风险:** 15%

## 详情

POC有效性分析：本POC（xzk8s）提供了一个基于Docker和Kubernetes的复现环境。它通过使用包含恶意xz-utils（版本5.6.0/5.6.1）的Debian镜像，并结合LD_PRELOAD技术加载特定的liblzma.so补丁文件来模拟漏洞环境。该POC的有效性在于它成功规避了原始后门中硬编码的攻击者公钥限制。原始后门仅允许持有特定私钥的攻击者触发远程代码执行，而此POC引用的xzbot项目通过替换二进制文件中的公钥，使得研究人员可以使用自定义私钥进行认证。利用步骤如下：1. 构建或拉取包含漏洞库的Docker镜像；2. 部署Pod并利用LD_PRELOAD强制加载带后门的liblzma动态库；3. 使用kubectl进行端口转发，将容器22端口映射至本地；4. 运行xzbot等利用脚本，通过构造特定的ED448签名数据包发送至sshd，绕过身份验证并执行命令。投毒风险分析：该POC本身具有较低的直接投毒风险，其目的是防御性安全研究。项目结构清晰，代码逻辑直接，使用了标准的Dockerfile和K8s清单文件，不包含恶意的二阶下载器或代码混淆。然而，风险主要集中在其依赖的外部资源上，例如从第三方GitHub仓库拉取的已打补丁的二进制文件（liblzma.so.5.6.0.patch）。此类二进制文件难以审计，可能被第三方植入额外的恶意行为。在投毒分析中，我们注意到该项目虽然没有主动尝试感染宿主机，但其演示的LD_PRELOAD技术正是恶意软件常用的持久化和劫持手段。对于企业内部研究人员，建议仅在受控的沙箱环境中使用此类预编译的补丁文件。代码中包含硬编码的root凭据（root123）仅用于环境初始化，不属于恶意投毒范畴，但整体利用链条依赖于不受控的外部二进制，这构成了一定程度的安全隐患。

**项目地址:** [https://hub.docker.com/r/r0binak/xzk8s](https://hub.docker.com/r/r0binak/xzk8s)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
