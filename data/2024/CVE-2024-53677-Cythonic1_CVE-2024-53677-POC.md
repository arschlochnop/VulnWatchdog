## CVE-2024-53677 - Apache Struts RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE

**影响应用:** Apache Struts

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2.0.0 to < 6.4.0

**利用条件:** 目标系统需开启文件上传功能，且使用的是受影响的Struts版本（S2-067）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC针对Apache Struts CVE-2024-53677（S2-067）设计，这是一处由于文件上传逻辑缺陷导致的路径穿越漏洞。通过分析提供的Go代码，POC构造了一个多部分表单请求（multipart/form-data），利用Struts在处理文件上传参数时的漏洞，通过操控上传文件名参数（如top.UploadFileName）并注入路径穿越字符（../），将恶意的JSP文件上传到Web服务器的可访问目录（如webroot）。POC代码逻辑完整，涵盖了从参数配置、路径探测到最终Payload执行的完整闭环。代码中定义了详细的结构体`Cmd`用于配置URL、Endpoint、LFI参数及Payload参数，使用了Go标准库`net/http`和`mime/multipart`，未引用任何第三方可疑依赖。其核心逻辑在于通过`Upload`函数模拟上传过程，通过`testLocation`函数验证文件是否成功写入。该POC具备极高的实战价值，能够自动化完成漏洞检测与利用。利用步骤：1. 准备恶意JSP脚本（默认为shell.jsp）；2. 使用go run执行POC，指定目标URL和文件上传接口（-end-point）；3. POC将通过路径穿越将shell.jsp上传至服务器；4. 访问上传后的JSP路径以执行系统命令。该POC的成功率取决于服务器的目录权限及JSP解析配置。【投毒风险分析】经过对POC源码的详细审计，未发现明显的恶意行为或投毒迹象。首先，代码结构清晰，使用了标准的Go编程实践，没有经过任何混淆或加密处理，这与常见的投毒脚本（通常伴随Base64混淆、动态下载远程Payload等行为）有本质区别。其次，POC引用的库均为Go原生标准库，如`net/http`、`os`、`flag`等，不存在供应链投毒风险。再次，其主要功能集中在向目标服务器发送HTTP POST请求，未发现针对执行者本地机器的敏感信息提取动作（如读取~/.ssh或环境变量）。此外，开发者在README中明确说明了默认Payload为GIF格式，这是一种规避简单WAF检测的常规安全研究手段。虽然README中提到了一个外部博客链接（SonicWall）和一个外部Docker镜像，但这些均为知名的安全社区资源。代码中的测试逻辑仅用于验证漏洞存在性，不会在本地系统植入后门。综合评估，该POC属于高质量、透明度高的防御性安全研究工具，投毒风险极低，仅为10%，主要风险点在于用户需自行下载外部JSP Payload，建议在使用前对自定义的Payload文件进行二次审计。

**项目地址:** [https://github.com/Cythonic1/CVE-2024-53677-POC](https://github.com/Cythonic1/CVE-2024-53677-POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
