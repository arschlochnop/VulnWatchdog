## CVE-2024-3094 - xz-utils (liblzma) 供应链攻击 / 注入后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击 / 注入后门

**影响应用:** xz-utils (liblzma)

**危害等级:** 严重 (CRITICAL)

**CVSS评分:** 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统需运行受影响版本的xz-utils，且通常需要sshd服务处于运行状态并链接了liblzma库。

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 高

**投毒风险:** 15%

## 详情

POC有效性分析：提供的代码片段主要包含一个Dockerfile和Makefile，其核心目的并非直接利用CVE-2024-3094的后门，而是作为一个实验环境，用于演示IFUNC（Indirect Function）的性能和行为特征。CVE-2024-3094的真实后门通过极其复杂的混淆手段隐藏在xz源码的测试文件中，利用M4宏和GCC扩展在编译时注入。该POC代码展示了如何检测CPU特性以及IFUNC的调用开销，这与漏洞利用中使用的‘劫持符号’技术在底层机制上是一致的。然而，这段代码本身并不包含触发后门的Payload，也不具备远程代码执行的能力，其有效性仅限于学术研究和底层机制验证。在真实的防御性研究中，该环境可以用来观察动态链接器如何处理被污染的库函数，但无法直接验证后门的触发条件。利用步骤：1. 在受影响的Linux发行版上安装xz-utils 5.6.0/5.6.1版本。2. 后门通过build-to-host.sh脚本在打包过程中注入，这通常在构建RPM或DEB包时触发。3. 恶意的.o文件被链接到liblzma中。4. 当sshd启动并调用liblzma时，后门会替换RSA_public_decrypt等关键函数。5. 攻击者通过特定的SSH证书握手包触发恶意代码，实现无需认证的远程执行。投毒风险分析：该POC代码本身表现为低风险。Dockerfile和Makefile内容透明，主要依赖标准的Debian软件仓库安装开发工具（build-essential, gdb, vim等），不存在混淆代码或外部恶意服务器的请求。代码中虽然涉及底层指令探测，但均为合法的性能测试逻辑。尽管如此，考虑到CVE-2024-3094本身就是一种极其隐蔽的投毒攻击，研究者在获取此类POC时必须保持警惕。目前的POC并未发现包含类似Jia Tan注入的二进制测试文件或经过多层混淆的shell脚本，因此在隔离的容器环境中使用是安全的。由于该漏洞的特殊性，任何声称能‘一键触发’的第三方二进制POC都应被视为极高投毒风险，可能包含针对研究者环境的二次后门。本环境代码清晰，无恶意行为，投毒风险评级为15%，主要源于对底层调试工具调用的常规审计需求。

**项目地址:** [https://github.com/tukaani-project/xz](https://github.com/tukaani-project/xz)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
