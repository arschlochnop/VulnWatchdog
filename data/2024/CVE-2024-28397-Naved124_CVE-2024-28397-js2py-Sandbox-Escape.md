## CVE-2024-28397 - js2py 沙箱逃逸

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 沙箱逃逸

**影响应用:** js2py

**危害等级:** 严重

**CVSS评分:** 待定，参考NIST

**影响版本:** 所有版本，在修复前

**利用条件:** 需要执行JavaScript代码的能力

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2024-28397是一个存在于js2py中的沙箱逃逸漏洞。js2py是一个流行的Python包，用于在Python解释器中执行JavaScript代码，常被网络爬虫用于解析网站上的JavaScript代码。此漏洞源于js2py中全局变量的实现，允许攻击者获取对js2py环境中Python对象的引用，从而逃脱JS环境并执行任意Python代码。该漏洞允许攻击者在服务器上执行任意命令，可能导致数据泄露、系统入侵或其他恶意活动。

POC有效性分析：
提供的PoC代码通过利用`js2py`的全局变量和对象属性访问机制，成功地逃逸了沙箱环境。PoC首先定义了一个JavaScript payload，该payload利用`Object.getOwnPropertyNames`来获取对象的属性，然后通过`__getattribute__`来访问Python对象的内部属性。该payload的核心在于`findposten`函数，该函数递归地搜索`subprocess.Popen`类，一旦找到，就使用它来执行任意命令。PoC代码执行`head -n 1 /etc/passwd`、`calc`、`gnome-calculator`、`kcalc`等命令，验证了漏洞的存在。Python部分的`test_poc`函数验证了/etc/passwd的内容是否出现在结果中，从而确认了漏洞利用的成功。提供的PoC代码结构清晰，注释完整，易于理解和复现。

利用步骤：
1. 安装`js2py`库：`pip install js2py`。
2. 运行提供的Python脚本`Proof of Concept.py`。脚本将执行JavaScript payload，该payload尝试逃逸沙箱并执行命令。
3. 验证脚本的输出。如果脚本输出"Success! the vulnerability exists for python ..."，则表示漏洞存在。

投毒风险分析：
该PoC的投毒风险较低，因为PoC代码主要使用了标准库（如`js2py`和`subprocess`），并且没有包含任何混淆代码或恶意行为。该PoC的主要目的是演示沙箱逃逸漏洞，而不是执行恶意攻击。然而，仍然存在一些潜在的风险。例如，攻击者可能会修改PoC代码，使其执行更具破坏性的命令，或者将PoC代码嵌入到恶意网站或应用程序中。此外，由于PoC代码使用了`subprocess.Popen`来执行命令，因此存在命令注入的风险。如果攻击者能够控制`cmd`变量的内容，则可以执行任意命令。尽管存在这些风险，但总体来说，该PoC的投毒风险较低（约为15%），因为其主要目的是演示漏洞，而不是实施攻击。风险主要来自潜在的滥用或修改PoC代码的行为，建议在使用和传播PoC代码时保持警惕，并采取适当的安全措施。

**项目地址:** https://github.com/Marven11/CVE-2024-28397-js2py-Sandbox-Escape

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-28397
