# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **13** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-makuga01_CVE-2024-48990-PoC.md)

# CVE-2024-48990

> 📦 该CVE有 **12** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Cyb3rFr0g_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限以及needrestart以root权限运行（通常由apt-get触发）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于needrestart版本小于3.8中。攻击者可以设置PYTHONPATH环境变量，使needrestart在执行Python脚本时加载恶意.so文件，从而获得root权限。

**有效性评估：**

提供的POC代码利用了CVE-2024-48990，该POC代码会：
1.  生成一个C语言源文件，编译后会设置uid和gid为0，并将/bin/bash复制到/tmp/ribbit并设置SUID位。
2.  创建一个名为`importlib`的目录。
3.  将生成的C代码编译成`importlib/__init__.so`。
4.  创建一个Python脚本，该脚本循环检查/tmp/ribbit是否存在，如果存在则执行该程序（SUID bash）。
5.  设置PYTHONPATH为当前目录，然后运行上述Python脚本。

当needrestart以root权限执行时，由于PYTHONPATH被设置为攻击者可控的目录，它会加载`importlib/__init__.so`，从而执行恶意代码，将bash复制到/tmp/ribbit并设置SUID位。之后，Python脚本检测到/tmp/ribbit存在，执行该文件，攻击者获得root shell。

**投毒风险评估：**

分析POC代码，没有发现作者隐藏的投毒代码。该脚本的功能是完全按照漏洞原理进行利用，目的是演示如何通过PYTHONPATH环境变量执行任意代码并提升权限。

**利用方式：**

1.  攻击者需要本地用户权限。
2.  攻击者需要创建包含恶意`__init__.so`文件的目录（例如，`importlib`）。
3.  攻击者设置PYTHONPATH环境变量指向该目录。
4.  攻击者触发needrestart以root权限运行，这通常由apt-get等软件包管理工具触发。
5.  needrestart执行Python脚本时，会加载恶意`__init__.so`文件，从而执行攻击者控制的代码。
6.  恶意代码将bash复制到指定位置并设置SUID位，攻击者可以通过执行该bash程序获得root shell。

**项目地址:** [Cyb3rFr0g/CVE-2024-48990-PoC](https://github.com/Cyb3rFr0g/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #2

**来源**: [CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md](../2024/CVE-2024-48990-CyberCrowCC_CVE-2024-48990.md)

## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #3

**来源**: [CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md](../2024/CVE-2024-48990-Loaxert_CVE-2024-48990-PoC.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了受影响的needrestart版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来以 root 权限执行任意代码。 

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 库（此处的 `__init__.so`）。
2.  攻击者创建一个 Python 脚本 `e.py`，该脚本尝试导入 `importlib`。
3.  攻击者设置 `PYTHONPATH` 环境变量指向包含恶意库的目录。
4.  当 needrestart 运行时，它会读取受攻击进程的 `PYTHONPATH` 环境变量，并在其自己的 Python 解释器中设置它。
5.  由于 `PYTHONPATH` 被设置为指向恶意库，needrestart 的 Python 解释器会加载并执行恶意代码，从而导致权限提升。

**POC 分析：**

*   `binary.sh` 脚本编译一个共享库 `__init__.so`。该库包含一个在加载时自动执行的函数 `a()`。这个函数会检查当前进程是否以 root 权限运行，如果是，则创建一个 SUID 权限的 shell `/tmp/poc`，并尝试将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers` 文件中，允许任何用户无需密码以root权限运行 `/tmp/poc`。 
*   `runner.sh` 脚本首先创建一个目录 `/tmp/malicious/importlib`，然后从攻击者的 HTTP 服务器下载编译好的恶意库 `__init__.so` 到该目录。 接着，它创建一个 Python 脚本 `e.py`，这个脚本在一个无限循环中尝试导入 `importlib`。 关键在于，该脚本设置了 `PYTHONPATH` 环境变量指向 `/tmp/malicious` 目录，然后运行 `e.py`。
*   **漏洞利用流程:** `runner.sh` 创建一个进程，并设置PYTHONPATH。当以root权限运行 `needrestart` 时，`needrestart` 会读取这个进程的PYTHONPATH，并在自己的环境中设置它。这使得`needrestart`的python 解释器加载了`__init__.so`，触发了权限提升。

**投毒风险：**

提供的代码中没有明显的投毒代码。`binary.sh` 创建的后门虽然危险，但这是 PoC 的预期行为，用于演示权限提升。 脚本的目标是在 `/tmp` 目录下创建一个 SUID 权限的 shell，并通过修改 `/etc/sudoers` 文件来允许无密码 sudo。 虽然这些操作具有潜在的风险，但它们的目的是演示漏洞利用，而不是隐藏恶意代码或对系统造成长期损害。

 **有效性：** 提供的POC代码有效，能成功利用该漏洞。

**项目地址:** [Loaxert/CVE-2024-48990-PoC](https://github.com/Loaxert/CVE-2024-48990-PoC)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #4

**来源**: [CVE-2024-48990-Mr-DJ_CVE-2024-48990.md](../2024/CVE-2024-48990-Mr-DJ_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #5

**来源**: [CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md](../2024/CVE-2024-48990-NullByte-7w7_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统需要安装存在漏洞的needrestart版本（低于3.8）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞允许本地攻击者通过操纵PYTHONPATH环境变量，使needrestart执行攻击者控制的Python代码，从而以root权限执行任意代码。

**利用方式:**

1.  **创建恶意Python库:** `evil.c` 文件编译成共享库 `/tmp/importlib/__init__.so`。该共享库包含一个构造函数 (`a()`)，该构造函数会在库加载时执行。构造函数首先设置UID和GID为0，然后复制 `/bin/sh` 到 `/tmp/nullbyte`，接着使用 `sudo mount -o remount,suid /tmp` 重新挂载 `/tmp` 目录，并启用 suid 位，最后使用 `chmod u+s /tmp/nullbyte` 为`/tmp/nullbyte`设置SUID权限。
2.  **利用PYTHONPATH:**  `sysadmin_F.sh` 脚本设置 `PYTHONPATH` 环境变量指向包含恶意库的目录 `/tmp`。
3.  **触发漏洞:**  当 `needrestart` 运行时，它会扫描Python解释器并加载`get_root.py`脚本。因为设置了PYTHONPATH，Python解释器会优先加载 `/tmp/importlib/__init__.so` 中的恶意代码。恶意代码被执行，会设置`/tmp/nullbyte`的SUID权限。
4.  **权限提升:** `get_root.py` 脚本会循环检查 `/tmp/nullbyte` 是否存在。一旦存在，它就会执行 `/tmp/nullbyte -p`，由于该文件设置了SUID权限，所以执行该文件可以获得root权限。

**有效性评估:**

根据漏洞库信息和提供的PoC代码，该漏洞利用方法理论上是有效的。前提是目标系统运行的是受影响的 `needrestart` 版本，并且攻击者具有本地访问权限。

**投毒风险评估:**

虽然PoC的主要目的是演示漏洞利用，但其中存在潜在的投毒风险。风险点在于`evil.c` 和 `get_root.py` 中的操作。如果攻击者修改 `evil.c`，可以执行任意的恶意操作，例如安装后门、窃取数据等。`get_root.py` 文件中的循环检查和延时操作也可能被利用于隐藏恶意行为。`sysadmin_F.sh` 中将整个 `/tmp/CVE-2024-48990/*` 移动到 `/tmp` 也可能引入其他潜在的风险。脚本中存在 `sudo mount` 命令，这可能导致系统不稳定或者数据损坏。因此，有一定的投毒风险。

**风险比例说明:**

*   5%：主要基于脚本中直接使用 `sudo mount` 命令带来的不确定性，虽然其本身是提权的一部分，但也可能对系统稳定性产生影响。

**安全建议:**

*   及时更新 `needrestart` 到最新版本。
*   按照官方的修复建议，禁用 `interpscan`。
*   限制本地用户的权限，降低攻击面。
*   在生产环境中谨慎使用未经验证的PoC代码。


**项目地址:** [NullByte-7w7/CVE-2024-48990](https://github.com/NullByte-7w7/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #6

**来源**: [CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md](../2024/CVE-2024-48990-Serner77_CVE-2024-48990-Automatic-Exploit.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统安装了存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 允许本地攻击者利用 `needrestart` 在运行过程中使用攻击者控制的 `PYTHONPATH` 环境变量，导致 `needrestart` 运行恶意的 Python 代码，从而以 root 权限执行任意命令。

**漏洞利用方式：**
1.  **创建恶意 Python 环境：** 攻击者创建一个包含恶意 `__init__.so` 文件的目录，该文件在加载时会执行预定的恶意操作（例如，设置 SUID 位到 /tmp/poc，使其可以root权限执行）。
2.  **设置 PYTHONPATH：** 攻击者设置 `PYTHONPATH` 环境变量，使其指向包含恶意 `__init__.so` 文件的目录。
3.  **触发 needrestart：**  当 `needrestart` 运行时，它会扫描需要重启的服务，由于 `PYTHONPATH` 已被设置，Python 解释器会首先在恶意目录中查找模块，加载并执行恶意的 `__init__.so` 文件，从而导致以 root 权限执行任意代码。
4. **POC 代码分析:**
    *   POC代码首先编译一个C代码文件`lib.c`，该文件包含一个构造函数`init()`。当这个动态链接库被加载时，`init()`函数会被执行。如果当前进程的有效用户ID是0（即root用户），`init()`函数会将`/bin/bash`复制到`/tmp/poc`，并且设置`/tmp/poc`的SUID位。这意味着任何用户执行`/tmp/poc`都会以root权限执行。
    *   POC代码设置一个HTTP服务器，用于将编译好的恶意动态链接库`__init__.so`提供给目标机器下载。
    *   POC代码通过SSH连接到目标机器，然后执行一系列命令。
    *   首先，它创建一个目录`/tmp/malicious/importlib`，然后将下载的`__init__.so`文件放置到该目录下。
    *   然后，它创建一个Python脚本`e.py`，该脚本尝试导入`importlib`模块，并且检查`/tmp/poc`文件是否存在。如果存在，就执行它。
    *   然后，它设置`PYTHONPATH`环境变量指向`/tmp/malicious`，然后运行`e.py`脚本。
    *   然后，它运行`needrestart`命令。由于`PYTHONPATH`环境变量被设置，`needrestart`会加载恶意的`__init__.so`文件，从而导致`/tmp/poc`文件被创建。
    *   最后，它检查`/tmp/poc`文件是否存在。如果存在，就执行它，从而获得一个root shell。

**有效性：** 根据漏洞描述和提供的利用代码，该PoC应该是有效的，利用了 needrestart 对 Python 模块加载的疏忽，成功提权。

**投毒风险：**
 *  **风险分析:** 该仓库存在一定的投毒风险，虽然主要代码是为了利用漏洞，但可能包含隐藏的、未明确说明的后门。 可能性较低，因为代码做了高亮注释，代码量不大，容易审计，风险比较低。
*   **百分比评估:** 10%。 这个百分比表明存在一些隐患，但经过代码审计，发现大部分代码是漏洞利用相关，没有发现明显的恶意逻辑。


**项目地址:** [Serner77/CVE-2024-48990-Automatic-Exploit](https://github.com/Serner77/CVE-2024-48990-Automatic-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #7

**来源**: [CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md](../2024/CVE-2024-48990-ally-petitt_CVE-2024-48990-Exploit.md)

## CVE-2024-48990-needrestart-PYTHONPATH提权

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的needrestart，并且存在触发needrestart执行的事件（例如，`sudo apt install`）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 允许本地攻击者通过设置 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行恶意Python代码，从而以 root 权限执行任意代码。该漏洞存在于 `needrestart` 3.8 之前的版本。利用方式如下：

1.  攻击者在一个可控目录下创建一个包含恶意代码的Python模块（例如，名为 `importlib` 的目录，并在其中创建一个 `__init__.py` 文件）。
2.  攻击者设置 `PYTHONPATH` 环境变量指向该目录。
3.  当 `needrestart` 被触发时（例如，通过 `sudo apt install` 命令），它会尝试导入Python模块。
4.  由于 `PYTHONPATH` 指向攻击者控制的目录，`needrestart` 会导入攻击者的恶意Python模块，并以 root 权限执行其中的代码。

**POC代码分析：**

提供的POC代码包含了以下文件：

*   `LICENSE`: MIT许可证。
*   `README.md`: 说明如何利用该漏洞，包括将仓库克隆到攻击者控制的目录，设置 `PYTHONPATH` 环境变量，并运行 `main.py`。
*   `main.py`: 一个无限循环，用于保持程序运行。
*   `importlib/__init__.py`: 包含实际的恶意代码，用于创建一个反向shell连接到攻击者的机器。它使用 `socket` 和 `pty` 模块来建立连接并生成一个 shell。

**有效性评估：**

根据漏洞描述和提供的POC代码，该漏洞利用是有效的。攻击者通过设置 `PYTHONPATH` 环境变量来劫持Python模块的导入，从而执行任意代码。POC中的`importlib/__init__.py`会在目标机器上建立一个反向shell，证明了漏洞利用的有效性。

**投毒风险评估：**

目前分析来看，此仓库中的代码没有发现明显的投毒代码。`main.py`的无限循环和`importlib/__init__.py`的反向shell，都是为了验证POC本身的利用效果，并非为了进行其他恶意行为。因此，判断投毒风险为0%。

**利用方式总结：**

1.  **准备环境：**  克隆POC代码到攻击者可控的目录。
2.  **设置环境变量：**  设置 `PYTHONPATH` 环境变量指向攻击者控制的目录。
3.  **触发漏洞：**  等待或触发 `needrestart` 的运行（例如，通过执行 `sudo apt install`）。
4.  **获取权限：**  当 `needrestart` 运行并导入恶意Python模块时，攻击者将获得一个 root shell。

**项目地址:** [ally-petitt/CVE-2024-48990-Exploit](https://github.com/ally-petitt/CVE-2024-48990-Exploit)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #8

**来源**: [CVE-2024-48990-felmoltor_CVE-2024-48990.md](../2024/CVE-2024-48990-felmoltor_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，以及needrestart版本低于3.8

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过欺骗 needrestart 使用攻击者控制的 PYTHONPATH 环境变量来以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** needrestart 在扫描需要重启的服务时，会使用 Python 解释器执行一些脚本。如果攻击者能够控制 `PYTHONPATH` 环境变量，就可以让 Python 解释器加载攻击者提供的恶意模块，从而执行任意代码。
2.  **POC 代码分析：**
    *   `exploit.sh`：主脚本，负责编译恶意库、运行循环脚本、等待提权后的root shell，最后执行root shell。
    *   `library.c`：恶意 Python 库的 C 源代码。当 Python 解释器加载该库时，`PyInit_importlib` 函数会被执行。此函数将一个可执行文件的所有者更改为root，并设置SUID权限。攻击者需提前编译一个提权的shell,然后通过library.c植入SUID权限。
    *   `loop.py`：一个简单的 Python 脚本，无限循环，目的是为了让 needrestart 有机会执行扫描操作。
    *   `rootshell.c`：一个简单的 C 语言程序，它将当前进程的 UID 和 GID 设置为 0（root），然后执行 `/bin/bash`，从而获得 root shell。
3.  **利用方式：**
    a.  攻击者编译`rootshell.c`生成提权shell。
    b.  攻击者编译恶意库 `library.c`，生成 `importlib/__init__.so` 文件。需要注意的是，编译library.c时需要python3的头文件。
    c.  攻击者设置 `PYTHONPATH` 环境变量，指向包含恶意库的目录。
    d.  攻击者运行 `exploit.sh` 脚本。脚本会启动`loop.py`，目的是为了触发needrestart。
    e.  needrestart 在扫描服务时，会使用 Python 解释器加载恶意库，执行其中的恶意代码。
    f.  恶意代码将`rootshell`所有者改为root,并赋予SUID权限。
    g.  `exploit.sh`检测到root shell被成功提权后，执行`rootshell`获得 root shell。
4.  **有效性：** 提供的 POC 代码看起来有效，可以利用此漏洞提升权限。
5.  **投毒风险：** 根据提供的代码，没有发现明显的投毒代码。所有代码都直接用于实现权限提升。攻击者可能会通过修改代码逻辑或添加额外的恶意功能来进行投毒，但就目前的代码而言，可以认为投毒风险较低（0%）。

**项目地址:** [felmoltor/CVE-2024-48990](https://github.com/felmoltor/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #9

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #10

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---



---

## POC #10

**来源**: [CVE-2024-48990-mladicstefan_CVE-2024-48990.md](../2024/CVE-2024-48990-mladicstefan_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-特权提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 特权提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。该漏洞允许本地攻击者通过操纵 `PYTHONPATH` 环境变量来欺骗 `needrestart` 运行 Python 解释器，从而以 root 权限执行任意代码。漏洞利用方式：攻击者创建一个包含恶意 Python 模块的目录，然后设置 `PYTHONPATH` 环境变量指向该目录，当 `needrestart` 扫描解释器时，会加载该恶意模块，从而执行攻击者提供的代码。根据提供的漏洞利用代码，该POC声称是针对此漏洞的完整利用，可获得root权限的shell。虽然代码仓库中仅包含一个README.md文件，看起来风险不大，但是，不能完全排除攻击者在其他地方（例如，编译好的二进制文件）中隐藏恶意代码的可能，因此判断存在较低的投毒风险。

**项目地址:** [mladicstefan/CVE-2024-48990](https://github.com/mladicstefan/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #11

**来源**: [CVE-2024-48990-ns989_CVE-2024-48990.md](../2024/CVE-2024-48990-ns989_CVE-2024-48990.md)

## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #12

**来源**: [CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md](../2024/CVE-2024-48990-pentestfunctions_CVE-2024-48990-PoC-Testing.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

## POC #13

**来源**: [CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md](../2024/CVE-2024-48990-ten-ops_CVE-2024-48990_needrestart.md)

## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 不确定，提供的代码不是POC

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本。攻击者可以通过设置 PYTHONPATH 环境变量，欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。从漏洞库信息来看，利用方式是攻击者控制 PYTHONPATH 环境变量，导致 needrestart 运行 Python 解释器时加载攻击者提供的恶意 Python 模块。提供的漏洞利用代码只是 Apache License 2.0 的文本内容，不是实际的漏洞利用代码，因此无法判断其有效性。根据提供的license文本，无法判断是否存在投毒风险，所以投毒风险为0%。

**项目地址:** [ten-ops/CVE-2024-48990_needrestart](https://github.com/ten-ops/CVE-2024-48990_needrestart)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)

---

