# CVE-2024-1086

> 📦 该CVE有 **8** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-1086-Alicey0719_docker-POC_CVE-2024-1086.md](../2024/CVE-2024-1086-Alicey0719_docker-POC_CVE-2024-1086.md)

## CVE-2024-1086 - Linux Kernel Use-After-Free in nf_tables

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升至 root

**影响版本:** 3.15 到 6.8-rc1 之间的 Linux Kernel 版本

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 nf_tables 组件中的一个 Use-After-Free 漏洞，攻击者可以利用此漏洞将普通用户权限提升到 root 权限。 

**有效性:** 根据搜索引擎结果和漏洞库信息，此漏洞已经被公开利用，存在可用的PoC。

**投毒风险评估:**

*   **Dockerfile:** 用于构建包含漏洞环境的 Docker 镜像。安装了构建工具和依赖，并从 GitHub 克隆了漏洞利用代码。
*   **README.md:** 提供了漏洞利用的说明和示例，包括如何使用 Docker Compose 启动环境，以及如何执行漏洞利用程序。
*   **compose.yaml:** 定义了 Docker Compose 服务的配置，包括添加 SYS_ADMIN 能力、禁用 seccomp 以及以特权模式运行容器。

这些配置是为了确保漏洞利用程序能够正常运行,提高root权限, 因此不属于恶意投毒代码。

虽然代码库本身是为了利用漏洞，但其中潜藏的风险在于：

1.  **第三方依赖：** Dockerfile 使用了来自 github.com/Notselwyn/CVE-2024-1086 的代码。虽然目前看来是 PoC 代码，但如果作者未来修改仓库，加入恶意代码，使用者在不知情的情况下构建镜像并执行，可能会受到影响。
2.  **滥用权限:**compose.yaml 中的 `privileged: true` ,`cap_add: - SYS_ADMIN`,`security_opt: - seccomp:unconfined` 配置会使容器拥有极高的权限，如果容器被攻破，攻击者可以利用这些权限对宿主机造成更大的危害。

综上，该代码库本身是合法的PoC，用于演示和利用漏洞。但是，潜在的风险在于第三方依赖和滥用权限，因此需要谨慎使用。综合来看，投毒风险较低，大概为10%。

**利用方式：**

1.  **漏洞触发:** `nft_verdict_init()` 函数允许将正值作为 hook verdict 中的 drop error。在 `nf_hook_slow()` 函数中，当使用类似于 `NF_ACCEPT` 的 drop error 发出 `NF_DROP` 时，会导致 double free 漏洞。
2.  **权限提升:** 成功利用此漏洞后，攻击者可以将本地普通用户权限提升为 root 权限。
3.  **PoC 利用:**
    *   构建包含漏洞环境的 Docker 镜像。
    *   进入容器，执行编译好的漏洞利用程序。
    *   漏洞利用程序将触发 Use-After-Free 漏洞，最终获得 root 权限。

**总结:** 该漏洞利用方式通过精心构造的网络数据包，触发内核中的 Use-After-Free 漏洞，从而实现本地权限提升。PoC代码的有效性较高，但使用者应注意潜在的第三方依赖风险和滥用权限带来的安全隐患。

**项目地址:** [Alicey0719/docker-POC_CVE-2024-1086](https://github.com/Alicey0719/docker-POC_CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #2

**来源**: [CVE-2024-1086-CCIEVoice2009_CVE-2024-1086.md](../2024/CVE-2024-1086-CCIEVoice2009_CVE-2024-1086.md)

## CVE-2024-1086

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel (netfilter: nf_tables)

**危害等级:** 高危，本地权限提升

**影响版本:** v3.15 to v6.8 (不含已修复版本)

**利用条件:** 需要启用 nf_tables, user namespaces (CONFIG_USER_NS=y), 且 user namespaces 权限非特权 (sysctl kernel.unprivileged_userns_clone = 1)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter 组件 nf_tables 中的一个 use-after-free 漏洞。攻击者可以利用此漏洞实现本地权限提升。

**有效性评估：**

根据漏洞库信息和搜索引擎结果，该漏洞已被积极利用，存在公开的 PoC 代码。提供的漏洞利用代码仓库包含 Makefile、源代码 (src 目录) 和说明文档，表明这是一个可运行的漏洞利用程序。

**投毒风险评估：**

阅读了提供的 Makefile 文件，以及 src/main.c、src/env.c、src/net.c、src/nftnl.c、src/file.c 文件，发现整个漏洞利用代码利用了漏洞本身, 并未发现后门和恶意代码。

但是README中提及了“The kernel panic (system crash) after running the exploit is a side-effect which deliberately hasn't been fixed to prevent malicious usage of the exploit (i.e. exploitation attempts should now be more noticeable, and unpractical in real-world operations).” 意味着作者有意保留了导致内核崩溃的副作用，以防止恶意利用。这在某种程度上可以被视为一种“defense by denial”，但同时也可能给测试和调试带来不便。因此认为存在一定的投毒风险， 风险比例约为10%。

**利用方式：**

1.  **漏洞触发：** 通过构造特定的 nf_tables 规则，在 `nft_verdict_init()` 函数中设置一个正值的 drop error，并导致 `NF_DROP` 与类似于 `NF_ACCEPT` 的 drop error 一起被触发。
2.  **Use-After-Free：** 触发 `nf_hook_slow()` 函数中的 double free 漏洞，释放已经被释放的内存。
3.  **权限提升：** 利用 UAF 漏洞，通过内存布局控制等技术，覆盖内核数据结构，最终获得 root 权限。

总体来说，利用方式较为复杂，需要对 netfilter 和 nf_tables 的内部机制有深入的理解。

**项目地址:** [CCIEVoice2009/CVE-2024-1086](https://github.com/CCIEVoice2009/CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #3

**来源**: [CVE-2024-1086-LLfam_CVE-2024-1086.md](../2024/CVE-2024-1086-LLfam_CVE-2024-1086.md)

## CVE-2024-1086-Linux Kernel-Use-After-Free

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致本地权限提升

**影响版本:** 3.15 <= Kernel Version < 6.8

**利用条件:** 需要在本地执行代码，并且目标内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086是Linux内核netfilter: nf_tables组件中的一个use-after-free漏洞。根据漏洞库信息和搜索结果，该漏洞允许本地攻击者提升权限。漏洞存在于 `nft_verdict_init()` 函数，该函数允许将正值作为hook verdict中的drop错误，从而导致`nf_hook_slow()` 函数在NF_DROP与类似于NF_ACCEPT的drop错误一起发出时可能发生double free漏洞。

**有效性：**

根据提供的漏洞利用代码和搜索引擎结果，POC代码是有效的。 搜索引擎结果和CISA KEV都说明该漏洞已被积极利用，github上也存在poc。

**投毒风险：**

代码仓库中存在投毒代码的风险较低，约为10%。以下是分析依据：

*   **说明文字：** README.md文件说明了该代码仅用于学习目的，并引用了其他参考资料。
*   **编译方式：** 编译指令简单，直接使用gcc编译，没有隐藏的编译选项。
*   **代码逻辑：** exp.c文件中的代码主要涉及nftables的配置和数据包的发送，用于触发漏洞。
*   **可疑点：** CONFIG_STATIC_USERMODEHELPER_PATH="/sbin/usermode-helper" 可能会被恶意利用，因为 `usermode-helper` 用于执行用户空间的辅助程序，如果被篡改，可能导致执行恶意代码。然而，这个配置本身是内核的一个功能，不一定意味着投毒。
*   **Double Free WARNING：** 漏洞利用代码中出现了内核的Warning，说明触发了double free。

总体来看，该漏洞利用代码主要关注漏洞的利用，没有明显的恶意代码或者后门。但是，不能完全排除作者隐藏了细微的投毒代码的可能性。

**利用方式：**

1.  **环境准备：** 需要一个受影响的Linux内核版本(3.15 <= Kernel Version < 6.8)，安装libnftnl-dev和libmnl-dev依赖。
2.  **配置nftables：** 利用nftables API设置特定的规则和链，这些规则和链旨在触发漏洞。
3.  **触发Double Free：** 通过发送特定的数据包，例如精心构造的IP数据包，触发`nf_hook_slow()`中的double free漏洞。 这包括通过nftables配置，将NF_DROP 与类似于NF_ACCEPT的drop错误一起发出。
4.  **权限提升：** 成功触发use-after-free漏洞后，攻击者可以利用该漏洞来覆盖内核内存，从而实现权限提升（通常提升到root权限）。该步骤通常涉及内存布局的精确控制和ROP（Return-Oriented Programming）技术。

**缓解措施：**

升级到已修复的内核版本（>=6.8）是缓解此漏洞的最有效方法。 此外，可以限制对nftables的访问，并监控nftables规则的配置。

**项目地址:** [LLfam/CVE-2024-1086](https://github.com/LLfam/CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #4

**来源**: [CVE-2024-1086-Notselwyn_CVE-2024-1086.md](../2024/CVE-2024-1086-Notselwyn_CVE-2024-1086.md)

## CVE-2024-1086-Linux Kernel nf_tables Use-After-Free

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升

**影响版本:** v5.14 到 v6.6 (部分版本需要满足特定配置)

**利用条件:** 需要用户命名空间 (CONFIG_USER_NS=y)，用户命名空间非特权 (sysctl kernel.unprivileged_userns_clone = 1)，以及 nf_tables 启用 (CONFIG_NF_TABLES=y)。可能需要关闭WiFi。CONFIG_INIT_ON_ALLOC_DEFAULT_ON=n

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter: nf_tables 组件中的一个use-after-free漏洞，攻击者可以利用该漏洞实现本地权限提升。漏洞存在于`nft_verdict_init()`函数，该函数允许将正值作为 hook verdict 中的 drop 错误，因此当使用类似于 NF_ACCEPT 的 drop 错误发出 NF_DROP 时，`nf_hook_slow()`函数可能导致double free漏洞。

**有效性：**

根据漏洞信息和搜索结果，该漏洞存在已知的公开利用代码，并且已经被积极利用。提供的POC代码来自Notselwyn的GitHub仓库，该仓库提供了漏洞的详细信息、受影响版本以及使用说明。该POC被描述为通用本地权限提升exploit，适用于v5.14到v6.6的大多数Linux内核，包括Debian、Ubuntu和KernelCTF。作者声称在KernelCTF镜像中成功率高达99.4%。因此，提供的POC代码被认为是有效的。

**投毒风险：**

分析POC代码，发现作者在README.md中明确指出，利用该漏洞后会导致内核崩溃（system crash），并且刻意没有修复此问题，以防止恶意使用。这表明作者有一定安全意识，但并不能完全排除投毒风险。代码本身包含了Makefile、LICENSE、README.md和src目录，其中包含了C源代码。虽然这些代码看起来是用于漏洞利用，但仍然存在作者故意添加恶意代码的可能性。仔细检查代码，尤其是那些与提权相关的部分，没有发现明显的后门代码。投毒风险评估为5%，主要基于以下几点：

1.  作者明确表示存在故意未修复的内核崩溃问题，表明作者有一定的道德约束。
2.  代码结构清晰，功能明确，未发现隐藏的恶意逻辑。
3.  该漏洞本身已经足够强大，无需额外添加恶意代码来增强其危害。

**利用方式：**

1.  **触发漏洞：** 通过nf_tables配置，构造特定的netfilter规则，使得`nft_verdict_init()`函数使用正值作为drop错误，并且使用类似于NF_ACCEPT的drop错误发出NF_DROP。
2.  **Use-After-Free：** 这将导致`nf_hook_slow()`函数在释放已经释放的内存后再次释放，触发double free漏洞。
3.  **内存破坏：** Double free漏洞可以用来破坏内核内存的布局，例如，通过控制释放的内存，可以在内存中布置特定的数据结构。
4.  **权限提升：** 通过内存破坏，攻击者可以修改内核数据结构中的权限信息，例如，修改当前进程的cred结构，将UID和GID修改为0，从而获得root权限。
5.  **执行Shell：** 获得root权限后，攻击者可以执行任意命令，例如，启动一个root shell。

**项目地址:** [Notselwyn/CVE-2024-1086](https://github.com/Notselwyn/CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #5

**来源**: [CVE-2024-1086-feely666_CVE-2024-1086.md](../2024/CVE-2024-1086-feely666_CVE-2024-1086.md)

## CVE-2024-1086

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升

**影响版本:** 3.15 to 6.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter (nf_tables) 组件中的一个 use-after-free 漏洞。此漏洞允许本地攻击者提升权限。

**有效性：**
根据搜索引擎结果，该漏洞存在公开可用的 PoC (Proof of Concept) 代码，并且已被积极利用。

**投毒风险：**
提供的 POC 代码仅仅是一个 `README.md` 文件，不包含任何可执行代码。因此，不存在作者隐藏投毒代码的风险。 投毒风险评估为0%。

**利用方式：**
漏洞存在于 `nft_verdict_init()` 函数中，该函数允许正值作为 hook 判决中的 drop 错误。当使用带有类似 NF_ACCEPT 的 drop 错误的 NF_DROP 时，`nf_hook_slow()` 函数可能导致双重释放漏洞。

攻击者可以通过利用此漏洞，将普通用户权限提升到 root 权限。 具体利用方式涉及到 netfilter 和 nf_tables 的配置，构造特定的网络数据包触发漏洞，从而控制内核执行流程，实现权限提升。

**项目地址:** [feely666/CVE-2024-1086](https://github.com/feely666/CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #6

**来源**: [CVE-2024-1086-karim4353_CVE-2024-1086-Exploit.md](../2024/CVE-2024-1086-karim4353_CVE-2024-1086-Exploit.md)

## CVE-2024-1086 Linux Kernel nf_tables Use-After-Free 本地提权漏洞

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升至root

**影响版本:** 3.15 <= Kernel Version < 6.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter: nf_tables 组件中的一个use-after-free漏洞，攻击者可以利用此漏洞实现本地权限提升。漏洞存在于`nft_verdict_init()`函数中，该函数允许正值作为hook判决中的drop error。因此，当`NF_DROP`与类似于`NF_ACCEPT`的drop error一起发出时，`nf_hook_slow()`函数可能导致double free漏洞。

**有效性:**
根据搜索引擎结果，该漏洞已经被公开披露，并且存在公开的PoC（概念验证）代码。CISA KEV 目录中也包含了此漏洞，表明它正在被积极利用。因此，可以判断该漏洞是有效的。

**投毒风险:**
提供的“漏洞利用代码”实际上是一个项目模板，而非直接可用的exploit。该项目鼓励安全研究，但明确声明不接受恶意代码，只允许在受控环境下进行测试。然而，依然存在投毒风险的可能性，比如在提交的代码中，不明显地加入恶意payload，或者通过复杂的逻辑绕过检查。风险评估为10%，主要基于以下几点：
*   项目声明的非恶意性质，提高了投毒的道德风险。
*   代码贡献需要经过审核，增加了投毒的难度。
*   贡献者可能通过混淆代码或利用项目框架的复杂性来隐藏恶意代码。

**利用方式:**
1.  **漏洞点：** `nft_verdict_init()` 函数允许不正确的drop error值。
2.  **触发条件：** 当 `NF_DROP` 与一个特殊的、类似于 `NF_ACCEPT` 的 drop error 一起使用时。
3.  **漏洞结果：** 在 `nf_hook_slow()` 函数中触发 double free。
4.  **利用步骤：** 攻击者需要构造特定的 nf_tables 规则，触发漏洞，然后利用 double free 漏洞来控制内存，最终实现权限提升。PoC 需要创建精心构造的 nf_tables 规则来触发 UAF，然后分配释放的内存来覆盖内核数据结构，从而获得 root 权限。实际利用可能涉及复杂的内存布局和堆喷射技术。

该漏洞的成功利用需要对 Linux 内核网络子系统和内存管理机制有深入的理解。

**项目地址:** [karim4353/CVE-2024-1086-Exploit](https://github.com/karim4353/CVE-2024-1086-Exploit)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #7

**来源**: [CVE-2024-1086-kevcooper_CVE-2024-1086-checker.md](../2024/CVE-2024-1086-kevcooper_CVE-2024-1086-checker.md)

## CVE-2024-1086 Linux Kernel Use-After-Free 特权提升

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** 3.15 to < 6.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-1086 是 Linux Kernel netfilter nf_tables 组件中的一个 use-after-free 漏洞，攻击者可以利用此漏洞将普通用户的权限提升到 root 权限。

**有效性分析：**
根据漏洞库信息、搜索结果，以及提供的 checker 脚本，可以确认此漏洞的 POC 是有效的。Checker 脚本可以检测目标系统是否满足漏洞利用的配置条件，多个搜索结果表明该漏洞存在公开的利用代码，且已被积极利用。

**投毒风险分析：**
提供的代码是一个checker脚本，用于检测系统是否存在漏洞，而不是漏洞利用代码本身。 检查器脚本本身功能单一,通过读取多个`/proc`文件和`/boot/config-*`文件,来判断当前内核配置是否容易受到攻击。

*   `LICENSE` 和 `README.md` 文件内容正常，没有发现恶意代码。
*   `check_cve_2024_1086.py` 脚本主要用于检测内核版本和配置，以确定系统是否容易受到 CVE-2024-1086 攻击。脚本逻辑相对简单，主要是读取 `/proc` 和 `/boot/config-*` 文件，没有发现明显的恶意行为。

因此，该仓库中存在投毒代码的可能性较低，大约为 5%。

**利用方式分析：**
1.  **触发漏洞：**  `nft_verdict_init()` 函数允许将正值作为 hook verdict 中的 drop 错误，导致 `nf_hook_slow()` 函数在 NF_DROP 与类似于 NF_ACCEPT 的 drop 错误一起发出时，可能发生双重释放漏洞。
2.  **利用UAF：** 攻击者通过精心构造的 netfilter 规则，触发 use-after-free 漏洞。当释放后的内存被再次访问时，攻击者可以控制该内存的内容。
3.  **权限提升：**  通过控制释放后内存的内容，攻击者可以覆盖内核数据结构，从而劫持内核控制流，最终实现本地权限提升。

总而言之，此漏洞利用难度较高，需要对内核网络协议栈 netfilter 以及内存管理机制有深入的了解，但由于存在公开的 POC 且已被实际利用，因此风险等级较高。

**项目地址:** [kevcooper/CVE-2024-1086-checker](https://github.com/kevcooper/CVE-2024-1086-checker)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

## POC #8

**来源**: [CVE-2024-1086-xzx482_CVE-2024-1086.md](../2024/CVE-2024-1086-xzx482_CVE-2024-1086.md)

## CVE-2024-1086 - Linux Kernel Use-After-Free

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel (netfilter: nf_tables)

**危害等级:** 高危，本地权限提升

**影响版本:** 3.15 <= version < 6.8 (部分打了补丁的分支除外，具体见描述)

**利用条件:** 需要用户命名空间(CONFIG_USER_NS=y)，且用户命名空间是非特权的(sysctl kernel.unprivileged_userns_clone = 1)，以及nf_tables启用(CONFIG_NF_TABLES=y)。 此外，x64/amd64架构。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter 组件 nf_tables 中的一个 use-after-free 漏洞。攻击者可以利用此漏洞实现本地权限提升。根据漏洞库信息，`nft_verdict_init()`函数允许将正值作为 hook verdict 中的 drop error。因此，当使用类似于 NF_ACCEPT 的 drop error 发出 NF_DROP 时，`nf_hook_slow()`函数可能导致 double free 漏洞。

**有效性：** 根据搜索结果，该漏洞存在公开可用的PoC利用代码，并且已被积极利用。提供的漏洞利用代码仓库包含`src/main.c`, `src/env.c`, `src/net.c`, `src/nftnl.c`, `src/file.c` 等源文件，以及编译脚本 `Makefile`，说明这是一个完整的 PoC 代码，并且README中说明了成功率。

**投毒风险：** 漏洞利用代码本身是为了利用漏洞，存在一定的风险。但是通过代码审计，并没有发现明显的恶意代码或者后门，考虑到作者公开了全部源代码，并且该漏洞本身是为了本地提权，攻击者需要首先在目标机器上运行代码，因此投毒意义不大。 但是存在通过修改利用代码，造成拒绝服务等情况。因此，投毒风险评估为 10%。

**利用方式：**

1.  **触发漏洞：** 通过创建特定的 nf_tables 规则，并设置特定的 drop error，触发 use-after-free 漏洞。
2.  **利用use-after-free：**  利用该漏洞，覆盖或修改内核内存中的数据。
3.  **权限提升：**  最终目的是将普通用户的权限提升为 root 权限。

**项目地址:** [xzx482/CVE-2024-1086](https://github.com/xzx482/CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)

---

