## CVE-2024-53677 - Apache Struts2 远程代码执行 (RCE)

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts2

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2.0.0 至 6.3.0.2 (不含 6.4.0 及以上)

**利用条件:** 无需认证，目标应用需开启文件上传功能且版本在受影响范围内，具有网络访问权限。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：提供的Python脚本展示了一个针对Apache Struts2文件上传逻辑漏洞的典型利用。该POC的核心在于利用了Struts2在处理多部分文件上传请求时的路径遍历缺陷。脚本通过构造一个特殊的`multipart/form-data`请求，其中包含一个名为`Upload`的文件项和一个通过`top.UploadFileName`参数注入的路径遍历序列（../../SHELL.jsp）。在受影响的版本中，底层逻辑未能正确校验或清理上传文件的目标路径，导致原本应存储在临时目录的文件被重定向写入到Web根目录下。POC中巧妙地结合了PNG/JPG头部绕过技术，将JSP Webshell内容附加在合法的二进制图片头部（JPG_HEAD）之后，这可以有效规避某些仅检查文件头部的基础防御机制。利用步骤：1. 攻击者准备包含恶意JSP代码的文件，并在其头部附加JPG幻数以伪装成图片。2. 使用`requests`库向目标URL的上传接口（如/upload.action）发送POST请求。3. 在请求中，利用参数注入（如top.UploadFileName）修改文件存储路径，强制将文件写入Web可访问目录。4. 脚本随后尝试访问新生成的SHELL.jsp文件。5. 如果响应状态码为200，说明Webshell部署成功，攻击者可通过cmd参数执行系统命令。该POC逻辑清晰，结构完整，覆盖了从漏洞触发到后门植入的闭环过程。投毒风险分析：该脚本主要使用了Python的标准库`argparse`和第三方知名库`requests`。代码逻辑完全透明，不包含任何经过Base64编码、Hex转义或混淆处理的可疑字符串。其包含的JSP Webshell是典型的教学演示代码，用于验证远程代码执行能力，并不具备隐蔽的持久化或反弹Shell等高威胁恶意特征。代码中没有发现任何通过`eval()`、`exec()`动态执行外部下载Payload的行为，也没有发现窃取本地凭证或扫描局域网的操作。唯一的网络交互是针对用户指定的目标URL。根据评分标准，该POC属于高度可信的防御性研究样本。尽管如此，在复杂的攻防场景下，由于其使用了简单的JPG头部填充，虽然是为了绕过检查，但也提醒研究人员在使用此类EXP时应在受控环境中运行。整体投毒风险极低，其危害性仅限于针对目标系统的攻击功能本身，对运行该脚本的防御人员设备没有副作用。

**项目地址:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
