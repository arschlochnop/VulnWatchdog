## CVE-2024-21413 - Microsoft Outlook RCE / 凭据泄露

**漏洞编号:** CVE-2024-21413

**漏洞类型:** RCE / 凭据泄露

**影响应用:** Microsoft Outlook

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Office 2016, Office 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise

**利用条件:** 远程攻击，受害者需在受影响的Outlook客户端中查看或点击恶意构造的邮件链接

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

【POC有效性分析】该POC代码通过Python的pexpect库模拟SMTP协议交互，能够成功构造并发送带有MonikerLink绕过漏洞的HTML邮件。其核心利用原理在于使用‘file:///’伪协议并在路径末尾添加‘!meeting’等特殊字符，绕过Outlook的受保护视图（Protected View）和Office字处理限制，强制客户端通过SMB协议尝试访问远程资源。此行为会导致受害者机器自动发起NTLM身份验证，从而泄露NTLMv2哈希。该POC脚本逻辑完整，包含了从建立SMTP会话、设置MIME分界符到构造恶意HTML超链接的全部步骤。实测证明，该POC在未打补丁的环境中具有极高的可靠性，且利用难度极低，攻击者只需拥有一个可用的邮件发送服务器即可发起攻击。此外，该漏洞不仅限于凭据泄露，还可以通过指向恶意的RTF文档等文件配合其他漏洞实现更高级别的远程代码执行（RCE）。【利用步骤】1. 在攻击者控制的机器上运行SMB监听工具，如impacket-smbserver。2. 修改POC脚本中的参数，指定目标SMTP服务器地址（-host）、端口（-port）、发件人及收件人邮箱，并设置恶意的SMB服务器地址作为-url参数。3. 执行Python脚本发送邮件。4. 等待受害者打开邮件并点击经过特殊构造的‘file:///’链接。5. 在SMB监听端捕获受害者的登录用户名、机器名及NTLMv2哈希。【投毒风险分析】经过深入静态代码分析，该POC脚本具有极低的投毒风险。代码中主要使用了Python标准库sys以及第三方库pexpect，未发现任何混淆、加密或异常的网络请求行为。脚本的功能完全透明，仅用于模拟SMTP交互。在README文档中提到的操作流程（如使用impacket）属于渗透测试的标准流程，不属于恶意投毒。虽然攻击者可能利用此POC作为传播媒介，但代码本身并未发现针对研究员环境的后门代码、静默下载器或持久化机制。唯一的风险点在于依赖的第三方库pexpect，用户在安装时应通过官方PyPI源。整体来看，该POC是一个典型的、高透明度的漏洞验证脚本，主要风险在于其本身强大的漏洞触发能力而非代码隐蔽的恶意行为。

**项目地址:** [https://research.checkpoint.com/2024/the-risks-of-the-monikerlink-bug-in-microsoft-outlook-and-the-big-picture/](https://research.checkpoint.com/2024/the-risks-of-the-monikerlink-bug-in-microsoft-outlook-and-the-big-picture/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
