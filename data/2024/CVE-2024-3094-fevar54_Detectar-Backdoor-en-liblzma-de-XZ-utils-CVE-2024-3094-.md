## CVE-2024-3094 - XZ Utils (liblzma) 供应链攻击/后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门

**影响应用:** XZ Utils (liblzma)

**危害等级:** 致命 (Critical)

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的系统需运行基于 systemd 且包含受损 liblzma 的 OpenSSH 服务 (sshd)

**POC 可用性:** 4/10

**POC 类型:** 检测脚本/规则

**攻击复杂度:** 高

**投毒风险:** 5%

## 详情

【POC有效性分析】该漏洞实质上是一个极其复杂的供应链攻击，由名为 Jia Tan 的攻击者在两年时间内通过潜伏、获取维护者权限并最终植入恶意混淆代码实现。输入的POC代码并非漏洞的利用脚本（Exploit），而是一条基于特征码的YARA检测规则。该规则针对 liblzma 库中的特定字节序列（f3 0f 1e fa ...）进行匹配。分析显示，该序列对应于后门中负责修改运行时函数指针的特定指令。从有效性角度看，该POC在静态分析环境下对特定版本的编译产物具有较高的检出率，但由于后门仅在特定编译环境（x86_64 Linux）和特定链接条件下（通过 systemd 链接到 sshd）才会被激活，单纯的静态特征匹配存在漏报或误报的可能性。实际利用步骤极为隐蔽，攻击者通过在测试用例文件中隐藏混淆的宏脚本，在编译阶段动态注入恶意逻辑，绕过常见的审计机制。该POC（YARA规则）对于安全研究人员进行系统合规性检查和受损程度评估具有重要的辅助价值，但不能替代动态的行为监控。由于该漏洞的触发依赖于特定的 RSA 签名校验过程，普通的攻击者极难通过重现该漏洞来进行二次利用，因此其防御重点在于资产清查而非漏洞利用测试。 【利用步骤】1. 获取受影响版本（5.6.0或5.6.1）的 xz-utils 源代码包（tarball）。2. 在特定 Linux 发行版环境下执行编译。3. 恶意脚本在 m4 宏执行过程中提取隐藏在测试文件中的二进制片段。4. 在动态链接过程中，恶意代码修改 ELF 的 GOT（Global Offset Table）表，劫持 RSA_public_decrypt 函数。5. 攻击者发送特定签名的指令，绕过 sshd 的身份认证，获得远程代码执行权限。 【投毒风险分析】当前提供的 POC 代码本身投毒风险极低。该代码块是一个标准的 YARA 规则文件，主要包含元数据描述和用于匹配的 Hex 字符串。代码逻辑仅执行只读的字节序列对比，不包含任何网络请求、文件修改、自删除或执行系统指令的行为。代码中引用的链接为 Openwall 等知名安全社区，作者 Fernando Vargas 为已知安全研究贡献者。然而，对于广泛流传的 CVE-2024-3094 相关的所谓‘一键检测脚本’或‘快速补丁’，安全人员必须保持高度警惕。由于该漏洞本身就是一种供应链投毒，攻击者极有可能利用社区的恐慌心理，发布伪装成检测工具的恶意程序。这些工具可能包含混淆的 Shell 脚本，在执行时会外连攻击者的 C2 服务器，或者在检测过程中执行敏感信息收集（如 SSH 私钥、环境变量等）。本 JSON 中分析的 YARA 规则因其透明的文本格式和明确的规则逻辑，属于低风险范畴（5%），其风险仅在于可能由于特征库过期导致的误导性结论。

**项目地址:** [https://www.openwall.com/lists/oss-security/2024/03/29/4](https://www.openwall.com/lists/oss-security/2024/03/29/4)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
