## CVE-2024-3094 - xz-utils (liblzma) 供应链攻击/远程代码执行(RCE)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/远程代码执行(RCE)

**影响应用:** xz-utils (liblzma)

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的系统需运行由 systemd 启动的 sshd，且 liblzma 版本为 5.6.0 或 5.6.1

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 高

**投毒风险:** 10%

## 详情

【POC有效性分析】本POC提供了一个完整的实验室环境复现方案。该漏洞本质上是一次极度复杂的供应链投毒，攻击者通过在 xz-utils 的发布包（tarballs）中植入混淆的 M4 宏脚本，在编译阶段篡改 liblzma 库。POC有效性体现在其通过 Docker 模拟了 Fedora 38 环境，并手动执行了从源码编译、注入恶意逻辑到运行受污染 sshd 的全过程。POC中的 patch.py 和 inject.sh 模拟了原始漏洞中的二进制补丁过程，使得 liblzma 能够挂钩（Hook）到 RSA_public_decrypt 函数，从而在 SSH 认证阶段拦截并解密特定的恶意有效载荷，实现未经授权的远程代码执行。此POC不仅展示了利用逻辑，还包含了 Go 编写的攻击客户端（bot.go），能向目标发送带签名的指令，是目前已知最接近真实漏洞逻辑的开源分析项目之一。【利用步骤】1. 使用提供的 Dockerfile 构建 Fedora 38 容器环境，并安装必要的编译工具链。2. 获取 xz-utils 5.6.0 源码包并解压。3. 设置环境变量 RPM_ARCH，执行 configure 和 make 进行编译，生成 liblzma.so.5.6.0。4. 运行 patch.py 对生成的共享对象文件进行字节级修改，植入自定义公钥。5. 执行 inject.sh 将恶意库链接至系统路径。6. 在环境中启动 sshd 进程。7. 在攻击机端编译 bot.go，指定目标 IP 和端口，发送特定的加密指令触发执行。【投毒风险分析】作为专业的威胁情报分析，该 POC 项目本身的投毒风险较低，属于纯粹的防御性研究。代码结构透明，patch.py 仅对本地编译产生的 so 文件进行字节替换，不具备自动传播能力。其核心逻辑依赖于本地文件的显式操作。搜索结果中提及的原始漏洞（由 Jia Tan 提交的代码）具有极高的隐蔽性和投毒技巧，但本 POC 项目旨在复现该过程，代码中未发现混淆的下载脚本或后门回传。然而，由于该 POC 包含了完整的攻击客户端逻辑和预编译脚本，如果被初级攻击者（脚本小子）直接利用，可能导致针对特定受感染资产的恶意探测。研究员应注意，虽然项目安全，但其生成的 liblzma.so 产物严禁在任何生产环境中使用。POC 中使用的 Go 语言库均为 standard 库和公开的安全库（如 gopacket），未见恶意混淆或第三方未授权加载行为。

**项目地址:** [https://github.com/valeriot30/cve-2024-3094](https://github.com/valeriot30/cve-2024-3094)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
