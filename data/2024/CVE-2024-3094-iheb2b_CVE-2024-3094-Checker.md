## CVE-2024-3094 - XZ Utils (liblzma) 供应链攻击/后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门

**影响应用:** XZ Utils (liblzma)

**危害等级:** 严重

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的xz库被libsystemd等链接，且sshd服务在运行，攻击者需持有特定的Ed448私钥

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 高

**投毒风险:** 10%

## 详情

POC有效性分析：提供的脚本是一个典型的检测型POC（Checker）。它通过多重维度验证系统是否存在CVE-2024-3094漏洞。首先，脚本识别操作系统发行版（如Alpine, Arch），并提取xz-utils的精确版本号，检查其是否落在已知的受污染版本区间（5.6.0和5.6.1）。其次，它通过`ldd`命令动态分析`sshd`二进制文件，确认其是否加载了包含后门代码的`liblzma`库。最关键的有效性体现于其对特征字节码的检测：脚本使用`hexdump`提取`liblzma`中的特定十六进制序列（如f30f1efa...），这些序列是Jia Tan植入的恶意代码在内存中的具体表现。这种检测方式比简单的版本检查更可靠，因为它能识别出经过混淆但仍具备后门特征的库文件。脚本还包含了复杂的编码字符串比对，进一步降低了误报率。总体而言，该POC能够准确识别受感染环境，是防御性研究中极具价值的探测工具。利用步骤：1. 在目标系统上赋予脚本执行权限。2. 以root或具有读取系统库权限的用户运行脚本。3. 观察脚本输出，若`malicious_xz`、`lzma_found`以及字节模式匹配均为真，则确认系统已遭入侵。4. 根据检测结果决定是否需要降级xz版本或重新安装系统。投毒风险分析：该脚本本身具有极高的透明度，投毒风险较低，约为10%。分析其代码逻辑，主要使用了标准的系统命令如`apk`, `pacman`, `xz --version`, `ldd`, `grep`, `hexdump`和`awk`。这些操作均为只读性质的检测行为，不涉及向远程服务器发送数据、下载不明二进制文件或修改系统关键配置。脚本中定义的庞大十六进制字符串（pattern_encoded_strings）是用于静态比对的恶意代码特征码，而非执行载体，这符合安全研究员编写检测工具的规范。代码中未发现`eval`、base64混淆执行或隐藏的网络套接字请求。虽然脚本操作了敏感的系统库路径，但在防御性研究语境下，这种行为是必要且安全的。唯一的潜在风险在于脚本若从非官方渠道下载，攻击者可能在检测逻辑中注入恶意命令，但就目前展示的代码内容来看，其行为纯净，属于安全的防御性扫描脚本。

**项目地址:** [https://github.com/tukaani-project/xz](https://github.com/tukaani-project/xz)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
