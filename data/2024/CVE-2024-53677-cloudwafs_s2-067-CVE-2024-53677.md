## CVE-2024-53677 - Apache Struts 2 RCE/目录穿越

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE/目录穿越

**影响应用:** Apache Struts 2

**危害等级:** CRITICAL

**CVSS评分:** 9.8

**影响版本:** Apache Struts 2.0.0 - 2.5.33, 6.0.0 - 6.3.0.2

**利用条件:** 需要目标应用开启文件上传功能且未对上传参数进行严格限制

**POC 可用性:** 7/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：提供的Python脚本 Check-CVE-2024-53677.py 是一个针对CVE-2024-53677（S2-067）漏洞的无损检测工具。该漏洞的核心在于Apache Struts 2的文件上传逻辑缺陷，允许攻击者通过OGNL绑定（如top.uploadFileName）覆盖文件名，从而实现路径穿越。POC通过构造一个Multipart请求，在正常的上传字段外，增加了一个名为'top.uploadFileName'的字段，并将值设置为包含路径遍历符的'../../vuln_test.txt'。这种方法可以直接测试服务器是否允许操纵上传路径。如果服务器在响应中反射了修改后的文件名或表现出路径处理异常，则可判定漏洞存在。此POC虽然不包含最终的RCE载荷（如上传JSP webshell），但其核心逻辑——即利用OGNL覆盖上传元数据——是完全正确的，能够有效探测目标系统的易感性。由于其采用了requests_toolbelt库来精确控制Multipart边界，在实际渗透测试或防御验证中具有较高的可靠性。利用步骤：1. 确定目标系统中存在基于Struts 2的文件上传接口。2. 构造包含恶意OGNL参数的HTTP POST请求。3. 通过修改uploadFileName或类似的Action属性，将文件路径指向Web目录（如/webapps/app/shell.jsp）。4. 上传包含恶意代码的文件（如JSP木马）。5. 访问上传后的路径以触发远程代码执行。投毒风险分析：该POC代码表现出极高的透明度和安全性。首先，脚本使用的库均为Python社区公认的标准安全库，如requests和requests_toolbelt，未发现调用eval()、exec()或base64混淆执行等恶意特征。其次，代码逻辑清晰，其检测行为仅限于向目标URL发送一个包含特定字符串的测试文件，且使用了'vuln_test.txt'这类无害的测试名称，不具备自我复制或持久化留后门的功能。脚本中没有发现任何尝试外连未知IP、窃取本地环境变量或读取敏感文件（如/etc/passwd）的恶意代码块。开发者在注释中明确指出该检测为‘Non-destructive’（非破坏性），这与代码实际行为相符。综上所述，该POC的投毒风险极低，属于安全的防御性研究工具。防御者在部署时仍需注意，此类脚本虽本身无毒，但运行环境应保持隔离，以防在复杂生产环境中产生非预期的HTTP请求副作用。

**项目地址:** [https://cwiki.apache.org/confluence/display/WW/S2-067](https://cwiki.apache.org/confluence/display/WW/S2-067)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
