## CVE-2024-51793 - Computer Repair Shop (CRM) WordPress Plugin 任意文件上传导致RCE

**漏洞编号:** CVE-2024-51793

**漏洞类型:** 任意文件上传导致RCE

**影响应用:** Computer Repair Shop (CRM) WordPress Plugin

**危害等级:** 高危

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** <= 3.8116

**利用条件:** 无需身份验证，可直接通过wp-admin/admin-ajax.php发起网络请求

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该POC代码针对WordPress插件'Computer Repair Shop'（CRM）中的CVE-2024-51793漏洞。该漏洞源于wc_upload_file_ajax操作在处理文件上传时缺乏必要的安全过滤和身份验证，允许攻击者上传任意文件至服务器。POC代码结构完整，逻辑清晰。首先，Scan函数通过访问readme.txt文件获取插件版本信息，确认版本低于或等于3.8116。接着，Exploit函数构造一个POST请求，将名为'[随机数]*ktn.php'的Webshell上传至服务器。该Webshell被伪装成'image/png'内容类型，绕过了基础的文件检查。代码使用了findall正则匹配返回结果中的上传路径，并尝试访问该路径以确认Webshell执行成功。该Webshell具备简单的文件管理功能，支持通过POST方式上传后续攻击载荷。整体分析，该POC具备高度的自动化特征，能够快速扫描并利用目标漏洞，漏洞利用链路完整且有效。 利用步骤：1. 通过自动化工具或手动检查readme.txt文件确认目标是否安装了3.8116版本及以下的CRM WordPress插件。2. 构造一个发往wp-admin/admin-ajax.php?action=wc_upload_file_ajax的HTTP POST请求。3. 在multipart/form-data中添加名为'file'的字段，包含恶意的PHP脚本代码，并设置Content-Type为image/png。4. 从服务器响应中提取上传文件的URL。5. 访问该URL以执行恶意代码并获得系统权限。 投毒风险分析：经过对POC源代码的深度静态分析，该代码主要采用了Python的标准库（requests, argparse, concurrent.futures等），未发现常见的恶意投毒特征。代码中虽然包含了Webshell Payload（'kill_the_net'标识的PHP代码），但这是用于验证漏洞利用效果的必要组成部分，而非针对分析者本机的攻击行为。代码不涉及动态执行混淆过的Base64字符串，也没有向非目标域名发送敏感信息的行为。网络行为均集中在目标URL的处理上。唯一的风险点在于其使用了__import*_('warnings').simplefilter('ignore', Warning)来抑制SSL警告，这在安全研究脚本中是常见操作。此外，代码尝试在本地目录下创建'**shells**.txt'和'**vuln**.txt'用于存储成功利用的结果，属于正常的数据记录行为。考虑到其代码透明度高，逻辑直观，投毒风险评估为低（15%），该风险主要来自于攻击者可能对该POC进行二次修改后重新分发。建议安全研究人员在沙箱环境中运行此类POC，并对上传的Payload内容进行二次确认。

**项目地址:** [https://github.com/KtN-1990/CVE-2024-51793-POC](https://www.google.com/search?q=https://github.com/KtN-1990/CVE-2024-51793-POC)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-51793](https://nvd.nist.gov/vuln/detail/CVE-2024-51793)
