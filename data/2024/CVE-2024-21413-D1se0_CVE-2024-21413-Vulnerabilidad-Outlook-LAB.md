## CVE-2024-21413 - Microsoft Outlook / Office 2016 RCE/凭据泄露

**漏洞编号:** CVE-2024-21413

**漏洞类型:** RCE/凭据泄露

**影响应用:** Microsoft Outlook / Office 2016

**危害等级:** Critical

**CVSS评分:** 9.8

**影响版本:** Microsoft Office 2016 (MSI-based), Office 2019, Office 2021, Microsoft 365 Apps for Enterprise

**利用条件:** 需要远程攻击者发送构造的恶意邮件，受害者通过Outlook点击或预览包含file://协议链接的邮件内容

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

CVE-2024-21413，被称为‘MonikerLink’漏洞，是存在于Microsoft Outlook中的关键安全缺陷。该漏洞源于Outlook在处理特定构造的URI（特别是使用file://协议且包含‘!’字符的Moniker链接）时，未能正确验证输入，导致绕过了受保护视图（Protected View）和Office文档的热点限制。POC有效性分析：提供的POC代码展示了一个完整的攻击链。首先，它使用Python的smtplib构建一个包含精心设计的HTML超链接的电子邮件。该链接利用file://协议指向攻击者控制的远程服务器地址。当Outlook处理此类链接时，它会错误地尝试通过SMB协议访问该路径。在验证过程中，POC通过集成Responder工具来捕获受害者机器发起的SMB身份验证请求。这种利用方式高度有效，因为它利用了Windows处理网络路径的默认行为，能够直接导致受害者的NTLMv2哈希值泄露。此外，该漏洞不仅限于凭据窃取，还可以通过复杂的Moniker链组合实现远程代码执行（RCE），其利用门槛极低，只需受害者点击链接即可触发。利用步骤：1. 部署一个攻击者控制的SMB服务器或运行Responder工具。2. 配置Python利用脚本，填入SMTP服务器信息及发件人、收件人邮箱。3. 运行脚本发送包含恶意file://链接的邮件。4. 等待受害者打开邮件并点击链接。5. 在Responder终端查看捕获到的NTLM哈希值或通过进一步的Moniker链触发代码执行。 投毒风险分析：该POC项目主要由Python脚本和README文档组成，代码结构清晰。投毒风险分析显示其处于低风险水平（约15%）。代码中使用的库如rich、pyautogui、opencv-python属于标准自动化和UI测试库。虽然项目中提到了下载外部脚本startServicesWindows.py，且引用了pyautogui等可能被滥用于恶意行为的库，但在当前语境下，这些是为了自动化实验室环境的搭建（启动Outlook和hMailServer）。主要的攻击逻辑位于exploitSendEmailOutlook.py中，其代码逻辑直观，未发现明显的代码混淆、未授权的远程下载或隐藏的恶意Shellcode。然而，由于该POC涉及凭据捕获，防御者在下载和测试时应确保在隔离的沙箱环境中运行，防止在配置过程中误将真实的凭据信息泄露给脚本中硬编码的（如果有）或不小心配置的外部地址。整体而言，该仓库是一个用于教育和安全研究的合法工具集，并未发现蓄意投毒特征。

**项目地址:** /tmp/vulnwatchdog_e90c71f4bc7b7747617028ea72f3a28a/

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
