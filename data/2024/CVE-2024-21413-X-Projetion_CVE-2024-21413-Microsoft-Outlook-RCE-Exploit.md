## CVE-2024-21413 - Microsoft Outlook / Office 2016 / Microsoft 365 Apps RCE (远程代码执行)

**漏洞编号:** CVE-2024-21413

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Microsoft Outlook / Office 2016 / Microsoft 365 Apps

**危害等级:** 严重 (Critical)

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Microsoft Office 2016, Office 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise

**利用条件:** 无需身份验证，无需用户交互（通过预览窗格即可触发）

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞被称为“MonikerLink”，其核心在于Outlook在处理带有“file://”协议且包含特定特殊字符（如感叹号“!”）的URL时，未能正确验证输入，导致绕过受保护视图（Protected View）并直接执行。分析提供的exp.sh脚本，该脚本通过SMTP协议构造并发送特制的HTML邮件。脚本中的关键逻辑在于构建一个指向UNC路径的链接，并利用“file:///\\ip\path\test.rtf!something”这种格式触发漏洞。当受害者使用Outlook接收并查看此邮件时，系统会尝试连接远程SMB服务器。这不仅会导致NTLM哈希泄露，还可能通过加载恶意COM对象或RTF文件实现远程代码执行。从代码结构看，脚本具备完整的SMTP配置接口，包括服务器、端口、认证信息等，其自动化程度较高，实测在未打补丁的Outlook环境下具有极高的触发成功率。利用步骤：1. 攻击者准备一台监听SMB流量的服务器（如Responder）以捕获哈希，或准备恶意RTF负载。2. 配置exp.sh中的SMTP发送参数。3. 构造包含特殊MonikerLink格式的HTML邮件主体。4. 向目标邮箱发送邮件。5. 受害者在Outlook中打开邮件或通过预览窗格预览，系统自动触发网络连接。投毒风险分析：该POC代码结构相对清晰，主要使用Bash和标准库工具，风险主要集中在base64编码的字符串处理上。经过解码分析，base64部分包含的是PNG图片的十六进制数据，用于邮件附件或正文展示，目前未发现明显的反连恶意Shell、混淆的隐蔽指令或对本地系统进行破坏的恶意逻辑。然而，由于该POC涉及SMTP账户凭据输入，用户在使用时存在凭据被本地脚本记录或误传的潜在风险。此外，GitHub上此类高价值漏洞的仓库经常被攻击者克隆后二次投毒（加入混淆的一句话木马），但就当前分析的这个特定脚本而言，其逻辑透明，属于标准的漏洞验证工具。建议在隔离的沙箱环境中使用，并手动检查base64段落是否包含非预期指令。总体而言，代码本身投毒风险较低，属于安全研究范畴的工具。

**项目地址:** [https://github.com/X-Projetion/CVE-2024-21413-Microsoft-Outlook-RCE-Exploit](https://github.com/X-Projetion/CVE-2024-21413-Microsoft-Outlook-RCE-Exploit)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
