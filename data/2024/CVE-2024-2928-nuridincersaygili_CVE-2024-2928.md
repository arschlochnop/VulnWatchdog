## CVE-2024-2928 - MLflow Local File Inclusion

**漏洞编号:** CVE-2024-2928

**漏洞类型:** Local File Inclusion

**影响应用:** MLflow

**危害等级:** High

**CVSS评分:** N/A

**影响版本:** < 2.11.3

**利用条件:** 需要网络访问，目标端口开放

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2024-2928是MLflow中存在的一个本地文件包含漏洞。该漏洞允许攻击者读取服务器上的任意文件。POC代码利用了MLflow的api接口，通过构造恶意的artifact_location和source参数，可以绕过身份验证，从而读取目标文件。具体利用步骤如下：

1.  获取目标文件的绝对路径。
2.  使用POC脚本，指定目标MLflow服务器的地址和端口。
3.  脚本会提示输入要读取的文件路径，输入目标文件的绝对路径。
4.  脚本通过发送一系列POST请求到/ajax-api/2.0/mlflow/experiments/create、/api/2.0/mlflow/runs/create、/ajax-api/2.0/mlflow/registered-models/create和/ajax-api/2.0/mlflow/model-versions/create端点来创建实验和运行。
5.  最后，脚本发送一个GET请求到/model-versions/get-artifact端点，其中path参数设置为要读取的文件名，name和version参数设置为之前创建的实验的名称和版本。
6.  如果文件存在且可读，服务器将返回文件的内容。

POC的有效性分析：

POC代码是一个完整的利用程序，可以自动完成利用过程。该代码首先提示用户输入要读取的文件的路径，然后使用MLflow API创建实验和运行，最后使用/model-versions/get-artifact端点读取文件内容。代码的成功利用表明，该漏洞确实存在并且可以被利用。该POC在MLflow 2.9.2版本上测试成功。

投毒风险分析：

该POC代码主要通过构造恶意的HTTP请求来利用漏洞，代码本身没有明显的恶意行为。但是，如果攻击者使用该漏洞读取包含敏感信息的配置文件，例如数据库凭据或API密钥，则可能会导致更严重的后果。此外，攻击者可能会修改POC代码，使其能够执行任意代码，从而实现远程控制服务器的目的。此POC代码包含从用户处获取文件路径并将其传递给HTTP请求的步骤。虽然它本身不包含混淆或恶意行为，但它确实依赖于用户输入，这引入了一定程度的风险。攻击者可能会诱使用户输入指向恶意文件的路径，这些文件在被读取时可能会触发其他漏洞或泄露敏感信息。此外，该脚本使用requests库发送HTTP请求。虽然这是一个标准库，但如果服务器端点被攻破或被重定向到恶意服务器，可能会导致信息泄露或中间人攻击。

总体而言，该POC代码的投毒风险较低，大约为10%。主要风险在于用户输入的文件路径可能指向恶意文件，或者服务器端点可能被攻破。

**项目地址:** https://github.com/m1nus0ne/CVE-2024-2928

**漏洞详情:** N/A
