## CVE-2024-53677 - Apache Struts RCE (远程代码执行)

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Struts

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** Apache Struts 2.0.0 - 2.5.32, 6.0.0 - 6.3.0.1

**利用条件:** 目标应用需开启文件上传功能，且未应用S2-067补丁；攻击者需要网络访问权限，无需认证。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

POC有效性分析：该漏洞（S2-067）源于Apache Struts 2的文件上传逻辑缺陷。在处理multipart/form-data请求时，Struts未能正确过滤上传参数中的路径遍历序列。POC通过注入名为'top.uploadFileName'的参数，配合文件上传操作，将恶意JSP文件强制写入服务器的Web目录（如/webapps/）。分析POC代码发现，其逻辑非常直接：首先构造一个包含JSP WebShell的GIF伪装文件，然后通过multipart请求发送，并附带一个精心构造的参数名来实现路径偏移。这种利用方式在Struts 2的历史漏洞中较为罕见（通常为OGNL注入），但其效果非常致命，因为它绕过了Struts本身的Action映射机制，直接利用底层文件操作逻辑。POC中提供的Python脚本使用了requests_toolbelt来精确模拟分段请求，证明了该漏洞可以被高度自动化利用。经过对代码逻辑的审计，POC完全能够实现从文件上传到获取Webshell的闭环攻击，其成功率极高，且不依赖于特定的Web容器配置，只要存在写入权限即可成功。利用步骤：1. 识别目标系统中实现文件上传的Action URL。2. 准备一个包含Java后门代码的JSP文件，为了绕过基础校验可以添加GIF文件头。3. 构造multipart/form-data请求，其中一个Part为正常的上传文件，另一个Part的关键在于name属性设置为受影响的参数（如'top.uploadFileName'），其值包含路径遍历字符（如'../../webapps/shell.jsp'）。4. 发送请求，服务器会将JSP文件保存至预想的Web路径下。5. 通过浏览器访问新生成的.jsp地址，并带上cmd参数执行系统命令。投毒风险分析：该POC项目结构清晰，代码逻辑透明。主要的风险点在于python脚本引用的第三方库requests_toolbelt。通过静态分析exploit.py，目前未发现明显的混淆代码或恶意的后门注入行为。代码中包含典型的Python安全脚本编写规范，如参数化URL解析和异常处理。README和手动说明文档详细描述了漏洞原理，这通常是安全研究员分享知识的表现，而非攻击者投毒。然而，由于该漏洞属于高价值的RCE，且POC脚本可以直接运行，存在被二次打包并在非官方渠道流传时加入恶意代码的风险。当前版本的投毒风险被评定为低（15%），主要理由是：1. 代码中使用的库均为标准库或知名第三方库。2. 脚本中没有尝试连接不相关的外部C2服务器。3. 没有Base64混淆的exec或eval等可疑语句。建议防御者在受控环境中使用该POC进行验证，并始终核对requirements.txt中的镜像源安全性。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-53677](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-53677)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
