## CVE-2024-43400 - Jinja2 (Python 模板引擎) 代码执行/拒绝服务(ReDoS)

**漏洞编号:** CVE-2024-43400

**漏洞类型:** 代码执行/拒绝服务(ReDoS)

**影响应用:** Jinja2 (Python 模板引擎)

**危害等级:** 高危

**CVSS评分:** 7.5

**影响版本:** < 3.1.5

**利用条件:** 攻击者能够控制 Jinja2 模板内容或传入特定的恶意输入进行解析

**POC 可用性:** 4/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

【POC有效性分析】该提供的POC代码并不是一个直接触发CVE-2024-43400漏洞的利用脚本，而是一个基于Docker的漏洞扫描/检测框架（YASA引擎）。该框架试图通过静态代码分析（Static Analysis）的方式，利用'taint_flow_java_input'等规则来检测代码中是否存在该漏洞的特征。Dockerfile中包含了Debian基础镜像、Python环境以及多个二进制组件（如yasa-engine-linux-x64、uast4go等），这表明该POC实质上是一个集成的自动化审计工具。run.py脚本负责调用这些二进制引擎，并针对特定的Java文件（如StringClass.java）进行扫描。虽然它宣称与CVE-2024-43400相关，但由于CVE-2024-43400主要影响Python的Jinja2库，而POC中却出现了针对Java文件的扫描配置（example-rule-config/rule_config_cve_2024_43400_java.json），这种不一致性暗示该POC可能是通用的静态分析工具套壳，或者是在特定闭源环境下的定制化检测方案。对于研究人员而言，该POC无法直接演示漏洞的触发过程（如输入导致的服务崩溃或RCE），其有效性仅限于提供一种检测思路而非攻击利用。【利用步骤】1. 构建容器：通过Dockerfile构建包含YASA审计引擎的环境。2. 准备源码：将待检测的目标源码（通常是使用Jinja2的Python项目或POC中提及的Java文件）放入扫描路径。3. 执行检测：运行run.py脚本，脚本将调用yasa-engine对源码进行抽象语法树（UAST）分析。4. 结果输出：脚本会根据配置文件的规则，在/app目录下生成output.json，报告是否存在潜在的漏洞点。【投毒风险分析】该POC的投毒风险评级为低（10%）。风险点分析如下：1. 二进制黑盒：POC中引用了多个预编译的二进制文件（yasa-engine-linux-x64, uast4go, uast4py），这些文件在Docker构建过程中被赋予了执行权限（755）。由于二进制文件不透明，无法直接审计其是否包含窃取环境变量、SSH密钥或在宿主机建立反弹Shell的逻辑。2. 权限提升：Dockerfile以root权限运行，且脚本涉及文件读写，如果用户在运行容器时挂载了敏感的宿主机目录（如-v /:/mnt），则可能存在潜在的安全隐患。3. 静态代码分析：代码逻辑主要是调用子进程执行二进制文件并解析JSON，未见混淆代码、外部URL请求或典型的eval/exec恶意注入。4. 结论：虽然包含二进制文件，但其行为模式符合安全厂商发布的检测工具特征。建议在隔离的沙箱环境或虚拟机中使用，并限制容器的网络访问，以规避潜在的隐连风险。用户应谨慎对待此类非开源核心引擎的审计工具，避免在生产源码服务器上直接执行。

**项目地址:** [https://github.com/vulnwatchdog/docker-yasa-CVE-2024-43400](https://www.google.com/search?q=https://github.com/vulnwatchdog/docker-yasa-CVE-2024-43400)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-43400](https://www.google.com/search?q=https://nvd.nist.gov/vuln/detail/CVE-2024-43400)
