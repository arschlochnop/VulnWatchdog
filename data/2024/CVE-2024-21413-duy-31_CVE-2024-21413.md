## CVE-2024-21413 - Microsoft Outlook 远程代码执行 (RCE)

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Outlook

**危害等级:** 严重

**CVSS评分:** 9.8

**影响版本:** Microsoft Office 2016, 2019, 2021, 以及 Microsoft 365 Apps for Enterprise

**利用条件:** 攻击者向目标发送包含恶意构造的 MonikerLink 的邮件，用户需在受影响版本中通过预览窗格查看或打开邮件。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

【POC有效性分析】该POC（MonikerLink漏洞利用）显示出极高的实用性和有效性。它利用了Outlook在处理'file://'协议和特定Moniker对象时的安全绕过缺陷。通过在URL末尾添加'!'字符（如'file:///\\ip\test\file.txt!struct'），攻击者可以绕过受信任区域检查和Outlook的安全警告框。POC中包含的Expect脚本（cve-2024-21413.sh）通过Telnet协议直接与SMTP服务器交互，自动化构造并发送带有恶意链接的MIME格式邮件。该脚本不仅演示了如何触发NTLM凭据泄漏，还指出了通过链接CVE-2023-21716（RTF漏洞）实现远程代码执行的可能性。POC的代码逻辑清晰，通过模拟标准的SMTP会话（HELO, MAIL FROM, RCPT TO, DATA）来投递Payload，对安全研究人员评估内网环境中的凭据嗅探风险具有极高的参考价值。经分析，其利用路径覆盖了从邮件发送、SMB监听、到哈希捕获与破解的完整攻击链。【利用步骤】1. 部署攻击者控制的SMB服务器（如使用Responder或Impacket-smbserver）以监听入站认证请求。2. 准备符合SPF/DKIM/DMARC要求的发件环境。3. 执行Expect脚本，指定SMTP网关、发送者、接收者以及恶意的UNC路径URL。4. 目标用户在Outlook预览窗格中查看邮件并点击链接，系统将自动尝试通过SMB协议访问恶意路径。5. 攻击者在SMB服务端捕获用户的Net-NTLMv2哈希。6. 使用Hashcat等工具离线破解捕获的哈希以获取明文密码。【投毒风险分析】该POC代码包的投毒风险评级为低（10%）。代码主要由一个纯文本README文档和一个Expect脚本组成。分析cve-2024-21413.sh的内容，其逻辑完全基于合法的Expect自动化工具和Telnet协议进行网络交互，未发现任何二进制混淆、动态代码执行（如eval）或隐藏的系统级后门。脚本中的网络连接仅限于用户输入的参数值（$host $port），不存在硬编码的外部恶意C2连接。README中提供的截图与代码逻辑高度契合，链接均指向合法的GitHub资产或安全研究社区（CheckPoint、MSRC、LinkedIn）。风险点仅在于用户如果从非官方或第三方修改版下载该POC，可能会被植入恶意的Shell环境监控脚本，但就原始POC本身而言，代码透明度极高，属于标准的防御性安全研究工具。建议使用者在隔离环境运行，并审核Expect脚本的参数解析逻辑，以防在复杂Shell环境下发生命令注入风险。

**项目地址:** [https://github.com/duy-31/CVE-2024-21413](https://github.com/duy-31/CVE-2024-21413)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)
