## CVE-2024-3094 - xz-utils (liblzma) 供应链攻击/后门(Backdoor)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门(Backdoor)

**影响应用:** xz-utils (liblzma)

**危害等级:** CRITICAL

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用受影响版本的liblzma库，且通常涉及通过sshd服务触发。攻击者需要特定的私钥进行远程触发。

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 高

**投毒风险:** 15%

## 详情

POC有效性分析：提供的脚本名为CVE-2024-3094.sh，实质上是一个安全加固与防御脚本而非攻击性利用代码。该脚本通过检测系统中安装的xz-utils版本来识别是否存在潜在的后门风险（5.6.0和5.6.1版本）。脚本有效性极高，它不仅能自动识别操作系统（Debian/Ubuntu, RHEL/CentOS, OpenSUSE），还能根据包管理器的状态执行升级或回退到稳定版本（5.4.6）的操作。这种POC的价值在于防御验证，帮助管理员快速确认环境安全性并实施补救。利用步骤分析：1. 环境识别：脚本首先通过detect_os_and_package_manager函数识别Linux发行版。2. 版本检测：利用系统命令获取xz版本，避免直接执行可能被劫持的二进制文件。3. 风险评估：对比已知漏洞版本（5.6.0/5.6.1）。4. 修复实施：若发现漏洞版本，脚本尝试通过包管理器更新，若失败则通过编译或下载预编译的稳定版5.4.6进行替换。真正的漏洞利用步骤极为复杂，涉及在构建过程中通过复杂的混淆脚本修改liblzma的RSA_public_decrypt函数，从而允许持有特定私钥的攻击者绕过SSH认证实现远程代码执行（RCE）。投毒风险分析：该脚本（CVE-2024-3094.sh）本身的投毒风险较低，约为15%。其代码逻辑透明，主要使用标准的Shell命令（apt, dnf, yum, wget, tar）进行操作。代码中未发现明显的混淆、恶意外部链接或窃取敏感信息的行为。主要风险点在于其涉及从外部URL下载源码包（SourceForge链接），在供应链攻击的语境下，任何指向第三方二进制或源码包的行为都需审慎对待。虽然脚本声明为安全工具，但在生产环境执行前，应验证其下载链接的真实性，并确保脚本来源于受信任的作者（如Aloke Majumder）。该脚本明确标注了防御用途，不属于旨在破坏系统的恶意PoC投毒。真正的CVE-2024-3094本身就是史上最严重的供应链投毒案例，由维护者Jia Tan精心潜伏并在构建脚本中嵌入二进制后门，这种高度隐蔽的投毒方式是防御团队需重点关注的模式。

**项目地址:** [https://github.com/alokemajumder](https://github.com/alokemajumder)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
