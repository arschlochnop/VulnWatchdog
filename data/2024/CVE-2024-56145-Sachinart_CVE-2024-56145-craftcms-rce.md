# CVE-2024-56145

> ğŸ“¦ è¯¥CVEæœ‰ **2** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-56145-Chocapikk_CVE-2024-56145.md](../2024/CVE-2024-56145-Chocapikk_CVE-2024-56145.md)

## CVE-2024-56145 - Craft CMS RCE

**æ¼æ´ç¼–å·:** CVE-2024-56145

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)

**å½±å“åº”ç”¨:** Craft CMS

**å±å®³ç­‰çº§:** ä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨ç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** 3.0.0 < 3.9.14, 4.0.0-RC1 < 4.13.2, 5.0.0-RC1 < 5.5.2ï¼Œä¸”php.iniä¸­register_argc_argvé…ç½®å¼€å¯

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡Craft CMSç‰ˆæœ¬å—å½±å“ï¼ŒPHPé…ç½®å¼€å¯`register_argc_argv`ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-56145æ˜¯ä¸€ä¸ªCraft CMSä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å‡ºç°åœ¨`register_argc_argv` PHPé…ç½®é€‰é¡¹å¯ç”¨æ—¶ã€‚ æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ çš„payloadåˆ©ç”¨æ­¤æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ¼æ´åŸç†:** å½“`register_argc_argv`å¯ç”¨æ—¶ï¼ŒPHPä¼šå°†GET, POST, COOKIEç­‰æ•°æ®å¡«å……åˆ°`argv`å…¨å±€å˜é‡ä¸­ã€‚æœªç»è¿‡æ»¤çš„`argv`å˜é‡ä¼šè¢«Craft CMSç”¨äºæ¨¡æ¿è·¯å¾„çš„è§£æï¼Œä»è€Œé€ æˆå‘½ä»¤æ³¨å…¥ã€‚

2.  **åˆ©ç”¨æ­¥éª¤ (åŸºäºæä¾›çš„POCä»£ç ):**
    *   **è®¾ç½®ç¯å¢ƒ:** é¦–å…ˆï¼Œéœ€è¦åœ¨ç›®æ ‡ç³»ç»Ÿæˆ–æœ¬åœ°æ­å»ºä¸€ä¸ªå—å½±å“ç‰ˆæœ¬çš„Craft CMSï¼Œå¹¶ç¡®ä¿`register_argc_argv`é…ç½®é¡¹å·²å¼€å¯ã€‚POC ä»£ç æä¾›äº†ä½¿ç”¨ `ddev` çš„è‡ªåŠ¨åŒ–ç¯å¢ƒé…ç½®è„šæœ¬ã€‚
    *   **FTP Server:** è¯¥æ¼æ´åˆ©ç”¨å·¥å…·ä¼šå¯åŠ¨ä¸€ä¸ª FTP æœåŠ¡ï¼Œç”¨äºå­˜æ”¾æ¶æ„ payloadï¼Œå¹¶é€šè¿‡ FTP åè®®æä¾›ç»™ Craft CMS åº”ç”¨ã€‚
    *   **Payloadç”Ÿæˆ:**  æ”»å‡»è€…éœ€è¦æ„é€ ä¸€ä¸ªæ¶æ„çš„æ¨¡æ¿è·¯å¾„Payloadï¼Œé€šè¿‡ç‰¹å®šçš„å‚æ•°ä¼ é€’ç»™Craft CMSï¼ŒCraft CMSä¼šè§£æè¯¥æ¨¡æ¿è·¯å¾„ï¼Œä»è€Œæ‰§è¡Œpayloadä¸­åŒ…å«çš„æ¶æ„ä»£ç ã€‚
    *   **æ¼æ´è§¦å‘:** æ„é€ åŒ…å«æ¶æ„æ¨¡æ¿è·¯å¾„çš„è¯·æ±‚å‘é€åˆ°ç›®æ ‡ Craft CMS åº”ç”¨ã€‚å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼Œä¸”FTPæœåŠ¡é…ç½®æ­£ç¡®ï¼Œåˆ™æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚
    *   **åå¼¹shell:** POCä»£ç å¯ä»¥ç”Ÿæˆå¤šç§åå¼¹shellçš„payloadï¼ˆbash, nc, mkfifoï¼‰ï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚

3.  **æŠ•æ¯’é£é™©:**  POCä»£ç ä½¿ç”¨äº†ä¸€ä¸ªFTP serveræ¥ä¼ è¾“æ¶æ„ä»£ç ï¼Œå¦‚æœä»£ç ç¼–å†™è€…åœ¨FTPæœåŠ¡å™¨ä¸Šæ”¾ç½®äº†å…¶å®ƒæ¶æ„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«ç›®æ ‡ç³»ç»Ÿä¸‹è½½å’Œæ‰§è¡Œï¼Œä»è€Œå¯¼è‡´æŠ•æ¯’ã€‚æ­¤å¤–ï¼Œè¯¥POCå·¥å…·ä½¿ç”¨`pygyat`åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™pythonå‘½ä»¤è¡Œå·¥å…·çš„åº“ï¼Œæœ¬èº«å¹¶æ— æ˜æ˜¾çš„æŠ•æ¯’é£é™©ã€‚POCä»£ç ä¸»è¦åŠŸèƒ½æ˜¯æ¼æ´åˆ©ç”¨ï¼Œè¾ƒä¸ºç›´æ¥ï¼Œä½†ä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚åœ¨payloadç”Ÿæˆç¯èŠ‚æ¤å…¥æ¶æ„ä»£ç ã€‚

4.  **ç¼“è§£æªæ–½:**
    *   å‡çº§åˆ°Craft CMSçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ>= 3.9.14, >= 4.13.2, >= 5.5.2ï¼‰ã€‚
    *   ç¦ç”¨`register_argc_argv`é…ç½®é€‰é¡¹ã€‚


**é¡¹ç›®åœ°å€:** [Chocapikk/CVE-2024-56145](https://github.com/Chocapikk/CVE-2024-56145)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-56145](https://nvd.nist.gov/vuln/detail/CVE-2024-56145)

---

## POC #2

**æ¥æº**: [CVE-2024-56145-hmhlol_craft-cms-RCE-CVE-2024-56145.md](../2024/CVE-2024-56145-hmhlol_craft-cms-RCE-CVE-2024-56145.md)

## CVE-2024-56145-CraftCMS-RCE

**æ¼æ´ç¼–å·:** CVE-2024-56145

**æ¼æ´ç±»å‹:** RCE

**å½±å“åº”ç”¨:** Craft CMS

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 5.5.2 and < 4.13.2 and < 3.9.14

**åˆ©ç”¨æ¡ä»¶:** PHPé…ç½®é¡¹register_argc_argvéœ€è¦å¯ç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2024-56145æ˜¯Craft CMSä¸­çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ ¹æ®æ¼æ´ä¿¡æ¯ï¼Œè¯¥æ¼æ´çš„è§¦å‘æ¡ä»¶æ˜¯php.inié…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†`register_argc_argv`é€‰é¡¹ã€‚ä»æœç´¢å¼•æ“ç»“æœæ¥çœ‹ï¼ŒAssetnoteçš„ç ”ç©¶å›¢é˜Ÿå‘ç°äº†è¯¥æ¼æ´ï¼Œå¹¶å‘å¸ƒäº†ç›¸å…³çš„åˆ†ææ–‡ç« å’Œæ¼æ´åˆ©ç”¨å·¥å…·ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æ˜¯ä¸€ä¸ªDockerfileï¼Œç”¨äºæ„å»ºåŒ…å«æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„Craft CMSå’Œå¯ç”¨`register_argc_argv`çš„PHPç¯å¢ƒã€‚`build_docker.sh`è„šæœ¬ç”¨äºæ„å»ºå’Œå¯åŠ¨Dockerå®¹å™¨ã€‚æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯åˆ©ç”¨PHPå°†å‘½ä»¤è¡Œå‚æ•°æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚å› ä¸ºPOCç¯å¢ƒä¸­åŒ…å«FTPæœåŠ¡ï¼Œå¹¶å…è®¸åŒ¿åç”¨æˆ·å†™å…¥ï¼Œè¿™å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨FTPæœåŠ¡ä¸Šä¼ æ¶æ„æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´æ›´ä¸¥é‡çš„æŠ•æ¯’æ”»å‡»ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¡ä»¶ï¼š** ç›®æ ‡Craft CMSæœåŠ¡å™¨çš„php.iniä¸­å¯ç”¨äº†`register_argc_argv`ã€‚
2.  **æ”»å‡»ï¼š** æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„ä»£ç çš„HTTPè¯·æ±‚ï¼Œè¯¥æ¶æ„ä»£ç ä¼šè¢«ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™PHPè„šæœ¬ã€‚
3.  **æ‰§è¡Œï¼š** Craft CMSè§£æè¯·æ±‚ï¼Œç”±äº`register_argc_argv`å·²å¯ç”¨ï¼Œæ¶æ„ä»£ç ä¼šä½œä¸ºå‘½ä»¤è¡Œå‚æ•°è¢«æ³¨å†Œï¼Œå¹¶æœ€ç»ˆå¯¼è‡´ä»£ç æ‰§è¡Œã€‚

**æŠ•æ¯’é£é™©è¯„ä¼°ï¼š**

è™½ç„¶æä¾›çš„ä»£ç ä¸»è¦æ˜¯ä¸ºäº†å¤ç°æ¼æ´ï¼Œä½†å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **FTPæœåŠ¡ï¼š** Dockerfileé…ç½®äº†åŒ¿åå¯å†™çš„FTPæœåŠ¡ã€‚æ”»å‡»è€…å¯ä»¥åœ¨ç¯å¢ƒä¸­ä¸Šä¼ æ¶æ„æ–‡ä»¶ã€‚
2.  **.envæ–‡ä»¶ï¼š** Dockerfileä¸­å¤åˆ¶`.env`æ–‡ä»¶ï¼Œè¿™å¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æœè¿™äº›ä¿¡æ¯è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´ä¸¥é‡çš„æ”»å‡»ã€‚
3.  **Composerä¾èµ–ï¼š** `composer.json` æ–‡ä»¶æŒ‡å®šäº†ä¾èµ–åŒ…çš„ç‰ˆæœ¬ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶äº†ä¾èµ–åŒ…çš„æºï¼Œå¯èƒ½ä¼šæ³¨å…¥æ¶æ„ä»£ç ã€‚

ç»¼åˆä»¥ä¸Šå› ç´ ï¼Œè™½ç„¶è¯¥POCçš„ä¸»è¦ç›®çš„æ˜¯éªŒè¯æ¼æ´ï¼Œä½†å…¶ä¸­ä¸€äº›é…ç½®å¯èƒ½ä¼šè¢«æ¶æ„åˆ©ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå­˜åœ¨10%çš„æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [hmhlol/craft-cms-RCE-CVE-2024-56145](https://github.com/hmhlol/craft-cms-RCE-CVE-2024-56145)

**æ¼æ´è¯¦æƒ…:** [CVE-2024-56145](https://nvd.nist.gov/vuln/detail/CVE-2024-56145)

---

