## CVE-2024-0670 - CheckMK Windows Agent 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2024-0670

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** CheckMK Windows Agent

**危害等级:** 高

**CVSS评分:** 8.8

**影响版本:** CheckMK Windows Agent (未指定版本)

**利用条件:** 需要本地低权限用户、可写C:\Windows\Temp目录、Windows PowerShell执行策略允许脚本执行 (可通过Bypass绕过)

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

该POC代码（`exploit.ps1`）利用CVE-2024-0670，CheckMK Windows Agent中的一个本地权限提升漏洞。漏洞源于MSI修复过程中非受控的搜索路径，低权限本地用户可在`C:\Windows\Temp`预置以可预测文件名命名的恶意payload。当CheckMK Agent的MSI修复被触发时，这些payload将以`NT AUTHORITY\SYSTEM`权限执行，实现系统完全控制。该POC是基于公开PoC的PowerShell衍生版本，代码清晰，配置简单（需设置攻击机IP、端口、payload路径），可实现SYSTEM shell，有效性高，可复现。
**利用步骤：** 攻击机启动Netcat监听器；在目标机准备反向shell payload并配置脚本；以低权限用户执行`powershell.exe -NoProfile -ExecutionPolicy Bypass -File .\exploit.ps1`；成功后，攻击者获得SYSTEM权限反向shell。
**投毒风险分析：** 该POC代码的投毒风险评估为低（约10%）。代码本身是透明的PowerShell脚本，专注于权限提升，未发现混淆或加载外部可疑脚本行为。它明确依赖用户配置的合法payload（如`nc.exe`）来验证利用效果。法律声明强调其用于教育和防御性测试。主要风险在于：代码来源不可信导致被篡改；用户配置了恶意的Payload。这些风险与POC代码本身的恶意性无关。总体而言，代码清晰，意图明确，风险可控。

**项目地址:** https://github.com/elsevar11/CVE-2024-0670-CheckMK-Agent-Local-Privilege-Escalation-Exploit

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-0670
