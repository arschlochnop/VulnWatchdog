## CVE-2024-0670 - CheckMK Windows Agent 本地权限提升 (Local Privilege Escalation)

**漏洞编号:** CVE-2024-0670

**漏洞类型:** 本地权限提升 (Local Privilege Escalation)

**影响应用:** CheckMK Windows Agent

**危害等级:** 高

**CVSS评分:** 8.8

**影响版本:** CheckMK Windows Agent (受影响版本未明确提供，推测为存在MSI修复机制的较新版本)

**利用条件:** 需要本地低权限用户账户、目标系统安装CheckMK Windows Agent、PowerShell执行策略允许脚本执行、具有`C:\Windows\Temp\`目录的写入权限、可选的Netcat监听器

**POC 可用性:** 9

**POC 类型:** 完整利用

**攻击复杂度:** 中

**投毒风险:** 0

## 详情

POC有效性分析与利用步骤:
该PowerShell PoC（CVE-2024-0670）旨在利用CheckMK Windows Agent中的本地权限提升漏洞，使低权限本地用户获取NT AUTHORITY\SYSTEM权限。PoC基于公开的利用方法，通过操纵MSI修复过程中的可预测命令文件执行路径实现。具体而言，它利用安装程序在MSI修复期间以预测性文件名在`C:\Windows\Temp`目录中执行文件的机制。攻击者可预先放置恶意payload，这些payload随后会以高权限执行。
利用步骤如下：首先，攻击者在攻击主机上启动Netcat监听器。其次，将`exploit.ps1`部署到目标Windows机器。然后，以低权限用户执行`exploit.ps1`，脚本会自动枚举MSI包，在`C:\Windows\Temp\`预植payload文件，并触发MSI修复。成功后，攻击者的监听器将收到一个SYSTEM权限的反向Shell。此PoC具有高度的有效性和功能性，能够如描述般实现权限提升。

投毒风险分析:
该PoC的投毒风险评估为0%。`README.md`明确指出其用途为教育、防御性工程和授权测试。PoC利用标准工具Netcat作为反向Shell的payload，这是漏洞利用的预期结果，并非恶意投毒行为。代码逻辑描述透明，未提及代码混淆、加密或从未知外部源下载执行文件的行为。同时，其免责声明进一步强调了合法安全研究性质。该PoC仅专注于漏洞利用功能，不包含额外的投毒组件。

**项目地址:** https://github.com/elsevar11/CVE-2024-0670-CheckMK-Agent-Local-Privilege-Escalation-Exploit

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-0670
