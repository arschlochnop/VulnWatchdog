# CVE-2024-39943

> 📦 该CVE有 **2** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-39943-JenmrR_Node.js-CVE-2024-39943.md](../2024/CVE-2024-39943-JenmrR_Node.js-CVE-2024-39943.md)

## CVE-2024-39943 - rejetto HFS RCE

**漏洞编号:** CVE-2024-39943

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** rejetto HFS (HTTP File Server)

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 0.52.10

**利用条件:** 需要目标HFS服务器开启文件上传功能，并且攻击者具有上传权限。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-39943 漏洞存在于 rejetto HFS (HTTP File Server) 3 的 0.52.10 之前版本中。该漏洞允许经过身份验证的远程用户（如果他们具有上传权限）执行操作系统命令。这是因为在 Node.js 中使用 `child_process.execSync` 而不是 `child_process.spawnSync` 来执行 `df` 命令时使用了 shell。  

**有效性分析：**

提供的漏洞利用代码是一个 Node.js 应用，模拟了存在漏洞的 HFS 服务器环境。`poc.py` 脚本通过向 `/upload` 路径发送包含操作系统命令的 HTTP POST 请求来利用该漏洞。服务器接收上传的文件，读取其内容，并使用 `execSync()` 函数执行该内容，从而导致远程代码执行。POC 代码演示了通过上传包含 `echo Hello_From_Hacked_Server` 命令的文件，在服务器上成功执行该命令。

**投毒风险分析：**

分析提供的代码仓库，其中投毒风险较低。主要原因是：

*   **代码结构简单清晰：** Dockerfile, docker-compose.yml, poc.py, package.json, server.js, README.md 文件均直接可见，结构简单，易于审计。
*   **明确的漏洞利用意图：**  README.md 详细描述了漏洞原理、利用方法和 PoC 验证过程，目的明确。
*   **关键代码段突出：** `server.js` 文件中明确标出了 `execSync()` 导致漏洞的位置，方便理解。
*   **没有发现可疑代码：**  检查了所有文件，没有发现任何试图建立反向 shell、下载恶意文件或执行其他恶意操作的可疑代码。

虽然投毒风险较低，但仍存在极小的可能性，例如作者未来可能更新仓库添加恶意代码。因此，建议在使用任何第三方代码时，始终进行仔细的代码审查。

**利用方式总结：**

1.  攻击者需要拥有目标 HFS 服务器的账号，并且该账号具有文件上传权限。
2.  攻击者构造包含恶意操作系统命令的文件。例如，包含 `echo Hello_From_Hacked_Server` 命令的 `exploit.txt` 文件。
3.  攻击者使用 `poc.py` 脚本或者其他 HTTP 客户端工具，向目标服务器的 `/upload` 路径发送 HTTP POST 请求，并将包含恶意命令的文件作为 `file` 参数上传。
4.  目标服务器接收到上传的文件后，读取其内容，并使用 `execSync()` 函数执行该内容，从而导致远程代码执行。
5.  攻击者通过查看服务器的响应或者其他方式，获取命令执行结果，并进一步控制服务器。

**项目地址:** [JenmrR/Node.js-CVE-2024-39943](https://github.com/JenmrR/Node.js-CVE-2024-39943)

**漏洞详情:** [CVE-2024-39943](https://nvd.nist.gov/vuln/detail/CVE-2024-39943)

---

## POC #2

**来源**: [CVE-2024-39943-truonghuuphuc_CVE-2024-39943-Poc.md](../2024/CVE-2024-39943-truonghuuphuc_CVE-2024-39943-Poc.md)

## CVE-2024-39943-rejetto HFS-远程命令执行

**漏洞编号:** CVE-2024-39943

**漏洞类型:** 远程命令执行

**影响应用:** rejetto HFS (HTTP File Server)

**危害等级:** 高危，可能导致完全控制服务器

**影响版本:** < 0.52.10

**利用条件:** 需要目标服务器运行rejetto HFS且攻击者拥有上传权限（或能通过其他方式获取上传权限）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-39943 允许经过身份验证的远程用户（如果他们具有上传权限）执行操作系统命令。这是因为 shell 用于执行 `df` 命令（即，在 Node.js 的 `child_process` 中使用 `execSync` 而不是 `spawnSync`）。

**漏洞利用方式：**

根据提供的PoC代码，此漏洞可以通过以下方式利用：

1.  **用户认证：** 首先，攻击者需要拥有一个有效的rejetto HFS用户账号，并且该账号需要具有上传权限。`config.yaml`文件展示了可以配置用户账号和权限。

2.  **创建包含恶意命令的目录：** PoC利用了文件系统在处理文件/目录大小计算时调用`df`命令的特性，通过创建一个名称包含恶意命令的目录，触发命令执行。恶意命令会被编码成Base64，避免直接出现在目录名中。

3.  **触发漏洞：**通过PUT请求上传文件到恶意的目录中，服务端调用df时，会执行目录名中构造的恶意代码。

PoC中提供了两种利用方式：

*   **poc_user_admin.py：** 利用了HFS的API接口来添加VFS目录，并设置上传权限。然后，创建包含恶意命令的目录，并通过`get_ls`接口来触发漏洞。
*   **poc_user_guest.py：** 模拟了普通用户上传文件的情况。该PoC首先上传文件到包含恶意命令的目录，如果目录不存在，则需要发送两次PUT请求才能成功执行命令。这是因为第一次请求创建了目录，但尚未触发`df`命令的执行。第二次请求才会触发。

**投毒风险评估：**

虽然PoC代码本身是为了演示漏洞利用而编写的，但是其中仍然存在一定的投毒风险：

*   **`poc_user_admin.py`可能被修改：** 攻击者可能会修改`poc_user_admin.py`，例如添加额外的后门代码，或者修改payload，使其执行恶意操作。
*   **`config.yaml`可能包含恶意配置：** `config.yaml`文件可能被篡改，添加具有管理员权限的恶意用户，或者修改现有用户的权限。
*  **虽然整体投毒风险较低，但需要谨慎使用，防止被恶意利用。**

综合评估，该漏洞利用的有效性较高，因为PoC代码已经能够成功地在目标系统上执行任意命令。投毒风险较低，但需要注意PoC代码本身可能被篡改。攻击者需要具备一定的权限才能利用该漏洞。

**项目地址:** [truonghuuphuc/CVE-2024-39943-Poc](https://github.com/truonghuuphuc/CVE-2024-39943-Poc)

**漏洞详情:** [CVE-2024-39943](https://nvd.nist.gov/vuln/detail/CVE-2024-39943)

---

