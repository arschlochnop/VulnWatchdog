## CVE-2024-3094 - XZ Utils / liblzma 供应链攻击/后门植入

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门植入

**影响应用:** XZ Utils / liblzma

**危害等级:** 紧急 (Critical)

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统需运行受影响版本的liblzma，且通常涉及通过systemd启动的sshd服务，攻击者需具备特定私钥进行签名验证触发

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 高

**投毒风险:** 65%

## 详情

【POC有效性分析】该提供的POC代码主要用于复现CVE-2024-3094中XZ Utils的混淆与解密过程，而非直接的远程攻击工具。分析显示，POC通过一系列复杂的Shell指令（包括tr字符替换、sed流编辑、head字节截取）模拟了原始恶意代码从压缩包测试文件中提取第二阶段载荷的过程。该POC能够有效展示攻击者如何利用‘good-large_compressed.lzma’和‘bad-3-corrupt_lzma2.xz’这两个看似损坏或普通的测试文件，通过多层嵌套的脚本执行逻辑来规避安全静态扫描。代码逻辑严密，准确还原了上游构建脚本在编译时插入恶意so文件的关键步骤。对于防御研究员而言，该POC在本地环境（需特定版本的xz源码）中具有极高的复现价值，可用于验证安全软件是否能识别此类深度混淆的Shell行为。然而，由于该漏洞的最终触发（即RCE阶段）依赖于高度复杂的预加载库劫持和特定RSA签名的验证，该POC仅停留在‘解混淆’阶段，并未包含最终的Payload触发逻辑。其有效性体现在对供应链攻击手段的深度剖析，而非即插即用的攻击。利用步骤通常涉及：1. 下载XZ 5.6.0源码；2. 替换测试文件夹下的lzma文件；3. 模拟构建过程触发恶意脚本执行；4. 监测liblzma.so是否被成功篡改。 

【投毒风险分析】此POC代码本身存在较高的投毒与误导风险。其核心脚本包含大量经过混淆的eval、tr、sed组合指令（例如：gl_path_unmap='tr " \\t_\\-" "\\t \\-_"'），这种高度不可读的代码风格正是恶意投毒工具的典型特征。在安全社区中，攻击者常利用此类‘解密演示’作为诱饵，在混淆层中植入针对研究人员主机的恶意命令（如rm -rf或反弹shell）。经过审计，本示例POC虽然目前指向的是解密逻辑，但由于其结构极易通过修改tr映射表或插入额外管道命令来隐藏恶意行为，普通用户极难通过肉眼识别其安全性。此外，POC要求用户在本地运行包含eval的脚本，这在缺乏沙箱保护的环境下极其危险。对于安全研究员，运行此类脚本前必须严格核对每一个字节流的转换逻辑。考虑到该漏洞本身即为供应链攻击，任何声称能‘复现’或‘检测’该漏洞的第三方脚本都可能成为二次投毒的重灾区，尤其是那些未在知名安全厂商仓库托管、代码逻辑晦涩的项目。建议在隔离的虚拟机环境中操作，并重点监控脚本是否有异常的外连网络行为或对系统关键库文件的非法写入权限。

**项目地址:** [https://github.com/advisories/GHSA-rxwq-x6](https://github.com/advisories/GHSA-rxwq-x6)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
