# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **15** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> 📦 该CVE有 **14** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要runc版本在受影响范围内，并且允许容器执行`runc exec`或恶意镜像执行`runc run`

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 存在于 runc 1.1.11 及更早版本中。由于文件描述符泄露，攻击者可以使新启动的容器进程（通过 runc exec）的工作目录位于主机文件系统命名空间中，从而允许通过访问主机文件系统来逃逸容器。该漏洞也可能被恶意镜像利用，通过 runc run 使得容器进程获得对主机文件系统的访问权限。更严重的是，攻击者可以覆盖半任意的主机二进制文件，从而完全逃逸容器。 

**有效性：**

根据漏洞描述和提供的POC代码，此POC代码有效。POC 代码提供了两种利用方式：一种是通过`-w /proc/self/fd/8`参数直接指定容器的工作目录到主机文件系统，另一种是通过在容器内部创建符号链接，然后使用`docker exec -w`命令将工作目录切换到主机文件系统。

**投毒风险：**

提供的漏洞利用代码仓库仅包含一个README.md文件，其中描述了漏洞的利用方法和受影响的版本。 代码中没有发现任何可疑的或恶意的代码。 仓库作者的目的是演示如何利用该漏洞，而不是植入后门或恶意代码。 但是如果攻击者拿到此代码,二次修改后进行传播，则存在一定的风险。因此投毒风险非常低,估计为5%。

**利用方式：**

此漏洞主要通过以下两种方式利用：

1.  **通过`docker run -w`参数：** 启动容器时，使用`-w /proc/self/fd/8`参数将容器的工作目录设置为主机文件系统上的某个目录。由于文件描述符泄露，`/proc/self/fd/8`指向的是主机文件系统，因此容器内的操作实际上是在主机文件系统上执行。
2.  **通过符号链接和`docker exec -w`参数：** 首先，在容器内部创建指向`/proc/self/fd/7/`和`/proc/self/fd/8/`的符号链接。然后，使用`docker exec -w`命令将容器的工作目录设置为这些符号链接指向的目录。同样，由于文件描述符泄露，这些符号链接实际上指向的是主机文件系统，从而允许容器访问和修改主机文件系统。

总而言之，该漏洞允许容器逃逸，攻击者可以利用它来访问和控制主机文件系统，从而造成严重的安全风险。

**项目地址:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #3

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**来源**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机完全控制

**影响版本:** < 1.1.12

**利用条件:** 需要runc版本小于1.1.12，并且容器需要执行exec或run操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，由于内部文件描述符泄露，攻击者可以使新生成的容器进程（来自runc exec）在主机文件系统命名空间中具有工作目录，从而允许通过访问主机文件系统来逃逸容器。恶意镜像也可以使用相同的攻击，允许容器进程通过runc run获得对主机文件系统的访问权限。 

**有效性：**

提供的POC代码是有效的，它展示了三种利用该漏洞的方法：

*   **通过运行容器：** 使用`docker run -w /proc/self/fd/8 ...`命令，`-w`参数设置容器的工作目录到`/proc/self/fd/8`，利用文件描述符泄露，将容器的工作目录设置为主机的文件系统。
*   **通过exec进入正在运行的容器：** 类似于运行容器的方式，通过`docker exec`进入容器并设置工作目录。
*   **通过runc本身：** 使用`runc spec`生成配置文件，然后修改`config.json`中的`cwd`字段为`/proc/self/fd/7`，最后使用`runc run`启动容器。

**投毒风险：**

该漏洞利用代码本身没有明显的投毒代码。该存储库主要提供漏洞的说明和利用示例。 但需要注意的是，任何从互联网下载的代码都存在潜在风险，以下为风险评估说明:

*   **依赖风险:** 该漏洞的利用依赖于操作系统命令，任何对其进行修改都可能导致潜在的风险，占比4%。
*   **代码隐藏风险:** 作者可能在其他位置（例如，图片文件或其他不明显的文件）嵌入恶意代码，但这需要进一步分析，占比6%。

因此，总体投毒风险评估为10%。

**利用方式：**

利用方式主要基于文件描述符泄露。当runc执行`exec`或`run`操作时，会泄露一个文件描述符，该文件描述符指向主机的文件系统。通过将容器的工作目录设置为`/proc/self/fd/<fd>`，容器内的进程就可以访问主机的文件系统，从而可以读取敏感信息、修改系统文件甚至执行任意代码，最终实现容器逃逸。

**总结：**

CVE-2024-21626是一个高危漏洞，利用简单，影响广泛。建议尽快升级runc到1.1.12或更高版本。

**项目地址:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**来源**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机权限

**影响版本:** < 1.1.12

**利用条件:** 需要存在漏洞版本的runc环境，以及执行容器的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个文件描述符泄漏漏洞。攻击者可以利用该漏洞使新生成的容器进程（来自 runc exec）在宿主机文件系统命名空间中拥有一个工作目录，从而允许通过访问宿主机文件系统进行容器逃逸。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对宿主机文件系统的访问权限。该漏洞的利用方式主要依赖于 runc 在处理 cgroup 时未正确关闭文件描述符，导致文件描述符泄漏。攻击者通过控制容器的 cwd (current working directory) 到 /proc/self/fd/7 这样的路径，使得容器内的进程可以访问到宿主机的文件系统。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此POC代码是有效的。搜索引擎结果中多个链接（如NVD、RedHat、Wiz.io、WithSecure、Snyk.io、nitroc.org）均确认了漏洞的存在以及通过文件描述符泄漏实现容器逃逸的可能性。POC代码 `poc-autoplay.sh` 脚本模拟了攻击流程，通过修改 `config.json` 文件，将容器的工作目录设置为宿主机上的文件描述符，从而实现逃逸。`README.md` 中也详细描述了漏洞原理和利用方法。

**投毒风险分析：**

分析POC代码，投毒风险较低，但不能完全排除。理由如下：

*   `poc-autoplay.sh` 的主要功能是安装和配置 Docker 环境，以及运行包含漏洞利用的 runc 容器。其中涉及到的 `apt-get install` 命令存在潜在的投毒风险，例如，如果软件源被篡改，则可能安装恶意软件包。但脚本本身没有发现直接的恶意代码。
*   脚本会下载 Docker 的 GPG 密钥，并添加到受信任的密钥列表中。如果 GPG 密钥被恶意替换，则可能导致安装被篡改的 Docker 软件包。
*   脚本还尝试获取安装前后软件包列表,以尝试进行对比, 这也存在一定的风险,可能会执行恶意代码。
*   总体来说，该POC主要侧重于漏洞利用，而非恶意代码传播。但由于涉及到外部资源的下载和安装，依然存在一定的投毒风险，大概在10%。

**漏洞利用方式：**

1.  **文件描述符泄漏：** runc 在创建容器时，会打开一些宿主机上的文件，例如 cgroup 文件。由于疏忽，这些文件描述符没有被正确关闭，而是泄漏到了容器内部的进程中。
2.  **控制容器工作目录：** 攻击者通过修改 runc 的配置文件 `config.json`，将容器的工作目录设置为泄漏的文件描述符对应的路径（例如 `/proc/self/fd/7`）。
3.  **容器逃逸：** 容器内的进程通过工作目录访问宿主机文件系统，从而实现容器逃逸。

具体来说，利用过程如下：

*   准备一个存在漏洞的 runc 环境。
*   创建一个容器镜像。
*   修改 runc 的配置文件 `config.json`，将容器的工作目录设置为 `/proc/self/fd/7`。
*   运行容器，容器内的进程就可以访问宿主机的文件系统了。
*   `make install` 会执行poc-autoplay.sh脚本自动化完成上述过程，并对比poc前后安装的软件包列表
*   `make uninstall` 会删除测试文件以及卸载安装的docker

**项目地址:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc，并且容器需要具有执行某些操作的权限（例如，使用`docker exec`或者运行恶意镜像）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞源于 runc 中的文件描述符泄露。攻击者可以利用此漏洞，通过泄露的文件描述符，使得新启动的容器进程（通过 `runc exec`）的工作目录位于宿主机的文件系统命名空间中，从而获得对宿主机文件系统的访问权限，实现容器逃逸。漏洞利用主要有以下几种方式：

1. **攻击方式1（恶意镜像）：** 恶意镜像可以利用此漏洞，使得容器进程获得对宿主机文件系统的访问权限。
2. **攻击方式2（runc exec）：** 通过 `runc exec` 启动的容器进程可能具有宿主机文件系统中的工作目录，允许逃逸。
3. **攻击方式3a和3b（覆盖宿主机二进制文件）：** 可以利用该漏洞覆盖半任意的宿主机二进制文件，从而完全控制宿主机。

**利用方式：**

根据提供的漏洞利用代码，利用方式是首先确定目标环境是否易受攻击，并找到正确的文件描述符。`checkVulnerability.sh` 脚本通过在一定范围内循环，使用 `docker run` 命令尝试不同的文件描述符，如果能够读取到宿主机的 `/etc/passwd` 文件，则说明该文件描述符泄露，并且目标环境易受攻击。找到正确的文件描述符后，就可以利用该文件描述符进行容器逃逸，例如读取宿主机上的敏感文件或覆盖宿主机上的二进制文件。

**投毒风险分析：**

尽管该仓库提供了利用 CVE-2024-21626 漏洞的 PoC 代码，但仍然存在一定的投毒风险。仓库中的 `checkVulnerability.sh` 脚本可能包含恶意代码，例如，在检测到漏洞存在时，自动执行某些恶意操作（例如，下载和执行恶意脚本），或者在不知情的情况下修改宿主机上的文件。该仓库还提供了一个修改后的Docker版本，该版本本身可能被篡改，使得可以后门进入宿主机。该投毒风险比例评定为10%。

**注意事项：**

在测试该漏洞时，务必在隔离的环境中进行，以防止恶意代码感染宿主机。

**项目地址:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**来源**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**来源**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要使用存在漏洞的runc版本，攻击者需要能够控制容器或使用恶意镜像创建容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 漏洞允许攻击者通过文件描述符泄漏实现容器逃逸。当使用 `runc exec` 创建新容器进程时，由于未正确关闭文件描述符，宿主机的文件描述符可能会泄漏到容器环境中。攻击者可以利用这些泄漏的文件描述符访问和修改宿主机的文件系统，从而导致容器逃逸，完全控制宿主机。

**有效性:**

提供的POC代码有效，可以利用该漏洞实现容器逃逸。

*   `Dockerfile`: 用于构建包含漏洞利用脚本的恶意镜像。关键在于将工作目录设置为 `/proc/self/fd/8`，利用泄漏的文件描述符。
*   `poc.sh`: 漏洞利用脚本，用于修改宿主机上的 `/var/spool/cron/crontabs/root` 文件，添加反弹shell的定时任务，从而获取宿主机的shell。
*   `poc2.sh`: 漏洞利用脚本，用于覆盖宿主机上的 `/bin/bash.copy` 文件，实现反弹shell。
*   `verify.sh`: 用于查找当前机器环境中泄漏的文件描述符对应的具体值。
*   `README.md`: 提供了漏洞的简介、利用方法、原理分析和修复方案。

**投毒风险:**

代码中存在潜在的投毒风险，主要体现在 `poc.sh` 和 `poc2.sh` 脚本中。

*   `poc.sh` 通过修改 `/var/spool/cron/crontabs/root` 文件添加定时任务，该文件是宿主机上的系统文件。恶意修改该文件可能导致宿主机上的其他定时任务失效，或者执行恶意代码。但考虑到这是POC验证的一部分，该行为可以被理解。
*   `poc2.sh` 脚本尝试覆盖 `/bin/bash.copy` 文件。如果该文件不存在，脚本执行会失败。如果存在，则会覆盖该文件，可能导致系统不稳定，或者执行恶意代码。同样的，考虑到这是POC，该行为可以被理解。

总体来说，该仓库的投毒风险较低（10%），主要是一些可能影响宿主机的恶意修改操作。恶意修改定时任务文件和覆盖二进制文件可能对系统造成一定影响，但这些操作是漏洞验证的必要步骤。

**利用方式:**

1.  **构建恶意镜像:** 使用 `Dockerfile` 构建包含漏洞利用脚本的恶意镜像。
2.  **查找泄漏的文件描述符:** 运行 `verify.sh` 脚本，查找当前机器环境中泄漏的文件描述符对应的具体值。如果不是8，需要修改 Dockerfile 的 WORKDIR 或者在使用 `docker run` 时使用 `-w` 参数指定。
3.  **运行恶意镜像:** 运行构建好的恶意镜像，并执行漏洞利用脚本 `poc.sh` 或 `poc2.sh`。
4.  **利用泄漏的文件描述符:** 脚本利用泄漏的文件描述符，修改宿主机上的文件系统。
5.  **获取宿主机shell:** 通过修改定时任务文件或覆盖二进制文件的方式，获取宿主机的shell，实现容器逃逸。

攻击者需要能够控制容器，或者使用恶意镜像创建容器才能成功利用此漏洞。根据搜索结果，该漏洞影响很大，可能导致对底层宿主机的完整控制。

**项目地址:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**来源**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**来源**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**来源**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**来源**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**来源**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**来源**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许攻击者逃逸容器并在主机上执行任意代码

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及执行容器构建或运行的权限（可能通过恶意镜像）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，源于文件描述符泄漏。该漏洞允许攻击者利用泄露的文件描述符，使得容器进程的工作目录指向主机文件系统命名空间。漏洞利用方式如下：

1.  **攻击场景1（恶意镜像）：** 用户运行了一个恶意的 Docker 镜像。该镜像在启动时，利用该漏洞将容器的工作目录设置为宿主机上的某个目录。
2.  **攻击场景2（runc exec）：** 使用 `runc exec` 在容器内执行新进程，新进程的工作目录错误地设置为主机的文件系统命名空间。
3.  **利用过程：** 在容器内，通过相对路径（如`../../../root/.ssh/authorized_keys`）操作文件，实际上是在操作宿主机上的文件。
4.  **POC代码分析：** 提供的 POC 代码展示了攻击者如何创建一个恶意的 Dockerfile，该 Dockerfile 将工作目录设置为 `/proc/self/fd/8`，这是一个泄露的文件描述符。然后，它复制一个恶意脚本 `inject-ssh-key.sh` 到容器中并执行。这个脚本会将攻击者的 SSH 公钥写入宿主机的 `/root/.ssh/authorized_keys` 文件，从而允许攻击者通过 SSH 以 root 权限登录宿主机。

**有效性：** 提供的 POC 代码有效，可以用来演示和利用 CVE-2024-21626 漏洞实现容器逃逸。

**投毒风险：** 仓库中存在投毒代码的可能性较低（10%）。主要风险集中在 `inject-ssh-key.sh` 脚本，它直接修改宿主机的 authorized_keys 文件，属于明显的漏洞利用行为，并非隐藏的投毒。虽然作者可能在其他位置（例如构建脚本或 Dockerfile 中）添加其他恶意行为，但当前提供的代码片段并未发现明显的后门或隐藏恶意功能。

**利用方式总结：** 攻击者构建或分发包含恶意Dockerfile的容器镜像, 镜像中的脚本利用文件描述符泄露漏洞，将容器的工作目录设置为宿主机的文件系统，最终修改宿主机上的文件实现权限提升。

**项目地址:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**来源**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc 容器逃逸漏洞

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问、权限提升

**影响版本:** v1.0.0-rc93 <= runc <= 1.1.11

**利用条件:** 需要容器运行环境，以及内核版本支持 openat2 系统调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626 漏洞允许攻击者通过利用 runc 中的文件描述符泄露，使新启动的容器进程（通过 `runc exec`）的工作目录位于主机文件系统命名空间中，从而逃逸容器。攻击者可以利用此漏洞访问甚至修改主机上的文件。根据搜索引擎结果和漏洞库信息，此漏洞已被广泛分析和利用。提供的 POC 代码展示了如何通过 `-w /proc/self/fd/$line` 参数，将容器的工作目录设置为主机上的文件描述符，从而实现容器逃逸。代码中先通过循环查找可用的文件描述符，然后通过 `docker exec` 在泄露文件描述符的容器中执行命令，访问主机文件系统。

**有效性：**
根据提供的 POC 代码和搜索结果，该漏洞利用是有效的。POC 代码中给出了详细的复现步骤，包括环境要求、利用方法和验证手段。修复后的 runc 版本不再允许使用文件描述符作为工作目录，从而阻止了这种攻击。

**投毒风险：**
该 POC 代码主要用于演示漏洞利用，本身不包含明显的恶意代码或后门。但是，任何代码都存在潜在的投毒风险。例如，恶意修改后的 runc 二进制文件可能包含后门或恶意功能。因此，在实际使用时，必须验证 runc 二进制文件的完整性和来源。将投毒风险评估为 5%，主要考虑到：该代码主要是流程演示，非二进制程序，被植入恶意代码的可能性比较小。代码使用`docker run --rm` 清理容器，一定程度上降低了驻留后门的风险，但替换runc二进制程序行为依然存在风险。

**利用方式：**
1.  **利用条件：** 受影响的 runc 版本（v1.0.0-rc93 <= runc <= 1.1.11），以及容器运行环境，内核版本支持 openat2 系统调用
2.  **攻击步骤：**
    *   查找可用的文件描述符：通过循环运行容器，并将工作目录设置为 `/proc/self/fd/$line`，找到一个可用的文件描述符，使得容器进程可以访问主机文件系统。
    *   逃逸容器：使用 `docker exec` 命令，在具有泄露文件描述符的容器中执行命令，访问主机文件系统。例如，读取 `/etc/passwd` 文件或其他敏感文件。
    *   覆盖主机二进制文件：通过修改主机上的二进制文件，可以实现更严重的攻击，例如权限提升或远程代码执行。
3.  **缓解措施：**
    *   升级 runc 到 1.1.12 或更高版本。
    *   避免使用受影响的 runc 版本。
    *   监控容器行为，检测异常的文件系统访问。

**项目地址:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**来源**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可完全控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 可以创建容器并指定执行命令，可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，由于文件描述符泄露，导致容器进程的工作目录可能位于主机文件系统命名空间中。攻击者可以利用此漏洞，通过 `runc exec` 或恶意镜像（`runc run`），访问甚至覆盖主机上的文件，从而实现容器逃逸，完全控制宿主机。

**漏洞利用方式：**
1.  **文件描述符泄露：** runc 在执行 `runc exec` 时，未能正确地设置 CLOEXEC 标志，导致文件描述符泄露到新启动的容器进程中。
2.  **工作目录操纵：** 利用泄露的文件描述符，攻击者可以操纵容器进程的工作目录指向主机文件系统上的某个目录。
3.  **文件覆盖/执行：** 在主机文件系统上，攻击者可以读取敏感文件，或覆盖关键的可执行文件，例如 `bash`，以获得宿主机的控制权。

**POC分析：**
提供的POC代码展示了漏洞利用过程：
1.  **Dockerfile：** 创建一个Ubuntu容器，安装 netcat 工具，添加 `poc.sh` 脚本，并设置工作目录为 `/proc/self/fd/9`，这个目录对应于泄露的文件描述符。注意：实际环境可能需要根据文件描述符泄露情况调整这个目录。
2.  **poc.sh：** 脚本首先获取容器的IP地址，然后在`/proc/self/cwd/../../../bin/bash.copy`创建一个反弹shell的`bash`副本。`/proc/self/cwd` 表示当前工作目录（即主机文件系统），向上三级目录，尝试覆盖宿主机的 `/bin/bash.copy`文件。脚本随后使用 `nc` 监听指定端口，等待反弹shell连接。

**有效性：**
根据漏洞描述和POC代码，此POC具有较高的成功率，能够实现容器逃逸。但实际利用时，需要根据不同的 Docker/runc 版本，调整工作目录 `/proc/self/fd/9`， 找到泄露的正确的文件描述符。同时目标文件路径也需要根据环境进行调整。

**投毒风险：**
经过代码审计，该仓库中的POC代码未发现明显的投毒行为。作者的目的是演示漏洞的利用，而不是在用户不知情的情况下执行恶意操作。`poc.sh` 脚本中的反弹 shell 行为是漏洞利用的一部分，并非隐藏的恶意代码。所以投毒风险为0%。

**项目地址:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

