# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **15** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md](../2024/CVE-2024-21626-KubernetesBachelor_CVE-2024-21626.md)

# CVE-2024-21626

> ðŸ“¦ è¯¥CVEæœ‰ **14** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2024-21626-FlojBoj_CVE-2024-21626.md](../2024/CVE-2024-21626-FlojBoj_CVE-2024-21626.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼Œå¹¶ä¸”å…è®¸å®¹å™¨æ‰§è¡Œ`runc exec`æˆ–æ¶æ„é•œåƒæ‰§è¡Œ`runc run`

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 å­˜åœ¨äºŽ runc 1.1.11 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ runc execï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚è¯¥æ¼æ´žä¹Ÿå¯èƒ½è¢«æ¶æ„é•œåƒåˆ©ç”¨ï¼Œé€šè¿‡ runc run ä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–åŠä»»æ„çš„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨é€ƒé€¸å®¹å™¨ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žæè¿°å’Œæä¾›çš„POCä»£ç ï¼Œæ­¤POCä»£ç æœ‰æ•ˆã€‚POC ä»£ç æä¾›äº†ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡`-w /proc/self/fd/8`å‚æ•°ç›´æŽ¥æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼Œç„¶åŽä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»“åº“ä»…åŒ…å«ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œå…¶ä¸­æè¿°äº†æ¼æ´žçš„åˆ©ç”¨æ–¹æ³•å’Œå—å½±å“çš„ç‰ˆæœ¬ã€‚ ä»£ç ä¸­æ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚ ä»“åº“ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨è¯¥æ¼æ´žï¼Œè€Œä¸æ˜¯æ¤å…¥åŽé—¨æˆ–æ¶æ„ä»£ç ã€‚ ä½†æ˜¯å¦‚æžœæ”»å‡»è€…æ‹¿åˆ°æ­¤ä»£ç ,äºŒæ¬¡ä¿®æ”¹åŽè¿›è¡Œä¼ æ’­ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„é£Žé™©ã€‚å› æ­¤æŠ•æ¯’é£Žé™©éžå¸¸ä½Ž,ä¼°è®¡ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ­¤æ¼æ´žä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨ï¼š

1.  **é€šè¿‡`docker run -w`å‚æ•°ï¼š** å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨`-w /proc/self/fd/8`å‚æ•°å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚ç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œ`/proc/self/fd/8`æŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨å†…çš„æ“ä½œå®žé™…ä¸Šæ˜¯åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚
2.  **é€šè¿‡ç¬¦å·é“¾æŽ¥å’Œ`docker exec -w`å‚æ•°ï¼š** é¦–å…ˆï¼Œåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºæŒ‡å‘`/proc/self/fd/7/`å’Œ`/proc/self/fd/8/`çš„ç¬¦å·é“¾æŽ¥ã€‚ç„¶åŽï¼Œä½¿ç”¨`docker exec -w`å‘½ä»¤å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºè¿™äº›ç¬¦å·é“¾æŽ¥æŒ‡å‘çš„ç›®å½•ã€‚åŒæ ·ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œè¿™äº›ç¬¦å·é“¾æŽ¥å®žé™…ä¸ŠæŒ‡å‘çš„æ˜¯ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå…è®¸å®¹å™¨è®¿é—®å’Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žå…è®¸å®¹å™¨é€ƒé€¸ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è®¿é—®å’ŒæŽ§åˆ¶ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ æˆä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚

**é¡¹ç›®åœ°å€:** [FlojBoj/CVE-2024-21626](https://github.com/FlojBoj/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #2

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #3

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---



---

## POC #3

**æ¥æº**: [CVE-2024-21626-NitroCao_CVE-2024-21626.md](../2024/CVE-2024-21626-NitroCao_CVE-2024-21626.md)

## CVE-2024-21626-runc-container-breakout

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦runcç‰ˆæœ¬å°äºŽ1.1.12ï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦æ‰§è¡Œexecæˆ–runæ“ä½œ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽå†…éƒ¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ªrunc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å…·æœ‰å·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡runc runèŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ 

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒå±•ç¤ºäº†ä¸‰ç§åˆ©ç”¨è¯¥æ¼æ´žçš„æ–¹æ³•ï¼š

*   **é€šè¿‡è¿è¡Œå®¹å™¨ï¼š** ä½¿ç”¨`docker run -w /proc/self/fd/8 ...`å‘½ä»¤ï¼Œ`-w`å‚æ•°è®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•åˆ°`/proc/self/fd/8`ï¼Œåˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
*   **é€šè¿‡execè¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š** ç±»ä¼¼äºŽè¿è¡Œå®¹å™¨çš„æ–¹å¼ï¼Œé€šè¿‡`docker exec`è¿›å…¥å®¹å™¨å¹¶è®¾ç½®å·¥ä½œç›®å½•ã€‚
*   **é€šè¿‡runcæœ¬èº«ï¼š** ä½¿ç”¨`runc spec`ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹`config.json`ä¸­çš„`cwd`å­—æ®µä¸º`/proc/self/fd/7`ï¼Œæœ€åŽä½¿ç”¨`runc run`å¯åŠ¨å®¹å™¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥æ¼æ´žåˆ©ç”¨ä»£ç æœ¬èº«æ²¡æœ‰æ˜Žæ˜¾çš„æŠ•æ¯’ä»£ç ã€‚è¯¥å­˜å‚¨åº“ä¸»è¦æä¾›æ¼æ´žçš„è¯´æ˜Žå’Œåˆ©ç”¨ç¤ºä¾‹ã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•ä»Žäº’è”ç½‘ä¸‹è½½çš„ä»£ç éƒ½å­˜åœ¨æ½œåœ¨é£Žé™©ï¼Œä»¥ä¸‹ä¸ºé£Žé™©è¯„ä¼°è¯´æ˜Ž:

*   **ä¾èµ–é£Žé™©:** è¯¥æ¼æ´žçš„åˆ©ç”¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œä»»ä½•å¯¹å…¶è¿›è¡Œä¿®æ”¹éƒ½å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é£Žé™©ï¼Œå æ¯”4%ã€‚
*   **ä»£ç éšè—é£Žé™©:** ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–å…¶ä»–ä¸æ˜Žæ˜¾çš„æ–‡ä»¶ï¼‰åµŒå…¥æ¶æ„ä»£ç ï¼Œä½†è¿™éœ€è¦è¿›ä¸€æ­¥åˆ†æžï¼Œå æ¯”6%ã€‚

å› æ­¤ï¼Œæ€»ä½“æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

åˆ©ç”¨æ–¹å¼ä¸»è¦åŸºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚å½“runcæ‰§è¡Œ`exec`æˆ–`run`æ“ä½œæ—¶ï¼Œä¼šæ³„éœ²ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šè¿‡å°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/<fd>`ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯ä»¥è¯»å–æ•æ„Ÿä¿¡æ¯ã€ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´žï¼Œåˆ©ç”¨ç®€å•ï¼Œå½±å“å¹¿æ³›ã€‚å»ºè®®å°½å¿«å‡çº§runcåˆ°1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [NitroCao/CVE-2024-21626](https://github.com/NitroCao/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #4

**æ¥æº**: [CVE-2024-21626-R4mbb_CVE-2024-21626.md](../2024/CVE-2024-21626-R4mbb_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒèŽ·å–å®¿ä¸»æœºæƒé™

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å­˜åœ¨æ¼æ´žç‰ˆæœ¬çš„runcçŽ¯å¢ƒï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨çš„æƒé™

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå®¹å™¨é€ƒé€¸ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚è¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦ä¾èµ–äºŽ runc åœ¨å¤„ç† cgroup æ—¶æœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚æ”»å‡»è€…é€šè¿‡æŽ§åˆ¶å®¹å™¨çš„ cwd (current working directory) åˆ° /proc/self/fd/7 è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯ã€æœç´¢å¼•æ“Žç»“æžœå’Œæä¾›çš„POCä»£ç ï¼Œå¯ä»¥åˆ¤æ–­æ­¤POCä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æœç´¢å¼•æ“Žç»“æžœä¸­å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚NVDã€RedHatã€Wiz.ioã€WithSecureã€Snyk.ioã€nitroc.orgï¼‰å‡ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨ä»¥åŠé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸çš„å¯èƒ½æ€§ã€‚POCä»£ç  `poc-autoplay.sh` è„šæœ¬æ¨¡æ‹Ÿäº†æ”»å‡»æµç¨‹ï¼Œé€šè¿‡ä¿®æ”¹ `config.json` æ–‡ä»¶ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é€ƒé€¸ã€‚`README.md` ä¸­ä¹Ÿè¯¦ç»†æè¿°äº†æ¼æ´žåŽŸç†å’Œåˆ©ç”¨æ–¹æ³•ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

åˆ†æžPOCä»£ç ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œä½†ä¸èƒ½å®Œå…¨æŽ’é™¤ã€‚ç†ç”±å¦‚ä¸‹ï¼š

*   `poc-autoplay.sh` çš„ä¸»è¦åŠŸèƒ½æ˜¯å®‰è£…å’Œé…ç½® Docker çŽ¯å¢ƒï¼Œä»¥åŠè¿è¡ŒåŒ…å«æ¼æ´žåˆ©ç”¨çš„ runc å®¹å™¨ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ `apt-get install` å‘½ä»¤å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœè½¯ä»¶æºè¢«ç¯¡æ”¹ï¼Œåˆ™å¯èƒ½å®‰è£…æ¶æ„è½¯ä»¶åŒ…ã€‚ä½†è„šæœ¬æœ¬èº«æ²¡æœ‰å‘çŽ°ç›´æŽ¥çš„æ¶æ„ä»£ç ã€‚
*   è„šæœ¬ä¼šä¸‹è½½ Docker çš„ GPG å¯†é’¥ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿¡ä»»çš„å¯†é’¥åˆ—è¡¨ä¸­ã€‚å¦‚æžœ GPG å¯†é’¥è¢«æ¶æ„æ›¿æ¢ï¼Œåˆ™å¯èƒ½å¯¼è‡´å®‰è£…è¢«ç¯¡æ”¹çš„ Docker è½¯ä»¶åŒ…ã€‚
*   è„šæœ¬è¿˜å°è¯•èŽ·å–å®‰è£…å‰åŽè½¯ä»¶åŒ…åˆ—è¡¨,ä»¥å°è¯•è¿›è¡Œå¯¹æ¯”, è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é£Žé™©,å¯èƒ½ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚
*   æ€»ä½“æ¥è¯´ï¼Œè¯¥POCä¸»è¦ä¾§é‡äºŽæ¼æ´žåˆ©ç”¨ï¼Œè€Œéžæ¶æ„ä»£ç ä¼ æ’­ã€‚ä½†ç”±äºŽæ¶‰åŠåˆ°å¤–éƒ¨èµ„æºçš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ï¼Œå¤§æ¦‚åœ¨10%ã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼š** runc åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šæ‰“å¼€ä¸€äº›å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ cgroup æ–‡ä»¶ã€‚ç”±äºŽç–å¿½ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«æ­£ç¡®å…³é—­ï¼Œè€Œæ˜¯æ³„æ¼åˆ°äº†å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹ä¸­ã€‚
2.  **æŽ§åˆ¶å®¹å™¨å·¥ä½œç›®å½•ï¼š** æ”»å‡»è€…é€šè¿‡ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è·¯å¾„ï¼ˆä¾‹å¦‚ `/proc/self/fd/7`ï¼‰ã€‚
3.  **å®¹å™¨é€ƒé€¸ï¼š** å®¹å™¨å†…çš„è¿›ç¨‹é€šè¿‡å·¥ä½œç›®å½•è®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

*   å‡†å¤‡ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ runc çŽ¯å¢ƒã€‚
*   åˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚
*   ä¿®æ”¹ runc çš„é…ç½®æ–‡ä»¶ `config.json`ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/7`ã€‚
*   è¿è¡Œå®¹å™¨ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°±å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿäº†ã€‚
*   `make install` ä¼šæ‰§è¡Œpoc-autoplay.shè„šæœ¬è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶å¯¹æ¯”pocå‰åŽå®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨
*   `make uninstall` ä¼šåˆ é™¤æµ‹è¯•æ–‡ä»¶ä»¥åŠå¸è½½å®‰è£…çš„docker

**é¡¹ç›®åœ°å€:** [R4mbb/CVE-2024-21626](https://github.com/R4mbb/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #5

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626-old-docker-versions.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¹¶ä¸”å®¹å™¨éœ€è¦å…·æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker exec`æˆ–è€…è¿è¡Œæ¶æ„é•œåƒï¼‰ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæºäºŽ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ¼æ´žåˆ©ç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. **æ”»å‡»æ–¹å¼1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æ¶æ„é•œåƒå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2. **æ”»å‡»æ–¹å¼2ï¼ˆrunc execï¼‰ï¼š** é€šè¿‡ `runc exec` å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹å¯èƒ½å…·æœ‰å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„å·¥ä½œç›®å½•ï¼Œå…è®¸é€ƒé€¸ã€‚
3. **æ”»å‡»æ–¹å¼3aå’Œ3bï¼ˆè¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼š** å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–åŠä»»æ„çš„å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

æ ¹æ®æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é¦–å…ˆç¡®å®šç›®æ ‡çŽ¯å¢ƒæ˜¯å¦æ˜“å—æ”»å‡»ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚`checkVulnerability.sh` è„šæœ¬é€šè¿‡åœ¨ä¸€å®šèŒƒå›´å†…å¾ªçŽ¯ï¼Œä½¿ç”¨ `docker run` å‘½ä»¤å°è¯•ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æžœèƒ½å¤Ÿè¯»å–åˆ°å®¿ä¸»æœºçš„ `/etc/passwd` æ–‡ä»¶ï¼Œåˆ™è¯´æ˜Žè¯¥æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¹¶ä¸”ç›®æ ‡çŽ¯å¢ƒæ˜“å—æ”»å‡»ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦åŽï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œä¾‹å¦‚è¯»å–å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

å°½ç®¡è¯¥ä»“åº“æä¾›äº†åˆ©ç”¨ CVE-2024-21626 æ¼æ´žçš„ PoC ä»£ç ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£Žé™©ã€‚ä»“åº“ä¸­çš„ `checkVulnerability.sh` è„šæœ¬å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´žå­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸäº›æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è„šæœ¬ï¼‰ï¼Œæˆ–è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚è¯¥ä»“åº“è¿˜æä¾›äº†ä¸€ä¸ªä¿®æ”¹åŽçš„Dockerç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æœ¬èº«å¯èƒ½è¢«ç¯¡æ”¹ï¼Œä½¿å¾—å¯ä»¥åŽé—¨è¿›å…¥å®¿ä¸»æœºã€‚è¯¥æŠ•æ¯’é£Žé™©æ¯”ä¾‹è¯„å®šä¸º10%ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

åœ¨æµ‹è¯•è¯¥æ¼æ´žæ—¶ï¼ŒåŠ¡å¿…åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­è¿›è¡Œï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç æ„ŸæŸ“å®¿ä¸»æœºã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626-old-docker-versions](https://github.com/Sk3pper/CVE-2024-21626-old-docker-versions)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #6

**æ¥æº**: [CVE-2024-21626-Sk3pper_CVE-2024-21626.md](../2024/CVE-2024-21626-Sk3pper_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®Œå…¨çš„å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ç”¨æˆ·è¿è¡Œå—æ±¡æŸ“çš„é•œåƒæˆ–è€…ä½¿ç”¨runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 20%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` åˆ›å»ºçš„æ–°å®¹å™¨è¿›ç¨‹ï¼Œä½¿å…¶å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œä½¿å®¹å™¨è¿›ç¨‹é€šè¿‡ `runc run` èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå·²ç»ç¡®è®¤å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰PoCã€‚æä¾›çš„Dockerfileå’ŒREADME.mdæè¿°äº†åˆ©ç”¨æ–¹å¼å’ŒçŽ¯å¢ƒå‡†å¤‡ï¼Œè¡¨æ˜Žè¯¥æ¼æ´žå¯ä»¥è¢«æˆåŠŸåˆ©ç”¨ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
æä¾›çš„ä»£ç ç‰‡æ®µä¸»è¦åŒ…å«Dockerfileå’ŒREADME.mdï¼Œç”¨äºŽé…ç½®æ¼æ´žåˆ©ç”¨çŽ¯å¢ƒï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚é£Žé™©ä¸»è¦åœ¨äºŽï¼š
1.  Dockerfileä¸­çš„ubuntué•œåƒå¯èƒ½è¢«æ›¿æ¢ä¸ºåŒ…å«æ¶æ„è½¯ä»¶çš„é•œåƒï¼ˆä½Žå¯èƒ½æ€§ï¼Œå› ä¸ºDockerfileæŒ‡å®šäº†æ˜Žç¡®çš„ubuntuç‰ˆæœ¬ï¼‰ã€‚
2.  README.mdå¼•å¯¼ç”¨æˆ·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerå’Œruncï¼Œå¦‚æžœç”¨æˆ·ä»Žä¸å¯ä¿¡çš„æºä¸‹è½½è¿™äº›è½¯ä»¶åŒ…ï¼Œå¯èƒ½ä¼šå®‰è£…è¢«ç¯¡æ”¹çš„ç‰ˆæœ¬ï¼ˆä¸­ç­‰å¯èƒ½æ€§ï¼‰ã€‚
3.  githubä»“åº“ä½œè€…æœ¬èº«å­˜åœ¨æŠ•æ¯’å¯èƒ½ï¼Œé€šè¿‡åŽç»­æäº¤æ¶æ„ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·ä¸‹è½½ï¼Œä½†ç›®å‰æä¾›çš„ä»£ç æ²¡æœ‰æ˜Žæ˜¾é£Žé™©ã€‚
å› æ­¤, ç»¼åˆåˆ¤æ–­, æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼Œå‡è®¾ä¸º20%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°ï¼Œå­˜åœ¨å¤šç§åˆ©ç”¨æ–¹å¼ï¼š
1.  **æ”»å‡» 1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** æž„å»ºåŒ…å«æ¶æ„payloadçš„é•œåƒï¼Œå½“è¿è¡Œæ­¤é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹èŽ·å¾—å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚
2.  **æ”»å‡» 2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽå®¿ä¸»æœºï¼Œä»Žè€Œè®¿é—®å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **æ”»å‡» 3a/3bï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼‰ï¼š** åˆ©ç”¨å‰ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œè¿›ä¸€æ­¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°å®Œå…¨çš„å®¹å™¨é€ƒé€¸ã€‚æä¾›çš„ä»£ç ä»“åº“çš„æè¿°å°è¯äº†å¯ä»¥é€šè¿‡ `-w` å‚æ•°æŒ‡å®šå·¥ä½œç›®å½•æ¥åˆ©ç”¨æ­¤æ¼æ´žã€‚
Dockerfileä¸­`WORKDIR /proc/self/fd/8` è¿™è¡Œä»£ç ï¼Œæ­£æ˜¯åˆ©ç”¨äº†æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°è¯•å°†å®¹å™¨çš„å·¥ä½œç›®å½•æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚

**é¡¹ç›®åœ°å€:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #7

**æ¥æº**: [CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md](../2024/CVE-2024-21626-V0WKeep3r_CVE-2024-21626-runcPOC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦ä½¿ç”¨å­˜åœ¨æ¼æ´žçš„runcç‰ˆæœ¬ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨æˆ–ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚å½“ä½¿ç”¨ `runc exec` åˆ›å»ºæ–°å®¹å™¨è¿›ç¨‹æ—¶ï¼Œç”±äºŽæœªæ­£ç¡®å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šæ³„æ¼åˆ°å®¹å™¨çŽ¯å¢ƒä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®å’Œä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§:**

æä¾›çš„POCä»£ç æœ‰æ•ˆï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

*   `Dockerfile`: ç”¨äºŽæž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚å…³é”®åœ¨äºŽå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œåˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
*   `poc.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽä¿®æ”¹å®¿ä¸»æœºä¸Šçš„ `/var/spool/cron/crontabs/root` æ–‡ä»¶ï¼Œæ·»åŠ åå¼¹shellçš„å®šæ—¶ä»»åŠ¡ï¼Œä»Žè€ŒèŽ·å–å®¿ä¸»æœºçš„shellã€‚
*   `poc2.sh`: æ¼æ´žåˆ©ç”¨è„šæœ¬ï¼Œç”¨äºŽè¦†ç›–å®¿ä¸»æœºä¸Šçš„ `/bin/bash.copy` æ–‡ä»¶ï¼Œå®žçŽ°åå¼¹shellã€‚
*   `verify.sh`: ç”¨äºŽæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚
*   `README.md`: æä¾›äº†æ¼æ´žçš„ç®€ä»‹ã€åˆ©ç”¨æ–¹æ³•ã€åŽŸç†åˆ†æžå’Œä¿®å¤æ–¹æ¡ˆã€‚

**æŠ•æ¯’é£Žé™©:**

ä»£ç ä¸­å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ï¼Œä¸»è¦ä½“çŽ°åœ¨ `poc.sh` å’Œ `poc2.sh` è„šæœ¬ä¸­ã€‚

*   `poc.sh` é€šè¿‡ä¿®æ”¹ `/var/spool/cron/crontabs/root` æ–‡ä»¶æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè¯¥æ–‡ä»¶æ˜¯å®¿ä¸»æœºä¸Šçš„ç³»ç»Ÿæ–‡ä»¶ã€‚æ¶æ„ä¿®æ”¹è¯¥æ–‡ä»¶å¯èƒ½å¯¼è‡´å®¿ä¸»æœºä¸Šçš„å…¶ä»–å®šæ—¶ä»»åŠ¡å¤±æ•ˆï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†è€ƒè™‘åˆ°è¿™æ˜¯POCéªŒè¯çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚
*   `poc2.sh` è„šæœ¬å°è¯•è¦†ç›– `/bin/bash.copy` æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè„šæœ¬æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–è¯¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼Œæˆ–è€…æ‰§è¡Œæ¶æ„ä»£ç ã€‚åŒæ ·çš„ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯POCï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«ç†è§£ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¯¥ä»“åº“çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆ10%ï¼‰ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯èƒ½å½±å“å®¿ä¸»æœºçš„æ¶æ„ä¿®æ”¹æ“ä½œã€‚æ¶æ„ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶å’Œè¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸€å®šå½±å“ï¼Œä½†è¿™äº›æ“ä½œæ˜¯æ¼æ´žéªŒè¯çš„å¿…è¦æ­¥éª¤ã€‚

**åˆ©ç”¨æ–¹å¼:**

1.  **æž„å»ºæ¶æ„é•œåƒ:** ä½¿ç”¨ `Dockerfile` æž„å»ºåŒ…å«æ¼æ´žåˆ©ç”¨è„šæœ¬çš„æ¶æ„é•œåƒã€‚
2.  **æŸ¥æ‰¾æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è¿è¡Œ `verify.sh` è„šæœ¬ï¼ŒæŸ¥æ‰¾å½“å‰æœºå™¨çŽ¯å¢ƒä¸­æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å…·ä½“å€¼ã€‚å¦‚æžœä¸æ˜¯8ï¼Œéœ€è¦ä¿®æ”¹ Dockerfile çš„ WORKDIR æˆ–è€…åœ¨ä½¿ç”¨ `docker run` æ—¶ä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šã€‚
3.  **è¿è¡Œæ¶æ„é•œåƒ:** è¿è¡Œæž„å»ºå¥½çš„æ¶æ„é•œåƒï¼Œå¹¶æ‰§è¡Œæ¼æ´žåˆ©ç”¨è„šæœ¬ `poc.sh` æˆ– `poc2.sh`ã€‚
4.  **åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦:** è„šæœ¬åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚
5.  **èŽ·å–å®¿ä¸»æœºshell:** é€šè¿‡ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ–‡ä»¶æˆ–è¦†ç›–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ï¼ŒèŽ·å–å®¿ä¸»æœºçš„shellï¼Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

æ”»å‡»è€…éœ€è¦èƒ½å¤ŸæŽ§åˆ¶å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ¶æ„é•œåƒåˆ›å»ºå®¹å™¨æ‰èƒ½æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´žã€‚æ ¹æ®æœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå½±å“å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å¯¹åº•å±‚å®¿ä¸»æœºçš„å®Œæ•´æŽ§åˆ¶ã€‚

**é¡¹ç›®åœ°å€:** [V0WKeep3r/CVE-2024-21626-runcPOC](https://github.com/V0WKeep3r/CVE-2024-21626-runcPOC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #8

**æ¥æº**: [CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-Wall1e_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å†…æ ¸æ”¯æŒopenat2 (kernel version >= 5.6), å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤, å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯runcä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žã€‚åˆ©ç”¨è¯¥æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥ä»Žå®¹å™¨ä¸­é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥èŽ·å¾—ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**æœ‰æ•ˆæ€§ï¼š**

æä¾›çš„POCä»£ç çœ‹èµ·æ¥æ˜¯æœ‰æ•ˆçš„ã€‚å®ƒåˆ©ç”¨äº†runcä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ¼æ´žï¼Œé€šè¿‡`process.cwd`çš„trickeryï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

`Dockerfile`ç”¨äºŽæž„å»ºåŒ…å«å¿…è¦å·¥å…·ï¼ˆnetcatï¼‰å’ŒPOCè„šæœ¬çš„é•œåƒã€‚
`poc.sh` è„šæœ¬ä¼šå°†ä¸€ä¸ªåå¼¹shellè„šæœ¬å†™å…¥åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„`/bin/bash.copy`ï¼Œç„¶åŽå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬ï¼Œç­‰å¾…åå¼¹ shell è¿žæŽ¥ã€‚
`verify.sh`è„šæœ¬å°è¯•é€šè¿‡éåŽ†ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–ä¸»æœºä¸Šçš„`/etc/passwd`æ–‡ä»¶ï¼Œæ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚
`README.md` æä¾›äº†æ¼æ´žæè¿°ã€ä½¿ç”¨è¯´æ˜Žä»¥åŠå‚è€ƒé“¾æŽ¥ï¼Œå¹¶è¯´æ˜Žäº†æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ã€‚

æ ¹æ®æœç´¢ç»“æžœï¼Œè¿™ä¸ªæ¼æ´žå½±å“äº†runc 1.1.12ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤šä¸ªæ¥æºéƒ½ç¡®è®¤äº†æ¼æ´žçš„å­˜åœ¨å’Œåˆ©ç”¨æ–¹æ³•ï¼Œå› æ­¤è¯¥POCçš„æœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

è¯¥ä»“åº“å¯èƒ½å­˜åœ¨è½»å¾®çš„æŠ•æ¯’é£Žé™©ï¼Œå¯èƒ½æ€§çº¦ä¸º10%ã€‚

ä¸»è¦é£Žé™©ç‚¹åœ¨äºŽ `poc.sh` è„šæœ¬ï¼Œå®ƒåœ¨ä¸»æœºä¸Šå†™å…¥äº†ä¸€ä¸ªåä¸º `/bin/bash.copy` çš„æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªæ–‡ä»¶æœ¬èº«æ˜¯ä¸ºäº†åˆ©ç”¨æ¼æ´žè€Œåˆ›å»ºçš„åå¼¹shellï¼Œä½†å¦‚æžœæ”»å‡»è€…åœ¨ `poc.sh` ä¸­åŠ å…¥é¢å¤–çš„æ¶æ„ä»£ç ï¼Œä¾‹å¦‚åˆ é™¤å…³é”®æ–‡ä»¶ã€å®‰è£…åŽé—¨æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¸¦æ¥æŠ•æ¯’é£Žé™©ã€‚ ç”¨æˆ·å¦‚æžœç›´æŽ¥ä½¿ç”¨æœªç»å®¡æŸ¥çš„`poc.sh`ï¼Œå¯èƒ½ä¼šåœ¨ä¸»æœºä¸Šç•™ä¸‹æ½œåœ¨çš„åŽé—¨ã€‚

åŒæ—¶éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œ`verify.sh`è„šæœ¬ä¸­éåŽ†æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œå¦‚æžœè¢«æ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹ä¸»æœºé€ æˆä¸€å®šçš„èµ„æºæ¶ˆè€—ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **çŽ¯å¢ƒå‡†å¤‡ï¼š** ç¡®ä¿è¿è¡Œruncçš„ç‰ˆæœ¬ä½ŽäºŽ1.1.12ï¼Œä¸”æ»¡è¶³POCæ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼ˆå†…æ ¸ç‰ˆæœ¬ã€å®¹å™¨åˆ›å»ºæƒé™ç­‰ï¼‰ã€‚
2.  **æž„å»ºé•œåƒï¼š** ä½¿ç”¨æä¾›çš„`Dockerfile`æž„å»ºä¸€ä¸ªåŒ…å«POCè„šæœ¬çš„dockeré•œåƒã€‚
3.  **è¿è¡Œå®¹å™¨ï¼š** è¿è¡Œæž„å»ºå¥½çš„é•œåƒï¼Œå¹¶æ‰§è¡Œ`poc.sh`è„šæœ¬ã€‚ è„šæœ¬ä¼šå°è¯•åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`/bin/bash.copy`çš„åå¼¹shellï¼Œå¹¶å¯åŠ¨ç›‘å¬ã€‚
4.  **å»ºç«‹è¿žæŽ¥ï¼š** åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ `/bin/bash.copy`, éšåŽæ”»å‡»è€…å³å¯é€šè¿‡ netcat å»ºç«‹è¿žæŽ¥ï¼ŒèŽ·å¾—ä¸»æœºçš„shellã€‚
5.  **é€ƒé€¸ï¼š** æ­¤æ—¶ï¼Œæ”»å‡»è€…å·²ç»é€ƒé€¸åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ‹¥æœ‰äº†ä¸»æœºçš„shellï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚

ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„æ¼ï¼Œå°†å®¹å™¨å†…çš„æ“ä½œæ˜ å°„åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œå†™å…¥æ¶æ„æ–‡ä»¶ï¼ŒèŽ·å¾—åå¼¹shellï¼Œæœ€ç»ˆå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**é¡¹ç›®åœ°å€:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #9

**æ¥æº**: [CVE-2024-21626-abian2_CVE-2024-21626.md](../2024/CVE-2024-21626-abian2_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠè¿è¡Œæ¶æ„é•œåƒæˆ–æ‰§è¡Œæ¶æ„å‘½ä»¤çš„èƒ½åŠ›

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼ŒæºäºŽruncåœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨æ³„æ¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´žï¼Œé€šè¿‡ç‰¹åˆ¶çš„å®¹å™¨é•œåƒæˆ–`runc exec`å‘½ä»¤ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcwdï¼‰æŒ‡å‘å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æä¾›çš„Dockerfileå±•ç¤ºäº†åˆ©ç”¨æ–¹å¼ï¼šå®ƒå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`/proc/self/fd/8`ï¼Œå…¶ä¸­`8`æ˜¯ä¸€ä¸ªæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚ç„¶åŽï¼Œé€šè¿‡`cat ../../../../etc/passwd`è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žæè¿°ï¼Œè¿˜å¯èƒ½åˆ©ç”¨æ­¤æ¼æ´žè¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»é¢ã€‚ 

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**

æä¾›çš„POCä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯è¯¥æ¼æ´žã€‚æœç´¢ç»“æžœä¸­çš„å¤šä¸ªé“¾æŽ¥ï¼ˆå¦‚`https://github.com/NitroCao/CVE-2024-21626`å’Œ`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`ï¼‰ä¹Ÿè¡¨æ˜Žå­˜åœ¨å…¬å¼€å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£Žé™©è¯„ä¼°ï¼š**

ç”±äºŽPOCä»£ç éžå¸¸ç®€æ´ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„æ¼è¯»å–å®¿ä¸»æœºæ–‡ä»¶ï¼Œå› æ­¤ç›´æŽ¥çš„æŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚ä½†æ˜¯ï¼Œä»å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼Œä¾‹å¦‚ï¼š

1.  **æž„å»ºæ—¶æŠ•æ¯’ï¼š** Dockerfileä¸­å¯èƒ½å­˜åœ¨é€šè¿‡`RUN`æŒ‡ä»¤æ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œä»Žè€Œåœ¨æž„å»ºé•œåƒæ—¶æ¤å…¥åŽé—¨çš„é£Žé™©ã€‚
2.  **ä¾èµ–æŠ•æ¯’ï¼š** åŸºç¡€é•œåƒ`alpine`å¯èƒ½å·²è¢«ç¯¡æ”¹ï¼ŒåŒ…å«æ¶æ„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½æ€§è¾ƒä½Žï¼‰ã€‚
3.  **ä¾›åº”é“¾æŠ•æ¯’ï¼š** æ”»å‡»è€…å¯èƒ½ç¯¡æ”¹ä»£ç ä»“åº“æˆ–æž„å»ºæµç¨‹ï¼Œä»Žè€Œå¼•å…¥æ¶æ„ä»£ç ã€‚ä½†å°±æä¾›çš„Dockerfileæœ¬èº«æ¥è¯´ï¼ŒæŠ•æ¯’é£Žé™©è¾ƒä½Žã€‚æ‰€ä»¥ç»¼åˆè¯„ä¼°æŠ•æ¯’é£Žé™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š**

1.  **æ¶æ„é•œåƒï¼š** æž„å»ºåŒ…å«æ¶æ„ä»£ç çš„Dockeré•œåƒï¼Œåˆ©ç”¨æ¼æ´žè¯»å–æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ã€‚
2.  **æ¶æ„å‘½ä»¤ï¼š** é€šè¿‡`runc exec`ç­‰å‘½ä»¤ï¼Œç»“åˆæ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰§è¡Œå®¿ä¸»æœºä¸Šçš„å‘½ä»¤ã€‚
3.  **æ–‡ä»¶è¦†ç›–ï¼š** åˆ©ç”¨æ³„æ¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¦†ç›–å®¿ä¸»æœºä¸Šçš„å…³é”®äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®žçŽ°æŒä¹…åŒ–æŽ§åˆ¶ã€‚

è¯¥æ¼æ´žçš„ä¿®å¤æ–¹æ³•æ˜¯å‡çº§åˆ°runc 1.1.12æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¿®å¤äº†æ–‡ä»¶æè¿°ç¬¦æ³„æ¼é—®é¢˜ã€‚

**é¡¹ç›®åœ°å€:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #10

**æ¥æº**: [CVE-2024-21626-adaammmeeee_little-joke.md](../2024/CVE-2024-21626-adaammmeeee_little-joke.md)

## CVE-2024-21626-runc-å®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®å’ŒæŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦è¿è¡Œå—å½±å“ç‰ˆæœ¬çš„runcçš„å®¹å™¨çŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å’Œè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•æ“ä½œæ¥å®žçŽ°å®¹å™¨é€ƒé€¸ã€‚æ ¹æ®æ¼æ´žä¿¡æ¯ï¼Œåœ¨run execæˆ–runå‘½ä»¤ä¸‹ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹å¯èƒ½æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ã€‚

**æœ‰æ•ˆæ€§è¯„ä¼°ï¼š**
æ ¹æ®æœç´¢ç»“æžœå’Œæ¼æ´žæè¿°ï¼Œè¯¥æ¼æ´žç¡®å®žå­˜åœ¨ï¼Œå¹¶ä¸”æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹æ³•ã€‚æœç´¢ç»“æžœä¸­[webpage 8](https://github.com/NitroCao/CVE-2024-21626)æåˆ°äº†åˆ©ç”¨æ–¹å¼ï¼Œå³é€šè¿‡è¿è¡Œä¸€ä¸ªå¸¦æœ‰`-w`å‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œè¯´æ˜ŽPOCè¾ƒä¸ºç®€å•ï¼Œæœ‰æ•ˆæ€§è¾ƒé«˜ã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**
æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç åŒ…å«ä¸¤ä¸ª shell è„šæœ¬ï¼š
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`ï¼šè¯¥è„šæœ¬åªæ˜¯ç®€å•åœ°è¾“å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜Žç³»ç»Ÿå­˜åœ¨æ¼æ´žï¼Œæç¤ºç”¨æˆ·æ›´æ–° runc ç‰ˆæœ¬ã€‚å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•æ¶æ„æ“ä½œã€‚
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`ï¼šè¯¥è„šæœ¬ä¿®æ”¹ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ï¼Œä½¿å¾—æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½ä¼šéšæœºæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚è™½ç„¶ä¿®æ”¹äº† `.bashrc` æ–‡ä»¶ï¼Œä½†å®ƒæ²¡æœ‰æ‰§è¡Œä»»ä½•å±é™©æ“ä½œï¼Œåªæ˜¯æ›´æ”¹äº†ç»ˆç«¯çš„æ˜¾ç¤ºæ•ˆæžœã€‚

ç»¼åˆæ¥çœ‹ï¼Œæä¾›çš„POCä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žçš„å­˜åœ¨ï¼Œå¹¶æ— æ˜Žæ˜¾çš„æ¶æ„ä»£ç ï¼Œåˆ¤æ–­å­˜åœ¨è½»å¾®æŠ•æ¯’ä»£ç çš„æ¦‚çŽ‡æ˜¯10%ï¼Œä¸»è¦åŽŸå› æ˜¯`script2.sh`ä¿®æ”¹äº†`.bashrc`ï¼Œè™½ç„¶æ²¡æœ‰ç›´æŽ¥å±å®³ï¼Œä½†å¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žçš„åˆ©ç”¨æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1.  **é€šè¿‡ `runc exec` å‘½ä»¤é€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿æ–°åˆ›å»ºçš„å®¹å™¨è¿›ç¨‹æ‹¥æœ‰ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸‹çš„å·¥ä½œç›®å½•ï¼Œä»Žè€Œè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
2.  **é€šè¿‡æ¶æ„é•œåƒé€ƒé€¸ï¼š** æ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„é•œåƒä¸­åˆ©ç”¨è¯¥æ¼æ´žï¼Œå½“ç”¨æˆ·è¿è¡Œè¯¥é•œåƒæ—¶ï¼Œå®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
3.  **è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š** æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¦†ç›–ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œæ•´çš„å®¹å™¨é€ƒé€¸ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒCVE-2024-21626æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œä»Žè€ŒæŽ§åˆ¶ä¸»æœºã€‚å»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #11

**æ¥æº**: [CVE-2024-21626-cdxiaodong_CVE-2024-21626.md](../2024/CVE-2024-21626-cdxiaodong_CVE-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´å®¿ä¸»æœºæƒé™æ³„éœ²å’Œå®Œå…¨æŽ§åˆ¶

**å½±å“ç‰ˆæœ¬:** >=v1.0.0-rc93, < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œä»¥åŠdockerçŽ¯å¢ƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626æ˜¯ä¸€ä¸ªruncå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä»Žå®¹å™¨å†…éƒ¨è®¿é—®ç”šè‡³æŽ§åˆ¶å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**

è¯¥æ¼æ´žæºäºŽruncåœ¨å¤„ç†å®¹å™¨å·¥ä½œç›®å½•æ—¶å­˜åœ¨ç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥æ¼æ´žï¼š

1.  **runc exec:** å½“ä½¿ç”¨`runc exec`å‘½ä»¤åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ–°è¿›ç¨‹æ—¶ï¼Œå¦‚æžœæ”»å‡»è€…èƒ½å¤ŸæŽ§åˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚é€šè¿‡æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦(`/proc/self/fd/`)è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
2.  **æ¶æ„é•œåƒ:** æ”»å‡»è€…å¯ä»¥æž„å»ºä¸€ä¸ªæ¶æ„çš„Dockeré•œåƒï¼Œè¯¥é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

æ ¹æ®æ¼æ´žåˆ©ç”¨ä»£ç ï¼ŒPOCé€šè¿‡docker-composeå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆé€šè¿‡è¯»å–å®¿ä¸»æœºçš„`/etc/passwd`æ–‡ä»¶æ¥éªŒè¯æ¼æ´žæ˜¯å¦å­˜åœ¨ã€‚POCä»£ç ä¸­ä½¿ç”¨äº†`/proc/self/fd/`çš„æ–¹å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¯•å›¾åˆ©ç”¨å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

**æŠ•æ¯’é£Žé™©åˆ†æžï¼š**

è¯¥POCç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ¼æ´žçš„å­˜åœ¨ã€‚å…¶ä¸­docker-compose.ymlåˆ›å»ºäº†å¤šä¸ªå®¹å™¨ï¼Œåˆ†åˆ«å°è¯•ä¸åŒçš„/proc/self/fd/å€¼ï¼Œå¢žåŠ äº†æˆåŠŸçŽ‡ã€‚ç”±äºŽåªæ˜¯ç®€å•çš„æ–‡ä»¶è¯»å–ï¼Œä¸å­˜åœ¨æ˜Žæ˜¾çš„æ¶æ„ä»£ç ã€‚ä½†æ˜¯ï¼Œä»éœ€è°¨æ…Žå¯¹å¾…ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„POCä»£ç ã€‚

*   **æ½œåœ¨é£Žé™©:** è™½ç„¶ä»£ç ä¸»è¦ç›®çš„æ˜¯è¯»å–`/etc/passwd`ï¼Œä½†ç†è®ºä¸ŠæˆåŠŸåˆ©ç”¨åŽï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä»»æ„æ“ä½œã€‚å¦‚æžœæ”»å‡»è€…åœ¨å…¶ä»–æ–‡ä»¶ä¸­åŠ å…¥æ¶æ„å‘½ä»¤ï¼Œå­˜åœ¨æ½œåœ¨é£Žé™©ã€‚

**ç»“è®º:**

ç»¼åˆæ¥çœ‹ï¼Œè¯¥POCçš„æŠ•æ¯’é£Žé™©è¾ƒä½Žï¼ˆçº¦5%ï¼‰ï¼Œä¸»è¦é£Žé™©åœ¨äºŽæˆåŠŸåˆ©ç”¨æ¼æ´žåŽå¯èƒ½äº§ç”Ÿçš„æ½œåœ¨å±å®³ã€‚ä½¿ç”¨è€…åº”è¯¥åœ¨éš”ç¦»çš„çŽ¯å¢ƒä¸­æµ‹è¯•POCï¼Œå¹¶ä»”ç»†æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚

**é¡¹ç›®åœ°å€:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #12

**æ¥æº**: [CVE-2024-21626-dorser_cve-2024-21626.md](../2024/CVE-2024-21626-dorser_cve-2024-21626.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼ŒæŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“ç‰ˆæœ¬çš„runcï¼Œå¯èƒ½æ˜¯æ¶æ„é•œåƒæˆ–runc exec

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žæ˜¯ runc ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žä½¿æ–°ç”Ÿæˆçš„å®¹å™¨è¿›ç¨‹ï¼ˆæ¥è‡ª runc execï¼‰åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­æ‹¥æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œä»Žè€Œå…è®¸é€šè¿‡è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæ¥é€ƒé€¸å®¹å™¨ï¼ˆæ”»å‡» 2ï¼‰ã€‚æ¶æ„é•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”»å‡»ï¼Œå…è®¸å®¹å™¨è¿›ç¨‹é€šè¿‡ runc run èŽ·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ï¼ˆæ”»å‡» 1ï¼‰ã€‚æ”»å‡» 1 å’Œ 2 çš„å˜ä½“ä¹Ÿå¯ç”¨äºŽè¦†ç›–åŠä»»æ„ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®Œå…¨å®¹å™¨é€ƒé€¸ï¼ˆæ”»å‡» 3a å’Œæ”»å‡» 3bï¼‰ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**

1.  **æ¶æ„é•œåƒï¼ˆæ”»å‡» 1ï¼‰ï¼š** æ¶æ„é•œåƒåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå°†å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œä»Žè€ŒèŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚
2.  **runc execï¼ˆæ”»å‡» 2ï¼‰ï¼š**  æ”»å‡»è€…åœ¨ä½¿ç”¨ `runc exec` è¿›å…¥å®¹å™¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žï¼Œä½¿å¾—æ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•ä½äºŽå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚
3.  **è¦†ç›–å®¿ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”»å‡» 3a å’Œ 3bï¼‰ï¼š**  åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²èŽ·å¾—å¯¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æƒé™åŽï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–å®¿ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æƒé™æˆ–æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**æ¼æ´žåˆ©ç”¨æœ‰æ•ˆæ€§ï¼š**

æ ¹æ®æ¼æ´žåº“ä¿¡æ¯å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žå­˜åœ¨PoCï¼Œä¸”åˆ©ç”¨è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡githubä¸Šçš„[webpage 8 begin] [title] NitroCao/CVE-2024-21626çš„æè¿°ï¼Œå¯ä»¥ç¡®å®šåªéœ€è¦è¿è¡Œä¸€ä¸ªå¸¦æœ‰-wå‚æ•°çš„å®¹å™¨å³å¯åˆ©ç”¨ï¼Œæ— éœ€æž„å»ºè‡ªå®šä¹‰é•œåƒã€‚

**æŠ•æ¯’é£Žé™©ï¼š**

æä¾›çš„æ¼æ´žåˆ©ç”¨ä»£ç ä»…åŒ…å«GNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼Œæ²¡æœ‰å‘çŽ°ä»»ä½•å¯ç–‘çš„æˆ–æ¶æ„çš„ä»£ç ã€‚å› æ­¤ï¼Œè¯¥ä»£ç ä»“åº“ä¸­å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„é£Žé™©è¾ƒä½Žï¼ŒæŽ¥è¿‘0%ã€‚

**æ€»ç»“ï¼š**

CVE-2024-21626 æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´žï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶æŽ§åˆ¶å®¿ä¸»æœºã€‚ç”±äºŽå­˜åœ¨å…¬å¼€çš„ PoC ä¸”åˆ©ç”¨æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå»ºè®®å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§åˆ° runc 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

**é¡¹ç›®åœ°å€:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #13

**æ¥æº**: [CVE-2024-21626-laysakura_CVE-2024-21626-demo.md](../2024/CVE-2024-21626-laysakura_CVE-2024-21626-demo.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸æ”»å‡»è€…é€ƒé€¸å®¹å™¨å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å—å½±å“çš„runcç‰ˆæœ¬ï¼Œä»¥åŠæ‰§è¡Œå®¹å™¨æž„å»ºæˆ–è¿è¡Œçš„æƒé™ï¼ˆå¯èƒ½é€šè¿‡æ¶æ„é•œåƒï¼‰

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 10%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªæ¼æ´žï¼ŒæºäºŽæ–‡ä»¶æè¿°ç¬¦æ³„æ¼ã€‚è¯¥æ¼æ´žå…è®¸æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚æ¼æ´žåˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»åœºæ™¯1ï¼ˆæ¶æ„é•œåƒï¼‰ï¼š** ç”¨æˆ·è¿è¡Œäº†ä¸€ä¸ªæ¶æ„çš„ Docker é•œåƒã€‚è¯¥é•œåƒåœ¨å¯åŠ¨æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´žå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ã€‚
2.  **æ”»å‡»åœºæ™¯2ï¼ˆrunc execï¼‰ï¼š** ä½¿ç”¨ `runc exec` åœ¨å®¹å™¨å†…æ‰§è¡Œæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹çš„å·¥ä½œç›®å½•é”™è¯¯åœ°è®¾ç½®ä¸ºä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ã€‚
3.  **åˆ©ç”¨è¿‡ç¨‹ï¼š** åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`../../../root/.ssh/authorized_keys`ï¼‰æ“ä½œæ–‡ä»¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ“ä½œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚
4.  **POCä»£ç åˆ†æžï¼š** æä¾›çš„ POC ä»£ç å±•ç¤ºäº†æ”»å‡»è€…å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶æ„çš„ Dockerfileï¼Œè¯¥ Dockerfile å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/8`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åŽï¼Œå®ƒå¤åˆ¶ä¸€ä¸ªæ¶æ„è„šæœ¬ `inject-ssh-key.sh` åˆ°å®¹å™¨ä¸­å¹¶æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬ä¼šå°†æ”»å‡»è€…çš„ SSH å…¬é’¥å†™å…¥å®¿ä¸»æœºçš„ `/root/.ssh/authorized_keys` æ–‡ä»¶ï¼Œä»Žè€Œå…è®¸æ”»å‡»è€…é€šè¿‡ SSH ä»¥ root æƒé™ç™»å½•å®¿ä¸»æœºã€‚

**æœ‰æ•ˆæ€§ï¼š** æä¾›çš„ POC ä»£ç æœ‰æ•ˆï¼Œå¯ä»¥ç”¨æ¥æ¼”ç¤ºå’Œåˆ©ç”¨ CVE-2024-21626 æ¼æ´žå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚

**æŠ•æ¯’é£Žé™©ï¼š** ä»“åº“ä¸­å­˜åœ¨æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½Žï¼ˆ10%ï¼‰ã€‚ä¸»è¦é£Žé™©é›†ä¸­åœ¨ `inject-ssh-key.sh` è„šæœ¬ï¼Œå®ƒç›´æŽ¥ä¿®æ”¹å®¿ä¸»æœºçš„ authorized_keys æ–‡ä»¶ï¼Œå±žäºŽæ˜Žæ˜¾çš„æ¼æ´žåˆ©ç”¨è¡Œä¸ºï¼Œå¹¶éžéšè—çš„æŠ•æ¯’ã€‚è™½ç„¶ä½œè€…å¯èƒ½åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚æž„å»ºè„šæœ¬æˆ– Dockerfile ä¸­ï¼‰æ·»åŠ å…¶ä»–æ¶æ„è¡Œä¸ºï¼Œä½†å½“å‰æä¾›çš„ä»£ç ç‰‡æ®µå¹¶æœªå‘çŽ°æ˜Žæ˜¾çš„åŽé—¨æˆ–éšè—æ¶æ„åŠŸèƒ½ã€‚

**åˆ©ç”¨æ–¹å¼æ€»ç»“ï¼š** æ”»å‡»è€…æž„å»ºæˆ–åˆ†å‘åŒ…å«æ¶æ„Dockerfileçš„å®¹å™¨é•œåƒ, é•œåƒä¸­çš„è„šæœ¬åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æ¼æ´žï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€ç»ˆä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å®žçŽ°æƒé™æå‡ã€‚

**é¡¹ç›®åœ°å€:** [laysakura/CVE-2024-21626-demo](https://github.com/laysakura/CVE-2024-21626-demo)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #14

**æ¥æº**: [CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md](../2024/CVE-2024-21626-zhangguanzhang_CVE-2024-21626.md)

## CVE-2024-21626 - runc å®¹å™¨é€ƒé€¸æ¼æ´ž

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æƒé™æå‡

**å½±å“ç‰ˆæœ¬:** v1.0.0-rc93 <= runc <= 1.1.11

**åˆ©ç”¨æ¡ä»¶:** éœ€è¦å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œä»¥åŠå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 5%

## è¯¦æƒ…

CVE-2024-21626 æ¼æ´žå…è®¸æ”»å‡»è€…é€šè¿‡åˆ©ç”¨ runc ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œä½¿æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ï¼ˆé€šè¿‡ `runc exec`ï¼‰çš„å·¥ä½œç›®å½•ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ï¼Œä»Žè€Œé€ƒé€¸å®¹å™¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žè®¿é—®ç”šè‡³ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚æ ¹æ®æœç´¢å¼•æ“Žç»“æžœå’Œæ¼æ´žåº“ä¿¡æ¯ï¼Œæ­¤æ¼æ´žå·²è¢«å¹¿æ³›åˆ†æžå’Œåˆ©ç”¨ã€‚æä¾›çš„ POC ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `-w /proc/self/fd/$line` å‚æ•°ï¼Œå°†å®¹å™¨çš„å·¥ä½œç›®å½•è®¾ç½®ä¸ºä¸»æœºä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä»£ç ä¸­å…ˆé€šè¿‡å¾ªçŽ¯æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åŽé€šè¿‡ `docker exec` åœ¨æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æä¾›çš„ POC ä»£ç å’Œæœç´¢ç»“æžœï¼Œè¯¥æ¼æ´žåˆ©ç”¨æ˜¯æœ‰æ•ˆçš„ã€‚POC ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„å¤çŽ°æ­¥éª¤ï¼ŒåŒ…æ‹¬çŽ¯å¢ƒè¦æ±‚ã€åˆ©ç”¨æ–¹æ³•å’ŒéªŒè¯æ‰‹æ®µã€‚ä¿®å¤åŽçš„ runc ç‰ˆæœ¬ä¸å†å…è®¸ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå·¥ä½œç›®å½•ï¼Œä»Žè€Œé˜»æ­¢äº†è¿™ç§æ”»å‡»ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
è¯¥ POC ä»£ç ä¸»è¦ç”¨äºŽæ¼”ç¤ºæ¼æ´žåˆ©ç”¨ï¼Œæœ¬èº«ä¸åŒ…å«æ˜Žæ˜¾çš„æ¶æ„ä»£ç æˆ–åŽé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å­˜åœ¨æ½œåœ¨çš„æŠ•æ¯’é£Žé™©ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä¿®æ”¹åŽçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½åŒ…å«åŽé—¨æˆ–æ¶æ„åŠŸèƒ½ã€‚å› æ­¤ï¼Œåœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œå¿…é¡»éªŒè¯ runc äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ¥æºã€‚å°†æŠ•æ¯’é£Žé™©è¯„ä¼°ä¸º 5%ï¼Œä¸»è¦è€ƒè™‘åˆ°ï¼šè¯¥ä»£ç ä¸»è¦æ˜¯æµç¨‹æ¼”ç¤ºï¼ŒéžäºŒè¿›åˆ¶ç¨‹åºï¼Œè¢«æ¤å…¥æ¶æ„ä»£ç çš„å¯èƒ½æ€§æ¯”è¾ƒå°ã€‚ä»£ç ä½¿ç”¨`docker run --rm` æ¸…ç†å®¹å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†é©»ç•™åŽé—¨çš„é£Žé™©ï¼Œä½†æ›¿æ¢runcäºŒè¿›åˆ¶ç¨‹åºè¡Œä¸ºä¾ç„¶å­˜åœ¨é£Žé™©ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **åˆ©ç”¨æ¡ä»¶ï¼š** å—å½±å“çš„ runc ç‰ˆæœ¬ï¼ˆv1.0.0-rc93 <= runc <= 1.1.11ï¼‰ï¼Œä»¥åŠå®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼Œå†…æ ¸ç‰ˆæœ¬æ”¯æŒ openat2 ç³»ç»Ÿè°ƒç”¨
2.  **æ”»å‡»æ­¥éª¤ï¼š**
    *   æŸ¥æ‰¾å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼šé€šè¿‡å¾ªçŽ¯è¿è¡Œå®¹å™¨ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/proc/self/fd/$line`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹å¯ä»¥è®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
    *   é€ƒé€¸å®¹å™¨ï¼šä½¿ç”¨ `docker exec` å‘½ä»¤ï¼Œåœ¨å…·æœ‰æ³„éœ²æ–‡ä»¶æè¿°ç¬¦çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œè®¿é—®ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¯»å– `/etc/passwd` æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ã€‚
    *   è¦†ç›–ä¸»æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼šé€šè¿‡ä¿®æ”¹ä¸»æœºä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°æ›´ä¸¥é‡çš„æ”»å‡»ï¼Œä¾‹å¦‚æƒé™æå‡æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
3.  **ç¼“è§£æŽªæ–½ï¼š**
    *   å‡çº§ runc åˆ° 1.1.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   é¿å…ä½¿ç”¨å—å½±å“çš„ runc ç‰ˆæœ¬ã€‚
    *   ç›‘æŽ§å®¹å™¨è¡Œä¸ºï¼Œæ£€æµ‹å¼‚å¸¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [zhangguanzhang/CVE-2024-21626](https://github.com/zhangguanzhang/CVE-2024-21626)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

## POC #15

**æ¥æº**: [CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md](../2024/CVE-2024-21626-zpxlz_CVE-2024-21626-POC.md)

## CVE-2024-21626-runcå®¹å™¨é€ƒé€¸

**æ¼æ´žç¼–å·:** CVE-2024-21626

**æ¼æ´žç±»åž‹:** å®¹å™¨é€ƒé€¸

**å½±å“åº”ç”¨:** runc

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯å®Œå…¨æŽ§åˆ¶å®¿ä¸»æœº

**å½±å“ç‰ˆæœ¬:** < 1.1.12

**åˆ©ç”¨æ¡ä»¶:** å¯ä»¥åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£Žé™©:** 0%

## è¯¦æƒ…

CVE-2024-21626 æ˜¯ runc ä¸­çš„ä¸€ä¸ªå®¹å™¨é€ƒé€¸æ¼æ´žï¼Œç”±äºŽæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼Œå¯¼è‡´å®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•å¯èƒ½ä½äºŽä¸»æœºæ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´žï¼Œé€šè¿‡ `runc exec` æˆ–æ¶æ„é•œåƒï¼ˆ`runc run`ï¼‰ï¼Œè®¿é—®ç”šè‡³è¦†ç›–ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œä»Žè€Œå®žçŽ°å®¹å™¨é€ƒé€¸ï¼Œå®Œå…¨æŽ§åˆ¶å®¿ä¸»æœºã€‚

**æ¼æ´žåˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š** runc åœ¨æ‰§è¡Œ `runc exec` æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°è®¾ç½® CLOEXEC æ ‡å¿—ï¼Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦æ³„éœ²åˆ°æ–°å¯åŠ¨çš„å®¹å™¨è¿›ç¨‹ä¸­ã€‚
2.  **å·¥ä½œç›®å½•æ“çºµï¼š** åˆ©ç”¨æ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®¹å™¨è¿›ç¨‹çš„å·¥ä½œç›®å½•æŒ‡å‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æŸä¸ªç›®å½•ã€‚
3.  **æ–‡ä»¶è¦†ç›–/æ‰§è¡Œï¼š** åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæˆ–è¦†ç›–å…³é”®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ `bash`ï¼Œä»¥èŽ·å¾—å®¿ä¸»æœºçš„æŽ§åˆ¶æƒã€‚

**POCåˆ†æžï¼š**
æä¾›çš„POCä»£ç å±•ç¤ºäº†æ¼æ´žåˆ©ç”¨è¿‡ç¨‹ï¼š
1.  **Dockerfileï¼š** åˆ›å»ºä¸€ä¸ªUbuntuå®¹å™¨ï¼Œå®‰è£… netcat å·¥å…·ï¼Œæ·»åŠ  `poc.sh` è„šæœ¬ï¼Œå¹¶è®¾ç½®å·¥ä½œç›®å½•ä¸º `/proc/self/fd/9`ï¼Œè¿™ä¸ªç›®å½•å¯¹åº”äºŽæ³„éœ²çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ³¨æ„ï¼šå®žé™…çŽ¯å¢ƒå¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ³„éœ²æƒ…å†µè°ƒæ•´è¿™ä¸ªç›®å½•ã€‚
2.  **poc.shï¼š** è„šæœ¬é¦–å…ˆèŽ·å–å®¹å™¨çš„IPåœ°å€ï¼Œç„¶åŽåœ¨`/proc/self/cwd/../../../bin/bash.copy`åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„`bash`å‰¯æœ¬ã€‚`/proc/self/cwd` è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå‘ä¸Šä¸‰çº§ç›®å½•ï¼Œå°è¯•è¦†ç›–å®¿ä¸»æœºçš„ `/bin/bash.copy`æ–‡ä»¶ã€‚è„šæœ¬éšåŽä½¿ç”¨ `nc` ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…åå¼¹shellè¿žæŽ¥ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´žæè¿°å’ŒPOCä»£ç ï¼Œæ­¤POCå…·æœ‰è¾ƒé«˜çš„æˆåŠŸçŽ‡ï¼Œèƒ½å¤Ÿå®žçŽ°å®¹å™¨é€ƒé€¸ã€‚ä½†å®žé™…åˆ©ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ Docker/runc ç‰ˆæœ¬ï¼Œè°ƒæ•´å·¥ä½œç›®å½• `/proc/self/fd/9`ï¼Œ æ‰¾åˆ°æ³„éœ²çš„æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åŒæ—¶ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¹Ÿéœ€è¦æ ¹æ®çŽ¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

**æŠ•æ¯’é£Žé™©ï¼š**
ç»è¿‡ä»£ç å®¡è®¡ï¼Œè¯¥ä»“åº“ä¸­çš„POCä»£ç æœªå‘çŽ°æ˜Žæ˜¾çš„æŠ•æ¯’è¡Œä¸ºã€‚ä½œè€…çš„ç›®çš„æ˜¯æ¼”ç¤ºæ¼æ´žçš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ¶æ„æ“ä½œã€‚`poc.sh` è„šæœ¬ä¸­çš„åå¼¹ shell è¡Œä¸ºæ˜¯æ¼æ´žåˆ©ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶éžéšè—çš„æ¶æ„ä»£ç ã€‚æ‰€ä»¥æŠ•æ¯’é£Žé™©ä¸º0%ã€‚

**é¡¹ç›®åœ°å€:** [zpxlz/CVE-2024-21626-POC](https://github.com/zpxlz/CVE-2024-21626-POC)

**æ¼æ´žè¯¦æƒ…:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)

---

