## CVE-2024-53677 - Apache Struts 2 RCE (远程代码执行)

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Struts 2

**危害等级:** Critical

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2.0.0 至 6.3.0.2 (不含 6.4.0)

**利用条件:** 远程未经身份验证，目标应用需开启文件上传功能

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞（S2-067）源于Apache Struts 2文件上传逻辑中的路径遍历缺陷。攻击者可以通过操纵文件上传参数（如通过多部分请求中的filename参数）来注入路径遍历字符（如 ../），从而将恶意文件写入服务器上的任意目录。此POC代码通过提供完整的容器化（Docker/Podman）复现环境和Python攻击脚本展示了利用过程。POC包含了一个完整的Java应用（upload-1.0.0.war）和自动化的Python脚本（S2-067.py）。通过分析README和Dockerfile，该POC通过Maven构建受影响的WAR包并部署在Tomcat容器中，利用脚本能够指定上传路径。有效性在于其通过修改文件上传目标的destination参数实现目录穿越。在实际测试中，POC作者提到的‘间歇性不可访问’问题，实际上是因为在Tomcat环境下，JSP文件写入到Web根目录后可能需要几秒钟的加载或热部署时间，或者是路径穿越层级未正确对齐。脚本允许用户自定义上传端点和目标路径，具备极高的实战化参考价值。此漏洞是Struts2近年来最严重的漏洞之一，因为它不依赖复杂的OGNL表达式注入，而是通过传统但由于逻辑错误重新出现的路径遍历手段实现控制。 【利用步骤】1. 使用提供的Dockerfile构建实验环境，将包含漏洞的Struts2应用部署在Tomcat 9容器。2. 准备恶意JSP Webshell文件（如newshell.jsp）。3. 使用Python脚本 S2-067.py 执行攻击，命令行参数需指定目标URL（-u）、上传动作端点（--upload_endpoint）以及关键的穿越路径（--destination ../newshell.jsp）。4. 脚本会发送一个Multipart请求，在参数中包含遍历字符。5. 攻击成功后，脚本会尝试访问部署在Web根目录下的JSP文件。6. 访问返回的URL（如 http://localhost:8080/newshell.jsp）即可获得系统命令执行权限。 【投毒风险分析】该POC项目目前的投毒风险评级为低（15%）。代码库主要由标准的Dockerfile、Maven配置文件、Java源代码和公开可见的Python脚本组成。Python脚本依赖项较少，主要使用了requests库，经过静态分析，脚本逻辑清晰，仅专注于文件上传协议的构造，未发现混淆代码、外部未知域名的DNS请求或异常的系统命令执行动作。然而，作为防御方需警惕：1. 攻击脚本中的requirements.txt可能被修改以引入恶意包镜像。2. 该POC中提到的‘多次尝试’逻辑可能被用来掩盖脚本后台的其他异步行为。3. 用户在下载此类利用脚本时，应重点检查Python脚本中是否存在对 `os.system` 或 `subprocess` 的非预期调用，以及是否有隐藏的 `.sh` 后门脚本随容器镜像一同运行。目前公开的这一版本代码透明度高，属于典型的安全研究工具，但在引入内部生产网络测试前，仍建议在隔离的沙箱环境执行并对网络流量进行抓包审计。

**项目地址:** [https://github.com/seanrickerd/CVE-2024-53677](https://www.google.com/search?q=https://github.com/seanrickerd/CVE-2024-53677)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
