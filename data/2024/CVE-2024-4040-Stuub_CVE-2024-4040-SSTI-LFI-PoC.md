# CVE-2024-4040

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md](../2024/CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md)

# CVE-2024-4040

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md](../2024/CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md)

# CVE-2024-4040

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md](../2024/CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md)

# CVE-2024-4040

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md](../2024/CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md)

# CVE-2024-4040

> 📦 该CVE有 **18** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md](../2024/CVE-2024-4040-Stuub_CVE-2024-4040-SSTI-LFI-PoC.md)

# CVE-2024-4040

> 📦 该CVE有 **17** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2024-4040-0xN7y_CVE-2024-4040.md](../2024/CVE-2024-4040-0xN7y_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #2

**来源**: [CVE-2024-4040-1ncendium_CVE-2024-4040.md](../2024/CVE-2024-4040-1ncendium_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #3

**来源**: [CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md](../2024/CVE-2024-4040-Mohammaddvd_CVE-2024-4040.md)

## CVE-2024-4040 CrushFTP服务器端模板注入漏洞

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP实例可网络访问，且版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个存在于CrushFTP中的服务器端模板注入(SSTI)漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过VFS沙箱），绕过身份验证以获得管理员权限，并在服务器上执行远程代码。 

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC代码是有效的。

*   漏洞库信息明确指出这是一个可被利用的漏洞，且有公开的PoC。
*   搜索引擎结果显示，该漏洞已经被广泛讨论，并且有被利用的案例。
*   提供的PoC代码可以读取`sessions.obj`文件，提取session信息，并尝试使用提取的token进行身份验证。根据代码逻辑，成功验证后能够获取用户名，进一步佐证漏洞利用的有效性。

**投毒风险分析：**
分析PoC代码以及仓库其他文件，判断是否存在投毒风险：

*   `CVE-2024-4040.py`: PoC主体代码，主要功能是利用SSTI读取`sessions.obj`，提取Token并验证，没有发现明显的恶意代码。代码逻辑相对清晰，主要为利用漏洞读取信息和验证Token。
*   `README.md`: 包含漏洞描述、利用方法和免责声明，未发现异常。

风险点分析：

1.  **依赖风险**：脚本依赖`requests`库，如果requests库被篡改，可能引入安全风险，但这不是作者引入的，故不计入投毒。
2.  **远程代码执行**：虽然PoC本身没有直接包含后门代码，但通过SSTI最终可以实现远程代码执行。攻击者如果将此PoC与进一步的利用手段结合，可以上传恶意JAR包执行任意命令。但这并非PoC直接投毒，而是漏洞本身的危害。
3. **免责声明:** README.md文件明确声明该代码仅用于教育和测试目的，但免责声明并不能完全消除滥用风险. 

综合来看，直接投毒的可能性较低，但存在被恶意使用的风险，以及使用第三方库可能引入的间接风险。

**利用方式分析：**

1.  **获取Cookie:** 脚本首先尝试获取CrushFTP实例的`currentAuth` cookie，通过访问目标URL建立Session。
2.  **读取 sessions.obj:** 利用服务器端模板注入漏洞，通过构造特殊的URL，读取服务器上的`sessions.obj`文件。这个文件包含用户的会话信息，包括加密的token。
3.  **提取Token:** 使用正则表达式从读取到的`sessions.obj`内容中提取有效的Token。
4.  **验证Token:** 使用提取的Token构造请求，访问`/WebInterface/function/`接口，尝试获取用户信息，验证Token的有效性。
5.  **持续监听:** PoC会持续监听sessions.obj文件，一旦文件内容发生变化，就提取新的Token并进行验证，以便在有新用户登录时立即获取其Token。

总的来说，该漏洞利用方式是利用SSTI读取敏感文件，提取用户会话信息，然后利用这些信息进行身份验证绕过。

**项目地址:** [Mohammaddvd/CVE-2024-4040](https://github.com/Mohammaddvd/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #4

**来源**: [CVE-2024-4040-Mufti22_CVE-2024-4040.md](../2024/CVE-2024-4040-Mufti22_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取，权限绕过，远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标CrushFTP服务器开放网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。根据提供的POC代码，利用方式如下：

1.  **获取`currentAuth` Cookie:** POC首先尝试连接到目标URL，获取服务器设置的Cookie，特别是`currentAuth` Cookie。这个Cookie是后续利用的关键。
2.  **构造包含恶意Payload的URL:** POC使用获取的`currentAuth` Cookie和用户提供的文件路径构造一个包含`<INCLUDE>`标签的恶意URL。这个URL会被发送到 `/WebInterface/function/?command=zip`端点。恶意URL的格式如下：

    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path></INCLUDE>&names=*
    ```

    其中，`<path>`是用户指定的要读取的文件路径，例如 `/path/to/file.txt/`。请注意，路径需要以`/`开头和结尾。
3.  **发送请求并获取响应:** POC将构造的URL和Cookie发送到目标服务器，并获取服务器的响应。响应内容会包含被读取的文件内容。

根据漏洞信息和搜索结果，此漏洞已被积极利用，建议尽快修补。提供的POC代码经过分析，只包含PoC验证代码，没有发现明显的投毒行为。

**项目地址:** [Mufti22/CVE-2024-4040](https://github.com/Mufti22/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #5

**来源**: [CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md](../2024/CVE-2024-4040-Praison001_CVE-2024-4040-CrushFTP-server.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #6

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #7

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---



---

## POC #7

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #18

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---



---

## POC #7

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #18

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---



---

## POC #7

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #18

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---



---

## POC #7

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #18

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---



---

## POC #7

**来源**: [CVE-2024-4040-airbus-cert_CVE-2024-4040.md](../2024/CVE-2024-4040-airbus-cert_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #8

**来源**: [CVE-2024-4040-entroychang_CVE-2024-4040.md](../2024/CVE-2024-4040-entroychang_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1, 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 服务版本在受影响范围内，且攻击者可发起网络请求。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2024-4040是CrushFTP中的一个严重的服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞读取文件系统中的文件（绕过VFS沙箱），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性分析：**

根据提供的漏洞信息和搜索结果，该漏洞已被广泛报道并被积极利用。CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码 `NonRegisteringDriver.java` 尝试模拟一个 JDBC 驱动，但实际上，它并没有进行数据库连接，而是利用 `user` 属性的值（经过Base64解码后）作为操作系统命令执行。这表明该PoC专注于远程代码执行，而非传统的数据库利用。

**投毒风险分析：**

提供的代码存在很高的投毒风险 (80%)。攻击者可能通过以下方式进行投毒：

1.  **非预期代码执行：** 该代码的核心功能是将Base64编码的用户名字段作为命令执行。如果攻击者可以控制提供给 CrushFTP 的配置，他们就可以通过这个“JDBC 驱动”执行任意系统命令。
2.  **依赖注入：** 攻击者可能通过篡改或替换 `NonRegisteringDriver.java` 文件，在其中添加恶意代码，例如反向 shell 或数据窃取程序。
3.  **供应链攻击：** 如果该代码被包含在第三方库或模块中，攻击者可以通过更新这些库或模块来传播恶意代码。
4.  **后门：** 该代码本身就有可能被用作后门，允许攻击者在目标系统上保持持久存在。

该代码的目的是利用 JDBC 驱动加载机制，将恶意的 Java 代码注入到 CrushFTP 服务器中，从而实现远程代码执行，窃取敏感信息，或者植入后门。

**利用方式：**

1.  **构造恶意请求：** 攻击者构造包含恶意模板注入的 HTTP 请求，触发 CrushFTP 服务器处理恶意模板。
2.  **利用 SSTI 执行代码：** 恶意模板利用服务器端模板引擎的漏洞执行任意代码，例如，读取文件、执行系统命令。
3.  **上传恶意 JDBC 驱动：** 攻击者上传包含恶意代码的 JDBC 驱动程序（如提供的 `NonRegisteringDriver.java`），并配置 CrushFTP 使用该驱动程序。
4.  **触发恶意驱动加载：** 当 CrushFTP 尝试连接数据库时，会加载并执行恶意 JDBC 驱动程序中的代码。
5.  **远程代码执行：** 恶意驱动程序中的代码被执行，攻击者从而控制 CrushFTP 服务器。

**项目地址:** [entroychang/CVE-2024-4040](https://github.com/entroychang/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #9

**来源**: [CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md](../2024/CVE-2024-4040-geniuszly_GenCrushSSTIExploit.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #10

**来源**: [CVE-2024-4040-gotr00t0day_CVE-2024-4040.md](../2024/CVE-2024-4040-gotr00t0day_CVE-2024-4040.md)

## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #11

**来源**: [CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md](../2024/CVE-2024-4040-ill-deed_CrushFTP-CVE-2024-4040-illdeed.md)

## CVE-2024-4040 - CrushFTP Authentication Bypass and Remote Code Execution

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未授权远程攻击者可以读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**影响版本:** 10.0 (低于 10.7.1) 和 11.0 (低于 11.1.0)

**利用条件:** 目标 CrushFTP 服务器运行受影响版本，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许未经身份验证的远程攻击者执行任意文件读取和远程代码执行。搜索引擎结果也证实了该漏洞已被公开利用。提供的 Python 脚本 `CVE-2024-4040.py` 旨在利用身份验证绕过漏洞。

**投毒风险:**

检查提供的 Python 脚本。脚本的主要功能是模拟 CrushFTP 的身份验证流程，通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头来绕过身份验证。脚本的 `exploit()` 函数构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器。根据代码逻辑，脚本似乎没有明显的恶意代码或后门。因此，投毒风险较低, 但是不排除作者在其它位置植入后门的可能性，谨慎使用。投毒风险概率为1%。

**利用方式:**

利用方式主要分为以下几个步骤：

1.  **身份验证绕过：** 攻击者通过生成伪造的 `CrushAuth` cookie 和 AWS 风格的 `Authorization` 标头，绕过 CrushFTP 的身份验证机制。脚本中使用 `generate_auth_cookie()` 函数生成伪造的 `CrushAuth` cookie，并使用 `Authorization` 标头传递用户名。
2.  **发送恶意请求：** 攻击者构造一个带有伪造身份验证信息的 HTTP POST 请求，并发送到目标服务器的 `/WebInterface/function/` 端点。请求中包含要执行的命令，例如 `getUserName`。
3.  **远程代码执行:** 利用服务器端模板注入，执行任意代码。

利用此漏洞，攻击者可以：

*   **读取任意文件：** 攻击者可以读取服务器上的任意文件，包括敏感配置文件和用户数据。
*   **绕过身份验证：** 攻击者可以绕过身份验证，获得管理权限。
*   **执行远程代码：** 攻击者可以在服务器上执行任意代码，从而完全控制服务器。

**缓解措施:**

*   升级到 CrushFTP 10.7.1 或 11.1.0 或更高版本。


**项目地址:** [ill-deed/CrushFTP-CVE-2024-4040-illdeed](https://github.com/ill-deed/CrushFTP-CVE-2024-4040-illdeed)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #12

**来源**: [CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md](../2024/CVE-2024-4040-jakabakos_CVE-2024-4040-CrushFTP-File-Read-vulnerability.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #13

**来源**: [CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md](../2024/CVE-2024-4040-juanorts_CrushFTP10-Docker-CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #14

**来源**: [CVE-2024-4040-olebris_CVE-2024-4040.md](../2024/CVE-2024-4040-olebris_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #15

**来源**: [CVE-2024-4040-rahisec_CVE-2024-4040.md](../2024/CVE-2024-4040-rahisec_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #16

**来源**: [CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md](../2024/CVE-2024-4040-rbih-boulanouar_CVE-2024-4040.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #17

**来源**: [CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md](../2024/CVE-2024-4040-safeer-accuknox_CrushFTP-cve-2024-4040-poc.md)

## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标CrushFTP实例运行在受影响的版本上，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入 (SSTI) 漏洞。未经身份验证的远程攻击者可以通过该漏洞读取 VFS 沙箱之外的文件系统上的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞的PoC是有效的。漏洞库信息中明确说明了该漏洞可导致任意文件读取和远程代码执行，并提供了相关的GitHub链接（airbus-cert/CVE-2024-4040）。搜索引擎结果也表明该漏洞正在被积极利用。PoC代码中包含了利用该漏洞进行文件读取和代码执行的 Python 脚本 `crushed.py`。虽然提供的 Dockerfile 主要用于搭建测试环境，但其中并没有直接包含利用代码。`crushed.py` 使用了 requests 库与目标 CrushFTP 服务器进行交互，并尝试利用 SSTI 漏洞。

**投毒风险：**
分析提供的文件列表，主要关注 `crushed.py` 文件。该文件相对较长，需要仔细审查是否存在恶意代码。根据代码内容, `crushed.py` 包含发送 HTTP 请求的代码，用于探测和利用目标服务器。仓库的其他文件，如 Dockerfile、docker-compose.yaml、k8s.yaml 和 policy.yaml，主要用于搭建测试环境和定义安全策略，自身不构成直接的投毒风险。需要注意的是, 容器镜像 `safeeraccuknox/demo:cve-2024-4040-poc` 存在潜在风险，因为它是由第三方提供的，可能包含未知恶意代码, 这里不考虑. 风险主要集中在`crushed.py`文件是否包含恶意逻辑。初步评估认为，该脚本的风险较低,但**不能排除**代码作者在 HTTP 请求中隐藏恶意代码或使用不安全的库函数等潜在风险。`policy.yaml`是针对 kubearmor 的策略，阻止访问敏感文件，是防御措施，不是投毒代码。综合评估，投毒风险大约为10%。

**利用方式：**
1.  攻击者发送特制的 HTTP 请求到易受攻击的 CrushFTP 服务器的 WebInterface 端点。
2.  该请求包含一个恶意的模板表达式，该表达式将被服务器的模板引擎执行。
3.  通过服务器端模板注入 (SSTI)，攻击者可以实现以下操作：
    *   读取服务器上的任意文件（VFS 沙箱之外的文件）。
    *   绕过身份验证，获得管理员权限。
    *   在服务器上执行任意代码。

**项目地址:** [safeer-accuknox/CrushFTP-cve-2024-4040-poc](https://github.com/safeer-accuknox/CrushFTP-cve-2024-4040-poc)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

## POC #18

**来源**: [CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md](../2024/CVE-2024-4040-tucommenceapousser_CVE-2024-4040-Scanner.md)

## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)

---

