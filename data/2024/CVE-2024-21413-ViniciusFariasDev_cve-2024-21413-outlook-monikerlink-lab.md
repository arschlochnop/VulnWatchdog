## CVE-2024-21413 - Microsoft Outlook, Microsoft Office 2016 远程代码执行 (Protected View Bypass / 信息泄露)

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (Protected View Bypass / 信息泄露)

**影响应用:** Microsoft Outlook, Microsoft Office 2016

**危害等级:** 高危

**CVSS评分:** 未提供

**影响版本:** Microsoft Office 2016 (32-bit edition), Microsoft Office 2016 (64-bit edition)

**利用条件:** 需要用户打开特制HTML邮件或文档，无需认证，需要网络访问（用于SMB认证）

**POC 可用性:** 8

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 10%

## 详情

CVE-2024-21413是Microsoft Outlook中的一个远程代码执行漏洞，主要利用了Moniker Link处理逻辑的缺陷。攻击者可以通过构造一个特殊的HTML邮件，其中包含一个`file://`协议的Moniker Link，并在链接后插入感叹号（`!`），从而绕过Outlook的“受保护视图”安全机制。一旦用户打开该邮件，Outlook在解析链接时会认为该文件是可信的，并以编辑模式打开，从而允许执行潜在的恶意操作，最终可能导致远程代码执行或信息泄露。

**POC有效性分析：**
提供的POC代码是一个教育性质的实验室指南和概念验证。它详细说明了如何通过Python的SMTP库发送一个精心构造的HTML邮件。该邮件中的Moniker Link指向一个SMB共享，当Outlook解析此链接并成功绕过保护视图时，会尝试进行SMB认证，导致受害者的netNTLMv2哈希泄露。POC利用Responder工具捕获这些哈希值。该POC的有效性在于它成功复现了漏洞的关键步骤：绕过保护视图并触发信息泄露（netNTLMv2哈希泄露）。虽然它没有直接展示完整的RCE，但哈希泄露本身就是一种严重的信息安全威胁，并且绕过保护视图是实现RCE的必要前置条件。这意味着该POC在验证漏洞的存在性和可利用性方面是高度有效的。它提供了具体的代码示例和操作步骤，使得研究人员可以在受控环境中轻松复现漏洞，理解其攻击原理。

**利用步骤：**
1. 攻击者需要设置一个SMB服务器，并运行Responder等工具来监听SMB认证请求，以捕获netNTLMv2哈希。
2. 使用POC中提供的Python脚本，构造一个包含恶意Moniker Link的HTML邮件。该链接应指向攻击者控制的SMB共享，并包含`!`字符以绕过保护视图。
3. 攻击者通过SMTP协议发送此邮件给目标Outlook用户。
4. 当目标用户在Outlook中打开此特制邮件时，Outlook会尝试连接到SMB共享，并自动发送用户的netNTLMv2哈希进行认证。
5. Responder捕获到哈希后，攻击者可以使用哈希破解工具（如Hashcat）尝试破解出用户的明文密码。
6. 在某些高级场景下，利用此绕过机制结合其他漏洞，可能进一步实现远程代码执行。

**投毒风险分析：**
提供的POC代码主要用于教育和研究目的，其设计目标是演示CVE-2024-21413漏洞的攻击流程。代码本身清晰、简洁，主要功能是构造并发送一个HTML邮件，以及说明如何使用Responder捕获哈希。

**低风险：**
*   **代码清晰度高：** POC代码结构良好，易于阅读和理解，没有明显的混淆、加密或难以分析的复杂逻辑。
*   **无恶意行为：** POC代码本身不包含任何恶意负载或后门。它仅利用标准SMTP协议发送邮件，并指导用户使用合法的安全工具（如Responder）进行测试。POC中没有发现尝试修改系统文件、安装恶意软件、窃取非漏洞相关信息或建立反向shell等行为。
*   **标准库和工具：** POC代码主要依赖Python的标准库进行邮件发送，并建议使用流行的安全工具Responder。这些都是业界广泛认知和使用的工具，并非专门为恶意活动设计。
*   **明确的教育声明：** README文件中明确指出“For educational purposes only”，强调其防御性研究的性质和非恶意用途。

**结论：** 鉴于上述分析，该POC代码的投毒风险极低。它是一个标准的漏洞概念验证工具，旨在帮助安全研究人员理解和复现漏洞，从而开发防御措施。在使用过程中，只要不将其应用于未经授权的系统，就不会构成额外的安全威胁。组织在利用此类POC进行漏洞复现和安全测试时，应确保在隔离且受控的环境中进行，并遵循最佳实践。

**项目地址:** 未提供

**漏洞详情:** https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-21413
