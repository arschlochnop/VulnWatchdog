## CVE-2024-3094 - XZ Utils / liblzma 供应链攻击/后门 (Supply Chain Backdoor)

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门 (Supply Chain Backdoor)

**影响应用:** XZ Utils / liblzma

**危害等级:** 紧急 (Critical)

**CVSS评分:** 10.0

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 受影响的操作系统（主要为 Linux 发行版）运行了包含恶意 liblzma 库的 sshd 服务，且攻击者拥有特定的 RSA 私钥进行认证触发。

**POC 可用性:** 4/10

**POC 类型:** 概念验证 (检测脚本)

**攻击复杂度:** 高

**投毒风险:** 10%

## 详情

【POC有效性分析】提供的三个POC脚本本质上属于安全检测工具，而非利用代码（Exploit）。第一个脚本 `debian-xz-liblzma.sh` 通过 `ldd` 命令定位 `sshd` 使用的 `liblzma` 路径，并使用 `hexdump` 匹配特定的字节序列 `f30f1efa554889f5...`，该序列是后门代码混淆后的指纹特征。第二个脚本 `detect_liblza-quick.sh` 是前者的精简版，原理相同。第三个脚本 `find_liblzma.sh` 旨在系统中搜索所有依赖 liblzma 的二进制文件。这些 POC 在检测受感染库方面非常有效，但它们不具备触发后门或执行远程代码的功能。由于该后门设计极其精巧，触发需要通过 SSH 协议发送特定的加密有效载荷，且目前公开的资料主要集中在逆向分析和检测，尚未有可靠的公共一键式全自动利用工具。利用该漏洞需要攻击者掌握作者未公开的私钥，因此目前安全社区提供的 POC 主要是防御性的检测逻辑。这些脚本在 Debian 等主流 Linux 环境下运行稳定，能准确识别版本号和二进制特征，对于运维人员快速排查环境风险具有极高的实用价值。

【利用步骤】1. 确认目标系统运行的是受影响的 XZ Utils 版本（5.6.0 或 5.6.1）。2. 通过系统管理工具（如 `apt` 或 `yum`）或检测脚本确认 liblzma 库中是否存在特定的混淆字节码。3. 漏洞触发条件需要特定的构建环境（如 x86_64 架构、GCC、GNU ld、Debian/Fedora 等衍生版）。4. 攻击者通过构造特定的 SSH 握手包，在 RSA 身份验证过程中注入恶意载荷。5. 后门会拦截身份验证检查，若载荷签名校验通过，则在系统上下文中执行载荷，从而绕过常规登录认证并获得 root 权限。由于触发逻辑嵌入在动态链接器的重定位过程中，利用过程高度隐蔽。

【投毒风险分析】当前提供的检测脚本投毒风险极低（约 10%）。脚本逻辑透明，主要使用标准的 Bash 内置命令和常见的 Linux 工具（如 `hexdump`, `grep`, `awk`, `ldd`）。代码中未发现混淆、外部下载请求或试图获取 root 权限的恶意指令。风险主要源于：1. 用户在生产环境直接运行来自非官方渠道的 `.sh` 脚本可能存在的信任风险；2. 脚本中的 `set -eu` 虽是良好实践，但若路径解析出错可能导致脚本异常退出。此类防御性脚本通常作为威胁情报的一部分在安全社区传播，其主要意图是帮助用户自查。然而，攻击者可能通过伪造类似的“漏洞检测工具”并植入反弹 shell 来实施钓鱼攻击。目前的 POC 代码清晰且具有注释，不属于恶意代码投毒范畴。但在使用时，建议用户在隔离环境先审查脚本内容，确认其指向的 NVD 或 GitHub 链接真实有效。此类供应链漏洞的真正风险在于上游源码库的污染，而非下游检测脚本的传播。

**项目地址:** [https://github.com/cyclone-github/scripts](https://github.com/cyclone-github/scripts)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)
