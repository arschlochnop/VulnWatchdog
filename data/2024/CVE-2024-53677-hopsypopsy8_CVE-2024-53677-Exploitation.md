## CVE-2024-53677 - Apache Struts 2 RCE/路径遍历

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE/路径遍历

**影响应用:** Apache Struts 2

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2.0.0 至 6.4.0 (不含 6.4.0)

**利用条件:** 目标应用开启了文件上传功能，且未对上传参数进行严格限制。

**POC 可用性:** 8/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 15%

## 详情

【POC有效性分析】该漏洞（S2-067）源于Apache Struts 2的文件上传逻辑缺陷。攻击者可以通过操纵多部分请求（Multipart Request）中的特定参数（如uploadFileName等），利用Struts的OGNL表达式解析机制或参数绑定逻辑实现路径遍历。在提供的POC文档中，通过在HTTP请求中注入带有目录穿越符（../）的参数，可以将原本受限的上传文件路径重定向到服务器上的任意敏感目录，例如Web目录。当恶意文件（如JSP木马）被上传到Web可访问路径并执行时，即可达成远程代码执行（RCE）。此POC不仅描述了漏洞原理，还详细记录了通过Burp Suite修改参数、绕过文件扩展名检查（伪造JPG后缀结合路径穿越）以及验证上传成功后的执行路径，具有极高的实战参考价值和复现成功率。漏洞的核心在于FileUploadInterceptor未能正确清理文件路径参数，允许攻击者覆盖底层的存储路径变量。\n\n【利用步骤】1. **环境侦察**：通过检查`pom.xml`或Web指纹确认Apache Struts版本处于受影响范围（如6.3.0.1）。2. **识别上传点**：寻找具有图片或其他文件上传功能的端点。3. **拦截请求**：使用Burp Suite拦截合法的文件上传HTTP POST请求。4. **参数注入**：在请求体中新增一个与文件上传相关的参数（例如利用`top.uploadFileName`等），并使用路径遍历字符（如`../../webapps/ROOT/shell.jsp`）来覆盖默认存储位置。5. **构造Payload**：在上传的文件数据末尾附加JSP WebShell代码。6. **触发执行**：成功上传后，访问Web目录下的Shell文件（如`http://target/shell.jsp`）获取服务器控制权。\n\n【投毒风险分析】该POC文档目前主要以Markdown形式存在，包含详细的截图和操作说明，暂未发现其提供的操作逻辑中包含恶意后门或隐蔽的第三方连接。投毒风险分析显示，该利用方式主要依赖标准的Burp Suite手动操作，而非一键式黑盒二进制工具，因此直接运行中毒代码的可能性较低。然而，在安全社区流传的相关自动化Exploit脚本中，需警惕以下风险：1. **混淆脚本**：部分Python脚本可能对攻击Payload进行Base64双重编码，潜伏反弹Shell至攻击者服务器。2. **虚假工具**：警惕在GitHub上新出现的针对该CVE的预编译EXE或JAR包，此类工具常以POC为噱头，实则在本地执行窃取浏览器凭据的恶意行为。3. **外部资源请求**：某些验证脚本可能会尝试从特定的外部URL下载二次载荷。基于当前分析，本文档提供的逻辑属于合法的渗透测试范畴，只要研究人员在隔离环境手动复现，整体投毒风险处于较低水平（约15%），风险主要来源于复现者自行搜索下载的第三方自动化脚本，而非漏洞原理描述本身。

**项目地址:** [https://github.com/vulnwatchdog/CVE-2024-53677](https://www.google.com/search?q=https://github.com/vulnwatchdog/CVE-2024-53677)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
