## CVE-2024-53677 - Apache Struts2 RCE/路径穿越/文件上传

**漏洞编号:** CVE-2024-53677

**漏洞类型:** RCE/路径穿越/文件上传

**影响应用:** Apache Struts2

**危害等级:** CRITICAL

**CVSS评分:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**影响版本:** 2.0.0 to < 6.4.0

**利用条件:** 1. 目标系统使用了受影响的Struts2版本。2. 开发者在实现文件上传功能时，允许从请求参数中动态获取上传文件名（通常是配置了FileUpload拦截器且未对参数名进行严格限制）。3. 目标目录具有可写权限且允许执行脚本（如JSP）。

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 5%

## 详情

POC有效性分析：该漏洞被称为S2-067，其核心在于Apache Struts2的文件上传逻辑存在缺陷。在处理多部分表单数据（multipart/form-data）时，Struts2允许攻击者通过覆盖特定的Action属性（如uploadFileName或uploadFileName[0]）来操纵上传文件的名称。如果目标Action没有对这些参数进行严格的白名单校验，攻击者就可以在文件名中使用路径穿越字符（如 '../'）。提供的Python POC代码通过requests库模拟了这一攻击过程。它定义了两个核心参数：-filename（用于注入路径穿越路径，如 ../poc.jsp）和-file（本地恶意JSP文件内容）。代码逻辑清晰，分别针对单文件上传和多文件上传场景构造了top.uploadFileName或uploadFileName[0]参数。经验证，该POC能够精确构造满足漏洞触发条件的HTTP POST请求，将文件上传到Web目录之外或覆盖关键Web容器文件（如jsp文件），从而实现远程代码执行。利用步骤：1. 准备攻击负载，创建一个包含恶意Java代码的JSP Webshell。2. 确定目标上传接口的URL地址。3. 使用POC脚本，指定-u参数为目标URL，-filename参数为包含路径穿越序列的目的路径（例如：../../webapps/ROOT/shell.jsp），-file参数为本地Webshell路径。4. 选择上传模式（-type s 或 m）。5. 发送请求后，Struts2会将文件保存到攻击者指定的恶意路径。6. 通过浏览器访问上传的Webshell地址，获取系统控制权。投毒风险分析：该POC代码具有极高的透明度，主要使用Python标准库和成熟的requests库，未发现任何恶意行为。代码中所有逻辑均围绕漏洞验证展开，没有进行任何混淆或加密处理。经过行为审计，脚本仅向用户指定的URL发送HTTP POST请求，不包含任何反弹Shell、凭证窃取、磁盘扫描或第三方服务器外联等隐蔽操作。脚本中定义的User-Agent为常见的Chrome浏览器标识，属于正常的渗透测试行为。虽然POC本身不具毒性，但其利用的漏洞危害极大，建议安全研究员在受控沙箱环境中使用，并确保测试目标已获得明确授权。由于代码结构简单，攻击者很难在不引起注意的情况下植入后门。综合评估，该POC的投毒风险等级极低，是一份高质量且安全的防御性研究参考代码。

**项目地址:** [https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-文件上传逻辑绕过-CVE-2024-53677-S2-067/](https://www.google.com/search?q=https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)
