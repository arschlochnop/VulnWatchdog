# CVE-2017-9822

> 📦 该CVE有 **2** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2017-9822-Tnot123_cve-2017-9822.md](../2017/CVE-2017-9822-Tnot123_cve-2017-9822.md)

## CVE-2017-9822 DotNetNuke Cookie 反序列化 RCE

**漏洞编号:** CVE-2017-9822

**漏洞类型:** 反序列化漏洞

**影响应用:** DotNetNuke CMS

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.1.1

**利用条件:** 需要目标网站使用 DotNetNuke CMS 并且版本低于 9.1.1

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9822 是 DotNetNuke CMS 9.1.1 之前版本中的一个远程代码执行漏洞。该漏洞源于程序使用 cookie 来识别用户，且存在不安全的反序列化操作。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（虽然只提供了部分信息，但可以判断其方向），该漏洞利用是有效的。漏洞库和搜索引擎结果都明确指出该漏洞的存在和危害，并提供了利用方式的线索（cookie 反序列化）。利用代码中的描述也佐证了这一点，它详细描述了如何设置调试环境、分析漏洞原理，并提到利用 XmlSerializer、ObjectDataProvider、ResourceDictionary 等 .NET 组件来构造 Gadget 从而实现 RCE。

**投毒风险分析：**

提供的漏洞利用代码片段主要是环境搭建和原理分析，并没有直接的恶意代码。但是考虑到代码仓库中可能存在作者未展示的部分，存在一定的投毒风险。风险评估较低，约为 5%。原因如下：

*   漏洞本身已经足够危险，没有必要添加额外的恶意代码来迷惑使用者。
*   详细的漏洞分析和调试步骤降低了投毒的必要性，作者的重心似乎在于复现漏洞。
*   仅仅是部分文档，不能确定是否存在其他辅助利用脚本，需要进行分析。

**利用方式分析：**

利用方式的核心是不安全的反序列化。具体步骤如下：

1.  攻击者构造一个包含恶意代码的 XML 序列化对象。这个对象利用 .NET 中已知的 Gadget chain，例如 ObjectDataProvider + ResourceDictionary。
2.  将该 XML 序列化对象进行编码，并将其设置为 DotNetNuke 站点的 cookie 值，通常是 DNNPersonalization cookie。
3.  当 DotNetNuke 站点处理该 cookie 时，会对 XML 数据进行反序列化。
4.  反序列化过程会触发 Gadget chain，从而执行攻击者预先设定的恶意代码，最终实现远程代码执行。

总结：该漏洞利用的有效性高，利用方式清晰，但仍需注意潜在的投毒风险。

**项目地址:** [Tnot123/cve-2017-9822](https://github.com/Tnot123/cve-2017-9822)

**漏洞详情:** [CVE-2017-9822](https://nvd.nist.gov/vuln/detail/CVE-2017-9822)

---

## POC #2

**来源**: [CVE-2017-9822-murataydemir_CVE-2017-9822.md](../2017/CVE-2017-9822-murataydemir_CVE-2017-9822.md)

# CVE-2017-9822

> 📦 该CVE有 **2** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2017-9822-Tnot123_cve-2017-9822.md](../2017/CVE-2017-9822-Tnot123_cve-2017-9822.md)

## CVE-2017-9822 DotNetNuke Cookie 反序列化 RCE

**漏洞编号:** CVE-2017-9822

**漏洞类型:** 反序列化漏洞

**影响应用:** DotNetNuke CMS

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.1.1

**利用条件:** 需要目标网站使用 DotNetNuke CMS 并且版本低于 9.1.1

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9822 是 DotNetNuke CMS 9.1.1 之前版本中的一个远程代码执行漏洞。该漏洞源于程序使用 cookie 来识别用户，且存在不安全的反序列化操作。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（虽然只提供了部分信息，但可以判断其方向），该漏洞利用是有效的。漏洞库和搜索引擎结果都明确指出该漏洞的存在和危害，并提供了利用方式的线索（cookie 反序列化）。利用代码中的描述也佐证了这一点，它详细描述了如何设置调试环境、分析漏洞原理，并提到利用 XmlSerializer、ObjectDataProvider、ResourceDictionary 等 .NET 组件来构造 Gadget 从而实现 RCE。

**投毒风险分析：**

提供的漏洞利用代码片段主要是环境搭建和原理分析，并没有直接的恶意代码。但是考虑到代码仓库中可能存在作者未展示的部分，存在一定的投毒风险。风险评估较低，约为 5%。原因如下：

*   漏洞本身已经足够危险，没有必要添加额外的恶意代码来迷惑使用者。
*   详细的漏洞分析和调试步骤降低了投毒的必要性，作者的重心似乎在于复现漏洞。
*   仅仅是部分文档，不能确定是否存在其他辅助利用脚本，需要进行分析。

**利用方式分析：**

利用方式的核心是不安全的反序列化。具体步骤如下：

1.  攻击者构造一个包含恶意代码的 XML 序列化对象。这个对象利用 .NET 中已知的 Gadget chain，例如 ObjectDataProvider + ResourceDictionary。
2.  将该 XML 序列化对象进行编码，并将其设置为 DotNetNuke 站点的 cookie 值，通常是 DNNPersonalization cookie。
3.  当 DotNetNuke 站点处理该 cookie 时，会对 XML 数据进行反序列化。
4.  反序列化过程会触发 Gadget chain，从而执行攻击者预先设定的恶意代码，最终实现远程代码执行。

总结：该漏洞利用的有效性高，利用方式清晰，但仍需注意潜在的投毒风险。

**项目地址:** [Tnot123/cve-2017-9822](https://github.com/Tnot123/cve-2017-9822)

**漏洞详情:** [CVE-2017-9822](https://nvd.nist.gov/vuln/detail/CVE-2017-9822)

---

## POC #2

**来源**: [CVE-2017-9822-murataydemir_CVE-2017-9822.md](../2017/CVE-2017-9822-murataydemir_CVE-2017-9822.md)

## CVE-2017-9822 DotNetNuke Cookie Deserialization RCE

**漏洞编号:** CVE-2017-9822

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** DotNetNuke (DNN)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 5.0.0 - 9.1.0 (Fixed in 9.1.1)

**利用条件:** 目标DNN站点使用默认的404错误页面配置（或任何会触发用户profile加载的情况），攻击者需要能够设置cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-9822 是一个 DotNetNuke (DNN) CMS 的远程代码执行漏洞。该漏洞源于 DNN 使用 `DNNPersonalization` cookie 来存储匿名用户的个性化设置。当 DNN 被配置为使用其内置的错误页面来处理 404 错误时（默认配置），应用程序会尝试加载当前用户的配置文件数据，从而触发对该 cookie 的反序列化。

`DNN Platform/Library/Common/Utilities/XmlUtils.cs` 中的 `DeSerializeHashtable` 函数存在不安全的反序列化。

**利用方式：**

1.  **构造恶意 Cookie：**  攻击者利用 YSoSerial.net 等工具生成包含恶意序列化对象的 XML 数据，并将其设置为 `DNNPersonalization` cookie 的值。其中 type 属性可以控制反序列化的类型。
2.  **触发反序列化：**  攻击者访问一个不存在的页面，触发 DNN 的 404 错误处理机制。
3.  **执行任意代码：**  由于不安全的反序列化，恶意对象被还原，导致服务器执行攻击者预设的任意代码。

**PoC 代码分析：**

提供的 PoC 代码使用了 `System.Data.Services.Internal.ExpandedWrapper` 和 `System.Windows.Data.ObjectDataProvider` 类来执行任意代码。`MethodName` 设置为 `WriteFile`，`MethodParameters` 设置为要写入的文件名。`ObjectInstance` 为 `FileSystemUtils`。

PoC 代码的目的是读取 `C:\Windows\win.ini` 文件，如果成功，服务器会将该文件的内容返回在响应体中。

**投毒风险评估：**

在提供的 PoC 代码中，没有发现明显的投毒代码。该代码的目的是验证漏洞的存在，而不是植入恶意后门。

综合来看，POC代码是安全的，但使用者需要明白其目的。

**项目地址:** [murataydemir/CVE-2017-9822](https://github.com/murataydemir/CVE-2017-9822)

**漏洞详情:** [CVE-2017-9822](https://nvd.nist.gov/vuln/detail/CVE-2017-9822)

---



---

