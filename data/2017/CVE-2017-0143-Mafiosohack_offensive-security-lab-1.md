# CVE-2017-0143

> 📦 该CVE有 **6** 个相关POC仓库

---

## POC #1

**来源**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB 远程代码执行漏洞

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，攻击者可网络访问目标系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0143 漏洞存在于 Microsoft Windows 的 SMBv1 服务器中，允许远程攻击者通过精心构造的数据包执行任意代码。该漏洞与 WannaCry 勒索软件的传播密切相关，利用 EternalBlue 漏洞利用工具进行攻击。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞影响多个版本的 Windows 系统，并且已经存在公开的漏洞利用代码，证明其有效性。

**投毒风险：**
提供的漏洞利用代码(实际上只是一个关于EternalBlue的README文件)本身并不包含恶意代码，只是一个报告文档，引用了一些外部链接。但是，引用外部链接存在一定的投毒风险，因为链接的网站可能已经被篡改，或者链接指向恶意软件。所以投毒风险评估为10%。

**利用方式：**
攻击者可以通过发送特制的 SMB 数据包到目标系统的 445 端口，触发漏洞，从而在目标系统上执行任意代码。攻击通常涉及以下步骤：
1.  扫描目标系统，确定是否存在 SMBv1 漏洞。
2.  使用 EternalBlue 漏洞利用工具，发送恶意 SMB 数据包。
3.  成功利用漏洞后，攻击者可以在目标系统上执行任意代码，例如安装恶意软件或窃取敏感数据。

**缓解措施：**
1.  禁用 SMBv1 服务。
2.  安装 Microsoft 提供的安全更新 MS17-010。
3.  使用防火墙限制对 445 端口的访问。

**项目地址:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**来源**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致系统完全控制和数据泄露

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统启用SMBv1服务且未安装MS17-010补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0143 是一个Windows SMBv1服务器中的远程代码执行漏洞。攻击者可以通过构造特制的SMB数据包发送到目标服务器，从而在目标系统上执行任意代码。此漏洞与EternalBlue exploit有关，是WannaCry勒索软件传播利用的漏洞之一。

**有效性：**
根据漏洞库信息和搜索结果，CVE-2017-0143漏洞被广泛利用，存在公开可用的漏洞利用代码（如EternalBlue）。提供的POC代码（Eternal-blue-Windows-7-Checker）是一个检测工具，用于判断目标主机是否受到EternalBlue攻击的影响，并非直接利用漏洞的代码，但是表明了该漏洞利用的有效性。

**投毒风险：**
提供的checker.py（未提供完整代码） 是用于检测目标是否存在漏洞。bucket.cpp 文件是哈希桶的实现，从代码来看，主要功能是实现一个简单的哈希表，没有发现明显的恶意代码或后门。但是，任何代码都可能被用于恶意目的，因此仍然存在一定的投毒风险。此处的10%表示存在一些细微的风险，需要进一步审计。

**利用方式：**
1.  攻击者扫描网络，查找启用SMBv1且未安装MS17-010补丁的目标系统。
2.  攻击者使用EternalBlue exploit或其他针对CVE-2017-0143的exploit，构造恶意的SMB数据包。
3.  攻击者将恶意数据包发送到目标系统。
4.  如果目标系统存在漏洞，恶意代码将在目标系统上执行，攻击者可以获得系统控制权。

**排序优先级说明：**
在本次分析中，搜索引擎结果提供了漏洞的总体描述和影响，漏洞利用代码提供了漏洞利用的细节和检测方法，漏洞库信息提供了漏洞的官方描述和受影响的系统版本。因此，搜索引擎结果>漏洞利用代码>漏洞库信息。

**项目地址:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #3

**来源**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB 远程代码执行漏洞（EternalBlue）

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**利用条件:** 目标系统启用SMBv1协议，且未安装MS17-010补丁，攻击者需要网络可达性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0143 (EternalBlue) 是一个存在于 Windows SMBv1 服务器中的远程代码执行漏洞。攻击者可以通过发送特制的 SMB 数据包来利用此漏洞，从而在目标系统上执行任意代码。漏洞利用通常涉及使用 Metasploit Framework，如提供的 POC 代码所示。该漏洞利用的有效性高，因为有多个公开可用的漏洞利用代码和 Metasploit 模块。投毒风险较低 (10%)，主要基于以下考虑：

*   **POC 代码验证：** 提供的 POC 代码主要描述了如何使用 Metasploit 利用 EternalBlue 漏洞，步骤清晰且目标明确，即复现漏洞。
*   **代码文件分析：** 分析了提供的 README.md 和 Steps.md 文件，主要用于指导用户如何搭建环境、配置参数和运行漏洞利用，未发现任何可疑或恶意的代码片段。因此，判断该仓库存在作者隐藏的投毒代码的可能性较低。
*   **风险提示：** POC 代码中包含明确的法律免责声明，提示用户只能在获得授权的系统上进行测试，避免非法使用。这在一定程度上降低了被恶意使用的风险。

**漏洞利用方式：**

1.  **环境准备：** 搭建包含易受攻击的 Windows 系统的实验环境（例如，Windows 7 虚拟机），确保已启用 SMBv1 且未安装 MS17-010 补丁。
2.  **IP 地址获取：** 在攻击者机器（例如，Kali Linux）上确定攻击者和目标系统的 IP 地址。
3.  **漏洞扫描：** 使用 Nmap 等工具扫描目标系统，确认漏洞是否存在。
4.  **Metasploit 利用：** 启动 Metasploit Framework，搜索并选择 EternalBlue 漏洞利用模块（`exploit/windows/smb/ms17_010_eternalblue`）。
5.  **参数配置：** 设置必要的参数，包括目标 IP 地址（RHOST）和攻击者 IP 地址（LHOST）。
6.  **漏洞利用执行：** 运行漏洞利用程序。如果成功，攻击者将获得目标系统的 Meterpreter shell。
7.  **后渗透测试：** 使用 Meterpreter shell 执行各种后渗透测试任务，例如收集系统信息、提升权限、访问文件等。

**总而言之，该漏洞利用有效性高，但请务必在授权环境下使用。**

**项目地址:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**来源**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1服务器

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 受影响版本包括Windows Vista SP2、Windows Server 2008 SP2和R2 SP1、Windows 7 SP1、Windows 8.1、Windows Server 2012 Gold和R2、Windows RT 8.1以及Windows 10 Gold, 1511和1607

**利用条件:** 目标系统启用SMBv1服务，攻击者需要能够通过网络访问目标系统的445端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-0143是一个Windows SMB远程代码执行漏洞。该漏洞存在于Microsoft Windows Vista SP2等多个版本的SMBv1服务器中。攻击者可以通过发送特制的SMB数据包利用此漏洞在目标系统上执行任意代码。

**有效性：**
提供的Python脚本 `exploit.py` 是一个针对 MS17-010 (CVE-2017-0143) 的漏洞利用程序。该脚本旨在利用SMBv1协议中的漏洞，允许未经身份验证的远程攻击者在目标系统上执行任意代码。漏洞库信息和搜索引擎结果均表明该漏洞是真实存在的，且有可用的利用代码。

**投毒风险：**
查看`exploit.py`的内容，发现代码结构复杂，包含SMB协议交互的实现，以及针对不同Windows版本的偏移量。虽然代码本身看起来是漏洞利用，但仍需注意潜在的投毒风险。例如，攻击者可能会在payload中嵌入恶意代码，或者修改代码的某些部分以在特定条件下执行恶意操作，这种风险较低，但不能完全排除. 因此,投毒风险评估为5%。

**利用方式：**
1.  **漏洞原理：** 该漏洞源于SMBv1协议处理恶意构造的数据包时，没有正确验证数据包的长度，导致缓冲区溢出，进而允许攻击者执行任意代码。
2.  **利用过程：**
    *   攻击者使用 `exploit.py` 脚本指定目标IP地址。
    *   脚本通过SMB协议与目标系统建立连接。
    *   脚本发送特制的SMB数据包，该数据包包含溢出payload。
    *   目标系统接收到恶意数据包后，SMBv1服务器处理数据包时发生缓冲区溢出。
    *   溢出payload覆盖内存中的关键区域，例如函数返回地址。
    *   当函数返回时，程序控制流被劫持到攻击者控制的区域，从而执行攻击者提供的恶意代码。
3. **利用细节:**
  * 该漏洞利用利用了与 EternalRomance 和 EternalSynergy 相同的漏洞，因此需要命名管道。
  *  该脚本通过覆盖 `SrvSecContext` 结构中的 `Token` 字段为 NULL，并将 `UsePsImpersonateClient` 字段设置为 true，从而允许运行的线程使用主令牌（SYSTEM）来执行所有 SMB 操作。对于 Windows 2003 及更早版本，该利用会修改 PCtxtHandle 中的令牌用户和组以获得 SYSTEM 权限，因为这些 Windows 版本中仅使用 `ImpersonateSecurityContext()`。

**总结：**
该漏洞利用的有效性较高，因为漏洞信息和公开的漏洞利用代码的存在，但需要仔细检查漏洞利用代码，确保其安全性，并在测试环境中使用，防止任何潜在的恶意行为。


**项目地址:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**来源**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB 远程代码执行漏洞

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，且攻击者能够进行网络访问。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2017-0143 存在于 Windows SMBv1 服务器中，允许未经身份验证的远程攻击者通过发送特制的 SMB 数据包在目标系统上执行任意代码。该漏洞常与 EternalBlue 漏洞利用框架和 DoublePulsar 后门相关联。利用过程一般为：

1.  使用 EternalBlue 漏洞利用框架攻击存在漏洞的 SMBv1 服务。
2.  成功利用后，通常会安装 DoublePulsar 后门，允许后续执行任意代码。
3.  通过 DoublePulsar 执行恶意载荷，例如反向 Shell 或其他恶意软件。

提供的漏洞利用代码（README.md）描述了如何使用 Metasploit 的 `msfvenom` 生成恶意载荷（反向 TCP shell），以及如何利用 `send_and_execute.py` 脚本通过 SMB 协议将该载荷发送到目标系统并执行。 其中提到了使用Docker来避免环境依赖问题.

**投毒风险分析：**

由于该漏洞影响范围广，且利用代码容易被修改以植入恶意载荷，因此存在较高的投毒风险。攻击者可能修改 `send_and_execute.py` 脚本或生成的恶意载荷，从而在受害者系统上执行恶意操作，例如安装勒索软件（如 WannaCry，搜索引擎结果中提到）。 因此，该漏洞如果未经验证，可能存在极大投毒风险。

**项目地址:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**来源**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，攻击者需要能够访问目标系统的445端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-0143是一个存在于Windows SMBv1服务器中的远程代码执行漏洞。攻击者可以通过构造特制的SMB数据包发送到目标服务器的445端口来触发此漏洞，成功利用可导致在目标系统上执行任意代码。

**有效性：**
提供的POC代码是一个`wannafind.sh`脚本，它使用`nmap`和`masscan`来检测网络中是否存在受CVE-2017-0143（MS17-010）和CVE-2017-7494影响的系统。脚本首先检查`masscan`和`nmap`是否已安装，然后下载或更新相应的Nmap脚本（`smb-vuln-ms17-010.nse` 和 `samba-vuln-cve-2017-7494.nse`）。然后，它使用`masscan`快速扫描指定子网的445端口，再使用`nmap`和下载好的脚本扫描存活主机，寻找漏洞。

这个脚本本身并不能直接利用CVE-2017-0143，但是它可以用来识别易受攻击的目标，为后续的攻击做准备。因此，该脚本的**有效性在于漏洞检测而非直接利用**。

**投毒风险：**
虽然脚本的功能是漏洞扫描，但仍存在一定的投毒风险。 主要体现在以下几个方面：

1.  **外部资源下载:** 脚本会从GitHub下载`smb-vuln-ms17-010.nse`脚本, 从gist.githubusercontent.com 下载`samba-vuln-cve-2017-7494.nse`。如果这些远程仓库被篡改，脚本可能会下载恶意代码。但脚本中对下载的文件会执行 `chown root:root`操作，即使被篡改，攻击者提权难度也会增加。
2.  **脚本执行:** 脚本需要root权限才能执行masscan和更新nmap脚本。如果攻击者能控制运行脚本的环境，可以修改脚本内容，添加恶意命令。

考虑到脚本的功能主要是调用现有的扫描工具，并且需要root权限才能运行，投毒风险相对较低，但不能完全排除。 考虑到远程下载脚本存在被中间人攻击的风险，给出一个较低的百分比：5%。

**利用方式：**
根据漏洞库信息和搜索结果，CVE-2017-0143的利用方式如下：

1.  **攻击者扫描网络，识别存在漏洞的SMBv1服务。** `wannafind.sh` 脚本可以辅助完成这一步。
2.  **攻击者构造恶意的SMB数据包，发送到目标服务器的445端口。**
3.  **目标服务器处理恶意数据包时，触发漏洞，导致代码执行。**
4.  **攻击者利用执行的代码，获取系统控制权，安装后门，窃取数据等。**

该漏洞常与EternalBlue（CVE-2017-0144）一起使用，EternalBlue负责突破系统的初始防御，然后利用CVE-2017-0143执行恶意代码。

**项目地址:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

