# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

# CVE-2017-0143

> ğŸ“¦ è¯¥CVEæœ‰ **7** ä¸ªç›¸å…³POCä»“åº“

---

## POC #1

**æ¥æº**: [CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md](../2017/CVE-2017-0143-Cedric-Martz_EthernalBlue_report.md)

## CVE-2017-0143 Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿ

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ¼æ´å­˜åœ¨äº Microsoft Windows çš„ SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´ä¸ WannaCry å‹’ç´¢è½¯ä»¶çš„ä¼ æ’­å¯†åˆ‡ç›¸å…³ï¼Œåˆ©ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·è¿›è¡Œæ”»å‡»ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œè¯¥æ¼æ´å½±å“å¤šä¸ªç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œè¯æ˜å…¶æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç (å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå…³äºEternalBlueçš„READMEæ–‡ä»¶)æœ¬èº«å¹¶ä¸åŒ…å«æ¶æ„ä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªæŠ¥å‘Šæ–‡æ¡£ï¼Œå¼•ç”¨äº†ä¸€äº›å¤–éƒ¨é“¾æ¥ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨å¤–éƒ¨é“¾æ¥å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ï¼Œå› ä¸ºé“¾æ¥çš„ç½‘ç«™å¯èƒ½å·²ç»è¢«ç¯¡æ”¹ï¼Œæˆ–è€…é“¾æ¥æŒ‡å‘æ¶æ„è½¯ä»¶ã€‚æ‰€ä»¥æŠ•æ¯’é£é™©è¯„ä¼°ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ 445 ç«¯å£ï¼Œè§¦å‘æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š
1.  æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ SMBv1 æ¼æ´ã€‚
2.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå‘é€æ¶æ„ SMB æ•°æ®åŒ…ã€‚
3.  æˆåŠŸåˆ©ç”¨æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚å®‰è£…æ¶æ„è½¯ä»¶æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

**ç¼“è§£æªæ–½ï¼š**
1.  ç¦ç”¨ SMBv1 æœåŠ¡ã€‚
2.  å®‰è£… Microsoft æä¾›çš„å®‰å…¨æ›´æ–° MS17-010ã€‚
3.  ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ 445 ç«¯å£çš„è®¿é—®ã€‚

**é¡¹ç›®åœ°å€:** [Cedric-Martz/EthernalBlue_report](https://github.com/Cedric-Martz/EthernalBlue_report)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #2

**æ¥æº**: [CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md](../2017/CVE-2017-0143-Mafiosohack_offensive-security-lab-1.md)

## CVE-2017-0143-Windows SMB Remote Code Execution

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…å¯ä»¥è®¿é—®445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªå­˜åœ¨äº Microsoft Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚ æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è¯¥æ¼æ´ä¹Ÿè¢«ç§°ä¸º EternalBlueï¼Œå¹¶è¢« WannaCry å‹’ç´¢è½¯ä»¶åˆ©ç”¨ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´ä¿¡æ¯å’Œæœç´¢ç»“æœï¼Œæ­¤æ¼æ´å·²è¢«å¹¿æ³›åˆ©ç”¨ï¼Œä¸”å­˜åœ¨å…¬å¼€çš„POCä»£ç (ä¾‹å¦‚ï¼šExploit-DBä¸Šçš„åˆ©ç”¨ä»£ç )ã€‚æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç æè¿°äº†ä¸€ä¸ªä½¿ç”¨Metasploitæ¡†æ¶åˆ©ç”¨EternalBlueæ¼æ´çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬é…ç½®RHOSTã€PAYLOADå’ŒLHOSTï¼Œå¹¶æˆåŠŸå»ºç«‹Meterpreterä¼šè¯ã€‚å› æ­¤ï¼Œæä¾›çš„POCä»£ç å…·æœ‰æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
åˆ†ææä¾›çš„POCä»£ç ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªå®éªŒæŠ¥å‘Šï¼Œæè¿°äº†å¦‚ä½•ä½¿ç”¨å…¬å¼€çš„EternalBlueæ¼æ´åˆ©ç”¨æ”»å‡»Windows 7è™šæ‹Ÿæœºï¼Œå¹¶æ— å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç ã€‚å…¶ä¸­æåŠçš„Metasploitæ¨¡å—ã€payloadé…ç½®ï¼ˆå¦‚windows/x64/meterpreter/reverse_tcpï¼‰éƒ½æ˜¯å¸¸è§çš„æ¸—é€æµ‹è¯•å·¥å…·ã€‚æˆªå›¾ä¿¡æ¯å±•ç¤ºäº†åˆ©ç”¨æˆåŠŸåçš„ææƒã€ä¿¡æ¯æœé›†ã€hashdumpç­‰æ“ä½œã€‚è€ƒè™‘åˆ°æŠ¥å‘Šä¸­åŒ…å«flagæ–‡ä»¶ï¼Œè¿›ä¸€æ­¥è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§è´¨çš„å¤ç°ã€‚ä»£ç ä»“åº“ä¸­åŒ…å«LICENSEï¼ŒREADME.mdå’Œå®éªŒæŠ¥å‘Šï¼Œç»¼åˆè¯„ä¼°è®¤ä¸ºä»“åº“æœ¬èº«å­˜åœ¨è¾ƒé«˜é£é™©ï¼Œå¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤åˆ¤æ–­æŠ•æ¯’é£é™©ä¸º10%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
åˆ©ç”¨æ–¹å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š
1.  **ä¾¦å¯Ÿï¼š** ä½¿ç”¨ `arp-scan` å’Œ `nmap` å‘ç°ç›®æ ‡ä¸»æœºå’Œå¼€æ”¾ç«¯å£ã€‚`nmap -sS -sV` ç”¨äºç¡®å®šç›®æ ‡ç³»ç»Ÿå¼€æ”¾çš„ç«¯å£å’ŒæœåŠ¡ç‰ˆæœ¬ã€‚
2.  **æ¼æ´æ£€æµ‹ï¼š** ä½¿ç”¨ `nmap --script vuln` æˆ–æ‰‹åŠ¨æšä¸¾ï¼Œè¯†åˆ«ç›®æ ‡ç³»ç»Ÿ SMB æœåŠ¡å­˜åœ¨çš„ CVE-2017-0143 æ¼æ´ã€‚
3.  **æ¼æ´åˆ©ç”¨ï¼š** ä½¿ç”¨ Metasploit æ¡†æ¶ä¸­çš„ `exploit/windows/smb/ms17_010_eternalblue` æ¨¡å—ã€‚
4.  **é…ç½®ï¼š** é…ç½® RHOSTï¼ˆç›®æ ‡ IP åœ°å€ï¼‰ï¼ŒPAYLOADï¼ˆä¾‹å¦‚ `windows/x64/meterpreter/reverse_tcp`ï¼‰ï¼Œä»¥åŠ LHOSTï¼ˆæ”»å‡»è€… IP åœ°å€ï¼‰ã€‚
5.  **æ‰§è¡Œï¼š** è¿è¡Œ exploitï¼ŒæˆåŠŸå»ºç«‹ Meterpreter ä¼šè¯ã€‚
6.  **åæ¸—é€ï¼š** æ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼Œæå–å¯†ç å“ˆå¸Œï¼Œå¹¶è¿›è¡Œå…¶ä»–åæ¸—é€æ´»åŠ¨ï¼Œæ¯”å¦‚flagè·å–ã€‚

**é¡¹ç›®åœ°å€:** [Mafiosohack/offensive-security-lab-1](https://github.com/Mafiosohack/offensive-security-lab-1)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---



---

## POC #3

**æ¥æº**: [CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md](../2017/CVE-2017-0143-NatteeSetobol_Etern-blue-Windows-7-Checker.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå®Œå…¨æ§åˆ¶å’Œæ•°æ®æ³„éœ²

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ä¸”æœªå®‰è£…MS17-010è¡¥ä¸

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 æ˜¯ä¸€ä¸ªWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´ä¸EternalBlue exploitæœ‰å…³ï¼Œæ˜¯WannaCryå‹’ç´¢è½¯ä»¶ä¼ æ’­åˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143æ¼æ´è¢«å¹¿æ³›åˆ©ç”¨ï¼Œå­˜åœ¨å…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆå¦‚EternalBlueï¼‰ã€‚æä¾›çš„POCä»£ç ï¼ˆEternal-blue-Windows-7-Checkerï¼‰æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼Œç”¨äºåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦å—åˆ°EternalBlueæ”»å‡»çš„å½±å“ï¼Œå¹¶éç›´æ¥åˆ©ç”¨æ¼æ´çš„ä»£ç ï¼Œä½†æ˜¯è¡¨æ˜äº†è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æä¾›çš„checker.pyï¼ˆæœªæä¾›å®Œæ•´ä»£ç ï¼‰ æ˜¯ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚bucket.cpp æ–‡ä»¶æ˜¯å“ˆå¸Œæ¡¶çš„å®ç°ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„å“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰å‘ç°æ˜æ˜¾çš„æ¶æ„ä»£ç æˆ–åé—¨ã€‚ä½†æ˜¯ï¼Œä»»ä½•ä»£ç éƒ½å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„ï¼Œå› æ­¤ä»ç„¶å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚æ­¤å¤„çš„10%è¡¨ç¤ºå­˜åœ¨ä¸€äº›ç»†å¾®çš„é£é™©ï¼Œéœ€è¦è¿›ä¸€æ­¥å®¡è®¡ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  æ”»å‡»è€…æ‰«æç½‘ç»œï¼ŒæŸ¥æ‰¾å¯ç”¨SMBv1ä¸”æœªå®‰è£…MS17-010è¡¥ä¸çš„ç›®æ ‡ç³»ç»Ÿã€‚
2.  æ”»å‡»è€…ä½¿ç”¨EternalBlue exploitæˆ–å…¶ä»–é’ˆå¯¹CVE-2017-0143çš„exploitï¼Œæ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ã€‚
3.  æ”»å‡»è€…å°†æ¶æ„æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿã€‚
4.  å¦‚æœç›®æ ‡ç³»ç»Ÿå­˜åœ¨æ¼æ´ï¼Œæ¶æ„ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œæ”»å‡»è€…å¯ä»¥è·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚

**æ’åºä¼˜å…ˆçº§è¯´æ˜ï¼š**
åœ¨æœ¬æ¬¡åˆ†æä¸­ï¼Œæœç´¢å¼•æ“ç»“æœæä¾›äº†æ¼æ´çš„æ€»ä½“æè¿°å’Œå½±å“ï¼Œæ¼æ´åˆ©ç”¨ä»£ç æä¾›äº†æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚å’Œæ£€æµ‹æ–¹æ³•ï¼Œæ¼æ´åº“ä¿¡æ¯æä¾›äº†æ¼æ´çš„å®˜æ–¹æè¿°å’Œå—å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæœç´¢å¼•æ“ç»“æœ>æ¼æ´åˆ©ç”¨ä»£ç >æ¼æ´åº“ä¿¡æ¯ã€‚

**é¡¹ç›®åœ°å€:** [NatteeSetobol/Etern-blue-Windows-7-Checker](https://github.com/NatteeSetobol/Etern-blue-Windows-7-Checker)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #4

**æ¥æº**: [CVE-2017-0143-benguelmas_cve-2017-0143.md](../2017/CVE-2017-0143-benguelmas_cve-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆEternalBlueï¼‰

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿå®Œå…¨æ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1åè®®ï¼Œä¸”æœªå®‰è£…MS17-010è¡¥ä¸ï¼Œæ”»å‡»è€…éœ€è¦ç½‘ç»œå¯è¾¾æ€§ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 10%

## è¯¦æƒ…

CVE-2017-0143 (EternalBlue) æ˜¯ä¸€ä¸ªå­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åˆ©ç”¨é€šå¸¸æ¶‰åŠä½¿ç”¨ Metasploit Frameworkï¼Œå¦‚æä¾›çš„ POC ä»£ç æ‰€ç¤ºã€‚è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§é«˜ï¼Œå› ä¸ºæœ‰å¤šä¸ªå…¬å¼€å¯ç”¨çš„æ¼æ´åˆ©ç”¨ä»£ç å’Œ Metasploit æ¨¡å—ã€‚æŠ•æ¯’é£é™©è¾ƒä½ (10%)ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

*   **POC ä»£ç éªŒè¯ï¼š** æä¾›çš„ POC ä»£ç ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit åˆ©ç”¨ EternalBlue æ¼æ´ï¼Œæ­¥éª¤æ¸…æ™°ä¸”ç›®æ ‡æ˜ç¡®ï¼Œå³å¤ç°æ¼æ´ã€‚
*   **ä»£ç æ–‡ä»¶åˆ†æï¼š** åˆ†æäº†æä¾›çš„ README.md å’Œ Steps.md æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ­å»ºç¯å¢ƒã€é…ç½®å‚æ•°å’Œè¿è¡Œæ¼æ´åˆ©ç”¨ï¼Œæœªå‘ç°ä»»ä½•å¯ç–‘æˆ–æ¶æ„çš„ä»£ç ç‰‡æ®µã€‚å› æ­¤ï¼Œåˆ¤æ–­è¯¥ä»“åº“å­˜åœ¨ä½œè€…éšè—çš„æŠ•æ¯’ä»£ç çš„å¯èƒ½æ€§è¾ƒä½ã€‚
*   **é£é™©æç¤ºï¼š** POC ä»£ç ä¸­åŒ…å«æ˜ç¡®çš„æ³•å¾‹å…è´£å£°æ˜ï¼Œæç¤ºç”¨æˆ·åªèƒ½åœ¨è·å¾—æˆæƒçš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé¿å…éæ³•ä½¿ç”¨ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†è¢«æ¶æ„ä½¿ç”¨çš„é£é™©ã€‚

**æ¼æ´åˆ©ç”¨æ–¹å¼ï¼š**

1.  **ç¯å¢ƒå‡†å¤‡ï¼š** æ­å»ºåŒ…å«æ˜“å—æ”»å‡»çš„ Windows ç³»ç»Ÿçš„å®éªŒç¯å¢ƒï¼ˆä¾‹å¦‚ï¼ŒWindows 7 è™šæ‹Ÿæœºï¼‰ï¼Œç¡®ä¿å·²å¯ç”¨ SMBv1 ä¸”æœªå®‰è£… MS17-010 è¡¥ä¸ã€‚
2.  **IP åœ°å€è·å–ï¼š** åœ¨æ”»å‡»è€…æœºå™¨ï¼ˆä¾‹å¦‚ï¼ŒKali Linuxï¼‰ä¸Šç¡®å®šæ”»å‡»è€…å’Œç›®æ ‡ç³»ç»Ÿçš„ IP åœ°å€ã€‚
3.  **æ¼æ´æ‰«æï¼š** ä½¿ç”¨ Nmap ç­‰å·¥å…·æ‰«æç›®æ ‡ç³»ç»Ÿï¼Œç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚
4.  **Metasploit åˆ©ç”¨ï¼š** å¯åŠ¨ Metasploit Frameworkï¼Œæœç´¢å¹¶é€‰æ‹© EternalBlue æ¼æ´åˆ©ç”¨æ¨¡å—ï¼ˆ`exploit/windows/smb/ms17_010_eternalblue`ï¼‰ã€‚
5.  **å‚æ•°é…ç½®ï¼š** è®¾ç½®å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç›®æ ‡ IP åœ°å€ï¼ˆRHOSTï¼‰å’Œæ”»å‡»è€… IP åœ°å€ï¼ˆLHOSTï¼‰ã€‚
6.  **æ¼æ´åˆ©ç”¨æ‰§è¡Œï¼š** è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºã€‚å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°†è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ Meterpreter shellã€‚
7.  **åæ¸—é€æµ‹è¯•ï¼š** ä½¿ç”¨ Meterpreter shell æ‰§è¡Œå„ç§åæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚æ”¶é›†ç³»ç»Ÿä¿¡æ¯ã€æå‡æƒé™ã€è®¿é—®æ–‡ä»¶ç­‰ã€‚

**æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ¼æ´åˆ©ç”¨æœ‰æ•ˆæ€§é«˜ï¼Œä½†è¯·åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹ä½¿ç”¨ã€‚**

**é¡¹ç›®åœ°å€:** [benguelmas/cve-2017-0143](https://github.com/benguelmas/cve-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #5

**æ¥æº**: [CVE-2017-0143-h3x0v3rl0rd_MS17-010.md](../2017/CVE-2017-0143-h3x0v3rl0rd_MS17-010.md)

## CVE-2017-0143

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1æœåŠ¡å™¨

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬Windows Vista SP2ã€Windows Server 2008 SP2å’ŒR2 SP1ã€Windows 7 SP1ã€Windows 8.1ã€Windows Server 2012 Goldå’ŒR2ã€Windows RT 8.1ä»¥åŠWindows 10 Gold, 1511å’Œ1607

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¯ç”¨SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªWindows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äºMicrosoft Windows Vista SP2ç­‰å¤šä¸ªç‰ˆæœ¬çš„SMBv1æœåŠ¡å™¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…åˆ©ç”¨æ­¤æ¼æ´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„Pythonè„šæœ¬ `exploit.py` æ˜¯ä¸€ä¸ªé’ˆå¯¹ MS17-010 (CVE-2017-0143) çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è¯¥è„šæœ¬æ—¨åœ¨åˆ©ç”¨SMBv1åè®®ä¸­çš„æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢å¼•æ“ç»“æœå‡è¡¨æ˜è¯¥æ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¸”æœ‰å¯ç”¨çš„åˆ©ç”¨ä»£ç ã€‚

**æŠ•æ¯’é£é™©ï¼š**
æŸ¥çœ‹`exploit.py`çš„å†…å®¹ï¼Œå‘ç°ä»£ç ç»“æ„å¤æ‚ï¼ŒåŒ…å«SMBåè®®äº¤äº’çš„å®ç°ï¼Œä»¥åŠé’ˆå¯¹ä¸åŒWindowsç‰ˆæœ¬çš„åç§»é‡ã€‚è™½ç„¶ä»£ç æœ¬èº«çœ‹èµ·æ¥æ˜¯æ¼æ´åˆ©ç”¨ï¼Œä½†ä»éœ€æ³¨æ„æ½œåœ¨çš„æŠ•æ¯’é£é™©ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨payloadä¸­åµŒå…¥æ¶æ„ä»£ç ï¼Œæˆ–è€…ä¿®æ”¹ä»£ç çš„æŸäº›éƒ¨åˆ†ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œæ¶æ„æ“ä½œï¼Œè¿™ç§é£é™©è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤. å› æ­¤,æŠ•æ¯’é£é™©è¯„ä¼°ä¸º5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
1.  **æ¼æ´åŸç†ï¼š** è¯¥æ¼æ´æºäºSMBv1åè®®å¤„ç†æ¶æ„æ„é€ çš„æ•°æ®åŒ…æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®éªŒè¯æ•°æ®åŒ…çš„é•¿åº¦ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ã€‚
2.  **åˆ©ç”¨è¿‡ç¨‹ï¼š**
    *   æ”»å‡»è€…ä½¿ç”¨ `exploit.py` è„šæœ¬æŒ‡å®šç›®æ ‡IPåœ°å€ã€‚
    *   è„šæœ¬é€šè¿‡SMBåè®®ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹è¿æ¥ã€‚
    *   è„šæœ¬å‘é€ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…å«æº¢å‡ºpayloadã€‚
    *   ç›®æ ‡ç³»ç»Ÿæ¥æ”¶åˆ°æ¶æ„æ•°æ®åŒ…åï¼ŒSMBv1æœåŠ¡å™¨å¤„ç†æ•°æ®åŒ…æ—¶å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚
    *   æº¢å‡ºpayloadè¦†ç›–å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸï¼Œä¾‹å¦‚å‡½æ•°è¿”å›åœ°å€ã€‚
    *   å½“å‡½æ•°è¿”å›æ—¶ï¼Œç¨‹åºæ§åˆ¶æµè¢«åŠ«æŒåˆ°æ”»å‡»è€…æ§åˆ¶çš„åŒºåŸŸï¼Œä»è€Œæ‰§è¡Œæ”»å‡»è€…æä¾›çš„æ¶æ„ä»£ç ã€‚
3. **åˆ©ç”¨ç»†èŠ‚:**
  * è¯¥æ¼æ´åˆ©ç”¨åˆ©ç”¨äº†ä¸ EternalRomance å’Œ EternalSynergy ç›¸åŒçš„æ¼æ´ï¼Œå› æ­¤éœ€è¦å‘½åç®¡é“ã€‚
  *  è¯¥è„šæœ¬é€šè¿‡è¦†ç›– `SrvSecContext` ç»“æ„ä¸­çš„ `Token` å­—æ®µä¸º NULLï¼Œå¹¶å°† `UsePsImpersonateClient` å­—æ®µè®¾ç½®ä¸º trueï¼Œä»è€Œå…è®¸è¿è¡Œçš„çº¿ç¨‹ä½¿ç”¨ä¸»ä»¤ç‰Œï¼ˆSYSTEMï¼‰æ¥æ‰§è¡Œæ‰€æœ‰ SMB æ“ä½œã€‚å¯¹äº Windows 2003 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¯¥åˆ©ç”¨ä¼šä¿®æ”¹ PCtxtHandle ä¸­çš„ä»¤ç‰Œç”¨æˆ·å’Œç»„ä»¥è·å¾— SYSTEM æƒé™ï¼Œå› ä¸ºè¿™äº› Windows ç‰ˆæœ¬ä¸­ä»…ä½¿ç”¨ `ImpersonateSecurityContext()`ã€‚

**æ€»ç»“ï¼š**
è¯¥æ¼æ´åˆ©ç”¨çš„æœ‰æ•ˆæ€§è¾ƒé«˜ï¼Œå› ä¸ºæ¼æ´ä¿¡æ¯å’Œå…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç çš„å­˜åœ¨ï¼Œä½†éœ€è¦ä»”ç»†æ£€æŸ¥æ¼æ´åˆ©ç”¨ä»£ç ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„è¡Œä¸ºã€‚


**é¡¹ç›®åœ°å€:** [h3x0v3rl0rd/MS17-010](https://github.com/h3x0v3rl0rd/MS17-010)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #6

**æ¥æº**: [CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md](../2017/CVE-2017-0143-n3rdh4x0r_MS17-010_CVE-2017-0143.md)

## CVE-2017-0143 - Windows SMB è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå…è®¸è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç 

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œä¸”æ”»å‡»è€…èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè®¿é—®ã€‚

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 95%

## è¯¦æƒ…

CVE-2017-0143 å­˜åœ¨äº Windows SMBv1 æœåŠ¡å™¨ä¸­ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹åˆ¶çš„ SMB æ•°æ®åŒ…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥æ¼æ´å¸¸ä¸ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶å’Œ DoublePulsar åé—¨ç›¸å…³è”ã€‚åˆ©ç”¨è¿‡ç¨‹ä¸€èˆ¬ä¸ºï¼š

1.  ä½¿ç”¨ EternalBlue æ¼æ´åˆ©ç”¨æ¡†æ¶æ”»å‡»å­˜åœ¨æ¼æ´çš„ SMBv1 æœåŠ¡ã€‚
2.  æˆåŠŸåˆ©ç”¨åï¼Œé€šå¸¸ä¼šå®‰è£… DoublePulsar åé—¨ï¼Œå…è®¸åç»­æ‰§è¡Œä»»æ„ä»£ç ã€‚
3.  é€šè¿‡ DoublePulsar æ‰§è¡Œæ¶æ„è½½è·ï¼Œä¾‹å¦‚åå‘ Shell æˆ–å…¶ä»–æ¶æ„è½¯ä»¶ã€‚

æä¾›çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼ˆREADME.mdï¼‰æè¿°äº†å¦‚ä½•ä½¿ç”¨ Metasploit çš„ `msfvenom` ç”Ÿæˆæ¶æ„è½½è·ï¼ˆåå‘ TCP shellï¼‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ `send_and_execute.py` è„šæœ¬é€šè¿‡ SMB åè®®å°†è¯¥è½½è·å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶æ‰§è¡Œã€‚ å…¶ä¸­æåˆ°äº†ä½¿ç”¨Dockeræ¥é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜.

**æŠ•æ¯’é£é™©åˆ†æï¼š**

ç”±äºè¯¥æ¼æ´å½±å“èŒƒå›´å¹¿ï¼Œä¸”åˆ©ç”¨ä»£ç å®¹æ˜“è¢«ä¿®æ”¹ä»¥æ¤å…¥æ¶æ„è½½è·ï¼Œå› æ­¤å­˜åœ¨è¾ƒé«˜çš„æŠ•æ¯’é£é™©ã€‚æ”»å‡»è€…å¯èƒ½ä¿®æ”¹ `send_and_execute.py` è„šæœ¬æˆ–ç”Ÿæˆçš„æ¶æ„è½½è·ï¼Œä»è€Œåœ¨å—å®³è€…ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å‹’ç´¢è½¯ä»¶ï¼ˆå¦‚ WannaCryï¼Œæœç´¢å¼•æ“ç»“æœä¸­æåˆ°ï¼‰ã€‚ å› æ­¤ï¼Œè¯¥æ¼æ´å¦‚æœæœªç»éªŒè¯ï¼Œå¯èƒ½å­˜åœ¨æå¤§æŠ•æ¯’é£é™©ã€‚

**é¡¹ç›®åœ°å€:** [n3rdh4x0r/MS17-010_CVE-2017-0143](https://github.com/n3rdh4x0r/MS17-010_CVE-2017-0143)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

## POC #7

**æ¥æº**: [CVE-2017-0143-valarauco_wannafind.md](../2017/CVE-2017-0143-valarauco_wannafind.md)

## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**æ¼æ´ç¼–å·:** CVE-2017-0143

**æ¼æ´ç±»å‹:** è¿œç¨‹ä»£ç æ‰§è¡Œ

**å½±å“åº”ç”¨:** Windows SMBv1

**å±å®³ç­‰çº§:** é«˜å±ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’Œç³»ç»Ÿæ§åˆ¶

**å½±å“ç‰ˆæœ¬:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**åˆ©ç”¨æ¡ä»¶:** ç›®æ ‡ç³»ç»Ÿå¼€å¯SMBv1æœåŠ¡ï¼Œæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç³»ç»Ÿçš„445ç«¯å£

**POC å¯ç”¨æ€§:** æ˜¯

**æŠ•æ¯’é£é™©:** 5%

## è¯¦æƒ…

CVE-2017-0143æ˜¯ä¸€ä¸ªå­˜åœ¨äºWindows SMBv1æœåŠ¡å™¨ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„SMBæ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£æ¥è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯å¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚

**æœ‰æ•ˆæ€§ï¼š**
æä¾›çš„POCä»£ç æ˜¯ä¸€ä¸ª`wannafind.sh`è„šæœ¬ï¼Œå®ƒä½¿ç”¨`nmap`å’Œ`masscan`æ¥æ£€æµ‹ç½‘ç»œä¸­æ˜¯å¦å­˜åœ¨å—CVE-2017-0143ï¼ˆMS17-010ï¼‰å’ŒCVE-2017-7494å½±å“çš„ç³»ç»Ÿã€‚è„šæœ¬é¦–å…ˆæ£€æŸ¥`masscan`å’Œ`nmap`æ˜¯å¦å·²å®‰è£…ï¼Œç„¶åä¸‹è½½æˆ–æ›´æ–°ç›¸åº”çš„Nmapè„šæœ¬ï¼ˆ`smb-vuln-ms17-010.nse` å’Œ `samba-vuln-cve-2017-7494.nse`ï¼‰ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨`masscan`å¿«é€Ÿæ‰«ææŒ‡å®šå­ç½‘çš„445ç«¯å£ï¼Œå†ä½¿ç”¨`nmap`å’Œä¸‹è½½å¥½çš„è„šæœ¬æ‰«æå­˜æ´»ä¸»æœºï¼Œå¯»æ‰¾æ¼æ´ã€‚

è¿™ä¸ªè„šæœ¬æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨CVE-2017-0143ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨æ¥è¯†åˆ«æ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸ºåç»­çš„æ”»å‡»åšå‡†å¤‡ã€‚å› æ­¤ï¼Œè¯¥è„šæœ¬çš„**æœ‰æ•ˆæ€§åœ¨äºæ¼æ´æ£€æµ‹è€Œéç›´æ¥åˆ©ç”¨**ã€‚

**æŠ•æ¯’é£é™©ï¼š**
è™½ç„¶è„šæœ¬çš„åŠŸèƒ½æ˜¯æ¼æ´æ‰«æï¼Œä½†ä»å­˜åœ¨ä¸€å®šçš„æŠ•æ¯’é£é™©ã€‚ ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  **å¤–éƒ¨èµ„æºä¸‹è½½:** è„šæœ¬ä¼šä»GitHubä¸‹è½½`smb-vuln-ms17-010.nse`è„šæœ¬, ä»gist.githubusercontent.com ä¸‹è½½`samba-vuln-cve-2017-7494.nse`ã€‚å¦‚æœè¿™äº›è¿œç¨‹ä»“åº“è¢«ç¯¡æ”¹ï¼Œè„šæœ¬å¯èƒ½ä¼šä¸‹è½½æ¶æ„ä»£ç ã€‚ä½†è„šæœ¬ä¸­å¯¹ä¸‹è½½çš„æ–‡ä»¶ä¼šæ‰§è¡Œ `chown root:root`æ“ä½œï¼Œå³ä½¿è¢«ç¯¡æ”¹ï¼Œæ”»å‡»è€…ææƒéš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚
2.  **è„šæœ¬æ‰§è¡Œ:** è„šæœ¬éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œmasscanå’Œæ›´æ–°nmapè„šæœ¬ã€‚å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶è¿è¡Œè„šæœ¬çš„ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ·»åŠ æ¶æ„å‘½ä»¤ã€‚

è€ƒè™‘åˆ°è„šæœ¬çš„åŠŸèƒ½ä¸»è¦æ˜¯è°ƒç”¨ç°æœ‰çš„æ‰«æå·¥å…·ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½è¿è¡Œï¼ŒæŠ•æ¯’é£é™©ç›¸å¯¹è¾ƒä½ï¼Œä½†ä¸èƒ½å®Œå…¨æ’é™¤ã€‚ è€ƒè™‘åˆ°è¿œç¨‹ä¸‹è½½è„šæœ¬å­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é£é™©ï¼Œç»™å‡ºä¸€ä¸ªè¾ƒä½çš„ç™¾åˆ†æ¯”ï¼š5%ã€‚

**åˆ©ç”¨æ–¹å¼ï¼š**
æ ¹æ®æ¼æ´åº“ä¿¡æ¯å’Œæœç´¢ç»“æœï¼ŒCVE-2017-0143çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  **æ”»å‡»è€…æ‰«æç½‘ç»œï¼Œè¯†åˆ«å­˜åœ¨æ¼æ´çš„SMBv1æœåŠ¡ã€‚** `wannafind.sh` è„šæœ¬å¯ä»¥è¾…åŠ©å®Œæˆè¿™ä¸€æ­¥ã€‚
2.  **æ”»å‡»è€…æ„é€ æ¶æ„çš„SMBæ•°æ®åŒ…ï¼Œå‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„445ç«¯å£ã€‚**
3.  **ç›®æ ‡æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®åŒ…æ—¶ï¼Œè§¦å‘æ¼æ´ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚**
4.  **æ”»å‡»è€…åˆ©ç”¨æ‰§è¡Œçš„ä»£ç ï¼Œè·å–ç³»ç»Ÿæ§åˆ¶æƒï¼Œå®‰è£…åé—¨ï¼Œçªƒå–æ•°æ®ç­‰ã€‚**

è¯¥æ¼æ´å¸¸ä¸EternalBlueï¼ˆCVE-2017-0144ï¼‰ä¸€èµ·ä½¿ç”¨ï¼ŒEternalBlueè´Ÿè´£çªç ´ç³»ç»Ÿçš„åˆå§‹é˜²å¾¡ï¼Œç„¶ååˆ©ç”¨CVE-2017-0143æ‰§è¡Œæ¶æ„ä»£ç ã€‚

**é¡¹ç›®åœ°å€:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**æ¼æ´è¯¦æƒ…:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)

---

