## CVE-2017-5638 - Apache Struts 2 RCE (远程代码执行)

**漏洞编号:** CVE-2017-5638

**漏洞类型:** RCE (远程代码执行)

**影响应用:** Apache Struts 2

**危害等级:** CRITICAL

**CVSS评分:** 10.0 (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)

**影响版本:** Struts 2.3.5 - 2.3.31, Struts 2.5 - 2.5.10

**利用条件:** 远程网络访问，目标开启了Jakarta Multipart解析器（通常用于处理文件上传）

**POC 可用性:** 9/10

**POC 类型:** 完整利用

**攻击复杂度:** 低

**投毒风险:** 10%

## 详情

POC有效性分析：该POC提供了极高完整性的实验环境。通过Dockerfile构建了一个基于Ubuntu 20.04、Java 11和Tomcat 9.0.31的真实运行环境，并统一部署了受影响的struts2-showcase.war应用（版本2.3.30）。利用脚本基于Python 3，针对Jakarta Multipart解析器在处理恶意Content-Type头部时的OGNL表达式注入漏洞进行攻击。该POC的有效性极高，因为它不仅包含了攻击载荷，还包含了完整的靶机配置，能够稳定触发RCE，执行系统级命令如'id'。其利用的核心在于Struts2解析HTTP头部错误信息时，未对Content-Type字段中的OGNL表达式进行过滤，导致攻击者可以控制执行流程。利用步骤：1. 准备环境：安装Docker和Python 3。2. 构建镜像：执行'docker build -t cve-2017-5638 .'命令，将自动下载并配置Tomcat与受损版本的Struts2。3. 启动服务：运行容器并将8080端口映射至宿主机，确保服务在'http://localhost:8080/struts2-showcase/'可访问。4. 执行攻击：运行'python3 exploit/exploit.py'，指定目标URL和待执行的OS命令。5. 结果验证：观察控制台输出，确认命令执行后的返回结果。投毒风险分析：经过对POC源代码的静态评估，该项目投毒风险较低。其核心利用逻辑基于标准Python库构造HTTP请求，代码逻辑清晰，主要行为是修改HTTP Headers中的Content-Type字段。Dockerfile引用的是官方归档地址（archive.apache.org），减少了中间人篡改风险。脚本中未发现代码混淆、未授权的外部域名连接或对宿主机敏感文件的恶意读写行为。尽管提供了二进制war包的自动化部署，但均来自官方分发渠道。唯一潜在风险在于用户在使用此类Exp时，若从非受信来源下载预编译的二进制文件或混淆后的Python脚本，可能存在反向Shell后门。本POC代码透明，符合防御性安全研究规范，但在生产环境中直接运行此类测试脚本仍需在隔离沙箱内进行，以防攻击载荷产生非预期的系统副作用。

**项目地址:** [https://github.com/louislafosse/CVE-2017-5638-assignement](https://www.google.com/search?q=https://github.com/louislafosse/CVE-2017-5638-assignement)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)
