## CVE-2024-21413 - Microsoft Outlook 远程代码执行漏洞

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致信息泄露、远程代码执行和权限提升

**影响版本:** 受影响版本包括 Microsoft Office 2016 (版本 < 16.0.5435.1001)、Microsoft Office 2019、Microsoft 365 Apps for Enterprise 和 Microsoft Office LTSC 2021（所有受支持版本，直至2024年2月更新）。

**利用条件:** 需要受害者使用 Microsoft Outlook 打开包含特制 file:// 链接的邮件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21413 是一种 Microsoft Outlook 远程代码执行漏洞，也称为 “MonikerLink” 漏洞。攻击者可以利用此漏洞通过发送包含恶意 `file://` 链接的电子邮件来远程执行代码。当用户点击该链接时，Outlook 会尝试连接到攻击者控制的 SMB 共享，这可能导致 NTLM 凭据泄露或未经授权访问本地文件。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞利用的有效性较高。CISA已将此漏洞添加到已知被利用的漏洞目录(KEV)中，表明该漏洞在野外已被积极利用。PoC代码提供了一种利用 `file://` 协议将受害者重定向到攻击者控制的 SMB 共享的方案，进一步验证了该漏洞的有效性。

**投毒风险：**
PoC代码主要包含利用脚本(exploitSendEmailOutlook.py, captureHashResponder.py)和辅助配置文件。`exploitSendEmailOutlook.py` 脚本用于发送包含恶意链接的电子邮件，`captureHashResponder.py` 用于启动 Responder 工具以捕获 NTLM 哈希。startServicesWindows.py用于快速启动漏洞验证环境.投毒风险主要存在于以下几个方面：

1.  **隐蔽的反向 Shell：** 攻击者可能在 `exploitSendEmailOutlook.py` 脚本中添加反向 Shell 代码，在受害者点击恶意链接时，在后台静默执行，从而控制受害者系统。
2.  **恶意 Responder 配置：** 攻击者可能修改 `captureHashResponder.py` 脚本，使其在捕获 NTLM 哈希的同时，执行其他恶意操作，例如下载并执行恶意文件。
3.  **供应链投毒：** 该 PoC 依赖于多个 Python 库（如 `pyautogui`、`Pillow`、`opencv-python` 和 `rich`）。攻击者可能通过篡改这些依赖库，植入恶意代码，从而影响所有使用该 PoC 的用户。

综合考虑，虽然 PoC 代码主要功能是演示漏洞利用，但存在潜在的投毒风险。攻击者可能利用代码中的可扩展性，添加恶意功能，或者通过篡改依赖库进行供应链投毒。因此，在使用该 PoC 时，务必进行代码审计，并从可信的源获取依赖库。

**利用方式：**
利用方式如下：

1.  **发送恶意邮件：** 攻击者构造一封包含恶意 `file://` 链接的电子邮件，并将其发送给受害者。
2.  **诱导点击链接：** 攻击者通过各种手段诱使受害者点击邮件中的恶意链接。
3.  **NTLM 凭据捕获/文件访问：** 受害者点击链接后，Outlook 会尝试连接到攻击者控制的 SMB 共享。Responder 工具会捕获受害者的 NTLMv2 哈希。或者，攻击者可以直接访问受害者本地文件（如果链接指向本地文件）。
4.  **代码执行 (可选)：** 攻击者可以进一步利用捕获的 NTLM 哈希进行密码破解，或者利用文件访问权限在受害者系统上执行恶意代码。

总而言之，CVE-2024-21413 是一个高危漏洞，利用方式简单，容易被攻击者利用。在使用该漏洞验证 PoC 时，必须在隔离环境中进行，并仔细审查代码，以防止被投毒。

**项目地址:** [D1se0/CVE-2024-21413-Vulnerabilidad-Outlook-LAB](https://github.com/D1se0/CVE-2024-21413-Vulnerabilidad-Outlook-LAB)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)