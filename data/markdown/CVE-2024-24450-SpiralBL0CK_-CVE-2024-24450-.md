## CVE-2024-24450-OpenAirInterface CN5G AMF-栈溢出

**漏洞编号:** CVE-2024-24450

**漏洞类型:** 栈溢出

**影响应用:** OpenAirInterface CN5G AMF

**危害等级:** 高危，可能导致拒绝服务和远程代码执行

**影响版本:** <= 2.0.0

**利用条件:** 需要访问N2接口

**POC 可用性:** 是

**投毒风险:** 90%

## 详情

CVE-2024-24450是OpenAirInterface CN5G AMF <= 2.0.0版本中ngap_handle_pdu_session_resource_setup_response函数存在的一个栈溢出漏洞。攻击者可以通过N2接口发送一个包含过大的FailedToSetupList IE的PDU Session Resource Setup Response消息，导致AMF服务拒绝服务，甚至可能执行任意代码。

**有效性：**

根据漏洞信息和提供的POC代码，该漏洞利用是有效的。POC代码模拟了gNB与AMF之间的NGAP通信流程，首先建立SCTP连接，发送NG Setup Request和Initial UE Message进行初始化，然后发送包含大量FailedToSetupList IE的PDU Session Resource Setup Response消息，触发栈溢出。

**投毒风险：**

该POC代码存在较高的投毒风险，接近90%。原因如下：

*   **依赖第三方库：** POC依赖pycrate_asn1dir库，恶意攻击者可以修改或者替换该库，在利用时执行恶意代码。
*   **代码未做充分的安全检查：** 该POC没有对gNB IP和AMF IP等配置项进行验证，恶意攻击者可以修改这些配置项，将流量导向其他目标。
*   **错误处理不足：** POC代码中对SCTP连接失败，NG Setup Response接收失败， PDU Session Setup Request接收失败等异常情况的处理不够完善，导致攻击执行失败时可能无法得到正确信息，甚至会造成其他问题。

**利用方式：**

1.  攻击者需要能够访问N2接口，模拟一个gNB。
2.  使用sctp.sctpsocket_tcp函数， 建立与目标AMF的SCTP连接，默认NGAP端口是38412。
3.  发送NG Setup Request消息，与AMF建立NGAP会话。
4.  发送Initial UE Message, 模拟UE请求。
5.  接收AMF返回的PDU Session Setup Request消息。
6.  构造包含大量FailedToSetupList IE的PDU Session Resource Setup Response消息，并发送给AMF，触发栈溢出。FailedToSetupList 的大小需要足够大，才能覆盖栈上的缓冲区，导致程序崩溃或执行恶意代码。
7.  观察AMF的行为，确认是否成功触发漏洞。

**项目地址:** [SpiralBL0CK/-CVE-2024-24450-](https://github.com/SpiralBL0CK/-CVE-2024-24450-)

**漏洞详情:** [CVE-2024-24450](https://nvd.nist.gov/vuln/detail/CVE-2024-24450)