## CVE-2022-0739 - BookingPress < 1.0.11 - Unauthenticated SQL Injection

**漏洞编号:** CVE-2022-0739

**漏洞类型:** SQL注入

**影响应用:** BookingPress WordPress Plugin

**危害等级:** 高危，未授权的SQL注入可能导致数据泄露、权限提升甚至远程代码执行

**影响版本:** < 1.0.11

**利用条件:** 目标网站安装了BookingPress插件，且版本低于1.0.11，允许未授权访问admin-ajax.php

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞库信息，BookingPress WordPress插件在1.0.11之前的版本中存在一个未授权的SQL注入漏洞。攻击者可以通过向`bookingpress_front_get_category_services` AJAX action发送恶意构造的POST请求来利用此漏洞。该漏洞允许未经验证的用户执行任意SQL查询，从而可能导致敏感数据泄露（例如，从`wp_users`表中提取用户名、电子邮件和密码哈希），甚至可能导致权限提升或远程代码执行（取决于数据库配置和WordPress环境）。

提供的POC脚本`exploit.sh`通过以下步骤利用此漏洞：

1.  **参数处理：** 接收URL和事件目录作为参数。
2.  **获取Nonce：** 从目标网站获取`_wpnonce`值，用于绕过WordPress的nonce验证（尽管此漏洞是未授权的，但插件可能仍需要nonce）。
3.  **构造Payload：** 构造一个包含恶意SQL注入的POST请求，该请求通过`UNION ALL SELECT`语句从`wp_users`表中检索`user_login`、`user_email`和`user_pass`。
4.  **发送请求：** 使用`curl`发送包含注入的POST请求到`wp-admin/admin-ajax.php`。
5.  **解析结果：** 使用`grep`和`sed`从响应中提取用户名、电子邮件和密码哈希值。
6.  **展示数据：** 将提取的用户数据以表格形式呈现。

**有效性：** 根据漏洞描述和提供的POC代码，该漏洞利用**有效**。该POC脚本可以成功地从`wp_users`表中提取敏感信息。

**投毒风险：** 经过对POC代码的分析，未发现明显的投毒代码。脚本的主要功能是利用SQL注入漏洞提取数据。脚本中所有的操作均是围绕此目的，没有发现任何试图破坏目标系统、安装恶意软件或者收集额外信息的行为。因此，投毒风险评估为**0%**。

**利用方式：**

1.  确定目标网站是否安装了存在漏洞的BookingPress插件（版本低于1.0.11）。
2.  运行`exploit.sh`脚本，提供目标网站的URL作为参数。
3.  脚本将自动获取nonce值，构造包含SQL注入的POST请求，并发送到目标网站。
4.  脚本将解析响应，提取用户名、电子邮件和密码哈希值，并将其显示在终端上。

**项目地址:** [lhamouche/Bash-exploit-for-CVE-2022-0739](https://github.com/lhamouche/Bash-exploit-for-CVE-2022-0739)

**漏洞详情:** [CVE-2022-0739](https://nvd.nist.gov/vuln/detail/CVE-2022-0739)