## CVE-2024-49369-Icinga2-TLS证书验证绕过

**漏洞编号:** CVE-2024-49369

**漏洞类型:** TLS证书验证绕过

**影响应用:** Icinga2

**危害等级:** 严重，可能导致远程代码执行和敏感信息泄露

**影响版本:** 2.4.0 <= version < 2.11.12
2.12.0 <= version < 2.12.11
2.13.0 <= version < 2.13.10
2.14.0 <= version < 2.14.3

**利用条件:** 需要目标主机运行受影响版本的Icinga2，并且允许网络访问JSON-RPC或HTTP API端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-49369 是 Icinga 2 中的一个严重漏洞，该漏洞允许攻击者绕过 TLS 证书验证，从而可以模拟受信任的集群节点以及使用 TLS 客户端证书进行身份验证的任何 API 用户。攻击者可以通过模拟 Master/Satellite 实例，劫持 Icinga Agent，执行任意命令或获取敏感信息。

**漏洞利用有效性：**
提供的漏洞利用代码（POC）看起来有效。它包含扫描易受攻击代理的脚本以及利用该漏洞执行任意命令的脚本。根据 README.md 文件，该利用方法通过模拟 Master/Satellite 实例，更新 endpoint 配置，然后在 endpoint 上执行任意命令来实现。 

**投毒风险：**
代码中存在投毒的风险较低，估计在10%左右。 虽然代码看起来是利用已知的漏洞，但需要人工审核 `main.py` 的具体实现，以确保其中不包含任何恶意或意外的行为。比如是否会收集额外信息并上传，或者执行其他未记录的操作。

**利用方式：**
1.  **扫描：** 使用 `main.py scan` 命令扫描子网以查找易受攻击的 Icinga Agent。
2.  **劫持：** 通过模拟 Master/Satellite 实例，利用 Icinga 2 的 JSON-RPC 协议接管 Icinga Agent。
3.  **配置更新：**  更新 Agent 的配置。
4.  **命令执行：** 在 Agent 上执行任意命令，例如设置反向 shell。即使禁用了配置和命令执行，攻击者仍然可以通过观察发送到 Agent 的检查结果来收集敏感数据。

**缓解措施：**
将 Icinga 2 升级到 v2.14.3, v2.13.10, v2.12.11 或 v2.11.12。 

**项目地址:** [Quantum-Sicarius/CVE-2024-49369](https://github.com/Quantum-Sicarius/CVE-2024-49369)

**漏洞详情:** [CVE-2024-49369](https://nvd.nist.gov/vuln/detail/CVE-2024-49369)