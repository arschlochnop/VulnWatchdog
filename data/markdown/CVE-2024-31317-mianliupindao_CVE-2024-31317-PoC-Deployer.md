## CVE-2024-31317 Android ZygoteProcess 反序列化漏洞

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 反序列化漏洞导致提权

**影响应用:** Android

**危害等级:** 高危，本地提权到任意应用权限

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要User执行权限，无需用户交互，需要WRITE_SECURE_SETTINGS权限。

**POC 可用性:** 是

**投毒风险:** 70%

## 详情

CVE-2024-31317 是一个 Android 操作系统中的权限提升漏洞，存在于 `ZygoteProcess.java` 的多个函数中。由于不安全的反序列化，攻击者可以通过 `WRITE_SECURE_SETTINGS` 权限执行任意应用程序的代码。这可能导致本地权限提升。从搜索引擎结果来看，这个漏洞被认为是近年来最有价值的Android用户空间漏洞之一，并且有公开的利用方法。漏洞利用代码 `Android_Zygote_Research_Kit.sh` 脚本旨在帮助研究人员复现和分析此漏洞。它包含一个反向 shell 程序（`reverse_shell.c`），一个 payload 文件（`payload.txt`），一个编译脚本（`compile.sh`），以及相关的说明文档。脚本尝试创建一个监听特定端口的反向 shell，这本身就存在一定的风险。脚本中反向连接的硬编码端口和IP地址，意味着攻击者可以控制受害设备的反向连接。考虑到脚本的目的是为了方便研究人员使用，存在一种投毒风险，攻击者可能通过修改反向 shell 的代码，在受害者不知情的情况下植入恶意代码。例如，可以修改 `reverse_shell.c` 使其在建立连接后执行某些恶意操作，或者将收集到的信息发送到攻击者的服务器。由于这个漏洞允许执行任意应用的代码，如果被恶意利用，可以造成很大的危害。

利用方式：

1.  **权限获取:** 攻击者需要先获得 `WRITE_SECURE_SETTINGS` 权限。
2.  **构造恶意数据:**  构造包含恶意代码的反序列化数据。
3.  **利用 ZygoteProcess:**  将恶意数据传递给存在漏洞的 `ZygoteProcess.java` 函数。
4.  **代码执行:**  利用 Zygote 进程的权限执行任意代码，实现权限提升。

该`Android_Zygote_Research_Kit.sh`脚本只是一个辅助利用工具，用于生成所需的文件，并没有漏洞利用的核心代码。

**项目地址:** [mianliupindao/CVE-2024-31317-PoC-Deployer](https://github.com/mianliupindao/CVE-2024-31317-PoC-Deployer)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)