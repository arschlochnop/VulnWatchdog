## CVE-2022-22963 - Spring Cloud Function SpEL 表达式注入 RCE

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** Spring Cloud Function 3.1.6, 3.2.2, 以及所有旧的和不受支持的版本

**利用条件:** 目标系统使用了 Spring Cloud Function，且开启了路由功能。 攻击者需要能够发送带有恶意 SpEL 表达式的请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中一个严重的安全漏洞，允许未经授权的攻击者通过构造恶意的 SpEL 表达式执行任意代码。漏洞存在于路由功能中，攻击者可以利用此功能将恶意 SpEL 表达式作为路由表达式的一部分发送到服务器。 鉴于漏洞的严重性和易利用性，该漏洞被评为高危。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，CVE-2022-22963 漏洞是一个经过确认的远程代码执行漏洞。多个安全厂商和机构都发布了相关的安全公告和分析报告。 提供的漏洞利用代码（POC）旨在利用该漏洞在受影响的 Spring Cloud Function 实例上执行任意代码，可以判定该POC有效。

**利用方式：**

该漏洞的利用方式是向 Spring Cloud Function 应用发送一个特制的 HTTP 请求，其中包含一个恶意的 SpEL 表达式作为路由表达式。当 Spring Cloud Function 处理该请求时，会执行该 SpEL 表达式，从而允许攻击者在服务器上执行任意代码。PoC代码通过指定目标URL、端口、攻击者IP和监听端口，利用目标服务器反弹shell到攻击者机器，达到远程代码执行的目的。

**投毒风险分析：**

查看提供的PoC代码，该代码主要包含以下几个部分：
1.  **参数解析：** 使用 `go-flags` 库解析命令行参数，包括目标 URL、端口、攻击者 IP 和监听端口。
2.  **IP 地址验证：** `isValidIP` 函数验证攻击者提供的 IP 地址是否有效。
3.  **构建 Payload：**  根据提供的参数，构建包含恶意 SpEL 表达式的 HTTP 请求体。
4.  **发送请求：** 使用 `net/http` 库发送 HTTP 请求到目标服务器。
5.  **错误处理：** `check_error` 函数用于处理程序执行过程中可能出现的错误。

代码本身相对简单，主要功能是构造和发送包含 SpEL 表达式的 HTTP 请求。没有发现明显的恶意代码或后门。

**潜在的投毒风险分析：**
*   **依赖项风险：**  `go.mod` 文件中列出了 `github.com/jessevdk/go-flags` 作为依赖项。 虽然该库本身很常用，但始终存在供应链攻击的风险。 但是，鉴于该库的广泛使用，这种风险较低。
*   **隐蔽的 Payload：**  虽然代码中没有明显的后门，但攻击者可能会在生成的 SpEL 表达式中插入难以察觉的恶意代码。 然而，分析代码表明，SpEL 表达式的生成是基于用户提供的参数，因此这种风险也相对较低。
*   **其他风险：** 由于代码会主动发起网络请求，存在被中间人攻击或嗅探的风险。

**总结：**

PoC代码的主要风险来自于对目标系统的攻击利用，而非代码本身包含恶意后门。 但是，用户需要意识到供应链攻击和隐蔽 Payload 的潜在风险。

根据以上分析，判断此仓库中存在作者隐藏的投毒代码的可能性较低，约为10%。这个百分比主要是基于依赖库被投毒的可能性，以及SpEL表达式中可以嵌入混淆代码的风险，整体代码逻辑比较清晰。


**项目地址:** [gunzf0x/CVE-2022-22963](https://github.com/gunzf0x/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)