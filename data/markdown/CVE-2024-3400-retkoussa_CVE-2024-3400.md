## CVE-2024-3400 PAN-OS GlobalProtect 命令注入漏洞

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以利用此漏洞在防火墙上以 root 权限执行任意代码。

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3

**利用条件:** 目标PAN-OS设备配置了 GlobalProtect gateway 或 GlobalProtect portal (或两者)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 中的一个命令注入漏洞。由于任意文件创建漏洞，未经身份验证的远程攻击者可以利用此漏洞在受影响的系统上执行任意代码，获得 root 权限。

**有效性评估：**

根据漏洞描述和搜索结果，此漏洞是真实存在的，并且已经被野外利用。提供的 PoC 代码旨在验证漏洞的存在。该PoC通过构造包含恶意路径的 SESSID Cookie，结合`/ssl-vpn/hipreport.esp`接口，尝试在`/var/appweb/sslvpndocs/global-protect/portal/images/`目录下创建一个名为`poc.txt`的文件。创建成功后，尝试通过`/global-protect/portal/images/poc.txt`访问该文件。如果返回 HTTP 403 状态码，则表示文件已成功上传，验证了漏洞的存在。由于脚本自动尝试HTTPS，且可以上传文件，初步判断提供的PoC代码是有效的。

**投毒风险分析：**

查看提供的PoC脚本，脚本主要功能是发送两个 HTTP 请求来验证漏洞的存在。第一个 POST 请求设置了一个包含目录遍历的 Cookie，目的是在特定目录下创建文件。第二个 GET 请求检查文件是否成功创建。脚本没有明显的恶意行为，例如植入后门或收集信息。尽管如此，仍然存在一定的投毒风险，例如：

*   **依赖项风险：** 脚本使用了 `requests` 库，如果该库被恶意篡改，可能导致安全问题。
*   **代码执行风险：** 虽然脚本本身看起来无害，但攻击者可能修改脚本，例如添加反向 shell 或其他恶意功能。考虑到代码简洁，功能单一，判定脚本投毒可能性为10%。

**利用方式总结：**

1.  **漏洞触发：** 攻击者发送特制的 HTTP 请求到受影响的 PAN-OS 设备的 GlobalProtect 接口。该请求包含恶意的 SESSID Cookie，利用目录遍历和任意文件创建漏洞。
2.  **命令注入：** 通过创建的文件执行操作系统命令。
3.  **权限提升：** 由于 GlobalProtect 组件以 root 权限运行，攻击者可以获得 root 权限。
4.  **最终影响：** 攻击者可以完全控制受影响的防火墙，包括读取敏感信息、修改配置、安装恶意软件等。

**缓解措施：**

*   立即升级到已修复的 PAN-OS 版本。
*   应用威胁防御签名 (Threat IDs 95187, 95189, and 95191)。
*   将漏洞保护应用于 GlobalProtect 接口。

**项目地址:** [retkoussa/CVE-2024-3400](https://github.com/retkoussa/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)