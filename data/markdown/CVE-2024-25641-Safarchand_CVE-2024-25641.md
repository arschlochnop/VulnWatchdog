## CVE-2024-25641-Cacti-RCE

**漏洞编号:** CVE-2024-25641

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Cacti

**危害等级:** 高危，可能导致完全控制目标系统

**影响版本:** < 1.2.27

**利用条件:** 需要Cacti的管理权限（Import Templates）和网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-25641是Cacti中存在的一个远程代码执行漏洞。该漏洞位于`/lib/import.php`脚本中的`import_package()`函数中。具有“Import Templates”权限的已认证用户可以通过“Package Import”功能，利用此漏洞在web服务器上执行任意PHP代码。漏洞的根本原因是`import_package()`函数未对XML数据中提供的文件名和文件内容进行充分验证，允许攻击者写入任意文件，包括位于Cacti基础路径之外的文件。利用方式如下：

1.  **身份验证：** 使用具有“Import Templates”权限的账户登录Cacti。
2.  **构造恶意软件包：** 创建一个包含恶意PHP代码的文件，并将其压缩成.xml.gz格式的软件包（例如test.xml.gz）。恶意文件中包含webshell，或者可以执行系统命令的PHP代码。
3.  **上传恶意软件包：** 通过Cacti的“Package Import”功能上传构造的恶意软件包。
4.  **触发漏洞：** Cacti在处理软件包时，由于未对文件名和文件内容进行充分验证，会将恶意PHP文件写入服务器，通常写入到web可访问的目录。上传的webshell文件被执行导致RCE。
5.  **反弹shell：** POC中的exploit.py脚本可以自动完成上述步骤，并尝试通过上传webshell的方式获取反弹shell。攻击者需要指定目标Cacti的URL、用户名、密码、本地IP和监听端口。

**关于投毒风险的评估：**
尽管POC代码的主要目的是利用该漏洞，但仍需注意潜在的投毒风险。分析代码后，发现该脚本主要功能是自动化漏洞利用流程，没有明显的恶意代码。然而，用户在使用该脚本时，应仔细检查test.xml.gz的内容，确保其是安全的。此外，使用未经授权的IP地址和端口进行反弹shell可能构成安全风险。 总体估计投毒风险为10%。

**项目地址:** [Safarchand/CVE-2024-25641](https://github.com/Safarchand/CVE-2024-25641)

**漏洞详情:** [CVE-2024-25641](https://nvd.nist.gov/vuln/detail/CVE-2024-25641)