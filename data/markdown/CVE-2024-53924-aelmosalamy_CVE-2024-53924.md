## CVE-2024-53924-Pycel-代码执行

**漏洞编号:** CVE-2024-53924

**漏洞类型:** 代码执行

**影响应用:** Pycel

**危害等级:** 高危，允许远程代码执行

**影响版本:** <= 1.0b30

**利用条件:** 需要目标系统安装Pycel，且能处理恶意Excel文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-53924 存在于 Pycel 1.0b30 及更早版本中。当 Pycel 处理不可信的 Excel 文件时，攻击者可以通过在单元格中构造恶意公式（例如以 `=IF(A1=200, eval("__import__('os').system('calc.exe')")` 开头的公式）来执行任意代码。Pycel在处理 `eval` 函数时缺乏足够的验证，导致恶意代码得以执行。PoC代码创建包含恶意公式的 Excel 文件，然后使用 `ExcelCompiler` 加载并计算单元格的值，触发代码执行。

**有效性:**  PoC代码显示了漏洞利用方法，表明该漏洞是有效的。

**投毒风险：**  PoC 代码本身主要展示了如何利用该漏洞，并没有发现明显的恶意投毒代码。风险评估为5%。这个风险评估主要基于以下考虑：
    *  `README.md` 文件中包含漏洞描述和复现步骤，没有发现异常。
    *  `poc.py` 文件清晰地展示了漏洞利用过程，主要功能是加载 Excel 文件，设置单元格的值并触发公式计算。
    *  虽然代码中使用 `__import__('os').system()` 执行系统命令，但这是漏洞利用本身的一部分，而非恶意添加的代码。
    *   细微投毒风险在于：代码的依赖项 (`requirements.txt`) 没有提供，可能会引入一些不可信的第三方库. 评估较低是因为至少代码本身是可读的，方便复查。

**利用方式：**
1.  攻击者创建一个包含恶意公式的 Excel 文件。这些公式利用了 `eval` 函数的特性来执行 Python 代码。
2.  受害者使用 Pycel 打开并处理该 Excel 文件。
3.  当 Pycel 计算包含恶意公式的单元格时，`eval` 函数内的 Python 代码被执行，从而导致任意代码执行。

**项目地址:** [aelmosalamy/CVE-2024-53924](https://github.com/aelmosalamy/CVE-2024-53924)

**漏洞详情:** [CVE-2024-53924](https://nvd.nist.gov/vuln/detail/CVE-2024-53924)