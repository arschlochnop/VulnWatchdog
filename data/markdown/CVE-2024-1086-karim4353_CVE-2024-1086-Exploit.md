## CVE-2024-1086 Linux Kernel nf_tables Use-After-Free 本地提权漏洞

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升至root

**影响版本:** 3.15 <= Kernel Version < 6.8

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 netfilter: nf_tables 组件中的一个use-after-free漏洞，攻击者可以利用此漏洞实现本地权限提升。漏洞存在于`nft_verdict_init()`函数中，该函数允许正值作为hook判决中的drop error。因此，当`NF_DROP`与类似于`NF_ACCEPT`的drop error一起发出时，`nf_hook_slow()`函数可能导致double free漏洞。

**有效性:**
根据搜索引擎结果，该漏洞已经被公开披露，并且存在公开的PoC（概念验证）代码。CISA KEV 目录中也包含了此漏洞，表明它正在被积极利用。因此，可以判断该漏洞是有效的。

**投毒风险:**
提供的“漏洞利用代码”实际上是一个项目模板，而非直接可用的exploit。该项目鼓励安全研究，但明确声明不接受恶意代码，只允许在受控环境下进行测试。然而，依然存在投毒风险的可能性，比如在提交的代码中，不明显地加入恶意payload，或者通过复杂的逻辑绕过检查。风险评估为10%，主要基于以下几点：
*   项目声明的非恶意性质，提高了投毒的道德风险。
*   代码贡献需要经过审核，增加了投毒的难度。
*   贡献者可能通过混淆代码或利用项目框架的复杂性来隐藏恶意代码。

**利用方式:**
1.  **漏洞点：** `nft_verdict_init()` 函数允许不正确的drop error值。
2.  **触发条件：** 当 `NF_DROP` 与一个特殊的、类似于 `NF_ACCEPT` 的 drop error 一起使用时。
3.  **漏洞结果：** 在 `nf_hook_slow()` 函数中触发 double free。
4.  **利用步骤：** 攻击者需要构造特定的 nf_tables 规则，触发漏洞，然后利用 double free 漏洞来控制内存，最终实现权限提升。PoC 需要创建精心构造的 nf_tables 规则来触发 UAF，然后分配释放的内存来覆盖内核数据结构，从而获得 root 权限。实际利用可能涉及复杂的内存布局和堆喷射技术。

该漏洞的成功利用需要对 Linux 内核网络子系统和内存管理机制有深入的理解。

**项目地址:** [karim4353/CVE-2024-1086-Exploit](https://github.com/karim4353/CVE-2024-1086-Exploit)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)