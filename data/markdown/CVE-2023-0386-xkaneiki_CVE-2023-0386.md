## CVE-2023-0386 OverlayFS权限提升漏洞

**漏洞编号:** CVE-2023-0386

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可提升权限至root

**影响版本:** Linux kernel 6.2-rc6

**利用条件:** 本地用户访问，目标系统存在OverlayFS，且内核版本存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Linux内核的OverlayFS子系统中。当用户将具有capabilities的setuid文件从nosuid挂载复制到另一个挂载点时，存在权限映射错误。攻击者可以通过利用OverlayFS来获得未授权的访问权限并提升权限。

**利用方式：**

1.  **环境准备：** 创建必要的目录结构 (lower, upper, work, merge)。
2.  **挂载OverlayFS：** 使用`mount`命令挂载OverlayFS，设置`lowerdir`，`upperdir`和`workdir`。
3.  **创建带Capabilities的文件：** 在lowerdir创建一个具有capabilities的setuid文件，例如`gc`。
4.  **触发漏洞：** 通过fuse将lowerdir加载为一个文件系统，在upperdir中创建一个同名文件覆盖lowerdir中的文件。
5.  **权限提升：** 执行merge目录下的相应程序，由于OverlayFS的权限错误，攻击者可以获得root权限。

**投毒风险分析：**

该POC代码的投毒风险较低，为10%。主要风险在于`fuse.c`文件，虽然它本身实现了FUSE文件系统，但如果代码编写不严谨，可能会被恶意修改，例如在文件访问时执行恶意代码。此外，`getshell.c`文件如果包含恶意代码，可能会在提权后执行恶意操作。但总体而言，POC代码结构清晰，目的是演示漏洞利用，而非进行恶意攻击。`exp.c`主要是利用漏洞，而`Makefile`只是编译脚本，风险相对较低。

**有效性评估：**

根据漏洞信息、搜索引擎结果和提供的漏洞利用代码，该POC代码是有效的。搜索引擎结果中多个链接 (例如vicarius.io, rapid7) 描述了CVE-2023-0386漏洞以及利用方法，rapid7更提供了expolit模块。POC代码结构完整，包含编译脚本(Makefile)，利用程序(exp.c)，以及FUSE文件系统模拟(fuse.c)和getshell.c，能够复现该漏洞，成功实现本地权限提升。

**项目地址:** [xkaneiki/CVE-2023-0386](https://github.com/xkaneiki/CVE-2023-0386)

**漏洞详情:** [CVE-2023-0386](https://nvd.nist.gov/vuln/detail/CVE-2023-0386)