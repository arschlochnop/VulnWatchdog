## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问 ActiveMQ 服务的 OpenWire 端口 (默认 61616)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议编组器中的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或代理（取决于哪个容易受到攻击）实例化类路径上的任何类，从而利用此漏洞在基于 Java 的 OpenWire 代理或客户端上执行任意 shell 命令。

**有效性：**
根据漏洞描述和提供的漏洞利用代码，该 POC 代码有效。该漏洞利用代码通过构造包含恶意类路径的 OpenWire 消息，利用 Spring 的 ClassPathXmlApplicationContext 来执行任意代码。漏洞信息和搜索引擎结果表明该漏洞已被广泛利用。

**投毒风险：**
分析提供的 Python 漏洞利用代码 (`exploit.py`) 和 XML 配置文件 (`poc.xml`)，没有发现明显的投毒代码。该代码主要用于构造恶意 OpenWire 消息并将其发送到 ActiveMQ 服务器。XML 文件用于定义 Spring Bean，并利用 `java.lang.ProcessBuilder` 执行命令。因此，投毒风险较低，为 0%。

**利用方式：**
1.  **确定目标：** 确定运行易受攻击的 Apache ActiveMQ 实例的目标服务器和端口（默认为 61616）。
2.  **构造恶意 XML：** 创建一个恶意 XML 配置文件 (如 `poc.xml`)，该文件包含用于执行任意代码的 Spring Bean 定义。常见的做法是使用 `java.lang.ProcessBuilder` 类执行操作系统命令。
3.  **创建 OpenWire 消息：** 使用漏洞利用脚本 (`exploit.py`)，该脚本将恶意 XML 配置文件嵌入到特制的 OpenWire 消息中。该脚本使用类名 `org.springframework.context.support.ClassPathXmlApplicationContext` 来触发反序列化。
4.  **发送消息：** 将构造的 OpenWire 消息发送到目标 ActiveMQ 服务器。
5.  **代码执行：** ActiveMQ 服务器在反序列化 OpenWire 消息时会实例化恶意 Spring Bean，从而导致执行任意代码。 在提供的 `poc.xml` 示例中，它会尝试启动`gnome-calculator`命令。

**搜索引擎信息优先级：**
根据搜索引擎结果，CVE-2023-46604 漏洞被广泛利用，并已被用于传播恶意软件（如 Kinsing）和勒索软件。这表明该漏洞是一个严重的安全风险，需要立即修复。

**项目地址:** [dcm2406/CVE-2023-46604](https://github.com/dcm2406/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)