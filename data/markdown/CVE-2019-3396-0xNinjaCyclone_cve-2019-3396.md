## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (Server-Side Template Injection)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** before 6.6.12, from 6.7.0 before 6.12.3, from 6.13.0 before 6.13.3, and from 6.14.0 before 6.14.2

**利用条件:** 目标Confluence服务器存在Widget Connector宏，且未进行身份验证即可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞存在于 Atlassian Confluence Server 的 Widget Connector 宏中。攻击者可以通过构造恶意的请求，利用服务器端模板注入漏洞执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。漏洞库信息和搜索结果都表明该漏洞已经被广泛利用，并且有可用的POC代码。POC代码通过构造包含恶意Velocity模板的请求，发送到 Confluence 服务器的 `/rest/tinymce/1/macro/preview` 接口，从而触发模板注入。

**投毒风险：**
代码主要功能是利用Velocity模板注入执行命令。其中使用了一个FTP服务器来托管payload，这是一种常见的绕过防火墙或上传限制的方法。该ruby脚本代码的主要功能是利用该漏洞，未发现明显的恶意代码或后门，但是代码中存在远程下载payload的行为，如果payload被替换，则存在一定的风险, 评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要找到存在漏洞的Confluence服务器。
2.  攻击者需要搭建一个FTP服务器，用于托管恶意Velocity模板。
3.  攻击者构造一个包含恶意Velocity模板的HTTP POST请求，发送到Confluence服务器的`/rest/tinymce/1/macro/preview`接口。该请求利用了 Widget Connector 宏的模板注入漏洞。
4.  Confluence服务器解析恶意Velocity模板，执行攻击者指定的命令，从而实现远程代码执行。

**综上所述，该漏洞的利用有效性高，存在一定的投毒风险。攻击者可以利用该漏洞在Confluence服务器上执行任意代码。**

**项目地址:** [0xNinjaCyclone/cve-2019-3396](https://github.com/0xNinjaCyclone/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)