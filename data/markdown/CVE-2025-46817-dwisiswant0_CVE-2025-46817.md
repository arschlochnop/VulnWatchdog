## CVE-2025-46817-Redis-Lua整数溢出

**漏洞编号:** CVE-2025-46817

**漏洞类型:** 整数溢出

**影响应用:** Redis

**危害等级:** 高危，可能导致拒绝服务或远程代码执行

**影响版本:** <= 8.2.1

**利用条件:** 需要Redis Lua脚本功能启用，并且具有执行Lua脚本的权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-46817 漏洞存在于 Redis 8.2.1 及更早版本的 Lua 脚本功能中。该漏洞是由于 Lua 的 `unpack` 函数在处理起始和结束索引时，使用了带符号整数进行计算，当精心构造的起始和结束索引导致计算结果溢出时，会绕过堆栈检查，进而导致 Redis 尝试分配大量的内存，最终导致服务器崩溃或拒绝服务，严重的可能会造成远程代码执行。

**有效性分析：**
提供的 POC 代码 `CVE-2025-46817.lua` 旨在触发 Lua 的 `unpack` 函数中的整数溢出。它使用负数和正数边界值作为 `unpack` 函数的参数，这些值经过计算后会溢出有符号整数，从而绕过堆栈大小检查。 根据 README.md 描述和漏洞信息，在 Redis 8.2.1 上执行此脚本会导致服务器挂起、内存耗尽或崩溃。 在 Redis 8.2.2 及更高版本上，由于进行了修复，脚本会被拒绝执行，并提示“ERR Error running script (too many results to unpack)”。 因此，提供的 POC 代码是有效的。

**投毒风险分析：**
检查了提供的 POC 代码 `CVE-2025-46817.lua` 和 `README.md` 文件，没有发现任何隐藏的、恶意的或非预期的代码。 POC 代码的功能明确且与漏洞描述一致，旨在触发整数溢出。 `README.md` 文件也只包含漏洞的描述，环境要求，使用方法和预期结果，不存在任何可疑内容。 因此，该仓库中存在作者隐藏的投毒代码的风险为 0%。

**利用方式：**
1.  **前提条件：** 目标 Redis 服务器版本为 8.2.1 或更早，且启用了 Lua 脚本功能。 攻击者需要具有 Redis 的认证权限，并能执行 Lua 脚本。
2.  **利用步骤：** 使用 `redis-cli` 工具，通过 `--eval` 参数执行 `CVE-2025-46817.lua` 脚本。 例如：`redis-cli -h <redis_host> -p <redis_port> -a <password> --eval CVE-2025-46817.lua`
3.  **预期结果：** 如果目标服务器存在漏洞，执行脚本后会导致 Redis 服务器崩溃、挂起或消耗大量内存。 如果服务器已修复，则会报错，提示结果过多无法解包。

**缓解措施：**
升级到 Redis 8.2.2 或更高版本，此版本已经修复了 `luaB_unpack` 和 `luaH_getnum` 函数，可以有效防御此漏洞。 或者，禁用不受信任用户的 Lua 脚本功能。

**项目地址:** [dwisiswant0/CVE-2025-46817](https://github.com/dwisiswant0/CVE-2025-46817)

**漏洞详情:** [CVE-2025-46817](https://nvd.nist.gov/vuln/detail/CVE-2025-46817)