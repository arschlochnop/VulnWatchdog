## CVE-2021-1675 PrintNightmare 远程代码执行漏洞

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致系统权限被获取

**影响版本:** 受影响的Windows版本及版本号见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要拥有网络访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞影响多个Windows版本。利用方式主要通过`hRpcAddPrinterDriverEx`函数，向Print Spooler服务添加恶意驱动程序，从而以SYSTEM权限执行任意代码。 

**有效性：**
提供的POC代码尝试通过以下步骤利用此漏洞：
1.  连接到目标系统的Print Spooler服务。
2.  枚举驱动程序，寻找包含“filerepository”的驱动。
3.  构造恶意的DRIVER_CONTAINER，指定恶意的pDriverPath和pDataFile（共享路径）。
4.  调用`hRpcAddPrinterDriverEx`添加驱动，尝试利用漏洞。
5.  尝试不同的ConfigFile路径，进一步利用漏洞。
从搜索结果和漏洞库信息来看，该漏洞的POC是有效的，并且在野利用已经发生。

**投毒风险：**
POC代码中存在一定投毒风险，可能性约为10%。
*   **代码可读性：** 代码结构清晰，易于理解和审查。
*   **潜在风险：** 代码中涉及文件操作和网络连接，如果被篡改，可能包含恶意payload或后门。
*   **不确定性：** 无法完全排除作者在代码中隐藏恶意行为的可能性，例如，在异常处理部分或不常用的代码路径中插入恶意代码。

**利用方式：**
1.  **攻击者准备：** 攻击者需要准备一个恶意的DLL文件，并将其放置在可以通过SMB协议访问的共享目录中。
2.  **连接目标：**  使用提供的POC代码，攻击者首先需要通过NetBIOS或SMB协议连接到目标Windows系统的Print Spooler服务。
3.  **利用漏洞：**  攻击者使用`hRpcAddPrinterDriverEx`函数，尝试在目标系统上安装恶意驱动程序。POC代码通过精心构造的`DRIVER_CONTAINER`结构，将恶意DLL文件的路径传递给Print Spooler服务。
4.  **代码执行：** 当Print Spooler服务尝试加载并执行攻击者提供的恶意DLL文件时，攻击者就可以在目标系统上以SYSTEM权限执行任意代码。

**项目地址:** [cube0x0/CVE-2021-1675](https://github.com/cube0x0/CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)