## CVE-2023-27350-PaperCut-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2023-27350

**漏洞类型:** 身份验证绕过 + 远程代码执行

**影响应用:** PaperCut NG/MF

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 22.0.5 (Build 63914)

**利用条件:** 目标系统运行受影响版本的PaperCut NG/MF，且攻击者可以网络访问该系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27350 是 PaperCut NG/MF 中的一个身份验证绕过漏洞。攻击者可以通过向 `/app?service=page/SetupCompleted` 发送特制请求来绕过身份验证。

**利用方式：**

1.  **身份验证绕过：** 未经身份验证的攻击者访问 `/app?service=page/SetupCompleted` 页面，利用不正确的访问控制绕过身份验证。
2.  **获取 Session ID:** 利用绕过的身份验证，通过构造特定的 POST 请求（例如，向 `/app` 发送带有`service=direct/1/SetupCompleted/$Form`的请求）获取有效的 JSESSIONID。
3.  **配置修改：** 使用获得的 JSESSIONID，通过发送 POST 请求到 `/app` 修改 PaperCut 的配置。关键配置包括：
    *   `print-and-device.script.enabled` 设置为 `Y` （启用打印脚本）。
    *   `print.script.sandboxed` 设置为 `N` （禁用脚本沙箱）。
4.  **远程代码执行：** 通过设置打印机脚本来执行任意代码。利用`PrinterDetails/$PrinterDetailsScript.$Form`，将恶意代码注入到`scriptBody`中。该脚本会在打印作业时执行，允许攻击者在系统上执行命令。

**有效性：**

提供的 POC 代码看起来是有效的。它包含以下步骤：

1.  **漏洞检测:**  脚本首先尝试通过访问 `/app?service=page/SetupCompleted` 页面来检测目标是否易受攻击。
2.  **会话获取:** 尝试获取有效的 JSESSIONID。
3.  **配置更改:**  修改 `print-and-device.script.enabled` 和 `print.script.sandboxed` 设置。
4.  **命令执行:** 通过打印机脚本注入恶意命令。

根据搜索引擎结果，此漏洞已被积极利用，并且有公开可用的 POC。

**投毒风险分析：**

虽然 POC 主要功能是利用漏洞，但仔细检查发现以下潜在风险：

*   **硬编码的 IP 地址和端口：**POC 中包含一个硬编码的 IP 地址 `10.0.40.83:8081` 在 `execute` 方法中。这可能允许攻击者将受害者信息发送到攻击者控制的服务器。虽然表面上看起来像是用于回调 `whoami` 命令的结果，但恶意攻击者可以修改POC, 也可将其用于收集敏感信息。
*   **Reverse Shell Payload 的修改:** 虽然代码看起来是要设置反向shell, 可以通过修改,将反向shell地址写死,用于恶意用途

因此, 有潜在的投毒风险。由于脚本的行为主要还是漏洞利用,且硬编码的IP地址容易被发现,所以认为投毒风险为**10%**。

**项目地址:** [adhikara13/CVE-2023-27350](https://github.com/adhikara13/CVE-2023-27350)

**漏洞详情:** [CVE-2023-27350](https://nvd.nist.gov/vuln/detail/CVE-2023-27350)