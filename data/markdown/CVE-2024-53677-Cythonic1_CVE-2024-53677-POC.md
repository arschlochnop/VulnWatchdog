## CVE-2024-53677-Apache Struts 文件上传路径遍历导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传漏洞,路径遍历,远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行和服务器控制

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 目标系统使用Apache Struts，且启用了基于FileuploadInterceptor的旧文件上传逻辑

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677 是 Apache Struts 中的一个文件上传漏洞，攻击者可以通过操纵文件上传参数来利用路径遍历，在某些情况下，这可能导致上传恶意文件，进而执行远程代码。

**有效性:**
提供的POC代码看起来是有效的，因为它实现了利用路径遍历上传文件，并尝试执行命令。搜索引擎结果也表明该漏洞可以实现RCE。

**投毒风险:**
虽然POC代码本身似乎是合法的漏洞利用程序，但仍然存在一些小的投毒风险。
*   **依赖风险:** `go.mod` 文件声明了 `go 1.25.0` 的依赖，虽然是常见的版本，但开发者需要自行安装Go环境。如果恶意作者指定了一个不存在或者包含恶意代码的go版本，则存在投毒风险。
*   **第三方库风险:** 代码中没有明确使用第三方库，降低了引入恶意依赖的风险，但仍需谨慎。
*   **执行任意命令风险:**  POC允许指定执行任意命令 `-command`，如果用户不小心执行了恶意命令，可能导致系统受损。
考虑到这些因素，POC代码的投毒风险较低，大约为10%。

**利用方式:**
1.  攻击者首先需要确定目标系统运行着受影响版本的 Apache Struts，并且使用了基于 `FileuploadInterceptor` 的文件上传机制。
2.  攻击者构造一个恶意的文件上传请求，其中包含经过精心设计的 `top.UploadFileName` 参数，该参数包含路径遍历字符 (例如 `../`)，用于指定文件上传的目标位置。
3.  攻击者上传一个包含恶意代码的文件 (例如 JSP shell)。
4.  攻击者通过访问上传的恶意文件来执行其中的代码，从而获得对目标系统的远程控制。
提供的 POC 代码通过以下步骤自动化了这些过程：
    *   **测试路径:**  POC首先尝试通过路径遍历上传一个测试文件，以确定正确的上传路径。
    *   **上传 Payload:**  POC 然后使用确定的路径上传恶意 Payload (默认 `shell.jsp`)。
    *   **执行命令:**  POC 尝试访问上传的 Payload，从而在服务器上执行命令 (默认 `whoami`)。

总的来说，该漏洞的利用需要一定的技术水平，但通过POC代码可以大大降低利用难度。 为了减轻 CVE-2024-53677 的风险，建议用户升级到 Apache Struts 6.4.0 或更高版本，并迁移到新的文件上传机制。

**项目地址:** [Cythonic1/CVE-2024-53677-POC](https://github.com/Cythonic1/CVE-2024-53677-POC)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)