## CVE-2022-1386 - Fusion Builder Unauthenticated SSRF

**漏洞编号:** CVE-2022-1386

**漏洞类型:** Server-Side Request Forgery (SSRF)

**影响应用:** Fusion Builder WordPress plugin (Avada theme)

**危害等级:** 高危，可能导致内部网络信息泄露、内部服务攻击、绕过防火墙等

**影响版本:** < 3.6.2

**利用条件:** 目标网站使用存在漏洞的Fusion Builder插件版本，且允许未授权访问wp-admin/admin-ajax.php

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-1386 是 Fusion Builder WordPress 插件中存在的一个未经身份验证的服务器端请求伪造 (SSRF) 漏洞。攻击者可以利用此漏洞向服务器发起任意 HTTP 请求，并将返回的数据反映在应用程序的响应中。这可以用于与服务器本地网络上的主机进行交互，绕过防火墙和访问控制措施。

**有效性：**

根据漏洞描述、搜索结果和提供的 POC 代码，此漏洞利用是有效的。POC 代码通过构造特定的 POST 请求到 `/wp-admin/admin-ajax.php` 并利用 `fusion_form_submit_form_to_url` action 和 `fusionAction` 参数注入恶意 URL，实现了 SSRF。

**投毒风险：**

POC 代码的主要功能是利用 SSRF 漏洞。潜在的投毒风险较低，约为 5%。风险点在于：

*   **`test_url`变量:**  POC 中定义了一个 `test_url = "https://pastebin.com/raw/XNBxNyaU"`，虽然当前代码中并没有直接使用这个 URL，但攻击者可能修改代码，在利用过程中尝试从该 URL 下载并执行恶意代码。但如果不是本人运行此poc,可以忽略。
*   **输出保存：** POC将Fusion ID 保存到本地文件中，如果攻击者获得服务器权限可以修改保存的内容。
*   **依赖库风险:** 使用了 `requests` 和 `BeautifulSoup` 库，需要确保这些库本身没有安全漏洞。

**利用方式：**

1.  **获取 Fusion ID：** POC 首先尝试从本地文件加载 Fusion ID。如果不存在，它会发送一个 POST 请求到 `/wp-admin/admin-ajax.php`，使用 `action=fusion_form_update_view` 来获取 `fusion-form-nonce-0` 的值，该值被用作 Fusion ID，并保存在本地文件中。
2.  **构造恶意请求：** POC 使用 `encode_multipart_form_data` 函数构造一个 `multipart/form-data` 请求，其中包含以下关键参数：
    *   `fusionAction`: 这是包含恶意 URL 的参数，攻击者可以将目标 URL 设置为内部服务地址、外部恶意服务器等。
    *   `fusionActionMethod`: 设置为 `GET`，指定使用 GET 方法发起请求。
3.  **发送请求：** POC 将构造好的请求发送到 `/wp-admin/admin-ajax.php`，并尝试解析响应的 JSON 数据。如果响应不是有效的 JSON，则返回一个表示失败的字典。

通过修改 `fusionAction` 参数，攻击者可以控制服务器发起任意 HTTP 请求，从而实现 SSRF 攻击。

**项目地址:** [ardzz/CVE-2022-1386](https://github.com/ardzz/CVE-2022-1386)

**漏洞详情:** [CVE-2022-1386](https://nvd.nist.gov/vuln/detail/CVE-2022-1386)