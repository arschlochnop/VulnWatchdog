## CVE-2015-10141 - Xdebug Remote Debugger Unauthenticated OS Command Execution

**漏洞编号:** CVE-2015-10141

**漏洞类型:** OS Command Injection

**影响应用:** Xdebug

**危害等级:** 高危，允许未授权用户执行任意系统命令，完全控制服务器。

**影响版本:** <= 2.5.5

**利用条件:** Xdebug 启用远程调试，监听 9000 端口，且未配置身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 Xdebug 的远程调试接口中。由于 Xdebug 在 2.5.5 及更早版本中，远程调试功能存在缺陷，开启后监听 9000 端口，并且没有进行任何身份验证。攻击者可以通过发送特制的 eval 命令，注入并执行任意 PHP 代码，进而利用 `system()` 或 `passthru()` 等函数执行系统命令，从而完全控制目标服务器。\n\n**漏洞利用方式：**\n1.  攻击者首先需要确定目标服务器运行着存在漏洞的 Xdebug 版本，并且开启了远程调试功能，监听在默认的 9000 端口。\n2.  攻击者发送包含恶意 PHP 代码的 `eval` 命令到 9000 端口。该 PHP 代码通常会调用系统命令执行函数，例如 `system()` 或 `passthru()`，从而在服务器上执行任意系统命令。\n3.  提供的 Python POC 脚本模拟了攻击过程：\n    *   它首先建立一个 Socket 连接，监听 9000 端口。\n    *   然后，通过发送一个带有 `XDEBUG_SESSION_START` 参数的 HTTP 请求，触发 Xdebug 的远程调试功能。`X-Forwarded-For` header 被设置为攻击者的 IP 地址（lhost），以便 Xdebug 连接到攻击者的 Socket 监听器。\n    *   当 Xdebug 连接到攻击者的 Socket 后，攻击者可以输入需要执行的系统命令。脚本会将命令进行 base64 编码，并封装在 Xdebug 的 `eval` 命令中，发送给目标服务器执行。\n    *   服务器执行命令的结果会被返回，脚本会对结果进行 base64 解码并输出。\n\n**投毒风险分析：**\n分析提供的 POC 代码，发现潜在的投毒风险较低，大概在 10% 左右。主要的风险点可能在于对用户输入命令的处理。代码中使用了 `base64.b64encode` 对用户输入的命令进行编码，但这并不能有效防止命令注入，只是为了符合 Xdebug 的协议要求。\n\n更具体来说：\n\n*   **潜在的风险：**虽然代码本身没有明显的恶意行为，但攻击者在输入命令时，如果使用精心构造的命令，仍然可能绕过一些简单的安全措施。 例如，如果目标系统上存在一些过滤规则，攻击者可以通过编码、转义等方式绕过这些规则。\n*   **概率较低的原因：**此脚本的主要功能是利用已知的 Xdebug 漏洞执行命令，其目的是为了完成漏洞利用的过程。 脚本作者的意图更偏向于复现漏洞，而不是植入后门。 只要用户确保使用的命令是安全的，代码本身引入的风险是可以忽略的。

**项目地址:** [D3Ext/CVE-2015-10141](https://github.com/D3Ext/CVE-2015-10141)

**漏洞详情:** [CVE-2015-10141](https://nvd.nist.gov/vuln/detail/CVE-2015-10141)