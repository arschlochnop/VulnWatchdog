## CVE-2024-40635-containerd-Integer Overflow

**漏洞编号:** CVE-2024-40635

**漏洞类型:** Integer Overflow

**影响应用:** containerd

**危害等级:** 中危，可能导致容器以root权限运行

**影响版本:** < 1.6.38, >= 1.7.0-beta.0, < 1.7.27, >= 2.0.0-beta.0, < 2.0.4

**利用条件:** 需要具有创建和运行容器的高级权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-40635 是 containerd 中的一个整数溢出漏洞。当容器配置的 User 字段的 UID:GID 大于 32 位有符号整数的最大值时，会导致整数溢出，使得容器最终以 root 权限 (UID 0) 运行。提供的 POC 代码通过 docker 库创建并运行一个容器，并设置 `user` 参数为超出 32 位有符号整数范围的值 (2147483648:2147483648)。然后，POC 代码检查容器是否以 root 权限运行，从而验证漏洞是否存在。

**有效性：**
POC 代码是有效的，它通过模拟触发漏洞的场景来验证漏洞的存在。

**投毒风险：**
该 POC 本身旨在验证漏洞，但存在极小的投毒风险（5%）。风险点在于 `vulnerable-image` 的选择。如果攻击者提供了一个表面上用于测试，但实际上包含恶意代码的 `vulnerable-image`，那么运行此 POC 可能会导致恶意代码在容器内执行。因此，务必使用可信的 Docker 镜像进行测试。

**利用方式：**
1.  利用的前提是需要较高的权限（如能够创建和运行容器的权限）。
2.  攻击者构建或使用一个镜像。
3.  攻击者在创建容器时，指定 `user` 参数的 UID 和 GID 大于 2147483647 (2^31 - 1)。
4.  containerd 在处理该 UID/GID 时发生整数溢出，错误地将容器的用户设置为 root (UID 0)。
5.  容器内的进程以 root 权限运行，可能导致提权或绕过安全限制。

**项目地址:** [yen5004/CVE-2024-40635_POC](https://github.com/yen5004/CVE-2024-40635_POC)

**漏洞详情:** [CVE-2024-40635](https://nvd.nist.gov/vuln/detail/CVE-2024-40635)