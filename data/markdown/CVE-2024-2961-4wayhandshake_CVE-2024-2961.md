## CVE-2024-2961-glibc-iconv缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致应用崩溃或覆盖相邻变量

**影响版本:** < 2.40

**利用条件:** 需要使用iconv()函数进行字符集转换，且目标字符集为ISO-2022-CN-EXT

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-2961是glibc库iconv()函数中的一个缓冲区溢出漏洞。该漏洞影响glibc 2.39及更早版本。当使用iconv()函数将字符串转换为ISO-2022-CN-EXT字符集时，可能会发生最多4字节的输出缓冲区溢出。攻击者可以利用此漏洞导致应用程序崩溃或覆盖相邻的变量。根据提供的漏洞利用代码，该POC利用了`wrapwrap`工具来构造特定的PHP过滤器链，该过滤器链会触发`iconv()`函数的漏洞，从而实现任意文件读取。该POC针对WordPress环境，利用其`upload_image_from_url`功能，通过可控的URL参数和构造的过滤器链，读取服务器上的任意文件。 

**有效性：**
根据漏洞描述和提供的利用代码，该漏洞是可利用的。Ambionics网站上的文章 (webpage 4, and links inside CVE details) 以及提供的POC表明此漏洞可以通过精心构造的输入触发。

**投毒风险：**
检查`arbitrary-file-read.py`脚本，未发现明显的恶意代码或后门。代码逻辑清晰，主要功能是构造HTTP请求，利用`wrapwrap`生成的链，发送给目标服务器，并处理响应。脚本的目的是利用漏洞读取文件内容，没有发现任何主动植入后门或执行恶意操作的迹象。代码从`chain.txt`读取filter chain，并将其插入到POST请求中，这部分是与wrapwrap工具协同工作以利用漏洞。检查README.md文件，描述了如何使用POC和wrapwrap工具，没有发现任何可疑之处。因此，投毒风险较低。

**利用方式：**
1.  **目标确认:** 确认目标系统使用受影响的glibc版本（< 2.40）并且存在可以利用的字符集转换点。
2.  **构造Payload:** 使用wrapwrap工具，生成包含特定PHP filter chain的`chain.txt`文件，该filter chain可以触发iconv()函数的缓冲区溢出漏洞，目标是读取任意文件。
3.  **URL构造:** 攻击者需要找到一个接受URL作为参数的接口，例如WordPress的`upload_image_from_url`功能。
4.  **发送请求:** 攻击者将构造的包含恶意filter chain的URL发送给目标服务器。
5.  **触发漏洞:**  服务器的iconv()函数在处理字符集转换时发生缓冲区溢出。
6.  **任意文件读取:**  利用缓冲区溢出漏洞，读取服务器上的任意文件内容。
7.  **移除Prefix/Suffix:** 可以移除读取文件的前缀或后缀，方便查看文件内容。
8.  **结果获取:**  攻击者从服务器的响应中获取读取的文件内容。

此利用方式依赖于目标系统存在特定的字符集转换操作，并且攻击者能够控制输入到iconv()函数的参数。提供的代码专门针对WordPress环境，展示了如何利用其文件上传功能触发漏洞，读取服务器上的敏感文件。

**项目地址:** [4wayhandshake/CVE-2024-2961](https://github.com/4wayhandshake/CVE-2024-2961)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)