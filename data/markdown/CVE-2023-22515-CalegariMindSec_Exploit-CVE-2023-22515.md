## CVE-2023-22515-Atlassian Confluence Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，允许未经身份验证的远程攻击者创建管理员账户并完全控制Confluence实例

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence实例对外开放，且未进行相关修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515是一个存在于Atlassian Confluence Data Center和Server中的严重Broken Access Control漏洞。根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞允许未经身份验证的攻击者通过访问`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`端点，重置Confluence的安装状态，然后通过向`/setup/setupadministrator.action`端点发送包含用户名、密码等信息的POST请求，创建一个新的管理员账户。该漏洞利用的有效性很高，因为公开的POC代码能够成功创建一个新的管理员账户。搜索结果也表明，该漏洞已被广泛利用。

**投毒风险分析：**
该POC代码主要包含一个bash脚本`xpl.sh`和一个说明文件`README.md`。`xpl.sh`脚本的功能是检测目标Confluence实例是否存在漏洞，并利用该漏洞创建一个新的管理员账户。脚本中定义了默认的用户名`a123456`和密码`ChangeMe123`。投毒风险主要体现在以下几个方面：

1.  **默认用户名和密码：** 攻击者可能修改脚本中的默认用户名和密码，诱导用户使用该脚本，从而在目标系统上创建一个攻击者已知的管理员账户。虽然用户可以修改这些值，但并非所有用户都会这样做，这使得攻击者有机会利用默认凭据进行进一步的攻击。
2.  **网络请求的潜在篡改：** 攻击者可能修改脚本中的curl命令，例如，添加额外的请求头或修改请求体，从而在利用漏洞的同时，向攻击者的服务器发送敏感信息或执行其他恶意操作。虽然目前脚本中的curl命令看起来比较简单，但攻击者可以很容易地对其进行修改，以实现更复杂的攻击目的。
3. **脚本本身的安全风险:** 脚本中使用的`curl -k`参数会忽略SSL证书验证，这可能导致中间人攻击。虽然这本身不是投毒，但增加了使用脚本的风险。此外，恶意作者可以在脚本中添加其他恶意代码，例如下载和执行其他恶意文件。

综合考虑以上因素，该POC代码存在一定的投毒风险，大约为10%。

**利用方式：**
1.  攻击者首先需要确定目标Confluence实例的版本是否在受影响的范围内。
2.  攻击者使用POC脚本`xpl.sh`，并提供目标Confluence实例的URL作为参数。
3.  脚本首先通过访问`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`端点来检查目标实例是否存在漏洞。
4.  如果目标实例存在漏洞，脚本将通过向`/setup/setupadministrator.action`端点发送POST请求来创建一个新的管理员账户。
5.  攻击者使用新创建的管理员账户登录Confluence实例，并获得完全控制权限。

**项目地址:** [CalegariMindSec/Exploit-CVE-2023-22515](https://github.com/CalegariMindSec/Exploit-CVE-2023-22515)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)