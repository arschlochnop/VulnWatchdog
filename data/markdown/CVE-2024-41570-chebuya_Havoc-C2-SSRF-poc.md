## CVE-2024-41570-Havoc-C2-SSRF

**漏洞编号:** CVE-2024-41570

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Havoc C2

**危害等级:** 高危，可能导致敏感信息泄露、内网探测、拒绝服务，甚至远程代码执行。

**影响版本:** 0.7

**利用条件:** Havoc C2 teamserver 监听端口对外开放，且目标 Havoc C2 版本为受影响版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-41570 是 Havoc C2 0.7 版本中的一个未经身份验证的服务器端请求伪造 (SSRF) 漏洞。此漏洞存在于 demon callback 处理中，允许攻击者从 teamserver 发送任意网络流量。

**有效性：**
根据漏洞描述和PoC代码，该漏洞利用的有效性较高。PoC 代码通过模拟 demon agent 的注册和心跳，从而在 teamserver 上打开一个 TCP socket，并可以读写数据。这允许攻击者发起 SSRF 攻击。

**投毒风险：**
PoC 代码本身没有明显的投毒代码。但是，任何未经审核的代码都存在潜在的风险。虽然作者提供了修复建议，但修改 teamserver 代码也可能引入新的问题。因此，投毒风险评估为 10%。需要进一步审查代码，以确保其没有恶意行为。

**利用方式：**
1.  **漏洞触发：** 攻击者无需认证，通过构造恶意的 agent 注册和心跳数据包，发送给 Havoc C2 的 teamserver。
2.  **SSRF 利用：** teamserver 错误地处理了这些数据包，导致其打开一个由攻击者指定的 IP 地址和端口的 TCP socket。
3.  **攻击目标：** 通过这个 socket，攻击者可以向 teamserver 发起 SSRF 攻击，例如：
    *   探测内网服务
    *   读取内部文件
    *   攻击内部应用
    *   泄露 teamserver 的源 IP 地址

**缓解措施：**
根据 PoC 中的建议，可以通过修改 `teamserver/pkg/agent/agent.go` 文件并重新编译 teamserver 来修复此漏洞。

**项目地址:** [chebuya/Havoc-C2-SSRF-poc](https://github.com/chebuya/Havoc-C2-SSRF-poc)

**漏洞详情:** [CVE-2024-41570](https://nvd.nist.gov/vuln/detail/CVE-2024-41570)