## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致数据泄露、权限提升和远程代码执行

**影响版本:** <= 6.0.31, <= 6.4.16, <= 7.0.1

**利用条件:** 需要Zabbix前端的非管理员用户账户，且该账户具有API访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42327是Zabbix前端API中CUser类的addRelatedObjects函数存在SQL注入漏洞。攻击者利用具有API访问权限的非管理员用户，通过构造恶意的SQL查询，可能泄露数据库中的敏感信息，例如用户密码哈希和API会话令牌。利用代码`sqliZabbix.py`提供了多种攻击模式：

*   `leak-users`:  提取用户ID、用户名、密码哈希和角色信息。
*   `leak-tokens`: 提取所有活动的会话ID（API令牌）。
*   `rce`: （需要管理员令牌）通过item.create方法执行远程代码，通常用于获取反向shell。这利用了SQL注入来获得管理员权限，然后使用Zabbix的功能来执行命令。
*   `custom`:  允许执行任意SQL查询。

**利用方式分析：**

1.  **认证：** 使用提供的用户名和密码通过Zabbix API进行身份验证。
2.  **SQL注入：**  通过构造恶意的SQL查询注入到`CUser.get` API调用的`addRelatedObjects`函数中。
3.  **数据提取/RCE：** 根据选择的模式，攻击者可以提取敏感信息（例如用户哈希、令牌）或利用获得的权限执行远程代码。

**关于投毒风险分析：**

代码中没有明显的恶意代码或后门。 `sqliZabbix.py` 脚本的目的是利用已知的SQL注入漏洞。 风险在于，使用者如果未经授权地在生产环境中使用该脚本，可能会造成破坏或数据泄露。 脚本本身包含免责声明，指出仅用于教育和授权的渗透测试目的。

**投毒风险百分比：** 10%。风险主要来自于使用者误用或者滥用，而不是代码本身存在恶意功能。

**项目地址:** [874anthony/CVE-2024-42327_Zabbix_SQLi](https://github.com/874anthony/CVE-2024-42327_Zabbix_SQLi)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)