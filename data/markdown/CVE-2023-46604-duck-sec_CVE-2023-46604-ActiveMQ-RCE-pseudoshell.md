## CVE-2023-46604 - Apache ActiveMQ - 远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 严重，可导致远程代码执行，完全控制受影响的系统

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker或Client的OpenWire端口(默认61616)。 目标需要存在于受影响的版本范围内。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 存在于 Apache ActiveMQ 的 OpenWire 协议中，是一个反序列化漏洞。远程攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**利用方式：**

1.  攻击者需要能够通过网络访问 ActiveMQ Broker 或 Client 暴露的 OpenWire 端口（通常是 61616）。
2.  攻击者构造恶意的 XML 文件，其中包含精心设计的序列化数据，该数据能够触发目标系统反序列化操作。
3.  攻击者运行 PoC 脚本，脚本会启动一个简单的 HTTP 服务器，用于托管恶意的 XML 文件，并将包含恶意 XML 文件 URL 的消息发送到 ActiveMQ Broker。当 ActiveMQ Broker 或 Client 尝试反序列化接收到的消息时，就会执行 XML 文件中指定的恶意代码。
4.  漏洞利用代码中通过发送包含恶意类的序列化对象，利用java反序列化漏洞，执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，可以确定该漏洞是有效的。搜索引擎结果表明，CVE-2023-46604 已经被积极利用，并被用于传播 Kinsing 恶意软件和勒索软件。

**投毒风险：**

分析提供的 PoC 代码，该脚本主要功能是生成恶意的 XML 文件，启动 HTTP 服务器，发送包含恶意 XML 文件 URL 的消息，以及接收目标服务器执行命令后的响应。该代码没有发现存在恶意行为，例如植入后门或窃取敏感信息。因此，投毒风险评估为0%。 该脚本依赖于目标系统存在漏洞才能成功执行，而并非自身包含恶意代码。

**项目地址:** [duck-sec/CVE-2023-46604-ActiveMQ-RCE-pseudoshell](https://github.com/duck-sec/CVE-2023-46604-ActiveMQ-RCE-pseudoshell)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)