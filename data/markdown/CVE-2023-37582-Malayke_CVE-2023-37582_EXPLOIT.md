## CVE-2023-37582-Apache RocketMQ-远程命令执行

**漏洞编号:** CVE-2023-37582

**漏洞类型:** 远程命令执行

**影响应用:** Apache RocketMQ NameServer

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 5.0.0 <= version <= 5.1.1; version <= 4.9.6

**利用条件:** NameServer地址泄露到公网且缺乏权限验证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-37582是Apache RocketMQ NameServer组件中的一个远程命令执行漏洞。该漏洞是CVE-2023-33246的不完全修复。当NameServer的地址泄露到公网并且缺乏权限验证时，攻击者可以通过更新配置功能执行任意命令，命令将以RocketMQ运行用户的身份执行。

**有效性：** 提供的POC代码通过修改`configStorePath`配置项，尝试在目标服务器上创建`/tmp/pwned`文件。这验证了利用NameServer的配置更新功能执行命令的能力，虽然该POC只是创建了一个文件，但可以扩展到执行更危险的命令，因此POC有效。

**投毒风险：** 提供的代码中没有明显的投毒代码。代码的主要功能是构造特定的请求包，发送到NameServer，并接收响应。代码逻辑相对清晰，没有发现隐藏的恶意行为。LICENSE文件是Apache 2.0许可，属于常规开源许可协议。因此，投毒风险评估为0%。

**利用方式：** 攻击者首先需要获取目标RocketMQ NameServer的地址。然后，使用POC脚本构造包含恶意配置的请求，通过socket连接发送到NameServer的9876端口。  POC代码中构造了两种请求，分别是`GET_NAMESRV_CONFIG` (319)和`UPDATE_NAMESRV_CONFIG` (318)。`UPDATE_NAMESRV_CONFIG`请求通过修改NameServer的配置，可以用于执行任意命令。该POC通过修改`configStorePath`配置项来触发漏洞，但实际攻击中可以构造更复杂的命令来达到控制服务器的目的。漏洞利用的关键在于NameServer未对配置更新操作进行严格的权限验证。

**项目地址:** [Malayke/CVE-2023-37582_EXPLOIT](https://github.com/Malayke/CVE-2023-37582_EXPLOIT)

**漏洞详情:** [CVE-2023-37582](https://nvd.nist.gov/vuln/detail/CVE-2023-37582)