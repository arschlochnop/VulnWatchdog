## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx + PHP-FPM，配置中包含 `fastcgi_split_path_info` 且未正确配置 `try_files` 或 `if (-f $uri)`。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞是 PHP-FPM 在特定 Nginx 配置下的远程代码执行漏洞。当 Nginx 使用 `fastcgi_split_path_info` 指令分割 URI 时，如果 URI 中包含 \n (%0a) 字符，可能导致 `PATH_INFO` 为空。PHP-FPM 在处理 `PATH_INFO` 为空的情况时存在逻辑缺陷，允许攻击者通过精心构造的请求，覆盖 FCGI 协议数据，进而执行任意代码。

**漏洞利用方式：**

1.  攻击者发送包含 %0a 字符的恶意 HTTP 请求，例如 `index.php%0a`。
2.  Nginx 使用 `fastcgi_split_path_info` 指令分割 URI，导致 `PATH_INFO` 为空。
3.  PHP-FPM 在处理 `PATH_INFO` 为空的情况时，发生缓冲区溢出，覆盖 FCGI 协议数据。
4.  攻击者通过覆盖的 FCGI 数据，可以控制 PHP-FPM 的行为，例如执行系统命令。

**有效性：**

提供的 POC 代码（`phuip-fpizdam`）是有效的。它利用了上述漏洞，可以在满足条件的 Nginx + PHP-FPM 环境中实现远程代码执行。

**投毒风险：**

README.md描述了漏洞原理和修复方法，`./phuip-fpizdam http://192.168.93.131:8080/index.php`命令是正常的漏洞利用方式。内涵两个exp一个是go语言，另一个是编译好的exp，说明作者提供了源码，风险较低。仍然存在一定的投毒风险，因为编译好的二进制文件可能包含未公开的恶意行为。因此，保守估计投毒风险为10%。攻击者可能会在编译好的 exp 中添加后门，例如反弹 shell 或植入恶意代码。用户在使用时，最好自行编译go源码。

**项目地址:** [ianxtianxt/CVE-2019-11043](https://github.com/ianxtianxt/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)