## CVE-2024-2961_buddyforms_2.7.7_RCE

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** glibc (iconv) & Buddyforms 2.7.7

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** glibc <= 2.39 & Buddyforms 2.7.7

**利用条件:** 需要Buddyforms 2.7.7插件存在，且目标系统使用受影响的glibc版本，以及存在可利用的admin-ajax.php接口。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

该漏洞结合了CVE-2024-2961（glibc iconv缓冲区溢出）和CVE-2023–26326 (Buddyforms LFI)。攻击者利用Buddyforms插件的文件包含漏洞读取任意文件，然后利用glibc的iconv函数进行字符集转换时存在的缓冲区溢出漏洞，通过构造恶意的字符序列触发溢出，最终实现远程代码执行。

**有效性：**
根据漏洞描述，搜索引擎结果和提供的POC代码，该POC代码是有效的。POC代码的README描述了如何使用该漏洞，并且提供了相关的技术细节链接和演示图片。代码本身利用了`iconv`函数的漏洞结合Buddyforms插件来实现RCE。

**投毒风险：**
POC代码中主要关注`buddyforms_2.7.7_cnext_exploit.py`。初步分析没有发现明显的恶意代码，例如反弹shell、下载执行恶意程序等。但是，仍然存在一定的投毒风险，主要体现在以下几个方面：
*   **依赖库风险：** `requirements.txt`中可能包含带有恶意代码的依赖库，虽然几率较低，但存在可能性。
*   **Payload定制风险：** POC代码的有效性依赖于特定的payload。攻击者可能通过修改payload来植入后门，例如在执行命令前或后添加恶意操作。尽管此POC的目的是进行漏洞利用演示，但用户可能不经检查直接用于生产环境，从而为攻击者留下可乘之机。
*   **隐蔽的后门函数：** 作者可能在代码中加入看似无害的函数，但在特定条件下触发恶意行为。虽然直接分析没有发现，但不能排除这种可能性。综合考虑，认为存在20%的投毒风险。

**利用方式：**
1.  **文件包含：** 利用Buddyforms插件的漏洞，通过`php://filter`伪协议读取`/proc/self/maps`，泄露内存布局。
2.  **泄露libc地址：** 从内存布局中找到libc的加载地址。
3.  **利用iconv漏洞：** 构造恶意的字符序列，利用`iconv`函数在进行`ISO-2022-CN-EXT`字符集转换时触发缓冲区溢出。
4.  **覆盖返回地址：** 利用缓冲区溢出覆盖函数返回地址，劫持程序控制流。
5.  **执行shellcode：** 将返回地址覆盖为shellcode的地址，执行shellcode，实现远程代码执行。
6.  **反弹Shell/执行命令:** Shellcode通常用于反弹shell或执行任意命令。

总而言之，利用方式比较复杂，需要结合多个漏洞才能完成RCE。

**项目地址:** [suce0155/CVE-2024-2961_buddyforms_2.7.7](https://github.com/suce0155/CVE-2024-2961_buddyforms_2.7.7)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)