## CVE-2024-56145-CraftCMS-RCE

**漏洞编号:** CVE-2024-56145

**漏洞类型:** RCE

**影响应用:** Craft CMS

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 5.5.2 and < 4.13.2 and < 3.9.14

**利用条件:** PHP配置项register_argc_argv需要启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-56145是Craft CMS中的一个远程代码执行漏洞。根据漏洞信息，该漏洞的触发条件是php.ini配置文件中启用了`register_argc_argv`选项。从搜索引擎结果来看，Assetnote的研究团队发现了该漏洞，并发布了相关的分析文章和漏洞利用工具。提供的漏洞利用代码是一个Dockerfile，用于构建包含易受攻击版本的Craft CMS和启用`register_argc_argv`的PHP环境。`build_docker.sh`脚本用于构建和启动Docker容器。漏洞利用方式是利用PHP将命令行参数注入到应用程序中，从而执行恶意代码。因为POC环境中包含FTP服务，并允许匿名用户写入，这存在一定的风险，例如，攻击者可能会利用FTP服务上传恶意文件并执行，从而导致更严重的投毒攻击。

**漏洞利用方式：**

1.  **条件：** 目标Craft CMS服务器的php.ini中启用了`register_argc_argv`。
2.  **攻击：** 攻击者构造包含恶意代码的HTTP请求，该恶意代码会被作为命令行参数传递给PHP脚本。
3.  **执行：** Craft CMS解析请求，由于`register_argc_argv`已启用，恶意代码会作为命令行参数被注册，并最终导致代码执行。

**投毒风险评估：**

虽然提供的代码主要是为了复现漏洞，但存在一定的投毒风险，主要体现在以下几个方面：

1.  **FTP服务：** Dockerfile配置了匿名可写的FTP服务。攻击者可以在环境中上传恶意文件。
2.  **.env文件：** Dockerfile中复制`.env`文件，这可能包含数据库凭据或其他敏感信息，如果这些信息被泄露，可能会导致更严重的攻击。
3.  **Composer依赖：** `composer.json` 文件指定了依赖包的版本，如果攻击者控制了依赖包的源，可能会注入恶意代码。

综合以上因素，虽然该POC的主要目的是验证漏洞，但其中一些配置可能会被恶意利用。因此，我们认为存在10%的投毒风险。

**项目地址:** [hmhlol/craft-cms-RCE-CVE-2024-56145](https://github.com/hmhlol/craft-cms-RCE-CVE-2024-56145)

**漏洞详情:** [CVE-2024-56145](https://nvd.nist.gov/vuln/detail/CVE-2024-56145)