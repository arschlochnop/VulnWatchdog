## CVE-2025-54424 - 1Panel Agent 证书验证绕过导致任意命令执行

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** 1Panel

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 2.0.6

**利用条件:** 需要能够通过网络访问1Panel Agent的端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-54424 是 1Panel Agent 中的一个漏洞，由于对客户端证书的验证不完整，攻击者可以伪造客户端证书绕过身份验证，从而访问 1Panel Agent 的高权限接口。由于 1Panel 中存在大量命令执行接口，因此成功利用此漏洞可实现远程代码执行。 

**有效性:**
提供的 Python 脚本 `CVE-2025-54424.py` 似乎是一个完整的漏洞利用程序。它包含以下关键步骤，这些步骤都与漏洞描述相符：

1.  **证书生成:** 动态生成 CN 为 `panel_client` 的自签名证书和私钥。
2.  **HTTP 预检:** 使用伪造的证书向目标服务器发送 HTTP 请求，验证是否可以绕过证书验证。
3.  **WebSocket 连接:** 尝试使用伪造的证书建立 WebSocket 连接，访问 `api/v2/hosts/terminal` 接口，模拟交互式 Shell。
4.  **交互式 Shell:** 如果 WebSocket 连接成功，则创建接收线程，与目标服务器进行交互，执行命令。

脚本中禁用了 requests 库的 SSL 验证警告，并通过 `ssl_context.check_hostname = False` 和 `ssl_context.verify_mode = ssl.CERT_NONE` 关闭了主机名验证和证书验证，这进一步证实了利用方式。

**投毒风险:**
尽管该 POC 代码看起来主要是用于利用漏洞，但潜在的投毒风险仍然存在。以下是一些潜在的投毒方式以及相应的评估：

*   **后门命令植入:** 在交互式 Shell 的代码中，可能会隐藏执行恶意命令的代码。例如，在 `receive_thread` 函数中，可以修改收到的数据并执行。
*   **代理配置修改:** 虽然脚本中包含代理设置，但是可能存在篡改代理设置以重定向流量到攻击者控制的服务器的风险。
*   **信息收集:** 脚本可能会收集目标服务器的信息（例如操作系统、IP 地址等）并发送给攻击者。

由于代码主要集中在漏洞利用上，且没有明显的恶意行为，因此将投毒风险评估为 10%。但用户在使用前仍然应该仔细审查代码。

**利用方式:**
1.  **生成伪造的客户端证书:** 攻击者使用脚本动态生成一个 CN 为 `panel_client` 的自签名证书和私钥。
2.  **绕过证书验证:**  由于 1Panel Agent 的证书验证存在漏洞，攻击者可以使用伪造的证书通过 HTTPS 和 WSS 连接到 Agent。
3.  **访问高权限接口:**  成功通过身份验证后，攻击者可以访问 1Panel Agent 的高权限接口，例如 `api/v2/hosts/terminal`，获取交互式 Shell。
4.  **执行任意命令:**  利用获得的交互式 Shell，攻击者可以在目标服务器上执行任意命令，从而完全控制服务器。

**项目地址:** [hophtien/CVE-2025-54424](https://github.com/hophtien/CVE-2025-54424)

**漏洞详情:** [CVE-2025-54424](https://nvd.nist.gov/vuln/detail/CVE-2025-54424)