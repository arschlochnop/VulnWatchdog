## CVE-2023-42793-JetBrains TeamCity-RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 2023.05.4

**利用条件:** 需要网络访问TeamCity服务器，且目标版本低于2023.05.4

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-42793 存在于 JetBrains TeamCity 2023.05.4 之前的版本中，是一个身份验证绕过漏洞，可以导致未经身份验证的远程代码执行。攻击者可以利用此漏洞在 TeamCity 服务器上执行任意代码，从而完全控制服务器。漏洞利用方式如下：

1.  **身份验证绕过：** 利用漏洞绕过身份验证。
2.  **启用调试模式：** 通过修改 `internal.properties` 文件启用 `rest.debug.processes.enable`。
3.  **远程代码执行：** 使用 `/app/rest/debug/processes` 接口执行任意命令。脚本通过修改 `internal.properties` 文件，然后使用特制的请求调用 `debug/processes` 接口，从而在目标系统上执行任意命令。

提供的 `TeamCity.sh` 脚本允许用户指定目标操作系统 (Linux 或 Windows)，并相应地调整命令执行方式。脚本首先获取一个token，然后利用该 token 修改`internal.properties`文件以启用调试模式，最后使用构造好的包含恶意命令的URL来触发RCE。

投毒风险评估：代码中主要逻辑为漏洞利用，并未发现明显的恶意代码。`TeamCity.sh` 中选择目标OS后，Linux环境使用了`base64`编码命令，Windows没有。虽然脚本的行为符合漏洞利用的预期，但是如果攻击者对`base64` 编码方式做了手脚，有可能在Linux执行的时候插入恶意命令。`TeamCity2.sh` 脚本对命令进行URL编码，windows只支持powershell, 可以对powershell添加恶意payload. 因此，存在一定的投毒风险，估计在10%左右。

**项目地址:** [SwiftSecur/teamcity-exploit-cve-2023-42793](https://github.com/SwiftSecur/teamcity-exploit-cve-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)