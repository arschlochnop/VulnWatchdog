## CVE-2017-10003

**漏洞编号:** CVE-2017-10003

**漏洞类型:** Solaris权限提升/数据篡改/DoS

**影响应用:** Solaris Operating System

**危害等级:** 中危，可能导致未授权数据修改、读取和部分拒绝服务

**影响版本:** 10

**利用条件:** 需要低权限用户登录到Solaris系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-10003是Oracle Sun Systems Products Suite Solaris组件(Network Services Library子组件)中的一个漏洞。受影响的版本为10。漏洞难以利用，但低权限攻击者登录到Solaris基础设施后，可以利用该漏洞危害Solaris系统。成功利用该漏洞可能导致未经授权的更新、插入或删除Solaris可访问数据的权限，以及未经授权读取Solaris可访问数据的子集，并可能导致Solaris的部分拒绝服务(partial DOS)。

根据提供的漏洞利用代码`sudopwn.c`和`README.md`，该POC主要利用了sudo的某些特性结合inotify机制来尝试进行权限提升。该利用方式的思路是：

1.  **环境准备:** 首先，创建`/dev/shm/_tmp`目录，并分别创建指向`/dev/pts/57`和`/usr/bin/sudo`的符号链接`/dev/shm/_tmp/_tty`和`/dev/shm/_tmp/ 34873 `。
2.  **inotify监控:** 使用inotify监控`/dev/shm/_tmp`目录的`IN_OPEN`和`IN_CLOSE_NOWRITE`事件。
3.  **Fork子进程:**  Fork一个子进程，并将该子进程的调度策略设置为`SCHED_IDLE`，优先级设置为19。
4.  **子进程执行sudo:** 子进程休眠1秒后，使用`execlp`执行`/dev/shm/_tmp/ 34873 `，即sudo，并传递参数`-r unconfined_r /usr/bin/sum --
HELLO
WORLD
`。该命令的目的是使用sudo以`unconfined_r`角色执行`/usr/bin/sum`命令，并传入`HELLO`和`WORLD`作为输入。
5.  **父进程监控和干预:** 父进程将自身的优先级设置为-20，并循环读取inotify事件。当监听到`IN_OPEN`事件时，停止子进程，然后打开一个新的pty，并将`pts_path`设置为`/dev/pts/57`。当监听到`IN_CLOSE_NOWRITE`事件时，停止子进程，删除`/dev/shm/_tmp/_tty`符号链接，并创建一个新的符号链接指向`/etc/motd`。
6.  **利用分析:** 该POC尝试通过竞争条件和符号链接替换的方式，影响sudo的执行行为。具体来说，它尝试在sudo打开`/dev/pts/57`时，通过inotify机制捕获该事件，然后打开一个新的pty，确保sudo使用预期的tty。然后，当sudo关闭`/dev/pts/57`时，替换`/dev/shm/_tmp/_tty`符号链接，使其指向`/etc/motd`，这可能导致sudo读取`/etc/motd`的内容，从而影响其执行结果。通过指定`unconfined_r`角色，结合特殊的命令（`/usr/bin/sum`）和输入，攻击者试图绕过sudo的权限检查，从而执行未授权的操作。

**有效性:** 根据漏洞描述和代码分析，这个POC代码并非直接利用CVE-2017-10003，而是利用了另一个漏洞CVE-2017-1000367, 并且该POC依赖SELinux，并需要用户具有一定的sudo权限才能利用。根据漏洞库信息, CVE-2017-10003的利用难度为“困难”。因此，提供的POC代码可能有效，但利用条件较为苛刻。

**投毒风险:** 该代码存在一定的投毒风险，可能性评估为10%。

*   **可疑的符号链接操作:**  在`/dev/shm`目录下创建和修改符号链接具有一定的风险，如果攻击者能够控制这些符号链接的目标文件，则可能执行任意代码或读取敏感信息。
*   **竞争条件:**  POC中使用了竞争条件，这使得利用的稳定性降低。攻击者可能通过精心构造的恶意代码，提高竞争成功的概率，从而达到不可预期的目的。
*   **对sudo行为的假设:**  POC假设了sudo的特定行为，如果sudo的实现方式发生变化，则POC可能失效。攻击者可能通过修改POC，使其适应新的sudo实现，从而达到攻击目的。

但是,该漏洞利用代码主要集中在利用SELinux和sudo的特性进行权限提升,并未发现明显的后门代码.

**排序优先级:** 根据排序优先级要求,结合搜索引擎结果,代码分析以及漏洞库信息,可知该漏洞存在,但是利用有一定难度,且有较多的依赖环境和配置,POC代码并非直接针对CVE-2017-10003漏洞, 而是针对CVE-2017-1000367漏洞。

**项目地址:** [c0d3z3r0/sudo-CVE-2017-1000367](https://github.com/c0d3z3r0/sudo-CVE-2017-1000367)

**漏洞详情:** [CVE-2017-10003](https://nvd.nist.gov/vuln/detail/CVE-2017-10003)