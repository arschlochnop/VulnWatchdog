## CVE-2023-3824-PHP-phar_dir_read栈缓冲区溢出

**漏洞编号:** CVE-2023-3824

**漏洞类型:** 栈缓冲区溢出

**影响应用:** PHP

**危害等级:** 高危，可能导致内存破坏或远程代码执行（RCE）

**影响版本:** < 8.0.30, < 8.1.22, < 8.2.8

**利用条件:** 需要目标系统运行存在漏洞的PHP版本，并允许上传phar文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-3824是PHP中PHAR扩展的一个栈缓冲区溢出漏洞，由于`phar_dir_read()`函数中缺乏足够的长度检查导致。当PHP加载phar文件并读取PHAR目录条目时，可以通过构造恶意的phar文件触发此漏洞，导致内存损坏或远程代码执行。

**利用方式：**

1.  攻击者创建一个恶意的phar文件，其中包含特制的目录条目，这些条目的长度超出了预期。
2.  攻击者将此phar文件上传到存在漏洞的PHP服务器上，如果服务器允许上传PHAR文件。
3.  攻击者通过触发PHP代码来处理上传的phar文件，例如，使用`new Phar()`函数来实例化该文件。
4.  当PHP尝试读取phar文件的目录条目时，由于长度检查不足，导致栈缓冲区溢出。
5.  攻击者可以利用此溢出来覆盖栈上的数据，从而可能实现远程代码执行。

**POC有效性：**

提供的POC代码利用此漏洞的原理。 Dockerfile设置了易受攻击的环境。 index.php允许上传phar文件，并尝试提取phar文件的内容。 exploit.zip应该包含恶意的phar文件，该文件在提取时会触发漏洞。该README提供了设置docker环境和利用方式的说明，可以通过反向shell获取权限。

**投毒风险：**

提供的代码片段中未发现明显的恶意代码。 index.php 文件目的是接收phar文件，然后提取文件，并没有执行其他恶意行为。`exploit.zip` 文件是被攻击的目标，不应该被定义为投毒代码。

因此，投毒风险评估为0%。

总而言之，此漏洞的利用相对直接，POC代码有效，并且没有明显的投毒风险。攻击者可以使用精心构造的phar文件来利用此漏洞，进而实现远程代码执行。

**项目地址:** [dadosneurais/cve-2023-3824](https://github.com/dadosneurais/cve-2023-3824)

**漏洞详情:** [CVE-2023-3824](https://nvd.nist.gov/vuln/detail/CVE-2023-3824)