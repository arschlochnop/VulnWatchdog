## CVE-2023-42793-JetBrains TeamCity-RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** < 2023.05.4

**利用条件:** 目标TeamCity服务器可从网络访问，需要通过其他途径获取TeamCity Token。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-42793是JetBrains TeamCity中存在的一个身份验证绕过漏洞，允许未经身份验证的攻击者通过HTTP(S)访问TeamCity服务器，并执行远程代码。根据漏洞库信息，CVSS评分为9.8，属于严重级别。搜索引擎结果显示，该漏洞已被多个APT组织利用，包括APT29、北朝鲜的Diamond Sleet和Onyx Sleet以及俄罗斯对外情报局 (SVR)，显示其真实性和危害性。Rapid7的博客文章也详细分析了该漏洞。提供的POC代码的利用方式是：

1.  **获取TeamCity Token:**  `readme.md` 中提到，需要通过其他漏洞或者方式获取TeamCity的Token. 这是利用此POC的前提。
2.  **启用调试模式:** 使用curl命令发送POST请求到`/admin/dataDir.html`，修改`config/internal.properties`文件，启用`rest.debug.processes.enable=true`，从而开启调试模式。这一步通过token进行验证。
3.  **构造反弹shell Payload:**  将反弹shell命令进行URL编码，目标是让受害者主机连接攻击者的Netcat监听器。
4.  **执行远程命令:** 使用curl命令发送POST请求到`/app/rest/debug/processes`，指定`exePath`为`/bin/bash`，`params`为`-c`和URL编码后的反弹shell命令。这个请求同样需要token验证。漏洞利用依赖于已获取的TeamCity token，然后通过启用调试模式执行反弹shell。根据分析，该POC代码没有明显的投毒行为。

**项目地址:** [HusenjanDev/CVE-2023-42793](https://github.com/HusenjanDev/CVE-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)