## CVE-2023-42793-JetBrainsTeamCity-身份验证绕过导致RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，可能导致远程代码执行和完全控制TeamCity服务器

**影响版本:** < 2023.05.4

**利用条件:** 需要能够通过HTTP(S)访问TeamCity服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-42793是JetBrains TeamCity中存在的一个身份验证绕过漏洞，攻击者无需身份验证即可执行远程代码。漏洞利用方式如下：

1.  **有效性：** 漏洞信息和搜索结果表明该漏洞已在野外被积极利用，包括APT组织（如APT29、CozyBear、北朝鲜黑客组织）和俄罗斯情报部门SVR。提供的代码`exploit.py`旨在利用此漏洞创建管理员账户或获取现有用户的token，从而控制TeamCity服务器。根据README.md的描述，还有一个`rce.py`脚本可以执行远程命令，但主脚本`exploit.py`的功能是创建管理员账户。

2.  **投毒风险：** 代码`exploit.py`本身的功能是利用漏洞创建管理员用户或获取token。投毒风险评估如下：
    *   代码中存在一些硬编码，例如默认密码"Password@123"和默认邮箱域名"@lol.omg"，如果直接使用这些默认值，容易被检测和防御。但这不属于投毒，而是简化使用的示例。
    *   代码尝试首先获取或删除现有的token，这增加了攻击成功的概率，但也可能在目标环境中留下痕迹。
    *   总体来看，`exploit.py`的主要风险在于被滥用以非法控制TeamCity服务器，而非恶意代码本身。因此，投毒风险较低，估计为10%。主要是担心引入了额外的请求或命令，用于收集用户信息或执行其他未经授权的操作。

3.  **利用方式：** 利用方式主要分为以下步骤：
    a.  攻击者发送特制的HTTP请求到TeamCity服务器，绕过身份验证。
    b.  使用`exploit.py`脚本，指定目标TeamCity服务器的URL。
    c.  脚本尝试获取或删除现有的token，然后创建一个新的管理员用户，或者获取指定用户的token。
    d.  如果成功创建管理员用户，攻击者可以使用新创建的管理员账户登录TeamCity服务器，并获得完全控制权限。
    e. 通过获取到的token, 攻击者可以模拟用户身份，从而执行相关操作。

该漏洞的严重性在于未经身份验证即可创建管理员帐户并执行任意代码，从而完全控制受影响的TeamCity服务器。缓解措施包括尽快升级到2023.05.4或更高版本。

**项目地址:** [FlojBoj/CVE-2023-42793](https://github.com/FlojBoj/CVE-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)