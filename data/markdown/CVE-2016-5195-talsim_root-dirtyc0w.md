## CVE-2016-5195 - Dirty COW

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** 2.x 至 4.x (before 4.8.3)

**利用条件:** 本地用户权限，目标系统内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

Dirty COW (CVE-2016-5195) 是 Linux 内核中的一个竞争条件漏洞，存在于 mm/gup.c 文件中。该漏洞源于内核在处理写时复制（COW）时存在缺陷，允许本地用户利用此漏洞向只读内存映射写入数据，从而获得特权提升。

**有效性：**

根据漏洞信息和搜索结果，Dirty COW 漏洞的 POC 代码是有效的。 该漏洞已经在野外被利用。该POC代码通过竞争条件利用写时复制的缺陷实现权限提升。

**投毒风险：**

该POC代码的投毒风险较低，约为 10%。 风险点主要在于以下几点：

*   **shellcode来源：** 虽然代码中明确说明 shellcode 由 `msfvenom` 生成，但用户仍然需要自行验证该 shellcode 的安全性，以防被替换为恶意代码。
*   **suid_binary 变量：** 脚本默认修改 `/bin/ping` ，可能在测试环境中影响系统的正常功能， 如果是生产环境可能导致拒绝服务,或者更严重权限提升到其他非授权用户. 这是潜在的风险。

总体来说，POC代码逻辑较为清晰，主要风险在于用户对shellcode和利用目标的验证。

**利用方式：**

该漏洞的利用方式如下：

1.  **备份目标SUID二进制文件：**  利用代码会首先备份要覆盖的SUID程序，默认为`/bin/ping`。
2.  **打开SUID二进制文件：** 使用只读方式打开目标二进制文件
3.  **映射内存：**  将目标SUID二进制文件映射到内存中。
4.  **创建竞争条件：**  创建两个线程。一个线程使用 `madvise` 系统调用触发写时复制（COW）。另一个线程通过 `/proc/self/mem` 写入被映射的内存区域。
5.  **覆盖SUID二进制文件：**  由于竞争条件，写入线程可能会在内存映射仍然被标记为只读时成功写入，从而修改文件内容。
6.  **执行Shellcode：** 监控被修改的二进制文件,一旦确认shellcode成功写入，就停止线程，执行该程序，因为该程序已经被shellcode覆盖，所以会获取root权限。最终导致利用代码可以执行任意命令从而获取root权限，。

**项目地址:** [talsim/root-dirtyc0w](https://github.com/talsim/root-dirtyc0w)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)