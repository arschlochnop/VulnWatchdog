## CVE-2023-38408-OpenSSH-远程代码执行

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh agent forwarding，且连接到攻击者控制的系统

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，是由于 PKCS#11 功能在 ssh-agent 中的搜索路径不够安全导致的远程代码执行漏洞。当开启 ssh agent forwarding 时，攻击者可以控制客户端连接到的服务器，通过在恶意服务器上放置恶意的 PKCS#11 共享库，诱导 ssh-agent 加载执行，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在可利用的公开PoC。

**投毒风险：**
提供的 PoC 代码是一个扫描器，用于检测目标主机上 OpenSSH 的版本是否小于 9.3p2，如果版本小于 9.3p2，则判断为存在漏洞。该代码主要功能是建立socket连接，获取ssh banner并进行正则匹配。虽然不能完全排除投毒的可能，但PoC本身结构简单，主要目的是版本检测，**投毒风险很低，大约为1%**，几乎可以忽略。真正的利用需要构建恶意的 PKCS#11 共享库。

**利用方式：**
1.  攻击者控制一个服务器。
2.  用户通过 SSH 连接到攻击者控制的服务器，并开启了 `ssh agent forwarding`。
3.  攻击者在服务器上放置一个恶意的 PKCS#11 共享库。
4.  当 ssh-agent 尝试加载 PKCS#11 共享库时，由于搜索路径不安全，加载了攻击者放置的恶意共享库，导致代码执行。
5.  攻击者从而可以在用户机器上执行任意代码，控制用户机器。

**项目地址:** [fazilbaig1/cve_2023_38408_scanner](https://github.com/fazilbaig1/cve_2023_38408_scanner)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)