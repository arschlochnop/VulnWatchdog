## CVE-2025-29927-Next.js中间件认证绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 认证绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** Next.js应用使用了中间件进行认证

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-29927是Next.js中间件中存在的一个认证绕过漏洞。攻击者可以通过在请求中添加特定的`x-middleware-subrequest` Header来绕过中间件的认证检查。根据提供的POC代码，该漏洞利用方式有效。POC代码提供了一个简单的Next.js应用示例，展示了如何通过修改请求头来绕过中间件。具体来说，当Next.js应用使用中间件时，`runMiddleware`函数会检索`x-middleware-subrequest` Header的值，并使用冒号(:)作为分隔符将其拆分为一个列表。然后，它会检查该列表是否包含中间件的`name`值。如果攻击者在请求中添加包含正确值的`x-middleware-subrequest` Header，中间件将被完全忽略，请求将通过`NextResponse.next()`转发到原始目的地，而中间件不会产生任何影响。

**有效性：**

根据漏洞信息和POC代码，该漏洞利用有效，可以通过构造特定的请求头绕过中间件的认证。

**投毒风险：**

POC代码本身主要是用于演示漏洞利用方式的示例项目，其包含的文件如`Readme.md`, `eslint.config.mjs`, `next-env.d.ts`, `next.config.js`, `package-lock.json`都属于正常项目文件。 虽然理论上可以往这些文件中插入恶意代码，但从现有的信息来看，未发现明显的投毒迹象。但是需要人工进一步review代码确保没有隐藏的恶意行为，所以投毒风险评定为5%。

**利用方式：**

1.  目标应用必须使用Next.js，且版本在受影响范围内 (>= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3).
2.  目标应用必须使用middleware进行权限校验.
3.  攻击者通过Burp Suite或类似的工具拦截请求。
4.  攻击者添加`x-middleware-subrequest` header，其值设置为包含middleware名称的字符串（通常用冒号分隔）。 例如，如果中间件的名称是`authMiddleware`，则header的值可以是`authMiddleware:otherValue`。
5.  发送修改后的请求，中间件将被绕过，从而访问受保护的资源。

**项目地址:** [Gokul-Krishnan-V-R/cve-2025-29927](https://github.com/Gokul-Krishnan-V-R/cve-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)