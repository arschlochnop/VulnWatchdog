## CVE-2023-22515-Confluence 破损的访问控制

**漏洞编号:** CVE-2023-22515

**漏洞类型:** 破损的访问控制

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可能导致未授权的管理员账户创建和远程代码执行

**影响版本:** 8.0.0 <= version <= 8.0.4
8.1.0 <= version <= 8.1.4
8.2.0 <= version <= 8.2.3
8.3.0 <= version <= 8.3.2
8.4.0 <= version <= 8.4.2
8.5.0 <= version <= 8.5.1

**利用条件:** 目标Confluence实例对外开放，且未完成初始化设置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515 是一个存在于 Atlassian Confluence Data Center 和 Server 中的破损的访问控制漏洞。未经身份验证的攻击者可以利用此漏洞创建未经授权的 Confluence 管理员帐户，从而完全控制受影响的 Confluence 实例。

**漏洞利用方式:**

1.  **检查安装状态:** 通过访问 `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` 接口判断 Confluence 是否已完成安装。如果返回包含 "Confluence" 字符串的页面，则表示可能存在漏洞。
2.  **创建管理员账户:**  通过向 `/setup/setupadministrator.action` 接口发送 POST 请求，并附带包含用户名、密码等信息的 payload 来创建新的管理员账户。请求头中需要包含 `X-Atlassian-Token: no-check`。
3.  **完成设置:** 通过向 `/setup/finishsetup.action` 接口发送 POST 请求，以完成设置过程。

**POC 代码分析:**

提供的 POC 代码 (main.go) 使用 Go 语言编写，实现了以下功能：

*   允许指定目标 Confluence 实例的 URL、用户名和密码。
*   如果未指定用户名和密码，则生成随机的用户名和密码。
*   检查 Confluence 的安装状态。
*   发送 POST 请求以创建管理员账户。
*   发送 POST 请求以完成设置。
*   支持通过代理服务器进行利用。

**投毒风险分析:**

POC 代码本身看起来比较直接，主要是实现漏洞利用，风险较低。但是，依旧存在一定的投毒风险，主要体现在：
* 依赖引入风险：代码中import了一些Go标准库，但如果攻击者修改代码，引入恶意的第三方库，则存在投毒的可能。
* 代码逻辑修改风险：攻击者可能修改代码，添加额外的操作，例如在成功创建管理员账户后，执行一些恶意操作，如上传 webshell 或修改系统配置。

综上，虽然POC代码本身的功能比较明确，但是仍然存在被植入恶意代码的风险，因此给出10%的投毒风险评估。

**项目地址:** [ad-calcium/CVE-2023-22515](https://github.com/ad-calcium/CVE-2023-22515)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)