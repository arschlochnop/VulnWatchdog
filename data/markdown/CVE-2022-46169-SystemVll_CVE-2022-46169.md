## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 1.2.23

**利用条件:** 需要目标系统运行Cacti，并且存在action类型为`POLLER_ACTION_SCRIPT_PHP`的`poller_item`。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-46169 是 Cacti 1.2.23 之前的版本中存在的一个未经身份验证的命令注入漏洞。攻击者可以通过操控HTTP请求头中的`Forwarded-For`字段，绕过身份验证，然后通过`remote_agent.php`文件中的`polldata`操作，并结合一个action类型为`POLLER_ACTION_SCRIPT_PHP`的`poller_item`，将恶意命令注入到`proc_open`函数中执行，从而实现远程代码执行。

**漏洞利用方式:**
1.  **身份验证绕过:** 通过设置`Forwarded-For`等HTTP头，伪造客户端IP地址，绕过`remote_agent.php`的身份验证。
2.  **触发命令注入:**  发送带有恶意`poller_id`参数的请求到`remote_agent.php?action=polldata`，该参数会被插入到`proc_open`函数执行的命令中。
3.  **寻找`POLLER_ACTION_SCRIPT_PHP`:**  漏洞利用的前提是存在一个action类型为`POLLER_ACTION_SCRIPT_PHP`的`poller_item`。需要找到对应的`host_id`和`local_data_id`。

**有效性:**
根据漏洞描述，此漏洞利用代码利用了未经授权的远程代理来执行任意系统命令，因此有效。

**投毒风险:**
提供的代码段是 Apache 2.0 许可协议，不包含任何可执行代码或恶意代码，因此投毒风险为0%。核心的PoC代码并没有提供，因此无法判断攻击者是否进行了后门代码验证，只能判断提供的许可协议不存在投毒风险。

**项目地址:** [SystemVll/CVE-2022-46169](https://github.com/SystemVll/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)