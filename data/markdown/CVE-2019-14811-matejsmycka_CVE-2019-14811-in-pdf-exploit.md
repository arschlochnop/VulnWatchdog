## CVE-2019-14811-Ghostscript-沙箱绕过

**漏洞编号:** CVE-2019-14811

**漏洞类型:** 沙箱绕过

**影响应用:** Ghostscript

**危害等级:** 高危，可能导致文件系统访问和任意命令执行

**影响版本:** 9.50之前

**利用条件:** 目标系统使用存在漏洞的Ghostscript版本，且允许处理PostScript文件，例如PDF预览功能。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-14811 漏洞存在于 Ghostscript 9.50 之前的版本中，特别是在 `.pdf_hook_DSC_Creator` 过程中。该漏洞允许攻击者通过构造恶意的 PostScript 文件绕过 `-dSAFER` 限制，从而获得文件系统访问权限和执行任意命令的能力。

**有效性分析：**

根据漏洞信息、搜索结果和提供的 PoC 代码，该漏洞利用是有效的。漏洞描述明确指出，通过精心构造的 PostScript 文件可以禁用安全保护并访问文件系统或执行任意命令。搜索引擎结果中 Rapid7 的分析也验证了这一点，PoC代码也佐证。

**投毒风险分析：**

分析提供的 PoC 代码，没有发现明显的投毒代码。PoC 代码的主要功能是：

1.  尝试从 `.pdf_hook_DSC_Creator` 中获取 `.forceput` 操作符。
2.  通过 `.forceput` 操作符覆盖 SAFER 标志和其他安全相关的用户参数，从而绕过安全模式。
3.  使用 `osexec` 操作符执行任意命令（在此 PoC 中是 `id` 命令）。

代码逻辑清晰，目的是利用漏洞绕过安全限制，没有发现隐藏的恶意功能。因此，投毒风险评估为 0%。

**利用方式分析：**

1.  **定位漏洞点：** 漏洞存在于 `.pdf_hook_DSC_Creator` 过程中，该过程没有正确地保护其特权调用。
2.  **获取 `.forceput` 操作符：** PoC 代码首先尝试从 `.pdf_hook_DSC_Creator` 中获取 `.forceput` 操作符。`.forceput` 允许在只读字典中设置值，这是绕过安全限制的关键。
3.  **绕过安全模式：** 通过使用 `.forceput` 操作符，PoC 代码将 `SAFER` 标志设置为 `false`，并修改其他安全相关的用户参数，如 `LockFilePermissions`、`PermitFileControl`、`PermitFileWriting` 和 `PermitFileReading`。
4.  **执行任意命令：** 绕过安全模式后，PoC 代码定义了一个 `osexec` 操作符，该操作符可以执行任意系统命令。PoC 中执行了 `id` 命令，用于显示当前用户的身份信息。
5.  **触发漏洞：**将恶意 PostScript 文件发送给目标系统，并由 Ghostscript 处理（例如，通过 PDF 预览功能）。当 Ghostscript 处理该文件时，漏洞将被触发，攻击者可以执行任意命令。

**总结：**

CVE-2019-14811 是一个高危漏洞，允许攻击者绕过 Ghostscript 的安全模式并执行任意命令。提供的 PoC 代码有效，且没有发现投毒风险。利用方式是首先获取 `.forceput` 操作符，然后使用该操作符绕过安全限制，最后执行任意命令。

**项目地址:** [matejsmycka/CVE-2019-14811-in-pdf-exploit](https://github.com/matejsmycka/CVE-2019-14811-in-pdf-exploit)

**漏洞详情:** [CVE-2019-14811](https://nvd.nist.gov/vuln/detail/CVE-2019-14811)