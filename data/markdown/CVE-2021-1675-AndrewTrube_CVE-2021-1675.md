## CVE-2021-1675 PrintNightmare 本地提权漏洞

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 本地提权

**影响应用:** Windows Print Spooler

**危害等级:** 高危，攻击者可利用此漏洞获取SYSTEM权限

**影响版本:** 受影响的Windows版本包括但不限于Windows 7, Windows 8.1, Windows 10, Windows Server 2008, Windows Server 2012, Windows Server 2016, Windows Server 2019, Windows Server 20H2, Windows Server version 2004, Windows 10 Version 1507, Windows 10 Version 1607, Windows 10 Version 1809, Windows 10 Version 1909, Windows 10 Version 2004, Windows 10 Version 20H2, Windows 10 Version 21H1等，具体版本号参见漏洞库信息。

**利用条件:** 攻击者需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675（PrintNightmare）是Windows Print Spooler服务中的一个漏洞，允许攻击者绕过SeLoadDriverPrivilege检查，通过安装恶意DLL来提升权限至SYSTEM。提供的POC代码包含两个源文件：`nightmare.cpp`（利用漏洞的主程序）和`payload-dll.cpp`（包含恶意shellcode的DLL）。利用方式如下：

1.  使用msfvenom生成shellcode，并将其嵌入`payload-dll.cpp`中。
2.  编译`nightmare.cpp`生成`PrintNightmareLPE.exe`。
3.  编译`payload-dll.cpp`生成`evil.dll`。
4.  将`evil.dll`移动到目标系统的`C:\windows\temp\evil.dll`（或修改`nightmare.cpp`中的路径）。
5.  运行`PrintNightmareLPE.exe`，该程序会加载`evil.dll`并执行其中的shellcode，从而提升权限。

**有效性：**提供的POC代码是有效的，可以用于演示和利用CVE-2021-1675漏洞。

**投毒风险：**虽然POC代码本身是为了复现漏洞，但存在一定的投毒风险。风险点主要在于payload-dll.cpp中shellcode的来源。如果shellcode是从不可信的来源获取，或者包含了恶意代码，那么整个利用过程就会被投毒。但代码的作者Andrew Trube是安全研究者，可以推断出投毒几率较低。根据对POC代码的分析，风险评估为 10%的概率存在潜在风险。

**漏洞利用方式：**
1.  攻击者需要在目标系统上具有本地访问权限。
2.  攻击者需要能够上传和执行文件。
3.  攻击者利用`PrintNightmareLPE.exe`加载恶意的`evil.dll`。
4.  恶意DLL中的shellcode会被执行，从而提升攻击者的权限。

**项目地址:** [AndrewTrube/CVE-2021-1675](https://github.com/AndrewTrube/CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)