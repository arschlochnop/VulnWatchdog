## CVE-2025-29927-Next.js中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问，数据泄露，权限提升

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用了受影响版本的Next.js，并且授权检查逻辑位于中间件中

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927是Next.js中间件中存在的一个授权绕过漏洞。该漏洞允许未经授权的攻击者通过操纵`x-middleware-subrequest`请求头来绕过中间件中的身份验证检查，从而访问受保护的资源。

**漏洞利用方式：**

1.  **识别目标：** 确定目标Next.js应用程序，并且该应用使用了受影响的版本。
2.  **构造请求：**  向目标应用程序发送HTTP请求，并在请求头中包含`x-middleware-subrequest`头，其值设置为特定的路径，例如`pages/_middleware`， `pages/dashboard/_middleware`等。该脚本提供了多个payload，通过`HEADERS`数组定义。
3.  **绕过授权：**  如果应用程序易受攻击，中间件的授权检查将被绕过，攻击者可以访问原本需要授权才能访问的页面或资源。
4.  **验证：**  可以通过检查响应头中是否缺少`X-Middleware-Rewrite`或`X-Middleware-Set-Cookie`头来判断授权是否成功绕过。POC代码会检测这些header，如果不存在，则表明绕过成功。

**有效性：**

根据漏洞描述和提供的PoC代码，该漏洞利用的有效性较高。PoC代码利用curl发送带有特定`x-middleware-subrequest`头的请求，并检查响应头来确认是否成功绕过中间件。

**投毒风险：**

该PoC代码主要用于漏洞检测和验证。LICENSE文件声明使用MIT开源协议。以下几点降低了投毒风险：

*   代码功能相对简单，主要使用curl发送请求和grep分析响应，逻辑清晰。
*   代码的目的是检测漏洞，而不是执行恶意操作。
*   使用了whatweb 来进行初步指纹识别。

尽管如此，仍然存在一定的投毒风险，比如：

*   **依赖风险：**  代码依赖于外部命令，如`curl`、`whatweb`等。如果这些命令被恶意替换，可能导致安全问题。
*   **日志泄露：**  脚本在执行过程中可能会输出一些敏感信息（例如BUILD_ID），虽然不是直接投毒，但可能为攻击者提供便利。

综合考虑，投毒风险较低，大约在10%左右。主要的风险在于对外部命令的依赖性，以及潜在的日志信息泄露，因此使用时需要注意环境安全。


**项目地址:** [RoyCampos/CVE-2025-29927](https://github.com/RoyCampos/CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)