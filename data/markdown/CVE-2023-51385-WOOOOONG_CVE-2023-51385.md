## CVE-2023-51385-OpenSSH-命令注入

**漏洞编号:** CVE-2023-51385

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.6

**利用条件:** 需要用户名或主机名包含shell元字符，并且被expansion token引用

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-51385 是 OpenSSH 9.6 之前版本中存在的一个命令注入漏洞。当用户名或主机名包含 shell 元字符，并且这个名字在特定情况下被 expansion token 引用时，可能发生操作系统命令注入。例如，一个不受信任的 Git 仓库可能包含一个子模块，其用户名或主机名中包含 shell 元字符。PoC代码只包含README文件，没有实际的验证后门代码，因此判断投毒概率较低。但如果攻击者使用该 PoC 并修改相关代码，则可能存在投毒风险。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞确实存在，并且影响 OpenSSH 9.6 之前的版本。提供的 PoC 代码仅仅是一个 README 文件，只包含漏洞名称，没有实际的漏洞利用代码。因此，提供的PoC代码本身**不具备**直接的漏洞利用有效性，需要进一步开发利用代码。

**投毒风险：**
因为提供的 PoC 只是一个 README 文件，因此**不存在**明显的投毒代码。可以认为投毒的风险很低，接近0%。但也不能完全排除，因为这个仓库可能后续被修改，添加恶意代码。
综合考虑，给出的投毒风险为1%。

**利用方式：**
利用此漏洞的一种方法是，攻击者可以创建一个包含恶意子模块的 Git 仓库。该子模块的用户名或主机名包含 shell 元字符。当用户尝试克隆包含此子模块的仓库时，OpenSSH 可能会执行恶意命令。具体步骤如下：

1.  创建一个包含恶意子模块的 Git 仓库。
2.  确保子模块的用户名或主机名包含 shell 元字符，例如反引号 (`) 或美元符号 ($)。
3.  诱使用户克隆该仓库。
4.  当 OpenSSH 处理子模块信息时，由于存在命令注入漏洞，恶意命令将被执行。

另一种利用方式是通过 `ProxyCommand` 指令。攻击者可以配置 SSH 客户端，使其使用包含恶意 shell 元字符的用户名或主机名连接到目标服务器。当 OpenSSH 执行 `ProxyCommand` 时，恶意命令将被执行。

**优先级排序:**
搜索引擎结果 > 漏洞库信息 > 漏洞利用代码(因为提供的POC没有任何实质性代码)


**项目地址:** [WOOOOONG/CVE-2023-51385](https://github.com/WOOOOONG/CVE-2023-51385)

**漏洞详情:** [CVE-2023-51385](https://nvd.nist.gov/vuln/detail/CVE-2023-51385)