## CVE-2025-24893 - XWiki SolrSearch Macro RCE

**漏洞编号:** CVE-2025-24893

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** XWiki Platform

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 5.3-milestone-2 到 15.10.11，以及 16.0.0-rc-1 到 16.4.1

**利用条件:** 目标XWiki实例可以通过网络访问且未应用补丁。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24893 存在于 XWiki Platform 的 SolrSearch 宏中，由于对用户输入过滤不足，允许未经身份验证的攻击者通过构造恶意的 RSS 请求，注入 Groovy 代码并执行。漏洞利用方式如下：

1.  **漏洞触发点:** `Main.SolrSearch` 页面，通过 `media=rss` 参数利用 RSS 渲染功能。
2.  **攻击方式:**  攻击者通过 `text` 参数注入包含 Groovy 代码的 payload。该 payload 利用了 XWiki 的异步渲染功能(`{{async}}`)，绕过了一些安全限制，从而可以执行任意 Groovy 代码。
3.  **Payload构造:**  Payload 包含嵌入在 RSS 内容中的恶意 Groovy 表达式。例如，`println("Hello from search text:" + (23 + 19))` 会在服务器端执行 Groovy 代码，并将结果嵌入到 RSS 的 `<title>` 标签中。
4.  **利用代码分析:** 提供的 Python 脚本自动化了整个漏洞利用过程。它允许用户输入任意命令，然后将命令嵌入到恶意 payload 中，并发送到目标 XWiki 实例。脚本还负责解析响应，提取命令执行的结果。
5.  **投毒风险分析:** 代码本身主要实现了漏洞利用功能，但是脚本中定义了远程和本地的host以及端口。如远程HOST `infinit3i.doge`,具有不确定性，存在命令执行后连接该HOST的风险。同时脚本在生成反向shell的时候，下载的文件名`rev`比较通用，如果恶意攻击者替换成其他后门程序，也可能存在投毒风险。因此，综合判定该脚本存在 5% 的投毒风险。
6.  **修复方案:**  升级 XWiki Platform 到 15.10.11, 16.4.1 或 16.5.0RC1 以上版本，或者手动修改 `Main.SolrSearchMacros` 宏的 `SolrSearchMacros.xml` 文件，使其与 `macros.vm#L2824` 中的 `rawResponse` 宏保持一致，并将内容类型设置为 `application/xml`。

**项目地址:** [Infinit3i/CVE-2025-24893](https://github.com/Infinit3i/CVE-2025-24893)

**漏洞详情:** [CVE-2025-24893](https://nvd.nist.gov/vuln/detail/CVE-2025-24893)