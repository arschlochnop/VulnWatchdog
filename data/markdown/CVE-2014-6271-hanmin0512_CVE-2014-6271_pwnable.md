## CVE-2014-6271 Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 命令注入

**影响应用:** Bash

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 4.3

**利用条件:** 需要目标系统存在CGI脚本、OpenSSH等利用入口，允许设置环境变量

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2014-6271，又名Shellshock，是一个存在于GNU Bash中的命令注入漏洞。攻击者可以构造包含恶意代码的环境变量，当Bash shell执行时，会将恶意代码一并执行，从而达到远程命令执行的目的。

**有效性：**

提供的POC代码是有效的，它演示了利用Shellshock漏洞的基本原理，即通过设置包含恶意代码的环境变量来执行任意命令。shellshock.c 文件通过提权后执行 bash 命令来证明改漏洞的利用。

**投毒风险：**

代码仓库中未发现明显的投毒代码。shellshock.c 只是简单的提权后执行了 bash 命令。

**利用方式：**

1.  **漏洞原理：** Bash在处理环境变量时，如果环境变量的值以函数定义开头，Bash会尝试解析并执行该函数定义之后的代码。如果攻击者能够控制环境变量的内容，就可以注入恶意的代码。

2.  **利用场景：**

    *   **CGI脚本：**  Web服务器在执行CGI脚本时，会将HTTP请求头中的某些字段作为环境变量传递给脚本。攻击者可以修改这些HTTP请求头，注入恶意代码。
    *   **OpenSSH：**  如果OpenSSH启用了`ForceCommand`功能，并且`ForceCommand`中使用了Bash shell，攻击者可以通过设置环境变量来执行命令。
    *   **DHCP客户端：**  某些DHCP客户端脚本会执行Bash shell，攻击者可以通过控制DHCP服务器，设置包含恶意代码的环境变量。

3.  **利用步骤：**

    a.  确定目标系统存在Bash shell，且版本小于等于4.3。
    b.  找到一个可以通过环境变量影响Bash执行的入口（例如CGI脚本）。
    c.  构造包含恶意代码的环境变量，例如：
        `export payload='() { ignored; }; /bin/cat /etc/passwd'`
    d.  将该环境变量传递给Bash shell执行。
    e.  如果漏洞存在，`/etc/passwd`文件的内容将被输出。

**项目地址:** [hanmin0512/CVE-2014-6271_pwnable](https://github.com/hanmin0512/CVE-2014-6271_pwnable)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)