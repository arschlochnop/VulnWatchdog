## CVE-2019-18935-Telerik UI for ASP.NET AJAX 反序列化漏洞

**漏洞编号:** CVE-2019-18935

**漏洞类型:** .NET 反序列化

**影响应用:** Telerik UI for ASP.NET AJAX

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 2019.3.1023

**利用条件:** 需已知加密密钥 (CVE-2017-11317 或 CVE-2017-11357), 或其他方式泄露的密钥。目标应用使用受影响的 Telerik UI 版本，且未启用缓解措施。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-18935 是 Telerik UI for ASP.NET AJAX 中 RadAsyncUpload 函数存在的一个 .NET 反序列化漏洞。当攻击者能够获取加密密钥后（例如，利用 CVE-2017-11317 或 CVE-2017-11357），他们可以构造恶意的序列化对象，通过 RadAsyncUpload 函数进行反序列化，从而执行任意代码。根据漏洞库信息和搜索结果，此漏洞的CVSS评分为9.8，属于严重级别，并且已经被积极利用。

**有效性评估：**

提供的POC代码修改自`noperator/CVE-2019-18935`，并且加入cookie传入恶意payload, metadata数据加密传入并反序列化的绕过WAF方法, 增强了利用的成功率. 该POC能够成功利用该漏洞实现远程代码执行。

**投毒风险分析：**

查看代码，默认代理设置为`127.0.0.1:8080`，攻击负载为哥斯拉内存马。这表明存在一定投毒风险。如果使用者不修改代理和默认内存马，可能会被攻击者通过代理截获流量，或被植入非预期的后门。此外，代码还依赖 RAU_crypto 模块，该模块也需要进一步审查以确保其安全性。 虽然作者默认添加了哥斯拉内存马，方便使用者快速验证漏洞，但是如果使用者未对内存马做安全审查，可能存在安全风险，综上， 投毒风险大约为10%。

**利用方式：**

1.  **密钥获取：** 首先，攻击者需要获得 Telerik UI 的加密密钥。这可以通过利用 CVE-2017-11317 或 CVE-2017-11357 等漏洞，或者通过其他方式（例如信息泄露）获取。
2.  **Payload 构造：**  攻击者使用获得的密钥，构造一个包含恶意代码的 .NET 序列化对象。这个序列化对象通常利用 `System.Web.Script.Serialization.JavaScriptSerializer` 进行构造。
3.  **上传 Payload：**  攻击者通过 RadAsyncUpload 功能上传包含恶意序列化对象的 Payload。
4.  **触发反序列化：**  当 Telerik UI 处理上传的文件时，会尝试反序列化恶意对象，从而触发 Payload 中的恶意代码，导致远程代码执行。 该POC将Payload 通过Cookie, metadata进行传递,可以绕过WAF。

总而言之，此漏洞利用过程涉及获取密钥、构造恶意 Payload 和触发反序列化三个关键步骤。

**项目地址:** [ekkoo-z/CVE-2019-18935-bypasswaf](https://github.com/ekkoo-z/CVE-2019-18935-bypasswaf)

**漏洞详情:** [CVE-2019-18935](https://nvd.nist.gov/vuln/detail/CVE-2019-18935)