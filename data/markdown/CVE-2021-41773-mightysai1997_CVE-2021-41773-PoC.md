## CVE-2021-41773 - Apache HTTP Server Path Traversal

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历 (Path Traversal)

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可导致文件泄露，甚至远程代码执行

**影响版本:** 2.4.49

**利用条件:** 需要目标服务器运行Apache HTTP Server 2.4.49，且Alias配置的目录未启用 "require all denied" 保护，CGI脚本需要启用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-41773是Apache HTTP Server 2.4.49版本中存在的路径遍历漏洞。攻击者可以利用该漏洞，通过构造包含特殊字符的URL，绕过Alias指令的限制，访问服务器上未授权的文件。如果目标服务器同时启用了CGI脚本支持，则攻击者可能进一步利用此漏洞执行任意代码。

**有效性：**

根据漏洞库信息、搜索结果和漏洞利用代码，可以判断该漏洞的POC代码是有效的。漏洞库中明确指出此漏洞已被在野利用。搜索引擎结果也显示了POC的存在和利用方式。

**投毒风险：**

提供的Dockerfile中，核心操作是：

1.  `FROM httpd:2.4.49`:  指定基础镜像为httpd:2.4.49，这是一个官方镜像，降低了投毒的可能性。
2.  `RUN sed -i 's/Require all denied/# Require all denied/g' /usr/local/apache2/conf/httpd.conf`:  这行代码将httpd.conf文件中的`Require all denied`注释掉。这正是为了使漏洞更容易被利用。如果没有这一行，即使存在路径遍历，也无法读取到未授权的文件（因为默认是拒绝所有访问）。这部分不是投毒，而是为了方便漏洞验证。
其他文件是`LICENSE`，仅包含Apache License 2.0的文本，不涉及任何恶意代码。

因此，直接的恶意投毒代码的可能性较低，但该Dockerfile的意图是创造一个存在漏洞的环境，以便更容易地利用漏洞。该仓库本身并没有主动植入恶意代码，而是提供了一个方便利用漏洞的环境。考虑到该行为可能被恶意利用，判定存在10%的投毒风险，因为此Dockerfile的目的是为了移除安全防护，为攻击者降低利用门槛。

**利用方式：**

1.  **路径遍历：** 攻击者构造包含`..%2f`的URL，尝试访问受限目录之外的文件。`%2f`是`/`的URL编码，`..`表示上一级目录。多次使用`..%2f`可以突破目录限制。
2.  **文件读取：** 如果成功绕过限制，攻击者可以读取服务器上的任意文件，例如配置文件、源代码等。
3.  **远程代码执行 (RCE)：** 如果目标服务器启用了CGI，攻击者可以通过上传恶意CGI脚本并执行，实现远程代码执行。利用路径遍历，将请求发送到位于服务器文件系统上的CGI脚本，从而执行任意命令。

例如，攻击者可以使用如下URL读取`/etc/passwd`文件：

`http://target/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd`

如果启用了CGI，攻击者可以尝试利用路径遍历访问并执行CGI脚本，例如：

`http://target/cgi-bin/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fpath/to/malicious.cgi`

**项目地址:** [mightysai1997/CVE-2021-41773-PoC](https://github.com/mightysai1997/CVE-2021-41773-PoC)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)