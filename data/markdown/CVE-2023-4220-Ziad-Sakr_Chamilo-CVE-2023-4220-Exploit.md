## CVE-2023-4220 Chamilo LMS 远程代码执行

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 任意文件上传/远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，可导致远程代码执行和服务器完全控制

**影响版本:** <= 1.11.24

**利用条件:** Chamilo LMS <= 1.11.24，目标服务器可访问，`/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 路径存在且可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220 漏洞存在于Chamilo LMS的 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 文件中，允许未经身份验证的攻击者通过上传恶意文件（例如webshell）来执行任意代码。该漏洞利用了 Chamilo LMS 大文件上传功能中的一个缺陷，攻击者通过构造特定的请求，将恶意文件上传到 `/main/inc/lib/javascript/bigupload/files/` 目录。上传的文件可以被直接访问并执行，导致远程代码执行。

**有效性：**

提供的POC代码通过 curl 命令模拟文件上传，指定了上传的文件路径、目标URL和执行reverse shell的端口。基本逻辑符合漏洞描述，利用步骤清晰，可以有效利用该漏洞。

**投毒风险：**

代码本身主要是通过curl上传文件，以及使用nc监听端口，看起来比较直接。但是，有几点需要关注：

1.  `reverse_file` 是用户可控的，这意味着如果用户不小心使用了包含恶意代码的文件作为 `reverse_file`，可能会引入投毒。
2.  脚本中提供了一段提示用户进行TTY交互的命令，这段命令本身没有恶意，但如果攻击者替换了其中的`/bin/bash`为其他恶意程序，可能会导致投毒。
3.  脚本执行后会启动一个`nc`监听进程，恶意用户可以连接到此端口执行命令，进行恶意操作。

综上，投毒风险较低，约为10%， 主要来自用户使用的 reverse shell 文件本身可能存在恶意代码。

**利用方式：**

1.  准备一个包含反弹shell代码的webshell文件（reverse_file）。
2.  使用提供的脚本 `CVE-2023-4220.sh`，通过 `-f` 参数指定 webshell 文件的路径，`-h` 参数指定 Chamilo LMS 的主机地址，`-p` 参数指定反弹 shell 的端口。
3.  脚本会使用 curl 命令将webshell上传到Chamilo LMS服务器的指定目录。
4.  脚本启动 nc 监听指定的端口。
5.  通过访问上传的 webshell 文件，触发反弹 shell，攻击者即可获得目标服务器的控制权。

**防范措施：**

1.  升级 Chamilo LMS 到最新版本。
2.  限制上传文件类型，对上传的文件进行安全检查。
3.  加强服务器安全配置，防止恶意代码执行。

**项目地址:** [Ziad-Sakr/Chamilo-CVE-2023-4220-Exploit](https://github.com/Ziad-Sakr/Chamilo-CVE-2023-4220-Exploit)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)