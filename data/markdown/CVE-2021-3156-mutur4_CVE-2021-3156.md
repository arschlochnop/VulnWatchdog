## CVE-2021-3156 - Sudo Heap-Based Buffer Overflow

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可导致本地提权至 root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户能够执行 sudo 命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156（Baron Samedit）是一个 Sudo 程序中的堆缓冲区溢出漏洞。根据漏洞描述和搜索结果，该漏洞存在于 Sudo 在解析命令行参数时，具体来说，是当使用 `sudoedit -s` 并且命令行参数以单个反斜杠字符结尾时，可能触发 off-by-one 错误，从而导致堆缓冲区溢出。未经授权的本地用户可以利用此漏洞提升权限至 root。

**有效性：**
根据搜索结果和漏洞库信息，以及提供的POC代码，该漏洞的利用是有效的。POC代码的目的是精心构造命令行参数和环境变量，利用 off-by-one 错误进行堆溢出，最终获得 root 权限。大量的公开信息和可用的利用代码表明此漏洞是可利用的。

**投毒风险：**
分析提供的 POC 代码，没有发现明显的投毒代码。代码的主要功能是利用漏洞本身进行提权。代码结构清晰，目的是构造特定的参数和环境变量，触发 Sudo 程序的堆缓冲区溢出。所有操作都围绕着漏洞利用展开，没有发现恶意行为，因此投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**  使用 `sudoedit -s` 命令，并提供一个以单个反斜杠结尾的命令行参数。这是触发漏洞的关键。
2.  **堆溢出：**  通过精心构造的环境变量（特别是 `overflow_buffer` 和 `lc_time_var`），覆盖堆上的相邻内存块。
3.  **权限提升：**  通过溢出，覆盖 Sudo 内部的关键数据结构（如 `service_user`），使其指向攻击者可控的内存区域，从而执行恶意代码或修改用户 ID，最终提升到 root 权限。
4.  **`execve`函数调用：** 使用execve函数调用精心构造的参数，触发漏洞，完成攻击。

总而言之，此漏洞利用的有效性很高，并且所提供的 POC 代码没有发现投毒的迹象。该漏洞利用方式依赖于堆溢出，通过控制命令行参数和环境变量覆盖关键数据结构，最终实现权限提升。

**项目地址:** [mutur4/CVE-2021-3156](https://github.com/mutur4/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)