## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+, Tomcat 作为 WAR 部署，Spring MVC 或 Spring WebFlux 应用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22965，也被称为 Spring4Shell，是一个 Spring Framework 中的远程代码执行漏洞。该漏洞利用了数据绑定功能，允许攻击者通过构造恶意请求来修改 Tomcat 的访问日志配置，进而写入恶意 Web shell，最终实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索引擎结果，确认该漏洞是真实存在的，并且存在公开的利用代码。漏洞的有效性取决于目标应用程序是否满足漏洞利用的先决条件：运行在 JDK 9+，部署为 WAR 包在 Tomcat 上，并使用 Spring MVC 或 Spring WebFlux。

**投毒风险：**
提供的代码片段 `/tmp/654a99bf9ba51c6c41107b986ba46894/mvnw` 看起来是 Maven Wrapper 脚本。这个脚本的主要目的是为了在没有安装 Maven 的环境下也能构建 Maven 项目，它本身不包含直接的漏洞利用代码。投毒的风险在于：

*   **依赖项投毒：** 攻击者可能修改 Maven 项目的 `pom.xml` 文件，添加恶意的依赖项。当 Maven Wrapper 构建项目时，会下载并执行这些恶意依赖项中的代码，从而实现投毒。虽然代码片段本身没有恶意，但 Maven 构建过程的性质决定了存在这种风险。
*   **配置投毒：** 攻击者可能篡改 Maven 的配置文件，修改构建过程，插入恶意代码。

考虑到 Maven Wrapper 的功能以及潜在的构建过程篡改，投毒风险评估为10%。

**利用方式：**
根据漏洞信息，利用方式主要包括以下步骤：

1.  **确定目标：** 找到满足漏洞利用条件的 Spring 应用。
2.  **构造恶意请求：** 构造包含恶意参数的 HTTP 请求，这些参数会修改 Tomcat 的访问日志配置。
3.  **写入 Web Shell：** 通过修改访问日志配置，将恶意代码（例如，一个简单的 Web shell）写入到 Tomcat 的 webapps 目录下。
4.  **执行命令：** 通过访问写入的 Web shell，执行任意命令。

总而言之，这是一个高危漏洞，如果目标应用程序满足利用条件，攻击者可以很容易地利用该漏洞执行任意命令。

**项目地址:** [dbgee/Spring4Shell](https://github.com/dbgee/Spring4Shell)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)