## CVE-2020-0688 Microsoft Exchange Server Remote Code Execution

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/15, 2019 CU3/4

**利用条件:** 需要有效的Exchange用户凭据

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-0688 是一个 Microsoft Exchange Server 中的远程代码执行漏洞，源于 Exchange Control Panel (ECP) 组件未能正确处理内存中的对象。攻击者可以利用静态的machineKey进行ViewState反序列化，从而执行任意代码。 

**漏洞利用方式：**

1.  **身份验证：** 攻击者首先需要获取有效的 Exchange 用户凭据，可以通过爆破、钓鱼等方式。
2.  **获取 ViewStateGenerator：** 成功登录后，攻击者需要获取 `__VIEWSTATEGENERATOR` 的值。
3.  **构造恶意 ViewState：** 攻击者使用ysoserial等工具，利用已知密钥构造恶意的 ViewState payload，其中包含要执行的命令。
4.  **发送请求：** 攻击者将包含恶意 ViewState 的请求发送到 Exchange 服务器的 ECP 路径（例如 `/ecp/default.aspx` 或 `/ecp/LiveIdError.aspx`）。
5.  **代码执行：** Exchange 服务器反序列化 ViewState，执行攻击者嵌入的恶意代码。

**关于投毒风险：**
代码总体来说是漏洞的利用，但需要仔细审查以下区域：
*   `ExchangeCmd.cs`中的UpdateMacKey函数,如果被人恶意篡改默认的密钥，可能会导致其他的隐患。虽然本身只是用于dummy file写入，但是需要注意。
*   与ysoserial集成的部分，需要验证生成的payload是否符合预期，防止被替换成恶意payload。

总体来说，投毒的概率较低，主要集中在payload生成和默认配置的修改上。需要复核相关逻辑保证安全。

**项目地址:** [zcgonvh/CVE-2020-0688](https://github.com/zcgonvh/CVE-2020-0688)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)