## CVE-2021-41773-Apache HTTP Server-路径遍历和RCE

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49，并启用了cgi-bin目录的执行权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-41773 存在于 Apache HTTP Server 2.4.49 中。攻击者可以通过构造包含特殊编码的 URL，利用路径遍历漏洞访问受限目录之外的文件。如果服务器配置允许 CGI 脚本执行，则可以进一步利用该漏洞执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞利用是有效的。漏洞库中提到该漏洞已在野外被利用，多个搜索结果也证实了该漏洞的存在和潜在危害，并提供了利用示例。PoC 代码实现了利用路径遍历漏洞执行命令的功能。

**投毒风险：**
PoC 代码主要功能是利用漏洞实现远程命令执行。以下是对代码可能存在的投毒风险的分析：

*   **代码结构和功能：** PoC 代码结构清晰，主要包括参数解析、URL 构造和 HTTP 请求发送等功能。这些功能都与漏洞利用直接相关。
*   **潜在的风险点：**  PoC 代码中存在一些潜在的风险点：
    *   `data_payload: str = f"echo Content-Type: text/plain; echo; {args.command}"` ，args.command参数如果被恶意构造，可能会导致执行非预期的系统命令。
        *   虽然`clean_url`函数旨在清理URL，但可能存在绕过的风险。

总体来说，代码的投毒风险较低，大概在5%。主要风险集中在命令执行的参数上，以及URL清洗函数可能存在的绕过。

**利用方式：**
1.  **确定目标：** 找到运行 Apache HTTP Server 2.4.49 的目标服务器，并确认 `cgi-bin` 目录已启用。
2.  **构造 Payload：** 使用包含路径遍历的 URL 和要执行的命令构造 HTTP POST 请求。URL 的基本格式如下：
    ```
    /cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/sh
    ```
    其中，`.%2e` 是 `..` 的 URL 编码，用于绕过路径检查。`bin/sh` 是要执行的 shell 程序的路径。
3.  **发送请求：**  将构造好的 HTTP POST 请求发送到目标服务器。
4.  **获取结果：**  如果漏洞利用成功，服务器将执行指定的命令，并将结果作为 HTTP 响应返回。

**项目地址:** [gunzf0x/CVE-2021-41773](https://github.com/gunzf0x/CVE-2021-41773)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)