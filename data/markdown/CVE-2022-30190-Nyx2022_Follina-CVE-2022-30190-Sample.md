## CVE-2022-30190 - Microsoft MSDT 'Follina' 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，允许攻击者以调用应用程序的权限执行任意代码

**影响版本:** 受影响的Windows版本众多，具体版本范围请参考漏洞库信息

**利用条件:** 用户需要打开恶意文档或点击恶意链接，触发MSDT通过URL协议调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-30190，又名'Follina'，是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中的远程代码执行漏洞。当MSDT被调用应用程序（如Microsoft Word）使用URL协议调用时，就会触发此漏洞。攻击者可以制作包含恶意链接或嵌入恶意OLE对象的Office文档（例如.docx或.rtf）。当用户打开这些文档时，MSDT会尝试通过HTTP(S)协议从远程服务器下载并执行恶意代码，从而允许攻击者在受害者系统上执行任意代码。POC代码中的`FollinaExtractor.cs` 文件显示，它用于解析docx和rtf文件，提取包含 `Target="mhtml:` 或 `\objclass http` 的信息,进而判断文件是否包含恶意链接，其他文件则是创建WPF应用的相关文件，没有发现明显的恶意代码。

**有效性评估：**根据漏洞库信息和搜索结果，该漏洞是一个已公开且被积极利用的漏洞，提供的POC代码是用于检测受感染的docx或rtf文档中是否包含利用该漏洞的恶意链接，该POC代码的目的是提取恶意链接，而不是直接进行攻击，所以判断该POC代码具有一定的有效性，可以辅助安全研究人员分析恶意样本。

**投毒风险评估：**该POC代码主要功能是分析文档，提取潜在的恶意链接，因此投毒风险较低。但是,任何代码都可能存在隐藏的后门或者被篡改的风险，因此也不能完全排除。将风险评估为5%。

**利用方式：**
1.  攻击者创建一个恶意的Word文档（.docx）或RTF文档，该文档包含一个指向远程服务器的链接。
2.  当用户打开该文档时，Word会尝试通过MSDT URL协议连接到远程服务器。
3.  远程服务器返回恶意HTML代码或脚本，该代码会被MSDT执行，从而允许攻击者在受害者系统上执行任意代码。
4.  攻击者可以使用户的身份执行命令，从而控制受害者的计算机。

**项目地址:** [Nyx2022/Follina-CVE-2022-30190-Sample](https://github.com/Nyx2022/Follina-CVE-2022-30190-Sample)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)