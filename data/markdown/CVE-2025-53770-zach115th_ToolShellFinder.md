## CVE-2025-53770 - Microsoft SharePoint Server 远程代码执行漏洞

**漏洞编号:** CVE-2025-53770

**漏洞类型:** 反序列化

**影响应用:** Microsoft SharePoint Server

**危害等级:** 高危，允许未经授权的攻击者通过网络执行代码

**影响版本:** Microsoft SharePoint Enterprise Server 2016, Microsoft SharePoint Server 2019, Microsoft SharePoint Server Subscription Edition (版本低于 16.0.18526.20508)

**利用条件:** 需要目标SharePoint服务器可达

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息和搜索引擎结果，CVE-2025-53770 是一个 Microsoft SharePoint Server 中存在的远程代码执行漏洞，源于对不可信数据的反序列化。 

**有效性评估：**
根据搜索引擎结果[webpage 2, 7, 9]，此漏洞已被积极利用，并且存在公开可用的PoC。提供的漏洞利用代码 (toolshellfinder.ps1) 实际上是一个检测脚本，用于在 IIS 日志中查找与 CVE-2025-53770 和 CVE-2025-53771 相关的攻击痕迹。 它通过搜索特定的 HTTP 方法、URI、查询字符串、User-Agent 和 Referer 字段来识别潜在的攻击尝试。 虽然它本身不是一个利用程序，但它表明了该漏洞的可利用性以及攻击者可能使用的攻击模式。

**投毒风险分析：**
提供的 PowerShell 脚本 `toolshellfinder.ps1` 的主要功能是分析 IIS 日志，查找攻击的 IoC。 它不包含任何明显的恶意代码来执行远程代码或修改系统。 投毒风险较低，估计为 10%。 这种风险主要来自于以下几个方面：

*   **依赖的输入数据（IIS 日志）：** 脚本的正确性依赖于 IIS 日志的完整性和准确性。 如果日志被篡改或包含恶意数据，可能会导致脚本误报或漏报。 
*   **PowerShell 执行策略：** 在某些配置下，PowerShell 的执行策略可能会允许执行未经签名的脚本。 如果攻击者能够修改脚本或替换它，可能会引入恶意代码。
*   **潜在的供应链风险：** 尽管当前代码看起来是安全的，但如果该脚本是从一个不可信的来源下载，或者脚本作者本身被攻击，则存在一定的供应链风险。虽然readme文件看起来正常,但作者也可能在其他地方投毒。

**漏洞利用方式分析：**
1.  **反序列化漏洞：** 漏洞的核心是由于 SharePoint Server 在处理反序列化数据时存在缺陷，导致攻击者可以构造恶意序列化数据，当服务器反序列化这些数据时，即可执行攻击者预先设定的代码。 
2.  **攻击入口点：** 根据搜索结果和检测脚本中的 IoC，攻击者可能利用 `/_layouts/15/ToolPane.aspx` 或 `/_layouts/16/ToolPane.aspx` 等页面，通过构造包含恶意序列化数据的 POST 请求来触发漏洞。`success.aspx`也可能作为利用的端点。
3.  **IIS 日志痕迹：** 成功或失败的攻击尝试都会在 IIS 日志中留下痕迹。 通过分析 IIS 日志，可以检测到以下 IoC：
    *   包含特定查询字符串（例如 `DisplayMode=Edit&a=/ToolPane.aspx`）的 `ToolPane.aspx` 请求。
    *   Referer 为 `/_layouts/SignOut.aspx` 的可疑文件下载请求。
    *   User-Agent 中包含 `curl`、`powershell` 或 `python` 关键字的 `start.aspx` 或 `success.aspx` 请求。
    *   `success.aspx`页面，并且查询字符串以长`__VIEWSTATE=`值开头

总结：该漏洞利用涉及发送特制的恶意序列化数据到SharePoint服务器，从而允许远程代码执行。提供的PoC代码是一个检测工具，用于在IIS日志中查找利用该漏洞的攻击尝试。虽然PoC代码本身不包含后门，但需要注意潜在的供应链风险。

**项目地址:** [zach115th/ToolShellFinder](https://github.com/zach115th/ToolShellFinder)

**漏洞详情:** [CVE-2025-53770](https://nvd.nist.gov/vuln/detail/CVE-2025-53770)