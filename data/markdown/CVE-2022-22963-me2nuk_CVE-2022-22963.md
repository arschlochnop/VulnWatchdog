## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可导致远程代码执行，完全控制服务器

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and all old and unsupported versions

**利用条件:** 需要Spring Cloud Function开启路由功能，且允许用户输入路由表达式

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中的一个远程代码执行漏洞。该漏洞是由于当使用路由功能时，攻击者可以提供特制的 SpEL 表达式作为路由表达式，从而导致远程代码执行和访问本地资源。

**漏洞利用分析：**

1.  **漏洞原理：** Spring Cloud Function 允许开发者使用 SpEL（Spring Expression Language）定义函数路由。当路由表达式由用户输入控制时，攻击者可以通过构造恶意的 SpEL 表达式来执行任意代码。
2.  **POC 有效性：** 提供的 POC 代码有效。Dockerfile 部署了一个存在漏洞的 Spring Cloud Function 应用，README.md 提供了利用该漏洞的步骤。POC 使用 `curl` 命令，通过设置 `spring.cloud.function.routing-expression` 头为恶意的 SpEL 表达式，来触发远程代码执行。示例中，`T(java.lang.Runtime).getRuntime().exec("touch /tmp/pwned")` 会在服务器上创建一个名为 `/tmp/pwned` 的文件，验证了 RCE。
3.  **投毒风险：** 检查了 Dockerfile 和 README.md，没有发现明显的投毒代码。Dockerfile 主要用于构建存在漏洞的环境，README.md 主要用于演示如何利用漏洞。尽管POC可以执行任意命令，但那是在利用漏洞，并非代码本身包含恶意后门。
4.  **利用方式总结：**
    *   攻击者向 Spring Cloud Function 应用发送 POST 请求。
    *   在请求头中设置 `spring.cloud.function.routing-expression`，值为恶意的 SpEL 表达式。
    *   服务器解析并执行该 SpEL 表达式，导致远程代码执行。

**漏洞修复建议：**

*   升级到 Spring Cloud Function 的安全版本。
*   禁用或限制路由功能。
*   对用户输入的路由表达式进行严格的过滤和验证。

**项目地址:** [me2nuk/CVE-2022-22963](https://github.com/me2nuk/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)