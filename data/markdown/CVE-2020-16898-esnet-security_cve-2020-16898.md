## CVE-2020-16898 - Windows TCP/IP 远程代码执行漏洞 (Bad Neighbor)

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows TCP/IP Stack

**危害等级:** 高危，可能导致远程代码执行，系统控制

**影响版本:** Windows 10 版本 1709, 1803, 1809, 1903, 1909, 2004; Windows Server 2019, 版本 1903, 版本 2004

**利用条件:** 攻击者需要与目标系统处于同一网络段，并发送特制的 ICMPv6 路由器通告数据包。

**POC 可用性:** 是，网络上已存在公开的PoC

**投毒风险:** 10%

## 详情

CVE-2020-16898 是一个存在于 Windows TCP/IP 协议栈中的远程代码执行漏洞。当 Windows TCP/IP 协议栈未正确处理 ICMPv6 路由器通告 (Router Advertisement) 数据包时，会导致此漏洞。攻击者可以通过向远程 Windows 计算机发送特制的 ICMPv6 路由器通告数据包来利用此漏洞。

**有效性：**
根据漏洞库信息和搜索引擎结果，此漏洞真实存在，并且有公开可用的 PoC 代码。从搜索结果来看，该漏洞被称为"Bad Neighbor"，影响多个Windows版本，包括Windows 10和Windows Server 2019。

**投毒风险：**
提供的代码片段是Zeek (原 Bro) 网络安全监控平台的包，用于检测 CVE-2020-16898 和 CVE-2020-16899 漏洞的利用。这段代码本身是用于安全检测的，而不是漏洞利用的 PoC 代码。但是，由于攻击者可能修改或替换该Zeek包，以达到隐藏恶意行为或进行进一步攻击的目的，因此存在一定的投毒风险。

风险评估：
- 代码用途：用于检测漏洞，本身不包含漏洞利用代码。
- 代码来源：esnet-security，看似合法的组织，但无法完全排除风险。
- 代码行为：检测 ICMPv6 数据包，并记录相关信息。
- 潜在风险：修改后的 Zeek 包可能绕过检测，或者执行恶意操作。

综合考虑，认为存在10%的投毒风险。

**利用方式：**
1.  **攻击者发送特制的 ICMPv6 路由器通告数据包：** 该数据包包含一个畸形的或超出预期的 RDNSS (Recursive DNS Server) 选项。
2.  **Windows TCP/IP 协议栈处理数据包：**  当 TCP/IP 协议栈解析这个畸形 RDNSS 选项时，由于缺乏适当的边界检查，会发生缓冲区溢出。
3.  **远程代码执行：**  缓冲区溢出允许攻击者覆盖内存，最终导致在目标系统上执行任意代码。
4.  **权限提升：**  由于 TCP/IP 协议栈运行在内核模式，成功利用此漏洞可以获得系统级别的权限。

**项目地址:** [esnet-security/cve-2020-16898](https://github.com/esnet-security/cve-2020-16898)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)