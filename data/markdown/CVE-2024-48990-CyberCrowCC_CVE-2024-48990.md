## CVE-2024-48990 - needrestart 本地提权漏洞

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地提权

**影响应用:** needrestart

**危害等级:** 高危，本地用户可以利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统运行受影响版本的 needrestart

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞允许本地攻击者通过操控 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行 Python 解释器，从而执行任意代码。`needrestart` 为了判断 Python 进程是否需要重启，会读取 `/proc/pid/environ` 获取进程的环境变量，如果存在 `PYTHONPATH` 环境变量，则设置该变量，并执行 Python 脚本。如果攻击者控制的 Python 进程设置了恶意的 `PYTHONPATH`，则 `needrestart` 会以 root 权限执行该恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个恶意的 Python 环境，并在该环境中设置 `PYTHONPATH` 环境变量，指向包含恶意 Python 模块的目录。
2.  攻击者运行一个 Python 进程，该进程继承了恶意的 `PYTHONPATH` 环境变量。
3.  当 `needrestart` 检测到该 Python 进程时，会读取其环境变量，并以 root 权限执行 Python 解释器，加载恶意的 Python 模块，从而执行攻击者的代码。

**投毒风险分析：**
提供的 POC 代码主要描述了漏洞原理，并没有直接提供可执行的漏洞利用代码。因此，该 README 文件本身不存在明显的投毒代码。但是考虑到如果将漏洞利用链中的恶意python代码也放入该仓库,那么存在被植入恶意payload进行传播的可能性。因此投毒风险很低,但不能完全排除。


**项目地址:** [CyberCrowCC/CVE-2024-48990](https://github.com/CyberCrowCC/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)