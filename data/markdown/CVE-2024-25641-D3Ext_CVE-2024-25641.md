## CVE-2024-25641 - Cacti RCE when importing packages

**漏洞编号:** CVE-2024-25641

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Cacti

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.2.27

**利用条件:** 需要具有"Import Templates"权限的已认证用户

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-25641是一个Cacti中的远程代码执行漏洞，存在于1.2.27之前的版本中。该漏洞允许具有"Import Templates"权限的认证用户通过"Package Import"功能执行任意PHP代码。漏洞位于`/lib/import.php`脚本的`import_package()`函数中，该函数没有正确验证上传的包中的文件名和文件内容，允许攻击者写入任意文件到服务器上，从而导致任意代码执行。

**有效性：**

根据漏洞信息和搜索引擎结果，该漏洞被认为是真实且可利用的。存在公开的PoC代码（如`https://github.com/Safarchand/CVE-2024-25641`和`https://github.com/D3Ext/CVE-2024-25641`），表明该漏洞已被成功利用。

**投毒风险：**

提供的PoC代码主要由以下文件组成：
* `LICENSE`: MIT许可证，表明代码开源，通常不涉及投毒。
* `README.md`: 漏洞说明和使用方法，没有发现恶意代码。
* `exploit.py`: Python脚本，用于利用漏洞。该脚本会利用`import_package()` 函数的文件写入功能上传恶意PHP文件，从而获取反向shell。如果使用不信任来源的POC，存在一定风险。仔细检查 `exploit.py`，未发现明显的故意投毒代码，例如删除重要文件或执行其他恶意操作。但是，PoC本身的行为就是上传并执行恶意代码，如果攻击者修改PoC，可能添加额外的恶意功能。因此，存在较低的投毒风险。

**利用方式：**

1.  攻击者需要具有Cacti的有效帐户，并且该帐户具有“Import Templates”权限。
2.  攻击者构造一个恶意的Cacti软件包，其中包含恶意PHP代码。
3.  攻击者通过Cacti的“Package Import”功能上传该恶意软件包。
4.  Cacti的`import_package()`函数将恶意PHP文件写入到服务器上的可访问位置。
5.  攻击者通过访问写入的PHP文件来执行其中的恶意代码，通常是获取反向shell。

根据文件内容和漏洞信息，该PoC的风险评估如下：

*   `LICENSE`和`README.md`看起来是标准的说明文件，没有风险。
*   `exploit.py` 是漏洞利用的核心，但目的是验证漏洞，虽然利用过程会上传webshell，但是这是漏洞利用的必要步骤，不能算是投毒代码。

总的来说，投毒风险较低，主要是因为代码目的是漏洞验证，而不是破坏系统。但是，用户使用PoC脚本时，需要意识到其行为的潜在风险，并确保从可信来源获取代码。为了减少风险，建议在使用前仔细检查脚本代码。所以，投毒风险评估为5%。

**项目地址:** [D3Ext/CVE-2024-25641](https://github.com/D3Ext/CVE-2024-25641)

**漏洞详情:** [CVE-2024-25641](https://nvd.nist.gov/vuln/detail/CVE-2024-25641)