## CVE-2025-24813 Apache Tomcat 远程代码执行漏洞

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 9.0.0.M1 <= version <= 9.0.98, 10.1.0-M1 <= version <= 10.1.34, 11.0.0-M1 <= version <= 11.0.2

**利用条件:** 需要满足以下条件：1. 启用了Default Servlet的写入功能（默认禁用）；2. 启用了Partial PUT支持（默认启用）；3. 应用使用Tomcat的文件存储session；4. 应用包含可用于反序列化攻击的库。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-24813是Apache Tomcat中的一个远程代码执行漏洞，源于路径等价性问题以及对部分PUT请求处理不当。攻击者可以通过上传恶意序列化payload到服务器，在特定条件下利用反序列化机制执行任意代码。

**有效性：**
提供的PoC代码尝试通过PUT请求上传恶意序列化的session文件到服务器，如果服务器满足漏洞利用的条件（启用了Default Servlet写入、启用了Partial PUT、使用文件存储session、存在可利用的反序列化库），则可以触发远程代码执行。从搜索结果来看，该漏洞已经在野外被利用。

**投毒风险：**
PoC代码主要由Python脚本组成，功能是：
1.  检测目标URL是否允许PUT请求。
2.  生成恶意序列化payload（使用ysoserial，如果指定）。
3.  上传payload到服务器。
4.  触发反序列化。

代码中主要操作是构造HTTP请求和调用ysoserial生成payload，没有发现明显的恶意代码或者后门。

存在投毒的微小可能性：ysoserial依赖本身可能包含未知的漏洞或后门，但PoC本身只是调用了ysoserial，风险较低。

**利用方式：**
1.  **检查前提条件:** 验证目标Tomcat服务器是否满足利用条件，包括Tomcat版本、Default Servlet写入是否启用、Partial PUT是否启用、是否使用文件存储session以及是否存在可利用的反序列化库。
2.  **生成Payload:** 使用ysoserial或其他工具生成包含恶意代码的序列化payload。Payload通常是精心构造的Java对象，在反序列化时会执行指定的命令。
3.  **上传Payload:** 利用Tomcat的Partial PUT功能，将payload上传到服务器上的session存储目录（通常是`./sessions/`）。攻击者可能需要利用路径遍历（例如，`uploads/../sessions/`）来绕过限制。
4.  **触发反序列化:**  通过访问特定的URL或执行其他操作，触发Tomcat反序列化上传的session文件。反序列化过程会执行payload中包含的恶意代码，导致远程代码执行。

**修复建议：**
升级到Apache Tomcat 11.0.3, 10.1.35 或 9.0.98及以上版本。
禁用Default Servlet的写入功能，除非绝对必要。
限制对session存储目录的访问。

**项目地址:** [GadaLuBau1337/CVE-2025-24813](https://github.com/GadaLuBau1337/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)