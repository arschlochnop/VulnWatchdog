## CVE-2022-21449 Psychic Signatures

**漏洞编号:** CVE-2022-21449

**漏洞类型:** ECDSA签名绕过

**影响应用:** Java SE JDK and JRE, Oracle GraalVM Enterprise Edition

**危害等级:** 高危，允许未经验证的攻击者修改数据

**影响版本:** Oracle Java SE: 17.0.2 and 18; Oracle GraalVM Enterprise Edition: 21.3.1 and 22.0.0.2

**利用条件:** 需要目标系统运行受影响的Java版本，并且客户端需要进行TLS握手。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-21449，也被称为“Psychic Signatures”，是一个存在于Java ECDSA签名验证中的严重漏洞。该漏洞源于对ECDSA签名验证算法的不正确实现，在Java 15中引入。攻击者可以利用该漏洞，通过提供一个 r=0, s=0 的无效签名来绕过ECDSA的校验，从而进行未授权的操作。

**有效性：**

提供的PoC代码通过修改golang的`crypto/ecdsa`库，使其返回r=s=0的无效签名，并修改`crypto/tls`库，禁用私钥与证书公钥匹配的验证，成功地利用了此漏洞。PoC代码中包含一个模拟恶意TLS服务器，以及一个容易受攻击的Java客户端。

**投毒风险：**

PoC代码本身是为了演示漏洞而设计的，但存在一定的投毒风险。主要体现在以下几个方面：

1.  **修改标准库：** 该PoC需要修改Go语言的标准加密库(`crypto/ecdsa`和`crypto/tls`)。如果攻击者分发了包含这些恶意修改的Go语言环境，开发者在不知情的情况下使用这些被修改的库，可能会导致更广泛的安全问题。
2.  **依赖构建脚本：** `build.sh`脚本用于构建PoC。攻击者可能会在脚本中加入恶意代码，例如下载和执行恶意程序。虽然提供的脚本看起来比较简单，但仍需保持警惕。
3.  **漏洞利用方式：**
    *   攻击者搭建一个恶意的TLS服务器。
    *   恶意服务器向客户端提供一个包含ECDSA公钥的有效证书链（例如，www.google.com）。
    *   但是，服务器在TLS握手期间发送的ECDSA签名是无效的（r=0, s=0）。
    *   由于存在CVE-2022-21449漏洞，客户端会错误地接受这个无效签名，从而完成TLS握手。
    *   攻击者现在可以冒充受信任的服务器，并执行各种恶意操作，例如窃取用户凭据或注入恶意代码。

**风险评估：**

由于PoC代码需要修改底层加密库，如果被恶意利用，可能导致供应链攻击。用户应警惕来路不明的Go环境和依赖，并仔细审查构建脚本。该仓库中潜在的投毒风险约为10%，主要集中在对golang标准库的修改和构建脚本的潜在恶意代码中。

**项目地址:** [notkmhn/CVE-2022-21449-TLS-PoC](https://github.com/notkmhn/CVE-2022-21449-TLS-PoC)

**漏洞详情:** [CVE-2022-21449](https://nvd.nist.gov/vuln/detail/CVE-2022-21449)