## CVE-2022-33140-Apache NiFi/Registry-命令注入

**漏洞编号:** CVE-2022-33140

**漏洞类型:** 命令注入

**影响应用:** Apache NiFi/Registry

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** NiFi: 1.10.0 <= version <= 1.16.2, Registry: 0.6.0 <= version <= 1.16.2

**利用条件:** 需要启用 ShellUserGroupProvider，且攻击者需要具有相应的身份验证和授权，NiFi需要修改访问策略的授权，Registry需要读取用户组的授权

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-33140是Apache NiFi和NiFi Registry中的一个命令注入漏洞。漏洞位于可选的ShellUserGroupProvider中，该Provider在处理用户组解析命令时，没有充分过滤参数，导致攻击者可以通过注入恶意操作系统命令来执行任意代码。该漏洞利用需要满足多个条件：

1.  必须启用ShellUserGroupProvider，默认配置中未启用。
2.  攻击者需要经过身份验证，并具有足够的权限。对于NiFi，需要修改访问策略的授权；对于NiFi Registry，需要读取用户组的授权。

提供的“漏洞利用代码”实际上是一个包含开发者PGP密钥的文件（`KEYS`），该文件本身**不包含任何漏洞利用代码**，也**不构成投毒**。此文件不是PoC，只是开发者的公钥列表，用于验证软件的完整性。

**利用方式：**

1.  **配置检查：** 确认目标系统启用了 ShellUserGroupProvider。
2.  **权限获取：** 获得经过身份验证的具有足够权限的用户身份。
3.  **命令注入：** 构造包含恶意命令的输入，该输入会传递给 ShellUserGroupProvider 进行处理，导致命令注入。
4.  **代码执行：** 恶意命令在目标系统上执行，导致远程代码执行。

由于提供的密钥文件不是PoC，因此判断该文件中存在投毒代码的可能性为0%。

**项目地址:** [shoucheng3/apache__nifi_CVE-2022-33140_1-16-2](https://github.com/shoucheng3/apache__nifi_CVE-2022-33140_1-16-2)

**漏洞详情:** [CVE-2022-33140](https://nvd.nist.gov/vuln/detail/CVE-2022-33140)