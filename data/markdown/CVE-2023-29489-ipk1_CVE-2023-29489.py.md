## CVE-2023-29489-cPanel-XSS

**漏洞编号:** CVE-2023-29489

**漏洞类型:** 跨站脚本 (XSS)

**影响应用:** cPanel

**危害等级:** 中危，可能导致账户劫持、敏感信息泄露或恶意代码执行

**影响版本:** before 11.109.9999.116

**利用条件:** 目标服务器运行存在漏洞的cPanel版本，且用户访问恶意链接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-29489 是 cPanel 中存在的一个反射型跨站脚本漏洞。该漏洞位于 `cpsrvd` 错误页面，攻击者可以通过构造包含恶意 JavaScript 代码的 `cpanelwebcall` URL，当用户访问该 URL 时，恶意代码将在用户的浏览器中执行。

**有效性：**

提供的 PoC 代码尝试通过 Shodan 搜索暴露 cPanel 界面的主机，然后构造包含 XSS 载荷的 URL 并发送请求。代码会检查响应中是否存在带有 `onerror` 属性的 `<img>` 标签，如果存在，则判定目标主机存在漏洞。该方法相对有效，可以验证漏洞的存在。

**投毒风险：**

PoC 代码本身包含潜在的风险，主要在于以下几点：

*   **使用了 `verify=False` 关闭 SSL 验证：**这使得脚本容易受到中间人攻击，可能导致敏感信息泄露，如 Shodan API 密钥。
*   **Shodan API 密钥硬编码：**将 Shodan API 密钥硬编码在脚本中是不安全的做法。如果脚本被泄露，密钥也将暴露。
*   **错误处理：**错误处理部分相对简单，可能会忽略某些类型的错误，导致程序崩溃或无法完成预期的功能。

尽管存在这些风险，PoC 代码本身并无明显的恶意代码。投毒风险主要集中在使用者对代码的安全性不重视导致。因此，投毒风险评定为 10%。

**利用方式：**

1.  **信息收集：**利用 Shodan 或其他搜索引擎找到暴露 cPanel 界面的目标主机。
2.  **构造恶意 URL：**构造包含 XSS 载荷的 `cpanelwebcall` URL，例如：`https://target/cpanelwebcall/<img%20src=x%20onerror="prompt(1)">aaaaaaaaaaaa`。
3.  **诱骗用户点击：**将恶意 URL 发送给目标用户，诱骗其点击。这可以通过钓鱼邮件、社交媒体或其他方式实现。
4.  **执行恶意代码：**当用户点击恶意 URL 时，cPanel 服务器会返回包含 XSS 载荷的错误页面。用户的浏览器会执行该载荷，从而导致恶意代码执行。恶意代码可以执行各种操作，例如：窃取用户的 Cookie、重定向用户到恶意网站、篡改页面内容等。

**缓解措施：**

*   升级 cPanel 到修复后的版本（>= 11.109.9999.116）。
*   实施输入验证和输出编码，以防止 XSS 攻击。
*   教育用户识别和避免点击可疑链接。

**项目地址:** [ipk1/CVE-2023-29489.py](https://github.com/ipk1/CVE-2023-29489.py)

**漏洞详情:** [CVE-2023-29489](https://nvd.nist.gov/vuln/detail/CVE-2023-29489)