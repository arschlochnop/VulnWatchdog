## CVE-2025-29927-Next.js-中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，未经授权访问敏感资源

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** 应用程序使用Next.js中间件进行身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 是 Next.js 中间件授权绕过漏洞。攻击者可以通过操纵 `x-middleware-subrequest` 头部绕过中间件中的安全控制。根据搜索引擎结果，这是一个严重的安全漏洞，CVSS 评分高达 9.1，并且很容易被利用。漏洞库信息确认了该漏洞存在于多个 Next.js 版本中，并建议阻止包含 `x-middleware-subrequest` 头的外部请求。提供的代码看起来像是一个使用 NextAuth.js 实现身份验证的 Next.js 应用程序示例，包含用于保护路由的中间件。`middleware.js` 文件中实现了路由保护逻辑，依赖 `next-auth/jwt` 来验证 token。如果 `x-middleware-subrequest` 头部可以绕过 `getToken` 的验证逻辑，则可以未经授权访问受保护的路由。

**漏洞利用方式：**

1.  攻击者发送包含 `x-middleware-subrequest` 头的恶意请求。
2.  如果中间件对 `x-middleware-subrequest` 头的处理不当，可能绕过身份验证检查。
3.  攻击者获得对受保护路由的未经授权的访问权限。

**投毒风险分析：**

分析提供的代码仓库，发现潜在的投毒点较少。主要集中在以下方面：

*   **依赖项：** `package.json` 文件中声明的依赖项可能包含恶意代码。不过，这些都是常用的库，风险相对较低。
*   **环境变量：** `.env.local` 文件中的环境变量如果被泄露，可能导致安全问题。但这是应用程序配置问题，不属于投毒。

总体来看，投毒风险较低，大约为10%。风险主要来自于潜在的供应链攻击，即依赖项中包含恶意代码的可能性。

**有效性评估：**

提供的代码似乎是一个用于演示 Next.js 身份验证的示例应用程序，本身并不包含利用 CVE-2025-29927 漏洞的代码。但是通过在发送到此示例应用程序的请求添加 `x-middleware-subrequest` 头部，可以测试该漏洞的存在。

**优先级：**

由于搜索引擎结果和漏洞库信息都表明 CVE-2025-29927 是一个严重且容易被利用的漏洞，因此应优先修复。


**项目地址:** [strobes-security/nextjs-vulnerable-app](https://github.com/strobes-security/nextjs-vulnerable-app)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)