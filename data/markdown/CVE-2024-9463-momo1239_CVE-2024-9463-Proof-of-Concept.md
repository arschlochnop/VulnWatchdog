## CVE-2024-9463-Palo Alto Networks Expedition-OS 命令注入

**漏洞编号:** CVE-2024-9463

**漏洞类型:** OS 命令注入

**影响应用:** Palo Alto Networks Expedition

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 1.2.96

**利用条件:** 目标系统运行存在漏洞的 Expedition 版本，且攻击者可以访问目标系统的web服务端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-9463 是 Palo Alto Networks Expedition 中的一个 OS 命令注入漏洞。未经验证的攻击者可以利用此漏洞以 root 权限在 Expedition 上执行任意 OS 命令，从而可能泄露用户名、明文密码、设备配置以及 PAN-OS 防火墙的设备 API 密钥。

**有效性：**

提供的 PoC 代码看起来是有效的。它通过构造恶意的 `ram` 参数，在 `/API/convertCSVtoParquet.php` 路径上执行命令注入。PoC 代码首先创建一个反向 shell 脚本，然后在攻击者控制的 HTTP 服务器上托管此脚本，并通过命令注入使其在目标系统上执行，从而建立反向 shell 连接。

**投毒风险：**

该 PoC 主要功能是利用漏洞建立反向 Shell，虽然存在风险，但没有明显的恶意投毒代码。风险点在于：

*   创建的`bash.sh`脚本有可能被修改为其他恶意代码。但从当前代码来看，这个可能性不大，风险较低。

所以,投毒风险评估为 5%。

**利用方式：**

1.  **准备攻击环境：** 攻击者需要一个公网 IP 地址，并运行一个 HTTP 服务器和一个 netcat 监听器。
2.  **创建反向 shell 脚本：** PoC 代码会生成一个 `bash.sh` 文件，包含连接攻击者 IP 地址和端口的反向 shell 命令。
3.  **启动 HTTP 服务器：** PoC 代码会在指定的 HTTP 端口上托管 `bash.sh` 文件。
4.  **启动 netcat 监听器：** PoC 代码会在指定的端口上启动 netcat 监听器，等待反向 shell 连接。
5.  **构造恶意请求：** PoC 代码会构造一个包含恶意 `ram` 参数的 POST 请求，发送到目标 Expedition 系统的 `/API/convertCSVtoParquet.php` 路径。该参数利用命令注入执行 `curl` 命令，从攻击者的 HTTP 服务器下载 `bash.sh` 脚本并在目标系统上执行。
6.  **获取反向 shell：** 如果漏洞利用成功，目标系统将建立与攻击者 netcat 监听器的反向 shell 连接，攻击者可以以 root 权限执行任意命令。

**修复方案：**

升级到 Expedition 1.2.96 或更高版本。升级后，所有 Expedition 用户名、密码和 API 密钥，以及所有被 Expedition 处理的防火墙用户名、密码和 API 密钥都应该轮换。

**项目地址:** [momo1239/CVE-2024-9463-Proof-of-Concept](https://github.com/momo1239/CVE-2024-9463-Proof-of-Concept)

**漏洞详情:** [CVE-2024-9463](https://nvd.nist.gov/vuln/detail/CVE-2024-9463)