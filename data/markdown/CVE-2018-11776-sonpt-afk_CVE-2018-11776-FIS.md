## CVE-2018-11776-Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致远程代码执行，完全控制服务器

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定命名空间配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 是 Apache Struts 2 的一个远程代码执行漏洞。当 `alwaysSelectFullNamespace` 设置为 `true`，并且存在特定的命名空间配置时，攻击者可以通过构造恶意的 OGNL 表达式来实现远程代码执行。

**有效性:**

根据漏洞描述和搜索结果，此漏洞的POC代码是有效的。存在多个公开的POC和利用脚本，证明了该漏洞的可利用性。提供的Python POC 代码通过构造包含恶意 OGNL 表达式的 Content-Type 请求头，绕过 Struts 的安全机制，从而执行任意命令。

**投毒风险:**

分析提供的POC代码，主要关注以下几个方面：
*   **代码逻辑:** 代码逻辑相对清晰，主要是构造 OGNL 表达式并发送 HTTP 请求执行命令。
*   **外部依赖:** 代码使用了 `http.client`, `urllib.request`, `ssl`, `subprocess`, `sys` 这些标准库，没有引入额外的第三方库，降低了引入恶意代码的可能性。
*   **命令执行:** 代码通过 `subprocess` 模块执行命令，虽然这本身是漏洞利用的一部分，但也需要注意是否存在精心构造的命令，例如下载并执行恶意脚本。
*   **README.md**: README 描述了漏洞和影响，没有发现恶意链接或者描述。

综合分析，该POC代码主要实现了漏洞利用，没有发现明显的投毒代码。`subprocess` 执行的命令由用户指定，不在POC代码本身中定义。考虑到代码由用户自定义命令执行，以及需要目标满足一定环境条件，投毒的概率较低，大约为10%。

**利用方式:**

1.  **漏洞触发:** 漏洞触发的关键在于 `alwaysSelectFullNamespace` 设置为 `true`，同时应用存在特定的命名空间配置（例如，没有明确的命名空间或使用通配符命名空间）。
2.  **OGNL 表达式注入:** 攻击者构造包含恶意 OGNL 表达式的 URL 或请求参数。该表达式可以执行任意 Java 代码。
3.  **远程代码执行:** Struts 框架解析 OGNL 表达式，导致恶意代码执行，从而允许攻击者在服务器上执行任意命令。
4.  **利用POC代码:** 提供的POC代码通过修改请求头的Content-Type，注入OGNL表达式，利用了该漏洞，实现了在目标服务器上执行任意命令。

**项目地址:** [sonpt-afk/CVE-2018-11776-FIS](https://github.com/sonpt-afk/CVE-2018-11776-FIS)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)