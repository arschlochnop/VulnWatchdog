## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 6.6.12 之前 (6.6.x修复版本), 6.7.0 到 6.12.3 之前 (6.12.x修复版本), 6.13.0 到 6.13.3 之前 (6.13.x修复版本), 以及 6.14.0 到 6.14.2 之前 (6.14.x修复版本)

**利用条件:** 需要能够访问Confluence服务器并利用Widget Connector宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞，存在于 Widget Connector 宏中。攻击者可以利用 Velocity 模板语言执行任意代码。漏洞利用代码 `rce.vm` 使用了 Velocity 模板注入，通过反射获取 `java.lang.Runtime` 类，然后调用 `exec` 方法来执行命令。在这个例子中，执行的是 `calc.exe`，这是一个用于测试的payload，实际应用中可以替换为任意命令。根据漏洞库信息、搜索结果和漏洞利用代码，该漏洞的利用是有效的。根据搜索结果，该漏洞已被积极利用，攻击者利用该漏洞传播恶意软件，例如 Gandcrab 勒索软件和加密货币挖矿恶意软件。提供的POC代码非常直接，只包含简单的RCE代码，不存在隐藏的投毒代码。利用方式是通过构造恶意请求，在Widget Connector宏中使用恶意的Velocity模板代码，从而实现远程代码执行。

**项目地址:** [dothanthitiendiettiende/CVE-2019-3396](https://github.com/dothanthitiendiettiende/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)