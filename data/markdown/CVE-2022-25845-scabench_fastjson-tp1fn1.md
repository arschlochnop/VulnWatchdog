## CVE-2022-25845-fastjson-反序列化

**漏洞编号:** CVE-2022-25845

**漏洞类型:** 反序列化

**影响应用:** com.alibaba:fastjson

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 1.2.83

**利用条件:** 需要目标系统使用存在漏洞版本的fastjson，且autoType未被禁用或配置不当

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25845 是一个 fastjson 的反序列化漏洞，攻击者可以通过构造恶意的 JSON 数据，绕过 autoType 检查，从而在目标系统上执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和提供的 POC 代码，可以判断该漏洞利用是有效的。漏洞信息明确指出 fastjson 在 1.2.83 之前的版本存在反序列化漏洞，且可以通过绕过 autoType 限制来执行远程代码。搜索结果中也有多个链接指向漏洞分析和利用，其中一个链接甚至是exploit的github仓库地址。提供的 POC 代码 `CVE-2022-25845.json`  利用 `java.lang.Exception` 结合 `Trigger` 尝试触发命令执行(touch foo)，这是一种常见的 fastjson 反序列化漏洞利用方式。

**投毒风险：**

提供的 POC 代码包含一个 JSON 文件 (`CVE-2022-25845.json`) 和一个 Apache 2.0 许可文件 (`LICENSE`)。JSON 文件中包含用于触发漏洞的 payload，尝试执行 `touch foo` 命令。LICENSE 文件是标准的开源许可协议，本身不包含恶意代码。初步判断投毒风险较低，LICENSE是开源协议,本身不涉及投毒，payload部分touch foo的命令相对温和，但是并不能完全排除作者在其他分支或提交历史中隐藏恶意代码的可能性，比如更隐蔽的反弹shell等。综合判断，投毒风险约为 10%。

**利用方式：**

1.  **漏洞原理：** fastjson 在处理 JSON 数据时，如果启用了 autoType 功能，允许 JSON 数据中指定反序列化的类名。攻击者可以利用这个功能，构造恶意的 JSON 数据，指定反序列化某些特定的类，这些类在被反序列化时会执行任意代码。
2.  **利用过程：**
    *   攻击者构造包含恶意类名的 JSON 数据，例如 `java.lang.Exception`和`Trigger`，利用特定的类和属性来触发命令执行。
    *   攻击者将构造的 JSON 数据发送给使用了存在漏洞版本的 fastjson 的应用程序。
    *   fastjson 在反序列化 JSON 数据时，会根据 JSON 数据中指定的类名来创建对象。
    *   如果指定的类存在安全漏洞，例如可以执行任意代码，那么攻击者就可以利用这个漏洞来执行任意代码。

**总结：**

CVE-2022-25845 是一个高危的反序列化漏洞，攻击者可以利用它来执行远程代码。受影响的应用程序应该尽快升级到 fastjson 1.2.83 或更高版本，或者启用 safeMode 来缓解这个漏洞。

**项目地址:** [scabench/fastjson-tp1fn1](https://github.com/scabench/fastjson-tp1fn1)

**漏洞详情:** [CVE-2022-25845](https://nvd.nist.gov/vuln/detail/CVE-2022-25845)