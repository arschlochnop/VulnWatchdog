## CVE-2015-3306-ProFTPD mod_copy 远程代码执行

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 远程代码执行

**影响应用:** ProFTPD

**危害等级:** 高危，可远程读取和写入任意文件，最终执行任意代码

**影响版本:** 1.3.5

**利用条件:** ProFTPD服务器开启mod_copy模块，且允许匿名访问(非必须，但降低利用难度)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2015-3306漏洞存在于ProFTPD 1.3.5版本的mod_copy模块中。攻击者可以利用`SITE CPFR`和`SITE CPTO`命令读取和写入服务器上的任意文件，从而导致远程代码执行。

**利用方式：**

1.  **连接目标FTP服务器：** 建立到目标 ProFTPD 服务器的 FTP 连接。
2.  **利用 `SITE CPFR` 和 `SITE CPTO` 写入webshell:**  通过 `SITE CPFR /proc/self/cmdline` 读取当前 ProFTPD 进程的命令行，然后使用 `SITE CPTO` 将包含恶意 PHP 代码的webshell写入服务器的可访问目录（例如 `/var/www/html`）。该webshell执行GET请求中cmd参数的内容。
3.  **执行任意命令:** 通过访问写入的webshell(http://<target>/shell.php?cmd=<command>)，执行任意命令。
4.  **上传反弹shell:**  利用写入的webshell,使用wget命令，将攻击者服务器上的反弹shell脚本上传到目标机器,并执行.

**有效性：**

提供的PoC代码（`ftp.py`）基于Metasploit模块转换而来，理论上是有效的，但是需要目标服务器开启mod_copy模块，并且需要知道目标服务器的web目录。

**投毒风险：**

PoC代码本身可能存在细微的投毒风险。虽然主要功能是利用漏洞，但存在以下潜在风险：

*   **后门植入：**  虽然 PoC 没有明显的后门代码，但攻击者可能修改 PoC，在目标服务器上植入持久性后门（例如，修改系统文件或添加计划任务），以便长期控制目标系统。

*   **恶意脚本下载：**  PoC 下载并执行 `run.php` 脚本，这个脚本的内容完全由攻击者控制。如果攻击者的服务器被攻破或脚本被替换，目标服务器可能下载并执行恶意代码。

*   **信息收集：**  PoC 可能收集目标服务器的信息（例如，操作系统版本、已安装软件列表）并发送给攻击者。

综上所述，认为存在5%的投毒风险，主要是由于下载执行未知脚本带来的潜在威胁，以及人工修改后植入后门的可能。

**排序优先级解释：**

*   **搜索引擎结果：** 搜索结果验证漏洞的存在，并提供了一些利用该漏洞的途径。
*   **漏洞利用代码：**  漏洞利用代码，是验证和复现漏洞的关键，通过代码分析可以理解漏洞的利用方式和影响。
*   **漏洞库信息：**  漏洞库信息提供了漏洞的基本描述、影响和相关参考链接。

**项目地址:** [cd6629/CVE-2015-3306-Python-PoC](https://github.com/cd6629/CVE-2015-3306-Python-PoC)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)