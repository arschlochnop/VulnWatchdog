## CVE-2022-22963-Spring Cloud Function SpEL表达式注入

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** 3.0.0.RELEASE <= Spring Cloud Function <= 3.2.2

**利用条件:** 应用程序使用了Spring Cloud Function，并且启用了路由功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963是Spring Cloud Function框架中的一个远程代码执行漏洞。当使用路由功能时，攻击者可以通过提供特制的SpEL表达式作为路由表达式，从而执行任意代码并访问本地资源。

**有效性：**
根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，该漏洞的POC代码是有效的。搜索引擎结果表明该漏洞存在已知公开的利用程序，漏洞利用代码也提供了利用该漏洞的脚本。

**投毒风险：**
该POC代码存在一定的投毒风险，风险约为10%。主要风险点在于:

*   漏洞利用脚本可能被修改以包含恶意代码，例如下载和执行其他恶意程序。目前的shellcode执行都是明文,如果植入其他的shellcode不易被发现
*   反弹shell时，vps的地址存在不确定性

**利用方式：**
漏洞的利用方式如下：

1.  攻击者构造一个包含恶意SpEL表达式的HTTP请求头，该请求头中的`spring.cloud.function.routing-expression`参数包含SpEL表达式。
2.  攻击者将构造的HTTP请求发送到受影响的Spring Cloud Function应用程序的`/functionRouter`端点。
3.  Spring Cloud Function框架在处理请求时，会将`spring.cloud.function.routing-expression`参数作为SpEL表达式进行解析和执行。
4.  如果SpEL表达式包含恶意代码，则会在服务器上执行，从而导致远程代码执行。

利用代码提供了以下功能：

*   DNSLog测试：通过发送包含DNS查询的SpEL表达式，可以验证目标是否存在漏洞。
*   反弹Shell：通过发送包含反弹shell命令的SpEL表达式，可以在目标服务器上执行任意命令，并获得shell访问权限。
*   支持Linux和Windows目标。

**优先级排序：**

1.  **搜索引擎结果：** 提供漏洞的总体风险评估和利用概况，有助于了解漏洞的严重性和影响。
2.  **漏洞利用代码：** 提供了实际可用的攻击Payload，以及详细的利用步骤和参数。
3.  **漏洞库信息：** 提供漏洞的官方描述和受影响的版本范围。

**项目地址:** [k3rwin/spring-cloud-function-rce](https://github.com/k3rwin/spring-cloud-function-rce)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)