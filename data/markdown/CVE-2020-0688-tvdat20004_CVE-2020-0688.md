## CVE-2020-0688-Microsoft Exchange Server-RCE

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/15, 2019 CU3/4

**利用条件:** 需要有效的Exchange用户凭据，且目标服务器存在CVE-2020-0688漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688 漏洞是由于 Microsoft Exchange Server 在处理内存中的对象时未能正确操作而导致的远程代码执行漏洞。攻击者可以通过利用静态密钥进行 ViewState 反序列化，从而在服务器上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，此漏洞的利用是有效的。漏洞利用的关键在于利用 Exchange 控制面板 (ECP) 中使用的静态密钥来构造恶意的 ViewState。提供的POC代码尝试自动化这一过程，包括登录OWA, 获取相关参数，然后使用 ysonet.exe 生成恶意 ViewState，最后发送带有恶意ViewState的请求。

**投毒风险：**
虽然POC代码本身旨在利用已知的漏洞，但潜在的投毒风险是存在的。代码中的投毒点可能包括：
1.  `ysonet.exe`：POC依赖外部程序`ysonet.exe`，如果下载的 `ysonet.exe` 文件被篡改，则可能执行恶意的代码，导致攻击者主机中毒。
2.  执行命令：`command` 参数通过`ysonet.exe`在目标服务器执行，如果攻击者更改此参数，可能在目标服务器上执行恶意代码。下载ysoserial.net和更改command参数的风险较高。

因此，代码中存在一定的投毒风险，大约为10%。

**利用方式：**
1.  **身份验证：** 首先，攻击者需要有效的 Exchange 用户凭据，使用用户名密码登录目标OWA。
2.  **获取参数：**  利用脚本获取目标Exchange服务器的`__VIEWSTATEGENERATOR`和`ASP.NET_SessionId`（`session_id`）等参数。
3.  **生成恶意 ViewState：** 使用 `ysonet.exe` 工具，结合静态密钥 (`validationKey` 和 `validationAlg`)以及上一步获取的参数，构造恶意的 ViewState。`ysonet.exe`程序的功能是将命令序列化到ViewState中。
4.  **发送请求：**  将生成的恶意 ViewState 作为参数（`__VIEWSTATE`）发送到 `/ecp/default.aspx` 页面。
5.  **代码执行：**  服务器反序列化 ViewState，执行其中嵌入的恶意代码。

**项目地址:** [tvdat20004/CVE-2020-0688](https://github.com/tvdat20004/CVE-2020-0688)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)