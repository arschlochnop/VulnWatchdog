## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行

**影响应用:** ingress-nginx

**危害等级:** 高危，可能导致集群接管

**影响版本:** <= 1.11.4, 1.12.0

**利用条件:** 需要访问Pod网络

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-1974是一个存在于Kubernetes ingress-nginx的严重远程代码执行漏洞（RCE），被称为'IngressNightmare'。未经身份验证的攻击者如果能够访问Pod网络，可以通过利用Validating Admission Controller中的漏洞来执行任意代码。

**有效性：**

提供的POC代码看起来是有效的。它包含构建恶意共享库（.so文件）的Makefile、说明漏洞利用方式的README.md文件。

从提供的Makefile分析,`danger.c`会被编译为`danger.so`文件，这符合利用描述中上传恶意.so文件的步骤. 同时，`bad_config.conf` 看起来是用于触发漏洞的恶意 Nginx 配置文件。

README.md文件描述了漏洞的详细信息、影响、受影响的版本、利用方式以及缓解步骤，这进一步佐证了POC代码的有效性。

**投毒风险：**

投毒风险较低，约为5%。虽然`danger.c`本身的代码内容未提供，理论上可能存在恶意行为，例如植入后门。但是，考虑到攻击流程主要依赖于上传.so文件和配置文件的注入，恶意代码更可能存在于`danger.c`中。同时`bad_config.conf`也可能存在后门，但概率较低. 总体上, 风险较低. README.md的完整描述提升了可信度,降低投毒的可能性。 

**利用方式：**

1.  **上传恶意.so文件：** 攻击者通过发送一个大的HTTP POST请求，触发NGINX的`client-body buffering`，从而将恶意.so文件存储为临时文件。
2.  **注入恶意配置：** 攻击者构造恶意的`AdmissionReview`请求，通过注入`ssl_engine`指令将.so文件的路径写入临时的 Nginx 配置文件。这是通过向admission validating webhook server发送请求实现的。
3.  **触发RCE：**  Admission webhook运行 `nginx -t` 命令来检查配置文件，这会加载恶意的.so文件，从而导致在Ingress controller Pod中执行任意代码。`nginx -t` 命令的执行是漏洞触发的关键。

漏洞利用需要攻击者能够访问Pod网络，这意味着攻击通常发生在集群内部。

**项目地址:** [B1ack4sh/Blackash-CVE-2025-1974](https://github.com/B1ack4sh/Blackash-CVE-2025-1974)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)