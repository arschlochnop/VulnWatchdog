## CVE-2023-50164-Apache Struts-RCE

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 2.0.0 <= Struts <= 2.5.32 或 6.0.0 <= Struts <= 6.3.0.1

**利用条件:** 需要目标系统运行存在漏洞的Apache Struts版本，并且存在文件上传功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164是一个Apache Struts框架中的文件上传漏洞，攻击者可以通过操纵文件上传参数，实现路径遍历，进而上传恶意文件，最终导致远程代码执行。根据搜索引擎结果（例如，Arctic Wolf的博客），已经存在公开的PoC被利用。提供的漏洞利用代码包含一个Dockerfile，用于构建包含漏洞Struts应用的环境。Dockerfile中：

1.  安装了OpenJDK 17和必要的工具（wget, curl）。
2.  下载并配置了存在漏洞的Tomcat 9.0.83。
3.  下载并部署了一个名为"upload-1.0.0.war"的包含漏洞的WAR文件，该文件来自GitHub仓库[https://github.com/Thirukrishnan/CVE-2023-50164-Apache-Struts-RCE/raw/main/upload-1.0.0.war]。这个WAR文件是专门为复现这个漏洞设计的。
4. 暴露了8080端口，用于访问Tomcat服务器。

**有效性：** 提供的Dockerfile和WAR文件可以有效复现CVE-2023-50164漏洞，搭建一个存在漏洞的环境。

**投毒风险：** 虽然整体代码是为了复现漏洞，但存在轻微的投毒风险，原因如下：
*   Dockerfile直接从GitHub下载WAR文件，这依赖于外部资源的可信度。如果GitHub上的WAR文件被篡改，那么构建的镜像也会包含恶意代码。这种风险的百分比估计为10%，因为原作者可能已经做了验证措施,或者github代码库本身有安全保护措施.

**利用方式：**

1.  攻击者利用路径遍历漏洞，通过修改文件上传参数，将恶意文件上传到服务器的任意目录。
2.  上传的文件通常是包含恶意代码的JSP或WAR文件。
3.  攻击者通过访问上传的恶意文件，触发恶意代码，从而实现远程代码执行。
4. 具体而言，通过修改上传的文件名参数，例如`filename="../../../../tmp/shell.jsp"`，可以将文件上传到/tmp目录下。然后，访问`http://ip-address:port/tmp/shell.jsp`即可执行其中的代码。利用方式详细信息见参考链接中的相关分析。


**项目地址:** [Thirukrishnan/CVE-2023-50164-Apache-Struts-RCE](https://github.com/Thirukrishnan/CVE-2023-50164-Apache-Struts-RCE)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)