## CVE-2023-22518-Confluence-不当授权漏洞

**漏洞编号:** CVE-2023-22518

**漏洞类型:** 不当授权

**影响应用:** Confluence Data Center and Server

**危害等级:** 严重，可能导致完全丧失机密性、完整性和可用性

**影响版本:** 所有版本（不受影响的版本除外，详见漏洞库信息）

**利用条件:** 需要网络访问 Confluence 服务

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞库信息和搜索引擎结果，CVE-2023-22518 是一个 Confluence Data Center 和 Server 的不当授权漏洞。未经身份验证的攻击者可以利用此漏洞重置 Confluence 并创建一个 Confluence 实例管理员帐户。使用此帐户，攻击者可以执行 Confluence 实例管理员可用的所有管理操作，从而导致完全丧失机密性、完整性和可用性。

**有效性：**
该POC代码主要侧重于环境搭建和调试分析，并没有提供直接可用的exp。文档描述了如何搭建存在漏洞的环境，并指导开发者如何通过diff新旧版本jar包，并使用断点调试来理解漏洞原理。因此，可以认为该POC代码提供了漏洞分析的基础，但缺乏直接利用的payload。

**投毒风险：**
该存储库包含了一些环境搭建和调试的截图，其中MySQL数据库配置部分包含了创建数据库和用户的SQL语句。这些SQL语句本身不具有投毒性，但如果用户直接复制粘贴到生产环境，并使用了文档中提供的弱口令（如`admin123`和`supersecure`），则会引入安全风险。同时，提供的`my.cnf`配置文件中的`log_bin_trust_function_creators = 1`配置，若非必要，在生产环境中开启也存在一定风险。代码仓库本身旨在分析漏洞，但其中一些配置如果被不安全地采用，可能会导致安全问题。因此，投毒风险评估为30%。

**利用方式：**
利用方式主要是通过未授权访问相关接口，重置 Confluence 实例并创建管理员账户。结合搜索引擎信息，确认漏洞利用无需认证。利用此漏洞可以完全控制受影响的 Confluence 服务器。

**漏洞细节补充:**
根据对提供的代码仓库分析，漏洞根源可能在于 `/json` 命名空间继承自 `/admin` 命名空间，导致原本需要管理员权限才能访问的 `/admin` 下的某些功能，可以直接通过 `/json` 命名空间访问，从而绕过权限校验。

**项目地址:** [Lilly-dox/Exploit-CVE-2023-22518](https://github.com/Lilly-dox/Exploit-CVE-2023-22518)

**漏洞详情:** [CVE-2023-22518](https://nvd.nist.gov/vuln/detail/CVE-2023-22518)