## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 受害者使用存在漏洞的Go版本执行 `go get` 命令来获取包含恶意代码的包。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许通过 `go get` 命令执行远程代码。攻击者可以创建一个包含恶意代码的Go包，并将该包托管在公开的存储库中。当受害者使用 `go get` 命令获取该包时，恶意代码将在构建过程中执行。利用方式为在包中利用 gcc 或 clang 的插件功能（`-fplugin=` 或 `-plugin=` 参数），在编译时执行任意命令。

提供的PoC代码包含两个文件：`attack.c` 和 `main.go`。
*   `attack.c` 文件包含一个名为 `malicious` 的函数，该函数使用 `system` 函数执行命令 `/usr/local/bin/score 356f5d20-43e8-4a8c-b024-f1e42ec7f7f5`。`__attribute__((constructor))` 确保 `malicious` 函数在共享库加载时自动执行。
*   `main.go` 文件使用 cgo 特性。`// #cgo CFLAGS: -fplugin=./attack.so`  指示 `go` 编译器在构建过程中将 `attack.so` 作为 gcc/clang 插件加载。由于 `attack.so` 包含 `malicious` 函数，因此当 `go get` 获取并构建这个包时，`malicious` 函数将被执行，从而实现远程命令执行。

有效性：提供的PoC代码是有效的，如果目标Go版本存在漏洞，则可以成功执行任意命令。

投毒风险：提供的 PoC 仅仅是漏洞演示，执行了一个固定的命令。从提供的 `attack.c` 和 `main.go` 代码来看，并没有发现隐藏的、额外的恶意代码或者后门。作者意图是演示漏洞，而不是进行恶意攻击，风险较低。

利用方式：
1.  攻击者创建一个包含恶意代码的Go包，如提供的PoC代码。
2.  攻击者将该包托管在公开的存储库中。
3.  攻击者诱使受害者使用存在漏洞的Go版本执行 `go get <attacker_repo>` 命令来获取该包。
4.  当受害者执行 `go get` 命令时，恶意代码将在构建过程中执行，从而实现远程命令执行。

**项目地址:** [jahwni/CVE-2018-6574](https://github.com/jahwni/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)