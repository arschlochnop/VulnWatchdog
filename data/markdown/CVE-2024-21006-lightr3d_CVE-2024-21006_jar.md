## CVE-2024-21006 - Oracle WebLogic Server 信息泄露漏洞

**漏洞编号:** CVE-2024-21006

**漏洞类型:** 信息泄露

**影响应用:** Oracle WebLogic Server

**危害等级:** 高危，可能导致未授权访问敏感数据

**影响版本:** 12.2.1.4.0, 14.1.1.0.0

**利用条件:** 需要网络访问WebLogic Server的T3或IIOP端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-21006 是 Oracle WebLogic Server 中的一个高危漏洞，影响版本 12.2.1.4.0 和 14.1.1.0.0。该漏洞允许未经身份验证的攻击者通过 T3 或 IIOP 协议进行网络访问，从而可能导致未经授权访问关键数据或完全访问所有可访问的 Oracle WebLogic Server 数据。

**有效性分析：**

根据提供的漏洞信息和搜索引擎结果，此漏洞的POC是有效的，并且已在野外被利用。POC 代码的 `README.md` 文件说明了如何使用提供的 JAR 文件进行利用，并引用了其他存储库中的相关代码。代码功能明确，可以触发漏洞。

**投毒风险分析：**

分析提供的 POC 代码，`messageDestinationReference.java` 主要功能是利用 JNDI 注入漏洞，通过 IIOP 协议与 WebLogic Server 建立连接，并利用 LDAP 服务器提供的恶意 payload 执行任意代码。虽然代码中存在使用 LDAP 的行为，但其本身属于漏洞利用的一部分，用于远程加载恶意类或执行命令，并非恶意投毒。

`generateRandomString` 方法用于生成随机字符串，目的是解决payload只能打一次的问题，并不会引入恶意代码。

代码中并未发现明显的恶意行为或后门，因此投毒风险较低，初步估计投毒的可能性约为1%。这个数字并不代表绝对安全，仅仅是根据现有信息判断。

**利用方式：**

1.  攻击者通过 T3 或 IIOP 协议与目标 WebLogic Server 建立连接。
2.  攻击者利用 JNDI 注入漏洞，构造恶意的 `MessageDestinationReference` 对象，其中包含指向恶意 LDAP 服务器的 JNDI URL。
3.  当 WebLogic Server 尝试解析该对象时，会连接到指定的 LDAP 服务器。
4.  恶意 LDAP 服务器提供包含恶意代码的 payload，WebLogic Server 加载并执行该 payload，导致远程代码执行。
5.  利用代码通过随机bind字符串，绕过只能利用一次的限制。

**总结：**

该漏洞利用相对简单，只需要提供目标 WebLogic Server 的 IP 地址、端口和恶意 LDAP 服务器的 URL 即可。由于无需身份验证，攻击者可以轻易地利用该漏洞获取敏感信息或执行任意代码。需要及时修复。

**项目地址:** [lightr3d/CVE-2024-21006_jar](https://github.com/lightr3d/CVE-2024-21006_jar)

**漏洞详情:** [CVE-2024-21006](https://nvd.nist.gov/vuln/detail/CVE-2024-21006)