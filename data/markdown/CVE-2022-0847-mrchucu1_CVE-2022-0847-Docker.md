## CVE-2022-0847 Dirty Pipe 本地提权漏洞

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可使低权限用户获得 root 权限

**影响版本:** 5.8 及以上，Linux Kernel 5.17 rc6

**利用条件:** 本地用户访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-0847 (Dirty Pipe) 漏洞是 Linux 内核中的一个权限提升漏洞，允许本地非特权用户覆盖只读文件中的数据。该漏洞源于 `copy_page_to_iter_pipe` 和 `push_pipe` 函数中新的管道缓冲区结构的 `flags` 成员缺乏适当的初始化，可能包含陈旧的值。利用此漏洞，攻击者可以修改 SUID 可执行文件或 `/etc/passwd` 文件，从而获得 root 权限。

**漏洞利用有效性：**
根据漏洞库信息和搜索结果，此漏洞已公开披露并存在可用的PoC利用代码。搜索结果表明，该漏洞易于利用，并且已经存在大量的公开可用的 PoC。

**投毒风险分析：**
提供的 Dockerfile 和 `exploit.c` 代码主要用于演示漏洞的利用过程，没有明显的恶意代码。`Dockerfile` 用于构建包含漏洞环境的 Docker 镜像，`exploit.c` 文件包含漏洞利用代码。`README.md` 描述了如何使用 Docker 镜像和漏洞利用程序。虽然整体风险较低，但仍需仔细审查 `exploit.c` 确保其行为符合预期，不包含任何隐藏的恶意功能，例如反向 shell 或其他未经授权的活动。Dockerfile中指定了Alpine和Debian作为基础镜像，并且指定了gcc进行编译，增加了可信度。

**漏洞利用方式：**
1.  **漏洞触发：** 利用 `copy_page_to_iter_pipe` 和 `push_pipe` 函数中 `flags` 成员未正确初始化的问题，向管道写入数据。
2.  **覆盖只读文件：** 通过管道机制，将恶意数据写入到原本只读的文件中，例如 SUID 可执行文件。
3.  **权限提升：** 执行被篡改的 SUID 程序，从而获得 root 权限。

**总结：** 该漏洞利用方式简单，危害巨大，存在可行的 PoC。提供的 Dockerfile 和 exploit.c 代码主要用于漏洞演示，但不能排除投毒的可能，需要进行详细的代码审计。

**项目地址:** [mrchucu1/CVE-2022-0847-Docker](https://github.com/mrchucu1/CVE-2022-0847-Docker)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)