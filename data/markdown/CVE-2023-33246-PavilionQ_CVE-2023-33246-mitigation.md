## CVE-2023-33246-Apache RocketMQ-远程代码执行

**漏洞编号:** CVE-2023-33246

**漏洞类型:** 远程代码执行

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 5.1.0

**利用条件:** RocketMQ组件（NameServer, Broker, Controller）暴露在公网且未进行权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-33246是一个Apache RocketMQ中的远程代码执行漏洞。漏洞存在于5.1.0及更早版本中。由于RocketMQ的某些组件在公网暴露且缺乏权限验证，攻击者可以通过以下两种方式利用此漏洞：

1.  **利用更新配置功能：** 攻击者可以利用`updateBrokerConfig`方法，通过修改配置参数（例如`rocketmqHome`）来执行任意命令。POC代码中的`Main.java`文件演示了如何通过设置`rocketmqHome`属性来执行shell命令或反弹shell。

2.  **伪造RocketMQ协议内容：** 攻击者可以构造恶意的RocketMQ协议内容，绕过身份验证，从而执行命令。


**漏洞利用方式：**

1.  攻击者首先需要确定目标RocketMQ服务的NameServer地址。
2.  然后，攻击者可以使用POC代码中的`updateConfig`方法，修改Broker的配置，例如`rocketmqHome`，将其设置为包含恶意命令的字符串。
3.  RocketMQ服务在读取并应用新的配置时，会执行攻击者注入的命令。


**投毒风险分析：**

该POC代码的主要目的是演示漏洞的利用和缓解方法。`README.md`文件表明该项目旨在提供CVE-2023-33246的缓解措施，并且`BrokerConfig.java`文件包含了对`RocketmqHome`参数的增强验证。

`Main.java`包含用于攻击测试的代码，虽然用于演示漏洞利用，但不应被认为是投毒代码。

但是，仍然存在一些风险：

*   **潜在的供应链风险：** 依赖项`rocketmq-client`和`rocketmq-tools`可能存在未知的漏洞，虽然概率较低，但存在一定风险。
*   **代码缺陷：** 代码中可能存在未知的bug，可能被攻击者利用。
*   **误用：** 用户可能错误地将此代码部署到生产环境，导致安全风险。

因此，评估投毒风险为10%。大多数代码用于漏洞验证和防御，但依赖项和其他潜在问题始终存在一定风险。


**项目地址:** [PavilionQ/CVE-2023-33246-mitigation](https://github.com/PavilionQ/CVE-2023-33246-mitigation)

**漏洞详情:** [CVE-2023-33246](https://nvd.nist.gov/vuln/detail/CVE-2023-33246)