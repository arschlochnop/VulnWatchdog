## CVE-2021-29447-WordPress-XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感文件泄露

**影响版本:** >= 5.6.0, < 5.7.1 (PHP 8)

**利用条件:** 需要 WordPress 版本在 5.6.0 到 5.7.1 之间，运行在 PHP 8 环境下，并具有上传文件的权限（如作者权限）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-29447 是 WordPress 5.6.0 到 5.7.1 版本中存在的一个 XXE 漏洞，仅在 PHP 8 环境下有效。攻击者需要具有上传文件的权限（例如，作者角色），才能通过上传包含恶意 XML 内容的文件（例如，特制的 WAV 音频文件）到媒体库来触发该漏洞。

**有效性：** 根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞利用是有效的。PoC代码提供了一个脚本 `generate_payloads.py`，用于自动生成包含 XXE 攻击向量的恶意 WAV 文件和 DTD 文件，并通过简单的 HTTP 服务器来接收从目标服务器提取的文件内容。搜索引擎结果中也包含了对该漏洞的描述和利用的讨论，以及公开的 PoC。

**投毒风险：** 提供的 PoC 代码主要用于生成 XXE payload 和启动一个简单的HTTP服务来接收数据。代码本身的功能相对明确，主要风险在于使用者可能将此代码用于未经授权的渗透测试活动。代码中主要通过构造恶意的 XML 内容来利用漏洞，本身不太可能存在隐藏的、与漏洞利用无关的恶意行为。但仍存在少量投毒风险 (5%)，例如作者可能在HTTP服务中添加一些隐蔽的日志记录或数据收集功能，或者在生成的 payload 中加入一些难以察觉的干扰代码。

**利用方式：**
1.  **生成Payload:** 使用 `generate_payloads.py` 脚本生成恶意 WAV 文件 (`--media-payload`) 和 DTD 文件 (`--dtd-payload`)。 DTD 文件中指定要读取的目标文件 (`--files-to-fetch`)。
2.  **启动 HTTP 服务器:** 脚本会启动一个简单的 Python HTTP 服务器，用于托管 DTD 文件，并接收目标服务器发送的请求。
3.  **上传恶意文件:**  具有上传权限的用户将生成的恶意 WAV 文件上传到 WordPress 的媒体库。
4.  **触发 XXE:**  WordPress 在处理上传的 WAV 文件时，会解析其中的 XML 内容，从而触发 XXE 漏洞，向攻击者的 HTTP 服务器请求 DTD 文件。
5.  **文件读取:** 恶意 DTD 文件指示 WordPress 服务器读取指定的文件，并将文件内容发送到攻击者的 HTTP 服务器。
6.  **获取文件:** 攻击者的 HTTP 服务器接收到文件内容后，脚本会将内容进行 Base64 解码并保存到本地。

**项目地址:** [b-abderrahmane/CVE-2021-29447-POC](https://github.com/b-abderrahmane/CVE-2021-29447-POC)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)