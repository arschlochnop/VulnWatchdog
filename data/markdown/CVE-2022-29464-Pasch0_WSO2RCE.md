## CVE-2022-29464-WSO2-Unrestricted File Upload

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 严重，可导致远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 需要网络访问，目标存在/fileupload接口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464 是 WSO2 产品中的一个严重的任意文件上传漏洞，攻击者可以通过构造包含目录遍历序列的 Content-Disposition 头部的请求，上传恶意文件到 web 根目录下的可执行位置，例如 `../../../../repository/deployment/server/webapps`。上传的文件可以被当作 JSP 或其他可执行文件解析，从而导致远程代码执行。根据搜索结果，该漏洞已经被广泛利用，并被用于安装 Cobalt Strike beacons 和其他恶意软件。提供的代码片段是 GNU GPL 协议，与漏洞利用本身无关，因此不存在投毒风险。利用方式主要为：

1.  利用 `/fileupload` 接口上传文件。
2.  在 `Content-Disposition` 头中构造目录遍历路径，将文件上传到 webapps 目录下。
3.  上传恶意 JSP 或其他可执行文件。
4.  通过访问上传的文件执行任意代码。

由于该漏洞已经被 CISA 加入已知被利用漏洞目录，建议尽快修复。

**项目地址:** [Pasch0/WSO2RCE](https://github.com/Pasch0/WSO2RCE)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)