## CVE-2021-1675 PrintNightmare

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致远程代码执行并获取SYSTEM权限

**影响版本:** 受影响的Windows版本包括但不限于Windows 7, Windows 8.1, Windows 10, Windows Server 2008, Windows Server 2012, Windows Server 2016, Windows Server 2019, Windows Server 20H2, Windows Server 2004, Windows 21H1等，具体版本号参考漏洞库信息。

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要能够与目标系统建立网络连接。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-1675，又名PrintNightmare，是一个Windows Print Spooler远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个已知的且被广泛利用的漏洞。多个PoC代码已公开，并且被CISA添加到已知被利用的漏洞目录中，表明该漏洞具有很高的有效性。

**投毒风险：**
提供的PoC代码是一个Zeek/Suricata规则集，用于检测PrintNightmare漏洞的利用尝试。这些规则通过监控网络流量中特定的DCE RPC调用（RpcAddPrinterDriver和RpcAddPrinterDriverEx）来识别潜在的攻击。此仓库本身**不是**一个直接的漏洞利用工具，而是用于检测和防御的工具。但是，任何安全工具都可能被滥用。投毒风险评估如下：

*   该代码库的主要目的是**检测**漏洞利用，而不是实施攻击。因此，直接的投毒风险较低。
*   间接风险存在：攻击者可能修改或使用这些规则集来识别易受攻击的目标，然后利用其他PoC代码发起攻击。
*   考虑到代码的功能和目的，此处认为投毒的概率较低，约为5%。

**利用方式：**
PrintNightmare漏洞的利用方式通常涉及以下步骤：

1.  攻击者利用`RpcAddPrinterDriver`或`RpcAddPrinterDriverEx`函数向Print Spooler服务添加恶意的打印机驱动程序。
2.  由于Print Spooler服务以SYSTEM权限运行，因此添加的恶意驱动程序也会以SYSTEM权限执行。
3.  攻击者可以利用这一点来执行任意代码，例如下载并执行恶意软件，或添加新的用户帐户。

**总结：**
PrintNightmare是一个高危漏洞，利用简单且影响广泛。尽管提供的PoC代码主要用于检测，但用户仍应保持警惕，确保及时应用补丁并实施适当的安全措施。

**项目地址:** [corelight/CVE-2021-1675](https://github.com/corelight/CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)