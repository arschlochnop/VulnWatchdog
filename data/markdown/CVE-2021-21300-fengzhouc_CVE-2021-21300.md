## CVE-2021-21300

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**利用条件:** 目标系统需使用大小写不敏感的文件系统（如Windows的NTFS）且安装了受影响版本的Git，并配置了clean/smudge过滤器（如Git LFS，Git for Windows默认配置Git LFS），用户需要clone恶意仓库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 漏洞存在于 Git 多个版本中，由于对符号链接处理不严格，攻击者可以在大小写敏感的文件系统上创建一个包含恶意符号链接的 Git 仓库。当用户在大小写不敏感的文件系统（如 Windows）上克隆该仓库时，该符号链接可能被解析到 .git/hooks 目录下的恶意脚本，导致在 clone 过程中执行任意命令。漏洞利用依赖于 clean/smudge 过滤器（如 Git LFS）。

**有效性：** 提供的 POC 代码是有效的，它演示了如何创建一个包含恶意符号链接和 post-checkout 脚本的仓库，当在 Windows 系统上 clone 该仓库时，post-checkout 脚本会被执行，从而实现远程命令执行。

**投毒风险：** 代码的主要功能是利用漏洞，但其中存在少量投毒风险。`hack.sh`脚本虽然展示了一个简单的攻击场景，但攻击者可以在此基础上添加更具破坏性的代码，例如删除文件、窃取敏感信息等。因此，克隆此仓库存在一定的风险，大约为10%。这个估计是基于这样一个事实，即POC的重点是漏洞演示，而非完全隐蔽的恶意代码。更复杂的利用可能会有更高的投毒风险。

**利用方式：**
1.  攻击者创建一个包含恶意符号链接和 post-checkout 脚本的 Git 仓库。
2.  仓库的 .gitattributes 文件配置了 clean/smudge 过滤器（如 Git LFS）。
3.  用户在大小写不敏感的文件系统上克隆该仓库。
4.  在 clone 过程中，由于符号链接被解析到 .git/hooks 目录下，post-checkout 脚本会被执行，从而实现远程命令执行。
5. 可以通过修改post-checkout文件内容为恶意代码，从而控制受害者机器。

**项目地址:** [fengzhouc/CVE-2021-21300](https://github.com/fengzhouc/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)