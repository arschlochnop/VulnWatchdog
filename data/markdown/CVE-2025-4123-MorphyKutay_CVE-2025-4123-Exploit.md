## CVE-2025-4123-Grafana-XSS和Open Redirect

**漏洞编号:** CVE-2025-4123

**漏洞类型:** 跨站脚本 (XSS) 和开放重定向

**影响应用:** Grafana

**危害等级:** 高危，可能导致用户凭据泄露，SSRF攻击以及任意JavaScript代码执行。

**影响版本:** 受影响版本：Grafana < 10.4.19, < 11.2.10, < 11.3.7, < 11.4.5, < 11.5.5, < 11.6.2, < 12.0.1

**利用条件:** 需要Grafana实例，且可能需要匿名访问开启。如果安装了Grafana Image Renderer插件，则可能触发SSRF。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-4123 是 Grafana 中的一个跨站脚本（XSS）漏洞，由客户端路径遍历和开放重定向组合导致。攻击者可以利用此漏洞将用户重定向到托管恶意前端插件的网站，该插件可以执行任意 JavaScript 代码。此漏洞不需要编辑器权限，如果启用了匿名访问，则 XSS 将起作用。 如果安装了 Grafana Image Renderer 插件，则可以利用开放重定向来实现完全读取的 SSRF。

**有效性分析：**

提供的 PoC 代码通过发送包含特定 payload 的请求，并检查服务器是否返回 301 或 302 重定向响应来检测漏洞。Payload `/public/..%2F%5cgoogle.com%2F%3f%2F..%2F..` 旨在触发路径遍历和开放重定向。

该 PoC 通过 `CheckRedirect` 函数禁用 Go 的自动重定向，以便能够检查原始响应的 `Location` 标头。如果服务器返回 301 或 302 响应，并且 `Location` 标头指示重定向到非预期域（例如 google.com），则表明存在漏洞。

**投毒风险分析：**

在提供的 PoC 代码中，没有发现明显的投毒代码。该代码的功能是发送特定 payload 并检查重定向响应，这与漏洞描述一致。PoC 本身旨在验证漏洞的存在，而不是执行恶意操作。代码逻辑简单，没有隐藏的或混淆的代码段，也没有尝试执行任何系统命令或访问敏感信息。

**利用方式分析：**

1.  **路径遍历和开放重定向：** 漏洞利用的核心是路径遍历和开放重定向。攻击者构造包含特殊字符的 URL，利用 Grafana 的路径处理逻辑中的缺陷，将用户重定向到攻击者控制的域。
2.  **XSS 攻击：** 一旦用户被重定向到攻击者控制的域，攻击者就可以通过托管包含恶意 JavaScript 代码的前端插件来执行 XSS 攻击。此代码可以窃取用户凭据、执行管理操作或进一步攻击其他系统。
3.  **SSRF 攻击（如果安装了 Grafana Image Renderer 插件）：** 如果 Grafana Image Renderer 插件已安装，攻击者可以利用开放重定向来触发 SSRF 攻击。攻击者可以控制服务器端发出的请求，读取服务器上的敏感文件或访问内部服务。
4.  **绕过 CSP：** 漏洞描述提到默认的 Content-Security-Policy (CSP) 可能会阻止 XSS，但 `connect-src` 指令配置不当或者存在其他绕过方式，攻击仍然可以成功。

**总结：**

该漏洞利用方式较为直接，利用路径遍历和开放重定向将用户导向恶意站点，从而实施 XSS 或 SSRF 攻击。PoC 代码有效，可以用来检测漏洞的存在。提供的代码本身不包含投毒行为。

**项目地址:** [MorphyKutay/CVE-2025-4123-Exploit](https://github.com/MorphyKutay/CVE-2025-4123-Exploit)

**漏洞详情:** [CVE-2025-4123](https://nvd.nist.gov/vuln/detail/CVE-2025-4123)