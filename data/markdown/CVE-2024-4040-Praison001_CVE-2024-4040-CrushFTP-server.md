## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 极危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 目标系统运行受影响版本的CrushFTP，且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经验证的远程攻击者可以通过发送特制的请求，利用 `<INCLUDE>` 标签来读取服务器上的任意文件、绕过身份验证，甚至执行任意代码。

**有效性：**

提供的 POC 代码 `exploit.py` 利用了未经身份验证的服务器端模板注入漏洞。通过发送包含恶意 `<INCLUDE>` 标签的 POST 请求到 `/WebInterface/login.html` 路径，可以读取任意文件。代码首先获取 `currentAuth` cookie，然后使用此 cookie 在后续的请求中绕过身份验证。

**投毒风险：**

提供的 `exploit.py` 代码没有明显的恶意行为或后门。代码的功能是明确地利用 SSTI 漏洞读取文件。虽然存在风险承担者可以使用此代码进行恶意活动，但代码本身没有包含任何隐藏的、非预期的功能。代码的逻辑看起来是合理的，且没有发现任何试图隐藏或执行恶意操作的部分。因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞定位：** 该漏洞存在于 `/WebInterface/login.html` 端点，允许未授权的攻击者发送请求。
2.  **获取认证Cookie:** 攻击者首先发送POST请求到Login URL,目的是获取服务器颁发的`currentAuth` Cookie。
3.  **SSTI 注入：** 通过在 POST 请求的 `paths` 参数中使用 `<INCLUDE>` 标签，可以指定要读取的文件路径。例如，`paths=<INCLUDE>/path/to/file</INCLUDE>`。
4.  **文件读取：** 服务器解析模板，并将指定文件的内容返回给攻击者。
5.  **利用链：** 攻击者可以读取敏感配置文件，如包含数据库凭据的文件，或者通过执行任意代码来完全控制服务器。
6.  **缓解措施：** 将 CrushFTP 更新到 10.7.1 或 11.1.0 或更高版本。采用 Web 应用防火墙 (WAF) 来过滤包含恶意 `<INCLUDE>` 标签的请求。

**项目地址:** [Praison001/CVE-2024-4040-CrushFTP-server](https://github.com/Praison001/CVE-2024-4040-CrushFTP-server)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)