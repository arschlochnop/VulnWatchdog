## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+, Tomcat (WAR deployment), Spring MVC or Spring WebFlux

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22965，又名Spring4Shell，是一个存在于Spring Framework中的远程代码执行漏洞。该漏洞允许未经身份验证的攻击者通过构造恶意请求来执行任意代码。根据漏洞库信息，该漏洞存在于运行在JDK 9+上的Spring MVC或Spring WebFlux应用程序中，并且需要以WAR包形式部署在Tomcat服务器上。如果应用部署为Spring Boot可执行jar包，则不易受此漏洞影响。搜索结果证实了该漏洞的存在，并指出该漏洞易于利用。提供的POC代码尝试利用数据绑定漏洞，通过修改 Tomcat 的 AccessLogValve 的属性来写入 webshell。该利用代码的有效性取决于目标系统是否满足漏洞利用的条件，包括 Spring 版本、JDK 版本、部署方式和 Tomcat 配置等。虽然`teamserver`和`readme.md`文件看起来不相关，但`CVE-2022-22965.py`文件本身并未发现明显的恶意代码。`teamserver`文件是Cobalt Strike的启动脚本，与漏洞利用无关。`readme.md`只是描述了漏洞和利用条件，并没有包含恶意代码。考虑到网络资源可能被篡改的风险，依然存在轻微的投毒可能（5%），但目前无法直接从代码中得出结论。

**利用方式：**

1.  **发送恶意请求：** 攻击者发送包含恶意参数的HTTP请求到目标Spring应用程序。
2.  **修改AccessLogValve：**  利用Spring的数据绑定功能，动态修改Tomcat的AccessLogValve组件的属性，例如`directory`，`prefix`，`suffix`和`pattern`。
3.  **写入Webshell：** 通过修改`pattern`属性，将一段包含恶意代码（例如，执行系统命令）的JSP代码写入到指定的目录和文件名的Webshell中。
4.  **执行Webshell：**  攻击者访问写入的Webshell，并传递命令参数，从而在服务器上执行任意代码。

**项目地址:** [likewhite/CVE-2022-22965](https://github.com/likewhite/CVE-2022-22965)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)