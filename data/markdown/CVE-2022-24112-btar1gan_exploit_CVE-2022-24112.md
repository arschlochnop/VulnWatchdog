## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全被控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** Apache APISIX 启用了 batch-requests 插件，并且使用默认API密钥或者API访问没有做严格IP限制

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache APISIX的batch-requests插件中。攻击者可以通过构造包含恶意代码的请求，利用该插件绕过Admin API的IP限制，从而执行任意代码。漏洞利用方式如下：

1.  **利用batch-requests插件绕过IP限制：** 攻击者通过batch-requests插件发送包含`X-Real-IP`头部的请求，伪造客户端IP，绕过Admin API的IP访问控制。
2.  **利用默认API Key或未做IP限制的API访问：** 如果APISIX使用了默认的API Key（`edd1c9f034335f136f87ad84b625c8f1`）或者API访问没有做严格IP限制，攻击者可以直接访问Admin API。
3.  **创建恶意路由：** 攻击者通过Admin API创建一个新的路由，该路由包含一个`filter_func`，其中包含要执行的恶意代码。在提供的POC中，该代码会反弹shell到攻击者的服务器(`192.168.45.175:1234`)。
4.  **触发恶意路由：** 攻击者通过访问新创建的路由(`/rms/fzxewh`)，触发`filter_func`中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC代码首先通过batch-requests插件创建一个包含恶意代码的路由，然后通过访问该路由触发恶意代码，成功实现远程代码执行。

**投毒风险评估：**
经过对提供的POC代码的分析，没有发现作者隐藏的恶意投毒代码。POC代码的功能是利用漏洞实现远程代码执行，反弹shell到指定的IP地址，并没有进行额外的恶意操作或隐藏后门。因此，投毒风险评估为0%。

**总结：**
CVE-2022-24112是一个高危的远程代码执行漏洞，攻击者可以利用该漏洞完全控制受影响的Apache APISIX服务器。需要及时升级到安全版本或禁用batch-requests插件来修复该漏洞。

**项目地址:** [btar1gan/exploit_CVE-2022-24112](https://github.com/btar1gan/exploit_CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)