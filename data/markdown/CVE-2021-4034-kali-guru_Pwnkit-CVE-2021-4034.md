## CVE-2021-4034-Polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获取root权限

**影响版本:** 所有版本

**利用条件:** 本地用户能够执行pkexec程序

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 (PwnKit) 是 polkit 的 pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。

**利用方式：**

1.  漏洞的根源在于 pkexec 未能正确处理调用参数计数。它最终尝试将环境变量作为命令执行。
2.  攻击者通过构造特定的环境变量，诱使 pkexec 执行任意代码。
3.  利用代码中的 `main.py` 脚本首先编译 `cve-2021-4034-poc.c` PoC 代码，生成可执行文件 `exploit`。
4.  然后，运行编译后的 `exploit`，该程序利用漏洞提升权限。
5.  脚本随后尝试通过 `whoami`、`ls /root` 和 `cat /root/flag.txt` 命令来验证提权是否成功。这些命令尝试获取当前用户，列出 `/root` 目录的内容，并读取 `/root/flag.txt` 文件，而这些操作通常需要 root 权限。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞 PoC 代码是有效的。漏洞已经被广泛利用，并且已经有公开的利用代码。

**投毒风险：**

查看提供的利用代码，该利用代码编译并运行提供的 c 代码（cve-2021-4034-poc.c，未提供内容）。`main.py` 中仅包含编译和执行漏洞利用程序以及验证提权的命令。没有发现任何明显的投毒代码。因此，投毒风险为 0%。需要注意的是，如果提供的 `cve-2021-4034-poc.c` 文件本身被篡改，则可能存在后门或恶意行为。但是仅根据现有信息,可以判断 `main.py` 本身没有投毒。


**项目地址:** [kali-guru/Pwnkit-CVE-2021-4034](https://github.com/kali-guru/Pwnkit-CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)