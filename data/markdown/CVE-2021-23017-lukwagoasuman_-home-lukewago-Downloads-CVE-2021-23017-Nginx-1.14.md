## CVE-2021-23017-Nginx Resolver 1-byte内存覆盖

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx

**危害等级:** 中危，可能导致worker进程崩溃或潜在的其他影响

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** 需要能够伪造来自DNS服务器的UDP数据包

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-23017是Nginx resolver中的一个安全问题，允许攻击者通过伪造来自DNS服务器的UDP数据包来导致1字节内存覆盖，从而导致worker进程崩溃或潜在的其他影响。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞是存在的，并且有一个公开的POC代码（[https://github.com/M507/CVE-2021-23017-PoC](https://github.com/M507/CVE-2021-23017-PoC)）。提供的Python脚本尝试模拟DNS服务器并发送特制的响应来触发漏洞。

**投毒风险：**
提供的PoC代码看起来像是利用了DNS响应中的CNAME记录来触发内存覆盖。代码逻辑相对简单，主要作用是监听UDP端口1053，解析收到的DNS请求，然后构造包含特定CNAME记录的恶意响应，并将其发送回请求方。其中 `unhexlify('c00c0005000100000e10000b18414141414141414141414141414141414141414141414141c004')` 这段十六进制数据包含了精心构造的CNAME记录，旨在覆盖目标内存。风险在于，虽然这段代码本身的目的在于重现漏洞，但恶意行为者可能修改此代码以产生更严重的后果，例如覆盖更敏感的内存区域以实现代码执行。由于代码功能相对明确，且专注于漏洞复现，因此评估其存在作者隐藏的投毒代码的风险较低，约为10%。

**利用方式：**
1.  **Nginx配置：**  Nginx需要配置使用resolver，并且允许从攻击者控制的DNS服务器解析域名。
2.  **DNS欺骗：**  攻击者需要能够拦截或欺骗Nginx服务器发送的DNS请求，并返回特制的恶意响应。
3.  **内存覆盖：**  恶意DNS响应中的CNAME记录被设计为覆盖Nginx进程中的特定内存区域，导致进程崩溃或潜在的恶意代码执行。

**总结：**
该漏洞的利用需要一定的条件，包括Nginx的配置和攻击者对DNS流量的控制。虽然利用难度相对较高，但如果成功利用，可能会导致Nginx服务不可用，甚至可能导致更严重的安全问题。

**项目地址:** [lukwagoasuman/-home-lukewago-Downloads-CVE-2021-23017-Nginx-1.14](https://github.com/lukwagoasuman/-home-lukewago-Downloads-CVE-2021-23017-Nginx-1.14)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)