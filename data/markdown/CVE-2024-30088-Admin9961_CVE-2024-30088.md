## CVE-2024-30088 Windows Kernel 提权漏洞

**漏洞编号:** CVE-2024-30088

**漏洞类型:** 权限提升

**影响应用:** Windows Kernel

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** 受影响的Windows版本和build号见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞 (CVE-2024-30088) 是一个Windows内核提权漏洞，存在于多个版本的Windows 10, Windows 11 和 Windows Server中。根据漏洞库信息，漏洞类型是CWE-367：Time-of-check Time-of-use (TOCTOU) 竞争条件。CISA的已知被利用漏洞目录中也包含了该漏洞，并标记为活跃利用。CVSS评分为7.0，属于高危漏洞。

漏洞利用代码分析：

提供的Python代码尝试利用该漏洞进行提权，代码主要包括以下几个部分：

1.  **定义Windows API相关的常量和数据结构**：例如 `TOKEN_ALL_ACCESS`, `PROCESS_ALL_ACCESS`, `SYSTEM_HANDLE` 等，以及 `NtQuerySystemInformation`，`OpenProcessToken` 等Windows API的定义和参数类型。
2.  **`GetKernelPointerByHandle` 函数**：该函数通过 `NtQuerySystemInformation` API获取内核句柄信息，遍历进程句柄，查找匹配的句柄，并返回相应的内核对象指针。这是利用竞争条件进行提权的关键步骤。
3.  **`GetPidByName` 函数**：用于通过进程名称获取进程PID。
4.  **代码不完整**: 代码在 `GetPidByName` 函数中途被截断, 缺少 `kernel32.CloseHandle(snapshot)` 结束。

**有效性评估**:

根据CISA KEV 和漏洞库信息，以及提供的利用代码，该漏洞的POC已经被公开，并且存在在野利用。提供的python代码框架完整， 但是代码不完整，无法直接运行。

**投毒风险评估**:

提供的Python脚本代码主要是调用Windows API来查询句柄信息和创建进程等操作，没有发现明显的恶意代码或后门。因此，认为该代码不存在投毒风险。

**利用方式分析**:

该漏洞的利用方式通常涉及以下步骤：

1.  **定位目标进程**: 通过进程名找到目标进程的PID。
2.  **获取目标进程的句柄**: 使用函数如 `OpenProcess` 获取目标进程的句柄。
3.  **利用TOCTOU竞争条件**: 在检查和使用句柄的这段时间内，内核对象的状态发生了改变，导致权限提升。
4.  **创建高权限进程**: 利用提升后的权限创建具有管理员权限的进程，从而实现提权。 

此漏洞通常需要较低的权限（本地访问权限）即可利用。

**项目地址:** [Admin9961/CVE-2024-30088](https://github.com/Admin9961/CVE-2024-30088)

**漏洞详情:** [CVE-2024-30088](https://nvd.nist.gov/vuln/detail/CVE-2024-30088)