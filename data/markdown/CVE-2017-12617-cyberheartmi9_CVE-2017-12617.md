## CVE-2017-12617-Apache Tomcat-远程代码执行

**漏洞编号:** CVE-2017-12617

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81

**利用条件:** 需要Tomcat开启HTTP PUT方法（readonly初始化参数设置为false）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12617 允许未经授权的用户通过 PUT 请求上传包含恶意代码的 JSP 文件，并在服务器上执行。利用方式如下：

1.  **漏洞条件：**
    *   目标 Tomcat 服务器运行在受影响的版本范围内。
    *   HTTP PUT 方法被启用，通常是因为`readonly`初始化参数在`Default` servlet 中被设置为`false`。

2.  **利用步骤：**
    *   攻击者构造一个恶意的 HTTP PUT 请求，将包含 JSP 代码的文件上传到服务器。该JSP文件包含攻击者想要执行的恶意代码，例如反弹shell。
    *   上传的文件名需要经过特殊构造，以绕过服务器的安全检查。常见方法包括使用`.jsp`后缀，或者利用路径穿越漏洞将文件上传到Web目录之外，然后通过其他方式访问。
    *   成功上传 JSP 文件后，攻击者通过 HTTP GET 请求访问该 JSP 文件，触发恶意代码的执行。

3.  **漏洞利用代码分析：**
    *   `tomcat-cve-2017-12617.py` 是一个 Python 脚本，用于自动化利用此漏洞。
    *   脚本接受目标 URL 作为参数，并尝试上传一个包含恶意代码的 JSP 文件。
    *   脚本的核心功能是发送 HTTP PUT 请求，将 JSP 文件上传到目标服务器，然后尝试访问该文件。

4.  **投毒风险评估：**
    *   查看代码，发现存在requests库的使用，有网络连接行为。
    *   脚本具备通过网络上传JSP文件的能力,JSP文件内容可以自定义，存在一定的投毒风险。例如，攻击者可能修改脚本，使其上传包含恶意代码的 JSP 文件，该 JSP 文件不仅包含漏洞利用代码，还包含其他恶意功能，例如收集用户信息、植入后门等。但从整体代码来看，主要还是漏洞利用本身，恶意投毒的可能性较低，估计占比10%。

总的来说，此漏洞利用方式较为直接，依赖于目标服务器的配置。POC 代码的有效性较高，但存在一定的投毒风险。使用者需要对 POC 代码进行仔细审查，确保其安全性。

**项目地址:** [cyberheartmi9/CVE-2017-12617](https://github.com/cyberheartmi9/CVE-2017-12617)

**漏洞详情:** [CVE-2017-12617](https://nvd.nist.gov/vuln/detail/CVE-2017-12617)