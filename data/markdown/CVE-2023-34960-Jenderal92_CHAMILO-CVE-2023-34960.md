## CVE-2023-34960-Chamilo-命令注入

**漏洞编号:** CVE-2023-34960

**漏洞类型:** 命令注入

**影响应用:** Chamilo

**危害等级:** 高危，可导致远程代码执行

**影响版本:** v1.11.* up to v1.11.18

**利用条件:** 需要能够访问Chamilo服务器上的`additional_webservices.php`，并发送特制的SOAP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Chamilo的`wsConvertPpt`组件中，允许攻击者通过构造包含恶意命令的PowerPoint文件名，利用SOAP API调用执行任意命令。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的PoC代码，该漏洞利用的有效性较高。多个来源都确认了该漏洞的存在，并且提供了利用该漏洞的PoC代码。Metasploit也集成了该漏洞的利用模块，进一步证明了其有效性。

**投毒风险分析：**

查看提供的PoC代码（`CVE-2023-34960.py`）后，发现其主要功能是：

1.  构造包含恶意命令的SOAP请求，发送到`/main/webservices/additional_webservices.php`。
2.  恶意命令是将一段PHP代码（base64编码的webshell）写入到 `shin.php` 文件中.
3.  尝试访问`/main/inc/lib/ppt2png/1.php`以确认webshell是否上传成功。

`README.md` 文件提供了简单的使用说明，没有发现明显的恶意代码。

**潜在的投毒风险在于：**

*   PoC中使用的webshell功能简单，可能只是为了演示漏洞。攻击者可以修改PoC，植入更复杂的后门代码。
*   PoC在成功利用漏洞后，会在目标服务器上留下webshell文件（`/main/inc/lib/ppt2png/1.php`），如果该文件被其他攻击者发现，可能会被用于进一步的攻击。

该风险是由于漏洞利用本身造成的后门，并非作者故意添加的恶意代码，判定投毒风险为10%。

**利用方式：**

1.  攻击者需要确定目标Chamilo服务器的版本在v1.11.* 到 v1.11.18之间。
2.  攻击者需要向目标服务器的`/main/webservices/additional_webservices.php`发送特制的SOAP请求。
3.  SOAP请求中的`file_name`参数需要包含恶意命令。PoC中使用的命令是将base64编码的PHP webshell写入`/main/inc/lib/ppt2png/1.php`文件。
4.  攻击者可以通过访问`/main/inc/lib/ppt2png/1.php`来执行webshell，从而控制目标服务器。
5.  该脚本会自动在 `vuln_chamilo.txt` 和 `shell_chamilo.txt` 中记录存在漏洞的URL以及成功获取shell的URL。

**项目地址:** [Jenderal92/CHAMILO-CVE-2023-34960](https://github.com/Jenderal92/CHAMILO-CVE-2023-34960)

**漏洞详情:** [CVE-2023-34960](https://nvd.nist.gov/vuln/detail/CVE-2023-34960)