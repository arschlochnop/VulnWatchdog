## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 目标系统使用受影响的Go版本，并且执行了 `go get` 命令获取包含恶意代码的包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许攻击者通过 `go get` 命令在目标系统上执行任意代码。此漏洞源于 Go 在构建源代码期间没有充分阻止 `gcc` 或 `clang` 插件的 `-fplugin=` 和 `-plugin=` 参数。攻击者可以创建一个包含恶意 `attack.c` 文件和相应的 `main.go` 文件的 Go 包。`attack.c` 文件包含一个 `malicious()` 函数，该函数使用 `__attribute__((constructor))` 标记，使其在共享库加载时自动执行。在这个 POC 中，`malicious()` 函数尝试建立一个反向shell (`nc blablabla`)。`main.go` 文件使用 `// #cgo CFLAGS: -fplugin=./attack.so` 指令，指示 Go 编译器在构建过程中加载 `attack.so` 共享库。当用户使用易受攻击的 Go 版本执行 `go get` 命令获取此恶意包时，`attack.so` 会被加载，并且 `malicious()` 函数会被执行，从而导致远程命令执行。

**有效性:** 提供的 POC 代码有效，它展示了如何通过 `go get` 和 `gcc` 插件在目标系统上执行任意命令。`attack.c` 文件中的 `system("nc blablabla")` 会尝试建立反向 shell，从而验证了远程代码执行的可能性。

**投毒风险:** 此代码仓库中没有明显的投毒代码。`attack.c` 中执行反向 shell 的代码是漏洞利用的核心部分，而不是隐藏的恶意行为。该利用方式的意图明确，且目的在于利用CVE-2018-6574。

**利用方式:** 攻击者需要创建一个包含恶意 `attack.c` 和 `main.go` 文件的 Go 包，并将其托管在可公开访问的存储库中。然后，诱使目标用户使用易受攻击的 Go 版本执行 `go get` 命令来获取此恶意包。当 `go get` 执行时，Go 编译器会加载 `attack.so` 共享库，并执行其中的恶意代码，从而导致远程命令执行。攻击者可以通过修改 `attack.c` 文件中的命令来执行任意操作，例如安装后门、窃取数据或控制整个系统。

**项目地址:** [NsByte/CVE-2018-6574](https://github.com/NsByte/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)