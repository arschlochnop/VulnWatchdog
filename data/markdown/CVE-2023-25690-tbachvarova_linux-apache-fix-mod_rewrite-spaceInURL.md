## CVE-2023-25690-Apache HTTP Server-HTTP Request Smuggling

**漏洞编号:** CVE-2023-25690

**漏洞类型:** HTTP Request Smuggling

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致绕过访问控制，代理到未预期的URL，缓存投毒。

**影响版本:** 2.4.0 <= version <= 2.4.55

**利用条件:** 启用mod_proxy和RewriteRule或ProxyPassMatch，且RewriteRule的pattern匹配用户提供的request-target的一部分并重新插入到代理的request-target中。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-25690是Apache HTTP Server 2.4.0到2.4.55版本中存在的一个HTTP请求走私漏洞。当Apache服务器配置了`mod_proxy`模块，并结合`RewriteRule`或`ProxyPassMatch`指令时，如果`RewriteRule`的模式匹配了用户提供的URL的一部分，并且这部分内容被重新插入到代理的请求目标中，就可能触发此漏洞。攻击者可以利用此漏洞绕过访问控制，将请求代理到未预期的URL，或者进行缓存投毒。

**有效性：** 根据漏洞信息和搜索结果，此漏洞的利用需要满足特定的配置条件，因此提供的POC代码并不直接是漏洞利用代码，而是修复URL中空格问题的配置方法，但该问题的根本原因是由于apache升级修复了CVE-2023-25690，所以间接证明了此漏洞的存在及危害。

**投毒风险：** 提供的POC代码是关于修复Apache服务器在mod_rewrite规则下处理URL中的空格问题。虽然POC本身不是直接的漏洞利用代码，但是它与CVE-2023-25690漏洞相关，因为更新apache导致空格出现问题的原因是为了修复此漏洞。 代码仓库中主要是一个README文件和一个图片文件，没有发现明显可疑的恶意代码或后门，所以投毒风险较低，初步评估为1%。

**利用方式：** 漏洞的利用方式主要通过构造特殊的HTTP请求，该请求会被代理服务器以不一致的方式解析，从而导致请求走私。攻击者可以通过精心设计的请求绕过访问控制，将请求发送到后端服务器上未预期的端点，或者进行缓存投毒。

详细的利用流程大致如下：
1.  攻击者构造一个包含恶意payload的HTTP请求。
2.  该请求被发送到配置了`mod_proxy`和`mod_rewrite`的Apache服务器。
3.  `RewriteRule`匹配URL的一部分，并将该部分重新插入到代理的请求中。
4.  由于服务器和后端应用对请求的解析方式不一致，恶意payload被传递到后端，导致安全问题，比如绕过认证或者访问未授权资源。
5.  利用成功与否取决于服务器的具体配置和后端应用的解析逻辑。

**项目地址:** [tbachvarova/linux-apache-fix-mod_rewrite-spaceInURL](https://github.com/tbachvarova/linux-apache-fix-mod_rewrite-spaceInURL)

**漏洞详情:** [CVE-2023-25690](https://nvd.nist.gov/vuln/detail/CVE-2023-25690)