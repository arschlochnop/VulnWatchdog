## CVE-2021-21300: Git 恶意仓库远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许攻击者在受害者机器上执行任意代码

**影响版本:** 2.14.2 <= Git版本 < 2.30.1

**利用条件:** 需要目标系统使用大小写不敏感的文件系统（如Windows/macOS），启用 Git LFS，并且受害者克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许攻击者通过构造包含恶意 Git hooks 的仓库，在受害者克隆该仓库时执行任意代码。攻击依赖于大小写不敏感的文件系统，以及 Git LFS 的 clean/smudge 过滤器。攻击者创建一个目录（如 'A'），并在其中包含一个名为 'post-checkout' 的文件，该文件包含恶意命令。然后，攻击者将目录 'A' 替换为指向 '.git/hooks/' 的符号链接。当 Git 执行 'A/post-checkout' 时，实际上执行了 '.git/hooks/post-checkout' 中的恶意代码。

**漏洞利用方式:**

1.  攻击者创建一个恶意 Git 仓库。
2.  仓库包含一个目录（例如 'A'），以及 'A/post-checkout' 文件，其中包含恶意代码。
3.  仓库的 `.gitattributes` 文件配置 Git LFS 来处理 'A/post-checkout' 文件。
4.  攻击者将目录 'A' 替换为一个指向 '.git/hooks/' 的符号链接。
5.  攻击者提交并将恶意仓库推送到一个公共或私有 Git 仓库。
6.  受害者克隆该恶意仓库。
7.  当 Git 执行 post-checkout 钩子时，由于符号链接和大小写不敏感的文件系统，恶意代码会被执行。

**投毒风险评估:**

提供的漏洞利用代码主要包含以下文件:

*   `README.md`: 描述漏洞信息和利用方法。
*   `A/a`，`A/b`: 两个空文件，用于迷惑用户，增加仓库的伪装性。
*   `A/post-checkout`: 包含恶意代码，例如 `echo PWNED >&2`，用于在受害者终端输出 "PWNED"。

在分析了提供的代码后，没有发现作者隐藏的恶意代码，该POC目的是验证漏洞，而并非投毒。

**结论:**

提供的 PoC 代码有效，可以用于验证 CVE-2021-21300 漏洞。 代码本身不包含投毒内容，仅用于演示漏洞利用。但如果有人发布包含恶意payload的类似代码，则存在投毒风险。

**项目地址:** [Sizvy/CVE-2021-21300](https://github.com/Sizvy/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)