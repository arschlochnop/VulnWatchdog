## CVE-2022-0847-Dirty Pipe

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许非特权用户覆盖只读文件，提升权限

**影响版本:** Linux Kernel 5.17 rc6及之前版本

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-0847，又名Dirty Pipe，是一个Linux内核中的本地权限提升漏洞。漏洞原因是`copy_page_to_iter_pipe` 和 `push_pipe` 函数中新的管道缓冲区结构的“flags”成员缺乏正确的初始化，可能包含陈旧的值。非特权本地用户可以利用此漏洞写入页面缓存中只读文件支持的页面，从而提升他们在系统上的权限。

**有效性：**
根据搜索结果，该漏洞的利用是可靠的，并且有可用的POC代码，可以获得root权限。

**投毒风险：**
提供的base64解码后的漏洞利用代码是一个二进制文件，直接分析二进制文件比较困难，存在一定风险，只能通过查看字符串等方式评估，风险较低，初步判断投毒风险较低。但是考虑到其二进制的特殊性，不能完全排除投毒的可能。作者在其中植入后门代码可能性为10%。

**利用方式：**
1.  利用该漏洞，攻击者首先打开一个目标文件（例如SUID程序）用于读取。
2.  创建一个管道（pipe）。
3.  向管道写入一些数据，然后清空管道（splice）。这一步是为了在pipe buffer的flags中引入未初始化的数据。
4.  通过`splice`将目标文件的数据“注入”到管道中。
5.  使用`write`系统调用将恶意数据写入管道，由于pipe buffer的flags的错误，这些数据会覆盖目标文件在页面缓存中的内容。
6.  如果目标文件是SUID程序，那么当该程序被执行时，就会执行攻击者注入的恶意代码，从而提升权限。

**项目地址:** [Asbatel/CBDS_CVE-2022-0847_POC](https://github.com/Asbatel/CBDS_CVE-2022-0847_POC)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)