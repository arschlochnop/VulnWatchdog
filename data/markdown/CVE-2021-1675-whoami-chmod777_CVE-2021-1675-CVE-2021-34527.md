## CVE-2021-1675 PrintNightmare

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，包括但不限于 Windows 7, Windows 8.1, Windows 10 (多个版本), Windows Server 2008, Windows Server 2012, Windows Server 2016, Windows Server 2019, Windows Server 2020等，具体版本号参考漏洞库信息。

**利用条件:** 目标系统需要启用Print Spooler服务，攻击者需要一定的权限（通常是域用户）或欺骗用户进行操作。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。根据搜索引擎结果和漏洞库信息，此漏洞影响多个Windows版本。提供的PoC代码 `CVE-2021-1675.ps1` 是一个PowerShell脚本，旨在利用此漏洞。该脚本通过添加恶意的打印机驱动程序来执行代码。如果 `$DLL` 参数为空，PoC会创建一个默认payload，在临时目录生成恶意DLL,用于创建新的本地管理员用户。如果提供了自定义的DLL，PoC会直接使用该DLL进行攻击。PoC的有效性较高，因为该漏洞在野外被广泛利用，并且CISA已将其添加到已知被利用的漏洞目录中。存在轻微投毒风险，因为PoC可以接受用户提供的DLL，攻击者可以在提供的DLL中植入恶意代码。PoC中默认DLL部分存在恶意行为，但该行为是POC功能的一部分，用于创建用户，不应视为投毒。根据提供的PoC代码，投毒风险估计为10%，主要来自于用户可能提供的恶意DLL。

**利用方式：**
1.  攻击者需要能够访问目标系统的网络。
2.  攻击者运行PoC脚本，指定恶意DLL或使用默认payload。
3.  PoC脚本利用Print Spooler服务添加恶意的打印机驱动程序。
4.  Print Spooler服务加载恶意DLL，执行其中的代码，从而允许攻击者以SYSTEM权限在目标系统上执行任意代码。
5. 通过执行DLL创建新用户或者其他更高级的操作.

**项目地址:** [whoami-chmod777/CVE-2021-1675-CVE-2021-34527](https://github.com/whoami-chmod777/CVE-2021-1675-CVE-2021-34527)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)