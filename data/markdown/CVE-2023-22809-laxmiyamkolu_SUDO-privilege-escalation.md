## CVE-2023-22809-Sudoedit特权提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 特权提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.8.0 <= Sudo < 1.9.12p2

**利用条件:** 需要用户具有sudoedit权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22809 漏洞允许本地攻击者通过 `sudoedit` 命令提升权限。`sudoedit` 功能在处理用户提供的环境变量（`SUDO_EDITOR`、`VISUAL` 和 `EDITOR`）时存在缺陷，允许攻击者向要处理的文件列表中追加任意条目。攻击者可以通过在编辑器环境变量中包含 `--` 参数来绕过保护机制，例如，设置 `EDITOR='vim -- /path/to/extra/file'`。

**漏洞利用方式：**

1.  **检查Sudo版本：** 确认Sudo版本在受影响范围内 (1.8.0 到 1.9.12p1)。
2.  **检查用户权限：** 确认用户拥有使用`sudoedit`编辑文件的权限。
3.  **设置EDITOR环境变量：** 设置`EDITOR`环境变量，使其包含恶意参数，例如`EDITOR='vim -- /etc/passwd'`。
4.  **使用sudoedit编辑文件：** 使用`sudoedit`编辑允许的文件，触发漏洞，从而能够编辑`/etc/passwd`或其他敏感文件。
5.  **修改/etc/passwd：** 修改`/etc/passwd`文件，将当前用户的UID修改为0，使其成为root用户。
6.  **切换用户：** 使用`su`命令切换到被提权的用户。

**有效性：**

提供的POC代码基本有效，它演示了利用漏洞提升权限的步骤。代码首先检查Sudo版本和用户权限，然后指导用户设置`EDITOR`环境变量，并使用`sudoedit`编辑文件。最后，它引导用户手动修改`/etc/passwd`文件并切换用户。该脚本是半自动化的，需要用户手动干预来修改`/etc/passwd`。

**投毒风险：**

该POC代码的投毒风险较低，约为10%。主要风险在于脚本尝试引导用户修改`/etc/passwd`文件。虽然这是漏洞利用的一部分，但如果用户不小心修改了其他重要配置，可能会导致系统不稳定或无法启动。此外，脚本的作者可能在`README.md`或其他文件中包含误导性信息，引导用户执行不安全的操作。但总体而言，代码本身没有明显的恶意行为。

更详细地分析，脚本中需要用户手动修改/etc/passwd这一步，用户可能会犯错，导致系统问题。理论上，攻击者可以将错误的修改方式写入脚本或文档中，让用户误操作，但现有代码并没有此类行为，因此风险较低。

**项目地址:** [laxmiyamkolu/SUDO-privilege-escalation](https://github.com/laxmiyamkolu/SUDO-privilege-escalation)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)