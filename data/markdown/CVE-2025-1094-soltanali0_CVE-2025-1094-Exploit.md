## CVE-2025-1094-PostgreSQL-SQL注入到RCE

**漏洞编号:** CVE-2025-1094

**漏洞类型:** SQL注入

**影响应用:** PostgreSQL

**危害等级:** 高危，可导致数据泄露和远程代码执行

**影响版本:** PostgreSQL 17.3之前, 16.7之前, 15.11之前, 14.16之前, 13.19之前

**利用条件:** 需要应用程序使用受影响的`PQescapeLiteral()`, `PQescapeIdentifier()`, `PQescapeString()`, 和 `PQescapeStringConn()` 函数的结果构建输入到 `psql`，或当`client_encoding`是`BIG5`且`server_encoding`是`EUC_TW`或`MULE_INTERNAL`时，利用命令行参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-1094 是一个存在于 PostgreSQL 的 SQL 注入漏洞，允许攻击者通过注入恶意 SQL 代码读取敏感文件并执行任意命令，最终实现远程代码执行。漏洞利用涉及多个阶段：

1.  **SQL 注入**：攻击者利用 `PQescapeLiteral()`, `PQescapeIdentifier()`, `PQescapeString()`, 和 `PQescapeStringConn()` 函数中的不当转义，向PostgreSQL数据库注入恶意的SQL语句。从PoC代码来看，此处的SQL注入是通过`lo_export`和`pg_read_file`函数读取`/etc/passwd`文件，并将其保存到`/tmp/payload`。

2.  **WebSocket 劫持**：攻击者劫持一个已建立的WebSocket连接，并发送恶意payload，目的是在服务器上执行任意命令。

3.  **远程代码执行 (RCE)**：通过WebSocket连接发送的payload包含反向shell代码，该代码会连接到攻击者的监听端口，从而使攻击者获得服务器的控制权。

**有效性评估：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该PoC代码在满足特定条件的情况下是有效的。条件包括：
*   PostgreSQL 版本在受影响范围内。
*   应用程序使用了易受攻击的转义函数，或者使用了不安全的命令行参数。
*   存在可被劫持的 WebSocket 连接（PoC 代码假设存在）。

**投毒风险分析：**

该PoC代码存在一定的投毒风险，风险评估为10%。主要风险点在于：

*   **依赖外部 WebSocket 连接：** 该PoC假设存在一个可劫持的WebSocket连接。如果攻击者诱导用户使用包含恶意WebSocket连接的PoC，可能导致意外行为或信息泄露。
*   **反向Shell依赖：** PoC代码通过建立反向shell获取服务器控制权，如果攻击者修改了反向shell连接的IP和端口，可能会将受害者暴露给未知的第三方。
*  **文件读写**:虽然PoC读取`/etc/passwd`是为了演示，但未经授权的文件读写行为本身就是高危的。攻击者可能会更改读取的文件，或写入恶意文件，从而引入其他安全风险。
*   **隐蔽性**：攻击者可以将恶意代码隐藏在看似无害的WebSocket消息中，增加检测的难度。

**利用方式总结：**

1.  利用SQL注入漏洞，读取服务器上的敏感文件，例如`/etc/passwd`。
2.  劫持已建立的WebSocket连接。
3.  通过WebSocket连接，发送包含反向shell的恶意payload，从而在服务器上执行任意命令，获得服务器的远程控制权限。

**项目地址:** [soltanali0/CVE-2025-1094-Exploit](https://github.com/soltanali0/CVE-2025-1094-Exploit)

**漏洞详情:** [CVE-2025-1094](https://nvd.nist.gov/vuln/detail/CVE-2025-1094)