## CVE-2017-5638-Apache Struts-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 需要目标系统运行存在漏洞版本的Apache Struts，且可以通过HTTP请求访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638 漏洞存在于 Apache Struts 2 的 Jakarta Multipart parser 中，由于其在处理文件上传时存在异常处理和错误消息生成方面的缺陷，允许远程攻击者通过构造恶意的 Content-Type, Content-Disposition 或 Content-Length HTTP 头部来执行任意命令。漏洞利用代码分析如下：

1.  **有效性：** 提供的POC代码通过构造包含 OGNL 表达式的 Content-Type 头部，利用 Struts 框架的漏洞执行任意命令，该方法是有效的。搜索引擎结果和漏洞库信息均表明此漏洞是一个高危且被广泛利用的远程代码执行漏洞。

2.  **投毒风险：** 投毒风险较低，约为10%。虽然该仓库提供了一个预编译的exe文件，但exe文件是一个struts漏洞利用工具,功能上与漏洞库和搜索引擎信息一致,其源代码也被一并给出。潜在的风险在于：
    *   **预编译的二进制文件可能包含恶意代码。** 虽然提供了源代码，但用户在使用前通常不会仔细审计所有代码。
    *   **Payload生成逻辑** payload.cpp 中 OGNL 表达式的构造虽然直接，但也存在被篡改以执行恶意操作的可能性。

3.  **利用方式：**
    *   攻击者发送一个特制的 HTTP 请求到目标服务器，该请求的 Content-Type 头部包含一个 OGNL 表达式。
    *   Struts 框架在处理该请求时，会解析并执行该 OGNL 表达式。
    *   攻击者可以使用 OGNL 表达式来执行任意命令，例如，通过 `java.lang.Runtime.getRuntime().exec()` 执行系统命令，从而获取对服务器的控制权。
    *   POC代码中，telnet函数建立socket链接，并持续发送payload，从而建立telnet连接，进入控制台。

 4. **排序优先级:** 搜索引擎结果 > 漏洞利用代码 > 漏洞库信息


**项目地址:** [jptr218/struts_hack](https://github.com/jptr218/struts_hack)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)