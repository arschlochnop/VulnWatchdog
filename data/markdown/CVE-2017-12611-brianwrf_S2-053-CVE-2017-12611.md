## CVE-2017-12611-Apache Struts-远程代码执行

**漏洞编号:** CVE-2017-12611

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行，控制服务器

**影响版本:** 2.0.0 - 2.3.33, 2.5 - 2.5.10.1

**利用条件:** 需要目标系统运行存在漏洞版本的Apache Struts，且存在可利用的Freemarker标签

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12611 漏洞存在于 Apache Struts 2.0.0 到 2.3.33 和 2.5 到 2.5.10.1 版本中。 漏洞原因是当 Freemarker 标签中使用了非预期的表达式代替字符串时，可能导致远程代码执行。

**有效性：**

根据漏洞信息和搜索结果，POC代码是有效的。 Exploit-DB 上的信息以及其他安全网站确认了该漏洞的存在和可利用性。 提供的 `exploit.py` 脚本构造了恶意的 OGNL 表达式，通过修改 OGNL 的成员访问控制来执行任意命令。

**投毒风险：**

分析提供的 `exploit.py` 脚本，主要功能是：

1.  接收 URL、参数名和要执行的命令作为输入。
2.  构造包含恶意 OGNL 表达式的 payload。
3.  URL 编码 payload。
4.  发送 HTTP GET 请求到目标 URL，其中 payload 作为参数值。
5.  打印响应内容。

从代码逻辑看，该脚本实现了漏洞利用的功能，但存在潜在的投毒风险，具体如下：

*   **潜在风险点：**虽然代码的主要功能是执行命令，但如果恶意攻击者修改了脚本，例如添加额外的网络请求或文件操作，可能在受害者不知情的情况下执行恶意行为。该脚本的参数可以被修改为恶意的URL、参数名和指令。
*   **缓解措施：** 使用前，需要仔细检查代码，确保没有添加额外的恶意代码。尽可能从可信的来源获取漏洞利用代码。

基于以上分析，我给出的投毒风险评估是 **10%**。

**利用方式：**

利用方式主要包括以下步骤：

1.  **确定目标：** 找到运行着受影响的 Apache Struts 版本的应用程序。
2.  **构造Payload：** 利用`exploit.py`脚本生成payload。脚本需要目标URL，存在漏洞的参数名和要执行的命令。
3.  **发送请求：**  将包含恶意 OGNL 表达式的 Payload 通过 HTTP GET 请求发送给目标服务器。
4.  **执行命令：** 如果服务器存在漏洞，将执行Payload中指定的命令。
5.  **获取结果：**  命令执行的结果会包含在 HTTP 响应中。

该漏洞的根本原因是 Struts 框架对 Freemarker 标签中的表达式处理不当，导致攻击者可以注入恶意的 OGNL 表达式来执行任意代码。

**项目地址:** [brianwrf/S2-053-CVE-2017-12611](https://github.com/brianwrf/S2-053-CVE-2017-12611)

**漏洞详情:** [CVE-2017-12611](https://nvd.nist.gov/vuln/detail/CVE-2017-12611)