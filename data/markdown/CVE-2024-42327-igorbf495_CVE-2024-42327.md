## CVE-2024-42327 - Zabbix SQL 注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL 注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致权限提升、数据泄露和远程命令执行

**影响版本:** 6.0.0 <= 6.0.31, 6.4.0 <= 6.4.16, 7.0.0 <= 7.0.1

**利用条件:** 需要 Zabbix 前端非管理员用户账户，且该账户拥有 API 访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42327 是 Zabbix 前端 API 中 CUser 类的 addRelatedObjects 函数中存在的 SQL 注入漏洞。此漏洞允许具有 API 访问权限的非管理员用户利用。根据搜索结果和提供的漏洞利用代码，利用方式如下：

1.  **漏洞利用方式：** 攻击者可以使用 Zabbix API，特别是 user.get 方法，触发 CUser 类的 addRelatedObjects 函数中的 SQL 注入。 攻击者首先通过 user.login 获取 token，然后修改请求参数，调用 user.update 函数， 尝试修改用户角色为超级用户。由于 `usrgrps` 参数缺少验证，可以被滥用，将用户添加到多个用户组中。通过将用户添加到 Zabbix administrators group 等具有无限制权限的组，可以提升用户权限。

2.  **有效性：** 提供的漏洞利用代码包含利用 CVE-2024-42327 的信息。代码展示了如何通过 Zabbix API 进行身份验证，以及如何构造恶意请求来利用 SQL 注入漏洞并尝试提升权限。搜索结果中的多个页面也证实了该漏洞的存在和严重性，以及PoC的存在。

3.  **投毒风险：** 虽然漏洞利用代码主要集中在利用 SQL 注入漏洞，但也存在一定的投毒风险。仔细检查了提供的代码，没有明显的恶意代码。`README.md` 文件主要描述了如何利用漏洞，没有发现作者有意添加的后门或恶意功能。代码中存在的风险主要在于攻击者可能会修改代码，引入恶意的SQL 语句，从而导致被攻击服务器的数据遭到破坏。考虑到代码的复杂性，以及潜在的风险，这里给出10%的投毒风险评估。

**项目地址:** [igorbf495/CVE-2024-42327](https://github.com/igorbf495/CVE-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)