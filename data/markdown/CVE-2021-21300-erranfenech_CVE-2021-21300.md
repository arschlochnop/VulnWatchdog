## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用受影响的Git版本，并且文件系统是大小写不敏感的（如NTFS, HFS+或APFS），同时配置了clean/smudge filters (例如 Git LFS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 是一个Git的远程代码执行漏洞。该漏洞出现在当克隆包含符号链接的恶意仓库时，并且该仓库使用了 clean/smudge 过滤器（比如 Git LFS）。在大小写不敏感的文件系统上（如Windows和macOS的默认文件系统），这可能导致在检出时执行恶意代码。

**有效性：**
提供的POC代码看起来是有效的。它创建了一个包含符号链接（`ln -s .git/hooks a`）和 `post-checkout` hook 的恶意仓库。当这个仓库被克隆到启用了符号链接和 clean/smudge 过滤器的系统上，并且文件系统是大小写不敏感的时候，`post-checkout` 脚本就会被执行，从而实现远程代码执行。

**投毒风险：**
该POC代码的主要目的是演示漏洞，没有发现明显的投毒代码。脚本只是简单地输出"PWNED"来表示漏洞利用成功。因此，投毒风险估计为0%。

**利用方式：**
1.  攻击者创建一个恶意的Git仓库。
2.  仓库包含一个符号链接，指向 `.git/hooks` 目录下的一个 hook 脚本(如 post-checkout)。
3.  仓库配置了 clean/smudge 过滤器 (例如通过 `.gitattributes` 文件启用Git LFS)。
4.  攻击者诱使用户克隆该恶意仓库。
5.  当用户克隆仓库时，Git会在大小写不敏感的文件系统上创建符号链接。
6.  由于 clean/smudge 过滤器的存在，以及大小写不敏感的文件系统，hook 脚本会被执行，从而导致远程代码执行。

总而言之，此漏洞的利用依赖于特定的环境配置，比如文件系统的大小写不敏感性和clean/smudge 过滤器的启用。

**项目地址:** [erranfenech/CVE-2021-21300](https://github.com/erranfenech/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)