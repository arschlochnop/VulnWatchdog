## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3

**利用条件:** 目标系统配置了 GlobalProtect gateway 或 GlobalProtect portal, 且为受影响的 PAN-OS 版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞，由于任意文件创建漏洞导致。攻击者可以通过 GlobalProtect 服务，利用此漏洞在防火墙上以 root 权限执行任意代码，无需身份验证。

**漏洞利用方式：**

1.  攻击者利用 GlobalProtect 的未授权访问点，通过构造特定的请求，触发任意文件创建漏洞。
2.  利用任意文件创建漏洞，写入包含恶意命令的文件。
3.  通过命令注入，执行恶意代码，从而控制防火墙。

**提供的漏洞利用代码分析：**

提供的代码 `IPLineFinder.py` **不是直接的漏洞利用代码**。它是一个 Python 脚本，用于在日志文件中查找包含特定 IP 地址的行，并将这些行提取到新的文件中。此脚本的设计目的是用于取证分析，以确定受 CVE-2024-3400 影响的系统是否已被入侵，通过搜索已知的恶意 IP 地址来判断。

**关于投毒风险的分析：**

*   `IPLineFinder.py` 本身：脚本逻辑相对简单，主要功能是搜索和提取日志行。直接的恶意代码注入风险较低。但如果攻击者替换或修改了`ip_addresses` 列表，添加了用于混淆或误导分析的IP地址，则存在投毒风险，使分析人员无法准确识别攻击源头或关联恶意活动。

*   依赖性：该脚本依赖于 Python 标准库 `os`。 虽然标准库的风险较低，但如果脚本在受损环境中执行，则存在被篡改的风险。

*   整体风险评估：考虑到脚本的功能和依赖性，以及攻击者可能的操作，估计投毒风险为 10%。这主要是指攻击者可能篡改 IP 地址列表，来混淆视听。

**搜索引擎结果佐证：**

搜索结果表明，CVE-2024-3400 是一个已在野外被利用的零日漏洞，且存在公开的 POC。Volexity 等安全公司发布了关于如何检测 compromised 设备的报告。CrowdStrike 和 Zscaler 也发布了相关的分析报告。

综上所述，CVE-2024-3400 是一个高危漏洞，可以被远程利用，需要及时修复。提供的脚本 `IPLineFinder.py` 本身不是漏洞利用代码，而是用于入侵检测和取证分析的工具，但存在被投毒的潜在风险，尽管风险较低。

**项目地址:** [tk-sawada/IPLineFinder](https://github.com/tk-sawada/IPLineFinder)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)