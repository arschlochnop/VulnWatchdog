## CVE-2016-6662 - MySQL Remote Root Code Execution / Privilege Escalation

**漏洞编号:** CVE-2016-6662

**漏洞类型:** 权限提升/远程代码执行

**影响应用:** MySQL, MariaDB, Percona Server

**危害等级:** 高危，可导致数据库服务器完全控制

**影响版本:** MySQL <= 5.5.52, 5.6.x <= 5.6.33, 5.7.x <= 5.7.15; MariaDB < 5.5.51, 10.0.x < 10.0.27, 10.1.x < 10.1.17; Percona Server < 5.5.51-38.1, 5.6.x < 5.6.32-78.0, 5.7.x < 5.7.14-7

**利用条件:** 需要能够修改MySQL配置文件 (my.cnf) 并且目标服务器运行受影响的版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-6662 允许本地用户通过设置 `general_log_file` 选项为 `my.cnf` 配置文件，创建任意配置并绕过某些保护机制。 这可以被利用来执行具有 root 权限的任意代码，通过设置 `malloc_lib` 选项。提供的PoC代码 `0ldSQL_MySQL_RCE_exploit.py` 是一个有限的版本，仅允许附加到现有 MySQL 配置文件的末尾。完整利用需要目标my.cnf具有mysql用户可写的权限。利用方式如下：

1.  **编译恶意共享库 (mysql_hookandroot_lib.so):**  该库包含恶意代码，用于提权和执行命令。
2.  **将恶意库转换为十六进制:** 将编译好的共享库内容转换为十六进制字符串。
3.  **利用SQL注入或其它方式修改my.cnf:**  将`malloc_lib`设置为恶意共享库的路径，并将`general_log_file`设置为`my.cnf`。需要具有FILE权限。
4.  **重启 MySQL 服务:**  重启后，MySQL将加载恶意共享库，执行其中的代码，从而获得 root 权限。

**投毒风险分析:**

该PoC代码的投毒风险较低 (10%)。PoC本身的功能是演示如何利用漏洞，并包含编译shellcode等必要步骤。然而，不排除作者在编译恶意库的过程中可能隐藏恶意代码的可能性。因此，在使用该PoC时，务必仔细审查代码，特别是 `mysql_hookandroot_lib.c` 文件，并进行代码审计以确保其安全性。

搜索引擎结果表明，该漏洞影响广泛，多个厂商的MySQL发行版都受影响。修复方案包括升级到最新版本或应用厂商提供的补丁。

**项目地址:** [boompig/cve-2016-6662](https://github.com/boompig/cve-2016-6662)

**漏洞详情:** [CVE-2016-6662](https://nvd.nist.gov/vuln/detail/CVE-2016-6662)