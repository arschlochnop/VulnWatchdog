## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要安装了Elementor插件或使用了存在漏洞利用点的其他插件/主题，且WordPress版本低于5.8.3

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-21661 是 WordPress 存在的一个 SQL 注入漏洞，位于 WP_Query 中，由于不正确的过滤，允许经过身份验证的攻击者（需要高权限，例如管理员）通过精心设计的请求执行任意 SQL 查询。该漏洞的利用依赖于特定的插件或主题以某种方式使用 WP_Query ，根据漏洞库信息，攻击复杂度较高。

**有效性评估：**

根据提供的漏洞利用代码和搜索结果，该漏洞是有效的。搜索结果中多个来源（NVD, Vicarius, pentest-tools, Rapid7, Exploit-DB）都确认了该漏洞的存在和风险。提供的 `exploit.py` 脚本利用了 Elementor 插件的 ecsload action，通过注入恶意的 tax_query 参数中的 term_taxonomy_id 字段进行时间盲注，从而获取数据库信息。

**投毒风险评估：**

分析提供的 `exploit.py` 脚本，该脚本主要实现了以下功能：

1.  **数据库长度爆破：** 通过 `PAYLOAD_DB_LEN` 构造 SQL 注入 payload，使用时间盲注来确定数据库名称的长度。
2.  **数据库名称提取：** 通过 `PAYLOAD_DB_NAME` 构造 SQL 注入 payload，使用时间盲注逐字符提取数据库名称。
3.  **用户数据爆破：** 通过 `PAYLOAD_USR_DMP_LEN` 构造 SQL 注入 payload，使用时间盲注来确定 `wp_users` 表中所有用户信息的长度（ID、用户名、密码哈希）。
4.  **用户数据提取：** 通过 `PAYLOAD_USR_DUMP` 构造 SQL 注入 payload，使用时间盲注逐字符提取 `wp_users` 表中所有用户的信息。

`docker-compose.yml` 文件用于搭建一个存在漏洞的 WordPress 环境，方便进行漏洞验证。

`README.md` 文件是占位符。

**潜在投毒风险：**代码中并没有明显的恶意代码或后门。风险主要在于利用脚本本身被用于非法目的，而非作者植入的恶意代码。脚本中存在与目标服务器进行交互和睡眠的函数，理论上会增加服务器的负担，存在轻微的拒绝服务风险。代码中利用了time.sleep，如果被滥用确实可能对服务器资源造成消耗，但是总体上可以判定投毒风险极低。

**利用方式：**

1.  **环境搭建：** 使用 `docker-compose.yml` 搭建一个存在漏洞的 WordPress 环境（版本低于 5.8.3）。
2.  **漏洞触发：** 确保安装了 Elementor 插件并开启，或者存在能够触发WP_Query的漏洞利用点的其它插件/主题。
3.  **SQL 注入：** 利用 `exploit.py` 脚本，通过 Elementor 插件的 ecsload action，向 `tax_query` 参数中的 `term_taxonomy_id` 字段注入恶意的 SQL 代码。
4.  **信息泄露：** 脚本通过时间盲注，可以获取数据库名称、用户表信息（用户名、密码哈希）等敏感数据。攻击者可进一步利用这些信息进行恶意操作，如登录后台、篡改数据等。


**项目地址:** [kittypurrnaz/cve-2022-21661](https://github.com/kittypurrnaz/cve-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)