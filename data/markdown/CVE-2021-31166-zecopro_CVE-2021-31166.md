## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于10.0.19041.982或10.0.19042.982)

**利用条件:** 目标系统需要运行存在漏洞的HTTP协议栈服务，攻击者需要能够向目标服务器发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个HTTP协议栈远程代码执行漏洞，影响多个Windows版本。从漏洞库信息来看，该漏洞的CVSS评分为9.8，属于高危漏洞，且已被CISA加入到已知被利用漏洞目录中。提供的POC代码是一个简单的bash脚本，其作用是发送一个包含特定`Accept-encoding`头的HTTP请求到目标URL。漏洞利用的关键在于特制的`Accept-encoding`头，该头会导致http.sys解析错误，触发use-after-free漏洞，从而可能导致远程代码执行。由于提供的POC仅为发送带有特定header的请求，没有其他恶意操作，因此判断不存在投毒代码，风险概率为0%。利用方式是发送特制的HTTP请求到存在漏洞的服务器。

**项目地址:** [zecopro/CVE-2021-31166](https://github.com/zecopro/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)