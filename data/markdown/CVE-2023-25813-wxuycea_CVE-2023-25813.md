## CVE-2023-25813-Sequelize-SQL注入

**漏洞编号:** CVE-2023-25813

**漏洞类型:** SQL注入

**影响应用:** Sequelize

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 6.19.1

**利用条件:** 应用程序使用受影响版本的Sequelize，并且使用 `replacements` 和 `where` 选项在同一查询中。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-25813 是 Sequelize (Node.js ORM) 在 6.19.1 之前的版本中存在的一个 SQL 注入漏洞。该漏洞与 `replacements` 参数的处理有关。如果应用程序在使用 `replacements` 时没有正确转义用户输入，则攻击者可以通过构造恶意的 SQL 语句来执行任意 SQL 代码。

**有效性评估：**

根据漏洞库信息和搜索引擎结果，此漏洞的严重程度被评为“CRITICAL”，并且存在公开可用的漏洞利用代码（POC）。提供的代码仓库包含了一个 Dockerfile 和 docker-compose.yml 文件，用于搭建一个包含漏洞环境的应用程序，以及相关的 Sequelize 代码。`package.json` 文件指定了易受攻击的 Sequelize 版本 `<6.19.1`，这表明该 POC 是有效的。  此外，readme.md说明该仓库是用来重现该漏洞。

**投毒风险评估：**

代码仓库主要包含以下文件：

*   `Dockerfile`：用于构建 Docker 镜像，未发现恶意代码。
*   `README.md`：漏洞说明文档，无恶意内容。
*   `app.js`：应用程序的主文件，用于启动 Express 服务器并连接到数据库。
*   `docker-compose.yml`：用于定义 Docker 容器，未发现恶意配置。
*   `package.json`：定义项目依赖，指定了有漏洞的Sequelize版本。
*   `wait-for-it.sh`：一个用于等待数据库服务启动的脚本,常规用法。
*   `/routes/auth.js`: 应用路由，可能存在注入点。
*   `/config/database.js`: 数据库配置,其中可能会暴露一些数据库的配置信息。

仔细检查了仓库中的每个文件，除了使用存在漏洞的Sequelize版本来重现漏洞外，没有发现明显的恶意代码或隐藏的后门。`wait-for-it.sh` 脚本用于确保数据库服务在应用程序启动之前可用，这是一个常见的做法，本身不具有恶意性。

`/routes/auth.js`和 `/config/database.js` 需要根据具体的实现来判断是否存在后门，如果包含一些未授权访问或者硬编码的凭据信息，那么可能存在投毒风险。但根据目前的信息，无法断定存在恶意代码。

因此，投毒风险评估为 **5%** 。这个较低的百分比主要考虑到：(1) 仓库的主要目的是为了复现已知的漏洞, (2) 大部分代码都是标准配置和应用程序框架，(3) 没有发现任何主动注入恶意代码的证据。 风险主要来自于 `/routes/auth.js`和 `/config/database.js` 可能存在的潜在后门。

**利用方式：**

攻击者可以利用此漏洞通过 `replacements` 参数注入恶意 SQL 代码。例如，如果应用程序使用类似以下的代码：

```javascript
sequelize.query('SELECT * FROM users WHERE username = :username', {
  replacements: { username: req.query.username }
});
```

攻击者可以通过在 `req.query.username` 中注入恶意 SQL 代码来执行任意 SQL 查询，例如：

```
http://example.com/users?username=admin' OR '1'='1
```

这将导致查询变为：

```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1'
```

这将返回所有用户的信息，而不仅仅是用户名为 `admin` 的用户。攻击者可以利用这种方式来读取、修改或删除数据库中的任何数据，或者甚至执行系统命令（如果数据库用户具有足够的权限）。

**项目地址:** [wxuycea/CVE-2023-25813](https://github.com/wxuycea/CVE-2023-25813)

**漏洞详情:** [CVE-2023-25813](https://nvd.nist.gov/vuln/detail/CVE-2023-25813)