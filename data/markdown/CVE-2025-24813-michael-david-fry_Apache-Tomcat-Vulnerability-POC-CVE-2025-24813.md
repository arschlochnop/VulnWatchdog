## CVE-2025-24813 - Apache Tomcat 路径等价和反序列化漏洞

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价 / 反序列化

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行、信息泄露或恶意内容注入

**影响版本:** 9.0.0.M1 <= version <= 9.0.98, 10.1.0-M1 <= version <= 10.1.34, 11.0.0-M1 <= version <= 11.0.2

**利用条件:** 对于RCE：Default Servlet 开启写入，支持Partial PUT，使用了Tomcat文件session持久化默认位置，存在可利用的反序列化库。对于信息泄露/内容注入：Default Servlet 开启写入，支持Partial PUT，存在敏感文件上传目录是公共上传目录的子目录，攻击者已知敏感文件名，使用Partial PUT上传敏感文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813是Apache Tomcat中的一个漏洞，涉及路径等价（'file.Name' 中的内部点）可能导致远程代码执行 (RCE)、信息泄露，或通过启用写入的默认Servlet向上传的文件添加恶意内容。漏洞存在于多个Tomcat版本：9.0.0.M1到9.0.98，10.1.0-M1到10.1.34，以及11.0.0-M1到11.0.2。

根据漏洞描述，如果Default Servlet启用了写入（默认禁用），支持Partial PUT（默认启用），并且应用程序使用了Tomcat的基于文件的会话持久化以及默认存储位置，同时应用程序包含可用于反序列化攻击的库，则可能导致RCE。另外，如果Default Servlet启用了写入，支持Partial PUT，并且存在安全敏感文件上传的目标URL是公共上传目标URL的子目录，攻击者已知安全敏感文件的名称，并且安全敏感文件也是通过partial PUT上传，攻击者可以查看安全敏感文件或向其中注入内容。

提供的PoC代码 (CVE-2025-24813.py) 旨在执行非侵入性检查，以验证目标服务器是否容易受到攻击。它首先尝试从HTTP Server标头中提取Tomcat版本。然后，它尝试通过HTTP PUT在目标上创建一个名为“CVE-2025-24813-check.txt”的文件，如果成功，则删除该文件。这用于确定DefaultServlet是否已启用写入。最后，它尝试检索会话ID。该脚本接受CSV文件作为输入，并在报告文件中记录所有操作。

**有效性：** 根据搜索结果，CVE-2025-24813已被利用，这表明该漏洞确实存在，并且可以被利用。提供的PoC代码主要用于检测漏洞的存在，而不是直接利用RCE或信息泄露。

**投毒风险：** PoC代码中，主要功能是进行版本检测和判断DefaultServlet是否开启写入权限。在提供的代码片段中，没有明显的恶意代码。但是仍存在一定的风险（估计为10%），例如：

1.  **依赖项风险：** 脚本使用了 `requests` 库，如果该库本身被篡改（例如通过PyPI投毒），可能会引入恶意代码。
2.  **报告文件：**  报告文件可能包含敏感信息，如果报告文件被上传到公共位置，可能导致信息泄露。
3.  **脚本维护者风险：** 如果脚本的维护者受到恶意攻击或者本身就是恶意用户，可能会在后续版本中添加恶意代码。

**利用方式：**

1.  **RCE (远程代码执行):**  攻击者需要满足多个条件，包括Default Servlet开启写入，支持Partial PUT，使用了Tomcat文件session持久化默认位置，存在可利用的反序列化库。攻击者利用Partial PUT上传恶意序列化数据到Tomcat的session文件，从而执行任意代码。
2.  **信息泄露/内容注入：**  攻击者需要满足多个条件，包括Default Servlet开启写入，支持Partial PUT，存在敏感文件上传目录是公共上传目录的子目录，攻击者已知敏感文件名，使用Partial PUT上传敏感文件。攻击者利用Partial PUT覆盖或修改敏感文件。

总的来说，该漏洞的利用需要特定配置和条件，提供的PoC主要用于初步检测，实际利用需要更复杂的攻击步骤。

**项目地址:** [michael-david-fry/Apache-Tomcat-Vulnerability-POC-CVE-2025-24813](https://github.com/michael-david-fry/Apache-Tomcat-Vulnerability-POC-CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)