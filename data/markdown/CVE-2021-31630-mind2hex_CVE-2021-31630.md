## CVE-2021-31630-OpenPLC Webserver v3-命令注入

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver

**危害等级:** 高危，可导致远程代码执行

**影响版本:** v3

**利用条件:** 需要OpenPLC Webserver v3运行，且攻击者需要具有Web应用的登录权限，访问/hardware页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31630是OpenPLC Webserver v3中的一个命令注入漏洞。攻击者通过利用"Hardware Layer Code Box"组件，可以在/hardware页面上执行任意代码。从搜索引擎结果来看，多个安全平台都记录了该漏洞，并确认了其严重性。提供的漏洞利用代码是一个Python脚本，它首先通过提供的用户名和密码登录到OpenPLC Web服务器。然后，它会构造一个包含反向shell命令的恶意C代码，并将其注入到“Hardware Layer Code Box”中。当OpenPLC Web服务器尝试编译和执行这段C代码时，就会执行攻击者注入的命令，从而建立一个反向shell连接到攻击者的机器上。由于该脚本的主要功能是利用命令注入漏洞建立反向shell，因此不存在明显的投毒代码。

**有效性分析：**
POC代码有效，因为代码实现了利用漏洞描述中提到的"Hardware Layer Code Box"组件在/hardware页面执行任意代码。通过修改C代码中的IP地址和端口，可以实现反向shell。

**投毒风险分析：**
提供的POC代码主要是利用漏洞建立反向shell，并未发现明显的恶意代码。脚本只是将用户提供的IP地址和端口插入到C代码中，并发送到目标服务器。因此，可以认为投毒风险较低，约为0%。

**利用方式分析：**
1.  攻击者需要拥有OpenPLC Webserver的登录凭证（默认用户名/密码通常是openplc/openplc，攻击者可能需要先进行密码爆破或者其他手段获取凭据）。
2.  攻击者使用提供的Python脚本，指定目标OpenPLC Webserver的URL、用户名、密码以及反向shell的IP地址和端口。
3.  脚本首先登录到OpenPLC Webserver。
4.  脚本构造包含恶意命令的C代码（反向shell）。
5.  脚本将恶意的C代码发送到/hardware页面的“Hardware Layer Code Box”组件。
6.  OpenPLC Webserver尝试编译并执行这段C代码，从而在服务器上执行攻击者注入的命令。
7.  攻击者在其监听端口上接收到反向shell连接，从而获得对OpenPLC Webserver服务器的控制权。

**项目地址:** [mind2hex/CVE-2021-31630](https://github.com/mind2hex/CVE-2021-31630)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)