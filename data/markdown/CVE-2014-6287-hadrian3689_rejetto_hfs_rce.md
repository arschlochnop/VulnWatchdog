## CVE-2014-6287 Rejetto HFS 2.3.x 远程命令执行

**漏洞编号:** CVE-2014-6287

**漏洞类型:** 远程命令执行

**影响应用:** Rejetto HTTP File Server (HFS)

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** 2.3x before 2.3c

**利用条件:** 需要目标服务器运行受影响版本的Rejetto HFS，并且攻击者能够通过网络访问该服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2014-6287 存在于 Rejetto HTTP File Server (HFS) 2.3x 版本直到 2.3c 之前的版本中。漏洞位于 `parserLib.pas` 文件中的 `findMacroMarker` 函数。攻击者可以利用 `%00` 序列在搜索操作中执行任意程序。

**有效性：**
根据漏洞信息、搜索结果（尤其是 Exploit-DB 的链接）以及提供的 POC 代码，可以判断此漏洞是有效的。Metasploit 也有相应的模块（根据 github.com/rapid7/metasploit-framework/pull/3793）。提供的 Python 脚本 `hfs.py` 实现了漏洞利用，通过构造包含恶意命令的 URL 发送到目标服务器，从而执行任意命令。

**投毒风险：**
POC 代码本身主要是构造payload，没有发现明显的投毒代码，只有一个很小的风险。
代码分析：
1.  使用 argparse 解析命令行参数：目标 URL、lhost（攻击者 IP 地址）和 lport（攻击者监听端口）。
2.  定义了 `HFS` 类，用于处理漏洞利用。
3.  `check_url` 函数：确保目标 URL 以 `/` 结尾。
4.  `hfs_exploit` 函数：
    *   构造 PowerShell 反向 shell payload，其中包含攻击者的 IP 地址和端口。
    *   使用 base64 编码 payload。
    *   使用 `requests.utils.quote` 对 payload 进行 URL 编码。
    *   构造包含 payload 的 URL：`?search=%00{{.exec|...payload...}}.}}`
    *   发送 GET 请求到构造的 URL。
5.  `rev_shell` 函数：在本地启动 netcat 监听指定端口。
6.  使用线程同时运行 `hfs_exploit` 和 `rev_shell` 函数。

**利用方式：**
1.  攻击者首先需要确认目标服务器运行着受影响版本的 Rejetto HFS。
2.  攻击者需要准备一个可以接受反向 shell 的监听器（例如，netcat）。
3.  攻击者运行提供的 Python 脚本，指定目标 URL、攻击者 IP 地址和监听端口。
4.  脚本会构造一个特殊的 URL，其中包含经过编码的 PowerShell 命令，用于在目标服务器上建立反向 shell。
5.  脚本将构造的 URL 发送到目标服务器。
6.  目标服务器解析 URL 中的命令，由于漏洞的存在，执行 PowerShell 命令，并建立与攻击者机器的反向 shell 连接。
7.  攻击者通过反向 shell 控制目标服务器。

**项目地址:** [hadrian3689/rejetto_hfs_rce](https://github.com/hadrian3689/rejetto_hfs_rce)

**漏洞详情:** [CVE-2014-6287](https://nvd.nist.gov/vuln/detail/CVE-2014-6287)