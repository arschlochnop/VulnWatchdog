## CVE-2020-0796 - SMBGhost 远程代码执行漏洞

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows 10 Version 1903/1909, Windows Server version 1903/1909

**利用条件:** 目标系统开启SMBv3服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796 (SMBGhost) 是一个存在于 Microsoft Server Message Block 3.1.1 (SMBv3) 协议中的远程代码执行漏洞。该漏洞源于 SMBv3 协议在处理某些请求时的方式存在缺陷，允许未经身份验证的攻击者通过构造恶意的压缩数据包，在目标系统上执行任意代码。根据漏洞库信息和搜索结果，该漏洞影响 Windows 10 版本 1903 和 1909，以及 Windows Server 版本 1903 和 1909。该漏洞具有"wormable"特性，意味着它可以自我传播。提供的漏洞利用代码包含一个扫描器 (scanner.py) 用于检测目标主机是否存在漏洞，以及一个攻击脚本 (exploit.py) 用于利用该漏洞。攻击脚本首先建立 SMB 连接并协商协议，然后发送包含恶意压缩数据的 SMB 数据包。该数据包的压缩长度字段被设置为一个很大的值，导致整数溢出，进而触发缓冲区溢出漏洞，允许攻击者覆盖内核内存，最终实现代码执行。 

**有效性评估：**
根据漏洞库信息和搜索结果中CISA的警告，该漏洞存在公开可用的PoC代码，并且已在实际环境中被利用，表明提供的PoC代码可能有效。该漏洞的利用难度较低，CVSS v3.1 评分为 10.0，表明其具有很高的危害性。

**投毒风险分析：**
漏洞利用代码 `exploit.py` 包含大量十六进制代码（`KERNEL_SHELLCODE`），这部分代码是攻击的核心，可能包含恶意负载。虽然这段代码看起来像合法的shellcode，但攻击者可能在其中植入后门或恶意指令。例如，shellcode可能被修改为在执行特定操作后，连接到攻击者的服务器，下载并执行其他恶意程序。 
scanner.py的功能相对简单，风险较低。 exploit.py 中存在投毒的可能性较高，大约 10%。需要对`KERNEL_SHELLCODE`进行详细分析，以确定其是否包含恶意代码。

**利用方式总结：**
1.  使用 `scanner.py` 扫描目标 IP 地址，判断是否存在 CVE-2020-0796 漏洞。
2.  如果目标存在漏洞，则使用 `exploit.py` 发起攻击。攻击脚本会与目标建立 SMB 连接，发送特制的 SMBv3 数据包，该数据包包含精心构造的压缩数据，利用整数溢出漏洞覆盖内核内存。
3.  通过覆盖内核内存，攻击者可以劫持控制流，执行预先准备好的 shellcode，从而在目标系统上执行任意代码。

**项目地址:** [OldDream666/cve-2020-0796](https://github.com/OldDream666/cve-2020-0796)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)