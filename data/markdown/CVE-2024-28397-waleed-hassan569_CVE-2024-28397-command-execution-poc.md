## CVE-2024-28397-js2py-Sandbox-Escape

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 代码注入

**影响应用:** js2py

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 0.74

**利用条件:** 需要应用程序使用存在漏洞版本的js2py且解析用户可控的JavaScript/JSON。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于js2py 0.74及更早版本中，源于 js2py.disable_pyimport() 组件中不完整的沙箱机制。攻击者可以利用该漏洞，通过构造恶意的JavaScript代码，访问Python的内部对象模型，最终获取到危险类如 subprocess.Popen，从而执行任意命令。

**漏洞利用方式：**

1.  **目标应用场景：** 应用程序使用 js2py 来解析或执行用户提供的 JavaScript 或 JSON 数据。
2.  **漏洞触发：** 攻击者提供恶意的 JavaScript 代码。
3.  **沙箱逃逸：**  POC 代码通过 `__class__`, `__base__`, 和 `__subclasses__()` 等方法，遍历 Python 的对象图，定位到 `subprocess.Popen` 类。
4.  **命令执行：**  使用 `subprocess.Popen` 执行任意操作系统命令。
5.  **结果返回：**  将命令执行的结果以字符串形式返回，确保 JSON 安全。

**有效性：**

根据漏洞描述、搜索引擎结果和提供的PoC代码，该漏洞利用是有效的。PoC代码展示了如何绕过沙箱，执行任意命令。

**投毒风险：**

分析提供的PoC代码 `payload.js` 和 `README.md` 文件，未发现明显的投毒代码。PoC 代码的功能明确，目的是利用漏洞执行命令。 `README.md` 文件仅包含漏洞描述、利用方式和参考链接。

**总结：**

CVE-2024-28397 是 js2py 中的一个高危漏洞，允许攻击者通过精心构造的 JavaScript 代码绕过沙箱，执行任意命令。应用程序如果使用存在漏洞的 js2py 版本，并且处理用户可控的 JavaScript 或 JSON 数据，则容易受到攻击。

**项目地址:** [waleed-hassan569/CVE-2024-28397-command-execution-poc](https://github.com/waleed-hassan569/CVE-2024-28397-command-execution-poc)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)