## CVE-2019-3396-Confluence-RCE

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 <= version < 6.13.3, 6.14.0 <= version < 6.14.2

**利用条件:** 需要目标Confluence Server存在Widget Connector宏且允许未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 是 Atlassian Confluence Server 中的一个服务器端模板注入漏洞。攻击者可以通过操纵 Widget Connector 宏，注入恶意 Velocity 模板代码，从而在 Confluence 服务器上执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞利用的有效性较高。漏洞库信息明确指出此漏洞允许远程攻击者通过服务器端模板注入实现路径遍历和远程代码执行。搜索引擎结果中也包含了大量的漏洞分析报告和利用示例，确认了该漏洞在野外已被积极利用，并可能被用于传播勒索软件或恶意挖矿程序。提供的POC代码仓库是一个简单的EXP，说明该漏洞存在可利用的POC.

**投毒风险评估：**

提供的代码片段 `include_1.jsp` 看起来像一个 Webshell，具备文件管理、数据库操作、命令执行等功能。 恶意代码比例较低，因为其本身就是webshell，为了完成漏洞的验证。因此投毒风险评估为 10%，这个比例反映了作者可能隐藏的用于维持权限或进行进一步攻击的代码的可能性，但主要功能是完成POC验证。

**利用方式分析：**

1.  **确定目标：** 找到存在漏洞版本的Confluence Server。
2.  **构造 Payload：** 构建包含恶意 Velocity 模板代码的请求。Payload通常利用`Widget Connector`宏的缺陷，将恶意代码注入到模板中。
3.  **发送请求：** 将构造好的 Payload 发送到目标 Confluence Server，触发模板引擎执行恶意代码。
4.  **远程代码执行：**  成功利用漏洞后，攻击者可以在目标服务器上执行任意命令，例如部署 Webshell、窃取敏感数据或进行其他恶意活动。

提供的`include_1.jsp` 文件实际上是一个后门，攻击者可以通过访问这个JSP页面并提供正确的密码（`xiaoma`）来执行各种操作，例如文件管理、数据库操作、命令执行等。利用漏洞部署webshell后，可以实现对服务器的控制。攻击者可以在服务器上上传、下载、修改和删除文件，查看和修改数据库中的数据，以及执行任意的系统命令。

**项目地址:** [tanw923/test1](https://github.com/tanw923/test1)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)