## CVE-2018-13379 - Fortinet FortiOS/FortiProxy SSL VPN 路径遍历

**漏洞编号:** CVE-2018-13379

**漏洞类型:** 路径遍历 (Path Traversal)

**影响应用:** Fortinet FortiOS/FortiProxy

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** FortiOS 6.0.0 to 6.0.4, 5.6.3 to 5.6.7 and 5.4.6 to 5.4.12, FortiProxy 2.0.0, 1.2.0 to 1.2.8, 1.1.0 to 1.1.6, 1.0.0 to 1.0.7

**利用条件:** 目标系统使用受影响版本的FortiOS/FortiProxy，且启用了SSL VPN web portal

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-13379 是一个存在于 Fortinet FortiOS 和 FortiProxy 的 SSL VPN web portal 中的路径遍历漏洞。未经身份验证的攻击者可以通过构造特制的 HTTP 请求，下载系统文件。该漏洞的利用方式如下：

1.  攻击者发送包含恶意路径的HTTP请求到目标的SSL VPN web portal，例如：`https://<target_ip>/remote/fgt_lang?lang=/../../../..//////////dev/cmdb/sslvpn_websession`。
2.  如果目标系统存在漏洞，服务器将返回包含敏感信息的系统文件内容。
3.  POC代码通过发送包含恶意路径的GET请求，然后检查返回内容是否包含`var fgt_lang =`字符串，如果存在，则将返回内容保存到本地文件，并尝试从中提取用户名和会话token。

**有效性:**
提供的POC代码有效，可以利用此漏洞从目标系统下载`sslvpn_websession`文件，并从中提取用户名和会话token。

**投毒风险:**
该POC代码本身未发现明显的投毒代码。代码的主要功能是发送HTTP请求、保存响应和解析文件内容。其中可能存在的风险点在于，如果攻击者滥用该POC，可能会导致目标系统资源耗尽或被用于其他恶意目的。

对POC进行分析发现，脚本首先检查目标主机是否存在漏洞，然后下载 `sslvpn_websession` 文件。 接着，它解析此文件以提取用户名和会话令牌。 整个过程没有发现明显的恶意行为或后门代码。尽管如此，也不能完全排除潜在的隐蔽风险，因此将投毒风险评估为5%。此数值是基于对代码逻辑的检查，以及缺乏任何可疑或恶意的迹象。

**利用方式:**
1.  运行POC脚本，指定目标IP地址或包含IP地址列表的文件。
2.  脚本将尝试连接到目标系统的SSL VPN web portal。
3.  如果目标系统存在漏洞，脚本将下载`sslvpn_websession`文件。
4.  脚本将解析该文件，提取用户名和会话token，并将其打印到屏幕。
5.  攻击者可以使用提取的会话token重放会话，而无需提供密码。

**项目地址:** [kh4sh3i/CVE-2018-13379](https://github.com/kh4sh3i/CVE-2018-13379)

**漏洞详情:** [CVE-2018-13379](https://nvd.nist.gov/vuln/detail/CVE-2018-13379)