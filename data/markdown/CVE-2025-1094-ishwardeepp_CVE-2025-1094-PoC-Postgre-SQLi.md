## CVE-2025-1094-PostgreSQL-SQL注入

**漏洞编号:** CVE-2025-1094

**漏洞类型:** SQL注入

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 17.3, < 16.7, < 15.11, < 14.16, < 13.19

**利用条件:** 服务器编码为EUC_TW或MULE_INTERNAL，客户端编码为BIG5

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2025-1094是PostgreSQL中的一个高危SQL注入漏洞。由于`PQescapeLiteral()`, `PQescapeIdentifier()`, `PQescapeString()`和`PQescapeStringConn()`等函数在处理特定编码组合时（服务器编码为EUC_TW或MULE_INTERNAL，客户端编码为BIG5）未能正确转义引号，攻击者可以通过操纵数据库输入或命令行参数来执行任意SQL命令。

**有效性分析：**

提供的PoC代码通过利用编码不匹配，特别是`server_encoding=EUC_TW`和`client_encoding=BIG5`的组合，成功地绕过了PostgreSQL的转义机制。`exploit.py`文件发送包含恶意SQL代码的POST请求到`app.py`，该请求经过`psql`执行。`init.sql`创建了一个测试表，为SQL注入提供上下文。Docker环境的配置确保了编码环境正确。

**投毒风险分析：**

PoC代码存在极高的投毒风险。 理由如下：

1.  **任意文件读取：** PoC允许读取`/etc/passwd`文件，这表明可以读取服务器上的任何文件，包括敏感配置文件和私钥。
2.  **远程代码执行（RCE）：** 通过注入SQL，攻击者可以创建large object，读取文件，并将其导出到文件系统。这意味着，虽然PoC中示例是读取/etc/passwd，但是它可以执行任何数据库支持的操作，包括调用外部程序或库，进而实现RCE。
3.  **环境依赖：** PoC依赖于特定的编码设置，这使得在不同环境下利用的难度增加。 但如果攻击者控制了数据库的配置，则可以轻松设置正确的编码以利用该漏洞。
4.  **真实漏洞利用案例：** 搜索结果表明，此漏洞已被用于攻击BeyondTrust和美国财政部等机构，这表明真实环境中存在利用。

**漏洞利用方式：**

1.  **编码不匹配：** 利用`client_encoding`和`server_encoding`之间的差异绕过转义。
2.  **注入恶意SQL：** 通过`PQescapeLiteral()`等函数的缺陷，将恶意的SQL代码注入到`psql`命令中。
3.  **执行任意命令：**  利用SQL注入执行`pg_read_file`等函数，读取服务器上的文件，然后通过large object将内容导出到指定位置。

**总结：**

CVE-2025-1094是一个严重的安全漏洞，允许攻击者执行任意SQL命令，读取敏感文件甚至实现远程代码执行。提供的PoC代码有效，并存在极高的投毒风险。

**项目地址:** [ishwardeepp/CVE-2025-1094-PoC-Postgre-SQLi](https://github.com/ishwardeepp/CVE-2025-1094-PoC-Postgre-SQLi)

**漏洞详情:** [CVE-2025-1094](https://nvd.nist.gov/vuln/detail/CVE-2025-1094)