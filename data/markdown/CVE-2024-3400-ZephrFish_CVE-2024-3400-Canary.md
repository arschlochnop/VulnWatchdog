## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以以 root 权限在防火墙上执行任意代码。

**影响版本:** PAN-OS 10.2 (低于 10.2.9-h1), PAN-OS 11.0 (低于 11.0.4-h1), PAN-OS 11.1 (低于 11.1.2-h3)

**利用条件:** 需要目标系统配置了 GlobalProtect gateway 或 GlobalProtect portal (或两者)。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞。由于任意文件创建漏洞，未经身份验证的攻击者可以利用此漏洞在受影响的防火墙上以 root 权限执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞 CVSS 评分高达 10.0，已被积极利用。提供的 PoC 代码尝试通过设置包含恶意命令的 `SESSID` cookie 来利用该漏洞。恶意命令使用 `curl` 和 `base64` 下载并执行来自 `kgezdr4fafaval55y8t2w9up.canarytokens.com` 的 shell 脚本。此行为符合命令注入漏洞的特征，因此 PoC 代码可能有效。

**投毒风险分析：**

PoC 代码本身不包含明显的投毒代码，其主要功能是利用漏洞执行命令。但是，需要注意的是，PoC 代码从外部 URL (`kgezdr4fafaval55y8t2w9up.canarytokens.com`) 下载并执行 shell 脚本。这意味着攻击者可以通过控制此 URL 来投放恶意代码。由于该URL属于canarytokens.com，该网站提供的token会发送警报，因此不太可能是恶意网址, 投毒风险较低，但依然存在。因此，风险评估百分比为10%。

**利用方式分析：**

1.  **漏洞点：** GlobalProtect 的登录页面 (`/global-protect/login.esp`)。
2.  **攻击方式：** 通过设置 `SESSID` cookie 注入恶意命令。Cookie 的值被设置为包含操作系统命令的字符串，这些命令会尝试下载并执行远程 shell 脚本。
3.  **命令执行：** 注入的命令使用 `curl` 和 `base64` 从指定 URL 下载 base64 编码的 shell 脚本，解码后通过 `bash` 执行。
4.  **权限提升：** 由于漏洞是在 PAN-OS 中利用的，且具有 root 权限执行代码的能力，因此攻击者可以完全控制受影响的防火墙。
5.  **利用条件：** 目标 PAN-OS 设备需要配置了 GlobalProtect 网关或门户，并且运行的是受影响的版本。

**项目地址:** [ZephrFish/CVE-2024-3400-Canary](https://github.com/ZephrFish/CVE-2024-3400-Canary)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)