## CVE-2023-21839 Oracle WebLogic Server 远程代码执行

**漏洞编号:** CVE-2023-21839

**漏洞类型:** 远程代码执行

**影响应用:** Oracle WebLogic Server

**危害等级:** 高危，允许未经身份验证的攻击者通过网络访问执行任意代码

**影响版本:** 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0

**利用条件:** 目标WebLogic Server实例必须运行在受影响的版本，且T3或IIOP协议端口对外开放。需要能访问JNDI服务的LDAP服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21839是Oracle WebLogic Server中的一个易于利用的漏洞，允许未经身份验证的攻击者通过T3或IIOP协议进行网络访问，从而导致Oracle WebLogic Server遭到入侵。攻击成功后，可能导致未经授权访问关键数据或完全访问所有Oracle WebLogic Server可访问的数据。

**有效性评估：**

根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，该漏洞的POC代码有效。

*   漏洞库信息明确指出该漏洞易于利用，且无需身份验证。
*   搜索引擎结果显示，该漏洞已被广泛讨论，并有安全厂商发布了相关的攻击签名。
*   提供的漏洞利用代码（Go语言编写）实现了通过Socket直接RCE，无需Java依赖，并且解决了IIOP的NAT网络问题。代码中包含了构造GIOP协议的相关结构体（LocateRequest, ResolveRequest, RebindRequest），这表明该POC试图模拟CORBA协议的交互过程，从而触发漏洞。

**投毒风险评估：**

存在一定的投毒风险，概率约为10%。

*   虽然README文件声明仅用于授权的安全测试与研究目的，但在实际应用中，使用者可能将其用于非法用途。
*   代码本身没有明显的恶意行为，例如直接执行恶意命令或上传后门。但是，`ldap://127.0.0.1:1389/evil`中`evil`这个JNDI服务名称是由用户自定义的，用户可以在JNDI服务中植入恶意代码，从而实现远程代码执行。PoC本身只是提供了利用漏洞的框架，而恶意代码的载体是用户配置的LDAP服务器。
*   `constant.go`文件中定义了一些常量，包括GIOP协议的魔数、版本号、消息类型等，这些常量对于构造GIOP协议的数据包至关重要，但它们本身并不构成投毒。

**利用方式分析：**

该漏洞的利用方式涉及构造恶意的GIOP（General Inter-ORB Protocol）消息，通过T3或IIOP协议发送到WebLogic Server。具体步骤如下：

1.  **构建恶意的JNDI服务：** 攻击者需要搭建一个恶意的JNDI服务（例如使用marshalsec工具），该服务会在目标WebLogic Server尝试lookup时，返回一个包含恶意代码的ObjectFactory。
2.  **构造GIOP消息：**
    *   根据提供的代码，攻击者需要构造LocateRequest，ResolveRequest或RebindRequest等GIOP消息。这些消息用于在WebLogic Server中查找或绑定特定的JNDI资源。
    *   在KeyAddress字段中指定要查找的JNDI资源名称，指向攻击者控制的JNDI服务地址。
    *   通过修改GIOP消息中的特定参数，例如ServiceName，使其指向恶意JNDI服务上的恶意对象。
3.  **发送GIOP消息：** 攻击者通过Socket连接到WebLogic Server的T3或IIOP端口，将构造好的GIOP消息发送过去。
4.  **触发漏洞：** WebLogic Server接收到GIOP消息后，会尝试连接攻击者指定的JNDI服务，并执行其中的恶意代码，从而实现远程代码执行。

该漏洞利用的关键在于构造能够触发WebLogic Server连接恶意JNDI服务的GIOP消息，并确保JNDI服务返回的ObjectFactory能够执行任意代码。

**项目地址:** [illegalbrea/CVE-2023-21839](https://github.com/illegalbrea/CVE-2023-21839)

**漏洞详情:** [CVE-2023-21839](https://nvd.nist.gov/vuln/detail/CVE-2023-21839)