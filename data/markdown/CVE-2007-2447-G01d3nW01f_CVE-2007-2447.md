## CVE-2007-2447-Samba-远程命令执行

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 目标Samba服务器启用 "username map script" 配置（对于SamrChangePassword函数利用）或可以访问其他MS-RPC函数（远程打印/文件共享管理），需要开放139/445端口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-2447 存在于 Samba 3.0.0 到 3.0.25rc3 版本的 smbd 组件中。该漏洞允许远程攻击者通过注入 shell 元字符执行任意命令。漏洞利用主要有两种方式：

1.  **SamrChangePassword 函数利用：** 当 Samba 配置中的 `username map script` 选项启用时，可以通过向 `SamrChangePassword` 函数传递包含 shell 元字符的恶意用户名来执行命令。
2.  **其他 MS-RPC 函数利用：** 远程身份验证的用户可以通过涉及远程打印和文件共享管理的其他 MS-RPC 函数中的 shell 元字符执行命令。

**POC代码分析：**

提供的 POC 代码 `sambaster.py` 尝试利用此漏洞。它使用 `pysmb` 库与目标 Samba 服务器建立 SMB 连接。POC 脚本构造包含反弹 shell 命令的恶意用户名，并通过 SMB 协议将其发送到目标服务器。脚本首先尝试使用一种 payload，如果失败，则使用另一种 payload。这些 payload 的目的是在目标服务器上执行命令，从而反弹一个 shell 到攻击者的机器。

**有效性：**

根据漏洞描述和 POC 代码，该漏洞利用的有效性取决于以下因素：

*   目标 Samba 服务器的版本是否在受影响的范围内 (3.0.0 - 3.0.25rc3)。
*   是否启用了易受攻击的配置（`username map script`）。
*   目标系统是否允许执行反弹 shell 命令（例如，防火墙规则）。
*   攻击者是否可以连接到目标服务器的 SMB 端口（139 或 445）。

如果所有条件都满足，则漏洞利用很可能成功。

**投毒风险：**

该 POC 代码的投毒风险较低 (0%)。代码的主要功能是利用已知的 Samba 漏洞。虽然 `nohup` 的使用值得注意，但这并不是恶意行为，而是为了在命令执行后断开连接时保持反弹 shell 运行。没有明显的迹象表明作者试图在代码中隐藏任何恶意功能，例如下载和执行任意代码或修改系统文件。代码逻辑清晰且易于理解，并没有发现存在隐蔽的恶意代码片段。

**项目地址:** [G01d3nW01f/CVE-2007-2447](https://github.com/G01d3nW01f/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)