## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，允许未授权用户执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 需要网络访问，存在启用了`POLLER_ACTION_SCRIPT_PHP`的poller_item

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-46169是Cacti中一个未经身份验证的命令注入漏洞。攻击者可以通过`remote_agent.php`文件，绕过身份验证，并利用`polldata` action注入恶意命令。

**利用方式：**

1.  **身份验证绕过：** 通过设置`X-Forwarded-For`头为`127.0.0.1`来欺骗`get_client_addr`函数，绕过`remote_agent.php`的身份验证。
2.  **命令注入：** 绕过身份验证后，攻击者可以利用`polldata` action。`poller_id`参数未经过滤，直接传递给`proc_open`函数，导致命令注入。 需要存在一个`poller_item` 其action 类型为 `POLLER_ACTION_SCRIPT_PHP`
3.  **参数枚举：** 如果不知道`host_id`和`local_data_id`，可以使用提供的POC脚本进行暴力破解。

**有效性分析：**

根据漏洞描述和POC代码，该漏洞利用是有效的。POC代码实现了身份验证绕过和命令注入，并提供了暴力破解`host_id`和`local_data_id`的功能。

**投毒风险分析：**

查看提供的POC代码，未发现明显的投毒代码。脚本逻辑清晰，主要功能是漏洞利用。代码通过构造恶意请求来利用漏洞，没有发现尝试在目标系统上安装后门或执行恶意操作的迹象。因此，投毒风险很低，约为0%。脚本依赖`requests`库，如果`requests`库被篡改，可能存在风险，但这不属于此仓库本身的投毒。

**总结：**

CVE-2022-46169是一个严重的安全漏洞，允许未经身份验证的攻击者在Cacti服务器上执行任意命令。该漏洞利用简单，影响广泛，需要及时修补。提供的POC代码可以有效利用此漏洞。

**项目地址:** [mind2hex/CVE-2022-46169](https://github.com/mind2hex/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)