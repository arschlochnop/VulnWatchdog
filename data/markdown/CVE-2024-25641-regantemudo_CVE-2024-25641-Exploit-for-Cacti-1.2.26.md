## CVE-2024-25641-Cacti-RCE

**漏洞编号:** CVE-2024-25641

**漏洞类型:** 远程代码执行

**影响应用:** Cacti

**危害等级:** 高危，允许攻击者在服务器上执行任意代码

**影响版本:** < 1.2.27

**利用条件:** 需要Cacti后台’导入模板’权限的已认证用户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-25641是Cacti 1.2.27之前版本中的一个远程代码执行漏洞。该漏洞源于`/lib/import.php`中的`import_package()`函数对导入的包文件未进行充分的验证。攻击者可以通过上传恶意构造的XML包，在服务器上写入任意文件，最终导致远程代码执行。

**有效性评估：**

根据漏洞库信息和搜索结果，此漏洞的POC代码已经公开。GitHub上存在相关的POC，并且Rapid7 Metasploit也已经包含了利用模块，表明该漏洞利用的有效性较高。

**投毒风险分析：**

提供的POC代码包含以下文件：

*   `README.md`: 包含漏洞描述，利用方法，安装说明。
*   `cacti_exploit.py`:  Python脚本，用于自动化漏洞利用。
*   `requirements.txt`:  包含Python依赖。
*   `php/reverse_shell.php`: 默认的PHP反弹shell Payload。

审查`cacti_exploit.py`脚本，其主要功能如下：

1.  身份验证：通过提供的用户名和密码登录Cacti。
2.  CSRF Token获取：解析登录页面获取CSRF Token以绕过CSRF保护。
3.  恶意XML构造：构造包含恶意PHP Payload的XML数据。
4.  利用Package Import功能上传XML：将构造的XML数据通过Cacti的Package Import功能上传。
5.  执行Payload： 通过访问上传的PHP文件触发反弹shell。

在`cacti_exploit.py`中，没有明显的恶意代码或后门。但是，仍然存在一定的投毒风险，例如：

*   依赖风险：`requirements.txt`文件中可能包含恶意库，虽然可能性较低，但是存在。
*   Payload替换：攻击者可能使用更复杂的PHP payload，导致更严重的后果，但这不是代码本身的投毒，而是使用者行为。
*   代码混淆：虽然此POC未做代码混淆，但攻击者可能添加混淆来隐藏恶意行为。

综合评估，此POC的投毒风险为10%。主要来自于潜在的依赖风险，以及使用者行为可能导致的payload替换。

**利用方式：**

1.  **环境准备：** 安装Cacti 1.2.26 (或更早版本)，并配置好运行环境 (PHP, MySQL等)。
2.  **权限获取：** 获得一个拥有’导入模板’权限的Cacti用户账号密码。
3.  **Payload生成：**  修改`php/reverse_shell.php`中的IP地址和端口，配置反弹shell的目标。
4.  **执行Exploit：** 运行`cacti_exploit.py`脚本，提供目标Cacti URL，用户名，密码，以及Payload路径。
5.  **触发Payload：**  脚本执行成功后，通过浏览器访问上传的PHP文件，或者通过脚本直接访问URL触发Payload。
6.  **获取Shell：**  在攻击者主机上监听配置的端口，等待反弹shell连接。

**项目地址:** [regantemudo/CVE-2024-25641-Exploit-for-Cacti-1.2.26](https://github.com/regantemudo/CVE-2024-25641-Exploit-for-Cacti-1.2.26)

**漏洞详情:** [CVE-2024-25641](https://nvd.nist.gov/vuln/detail/CVE-2024-25641)