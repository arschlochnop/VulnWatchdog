## CVE-2020-17530-Apache Struts-OGNL远程代码执行

**漏洞编号:** CVE-2020-17530

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** Struts 2.0.0 - Struts 2.5.25

**利用条件:** 需要目标系统运行存在漏洞版本的Apache Struts，且允许外部访问。攻击者需要构造包含恶意OGNL表达式的HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-17530 (S2-061) 是一个Apache Struts框架中的远程代码执行漏洞。漏洞原因是Struts2在处理tag attributes时，对用户输入的OGNL表达式进行了二次解析，导致攻击者可以通过构造恶意的OGNL表达式，在服务器端执行任意代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的POC代码，该漏洞的利用是有效的。漏洞库信息明确指出该漏洞可导致远程代码执行，影响Struts 2.0.0 - Struts 2.5.25版本。搜索结果中也包含多个安全厂商的分析报告，确认该漏洞的存在和危害。提供的POC代码 `freemarker_RCE_struts2_s2-061.py` 尝试利用 Freemarker 模板引擎的 `Execute` 方法执行命令。

**投毒风险：**
POC代码本身主要是利用了OGNL表达式注入来执行命令。但是，有以下潜在的投毒风险：
1.  **依赖:**  POC依赖于`requests`和`lxml`库。如果攻击者修改了代码，使用`pip install -r requirements.txt`来安装恶意依赖，可能引入恶意代码。虽然此POC没有提供`requirements.txt`，但这是潜在的风险。
2.  **执行任意命令的风险:**  由于该POC旨在执行任意命令，这意味着如果攻击者控制了运行POC的环境，他们可以修改脚本以执行其他恶意操作。这并非POC本身的投毒，而是利用POC执行的命令可能带来的风险。
3.  **URI构造方式:** POC中的URI构造方式较为复杂，通过大量的字符串拼接和截断，虽然目的是绕过WAF或检测，但也增加了隐藏恶意逻辑的可能性。尽管目前看来只是为了构造payload，但需要仔细审查每一步操作。

综合来看，该POC的投毒风险较低，大约为10%，主要集中在人为修改和使用恶意依赖项的可能性上。

**利用方式：**
该漏洞的利用方式如下：
1.  攻击者构造包含恶意OGNL表达式的HTTP请求，通常是通过GET或POST请求的参数传递。
2.  Struts2框架在处理请求时，会对OGNL表达式进行解析和执行。
3.  由于存在二次解析漏洞，攻击者可以利用OGNL表达式执行任意代码，例如执行系统命令或读取敏感文件。

提供的POC代码利用了Freemarker模板引擎的`Execute`方法，通过OGNL表达式`${freemarker.template.utility.Execute.exec('{command}')}`来执行指定的命令。脚本首先构造包含恶意OGNL表达式的URL，然后发送HTTP请求，最后解析响应，提取执行结果。

**项目地址:** [ludy-dev/freemarker_RCE_struts2_s2-061](https://github.com/ludy-dev/freemarker_RCE_struts2_s2-061)

**漏洞详情:** [CVE-2020-17530](https://nvd.nist.gov/vuln/detail/CVE-2020-17530)