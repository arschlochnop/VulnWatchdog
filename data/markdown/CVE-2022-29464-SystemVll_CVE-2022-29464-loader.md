## CVE-2022-29464-WSO2-任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，可导致远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 目标存在/fileupload端点且未授权访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464 是一个存在于多个 WSO2 产品中的严重漏洞，攻击者可以通过利用/fileupload端点上传任意文件，结合目录遍历将恶意JSP文件写入到webapps目录下，从而实现远程代码执行。该POC脚本首先生成一个随机文件名的JSP webshell，然后通过POST请求将该webshell上传到目标服务器的/fileupload/toolsAny端点。请求头中包含目录遍历(../)序列，用于将文件写入到服务器的webapps目录。上传后，脚本会休眠15秒，然后尝试通过GET请求访问上传的webshell，并执行指定的命令。如果返回状态码为200，则表示webshell执行成功。该POC的利用方式是典型的任意文件上传结合目录遍历实现RCE的漏洞利用方式。

**有效性:**
根据漏洞信息和搜索结果，该漏洞的POC代码是有效的，可以利用该漏洞在目标服务器上执行任意代码。

**投毒风险:**
代码没有发现明显的恶意行为或隐藏的后门。所有操作都与漏洞利用相关，例如上传 webshell 和执行命令。该代码的主要目的是为了验证漏洞的存在并进行简单的命令执行，没有检测到任何试图损害用户系统或窃取信息的行为。

**利用方式:**
1.  **确定目标：** 确定运行存在漏洞的 WSO2 产品的服务器。
2.  **上传 Webshell：** 使用包含目录遍历的 Content-Disposition 头的 POST 请求，将恶意 JSP 文件上传到`/fileupload/toolsAny`端点。
3.  **远程代码执行：** 通过访问上传的 JSP 文件，传递需要执行的命令作为参数，实现远程代码执行。例如：`{host}/authenticationendpoint/{filename}?cmd={command}`


**项目地址:** [SystemVll/CVE-2022-29464-loader](https://github.com/SystemVll/CVE-2022-29464-loader)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)