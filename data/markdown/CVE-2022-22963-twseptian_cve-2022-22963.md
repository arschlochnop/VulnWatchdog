## CVE-2022-22963 - Spring Cloud Function SpEL 远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** Spring Cloud Function 3.1.6, 3.2.2 及所有旧的和不受支持的版本

**利用条件:** 使用 Spring Cloud Function 路由功能，且允许用户提供 SpEL 表达式作为路由表达式。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中的一个远程代码执行漏洞。该漏洞源于当使用路由功能时，用户可以提供精心构造的 SpEL 表达式作为路由表达式，从而导致远程代码执行和访问本地资源。

**有效性：**

提供的 PoC 代码有效。根据漏洞库信息和搜索引擎结果，此漏洞允许未经身份验证的远程代码执行。PoC 代码展示了如何通过 `spring.cloud.function.routing-expression` 头注入 SpEL 表达式，从而执行任意命令，例如 `ping` 命令。 tcpdump 结果证实了命令已成功执行。

**投毒风险：**

分析提供的 Dockerfile 和 README.md 文件，虽然 PoC 本身没有直接的恶意代码（即利用漏洞执行命令的部分是合法的漏洞利用），但仍然存在一定的投毒风险。Dockerfile 指向 `openjdk:17-alpine`，该镜像本身较为安全。`COPY ./jar/*.jar /app/spring-cloud-function-routing.jar`命令从本地复制 jar 包,这个jar包可能是被篡改过的恶意jar包,如果原作者上传了恶意jar包,则会存在投毒风险。因此投毒风险评估为10%。

**利用方式：**

1.  攻击者利用 `spring.cloud.function.routing-expression` HTTP Header 注入恶意的 SpEL 表达式。
2.  Spring Cloud Function 的路由逻辑会解析并执行该 SpEL 表达式。
3.  攻击者可以使用 SpEL 表达式执行任意代码，例如通过 `java.lang.Runtime.getRuntime().exec()` 执行系统命令。
4.  该漏洞可以通过网络远程利用，无需任何身份验证，风险极高。

**参考资料：**

*   CVE 漏洞库信息表明该漏洞的严重性评分为 9.8 (Critical)，易于利用，且已被 CISA 列入已知被利用漏洞目录。
*   搜索引擎结果也确认了该漏洞的存在和潜在危害，并提供了缓解措施的建议。

**项目地址:** [twseptian/cve-2022-22963](https://github.com/twseptian/cve-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)