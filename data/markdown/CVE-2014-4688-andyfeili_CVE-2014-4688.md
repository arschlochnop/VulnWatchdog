## CVE-2014-4688-pfSense-命令注入

**漏洞编号:** CVE-2014-4688

**漏洞类型:** 命令注入

**影响应用:** pfSense

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 2.1.3

**利用条件:** 需要已认证的pfSense用户账号

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于pfSense 2.1.4之前的版本中。远程已认证用户可以通过`diag_dns.php`, `diag_smart.php`, 或 `status_rrd_graph_img.php`等页面的参数注入恶意命令，从而执行任意代码。

**利用方式：**

1.  攻击者需要拥有pfSense的有效用户凭据。
2.  攻击者通过构造包含恶意命令的请求，发送到存在漏洞的PHP页面 (`status_rrd_graph_img.php`, `diag_dns.php`, `diag_smart.php`)。 
    例如，漏洞利用代码利用了`status_rrd_graph_img.php`的`database`参数，将payload进行URL编码，然后通过printf命令执行。
3.  服务器执行注入的命令，攻击者从而获得shell。

**漏洞利用代码分析：**

提供的Python脚本自动化了漏洞利用过程：

*   首先，脚本获取用户输入的pfSense地址、用户名、密码、本地监听地址和端口。
*   然后，脚本构造一个反向shell命令，并将其转换为八进制编码，以绕过可能的输入过滤。
*   脚本尝试登录pfSense Web界面，获取CSRF token。
*   最后，脚本构造一个GET请求，将包含编码后的反向shell命令注入到`status_rrd_graph_img.php`的`database`参数中。如果利用成功，服务器将执行该命令，攻击者将在指定的本地端口上获得一个反向shell。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，且提供的POC代码针对该漏洞编写，因此该POC代码在未修复的pfSense版本上应有效。

**投毒风险：**

代码中没有明显的投毒迹象。该代码的主要功能是利用漏洞执行命令，获得反向shell。代码结构清晰，没有发现额外或隐藏的功能。 因此，投毒风险评估为0%。

**项目地址:** [andyfeili/CVE-2014-4688](https://github.com/andyfeili/CVE-2014-4688)

**漏洞详情:** [CVE-2014-4688](https://nvd.nist.gov/vuln/detail/CVE-2014-4688)