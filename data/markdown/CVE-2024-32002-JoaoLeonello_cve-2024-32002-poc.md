## CVE-2024-32002 - Git Submodule Remote Code Execution

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** 受影响版本包括 2.39.4 之前的所有版本，以及 2.40.0 到 2.40.2，2.41.0，2.42.0 到 2.42.2，2.43.0 到 2.43.4，2.44.0 和 2.45.0。

**利用条件:** 需要目标系统使用受影响的 Git 版本，且支持符号链接。利用依赖于递归克隆包含恶意配置的仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是 Git 中一个严重的远程代码执行漏洞，它允许攻击者通过恶意构造包含子模块的 Git 仓库来执行任意代码。漏洞的核心在于 Git 在处理子模块路径时存在缺陷，攻击者可以利用此缺陷将恶意文件写入 `.git/` 目录，从而劫持 Git 的行为。

**漏洞利用方式：**

1.  **创建恶意仓库：** 攻击者创建一个包含子模块的 Git 仓库。关键在于构造一个恶意的 `.gitmodules` 文件。此文件中定义的子模块路径会被操纵，指向 `.git/` 目录内的某个位置。
2.  **符号链接欺骗：** 攻击者会创建一个符号链接，将仓库中的某个目录链接到 `.git/` 目录。例如，创建一个名为 `A` 的目录的符号链接，使其指向 `.git/`。
3.  **路径注入：** 通过组合恶意 `.gitmodules` 文件和符号链接，攻击者可以欺骗 Git 将子模块的内容写入 `.git/modules/` 目录。这允许攻击者注入恶意 hook 脚本。
4.  **触发执行：** 当受害者递归克隆（`git clone --recursive`）恶意仓库时，Git 将初始化子模块，并将恶意 hook 脚本复制到 `.git/hooks/` 目录。然后，当受害者执行诸如 `git checkout` 之类的 Git 操作时，这些恶意 hook 脚本会被触发执行，从而导致远程代码执行。

**POC 分析：**

提供的 POC 代码通过 Dockerfile 构建了一个包含漏洞 Git 版本的环境，并使用 `setup.sh` 脚本自动化了漏洞利用过程。该脚本创建了一个包含恶意 `post-checkout` hook 的子模块，修改 `.gitmodules` 文件，创建必要的符号链接，并将恶意 hook 注入到受害者的 `.git/hooks/` 目录中。当执行 `git checkout HEAD` 时，hook 脚本会被触发，在 `/tmp/teste.txt` 中写入 "joao was here"，从而验证了漏洞的存在。

**投毒风险分析：**

虽然 POC 代码的主要目的是演示漏洞，但仍然存在潜在的投毒风险。`setup.sh` 脚本包含以下可疑行为：

*   向 `/etc/sudoers` 文件添加用户，允许用户无密码执行 sudo 命令。虽然这可能是为了方便演示，但在实际环境中会带来安全风险。

考虑到这些因素，我将投毒风险评估为 10%。

**项目地址:** [JoaoLeonello/cve-2024-32002-poc](https://github.com/JoaoLeonello/cve-2024-32002-poc)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)