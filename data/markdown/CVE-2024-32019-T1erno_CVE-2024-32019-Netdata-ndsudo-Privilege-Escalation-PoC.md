## CVE-2024-32019-Netdata-本地提权

**漏洞编号:** CVE-2024-32019

**漏洞类型:** 本地提权

**影响应用:** Netdata

**危害等级:** 高危，允许低权限用户通过PATH劫持执行任意代码

**影响版本:** >= 1.45.0, < 1.45.3 和 >= 1.44.0-60, < 1.45.0-169

**利用条件:** 需要Netdata Agent存在ndsudo，且版本在受影响范围内，以及可控的PATH环境变量

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32019是Netdata中`ndsudo`工具的一个本地提权漏洞。`ndsudo`是一个具有SUID root权限的可执行文件，但它使用`PATH`环境变量来查找要执行的命令。攻击者可以通过将恶意可执行文件放置在`PATH`环境变量中优先于系统目录的位置，诱使`ndsudo`执行该恶意程序，从而获得root权限。

**漏洞利用方式：**
1.  查找具有SUID权限的`ndsudo`可执行文件的路径。
2.  创建一个恶意的可执行文件(例如`nvme`)，该文件执行攻击者希望执行的任意代码。提供的`payload.c`是一个简单的示例，它会生成一个root shell。
3.  修改`PATH`环境变量，将当前目录(或包含恶意可执行文件的目录)添加到`PATH`的开头。
4.  调用`ndsudo`，并指定一个它允许执行的命令(例如`nvme-list`)。由于`PATH`已经被修改，`ndsudo`会执行攻击者放置的恶意`nvme`可执行文件，从而以root权限执行任意代码。

**有效性：**
提供的PoC代码是有效的。它包含一个shell脚本，用于查找`ndsudo`，创建一个`nvme` payload，修改`PATH`，然后执行`ndsudo`。README.md文件描述了如何编译`payload.c`并使用脚本。

**投毒风险：**
查看了提供的三个文件内容，没有发现任何投毒代码。其中，CVE-2024-32019.sh脚本用于利用漏洞，payload.c用于编译恶意payload，README.md文件描述了漏洞和利用方法，都是正常的利用代码。
因此，投毒风险为0%。

**项目地址:** [T1erno/CVE-2024-32019-Netdata-ndsudo-Privilege-Escalation-PoC](https://github.com/T1erno/CVE-2024-32019-Netdata-ndsudo-Privilege-Escalation-PoC)

**漏洞详情:** [CVE-2024-32019](https://nvd.nist.gov/vuln/detail/CVE-2024-32019)