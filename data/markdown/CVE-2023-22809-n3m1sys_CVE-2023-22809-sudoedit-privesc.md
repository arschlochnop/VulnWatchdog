## CVE-2023-22809-sudo-权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** sudo

**危害等级:** 高危，允许本地低权限用户获得root权限

**影响版本:** 1.8.0 to 1.9.12p1

**利用条件:** 用户需要能够通过sudoedit或sudo -e以root权限编辑文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22809是sudo中的一个权限提升漏洞，存在于1.8.0到1.9.12p1版本。sudoedit (或 -e) 功能错误地处理了用户提供的环境变量（SUDO_EDITOR、VISUAL和EDITOR）中传递的额外参数，允许本地攻击者将任意条目附加到要处理的文件列表中。攻击者可以通过设置这些环境变量来包含恶意文件，从而导致权限提升。

**有效性：**
根据漏洞信息和POC代码，该漏洞利用是有效的。POC脚本首先检查sudo版本是否在受影响范围内，然后检查当前用户是否具有使用sudoedit或sudo -e以root权限编辑文件的权限。如果满足这两个条件，它将修改/etc/sudoers文件，为当前用户添加sudo权限，从而获得root shell。

**投毒风险：**
分析提供的POC代码（exploit.sh），没有发现明显的恶意代码或后门。脚本的主要功能是利用漏洞修改sudoers文件以提升权限，这是一个合法的漏洞利用方式，而非植入恶意代码。README.md文件仅是对漏洞和利用方式的描述。

**利用方式：**
1.  **检查sudo版本：** 脚本首先检查当前系统上安装的sudo版本是否在漏洞影响范围内。
2.  **检查sudoedit权限：** 脚本检查当前用户是否可以使用sudoedit或sudo -e以root权限编辑文件。
3.  **修改sudoers文件：** 如果满足上述条件，脚本会使用用户可控的环境变量EDITOR，通过sudoedit命令打开/etc/sudoers文件。由于sudoedit的漏洞，攻击者可以控制传递给EDITOR程序的参数，从而可以添加任意文件到编辑列表。
4.  **权限提升：**  攻击者在sudoers文件中添加一行，允许当前用户使用sudo执行任何命令，从而获得root权限。
5.  **获取root shell：** 最后，脚本使用`sudo su root`命令获得root shell。

**项目地址:** [n3m1sys/CVE-2023-22809-sudoedit-privesc](https://github.com/n3m1sys/CVE-2023-22809-sudoedit-privesc)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)