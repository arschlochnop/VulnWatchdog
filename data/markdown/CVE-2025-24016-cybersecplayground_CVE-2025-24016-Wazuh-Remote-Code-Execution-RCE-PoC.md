## CVE-2025-24016-Wazuh-RCE

**漏洞编号:** CVE-2025-24016

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Wazuh

**危害等级:** 高危，可能导致完全系统权限控制

**影响版本:** >= 4.4.0, < 4.9.1

**利用条件:** 需要API访问权限（可能通过被攻陷的dashboard、集群节点或特定配置下的Agent）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24016是Wazuh服务器中存在的一个远程代码执行漏洞，源于不安全的反序列化。攻击者可以通过构造恶意的JSON数据，利用DistributedAPI接口中的`as_wazuh_object`函数在反序列化过程中执行任意Python代码。

**有效性分析：**

根据漏洞描述和POC代码，该漏洞利用是有效的。POC代码通过向`/security/user/authenticate/run_as`端点发送包含恶意`__reduce__`的JSON payload，在服务器端执行`os.system`命令，从而实现远程代码执行。

**投毒风险分析：**

虽然POC代码本身是为了验证漏洞，但查看提供的代码，`CVE-2025-24016-POC.py`脚本并没有明显的恶意代码或后门。风险在于攻击者可能修改POC，使其在目标系统上安装后门或执行其他恶意操作。此外，README中给出的Burp Suite请求示例中，虽然`__unhandled_exc__`示例会导致Wazuh服务器关闭，形成拒绝服务，但它本身不是一个隐蔽的后门。

LICENSE采用MIT许可证，允许修改和分发，但也增加了潜在的投毒风险。攻击者可以修改代码并重新发布，使其包含恶意功能。因此，初步判断投毒风险为10%。

**利用方式分析：**

1.  **攻击入口：** 攻击者需要具备Wazuh API的访问权限。这可能通过以下方式获得：
    *   攻陷Wazuh dashboard。
    *   攻陷Wazuh集群中的其他节点。
    *   在某些配置下，攻陷Wazuh Agent。
2.  **漏洞触发：** 攻击者构造恶意的JSON payload，其中包含`__reduce__`或其他可触发代码执行的反序列化gadget。
3.  **利用过程：** 攻击者将payload发送到Wazuh API的`/security/user/authenticate/run_as`端点，触发反序列化过程。
4.  **代码执行：** Wazuh服务器在反序列化payload时，会执行攻击者指定的Python代码，从而实现远程代码执行。
5.  **影响：** 攻击者可以利用该漏洞执行任意系统命令，获取敏感信息，安装后门，甚至完全控制Wazuh服务器。

**缓解措施：**

*   升级到Wazuh v4.9.1或更高版本。
*   避免将API暴露在公网上。
*   监控API的异常活动。

**项目地址:** [cybersecplayground/CVE-2025-24016-Wazuh-Remote-Code-Execution-RCE-PoC](https://github.com/cybersecplayground/CVE-2025-24016-Wazuh-Remote-Code-Execution-RCE-PoC)

**漏洞详情:** [CVE-2025-24016](https://nvd.nist.gov/vuln/detail/CVE-2025-24016)