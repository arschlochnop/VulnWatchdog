## CVE-2023-45878-GibbonEdu-任意文件写入

**漏洞编号:** CVE-2023-45878

**漏洞类型:** 任意文件写入

**影响应用:** GibbonEdu

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 25.0.1

**利用条件:** 需要目标系统存在未授权的 `rubrics_visualise_saveAjax.php` 接口，且目标系统可被网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45878 漏洞存在于 GibbonEdu 25.0.1 及更早版本中。由于 `rubrics_visualise_saveAjax.php` 接口未进行身份验证，攻击者可以利用此漏洞上传任意文件。攻击者通过构造包含 PHP 代码的图片文件，并利用 `img` 参数传递 base64 编码后的 payload，利用 `path` 参数指定文件保存路径，可以将恶意 PHP 文件写入服务器，最终实现远程代码执行。

**利用方式:**

1.  攻击者构造包含恶意 PHP 代码的图片，例如一个简单的 webshell：`<?php system($_REQUEST['cmd']); ?>`。
2.  将 PHP 代码进行 Base64 编码。
3.  构造 HTTP POST 请求，包含以下参数：
    *   `img`: 值为 `image/png;asdf,<base64编码的PHP代码>`
    *   `path`: 值为恶意 PHP 文件名，例如 `shell.php`
    *   `gibbonPersonID`: 任意值，例如 `0000000001`
4.  发送请求到 `http://<target>/Gibbon-LMS/modules/Rubrics/rubrics_visualise_saveAjax.php`。
5.  成功上传 webshell 后，可以通过访问 `http://<target>/Gibbon-LMS/shell.php?cmd=<command>` 执行任意命令。

**投毒风险分析:**

尽管该 POC 代码的主要功能是利用漏洞进行渗透测试，但仍存在潜在的投毒风险。
* 代码中包含请求目标地址的操作,如果作者在代码中加入隐藏的逻辑，例如将目标信息发送到恶意服务器，则可能导致信息泄露。
* 提供的 `powershell_reverse_shell` 函数用于生成 PowerShell 反弹 shell 的 payload，如果攻击者的服务器被攻陷，或者该函数被恶意修改，可能会导致反弹 shell 连接到恶意服务器，从而使受害者受到攻击。

总的来说，此仓库存在一定的投毒风险，但主要集中在作者是否在代码中加入了隐藏的恶意逻辑以及反弹shell的IP端口是否存在风险，评估结果为10%。用户在使用该 POC 代码时应仔细审查代码，确保其安全性。

**项目地址:** [davidzzo23/CVE-2023-45878](https://github.com/davidzzo23/CVE-2023-45878)

**漏洞详情:** [CVE-2023-45878](https://nvd.nist.gov/vuln/detail/CVE-2023-45878)