## CVE-2024-51568 - CyberPanel Pre-Authentication Command Injection

**漏洞编号:** CVE-2024-51568

**漏洞类型:** 命令注入

**影响应用:** CyberPanel

**危害等级:** 高危，允许未经身份验证的远程攻击者以root权限执行任意命令。

**影响版本:** < 2.3.5

**利用条件:** 目标系统运行着CyberPanel，且版本低于2.3.5，攻击者可以网络访问目标服务器的8090端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-51568 是 CyberPanel 2.3.5之前版本中存在的一个预认证命令注入漏洞。该漏洞位于`/filemanager/upload`端点，利用`completePath`参数进行命令注入。由于中间件绕过，攻击者无需身份验证即可利用此漏洞。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断该漏洞的PoC代码是有效的。漏洞库信息和搜索引擎结果都确认了该漏洞的存在，并指出该漏洞允许未经身份验证的远程代码执行。提供的PoC代码包括一个Dockerfile用于启动一个存在漏洞的CyberPanel实例，以及一个Nuclei模板，该模板模拟了漏洞利用过程。Nuclei模板通过向`/filemanager/upload`端点发送恶意请求，并在`completePath`参数中注入命令，来验证漏洞的存在。PoC还提供了Interactsh集成以进行带外检测，增强了验证的可靠性。

**利用方式分析：**

攻击者可以发送一个POST请求到`/filemanager/upload`接口，并在multipart/form-data中的`completePath`字段中插入恶意命令。由于该接口存在命令注入漏洞，未经授权的攻击者可以在服务器上执行任意命令，从而获得系统的完全控制权。PoC 使用了 `curl {{interactsh-url}}` 或 `wget {{interactsh-url}}` 或 `nslookup {{interactsh-url}}` 这样的 payload，允许在命令执行后通过带外方式（DNS或HTTP请求到 interactsh 服务器）进行验证。

**投毒风险分析：**

PoC代码本身主要用于验证漏洞的存在，投毒风险较低，但不能完全排除。主要的分析点包括：

*   **Dockerfile:**  Dockerfile用于构建一个包含漏洞的CyberPanel环境，该环境本身就是为了复现漏洞而设计的，因此其中不应包含额外的恶意代码。
*   **Nuclei 模板:**  Nuclei模板用于发送恶意请求，其目的是触发漏洞。检查模板的payload，确认其只包含用于漏洞验证的命令，没有其他潜在的恶意行为。
*   **README.md:**  README文件提供了漏洞的详细信息和使用说明，其中包含安全声明，表明该环境仅用于安全研究和教育目的，并警告用户不要在生产环境中使用。这表明作者可能已经考虑到了潜在的风险。

总体来说，直接的投毒风险较低。但考虑到以下因素，存在少量风险：

*   **依赖风险:**  Dockerfile可能会依赖于外部资源（例如，从网络下载CyberPanel安装包），如果这些外部资源被篡改，可能会引入恶意代码。
*   **误用风险:**  用户可能会在不了解风险的情况下，在生产环境中使用该PoC环境，导致系统受到攻击。

**结论：**

综上所述，PoC代码本身主要用于漏洞验证，直接的投毒风险较低。但考虑到潜在的依赖风险和误用风险，需要保持警惕。因此，投毒风险评估为 5%。

**项目地址:** [jsnv-dev/CVE-2024-51568---CyberPanel-Command-Injection-Nuclei-Template](https://github.com/jsnv-dev/CVE-2024-51568---CyberPanel-Command-Injection-Nuclei-Template)

**漏洞详情:** [CVE-2024-51568](https://nvd.nist.gov/vuln/detail/CVE-2024-51568)