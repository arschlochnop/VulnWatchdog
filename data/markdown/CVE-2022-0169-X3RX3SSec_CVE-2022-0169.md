## CVE-2022-0169-Photo Gallery by 10Web-SQL注入

**漏洞编号:** CVE-2022-0169

**漏洞类型:** SQL注入

**影响应用:** Photo Gallery by 10Web

**危害等级:** 高危，可能导致数据泄露和服务器控制

**影响版本:** < 1.6.0

**利用条件:** WordPress站点安装了受影响的Photo Gallery插件，且允许未授权用户访问admin-ajax.php。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Photo Gallery by 10Web插件的1.6.0版本之前，由于对`bwg_tag_id_bwg_thumbnails_0`参数未进行充分的验证和转义，导致未经身份验证的攻击者可以通过`bwg_frontend_data` AJAX action 注入恶意的SQL代码。  

**利用方式：**

1.  攻击者构造包含恶意SQL代码的`bwg_tag_id_bwg_thumbnails_0`参数。
2.  攻击者发送包含该恶意参数的HTTP GET请求到`/wp-admin/admin-ajax.php`，并设置`action=bwg_frontend_data`。
3.  插件处理请求时，会将恶意SQL代码拼接到SQL查询语句中，导致SQL注入。
4.  攻击者可以利用SQL注入漏洞执行任意SQL查询，例如提取数据库中的敏感信息（如用户名和密码哈希），甚至可以写入webshell控制服务器。

**POC有效性：**

提供的POC代码`CVE-2022-0169.py` 看起来是有效的，可以利用该漏洞提取WordPress `wp_users`表中的用户名和密码哈希。它首先会尝试检测WordPress版本，然后构造包含SQL注入payload的URL，发送请求，提取用户名和密码哈希，并保存到文件中。最后，POC还可以运行hashcat来破解密码哈希。

**投毒风险分析：**

虽然POC的主要功能是利用SQL注入漏洞，但其中也存在一定的投毒风险：

*   **依赖外部资源：** 代码依赖于requests、rich等第三方库。如果这些库的PyPI源被篡改，可能导致安装恶意代码。
*   **自动执行hashcat：** 代码会自动调用hashcat破解密码。如果hashcat被恶意替换，可能导致系统被感染。  虽然wordlist 默认是 `/usr/share/wordlists/rockyou.txt`相对安全,但是给了用户参数`-w` 自定义,如果用户指定了一个恶意的wordlist 也有风险
*   **目录创建与文件写入：** 代码会在`results/{run_id}`目录下创建目录和写入文件。虽然这个目录看似在用户控制的范围内，但如果用户在不安全的上下文中运行脚本，可能会导致权限提升或文件覆盖等问题。
*   **subprocess.call:** 使用subprocess.call执行命令,如果命令中存在恶意代码,也会导致投毒。

综合来看，该POC的投毒风险较低，约为10%。 主要风险在于用户对参数的错误配置和对外部依赖的信任。


**项目地址:** [X3RX3SSec/CVE-2022-0169](https://github.com/X3RX3SSec/CVE-2022-0169)

**漏洞详情:** [CVE-2022-0169](https://nvd.nist.gov/vuln/detail/CVE-2022-0169)