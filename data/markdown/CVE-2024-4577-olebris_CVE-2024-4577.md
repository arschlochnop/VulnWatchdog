## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 8.1.* (before 8.1.29), 8.2.* (before 8.2.20), 8.3.* (before 8.3.8)

**利用条件:** Windows系统，运行于CGI模式，系统启用了使用"Best Fit"策略的代码页，使用Apache

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞。当PHP在Windows上以CGI模式运行时，如果系统配置了特定的代码页，Windows可能会使用“Best-Fit”行为替换命令行中的字符，PHP CGI模块可能会将这些字符错误地解释为PHP选项。这允许攻击者向正在运行的PHP二进制文件传递选项，从而可能泄露脚本的源代码、在服务器上运行任意PHP代码等。根据提供的漏洞利用代码，利用方式是通过POST请求向目标服务器发送特定的URL和请求头，其中URL包含恶意的PHP选项，例如`allow_url_include`和`auto_prepend_file`。请求体包含PHP代码（例如`<?php phpinfo(); ?>`）。如果服务器存在漏洞，服务器将执行请求体中的PHP代码，从而允许攻击者执行任意代码。

提供的POC代码的有效性较高，因为它直接利用了漏洞描述中提到的`allow_url_include`和`auto_prepend_file`选项来执行任意PHP代码。

关于投毒风险，分析POC代码本身，该脚本的功能是验证目标站点是否存在CVE-2024-4577漏洞。它通过发送包含`phpinfo()`函数的POST请求来判断目标是否易受攻击。脚本没有发现任何恶意或隐藏的投毒代码。脚本只是用于检测漏洞，而不是植入后门或其他恶意软件。
根据搜索引擎结果，此漏洞已经被大规模利用，证明此漏洞的利用难度低且影响广泛。

**项目地址:** [olebris/CVE-2024-4577](https://github.com/olebris/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)