## CVE-2023-45866 BlueZ Bluetooth HID 注入

**漏洞编号:** CVE-2023-45866

**漏洞类型:** 蓝牙HID注入

**影响应用:** BlueZ

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.64 (Ubuntu 22.04LTS)

**利用条件:** 攻击者需要在目标设备蓝牙范围内，且目标设备未进行必要的身份验证或配对。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45866 允许未经身份验证的蓝牙外围设备模拟HID设备（例如键盘），并向主机系统注入恶意输入。该漏洞存在于BlueZ蓝牙协议栈中，攻击者可以绕过身份验证，建立加密连接，并发送HID报告，从而模拟键盘输入，执行任意命令。

**有效性分析：**
根据漏洞信息，搜索引擎结果以及提供的POC代码，可以判定该漏洞是有效的。POC代码是一个Python脚本，它模拟了一个蓝牙键盘，并尝试连接到目标设备并发送按键输入。脚本中实现了HID报告的构造和发送，以及DuckyScript的解析功能，可以执行预定义的恶意payload。

**投毒风险分析：**
虽然脚本本身旨在利用该漏洞，但其中可能存在一些潜在的投毒风险。例如，脚本可能包含：
1.  **恶意Payload：** DuckyScript部分，攻击者可能将脚本配置为执行破坏性的命令，例如删除文件、安装恶意软件或窃取敏感数据。
2.  **后门功能：** 脚本可能包含额外的代码，用于在目标系统上安装后门，允许攻击者在以后重新访问该系统。
3.  **信息收集：** 脚本可以收集有关目标系统的信息，例如操作系统版本、已安装的软件或网络配置，并将这些信息发送给攻击者。

对代码进行分析后，发现代码的功能主要集中在模拟蓝牙键盘和发送预定义的按键序列。但是，`process_duckyscript` 函数允许执行任意的DuckyScript命令，这本身就具有潜在的风险。因此投毒风险定为10%,主要集中在DuckyScript的 payload 部分。

**利用方式：**
1.  **准备：** 攻击者需要一台配备蓝牙功能的设备，并安装必要的软件库（例如Python的`bluetooth`库）。
2.  **扫描：** 使用蓝牙扫描工具查找附近易受攻击的设备。
3.  **连接：** 使用POC代码中提供的蓝牙地址连接到目标设备。
4.  **注入：** 通过发送HID报告模拟键盘输入，执行恶意命令。

总而言之，CVE-2023-45866是一个严重的安全漏洞，攻击者可以利用它来远程控制受影响的设备。用户应及时更新BlueZ版本，或者禁用蓝牙功能来防范攻击。

**项目地址:** [Chedrian07/CVE-2023-45866-POC](https://github.com/Chedrian07/CVE-2023-45866-POC)

**漏洞详情:** [CVE-2023-45866](https://nvd.nist.gov/vuln/detail/CVE-2023-45866)