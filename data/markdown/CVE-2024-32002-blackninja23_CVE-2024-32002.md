## CVE-2024-32002-Git-RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** 受影响版本包括：2.45.0, 2.44.0, 2.43.0 < 2.43.4, 2.42.0 < 2.42.2, 2.41.0, 2.40.0 < 2.40.2, < 2.39.4

**利用条件:** 需要在大小写不敏感的文件系统（例如Windows或macOS）上进行克隆，并且core.symlinks=true（默认）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是 Git 中存在的一个远程代码执行漏洞。该漏洞源于 Git 在递归克隆包含恶意子模块的存储库时，由于大小写不敏感的文件系统上的符号链接处理不当，导致可以将文件写入 `.git/` 目录而不是子模块的工作目录中。 这允许写入一个钩子，该钩子将在克隆操作仍在运行时执行，使用户没有机会检查正在执行的代码。

**有效性：**
根据漏洞库信息、搜索结果和漏洞利用代码，此漏洞利用的有效性较高。PoC 代码明确展示了如何利用该漏洞在 Windows 和 macOS 系统上实现 RCE。

**投毒风险：**
该存储库存在一定的投毒风险。虽然提供的 PoC 代码看似直接，目的是展示漏洞利用，但`create_poc.sh`脚本如果被修改，则有可能植入恶意代码，导致使用者在不知情的情况下执行攻击者的恶意操作。脚本中包含的 URL `https://github.com/blackninja23/hook.git`，如果被替换成恶意仓库，存在被投毒的风险。但代码本身功能比较直白，没有过于复杂的逻辑，因此投毒风险较低，预估为10%。

**利用方式：**
1.  攻击者创建一个恶意 Git 仓库，其中包含一个子模块。
2.  该子模块的路径被精心构造，利用大小写变体（例如 `A/modules/x` vs `a/modules/x`）来欺骗大小写不敏感的文件系统。
3.  该子模块包含一个符号链接，指向仓库的 `.git/` 目录。
4.  `.git/` 目录中包含一个恶意 Git 钩子（例如 `post-checkout`）。
5.  当受害者使用 `git clone --recursive` 克隆恶意仓库时，Git 会尝试递归地克隆子模块。
6.  由于大小写不敏感的文件系统，Git 可能会错误地解析子模块的路径，导致符号链接被解析到 `.git/` 目录中。
7.  恶意 Git 钩子会被执行，从而导致远程代码执行。

**项目地址:** [blackninja23/CVE-2024-32002](https://github.com/blackninja23/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)