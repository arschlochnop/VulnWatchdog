## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.14.2 <= version < 2.30.1 (受影响版本详见漏洞库信息)

**利用条件:** 需要目标系统使用受影响的Git版本，且使用大小写不敏感的文件系统（如NTFS、HFS+、APFS），并且配置了clean/smudge filter（例如Git LFS），用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 是一个 Git 漏洞，允许恶意仓库在克隆时执行任意代码。此漏洞主要影响使用大小写不敏感文件系统的系统，如 Windows 和 macOS，并且需要配置 clean/smudge 过滤器（例如 Git LFS）。

**有效性分析：**
提供的 POC 代码包含以下文件：
* `A/a`：一个空文件。
* `A/b`：一个空文件。
* `A/post-checkout`：一个 shell 脚本，其作用是创建 `/tmp/pwn` 文件并写入 "PWN" 字符串。

`post-checkout` 脚本被放置在 `.git/hooks` 目录下，并在 `git checkout` 命令执行后执行。利用的关键在于精心构造的文件名和符号链接，使得在大小写不敏感的文件系统上，钩子脚本能够被正确识别并执行。根据漏洞描述，结合 clean/smudge 过滤器配置，可以触发执行。

**投毒风险分析：**
提供的 POC 代码非常简单，除了创建 `/tmp/pwn` 文件之外没有其他操作。这意味着该代码本身不太可能包含任何作者隐藏的恶意代码。投毒风险较低。

**利用方式：**
1.  攻击者创建一个包含恶意 `post-checkout` 钩子的 Git 仓库。
2.  该仓库还包含一些文件，例如 `A/a` 和 `A/b`，以及必要的 Git LFS 配置或其他触发 clean/smudge 过滤器的配置。
3.  受害者克隆该恶意仓库到使用大小写不敏感文件系统的机器上，且该机器已经配置了 Git LFS 或其他 clean/smudge 过滤器。
4.  在克隆过程中，由于文件系统的大小写不敏感性，以及 clean/smudge 过滤器的处理，`post-checkout` 钩子被触发执行，导致任意代码执行。
5.  在这个 POC 例子中，代码执行的结果是在 `/tmp/` 目录下创建一个名为 `pwn` 的文件，文件内容为 `PWN`。

**项目地址:** [Saboor-Hakimi-23/CVE-2021-21300](https://github.com/Saboor-Hakimi-23/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)