## CVE-2022-29464 - WSO2 任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传/远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0

**利用条件:** 需要网络访问到WSO2服务器的/fileupload端点

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-29464 漏洞是一个存在于多个WSO2产品中的严重漏洞，允许未经身份验证的攻击者上传任意文件，进而导致远程代码执行。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞的利用是有效的。搜索引擎结果中多个链接表明该漏洞已被积极利用，且存在公开可用的POC。

**投毒风险：**
提供的POC代码主要是漏洞原理的分析和描述，并未发现直接的恶意代码。然而，任何公开的漏洞利用代码都存在被修改并植入恶意代码的风险。例如，攻击者可能修改POC，在成功上传JSP后，执行额外的恶意操作，例如下载并执行其他恶意程序。POC中直接包含恶意JSP的可能性较低，但后续利用上传的JSP进行投毒的可能性较高。因此，评估投毒风险为 10%。

**利用方式：**
1.  **漏洞位置：** 受影响的WSO2产品存在`/fileupload`端点，该端点允许未授权的文件上传。
2.  **路径穿越：** 攻击者利用`Content-Disposition`头中的目录遍历序列（例如`../../../../`）将上传的文件写入到Web根目录下的特定位置，如`repository/deployment/server/webapps`。
3.  **上传恶意文件：** 攻击者上传包含恶意代码的JSP文件。
4.  **远程代码执行：**  一旦恶意JSP文件被上传到Web根目录，攻击者可以通过访问该JSP文件来执行服务器上的任意代码。

**项目地址:** [hakivvi/CVE-2022-29464](https://github.com/hakivvi/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)