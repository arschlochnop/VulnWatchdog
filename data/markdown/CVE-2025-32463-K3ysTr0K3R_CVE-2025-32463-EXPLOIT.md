## CVE-2025-32463-Sudo-本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 1.9.14 - 1.9.17 (不包含1.9.17p1)

**利用条件:** 本地用户访问权限，目标系统存在漏洞版本的Sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 是 Sudo 1.9.14 到 1.9.17p1 版本中存在的一个本地权限提升漏洞。该漏洞允许本地攻击者利用 `--chroot` 选项，通过用户可控的 `/etc/nsswitch.conf` 文件获取 root 权限。漏洞利用方式如下：

1.  **漏洞原理：** `sudo -R` (或 `--chroot`) 选项的目的是在 chroot 环境中执行命令。然而，该漏洞允许攻击者指定自己的 `/etc/nsswitch.conf`，Sudo会读取攻击者控制的目录中的nsswitch.conf，这个文件指定了如何解析用户名、密码等信息。通过构造恶意的 `nsswitch.conf` 文件，可以劫持名称服务查找过程，加载攻击者控制的动态链接库，从而执行任意代码。

2.  **利用步骤：**
    *   创建一个临时目录作为 chroot 环境。
    *   在该目录中创建 `etc/nsswitch.conf` 文件，将 `passwd` 数据库的查找指向一个恶意动态链接库（`.so` 文件）。
    *   编译一个恶意动态链接库，其中包含在加载时执行的 shellcode，用于提升权限。该 shellcode 通常会调用 `setreuid(0,0)` 和 `setregid(0,0)` 来更改用户和组 ID 为 root，然后执行 `/bin/sh` 或指定的命令。
    *   使用 `sudo -R <chroot目录> <任意命令>` 来触发漏洞。Sudo 将使用攻击者提供的 `nsswitch.conf` 文件，加载恶意动态链接库，从而以 root 权限执行代码。

3.  **POC分析：** 提供的 shell 脚本 `CVE-2025-32463.sh` 实现了上述步骤。它首先检查依赖项（gcc, sudo）和 sudo 版本。然后，创建一个临时目录，生成恶意的 `nsswitch.conf` 和动态链接库 `bridge90.so.2`，最后使用 `sudo -R` 命令触发漏洞。脚本会在编译的c文件里运行 setreuid(0,0),达到提权目的。

4.  **有效性评估：** 根据漏洞信息和 POC 代码，该漏洞利用方法是有效的。脚本首先确认 Sudo 版本是否在受影响范围内，并且会进行漏洞确认，然后生成并编译exploit，并执行。如果目标系统满足漏洞利用的条件，该 POC 代码应该能够成功实现本地权限提升。

5.  **投毒风险评估：** 尽管该 POC 脚本旨在利用漏洞，但也存在潜在的投毒风险。风险点分析如下：
    *   **编译过程中的恶意代码：** 脚本中的 `bridge90.c` 文件是编译成动态链接库的关键。如果这个文件中包含恶意代码（例如，在提权后植入后门、上传用户数据等），则可能导致被攻击者在不知情的情况下执行恶意操作。虽然当前提供的代码只是简单的提升权限并执行 shell，但理论上可以修改这个文件来包含恶意行为。
    *   **其他潜在的恶意行为：** 尽管脚本的主要目的是提权，但也可能包含其他隐藏的恶意行为，例如修改系统文件、安装恶意软件等。由于脚本需要 root 权限才能执行，因此一旦成功提权，恶意代码可能会对系统造成严重损害。

   **评估结论：** 此漏洞利用的有效性高。 投毒风险较低，风险系数为 10%。目前提供的poc脚本没有明显的投毒代码，但需要注意，攻击者可以修改代码来加入恶意行为。

**项目地址:** [K3ysTr0K3R/CVE-2025-32463-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2025-32463-EXPLOIT)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)