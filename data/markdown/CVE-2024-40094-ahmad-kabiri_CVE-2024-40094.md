## CVE-2024-40094-graphql-java-DoS

**漏洞编号:** CVE-2024-40094

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** graphql-java

**危害等级:** 中危，可能导致服务不可用

**影响版本:** < 21.5

**利用条件:** 需要GraphQL端点可访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-40094 漏洞存在于 graphql-java 21.5 之前的版本中。该漏洞允许攻击者通过发送特制的 introspection 查询，利用 ExecutableNormalizedFields (ENFs) 的处理缺陷来执行拒绝服务攻击。攻击的原理是，构造包含大量嵌套字段和别名的 GraphQL 查询，导致服务端在处理这些查询时消耗大量资源，最终导致服务崩溃或响应缓慢。

**有效性评估：**

提供的 POC 代码 `CVE-2024-40094.py` 旨在通过发送大量包含嵌套别名的 introspection 查询来触发 ENF 相关的 DoS 漏洞。代码使用 `aiohttp` 库实现异步请求，以增加并发量，提高攻击效率。根据搜索结果，已经存在利用该漏洞的脚本，因此提供的POC代码很可能有效。

**投毒风险评估：**

检查提供的 POC 代码，主要功能是构造并发送 GraphQL 查询，并记录响应信息。LICENSE 文件为MIT许可,未发现任何恶意行为或后门代码。但是考虑到用户提供的URL头信息,我们假设存在小概率的投毒风险，风险占比为1%。风险主要来自于用户误配置了URL与Headers信息，导致信息泄露。

**利用方式：**

1.  **目标确认：** 确定目标 GraphQL API 端点。
2.  **查询构造：** 使用 `build_enf_query` 函数构造包含大量嵌套别名的恶意 GraphQL 查询。别名的数量由 `ALIAS_COUNT` 控制。
3.  **并发请求：** 使用 `aiohttp` 库，通过多个 worker 协程并发地向目标端点发送构造的查询。`JOB_COUNT` 控制并发数量。
4.  **资源消耗：** 恶意查询会导致服务端在处理 ENF 时消耗大量 CPU 和内存资源。
5.  **拒绝服务：** 过量的资源消耗最终导致服务响应缓慢或崩溃，实现拒绝服务攻击。

**项目地址:** [ahmad-kabiri/CVE-2024-40094](https://github.com/ahmad-kabiri/CVE-2024-40094)

**漏洞详情:** [CVE-2024-40094](https://nvd.nist.gov/vuln/detail/CVE-2024-40094)