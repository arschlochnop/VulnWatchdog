## CVE-2024-4367-Firefox-PDF.js任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird (PDF.js)

**危害等级:** 高危，允许在PDF.js上下文中执行任意JavaScript代码

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 用户需要打开恶意的PDF文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4367是Mozilla Firefox, Firefox ESR, Thunderbird中的一个漏洞，存在于PDF.js中，由于在处理字体时缺少类型检查，允许攻击者通过构造恶意的PDF文件，在PDF.js的上下文中执行任意JavaScript代码。 

**利用方式：**

1.  攻击者创建一个恶意的PDF文档。
2.  该PDF文档包含特制的字体数据，利用PDF.js字体处理过程中的类型检查缺失漏洞。
3.  当用户使用受影响的Firefox或Thunderbird版本打开此PDF文档时，PDF.js会解析该恶意字体数据。
4.  由于缺少类型检查，PDF.js会执行嵌入在字体数据中的恶意JavaScript代码。
5.  恶意JavaScript代码在PDF.js的上下文中执行，可以进行诸如窃取信息或执行其他恶意操作。

**POC分析：**

提供的POC代码是一个PDF文件，其中包含:
*   定义了一个Shading Pattern，其中包含一个Function，该Function用于生成颜色，包含/C0[0 0 1]和/C1[1 0.6 0]，定义了从蓝到橙色的颜色渐变
*   定义了一个Font，其中FontMatrix的值为`[0.1 0 0 0.1 0 (1\); alert\('vprr')]`，其中包含了嵌入的JavaScript代码`alert('vprr')`
*   定义了一个Page，Contents 使用了定义的 Shading Pattern 和 Font，通过在PDF文档中绘制文本，会触发字体渲染，从而执行嵌入在字体中的JavaScript代码，弹出警告框。

**有效性：**

根据漏洞描述和POC代码，该POC利用了PDF.js在处理字体时的类型检查缺失漏洞，通过在FontMatrix中嵌入JavaScript代码，成功实现了任意JavaScript代码执行。因此，该POC代码被认为是有效的。

**投毒风险：**

该POC代码的主要功能是利用漏洞执行JavaScript代码，弹出警告框。虽然POC本身不包含明显的恶意行为，但如果攻击者在实际攻击中，可能会将警告框替换为更隐蔽的恶意代码，例如窃取用户数据或执行其他恶意操作。因此判断该仓库中存在作者隐藏的投毒代码的风险较低，约为5%。 主要是考虑了作者可能将alert信息替换为其他payload。但就目前来看，该PDF 仅仅是漏洞验证程序。

**项目地址:** [pedrochalegre7/CVE-2024-4367-pdf-sample](https://github.com/pedrochalegre7/CVE-2024-4367-pdf-sample)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)