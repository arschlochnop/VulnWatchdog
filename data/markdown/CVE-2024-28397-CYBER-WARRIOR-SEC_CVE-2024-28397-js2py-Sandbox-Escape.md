## CVE-2024-28397-js2py-Sandbox-Escape

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 代码注入/沙箱逃逸

**影响应用:** js2py

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 0.74

**利用条件:** 需要安装了js2py库，并且在python环境中执行JavaScript代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-28397是js2py库中存在的一个代码注入/沙箱逃逸漏洞。该漏洞源于js2py在处理全局变量时存在缺陷，允许攻击者在JS代码中获取对Python对象的引用，从而绕过js2py.disable_pyimport()的限制，逃逸JS沙箱并在主机上执行任意代码。攻击者可以通过构造恶意的JS代码，利用此漏洞实现远程代码执行。

**漏洞利用方式：**

1.  攻击者需要找到使用js2py库解析JavaScript代码的应用程序。
2.  攻击者构造包含恶意代码的JavaScript文件，例如，利用全局变量漏洞获取Python对象引用，并执行系统命令。
3.  应用程序使用js2py库解析该恶意JavaScript代码。
4.  恶意代码利用漏洞绕过沙箱限制，在主机上执行任意命令，例如`head -n 1 /etc/passwd`来验证漏洞，或者执行其他恶意操作。

**有效性：**

根据提供的漏洞信息和POC代码描述，该POC代码是有效的。`affected_version_test.txt`文件记录了在不同Python版本上，利用该漏洞执行`head -n 1 /etc/passwd`命令成功的案例。POC代码可以成功绕过沙箱限制，在主机上执行任意命令。

**投毒风险：**

评估该仓库的投毒风险为10%。理由如下：

1.  `README.md`和`README_zh.md`文件提供了漏洞的详细描述，重现步骤和修复方法，较为清晰完整。
2.  `affected_version_test.txt`文件包含了在不同python版本下的测试结果，证明了该漏洞的存在。
3.  作者在`README.md`文件中提到，在发现漏洞后已向官方仓库提交PR，但PR长期未被处理，才选择公开POC和修复方案，说明作者的目的是为了推动漏洞修复，而非恶意传播。

然而，仍然存在一定的投毒风险：

1.  攻击者可能修改`poc.py`文件，将其中执行的命令替换为更具破坏性的恶意代码。
2.  攻击者可能在`fix.py`文件中添加后门代码，诱导用户使用包含后门的修复方案。

**项目地址:** [CYBER-WARRIOR-SEC/CVE-2024-28397-js2py-Sandbox-Escape](https://github.com/CYBER-WARRIOR-SEC/CVE-2024-28397-js2py-Sandbox-Escape)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)