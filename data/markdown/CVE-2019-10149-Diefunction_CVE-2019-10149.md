## CVE-2019-10149-Exim-远程命令执行

**漏洞编号:** CVE-2019-10149

**漏洞类型:** 远程命令执行

**影响应用:** Exim

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 4.87 to 4.91 (inclusive)

**利用条件:** 目标服务器运行存在漏洞的Exim版本，且允许外部连接到SMTP端口（默认25端口）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-10149是Exim邮件服务器中存在的一个远程命令执行漏洞。漏洞原因是Exim在`deliver_message()`函数中对收件人地址的验证不当，攻击者可以通过构造特殊的邮件收件人地址，在服务器上执行任意命令。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以判断此漏洞是真实存在的，且有可用的POC代码。搜索引擎结果中多个链接（例如Tenable, NVD, Rapid7, Microsoft, Trend Micro, Qualys, Orpheus Cyber, SecPod, esentire, RedHat）都确认了此漏洞的存在和高危性。CISA已将此漏洞加入已知被利用的漏洞目录(KEV)。提供的PoC脚本也证实了利用方法的可行性。

**投毒风险：**
分析提供的`exploit.py`代码，该脚本主要功能是利用SMTP协议与目标Exim服务器进行交互，构造包含恶意命令的收件人地址，从而实现远程命令执行。脚本的主要步骤包括：
1.  建立socket连接到目标服务器的25端口
2.  发送EHLO命令
3.  发送MAIL FROM命令
4.  发送RCPT TO命令，其中收件人地址包含`${run{...}}`结构，用于执行命令
5.  发送DATA命令
6.  发送包含一系列Received头的邮件正文，最后以".\r\n"结束

检查脚本代码，没有发现任何可疑的、与漏洞利用无关的代码。payload部分通过字符串格式化，将反弹shell命令注入到收件人地址中。因此，可以认为此仓库中作者隐藏投毒代码的可能性为0%。

**利用方式：**
1.  **前期准备：** 攻击者需要一台可以访问目标服务器的机器，并且需要知道目标服务器的IP地址和SMTP端口（通常是25）。攻击者还需要监听一个端口，用于接收目标服务器反弹的shell。
2.  **漏洞利用：** 攻击者运行提供的`exploit.py`脚本，指定目标服务器的IP地址、SMTP端口、攻击者自己的IP地址和监听端口。
3.  **远程命令执行：** 脚本会构造一个包含恶意命令的邮件，发送给目标服务器。当Exim处理该邮件时，会执行恶意命令，通常是反弹shell。
4.  **获取shell：** 攻击者在自己的机器上接收到反弹的shell，从而控制目标服务器。

**项目地址:** [Diefunction/CVE-2019-10149](https://github.com/Diefunction/CVE-2019-10149)

**漏洞详情:** [CVE-2019-10149](https://nvd.nist.gov/vuln/detail/CVE-2019-10149)