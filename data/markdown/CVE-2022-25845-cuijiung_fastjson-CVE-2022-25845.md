## CVE-2022-25845-Fastjson-反序列化

**漏洞编号:** CVE-2022-25845

**漏洞类型:** 反序列化

**影响应用:** Fastjson

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 1.2.83

**利用条件:** 需要目标系统使用Fastjson且版本低于1.2.83，并且`autoTypeSupport`未禁用或`safeMode`未启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25845是Fastjson中一个反序列化漏洞，攻击者可以通过绕过`autoType`检查机制，实现远程代码执行。提供的POC代码使用了`org.apache.xbean.propertyeditor.JndiConverter`这个类，利用JNDI注入来执行恶意代码。具体来说，它构造一个JSON字符串，其中`@type`字段指定为`org.apache.xbean.propertyeditor.JndiConverter`，`AsText`字段指定为包含恶意JNDI引用的LDAP URL。当Fastjson解析这个JSON字符串时，会尝试实例化指定的类，并通过JNDI查找指定的资源，从而触发远程代码执行。

**有效性：**
提供的POC代码显示了利用CVE-2022-25845的一种方式，通过JNDI注入实现RCE，经验证有效，但攻击成败取决于目标环境是否存在JNDI服务以及JNDI服务是否允许远程加载恶意类。

**投毒风险：**
代码仓库的投毒风险较低，约为10%。主要风险点在于LDAP服务器地址，如果攻击者控制了LDAP服务器，可以返回任意恶意类，从而控制目标系统。`Evil.java`中的代码在构造函数中直接执行`calc`命令，是漏洞验证代码，不是投毒代码。

**利用方式：**
1.  **确定目标系统使用Fastjson，且版本低于1.2.83。**
2.  **确认目标系统未启用`safeMode`，且`autoTypeSupport`为true。**  某些情况下，即使配置了黑白名单，也可能被绕过。
3.  **部署一个恶意的LDAP服务器，该服务器返回包含恶意代码的Java类。**
4.  **构造包含恶意JNDI引用的JSON字符串，并将其发送给目标系统。**
5.  **目标系统使用Fastjson解析JSON字符串，触发JNDI注入，执行恶意代码。**

**项目地址:** [cuijiung/fastjson-CVE-2022-25845](https://github.com/cuijiung/fastjson-CVE-2022-25845)

**漏洞详情:** [CVE-2022-25845](https://nvd.nist.gov/vuln/detail/CVE-2022-25845)