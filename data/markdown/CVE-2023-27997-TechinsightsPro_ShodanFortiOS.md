## CVE-2023-27997 - FortiOS SSL-VPN 堆缓冲区溢出

**漏洞编号:** CVE-2023-27997

**漏洞类型:** 堆缓冲区溢出

**影响应用:** FortiOS, FortiProxy

**危害等级:** 高危，可远程代码执行

**影响版本:** FortiOS: <= 7.2.4, <= 7.0.11, <= 6.4.12, <= 6.2.13, <= 6.0.16; FortiProxy: <= 7.2.3, <= 7.0.9, <= 2.0.12, <= 1.2.13, <= 1.1.6

**利用条件:** 需要开启SSL-VPN服务，且目标版本存在漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-27997 是 FortiOS 和 FortiProxy SSL-VPN 中的一个堆缓冲区溢出漏洞。攻击者可以通过构造恶意请求，利用此漏洞在目标系统上执行任意代码或命令。

**有效性：**
根据搜索结果和漏洞库信息，该漏洞已被广泛利用。BishopFox 的博客提供了漏洞分析和利用方法，并发布了漏洞检测工具。CISA 将此漏洞列入已知被利用的漏洞目录中。综合来看，该漏洞的 PoC 利用是有效的。

**投毒风险：**
提供的 PoC 代码 `shodan_search.py` 本身是一个用于在 Shodan 上搜索特定地区内最近已修复的 FortiOS 设备的脚本。该脚本通过查询包含特定日期 `Last-Modified` 字段的设备，来判断设备是否在给定的日期范围内进行了更新。脚本本身的功能是用于安全研究和漏洞发现，而非直接攻击或植入后门。但是，使用 Shodan API 需要 API 密钥，如果攻击者获取到该密钥，可以滥用该脚本进行大规模扫描活动，或者在其他脚本中植入恶意代码。因此，存在一定的投毒风险，但风险较低。由于只是简单的信息搜集脚本，并不包含攻击载荷或者恶意操作，投毒风险评估为5%。

**利用方式：**
1.  **漏洞触发：** 攻击者发送特制的 SSL-VPN 请求，利用堆缓冲区溢出漏洞。
2.  **代码执行：** 成功溢出后，攻击者可以控制程序执行流程，注入并执行恶意代码。
3.  **权限获取：** 恶意代码可以执行系统命令，获取系统权限，甚至完全控制受影响的设备。

**项目地址:** [TechinsightsPro/ShodanFortiOS](https://github.com/TechinsightsPro/ShodanFortiOS)

**漏洞详情:** [CVE-2023-27997](https://nvd.nist.gov/vuln/detail/CVE-2023-27997)