## CVE-2022-22963-Spring Cloud Function SpEL RCE

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Cloud Function

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码。

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and all old and unsupported versions

**利用条件:** 需要目标应用使用Spring Cloud Function，并且开启了routing功能。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中的一个 SpEL 表达式注入导致的远程代码执行漏洞。当应用使用了 routing 功能时，攻击者可以通过构造恶意的 SpEL 表达式作为 routing-expression，发送到服务器端，服务器在处理该 SpEL 表达式时会执行其中的代码，从而导致 RCE。\n\n**有效性：**\n根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断此漏洞的POC代码有效。搜索结果中许多文章都提到了该漏洞的远程代码执行能力，并且漏洞利用代码提供了一个可以执行命令和反弹shell的工具。\n\n**投毒风险：**\n漏洞利用代码（Spring-cloud-function-spel.py）主要功能是发送包含恶意SpEL表达式的HTTP请求。代码逻辑相对简单，主要集中在构建payload和发送请求上。\n*   **风险点分析：**
    * 反弹shell和执行命令的功能本身就具有潜在的风险，如果被恶意利用，可以直接控制目标服务器。
    *  该仓库中是否存在作者隐藏的投毒代码的可能性较低。代码比较简单，主要是构建恶意SPEL 表达式，然后发送请求，所以分析给出较低的投毒百分比。\n\n**利用方式：**\n1.  **确定目标应用使用了Spring Cloud Function，并且启用了routing功能。**
2.  **使用POC工具（Spring-cloud-function-spel.py 或 编译好的exe）。**
3.  **通过 `--check` 参数选择GET或POST请求方式检测漏洞是否存在。工具通过判断返回状态码是否为500来判断漏洞是否存在。
4.  **如果漏洞存在，可以使用 `--cmd` 参数执行任意命令，或者使用 `--ip` 和 `--port` 参数反弹shell。**
5.  **POC工具会构造一个包含恶意SpEL表达式的HTTP请求，并将该请求发送到目标应用的`/functionRouter`（默认路由，可以通过`--route`参数修改）路径。**
6.  **目标应用在处理该请求时，会解析并执行SpEL表达式，从而导致RCE。**

**项目地址:** [charis3306/CVE-2022-22963](https://github.com/charis3306/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)