## CVE-2023-7028 - GitLab Account Takeover

**漏洞编号:** CVE-2023-7028

**漏洞类型:** 账号接管

**影响应用:** GitLab CE/EE

**危害等级:** 高危，可能导致账号接管，数据泄露，权限提升

**影响版本:** 16.1 to 16.1.5, 16.2 to 16.2.8, 16.3 to 16.3.6, 16.4 to 16.4.4, 16.5 to 16.5.5, 16.6 to 16.6.3, 16.7 to 16.7.1

**利用条件:** 目标GitLab实例存在漏洞且可访问密码重置页面

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-7028 是一个存在于 GitLab CE/EE 的密码重置功能中的账号接管漏洞。未经身份验证的攻击者可以通过向密码重置端点提供多个电子邮件地址，从而将密码重置链接发送到攻击者控制的电子邮件地址，进而接管受害者帐户。 

**有效性分析：**
提供的 PoC 代码 `CVE-2023-7028 PoC.py` 看起来有效，因为它实现了漏洞利用所需的步骤。 它首先获取 `authenticity_token` 和 `_gitlab_session` cookie。 然后，它构造一个包含受害者和攻击者电子邮件地址的恶意请求，并将其发送到密码重置端点。 如果漏洞存在，则攻击者将收到密码重置链接。

**投毒风险分析：**
PoC 代码本身看起来没有明显的投毒行为。代码逻辑相对简单，主要功能就是利用漏洞，没有发现隐藏的恶意代码或后门。但是，任何从外部来源获取的代码都存在一定的风险，需要仔细审查。 这里给出的投毒风险评分为5%，主要考虑到以下几点：
*   代码依赖 `requests` 和 `colorama` 两个库，这些库本身存在被供应链攻击的风险。
*   虽然代码主体功能明确，但无法完全排除作者在代码中隐藏不明显恶意行为的可能性。
*   代码从 GitLab 实例获取 token 和 cookie，如果 GitLab 实例本身被入侵，获取到的 token 和 cookie 可能已经被篡改。

**利用方式：**
1.  **目标确认：** 确认目标 GitLab 实例的版本在受影响的范围内。
2.  **获取必要信息：** 使用 PoC 脚本的 `get_token` 函数从目标 GitLab 实例的密码重置页面获取 `authenticity_token` 和 `_gitlab_session` cookie。
3.  **构造恶意请求：** 使用获取到的 `authenticity_token` 和 `_gitlab_session` cookie，以及受害者和攻击者的电子邮件地址，构造一个包含两个电子邮件地址的 POST 请求，发送到 `/users/password` 端点。`user[email][]` 参数包含受害者和攻击者的电子邮件地址。
4.  **接收重置链接：** 如果漏洞存在，攻击者的电子邮件地址将收到密码重置链接。
5.  **重置密码：** 攻击者使用收到的密码重置链接重置受害者帐户的密码。
6.  **接管帐户：** 攻击者使用新密码登录受害者帐户。

**项目地址:** [thanhlam-attt/CVE-2023-7028](https://github.com/thanhlam-attt/CVE-2023-7028)

**漏洞详情:** [CVE-2023-7028](https://nvd.nist.gov/vuln/detail/CVE-2023-7028)