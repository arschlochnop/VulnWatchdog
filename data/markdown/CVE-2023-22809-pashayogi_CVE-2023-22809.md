## CVE-2023-22809-sudoedit权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** sudo

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** 1.8.0 to 1.9.12p1

**利用条件:** 用户需要拥有使用 sudoedit 或 sudo -e 命令编辑文件的权限，且目标文件属于root用户。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22809 漏洞允许本地攻击者通过滥用 sudoedit（或 -e）功能中对用户提供的环境变量（SUDO_EDITOR、VISUAL 和 EDITOR）的处理方式，将任意条目附加到要处理的文件列表中，从而导致权限提升。

**有效性：**
POC 代码有效。该代码首先检查 sudo 版本是否在受影响范围内，然后检查当前用户是否可以使用 sudoedit 或 sudo -e 以 root 身份运行命令。如果满足条件，则它会通过设置 EDITOR 环境变量，利用 vim 的 `--` 参数绕过保护机制，打开 /etc/sudoers 文件进行编辑，引导用户添加一行配置以获取 root 权限，最终通过 `sudo su root` 获取 root shell。

**投毒风险：**
该 POC 代码中没有明显的投毒代码。脚本的功能很明确，即利用漏洞提升权限。它仅修改 `/etc/sudoers` 文件，而不会尝试植入任何隐藏的后门或其他恶意代码。

**利用方式：**
1.  **检查 sudo 版本：** 首先，检查目标系统上安装的 sudo 版本是否在受影响的范围内（1.8.0 到 1.9.12p1）。
2.  **检查 sudoedit 权限：** 检查当前用户是否具有使用 sudoedit 或 sudo -e 命令编辑文件的权限，并且该文件归 root 用户所有。
3.  **设置 EDITOR 环境变量：** 将 EDITOR 环境变量设置为包含 `--` 参数的恶意值，例如 `EDITOR="vim -- /etc/sudoers"`。
4.  **运行 sudoedit：** 运行 `sudoedit <受root拥有的文件>` 命令。由于环境变量的影响，这会导致使用 vim 打开 `/etc/sudoers` 文件。
5.  **编辑 /etc/sudoers：**  在打开的 `/etc/sudoers` 文件中，添加一行允许当前用户以 root 身份执行任何命令的配置，例如 `<用户名> ALL=(ALL:ALL) ALL`。
6.  **获取 root shell：** 使用 `sudo su root` 命令获取 root shell。

综上所述，提供的POC代码有效，不存在投毒风险，且能成功利用 CVE-2023-22809 漏洞提升权限。

**项目地址:** [pashayogi/CVE-2023-22809](https://github.com/pashayogi/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)