## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 1.3 - 2.12.1

**利用条件:** 默认配置或未修改Admin API的IP限制和API密钥

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24112 允许攻击者利用 batch-requests 插件绕过 Admin API 的 IP 限制，如果 Apache APISIX 使用默认配置（默认 API 密钥），则存在远程代码执行的风险。

**利用方式：**

1.  攻击者发送包含恶意请求的批处理请求到 `/apisix/batch-requests` 接口。
2.  在批处理请求中，攻击者通过 `X-Real-IP` 头欺骗客户端 IP 地址，绕过 Admin API 的 IP 限制。
3.  攻击者利用默认 API 密钥，通过Admin API创建包含恶意Lua代码的路由规则。POC通过在`filter_func`中执行bash反弹shell。
4.  当客户端访问与恶意路由规则匹配的 URI 时，Lua 代码被执行，从而实现远程代码执行。

**有效性：**
提供的 POC 代码利用了该漏洞。它首先发送一个 POST 请求到 `/apisix/batch-requests`，其中包含一个PUT请求用于创建路由，这个路由的 `filter_func` 会执行反弹 shell 的 bash 命令。然后，发送一个GET请求到这个创建的路由，触发命令执行。

**投毒风险：**
代码主体功能为漏洞利用，但仍存在小概率投毒风险，例如：

1.  **隐蔽的反弹shell地址:** 攻击者可能将反弹 shell 的地址隐藏在代码中，使其难以被发现。
2.  **定时任务植入:** 攻击者可能会添加定时任务，定期执行恶意代码。
3.  **后门账户:** 攻击者可能会添加一个后门账户，方便以后访问系统。

虽然 POC 主要目的是利用漏洞，但是不能完全排除作者植入其他恶意代码的可能性。因此，将投毒风险评估为 10%。

**项目地址:** [kavishkagihan/CVE-2022-24112-POC](https://github.com/kavishkagihan/CVE-2022-24112-POC)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)