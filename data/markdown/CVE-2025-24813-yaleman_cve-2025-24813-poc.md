## CVE-2025-24813 Apache Tomcat RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Tomcat

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 9.0.0.M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** writes enabled for the default servlet, support for partial PUT (enabled by default), application uses Tomcat's file based session persistence with default storage location, application includes a library that may be leveraged in a deserialization attack

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞，允许攻击者通过具有写权限的默认 Servlet 执行远程代码或进行信息泄露。漏洞利用的关键在于 Tomcat 的 partial PUT 功能和文件型 session 持久化机制。 

**有效性分析：**

根据漏洞描述和搜索结果，该漏洞利用依赖于几个前提条件：

1.  默认 Servlet 必须启用写入权限（默认禁用，需要配置）。
2.  必须支持 partial PUT （默认启用）。
3.  应用程序必须使用 Tomcat 的文件型 session 持久化，且使用默认存储位置。
4.  应用程序需要包含一个可用于反序列化攻击的库（例如，存在已知的 ysoserial gadget）。

提供的 PoC 代码（main.py）尝试模拟这些步骤：

1.  检查目标 Servlet 是否可通过 PUT 请求写入。
2.  生成恶意的 Java 序列化 payload （通过 ysoserial）。
3.  上传 payload 作为 session 文件。
4.  通过访问 session 文件触发反序列化。

搜索结果表明，CVE-2025-24813 漏洞在野外已被积极利用。 多个博客文章 (rapid7, recordedfuture, akamai, keysight, wiz, zscaler, sonicwall, xmcyber) 都描述了该漏洞以及检测和缓解方法。

**投毒风险分析：**

分析提供的PoC代码，存在一定的投毒风险，约为10%：

*   `download.sh` 脚本会从外部源（`https://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar`）下载 `ysoserial-all.jar`。虽然 ysoserial 是一个合法的漏洞利用工具，但下载过程中存在被中间人攻击或恶意软件替换的风险。该脚本在下载后会检查文件是否为有效的 JAR 文件，但不能完全保证其安全性。
*   `main.py`  脚本尝试通过PUT请求写入文件，可能会写入恶意代码或后门。虽然脚本主要目的是RCE，但存在修改文件内容的潜在风险。

总体而言，PoC 本身主要是为了演示漏洞，但从外部源下载 ysoserial 存在一定的风险。使用者应谨慎对待。

**利用方式：**

1.  **检查可写性:** 首先，确定目标 Tomcat 服务器上的默认 Servlet 是否启用了写入权限，并且支持 partial PUT 请求。
2.  **生成 Payload:**  使用 ysoserial 或其他工具，根据目标应用程序中存在的库，生成一个恶意的 Java 序列化 Payload，该 Payload 包含要执行的命令。
3.  **上传 Payload:**  将生成的 Payload 通过 PUT 请求上传到 Tomcat 服务器，利用 partial PUT 功能将 Payload 写入到 session 文件中。
4.  **触发反序列化:**  通过构造特定的 HTTP 请求，访问包含恶意 Payload 的 session 文件，触发 Java 反序列化漏洞，从而执行 Payload 中的命令。

该漏洞允许攻击者在目标服务器上执行任意代码，从而完全控制系统。如果无法直接执行代码，攻击者还可以利用该漏洞进行信息泄露，读取敏感文件，或者修改服务器上的文件。

**项目地址:** [yaleman/cve-2025-24813-poc](https://github.com/yaleman/cve-2025-24813-poc)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)