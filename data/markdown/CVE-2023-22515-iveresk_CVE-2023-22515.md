## CVE-2023-22515-Atlassian Confluence-Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可创建未授权的Confluence管理员账户并完全控制Confluence实例。

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** 目标Confluence实例需要公开可访问，且版本位于受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515 是一个存在于 Atlassian Confluence Data Center 和 Server 中的严重漏洞。攻击者可以通过未经身份验证的访问，利用该漏洞创建未经授权的 Confluence 管理员账户，从而完全控制受影响的 Confluence 实例。 

**利用方式：**

1.  **绕过身份验证:** 攻击者利用`/server-info.action`接口，通过设置`bootstrapStatusProvider.applicationConfig.setupComplete`参数为`false`，重置 Confluence 的安装状态。
2.  **创建管理员账户:**  在安装状态被重置后，攻击者通过访问`/setup/setupadministrator.action`接口，并提交包含用户名、密码等信息的 POST 请求，创建一个新的管理员账户。由于安装状态被重置，该过程无需任何身份验证。
3.  **完成安装:** 攻击者通过访问`/setup/finishsetup.action`接口，完成 Confluence 的安装流程，使新创建的管理员账户生效。

**POC有效性：**

提供的POC脚本 `cve-2023-22515.sh` 实现了上述利用方式。脚本首先检查目标是否存在，然后通过curl命令发送HTTP请求，重置安装状态、创建管理员账户并完成安装。 该POC脚本的有效性较高，因为它的逻辑与公开的漏洞利用方式一致，并且可以自动化漏洞利用过程。

**投毒风险：**

虽然脚本主体实现了漏洞利用逻辑，但仍然存在一定的投毒风险。风险主要来源于以下几个方面：

*   **默认用户名密码：** 脚本默认使用 `adm1n` 作为用户名和密码。如果攻击者修改了脚本，并使用更复杂的密码，可能会导致被攻击者难以发现新的管理员账户。
*   **文件读取的潜在风险：** 脚本中存在从文件读取IP地址的逻辑 (`while read LINE; do ... done <$IP`)。如果攻击者能够控制该文件的内容，可能会执行恶意命令。虽然此处的变量`$IP`很可能是一个笔误，应该是`$TARGET`，但不能排除被利用的风险。
*   **CURL参数的修改风险：** 攻击者可能会修改curl命令的参数，例如添加 `--proxy` 参数，将流量转发到恶意服务器，从而窃取敏感信息。或者将 `email=haxor%40localhost` 修改为其他钓鱼邮件。

综合来看，投毒风险约为 10%。该风险主要来源于脚本中可能存在的恶意修改或参数注入，而非脚本本身的漏洞利用逻辑。

**项目地址:** [iveresk/CVE-2023-22515](https://github.com/iveresk/CVE-2023-22515)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)