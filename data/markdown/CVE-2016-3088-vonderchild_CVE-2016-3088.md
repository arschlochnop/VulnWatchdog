## CVE-2016-3088 - Apache ActiveMQ 文件服务器任意文件上传和执行

**漏洞编号:** CVE-2016-3088

**漏洞类型:** 任意文件上传和执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 5.x before 5.14.0

**利用条件:** 需要目标系统运行存在漏洞版本的Apache ActiveMQ，且Fileserver web application可用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 Apache ActiveMQ 的 Fileserver web application 中。攻击者可以通过发送 HTTP PUT 请求上传恶意文件 (例如 JSP shell)，然后使用 HTTP MOVE 请求将其移动到 Web 容器的可执行目录 (例如 admin 目录)。攻击需要身份验证，但是代码执行结果是root权限，无需授权。漏洞利用有效性高，利用代码清晰，未发现恶意投毒代码。攻击者可以利用该漏洞在服务器上执行任意代码，控制服务器。

**利用方式：**

1.  **上传恶意文件：** 使用 HTTP PUT 请求，将包含恶意代码的文件（例如 JSP shell）上传到 fileserver 目录。利用的路径是`fileserver/%80/%80`,  这里利用了目录穿越。
2.  **移动恶意文件：** 使用 HTTP MOVE 请求，将上传的恶意文件移动到 Web 容器的可执行目录下（例如 admin 目录）。将文件移动到`/admin/shell.jsp`。
3.  **远程代码执行：** 访问移动后的恶意文件（例如 `admin/shell.jsp`），即可执行服务器上的任意代码。

**POC 分析：**

POC 代码首先尝试使用 PUT 方法将文件上传到 ActiveMQ 服务器的 fileserver 目录。 然后,它使用 MOVE 方法将上传的文件移动到服务器上的 admin 目录。最后，它打印出上传的 shell 的 URL。该 URL 可用于执行任意命令。

**威胁评估:**

由于此漏洞允许未经身份验证的远程代码执行，因此威胁级别很高。 攻击者可以使用此漏洞来完全控制受影响的系统。

**项目地址:** [vonderchild/CVE-2016-3088](https://github.com/vonderchild/CVE-2016-3088)

**漏洞详情:** [CVE-2016-3088](https://nvd.nist.gov/vuln/detail/CVE-2016-3088)