## CVE-2024-55591 - FortiOS/FortiProxy Authentication Bypass

**漏洞编号:** CVE-2024-55591

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS/FortiProxy

**危害等级:** 严重，可导致超级管理员权限获取

**影响版本:** FortiOS 7.0.0 <= 7.0.16, FortiProxy 7.0.0 <= 7.0.19, FortiProxy 7.2.0 <= 7.2.12

**利用条件:** 需要目标设备开放网络访问，并运行受影响的FortiOS或FortiProxy版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-55591 是一个影响 FortiOS 和 FortiProxy 的身份验证绕过漏洞。攻击者可以通过向 Node.js websocket 模块发送特制请求来获得超级管理员权限。漏洞库信息、搜索引擎结果和提供的 PoC 代码均表明该漏洞的有效性。

**有效性：**
漏洞库信息表明该漏洞已经被积极利用，并被 CISA 加入到已知被利用的漏洞列表中。搜索引擎结果也确认了该漏洞已经被野外利用。提供的 PoC 代码旨在利用 websocket 模块中的缺陷，通过伪造登录上下文信息并发送特制的命令，绕过身份验证并执行任意命令。

**投毒风险：**
PoC 代码本身看起来比较直接地实现了漏洞利用，但仍存在一定的投毒风险。PoC代码中包含从服务器接收数据，并使用`bytes.fromhex(data.hex()).decode(errors='replace')`尝试解码数据，如果服务器返回包含恶意代码的十六进制字符串，可能会被解码并执行。此外，虽然PoC代码没有明显地进行恶意行为，但攻击者可能会修改该代码，加入例如反向shell的恶意代码，从而达到长期控制目标系统的目的。因此，不能完全排除投毒的可能性，估计投毒风险为10%。

**利用方式：**
1.  PoC 利用了 FortiOS/FortiProxy 中的 Node.js websocket 模块的身份验证绕过漏洞。
2.  PoC 首先创建一个 websocket 连接到目标设备。
3.  然后，它构造一个包含伪造的登录上下文信息的 websocket 帧，模拟一个合法的管理员登录。
4.  接下来，它发送一个包含要执行的命令的 websocket 帧。
5.  由于身份验证绕过，目标设备将执行该命令，并将结果返回给攻击者。
6. 该漏洞允许攻击者在未经授权的情况下获得超级管理员权限，从而完全控制受影响的设备。

**项目地址:** [watchtowrlabs/fortios-auth-bypass-poc-CVE-2024-55591](https://github.com/watchtowrlabs/fortios-auth-bypass-poc-CVE-2024-55591)

**漏洞详情:** [CVE-2024-55591](https://nvd.nist.gov/vuln/detail/CVE-2024-55591)