## CVE-2023-32233-Linux Kernel Netfilter nf_tables Use-After-Free

**漏洞编号:** CVE-2023-32233

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** <= 6.3.1

**利用条件:** 本地用户权限，目标系统运行受影响的Linux内核版本且未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-32233是Linux内核Netfilter nf_tables组件中的一个使用后释放（Use-After-Free）漏洞。该漏洞发生在处理批量请求更新nf_tables配置时，由于匿名集合处理不当导致。未授权的本地用户可以利用此漏洞在内核内存中执行任意读写操作，从而获得root权限。

**有效性分析：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，此漏洞利用的有效性较高。漏洞库信息表明该漏洞确实存在，并且允许本地提权。搜索引擎结果中也显示存在公开的PoC代码。
提供的PoC代码包含构建和配置说明，以及如何针对不同内核进行调整的指导，包括内核符号地址和机器码的调整。这表明该PoC是经过验证的，并且具有一定的灵活性，可以适应不同的内核版本。

**投毒风险分析：**
分析PoC代码后，发现其中存在一些需要用户手动配置的参数，例如内核符号地址、机器码等。这些参数的配置需要一定的内核知识，如果配置不当，可能会导致PoC无法成功利用，甚至导致系统崩溃。但是，这些配置要求是由于内核版本和编译选项的差异造成的，属于正常情况，并非恶意投毒。
代码中没有发现明显的恶意代码或后门。需要注意的是，PoC本身可能会导致系统不稳定，甚至崩溃，这是利用UAF漏洞的常见风险。因此，在测试PoC时，建议在专用系统上进行，以避免数据损坏。
综合来看，投毒风险较低，大约为10%。主要风险在于PoC本身可能导致系统不稳定。

**利用方式分析：**
1.  **漏洞触发：** 通过精心构造的Netfilter nf_tables批量请求，触发use-after-free漏洞。漏洞的根源在于对匿名集合的处理不当。
2.  **内存破坏：**  利用use-after-free漏洞，在内核内存中执行任意读写操作。这允许攻击者覆盖关键的内核数据结构。
3.  **权限提升：**  通过覆盖`modprobe_path`变量，将执行modprobe的路径修改为攻击者控制的脚本。当内核尝试执行modprobe时，会执行攻击者提供的脚本，从而获得root权限。
4. **代码分析:** exploit.c代码通过利用nf_tables的批量处理机制中的UAF漏洞，精巧地控制内核内存，最终劫持了`modprobe_path`，实现了提权。其中race condition的利用是成功利用漏洞的关键,需要通过调整sleep时间来提高成功率。
5.  **配置需求:**  PoC需要根据不同的内核版本进行配置，包括内核符号地址和机器码的调整，以确保能够正确利用漏洞。

**项目地址:** [RogelioPumajulca/TEST-CVE-2023-32233](https://github.com/RogelioPumajulca/TEST-CVE-2023-32233)

**漏洞详情:** [CVE-2023-32233](https://nvd.nist.gov/vuln/detail/CVE-2023-32233)