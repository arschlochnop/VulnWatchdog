## CVE-2018-14847-MikroTik RouterOS-目录遍历

**漏洞编号:** CVE-2018-14847

**漏洞类型:** 目录遍历

**影响应用:** MikroTik RouterOS

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** <= 6.42

**利用条件:** 目标设备运行MikroTik RouterOS <= 6.42，并且8291端口开放

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-14847是一个存在于MikroTik RouterOS 6.42及更早版本中的目录遍历漏洞。未经身份验证的远程攻击者可以通过WinBox接口读取任意文件，经过身份验证的攻击者可以写入任意文件。

**有效性分析：**
提供的Python代码 `MikroRoot.py` 利用了此漏洞，它首先使用Shodan搜索暴露的MikroTik设备，然后尝试利用该漏洞从目标设备中提取用户名和密码。从搜索结果和漏洞库信息来看，此漏洞已被广泛利用，并存在公开的PoC。

**投毒风险分析：**
代码中存在潜在的投毒风险，尽管不明显：
1.  **`extract_user.py`中的`decrypt_password`函数：**  虽然函数本身实现了密码解密逻辑，但攻击者可能利用此函数执行其他恶意操作，但这部分风险较低。
2.  **Shodan API Key：**  恶意攻击者可以伪造一个类似的脚本，要求用户提供Shodan API Key，然后使用该Key进行恶意扫描活动。
3.  **dump函数：** 提取的用户密码直接输出到屏幕，存在一定风险。恶意使用者可以修改这部分输出的代码，将抓取的数据发送到恶意服务器。
4.  **`HackRouter`函数：** 连接目标设备并发送特定的字节序列。这些字节序列是漏洞利用的核心，但恶意使用者可能修改序列，进行其他恶意操作，例如尝试写入恶意文件。
   根据现有代码分析，`MikroRoot.py`主要功能依赖于从目标设备中提取敏感信息。虽然脚本本身看起来是用来进行渗透测试的工具，但潜在的滥用风险依然存在，代码中并无明显的后门代码，判定投毒风险为10%。

**利用方式分析：**
1.  **Shodan搜索：** 使用Shodan API找到暴露在公网上的MikroTik路由器。
2.  **漏洞触发：**  通过8291端口（Winbox接口）向目标设备发送特制的请求，利用目录遍历漏洞读取 `/flash/rw/store/user.dat` 文件。
3.  **数据提取：** 从读取的文件中提取加密的用户名和密码。
4.  **密码解密：** 使用内置的解密算法解密提取的密码。
5.  **权限提升/控制：** 利用获得的用户名和密码登录设备，进行进一步的攻击，例如修改配置或安装恶意软件。根据搜索引擎结果的信息，该漏洞可能被用于安装恶意软件并形成僵尸网络。
总的来说，该漏洞利用方式较为直接，通过目录遍历读取用户数据库文件并解密，从而获取设备的控制权。

**项目地址:** [syrex1013/MikroRoot](https://github.com/syrex1013/MikroRoot)

**漏洞详情:** [CVE-2018-14847](https://nvd.nist.gov/vuln/detail/CVE-2018-14847)