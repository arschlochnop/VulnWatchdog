## CVE-2019-5420-Rails-远程代码执行

**漏洞编号:** CVE-2019-5420

**漏洞类型:** 远程代码执行

**影响应用:** Rails

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 5.2.2.1, < 6.0.0.beta3 (仅限开发模式)

**利用条件:** Rails应用运行在开发模式下，且攻击者可以访问应用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5420是一个Rails框架在开发模式下的远程代码执行漏洞。漏洞原因是Rails在开发模式下使用自动生成的secret token，攻击者可以通过一定手段猜测该token。获取token后，攻击者可以构造恶意cookie，利用Rails内部机制执行任意代码。 

**有效性：**

根据漏洞信息、搜索结果和POC代码，可以判定该漏洞是有效的。POC代码（CVE-2019-5420.rb）提供了利用该漏洞提升用户权限的演示，通过修改cookie中的`user_id`字段，可以将用户权限提升至管理员权限。

**投毒风险：**

查看提供的代码，CVE-2019-5420.rb 主要逻辑为：

1.  解码cookie值。
2.  使用应用程序名称生成密钥。
3.  使用密钥和解码后的cookie解密数据。
4.  修改解密后的JSON数据中的`user_id`字段。
5.  使用新的`user_id`重新加密数据生成新的cookie。

README.md 文件描述了如何使用该脚本。

综合分析来看，该POC代码的功能明确，没有发现任何隐藏的恶意代码或后门。代码的目的是演示如何利用漏洞提升权限，而不是进行恶意攻击。因此，可以认为该仓库不存在投毒风险。

**利用方式：**

1.  **环境要求：** 目标Rails应用必须运行在开发模式下，因为开发模式下secret token更容易被猜测或泄露。
2.  **获取Cookie：** 攻击者需要获取目标用户的Cookie值。
3.  **获取/猜测应用名称：** 攻击者需要知道或者猜测Rails应用程序的名称，因为secret token的生成依赖于应用名称。 如果无法直接获取，可能需要进行爆破尝试。
4.  **运行POC代码：** 攻击者将Cookie值和应用名称代入POC代码（CVE-2019-5420.rb），运行脚本。
5.  **替换Cookie：** 脚本会生成一个新的Cookie，攻击者需要将浏览器中的Cookie替换为新生成的Cookie。
6.  **权限提升：** 刷新页面后，攻击者将拥有`user_id`对应用户的权限，例如管理员权限。

**总结：**

该漏洞利用的关键在于获取secret token。在开发模式下，Rails应用的secret token通常比较弱，容易被猜测。攻击者利用猜测的token，结合Rails的cookie加密机制，可以篡改cookie中的用户信息，从而提升权限，甚至执行任意代码。


**项目地址:** [PenTestical/CVE-2019-5420](https://github.com/PenTestical/CVE-2019-5420)

**漏洞详情:** [CVE-2019-5420](https://nvd.nist.gov/vuln/detail/CVE-2019-5420)