## CVE-2018-14847 - MikroTik RouterOS WinBox Directory Traversal

**漏洞编号:** CVE-2018-14847

**漏洞类型:** 目录遍历

**影响应用:** MikroTik RouterOS WinBox

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行（通过写入恶意文件）

**影响版本:** <= 6.42

**利用条件:** 目标设备开启WinBox服务，攻击者需要能够访问目标设备的WinBox端口（默认为8291）。未授权访问即可利用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-14847 漏洞存在于 MikroTik RouterOS 的 WinBox 接口中，允许未授权的远程攻击者读取任意文件，并允许已认证的攻击者写入任意文件。该漏洞是由于 WinBox 接口中的目录遍历漏洞导致的。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。漏洞库信息明确指出未授权攻击者可以读取任意文件，而搜索引擎结果中也包含了利用该漏洞读取密码信息的案例。提供的代码 `mikrotikbeast.py` 尝试利用该漏洞读取 `/flash/rw/store/user.dat` 文件，该文件通常包含路由器用户的用户名和加密的密码。`extract_user.py` 用于解密从 `/flash/rw/store/user.dat` 文件中提取的密码。

**投毒风险：**

虽然 `mikrotikbeast.py` 脚本旨在利用 CVE-2018-14847 读取敏感文件，`extract_user.py`旨在提取账号密码，但是无法完全排除作者在代码中隐藏恶意行为的可能性，但是可能性较低。例如，可以修改 `mikrotikbeast.py` 脚本，在成功利用漏洞后，尝试下载并执行远程恶意脚本，但这不属于漏洞本身的利用，而是漏洞被利用后的一种潜在攻击方式。代码中未发现明显的后门或恶意代码，但存在一些潜在风险。 相对来说，投毒风险较低，评估为 5%。

**利用方式：**

1.  **目标扫描：** 使用 `mikrotikbeast.py` 脚本扫描指定网段内的 MikroTik 路由器，尝试连接 WinBox 端口。
2.  **漏洞触发：**  脚本构造特殊的请求，利用目录遍历漏洞读取 `/flash/rw/store/user.dat` 文件。
3.  **数据提取：** 脚本将读取到的 `user.dat` 文件内容保存。
4.  **密码解密：**  使用 `extract_user.py` 脚本和 `user.dat` 文件，解密用户的用户名和密码。

总而言之，该漏洞的利用方式是通过 WinBox 协议发送包含目录遍历payload的请求，从而读取到包含加密用户凭据的敏感文件，进而解密这些凭据以获得对设备的未授权访问。

**项目地址:** [mahmoodsabir/mikrotik-beast](https://github.com/mahmoodsabir/mikrotik-beast)

**漏洞详情:** [CVE-2018-14847](https://nvd.nist.gov/vuln/detail/CVE-2018-14847)