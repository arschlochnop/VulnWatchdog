## CVE-2024-56800-Firecrawl-SSRF

**漏洞编号:** CVE-2024-56800

**漏洞类型:** SSRF (服务器端请求伪造)

**影响应用:** Firecrawl

**危害等级:** 高危，可能导致内部网络资源泄露和访问

**影响版本:** < 1.1.1

**利用条件:** 需要能够控制 Firecrawl 的抓取目标 URL

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Firecrawl的网页抓取功能中。攻击者可以通过指定一个恶意的URL，该URL会重定向到内部IP地址，从而利用 Firecrawl 访问内部网络资源。Firecrawl 在抓取网页时没有充分验证目标 URL，导致了 SSRF 漏洞。

**有效性:**

提供的Dockerfile, README.md, server.py, CONTRIBUTING.md和LICENSE文件构成了一个完整的PoC，展示了如何利用 Firecrawl 的 SSRF 漏洞。server.py 中使用了firecrawl.FirecrawlApp(API_KEY)并调用了fc.scrape_url()函数，如果scrape_url()函数没有进行严格的URL过滤，则可能存在SSRF漏洞。Dockerfile用于构建包含漏洞版本的Firecrawl应用程序，README.md提供了运行PoC的步骤。

**投毒风险:**

分析提供的代码，主要关注以下几点：

*   **Dockerfile:**  Dockerfile 中没有任何可疑指令。它只是用于构建一个包含所需依赖项和源代码的镜像。
*   **README.md:** README 文件仅包含运行 PoC 的说明。
*   **server.py:** server.py 主要功能是调用firecrawl SDK的scrape_url方法,如果 firecrawl SDK 本身存在漏洞,那么可以利用。注意代码中既有scrape_url("http://localhost:9999")也有scrape_url("https://firecrawl.dev"),前者的存在可能是为了本地验证SSRF，但更有可能是为了让使用者在本地环境中测试，降低其在生产环境中测试导致暴露的警惕性。
*   **CONTRIBUTING.md:** CONTRIBUTING.md 文件包含了贡献指南，没有发现任何恶意代码。
*   **LICENSE:** GNU AFFERO GENERAL PUBLIC LICENSE

虽然没有明显的恶意代码，但存在一定的潜在风险：

*   **漏洞利用方向误导:** 通过展示一个简单的SSRF PoC，可能掩盖了更复杂的利用方式，甚至可能引导安全研究人员忽略更严重的问题。
*   **对firecrawl SDK 依赖：** PoC 的有效性完全取决于firecrawl SDK 本身是否存在漏洞。如果SDK代码存在问题，那么这个PoC才有效。

综合来看，投毒的可能性较低，但不能完全排除。风险主要集中在对 firecrawl SDK 的依赖以及潜在的利用方向误导。

**利用方式:**

1.  部署存在漏洞版本的 Firecrawl 应用。
2.  构造一个包含重定向到内部IP地址的恶意URL（例如：`http://example.com/redirect?url=http://169.254.169.254/latest/meta-data/`，用于访问云服务器的元数据）。
3.  将该恶意URL作为scrape_url() 的参数，触发SSRF漏洞。
4.  Firecrawl 将会请求内部IP地址，攻击者可以获取内部资源（例如：云服务器元数据、内部服务配置等）。
5.  在真实利用中，需要与域名解析欺骗等其他技术结合，扩大攻击范围，例如，指向内网域名的域名服务器地址记录指向攻击者控制的服务器，诱导服务请求恶意域名。
6.  如果Firecrawl运行在云环境中，可能造成更大的影响。

**项目地址:** [cyhe50/cve-2024-56800-poc](https://github.com/cyhe50/cve-2024-56800-poc)

**漏洞详情:** [CVE-2024-56800](https://nvd.nist.gov/vuln/detail/CVE-2024-56800)