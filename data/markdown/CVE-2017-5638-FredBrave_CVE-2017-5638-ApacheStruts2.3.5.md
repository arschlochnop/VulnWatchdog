## CVE-2017-5638-Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x (before 2.3.32), 2.5.x (before 2.5.10.1)

**利用条件:** 需要目标服务器运行存在漏洞版本的Apache Struts2，且允许HTTP请求

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-5638 是一个 Apache Struts2 的远程代码执行漏洞，存在于 Jakarta Multipart parser 中。由于不正确的异常处理和错误消息生成，攻击者可以通过构造恶意的 Content-Type、Content-Disposition 或 Content-Length HTTP 头来执行任意命令。从漏洞库信息、搜索引擎结果和提供的漏洞利用代码来看，该漏洞利用的有效性非常高，因为在2017年3月已经被广泛利用。漏洞利用代码中的`CVE-2017-5638ApacheStruts.py`脚本通过构造包含OGNL表达式的Content-Type头来触发漏洞，从而执行任意命令。利用方式是通过发送一个精心构造的HTTP请求，其中Content-Type头包含一个OGNL表达式，该表达式允许攻击者执行任意系统命令。

**有效性:**
根据漏洞库信息、搜索结果和提供的POC代码，此漏洞的有效性非常高，且POC代码能够复现。

**投毒风险:**
POC代码主要功能是发送恶意请求并执行命令。虽然存在一定的风险（例如，命令执行不当导致系统不稳定），但不存在明显的恶意投毒代码。代码结构较为清晰，主要包含参数解析、payload生成和请求发送三个部分。代码中可能的风险点在于，攻击者可以利用此代码执行任意命令，因此存在滥用的风险。但代码本身的功能是为了验证漏洞，并无主动传播恶意代码的功能。我给出的投毒风险评估为5%，主要考虑是：

*   代码作者可能会在代码中添加一些隐藏的后门代码，例如，收集目标服务器的信息并发送到攻击者的服务器，或者在目标服务器上安装恶意软件。
*   代码用户可能会在使用代码时，不小心执行了恶意命令，从而导致系统被入侵。

**利用方式:**
1.  **目标确定:** 确定目标服务器上运行的Apache Struts2版本是否在受影响范围内（2.3.x before 2.3.32 或 2.5.x before 2.5.10.1）。
2.  **Payload构造:** 使用POC代码中的`creating_payload`函数构造包含恶意命令的OGNL表达式payload。 例如：要执行 `whoami` 命令，使用 `-c whoami` 参数。
3.  **请求发送:** 使用POC代码中的`execute`函数，将构造好的payload作为Content-Type头的值，发送HTTP请求到目标服务器的`.action`文件。POC代码会打印命令执行的结果。
4.  **结果分析:** 分析命令执行的结果，判断漏洞是否成功利用。

总而言之，该漏洞利用代码的有效性高，但存在较低的投毒风险。使用时务必谨慎，并确保在授权的环境下进行。


**项目地址:** [FredBrave/CVE-2017-5638-ApacheStruts2.3.5](https://github.com/FredBrave/CVE-2017-5638-ApacheStruts2.3.5)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)