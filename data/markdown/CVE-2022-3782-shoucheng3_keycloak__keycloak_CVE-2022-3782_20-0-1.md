## CVE-2022-3782 - Keycloak Path Traversal via Double URL Encoding

**漏洞编号:** CVE-2022-3782

**漏洞类型:** 路径遍历

**影响应用:** Keycloak

**危害等级:** 高危，可能导致信息泄露和未授权访问

**影响版本:** <= 20.0.2

**利用条件:** 客户端配置了包含通配符的Valid Redirect URIs

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-3782 漏洞存在于 Keycloak 中，由于其未正确验证重定向 URL，攻击者可利用双重 URL 编码绕过验证，访问其他 URL 和潜在的敏感信息。该漏洞影响任何在 Valid Redirect URIs 字段中使用通配符的客户端。根据搜索引擎结果，漏洞的根本原因是重定向 URI 验证中的不当 URL 解码处理。漏洞利用代码显示的是 Keycloak 项目的贡献者和适配者信息，与漏洞的利用没有直接关系，初步判断为无关文件。但是，这些文件可能被用来进行社会工程攻击，例如冒充贡献者或者利用适配者信息进行钓鱼攻击。因此，存在极低的投毒风险，大约为10%。漏洞利用方式：攻击者构造恶意请求，其中包含双重 URL 编码的路径遍历payload作为重定向URI，例如 `https://example.com/%%2e%2e/%%2e%2e/sensitive/file`，Keycloak 未能正确解码并验证此 URL，导致攻击者绕过重定向URI的限制访问了服务器上的任意文件。

**风险评估：**该漏洞为高危漏洞，利用成功可导致敏感文件泄露，甚至可能通过读取配置文件获取数据库连接等敏感信息，进一步扩大攻击范围。

**修复建议：**升级 Keycloak 到不受影响的版本，并避免在 Valid Redirect URIs 字段中使用通配符。对所有重定向 URL 进行严格的验证和过滤，防止路径遍历攻击。

**项目地址:** [shoucheng3/keycloak__keycloak_CVE-2022-3782_20-0-1](https://github.com/shoucheng3/keycloak__keycloak_CVE-2022-3782_20-0-1)

**漏洞详情:** [CVE-2022-3782](https://nvd.nist.gov/vuln/detail/CVE-2022-3782)