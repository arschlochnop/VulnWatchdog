## CVE-2020-0796 (SMBGhost)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Server Message Block 3.1.1 (SMBv3)

**危害等级:** 高危，可能导致远程代码执行和系统崩溃

**影响版本:** Windows 10 Version 1903/1909, Windows Server, version 1903/1909 (Server Core installation)

**利用条件:** 目标系统开启SMB服务 (445端口), 且未安装相应的安全补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796，又名SMBGhost，是一个存在于Microsoft SMBv3协议处理特定请求方式中的远程代码执行漏洞。漏洞位于SMBv3压缩功能中，未正确处理压缩数据包，导致内存破坏，攻击者可以通过发送特制的SMBv3数据包触发该漏洞，实现在目标系统上的远程代码执行。根据提供的漏洞利用代码 `poc-and-scan.py`，此PoC包含扫描和崩溃两种模式。扫描模式检测目标主机是否存在漏洞，崩溃模式则发送畸形数据包尝试使目标系统崩溃。

**有效性:**
根据搜索结果和提供的漏洞利用代码，此漏洞是有效的，并且存在公开可用的PoC。

**投毒风险:**
`poc-and-scan.py`脚本首先进行IP地址有效性校验，避免在公网上进行测试，具备一定的安全性考虑。脚本的功能相对简单，包括SMB协商和发送畸形数据包。虽然代码本身看起来没有明显的恶意代码，但是仍然存在一定的投毒风险。例如，

1.  **依赖风险:**  PoC 依赖 Python3，如果用户使用的 Python3 环境被污染，则可能受到攻击。
2.  **拒绝服务:**  崩溃模式旨在使目标系统崩溃，如果被恶意利用，可能造成拒绝服务攻击。

因此，综合判断投毒风险为10%。

**利用方式:**

1.  **扫描:**  PoC首先发送SMB协商数据包，检测目标系统是否支持SMBv3协议以及是否启用了LZNT1压缩算法。
2.  **触发漏洞:** 如果目标系统满足漏洞条件，PoC会发送一个畸形的压缩数据包，该数据包中包含了精心构造的长度字段，导致SMBv3在处理压缩数据时发生缓冲区溢出，从而触发远程代码执行或系统崩溃。

该PoC的利用方式相对直接，通过发送畸形数据包触发漏洞。

**项目地址:** [ran-sama/CVE-2020-0796](https://github.com/ran-sama/CVE-2020-0796)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)