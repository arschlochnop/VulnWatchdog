## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可完全控制受影响的服务器

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+, Tomcat作为WAR部署，使用Spring MVC或Spring WebFlux。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22965 (Spring4Shell) 是一个在 Spring Framework 中发现的远程代码执行漏洞。攻击者可以通过数据绑定，操纵某些属性来执行任意代码。根据漏洞库信息和搜索结果，漏洞利用的有效性较高，特别是针对使用JDK 9+并以WAR包形式部署在Tomcat上的Spring应用。

**利用方式：**

1.  **利用条件:**  需要满足以下条件：
    *   运行在 JDK 9 或更高版本。
    *   Spring MVC 或 Spring WebFlux 应用。
    *   部署为 Tomcat WAR 包。
    *   使用受影响的 Spring Framework 版本 (5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+)。
2.  **漏洞原理:** 通过操纵 `class.module.classLoader.resources.context.parent.pipeline.first.pattern` 属性，修改Tomcat的日志配置，写入webshell到可访问的目录。
3.  **利用步骤:**
    *   发送恶意构造的HTTP请求，包含精心设计的参数，以修改Tomcat的日志设置，将日志输出到Web可访问的目录。
    *   日志内容包含恶意代码，例如JSP webshell。
    *   通过访问webshell的URL，执行任意命令。

提供的漏洞利用代码 (`spring4shell.py`) 旨在自动化上述过程。

**投毒风险分析：**

提供的Python脚本`spring4shell.py`主要功能是利用CVE-2022-22965漏洞，通过修改Tomcat日志配置写入webshell，从而实现远程代码执行。虽然该脚本本身是为了攻击利用而编写的，但仍然存在潜在的投毒风险，尤其是在使用者直接下载并使用未经仔细审查的代码时。

具体分析如下：

*   **风险点1：**  脚本中可能会包含恶意代码，例如植入后门、收集敏感信息并外传等。虽然目前的代码片段看起来相对直接，主要关注漏洞利用，但攻击者可以很容易地添加额外的恶意功能。
*   **风险点2：**  该脚本依赖于第三方库 (`requests`, `bs4`)，这些库本身可能存在安全漏洞，或者被攻击者替换为恶意版本。虽然`pip3 install bs4` 和 `pip3 install requests`  是安装常用库，但如果源被劫持，可能会安装恶意版本。
*   **风险点3：**  脚本中的默认参数，例如webshell的文件名、密码、上传目录等，可能被攻击者利用。如果攻击者能够预测或控制这些参数，就可以更容易地进行后续攻击。

由于存在以上潜在风险，在使用任何公开的漏洞利用代码之前，都必须进行彻底的安全审查，确保代码的安全性和可靠性。此外，建议修改默认参数，增加攻击难度。

**投毒风险评估：**
考虑到代码功能相对集中于漏洞利用，且作者也给出了GitHub地址，初步判断投毒的可能性较低，但不能完全排除。综合评估，投毒风险为10%。这个概率考虑到作者可能隐藏恶意代码，或者将来代码仓库被入侵后植入恶意代码的情况。

**项目地址:** [guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965](https://github.com/guigui237/Expoitation-de-la-vuln-rabilit-CVE-2022-22965)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)