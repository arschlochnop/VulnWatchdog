## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** 1.9.14 - 1.9.17 (不含1.9.17p1)

**利用条件:** 本地用户需要存在并且Sudo版本符合漏洞影响范围

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-32463是Sudo中一个本地提权漏洞，利用了`--chroot`选项的不安全使用。攻击者可以创建一个恶意`nsswitch.conf`文件，通过`sudo -R`选项，使得Sudo在chroot环境中加载该文件。当Sudo尝试解析用户和组信息时，会加载攻击者控制的共享库(本例中为`libnss_/lower.so.2`)。该共享库在加载时执行，通过`setreuid(0, 0)`和`setregid(0, 0)`将当前进程的UID和GID设置为0（root），从而获得root权限，最后通过`execl("/bin/bash", "/bin/bash", NULL)`启动一个root shell。

**漏洞利用有效性分析:**

提供的POC代码使用Dockerfile构建了一个包含漏洞版本的Sudo（1.9.16p2）的Ubuntu 24.04环境，然后将poc.sh脚本复制到测试用户的主目录并赋予执行权限。POC脚本会创建一个临时目录，并在该目录中生成恶意的`nsswitch.conf`和共享库`libnss_/lower.so.2`，然后利用`sudo -R`选项触发漏洞，最后删除临时目录。根据漏洞描述和POC代码，该漏洞利用是有效的，可以在本地提升权限。

**投毒风险分析:**

Dockerfile中，从官方源下载Sudo源码，并进行编译安装，Dockerfile下载链接地址没有问题。
poc.sh脚本中，主要的操作是创建目录，创建C代码并编译，生成恶意配置文件，执行sudo命令。脚本本身没有明显的恶意代码，也没有连接任何外部网络或者下载不明文件，因此投毒风险较低，但仍然存在一定风险，例如作者可能在C代码中插入不易察觉的后门。
综合评估，投毒风险约为1%。

**利用方式总结:**

1.  **环境准备:** 需要一个存在漏洞版本的Sudo的Linux环境 (1.9.14 - 1.9.17，不包括1.9.17p1).
2.  **构造恶意文件:**  创建一个包含恶意配置的`nsswitch.conf`文件，指向攻击者控制的共享库。
3.  **编译共享库:**  编写一个共享库，该库在加载时执行提权操作（设置UID/GID为0并启动shell）。
4.  **利用`sudo -R`触发漏洞:** 使用`sudo -R <攻击者控制的目录>`，Sudo将会以chroot环境运行，并加载攻击者构造的`nsswitch.conf`文件，从而加载恶意共享库并提权。

**项目地址:** [lowercasenumbers/CVE-2025-32463_sudo_chroot](https://github.com/lowercasenumbers/CVE-2025-32463_sudo_chroot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)