## CVE-2022-30190 (Follina)

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能导致远程代码执行，权限提升，数据泄露

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 用户需要打开恶意文档（例如Word），或者点击恶意链接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190，又名Follina，是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT)中的远程代码执行漏洞。该漏洞的利用方式如下：

1.  **攻击媒介：** 攻击者可以创建一个恶意的Microsoft Office文档（如Word），或者通过其他方式诱使用户点击一个特制的URL链接。
2.  **漏洞触发：** 当用户打开恶意文档或点击恶意链接时，MSDT会通过`ms-msdt:` URL协议被调用。
3.  **远程模板注入：** 恶意文档利用Word的远程模板功能，从远程服务器检索HTML文件。该HTML文件中包含恶意的JavaScript代码。
4.  **代码执行：** 嵌入在HTML中的JavaScript代码构造一个MSDT协议URL，该URL利用`PCWDiagnostic`参数来执行任意命令。
5.  **有效性：** 提供的Python脚本 `payload.py` 用于生成包含恶意命令的HTML payload。脚本首先将要执行的命令进行Base64编码，然后将其嵌入到一个特制的HTML脚本中，该脚本利用了`ms-msdt:` 协议。该POC代码看起来是有效的，可以生成利用此漏洞的payload。
6.  **投毒风险：** 提供的POC仓库主要包含生成Payload的脚本，脚本目的是使用Invoke-Expression执行base64编码的命令,虽然脚本本身没有明显的恶意代码，但存在以下投毒风险：
    * 依赖风险：Payload生成脚本依赖base64编码技术，攻击者有可能通过修改解码后的命令来实现恶意行为。
    * 载荷风险：Payload最终会执行PowerShell命令，这为执行恶意载荷提供了机会。攻击者可以嵌入各种恶意代码，如反向Shell、文件下载执行等。
    * 脚本来源风险： 虽然脚本声称来源于JohnHammond的GitHub仓库，但是有被篡改的风险，需要人工审核确认。
    因此，综合评估，该仓库中存在一定投毒风险, 估计占比10%。主要风险集中在使用者在使用payload时可能引入恶意代码。
7.  **缓解措施：**
    *   禁用MSDT URL协议。
    *   安装Microsoft提供的安全更新。
    *   使用威胁检测工具来识别和阻止利用此漏洞的攻击。

总体而言，CVE-2022-30190是一个严重的安全漏洞，攻击者可以利用它在受影响的系统上执行任意代码。用户应尽快采取措施来缓解此漏洞带来的风险。

**项目地址:** [alien-keric/CVE-2022-30190](https://github.com/alien-keric/CVE-2022-30190)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)