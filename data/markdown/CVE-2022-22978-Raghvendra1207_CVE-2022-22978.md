## CVE-2022-22978 - Spring Security Authorization Bypass

**漏洞编号:** CVE-2022-22978

**漏洞类型:** 授权绕过

**影响应用:** Spring Security

**危害等级:** 高危，可能导致未经授权的访问

**影响版本:** Spring security versions 5.4.x prior to 5.4.11+, 5.5.x prior to 5.5.7+, 5.6.x prior to 5.6.4+ and all earlier unsupported versions

**利用条件:** 应用程序使用了RegexRequestMatcher，并且正则表达式中包含`.`

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22978 漏洞存在于Spring Security的RegexRequestMatcher中。当使用RegexRequestMatcher并且正则表达式包含`.`时，攻击者可以通过在URL中插入换行符（\r或\n，编码为%0d或%0a）来绕过授权验证。提供的PoC代码通过创建一个简单的Spring Boot应用程序，配置Spring Security来保护/admin/*路径，并使用存在漏洞的版本来演示如何通过插入%0d或%0a绕过身份验证。 

**有效性：** PoC代码有效，可以重现漏洞。

**投毒风险：** 仔细分析PoC代码后，发现其主要目的是为了演示漏洞，并无明显的恶意代码。但是，由于gradle脚本存在远程依赖的风险，且demo中使用了特定的spring security版本。作者可能存在隐藏的投毒代码或依赖后门，例如通过恶意依赖项植入，考虑到漏洞利用的便捷性，以及spring框架的安全性，投毒风险相对较低。 此处将风险设置为10%。

**利用方式：** 
1. 应用程序使用Spring Security，并且使用了RegexRequestMatcher进行URL匹配。
2. RegexRequestMatcher中的正则表达式包含`.`。
3. 攻击者构造包含%0d或%0a的URL，例如/admin/%0dxyz，绕过身份验证，访问受保护的资源。

**项目地址:** [Raghvendra1207/CVE-2022-22978](https://github.com/Raghvendra1207/CVE-2022-22978)

**漏洞详情:** [CVE-2022-22978](https://nvd.nist.gov/vuln/detail/CVE-2022-22978)