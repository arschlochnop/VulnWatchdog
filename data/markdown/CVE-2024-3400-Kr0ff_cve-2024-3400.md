## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以在防火墙上以 root 权限执行任意代码

**影响版本:** PAN-OS 10.2（低于 10.2.9-h1）、11.0（低于 11.0.4-h1）和 11.1（低于 11.1.2-h3）

**利用条件:** 目标系统需要配置 GlobalProtect 网关或 GlobalProtect 门户

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞。由于任意文件创建漏洞，未经身份验证的攻击者可以利用此漏洞在受影响的防火墙上以 root 权限执行任意代码。

**有效性：**
提供的 PoC 代码似乎有效。漏洞库信息和搜索结果都表明该漏洞已被积极利用，并且存在公开的 PoC。该PoC代码包含check模块，可以验证目标是否存在漏洞，exploit模块可以执行命令。

**投毒风险：**
该 PoC 代码的投毒风险较低 (0%)。代码相对简单，主要是利用请求进行漏洞验证和利用。没有发现明显的恶意或隐藏行为，例如下载和执行任意二进制文件、修改系统文件或安装后门。

**利用方式：**
1.  **漏洞触发：** 漏洞存在于GlobalProtect组件中，通过构造特殊的HTTP请求触发。该漏洞允许攻击者创建任意文件。
2.  **命令注入：** 攻击者利用任意文件创建漏洞进行命令注入，以执行恶意代码。
3.  **权限提升：** 成功利用该漏洞后，攻击者可以在目标系统上获得 root 权限。

**PoC 利用方式分析：**
*   **check 模块：**  检查目标是否容易受到攻击。
    *   它使用特制的 Cookie 发送 POST 请求到 `/ssl-vpn/hipreport.esp` 端点。Cookie 包含路径遍历序列，旨在访问 web 服务器文档目录之外的文件。
    *   如果请求返回状态代码 200，则脚本会尝试使用不包含 Cookie 的单独 GET 请求来访问服务器上使用 Cookie 值中指定的文件名构造的路径。 如果此 GET 请求返回状态代码 403（禁止），则目标被认为是易受攻击的。
*   **exploit 模块：** 利用漏洞执行命令。
    *   它通过构造带有恶意 Cookie 的HTTP POST请求到 `/ssl-vpn/hipreport.esp` 端点，触发命令执行。Cookie 包含命令注入payload，该payload将执行任意命令。
    *   该脚本使用`${IFS}`绕过空格过滤。
    *   该脚本尝试通过HTTP和HTTPS发送请求。

**缓解措施：**
建议立即升级到 PAN-OS 的固定版本，即使已应用解决方法和缓解措施。 该问题已在 PAN-OS 10.2.9-h1、PAN-OS 11.0.4-h1、PAN-OS 11.1.2-h3 以及所有更高版本的 PAN-OS 中得到修复。

**项目地址:** [Kr0ff/cve-2024-3400](https://github.com/Kr0ff/cve-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)