## CVE-2021-25646-Apache Druid 远程代码执行

**漏洞编号:** CVE-2021-25646

**漏洞类型:** 远程代码执行

**影响应用:** Apache Druid

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 0.20.0

**利用条件:** 需要目标Druid实例版本小于等于0.20.0，且攻击者需要具备一定的权限（authenticated user）。但根据搜索结果，在某些默认配置下，可能无需认证即可利用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-25646 允许认证用户通过构造特制的请求，绕过服务器配置，执行用户提供的 JavaScript 代码，从而实现远程代码执行。该漏洞存在于 Apache Druid 0.20.0 及更早版本中。根据提供的漏洞利用代码，该POC是一个用Go语言编写的利用工具，允许检测目标是否存在漏洞，并且可以执行命令，甚至反弹shell。

**有效性分析：**
漏洞库信息明确指出该漏洞的存在，并提供了修复方案（升级到0.20.1或更高版本）。搜索引擎结果中也包含了多个关于该漏洞的分析和利用文章，证明了该漏洞的真实性和可利用性。提供的POC代码包含漏洞检测和利用功能，从其README中的演示图片来看，该POC能够成功执行命令和反弹shell，表明其具有较高的有效性。

**投毒风险分析：**
检查POC代码，主要是 `main.go` 和 `druid/druid.go` (未提供具体内容，假设存在)，可以判断该工具是否包含恶意代码。当前给出的代码片段相对简单，主要功能是漏洞利用。由于代码使用Go语言编写，需要编译后才能执行，相比脚本语言，直接植入恶意代码的风险较低。`go.mod` 和 `go.sum` 文件列出了依赖项，可以审查这些依赖项是否存在已知的安全问题。 `color` 库看起来是用于终端输出着色的，风险较低。总体来看，直接投毒的可能性较低，风险估计为10%。

**利用方式：**
1.  **身份验证：** 某些情况下，需要首先通过身份验证获取访问权限。但根据一些搜索结果（如attackerkb.com），在默认配置下，可能无需身份验证。
2.  **构造恶意请求：** 构造包含恶意 JavaScript 代码的 HTTP 请求。根据 thezdi.com 的描述，该请求包含精心构造的 JSON 数据。
3.  **发送请求：** 将构造好的请求发送到 Druid 服务器。
4.  **执行代码：** Druid 服务器解析请求，执行嵌入的 JavaScript 代码，从而实现远程代码执行。
5.  **命令执行/反弹Shell：** 漏洞利用成功后，攻击者可以在服务器上执行任意命令，例如反弹 shell，从而完全控制服务器。

**项目地址:** [k7pro/CVE-2021-25646-exp](https://github.com/k7pro/CVE-2021-25646-exp)

**漏洞详情:** [CVE-2021-25646](https://nvd.nist.gov/vuln/detail/CVE-2021-25646)