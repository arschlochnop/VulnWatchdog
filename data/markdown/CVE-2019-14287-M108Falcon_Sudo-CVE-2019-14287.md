## CVE-2019-14287-Sudo权限绕过

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许普通用户以root权限执行命令

**影响版本:** < 1.8.28

**利用条件:** 需要用户具有sudo权限，但sudoers配置禁止以root身份执行命令（例如 !root 配置）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-14287漏洞允许具有Runas ALL权限的sudoer账户绕过某些策略黑名单和会话PAM模块，并可能导致不正确的日志记录。该漏洞通过使用一个构造的用户ID来调用sudo，例如 `sudo -u \#$((0xffffffff))` 或 `sudo -u#-1`。这会绕过诸如 `!root` 配置，并允许用户以root身份执行命令，即使sudoers文件明确禁止这样做。

**有效性评估：**

根据漏洞描述、搜索结果（如Exploit-DB上的exploit）和提供的POC代码，此漏洞的利用是有效的，特别是在Sudo版本低于1.8.28的系统上。

提供的Python脚本`sudo-exploit.py`尝试确定当前用户的权限，提取允许执行的二进制文件，然后尝试使用`-u#-1`选项以root权限执行它们。Bash脚本`sudo-exploit.sh`检查用户是否具有sudo权限，并验证Sudo版本是否易受攻击。如果易受攻击，它将尝试使用`-u#-1`选项执行用户可以sudo执行的命令。

**投毒风险分析：**

对提供的Python和Bash脚本进行分析后，未发现明显的恶意或投毒代码。脚本的主要目的是验证和利用CVE-2019-14287漏洞。这些脚本旨在检查用户的sudo权限、sudo版本，并尝试利用该漏洞执行命令。因此，投毒风险评估为0%。

**利用方式：**

1.  **前提条件：** 攻击者必须具有sudo权限，并且sudoers文件必须允许攻击者运行命令，但明确禁止以root身份运行（例如，使用`!root`）。
2.  **绕过限制：** 攻击者使用`sudo -u \#$((0xffffffff))` 或 `sudo -u#-1`命令，其中`\#$((0xffffffff))` 或 `-1` 被Sudo错误地解释为一个用户ID，从而绕过了`!root`的限制和其他安全策略。
3.  **执行命令：** 通过绕过限制，攻击者可以以root权限执行任意命令。
4.  **漏洞修复：** 升级Sudo到1.8.28或更高版本可以修复此漏洞。

**项目地址:** [M108Falcon/Sudo-CVE-2019-14287](https://github.com/M108Falcon/Sudo-CVE-2019-14287)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)