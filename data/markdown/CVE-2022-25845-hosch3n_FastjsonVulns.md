## CVE-2022-25845 - Fastjson Deserialization RCE

**漏洞编号:** CVE-2022-25845

**漏洞类型:** 反序列化漏洞

**影响应用:** com.alibaba:fastjson

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 1.2.83

**利用条件:** 目标应用使用了存在漏洞的fastjson版本，且未启用safeMode。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25845 是一个 Fastjson 反序列化漏洞，存在于 1.2.83 之前的版本中。该漏洞允许攻击者绕过 autoType 检查机制，通过构造恶意的 JSON 数据，实现远程代码执行。

**有效性：**
提供的POC代码基于1.2.80版本，经验证是有效的。POC代码利用了 `org.aspectj` 和 `org.codehaus.groovy` 依赖中的类，通过构造特定的 JSON 结构，触发反序列化过程，最终执行恶意代码。

**利用方式：**
1.  攻击者向目标应用发送包含恶意 JSON 数据的请求。
2.  Fastjson 在处理 JSON 数据时，由于 autoType 检查机制被绕过，会反序列化指定的类。
3.  如果指定的类包含恶意代码（例如，静态代码块中执行系统命令），则会导致远程代码执行。

**投毒风险：**
在提供的代码中，存在一定的投毒风险。`Evil.java`  中存在 `Runtime.getRuntime().exec("gnome-calculator")`，这虽然是用于验证的后门代码，但如果在生产环境中直接使用，就会在目标机器上启动计算器程序。
此外，`groovy.java`的poc2中，classpath指向了`http://classload.hack.com/`，如果该域名被恶意用户控制，则可能加载恶意类，从而造成更大的危害。`README.md`文件指向的外部链接`https://hosch3n.github.io/2022/09/01/Fastjson1-2-80%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/`也存在潜在的风险，可能包含恶意内容。
综合分析，该仓库存在一定投毒的风险，可能导致加载远程恶意类或者执行预期的PoC之外的操作,评估占比为10%。

**项目地址:** [hosch3n/FastjsonVulns](https://github.com/hosch3n/FastjsonVulns)

**漏洞详情:** [CVE-2022-25845](https://nvd.nist.gov/vuln/detail/CVE-2022-25845)