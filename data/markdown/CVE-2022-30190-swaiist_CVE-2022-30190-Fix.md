## CVE-2022-30190-MSDT远程代码执行

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能允许攻击者在受害者系统上执行任意代码

**影响版本:** 受影响的Windows版本，详见漏洞库信息

**利用条件:** 用户需要打开包含恶意链接或文件的文档

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-30190（又名Follina）是一个远程代码执行漏洞，存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中。攻击者可以利用此漏洞通过精心构造的恶意文档（例如Word文档）或通过URL协议调用MSDT来执行任意代码。当用户打开包含恶意链接或文件的文档时，该漏洞会被触发。根据搜索结果，攻击者利用Word的远程模板功能从远程服务器检索HTML文件，然后利用MSDT执行代码。提供的PoC代码中，execute.bat脚本首先备份 `HKEY_CLASSES_ROOT\ms-msdt` 注册表项到桌面上的`backup-for-msdt`文件中，然后删除该注册表项。restore.bat脚本则将备份的注册表项导入回来。这两个脚本本身并不会执行任何恶意代码，而是用于删除和恢复MSDT的注册表关联，通常是利用流程的一部分，用于绕过某些缓解措施或用于测试。因此，仓库本身提供的PoC代码没有发现作者隐藏的投毒代码。

**有效性：**
根据漏洞描述和搜索结果，以及PoC涉及的操作，该PoC代码是漏洞利用链的一部分，主要用于修改MSDT的注册表关联。结合其他步骤（例如，通过Word远程模板下载恶意HTML），可以实现远程代码执行。

**利用方式：**
1.  攻击者创建一个包含恶意链接或嵌入恶意OLE对象的文档（例如Word文档）。
2.  当用户打开文档时，Word会尝试从远程服务器加载HTML文件（通过远程模板功能）。
3.  恶意HTML文件利用`ms-msdt:` URL协议调用MSDT。
4.  MSDT被触发，执行HTML文件中包含的恶意代码。
5.  攻击者可以利用该漏洞在受害者系统上执行任意命令。  提供的PoC 代码中的`execute.bat` 通过删除`HKEY_CLASSES_ROOT\ms-msdt` 注册表关联，在恢复前，可能允许攻击者控制MSDT的行为或执行流程。`restore.bat`脚本用于恢复该关联，在攻击之后清理环境。

**投毒风险评估：**
PoC 代码本身主要用于注册表操作，没有发现明显的恶意代码。但是，由于PoC通常需要结合其他恶意文件（例如HTML或Word文档）才能完成攻击，因此，投毒风险主要存在于这些其他组件中。但是仅从提供的bat文件来判断，投毒风险较低。

**项目地址:** [swaiist/CVE-2022-30190-Fix](https://github.com/swaiist/CVE-2022-30190-Fix)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)