## CVE-2020-0688 - Microsoft Exchange Server 远程代码执行

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/15, 2019 CU3/4

**利用条件:** 需要Exchange服务器的OWA或ECP接口可访问，并具有有效的Exchange用户凭据

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688 漏洞是 Microsoft Exchange Server 在处理内存中对象时，由于未能正确处理反序列化数据而导致的远程代码执行漏洞。该漏洞存在于 Exchange Control Panel (ECP) 组件中，攻击者可以利用静态密钥对 ViewState 进行恶意构造，从而在服务器上执行任意代码。

**有效性：**
提供的 Python POC 代码 `CVE-2020-0688_EXP.py` 是有效的。该脚本通过以下步骤利用该漏洞：

1.  **身份验证：** 使用提供的用户名和密码尝试登录 Exchange 的 OWA 接口。通过模拟用户登录过程，获取有效的 `ASP.NET_SessionId` Cookie，并获取 `__VIEWSTATEGENERATOR` 的值 (如果获取不到, 使用默认值).
2.  **Payload 生成：** 使用 `ysoserial.exe` 工具生成恶意的 ViewState payload。该 payload 包含攻击者想要执行的命令。POC 脚本使用了 TextFormattingRunProperties gadget。
3.  **Payload 注入：** 将生成的 payload 注入到 ECP 的 `default.aspx` 页面的 `__VIEWSTATE` 参数中，通过 GET 请求发送到服务器。
4.  **代码执行：** 如果服务器存在漏洞，并且 payload 构造正确，服务器将反序列化恶意的 ViewState payload，从而执行攻击者指定的命令。

**投毒风险：**
虽然该 POC 代码的主要功能是漏洞利用，但仍然存在一些潜在的投毒风险，风险评估为10%。

*   **依赖 ysoserial：** 该 POC 依赖于外部工具 `ysoserial.exe` 来生成 payload。攻击者可能会修改 `ysoserial.exe`，使其在生成 payload 的同时执行恶意操作，例如植入后门或收集敏感信息。用户需要从可信的来源下载 `ysoserial.exe`，并验证其完整性。

**利用方式：**
利用 CVE-2020-0688 漏洞的步骤如下：

1.  **获取凭据：** 攻击者需要获取有效的 Exchange 用户凭据。这可以通过钓鱼、密码猜测或利用其他漏洞来实现。
2.  **确定目标：** 攻击者需要确定目标 Exchange 服务器的 OWA 或 ECP URL。
3.  **生成 Payload：** 攻击者需要使用 `ysoserial.exe` 工具生成恶意的 ViewState payload，其中包含要执行的命令。
4.  **发送请求：** 攻击者需要将生成的 payload 注入到 ECP 的 `default.aspx` 页面的 `__VIEWSTATE` 参数中，通过 GET 请求发送到服务器。
5.  **执行代码：** 如果服务器存在漏洞，将执行攻击者指定的命令。

**项目地址:** [Yt1g3r/CVE-2020-0688_EXP](https://github.com/Yt1g3r/CVE-2020-0688_EXP)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)