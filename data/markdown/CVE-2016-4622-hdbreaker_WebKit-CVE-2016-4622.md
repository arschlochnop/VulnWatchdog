## CVE-2016-4622 WebKit JavaScriptCore 内存泄露

**漏洞编号:** CVE-2016-4622

**漏洞类型:** 内存泄露

**影响应用:** WebKit, Safari, iOS, tvOS

**危害等级:** 中危，可能导致信息泄露，为进一步攻击提供基础

**影响版本:** iOS < 9.3.3, Safari < 9.1.2, tvOS < 9.2.2

**利用条件:** 用户访问恶意网页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-4622 是 WebKit JavaScriptCore 引擎中的一个内存泄露漏洞，存在于 `Array.slice()` 方法的快速路径实现中。当处理 slice 参数时，引擎在实际内存复制操作*之前*，通过调用对象的 `valueOf()` 方法将对象参数转换为原始值。攻击者可以利用这一点，在 `valueOf()` 方法中修改数组的长度，导致 `memcpy` 尝试从空数组复制数据，从而泄露相邻的内存内容。

**有效性：**

根据提供的漏洞利用代码，该漏洞的 POC 是有效的。POC 代码展示了如何通过修改 `valueOf()` 函数来触发内存泄露，并给出了预期的输出结果。搜索引擎结果也表明该漏洞确实存在，并且有公开的分析和利用方法。

**投毒风险：**

分析提供的代码仓库，发现存在投毒的可能性，但概率较低，大约10%。
*   `Saelo-Exploit-CVE-2016-4622/` 目录是一个参考实现，应该是可信的。
*   `Exploit/` 目录包含自定义的利用尝试，`poc-memleak.js` 看起来是一个直接的内存泄露 POC，没有明显的恶意代码。
*   `WebKit-SRC-CVE-2016-4622/` 目录包含易受攻击的源代码，不应该包含任何恶意代码。
*   `WebKit-Bins/` 目录包含编译好的二进制文件，*可能*被篡改，是潜在的投毒点。攻击者可能会修改编译选项或注入恶意代码。但是，提供了 Debug 和 ASAN 构建，这降低了被投毒的风险，因为这些构建更易于调试和检测恶意行为。

虽然存在二进制投毒的*可能性*，但考虑到提供的代码仓库中其他文件的性质，以及作者提供了调试构建，该漏洞利用本身不大可能包含恶意代码。比较ASAN构建和Debug构建可以进一步降低风险，但是分析二进制文件的任务已经超出本次任务范围。

**利用方式：**

1.  攻击者构造一个包含恶意 JavaScript 代码的网页。
2.  用户使用受影响的 Safari、iOS 或 tvOS 版本访问该网页。
3.  恶意 JavaScript 代码创建一个数组，并调用 `slice()` 方法，传入一个包含恶意 `valueOf()` 函数的对象作为参数。
4.  `valueOf()` 函数被调用，修改数组的长度。
5.  `memcpy` 函数尝试从空数组复制数据，导致内存泄露。
6.  攻击者可以分析泄露的内存内容，获取敏感信息，例如地址信息，这可以为进一步的远程代码执行利用提供基础。

**项目地址:** [hdbreaker/WebKit-CVE-2016-4622](https://github.com/hdbreaker/WebKit-CVE-2016-4622)

**漏洞详情:** [CVE-2016-4622](https://nvd.nist.gov/vuln/detail/CVE-2016-4622)