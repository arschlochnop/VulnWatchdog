## CVE-2015-4133 - WordPress ReFlex Gallery Plugin Arbitrary File Upload

**漏洞编号:** CVE-2015-4133

**漏洞类型:** Arbitrary File Upload

**影响应用:** WordPress ReFlex Gallery Plugin

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 3.1.4

**利用条件:** 需要安装易受攻击的ReFlex Gallery插件，并且服务器允许上传文件到uploads目录

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2015-4133 漏洞存在于 WordPress ReFlex Gallery 插件 3.1.4 之前的版本中。攻击者可以通过上传包含 PHP 代码的文件，然后直接访问该文件来执行任意 PHP 代码。漏洞位于 `admin/scripts/FileUploader/php.php` 文件中，由于未对上传的文件类型进行严格的限制，导致了任意文件上传漏洞。

**利用方式：**

1.  攻击者上传一个包含恶意 PHP 代码的 PHP 文件 (例如 exploit-shell.php)。
2.  攻击者通过构造 URL，直接访问上传的 PHP 文件（例如 `url + "wp-content/uploads/" + str(year) + "/09/" + webshell_name`），从而执行其中的 PHP 代码。

**POC 代码分析：**

提供的 POC 代码 `CVE-2015-4133.py` 实现了该漏洞的利用过程。主要步骤如下：

1.  **创建 webshell 文件：**  POC 首先创建一个名为 `exploit-shell.php` 的 webshell 文件，其中包含简单的 PHP 代码，用于执行通过 GET 参数 `cmd` 传递的系统命令。
2.  **上传 webshell：** POC  尝试利用漏洞上传这个webshell，但具体上传过程未在提供的代码段中体现，因为该文件会被上传到 `wp-content/uploads/[year]/09/` 目录下。
3.  **执行命令：**  上传成功后，POC 构造 URL，通过 `cmd` 参数执行系统命令，并将结果返回给攻击者。提供了一个简单的交互式 shell。
4.  **反弹 Shell (Reverse Shell)：** POC 包含一个利用 bash 反弹 shell 的功能，攻击者可以指定 IP 地址和端口，让目标服务器连接到攻击者的监听器。

**投毒风险分析：**

代码中发现的潜在投毒风险较低，约为5%。主要是以下几个方面：

1.  **依赖风险：** 虽然代码依赖于 `requests` 库，但这是常见的 Python 库，风险较低。
2.  **webshell 内容：**webshell的内容只是执行cmd命令，功能相对简单，没有明显的恶意代码。
3.  **代码可读性：** 代码结构清晰，逻辑简单，没有发现隐藏恶意行为的迹象。
4. **Year参数** 攻击者需要知道年份,如果年份猜错,可能会认为是exp失效.

综上所述，该 POC 的主要目的是验证漏洞并实现远程代码执行。虽然理论上攻击者可以修改 webshell 的内容，使其具有更强的破坏性，但就提供的代码本身而言，投毒风险较低。攻击者主要面临的风险是被安全设备检测到恶意webshell.

**项目地址:** [D3Ext/CVE-2015-4133](https://github.com/D3Ext/CVE-2015-4133)

**漏洞详情:** [CVE-2015-4133](https://nvd.nist.gov/vuln/detail/CVE-2015-4133)