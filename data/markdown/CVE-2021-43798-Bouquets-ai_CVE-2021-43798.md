## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (除已修复版本)

**利用条件:** 需要网络访问，Grafana实例存在漏洞且安装了插件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43798是Grafana中存在的一个目录遍历漏洞。攻击者可以通过构造包含目录遍历字符的URL，读取服务器上的任意文件。漏洞存在于`/public/plugins/<plugin_id>/`路径，其中`<plugin_id>`是已安装插件的ID。提供的Go语言POC代码通过读取`url.txt`中的URL列表，并针对每个URL，尝试拼接不同的插件路径和目录遍历payload，以读取`/etc/passwd`文件来验证漏洞是否存在。如果`/etc/passwd`包含"root:"字符串，则认为存在漏洞，并将URL写入`test.txt`文件中。根据提供的代码，没有发现明显的投毒风险。

**有效性评估：**

该POC代码看起来是有效的，因为它实现了漏洞描述中提到的攻击向量，并尝试读取一个已知文件（`/etc/passwd`）来验证漏洞的存在。搜索结果也表明该漏洞存在可利用的POC。

**利用方式：**

1.  **确定目标Grafana实例的版本：**  漏洞影响Grafana 8.0.0-beta1 to 8.3.0版本。
2.  **确定是否存在易受攻击的插件：**  利用漏洞需要知道目标实例上已安装的插件ID。
3.  **构造恶意URL：**  将插件ID和目录遍历payload拼接到`/public/plugins/<plugin_id>/`路径中，例如：`/public/plugins/alertlist/../../../../../../../../../../../../../../etc/passwd`。
4.  **发送请求：**  向构造的URL发送HTTP GET请求。
5.  **读取文件：**  如果漏洞存在，服务器将返回被请求文件的内容。
6.  **利用步骤（参考README.md）：** 验证存在后访问 `var/lib/grafana/grafana.db` 即可下载这个数据库文件打开 user 的表，发现 login 为 admin 的一般密码也为 admin，登录进去即可。

**投毒风险评估：**

提供的Go语言POC代码主要用于验证漏洞是否存在，其目的是读取`/etc/passwd`文件。虽然该代码本身没有明显的投毒行为，但需要注意以下几点：

*   **url.txt：**  `url.txt` 文件包含要测试的 Grafana 实例的URL列表，这些URL可能指向恶意服务器，从而导致信息泄露或受到进一步攻击。需要确保此列表中的URL是可信的。
*   **test.txt：**  `test.txt` 文件包含确认存在漏洞的Grafana实例的URL，这些URL如果被泄露，可能会被恶意攻击者利用。
*   **供应链风险：**  虽然直接的代码没有投毒，但是需要确认下载该代码的来源是可信的，防止被中间人攻击。

**总体评估：**

该POC代码在验证漏洞方面是有效的，但需要注意相关的安全风险，例如确保`url.txt`中的URL是可信的，以及妥善保管`test.txt`文件。直接的代码分析未发现直接的投毒风险。综合评估投毒风险为0%。

**项目地址:** [Bouquets-ai/CVE-2021-43798](https://github.com/Bouquets-ai/CVE-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)