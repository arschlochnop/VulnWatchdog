## CVE-2022-0847 - Dirty Pipe 本地提权漏洞

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致普通用户获取 root 权限

**影响版本:** Linux kernel versions newer than 5.8, fixed in 5.16.11, 5.15.25, and 5.10.102

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0847 (Dirty Pipe) 是 Linux 内核中的一个本地权限提升漏洞。该漏洞允许非特权用户覆盖只读文件中的数据，从而获得 root 权限。漏洞根源在于 Linux 内核在处理管道缓冲区时，未正确初始化 pipe buffer 结构的 "flags" 成员，导致该成员可能包含过时的值。利用该漏洞，攻击者可以修改 /etc/passwd 文件来更改 root 密码，或者劫持 SUID 程序来执行任意代码。提供的漏洞利用代码包含两个expolit, exploit-1 旨在修改只读文件，如/etc/passwd，通过更改root密码来获得root权限，它会先备份/etc/passwd到/tmp/passwd.bak，然后修改/etc/passwd中的root密码，最后恢复/etc/passwd。exploit-2 旨在劫持 SUID 程序，通过覆盖 SUID 进程内存中的数据来获得root权限。compile.sh 用于编译 exploit-1.c 和 exploit-2.c。从代码逻辑上来看，没有发现明显的投毒代码，主要风险在于利用成功后对系统造成的更改（如修改 root 密码），这属于漏洞利用的正常效果，而非代码本身携带的恶意逻辑。综合来看, 投毒风险为0%。根据漏洞描述和漏洞利用代码，可以确认提供的POC代码是有效的。利用方式如下：

1.  **查找SUID程序:** 使用 `find / -perm -4000 2>/dev/null`命令查找SUID程序。
2.  **编译利用程序:** 使用`./compile.sh`编译exploit-1.c或exploit-2.c.
3.  **运行利用程序:** `./exploit-1` 修改只读文件或者 `./exploit-2 /usr/bin/sudo` 劫持SUID程序，从而提权。

**项目地址:** [muhammad1596/CVE-2022-0847-DirtyPipe-Exploits](https://github.com/muhammad1596/CVE-2022-0847-DirtyPipe-Exploits)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)