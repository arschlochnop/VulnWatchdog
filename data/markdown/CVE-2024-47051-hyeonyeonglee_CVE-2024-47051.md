## CVE-2024-47051-Mautic-RCE & 文件删除

**漏洞编号:** CVE-2024-47051

**漏洞类型:** 远程代码执行 (RCE) & 路径遍历文件删除

**影响应用:** Mautic

**危害等级:** 高危，可能导致服务器完全控制和数据泄露

**影响版本:** < 5.2.3

**利用条件:** 需要已经通过身份验证的用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-47051 是 Mautic 5.2.3 之前版本中存在的严重安全漏洞。它包含两个主要的安全问题：

1.  **远程代码执行 (RCE) via Asset Upload：** 通过资产上传功能中的漏洞，攻击者可以绕过文件扩展名限制，上传恶意的 PHP 脚本等可执行文件，从而实现远程代码执行。

2.  **路径遍历文件删除：** 在上传验证过程中存在路径遍历漏洞。由于对路径组件处理不当，经过身份验证的用户可以操纵文件删除过程，删除主机系统上的任意文件。

**有效性：**

根据漏洞库信息和搜索引擎结果，此漏洞的POC是有效的。多个来源 (如NVD, Wiz.io, SonicWall, Snyk, GitHub) 都证实了该漏洞的存在以及利用的可能性。特别是 GitHub 上的 mallo-m/CVE-2024-47051 仓库提供了利用此漏洞的验证信息。

**投毒风险：**

提供的 Dockerfile 主要是用于构建 Mautic 运行环境，没有明显的恶意代码。Dockerfile 用于安装所需的 PHP 扩展并设置权限，以支持 Mautic 应用程序的正常运行。提供的LICENSE.txt 是 Mautic 软件的开源许可证，其中包括多个第三方组件的许可证信息，同样没有发现恶意代码。因此，投毒风险较低，估计在10%左右。这个风险主要来自于以下几个方面：

*   **依赖镜像的潜在风险：** Dockerfile 基于 `php:8.1-apache` 镜像。虽然官方镜像通常是安全的，但仍然存在镜像本身被篡改或包含漏洞的可能性。
*   **Mautic 代码本身的复杂性：** 虽然 Dockerfile 和 LICENSE 文件本身没有问题，但 Mautic 代码库庞大且复杂。如果攻击者能够控制 Dockerfile 构建过程，他们可能通过添加额外的步骤来引入恶意代码。

**利用方式：**

1.  **身份验证：** 攻击者首先需要获得 Mautic 实例的有效用户凭据。
2.  **上传恶意文件：** 攻击者利用资产上传功能，绕过文件类型检查，上传包含恶意 PHP 代码的文件。
3.  **触发恶意代码：** 攻击者通过访问上传的恶意 PHP 文件来触发远程代码执行。
4.  **文件删除:** 攻击者通过构造包含路径遍历的请求来删除系统上的敏感文件.

攻击者可以利用 RCE 来执行系统命令，控制服务器，或者通过文件删除来破坏系统。


**项目地址:** [hyeonyeonglee/CVE-2024-47051](https://github.com/hyeonyeonglee/CVE-2024-47051)

**漏洞详情:** [CVE-2024-47051](https://nvd.nist.gov/vuln/detail/CVE-2024-47051)