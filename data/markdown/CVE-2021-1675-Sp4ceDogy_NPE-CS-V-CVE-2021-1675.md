## CVE-2021-1675 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致系统完全控制

**影响版本:** 受影响版本包括Windows 7, Windows 8.1, Windows 10, Windows Server 2008, Windows Server 2012, Windows Server 2016, Windows Server 2019, Windows Server 20H2, Windows Server 2004, Windows 21H1等，具体版本参见漏洞库信息。

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要具备一定的访问权限（可以是低权限用户）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过未经授权的方式调用 `RpcAddPrinterDriverEx()` 函数来安装恶意打印驱动程序，从而在目标系统上以SYSTEM权限执行任意代码。

**有效性：**
根据搜索引擎结果，CVE-2021-1675的PoC代码是存在的，并且已被公开。漏洞库信息也确认了该漏洞的存在和影响范围。

**投毒风险：**
提供的漏洞利用代码仅仅包含一些链接, 大部分是视频和github链接, github的作者是JohnHammond, 如果从github下载的exp，可能有一定的风险, 但总体来说, 投毒风险较低, 估计在10%左右。

**利用方式：**
1.  攻击者利用该漏洞，通过 `RpcAddPrinterDriverEx()` 函数添加恶意的打印机驱动。
2.  这个恶意驱动程序本质上是一个DLL文件，它会被加载到Print Spooler进程（spoolsv.exe）中。
3.  由于Print Spooler服务通常以SYSTEM权限运行，所以恶意DLL中的代码也会以SYSTEM权限执行，从而导致远程代码执行。
4.  利用流程通常包括:
    * 找到目标系统上开启的Print Spooler服务。
    * 构造恶意的请求，发送给Print Spooler服务。
    *  Print Spooler服务解析请求并尝试加载攻击者提供的恶意驱动。
    *  恶意驱动被加载后，执行攻击者预设的恶意代码。

**项目地址:** [Sp4ceDogy/NPE-CS-V-CVE-2021-1675](https://github.com/Sp4ceDogy/NPE-CS-V-CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)