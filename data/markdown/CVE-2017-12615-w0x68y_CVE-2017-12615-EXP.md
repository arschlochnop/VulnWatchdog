## CVE-2017-12615-Apache Tomcat-远程代码执行

**漏洞编号:** CVE-2017-12615

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，允许攻击者上传恶意JSP文件并执行任意代码

**影响版本:** 7.0.0 to 7.0.79

**利用条件:** 运行在Windows上，并且启用了HTTP PUT方法(readonly 初始化参数设置为false)

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-12615 漏洞存在于 Apache Tomcat 7.0.0 到 7.0.79 版本中。当 Tomcat 运行在 Windows 操作系统上，且启用了 HTTP PUT 请求方法（例如，通过设置 `readonly` 初始化参数为 `false`）时，攻击者可以通过构造特殊的请求上传恶意的 JSP 文件到服务器。上传的 JSP 文件随后可以被访问，并执行其中包含的任意代码，导致远程代码执行。

**漏洞利用方式：**
1.  **检查PUT方法是否启用：** 首先，需要确认目标 Tomcat 服务器是否允许 HTTP PUT 请求。可以通过发送 `OPTIONS` 请求，检查响应头中的 `Allow` 字段是否包含 `PUT`。
2.  **构造恶意JSP文件：** 准备一个包含恶意代码的 JSP 文件。该 JSP 文件可以使用 Java 代码执行任意命令，例如反弹 shell。
3.  **上传JSP文件：** 使用 HTTP PUT 请求将恶意 JSP 文件上传到服务器。文件名需要包含特殊的字符，例如使用时间戳命名然后加/.jsp/绕过文件类型校验。
4.  **执行JSP文件：**  通过 Web 浏览器访问上传的 JSP 文件，触发恶意代码的执行，从而实现远程代码执行。

**代码分析：**
提供的 Go 语言 POC 代码实现了上述漏洞利用过程。该代码首先检查目标服务器是否支持 PUT 请求，然后构造包含恶意代码的 JSP 文件，并使用 PUT 请求将其上传到服务器。上传成功后，返回 Webshell 地址。

**投毒风险：**
代码本身是一个PoC验证程序，主要功能是上传jsp webshell文件。风险较低，但是用户在使用时，可能会替换webshell里的代码，如果webshell代码被替换为恶意代码，则存在被植入恶意代码的风险。因此判定投毒风险为1%。

**项目地址:** [w0x68y/CVE-2017-12615-EXP](https://github.com/w0x68y/CVE-2017-12615-EXP)

**漏洞详情:** [CVE-2017-12615](https://nvd.nist.gov/vuln/detail/CVE-2017-12615)