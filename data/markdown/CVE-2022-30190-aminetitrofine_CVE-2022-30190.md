## CVE-2022-30190 (Follina) - Microsoft MSDT远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能导致远程代码执行，获取系统控制权

**影响版本:** 受影响的Windows版本包括但不限于Windows 7, Windows 8.1, Windows 10, Windows 11, Windows Server 2008 R2, Windows Server 2012, Windows Server 2016, Windows Server 2019, Windows Server 2022，具体版本范围请参考漏洞库信息。

**利用条件:** 需要用户打开包含恶意代码的Word文档或其他调用MSDT的应用程序。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190（Follina）是一个Microsoft MSDT远程代码执行漏洞。攻击者可以利用Word等应用程序通过URL协议调用MSDT来执行任意代码。漏洞利用过程大致如下：

1.  攻击者创建一个包含恶意链接的Word文档或其他支持URL协议调用MSDT的文档。
2.  当受害者打开该文档时，Word会尝试通过URL协议调用MSDT。
3.  恶意URL指向攻击者控制的服务器，服务器返回包含恶意代码的HTML页面。
4.  MSDT执行HTML页面中的恶意代码，从而实现远程代码执行。

根据提供的漏洞利用代码`follina.py`，该脚本可以生成包含恶意引用的Word文档，指向攻击者控制的HTTP服务器。HTTP服务器提供包含恶意代码的HTML文件，当受害者打开Word文档时，MSDT将执行此代码。

**有效性：** 提供的POC代码 `follina.py` 看起来有效，可以生成包含恶意代码的Word文档，并通过HTTP服务器提供payload。通过命令行参数可以指定要执行的命令（例如calc.exe或notepad.exe），或者获取反向shell。

**投毒风险：** `follina.py` 代码本身主要功能是利用漏洞，生成包含恶意代码的文档和提供payload。但值得注意的是，如果使用反向shell功能（`-r` 参数），代码会尝试从GitHub下载 `nc64.exe` (Netcat) 并将其放置在受害者系统的 `C:\Windows\Tasks` 目录下。这本身不是投毒行为，而是exploit的一部分，目的是为了建立反向连接。 但从Github下载的netcat二进制文件来源是否安全需要考虑，存在一定的供应链风险。仓库中的README.md文件描述中使用的下载链接也需要验证安全性。

综合考虑，认为该仓库存在一定程度的投毒风险，但主要来自于供应链风险和exploit本身行为引入的风险，而非作者恶意植入的后门，因此投毒风险评估为10%。

**利用方式：**

1.  **生成恶意文档：** 使用 `follina.py` 脚本生成包含恶意链接的Word文档（或其他支持的文档）。
2.  **搭建HTTP服务器：** 运行 `follina.py` 脚本会启动一个HTTP服务器，用于提供恶意HTML payload。
3.  **诱骗受害者打开文档：** 通过电子邮件、社交媒体或其他方式将恶意文档发送给受害者，诱骗其打开。
4.  **执行任意代码：** 受害者打开文档后，MSDT会执行HTTP服务器提供的恶意代码，从而实现远程代码执行。攻击者可以执行任意命令，安装恶意软件，窃取数据等。

**项目地址:** [aminetitrofine/CVE-2022-30190](https://github.com/aminetitrofine/CVE-2022-30190)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)