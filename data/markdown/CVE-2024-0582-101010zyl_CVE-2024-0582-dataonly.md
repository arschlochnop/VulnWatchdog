## CVE-2024-0582 - Linux Kernel io_uring Use-After-Free

**漏洞编号:** CVE-2024-0582

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可导致权限提升或系统崩溃

**影响版本:** < 6.4.0

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0582 是 Linux 内核 io_uring 子系统中的一个 use-after-free 漏洞。当用户使用 IORING_REGISTER_PBUF_RING 注册 buffer ring，对其进行 mmap() 操作，然后释放它时，可能出现此漏洞。

**有效性：**
根据漏洞信息和搜索结果，该漏洞已被公开披露，并且存在可用的利用代码。从提供的漏洞利用代码来看，该PoC利用data-only攻击方式，通过io_uring接口注册buffer ring，并尝试利用UAF漏洞修改文件系统相关的数据结构（`ext4_file_operations`），从而实现权限提升。

**投毒风险：**
尽管代码本身实现了利用 CVE-2024-0582 的功能，但仍存在一些潜在的投毒风险：

1.  **硬编码偏移量：** 代码中 `ext4_fops_offset` 是一个硬编码的偏移量。这个偏移量在不同的内核版本和配置下可能会有所不同。如果攻击者提供一个错误的偏移量，可能会导致系统崩溃，或者利用失败，从而误导用户。
2.  **后门用户：** 利用成功后，代码会向 `/etc/passwd` 文件添加一个后门用户。这种行为本身就是一种攻击行为，但如果攻击者修改后门用户的用户名或密码，可能会导致受害者难以发现并清除后门。
3.  **潜在的隐藏代码：** 虽然对提供的代码进行了分析，未发现明显的恶意代码，但仍不能排除作者在其他地方隐藏恶意代码的可能性，例如通过复杂的编译选项或外部依赖。

综合考虑，投毒风险评估为10%。主要风险在于硬编码偏移量的适配性和后门用户，以及潜在的未被发现的恶意代码。

**利用方式：**
1.  **漏洞触发：** 利用 io_uring 接口注册 buffer ring，触发 use-after-free 漏洞。
2.  **内存损坏：** 通过 UAF 漏洞，覆盖或修改内核内存中的关键数据结构。
3.  **权限提升：** 通过修改 `ext4_file_operations` 结构，劫持文件操作，实现权限提升，并向 `/etc/passwd` 文件添加后门用户。
4.  **清理或维持访问：** 攻击者可能会清理利用痕迹，或者通过后门用户长期维持对系统的访问。

**项目地址:** [101010zyl/CVE-2024-0582-dataonly](https://github.com/101010zyl/CVE-2024-0582-dataonly)

**漏洞详情:** [CVE-2024-0582](https://nvd.nist.gov/vuln/detail/CVE-2024-0582)