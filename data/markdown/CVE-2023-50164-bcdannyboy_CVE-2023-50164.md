## CVE-2023-50164 - Apache Struts 文件上传路径遍历导致远程代码执行

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致任意文件上传和远程代码执行

**影响版本:** 2.0.0 <= Struts <= 2.5.32 或 6.0.0 <= Struts <= 6.3.0.1

**利用条件:** 需要目标系统存在文件上传功能，并且该功能受到Struts框架处理。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-50164是Apache Struts 2中的一个文件上传漏洞。攻击者可以操纵文件上传参数，实现路径遍历，进而上传恶意文件，最终可能导致远程代码执行。根据漏洞库信息和搜索结果，该漏洞的CVSS评分为9.8，属于高危漏洞，并且已经存在公开的PoC。

**有效性：**
提供的PoC代码尝试通过修改multipart/form-data请求中的文件名参数，利用路径遍历漏洞，将上传的文件写入到任意位置。它通过上传一个包含 "SUCCESSFULLY EXPLOITED CVE-2023-50164" 字符串的benign.txt文件来验证漏洞的存在。PoC需要用户提供目标URL，上传变量名，文件名变量名和payload路径，这表明漏洞的利用具有一定的环境依赖性。
从搜索结果来看, 存在公开可利用的EXP, 已经有被利用的尝试,可以判断此漏洞利用的有效性很高.

**投毒风险：**
PoC代码本身的功能是上传一个包含特定字符串的benign.txt文件，以验证漏洞是否存在。 虽然PoC允许用户指定任意payload路径，但上传的文件内容是预定义的，相对安全，风险较低。 即使恶意用户指定了系统关键文件路径，覆盖的内容也是无害的，不会直接导致系统崩溃或者执行恶意代码。 此外， PoC需要用户指定uploadVar和filenameVar，也需要用户提供payloadPath，增加了利用的难度，降低了被恶意使用的可能性。PoC上传的文件内容是固定的，不包含任何可执行代码，因此直接被用作恶意软件的可能性较低。综合来看，该PoC代码的投毒风险较低，估计约为1%。

**利用方式：**
1.  攻击者首先需要确定目标系统使用的Struts版本在受影响范围内 (2.0.0 <= Struts <= 2.5.32 或 6.0.0 <= Struts <= 6.3.0.1)。
2.  攻击者需要找到目标系统存在文件上传功能的地方，并分析上传请求的参数，确定`uploadVar`（上传文件的变量名）和 `filenameVar`（上传文件名的变量名）。
3.  利用PoC脚本，通过修改`filenameVar`参数，构造包含路径遍历的payload，例如`../../../../tmp/benign.txt`，将benign.txt上传到指定位置。
4.  如果上传成功，则说明漏洞存在。攻击者可以修改PoC，上传包含恶意代码的payload文件，例如webshell，从而控制目标服务器。

**项目地址:** [bcdannyboy/CVE-2023-50164](https://github.com/bcdannyboy/CVE-2023-50164)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)