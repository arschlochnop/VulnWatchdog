## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** < 1.2.23

**利用条件:** 需要目标Cacti实例存在具有POLLER_ACTION_SCRIPT_PHP（即action类型为2）的poller_item配置，并且攻击者可以访问remote_agent.php

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-46169 存在于Cacti的`remote_agent.php`文件中，允许未经身份验证的攻击者执行任意代码。利用方式如下：

1.  **身份验证绕过：** 攻击者通过伪造`X-Forwarded-For` HTTP头，将其设置为运行Cacti服务器的IP地址，从而绕过身份验证。这是因为`get_client_addr`函数会读取这些HTTP头来确定客户端IP地址，并且之后通过`gethostbyaddr`解析IP地址为主机名，而Cacti服务器自身的主机名通常在`poller`表中存在，导致验证通过。
2.  **命令注入：** 成功绕过身份验证后，攻击者可以利用`polldata`动作，该动作会使用`proc_open`执行PHP脚本。攻击者可以通过`poller_id`参数注入恶意命令。例如，`poller_id=;id`将执行`id`命令。
3.  **前提条件：** 要触发命令注入，必须存在一个`poller_item`，其`action`字段设置为`POLLER_ACTION_SCRIPT_PHP`（值为2）。`host_id`和`local_data_id`可以通过暴力破解找到。

**有效性：**

提供的PoC代码利用了上述漏洞。首先，它检查目标是否容易受到攻击（`checkVuln`函数）。然后，它通过暴力破解（`bruteForce`函数）确定有效的`host_id`和`local_data_id`。最后，它使用精心设计的payload（`remoteCodeExecution`函数）将恶意命令注入到`poller_id`参数中，从而在服务器上执行任意代码。由于CVE细节和搜索结果确认了此漏洞，PoC代码应有效。

**投毒风险：**

查看PoC代码和相关的README文件，未发现任何恶意或可疑的代码。PoC代码仅包含利用CVE-2022-46169漏洞的代码。因此，投毒风险为0%。

**搜索引擎结果：**

搜索引擎结果证实了CVE-2022-46169是一个未经身份验证的命令注入漏洞，影响Cacti的早期版本。多个来源都强调了该漏洞已被积极利用。


**项目地址:** [lof1sec/CVE-2022-46169](https://github.com/lof1sec/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)