## CVE-2024-50379-Apache Tomcat-TOCTOU Race Condition RCE

**漏洞编号:** CVE-2024-50379

**漏洞类型:** TOCTOU Race Condition RCE

**影响应用:** Apache Tomcat

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 11.0.0-M1 <= version <= 11.0.1
10.1.0-M1 <= version <= 10.1.33
9.0.0.M1 <= version <= 9.0.97

**利用条件:** 1. 存在大小写不敏感的文件系统。
2. 默认Servlet开启写入功能(非默认配置)。
3. 目标服务器存在/uploads目录且可写。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-50379 是 Apache Tomcat 中 JSP 编译期间的 Time-of-Check Time-of-Use (TOCTOU) 竞争条件漏洞。当默认 servlet 启用写入（非默认配置）且文件系统不区分大小写时，攻击者可以利用此漏洞实现远程代码执行。该 PoC 代码通过上传包含恶意代码的 JSP shell 到可写目录（如/uploads）并利用该 shell 执行任意系统命令来演示漏洞利用过程。需要注意的是,PoC代码中定义了BASE_URL、UPLOAD_ENDPOINT、SHELL_NAME和SHELL_CONTENT等变量，如果攻击者修改了SHELL_CONTENT内容添加了恶意程序，可能会对目标系统造成其他安全威胁。尽管 PoC 本身是为了演示漏洞，但确实存在被滥用进行恶意攻击的风险。该PoC的投毒风险主要来自修改后的JSP shell, 例如执行反弹shell或下载执行其他恶意程序。代码中虽然没有明显的恶意投毒代码，但是存在一定风险，例如JSP shell执行命令时的注入，或对服务器的其他操作等，所以投毒风险评为10%。

**项目地址:** [Alchemist3dot14/CVE-2024-50379](https://github.com/Alchemist3dot14/CVE-2024-50379)

**漏洞详情:** [CVE-2024-50379](https://nvd.nist.gov/vuln/detail/CVE-2024-50379)