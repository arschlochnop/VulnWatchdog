## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要能够与目标系统的445端口(SMB)通信。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-34527 (PrintNightmare) 是一个存在于 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过不当的权限文件操作，利用此漏洞在目标系统上以 SYSTEM 权限执行任意代码。根据漏洞库信息，多个Windows版本都受到影响，且需要设置特定的注册表键值才能缓解此漏洞。提供的PoC代码通过SMB协议发送一个协商协议的请求。虽然这个PoC *本身* 似乎并没有包含直接执行代码的部分，但它代表了攻击的第一阶段，即与目标建立连接。真正的漏洞利用需要进一步的步骤，例如上传恶意驱动程序。根据提供的代码和信息，无法直接判断其是否有效，因为提供的代码仅是一个SMB协商协议的请求，这只是利用该漏洞的其中一步。该仓库中的PoC.py文件没有发现明显的恶意代码或后门,没有执行任何本地文件操作或连接到任何外部恶意服务器的行为，主要实现了发送SMB协议协商请求，所以投毒风险较低，风险概率为0%。

**利用方式：**

1.  **连接目标：** 通过SMB协议（445端口）与目标系统的Print Spooler服务建立连接。
2.  **触发漏洞：**  利用 `RpcAddPrinterDriverEx` 函数安装恶意的打印机驱动程序。这个函数允许在没有适当权限验证的情况下安装驱动程序。
3.  **代码执行：**  恶意的驱动程序被加载，从而允许攻击者以SYSTEM权限执行任意代码。

**需要注意的是，微软已经发布了补丁来修复此漏洞。因此，只有在未打补丁的系统上才能成功利用此漏洞。**

**项目地址:** [d0rb/CVE-2021-34527](https://github.com/d0rb/CVE-2021-34527)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)