## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，且文件系统大小写不敏感（如Windows, macOS），启用了core.symlinks，且配置了clean/smudge filter（如Git LFS）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许恶意仓库在克隆时执行远程代码。该漏洞利用了Git的clean/smudge过滤器和符号链接在大小写不敏感的文件系统上的处理方式。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意符号链接和特定文件的Git仓库。
2.  仓库配置了clean/smudge过滤器（例如，通过Git LFS）。
3.  当用户克隆此仓库时，符号链接会被创建。
4.  在大小写不敏感的文件系统上，精心构造的符号链接和文件名的组合会导致Git执行恶意代码。

**POC代码分析：**

提供的POC代码包含三个文件:

*   `A/a`: 文件内容为空
*   `A/b`: 文件内容为空
*   `A/post-checkout`:  这是一个shell脚本，它会在`git checkout`操作**之后**执行。这个脚本会向`http://dc5325e3774c.ngrok.io`发起一个HTTP请求，这允许攻击者追踪受害者是否克隆了仓库。这个脚本本身即是后门，也能够下载其他恶意代码。

**有效性评估：**

此POC代码是有效的，因为它展示了如何在克隆仓库时执行任意代码。攻击者通过`post-checkout` hook 执行 `curl` 命令来与外部服务器通信，这可以用来执行任何命令。

**投毒风险：**

此POC自身不包含传统意义上的投毒代码，而是利用了 Git 的特性来执行恶意操作。`post-checkout` 脚本中的 `curl` 命令是攻击者放置的后门，用于执行远程操作。因此，这里将投毒风险评估为0%，因为脚本本身即为恶意利用的载体,并非是隐藏的恶意代码.攻击者通过控制 `post-checkout` 脚本的内容来达到攻击目的。

**总结：**

CVE-2021-21300是一个严重的安全漏洞，因为它允许攻击者在受害者克隆恶意仓库时执行任意代码。用户应避免克隆来自不受信任来源的仓库，并及时更新Git到已修复的版本。同时，禁用`core.symlinks`或者不全局配置clean/smudge filters可以作为临时缓解措施。

**项目地址:** [Kirill89/CVE-2021-21300](https://github.com/Kirill89/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)