## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行漏洞

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 远程命令执行

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以以root权限执行任意代码

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3

**利用条件:** 目标设备配置了GlobalProtect网关或GlobalProtect Portal，且在受影响的PAN-OS版本范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞。由于任意文件创建漏洞，未经身份验证的攻击者可以在启用了 GlobalProtect 的 PAN-OS 防火墙上以 root 权限执行任意代码。

**漏洞利用方式：**

1.  **漏洞点:** 漏洞存在于GlobalProtect组件处理 `hipreport.esp` 请求的过程中。
2.  **攻击方式:** 攻击者通过构造包含目录遍历的恶意`SESSID` cookie发送POST请求到`/ssl-vpn/hipreport.esp` 。目录遍历允许攻击者覆盖或创建Web服务器可访问目录之外的文件。
3.  **命令注入:**  利用目录遍历，攻击者可以在特定位置创建一个文件，其中包含要执行的命令。
4.  **代码执行:** 创建的文件包含的命令会被PAN-OS执行，导致远程代码执行。

**有效性分析：**

根据漏洞库信息、搜索结果和提供的POC代码，该漏洞是有效的。漏洞库信息明确指出该漏洞已被积极利用，并且存在公开的POC代码。搜索结果也证实了这一点，多个安全厂商发布了关于该漏洞的分析和检测方法。提供的POC代码实现了利用该漏洞进行远程代码执行或漏洞扫描的功能。

**投毒风险分析：**

代码中存在一些潜在的风险，需要进一步人工分析。
1. 脚本依赖于`pwncat-vl`。由于`pwncat`是一个渗透测试工具，引入这个库可能会增加攻击面。检查该库的安全性是必要的。
2.  代码尝试利用socket进行反向shell连接。虽然这是漏洞利用的一部分，但如果脚本被恶意修改，可能会被滥用。
3. 文件名的生成使用uuid，这降低了恶意文件被预测到的可能性，但仍需注意文件创建的位置和内容。

尽管存在上述风险，但从代码的整体结构来看，其主要功能是利用漏洞实现远程代码执行或扫描，没有明显的恶意代码，所以存在一定比例的投毒风险。

**项目地址:** [Chocapikk/CVE-2024-3400](https://github.com/Chocapikk/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)