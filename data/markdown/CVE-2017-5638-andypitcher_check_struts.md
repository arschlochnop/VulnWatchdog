## CVE-2017-5638-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 需要目标系统运行存在漏洞的Apache Struts2版本，且允许外部网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts2 Jakarta Multipart parser中存在的一个远程代码执行漏洞。攻击者可以通过构造恶意的Content-Type, Content-Disposition, 或 Content-Length HTTP header，在服务器上执行任意命令。漏洞根源在于Struts2对Content-Type等header的处理不当，导致OGNL表达式注入。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个真实存在的且已被广泛利用的高危漏洞。网上存在大量的PoC代码，表明其有效性。

**投毒风险：**
提供的代码片段是一个GNU GPL v3许可协议。单独从这个LICENSE文件无法判断是否存在投毒代码，需要检查完整的漏洞利用程序。
然而，考虑到漏洞利用的性质（远程代码执行），如果攻击者能够控制漏洞利用代码，他们可以嵌入恶意代码，例如：

*   **植入后门：** 在目标系统上安装后门，以便长期控制。
*   **数据窃取：** 窃取目标系统上的敏感数据。
*   **恶意软件传播：** 将目标系统作为传播恶意软件的跳板。
*   **破坏系统：** 删除关键文件或使系统崩溃。

因此，在使用任何来自不可信来源的漏洞利用代码时，都必须非常谨慎，进行详细的代码审计，确保没有恶意行为。这里给出的“投毒风险”评估为10%，主要因为提供的代码段本身只是LICENSE信息，无法确定完整利用代码的安全性。需要对实际使用的利用代码进行更细致的分析。

**利用方式：**
利用方式主要通过以下步骤：

1.  **确定目标：** 确定运行存在漏洞的Apache Struts2版本的服务器。
2.  **构造恶意HTTP请求：** 构造包含恶意OGNL表达式的HTTP请求，通常在Content-Type header中，例如`Content-Type: %{#context['com.opensymphony.xwork2.dispatcher.HttpServletRequest'].getHeader('cmd')}`。`cmd` header 包含要执行的系统命令。
3.  **发送请求：** 将构造好的HTTP请求发送到目标服务器。
4.  **执行命令：** Struts2解析HTTP请求时，会执行恶意OGNL表达式，从而在服务器上执行攻击者指定的命令。

例如，攻击者可以使用curl命令发送包含恶意Content-Type header的请求：

```bash
curl -H 'Content-Type: %{#context["com.opensymphony.xwork2.dispatcher.HttpServletRequest"].map.class.forName("java.lang.Runtime").getRuntime().exec("id")}' http://target.com/example.action
```

此命令会在目标服务器上执行`id`命令，并将结果返回给攻击者。

总而言之，CVE-2017-5638是一个高危的远程代码执行漏洞，利用简单且影响严重，需要及时修复。

**项目地址:** [andypitcher/check_struts](https://github.com/andypitcher/check_struts)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)