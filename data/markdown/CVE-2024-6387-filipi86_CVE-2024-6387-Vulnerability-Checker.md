## CVE-2024-6387-OpenSSH-竞争条件

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行或拒绝服务

**影响版本:** 8.5p1 <= OpenSSH <= 9.7p1

**利用条件:** 需要目标主机开启SSH服务，且攻击者能够发起大量连接尝试

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-6387（又名regreSSHion）是一个OpenSSH服务器中的竞争条件漏洞。它源于OpenSSH处理信号的方式，当SSH服务器在短时间内收到大量连接请求且认证失败时，可能导致信号处理不当，进而允许未经验证的远程攻击者在基于glibc的Linux系统上执行任意代码，获取root权限，或者导致拒绝服务。

**有效性：**
根据搜索结果和漏洞库信息，该漏洞的PoC已发布，表明漏洞可被利用。提供的Python脚本`CVE-2024-6387-Vulnerability-Checker.py`是一个漏洞检测工具，通过检查SSH banner版本来判断目标是否存在漏洞。脚本本身并不能直接利用该漏洞进行RCE或DoS攻击，而是用来辅助确认目标系统是否在受影响的范围内。

**投毒风险：**
该Python脚本主要功能是检查OpenSSH版本，判断其是否在受影响的范围内。代码本身只包含版本检测逻辑，没有发现任何恶意代码或后门，因此投毒风险极低。可以认为投毒风险为0%。

**利用方式：**
1.  **版本检测：** 使用PoC脚本或类似工具检测目标SSH服务器的版本，确认其是否位于易受攻击的范围(8.5p1 <= OpenSSH <= 9.7p1)。
2.  **触发竞争条件：** 如果目标版本易受攻击，攻击者需要发起大量连接尝试，并在短时间内故意认证失败，以触发竞争条件。
3.  **代码执行（或DoS）：** 成功触发竞争条件后，利用glibc的堆操作特性，攻击者可以插入恶意指令到堆中，从而实现远程代码执行。另一种利用方式是耗尽服务器资源，造成拒绝服务攻击。

需要注意的是，利用此漏洞进行RCE需要对glibc堆操作有一定的了解，并且成功率可能不高。缓解措施包括禁用`LoginGraceTime`配置，并使用`fail2ban`等工具限制恶意连接。

**项目地址:** [filipi86/CVE-2024-6387-Vulnerability-Checker](https://github.com/filipi86/CVE-2024-6387-Vulnerability-Checker)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)