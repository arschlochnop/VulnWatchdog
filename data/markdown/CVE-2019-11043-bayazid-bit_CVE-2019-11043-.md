## CVE-2019-11043 PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx 作为前端，配置不当，将请求传递给 PHP-FPM 处理。存在 try_files 或 if (-f $uri) 等检查文件存在的配置绕过。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 是一个 PHP-FPM 的远程代码执行漏洞，影响特定版本的 PHP。该漏洞是由于 PHP-FPM 在处理 `env_path_info` 时存在 underflow 缺陷，导致可以覆盖 FPM 分配的缓冲区，从而实现远程代码执行。

**有效性：**
提供的 POC 代码尝试通过修改 User-Agent 头来执行系统命令。根据漏洞信息和搜索结果，攻击并非通过 User-Agent 头，而是需要特定的 URL 构造来触发，因此提供的 POC **可能无效**，需要进行适配或修改。

**投毒风险：**
该 POC 脚本本身非常简单，只包含发送 HTTP 请求并打印响应的功能。其中 `User-Agentt` 的拼写错误可能是一个隐藏的混淆手段，但总体来看，**投毒风险较低**。主要是代码结构简单。投毒风险评估为10%。

**利用方式：**
利用方式总结如下：
1.  目标系统必须使用 Nginx 作为前端服务器，并且启用了 PHP-FPM。
2.  Nginx 的配置需要存在缺陷，例如没有正确检查文件是否存在就将请求传递给 PHP-FPM。
3.  攻击者通过构造特殊的 URL，利用 `env_path_info` underflow 漏洞覆盖 FPM 缓冲区。
4.  攻击者在覆盖的缓冲区中注入恶意代码，从而实现远程代码执行。 这种利用方式需要精确控制 URL 的长度和注入的数据，因此具有一定的复杂性。

**项目地址:** [bayazid-bit/CVE-2019-11043-](https://github.com/bayazid-bit/CVE-2019-11043-)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)