## CVE-2021-22911 Rocket.Chat NoSQL注入导致RCE

**漏洞编号:** CVE-2021-22911

**漏洞类型:** NoSQL注入

**影响应用:** Rocket.Chat

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 3.11, 3.12, 3.13 (Fixed in 3.13.2, 3.12.4, 3.11.4)

**利用条件:** 目标Rocket.Chat服务器版本在受影响范围内，且允许未授权访问API接口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22911是Rocket.Chat服务器中存在的一个NoSQL注入漏洞。由于未对用户输入进行充分的清理，攻击者可以通过构造恶意的NoSQL查询语句，绕过身份验证并执行任意代码。

**利用方式：**

1.  **密码重置流程利用：** 攻击者首先利用`sendForgotPasswordEmail`方法向管理员邮箱发送密码重置邮件。由于存在NoSQL注入漏洞，攻击者可以通过`getPasswordPolicy`方法，利用正则表达式盲注获取密码重置Token。
2.  **重置管理员密码：**  获得Token后，攻击者调用`resetPassword`方法重置管理员密码。
3.  **身份验证与RCE：** 使用重置后的密码登录管理员帐户。然后，通过创建Webhook集成，并在集成脚本中嵌入反向Shell代码，实现远程代码执行。具体来说，`process_incoming_request`函数中的`exec`函数被用来执行恶意命令，建立反向连接到攻击者的监听端口。

**关于投毒风险：**

分析提供的Python脚本，该脚本的主要功能是自动化利用CVE-2021-22911漏洞，重置管理员密码，然后通过创建集成并执行反向shell来实现RCE。代码没有明显的投毒行为，例如未经授权的数据收集、恶意文件上传或对目标系统进行破坏性操作。脚本的行为符合漏洞利用的预期。`README.md` 文件提供了如何使用脚本的说明，也没有任何恶意指示。

因此，判断此仓库中不存在作者隐藏的投毒代码的可能性较高，可能性为0%。

**项目地址:** [overgrowncarrot1/CVE-2021-22911](https://github.com/overgrowncarrot1/CVE-2021-22911)

**漏洞详情:** [CVE-2021-22911](https://nvd.nist.gov/vuln/detail/CVE-2021-22911)