## CVE-2025-24813-Apache Tomcat-路径遍历/反序列化RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径遍历/反序列化RCE

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** 11.0.0-M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** 1. 默认Servlet开启了写入 (默认禁用)
2. 支持Partial PUT (默认启用)
3. 应用使用Tomcat基于文件的Session持久化, 使用默认存储位置
4. 应用包含可被反序列化攻击利用的库

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞，攻击者可以利用 'file.Name' (内部点) 来实现远程代码执行和/或信息泄露，以及/或通过启用了写入的默认 Servlet 向上传的文件添加恶意内容。

**漏洞利用方式：**
1.  **信息泄露/恶意内容添加：**  如果满足以下条件，攻击者可以查看安全敏感文件或向其中注入内容：
    *   默认 Servlet 启用了写入（默认禁用）。
    *   支持 Partial PUT（默认启用）。
    *   安全敏感上传的目标 URL 是公共上传目标 URL 的子目录。
    *   攻击者知道要上传的安全敏感文件的名称。
    *   通过 Partial PUT 上传安全敏感文件。

2.  **远程代码执行：**  如果满足以下条件，攻击者可以执行远程代码：
    *   默认 Servlet 启用了写入（默认禁用）。
    *   支持 Partial PUT（默认启用）。
    *   应用程序使用 Tomcat 的基于文件的会话持久性，并且使用默认的存储位置。
    *   应用程序包含一个可以用于反序列化攻击的库。

**POC分析：**
POC利用脚本`CVE_2025_24813.py`的利用流程大概如下：
1.  检查目标服务器的默认servlet是否开启PUT方法，主要通过PUT请求上传一个文件来判断.
2.  如果目标开启了PUT方法，则会生成一个ysoserial的payload，指定gadget和要执行的命令.
3.  然后将payload上传到`target_url/uploads/../sessions/{session_id}.session`，session_id是由参数指定

**投毒风险分析：**
*   脚本主要功能是漏洞利用，没有发现明显的恶意代码。
*   脚本会生成payload并上传，这个过程可能存在一定风险，但主要取决于执行的命令和payload的内容，而非脚本本身。
*  脚本中存在一些临时文件创建，然后删除的操作，例如`Exploit.java`, `Exploit.class`，这些是payload构造过程中的正常步骤，但如果删除失败，可能会在服务器上留下痕迹。
*  脚本有生成java payload的逻辑，但是java payload的生成是直接拼接字符串，命令在字符串中比较明显，不太容易做手脚。
*  考虑到ysoserial payload本身就可能被认为是具有潜在危害，因此将投毒风险评估为5%。主要是payload本身可能存在的潜在风险。

**结论：**
提供的POC代码看起来是有效的，如果目标环境满足漏洞利用的条件，可以成功执行命令。投毒风险较低，主要风险在于利用过程中生成的payload可能带来的危害。

**项目地址:** [Eduardo-hardvester/CVE-2025-24813](https://github.com/Eduardo-hardvester/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)