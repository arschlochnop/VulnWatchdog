## CVE-2023-22809-Sudoedit权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地权限提升至root

**影响版本:** 1.8.0 to 1.9.12p1

**利用条件:** 用户需要具有sudoedit或者sudo -e的权限，且可以以root或者ALL用户运行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22809 是一个 Sudo 的权限提升漏洞，存在于 1.8.0 到 1.9.12p1 版本中。该漏洞是由于 `sudoedit` (也称为 `-e` 功能) 在处理用户提供的环境变量（`SUDO_EDITOR`、`VISUAL` 和 `EDITOR`）中传递的额外参数时存在错误，允许本地攻击者将任意条目附加到要处理的文件列表中，从而导致权限提升。

**利用方式：**
1.  **检查Sudo版本：** 漏洞利用代码首先检查当前安装的 Sudo 版本是否在受影响的范围内 (1.8.0 to 1.9.12p1)。
2.  **检查用户权限：** 漏洞利用代码检查当前用户是否具有使用 `sudoedit` 或 `sudo -e` 命令以 root 身份或以 `ALL` 用户身份运行的权限。这通常意味着用户在 `sudoers` 文件中具有相应的条目。
3.  **利用环境变量注入参数：** 如果满足上述条件，攻击者可以通过设置 `SUDO_EDITOR`、`VISUAL` 或 `EDITOR` 环境变量来注入额外的参数。攻击者可以在这些环境变量中包含 `--` 参数，从而欺骗 `sudoedit` 命令，使其将任意文件添加到要编辑的文件列表中。
4.  **修改sudoers文件：**POC通过vim打开sudoers文件，提示用户添加一行提权配置到sudoers文件中，完成提权。
5.  **获得root权限：**成功修改 `sudoers` 文件后，攻击者可以使用 `sudo su root` 命令获得 root 权限。

**投毒风险评估：**
仔细审查了提供的 POC 代码，没有发现任何明显的恶意代码或后门。该脚本的主要功能是检查 Sudo 版本、用户权限，然后引导用户使用 `sudoedit` 修改 `/etc/sudoers` 文件来提升权限。没有发现任何未经授权的网络连接、文件修改或信息泄露行为。因此，认为该 POC 代码的投毒风险为 0%。

**项目地址:** [Toothless5143/CVE-2023-22809](https://github.com/Toothless5143/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)