## CVE-2021-41773 - Apache HTTP Server 2.4.49 Path Traversal & RCE

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49，并启用了 CGI 脚本支持，并且Alias配置的目录没有 require all denied 限制。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-41773 是 Apache HTTP Server 2.4.49 中的一个路径遍历漏洞，如果配置不当，可能导致远程代码执行。攻击者可以利用路径遍历绕过 Alias 指令的限制，访问服务器上的任意文件。如果目标服务器启用了 CGI 脚本，并且被访问的目录中存在可执行的 CGI 脚本，攻击者就可以通过构造恶意的 URL 来执行任意代码。

**有效性：**
提供的 POC 代码旨在利用此漏洞。`exploit.py` 脚本首先尝试通过发送包含路径遍历序列的 HTTP 请求来验证目标是否易受攻击，例如 `/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd`。如果从 `/etc/passwd` 文件中检测到 "root:" 和 "bin/" 字符串，则认为目标易受攻击。然后，该脚本尝试利用漏洞通过反向 shell 在目标上执行任意代码。

**利用方式：**
1.  使用路径遍历序列（例如，`.%2e` 或 URL 编码的 `.%2532%2565`）来绕过目录限制。
2.  尝试读取敏感文件，如 `/etc/passwd`，以验证漏洞的存在。
3.  如果服务器配置允许，则利用 CGI 脚本执行任意命令。这通常涉及构造包含命令的 URL，并将该 URL 发送到易受攻击的服务器。
4. 设置监听器，等待反向shell连接。

**投毒风险：**
虽然主要代码看起来直接实现了漏洞利用，但仍然存在一定的投毒风险。可能性大约为 10%。

*   依赖关系：`exploit.py` 脚本依赖于 `requests` 库。虽然 `requests` 是一个流行的 Python 库，但存在供应链攻击的风险。恶意攻击者可能会尝试污染 `requests` 库或类似的依赖项，从而在不知不觉中将恶意代码引入到 `exploit.py` 中。
*   CGI配置的判断：如果目标服务器上未启用 CGI 或 CGI 配置不正确，该漏洞可能无法利用进行 RCE。POC代码中关于CGI的利用可能无法执行.
*   代码审查：在执行任何未经审核的代码（包括此 POC）之前，务必进行彻底的代码审查，以确保其不包含恶意功能。特别注意反向 shell 部分，确保它只执行预期命令。
*  作者动机: 无法完全信任代码作者的真实目的。尽管代码可能有效利用漏洞，但作者可能有意或无意地包含后门或恶意代码。
* 编码问题：URL 编码和解码可能存在问题，导致意外行为。

**项目地址:** [adrianmafandy/CVE-2021-41773](https://github.com/adrianmafandy/CVE-2021-41773)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)