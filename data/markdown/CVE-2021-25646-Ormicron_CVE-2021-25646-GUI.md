## CVE-2021-25646-Apache Druid-远程代码执行

**漏洞编号:** CVE-2021-25646

**漏洞类型:** 远程代码执行

**影响应用:** Apache Druid

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 0.20.0

**利用条件:** 需要目标运行Druid 0.20.0及更早版本，且攻击者需要具备身份验证权限。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2021-25646 允许经过身份验证的用户通过构造特定的请求来覆盖系统配置，从而在 Apache Druid 服务器上执行任意代码。漏洞利用方式：

1.  **漏洞描述：** Apache Druid 包含执行用户提供的 JavaScript 代码的能力，该功能旨在用于高信任环境，默认情况下处于禁用状态。但是，在 Druid 0.20.0 及更早版本中，经过身份验证的用户可以发送特制的请求，强制 Druid 运行用户提供的 JavaScript 代码，而无需考虑服务器配置。
2.  **搜索引擎结果分析：** 大部分搜索结果都表明这是一个未经身份验证的 RCE 漏洞，这与漏洞库中的信息不符。漏洞库信息表明，该漏洞需要身份验证。
3.  **漏洞利用代码分析：** 提供的代码是 C# 的 Visual Studio 项目，看起来是一个用于利用此漏洞的程序。项目包含`Form1.cs`和`Program.cs`等文件，表明它可能是一个图形界面程序，用于构造和发送恶意请求。

    *   **有效性：** 根据漏洞信息和搜索结果，可以判断该漏洞是有效的，并且存在公开可用的利用代码。需要注意的是，漏洞利用需要身份验证，这一点与部分搜索结果不一致。提供的C#代码表明存在一种GUI利用方式。通过构造带有恶意JavaScript代码的HTTP请求利用漏洞。
    *   **投毒风险：**  提供的代码片段为 Visual Studio 项目文件和一些窗体相关的代码，并非完整的PoC代码，难以直接判断是否存在投毒代码。代码本身是用于利用漏洞的，如果攻击者修改了代码，例如在执行有效载荷之前或之后添加了其他恶意操作（例如，窃取凭据、安装后门、横向渗透），则可能存在投毒。根据已提供的代码片段，检测到恶意代码的概率较低，约为20%。
    *   **利用方式：** 攻击者需要首先获取 Druid 实例的有效身份验证凭据。然后，他们可以构造一个包含恶意 JavaScript 代码的 HTTP 请求，利用 Druid 的配置覆盖机制来执行该代码，从而获得服务器的控制权。攻击通常涉及向 Druid 服务器的特定端点（例如查询或数据摄取 API）发送包含恶意 JavaScript 代码的 JSON 载荷。

**项目地址:** [Ormicron/CVE-2021-25646-GUI](https://github.com/Ormicron/CVE-2021-25646-GUI)

**漏洞详情:** [CVE-2021-25646](https://nvd.nist.gov/vuln/detail/CVE-2021-25646)