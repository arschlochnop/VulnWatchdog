## CVE-2024-42471-actions/artifact-任意文件写入

**漏洞编号:** CVE-2024-42471

**漏洞类型:** 任意文件写入/路径遍历

**影响应用:** actions/artifact

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** >= 2.0.0, < 2.1.2

**利用条件:** 需要能上传恶意artifact，并触发downloadArtifactInternal、downloadArtifactPublic 或 streamExtractExternal 功能。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42471是一个存在于GitHub Actions ToolKit（actions/artifact）中的路径遍历漏洞，允许攻击者通过构造恶意的artifact压缩包，在目标系统上写入任意文件。该漏洞出现在2.x分支的2.1.2版本之前。攻击者可以利用`downloadArtifactInternal`，`downloadArtifactPublic`或`streamExtractExternal`函数提取包含路径遍历文件名的特定artifact时触发该漏洞。

**有效性评估：**

提供的POC代码显示了如何创建一个包含恶意路径的zip文件，该路径指向目标系统上的任意文件。通过`zipfile.ZipFile`模块创建压缩文件，并使用`arcname`参数来指定压缩包内的文件路径，这里利用了`hack/../../../../../../../../../../../../../../{path_to_overwrite_file}`来构造路径穿越。

根据漏洞描述，当受影响的`actions/artifact`版本下载并解压此恶意压缩包时，会将文件写入到指定的目标路径，从而实现任意文件写入。

因此，提供的POC代码**有效**。

**投毒风险评估：**

查看POC代码，其主要功能是创建恶意的zip文件，没有发现明显的恶意代码或后门植入的迹象。代码简单，逻辑清晰，仅仅是利用了zipfile模块创建包含路径穿越的文件，从而实现文件覆写。尽管如此，作者可能存在潜在的恶意意图。 代码中要求修改zipfile库的源代码，这本身具有一定的风险，可能引入不稳定性或安全问题。
因此，代码存在一定潜在风险，但代码本身恶意程度较低。
因此，判定投毒风险为**10%**。

**利用方式：**

1.  攻击者创建一个包含恶意路径的artifact压缩包。压缩包的文件名构造包含路径遍历字符，例如`../../../../../../../../../../../../../../etc/passwd`。
2.  将恶意artifact上传到受影响的GitHub Actions工作流。
3.  当工作流调用`downloadArtifactInternal`，`downloadArtifactPublic` 或 `streamExtractExternal` 并处理此artifact时，漏洞被触发。
4.  `actions/artifact`会将压缩包中的文件解压到由恶意路径指定的位置，从而导致任意文件写入。
5.  通过覆写关键文件，攻击者可以实现任意代码执行或其他恶意目的。

**项目地址:** [theMcSam/CVE-2024-42471-PoC](https://github.com/theMcSam/CVE-2024-42471-PoC)

**漏洞详情:** [CVE-2024-42471](https://nvd.nist.gov/vuln/detail/CVE-2024-42471)