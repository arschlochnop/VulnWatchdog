## CVE-2024-3094 XZ Utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门

**影响应用:** XZ Utils

**危害等级:** 极危，可能导致未授权远程访问和控制

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用了受影响的xz版本，并且ssh服务链接了liblzma库

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-3094 描述了 XZ Utils 工具包中发现的恶意代码。此代码是一个供应链攻击的产物，影响了 5.6.0 和 5.6.1 版本。攻击者通过复杂的混淆技术，将预先构建的目标文件插入到 liblzma 的构建过程中，修改了 liblzma 的代码。这导致任何链接到该库的软件都可能被劫持。**利用方式：** 这个后门主要影响 SSH 服务，攻击者可以绕过 SSH 身份验证，实现未授权的远程代码执行。攻击链包括：

1.  恶意代码被嵌入到 xz 的上游 tarball 中。
2.  构建系统在构建 liblzma 时提取恶意代码。
3.  恶意代码修改 liblzma 库。
4.  SSH 服务链接到被修改的 liblzma 库。
5.  攻击者利用修改后的 SSH 服务进行未授权访问。

**关于提供的脚本：** 提供的 `CVE-2024-3094.sh` 脚本并非漏洞利用代码，而是一个**缓解脚本**，用于检测和修复受影响的 xz 版本。它通过以下步骤工作：

1.  检测操作系统和包管理器。
2.  获取当前 xz 版本。
3.  如果版本是易受攻击的（5.6.0 或 5.6.1），则尝试升级到最新版本或安装稳定的旧版本（5.4.6）。

**投毒风险分析：** 脚本本身是一个安全脚本，目标是修复漏洞。但是，仍然存在一定的投毒风险：

*   **依赖外部源：** 脚本从外部 URL 下载稳定的 xz 版本（`https://excellmedia.dl.sourceforge.net/project/lzmautils/xz-5.4.6.tar.bz2`）。如果此源被攻破，脚本可能会下载恶意软件。
*   **`make install` 的风险：** 脚本使用 `make install` 安装 xz。`make install` 过程可能会执行 Makefile 中定义的任意命令，如果 Makefile 被篡改，可能导致恶意代码执行。
*   **权限提升：** 脚本需要 `sudo` 权限才能执行升级和安装操作。如果脚本本身存在漏洞，攻击者可能会利用此漏洞提升权限。

因此，尽管脚本的意图是好的，但仍然存在一些潜在的风险。我对这个脚本的投毒风险评估为 20%，因为虽然作者提供了许可证，但是由于脚本行为包含下载文件，编译，和使用root权限等敏感操作，存在风险。

**项目地址:** [alokemajumder/CVE-2024-3094-Vulnerability-Checker-Fixer](https://github.com/alokemajumder/CVE-2024-3094-Vulnerability-Checker-Fixer)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)