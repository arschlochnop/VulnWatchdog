## CVE-2021-32099 - Artica Pandora FMS SQL 注入导致登录绕过

**漏洞编号:** CVE-2021-32099

**漏洞类型:** SQL 注入

**影响应用:** Artica Pandora FMS

**危害等级:** 高危，可导致未授权访问和信息泄露

**影响版本:** 742

**利用条件:** 目标系统运行 Pandora FMS 742，且攻击者可以访问 /include/chart_generator.php 页面。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-32099 漏洞存在于 Artica Pandora FMS 742 的 pandora_console 组件中。攻击者可以通过操纵 /include/chart_generator.php 的 session_id 参数，注入恶意的 SQL 代码，从而绕过身份验证。具体利用方式如下：

1.  攻击者构造包含 SQL 注入 payload 的 URL，例如：`http://localhost:8000/pandora_console/include/chart_generator.php?session_id=PayloadHere%27%20union%20select%20%271%27,%272%27,%27id_usuario|s:5:%22admin%22;%27%20--%20a`
2.  该 payload 会修改数据库中的 session 数据，将用户的 id_usuario 设置为 admin。该部分主要构造恶意的序列化数据以覆盖现有session。
3.  攻击者访问 Pandora FMS 控制台，即可获得管理员权限。

**有效性:** 提供的POC代码是有效的，因为它利用了 SQL 注入漏洞来修改会话数据，从而实现登录绕过。

**投毒风险:** 提供的POC代码仓库主要包含了一个 `README.md` 文件。该文件详细描述了漏洞的分析过程和利用方法。 虽然代码本身没有明显的恶意行为，比如下载执行恶意文件等，但是任何能修改数据库的攻击都可能导致数据损坏和拒绝服务。因此，存在极低的投毒风险，约5%，风险点在于攻击者可以使用此漏洞修改或删除数据库内容，从而对系统造成损害。 

**利用方式:**

1.  确定目标系统运行的是 Artica Pandora FMS 742。
2.  构造包含 SQL 注入 payload 的 URL，目标为 `/include/chart_generator.php` 页面，并修改 `session_id` 参数。
3.  访问构造的 URL。
4.  访问 Pandora FMS 控制台，以绕过身份验证并获得管理员权限。

**项目地址:** [l3eol3eo/CVE-2021-32099_SQLi](https://github.com/l3eol3eo/CVE-2021-32099_SQLi)

**漏洞详情:** [CVE-2021-32099](https://nvd.nist.gov/vuln/detail/CVE-2021-32099)