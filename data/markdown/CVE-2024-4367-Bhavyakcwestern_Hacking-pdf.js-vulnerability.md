## CVE-2024-4367-PDF.js-任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** PDF.js, Firefox, Firefox ESR, Thunderbird

**危害等级:** 高危，可能导致跨站脚本攻击（XSS）和远程代码执行

**影响版本:** PDF.js < 4.2.67, Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 需要用户打开恶意PDF文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4367 是一个存在于 PDF.js 中的高危漏洞，由于在处理字体时缺少类型检查，允许攻击者通过特制的 PDF 文件执行任意 JavaScript 代码。攻击者可以利用 `fontMatrix` 数组中的漏洞，将恶意代码注入到 PDF 文件中，当受害者使用存在漏洞的 PDF.js 版本（如 Firefox 126 之前的版本）打开该文件时，恶意 JavaScript 代码将被执行。这可能导致跨站脚本攻击（XSS），或者如果 PDF.js 运行在 Electron 等环境中，甚至可能导致远程代码执行。

**有效性：** 提供的POC代码（`ex1.pdf` 和 `ex-gist.pdf`）通过构造恶意的`fontMatrix`数据，证明了该漏洞的可利用性。`ex1.pdf`触发alert，`ex-gist.pdf`甚至可以从远程地址加载并执行JavaScript，验证了漏洞利用的有效性。

**投毒风险：** 虽然该项目提供了漏洞利用的PoC，但是检查了仓库中的其他文件，如`astro.config.mjs`和`package-lock.json`等配置文件，并未发现明显的恶意代码。 风险主要存在于如果下载该项目并在受信任的环境中运行，远程加载的js文件包含恶意payload的可能性，因此推测投毒风险较低，预估为10%。

**利用方式：**
1.  攻击者创建一个包含恶意字体的PDF文件，该字体中包含恶意的`fontMatrix`数组。
2.  `fontMatrix`数组的元素包含JavaScript代码。
3.  当受害者使用存在漏洞的PDF.js版本打开该PDF文件时，PDF.js会解析字体数据，由于缺少适当的类型检查，会将`fontMatrix`中的字符串作为JavaScript代码执行。
4.  恶意JavaScript代码在受害者的浏览器或Electron应用中执行，可能导致XSS或RCE。

**项目地址:** [Bhavyakcwestern/Hacking-pdf.js-vulnerability](https://github.com/Bhavyakcwestern/Hacking-pdf.js-vulnerability)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)