## CVE-2024-3552-Web Directory Free-SQL注入

**漏洞编号:** CVE-2024-3552

**漏洞类型:** SQL注入

**影响应用:** Web Directory Free WordPress Plugin

**危害等级:** 高危，可能导致数据泄露、数据篡改和服务器控制

**影响版本:** < 1.7.0

**利用条件:** 需要目标WordPress站点安装Web Directory Free插件且版本低于1.7.0，并且允许未授权用户访问admin-ajax.php。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3552是Web Directory Free WordPress插件中存在的一个未经身份验证的SQL注入漏洞。该漏洞位于`w2dc_ajax_controller`类的`get_map_marker_info`方法中，通过`admin-ajax.php`接口暴露。漏洞原因是插件在处理`locations_ids[]`参数时，没有进行充分的过滤和转义，直接将其拼接到SQL查询语句中，导致攻击者可以注入恶意的SQL代码。根据提供的POC代码，攻击者可以通过发送包含恶意SQL代码的POST请求到`/wp-admin/admin-ajax.php`，利用`action=w2dc_get_map_marker_info&locations_ids[]=(select+if(1=1,sleep(5),0)+from+(select+1)x)`这样的payload来触发基于时间的盲注。如果`if(1=1,sleep(5),0)`中的条件为真，服务器会休眠5秒，否则立即返回。通过观察服务器响应时间，攻击者可以判断SQL注入是否成功。 

**有效性：**
提供的POC代码有效，可以通过构造特定的payload触发SQL注入漏洞。

**投毒风险：**
该仓库的投毒风险较低，约10%。主要风险在于：
1.  **潜在的Payload修改:** 攻击者可能修改POC中的SQL payload，插入恶意代码或利用其他更隐蔽的SQL注入方式。
2.  **依赖关系:** 仓库中可能包含对其他恶意资源的引用（可能性较低，因为此POC本身实现功能）。
3.  **图片链接劫持:** 图片链接使用了第三方服务,存在一定风险。

目前代码本身专注于展示漏洞利用，未发现直接的后门代码，但不能排除潜在的风险。

**利用方式：**
1.  **漏洞定位:** 漏洞存在于`w2dc_ajax_controller`类的`get_map_marker_info`方法中。
2.  **构造Payload:** 构造包含恶意SQL代码的`locations_ids[]`参数，如`action=w2dc_get_map_marker_info&locations_ids[]=(select+if(1=1,sleep(5),0)+from+(select+1)x)`。
3.  **发送请求:** 发送POST请求到`/wp-admin/admin-ajax.php`，并携带构造好的payload。
4.  **判断结果:** 通过观察服务器响应时间判断SQL注入是否成功，如果payload中的条件为真，服务器会休眠，响应时间会变长。
5.  **数据提取/控制:** 利用SQL注入漏洞，攻击者可以查询、修改甚至删除数据库中的数据，或者执行任意代码，获取服务器控制权。

**项目地址:** [truonghuuphuc/CVE-2024-3552-Poc](https://github.com/truonghuuphuc/CVE-2024-3552-Poc)

**漏洞详情:** [CVE-2024-3552](https://nvd.nist.gov/vuln/detail/CVE-2024-3552)