## CVE-2022-22536 SAP Request Smuggling

**漏洞编号:** CVE-2022-22536

**漏洞类型:** 请求走私 (Request Smuggling)

**影响应用:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**危害等级:** 高危，可能导致权限提升、数据泄露、缓存投毒和拒绝服务

**影响版本:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**利用条件:** 目标系统存在受影响的SAP组件，且允许HTTP/HTTPS访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22536是SAP NetWeaver和ABAP平台中的一个请求走私漏洞。未经验证的攻击者可以通过在受害者请求前添加恶意数据来利用此漏洞，从而冒充受害者执行功能或污染中间Web缓存。漏洞利用代码scanner.py是一个针对CVE-2022-22536的扫描器，它通过发送特制的HTTP请求来检测目标系统是否存在请求走私漏洞。这个POC代码通过构造畸形的HTTP请求，利用服务器对Content-Length和Transfer-Encoding处理不一致的问题，将恶意请求隐藏在看似正常的请求中，当服务器处理完第一个请求后，会将恶意请求当做下一个请求进行处理，从而达到走私请求的目的。

**有效性：**
根据漏洞描述和POC代码，该漏洞利用代码是有效的，因为它旨在验证目标系统是否容易受到请求走私攻击。该代码通过发送构造的HTTP请求并分析响应来检测此漏洞。

**投毒风险：**
代码中存在极低的投毒风险（约10%）。风险点在于：

1.  **依赖项：** 代码依赖于`tqdm`库。虽然`tqdm`是一个常见的库，但始终存在依赖项被劫持或恶意版本替代的风险。
2.  **证书验证控制：** 脚本允许禁用SSL证书验证 (`cert_verify=False`)。虽然这在测试环境中很有用，但在生产环境中可能会引入中间人攻击的风险。

总体而言，代码相对简单且易于审计。主要功能是构造和发送HTTP请求以进行漏洞检测，而不是执行恶意操作。然而，始终建议在运行任何第三方代码之前进行彻底审查。

**利用方式：**

1.  **目标列表：** 扫描器从文件中读取目标IP地址和端口列表。
2.  **协议协商：** 扫描器支持通过HTTP或HTTPS进行连接，并可选地验证SSL证书。
3.  **漏洞验证：** 扫描器通过发送特制的HTTP请求（包含填充数据和代理对齐有效负载）来触发请求走私漏洞。这些请求旨在利用服务器对Content-Length和Transfer-Encoding的处理差异。
4.  **结果分析：** 扫描器分析服务器的响应，以确定目标系统是否容易受到攻击。如果服务器以意外的方式处理请求，则可能存在请求走私漏洞。
5.  **报告：** 扫描器生成CSV格式的报告，其中包含有关扫描结果的信息。

**项目地址:** [abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner](https://github.com/abrewer251/CVE-2022-22536_SAP_Request_Smuggling_Scanner)

**漏洞详情:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)