## CVE-2024-53677-Apache Struts 文件上传路径穿越导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传路径穿越/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 使用了基于 FileuploadInterceptor 的旧文件上传逻辑，并且允许用户控制上传文件名参数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677 是 Apache Struts 框架中的一个文件上传漏洞。攻击者可以通过操纵文件上传参数，实现路径穿越，将恶意文件上传到服务器的任意目录，从而可能执行远程代码。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，此漏洞真实存在且危害严重。POC 代码通过修改`top.uploadFileName`参数尝试将文件上传到目标目录，证明了路径穿越的可能性。POC代码的检测部分通过发送包含恶意文件名的上传请求来检查目标服务器是否易受攻击。如果服务器返回包含恶意文件名的响应，则表明存在漏洞，s2-067-poc.py可以用于上传恶意jsp脚本从而实现rce。

**投毒风险分析：**

检视提供的三个文件：

*   `Check-CVE-2024-53677.py`: 这是一个漏洞检测脚本，旨在非破坏性地检测目标服务器是否存在 CVE-2024-53677 漏洞。它通过上传一个带有修改后文件名的文件来判断是否存在漏洞，基本没有发现异常行为。
*   `README.md`: 这是一个描述 CVE-2024-53677 漏洞的说明文件，包含漏洞描述、影响、修复建议等信息，没有发现投毒代码。
*   `s2-067-poc.py`: 这是一个漏洞利用脚本，用于利用 CVE-2024-53677 漏洞上传恶意 JSP 文件，从而实现远程代码执行。尽管其功能是利用漏洞，但本身也属于漏洞利用代码范畴，考虑到会上传jsp脚本，存在一定后门风险。

总体而言，投毒风险较低，但存在jsp后门文件上传风险需要注意。

**利用方式：**

1.  **路径穿越：** 攻击者通过修改文件上传请求中的文件名参数（例如`top.uploadFileName`），使其包含路径穿越符（如`../`），从而突破服务器的文件上传目录限制。
2.  **恶意文件上传：** 攻击者利用路径穿越，将恶意文件（如 JSP webshell）上传到服务器的可执行目录（如 Web 应用程序的根目录）。
3.  **远程代码执行：** 攻击者通过访问上传的恶意文件，执行其中的恶意代码，从而控制服务器。

**防范措施：**

*   升级 Apache Struts 到 6.4.0 或更高版本。
*   使用 Struts 提供的新的文件上传机制，避免使用基于 `FileuploadInterceptor` 的旧文件上传逻辑。
*   对用户上传的文件名进行严格的验证和过滤，防止路径穿越攻击。
*   限制文件上传目录的执行权限。

**项目地址:** [cloudwafs/s2-067-CVE-2024-53677](https://github.com/cloudwafs/s2-067-CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)