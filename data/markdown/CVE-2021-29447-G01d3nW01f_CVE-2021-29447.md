## CVE-2021-29447-WordPress-XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XXE (XML External Entity)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感文件泄露

**影响版本:** >= 5.6.0, < 5.7.1 (PHP 8)

**利用条件:** 需要WordPress版本在5.6.0到5.7.1之间，并且运行在PHP 8环境下；需要具备上传文件的权限（如Author角色）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于WordPress媒体库中，允许具有文件上传权限的用户利用XML解析漏洞执行XXE攻击。漏洞利用需要WordPress运行在PHP 8环境下，因为该漏洞利用了PHP 8中ID3库的一个缺陷。攻击者可以上传包含恶意XML代码的WAV文件，其中XML代码定义了外部实体，导致服务器尝试解析并加载外部资源。利用方式如下：

1.  攻击者准备一个恶意的DTD文件，该文件包含用于读取服务器文件或执行其他操作的实体。
2.  攻击者使用提供的Python脚本 (`evil-wav-dtd-xxe.py`) 生成一个包含指向恶意DTD的XML的WAV文件。 该脚本会创建一个DTD文件，其中包含一个实体来读取目标文件，并创建一个HTTP请求来将读取的文件内容发送到攻击者的服务器。
3.  攻击者通过WordPress媒体库上传生成的恶意WAV文件。
4.  当WordPress解析该WAV文件时，会触发XXE漏洞，导致服务器加载并执行恶意DTD文件中的指令，将目标服务器上的文件内容通过HTTP请求发送给攻击者。

**有效性评估：**

根据漏洞信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的PoC代码。提供的PoC代码（`evil-wav-dtd-xxe.py`）可以生成恶意的WAV文件和DTD文件，用于利用该漏洞读取服务器上的敏感文件。因此，PoC代码是有效的。

**投毒风险评估：**

查看提供的PoC代码，该代码主要用于生成漏洞利用所需的WAV和DTD文件。 `evil-wav-dtd-xxe.py` 脚本本身的作用就是生成利用漏洞的payload， 从代码逻辑上看，不存在明显的恶意代码或后门。`readme.md` 仅仅是提供使用的说明。

**利用方式总结：**

1.  **权限要求：** 具有上传文件权限的WordPress用户（如Author角色）。
2.  **环境要求：** WordPress版本在5.6.0到5.7.1之间，运行在PHP 8环境下。
3.  **攻击步骤：**
    *   准备恶意DTD文件：该文件定义了读取服务器文件的实体，并将文件内容发送到攻击者控制的服务器。
    *   生成恶意WAV文件：使用`evil-wav-dtd-xxe.py`脚本生成包含指向恶意DTD文件的XML的WAV文件。
    *   上传恶意WAV文件：通过WordPress媒体库上传生成的WAV文件。
    *   触发XXE漏洞：WordPress解析WAV文件时，加载恶意DTD文件，读取服务器文件并通过HTTP请求发送给攻击者。


**项目地址:** [G01d3nW01f/CVE-2021-29447](https://github.com/G01d3nW01f/CVE-2021-29447)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)