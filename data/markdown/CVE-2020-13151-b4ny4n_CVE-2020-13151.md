## CVE-2020-13151 - Aerospike UDF远程命令执行

**漏洞编号:** CVE-2020-13151

**漏洞类型:** 远程命令执行

**影响应用:** Aerospike Community Edition

**危害等级:** 高危，允许未经身份验证的远程命令执行

**影响版本:** 4.9.0.5 (小于 5.1.0.3)

**利用条件:** 目标Aerospike服务器运行着受影响的版本，并且攻击者可以进行网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-13151 允许未经身份验证的用户通过上传和执行恶意的 Lua UDF（用户自定义函数）在 Aerospike 数据库服务器上执行任意操作系统命令。漏洞存在于Aerospike Community Edition 4.9.0.5 版本中，且小于5.1.0.3 版本。漏洞利用的关键在于绕过 Aerospike 禁用 `os.execute()` 调用的限制。攻击者可以通过其他 Lua 函数或模块来执行系统命令。 

**利用方式：**

1.  **UDF 注册：** 攻击者首先需要通过 Aerospike 客户端将包含恶意代码的 Lua UDF 注册到服务器。
2.  **命令执行：** 注册完成后，攻击者可以调用该 UDF，UDF 内部的恶意代码会以运行 Aerospike 服务的用户权限在服务器上执行任意操作系统命令。

**POC代码分析：**

提供的POC代码包含一个Python脚本 `cve2020-13151.py` 和一个 Lua 脚本 `poc.lua`。

*   `cve2020-13151.py`：这是一个 Python 脚本，用于自动化漏洞利用过程。它首先连接到目标 Aerospike 服务器，检查服务器版本是否易受攻击，然后上传并执行 `poc.lua` 中定义的 UDF。
*   `poc.lua`：该文件包含 Lua 代码，用于执行操作系统命令。虽然漏洞描述中提到了 `os.execute()` 被禁用，但实际的利用可能使用了其他 Lua 函数或模块来绕过此限制，执行命令。

**有效性：**

根据漏洞描述和POC代码，可以判断该漏洞利用方法是有效的，前提是目标服务器运行的是受影响的版本。

**投毒风险：**

检查提供的Python脚本和示例Lua代码, 并未发现明显的恶意代码. 投毒风险较低,约10%, 主要风险在于脚本可能包含不明显的后门或收集信息的代码。


**项目地址:** [b4ny4n/CVE-2020-13151](https://github.com/b4ny4n/CVE-2020-13151)

**漏洞详情:** [CVE-2020-13151](https://nvd.nist.gov/vuln/detail/CVE-2020-13151)