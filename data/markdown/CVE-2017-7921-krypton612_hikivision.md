## CVE-2017-7921-Hikvision摄像机未授权访问

**漏洞编号:** CVE-2017-7921

**漏洞类型:** 未授权访问/权限提升

**影响应用:** Hikvision Cameras

**危害等级:** 高危，可能导致信息泄露、设备控制和拒绝服务

**影响版本:** DS-2CD2xx2F-I Series V5.2.0 build 140721 to V5.4.0 build 160530, DS-2CD2xx0F-I Series V5.2.0 build 140721 to V5.4.0 Build 160401, DS-2CD2xx2FWD Series V5.3.1 build 150410 to V5.4.4 Build 161125, DS-2CD4x2xFWD Series V5.2.0 build 140721 to V5.4.0 Build 160414, DS-2CD4xx5 Series V5.2.0 build 140721 to V5.4.0 Build 160421, DS-2DFx Series V5.2.0 build 140805 to V5.4.5 Build 160928, and DS-2CD63xx Series V5.0.9 build 140305 to V5.3.5 Build 160106

**利用条件:** 目标设备运行受影响的固件版本，并且可以通过HTTP/HTTPS访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7921 是 Hikvision IP 摄像机中发现的一个严重漏洞，它允许未经身份验证的攻击者绕过身份验证，并获取对敏感信息的访问权限或提升权限。

**漏洞利用方式：**

该漏洞通过在 URL 中附加特定的字符串 `?auth=YWRtaW46MTEK` 来实现未经授权的访问。这个字符串充当后门，允许攻击者访问各种敏感端点，而无需有效的身份验证。

**利用步骤：**

1.  **确定目标：** 识别运行易受攻击的 Hikvision 摄像机固件版本的设备。
2.  **构造恶意 URL：** 将 `?auth=YWRtaW46MTEK` 附加到摄像机 HTTP/HTTPS URL 的末尾，然后附加目标端点。
3.  **发送请求：** 使用 curl 或任何其他 HTTP 客户端发送构造的 URL 请求。
4.  **获取信息或执行操作：** 根据所使用的端点，攻击者可以检索敏感信息（如设备信息、用户列表、配置文件）或执行操作（如重启或恢复出厂设置）。

**脚本分析：**

*   `exploit.sh` 脚本通过命令行参数获取目标主机、端口和 SSL 设置。它构造带有后门的 URL，然后使用 `curl` 命令发送请求。脚本检查 HTTP 状态码以确定目标是否易受攻击。如果易受攻击，脚本会下载配置文件，并尝试使用 `config-decryptor.py` 脚本对其进行解密，如果解密成功,会提取用户名和密码。
*   `config-decryptor.py` 脚本用于解密下载的配置文件。它使用 AES 解密和 XOR 运算来提取可读信息。这个脚本中没有明显的投毒代码，但要注意该脚本用于处理从目标设备获取的配置信息，可能存在被利用来进行后续攻击的风险。

**投毒风险分析：**

`exploit.sh`脚本本身主要通过拼接URL和调用`curl`获取数据，风险较低。`config-decryptor.py`脚本用于解密配置文件，其中用到了固定的密钥，脚本没有联网行为，恶意修改解密逻辑的可能性较低。整体代码的投毒风险较低,大约为5%。主要是需要人工分析解密后的配置信息,存在人为投毒的风险。


**项目地址:** [krypton612/hikivision](https://github.com/krypton612/hikivision)

**漏洞详情:** [CVE-2017-7921](https://nvd.nist.gov/vuln/detail/CVE-2017-7921)