## CVE-2023-32315 - Openfire Authentication Bypass

**漏洞编号:** CVE-2023-32315

**漏洞类型:** 路径遍历/认证绕过

**影响应用:** Openfire

**危害等级:** 高危，可能导致未授权访问和控制Openfire服务器

**影响版本:** 3.10.0 <= version < 4.6.8 和 4.7.0 <= version < 4.7.5

**利用条件:** 目标服务器运行存在漏洞版本的Openfire，并且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-32315是一个Openfire管理控制台的认证绕过漏洞。攻击者可以通过路径遍历攻击，利用未认证的Openfire安装环境，访问Openfire管理控制台的受限页面，从而创建新的管理员用户。该漏洞影响Openfire 3.10.0到4.6.7和4.7.0到4.7.4版本。

**有效性：**

根据提供的漏洞信息和漏洞利用代码，以及搜索结果，该漏洞利用代码是有效的。搜索结果中提到该漏洞已经被野外利用，并且存在公开的PoC。

**投毒风险：**

提供的Python脚本`CVE-2023-32315.py`主要功能是利用CVE-2023-32315漏洞，通过构造恶意URL来绕过身份验证，在Openfire服务器上创建一个新的管理员用户。代码逻辑相对清晰，主要包括以下几个步骤：

1.  **获取CSRF Token:** 尝试从`/login.jsp`页面获取CSRF token，虽然这个token本身不是直接用于绕过认证，但是利用脚本在构造请求时会用到它。
2.  **构造恶意URL:** 使用路径遍历漏洞`setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp`，直接访问用户创建页面，并设置用户名、密码以及管理员权限。
3.  **发送请求并验证结果:** 使用`requests`库发送GET请求，然后检查响应状态码，判断是否成功创建用户。

检查代码，没有发现明显的恶意行为，例如删除文件、传播恶意软件、或者进行其他未经授权的系统修改等。代码中使用的用户名和密码（hugme/HugmeNOW）也只是为了验证漏洞，并非后门。

代码中存在`subprocess.Popen`，理论上存在被注入命令的风险，但是代码中直接将构造好的命令赋值给`add_credentials_cmd`，其中`target_url`、`vuln_path`、`csrf_token` 等变量都经过了明确的赋值，没有用户可控的输入，因此被注入恶意命令的风险较低。

总体来说，该脚本本身被投毒的风险较低，大概为10%。风险主要来自于运行该脚本的环境是否安全，以及目标Openfire服务器的配置是否允许通过这种方式创建用户。

**利用方式：**

1.  **确定目标Openfire版本：** 确认目标Openfire服务器的版本在受影响的范围内（3.10.0 <= version < 4.6.8 或 4.7.0 <= version < 4.7.5）。
2.  **运行漏洞利用代码：** 运行提供的Python脚本，指定目标Openfire服务器的URL。
3.  **代码自动利用:**  脚本会自动尝试获取CSRF token，构造包含路径遍历的恶意URL，并发送请求创建新的管理员用户。
4.  **登录管理控制台：** 使用脚本中指定的用户名和密码（默认为hugme/HugmeNOW）登录Openfire的管理控制台。
5.  **控制服务器：** 成功登录后，攻击者可以执行任意管理操作，例如修改配置、安装插件、甚至执行系统命令。

**项目地址:** [asepsaepdin/CVE-2023-32315](https://github.com/asepsaepdin/CVE-2023-32315)

**漏洞详情:** [CVE-2023-32315](https://nvd.nist.gov/vuln/detail/CVE-2023-32315)