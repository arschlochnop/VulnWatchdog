## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** 需要nginx作为前端，并且配置不当，将请求传递给PHP-FPM

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-11043是一个PHP-FPM的远程代码执行漏洞，当PHP-FPM与Nginx配合使用时，如果Nginx配置不当，攻击者可以通过构造特定的URL，利用env_path_info的underflow缺陷，覆盖FPM模块的内存，从而执行任意代码。

**有效性：**
提供的POC代码看起来是有效的。POC通过发送包含\n的特殊构造的URL，并尝试不同的K长度，来触发502错误，如果成功触发，则表明存在CVE-2019-11043漏洞。

**投毒风险：**
分析提供的文件，包括Python脚本（CVE-2019-11043-POC.py）、配置文件（CVE-2019-11043_POC.ini）、LICENSE和README.md，没有发现任何明显的恶意代码或后门。该Python脚本主要是用于检测目标URL是否存在CVE-2019-11043漏洞，其行为符合漏洞利用的预期。因此，评估认为该仓库中作者隐藏投毒代码的风险较低，为0%。

**利用方式：**
利用方式如下：
1.  **目标环境：** 目标服务器必须运行PHP-FPM，并且使用Nginx作为前端。
2.  **错误配置：** Nginx必须存在配置错误，即将URI传递给PHP-FPM，而不是首先检查文件是否存在（例如，缺少`try_files $uri =404;`指令）。
3.  **构造Payload：** 攻击者构造包含换行符（%0a）的特定URL，例如`url + "/PHP%0Ais_poc_thistiest_lang.php?" + "K" * i`，其中`i`是精心选择的长度。
4.  **触发Underflow：** 构造的URL会触发`env_path_info`的underflow，导致PHP-FPM覆盖其内部数据结构。
5.  **远程代码执行：** 通过覆盖特定的内存区域，攻击者可以控制PHP-FPM的行为，最终执行任意代码。

**总结：** 该漏洞允许未经身份验证的远程攻击者在目标服务器上执行任意代码，前提是目标服务器满足特定的配置要求。

**项目地址:** [k8gege/CVE-2019-11043](https://github.com/k8gege/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)