## CVE-2018-1000802

**漏洞编号:** CVE-2018-10008

**漏洞类型:** 代码注入

**影响应用:** Python shutil.make_archive

**危害等级:** 中危，可能导致信息泄露，拒绝服务，或者执行任意命令

**影响版本:** < 2.7 (add531a1e55b0a739b0f42582f1c9747e5649ace之前)

**利用条件:** 1. 运行在Windows机器上; 2. 命令行可访问zip工具; 3. 导入zipfile失败

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于`shutil`模块的`make_archive`函数中。当满足特定条件（运行在Windows上，需要命令行可用的zip工具，且标准库 zipfile 模块导入失败）时，`make_archive`会通过命令行调用外部zip工具。攻击者可以通过构造恶意的文件名，将参数传递给zip命令，从而实现信息泄露（读取任意文件），拒绝服务（压缩整个驱动器），或执行任意命令。`poc.py` 中的 `information_leak` 函数演示了如何泄露 `/etc/hosts` 文件。`denial_of_service`函数尝试压缩整个C盘，造成拒绝服务。 `arbitrary_arguments` 函数演示了参数注入。

**有效性:** POC代码有效，但需要满足特定条件才能成功利用。

**投毒风险:** 代码仓库本身不包含任何明显的恶意代码或后门，因此投毒风险为0%。`zipfile.py` 仅仅是为了模拟 `Zipfile ImportError`的情况, 不存在投毒。

**利用方式:**
1.  利用`make_archive`函数，精心构造文件名参数，实现命令行参数注入。
2.  攻击者通过控制`make_archive`的`base_dir`和`base_name`参数，构建包含恶意参数的文件路径。
3.  当程序在满足特定条件的Windows环境下运行时，`make_archive`函数会调用系统命令行的zip工具，并将恶意参数传递给zip命令。
4.  根据注入的参数，可以实现读取任意文件、拒绝服务或执行任意命令。

**项目地址:** [tna0y/CVE-2018-1000802-PoC](https://github.com/tna0y/CVE-2018-1000802-PoC)

**漏洞详情:** [CVE-2018-10008](https://nvd.nist.gov/vuln/detail/CVE-2018-10008)