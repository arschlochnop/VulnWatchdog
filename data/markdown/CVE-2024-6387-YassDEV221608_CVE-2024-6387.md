## CVE-2024-6387 - OpenSSH RegreSSHion 远程代码执行/拒绝服务

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行和拒绝服务

**影响版本:** <= 9.7p1，受影响版本包括8.5p1至9.7p1

**利用条件:** 需要目标系统运行受影响版本的OpenSSH，且攻击者能够发起大量连接请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-6387 (RegreSSHion) 是 OpenSSH 服务器 (sshd) 中发现的一个安全回归漏洞，它源于 CVE-2006-5051。该漏洞是一个竞争条件，可能导致 sshd 以不安全的方式处理某些信号。未经身份验证的远程攻击者可以通过在设定的时间段内未能通过身份验证来触发此漏洞。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的PoC代码是有效的。多个来源证实了该漏洞的存在和可利用性，特别是针对glibc的Linux系统。

**投毒风险：**

提供的PoC代码包含用于编译、构建和利用漏洞的Dockerfile和Python脚本。通过分析代码，可以发现以下潜在的投毒风险因素：

*   **依赖项：** Dockerfile中使用了`wget`和`curl`来下载OpenSSH源码，存在被中间人攻击替换为恶意源码的风险。尽管校验和可以降低这种风险，但如果攻击者能够控制构建环境，仍然可能引入恶意代码。
*   **shellcode：** Python脚本包含一个名为`shellcode`的变量，目前只是占位符，但攻击者可以修改此变量，插入恶意shellcode。攻击者可以精心构造shellcode，以执行恶意操作，例如安装后门、窃取数据或提权。

虽然这些风险存在，但从现有代码来看，没有发现明显的恶意代码。因此，评估投毒风险为10%。

**利用方式：**

1.  **环境搭建：** 使用Dockerfile搭建包含漏洞版本的OpenSSH环境（32位Linux系统）。
2.  **SSH握手：** 客户端与服务器建立连接，发送SSH版本信息并进行密钥交换（KEX）初始化。
3.  **堆准备：** 通过发送特定大小的数据包来布置堆内存，利用glibc的漏洞插入恶意指令。
4.  **触发竞争条件：** 大量连接尝试来触发信号处理程序中的竞争条件。
5.  **执行代码：** 成功触发竞争条件后，恶意代码将被执行，从而实现远程代码执行。

总体来说，利用方式较为复杂，需要精心构造数据包和进行大量的连接尝试才能成功。

**项目地址:** [YassDEV221608/CVE-2024-6387](https://github.com/YassDEV221608/CVE-2024-6387)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)