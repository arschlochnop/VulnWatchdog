## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地用户权限，目标主机安装存在漏洞的Sudo版本

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-32463 漏洞允许本地用户通过 `sudo` 命令的 `--chroot` 选项提升权限至 root。漏洞利用方式如下：

1.  **漏洞描述:**  该漏洞源于 `sudo` 在使用 `--chroot` 选项时，会使用用户可控目录下的 `/etc/nsswitch.conf` 文件。攻击者可以利用这一点，通过构造恶意的 `nsswitch.conf` 文件来加载恶意动态链接库，从而执行任意代码，达到提权的目的。

2.  **POC 代码分析:**  提供的 POC 代码 (`CVE-2025-32463.sh`) 演示了如何利用此漏洞：
    *   首先，创建一个临时目录作为 chroot 的根目录。
    *   然后，创建一个包含恶意代码的 C 文件 (`woot1337.c`)，该文件包含一个构造函数，在加载时会设置 uid 和 gid 为 0，并执行 `/bin/bash`。
    *   创建一个 `nsswitch.conf` 文件，将其中的 `passwd` 条目指向一个不存在的文件 `/woot1337`。这将导致系统尝试加载动态链接库 `libnss_/woot1337.so.2`。
    *   编译 C 代码为动态链接库 `libnss_/woot1337.so.2`。
    *   最后，使用 `sudo -R woot woot` 命令，以 chroot 环境运行 `woot` (一个并不存在的命令，但由于nsswitch.conf被篡改会加载恶意so)。由于 `nsswitch.conf` 被篡改，导致恶意动态链接库被加载，从而执行恶意代码，最终获得 root shell。

3.  **有效性:**  根据提供的 README.md 文件，该 POC 在 Ubuntu 24.04.2 LTS 上成功利用，证明漏洞有效。

4.  **投毒风险:** 代码中创建了一个so文件，以及修改了nsswitch.conf文件, 这些行为均是提权所需的操作,没有发现隐藏的恶意行为，投毒可能性较低。但考虑到脚本会修改系统配置（尽管是在 chroot 环境中），仍存在一定的风险。作者可能将恶意行为隐藏在编译好的so文件中(例如反弹shell)。总体来说，投毒风险很低，判断为5%。

5. **利用方式总结**
    攻击者利用 sudo 的 -R/--chroot 选项，指定一个由攻击者控制的目录作为新的根目录。在该目录下，攻击者放置一个特制的 /etc/nsswitch.conf 文件。当 sudo 尝试在 chroot 环境中运行程序时，会读取这个被篡改的 nsswitch.conf 文件。这个文件会指示系统加载位于攻击者控制目录下的恶意动态链接库。这个动态链接库包含提权代码，当被加载时，会执行提权操作，从而允许攻击者在 chroot 环境之外获得 root 权限。

**项目地址:** [SysMancer/CVE-2025-32463](https://github.com/SysMancer/CVE-2025-32463)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)