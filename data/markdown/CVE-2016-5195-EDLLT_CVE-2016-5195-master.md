## CVE-2016-5195 Dirty COW

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致本地用户获取 root 权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 本地用户权限，目标系统存在漏洞且未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

提供的POC代码针对Android平台，利用Dirty COW漏洞覆盖`/system/bin/run-as`文件，达到权限提升的目的。

**有效性：**

从提供的`README.md`和`Makefile`可以看出，该POC旨在利用Dirty COW漏洞在Android设备上提升权限。通过修改`/system/bin/run-as`，将普通用户的权限提升为root权限。执行结果显示成功修改了`/system/bin/run-as`，并且通过修改后的`run-as`命令可以获取root权限，因此该POC在未修复漏洞的Android设备上是有效的。

**投毒风险：**

分析POC代码，主要包含以下几个文件：

*   `Android.mk`：Android NDK的编译配置文件，用于指定源文件、模块名称、链接库等。
*   `Makefile`：用于自动化编译、推送和测试的脚本。其中`NDK_BUILD`变量指向NDK编译器的路径。
*   `dirtycow.c`和`dcow.c`: 漏洞利用的主体代码，实现利用Dirty COW漏洞写入只读文件。
*   `run-as.c`：替换系统`/system/bin/run-as`的可执行文件。
*   `README.md`：说明文档。

虽然大部分代码是为了实现漏洞利用，但存在一定的投毒风险。风险点在于：

1.  `run-as.c`被替换，如果恶意作者在`run-as.c`中添加后门，可能在用户不知情的情况下执行恶意代码。
2.  `Makefile`中`NDK_BUILD`变量如果被替换为恶意NDK，可能导致编译出的二进制文件包含恶意代码。

总体来说，直接的、明显的投毒代码并不存在，但是考虑到代码修改系统关键文件，以及存在替换编译工具的可能性，存在一定的潜在风险，大约为10%。

**利用方式：**

1.  **环境准备：** 准备存在Dirty COW漏洞的Android设备，安装ADB工具。
2.  **编译POC：** 使用Android NDK编译POC代码，生成可执行文件`dirtycow`和`run-as`。
3.  **推送文件：** 通过ADB将`dirtycow`和`run-as`推送到Android设备的`/data/local/tmp/`目录，并赋予执行权限。
4.  **备份文件：** 备份`/system/bin/run-as`到`/data/local/tmp/dirtycow_dir/run-as-original`，以便后续恢复。
5.  **漏洞利用：** 运行`dirtycow /data/local/tmp/run-as /system/bin/run-as`命令，利用Dirty COW漏洞将`/system/bin/run-as`替换为`run-as`。
6.  **权限提升：** 运行修改后的`/system/bin/run-as`命令，获取root权限。

**项目地址:** [EDLLT/CVE-2016-5195-master](https://github.com/EDLLT/CVE-2016-5195-master)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)