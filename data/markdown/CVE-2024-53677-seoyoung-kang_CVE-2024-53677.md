## CVE-2024-53677-Apache Struts 文件上传路径遍历导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传/路径遍历/RCE

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 <= version < 6.4.0

**利用条件:** 需要目标应用使用基于 FileuploadInterceptor 的旧文件上传逻辑，且可访问 upload.action 接口。

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2024-53677 漏洞存在于 Apache Struts 的文件上传逻辑中。攻击者可以通过操纵文件上传参数实现路径遍历，从而上传恶意文件，例如 JSP webshell，最终导致远程代码执行。

**漏洞利用方式：**

1.  **确定目标应用是否使用存在漏洞的 Struts 版本** (2.0.0 到 6.3.x)。
2.  **确定目标应用是否使用基于 FileuploadInterceptor 的文件上传机制**。
3.  **发送包含恶意构造的`top.UploadFileName`参数的 POST 请求到 `upload.action` 接口**。`top.UploadFileName`参数用于指定上传文件的目标路径，攻击者可以通过该参数进行路径遍历，将文件上传到任意目录。
4.  **上传包含恶意代码的文件（如 JSP webshell）**。PoC 中使用了JSP webshell，允许执行服务器端命令。
5.  **通过访问上传的webshell执行任意命令。** PoC 上传 webshell 后，通过构造特定的 URL 参数 `action=cmd&cmd=<command>` 来执行命令。

**有效性评估：**

提供的PoC 代码有效，可以利用该漏洞实现文件上传和远程代码执行。PoC 包含两个 Python 脚本：

*   `PoC.py`:  该脚本通过 POST 请求上传包含 webshell 代码的 JSP 文件，并设置 `top.UploadFileName` 参数为目标路径，实现路径遍历和 webshell 上传。上传成功后，通过 GET 请求访问 webshell，执行指定的命令。
*   `cve_2024_53677_Tool.py`:  该脚本提供了一个交互式菜单，用于检测 Struts 版本、检查漏洞是否存在、上传测试文件和 webshell，并在 Selenium 中打开 webshell。功能更全面，方便漏洞利用。

**投毒风险评估：**

PoC代码中存在极小的投毒风险。PoC 主要功能是漏洞利用，将后门代码封装在webshell里，不算投毒。投毒代码可能藏在以下几点：

1.  **Webshell 代码本身**： 虽然 webshell 的主要目的是执行命令，但开发者可以加入其他恶意代码，例如收集服务器信息、植入持久性后门等。但PoC提供的webshell比较简单，主要的功能是命令执行。
2.  **工具脚本**（`cve_2024_53677_Tool.py`）： 该脚本拥有更多功能，可能在版本检测、文件上传等过程中隐藏恶意代码，例如修改上传文件的内容、记录用户输入等。
3.  **依赖库**：PoC 使用了 `requests` 和（可选）`selenium` 库。虽然这些库本身是安全的，但如果作者使用了恶意修改过的版本，可能会引入安全风险。

**综合评估，投毒风险较低（2%）。主要风险在于 webshell 本身可能存在恶意代码，以及对未知来源脚本的不信任。建议仔细审查代码，并使用可信的依赖库。**

**项目地址:** [seoyoung-kang/CVE-2024-53677](https://github.com/seoyoung-kang/CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)