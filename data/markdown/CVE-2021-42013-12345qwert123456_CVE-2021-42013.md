## CVE-2021-42013 - Apache HTTP Server Path Traversal and Remote Code Execution

**漏洞编号:** CVE-2021-42013

**漏洞类型:** Path Traversal and Remote Code Execution

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感文件泄露和远程代码执行

**影响版本:** 2.4.49, 2.4.50

**利用条件:** 服务器运行Apache HTTP Server 2.4.49或2.4.50，且存在Alias-like指令配置，CGI脚本已启用并且对Alias路径没有做`require all denied`限制。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-42013是CVE-2021-41773的不完整修复。攻击者可以利用路径遍历漏洞，将URL映射到Alias-like指令配置之外的文件。如果这些目录之外的文件没有受到默认配置"require all denied"的保护，则请求可能会成功。 如果还为这些别名路径启用了CGI脚本，则可能允许远程代码执行。

**漏洞利用方式：**

1.  **路径遍历：** 攻击者利用`..`序列绕过Alias-like指令的限制，访问受限目录之外的文件。
2.  **双URL编码：** 原始的CVE-2021-41773补丁未能正确处理双URL编码的路径。攻击者可以使用双URL编码（例如`%%32%65`代替`.`）来绕过补丁。
3.  **CGI执行：** 如果目标服务器启用了CGI，攻击者可以利用路径遍历访问到诸如`/bin/bash`等可执行文件，并执行任意命令。POC代码中通过POST请求向`/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/bash`发送payload `echo Content-Type: text/plain; echo; id`，该payload会通过bash执行id命令并返回结果。

**有效性：**

提供的POC代码有效，可以利用该漏洞在受影响的Apache HTTP Server版本上执行任意命令。

**投毒风险：**

Dockerfile修改了Apache的配置文件，启用了`mod_cgid`模块，并且将`Require denied`改为了`Require granted`。使得CGI脚本能够执行。作者有一定概率会进行投毒，但是从目前来看，作者只是为了让漏洞更容易复现，并没有发现明显的恶意代码。投毒风险评估为10%，主要是代码仓库所有者信誉未知，存在潜在风险。

**项目地址:** [12345qwert123456/CVE-2021-42013](https://github.com/12345qwert123456/CVE-2021-42013)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)