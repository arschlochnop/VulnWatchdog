## CVE-2017-9841-PHPUnit-RCE

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHPUnit

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHPUnit < 4.8.28 和 PHPUnit 5.x < 5.6.3

**利用条件:** 需要目标服务器运行存在漏洞的PHPUnit版本，并且 /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php 暴露在web访问下

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2017-9841 是 PHPUnit 中的一个远程代码执行漏洞。攻击者通过向 `Util/PHP/eval-stdin.php` 发送以 `<?php` 开头的 HTTP POST 数据，可以执行任意 PHP 代码。

**漏洞利用方式：**

1.  **确定目标：** 找到运行着存在漏洞的 PHPUnit 版本的服务器，并且确认 `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` 可以通过 Web 访问。
2.  **构造Payload：** 构造一个以 `<?php` 开头的 PHP 代码，该代码将被执行。
3.  **发送请求：**  向 `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` 发送一个 HTTP POST 请求，并将构造好的 PHP 代码放在 POST 数据中。
4.  **执行代码：** 服务器执行 POST 数据中的 PHP 代码。

**POC有效性评估：**

提供的POC代码是一个Python脚本，旨在利用 CVE-2017-9841 漏洞。脚本首先安装依赖(pycryptodome)，然后通过HTTP POST 发送包含PHP恶意代码的请求到目标服务器。根据漏洞描述和搜索结果，这个POC **有效**。

**投毒风险分析：**

该代码包含大量的混淆代码, 存在一定风险, 具体分析如下：

1.  **混淆处理：** POC 代码使用了 `pyobfuscate` (但实际上并没有看到调用)，以及大量的base64, zlib，codecs等编码混合使用, 通过字符串替换等操作,增加了代码阅读难度。
2.  **eval执行：** 存在一定的Eval函数, 存在执行恶意代码的风险。eval函数也可能是为了执行加密后的shellcode或其他恶意操作。 虽然eval可能是必须的为了将代码注入到存在漏洞的服务器, 但是也有可能混入攻击者自己的恶意代码
3.  **连接外部资源:** 没有发现连接恶意外部资源

虽然代码存在混淆，但主要功能是利用漏洞，并不能完全确定为投毒代码。混淆的目的是为了绕过检测，并非一定包含恶意行为。综合判断，认为该POC存在 **20%** 的投毒风险。

**项目地址:** [MadExploits/PHPunit-Exploit](https://github.com/MadExploits/PHPunit-Exploit)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)