## CVE-2021-31166 HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP.sys

**危害等级:** 高危，可导致远程代码执行，系统蓝屏

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (受影响版本小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标主机开启HTTP服务，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166是一个Windows HTTP协议栈远程代码执行漏洞。攻击者可以通过发送特制的HTTP请求到目标服务器，触发漏洞，导致远程代码执行或者系统蓝屏。从漏洞库信息可知，该漏洞影响多个版本的Windows 10和Windows Server。该漏洞的CVSS评分高达9.8，属于严重漏洞。CISA已将其列入已知被利用的漏洞目录。

根据提供的POC代码（CVE-2021-31166.py）：

1.  **有效性：** 该POC通过发送包含特定`Accept-Encoding`头的HTTP请求来触发漏洞。如果目标存在漏洞，服务器会因为处理畸形header导致`ReadTimeout`或者崩溃重启。代码中包含验证目标是否重启的函数，从而判断漏洞是否存在。因此，提供的POC代码有效。

2.  **投毒风险：** 检查了提供的POC代码、README以及LICENSE，未发现任何恶意或投毒代码。代码逻辑主要集中在发送HTTP请求、检测响应状态以及判断是否蓝屏重启。因此，投毒风险为0%。

3.  **利用方式：** 漏洞利用方式如下：
    a.  首先发送正常请求进行握手，判断目标主机是否存活。
    b.  发送包含特制`Accept-Encoding`头的HTTP请求，触发漏洞。
    c.  通过不断发送请求并检查目标主机是否重启来验证漏洞是否成功利用。如果目标主机蓝屏重启，则表示漏洞已成功利用。



**项目地址:** [ZZ-SOCMAP/CVE-2021-31166](https://github.com/ZZ-SOCMAP/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)