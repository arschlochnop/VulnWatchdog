## CVE-2025-29927-Next.js-中间件鉴权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 鉴权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问敏感数据或功能

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 目标Next.js应用使用了存在漏洞的中间件鉴权逻辑，攻击者能够发起网络请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-29927 漏洞存在于 Next.js 中间件中，允许攻击者绕过授权检查。该漏洞的根源在于对 `x-middleware-subrequest` HTTP 头的处理不当。当此 header 被设置为 `middleware` 时，服务器可能错误地认为请求源自内部逻辑，从而绕过基于中间件的身份验证。根据漏洞库信息，CVSS 评分为 9.1，属于严重级别。受影响的版本包括 >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25 和 > 15.0.0, < 15.2.3。

**有效性：** 提供的 PoC 代码看起来是有效的。它使用 Python 的 `requests` 库发送带有 `x-middleware-subrequest: middleware` 头的 HTTP 请求。如果目标应用程序易受攻击，则此请求将绕过中间件身份验证。

**投毒风险：** PoC 代码的投毒风险较低，约为 5%。主要风险来自于依赖项，即 `requests` 库，但这是一个广泛使用的库，不太可能包含恶意代码。PoC 代码本身非常简单，直接发送带有特定 header 的请求，没有明显的恶意行为。风险点包括：1. 如果代理服务器被恶意控制，则攻击者的流量可能被嗅探或篡改。2. 攻击者可能会修改expolit.py，使其包含恶意payload并传播，诱导其他安全研究人员使用。尽管有这些可能性，但核心 PoC 代码本身似乎是安全的，风险占比小。

**利用方式：** 攻击者通过发送带有 `x-middleware-subrequest: middleware` 头的 HTTP 请求来利用此漏洞。利用步骤如下：

1.  **确定目标：** 找到运行存在漏洞的 Next.js 版本的应用程序，并且该应用程序使用中间件进行身份验证。
2.  **构造请求：** 创建一个带有 `x-middleware-subrequest: middleware` 头的 HTTP 请求，目标是受保护的资源（例如，管理面板或 API 端点）。
3.  **发送请求：** 将构造的请求发送到目标应用程序。
4.  **绕过身份验证：** 如果应用程序易受攻击，中间件身份验证将被绕过，攻击者可以访问受保护的资源。

可以通过升级 Next.js 版本或者在 Web 应用防火墙中设置规则来阻止含有 `x-middleware-subrequest: middleware` 的请求，来缓解此漏洞。

**项目地址:** [w2hcorp/CVE-2025-29927-Exploit](https://github.com/w2hcorp/CVE-2025-29927-Exploit)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)