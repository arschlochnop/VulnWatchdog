## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE (XML External Entity)

**影响应用:** Ktor

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** < 2.3.5

**利用条件:** 需要目标服务器开启了Ktor的XML反序列化功能且版本低于2.3.5，攻击者能够向服务器发送恶意XML数据。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-45612是JetBrains Ktor 2.3.5之前版本中ContentNegotiation的XML格式默认配置存在XXE漏洞。攻击者可以通过发送包含外部实体引用的恶意XML文件，读取服务器上的任意文件。

**有效性:** 提供的PoC代码是有效的。它演示了如何通过构造包含`<!DOCTYPE>`声明的XML文件来利用XXE漏洞。该文件定义了一个外部实体，该实体指向服务器上的敏感文件（例如，`sensitive_infos.txt`），然后该实体在XML文档的`name`字段中被引用。当服务器解析此XML时，它将解析外部实体，从而导致服务器读取并返回敏感文件的内容。

**投毒风险:**  

*   **低风险:** PoC代码主要由示例代码和说明组成，用于重现XXE漏洞。虽然`build.gradle.kts`文件指定了Ktor依赖项的版本，但它也清楚地表明了哪个版本是易受攻击的，哪个版本是已修复的。 `sensitive_infos.txt` 文件是演示用途，本身不具备危害性。
*   **潜在的风险:**  `gradlew`脚本是自动构建工具Gradle的包装器脚本，理论上存在被篡改的风险，但代码比较简单，被植入恶意代码的可能性较低。在检查了提供的文件后，评估投毒风险为5%。

**利用方式:**

1.  **构建恶意XML:** 攻击者构造一个恶意的XML文件，其中包含一个`<!DOCTYPE>`声明，用于定义一个外部实体。该实体指向攻击者想要读取的服务器上的文件。例如:`<!ENTITY exploit SYSTEM "file:///etc/passwd">`
2.  **发送恶意XML:** 攻击者通过HTTP POST请求或其他支持的方式，将恶意XML文件发送到目标服务器的Ktor应用程序。
3.  **触发XXE:** 当Ktor应用程序使用默认配置的XML反序列化功能解析XML文件时，它会尝试解析外部实体。由于外部实体指向服务器上的文件，因此服务器会读取该文件的内容。
4.  **获取敏感信息:** 服务器将读取的文件内容返回给攻击者。攻击者可以利用此漏洞读取服务器上的任何文件，例如配置文件、数据库连接字符串或私钥。

**缓解措施:**

*   升级到Ktor 2.3.5或更高版本。
*   禁用XML外部实体解析。 
*   对XML输入进行严格的验证和过滤。

**项目地址:** [clemfavre/cve-2023-45612_exploit](https://github.com/clemfavre/cve-2023-45612_exploit)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)