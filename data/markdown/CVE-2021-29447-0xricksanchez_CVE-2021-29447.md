## CVE-2021-29447 - WordPress Authenticated XXE attack in Media Library

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XML External Entity (XXE) Injection

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** >= 5.6.0, < 5.7.1 (需要 PHP 8)

**利用条件:** 需要具有文件上传权限（例如，作者角色），且WordPress运行在PHP 8环境下。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-29447 漏洞存在于 WordPress 5.6.0 到 5.7.1 版本之间，允许具有文件上传权限的用户（例如作者）通过媒体库上传包含恶意 XML 内容的文件，从而触发 XXE 攻击。漏洞利用依赖于 WordPress 使用 PHP 8，因为 PHP 8 对 XML 解析的处理方式使得 XXE 攻击成为可能。

**有效性：**
提供的 POC 代码 `expl.py` 针对的是利用 WAV 文件中的 iXML 块进行 XXE 注入。这个POC专门针对 WordPress BookingPress 插件 < 1.0.11，但该漏洞的描述是通用的，只要目标应用解析包含恶意 XML 的 iXML 块，就可能受到攻击。由于CVE-2021-29447描述的场景和POC有一定关联，判断该POC具有一定的有效性，可以尝试在受影响的 WordPress 版本上利用。

**投毒风险：**
代码中存在投毒的风险较低。`expl.py` 脚本的主要功能是生成包含 XXE payload 的恶意 WAV 文件。Payload 从命令行参数获取IP和端口，攻击者需要配置自己的HTTP服务来接收数据。`README.md` 中也描述了整个利用流程，从生成恶意文件到启动 HTTP 服务器再到解码数据。但是如果攻击者没有配置自己的服务器，可能会导致数据泄露到poc作者搭建的服务器。因此推断存在10%的投毒风险。

**利用方式：**
1.  **生成恶意 WAV 文件：** 运行 `expl.py` 脚本，指定攻击者控制的服务器 IP 地址和端口，生成包含 XXE payload 的 `exploit.wav` 文件。
2.  **启动 HTTP 服务器：** 在攻击者服务器上启动一个 HTTP 服务器，用于提供外部实体定义 (DTD)。
3.  **上传恶意文件：** 具有文件上传权限的 WordPress 用户将 `exploit.wav` 文件上传到媒体库。
4.  **触发 XXE：** WordPress 解析上传的 WAV 文件，当解析 iXML 块时，会尝试从攻击者控制的服务器下载 DTD 文件，从而触发 XXE 攻击，导致服务器上的文件被读取并以 Base64 编码的形式发送到攻击者的服务器。
5.  **解码数据：** 攻击者从 HTTP 服务器的日志中获取 Base64 编码的数据，并进行解码，获取被读取的文件内容。

**项目地址:** [0xricksanchez/CVE-2021-29447](https://github.com/0xricksanchez/CVE-2021-29447)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)