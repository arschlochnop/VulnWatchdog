## CVE-2023-34468-Apache NiFi-RCE

**漏洞编号:** CVE-2023-34468

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache NiFi

**危害等级:** 高危，允许攻击者执行任意代码

**影响版本:** <= 1.21.0

**利用条件:** 需要已认证并授权的用户，可以配置数据库连接URL

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-34468 存在于 Apache NiFi 的 DBCPConnectionPool 和 HikariCPConnectionPool Controller Services 中。经过身份验证和授权的用户可以通过配置包含 H2 驱动程序的恶意数据库 URL 来执行任意代码。漏洞利用方式：

1.  攻击者需要具备 Apache NiFi 的有效用户凭据，并且具有配置 Controller Services 的权限。
2.  攻击者配置 DBCPConnectionPool 或 HikariCPConnectionPool Controller Service，并在数据库 URL 中使用 H2 驱动程序。
3.  在 H2 驱动程序的连接字符串中，攻击者可以嵌入恶意代码，例如使用 `SCRIPT` 函数或 `CREATE ALIAS` 指令。
4.  当 NiFi 尝试建立数据库连接时，H2 驱动程序会执行连接字符串中的恶意代码，从而导致远程代码执行。

根据提供的漏洞利用代码，代码本身是一个PGP密钥文件，用于验证软件的完整性，不是直接的漏洞利用代码。虽然本身不是后门或投毒代码，但如果攻击者替换了密钥文件，会导致用户无法验证软件的完整性。 投毒风险较低，主要取决于这个密钥分发渠道的安全性。由于密钥文件本身无法利用漏洞,仅能影响完整性校验，所以评定投毒风险为1%.

**项目地址:** [shoucheng3/asf__nifi_CVE-2023-34468_1-21-0](https://github.com/shoucheng3/asf__nifi_CVE-2023-34468_1-21-0)

**漏洞详情:** [CVE-2023-34468](https://nvd.nist.gov/vuln/detail/CVE-2023-34468)