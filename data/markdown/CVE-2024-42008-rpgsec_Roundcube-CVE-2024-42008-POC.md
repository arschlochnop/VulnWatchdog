## CVE-2024-42008 Roundcube XSS漏洞

**漏洞编号:** CVE-2024-42008

**漏洞类型:** 跨站脚本（XSS）

**影响应用:** Roundcube

**危害等级:** 高危，可能导致信息泄露、账户劫持和恶意邮件发送

**影响版本:** <= 1.5.7, 1.6.x <= 1.6.7

**利用条件:** 受害者需要打开包含恶意附件的邮件或访问包含恶意脚本的页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42008是Roundcube Webmail中rcmail_action_mail_get->run()函数存在的一个跨站脚本漏洞。攻击者可以通过发送包含特制HTML内容的邮件来利用此漏洞。具体来说，攻击者可以利用CSS动画和JavaScript事件处理程序（如onanimationstart）来绕过内容过滤，从而在受害者的浏览器中执行任意JavaScript代码。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且影响了Roundcube的多个版本。POC代码的提供进一步证明了其有效性。POC通过构造包含恶意CSS动画属性和JavaScript代码的HTML邮件，当用户查看邮件时，JavaScript代码会在用户浏览器中执行，从而窃取用户邮箱中的邮件内容和元数据，并将其发送到攻击者的服务器。

**投毒风险：**
虽然POC的主要目的是演示漏洞利用，但仍然存在一定的投毒风险。例如：

1.  `ATTACKER_IP` 和 `ATTACKER_PORT`: 攻击者可能会诱导用户修改脚本中的 `ATTACKER_IP` 和 `ATTACKER_PORT` 设置，指向一个由攻击者控制的恶意服务器，以便收集用户邮箱信息。
2.  Payload修改: 攻击者可能尝试修改XSS payload，在窃取邮件的同时，尝试执行其他恶意操作，例如植入恶意cookie、重定向用户到钓鱼网站等。
3.  README.md 中的潜在风险： 虽然`README.md` 文件本身不太可能包含恶意代码，但如果攻击者诱导用户下载并执行其他恶意文件（例如，伪装成依赖项的脚本），则可能存在风险。

综合考虑，POC代码本身包含的投毒风险较低，约为10%。主要风险在于攻击者可能利用POC进行二次修改和包装，从而实现更隐蔽和具有破坏性的攻击。

**利用方式：**

1.  **构造恶意邮件：** 攻击者创建一个包含恶意HTML内容的邮件。这个HTML内容包含一个CSS动画，当动画开始时，会触发JavaScript代码的执行。
2.  **发送恶意邮件：** 攻击者将恶意邮件发送给Roundcube用户。
3.  **用户查看邮件：** 当用户打开或查看包含恶意HTML内容的邮件时，浏览器会解析并执行其中的HTML和JavaScript代码。
4.  **XSS触发：** CSS动画的`onanimationstart`事件被触发，执行预先设定的JavaScript代码。
5.  **数据窃取：** JavaScript代码窃取用户的邮件内容（包括UID、消息列表、邮件源码和附件等）和元数据。
6.  **数据外发：** 窃取的数据通过HTTP请求发送到攻击者控制的服务器。
7.  **攻击者服务器接收数据：** 攻击者的服务器接收并记录窃取到的数据。

**项目地址:** [rpgsec/Roundcube-CVE-2024-42008-POC](https://github.com/rpgsec/Roundcube-CVE-2024-42008-POC)

**漏洞详情:** [CVE-2024-42008](https://nvd.nist.gov/vuln/detail/CVE-2024-42008)