## CVE-2020-0618 - Microsoft SQL Server Reporting Services Remote Code Execution

**漏洞编号:** CVE-2020-0618

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft SQL Server Reporting Services (SSRS)

**危害等级:** 高危，可导致完全控制受影响的服务器

**影响版本:** 受影响版本包括SQL Server 2012 SP4 (QFE), SQL Server 2016 SP2 (CU), SQL Server 2014 SP3 (GDR/CU)

**利用条件:** 需要能够向ReportServer/pages/ReportViewer.aspx发送POST请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0618 是 Microsoft SQL Server Reporting Services (SSRS) 中的一个远程代码执行漏洞。该漏洞源于 SSRS 在处理页面请求时存在不正确的反序列化操作。攻击者可以通过构造恶意的 `ViewState` 参数，将其插入到发往 `ReportServer/pages/ReportViewer.aspx` 的 POST 请求中，利用 `LosFormatter` 反序列化器执行任意代码。提供的 PoC 使用 `ysoserial.net` 生成 Payload，该 Payload 使用 `TypeConfuseDelegate` gadget chain，并通过 PowerShell 执行反向连接 shell 命令。 

**利用方式：**

1.  使用 `ysoserial.net` 工具生成恶意的 `ViewState` Payload。
2.  将 Payload 插入到发往 `ReportServer/pages/ReportViewer.aspx` 的 POST 请求的 `NavigationCorrector$ViewState` 参数中。
3.  发送精心构造的 POST 请求到目标服务器。
4.  如果漏洞利用成功，服务器将执行 Payload 中包含的恶意代码。

**投毒风险分析：**

该 PoC 代码主要利用 `ysoserial.net` 生成 Payload，该 Payload 较为常见，主要风险存在于执行的 Powershell 脚本。脚本内容本身是为了建立反向 shell，但若攻击者修改脚本中的 IP 地址或端口，可能导致受害者连接到攻击者的服务器，从而泄露信息或被进一步控制。仓库本身也可能被其他人篡改。综合考虑，投毒风险约为 10%。

**项目地址:** [euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

**漏洞详情:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)