## CVE-2022-44268-ImageMagick-任意文件读取

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 任意文件读取

**影响应用:** ImageMagick

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49

**利用条件:** 需要ImageMagick处理恶意构造的PNG图片，且ImageMagick进程有读取目标文件的权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-44268 是 ImageMagick 中的一个信息泄露漏洞。当 ImageMagick 解析 PNG 图像（例如，用于调整大小）时，如果 ImageMagick 进程具有读取文件的权限，则生成的图像可能会嵌入任意文件的内容。

**有效性：**
提供的 Python 脚本 `create_image.py` 使用 Pillow 库生成一个 PNG 图像，并将指定的文件路径作为元数据嵌入到图像中。此脚本能够创建包含文件路径的 PNG 文件。漏洞利用的关键在于，当易受攻击的 ImageMagick 版本处理这个 PNG 文件时，会试图读取元数据中指定的文件，并将文件内容嵌入到处理后的图像中。因此，提供的 POC 代码**有效**。

**投毒风险：**
查看 `create_image.py` 脚本和 `README.md` 文件，该脚本主要是利用 Pillow 库生成 PNG 文件，并将指定的文件路径以文本形式嵌入 PNG 文件的元数据中。脚本功能简单，没有发现任何可疑的代码执行或后门逻辑。`README.md` 仅包含如何运行脚本的说明。不过考虑到攻击者可能会修改脚本，例如添加额外的网络请求或者执行命令的行为，因此存在一定的投毒风险，评估约为 5%。

**利用方式：**
1.  攻击者使用 `create_image.py` 脚本生成一个特制的 PNG 图像，其中嵌入了目标服务器上要读取的文件的路径（例如 `/etc/passwd`）。
2.  攻击者将此 PNG 图像上传到使用存在漏洞的 ImageMagick 版本的服务器。这可以通过多种方式实现，例如上传为头像、图片附件等。
3.  服务器使用 ImageMagick 处理上传的 PNG 图像（例如，调整大小、转换格式）。
4.  当 ImageMagick 处理该 PNG 图像时，它会尝试读取 PNG 元数据中指定的文件内容，并将该内容嵌入到处理后的图像中。
5.  攻击者下载处理后的图像。
6.  攻击者从下载的图像中提取嵌入的文件内容，从而实现任意文件读取。

通过搜索引擎结果得知,此漏洞已经存在EXP代码, 风险等级较高。

**项目地址:** [NataliSemi/-CVE-2022-44268](https://github.com/NataliSemi/-CVE-2022-44268)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)