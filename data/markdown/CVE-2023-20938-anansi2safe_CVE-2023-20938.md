## CVE-2023-20938 - Android Binder Use-After-Free

**漏洞编号:** CVE-2023-20938

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel (Binder)

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** Android kernel (受影响版本低于2023-02-01)

**利用条件:** 本地执行环境,无需用户交互

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-20938是Android Binder中的一个Use-After-Free漏洞，位于`binder.c`的`binder_transaction_buffer_release`函数中。漏洞原因是由于不正确的输入验证，可能导致释放后重用。根据漏洞库信息，攻击者无需额外执行权限，也不需要用户交互，即可实现本地权限提升。

**有效性评估：**

根据搜索引擎结果，存在多个关于此漏洞的分析和利用的文章，包括Android Red Team在OffensiveCon 2024上的演示。POC代码和README.md文件也提供了漏洞的分析和利用方法，包括通过`ITokenManager`建立进程间连接，通过构造特定格式的binder事务，触发`binder_transaction_buffer_release`中的UAF漏洞，最终导致KASAN崩溃。提供的POC代码已经包含触发漏洞所需的必要步骤，包括client A和client B通过servicemanager建立Binder连接，创建node对象，通过未对齐的`offsets_size`进入错误处理代码，最终触发漏洞。因此，可以判断提供的POC代码是有效的。

**投毒风险评估：**

分析提供的Makefile、README.md以及代码的逻辑，Makefile只是编译相关的配置信息，没有发现异常。README.md是对漏洞原理和利用方式的说明，也没有发现投毒信息。代码利用了Binder机制的漏洞，旨在触发UAF，从而造成拒绝服务或权限提升。但是，仍然存在一定的投毒风险：

*   **潜在的后门植入：** 攻击者可能在UAF发生后，利用内存布局的可预测性，在被释放的内存区域写入恶意代码，实现权限提升或后门植入。
*   **隐蔽的恶意行为：** 攻击者可能在触发UAF的同时，执行一些难以察觉的恶意行为，例如收集设备信息、篡改系统设置等。

考虑到以上潜在风险，以及POC代码主要关注UAF漏洞的触发，而非恶意代码植入，因此判定投毒风险较低，约为10%。

**利用方式分析：**

1.  **进程间通信（IPC）：** 通过Android Binder机制建立两个进程（client A和client B）之间的通信连接。
2.  **对象创建与引用：** client A创建一个binder node对象（0xbeef），client B通过引用指向该node对象。
3.  **事务构造与发送：** client B构造一个包含错误`offsets_size`的binder事务，并将其发送给client A。`offsets_size`未对齐将导致错误处理代码被触发。
4.  **漏洞触发：**  `binder_transaction_buffer_release`函数由于处理错误事务，导致node对象的引用计数减少。
5.  **释放与重用：** 通过关闭client B的binder连接，进一步减少node对象的引用计数，最终释放该对象。client A在后续操作中尝试再次访问该node对象，触发Use-After-Free漏洞。
6. **权限提升:** 该漏洞可以实现本地权限提升,结合漏洞利用技术,可以执行任意代码,从而完全控制android设备.

**项目地址:** [anansi2safe/CVE-2023-20938](https://github.com/anansi2safe/CVE-2023-20938)

**漏洞详情:** [CVE-2023-20938](https://nvd.nist.gov/vuln/detail/CVE-2023-20938)