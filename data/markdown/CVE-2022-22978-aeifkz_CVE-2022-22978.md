## CVE-2022-22978-Spring Security-授权绕过

**漏洞编号:** CVE-2022-22978

**漏洞类型:** 授权绕过

**影响应用:** Spring Security

**危害等级:** 高危，可能导致未授权访问

**影响版本:** Spring security versions 5.4.x prior to 5.4.11+, 5.5.x prior to 5.5.7+, 5.6.x prior to 5.6.4+ and all earlier unsupported versions

**利用条件:** 应用程序使用RegexRequestMatcher，且正则表达式中包含"."

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22978是Spring Security中的一个授权绕过漏洞。当使用RegexRequestMatcher时，如果正则表达式配置不当（例如包含"."），攻击者可以通过构造特殊的URL来绕过安全检查。根据漏洞利用代码中的README.md，攻击者可以尝试使用`%0a`或`%0d`等字符进行换行，以欺骗RegexRequestMatcher，从而绕过身份验证。例如，`http://localhost:9090/login%0a` 尝试绕过login验证。

**有效性：**
根据POC代码中的README.md的描述，其中一个利用方式是成功的，其余是失败的，所以POC的有效性有一定的局限性。

**投毒风险：**
查看提供的文件列表，其中包含了Maven wrapper（`mvnw`），`HELP.md`和`README.md`等文件。Maven wrapper本身是为了方便构建和运行项目，`HELP.md`提供了参考文档链接，`README.md`提供了漏洞利用的简单说明。

虽然没有明显的恶意代码，但需要注意的是，任何引入的第三方库或构建脚本都存在潜在的风险。`mvnw`脚本在执行时会下载Maven依赖，如果依赖源被篡改，则可能引入恶意依赖。这个仓库相对简单，投毒的可能性较低，但不能完全排除，风险评估大约10%。

**利用方式：**
利用方式是构造包含特殊字符（例如换行符`%0a`或`%0d`）的URL，以绕过RegexRequestMatcher的检查。攻击者需要找到使用了存在漏洞的RegexRequestMatcher的端点，并尝试通过精心构造的URL来访问受保护的资源。核心在于利用不同Servlet容器对换行符处理的差异，造成正则匹配失效。

**总结：**
该漏洞的关键在于对RegexRequestMatcher的不当使用，以及不同Servlet容器对特殊字符处理的差异。攻击者利用这些差异，构造特定的URL，从而绕过授权检查。

**项目地址:** [aeifkz/CVE-2022-22978](https://github.com/aeifkz/CVE-2022-22978)

**漏洞详情:** [CVE-2022-22978](https://nvd.nist.gov/vuln/detail/CVE-2022-22978)