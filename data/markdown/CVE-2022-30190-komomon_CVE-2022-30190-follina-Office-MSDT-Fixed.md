## CVE-2022-30190-Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能导致远程代码执行，安装程序，查看、更改或删除数据，或在用户权限允许的上下文中创建新帐户

**影响版本:** 受影响的Windows版本：Windows 7 SP1, Windows 8.1, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows 10 (所有版本), Windows 11, Windows Server 2016, Windows Server 2019, Windows Server 2022。 具体版本范围请参考漏洞库信息。

**利用条件:** 需要用户打开恶意的Word文档或其他调用MSDT的应用程序。攻击者需要诱骗用户执行恶意操作。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190（又名Follina）是一个Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞。攻击者可以通过构造恶意的Word文档或其他调用MSDT的应用程序，利用URL协议调用MSDT来执行任意代码。该漏洞的利用方式是，恶意文档利用Word的远程模板功能从远程web服务器检索HTML文件，该HTML文件包含执行恶意代码的指令。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意链接的Word文档或其他可以调用MSDT的应用程序。
2.  该恶意链接指向攻击者控制的服务器，该服务器托管一个包含恶意代码的HTML文件。
3.  当受害者打开文档时，Word会尝试从远程服务器加载HTML文件。
4.  HTML文件利用ms-msdt协议触发MSDT，从而执行嵌入的恶意代码。
5.  恶意代码在受害者的计算机上执行，赋予攻击者控制受害者系统的能力。

**投毒风险分析：**

提供的Python POC代码主要功能是生成包含漏洞利用的恶意Word文档。 代码通过修改docx文档的`word/_rels/document.xml.rels`文件，将文档中的链接重定向到恶意服务器。  此外，代码还会修改`word/document.xml`添加OLEObject。

虽然代码本身实现了漏洞利用，但潜在的投毒风险主要在于以下几个方面：

*   **恶意服务器：**  POC代码依赖于攻击者控制的服务器来托管payload。 如果攻击者在服务器端放置了更具破坏性的payload，例如勒索软件或其他恶意软件，则利用此POC的用户可能会意外地分发这些恶意软件。
*   **生成的文档：**  生成的docx文档本身就是恶意文件。如果用户不小心将包含后门的恶意文档分享给其他人，可能会造成进一步的危害，但这不是代码投毒，而是漏洞本身的利用效果。

代码中直接包含恶意后门的概率较低，但用户需要警惕使用该POC可能带来的间接风险，尤其是payload服务器的安全性。 此处将投毒概率评估为10%，主要考虑的是payload服务器被恶意利用的可能性，而非代码本身存在后门。

**项目地址:** [komomon/CVE-2022-30190-follina-Office-MSDT-Fixed](https://github.com/komomon/CVE-2022-30190-follina-Office-MSDT-Fixed)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)