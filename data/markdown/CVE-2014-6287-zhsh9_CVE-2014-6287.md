## CVE-2014-6287-Rejetto HFS-远程命令执行

**漏洞编号:** CVE-2014-6287

**漏洞类型:** 远程命令执行

**影响应用:** Rejetto HTTP File Server (HFS)

**危害等级:** 高危，可执行任意命令

**影响版本:** 2.3x before 2.3c

**利用条件:** 目标运行存在漏洞的Rejetto HFS版本，攻击者可网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6287是Rejetto HTTP File Server (HFS) 2.3x版本（2.3c之前）中的一个远程命令执行漏洞。该漏洞存在于`parserLib.pas`文件中的`findMacroMarker`函数中。攻击者可以通过在搜索操作中使用`%00`序列来执行任意程序。

**利用方式：**

1.  攻击者构造包含恶意命令的URL，其中恶意命令嵌入在`search`参数中，并以`%00{.exec|...}`格式编码。
2.  HFS服务器解析URL时，由于`findMacroMarker`函数对NULL字节的处理不当，导致恶意命令被执行。

提供的PoC代码`exp.py`利用了该漏洞。PoC需要以下参数：

*   `--rhost`: 目标IP地址。
*   `--rport`: 目标端口号。
*   `--lhost`: 攻击者控制的SMB服务器的IP地址，用于托管`nc.exe`。
*   `--lport`: 攻击者监听反向shell的端口号。
*   `--smb_workgroup`: SMB workgroup，默认为"share"。
*   `--nc_name`: nc.exe文件名, 默认为"nc.exe"

PoC首先从攻击者的SMB服务器下载`nc.exe`到目标机器上的`C:\Users\Public\`目录。然后，PoC使用`nc.exe`在目标机器上执行反向shell，连接回攻击者的机器。

**有效性：**

根据漏洞信息和提供的PoC代码，该漏洞利用是有效的。多个来源 (Exploit-DB, PacketStorm) 证实了该漏洞的存在，以及PoC的有效性。该漏洞还被CISA列入已知被利用漏洞目录(KEV)。

**投毒风险：**

PoC代码的主要目的是利用漏洞实现远程命令执行，虽然代码需要从攻击者控制的SMB服务器下载`nc.exe`，但该过程本身是漏洞利用的一部分，不是后门或投毒行为。作者可能植入投毒代码的风险较低，约10%。风险主要来自于以下几点：

* 下载的`nc.exe`可能被替换为恶意版本。用户需要自行验证下载的`nc.exe`的完整性。
* 代码中的`base_dir`写死为`C:\Users\Public\`，如果用户没有修改，可能因为目录权限等原因，导致payload运行失败，不算是投毒，但是限制了payload的通用性。

总体而言，该仓库的投毒风险较低。用户在使用该PoC代码时，应当注意验证所使用工具的来源和完整性。

**项目地址:** [zhsh9/CVE-2014-6287](https://github.com/zhsh9/CVE-2014-6287)

**漏洞详情:** [CVE-2014-6287](https://nvd.nist.gov/vuln/detail/CVE-2014-6287)