## CVE-2017-0144-Windows SMB Remote Code Execution

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv1 Server

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607, Windows Server 2016

**利用条件:** 目标系统需要开启SMBv1服务，且防火墙允许445端口的流量。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144是Microsoft Windows SMBv1服务器中的一个远程代码执行漏洞。攻击者可以发送特制的SMB数据包到目标服务器，从而在目标系统上执行任意代码。该漏洞的利用通常与EternalBlue攻击框架相关联。

**漏洞利用有效性：**
从提供的漏洞利用代码 `ms17-010-ng.sh` 来看，这是一个自动化利用脚本，其有效性取决于多个因素：

1.  **目标系统是否安装存在漏洞的Windows版本：** 根据漏洞库信息和搜索引擎结果，只有特定版本的Windows才受影响。
2.  **目标系统是否启用了SMBv1协议：** 现代Windows系统默认可能已禁用SMBv1，需要手动启用才能被利用。
3.  **Metasploit框架的配置是否正确：** 脚本依赖Metasploit框架来生成和发送利用代码，需要正确配置LHOST和LPORT等参数。
4.  **是否存在其他安全措施：** 防火墙、入侵检测系统等安全措施可能会阻止利用。

**投毒风险：**
脚本本身存在一定的投毒风险，因为：

1.  **脚本来源未知：** 如果从不可信的来源下载，脚本可能包含恶意代码。
2.  **缺乏严格的代码审查：** 难以保证脚本没有隐藏的恶意功能。
3.  **脚本执行权限：** 脚本需要root权限才能执行nmap和msfconsole，这增加了系统风险。

具体来说，虽然该脚本看起来主要功能是扫描和利用MS17-010漏洞，但是仍然存在一定的投毒风险，例如攻击者可能会在脚本中嵌入后门，用于在受害者系统上执行恶意操作。 风险预估百分比为10%，因为脚本主要依赖于Metasploit框架，恶意代码嵌入相对困难。 

**漏洞利用方式：**

1.  **扫描目标系统：** 使用nmap扫描目标系统的445端口，确定SMB服务是否开启。
2.  **漏洞检测：** 使用nmap的`smb-vuln-ms17-010`脚本检测目标系统是否存在MS17-010漏洞。
3.  **生成Metasploit配置文件：** 如果目标系统存在漏洞，脚本会生成一个Metasploit配置文件，其中包含攻击目标IP地址、攻击者IP地址和端口等信息。
4.  **执行Metasploit：** 脚本会调用Metasploit框架，并加载生成的配置文件，从而利用漏洞，获得目标系统的远程控制权限。

**项目地址:** [pelagornisandersi/WIndows-7-automated-exploitation-using-metasploit-framework-](https://github.com/pelagornisandersi/WIndows-7-automated-exploitation-using-metasploit-framework-)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)