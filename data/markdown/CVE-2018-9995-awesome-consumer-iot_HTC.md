## CVE-2018-9995-TBK DVR-Authentication Bypass

**漏洞编号:** CVE-2018-9995

**漏洞类型:** 身份验证绕过

**影响应用:** TBK DVR4104, DVR4216 及多个重新贴牌版本 (Novo, CeNova, QSee, Pulnix, XVR 5 in 1, Securus, Night OWL, DVR Login, HVR Login, MDVR Login)

**危害等级:** 高危，可能导致未授权访问DVR设备，泄露视频数据，甚至控制设备。

**影响版本:** 受影响版本未知，可能存在于2018年前的固件版本。

**利用条件:** 需要目标DVR设备的IP地址和端口（通常是80端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞允许攻击者通过设置 'Cookie: uid=admin' HTTP头部来绕过身份验证。PoC代码 `thecctv.py` 通过发送带有该Cookie的请求到 `/device.rsp?opt=user&cmd=list` 路径，从而获取设备的用户凭据（用户名和密码）。利用方式简单，只需要提供目标设备的IP地址和端口。

**有效性评估：**
根据漏洞描述和PoC代码，利用的有效性较高。PoC利用了HTTP头部注入，绕过了正常的登录验证过程。

**投毒风险分析：**
虽然脚本主要功能是利用漏洞，但存在以下潜在投毒风险：
1. **信息收集：** 脚本获取目标的IP和端口，可能收集并上传至攻击者服务器。
2. **恶意修改：** 攻击者可能修改脚本，在获取凭据后执行恶意操作，例如修改设备配置、删除录像等。
3. **依赖风险：** 脚本依赖 `requests` 和 `colorama` 库，如果这些库被恶意篡改，可能导致脚本执行恶意代码。

基于以上分析，投毒风险评估为10%。主要风险在于脚本本身的功能可能被用于大规模扫描和攻击，以及可能被篡改以执行恶意操作，但代码本身比较简单，没有发现明显恶意代码，因此投毒风险相对较低。

**利用方式：**
1.  使用搜索引擎（如ZoomEye）搜索暴露`/login.rsp` 路径的DVR设备。
2.  运行`thecctv.py`脚本。
3.  输入目标DVR设备的IP地址和端口。
4.  脚本将自动发送包含恶意Cookie的HTTP请求，并尝试获取用户凭据。

**项目地址:** [awesome-consumer-iot/HTC](https://github.com/awesome-consumer-iot/HTC)

**漏洞详情:** [CVE-2018-9995](https://nvd.nist.gov/vuln/detail/CVE-2018-9995)