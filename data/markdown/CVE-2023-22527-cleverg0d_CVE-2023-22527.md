## CVE-2023-22527 - Confluence OGNL 注入 RCE

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Atlassian Confluence Server 和 Data Center

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** Confluence 实例版本在受影响范围内，并且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22527 是 Atlassian Confluence Server 和 Data Center 中的一个模板注入漏洞，允许未经身份验证的攻击者实现远程代码执行。该漏洞位于处理 `text-inline.vm` 模板的位置，利用了 OGNL 表达式注入。攻击者可以通过构造特殊的 POST 请求，将恶意的 OGNL 表达式作为 `label` 参数的一部分发送到 `/template/aui/text-inline.vm` 端点。 

POC 代码通过发送包含 OGNL 表达式的 POST 请求，利用 `#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(#parameters.x,{})` 获取 OGNL 上下文，并执行 `x` 参数中的 OGNL 表达式。该 POC 使用 `freemarker.template.utility.Execute` 执行系统命令 `id`，并将结果通过 HTTP 响应头 `X-Cmd-Response` 返回。

**漏洞利用方式:**

1.  攻击者向目标 Confluence 服务器的 `/template/aui/text-inline.vm` 端点发送特制的 POST 请求。
2.  请求体中的 `label` 参数包含 OGNL 表达式，该表达式允许攻击者执行任意代码。
3.  OGNL 表达式使用 `freemarker.template.utility.Execute` 类执行系统命令。
4.  命令执行的结果通过 HTTP 响应头返回，或者用于进一步的攻击，例如部署恶意软件。

**有效性:**

根据漏洞信息、搜索结果和 POC 代码，该 POC 代码**有效**，因为搜索引擎结果指向了多个利用此漏洞进行 RCE 的案例。

**投毒风险:**

查看提供的漏洞利用代码，只包含了一个用于验证漏洞的POST请求，其中执行了id命令。
README.md文件主要描述了漏洞信息,EPSS评分和CISA目录。
综合来看，**不存在作者隐藏的投毒代码，投毒风险为 0%**。

**项目地址:** [cleverg0d/CVE-2023-22527](https://github.com/cleverg0d/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)