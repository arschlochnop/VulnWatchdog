## CVE-2023-22527-Atlassian Confluence-远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence Data Center 和 Server

**危害等级:** 高危，允许未授权的攻击者执行任意代码

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例版本在受影响范围内，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22527 是 Atlassian Confluence Server 和 Data Center 中的一个模板注入漏洞，允许未经身份验证的攻击者远程执行代码。漏洞位于 `/template/aui/text-inline.vm` 路径。该漏洞利用了 OGNL 表达式注入。攻击者可以通过构造恶意请求，利用 Velocity 模板引擎执行任意代码。 

**有效性：**
提供的PoC代码有效。它通过向 `/template/aui/text-inline.vm` 发送包含恶意 OGNL 表达式的 POST 请求来利用此漏洞。PoC 包含检测和利用两个功能。检测功能检查服务器是否在响应头中返回 `X-Cmd-Response` 字段，以确认漏洞存在。利用功能允许攻击者执行任意命令，并将结果放在 `X-Cmd-Response` 标头中返回。

**投毒风险：**
该仓库中未发现明显的投毒代码。代码逻辑清晰，主要功能是发送包含恶意 OGNL 表达式的 HTTP 请求，并解析响应头。该PoC只是验证漏洞，没有发现后门等恶意代码。

**利用方式：**
1.  **漏洞定位：** 该漏洞存在于受影响 Confluence 实例的 `/template/aui/text-inline.vm` 路径。
2.  **请求构造：** 攻击者需要构造一个包含恶意 OGNL 表达式的 POST 请求，表达式利用 `freemarker.template.utility.Execute` 类执行任意系统命令。
3.  **命令执行：**  服务器接收到请求后，Velocity 模板引擎会解析并执行 OGNL 表达式，从而执行攻击者指定的命令。
4.  **结果获取：** 命令执行的结果通过 `X-Cmd-Response` HTTP 响应头返回给攻击者。 

**注意：** 根据搜索结果，此漏洞已被广泛利用于攻击，包括加密货币挖矿和勒索软件部署。

**项目地址:** [Niuwoo/CVE-2023-22527](https://github.com/Niuwoo/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)