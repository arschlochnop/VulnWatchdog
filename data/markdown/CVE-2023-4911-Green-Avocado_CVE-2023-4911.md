## CVE-2023-4911-glibc-ld.so-本地提权

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 本地缓冲区溢出提权

**影响应用:** glibc

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** glibc 2.34 到 glibc 2.39之前的版本，Ubuntu 22.04, Ubuntu GLIBC 2.35-0ubuntu3.1

**利用条件:** 需要本地用户权限，ASLR开启或关闭均可（POC中提供了关闭ASLR的选项）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-4911 是 glibc 动态链接器 ld.so 中的缓冲区溢出漏洞，当处理 GLIBC_TUNABLES 环境变量时发生。该漏洞允许本地攻击者通过精心构造的 GLIBC_TUNABLES 环境变量，在使用 SUID 权限启动二进制文件时执行具有提升权限的代码。

**利用方式：**

1.  **漏洞触发：**  利用 `GLIBC_TUNABLES` 环境变量的解析过程中的缓冲区溢出。`poc.c` 代码构造了超长的 `GLIBC_TUNABLES` 环境变量，触发缓冲区溢出。
2.  **控制程序流程：**  通过覆盖内存中的关键数据结构，劫持程序执行流程。
3.  **权限提升：**  利用 SUID 程序（如 `/usr/bin/su`）执行 shellcode，获得 root 权限。

**POC代码分析：**

*   `Dockerfile`：用于构建包含漏洞利用代码和所需依赖的 Docker 镜像。
*   `README.md`：提供了漏洞描述、利用步骤、调试方法和构建说明。
*   `gdbscript`：用于调试漏洞利用过程的 GDB 脚本。
*   `patch.py`：用于修改 `/lib/x86_64-linux-gnu/libc.so.6` 文件，替换 `__libc_start_main` 函数为 shellcode，该shellcode的功能为提权。
*   `poc.c`：漏洞利用的 POC 代码，构造恶意的 `GLIBC_TUNABLES` 环境变量，覆盖内存数据结构，劫持程序执行流程。

**投毒风险分析：**

检查了POC代码，`patch.py`中的shellcode就是提权的shellcode, 没有发现作者隐藏的其他恶意代码，因此判定投毒风险为0%。该代码利用了公开的漏洞信息，并构造了相应的利用代码。

**结论：**

提供的 POC 代码有效，可以用于在受影响的系统上进行本地权限提升。没有发现投毒代码。需要注意在实际环境中，ASLR 可能会增加漏洞利用的难度，但 POC 提供了关闭 ASLR 的方法。

**项目地址:** [Green-Avocado/CVE-2023-4911](https://github.com/Green-Avocado/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)