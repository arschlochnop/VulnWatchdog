## CVE-2021-31956 Windows NTFS 权限提升漏洞

**漏洞编号:** CVE-2021-31956

**漏洞类型:** 权限提升

**影响应用:** Windows NTFS

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

根据漏洞信息和搜索结果，CVE-2021-31956是一个Windows NTFS权限提升漏洞。该漏洞允许本地攻击者通过利用NTFS文件系统中的缺陷，提升自己的权限。

**1. 有效性:**

*   搜索结果表明该漏洞已被公开披露，并存在利用代码。
*   提供的漏洞利用代码是一个Visual Studio解决方案，包含C++源代码，表明该漏洞的利用是可行的。
*   README.md文件提到是WIP PoC, 存在不稳定性。

综合判断，提供的POC代码具有一定的有效性，但可能不够稳定，需要进一步完善。

**2. 投毒风险:**

*   分析提供的C++代码需要反编译和代码审计。
*   README.md文件中提到该代码是从其他项目fork而来，存在引用第三方代码的风险。
*   代码的编译环境可能被植入恶意代码。
*   该PoC代码本身是为了利用漏洞，因此也可能包含一些潜在的风险。

综合判断，此仓库中存在一定投毒代码的风险，估计为30%。

**3. 利用方式:**

*   **漏洞原理：** 该漏洞是由于NTFS文件系统处理特定操作时存在缺陷，导致内核内存损坏，从而允许权限提升。
*   **利用步骤：**
    1.  精心构造特定的NTFS文件系统操作，触发漏洞。
    2.  利用内核内存损坏，覆盖关键数据结构，例如进程令牌(Token)。
    3.  将当前进程的令牌替换为SYSTEM用户的令牌，从而提升权限。

    **利用细节**:
        *   该漏洞利用可能涉及到 Windows Notification Facility (WNF)。
        *   利用需要对内核内存布局和数据结构有深入的了解。
        *   利用过程可能需要进行内存池喷射（Pool Feng Shui）等技术，以提高利用的可靠性。

**4. 排序优先级**

    *   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**
        *   搜索引擎结果提供了漏洞相关的分析文章和利用案例，可以帮助了解漏洞的细节和利用方法。
        *   漏洞利用代码提供了实际的POC代码，可以验证漏洞的存在性和利用效果。
        *   漏洞库信息提供了漏洞的基本信息，例如受影响的版本和CVSS评分，可以帮助评估漏洞的风险。


**项目地址:** [hoangprod/CVE-2021-31956-POC](https://github.com/hoangprod/CVE-2021-31956-POC)

**漏洞详情:** [CVE-2021-31956](https://nvd.nist.gov/vuln/detail/CVE-2021-31956)