## CVE-2007-2447-Samba远程命令注入

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令注入

**影响应用:** Samba

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 需要启用 "username map script" smb.conf 选项 (对于 SamrChangePassword 函数) 或者需要远程身份验证 (对于其他 MS-RPC 函数如远程打印和文件共享管理)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2007-2447 存在于 Samba 3.0.0 到 3.0.25rc3 版本中。漏洞原因是 smbd 中的 MS-RPC 功能在处理某些函数时，没有正确过滤 shell 元字符，导致远程攻击者可以执行任意命令。

**漏洞利用方式：**

1.  **SamrChangePassword 函数 (需要 "username map script")：** 当启用了 `username map script` 选项时，攻击者可以通过向 `SamrChangePassword` 函数传递包含 shell 元字符的恶意用户名，执行任意命令。
2.  **其他 MS-RPC 函数 (需要身份验证)：** 经过身份验证的远程用户可以通过其他 MS-RPC 函数（如远程打印和文件共享管理）中的 shell 元字符注入来执行命令。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有多个安全公告和报告确认了其存在和危害。cvedetails.com的搜索结果也表明存在利用该漏洞的模块。

**投毒风险：**

提供的漏洞利用代码 `/tmp/fe0bd9ec613e8863209916448a9a059e/README.md` 内容非常简短，仅包含 CVE 编号和分隔符，实际利用需要更多代码才能构造 payload，因此判断存在投毒的概率相对较低。此处的“投毒”指的是例如，在完整的利用代码中，攻击者可能会包含一些恶意代码，例如删除关键文件、安装后门等。 因为当前的payload只是一个README.md文件，所以投毒概率相对较低。 只有10%是因为无法完全排除人为添加恶意描述的可能.

**总结：**
该漏洞的利用主要依赖于向易受攻击的 MS-RPC 函数传递包含 shell 元字符的参数。对于 `SamrChangePassword` 函数，需要 `username map script` 选项的配合；对于其他函数，则需要远程身份验证。成功利用该漏洞可以导致远程代码执行，对系统安全构成严重威胁。

**项目地址:** [testaross4/CVE-2007-2447](https://github.com/testaross4/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)