## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** 10.0 < 10.7.1, 11.0 < 11.1.0

**利用条件:** 目标服务器运行受影响的CrushFTP版本，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（在VFS沙箱之外），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**漏洞利用方式：**

1.  **建立会话:** PoC 首先尝试通过访问 `/WebInterface/` 建立一个 AJAX 会话，并提取 `CrushAuth` 和 `currentAuth` 这两个重要的 cookie。这是利用漏洞的关键前提，因为后续的请求需要这些 cookie 来进行利用。
2.  **SSTI 注入：** PoC 使用 `currentAuth` cookie 构造包含恶意模板的URL，该模板使用`{{hostname}}` 尝试执行命令来获取主机名。PoC 通过发送一个带有特制 URL 的 POST 请求到 `/WebInterface/function/` 端点，其中 `command=zip` 和 `path={{hostname}}`是注入点。服务器处理此请求时，会将`{{hostname}}`模板指令渲染为主机名，如果成功，服务器返回主机名。
3.  **身份验证绕过尝试:**  PoC尝试使用 `working_dir` 参数绕过身份验证。

**有效性：**

根据漏洞库信息、搜索引擎结果（特别是 Rapid7 的分析）以及提供的漏洞利用代码，此 PoC 代码是有效的。PoC 的目标是利用 SSTI 漏洞读取服务器上的文件和执行命令。

**投毒风险：**

虽然 PoC 代码的功能主要是利用 SSTI 漏洞，但仍然存在一些小的潜在投毒风险：

*   **依赖项风险：** PoC 依赖于 `requests`、`urllib3` 和 `rich` 库。如果这些库的来源不可信或被篡改，可能会引入恶意代码。
*   **代码执行风险：** 漏洞利用代码本身会执行服务器返回的结果，如果攻击者能够控制服务器返回的内容，可能会执行恶意代码。
*   **作者意图不明：** 虽然代码表面上是合法的 PoC，但作者可能在代码中隐藏了不易察觉的恶意逻辑。但目前没有明显证据表明存在恶意代码。

综合评估，投毒风险约为 10%。该PoC主要依赖已知的SSTI利用方式，而隐藏恶意代码的可能性较低，但仍然需要保持警惕，尤其是在使用来自非官方渠道的 PoC 代码时。


**项目地址:** [geniuszly/GenCrushSSTIExploit](https://github.com/geniuszly/GenCrushSSTIExploit)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)