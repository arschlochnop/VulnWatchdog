## CVE-2018-11776-Apache Struts-远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true, 存在结果页面且上层package没有namespace或为通配符namespace, 或使用url tag 且没有value和action属性且上层package没有namespace或为通配符namespace。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2018-11776 是一个 Apache Struts 2 的远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞是由于Struts框架在特定配置下，对namespace处理不当，导致OGNL表达式注入，最终实现远程代码执行。漏洞影响版本为2.3到2.3.34以及2.5到2.5.16。

**有效性：**

提供的POC代码使用了 OGNL 表达式注入来执行系统命令。其原理是利用Struts框架的漏洞，构造恶意的URL，将OGNL表达式作为参数传递给服务器，服务器在解析参数时执行了该表达式，从而实现了远程代码执行。代码通过修改 OgnlUtil 类的 excludedPackageNames 和 excludedClasses 属性，绕过 Struts 的安全限制。POC利用了multipart/form-data的Content-Type来触发漏洞。基于搜索结果和漏洞库信息，该漏洞存在公开可用的expoloit，证明该PoC有效。

**投毒风险：**

提供的POC代码中，最可疑的地方是向目标服务器发送恶意构造的HTTP请求，存在注入恶意指令的潜在可能。但是，该代码的主要目的是利用已知漏洞执行命令，而非植入后门或恶意软件。虽然可能被滥用，但是从代码逻辑来看，主要功能是进行漏洞验证和利用，没有发现明显的恶意代码，因此可以认为不存在作者隐藏的投毒代码，存在投毒风险的概率较低，大概为1%。

**利用方式：**

1.  **确定目标Struts版本：** 确认目标应用使用的Struts版本在受影响范围内（2.3 to 2.3.34, 2.5 to 2.5.16）。
2.  **确认配置：** 确认 alwaysSelectFullNamespace 为 true，并且符合漏洞触发的特定条件(没有namespace或为通配符namespace)。
3.  **构造恶意URL：** 使用类似POC代码中使用的 OGNL 表达式，构造包含要执行的系统命令的恶意URL。
4.  **发送HTTP请求：** 使用工具如curl或POC代码中的urllib2，向目标服务器发送构造好的HTTP请求。
5.  **执行命令：** 如果漏洞存在，服务器将执行OGNL表达式中的系统命令，攻击者可以获取服务器的控制权。

**项目地址:** [arlyone/Apache-Struts-0Day-Exploit](https://github.com/arlyone/Apache-Struts-0Day-Exploit)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)