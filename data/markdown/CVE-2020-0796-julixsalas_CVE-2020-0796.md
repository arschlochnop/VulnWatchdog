## CVE-2020-0796 - SMBGhost 远程代码执行漏洞

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危，可能导致远程代码执行和网络传播

**影响版本:** Windows 10 版本 1903 和 1909，Windows Server 版本 1903 和 1909

**利用条件:** 目标系统启用SMBv3协议，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-0796（又名SMBGhost）是Microsoft Server Message Block (SMB) v3.1.1协议处理特定请求时存在远程代码执行漏洞。漏洞存在于SMBv3压缩功能中，未经身份验证的攻击者可以通过特制的SMBv3数据包利用此漏洞。成功利用此漏洞的攻击者可以在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果（如CISA的警告和多个PoC代码的提及）以及提供的漏洞利用代码，可以判断此漏洞的PoC代码是有效的。漏洞利用代码能够检测目标是否存在漏洞，并在一定条件下实现远程代码执行。

**投毒风险：**
提供的代码是一个简单的漏洞扫描器，用于检测目标系统是否存在CVE-2020-0796漏洞。代码主要功能是建立TCP连接，发送SMB协商协议数据包，然后根据返回的数据包判断是否存在漏洞。代码本身较为简单，主要风险来自于`module.log`函数，如果该函数被恶意修改，有可能在日志中泄露敏感信息。投毒的概率较低，约为5%。

**利用方式：**
利用方式主要分为以下几个步骤：
1.  **发送恶意SMB协商协议数据包：** 攻击者构造包含错误压缩参数的SMBv3协商协议数据包。
2.  **触发整数溢出：** 目标系统在处理该数据包时，由于压缩大小的计算存在整数溢出，导致后续的内存分配错误。
3.  **内存破坏：** 溢出导致内存破坏，攻击者可以利用此破坏覆盖关键数据或代码。
4.  **代码执行：** 通过精心构造的内存布局，攻击者最终可以在目标系统上执行任意代码。

提供的Python代码实际上是一个扫描模块，用于检测目标系统是否易受攻击。实际的漏洞利用需要更复杂的Payload，通常会借助Metasploit等渗透测试框架。

**项目地址:** [julixsalas/CVE-2020-0796](https://github.com/julixsalas/CVE-2020-0796)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)