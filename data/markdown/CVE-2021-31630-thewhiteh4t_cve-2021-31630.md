## CVE-2021-31630-OpenPLC Webserver v3-命令注入

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver v3

**危害等级:** 高危，可导致远程代码执行

**影响版本:** v3

**利用条件:** 需要身份验证和网络访问/hardware页面

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于OpenPLC Webserver v3的/hardware页面，攻击者可以通过“Hardware Layer Code Box”组件注入恶意命令。漏洞利用方式如下：

1.  **漏洞描述：** CVE-2021-31630 是 OpenPLC Webserver v3 中的一个命令注入漏洞，允许经过身份验证的远程攻击者通过 `/hardware` 页面的 "Hardware Layer Code Box" 组件执行任意代码。
2.  **搜索引擎结果：** 多个搜索结果表明该漏洞的描述，影响版本和利用方法。其中github链接指向了可利用的poc代码
3.  **漏洞利用代码分析：**
    *   POC 代码是一个 Python 脚本，用于利用 OpenPLC Webserver v3 中的命令注入漏洞。
    *   脚本首先登录到 OpenPLC Webserver v3，默认用户名和密码为 openplc/openplc。
    *   然后，脚本将默认程序还原，接着上传一个包含反向 shell 的特制 C 代码到`/hardware` 页面的 "Hardware Layer Code Box"。
    *   上传的C代码会被编译和执行，从而在目标系统上建立一个反向 shell 连接到攻击者的机器，IP地址和端口由脚本参数`-lh` 和 `-lp`指定。
    *   最后，脚本停止并清理PLC服务。
4.  **有效性评估：** 提供的 POC 代码有效，能够实现远程代码执行。
5.  **投毒风险评估：**
    *   该仓库的主要功能是提供漏洞利用代码，帮助研究人员验证和理解漏洞，但并不能完全排除投毒风险。
    *   `cve_2021_31630.py` 主要功能是利用漏洞，其本身没有明显的恶意代码，但使用者有可能会修改此脚本植入恶意代码
    *   `README.md`文件描述了漏洞利用过程和代码功能。
    *   综合来看，投毒风险较低，但是由于代码可能被篡改，仍存在一定的潜在风险。投毒风险估算为5%。
6. **漏洞利用方式：**
  1. 登录到OpenPLC Webserver v3。
  2. 停止当前PLC服务，清理环境。
  3. 上传包含恶意命令的C代码（通过`custom_layer_code`参数）到 `/hardware` 页面的 "Hardware Layer Code Box" 组件。
  4. 触发编译过程 (`/compile-program?file=blank_program.st`)，使恶意代码得到执行。
  5. 启动PLC服务，执行恶意代码（反向shell）
  6. 清理PLC服务。


**项目地址:** [thewhiteh4t/cve-2021-31630](https://github.com/thewhiteh4t/cve-2021-31630)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)