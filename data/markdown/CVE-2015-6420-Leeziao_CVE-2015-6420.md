## CVE-2015-6420 - Cisco 产品 Java 反序列化漏洞

**漏洞编号:** CVE-2015-6420

**漏洞类型:** Java 反序列化

**影响应用:** Cisco 产品 (多种)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本未知，需要根据具体Cisco产品判断

**利用条件:** 需要目标系统存在漏洞，并能向其发送恶意序列化数据

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2015-6420 漏洞是由于 Cisco 的多个产品中使用了存在漏洞的 Apache Commons Collections (ACC) 库，允许远程攻击者通过构造恶意的 Java 序列化对象来执行任意命令。  

**有效性：**根据漏洞描述和搜索结果，此漏洞允许远程代码执行，因此PoC 代码若能成功执行命令，则被认为是有效的。

**投毒风险：**
提供的“漏洞利用代码”是一个 drawio 图，展示了利用链。本身不是可执行的代码，只是漏洞利用过程的流程图，帮助理解反序列化的过程。由于不是直接可执行的代码，所以即使有投毒，也只是理论上的。比如，流程图指向错误的类，但实际利用时，攻击者会使用正确的类。

然而，**理论上存在极低的投毒风险** (5%)。如果攻击者依赖于此流程图来构建攻击载荷，流程图中的细微错误可能会导致攻击失败。例如，某个方法名拼写错误，或者类名与实际的不完全一致，都有可能使攻击无法完成。因此，在使用此图时，务必仔细核对利用链，确保每个步骤的准确性。

**利用方式：**
1.  **漏洞触发点:** 攻击者向存在漏洞的Cisco产品发送特制的Java序列化对象。
2.  **利用链:** `sun.reflect.annotation.AnnotationInvocationHandler.readObject()` 触发反序列化过程。
3.  `org.apache.commons.collections.map.AbstractInputCheckedMapDecorator.setValue()` 对map的value进行操作
4.  `org.apache.commons.collections.map.TransformedMap.checkSetValue()` 对setValue的值进行检查，触发transformer
5.  `org.apache.commons.collections.functors.ChainedTransformer.transform()`  链式调用多个 transformer。
6.  通过精心构造 `ChainedTransformer`，可以使用 `ConstantTransformer`, `InvokerTransformer` 等 functor 执行任意代码。

总而言之，攻击者通过发送恶意的序列化数据，利用 Apache Commons Collections 库中的 `TransformedMap` 和 `ChainedTransformer` 等类，最终实现远程代码执行。

**项目地址:** [Leeziao/CVE-2015-6420](https://github.com/Leeziao/CVE-2015-6420)

**漏洞详情:** [CVE-2015-6420](https://nvd.nist.gov/vuln/detail/CVE-2015-6420)