## CVE-2019-18634-Sudo-Stack Buffer Overflow

**漏洞编号:** CVE-2019-18634

**漏洞类型:** Stack Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可能导致权限提升

**影响版本:** < 1.8.26

**利用条件:** pwfeedback 在 /etc/sudoers 中被启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-18634 是 Sudo 1.8.26 之前版本中存在的栈缓冲区溢出漏洞。当 /etc/sudoers 文件中启用了 pwfeedback 选项时，攻击者可以通过向 tgetpass.c 中的 getln() 函数的标准输入 (stdin) 传递一个长字符串来触发该漏洞，导致特权 sudo 进程中的栈缓冲区溢出。利用代码包含一个`exec.c` 文件, 用于修改 `/proc/self/exe` 文件权限为SUID,并尝试调用 `/bin/bash` 获取shell，或者直接调用`/bin/bash`。 `exploit.py` 脚本生成溢出payload，包含大量的null字节填充,以及一些标志位和user_details数据。 `run.py` 脚本负责编译`exec.c`，设置环境变量`SUDO_ASKPASS`指向编译后的`exec.c`,然后通过`sudo -k -S id` 命令触发漏洞。

**有效性：** 根据搜索结果和漏洞描述，提供的POC代码应该有效，前提是目标系统满足漏洞利用的条件（sudo 版本低于 1.8.26 且启用了 pwfeedback）。

**投毒风险：** 该代码的主要功能是权限提升，但存在轻微的投毒风险。`exec.c`首先修改了`/proc/self/exe`的权限为SUID。虽然这在漏洞利用后允许非特权用户执行`exec.c`来获得root权限，但是恶意攻击者可能会利用这一点来植入后门。此外，exploit的有效性依赖于pwfeedback的开启，这本身不是一个默认配置，可能导致exploit无法工作，或被攻击者诱导开启该配置。整体投毒风险较低，约为 10%。

**利用方式：**

1.  **前提条件：** 目标系统运行着存在漏洞的 Sudo 版本 (低于 1.8.26)，且 /etc/sudoers 文件中启用了 pwfeedback 选项。
2.  **Payload生成：** 使用 `exploit.py` 脚本生成用于触发缓冲区溢出的恶意payload。
3.  **编译和执行：** 编译 `exec.c`，并设置 `SUDO_ASKPASS` 环境变量指向编译后的可执行文件。
4.  **漏洞触发：** 通过执行 `sudo -k -S id < /tmp/pty` 命令，触发 sudo 请求密码，从而调用 `getln()` 函数，并将恶意 payload 传递给它，导致栈缓冲区溢出。
5.  **权限提升：** 成功溢出后，程序执行流程被劫持，最终通过修改自身权限或直接调用`/bin/bash`获取 root 权限。


**项目地址:** [N1et/CVE-2019-18634](https://github.com/N1et/CVE-2019-18634)

**漏洞详情:** [CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)