## CVE-2024-0582 - Linux Kernel io_uring Use-After-Free

**漏洞编号:** CVE-2024-0582

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致权限提升或系统崩溃

**影响版本:** < 6.4.0

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0582 是 Linux 内核 io_uring 子系统中的一个 use-after-free 漏洞。当用户使用 IORING_REGISTER_PBUF_RING 注册 buffer ring，并使用 mmap() 映射它，然后释放它时，会发生此漏洞。

**有效性分析：**
根据漏洞库信息，该漏洞存在于 Linux kernel 6.4 之前的版本。提供的 POC 代码（`exploit.c`）利用了该漏洞，并参考了 CVE-2023-2598 的利用方式。从搜索结果来看，该漏洞已被公开披露，并且存在多个可用的 Exploit 代码。

**投毒风险分析：**

该 POC 代码相对复杂，涉及 io_uring 接口的大量使用，代码量也比较大，增加分析难度。

*   代码中存在大量的系统调用和内存操作，这增加了代码的潜在风险，即攻击者可能利用这些操作来执行恶意代码。
*   POC 代码本身的目标是提升权限，本质上就具有一定的“破坏性”。
*   代码中包含`#define target_tty_dev "/dev/ttyS0"`，`/dev/ttyS0`一般是串口设备，攻击者可能会利用它进行控制或窃取信息
*  代码大量使用偏移地址 `#define sk_data_ready_off 680` `#define TCP_OFFSET 1400` `#define IOCTL_OFFSET 40` `#define call_usermodehelper_exec 0xa38f0` `#define call_usermodehelper_exec_work 0xa3cb0` 这些硬编码的偏移地址，可能会导致代码在不同内核版本上失效，也可能被利用进行恶意操作。

因此，综合考虑，该 POC 代码可能存在一定投毒风险，风险占比大约为 10%。

**利用方式分析：**

1.  **Buffer Ring 注册与映射：** 利用 `io_uring_register_buf_ring` 注册 buffer ring，然后使用 `mmap()` 将其映射到用户空间。
2.  **Use-After-Free 触发：** 释放 buffer ring 后，仍然可以访问已释放的内存，从而触发 use-after-free 漏洞。
3.  **权限提升：** 通过精心构造的数据，覆盖内核中的敏感数据结构，例如 `task_struct` 的 `cred` 字段，从而提升权限。具体利用方式参考 CVE-2023-2598 的利用方法。
4. **call_usermodehelper:** 代码定义了 `call_usermodehelper_exec` 和 `call_usermodehelper_exec_work` 偏移量，这表明该漏洞利用可能涉及调用 `call_usermodehelper` 函数来执行用户态代码，实现权限提升。

**项目地址:** [ysanatomic/io_uring_LPE-CVE-2024-0582](https://github.com/ysanatomic/io_uring_LPE-CVE-2024-0582)

**漏洞详情:** [CVE-2024-0582](https://nvd.nist.gov/vuln/detail/CVE-2024-0582)