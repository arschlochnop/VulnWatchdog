## CVE-2023-3824 - PHP Phar 堆栈缓冲区溢出

**漏洞编号:** CVE-2023-3824

**漏洞类型:** 堆栈缓冲区溢出

**影响应用:** PHP

**危害等级:** 高危，可能导致内存破坏或远程代码执行（RCE）

**影响版本:** PHP 8.0.* < 8.0.30, 8.1.* < 8.1.22, 8.2.* < 8.2.8

**利用条件:** 需要能够加载恶意的Phar文件

**POC 可用性:** 是，但需要进一步分析

**投毒风险:** 10%

## 详情

CVE-2023-3824 是 PHP 中 Phar 扩展中的一个堆栈缓冲区溢出漏洞。当 PHP 加载 Phar 文件并读取目录条目时，由于长度检查不足，可能导致缓冲区溢出，进而造成内存破坏或远程代码执行。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞是一个真实存在的，且影响多个PHP版本。由于提供的POC代码只是一个指向 codeberg 仓库的链接，需要进一步分析仓库内容来确定其有效性。但是考虑到漏洞描述的细节以及多个来源的确认，该漏洞具有较高的可利用性。

**投毒风险：** 提供的漏洞利用代码只有一个指向 codeberg 仓库的 README.md 文件。虽然直接评估这个文件无法判断是否存在投毒代码，但考虑到以下几点：
    * 仓库的来源 (codeberg) 相对比较干净，比github投毒风险低。
    * POC本身目的如果是漏洞验证，植入后门反而影响验证效果。
    * README.md的内容非常简洁，只有链接，没有明显的投毒迹象。

    因此，投毒的可能性较低。我们仍然不能排除下载的POC代码仓库中存在其他被隐藏的恶意代码的可能性。所以综合判断，认为存在10%的投毒风险。

**利用方式：** 利用方式主要分为以下几个步骤：

1.  **构造恶意的Phar文件：** 攻击者需要构造一个恶意的Phar文件，该文件包含特制的目录条目，这些条目的长度超过了PHP在读取时分配的缓冲区大小。
2.  **触发漏洞：** 攻击者需要找到一种方法让目标PHP应用程序加载这个恶意的Phar文件。这可能涉及文件上传、文件包含或其他允许加载phar文件的机制。
3.  **溢出利用：** 当PHP尝试读取Phar文件的目录条目时，由于长度检查不足，数据会溢出缓冲区，覆盖堆栈上的其他数据。攻击者可以利用这一点来覆盖函数返回地址，跳转到任意代码执行。

总而言之，该漏洞是一个严重的安全问题，攻击者可以利用它来实现远程代码执行，因此及时更新PHP版本至不受影响的版本至关重要。

**项目地址:** [bluefish3r/poc-cve](https://github.com/bluefish3r/poc-cve)

**漏洞详情:** [CVE-2023-3824](https://nvd.nist.gov/vuln/detail/CVE-2023-3824)