## CVE-2024-46982-Next.js 缓存投毒

**漏洞编号:** CVE-2024-46982

**漏洞类型:** 缓存投毒

**影响应用:** Next.js

**危害等级:** 高危，可能导致XSS、DoS和数据泄露

**影响版本:** 13.5.1 <= version < 13.5.7, 14.0.0 <= version < 14.2.10

**利用条件:** 需要Next.js版本在受影响范围内，使用pages router，且目标路由为非动态服务端渲染路由。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Next.js的缓存机制中，通过构造特殊的HTTP请求，可以毒化非动态服务端渲染路由的缓存，导致服务器缓存了不应该缓存的内容。攻击者可以通过注入恶意Payload（例如XSS代码）到User-Agent头中，使服务器缓存包含恶意代码的响应，当其他用户访问被毒化的页面时，恶意代码会被执行，导致XSS攻击。此外，攻击者还可以通过发送大量的恶意请求，耗尽服务器资源，导致DoS攻击。从提供的代码来看，该工具通过读取targets.txt中的目标URL和payloads.txt中的Payload，然后向目标URL发送包含Payload的HTTP请求，并检查响应中是否包含Payload来判断目标是否存在漏洞。代码中没有发现明显的投毒行为。 漏洞利用方式是向目标站点的特定URL（/poc?__nextDataReq=1）发送GET请求，并在请求头中设置User-Agent和x-now-route-matches。User-Agent包含恶意Payload（例如XSS代码），x-now-route-matches设置为1。如果目标站点存在漏洞，服务器会将包含恶意Payload的响应缓存起来。当其他用户访问该页面时，恶意Payload会被执行。

**项目地址:** [Lercas/CVE-2024-46982](https://github.com/Lercas/CVE-2024-46982)

**漏洞详情:** [CVE-2024-46982](https://nvd.nist.gov/vuln/detail/CVE-2024-46982)