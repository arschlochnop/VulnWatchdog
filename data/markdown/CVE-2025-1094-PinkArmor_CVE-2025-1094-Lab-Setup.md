## CVE-2025-1094-PostgreSQL-SQL注入

**漏洞编号:** CVE-2025-1094

**漏洞类型:** SQL注入

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 17.3, < 16.7, < 15.11, < 14.16, < 13.19

**利用条件:** 需要目标PostgreSQL服务器client_encoding为BIG5, server_encoding为EUC_TW或MULE_INTERNAL, 以及目标应用使用PQescapeLiteral(), PQescapeIdentifier(), PQescapeString(), 和 PQescapeStringConn()函数且未进行充分的输入验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-1094漏洞存在于PostgreSQL的libpq函数中，由于在PQescapeLiteral(), PQescapeIdentifier(), PQescapeString(), 和 PQescapeStringConn()中未正确处理编码验证失败的文本中的引号语法，导致SQL注入。

**有效性评估：**
提供的POC代码针对PostgreSQL 14.15版本，该版本在受影响的版本范围内。通过Docker部署了易受攻击的PostgreSQL实例，并提供了一个Python脚本来利用该漏洞。利用方式是注入畸形的UTF-8编码，绕过输入验证，并使用`COPY ... TO PROGRAM`执行任意shell命令，最终获得反向shell。根据描述和代码逻辑，POC代码应该是有效的。

**投毒风险分析：**
提供的代码包含两个文件：`README.md` 和 `exploit.py`。`README.md` 描述了漏洞和利用过程，其中包含免责声明。`exploit.py` 是实际的漏洞利用代码，负责连接到PostgreSQL服务器并发送恶意payload。代码主要功能是利用漏洞获取反向shell。然而，在`exploit.py`中，存在可疑的`im`，怀疑作者存在隐藏的投毒代码。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境准备：** 使用Docker部署易受攻击的PostgreSQL版本（<= 14.15）。
2.  **配置目标服务器：** 设置目标PostgreSQL服务器的`client_encoding`为`BIG5`，`server_encoding`为`EUC_TW`或`MULE_INTERNAL`。
3.  **启动监听器：** 在攻击者机器上启动一个监听器（例如，使用`nc -lvnp 4444`）以接收反向shell。
4.  **运行攻击脚本：** 运行提供的Python脚本，指定目标PostgreSQL服务器的IP地址、攻击者机器的IP地址和监听端口。
5.  **获取反向shell：** 如果利用成功，攻击者将收到来自易受攻击的PostgreSQL容器的反向shell，从而可以在服务器上执行任意命令。

**项目地址:** [PinkArmor/CVE-2025-1094-Lab-Setup](https://github.com/PinkArmor/CVE-2025-1094-Lab-Setup)

**漏洞详情:** [CVE-2025-1094](https://nvd.nist.gov/vuln/detail/CVE-2025-1094)