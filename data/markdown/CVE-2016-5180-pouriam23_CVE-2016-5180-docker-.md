## CVE-2016-5180-c-ares 堆缓冲区溢出

**漏洞编号:** CVE-2016-5180

**漏洞类型:** 堆缓冲区溢出

**影响应用:** c-ares

**危害等级:** 高危，可能导致拒绝服务或远程代码执行

**影响版本:** c-ares 1.x before 1.12.0

**利用条件:** 需要应用程序使用c-ares库进行DNS解析，并且可以控制或影响被解析的域名。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞信息，CVE-2016-5180是c-ares 1.12.0之前版本中`ares_create_query`函数中存在的一个基于堆的缓冲区溢出漏洞。攻击者可以通过构造包含转义尾点（escaped trailing dot）的恶意hostname，导致越界写入，从而可能导致拒绝服务或任意代码执行。

**有效性：**

提供的PoC代码是一个Node.js应用，它模拟了一个可能受到该漏洞影响的场景。应用接受用户提供的URL作为callback，并使用`dns.resolve`函数解析该URL的hostname。由于Node.js的`dns.resolve`底层使用了c-ares库，如果c-ares库的版本存在漏洞，则该应用会受到CVE-2016-5180的影响。该POC验证了可以通过控制hostname（callback URL）来触发漏洞，因此有效。

**投毒风险：**

分析提供的Dockerfile、package.json和server.js文件，没有发现任何明显的投毒代码。代码逻辑清晰，主要功能是接收URL并使用dns.resolve进行解析。所有依赖项都是常用的npm库。 因此，投毒风险评估为0%。

**利用方式：**

1.  **攻击者构造恶意的hostname**：hostname包含转义的尾点（例如，`hello\.`），导致`ares_create_query`函数计算hostname大小时出现错误。
2.  **提交恶意hostname给存在漏洞的应用程序**：攻击者将构造好的hostname作为输入（在PoC代码中是callback URL）提交给应用程序。
3.  **触发缓冲区溢出**：应用程序使用c-ares库解析hostname，`ares_create_query`函数分配的缓冲区过小，导致在复制hostname时发生堆缓冲区溢出。
4.  **利用缓冲区溢出**：攻击者可以通过控制溢出的内容，实现拒绝服务（DoS）或者进一步执行任意代码。

**总结：**

该漏洞利用方式主要是通过精心构造的hostname，利用c-ares库在处理转义尾点时的缺陷，触发堆缓冲区溢出。PoC代码提供了一种模拟和验证该漏洞的方式，可以通过控制hostname来触发漏洞，但本身不包含投毒代码。

**项目地址:** [pouriam23/CVE-2016-5180-docker-](https://github.com/pouriam23/CVE-2016-5180-docker-)

**漏洞详情:** [CVE-2016-5180](https://nvd.nist.gov/vuln/detail/CVE-2016-5180)