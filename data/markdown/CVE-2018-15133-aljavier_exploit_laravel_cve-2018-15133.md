## CVE-2018-15133-Laravel-反序列化RCE

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化远程代码执行

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.5.40 and 5.6.x <= 5.6.29

**利用条件:** 需要知道应用的APP_KEY，这通常需要事先获得了特权访问权限或成功实施了先前的攻击。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-15133是Laravel框架中的一个反序列化漏洞。攻击者可以利用此漏洞，通过在X-XSRF-TOKEN中注入恶意序列化数据，实现在目标服务器上执行任意代码。漏洞利用的核心在于`Illuminate/Encryption/Encrypter.php`中的`decrypt`方法和`phpggc`中的`gadgetchains/Laravel/RCE/3/chain.php`。

**有效性：**

从漏洞描述和搜索结果来看，此漏洞已经被CISA列入已知被利用的漏洞目录，表明该漏洞在野外被积极利用。提供的PoC代码基于已知的利用方式，并参考了 Metasploit 的 exploit，所以该PoC代码有效。

**投毒风险：**

PoC代码主要由两个文件组成：`README.md` 和 `pwn_laravel.py`。

*   `README.md`: 包含漏洞描述、利用方法、依赖安装和免责声明等信息。没有发现恶意代码。
*   `pwn_laravel.py`: PoC利用脚本，用于生成恶意payload并发送到目标服务器。脚本利用了`Crypto`库进行加密和解密操作。虽然代码功能是实现RCE，但本身逻辑并没有发现明显的投毒行为。

分析后认为，投毒风险主要存在于依赖项上，尤其是`Crypto`库。但是由于该库比较常用，如果存在恶意代码，可能会被更早发现。

根据代码的功能和依赖关系，判定投毒风险为10%。

**利用方式：**

1.  **获取APP_KEY：** 这是利用此漏洞的关键前提。攻击者需要获取目标Laravel应用的APP_KEY。APP_KEY通常存储在`.env`文件中。
2.  **生成恶意Payload：** 使用PoC脚本`pwn_laravel.py`，指定目标URL、APP_KEY和要执行的命令，生成恶意的序列化数据，并使用APP_KEY对其进行加密。
3.  **发送请求：** 将生成的加密数据作为`X-XSRF-TOKEN`的值，通过HTTP请求发送到目标Laravel应用。
4.  **触发反序列化：** Laravel应用在处理请求时，会尝试解密`X-XSRF-TOKEN`，并对其进行反序列化。如果APP_KEY正确，且反序列化链存在，则会导致远程代码执行。

总而言之，该漏洞的利用依赖于APP_KEY的泄露，攻击难度较高，但危害性很大。

**项目地址:** [aljavier/exploit_laravel_cve-2018-15133](https://github.com/aljavier/exploit_laravel_cve-2018-15133)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)