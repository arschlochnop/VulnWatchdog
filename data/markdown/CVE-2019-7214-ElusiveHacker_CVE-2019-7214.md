## CVE-2019-7214-SmarterMail-反序列化RCE

**漏洞编号:** CVE-2019-7214

**漏洞类型:** 反序列化RCE

**影响应用:** SmarterMail

**危害等级:** 高危，可远程代码执行

**影响版本:** < Build 6985

**利用条件:** 目标端口17001可访问（默认配置下不可远程访问，Build 6985后修复）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-7214是SmarterMail 16.x版本Build 6985之前的一个反序列化漏洞。攻击者可以通过向目标服务器的17001端口（如果可访问）发送特制的序列化数据，来执行任意命令。该漏洞利用依赖于.NET反序列化漏洞，攻击者可以构造恶意的PowerShell命令作为payload，并通过序列化方式传递给SmarterMail服务器。提供的PoC代码（CVE-2019-7214.py）构造了这样的payload，其中包含了base64编码的PowerShell反向shell命令。  

**有效性:**  根据搜索结果和漏洞利用代码，可以判断该POC代码有效。多个来源表明存在可利用的PoC，并且提供的代码本身也实现了利用过程。

**投毒风险:** 投毒风险较低，估计在5%左右。主要考虑以下几个方面：
1.  **代码来源：** 代码来自多个作者，经过了ElusiveHacker修改，但主要逻辑是Soroush Dalili的。原始作者的信誉需要评估，但NCC Group也发布了相关的技术报告，佐证了漏洞的存在。
2.  **代码内容：** 代码主要功能是生成和发送Payload，Payload本身包含反向shell的PowerShell命令。虽然反向shell本身有风险，但这是漏洞利用的必要组成部分，不属于投毒。
3.  **配置参数：**  代码中需要配置`LHOST`和`LPORT`，这是反向连接的地址，如果攻击者不小心使用了错误的配置，可能导致连接到恶意的服务器，存在被反制的风险。但这不属于代码本身的投毒。
4. **README.md文件：** README文件说明了如何配置和使用该PoC，其中提到了hostname解析、端口配置以及使用Netcat监听等步骤。它对环境搭建和运行提供了指引，并无恶意操作。

主要的投毒风险在于，如果攻击者下载了该POC，并在生产环境中使用，可能被其他人截获反向shell连接，从而导致信息泄露或权限被窃取。因此,不能完全排除攻击者在托管的服务器上，捕获反向shell链接。

**利用方式:**  
1.  **确定目标版本：**  确认SmarterMail版本低于Build 6985。
2.  **确认端口可访问：** 确认目标服务器的17001端口可以通过网络访问。
3.  **配置PoC：** 修改PoC代码中的`HOSTNAME`、`LHOST`和`LPORT`参数，分别设置为目标主机名、攻击者IP地址和监听端口。
4.  **运行PoC：** 运行PoC代码，发送序列化的Payload。
5.  **监听连接：** 在攻击者机器上使用Netcat或其他工具监听指定的端口。
6.  **获取Shell：** 如果漏洞利用成功，将在攻击者机器上获得一个来自目标服务器的PowerShell Shell。

**项目地址:** [ElusiveHacker/CVE-2019-7214](https://github.com/ElusiveHacker/CVE-2019-7214)

**漏洞详情:** [CVE-2019-7214](https://nvd.nist.gov/vuln/detail/CVE-2019-7214)