## CVE-2022-46463-Harbor-未授权访问

**漏洞编号:** CVE-2022-46463

**漏洞类型:** 未授权访问

**影响应用:** Harbor

**危害等级:** 高危，可能导致敏感信息泄露，供应链投毒

**影响版本:** v1.X.X to v2.5.3

**利用条件:** Harbor服务对外开放

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-46463 漏洞允许未经身份验证的攻击者访问 Harbor 的公共和私有镜像仓库。根据漏洞描述和搜索引擎结果，该漏洞的利用方式主要是通过未授权的 HTTP 请求来访问 Harbor API，从而获取镜像信息甚至下载镜像。

**有效性评估：**
提供的Python脚本通过 Harbor API 搜索镜像，并直接下载镜像文件，验证了未授权访问漏洞的存在。

**投毒风险分析：**
虽然该脚本的主要目的是扫描和下载镜像，但存在一定的投毒风险，主要体现在以下几个方面：
*   **依赖风险：**脚本依赖于 `requests` 和 `urllib3` 等第三方库，如果这些库本身存在安全漏洞，则可能导致代码执行。
*   **配置错误风险：**脚本允许用户指定代理，如果代理配置不当，可能导致敏感信息泄露。
*   **恶意代码风险：**尽管脚本本身没有明显的恶意代码，但攻击者可能修改脚本，例如植入后门或者修改下载的镜像文件，从而实现供应链投毒。
*   **文件操作风险** 脚本会生成和读取文件,存在一定的文件读取风险.

综合来看，投毒风险主要来自于对脚本的修改和不当配置，脚本本身下载后篡改上传投毒的可能性较低，脚本本身的功能主要是镜像的扫描和下载，并非上传，所以脚本本身投毒的可能性占比5%。

**利用方式：**
1.  **搜索镜像：** 通过脚本扫描Harbor实例，遍历公开和私有仓库中的镜像列表，获取项目ID和仓库名称等信息。
2.  **下载镜像：** 根据获取的镜像信息，直接通过 Harbor API 下载镜像文件，绕过身份验证。
3.  **解压镜像：** 脚本可以自动解压下载的镜像文件，方便攻击者进一步分析和利用。
4.  **信息泄露：** 攻击者可以利用此漏洞获取 Harbor 中存储的敏感信息，例如访问密钥、配置文件等。
5.  **供应链攻击：** 攻击者可以下载私有镜像，分析其中的安全漏洞，甚至可以修改镜像并重新上传，实施供应链投毒。

**项目地址:** [CodeSecurityTeam/harbor](https://github.com/CodeSecurityTeam/harbor)

**漏洞详情:** [CVE-2022-46463](https://nvd.nist.gov/vuln/detail/CVE-2022-46463)