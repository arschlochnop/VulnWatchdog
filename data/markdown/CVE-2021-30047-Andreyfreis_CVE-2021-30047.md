## CVE-2021-30047-vsftpd-DoS

**漏洞编号:** CVE-2021-30047

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** vsftpd

**危害等级:** 高危，可能导致服务不可用

**影响版本:** 3.0.3

**利用条件:** 目标主机运行vsftpd 3.0.3版本，并且允许建立新的TCP连接。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-30047 漏洞存在于 VSFTPD 3.0.3 版本中，由于程序允许的连接数有限，攻击者可以通过创建大量连接来耗尽服务器资源，导致拒绝服务。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。漏洞库信息和搜索引擎结果都明确指出 VSFTPD 3.0.3 存在 DoS 漏洞，攻击者可以通过耗尽连接数来攻击。POC 代码 `cve-2021-30047.py` 的实现方式是创建多个线程，每个线程都尝试与目标 VSFTPD 服务器建立 FTP 连接，从而达到耗尽服务器连接资源的目的。

**投毒风险分析：**

对提供的 POC 代码 `cve-2021-30047.py` 进行分析，代码的主要功能是建立大量的 FTP 连接以造成拒绝服务。代码中包含以下几个关键部分：

*   `testar_conexao()`: 测试目标端口是否开放。
*   `ataque()`: 尝试使用 `ftp` 命令连接目标服务器。关键在于使用了 `subprocess.Popen` 创建子进程执行 `ftp` 命令，并将标准输出和标准错误重定向到 `/dev/null`，这意味着连接过程中的任何交互都被屏蔽了。
*   `iniciar_ataque_loop()`: 创建多个线程并发执行 `ataque()` 函数，从而发起 DoS 攻击。
*   `temporizador()`:  定时杀死由 `subprocess.Popen` 创建的 `ftp` 进程，防止攻击无限期执行。

代码中并没有发现明显的恶意代码，例如反弹 shell、文件上传或其他任何试图在目标系统上执行任意代码的行为。 子进程执行的命令是标准的 `ftp` 命令，虽然数量庞大，但本身并不会造成安全问题（除了 DoS 之外）。因此，该 POC 代码的投毒风险为 0%。

**利用方式：**

1.  **环境准备：** 确保目标主机运行着 VSFTPD 3.0.3 版本。
2.  **运行POC：** 使用 Python 运行提供的 POC 代码 `cve-2021-30047.py`，需要指定目标 IP 地址和端口号（默认为 21），以及要创建的最大连接数（默认为 50）。
3.  **观察效果：**  POC 运行后，会创建大量的 FTP 连接，导致 VSFTPD 服务器无法响应正常的连接请求，从而达到拒绝服务的目的。

**项目地址:** [Andreyfreis/CVE-2021-30047](https://github.com/Andreyfreis/CVE-2021-30047)

**漏洞详情:** [CVE-2021-30047](https://nvd.nist.gov/vuln/detail/CVE-2021-30047)