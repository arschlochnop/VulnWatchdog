## CVE-2019-13272-Linux Kernel PTRACE_TRACEME 本地提权

**漏洞编号:** CVE-2019-13272

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户获得root权限

**影响版本:** < 5.1.17

**利用条件:** 需要本地用户权限，目标系统内核版本低于5.1.17，且没有应用SELinux deny_ptrace策略

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-13272 漏洞存在于 Linux 内核的 ptrace_link 函数中，该函数处理进程创建 ptrace 关系时凭据的记录不当。攻击者可以利用父子进程关系（父进程降权并调用 execve）来获得 root 权限。该漏洞利用了不正确的 ptrace 关系标记为特权关系，这可以通过 Polkit 的 pkexec 助手与 PTRACE_TRACEME 来利用。

**有效性：**
根据漏洞描述和漏洞利用代码，该POC代码有效。搜索引擎结果中也存在对此漏洞的描述和利用信息，以及多个厂商发布的补丁和安全公告，表明该漏洞真实存在且影响较大。利用代码通过创建一个父子进程，父进程调用`pkexec`，子进程通过`PTRACE_TRACEME`强制父进程跟踪自己，从而利用`pkexec`的权限来提权。

**投毒风险：**
该漏洞利用代码相对简洁，主要利用了`ptrace`和`pkexec`的交互缺陷。代码中包含一些辅助函数，例如`tprintf`，以及一个helper路径列表。对`cve-2019-13272_exp.c`代码进行分析，没有发现明显的恶意代码，但由于代码可以提权，如果攻击者修改helper列表或者修改exec执行的程序路径指向恶意程序，则存在一定的投毒风险，但是目前代码本身的风险较低。`/tmp/e8e7a709c0acaf59e6ddaab46f6886bc/README.md`和`cve-2019-13272_exp.c`的作者是同一个人，且代码质量相对较高，风险较低，因此投毒风险评估为1%。

**利用方式：**
1.  编译并运行提供的 C 代码。
2.  POC代码首先创建一个子进程，父进程执行`pkexec`尝试提权，子进程利用`PTRACE_TRACEME`来追踪父进程。
3.  子进程执行`pkexec`时会因为ptrace关系被认为是特权关系从而执行suid程序。
4.  成功利用该漏洞后，攻击者将获得 root 权限。

**项目地址:** [Cyc1eC/CVE-2019-13272](https://github.com/Cyc1eC/CVE-2019-13272)

**漏洞详情:** [CVE-2019-13272](https://nvd.nist.gov/vuln/detail/CVE-2019-13272)