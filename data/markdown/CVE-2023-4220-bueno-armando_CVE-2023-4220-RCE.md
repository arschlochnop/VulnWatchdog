## CVE-2023-4220-Chamilo LMS Unauthenticated Remote Code Execution

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** <= 1.11.24

**利用条件:** Chamilo LMS服务器可公开访问，且目标版本小于等于1.11.24

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220是Chamilo LMS中存在的一个未经身份验证的远程代码执行漏洞。该漏洞位于`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`文件中的大文件上传功能中。攻击者可以通过上传恶意PHP文件（webshell）来执行任意代码。 

**漏洞利用方式：**

1.  攻击者使用`curl`命令上传包含恶意代码的PHP文件到目标服务器的`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`，利用大文件上传功能绕过身份验证。
2.  上传成功后，webshell存储在`/main/inc/lib/javascript/bigupload/files/`目录下，文件名为`rce.php`。
3.  攻击者通过`curl`命令访问上传的webshell(`/main/inc/lib/javascript/bigupload/files/rce.php`)，触发webshell中的恶意代码，实现远程代码执行。

**POC代码分析：**

提供的POC代码是一个Python脚本，它执行以下操作：

1.  接收目标URL、端口、命令和可选的反向shell参数。
2.  如果提供了命令，则对其进行Base64编码，然后将其包装在PHP代码中，以便通过`system()`函数执行。
3.  如果未提供命令，则构建一个反向shell命令，使用攻击者的IP地址和端口。
4.  将生成的PHP代码保存到`rce.php`文件中。
5.  使用`curl`命令将`rce.php`上传到`/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported`。
6.  使用`curl`命令访问上传的`rce.php`，执行恶意代码。

**有效性评估：**

根据漏洞描述、搜索结果和提供的POC代码，该漏洞利用是有效的。POC代码能够成功上传并执行webshell，从而实现远程代码执行。

**投毒风险分析：**

对POC代码进行分析后，发现存在一定的投毒风险，概率为10%。主要体现在以下方面：

*   脚本直接使用`os.system()`函数执行外部命令，这可能允许攻击者在目标系统上执行任意命令。虽然脚本主要执行curl命令，理论上只涉及上传文件和访问文件，如果攻击者修改了上传文件或者篡改了访问的url, 导致执行系统命令，也存在被植入恶意后门的风险。

总体来说，该POC的投毒风险较低，因为脚本的功能比较明确，恶意行为不容易被隐藏。用户在使用时应仔细检查代码，确保没有被篡改。

**项目地址:** [bueno-armando/CVE-2023-4220-RCE](https://github.com/bueno-armando/CVE-2023-4220-RCE)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)