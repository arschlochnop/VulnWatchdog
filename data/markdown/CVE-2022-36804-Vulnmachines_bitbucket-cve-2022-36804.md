## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server 和 Data Center

**危害等级:** 高危，允许远程代码执行

**影响版本:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库具有访问权限或者对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804是Atlassian Bitbucket Server和Data Center中的一个命令注入漏洞。攻击者可以通过发送恶意HTTP请求，利用多个API端点中的漏洞执行任意代码。

**有效性：**

根据漏洞描述、搜索结果以及提供的POC代码，可以判断此漏洞是有效的，并且已经存在公开的利用方法。

**投毒风险：**

提供的漏洞利用代码主要包含两个payload，用于触发命令注入。
*   `payload` 文件通过构造包含 `--exec` 参数的HTTP请求，执行 `whoami` 命令。看起来是为了验证漏洞是否存在。  
*   `payload2` 文件同样构造了包含 `--exec` 参数的HTTP请求，执行 `id` 命令。也是为了验证漏洞是否存在。

仓库中的`README.md`只是包含PoC的演示图片以及作者的社交媒体链接，没有发现恶意代码。

综合评估，由于POC文件本身是为了验证漏洞，并非为了传播恶意代码，仓库中主要的文件是用于演示和说明漏洞的，因此投毒风险较低，评估为10%。此处的风险主要来源于POC可能被他人修改后传播，从而植入恶意代码。

**利用方式：**

利用方式主要通过构造特殊的HTTP请求，该请求中利用了git命令的 `--exec` 参数，该参数允许执行任意系统命令。攻击者通过在 `path` 或 `prefix` 参数中插入包含 `--exec` 和恶意命令的字符串，最终导致命令注入。

具体利用步骤如下：

1.  构造包含恶意命令的HTTP请求，请求特定的API端点，例如 `/rest/api/latest/projects/<projectname>/repos/<reponame>/archive`。
2.  在 `path` 或 `prefix` 参数中，插入类似 `%00--exec=<command>%00--remote=origin` 的字符串。
3.  发送构造好的HTTP请求到目标Bitbucket服务器。
4.  服务器解析请求，执行被注入的命令。

成功利用此漏洞可以导致远程代码执行，可能导致服务器被完全控制。

**项目地址:** [Vulnmachines/bitbucket-cve-2022-36804](https://github.com/Vulnmachines/bitbucket-cve-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)