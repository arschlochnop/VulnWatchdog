## CVE-2022-0847-Dirty Pipe

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户修改只读文件并提升权限

**影响版本:** 5.8 <= Linux Kernel < 5.16.11, 5.15.25, 5.10.102

**利用条件:** 需要本地用户权限，目标系统内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

**有效性：**
提供的POC代码`exploit-1.c`是针对CVE-2022-0847漏洞的利用程序，该漏洞允许本地用户覆盖page cache中的任意文件内容，即使这些文件是只读的。搜索引擎结果也表明存在多个公开可用的POC，证实了该漏洞的可利用性。该漏洞利用代码修改`/etc/passwd`文件，从而获取root权限，进一步证实了它的有效性。

**投毒风险：**
分析仓库中的代码后，发现`compile.sh`脚本仅用于编译`exploit-1.c`和`exploit-2.c`，未发现任何额外的恶意代码或后门。`exploit-1.c`本身的目的就是修改`/etc/passwd`文件以提升权限，这属于漏洞利用的一部分，而非投毒。然而，使用任何未经授权的漏洞利用程序都存在潜在风险，包括系统不稳定或数据损坏。因此，存在潜在投毒风险，但不来自于代码本身，而是来自于对漏洞利用程序的不当使用。占比10%。

**利用方式：**
1.  **漏洞原理：** CVE-2022-0847（Dirty Pipe）漏洞源于Linux内核在`copy_page_to_iter_pipe`和`push_pipe`函数中，新的管道缓冲区结构体的“flags”成员缺乏适当的初始化，可能包含过时的值。
2.  **利用步骤：**
    *   利用该漏洞，攻击者首先创建一个管道。
    *   然后，将数据写入管道，使管道缓冲区具有`PIPE_BUF_FLAG_CAN_MERGE`标志。
    *   接下来，耗尽管道中的数据。
    *   然后，使用`splice`系统调用将目标文件（例如`/etc/passwd`）的一部分写入管道，利用未初始化的标志，从而绕过只读限制。
    *   最后，将恶意数据写入管道，覆盖目标文件中的相应部分。
3.  **利用效果：**  成功利用此漏洞后，攻击者可以修改`/etc/passwd`等只读文件，从而提升权限，获取root shell。

**项目地址:** [orsuprasad/CVE-2022-0847-DirtyPipe-Exploits](https://github.com/orsuprasad/CVE-2022-0847-DirtyPipe-Exploits)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)