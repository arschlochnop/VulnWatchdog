## CVE-2025-24054 - NTLM Hash Disclosure Spoofing Vulnerability

**漏洞编号:** CVE-2025-24054

**漏洞类型:** NTLM Hash Disclosure

**影响应用:** Windows

**危害等级:** 中危，可能导致凭据泄露和权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 需要目标用户打开或预览恶意的.library-ms文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24054是一个Windows NTLM哈希泄露欺骗漏洞。攻击者可以通过诱使用户打开一个特制的`.library-ms`文件，该文件包含指向攻击者控制的SMB服务器的UNC路径，从而触发受害者的系统向攻击者控制的服务器进行NTLM认证。攻击者可以捕获到泄露的NTLMv2哈希。 

**有效性：**

根据提供的漏洞信息和搜索结果，该漏洞已被积极利用。POC代码提供了一个Python脚本（`generate_library_ms.py`）用于生成恶意的`.library-ms`文件，并包含了一个示例文件(`xd.library-ms`)。该文件包含指向攻击者控制的SMB服务器的UNC路径。提供的步骤清晰地描述了如何使用Responder等工具搭建SMB服务器并捕获泄露的NTLM哈希。因此，提供的POC代码是有效的。

**投毒风险：**

评估提供的代码是否存在投毒风险：

*   `README.md`：仅包含漏洞描述、利用方法、参考链接和作者信息，没有发现恶意代码。
*   `exploit.py`：该脚本的功能是生成一个包含UNC路径的`.library-ms`文件。脚本中唯一可配置的参数是ATTACKER_IP，这允许攻击者指定接收NTLM哈希的服务器。代码本身不包含任何可疑或恶意的操作。
*   `xd.library-ms`：这是一个示例`.library-ms`文件，其中包含指向攻击者控制的SMB服务器的UNC路径。内容是XML格式，结构简单，没有隐藏恶意代码的空间。

综合来看，该仓库中存在恶意代码的可能性较低，但仍然存在一定的风险。例如，如果攻击者篡改了`exploit.py`脚本，在生成`.library-ms`文件时添加了其他恶意行为，或者将`xd.library-ms`替换为包含其他攻击向量的文件，则可能存在投毒风险。考虑到该脚本和文件的功能相对简单直接，并且只涉及生成`.library-ms`文件，因此投毒的可能性较低，估计在5%左右。

**利用方式：**

1.  攻击者使用提供的`exploit.py`脚本，或者手动创建一个`.library-ms`文件。脚本中需设置攻击者控制的SMB服务器的IP地址（`ATTACKER_IP`）。
2.  攻击者搭建一个SMB服务器，例如使用Responder。
3.  攻击者通过钓鱼等方式，将`.library-ms`文件发送给受害者。
4.  受害者在Windows资源管理器中打开或预览该文件。
5.  Windows系统尝试连接到`.library-ms`文件中指定的UNC路径，并使用NTLM认证。
6.  攻击者的SMB服务器捕获到受害者的NTLMv2哈希。
7.  攻击者可以使用捕获到的哈希进行离线破解，或者使用Pass-the-Hash攻击。

**项目地址:** [helidem/CVE-2025-24054-PoC](https://github.com/helidem/CVE-2025-24054-PoC)

**漏洞详情:** [CVE-2025-24054](https://nvd.nist.gov/vuln/detail/CVE-2025-24054)