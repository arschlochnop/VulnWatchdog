## CVE-2021-3560-Polkit权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** polkit

**危害等级:** 高危，可导致本地用户获取root权限

**影响版本:** polkit 0.113及更高版本，或Debian fork的0-105-26

**利用条件:** 需要安装accountsservice和gnome-control-center，且在不支持图形登录的环境下运行。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560是一个polkit中的权限提升漏洞。攻击者可以通过利用D-Bus请求中的凭据检查绕过，从而将请求者的权限提升为root用户。

**有效性评估：**
根据提供的漏洞库信息、搜索引擎结果和PoC代码，此漏洞的PoC代码是有效的。漏洞信息表明该漏洞已在野外被利用 (CISA KEV目录)，并且存在公开可用的PoC。

**投毒风险评估：**
PoC代码本身是一个bash脚本，主要用于自动化漏洞利用过程。虽然脚本会尝试注入一个新的sudo用户，但这种行为是漏洞利用的必要步骤，而非隐藏的恶意代码。然而，下载和运行任何来自不可信来源的脚本始终存在风险。因此，谨慎对待脚本，在受控环境中检查代码，是降低风险的措施。
仔细分析README.md的内容，投毒风险主要来自以下几个方面：
1.  **依赖性：** 脚本依赖于`accountsservice`和`gnome-control-center`的存在。虽然这些通常是标准组件，但如果环境缺少这些组件，脚本可能无法正常工作，或者产生意想不到的错误。
2.  **Timing依赖：** 漏洞利用依赖于精确的Timing。如果Timing不正确，漏洞利用会失败，并且可能需要多次尝试。
3.  **环境限制：** 脚本警告不要在图形登录环境运行，否则会导致polkit认证循环弹出。虽然这不是恶意行为，但可能造成拒绝服务。
4. **新增用户风险:** 脚本会在sudo组添加用户,如果该用户被攻击者控制,会导致系统被远程控制,存在风险.

**利用方式：**
1.  **漏洞触发：** 攻击者发送一个D-Bus消息来触发polkit。
2.  **连接中断：** 在polkit处理请求时，攻击者突然中断连接。
3.  **权限提升：** 攻击者使用之前的bus标识符发送第二个请求，由于polkit将断开连接的UID视为0，因此第二个请求会以root权限执行。
4. **添加sudo用户:** 攻击者利用root权限添加拥有sudo权限的用户。

总而言之，该PoC的目的是为了利用CVE-2021-3560漏洞，添加sudo用户以实现权限提升。尽管PoC本身的代码没有明显的恶意行为，但依旧存在一定的投毒风险，下载和使用需谨慎。


**项目地址:** [secnigma/CVE-2021-3560-Polkit-Privilege-Esclation](https://github.com/secnigma/CVE-2021-3560-Polkit-Privilege-Esclation)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)