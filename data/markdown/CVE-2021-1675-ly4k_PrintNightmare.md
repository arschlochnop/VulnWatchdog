## CVE-2021-1675/CVE-2021-34527 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本包括但不限于Windows 7, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 目标系统开启Print Spooler服务，攻击者需要目标机器的有效用户凭据或能够进行Kerberos认证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

PrintNightmare (CVE-2021-1675/CVE-2021-34527) 是一个 Windows Print Spooler 服务中的远程代码执行漏洞。攻击者可以通过 `AddPrinterDriverEx` 函数加载恶意的驱动程序 DLL，从而在系统上以 SYSTEM 权限执行任意代码。根据搜索引擎结果和提供的漏洞利用代码，该漏洞的PoC是有效的。利用方式包括:

1.  **远程DLL注入:** 攻击者将恶意的DLL文件放置在可访问的SMB共享上，然后利用漏洞加载该DLL。
2.  **本地DLL加载:**  攻击者可以将恶意的DLL放置在目标系统的本地路径，然后利用漏洞加载它。
3.  **自定义驱动名称:** 攻击者可以指定自定义的驱动名称。

**投毒风险分析:** 提供的代码主要包含漏洞利用的脚本和license文件。虽然代码中没有明显的恶意代码，但是通过控制DLL的加载路径，攻击者可以执行任意代码，这本身就存在一定的风险。`printnightmare.py`脚本本身不属于投毒代码，它只是一个利用漏洞的工具。但用户如果使用来源不明或被篡改的`add_user.dll`等恶意payload，可能导致被植入后门或其他恶意程序。因此，在使用任何PoC代码时，都应仔细审查其来源和内容，并在隔离环境中进行测试。

由于代码的目的是为了演示漏洞利用，并且通过外部DLL来执行操作，所以不能完全排除存在投毒的可能。这里假设投毒的概率较低，评估为10%。

**项目地址:** [ly4k/PrintNightmare](https://github.com/ly4k/PrintNightmare)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)