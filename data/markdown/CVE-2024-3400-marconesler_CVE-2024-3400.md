## CVE-2024-3400 PAN-OS GlobalProtect 任意文件创建导致命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 严重，未经身份验证的攻击者可以root权限执行任意代码

**影响版本:** PAN-OS 10.2 (低于 10.2.9-h1), 11.0 (低于 11.0.4-h1), 和 11.1 (低于 11.1.2-h3)，且配置了GlobalProtect网关或门户

**利用条件:** 需要目标系统配置了GlobalProtect网关或门户

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 功能中的一个命令注入漏洞，源于任意文件创建。未经身份验证的远程攻击者可以利用此漏洞在受影响的设备上以 root 权限执行任意代码。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以得出结论：该漏洞的PoC代码有效。

*   漏洞库信息显示，Palo Alto Networks 已经意识到有越来越多的攻击利用此漏洞，并且第三方已经公开了PoC。
*   搜索结果中也包含了多个关于CVE-2024-3400的分析文章，以及检测被入侵设备的方法，进一步证实了该漏洞的真实性和可利用性。
*   提供的PoC代码 `cve-2024-3400.py` 实现了利用该漏洞执行命令的功能，包括获取配置文件和执行反弹shell。

**投毒风险分析：**

PoC代码本身相对简单，主要通过构造恶意的SESSID cookie来触发漏洞。投毒风险较低。主要风险点在于：

*   **README.md中的免责声明：** README.md提到“the firewall must be running a vulnerable PAN-OS version and must have telemetry enabled.”,如果使用者忽略此项说明，在非漏洞环境中使用，可能会导致一些非预期行为。 即使此项说明，使用者也有可能没意识到打开telemetry可能带来的风险. *   **Connect-back shell风险：** PoC代码中包含反弹shell的功能，如果攻击者修改反弹shell的IP地址和端口，可以连接到受害者的设备。

**漏洞利用方式：**

1.  **漏洞原理：** 漏洞利用了GlobalProtect功能中对用户输入验证不严格的问题，允许攻击者通过构造恶意的SESSID cookie来创建任意文件，并在创建文件的过程中执行命令注入。
2.  **攻击步骤：**
    *   攻击者构造包含恶意命令的SESSID cookie。
    *   攻击者向目标设备的GlobalProtect登录页面发送请求，并在请求中包含构造的SESSID cookie。
    *   目标设备在处理SESSID cookie时，由于验证不严格，会将cookie中的恶意命令注入到系统中执行。
3.  **PoC代码分析：**
    *   `cve-2024-3400.py` 脚本接受目标主机、攻击类型和反弹shell地址作为参数。
    *   脚本根据攻击类型选择不同的命令。
        *   `getconf`: 复制 `running-config.xml` 到 web 目录，攻击者可以下载配置文件。
        *   `getpanoramaconf`: 复制 `merged-running-config.xml` 到 web 目录，攻击者可以下载panorama合并的配置文件。
        *   `remoteshell`: 启动反弹shell，连接到攻击者指定的IP地址和端口。
    *   脚本将命令进行base64编码，并将其嵌入到SESSID cookie中。
    *   脚本向目标设备发送包含恶意cookie的GET请求。

**总结：**

CVE-2024-3400是一个高危漏洞，利用简单，影响广泛。建议受影响的用户尽快升级到安全版本。

**项目地址:** [marconesler/CVE-2024-3400](https://github.com/marconesler/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)