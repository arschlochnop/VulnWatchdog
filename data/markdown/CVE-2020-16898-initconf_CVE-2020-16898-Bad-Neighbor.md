## CVE-2020-16898: Bad Neighbor - Windows TCP/IP远程代码执行漏洞

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows TCP/IP Stack

**危害等级:** 高危，可能导致远程代码执行或拒绝服务 (DoS)

**影响版本:** Windows 10 Version 1709, 1803, 1809, 1903, 1909, 2004; Windows Server 2019, version 1903, version 2004

**利用条件:** 攻击者需要与目标系统处于同一网络或能够发送 ICMPv6 路由通告数据包到目标系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-16898，又名"Bad Neighbor"，是一个Windows TCP/IP堆栈中的远程代码执行漏洞。该漏洞源于Windows TCP/IP堆栈不正确地处理 ICMPv6 路由器通告数据包。攻击者可以通过发送特制的 ICMPv6 路由器通告数据包到远程Windows计算机来利用此漏洞。成功利用此漏洞的攻击者可以在目标服务器或客户端上执行代码。

根据漏洞信息和搜索结果，该漏洞可以通过发送包含畸形 RDNSS 选项的 ICMPv6 路由器通告数据包来触发。具体来说，当 RDNSS 选项的长度字段为偶数时，会触发漏洞。

提供的 Zeek 脚本实现了对该漏洞的检测。它会检查所有传入的 ICMPv6 流量，查找 ICMPv6 类型字段为 134 (表示路由器通告) 且 ICMPv6 选项字段为 25 (表示递归 DNS 服务器 RDNSS) 的数据包。如果此 RDNSS 选项的长度字段值为偶数，则该脚本会发出警报。

**有效性：**

提供的Zeek脚本并非漏洞利用代码，而是用于检测攻击的签名。其有效性在于检测到潜在的攻击流量，但它本身无法触发漏洞。

**投毒风险：**

该Zeek脚本的目的是检测恶意流量，本身不太可能包含投毒代码。 风险评估为10%。原因包括：
   * Zeek 脚本的主要功能是网络流量分析和检测，用于安全监控。因此，直接嵌入恶意代码的可能性较低。
   * 该脚本相对简单，主要基于对 ICMPv6 报文特定字段的检查，易于人工审查，从而降低了隐藏恶意代码的风险。

**利用方式：**

1.  攻击者需要与目标系统处于同一网络或能够向目标系统发送 ICMPv6 路由通告数据包。
2.  攻击者构造一个包含畸形 RDNSS 选项的 ICMPv6 路由通告数据包。RDNSS 选项的长度字段必须是偶数。
3.  攻击者将构造的数据包发送到目标系统。
4.  如果目标系统未打补丁，则可能导致远程代码执行或者拒绝服务。

**项目地址:** [initconf/CVE-2020-16898-Bad-Neighbor](https://github.com/initconf/CVE-2020-16898-Bad-Neighbor)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)