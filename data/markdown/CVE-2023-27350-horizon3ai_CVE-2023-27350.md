## CVE-2023-27350 PaperCut NG/MF 身份验证绕过与远程代码执行漏洞

**漏洞编号:** CVE-2023-27350

**漏洞类型:** 身份验证绕过/远程代码执行

**影响应用:** PaperCut NG/MF

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 22.0.5 (Build 63914)

**利用条件:** 目标系统运行受影响版本的PaperCut NG/MF，且攻击者可以访问目标系统的网络。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27350 是 PaperCut NG/MF 软件中的一个漏洞，允许未经身份验证的远程攻击者执行任意代码。攻击者首先利用身份验证绕过漏洞，然后滥用内置的脚本功能来执行代码。 

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞利用的有效性极高。CISA已经将此漏洞添加到已知被利用漏洞目录中，表明该漏洞正在被积极利用。Sophos等安全厂商也报告了针对该漏洞的攻击。

**投毒风险分析：**

PoC 代码本身主要包含以下几个步骤：

1.  **身份验证绕过：** 通过访问`/app?service=page/SetupCompleted`绕过身份验证。
2.  **设置修改：** 使用`set_setting`函数修改`print-and-device.script.enabled`和`print.script.sandboxed`配置项，启用打印脚本功能并禁用沙盒。
3.  **命令执行：**  通过修改打印机脚本，将攻击者提供的命令注入到`scriptBody`中执行。
4.  **配置恢复：** 执行完成之后恢复`print-and-device.script.enabled`和`print.script.sandboxed`配置项。

在`execute` 函数中，PoC 使用了 `curl` 命令来尝试将`whoami`命令的输出发送到 `http://10.0.40.83:8081`。这可能是PoC作者用于验证漏洞利用成功的一种方式，**但如果直接使用此PoC且目标环境可以访问公网，则可能泄露目标服务器的用户名**。这可以被视为一种潜在的投毒风险。

仔细检查代码后，没有发现明显的恶意代码，例如下载并执行其他程序，或者删除系统文件等。投毒的风险主要在于`execute`函数中硬编码的IP地址和端口号，以及`command`参数的潜在恶意利用。

总体来说，该仓库中存在作者隐藏的投毒代码的可能性较低，风险主要在于使用者不理解PoC代码的含义，直接使用导致的信息泄露，考虑到`curl`命令中的IP地址，以及`command`参数的潜在风险，因此，投毒风险评定为10%。

**利用方式分析：**

1.  攻击者首先利用身份验证绕过漏洞，无需提供任何凭据即可访问 PaperCut NG/MF 的管理界面。
2.  攻击者修改配置，允许执行打印脚本，并禁用脚本沙箱。
3.  攻击者构造包含恶意代码的打印脚本，并将该脚本上传到 PaperCut 服务器。
4.  当 PaperCut 服务器处理打印任务时，恶意脚本会被执行，从而导致远程代码执行。

**项目地址:** [horizon3ai/CVE-2023-27350](https://github.com/horizon3ai/CVE-2023-27350)

**漏洞详情:** [CVE-2023-27350](https://nvd.nist.gov/vuln/detail/CVE-2023-27350)