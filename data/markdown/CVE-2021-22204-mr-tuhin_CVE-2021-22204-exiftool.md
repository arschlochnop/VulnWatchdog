## CVE-2021-22204-ExifTool-代码执行

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 代码执行

**影响应用:** ExifTool

**危害等级:** 高危，允许远程代码执行

**影响版本:** >=7.44, <12.24

**利用条件:** 目标系统安装了受影响版本的ExifTool，且攻击者可以上传或让目标处理特制的DjVu文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22204 是 ExifTool 中 DjVu 文件解析模块的一个代码执行漏洞。攻击者可以构造恶意的 DjVu 文件，当 ExifTool 解析该文件时，恶意代码会被执行。

**有效性评估：**

提供的POC代码是有效的，漏洞库信息和Packetstorm Security提供的exp佐证了这一点。该POC的README.md文件提供了清晰的使用说明，exploit.py 脚本通过构造恶意的 DjVu 文件触发漏洞，从而在目标系统上执行任意代码。

**投毒风险分析：**

通过分析 exploit.py 脚本的内容，发现其主要功能是生成包含恶意配置的 DjVu 文件，从而触发 ExifTool 的代码执行漏洞。恶意代码包含在 Image::ExifTool::UserDefined配置中，并通过DjVu的文件格式来执行。虽然脚本本身存在执行系统命令的行为（例如，通过`run('clear')`清理屏幕），但这属于辅助功能，不是恶意投毒行为。

对README.md和exploit.py文件进行分析,在代码和描述中未发现任何明显的恶意代码或后门。综上所述，该仓库存在投毒代码的可能性较低, 但仍然存在一定的潜在风险。

**利用方式：**

1.  攻击者首先需要找到一个受害者，该受害者正在运行易受攻击版本的 ExifTool。
2.  攻击者使用提供的 `exploit.py` 脚本，指定攻击者的 IP 地址和监听端口，生成一个恶意的 DjVu 文件（`image.jpg`）。
3.  攻击者诱骗受害者使用 ExifTool 处理这个恶意的 DjVu 文件。这可以通过多种方式实现，例如：
    *   将恶意文件上传到使用 ExifTool 处理上传文件的 Web 应用程序。
    *   通过电子邮件将恶意文件发送给受害者。
    *   在共享文件服务器上放置恶意文件。
4.  当 ExifTool 处理恶意的 DjVu 文件时，漏洞被触发，攻击者指定的命令将在受害者的系统上执行，反弹shell到攻击者的机器上。

**项目地址:** [mr-tuhin/CVE-2021-22204-exiftool](https://github.com/mr-tuhin/CVE-2021-22204-exiftool)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)