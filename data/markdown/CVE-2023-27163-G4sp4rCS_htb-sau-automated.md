## CVE-2023-27163-request-baskets-SSRF

**漏洞编号:** CVE-2023-27163

**漏洞类型:** SSRF (Server-Side Request Forgery)

**影响应用:** request-baskets

**危害等级:** 中危，可以允许攻击者访问内部网络资源和敏感信息，根据CVSS评分，需要较高权限才能利用。

**影响版本:** <= 1.2.1

**利用条件:** 需要目标request-baskets服务可访问，且攻击者需要具备创建或修改basket的权限（通常需要认证，CVE描述里privilegesRequired是HIGH）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于request-baskets v1.2.1及更早版本中，位于`/api/baskets/{name}`组件。攻击者可以通过构造恶意的API请求，利用SSRF漏洞访问内部网络资源。根据PacketstormSecurity和Github的搜索结果，该漏洞存在公开的POC。漏洞利用方式如下：

1.  **mailtrail函数 (SSRF触发):** 首先，通过`mailtrail`函数，向`/api/baskets/pwned`发送POST请求，创建一个新的basket或者修改已存在的basket。请求的body包含`forward_url`参数，该参数指向攻击者控制的服务器（在`exploit.py`中，尝试指向`http://127.0.0.1:80/`，实际攻击中需要替换为攻击者控制的服务器），并设置`proxy_response`为`True`，这导致request-baskets会将请求转发到`forward_url`，从而触发SSRF。
2.  **exploit函数 (反弹shell):** 然后，利用`exploit`函数，向`/pwned/login`（`/pwned`是之前`mailtrail`创建的basket名字）发送POST请求。POST请求的body中的`username`参数包含一段bash代码，该代码首先将一段base64编码的payload解码，然后执行。该payload是一个python反弹shell脚本，它会连接攻击者指定的IP地址和端口，并将shell重定向到该连接。`os.system`函数执行的command将payload作为参数传递给`curl`，进一步通过shell进行执行。

**有效性:** 根据github和PacketstormSecurity的搜索结果，存在公开可用的POC代码，并且`exploit.py`代码看起来也实现了该POC的逻辑。因此，该POC代码应该是有效的。

**投毒风险:** 仔细分析了`exploit.py`的代码，未发现任何明显的投毒代码。该脚本的主要功能是利用SSRF漏洞触发反弹shell，其行为与漏洞描述一致。脚本中没有额外的恶意操作，例如删除文件、窃取凭据或安装后门。用于反弹shell的python代码虽然可以用来执行任意命令，但这是漏洞利用的一部分，不能算作投毒。所有操作都围绕着利用SSRF漏洞获取shell的目的。因此，投毒风险为0%。

**项目地址:** [G4sp4rCS/htb-sau-automated](https://github.com/G4sp4rCS/htb-sau-automated)

**漏洞详情:** [CVE-2023-27163](https://nvd.nist.gov/vuln/detail/CVE-2023-27163)