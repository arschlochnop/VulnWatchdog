## Mongoose WebSocket Integer Overflow Vulnerability

**漏洞编号:** CVE-2025-51495

**漏洞类型:** Integer Overflow

**影响应用:** Mongoose

**危害等级:** 高危，可能导致内存损坏、程序崩溃或远程代码执行

**影响版本:** 7.17

**利用条件:** 需要目标系统运行 Mongoose v7.17，并启用 WebSocket 服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞利用代码，Mongoose (v7.17) 的 WebSocket 模块中存在一个整数溢出漏洞，位于 `mg_ws_cb` 函数中。该函数负责处理传入的 WebSocket 帧。攻击者可以通过构造特制的 WebSocket 数据包，设置 `ofs=0`，从而导致在计算 `ofs-1` 时发生整数溢出。溢出后的 `ofs` 值会变得非常大，远大于接收缓冲区 `recv.buf` 的实际长度。后续的 WebSocket 处理函数可能会使用这个被篡改的 `ofs` 值，造成越界内存访问或程序崩溃。

提供的 PoC 包含修改后的客户端代码，用于发送触发漏洞的 WebSocket 数据包。服务器端在接收并处理这个数据包后，会因为整数溢出导致的越界访问而崩溃。ASAN 检测表明了这种崩溃。

**有效性评估：**
PoC 代码表明漏洞利用的有效性，因为它可以导致目标服务器崩溃。

**投毒风险评估：**
评估投毒风险主要关注代码中是否存在非预期的恶意行为，例如反弹 shell、植入后门等。目前提供的代码主要集中于展示如何触发整数溢出导致服务器崩溃。代码的目的是清晰地展示漏洞，而不是隐藏恶意功能。当然，如果攻击者将此PoC集成到更大的攻击框架中，可能会存在其他风险。

代码库投毒风险评估：10%。风险较低，因为 PoC 的主要功能是触发已知的漏洞，而不是执行任何恶意活动。

**利用方式：**
1.  攻击者构造特制的 WebSocket 数据包，其中包含触发整数溢出的恶意数据。
2.  攻击者将该数据包发送到运行着易受攻击的 Mongoose 服务器。
3.  服务器的 `mg_ws_cb` 函数处理该数据包时，由于整数溢出，`ofs` 变量的值变得异常大。
4.  后续的 WebSocket 处理函数使用这个错误的 `ofs` 值访问内存，导致越界访问。
5.  越界访问可能导致内存损坏、程序崩溃，甚至潜在的远程代码执行。

**项目地址:** [cainiao159357/CVE-2025-51495](https://github.com/cainiao159357/CVE-2025-51495)

**漏洞详情:** [CVE-2025-51495](https://nvd.nist.gov/vuln/detail/CVE-2025-51495)