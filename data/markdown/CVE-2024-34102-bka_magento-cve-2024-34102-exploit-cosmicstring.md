## CVE-2024-34102-Adobe Commerce/Magento-XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XXE (XML External Entity)

**影响应用:** Adobe Commerce / Magento

**危害等级:** 高危，可能导致任意代码执行，敏感信息泄露

**影响版本:** <= 2.4.7, <= 2.4.6-p5, <= 2.4.5-p7, <= 2.4.4-p8

**利用条件:** 需要网络访问，无需用户交互

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-34102是一个存在于Adobe Commerce和Magento中的XML外部实体（XXE）漏洞。攻击者可以通过发送特制的XML文档，该文档引用外部实体来利用此漏洞，从而可能导致任意代码执行和敏感信息泄露。该漏洞无需身份验证即可利用，CVSS评分为9.8，属于高危漏洞。

**有效性:**

漏洞库信息和搜索结果表明该漏洞是真实存在的，且已经被公开利用。提供的POC代码包含利用该漏洞的演示和Exploit Demo。

**投毒风险:**

尽管POC代码主要是为了演示漏洞，但其中`cve-2024-34102-exploit/README.md`文档包含利用步骤，可能被恶意攻击者直接使用，使得漏洞更容易被利用。`/cve-2024-34102-exploit/change-crypt-key.p`文件可能包含更改加密密钥的操作,存在一定的风险。整体投毒风险较低，预估为10%。

**利用方式:**

1.  攻击者构造包含恶意外部实体引用的XML文档。
2.  将该XML文档发送到存在XXE漏洞的Adobe Commerce/Magento应用程序。
3.  应用程序解析XML文档时，会尝试解析外部实体。
4.  攻击者可以通过外部实体引用来读取服务器上的任意文件（例如，/etc/passwd）或执行任意代码。

从POC代码来看，利用方式主要是通过POST请求发送恶意的XML数据到`/rest/all/V1/guest-carts/{cartId}/estimate-shipping-methods`接口，提取服务器环境变量中的crypt key，然后利用crypt key构造JWT token，从而访问受保护的REST API。

搜索引擎结果也支持这一利用方式，例如网页4提到“nested deserialization”可能存在问题，意味着攻击者可以通过嵌套的XML结构触发漏洞。网页7提供了受影响的版本信息。

总而言之，该漏洞利用起来相对简单，危害巨大，需要及时修复。

**项目地址:** [bka/magento-cve-2024-34102-exploit-cosmicstring](https://github.com/bka/magento-cve-2024-34102-exploit-cosmicstring)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)