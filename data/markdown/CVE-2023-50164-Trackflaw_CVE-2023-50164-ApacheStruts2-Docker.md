## CVE-2023-50164-Apache Struts-文件上传路径穿越导致RCE

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 文件上传路径穿越

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 <= version <= 2.5.32 和 6.0.0 <= version <= 6.3.0.1

**利用条件:** 需要目标系统存在文件上传功能并且使用受影响的 Apache Struts 版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164 是 Apache Struts 2 中的一个严重漏洞，允许攻击者通过操纵文件上传参数来执行路径遍历攻击。如果应用程序存在缺陷，攻击者可以上传恶意文件，从而导致远程代码执行(RCE)。

**有效性：**

提供的 Dockerfile 旨在构建一个易受攻击的 Apache Struts 2 环境，用于演示 CVE-2023-50164。它包含构建和运行 Struts 应用程序所需的步骤。通过构建和运行这个 Docker 镜像，研究人员和安全专业人员可以安全地研究和利用此漏洞。

**投毒风险：**

在提供的文件中，`/tmp/c76c54a0ed5cbc2c09e0533b7830ced8/tomcat-users.xml` 文件包含一个具有预定义用户名“admin”和密码“trackflaw”的 Tomcat 管理员用户。虽然这允许轻松访问 Tomcat 管理界面以进行漏洞利用，但它也引入了投毒风险，如果这个配置被用于生产环境，攻击者可以通过默认凭据控制 Tomcat 服务器。此外，由于 `README.md` 文件中指出“The weaponized exploit code is not supplied.”，这意味着该仓库不包含直接利用漏洞的完整exp，用户需要自行编写利用代码，也增加了一定的投毒可能性，比如引导用户访问恶意网站或者下载包含恶意代码的exp。综合考虑，投毒风险相对较低，估计为10%。

**利用方式：**

根据漏洞库信息和搜索结果，漏洞利用方式如下：

1.  **路径遍历：** 攻击者通过修改文件上传请求中的参数，例如文件名，使其包含路径遍历字符（如 `../`），从而突破文件上传目录的限制。
2.  **恶意文件上传：**  通过路径遍历，攻击者可以将恶意文件上传到服务器上任意可写目录，例如 Web 应用程序的根目录或其他包含可执行脚本的目录。
3.  **远程代码执行 (RCE)：** 上传的恶意文件可以是包含恶意代码的 JSP 文件、Shell 脚本或其他服务器能够执行的文件。一旦该文件被服务器执行，攻击者就可以在服务器上执行任意命令，从而实现远程代码执行。

**项目地址:** [Trackflaw/CVE-2023-50164-ApacheStruts2-Docker](https://github.com/Trackflaw/CVE-2023-50164-ApacheStruts2-Docker)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)