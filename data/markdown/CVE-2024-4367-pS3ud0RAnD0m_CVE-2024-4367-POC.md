## CVE-2024-4367 PDF.js 任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** PDF.js (Firefox, Firefox ESR, Thunderbird)

**危害等级:** 高危，可能导致跨站脚本攻击 (XSS), 信息泄露等

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 受害者需要打开恶意PDF文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4367是PDF.js中存在的一个漏洞，由于在处理字体时缺少类型检查，允许在PDF.js上下文中执行任意JavaScript代码。攻击者可以制作恶意的PDF文件，当受害者使用存在漏洞的Firefox, Firefox ESR或Thunderbird打开该文件时，恶意JavaScript代码会被执行。

**有效性：**

根据漏洞信息和搜索引擎结果，该漏洞影响多个Mozilla产品，且存在公开可用的PoC代码。PoC代码通过`pdf-modify.py`脚本修改PDF文件，将恶意JavaScript代码注入到PDF文件中，替换原始文件中的占位符，因此该PoC代码的有效性较高。

**投毒风险：**

查看PoC代码，`pdf-modify.py`脚本的主要功能是替换PDF文件中的特定字符串（`PLACEHOLDER`）为攻击者提供的恶意JavaScript代码。脚本本身没有明显的恶意行为，例如回连攻击者服务器、植入后门等。`README.md` 也提供了使用说明，整体代码相对简洁易懂。

需要注意的是，攻击者可以修改`payload_new`变量来定义执行的JavaScript代码。因此，如果用户不小心使用了包含恶意payload的`payload_new`，则会导致攻击。但这种风险不在于PoC代码本身被投毒，而在于使用者使用的payload是否安全。

基于以上分析，认为该PoC代码存在较低的投毒风险（约5%）。

**利用方式：**

1.  攻击者制作恶意的PDF文件，其中包含特殊的占位符（`PLACEHOLDER`）。
2.  攻击者使用`pdf-modify.py`脚本，将恶意JavaScript代码注入到PDF文件中，替换占位符。
3.  攻击者将修改后的恶意PDF文件发送给受害者。
4.  受害者使用存在漏洞的Firefox, Firefox ESR或Thunderbird打开该PDF文件。
5.  PDF.js解析PDF文件时，会执行注入的恶意JavaScript代码，从而导致任意代码执行。

恶意代码可以执行的操作包括：

*   窃取用户的Cookie、localStorage、sessionStorage等敏感信息。
*   将用户重定向到钓鱼网站。
*   在用户的浏览器中执行任意代码。

**项目地址:** [pS3ud0RAnD0m/CVE-2024-4367-POC](https://github.com/pS3ud0RAnD0m/CVE-2024-4367-POC)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)