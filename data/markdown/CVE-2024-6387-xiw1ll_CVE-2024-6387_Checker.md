## CVE-2024-6387 OpenSSH regreSSHion 漏洞检测

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 远程代码执行/拒绝服务

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行或拒绝服务攻击

**影响版本:** 8.5p1 <= OpenSSH <= 9.7p1 (受影响版本范围)

**利用条件:** 目标系统运行受影响版本的OpenSSH服务，并且攻击者能够建立网络连接。

**POC 可用性:** 是，存在漏洞检测POC代码

**投毒风险:** 5%

## 详情

CVE-2024-6387（regreSSHion）是OpenSSH服务器中的一个安全回归漏洞，源于CVE-2006-5051。该漏洞是一个信号处理竞争条件，可能导致sshd以不安全的方式处理某些信号。未经身份验证的远程攻击者可以通过在设定的时间内未能通过身份验证来触发此漏洞，从而导致远程代码执行（RCE）或拒绝服务（DoS）。

**有效性：**
根据漏洞信息和搜索结果，此漏洞被认为是高危的，并且存在公开可用的PoC利用代码。该漏洞利用的复杂性较高(CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H)，意味着成功利用需要精确的时序和条件，并非总是可靠，但成功利用的后果非常严重。

**投毒风险：**
提供的YAML文件是一个nuclei模板，用于检测目标系统上运行的OpenSSH版本是否在受影响的范围内，并排除已知已修复的发行版（如Ubuntu, Debian等）。README.md文件列出了排除补丁的版本。该代码的主要目的是漏洞检测，而不是漏洞利用。该nuclei模板本身不包含恶意代码，但是，如果攻击者修改此文件以错误地排除某些已修复的版本，或者包含虚假信息以误导用户，则可能存在投毒风险。 假设，攻击者修改YAML文件，移除对某些打了补丁的版本的排除规则，那么扫描结果可能会错误地将打了补丁的系统判定为存在漏洞，诱导用户采取不必要的措施。 但是，这种投毒攻击依赖于用户信任并使用被篡改的检测脚本，总体风险较低。 综合来看，POC本身投毒风险较低，约为5%。

**利用方式：**
1.  **版本检测：** 攻击者可以使用提供的nuclei模板或类似工具来扫描目标系统，确定其运行的OpenSSH版本是否在受影响的范围内。
2.  **触发竞争条件：** 一旦确认目标系统存在漏洞，攻击者需要通过发送大量无效的身份验证请求来触发竞争条件。这通常涉及在LoginGraceTime内尝试多次身份验证失败。
3.  **代码执行/拒绝服务：** 成功触发竞争条件后，sshd可能会以不安全的方式处理信号，从而允许攻击者执行任意代码或导致服务崩溃（拒绝服务）。 根据搜索结果，利用可能需要多次重试才能成功。

**缓解措施：**
*   升级到OpenSSH 9.8或更高版本。
*   禁用LoginGraceTime或将其设置为0，并使用fail2ban等工具来管理连接。
*   应用发行版提供的安全补丁。

**项目地址:** [xiw1ll/CVE-2024-6387_Checker](https://github.com/xiw1ll/CVE-2024-6387_Checker)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)