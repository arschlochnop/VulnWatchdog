## CVE-2007-2447-Samba-远程命令执行

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 目标Samba服务器启用 'username map script' 配置，且攻击者需要网络访问Samba服务。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2007-2447 漏洞存在于 Samba 的 MS-RPC 功能中，允许远程攻击者通过 shell 元字符执行任意命令。该漏洞主要影响启用了 'username map script' 的 Samba 服务器。 

**有效性：**
提供的 Go 语言 POC 代码利用了该漏洞。它通过构造包含 shell 元字符的恶意用户名，并通过 SMB 协议的 NTLM 认证过程将其发送到目标服务器。如果目标服务器启用了 'username map script'，Samba 将尝试执行该恶意用户名作为脚本，从而导致远程命令执行。

**投毒风险：**
代码主体实现了漏洞利用的功能，主要逻辑集中在构造payload和发送恶意用户名。 `README.md`、 `go.mod`、`go.sum`文件相对比较安全,恶意代码通常会隐藏在字符串或者base64等编码中,该仓库未发现。
该仓库的投毒风险较低，约为1%。

**利用方式：**
1.  攻击者需要确定目标 Samba 服务器的版本在 3.0.0 到 3.0.25rc3 之间，并且启用了 'username map script'。
2.  攻击者需要准备一个包含恶意 shell 命令的 payload。该 payload 将被注入到用户名中。
3.  攻击者使用 POC 代码，构造包含恶意 payload 的用户名，并通过 SMB 协议的 NTLM 认证过程将其发送到目标服务器。
4.  目标服务器接收到恶意用户名后，由于启用了 'username map script'，Samba 将尝试执行该用户名作为脚本，从而触发远程命令执行。
5.  攻击者可以在目标服务器上执行任意命令，例如安装后门、窃取数据等。

**项目地址:** [IamLucif3r/CVE-2007-2447-Exploit](https://github.com/IamLucif3r/CVE-2007-2447-Exploit)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)