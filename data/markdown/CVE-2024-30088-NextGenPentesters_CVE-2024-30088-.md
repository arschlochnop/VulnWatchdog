## CVE-2024-30088-Windows Kernel Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2024-30088

**漏洞类型:** 权限提升

**影响应用:** Windows Kernel

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** 受影响的Windows 10, Windows 11 和 Windows Server版本，详见CVE信息

**利用条件:** 需要在受影响的Windows系统上本地执行。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-30088是一个Windows内核权限提升漏洞，属于TOCTOU（Time-of-check Time-of-use）竞争条件漏洞。根据漏洞库信息和搜索结果，该漏洞已被APT34和OilRig等组织利用于实际攻击中，CISA KEV目录也收录了此漏洞，说明具有较高现实威胁。

**有效性评估：**

提供的POC代码似乎有效。从代码分析来看，该POC利用了`NtQuerySystemInformation`函数获取内核对象地址，然后通过`CreateProcessFromHandle`函数，结合父进程句柄欺骗，创建具有SYSTEM权限的新进程。这种利用方式绕过了某些安全检查，从而提升权限。

**投毒风险分析：**

分析POC代码，主要关注以下几个方面：

*   **非预期行为：** 代码中是否存在与漏洞利用无关的、可能对系统造成损害的操作？
*   **远程连接：** 代码是否尝试建立网络连接，下载或上传数据？
*   **持久化：** 代码是否尝试在系统上安装后门或修改启动项？

从提供的代码来看，主要功能集中于利用漏洞本身，没有发现明显的恶意代码，如远程连接、文件篡改或持久化后门。但是，仍然存在一定的投毒风险，比如，代码中使用的硬编码的偏移量可能在特定版本的Windows上导致崩溃，或者某些错误处理逻辑可能被利用。
因此，判定投毒风险为10%。

**利用方式：**

1.  **漏洞触发：** 利用TOCTOU竞争条件，在检查和使用内核对象之间的时间窗口内修改对象状态，欺骗内核。
2.  **句柄泄露：** 使用`NtQuerySystemInformation`获取目标进程的句柄信息，从而找到内核对象的地址。
3.  **父进程欺骗：** 通过`CreateProcessFromHandle`创建一个新进程，并将其父进程设置为具有SYSTEM权限的内核对象句柄。这样，新进程就会继承SYSTEM权限。
4.  **权限提升：** 成功创建新进程后，攻击者就可以执行任意SYSTEM权限的命令。


**项目地址:** [NextGenPentesters/CVE-2024-30088-](https://github.com/NextGenPentesters/CVE-2024-30088-)

**漏洞详情:** [CVE-2024-30088](https://nvd.nist.gov/vuln/detail/CVE-2024-30088)