## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露、数据篡改和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要目标WordPress站点存在易受攻击的插件（如ele-custom-skin）且插件使用了易受攻击的WP_Query方式。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-21661 是 WordPress 中由于 WP_Query 中不正确的清理而导致的 SQL 注入漏洞。此漏洞允许攻击者执行任意 SQL 查询，从而可能导致未经授权的数据访问或修改。漏洞存在于 WordPress 5.8.3 之前的版本中。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在公开的PoC利用代码（如Exploit-DB上的50663）。提供的Python脚本`CVE-2022-21661.py`也证实了这一点，该脚本尝试利用此漏洞从数据库中提取信息，如用户名。脚本通过时间盲注的方式爆破数据。

**投毒风险：**

仔细审查提供的Python脚本后，发现其主要功能是利用SQL注入漏洞。脚本包含以下功能：

*   **信息收集：** 脚本可以检测WordPress版本和是否存在`ele-custom-skin`插件。
*   **SQL注入：** 脚本利用时间盲注从数据库中提取信息，例如用户名。通过构造包含`sleep()`函数的SQL查询实现时间盲注。

没有发现明显的恶意或后门代码。脚本中的延时阈值和目标域名可以通过参数进行修改，这是正常的功能，不属于投毒行为。但是，由于脚本能被用于攻击，依然存在一定的安全风险，例如被攻击者恶意利用。

因此，评估投毒风险较低，大概在1%左右，主要是指被恶意利用的风险，而非代码本身包含恶意代码。

**利用方式：**

1.  **漏洞定位：** 漏洞存在于 `WP_Query` 类中，当插件或主题以不安全的方式使用它时，可能导致 SQL 注入。
2.  **利用前提：** 目标 WordPress 站点需要安装存在漏洞的插件（比如`ele-custom-skin`），且该插件使用了存在漏洞的`WP_Query`方式。高权限用户才可能触发漏洞。
3.  **攻击步骤：**
    *   攻击者首先需要确定目标站点上是否存在易受攻击的插件。
    *   然后，攻击者通过构造恶意的 `tax_query` 参数，将 SQL 注入到 `WP_Query` 查询中。
    *   利用时间盲注的方法，逐步提取数据库中的敏感信息，例如用户名、密码哈希等。
4.  **PoC脚本分析:**
    *  脚本首先定义了请求头，包括User-Agent和X-Forwarded-For，用于模拟正常请求。
    *  `get_info`函数用于获取wordpress版本信息和elementor插件信息。
    *  `payload_format`函数用于生成SQL注入的payload，使用了时间盲注的方法，如果条件成立，则sleep一段时间。
    *  `get_userlogin`函数用于破解用户名，通过二分法和时间盲注逐步猜测用户名。

**项目地址:** [guestzz/CVE-2022-21661](https://github.com/guestzz/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)