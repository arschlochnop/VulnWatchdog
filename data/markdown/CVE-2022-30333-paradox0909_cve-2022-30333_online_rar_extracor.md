## CVE-2022-30333-UnRAR路径遍历

**漏洞编号:** CVE-2022-30333

**漏洞类型:** 路径遍历

**影响应用:** UnRAR

**危害等级:** 高危，允许攻击者在目标文件系统上写入任意文件，可能导致远程代码执行。

**影响版本:** < 6.12 (Linux/UNIX)

**利用条件:** 需要目标系统运行受影响版本的UnRAR，且攻击者能够控制RAR文件的内容，通常结合其他漏洞利用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30333是一个存在于RARLAB UnRAR 6.12之前版本（Linux和UNIX）中的路径遍历漏洞。该漏洞允许攻击者在解压RAR文件时，通过构造恶意的文件路径，将文件写入到目标文件系统的任意位置，例如，创建`~/.ssh/authorized_keys`文件来实现SSH免密登录。\n\n根据搜索引擎结果，此漏洞已被CISA列入已知被利用漏洞目录中，并且被用于攻击Zimbra等应用。\n\n提供的漏洞利用代码包含一个Ruby脚本(`cve-2022-30333.rb`)，该脚本可以生成包含恶意路径的RAR文件。脚本接收两个参数：目标文件路径和要写入的文件内容。脚本会将文件内容写入到指定的目标路径。\n\n利用方式：\n1.  攻击者构造包含恶意路径的RAR文件。恶意路径指向目标文件系统上的敏感位置。\n2.  诱使用户或系统使用UnRAR解压该RAR文件。\n3.  UnRAR在解压过程中，会将文件写入到恶意路径所指定的位置。\n\n投毒风险分析：\n查看POC代码，发现`/tmp/9d35847d0e3708c158a7a50cc53b0747/501496cd-bc48-4cdf-a628-b6ee60d29be3/src/extract.php`文件中使用了`shell_exec`函数，并且拼接了用户上传的文件名，虽然使用了`escapeshellarg`函数进行转义，但是仍然存在一定的风险，例如编码问题或者其他绕过方式，如果利用不当，可能造成命令注入。\n`flag.c`文件中存在`DH{**REMOVE**}\n`，可能为了混淆或者作为示例。\n`/tmp/9d35847d0e3708c158a7a50cc53b0747/501496cd-bc48-4cdf-a628-b6ee60d29be3/<svg onload=alert(document.domain)>.php`存在XSS的风险，同样存在投毒的可能。\n综合来看，该仓库存在一定的投毒风险，主要集中在`extract.php`的命令注入和`<svg onload=alert(document.domain)>.php`的XSS，以及`flag.c`文件的flag可能存在误导性。\n\n有效性：\n根据漏洞描述和提供的POC代码，该漏洞利用是有效的。POC能够生成恶意的RAR文件，并利用UnRAR的路径遍历漏洞将文件写入到指定位置。需要注意的是，该漏洞只影响Linux/UNIX平台上的UnRAR，不影响WinRAR和Android RAR。

**项目地址:** [paradox0909/cve-2022-30333_online_rar_extracor](https://github.com/paradox0909/cve-2022-30333_online_rar_extracor)

**漏洞详情:** [CVE-2022-30333](https://nvd.nist.gov/vuln/detail/CVE-2022-30333)