## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (除已修复版本)

**利用条件:** 需要目标Grafana实例运行在受影响版本，且可网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞。攻击者可以利用该漏洞通过 `grafana_host_url/public/plugins//` 路径读取本地文件。PoC 代码首先从 `/metrics` 端点获取已安装插件的 ID，然后利用目录遍历漏洞读取目标文件（默认为 `/etc/passwd`）。PoC 还尝试读取用户的 SSH 私钥，并使用该密钥通过 SSH 连接到目标系统，并尝试提权。 

**有效性评估：**
漏洞库信息和搜索结果均表明该漏洞存在且有公开的 PoC。提供的PoC代码看起来完整且逻辑清晰，应该可以有效利用该漏洞，提取敏感文件。

**投毒风险评估：**
该PoC的代码功能比较直观，主要用于文件读取和SSH密钥的利用。其中存在少量可疑点：PoC会尝试使用读取到的SSH密钥进行SSH连接，并在目标机器上执行一些命令(sudo -l，find suid/guid文件， install awk 以及读取 user.txt和 root.txt)。这些命令本身不一定是恶意的，但可能被滥用于收集目标系统信息或尝试提权。因此，存在一定的投毒风险，约为10%。主要风险点在于脚本自动化了SSH密钥的利用和后续的命令执行，攻击者可能修改这些命令以达到恶意目的。

**利用方式：**
1.  确定目标 Grafana 实例的版本是否在受影响范围内 (8.0.0-beta1 to 8.3.0, excluding patched versions)。
2.  使用 PoC 脚本，指定目标 Grafana 实例的 URL 和要读取的文件路径。
3.  脚本将利用目录遍历漏洞读取指定文件，并尝试读取用户的SSH密钥，如果成功读取到SSH密钥，会尝试使用SSH密钥登录并执行提权操作。
4.  攻击者可以根据需要修改脚本，读取其他敏感文件或执行其他操作。

**项目地址:** [mauricelambert/LabAutomationCVE-2021-43798](https://github.com/mauricelambert/LabAutomationCVE-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)