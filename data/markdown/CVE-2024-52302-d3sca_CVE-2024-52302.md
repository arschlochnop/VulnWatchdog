## CVE-2024-52302-common-user-management-任意文件上传导致RCE

**漏洞编号:** CVE-2024-52302

**漏洞类型:** 任意文件上传

**影响应用:** common-user-management

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 204402bb8b68030c14911379ddc82cfff00b8538

**利用条件:** 需要低权限用户账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-52302是common-user-management应用中的一个高危漏洞，允许经过身份验证的低权限攻击者通过上传恶意文件（例如JSP、PHP、HTML）到/api/v1/customer/profile-picture端点来实现远程代码执行。漏洞源于应用程序对上传文件缺乏适当的验证，攻击者可以绕过限制，上传任意类型的文件。 

**有效性：**
提供的PoC代码有效，它首先尝试使用提供的用户名和密码登录应用程序，如果登录成功，则获取Bearer token。然后，它使用此token将指定的恶意文件上传到/api/v1/customer/profile-picture端点。一旦文件上传成功，攻击者就可以通过构造的URL访问该文件，从而执行恶意代码。

**投毒风险：**
PoC代码本身看起来比较直接，没有明显的恶意代码。但是，存在一些小的风险：
1.  `requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)` 禁用了SSL证书验证警告。虽然这在测试环境下很常见，但在实际攻击中可能会被利用。例如，如果目标网络使用自签名证书，攻击者可能会更容易执行中间人攻击。
2.  `verify=False` 在`requests.post`调用中也禁用了SSL证书验证，这与上述情况类似，增加了中间人攻击的风险。
虽然这些做法本身不是恶意投毒，但会降低安全性，为潜在的攻击创造条件。因此，投毒风险评定为10%。

**利用方式：**
1.  **身份验证：** 使用提供的用户名和密码登录应用程序。由于漏洞描述中表明需要低权限用户账户，因此可能需要先注册一个普通用户。
2.  **获取Token：** 成功登录后，从响应中提取Bearer token。
3.  **上传恶意文件：** 使用获取的token，通过POST请求将包含恶意代码的文件（例如JSP webshell）上传到/api/v1/customer/profile-picture端点。
4.  **执行代码：** 确定上传文件的URL，并通过浏览器或curl等工具访问该URL，触发恶意代码的执行。
5.  **搜索引擎补充**: 根据搜索引擎结果，该漏洞允许上传HTML文件，这意味着攻击者可以通过上传包含恶意JavaScript的HTML文件来执行XSS攻击，甚至通过XSS攻击来进一步利用服务器。

**项目地址:** [d3sca/CVE-2024-52302](https://github.com/d3sca/CVE-2024-52302)

**漏洞详情:** [CVE-2024-52302](https://nvd.nist.gov/vuln/detail/CVE-2024-52302)