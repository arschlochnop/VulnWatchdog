## CVE-2024-28397 js2py Sandbox Escape

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 代码注入/沙箱逃逸

**影响应用:** js2py

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 0.74

**利用条件:** 目标系统运行js2py库且允许执行JavaScript代码

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-28397 漏洞存在于 js2py 库中，允许攻击者通过构造的 API 调用执行任意代码。该漏洞利用 js2py 的沙箱逃逸机制，通过 JavaScript 代码访问 Python 的内部对象，最终执行系统命令。

**漏洞分析：**

1.  **漏洞原理：** js2py 库在处理 JavaScript 代码时，允许通过 `Object.getOwnPropertyNames({})` 等方法访问 Python 的内部对象，如 `__class__`、`__base__` 和 `__subclasses__`。攻击者可以利用这些内部对象，查找 `subprocess.Popen` 类，并使用该类执行任意系统命令。
2.  **利用方式：** 提供的漏洞利用代码展示了如何利用该漏洞。首先，生成一个反向 shell 的 payload，并进行 Base64 编码。然后，构造一段 JavaScript 代码，该代码利用 `Object.getOwnPropertyNames({})` 访问 Python 内部对象，找到 `subprocess.Popen` 类，并使用该类执行 Base64 编码后的 payload。payload 被解码和执行，从而建立一个反向 shell 连接到攻击者的机器。
3.  **POC有效性：** 提供的 Go 脚本和 Bash 脚本都能够根据用户输入的 Target URL、IP 地址和端口，生成相应的 JavaScript 代码并发送到目标 URL，从而触发漏洞并建立反向 shell，因此 POC 代码有效。
4.  **投毒风险：** 通过分析 `exploit.go`，`exploit.sh` 和 `README.md` 没有发现明显的恶意投毒代码。Go 脚本和 Bash 脚本的功能是获取用户输入（目标 URL、IP 地址、端口），生成 JavaScript payload，然后发送 HTTP 请求。主要的漏洞利用逻辑在 JavaScript payload 中。考虑到该漏洞的特殊性（沙箱逃逸），其本身就允许执行任意代码，因此很难区分正常的利用代码和恶意投毒代码。不过，如果攻击者修改了脚本，加入了额外的功能，例如上传敏感信息，或者安装后门等，那么就存在投毒风险。`README.md` 文件只包含漏洞的描述和使用说明，没有可疑代码。

   综合来看，直接的投毒风险较低，但是使用者仍然需要小心，确保脚本来源可靠。

**缓解措施：**

*   升级 js2py 库到修复版本。
*   实施适当的输入验证和清理。
*   使用安全的沙箱替代方案。
*   采用纵深防御安全措施。

**项目地址:** [0xDTC/js2py-Sandbox-Escape-CVE-2024-28397-RCE](https://github.com/0xDTC/js2py-Sandbox-Escape-CVE-2024-28397-RCE)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)