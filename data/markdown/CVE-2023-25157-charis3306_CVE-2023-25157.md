## CVE-2023-25157-GeoServer-SQL注入

**漏洞编号:** CVE-2023-25157

**漏洞类型:** SQL注入

**影响应用:** GeoServer

**危害等级:** 高危，可能导致敏感信息泄露、数据篡改、甚至服务器权限获取

**影响版本:** 2.20.x < 2.20.7, 2.19.x < 2.19.7, 2.18.x < 2.18.7, 2.21.x < 2.21.4, 2.22.x < 2.22.2

**利用条件:** GeoServer服务开启，目标存在漏洞版本，且允许未授权网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25157是GeoServer中的一个SQL注入漏洞。由于GeoServer对用户输入过滤不严格，远程未授权攻击者可以构造畸形的过滤语法，绕过GeoServer的词法解析，从而造成SQL注入。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞的利用是有效的。PoC代码中提供了利用此漏洞的请求示例，以及用于自动化检测的Python脚本。

**投毒风险：**
虽然提供的Python脚本主要功能是利用SQL注入漏洞，但仍存在一定的投毒风险。风险点在于`PROXY`变量的使用。如果攻击者修改了脚本中的代理地址，例如设置为一个恶意代理服务器，则可以通过该代理服务器捕获或篡改经过该代理的流量。例如脚本片段：
`PROXY = "http://127.0.0.1:8080/" if False else None`
如果将`False`修改为`True`， 并且用户使用了恶意的代理，则可能被投毒。此外，如果脚本被修改为执行恶意代码（例如下载和执行其他程序），则存在更大的风险。总体来说，投毒风险较低，约为10%，主要取决于用户是否会使用来路不明的代理或修改脚本本身。

**利用方式：**
利用方式如下：
1.  **获取可用功能名称：** 通过发送`GetCapabilities`请求到`/geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities`端点，获取GeoServer支持的WFS功能名称。
2.  **获取相关功能可用属性：** 针对特定功能名称，例如`vulhub:example`，发送`DescribeFeatureType`请求到`/geoserver/wfs?request=DescribeFeatureType&version=2.0.0&service=WFS&outputFormat=application/json&typeName=vulhub:example`端点，获取该功能的可用属性列表。
3.  **构造SQL注入Payload：** 针对特定属性，构造包含SQL注入的`CQL_FILTER`参数，发送`GetFeature`请求到`/geoserver/ows`端点。例如：
`/geoserver/ows?service=wfs&version=1.0.0&request=GetFeature&typeName=vulhub:example&CQL_FILTER=strStartsWith(name,'x'')+=+true+and+1=(SELECT+CAST+((SELECT+version())+AS+INTEGER))+--+')+=+true`
此payload利用了`strStartsWith`函数和`CQL_FILTER`参数，注入SQL代码来执行数据库操作，如获取数据库版本信息。
4.  **验证与自动化：** 提供的`exp.py`脚本自动化了上述过程。它首先从目标GeoServer获取功能列表和属性，然后针对每个属性构造SQL注入payload，并检查响应中是否包含错误信息，以此判断漏洞是否存在。

**项目地址:** [charis3306/CVE-2023-25157](https://github.com/charis3306/CVE-2023-25157)

**漏洞详情:** [CVE-2023-25157](https://nvd.nist.gov/vuln/detail/CVE-2023-25157)