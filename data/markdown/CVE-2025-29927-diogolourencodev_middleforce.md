## CVE-2025-29927-Next.js-中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问、数据泄露和权限提升

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用了Next.js中间件进行权限验证，且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 存在于 Next.js 中间件中，允许攻击者通过操纵特定的 HTTP 头部来绕过授权检查。该漏洞的利用方式如下：

1.  **漏洞描述：** Next.js 应用如果使用中间件进行授权验证，且版本在受影响范围内，则可能存在此漏洞。
2.  **利用方式：** 攻击者通过发送带有 `x-middleware-subrequest: middleware` 头的 HTTP 请求，可以绕过中间件的授权检查，从而访问受保护的路由或 API 接口。
3.  **POC 代码分析：** 提供的 `middleforce.py` 脚本通过发送两种类型的请求来检测漏洞：
    *   **Basic Request：**  发送不带任何特殊头的普通请求，获取状态码。
    *   **Middleware Request：** 发送包含 `x-middleware-subrequest: middleware` 以及其他一些头（如 `X-Frame-Options`, `Access-Control-Allow-*`）的请求，模拟中间件子请求，获取状态码。
    *   **漏洞判断：** 如果 Basic Request 被拦截（例如返回 403），而 Middleware Request 成功返回 200，则表明存在漏洞，中间件授权被绕过。
4.  **有效性评估：** 根据漏洞库信息和POC代码，该漏洞利用是有效的。POC代码模拟了攻击者绕过中间件授权的过程，能够准确地检测到存在漏洞的 Next.js 应用。
5.  **投毒风险分析：**
    *   `middleforce.py`：该脚本的主要功能是发送带有特定 header 的请求并根据响应状态码判断是否存在漏洞，逻辑相对简单，未发现明显的恶意代码。但header中包含一些与CORS相关的header可能存在一些风险。
    *   `install.sh`：安装脚本尝试使用 `pip install -r requirements.txt --break-system-packages` 安装依赖，这在某些系统配置下可能导致问题，但并非明显的恶意行为。将脚本复制到 `/usr/local/bin` 目录是正常的安装流程。
    *   `README.md`：只是工具的说明文档，没有风险。
    *   **综合评估：** 总体而言，该仓库中存在恶意投毒代码的可能性较低，但某些配置可能引起使用者系统异常。投毒风险评估为 10%。

**总结：** 该漏洞利用有效，攻击者可以利用该漏洞绕过 Next.js 中间件的授权检查，访问受保护的资源。尽管 POC 代码本身未发现明显的投毒行为，但仍需谨慎使用，并在受控环境中进行测试。

**项目地址:** [diogolourencodev/middleforce](https://github.com/diogolourencodev/middleforce)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)