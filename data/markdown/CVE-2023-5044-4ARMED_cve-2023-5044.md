## CVE-2023-5044-ingress-nginx-代码注入

**漏洞编号:** CVE-2023-5044

**漏洞类型:** 代码注入

**影响应用:** ingress-nginx

**危害等级:** 高危，可能导致权限提升和集群控制

**影响版本:** < 1.9.0

**利用条件:** 需要对Ingress资源具有创建或修改权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-5044 漏洞存在于 Kubernetes ingress-nginx 控制器中，允许攻击者通过 `nginx.ingress.kubernetes.io/permanent-redirect` 注解注入恶意代码。 

**有效性：**

根据漏洞信息和搜索结果，该漏洞是真实存在的，并且已被公开披露和利用。多个安全厂商和社区都发布了相关的安全公告和分析文章。由于版本低于1.9.0的ingress-nginx均受影响，因此PoC有效性高。

**投毒风险：**

提供的漏洞利用代码只包含GNU GPL协议，是一个通用的开源协议，不包含任何恶意代码或后门。但是，不能完全排除其他未公开的利用代码或方法中存在投毒的风险。考虑到GPL协议本身的开源和透明特性，以及对代码的快速审查，可以判断此仓库中存在作者隐藏的投毒代码的可能性较低，初步估计投毒风险为10%。

**利用方式：**

攻击者可以通过以下步骤利用该漏洞：

1.  **创建或修改 Ingress 资源：** 攻击者需要拥有创建或修改 Ingress 资源的权限。通常需要`low`权限的用户即可操作
2.  **注入恶意代码：** 在 Ingress 资源的 `nginx.ingress.kubernetes.io/permanent-redirect` 注解中，注入包含恶意代码的字符串。由于nginx配置允许变量展开，攻击者可以利用这一点执行任意命令。
3.  **触发漏洞：**  Ingress 控制器会解析该注解，并将恶意代码写入 Nginx 配置文件。当 Nginx 重新加载配置时，恶意代码会被执行。
4.  **权限提升：** 由于 Nginx 通常以较高的权限运行，攻击者可以通过代码注入获得更高的权限，从而控制整个 Kubernetes 集群，例如窃取secret，接管控制平面。

**总结：**

CVE-2023-5044 是一个高危漏洞，利用难度较低，攻击者可以通过简单的步骤实现代码注入和权限提升。建议受影响的用户尽快升级到 >= 1.9.0 的版本，并审查 Ingress 资源的配置，以防止潜在的攻击。

**项目地址:** [4ARMED/cve-2023-5044](https://github.com/4ARMED/cve-2023-5044)

**漏洞详情:** [CVE-2023-5044](https://nvd.nist.gov/vuln/detail/CVE-2023-5044)