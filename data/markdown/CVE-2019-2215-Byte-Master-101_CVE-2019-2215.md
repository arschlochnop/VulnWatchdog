## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可导致权限提升至Linux内核

**影响版本:** Kernel

**利用条件:** 需要安装恶意本地应用程序或利用网络应用中的其他漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-2215 是一个Android Binder驱动中的use-after-free漏洞，存在于binder.c中。攻击者可以通过利用此漏洞实现从应用程序到Linux内核的权限提升。

**有效性：**
提供的POC代码看起来是有效的。`README.md` 文件描述了漏洞利用的构建和执行过程，并且给出了成功提权的示例输出。示例输出显示了分配内存页、泄漏task_struct指针、获取任意读写权限，并最终将SELinux设置为permissive模式的过程。`Makefile` 提供了构建漏洞利用的必要步骤。

**投毒风险：**
该代码库的投毒风险较低，约为5%。主要基于以下几点考虑：
1.  `README.md` 提到了该代码基于Google Project Zero的概念验证，并且感谢了其他研究人员的工作，这表明代码的来源是可信的。
2.  代码结构清晰，`Makefile` 和 `exploit.c` 文件组织良好，易于理解和审查。
3.  漏洞利用代码本身较为复杂，即使存在恶意代码，也可能隐藏在复杂的逻辑之中，但整体来看，代码更偏向于PoC验证而非恶意后门，没有发现明显的恶意行为。
4.  免责声明明确指出该代码仅用于教育和展示目的，开发者不承担任何非法或不道德使用的责任，可以推断作者不希望代码被用于恶意目的。

但仍存在微小风险，例如作者可能在代码中加入细微的后门，但这种可能性较低。

**利用方式：**
此漏洞的利用方式涉及以下几个步骤：

1.  **内存布局：** 首先，在内存中分配一个大的对齐页面。
2.  **泄漏task_struct指针：**
    *   分配binder和epoll文件描述符。
    *   创建一个管道（pipe）。
    *   构建IOVEC堆栈。
    *   fork一个子进程。
    *   分配和链接binder_thread结构。
    *   释放binder_thread结构。
    *   将binder_thread结构重新分配为IOVECs。
    *   子进程触发unlink操作，并从管道中读取数据。
    *   父进程读取泄漏的task_struct指针。
3.  **获取任意读写权限：** 类似于泄漏task_struct指针的过程，但使用socket和消息头对象。
4.  **提权：**
    *   通过任意读写权限，找到SELinux enforcing标志的地址。
    *   将SELinux enforcing标志设置为0，从而将SELinux设置为permissive模式。

成功利用此漏洞后，攻击者可以获得root权限，从而完全控制设备。

**项目地址:** [Byte-Master-101/CVE-2019-2215](https://github.com/Byte-Master-101/CVE-2019-2215)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)