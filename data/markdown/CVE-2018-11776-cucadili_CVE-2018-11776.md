## CVE-2018-11776 Apache Struts2 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** 2.3 to 2.3.34 and 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定命名空间配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 漏洞存在于 Apache Struts 2 框架中，允许攻击者通过构造特制的 URL 来执行任意代码。漏洞的触发条件是 `alwaysSelectFullNamespace` 参数为 true，并且应用程序的命名空间配置存在缺陷，例如缺少命名空间或者使用通配符命名空间。根据漏洞库信息和搜索结果，此漏洞影响 Struts 2.3.x 到 2.3.34 以及 2.5.x 到 2.5.16 版本。

**有效性：**
提供的POC代码包含Suricata规则和内核模块，用于检测和阻止利用此漏洞的攻击。Python PoC的github链接也被给出，证明此漏洞存在可利用性。根据搜索结果，此漏洞已被广泛利用，因此提供的PoC代码是有效的。

**投毒风险：**
提供的代码仓库中存在一定投毒风险，风险预估为10%。
*   `module_kernel.ko`：这是一个内核模块，如果编译和加载过程被篡改，可能引入恶意代码。虽然提供的代码看起来是无害的，但不能完全排除编译过程被污染的可能性。
*   `test.rules`：Suricata规则本身是用于检测恶意流量的，但如果规则被设计为故意放过某些恶意流量，则可以达到投毒的效果。当前规则只是简单的检测是否存在`allowStaticMethodAccess`，可以绕过。
*   README.md中提供的github链接可能指向包含恶意payload的PoC，虽然目前无法确定，但也存在潜在风险。

**利用方式：**
1.  **确定目标环境：** 目标应用程序必须使用受影响的 Apache Struts 2 版本（2.3.x 到 2.3.34 以及 2.5.x 到 2.5.16），且 `alwaysSelectFullNamespace` 配置为 true。
2.  **构造恶意URL：** 攻击者需要构造一个包含恶意 OGNL 表达式的 URL。该表达式会被 Struts 2 框架解析和执行，从而实现远程代码执行。
3.  **发送HTTP请求：** 将构造好的恶意 URL 作为 HTTP 请求发送到目标应用程序。
4.  **执行任意代码：** 如果漏洞成功利用，攻击者可以在目标服务器上执行任意代码，例如安装后门、窃取数据或控制系统。

**缓解措施：**
1.  升级到不受影响的 Apache Struts 2 版本。
2.  确保 `alwaysSelectFullNamespace` 参数设置为 false（如果不需要该功能）。
3.  配置合适的命名空间，避免使用通配符命名空间。
4.  使用 Web 应用防火墙（WAF）或入侵检测系统（IDS）来检测和阻止恶意请求。

**项目地址:** [cucadili/CVE-2018-11776](https://github.com/cucadili/CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)