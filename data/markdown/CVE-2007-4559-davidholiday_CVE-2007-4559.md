## CVE-2007-4559 Python tarfile 目录遍历漏洞

**漏洞编号:** CVE-2007-4559

**漏洞类型:** 目录遍历

**影响应用:** Python tarfile module

**危害等级:** 高危，可能导致任意文件覆盖

**影响版本:** Python 3.11.4之前版本

**利用条件:** 需要用户协助解压恶意构造的tar文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2007-4559 存在于 Python 的 tarfile 模块中。当使用 extract 或 extractall 函数解压包含恶意构造的文件名的 TAR 压缩包时，攻击者可以利用目录遍历漏洞覆盖任意文件。漏洞利用方式如下：

1.  **创建恶意Tar文件：** 攻击者创建一个包含带有 '..' 序列的文件名的 tar 文件。例如，文件名可能是 '../../../../etc/passwd'。
2.  **欺骗用户解压：** 攻击者诱使用户使用存在漏洞的 Python 脚本解压该 tar 文件。
3.  **目录遍历：** 当 Python 的 tarfile 模块解压文件时，它不会正确地清理文件名中的 '..' 序列，导致文件被写入到 tar 包之外的目录，从而覆盖任意文件。

**POC代码分析：**
提供的POC代码模拟了攻击流程，展示了如何在tar文件中构造恶意路径，并通过`tarfile.extractall`或`tarfile.extract`函数进行目录遍历。

**有效性：**
POC代码有效，可以验证目录遍历漏洞。

**投毒风险：**
该仓库主要用于演示漏洞，用于论证`os.path.realpath()`在处理符号链接时存在的问题，使得在提取之前难以检测出恶意路径。 考虑到该代码仓库的主要目的是漏洞演示和验证，以及代码内容相对简单直接，包含恶意投毒代码的可能性较低，判断投毒风险较低，估计为10%。主要风险可能来自下载源的安全性，但代码本身隐藏恶意行为的可能性不大。

**项目地址:** [davidholiday/CVE-2007-4559](https://github.com/davidholiday/CVE-2007-4559)

**漏洞详情:** [CVE-2007-4559](https://nvd.nist.gov/vuln/detail/CVE-2007-4559)