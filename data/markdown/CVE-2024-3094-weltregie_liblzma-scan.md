## CVE-2024-3094-XZ Utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门

**影响应用:** XZ Utils

**危害等级:** 极危，可能导致SSH远程代码执行

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用了受感染的XZ Utils版本，并且SSH服务使用了liblzma库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3094 涉及 XZ Utils 工具中的一个供应链后门，该后门影响了 5.6.0 和 5.6.1 版本。该漏洞利用方式是通过一系列复杂的混淆，liblzma 构建过程从源代码中伪装的测试文件中提取预构建的目标文件。然后使用该文件修改 liblzma 代码中的特定函数，从而导致任何链接到该库的软件都可以使用修改后的 liblzma 库。这使得攻击者可以拦截和修改与该库的数据交互。

**有效性分析：**
提供的POC代码包含一个用于扫描系统上是否存在被感染的liblzma库的shell脚本（`liblzma-scan.sh`）和一个包含已知恶意liblzma库SHA256哈希值的文本文件（`hashes.txt`）。该脚本通过查找名为 `liblzma*` 的文件，计算其 SHA256 哈希值，并将其与 `hashes.txt` 文件中的哈希值进行比较，如果匹配，则表明存在后门。

**投毒风险分析：**
虽然这个 POC 的主要目的是检测受感染的文件，但存在一定的投毒风险。脚本`liblzma-scan.sh`本身相对简单，主要功能是查找文件并计算哈希值，并与提供的hash列表进行对比，没有明显的恶意行为。风险主要来自`hashes.txt`文件，如果攻击者能够篡改此文件，添加未被官方标记为恶意但实际包含后门的文件的哈希值，则可能导致误报。此外，脚本作者可能在脚本中添加了不易察觉的恶意代码，例如信息收集或远程执行命令。考虑到其检测恶意文件为目的，投毒可能性较低，估计为10%。

**利用方式：**
1.  **受影响版本识别：** 确定系统是否安装了受影响的 XZ Utils 版本（5.6.0 或 5.6.1）。
2.  **库扫描：** 运行 `liblzma-scan.sh` 脚本以检测系统中是否存在具有已知恶意哈希值的 `liblzma` 库。
3.  **SSH 利用：** 如果检测到受感染的库，攻击者可能能够利用该后门绕过 SSH 身份验证并执行远程代码。具体而言，该后门修改了 SSHd 的行为，使其在特定条件下允许未经授权的访问。

**搜索引擎结果印证：**
搜索引擎结果中，多个链接（例如，[webpage 1], [webpage 5], [webpage 6], [webpage 8]）都确认了 CVE-2024-3094 允许攻击者绕过 SSH 身份验证进行远程代码执行。 [webpage 4] 还提供了一个用于扫描漏洞的工具。


**项目地址:** [weltregie/liblzma-scan](https://github.com/weltregie/liblzma-scan)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)