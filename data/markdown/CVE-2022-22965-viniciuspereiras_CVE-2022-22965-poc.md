## CVE-2022-22965-Spring4Shell-RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行

**影响应用:** Spring Framework

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Spring Framework 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+，Tomcat作为WAR部署

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22965（Spring4Shell）是一个存在于Spring Framework中的远程代码执行漏洞。该漏洞利用了在JDK 9+环境下，Spring MVC或Spring WebFlux应用的数据绑定功能。攻击者通过构造恶意的请求，修改classloader中的属性，进而控制Tomcat的日志记录行为，最终写入webshell，实现远程代码执行。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞已在野外被积极利用，并且存在公开可用的POC代码。提供的POC代码利用了修改 Tomcat access log pattern 的方式写入 webshell，从而实现远程代码执行。

**投毒风险：**

检查提供的POC代码后，虽然POC利用了常见的漏洞利用方法（写入Webshell），但代码中包含一个密码验证逻辑 `--password`。如果攻击者不提供正确的密码，webshell将无法执行命令，从而增加了防御的难度，存在一定概率为后门，但概率较低。虽然webshell的写入行为本身具有一定的风险，但整体代码较为直接，投毒可能性较低。风险预估为1%。

**利用方式：**

1.  攻击者发送精心构造的HTTP请求到目标Spring应用。
2.  请求中包含的参数利用Spring的数据绑定机制，修改`class.module.classLoader.resources.context.parent.pipeline.first.pattern` 属性，将恶意代码（例如，webshell）写入Tomcat的access log pattern。
3.  访问目标应用的相应URL，触发webshell执行。
4.  攻击者通过webshell执行任意命令，实现远程代码执行。

**项目地址:** [viniciuspereiras/CVE-2022-22965-poc](https://github.com/viniciuspereiras/CVE-2022-22965-poc)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)