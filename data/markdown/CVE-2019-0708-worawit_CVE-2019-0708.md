## CVE-2019-0708 (BlueKeep)

**漏洞编号:** CVE-2019-0708

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Remote Desktop Services

**危害等级:** 严重，可能导致未经身份验证的远程代码执行

**影响版本:** Windows 7 SP1, Windows Server 2008 SP2, Windows Server 2008 R2 SP1

**利用条件:** 目标系统开启RDP服务，且未打CVE-2019-0708补丁，攻击者需要能够通过网络访问RDP端口（默认3389）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，对此漏洞进行分析如下：

**有效性：**
提供的POC代码（/tmp/17697ac0c48fcbdf2173a35ac144de87/NOTE.md）描述了针对CVE-2019-0708 (BlueKeep) 在Windows 7 和 Windows Server 2008上的利用方法。搜索引擎结果也显示存在可利用的POC。漏洞利用代码的分析表明，它针对RDP服务的Use-After-Free漏洞，通过操纵信道数据（特别是MS_T120信道）来控制RIP (Instruction Pointer)，从而实现代码执行。结合漏洞库信息，可以判断该POC具有较高的有效性，能够在未经身份验证的情况下远程执行代码。

**投毒风险：**
代码仓库中存在投毒代码的可能性评估为10%。分析主要基于提供的`NOTE.md`文件，该文件仅描述了漏洞利用的技术细节，没有发现任何恶意代码或后门。漏洞利用的核心在于利用RDP协议本身的缺陷来执行代码。因此，该仓库更大的风险是代码可靠性，而不是恶意投毒。更复杂的投毒可能存在其他文件中，此处无法进行全面分析。

**利用方式：**
1.  **目标确认：** 确认目标系统运行的是受影响的Windows版本 (Windows 7, Windows Server 2008)。
2.  **RDP端口探测：**  扫描目标系统的3389端口，确定RDP服务是否开启。
3.  **非分页池喷射：** 使用 RDPSND, RDPDR, REFRESH_RECT 信道进行非分页池喷射。
4.  **触发Use-After-Free：**  发送特制的RDP请求到MS_T120信道，触发Use-After-Free漏洞，释放信道。
5.  **内存布局控制：** 通过发送大量数据到特定信道（如RDPSND或RDPDR）来控制非分页内存池的布局。
6.  **RIP控制：**  通过构造信道数据，覆盖`pdata`指针，使其指向恶意代码，最终通过间接调用指令`call [reg]`控制RIP，执行恶意代码。
7.  **Shellcode执行：**  将shellcode注入到非分页内存池中，并通过上述RIP控制流程来执行shellcode，实现远程代码执行。

**项目地址:** [worawit/CVE-2019-0708](https://github.com/worawit/CVE-2019-0708)

**漏洞详情:** [CVE-2019-0708](https://nvd.nist.gov/vuln/detail/CVE-2019-0708)