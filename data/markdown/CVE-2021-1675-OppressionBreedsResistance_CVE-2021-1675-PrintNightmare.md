## CVE-2021-1675 PrintNightmare

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** 受影响的Windows版本详见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要具有在目标系统上添加打印机的权限(某些情况下，可以绕过)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过向Print Spooler服务发送特制的请求，加载恶意DLL文件，从而在系统上执行任意代码。 

**有效性：**

从提供的漏洞利用代码来看，这是一个有效的POC。它包含以下关键组成部分：

*   **MyDLL2.sln/MyDLL2目录:** 包含用于生成恶意DLL的Visual Studio解决方案和项目文件。
*   **MyDLL2.cpp:** 包含DLL的源代码，其中 `DllMain` 函数在DLL加载时执行 `system("echo Oppression Breeds Resistance > C:\proof.txt")` 命令。 这会在C盘根目录下创建一个名为`proof.txt`的文件，内容为“Oppression Breeds Resistance”，用于验证漏洞是否成功利用。
*   **README.md:** 说明了POC的使用方法，提到了使用了 Caleb Stewart 和 John Hammond 的 PowerShell 脚本，并包含了一个混淆后的 PowerShell 脚本。

**投毒风险：**

该仓库存在一定的投毒风险，风险评估为10%。 虽然主要的利用方式是已知的PrintNightmare漏洞利用，但作者添加了混淆的PowerShell脚本，如果用户直接使用该混淆脚本，可能会引入未知的恶意行为。 需要仔细审查混淆脚本的内容。

**利用方式：**

1.  **构建恶意DLL：** 使用提供的Visual Studio项目构建恶意的DLL (MyDLL2.dll)。 该DLL包含在加载时执行任意命令的代码。
2.  **利用Print Spooler服务：** 使用PowerShell脚本（或Impacket）通过 `AddPrinterDriverEx` 函数将恶意的DLL上传到目标系统。
3.  **触发DLL加载：** 上传DLL后，Print Spooler服务会尝试加载该DLL，从而执行DLL中的恶意代码。
4.  **远程代码执行：**  成功利用后，攻击者可以在目标系统上以SYSTEM权限执行任意命令。

**总结：**

该POC利用了PrintNightmare漏洞，允许攻击者通过Print Spooler服务在目标系统上执行任意代码。虽然主要代码是已知的漏洞利用，但混淆的PowerShell脚本增加了潜在的投毒风险，使用时需要谨慎审查。

**安全建议：**

*   及时安装Microsoft提供的安全补丁，修复PrintNightmare漏洞。
*   禁用Print Spooler服务，如果不需要使用打印功能。
*   限制用户在系统上添加打印机的权限。

**项目地址:** [OppressionBreedsResistance/CVE-2021-1675-PrintNightmare](https://github.com/OppressionBreedsResistance/CVE-2021-1675-PrintNightmare)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)