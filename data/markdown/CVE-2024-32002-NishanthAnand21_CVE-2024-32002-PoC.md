## CVE-2024-32002-Git-远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许攻击者在受害者机器上执行任意代码

**影响版本:** 2.39.4之前，以及2.40.0到2.40.2，2.41.0，2.42.0到2.42.2，2.43.0到2.43.4，2.44.0和2.45.0版本

**利用条件:** 需要目标系统启用符号链接支持，并且从恶意Git仓库克隆包含恶意submodule的仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是 Git 中一个远程代码执行 (RCE) 漏洞。该漏洞源于 Git 处理 submodules 的方式存在缺陷，攻击者可以构造恶意的 Git 仓库，其中包含一个精心设计的 submodule，该 submodule 利用了 Git 的漏洞，可以将文件写入 `.git/` 目录而不是 submodule 的工作目录。这允许攻击者在克隆操作期间执行恶意 hook，从而在受害者机器上执行任意代码。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的PoC是有效的。搜索结果中的 [webpage 6] 提到了一个演示如何利用该漏洞的PoC。
提供的PoC代码首先配置 Git 允许 file 协议和启用符号链接。然后，它创建一个包含恶意 post-checkout hook 的仓库 repo1。此 hook 包含一个 Payload，将在克隆 repo1 后执行。接下来，它创建一个包含 submodule 的仓库 repo2，该 submodule 指向 repo1。关键步骤是创建一个指向 `.git` 目录的符号链接，并将其添加到 repo2。最后，克隆 repo2 会触发恶意 hook，导致执行 Payload。

**投毒风险：**

该PoC本身就包含恶意代码(`<Payload>`)，用于在受害者机器上执行命令。投毒风险的评估旨在判断作者是否在PoC代码之外，还隐藏了其他的恶意代码或逻辑，用于进一步攻击或控制受害者系统。代码中可能存在潜在的投毒风险，但根据现有代码，没有找到明确的投毒代码。考虑到README中作者的个人站点链接，存在一定的概率通过其他方式植入后门，因此投毒风险预估为10%。

**利用方式：**

1.  **攻击者创建一个恶意 Git 仓库（例如 repo1），其中包含一个恶意 hook。** hook 的作用是在克隆仓库后执行 Payload。
2.  **攻击者创建一个包含 submodule 的 Git 仓库（例如 repo2），该 submodule 指向恶意仓库 repo1。**
3.  **攻击者创建一个指向 `.git` 目录的符号链接，并将其添加到 repo2。** 这一步是漏洞利用的关键，它欺骗 Git 将文件写入 `.git/` 目录。
4.  **受害者克隆仓库 repo2。** 在克隆过程中，Git 会尝试更新 submodule，由于存在符号链接，恶意 hook 将被写入 `.git/` 目录并执行，从而在受害者机器上执行 Payload。

该漏洞利用的先决条件是目标系统必须启用符号链接支持。如果 `core.symlinks` 设置为 `false`，则该漏洞无法利用。


**项目地址:** [NishanthAnand21/CVE-2024-32002-PoC](https://github.com/NishanthAnand21/CVE-2024-32002-PoC)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)