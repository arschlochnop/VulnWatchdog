## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行，可能导致系统完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，且允许用户控制的输入传递给`StringSubstitutor`进行插值

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中`StringSubstitutor`类的变量插值功能。如果应用程序使用受影响的Apache Commons Text版本（1.5到1.9）且允许用户控制的输入传递给`StringSubstitutor`进行插值，则攻击者可以通过构造包含恶意脚本、DNS或URL查找的输入来执行任意代码。根据漏洞利用代码，该代码提供了一个易受攻击的Web应用程序，它接受`cmd`参数，并将其传递给`StringSubstitutor`函数，从而允许RCE。由于该仓库的目的是为了漏洞演示，LICENSE文件使用的是标准的MIT协议，没有发现作者隐藏的投毒代码。

**利用方式：**

1.  **确定目标应用程序是否使用了受影响的Apache Commons Text版本（1.5-1.9）。**
2.  **识别应用程序中将用户控制的输入传递给`StringSubstitutor`进行插值的位置。**
3.  **构造包含恶意脚本、DNS或URL查找的输入。例如：**`${script:javascript:java.lang.Runtime.getRuntime().exec("command")}`**，`${dns:address}`**或者`${url:https://example.com}`**。**
4.  **将恶意输入发送到目标应用程序。**
5.  **如果漏洞利用成功，攻击者将在目标系统上执行任意代码。**

根据搜索结果，此漏洞被认为是高危漏洞，CVSS评分高达9.8，可能允许攻击者在受影响的系统上执行任意代码。 Apache Commons Text 1.10.0 通过禁用默认的危险插值器修复了此漏洞。

**项目地址:** [tulhan/commons-text-goat](https://github.com/tulhan/commons-text-goat)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)