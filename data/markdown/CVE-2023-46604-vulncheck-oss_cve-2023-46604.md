## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ的OpenWire协议端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞，存在于Java OpenWire协议marshaller中。攻击者可以通过网络访问Java-based OpenWire broker或client，通过操纵OpenWire协议中的序列化类类型，导致client或broker（相应地）实例化classpath上的任何类，从而执行任意shell命令。

**有效性：**根据漏洞库信息、搜索结果以及漏洞利用代码，该漏洞的POC代码是有效的。搜索结果表明该漏洞已经被积极利用，导致Kinsing恶意软件和勒索软件感染。

**投毒风险：** 提供的Dockerfile仅仅描述了如何编译和运行利用代码，LICENSE文件是Apache协议。提供的 exploit 示例较为简略，主要目的是利用漏洞，并无发现明显的恶意投毒代码。因此，判断投毒风险为0%。

**利用方式：** 攻击者利用此漏洞，通过发送特制的恶意序列化数据到ActiveMQ broker，broker在反序列化这些数据时，会加载并实例化攻击者指定的类，从而执行任意代码。这些类可以是攻击者构造的恶意类，也可以是broker classpath上已存在的类。常见利用方式是通过加载`org.springframework.context.support.ClassPathXmlApplicationContext`类，利用Spring的特性来执行代码。攻击者可以在XML配置文件中指定要执行的命令。由于是反序列化漏洞，常见的利用链如`CommonsCollections`也可能被利用。

**项目地址:** [vulncheck-oss/cve-2023-46604](https://github.com/vulncheck-oss/cve-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)