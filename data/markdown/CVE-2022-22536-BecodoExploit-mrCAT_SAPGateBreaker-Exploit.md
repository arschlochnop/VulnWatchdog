## CVE-2022-22536: SAP NetWeaver HTTP Request Smuggling

**漏洞编号:** CVE-2022-22536

**漏洞类型:** HTTP Request Smuggling

**影响应用:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**危害等级:** 高危，可导致权限绕过、缓存投毒、信息泄露、完全控制系统

**影响版本:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22 及受影响的 SAP Web Dispatcher 和 SAP Content Server 版本

**利用条件:** 需要能够访问受影响的 SAP NetWeaver 组件的网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22536 是 SAP NetWeaver 中一个严重 HTTP 请求走私漏洞。攻击者可以通过操纵 Content-Length 或 Transfer-Encoding 头部，在前端服务器和后端服务器之间造成请求解析差异，从而将恶意请求“走私”到后端。\n\n**有效性分析：** 根据漏洞库信息和提供的漏洞利用代码（SAPGateBreaker-Exploit），该漏洞利用尝试利用 Content-Length 头部进行请求走私。漏洞利用代码的描述提到，传统的 chunked 编码方式可能被 SAP ICM 拒绝，因此该 PoC 转向使用 Content-Length 进行 desynchronization。由于CISA KEV已收录，说明漏洞真实存在且利用较为广泛。该 PoC 的基本思路是通过发送一个精心构造的 POST 请求，其中包含一个嵌入式的 GET 请求，目标是访问内部资源。这种方法通常有效，因为前端服务器可能根据 Content-Length 只读取部分请求，而将剩余部分作为下一个请求发送到后端服务器。如果目标系统存在漏洞，PoC 大概率有效。\n\n**投毒风险分析：** 查看提供的文件列表，主要包含 LICENSE、README.md 和 exploit 脚本。LICENSE 声明了 MIT 许可，表明代码开源。README.md 文件描述了漏洞和 PoC 的基本信息。没有直接发现恶意代码。但是，由于HTTP请求走私本身的复杂性，以及SAP系统的复杂性，不排除作者可能在代码中植入不易察觉的后门或漏洞利用。例如，该 PoC 可能会尝试访问一些不应该访问的内部端点，或者在特定条件下触发一些意外行为。需要对PoC代码进行仔细分析，特别是网络请求部分。因此，投毒风险评估为10%，主要是考虑到代码中可能存在未知的漏洞或不安全行为。\n\n**利用方式：**\n1.  攻击者构造包含恶意负载的 HTTP 请求。\n2.  恶意负载利用 Content-Length 或 Transfer-Encoding 头部，使得前端服务器和后端服务器对请求边界的解析不一致。\n3.  前端服务器将部分恶意请求转发到后端服务器。\n4.  后端服务器将恶意请求作为合法请求处理，从而导致攻击者可以执行未授权操作，例如绕过身份验证、访问内部资源或篡改数据。

**项目地址:** [BecodoExploit-mrCAT/SAPGateBreaker-Exploit](https://github.com/BecodoExploit-mrCAT/SAPGateBreaker-Exploit)

**漏洞详情:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)