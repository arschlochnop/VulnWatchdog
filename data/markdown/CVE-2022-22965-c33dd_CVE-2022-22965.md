## CVE-2022-22965 - Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+, Tomcat 作为 WAR 部署，Spring MVC 或 Spring WebFlux 应用

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22965 (Spring4Shell) 是一种远程代码执行漏洞，存在于 Spring Framework 中。根据漏洞库信息和搜索结果，攻击者可以通过数据绑定利用此漏洞，向某些参数传递特制的恶意请求，从而获得对服务器的控制权。

**利用方式：**

1.  **目标：** 目标应用程序需要运行在 JDK 9 或更高版本上，并且部署为 Tomcat WAR 包。使用 Spring MVC 或 Spring WebFlux 框架。
2.  **漏洞触发：** 漏洞利用涉及操纵类加载器绕过安全机制。通过修改 Tomcat 的 AccessLogValve 组件，可以写入恶意 Web shell。
3.  **具体步骤：** 攻击者发送包含恶意参数的 HTTP 请求。这些参数被 Spring 的数据绑定机制处理，导致 `class.module.classLoader.resources.context.parent.pipeline.first.pattern` 属性被修改，从而写入 Web shell 到服务器的可访问位置。
4.  **代码分析：** 提供的POC代码是一个C程序，该程序尝试通过HTTP请求与目标服务器通信，并检查响应状态码以确定漏洞是否存在。关键部分在于构造特定的HTTP头，例如`suffix`和`c1`，以利用数据绑定漏洞。代码中没有发现明显的投毒代码。

**有效性：**

提供的C代码片段看起来像是漏洞利用的前期检查工具，用于验证目标是否存在漏洞。它通过发送包含特定header的HTTP请求并检查响应来尝试利用该漏洞。如果服务器返回 2XX 状态码，则认为漏洞存在。

**投毒风险：**

仔细审查提供的C代码后，没有发现任何可疑的、恶意的或隐藏的后门代码。代码的功能主要是发送HTTP请求，读取响应，并根据响应码判断漏洞是否存在。 因此，评估的投毒风险为 0%。

**项目地址:** [c33dd/CVE-2022-22965](https://github.com/c33dd/CVE-2022-22965)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)