## CVE-2023-40931-Nagios XI-SQL注入

**漏洞编号:** CVE-2023-40931

**漏洞类型:** SQL注入

**影响应用:** Nagios XI

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 5.11.0 <= version <= 5.11.1

**利用条件:** 需要Nagios XI管理员权限或已授权用户的身份验证

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

根据提供的漏洞信息、搜索结果和漏洞利用代码，可以进行以下分析：

1.  **有效性：**
    *   漏洞库信息和搜索结果都表明 CVE-2023-40931 是 Nagios XI 5.11.0 到 5.11.1 版本中的 SQL 注入漏洞，攻击者可以通过该漏洞执行任意 SQL 命令。
    *   漏洞利用代码 `exploit.py` 提供了完整的利用流程，包括身份验证、获取 token、测试 SQL 注入以及利用 sqlmap 提取数据库。脚本会先尝试使用提供的用户名和密码获取身份验证令牌，然后使用该令牌加载主页，接着通过向 `/admin/banner_message-ajaxhelper.php` 发送包含恶意 `id` 参数的 POST 请求来测试 SQL 注入。
    *   `exploit.py` 脚本如果成功检测到 SQL 错误，会打印相应的提示信息。此外，脚本还集成了 sqlmap 工具，可以自动利用该漏洞提取数据库。
    *   综合来看，提供的 POC 代码是有效的，可以用于验证和利用 CVE-2023-40931 漏洞。

2.  **投毒风险：**
    *   查看`exploit.py`代码，该脚本主要功能是验证和利用SQL注入漏洞。没有发现任何明显的恶意代码或后门。脚本使用 `requests` 库发送 HTTP 请求，并使用 `subprocess` 模块调用 `sqlmap` 工具。这两个操作本身是正常的漏洞利用流程，不属于投毒行为。
    *   `readme.md`文件也只包含免责声明和项目描述，没有可疑内容。
    *   综上所述，该仓库中存在作者隐藏的投毒代码的可能性较低。因此评估的投毒风险为 1%。

3.  **利用方式：**
    *   攻击者首先需要拥有 Nagios XI 的有效用户名和密码。根据漏洞描述，需要是已授权的用户，或者管理员用户。
    *   攻击者使用 `exploit.py` 脚本，提供目标 Nagios XI 的 URL、用户名和密码。
    *   脚本自动完成以下步骤：
        *   使用提供的凭据向 `/api/v1/authenticate` 发送 POST 请求，获取身份验证 token。
        *   使用获取的 token 加载主页，验证身份验证是否成功。
        *   向 `/admin/banner_message-ajaxhelper.php` 发送包含恶意 SQL 注入 payload 的 POST 请求，利用 `id` 参数中的 SQL 注入漏洞。
        *   如果检测到 SQL 错误，则说明漏洞存在，脚本会调用 sqlmap 工具，利用该漏洞提取数据库中的数据。
    *   通过修改 `exploit.py` 脚本中的 sqlmap 命令，可以实现更高级的攻击，例如执行任意系统命令。



**项目地址:** [G4sp4rCS/CVE-2023-40931-POC](https://github.com/G4sp4rCS/CVE-2023-40931-POC)

**漏洞详情:** [CVE-2023-40931](https://nvd.nist.gov/vuln/detail/CVE-2023-40931)