## CVE-2024-48990-needrestart-权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 权限提升

**影响应用:** needrestart

**危害等级:** 高危，本地攻击者可利用该漏洞以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 本地用户能够触发needrestart执行，例如通过apt安装/删除软件包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞存在于 needrestart 3.8 之前的版本中。该漏洞允许本地攻击者通过利用 PYTHONPATH 环境变量来欺骗 needrestart 运行 Python 解释器，从而以 root 权限执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意代码的 Python 模块，例如 `/tmp/malicious/importlib/__init__.so`。
2.  攻击者设置 PYTHONPATH 环境变量指向包含恶意模块的目录，例如 `/tmp/malicious`。
3.  攻击者触发 needrestart 执行，例如通过安装或删除软件包。
4.  当 needrestart 运行时，它会加载攻击者控制的 Python 模块。
5.  恶意模块中的代码将在 root 权限下执行。

**有效性：**

提供的 PoC 代码是有效的，它演示了如何利用该漏洞来获得 root 权限。PoC 代码创建一个共享库，该库在构造函数中运行，如果以 root 权限运行，则执行以下操作：

*   复制 `/bin/sh` 到 `/tmp/poc`
*   设置 `/tmp/poc` 的 SUID 位
*   将 `ALL ALL=NOPASSWD: /tmp/poc` 添加到 `/etc/sudoers`，允许任何用户无需密码以 root 权限运行 `/tmp/poc`。

然后，PoC 运行一个 Python 脚本，该脚本不断尝试导入 `importlib`，直到 `/tmp/poc` 存在，然后使用 `sudo /tmp/poc -p` 来启动一个提权的 shell。

**投毒风险：**

该仓库中没有发现明显的投毒代码。PoC 的目的是演示漏洞，而不是引入恶意软件。所有代码都相对清晰，并且意图明确。但是，始终建议仔细检查任何来自不受信任来源的代码。


**项目地址:** [pentestfunctions/CVE-2024-48990-PoC-Testing](https://github.com/pentestfunctions/CVE-2024-48990-PoC-Testing)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)