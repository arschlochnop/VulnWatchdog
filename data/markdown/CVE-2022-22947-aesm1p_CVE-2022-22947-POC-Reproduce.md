## CVE-2022-22947-Spring Cloud Gateway Code Injection

**漏洞编号:** CVE-2022-22947

**漏洞类型:** 代码注入

**影响应用:** Spring Cloud Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Spring Cloud Gateway versions 3.1.x prior to 3.1.1+, 3.0.x prior to 3.0.7+

**利用条件:** Gateway Actuator endpoint is enabled, exposed, and unsecured

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22947是一个存在于Spring Cloud Gateway中的代码注入漏洞。当Gateway Actuator端点被启用、暴露且未进行安全保护时，远程攻击者可以通过构造恶意请求执行任意代码。漏洞根源在于getValue方法中不安全的SpEL表达式求值。

**有效性：**
根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，且已经有公开的POC。漏洞利用代码是一个Maven项目，旨在重现漏洞。因此，提供的POC代码很可能是有效的。

**投毒风险：**
提供的代码仓库包含一个`README.md`文件和一个`mvnw`脚本。`mvnw` 是 Maven Wrapper 脚本，用于在没有安装 Maven 的情况下构建项目。检查 `mvnw` 脚本，它主要负责下载和启动 Maven，没有发现明显的恶意行为。但是，仍然存在一定的投毒风险，例如：
1.  **依赖项投毒：** 构建项目时使用的 Maven 依赖项可能包含恶意代码。 这种情况发生的概率较低，但存在可能。
2.  **构建脚本投毒：** `pom.xml`文件(未提供)中可能存在恶意插件或目标，在构建过程中执行恶意代码。由于未提供此文件，无法对此进行评估。

考虑到提供的文件主要与Maven构建相关，直接植入后门的难度较高，但通过依赖项投毒的可能性是存在的。因此，投毒风险估计为10%。

**利用方式：**
1.  **确定目标：** 找到运行着存在漏洞的Spring Cloud Gateway实例，并且其Actuator端点对外开放且未进行认证。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，发送到Actuator端点。这些SpEL表达式能够执行任意系统命令或代码。
3.  **远程代码执行：**  Spring Cloud Gateway解析并执行恶意SpEL表达式，从而导致远程代码执行。
4.  **控制系统：** 攻击者利用执行的恶意代码控制受害系统。

**优先级：**
根据信息来源的重要性排序：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [aesm1p/CVE-2022-22947-POC-Reproduce](https://github.com/aesm1p/CVE-2022-22947-POC-Reproduce)

**漏洞详情:** [CVE-2022-22947](https://nvd.nist.gov/vuln/detail/CVE-2022-22947)